<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêû üóÑÔ∏è üßñüèæ Smart House. Development and Implementation Experience üèì ü§Ø üëµüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will review the experience of developing and implementing a smart home in a two-room apartment. Here, the author‚Äôs point of view on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Smart House. Development and Implementation Experience</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/luxoft/blog/493746/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article we will review the experience of developing and implementing a smart home in a two-room apartment. </font><font style="vertical-align: inherit;">Here, the author‚Äôs point of view on the approach to the design and development of a smart home will be presented, as well as a turnkey solution that has been successfully working for 4 years.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qc/gv/bp/qcgvbphisnowbwjzukh0jo3faho.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welcome to those who want to make their home smart.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What is a smart home? We will get away from official definitions and look at it from the point of view of the consumer. When the author first shared his ideas of a smart home with his friend, he said, ‚ÄúCan't you get to the switch and turn on the light yourself?‚Äù In his own way, he is right - the author is lazy (a joke). The idea of ‚Äã‚Äãa smart home consists precisely in the fact that he himself would perform manipulations for us to control lighting, power supply, and at the same time, save resources and ensure safety. Thus, a smart home is a complex of software and hardware solutions aimed at improving the quality of life of those living in the house. Yes, that's right, a smart home should be considered as what makes your life more comfortable, and not as a big and expensive toy. In this concept, the author of the article recognizes voice control of a smart home as unnecessary and considerswhat a smart home should realize, and in the future, also anticipate typical human behavior.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Behavior patterns</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where to start when you think about a smart home? </font><font style="vertical-align: inherit;">With the choice of technology, a central controller? </font><font style="vertical-align: inherit;">No and no again. </font><font style="vertical-align: inherit;">First of all, ask yourself the question - why do I need a smart home? </font><font style="vertical-align: inherit;">What will he do for me? </font><font style="vertical-align: inherit;">According to the author of the article, there are four groups of functions that a smart home can provide:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Behavioral patterns - support for the typical behavior of living in an apartment, in terms of the use of electrical appliances and lighting.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comfortable environment - creating comfort depending on the conditions, for example, day, night, guests, romantic evening, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information support - various tips for people living in the apartment about the weather, traffic jams, current events, such as friends' birthdays, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safe home - emergency prevention, quick shutdown of electrical appliances, security functions.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All these groups of functions should be carefully thought out, coordinated with all those living in the apartment, and only after that we can talk about designing a smart home system. We show an example of such a design, using the example of the smart home function of the author of the article.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, let's start with behavioral patterns. To see them, you need to watch yourself and your family for some time. In the framework of observations, we record: what time does a person get up, does he always take food at the same time or in a certain interval, the route around the apartment, from the moment he wakes up to leave the house, the route along the apartment from the moment he arrives home to the end time. As a result, we get some picture in which it is important for us: what kind of light sources a person uses, what he needs for a comfortable existence ‚Äî the inclusion of a warm floor in the bathroom, soft lighting, dim lights at night, etc. Such patterns must be found for each family member and get something in between that won‚Äôt upset the comfort of others. Suppose a husband gets up earlier than his wife every day.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order not to wake up the wife, you can turn on a weak green light on the ceiling for five minutes instead of overhead lighting, and then turn it off (From the author‚Äôs experience, a weak green light does not interfere with other people‚Äôs sleep). As a result, two patterns were realized - the weekend morning and the morning of the week. Within the framework of these patterns, the smart home itself turns on the lighting at the right time, the radio turns off itself and tells with the help of various colors of the ceiling lights how much time is left before going to work. The patterns themselves are launched by the smart home on the basis of calculations of the necessary time for the morning procedures before the onset of an event from the Google calendar. For this, a special intelligent alarm clock was developed that analyzes data about upcoming events.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create a comfortable environment, it is also necessary to observe what kind of lighting is comfortable for us when we go to the kitchen at night, do we turn on the warm floor in the morning every day or only on weekends, what kind of lighting do we set when we watch TV? As a result of such observations, the author realized a green backlight in the rooms, and in public places the overhead light was 10% of the nominal, which is turned on and off by the command of motion sensors. When guests arrive, you can realize a smooth change in the colors of the backlight, ‚Äútwist‚Äù the video with a fireplace on the TV, and play pleasant music from the audio column. And all this by one command from the control panel or telegram. In the framework of this group of functions, the author realized, in addition to the night mode, turning on the bright white backlight while turning on the TV,guest mode with a smooth change in the color of the backlight.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Information support is optional, but enjoyable. It's good, after all, when you go to work, a caring smart home with a human voice reminds you of the need to take an umbrella, because it is raining outside. And in the evening, upon returning home, it is always pleasant to listen to calm music, after a long working day, which the same smart home automatically includes for you.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And finally, a safe home. </font><font style="vertical-align: inherit;">The basic function of any smart home is to turn off lighting and appliances when people leave home. </font><font style="vertical-align: inherit;">But what if you have a curious student at home who can do things while his parents are at work? </font><font style="vertical-align: inherit;">A smart home will turn off all sockets, leaving almost no chance of causing trouble. </font><font style="vertical-align: inherit;">And when the parents come, the system recognizes this, and turns on the power supply in the entire apartment. </font><font style="vertical-align: inherit;">The author of the article had a case when he forgot to turn off the electric stove and went to work. </font><font style="vertical-align: inherit;">And only due to the fact that the smart house automatically turned off all appliances did not happen unhappiness.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After all the wishes are formulated, you can begin to develop the architecture of a smart home. Here, it is important to take into account the scale of the room that the system will manage. You must decide on the topology of electrical and control lines in advance. The ideal option is a ‚Äústar‚Äù topology, when each consumer has its own power supply line, and all control electronics are assembled in one panel, next to the classic panel, where panel switches are installed. A more economical option is when the ‚Äúcommon bus‚Äù wiring is used as builders in Russia build), and the control relay is connected to the circuit directly in front of the device. The disadvantage of this method is the complexity of the subsequent maintenance of the relay, since then it can be closed by a stretch ceiling, tile or wallpaper.To date, there are relays that can be mounted directly in the mounting boxes along with electrical equipment, but deeper than those that are massively installed in new buildings in Russian cities.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next important point that defines the architecture of a smart home is control communications. </font><font style="vertical-align: inherit;">Management communications are of two types:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separate communication lines to each switch or relay, or a relay group controlled by one communication line, for example MegaD-2561 (https://ab-log.ru/). </font><font style="vertical-align: inherit;">Advantage - reliability, disadvantage - high costs for additional communication lines</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">radio control. </font><font style="vertical-align: inherit;">Each relay is controlled by a command transmitted over the air. </font><font style="vertical-align: inherit;">The advantages of this method include ease of installation and the absence of additional control lines. </font><font style="vertical-align: inherit;">The disadvantage is the radio signal, which can attenuate due to external interference and then the command may not reach the relay. </font><font style="vertical-align: inherit;">As an example of such relays, we can cite the Noolite system (http://noolite.by/), which is used by the author of the article</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on economic considerations, the author of the article for a smart home chose a radio channel. To increase the flexibility of the system, each "consumer" had its own electric line laid. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most important decision in the architecture of a smart home is the control scheme - decentralized or centralized. We will analyze each of them in detail</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a decentralized control scheme, all devices are interconnected and there is no single decision center in the system. Here the connection ‚Äúeach with each‚Äù is realized. In fact, this is no different from the usual lighting control circuit, except that the switches and the relays themselves receive a little bit of ‚Äúintelligence‚Äù and, for example, are able to turn off the lights by timeout, or from a single switch, immediately turn on several light sources controlled by different relay. In such a scheme, the presence of a smart home controller is allowed, which also receives notifications about the state of the light sources and can, in accordance with the embedded logic, send control commands to the relay.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q-/bx/gp/q-bxgpv4myuqtz5iqhn2q600usw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The diagram shows that the command from the button (Button) is sent directly to the relays associated with it, however, this command is also transmitted to the controller, which is simply notified of the fact of pressing. At the same time, the relay, when changing its state, also notifies the controller about this. Such a scheme is absolutely reliable, since in the event of a controller failure, the lighting will still work, but there will be no additional functions. On the other hand, such a scheme is less flexible, since it will be more difficult to implement changes in the logic of operation of one switch with different relays, for example, depending on the time of day. For such a task, a centralized scheme is suitable.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6b/m1/pv/6bm1pv_hjca3upj4q3cg6s5y4nu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From this diagram it is clear that all the commands are sent to the smart home controller and all control is also carried out by this controller. </font><font style="vertical-align: inherit;">The main disadvantage of such a scheme is a single point of failure. </font><font style="vertical-align: inherit;">When the controller fails, the whole system becomes inoperative, however, an important advantage of such a solution is great flexibility in device management, the ability to completely change the logic of work, depending on the preferences of the residents. </font><font style="vertical-align: inherit;">Based on the fact that the probability of controller failure is small (during the four-year operation of the system there was only one serious failure due to the memory card), the author chose a centralized architecture scheme for the smart home.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To implement a smart home, in addition to hardware solutions, the review of which is not the purpose of this article, you need to choose a software platform. </font><font style="vertical-align: inherit;">Now on the market there are a lot of solutions based on free software. </font><font style="vertical-align: inherit;">According to the author, the following projects are worthy of consideration (included systems with which the author worked directly):</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Majordomo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the system is written in PHP. </font><font style="vertical-align: inherit;">For programming, the concept of objects, their properties and methods is used. </font><font style="vertical-align: inherit;">It supports a large set of devices and has a large Russian community. </font><font style="vertical-align: inherit;">Good for a quick start, however, the use of the MySQL DBMS and the architecture of a classic web application by this system is its significant drawback. </font><font style="vertical-align: inherit;">This system was used by the author in the first version of the smart home. </font><font style="vertical-align: inherit;">You can use PHP or Google Blockly as a logic programming tool.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">OpenHAB </a>‚Äî   ,   Java.    ,            .           Google Blockly</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Node-red</a> ‚Äî       ,  ,         (rest, mqtt  .&nbsp;.).         , ,  ,     .&nbsp;.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> ioBroker</a> ‚Äî    JavaScript (Node JS).     ,        .    ‚Äî          .          JavaScript, Google Blockly  Node-red,     ioBroker   .          ,    2019 .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The smart home itself is currently implemented on the basis of the Rapsberry PI 3 and the Rapsberrian operating system. As already mentioned, the ioBroker system is used as a control system. Lighting and power management is based on Noolite technology. As a hardware add-on, a GSM module is used, which is used for emergency notification in the absence of the Internet, and also as an additional system control channel via SMS from trusted phones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The logic of interaction between devices is implemented based on JavaScript, Google Blockly and Node-red scripts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JavaScript is a regular program for NodeJS. For example, the chime of chimes is implemented in the author‚Äôs smart home like this:</font></font><br>
<br>
<pre><code class="javascript hljs">schedule(<span class="hljs-string">'0 0,8-23 * * *'</span>,() =&gt;<font></font>
	{<font></font>
	 <span class="hljs-keyword">let</span> currentTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
	 <span class="hljs-keyword">let</span> hour = currentTime.getHours();
	 <span class="hljs-keyword">if</span>(hour &gt; <span class="hljs-number">12</span>)<font></font>
		hour -= <span class="hljs-number">12</span>;
	 <span class="hljs-keyword">let</span> file = hour.toString() + <span class="hljs-string">'h.mp3'</span>;<font></font>
            playSound(<span class="hljs-string">'audio/'</span> + file); <font></font>
           });<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here, the ioBroker code calls every hour in the interval 8: 00-23: 00 a function that generates the name of the file in which the chime of the chime is recorded for the corresponding hour and plays the required audio file on the external device. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Blockly allows you to write code in a visual programming language without going into the details of JavaScript. For example, the inclusion of light in the hallway according to the motion sensor is implemented in this way: when the sun has set, the light turns on at 100%, in night mode - at 10% brightness: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/6e/8n/gg6e8ng63dvsdovrhq3g1qbscky.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we see a subscription to the event of a change in the state of the motion sensor. This code will be called when the state changes and contains ‚Äútrue‚Äù.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using Node-red, we can implement simple control scenarios. For example, in the bathroom, we can use a simple code to control the light from the motion sensor: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/aj/2q/fp/aj2qfpr1neatheymlpc8g6eh7e0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the moment when the motion sensor changes its state, the Node-red script blocks are automatically executed. When the motion sensor sends a ‚Äúturn off‚Äù command, the script gives a delay of 5 minutes, after which it turns off the light. If within 5 minutes the motion sensor sends a ‚Äúturn on‚Äù command, the delay will be reset and the light will remain on. A discussion of implementation details for Node-red blocks is beyond the scope of this article.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, thanks to the approach to smart home as a system that improves the quality of life, the author of the project was able to realize his dream of a smart home without experiencing significant economic costs. </font><font style="vertical-align: inherit;">At the time of the launch of the project for a two-room apartment, the costs amounted to about 50,000 rubles ($ 811).</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493732/index.html">Yesterday it was impossible, but today it is necessary: ‚Äã‚Äãhow to start working remotely and not cause a leak?</a></li>
<li><a href="../en493734/index.html">Perfectionism, cancellation: how technical specialists write articles</a></li>
<li><a href="../en493736/index.html">Security Week 13: Home Safety</a></li>
<li><a href="../en493740/index.html">Results of the online phase of NeoQUEST-2020: survived as best they could</a></li>
<li><a href="../en493742/index.html">How exchange rates and fuel prices depend on oil prices</a></li>
<li><a href="../en493748/index.html">Interest in the coronavirus COVID-19 on the Internet. What are they looking for, how much, where and how? Let's see Yandex.Wordstat and Google. Trends</a></li>
<li><a href="../en493752/index.html">CAPTCHA for codeigniter 4</a></li>
<li><a href="../en493754/index.html">Logistics. Part 1. Optimization of air traffic in directions and schedule formation</a></li>
<li><a href="../en493756/index.html">How to launch a startup in foreign markets during quarantine: Reddit, Product Hunt, resources in Latin America</a></li>
<li><a href="../en493758/index.html">Artificial intelligence will first create a corpus of ancient Slavic manuscripts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>