<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßíüèª üßÄ üë¥üèæ Is it dangerous to keep RDP open on the Internet? üßîüèΩ üóûÔ∏è üíó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often I read the opinion that keeping the RDP (Remote Desktop Protocol) port open on the Internet is very insecure, and you don‚Äôt need to. And you nee...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Is it dangerous to keep RDP open on the Internet?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487056/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Often I read the opinion that keeping the RDP (Remote Desktop Protocol) port open on the Internet is very insecure, and you don‚Äôt need to. </font><font style="vertical-align: inherit;">And you need to give access to RDP either through a VPN, or only from certain "white" IP addresses.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I administer several Windows Server for small companies, in which I was tasked with providing remote access to Windows Server for accountants. </font><font style="vertical-align: inherit;">Such a modern trend is work from home. </font><font style="vertical-align: inherit;">Quickly enough, I realized that tormenting VPN accountants is a thankless task, and collecting all the IPs for the whitelist will not work, because the IP addresses of the people are dynamic.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So I went the simplest way - I forwarded the RDP port out. </font><font style="vertical-align: inherit;">Now, for access, accountants need to run RDP and enter the host name (including port), username and password.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article I will share my experience (positive and not so good) and recommendations.</font></font></p><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The risks</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What are the risks of opening the RDP port?</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Unauthorized access to sensitive data.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If someone selects a password for RDP, he will be able to get the data that you want to keep private: account status, balances, customer data, ...</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Data loss, for</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
example, as a result of the operation of a cryptographic virus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or targeted action by an attacker.</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Loss of the workstation.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Workers need to work, and the system is compromised, you need to reinstall / restore / configure.</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Compromise of the local network</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If an attacker gained access to a Windows computer, then from that computer he will be able to access systems that are not accessible from the outside, from the Internet. </font><font style="vertical-align: inherit;">For example to file balls, to network printers, etc.</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I had a case when Windows Server caught a cryptor</font></font></b><div class="spoiler_text"><p>         C:,       NAS  .   NAS  Synology,   snapshots,  NAS    5 ,  Windows Server   .</p></div></div><br>
<h3>  </h3><br>
<p>  Windows Servers   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Winlogbeat</a>,     ElasticSearch.  Kibana   ,       .<br>
   ,      .</p><br>
<p>  :<br>
<b>a) RDP  -.</b><br>
     RDP      3389,  443 ‚Äî     HTTPS.    ,  ,     .     :</p><br>
<img src="https://habrastorage.org/webt/oc/mw/2k/ocmw2kyswnbz7foc09-2-z1ln-q.png" alt="Windows Logs in Kibana"><br>
<p>,      400 000     RDP.<br>
,      55 001 IP  ( IP     ).</p><br>
<p>     ,    fail2ban,  </p><br>
<div class="spoiler"><b class="spoiler_title"> Windows   - .</b><div class="spoiler_text"><p>     ,     ,       :<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://github.com/glasnt/wail2ban</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://github.com/EvanAnderson/ts_block</a></p><br>
<p>   ,     .</p><br>
<p>        ‚Äî   .</p></div></div><br>
<p><strong>Update</strong>:   ,   443 ‚Äî  ,      (32000+),   443  ,   RDP    ‚Äî  .</p><br>
<p><strong>Update:</strong>   ,    :<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://github.com/digitalruby/ipban</a></p><br>
<p>  IPBan,     :<br>
<img src="https://habrastorage.org/webt/oq/q1/ir/oqq1irnzeagwsqnbfpe4gbl9f_o.jpeg" alt="image"></p><br>
<div class="spoiler"><b class="spoiler_title"> IPBan   </b><div class="spoiler_text"><p>2020-02-11 00:01:18.2517|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.228,, RDP, 1<br>
2020-02-11 00:01:18.2686|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.228, Administrator, RDP, 2<br>
2020-02-11 00:02:49.7098|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147,, RDP, 3<br>
2020-02-11 00:02:49.7098|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147, Administrator, RDP, 4<br>
2020-02-11 00:04:20.9878|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.184.20,, RDP, 5<br>
2020-02-11 00:04:20.9878|WARN|DigitalRuby.IPBanCore.Logger|Banning ip address: 95.213.184.20, user name:, config black listed: False, count: 5, extra info:<br>
2020-02-11 00:04:20.9878|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.184.20, Administrator, RDP, 5<br>
2020-02-11 00:04:21.0040|WARN|DigitalRuby.IPBanCore.Logger|IP 95.213.184.20, Administrator, RDP ban pending.<br>
2020-02-11 00:04:21.1237|WARN|DigitalRuby.IPBanCore.Logger|Updating firewall with 1 entries‚Ä¶<br>
2020-02-11 00:05:36.6525|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.24,, RDP, 3<br>
2020-02-11 00:05:36.6566|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.24, Administrator, RDP, 4<br>
2020-02-11 00:07:22.4729|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 82.202.249.225, Administrator, RDP, 3<br>
2020-02-11 00:07:22.4894|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 82.202.249.225,, RDP, 4<br>
2020-02-11 00:08:53.1731|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 45.141.86.141,, RDP, 3<br>
2020-02-11 00:08:53.1731|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 45.141.86.141, Administrator, RDP, 4<br>
2020-02-11 00:09:23.4981|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 68.129.202.154,, RDP, 1<br>
2020-02-11 00:09:23.5022|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 68.129.202.154, ADMINISTRATOR, RDP, 2<br>
2020-02-11 00:10:39.0282|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147,, RDP, 5<br>
2020-02-11 00:10:39.0336|WARN|DigitalRuby.IPBanCore.Logger|Banning ip address: 95.213.143.147, user name:, config black listed: False, count: 5, extra info:<br>
2020-02-11 00:10:39.0336|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147, Administrator, RDP, 5<br>
2020-02-11 00:10:39.0336|WARN|DigitalRuby.IPBanCore.Logger|IP 95.213.143.147, Administrator, RDP ban pending.<br>
2020-02-11 00:10:39.1155|WARN|DigitalRuby.IPBanCore.Logger|Updating firewall with 1 entries‚Ä¶<br>
2020-02-11 00:12:09.6470|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 82.202.249.225,, RDP, 5<br>
2020-02-11 00:12:09.6470|WARN|DigitalRuby.IPBanCore.Logger|Banning ip address: 82.202.249.225, user name:, config black listed: False, count: 5, extra info: </p></div></div><br>
<p><b>b)   username,   </b><br>
,        .<br>
    :    ‚Äî    ,  . :         . ,      - :      DESKTOP-DFTHD7C       DFTHD7C:</p><br>
<img src="https://habrastorage.org/webt/4i/pp/2b/4ipp2bcvy1zml2ero2hwur2_hnu.png" alt="image"><br>
<p>,      DESKTOP-MARIA,         MARIA.</p><br>
<p>,     :   ,    ‚Äî    "administrator".   ,      Windows,   . </p><br>
<div class="spoiler"><b class="spoiler_title">  -   .</b><div class="spoiler_text"><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/local-accounts#administrator-account</a><br>
Administrator account<br>
The default local Administrator account is a user account for the system administrator. Every computer has an Administrator account (SID S-1-5-domain-500, display name Administrator). The Administrator account is the first account that is created during the Windows installation.</p><br>
<p>The Administrator account has full control of the files, directories, services, and other resources on the local computer. The Administrator account can create other local users, assign user rights, and assign permissions. The Administrator account can take control of local resources at any time simply by changing the user rights and permissions.</p><br>
<p>The default Administrator account cannot be deleted or locked out, but it can be renamed or disabled.</p></div></div><br>
<p>    :         .<br>
  ,        Administrator   Murmansk#9.     ,    ,          ,  ,   ‚Äî .<br>
   Administrator  ,    ?   !</p><br>
<p>   : </p><br>
<ul>
<li>      </li>
<li>,      Administrator</li>
<li>  </li>
</ul><br>
<p>  ,  ,   Windows Server    -  -  ,  .</p><br>
<p>  ,  ?<br>
     ,       RDP,    :</p><br>
<ul>
<li>  IP</li>
<li>   (hostname)</li>
<li> </li>
<li>GeoIP </li>
</ul><br>
<p>     ‚Äî   .</p><br>
<p>,   - IP -  ,    IP ( )     PowerShell:</p><br>
<pre><code class="powershell hljs"><span class="hljs-built_in">New-NetFirewallRule</span> <span class="hljs-literal">-Direction</span> Inbound <span class="hljs-literal">-DisplayName</span> <span class="hljs-string">"fail2ban"</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">"fail2ban"</span> <span class="hljs-literal">-RemoteAddress</span> (<span class="hljs-string">"185.143.0.0/16"</span>, <span class="hljs-string">"185.153.0.0/16"</span>, <span class="hljs-string">"193.188.0.0/16"</span>) <span class="hljs-literal">-Action</span> Block</code></pre><br>
<p>  Elastic,  Winlogbeat   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Auditbeat</a>,         .   SIEM (Security Information &amp; Event Management)   Kibana.      ,      ‚Äî  Auditbeat     Linux ,  SIEM      .</p><br>
<p>   :</p><br>
<ul>
<li>   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">put Security Updates on time</font></font></li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus: a list of 50 users who were most often used for login attempts via RDP</font></font></b><div class="spoiler_text"><div class="scrollable-table"><table>
<thead>
<tr>
<th>Ôªø"user.name: Descending"</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>dfthd7c (hostname)</td>
<td>842941</td>
</tr>
<tr>
<td>winsrv1 (hostname)</td>
<td>266525</td>
</tr>
<tr>
<td>ADMINISTRATOR</td>
<td>180678</td>
</tr>
<tr>
<td>administrator</td>
<td>163842</td>
</tr>
<tr>
<td>Administrator</td>
<td>53541</td>
</tr>
<tr>
<td>michael</td>
<td>23101</td>
</tr>
<tr>
<td>server</td>
<td>21983</td>
</tr>
<tr>
<td>steve</td>
<td>21936</td>
</tr>
<tr>
<td>john</td>
<td>21927</td>
</tr>
<tr>
<td>paul</td>
<td>21913</td>
</tr>
<tr>
<td>reception</td>
<td>21909</td>
</tr>
<tr>
<td>mike</td>
<td>21899</td>
</tr>
<tr>
<td>office</td>
<td>21888</td>
</tr>
<tr>
<td>scanner</td>
<td>21887</td>
</tr>
<tr>
<td>scan</td>
<td>21867</td>
</tr>
<tr>
<td>david</td>
<td>21865</td>
</tr>
<tr>
<td>chris</td>
<td>21860</td>
</tr>
<tr>
<td>owner</td>
<td>21855</td>
</tr>
<tr>
<td>manager</td>
<td>21852</td>
</tr>
<tr>
<td>administrateur</td>
<td>21841</td>
</tr>
<tr>
<td>brian</td>
<td>21839</td>
</tr>
<tr>
<td>administrador</td>
<td>21837</td>
</tr>
<tr>
<td>mark</td>
<td>21824</td>
</tr>
<tr>
<td>staff</td>
<td>21806</td>
</tr>
<tr>
<td>ADMIN</td>
<td>12748</td>
</tr>
<tr>
<td>ROOT</td>
<td>7772</td>
</tr>
<tr>
<td>ADMINISTRADOR</td>
<td>7325</td>
</tr>
<tr>
<td>SUPPORT</td>
<td>5577</td>
</tr>
<tr>
<td>SOPORTE</td>
<td>5418</td>
</tr>
<tr>
<td>USER</td>
<td>4558</td>
</tr>
<tr>
<td>admin</td>
<td>2832</td>
</tr>
<tr>
<td>TEST</td>
<td>1928</td>
</tr>
<tr>
<td>MySql</td>
<td>1664</td>
</tr>
<tr>
<td>Admin</td>
<td>1652</td>
</tr>
<tr>
<td>GUEST</td>
<td>1322</td>
</tr>
<tr>
<td>USER1</td>
<td>1179</td>
</tr>
<tr>
<td>SCANNER</td>
<td>1121</td>
</tr>
<tr>
<td>SCAN</td>
<td>1032</td>
</tr>
<tr>
<td>ADMINISTRATEUR</td>
<td>842</td>
</tr>
<tr>
<td>ADMIN1</td>
<td>525</td>
</tr>
<tr>
<td>BACKUP</td>
<td>518</td>
</tr>
<tr>
<td>MySqlAdmin</td>
<td>518</td>
</tr>
<tr>
<td>RECEPTION</td>
<td>490</td>
</tr>
<tr>
<td>USER2</td>
<td>466</td>
</tr>
<tr>
<td>TEMP</td>
<td>452</td>
</tr>
<tr>
<td>SQLADMIN</td>
<td>450</td>
</tr>
<tr>
<td>USER3</td>
<td>441</td>
</tr>
<tr>
<td>1</td>
<td>422</td>
</tr>
<tr>
<td>MANAGER</td>
<td>418</td>
</tr>
<tr>
<td>OWNER</td>
<td>410</td>
</tr>
</tbody>
</table></div></div></div></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487042/index.html">64-core Ryzen Threadripper 3990X defeats all Intel processors in tests, including $ 20,000 Xeon</a></li>
<li><a href="../en487044/index.html">Privacy? No not heard</a></li>
<li><a href="../en487046/index.html">How to build a native library for Android</a></li>
<li><a href="../en487052/index.html">Kaboom: an unusual sapper</a></li>
<li><a href="../en487054/index.html">ROS: Dedicated to those stuck in Gazebo ... Platform for a robot for 28,000 rubles</a></li>
<li><a href="../en487058/index.html">"Hadoop. ZooKeeper ‚Äùfrom the Mail.Ru Group Technostream series‚Äú Distributed Processing of Large Data in Hadoop ‚Äù</a></li>
<li><a href="../en487060/index.html">Using Google Chrome? So Google collects your data through X-client-data</a></li>
<li><a href="../en487062/index.html">CBS allowed Linux users to watch Star Trek, thanks to her for that</a></li>
<li><a href="../en487064/index.html">My second year as an independent developer</a></li>
<li><a href="../en487066/index.html">Work with the Chinese chip ADC Hx711</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>