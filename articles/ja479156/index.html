<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜ ğŸ¡ ğŸ‘¨ğŸ¿â€ğŸ’» ESP32 + Arduino Core + FreeRTOS + Blynk =å¿ƒã®å§‹ã¾ã‚Šã‚’æŒã¤å®¶ â™¿ï¸ â™Šï¸ ğŸ§Ÿ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„
 

ã©ã†ã„ã†ã‚ã‘ã‹ã€ç§ã¯ç§ã®å®¶ã€ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚’å»ºã¦ãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ç§ã®è´…æ²¢ãªaulã«ã¯ã‚¬ã‚¹ãŒãªãã€è¿‘ã„å°†æ¥ã«äºˆæƒ³ã•ã‚Œãªã„ã®ã§ã€ç§ã¯ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚’é¸ã³ã¾ã—ãŸ-ç§ã«ã¨ã£ã¦ã€é›»æ°—ã§åŠ ç†±ã™ã‚‹ã“ã¨ã¯éå¸¸ã«é«˜ä¾¡ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚ã¾ã‚ã€ãã‚Œã¯ãã‚ŒãŒæœ€ã‚‚å®‰ã„æŠ€è¡“ã®ä¸€ã¤ã ã‹ã‚‰ã§ã™ã€‚
 ã‚ã‹ã£ãŸã€...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESP32 + Arduino Core + FreeRTOS + Blynk =å¿ƒã®å§‹ã¾ã‚Šã‚’æŒã¤å®¶</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479156/"><h2 id="celi-proekta"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã©ã†ã„ã†ã‚ã‘ã‹ã€ç§ã¯ç§ã®å®¶ã€ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚’å»ºã¦ãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç§ã®è´…æ²¢ãªaulã«ã¯ã‚¬ã‚¹ãŒãªãã€è¿‘ã„å°†æ¥ã«äºˆæƒ³ã•ã‚Œãªã„ã®ã§ã€ç§ã¯ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚’é¸ã³ã¾ã—ãŸ-ç§ã«ã¨ã£ã¦ã€é›»æ°—ã§åŠ ç†±ã™ã‚‹ã“ã¨ã¯éå¸¸ã«é«˜ä¾¡ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">ã¾ã‚ã€ãã‚Œã¯ãã‚ŒãŒæœ€ã‚‚å®‰ã„æŠ€è¡“ã®ä¸€ã¤ã ã‹ã‚‰ã§ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ã‹ã£ãŸã€å®¶ã®å‘¨ã‚Šã«ãƒ‘ã‚¤ãƒ—ã‚’æŠ•ã’ã€ãƒãƒƒãƒ†ãƒªãƒ¼ã€ãƒœã‚¤ãƒ©ãƒ¼ã‚’æ›ã‘ãŸã€‚æš–ã‹ã„ã‚ˆã†ã«è¦‹ãˆãŸãŒã€ä½•ã‹ãŒãŠã‹ã—ã„ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªåˆ†ã®å£°ã‚’èã„ã¦ã€ã“ã‚Œã¯å¥½ãã§ã¯ãªã„ãƒ’ã‚­ã‚¬ã‚¨ãƒ«ã§ã‚ã‚‹ã“ã¨ã«æ°—ä»˜ãã¾ã—ãŸã€‚å®¶ã«ã„ãªã„ã¨ãï¼ˆ1æ—¥12ã€œ16æ™‚é–“ï¼‰ã€æš–æˆ¿ã¯æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã«ã¯ã‚ãšã‹ãªæ…£æ€§ãŒã‚ã‚Šã€ã™ã°ã‚„ãæ¸©åº¦ã‚’ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€æ©Ÿèƒ½ã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚åˆ°ç€ã™ã‚‹å‰ã«ã®ã¿ã‚ªãƒ³ã«ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã©ã“ã‹é•·ã„é–“å®¶ã‚’å‡ºãŸã¨ãã¨åŒã˜çŠ¶æ³ã€‚</font><font style="vertical-align: inherit;">ã¾ã‚ã€ä¸€èˆ¬çš„ã«ã€è·¯ä¸Šã§ãƒœã‚¤ãƒ©ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’æ¸©åº¦ã®å¤‰åŒ–ã«åˆã‚ã›ã¦ã²ã­ã‚‹ã“ã¨ã¯ã€ã©ã†ã„ã†ã‚ã‘ã‹ã‚³ãƒ¼ã‚·ãƒ£ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªå‹•åŒ–ãŒãªã‘ã‚Œã°ã€ã©ã“ã«ã‚‚ãƒœã‚¤ãƒ©ãƒ¼ãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªãƒœã‚¤ãƒ©ãƒ¼ã§ã‚ã‚‹ã“ã¨ãŒæ˜ã‚‰ã‹ã«ãªã‚Šã¾ã—ãŸãŒã€å¤–éƒ¨åˆ¶å¾¡ãƒªãƒ¬ãƒ¼ã‚’æ¥ç¶šã™ã‚‹ãŸã‚ã®æ¥ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚‚ã¡ã‚ã‚“ã€å¿…è¦ãªæ©Ÿèƒ½ã‚’ã™ã¹ã¦å‚™ãˆãŸãƒœã‚¤ãƒ©ãƒ¼ã‚’ã™ãã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€ç§ã«ã¨ã£ã¦ã€ãã®ã‚ˆã†ãªãƒœã‚¤ãƒ©ãƒ¼ã¯ãªã‚“ã¨ãªãéäººé“çš„ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã•ã‚‰ã«ã€ç§ã¯arduinoãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã‚ã‚Šã¾ã™ãŒã€é ­ã‚’ä½¿ã£ã¦ã—ã‚ƒãŒã‚“ã ã‚Šã€é­‚ã®ãŸã‚ã«ä½•ã‹ã‚’ãŠã—ã£ã“ã—ãŸã‚Šã€å°‘ã—Cã‚’å­¦ã³ãŸã„ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Ÿéš›ã«è¦ä»¶ã«ã¤ã„ã¦ï¼š</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚»ãƒƒãƒˆãƒã‚¤ãƒ³ãƒˆæ¸©åº¦åˆ¶å¾¡</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±‹å¤–ã¾ãŸã¯æ‰‹å‹•ã§ã®æ¸©åº¦ã«å¿œã˜ãŸã‚¯ãƒ¼ãƒ©ãƒ³ãƒˆæ¸©åº¦ã®åˆ¶å¾¡</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨­å®šãŒç•°ãªã‚‹ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã€æ—¥ä¸­ã¯å†·ãŸãã€å¤œã¯ã‚ˆã‚Šé«˜æ¸©</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªå‹•ãƒ¢ãƒ¼ãƒ‰ã€è‡ªå‹•æ˜¼å¤œç§»è¡Œ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€±æœ«ã®æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ã€è‡ªå‹•é·ç§»ãªã— </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ¼ãƒ©ãƒ³ãƒˆæ¸©åº¦ã‚’æ‰‹å‹•ã§è¨­å®šã—ã€ãƒœã‚¤ãƒ©ãƒ¼ã‚’ã‚ªãƒ³/ã‚ªãƒ•ã§ãã‚‹éè‡ªå‹•ãƒ¢ãƒ¼ãƒ‰ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒœã‚¿ãƒ³ã¨ç”»é¢ã‹ã‚‰ã€ãŠã‚ˆã³Webã‚µã‚¤ãƒˆ/ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»‹ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§åŠ ç†±åˆ¶å¾¡</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã‚Œã¯åˆã‚ã§ã—ãŸã€ãã—ã¦ç§ã¯è‹¦ã—ã‚“ã§è¿½åŠ ã—ã¾ã—ãŸï¼š</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¡—è·¯ç¯åˆ¶å¾¡ï¼ˆLEDã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚µãƒ¼ã€ã‚µã‚¤ãƒ¬ãƒ³ã€è¡—ç¯ã«åŸºã¥ãè­¦å ±ã‚·ã‚¹ãƒ†ãƒ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒœã‚¤ãƒ©ãƒ¼ã«ã‚ˆã£ã¦æ¶ˆè²»ã•ã‚Œã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ—¥/æœˆ/å¹´ã”ã¨ã«æ¸¬å®š+å¹´é–“ã®å„æœˆã”ã¨</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ãƒ³ãƒ—ã®ã‚†ã£ãã‚Šã¨ã—ãŸç‚¹æ»…ã®ã¿ã«ã‚ˆã‚‹è­¦å ±ãƒ¢ãƒ¼ãƒ‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ãƒ³ãƒ—ã®é«˜é€Ÿç‚¹æ»…ã¨ã‚µã‚¤ãƒ¬ãƒ³ã®çŸ­ã„ãƒ“ãƒ¼ãƒ—éŸ³ã«ã‚ˆã‚‹ä¿¡å·ãƒ¢ãƒ¼ãƒ‰</font></font></li>
<li>         </li>
</ul><br>
<p>   â€”  ,     ,       . ,     Arduino ,      , ..       .        ,     .</p><br>
<h2 id="chto-bylo-v-nachale">   </h2><br>
<p>       Arduino Nano + ESP8266,  ESP   ,    .  ?         ,       ,       .  ESP   ?      . </p><br>
<p>Arduino   ,      GPIO,  ESP      Blynk,          GPIO.     UART,   JSON    .  ,      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>.</p><br>
<p> ,       (     ),       .       Arduino IDE,     ,      ,     .</p><br>
<h2 id="zhelezo"></h2><br>
<p>,  ,    ESP32 devkit v1,    GPIO,       .  ,       .</p><br>
<p> :</p><br>
<ul>
<li>ESP32 devkit v1 noname China</li>
<li>3   DS18B20,   ,      </li>
<li>  4 </li>
<li>pir  HC-SR501</li>
</ul><br>
<p>   ,         .</p><br>
<h2 id="pochemu-freertos-i-arduino-core"> FreeRTOS  Arduino Core</h2><br>
<p> Arduino   ,      Blynk,   Arduino Core     . </p><br>
<p>FreeRTOS             .       ,  , ,   ,  â€”    ,     Arduino ,          loop. </p><br>
<p>  FreeRTOS       ,     . ,  Arduino      ,   ,     â€”     .       ,         ,   .</p><br>
<h2 id="pro-logiku"> </h2><br>
<h3 id="pro-freertos-taski"> FreeRTOS </h3><br>
<p>â†’   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  </a></p><br>
<p>,   FreeRTOS  setup    main,    ,    FreeRTOS tasks ( ),  loop    .</p><br>
<p>      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">calculate_water_temp</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *pvParameters)</span>
</span>{
   <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<font></font>
        {<font></font>
        <span class="hljs-keyword">if</span> (heating_mode == <span class="hljs-number">3</span>) {}
        <span class="hljs-keyword">else</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (temp_outside &gt; <span class="hljs-number">-20</span>)<font></font>
                max_water_temp = <span class="hljs-number">60</span>;
            <span class="hljs-keyword">if</span> (temp_outside &lt;= <span class="hljs-number">-20</span> &amp;&amp; temp_outside &gt; <span class="hljs-number">-25</span>)<font></font>
                max_water_temp = <span class="hljs-number">65</span>;
            <span class="hljs-keyword">if</span> (temp_outside &lt;= <span class="hljs-number">-25</span> &amp;&amp; temp_outside &gt; <span class="hljs-number">-30</span>)<font></font>
                max_water_temp = <span class="hljs-number">70</span>;
            <span class="hljs-keyword">if</span> (temp_outside &lt;= <span class="hljs-number">-30</span>)<font></font>
                max_water_temp = <span class="hljs-number">85</span>;<font></font>
        }<font></font>
        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_RATE_MS);<font></font>
    }<font></font>
}</code></pre><br>
<p>  ,      _void <code>pvParameters</code>,     ,   <code>while (true)</code>. </p><br>
<p>    (   )     <code>vTaskDelay(1000 / portTICK_RATE_MS)</code>  1 .        , ,    ,   ,   ,     ,   .</p><br>
<p>     setup.     <code>xTaskCreate</code>:</p><br>
<p><code>xTaskCreate(calculate_water_temp, "calculate_water_temp", 2048, NULL, 1, NULL);</code></p><br>
<p> ,      <em>calculate_water_temp</em> â€”  ,     2048 â€”    . </p><br>
<p>      1024 ,     ,        (     uart),       2 ,    â€”   2      .      ,  ESP32   ,         .</p><br>
<p>      â€” ,        ,  â€” .   NULL  .   :</p><br>
<p><code>TaskHandle_t slow_blink_handle;</code> </p><br>
<p>,      <code>xTaskCreate</code>    :</p><br>
<p><code>xTaskCreate(outside_lamp_blinks, "outside_lamp_blynk", 10000, (void *)1000, 1, &amp;slow_blink_handle);</code></p><br>
<p>     ,  :</p><br>
<p><code>vTaskDelete(slow_blink_handle);</code></p><br>
<p>         <code>panic_control</code>.</p><br>
<h3 id="pro-freertos-myuteksy"> FreeRTOS </h3><br>
<p>            uart, wifi  ..       wifi     . </p><br>
<p>   : </p><br>
<p><code>SemaphoreHandle_t wifi_mutex;</code> </p><br>
<p> <code>setup</code>  : </p><br>
<p><code>wifi_mutex = xSemaphoreCreateMutex();</code> </p><br>
<p>,         ,      ,          : </p><br>
<p><code>xSemaphoreTake(wifi_mutex, portMAX_DELAY);</code> </p><br>
<p><code>portMAX_DELAY</code> â€”          ,      . </p><br>
<p>           :</p><br>
<p><code>xSemaphoreGive(wifi_mutex);</code> </p><br>
<p>      <code>send_data_to_blynk</code>.</p><br>
<p>         ,   JTAG    ,     .</p><br>
<h3 id="kratkoe-opisanie-tasok">  </h3><br>
<p><code>get_temps</code> â€”    ,   30 ,   .<br>
<code>get_time_task</code> â€”  ,  NTP .     RTC  DS3231,       ,       .          ,          â€”   .       ,   ,     .         ,     0:00:00 â€”   .<br>
<code>calculate_water_temp</code> â€”  .<br>
<code>detect_pir_move</code> â€”      HC-SR501.     +3.3   ,      <code>digitalRead</code>, ,           GND â€” <code>pinMode(pir_pin, INPUT_PULLDOWN);</code><br>
<code>heating_control</code> â€”   .<br>
<code>out_lamp_control</code> â€”   .<br>
<code>panic_control</code> â€”       .           , <code>outside_lamp_blinks</code>  <code>siren_beeps</code>.   FreeRTOS      ,      ,       , ..     . FreeRTOS         .      <code>loop</code>     , ..    .<br>
<code>guard_control</code> â€”   .<br>
<code>send_data_to_blynk</code> â€”     Blynk.<br>
<code>run_blynk</code> â€”    <code>Blynk.run()</code>       Blynk.            .  <code>Blynk.run()</code>   <code>loop</code>,            .<br>
<code>write_setting_to_pref</code> â€”             .  pref   .<br>
<code>count_heated_hours</code> â€”    .   ,       (  30 ),          .<br>
<code>send_heated_hours_to_app</code> â€”         0.00833 (1/120 ),        Blynk.<br>
<code>feed_watchdog</code> â€”  Watchdog.   watchdog, ..       .     â€” ,       ,   watchdog   .   watchdog 10 ,          10 .<br>
<code>heart_beat</code> â€”   .     ,       . ..      ,    UART â€”  <code>Serial.begin(9600);</code>    UART  .  . </p><br>
<h3 id="esp32-nvs-wear-leveling">ESP32 NVS wear leveling</h3><br>
<p><em>   ,   ,      . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a> </em></p><br>
<p>       Arduino  EEPROM .    ,         ,     flash    . </p><br>
<p> ESP32  EEPROM,      4 Mb flash ,      â€”        .        â€” NVS, FATFS, SPIFFS.         . </p><br>
<p>..        Int,   NVS â€” Non-Volitile Storage.          ,   .     ,      NVS. </p><br>
<p>  EEPROM,   FLASH     ,   EEPROM     100000  1 000 000 ,  FLASH â€”  .      ,   60  60   24 = 86 400 /.        11 ,    .         . </p><br>
<p>   ,  <code>update()</code> <code>put()</code>  EEPROM Arduino     .            ,    . </p><br>
<p> NVS       (wear leveling).   ,    flash   ,      .     NVS     ,     ,      flash .     : .  ,   ,   EEPROM, ..     ,     . <strong>Upd:</strong>     15 !</p><br>
<p>    <code>1</code>   <code>somekey</code>,     <code>2</code>    ,     ,     (Erased),      : </p><br>
<p><img src="https://habrastorage.org/webt/pw/ri/of/pwriofnineuwy7bmctgzcngiqrk.jpeg"></p><br>
<p>      <code>somekey</code>      . ..  ,            . </p><br>
<p>   , Empty â€” ,  , Active â€”       , Full â€” ,    .      ,  <br>
Active   Full,   Empty   Active. </p><br>
<p><img src="https://habrastorage.org/webt/6q/lz/ym/6qlzymofwdhy9ah2x-ekgpd23tq.jpeg"></p><br>
<p>       Espressif   ,         .   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>,      1  .</p><br>
<p>   ,    (Non-Erased),    ,   . </p><br>
<p> ,  -        ,    â€”  .   ,    NVS   1 MB,         170,     .    NVS   . </p><br>
<p>    NVS  ESP32  Arduino Core    Preferences,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>.</p><br>
<h3 id="nemnogo-o-visualgdb">  VisualGDB</h3><br>
<p>      Arduino IDE,         Visual Studio. ,  VS   ,   ,      50   Arduino IDE     .       IDE  . ..    VS,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">VisualGDB</a>. </p><br>
<p> Arduino IDE,   ESP32   .      ,        . </p><br>
<h3 id="izmenenie-tablicy-razdelov-esp32-pri-rabote-s-visualgdb">   ESP32    VisualGDB</h3><br>
<p>  ,   ESP32  ,     .<br>
    csv ,   VisualGDB   : </p><br>
<pre><code class="plaintext hljs">Name,   Type, SubType, Offset,  Size, Flags  <font></font>
nvs,      data, nvs,     0x9000,  0x5000,  <font></font>
otadata,  data, ota,     0xe000,  0x2000,  <font></font>
app0,     app,  ota_0,   0x10000, 0x140000,  <font></font>
app1,     app,  ota_1,   0x150000,0x140000,  <font></font>
spiffs,   data, spiffs,  0x290000,0x170000,</code></pre><br>
<p>     NVS,        .    ,  app0( ),       0x10000,    ,     . ,     ,     ""   .       0x8000.  ,  NVS    0x5000 â€” 20KB,    . </p><br>
<p>     : </p><br>
<pre><code class="plaintext hljs">Name,   Type, SubType, Offset,  Size, Flags  <font></font>
app0,     app,  ota_0,   0x10000, 0x140000,  <font></font>
nvs,      data, nvs,     ,  1M,  <font></font>
otadata,  data, ota,     ,  0x2000,  <font></font>
spiffs,   data, spiffs,  ,  0x170000,<font></font>
</code></pre><br>
<p>     Name,     ,        .</p><br>
<p> ,  NVS   1 MB.    ,       ,  ,      app0. CSV       txt         csv.</p><br>
<p>,      , ..        .    :<br>
<code>c:\Users\userName\Documents\ArduinoData\packages\esp32\hardware\esp32\1.0.3\tools\gen_esp32part.exe part_table_name.csv part_table_name.bin</code>.   â€”  CSV,   â€”  .</p><br>
<p>     <code>c:\Users\userName\Documents\ArduinoData\packages\esp32\hardware\esp32\1.0.3\tools\partitions\part_table_name.csv</code>,            ,      .   ,       <code>c:\Users\userName\Documents\ArduinoData\packages\esp32\hardware\esp32\1.0.3\boards.txt</code>.     <code>esp32doit-devkit-v1.build.partitions=part_table_name</code><br>
  , VisualGDB             <br>
<code>~project_folder_path\Output\board_name\Debug\project_name.ino.partitions.bin</code>,      .</p><br>
<h3 id="jtag-otladchik-cjmc-ft232h">JTAG  CJMC-FT232H</h3><br>
<p>  ,    ,     ESP32,     600,  Aliexpress  .</p><br>
<p><img src="https://habrastorage.org/webt/gn/cu/gm/gncugmqpjnb1hbmj630nnegxjgq.jpeg"></p><br>
<p>   Windows     ,       Zadig,   ,   .</p><br>
<p>  ESP32 devkit-v1   :<br>
FT232H â€” ESP32<br>
AD0 â€” GPIO13<br>
AD1 â€” GPIO12<br>
AD2 â€” GPIO15<br>
AD3 â€” GPIO14<br>
   <code>Project -&gt; VisualGDB Project Properties</code>    : </p><br>
<p><img src="https://habrastorage.org/webt/eg/oi/7b/egoi7bhrpkjaprfvyz-jd9puccw.jpeg"> </p><br>
<p>    Test.         ,    ,      Test.    ,      5 .</p><br>
<p>        USB  ESP32(  ),      <code>Debug -&gt; Attach to Running Embedded Firmware</code>.      ,          <code>Debug -&gt; Windows -&gt; Threads</code>     FreeRTOS   ,   ,      .        .<br>
     NVS,      .   ,              NVS  ,     NVS   . ,     ,  2  NVS,     â€”  ,     .       ,   ,     ,       . </p><br>
<h3 id="glyuki-esp32"> ESP32</h3><br>
<p>    Aliexpress,  ESP32   ,    .   ,       ,   I2C,      ,   ,    +5V         .   â€”  .</p><br>
<p>       0.7A,  ds18b20   3.3V ,      â€”     2. GND      GND   .    â€”  .</p><br>
<h3 id="o-rezultatah-proekta">  </h3><br>
<p>       ,      .         23   -5 â€” -7 ,    11   .    20     23  ,    9   .   6,     2,2,   26,4  .       200 ,         -5 .     5000    . </p><br>
<p>    2000,       ,     ,         20000.  ,             ,     , ,        C++      (     ).  ,  ,  .</p><br>
<p>   Blynk:</p><br>
<p><img src="https://habrastorage.org/webt/f8/a-/57/f8a-57tioype-tcgmjmodpagpwa.jpeg"></p><br>
<p><img src="https://habrastorage.org/webt/ez/3a/o3/ez3ao3_ht2lgjsbf9jvv_xcoksc.jpeg"></p><br>
<p><img src="https://habrastorage.org/webt/xi/xv/f-/xixvf-6pvrnw-2trm_toszimwrm.jpeg"></p><br>
<p>,     ,               .    . ,     ,     ,    ,     ,     . </p><br>
<p>     ,   .      . </p><br>
<h3 id="upd1">UPD1:</h3><br>
<p>       esp_restart(),          (       ).     ,   .               reboot  .   ESP32 devkit v1   EN,    3,3 ,      ESP32.    +5 ,        0,   3,3   ESP32,       .<br>
 ,     esp_restart() pinMode(reset_pin, OUTPUT), reset_pin     GPIO2.   ,       INPUT mode,     ,      UOTPUT,       LOW.    EN  LOW   .<br>
     GPIO2   EN .<br>
     â€”   :) </p><br>
<h3 id="upd2">UPD2:</h3><br>
<p>,  Blynk.run()  ESP32    WiFi   .      run_blynk.<br>
 , ,       Blynk.begin(),   WiFi .       ,         .   begin  connectWiFi   BlynkSimpleEsp32.h         .  ,      WiFi    ,     ,   WiFi ,    Blynk.<br>
      GitHub. </p><br>
<p>:</p><br>
<ol>
<li>   WiFi â€” , . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiFiã‚’ä½¿ç”¨ã›ãšã«ãƒœãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€WiFiãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚WiFiãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒè¡¨ç¤ºã•ã‚ŒãŸå¾Œã€èª­ã¿è¾¼ã¾ã‚Œã€æ©Ÿèƒ½ã—ã¾ã™ã€‚WiFiãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯Blynkã«æ¥ç¶šã•ã‚Œã¾ã™ã€‚ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiFiã‚’ä½¿ç”¨ã—ã¦ãƒœãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŒã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã—ãªã„-ãƒ­ãƒ¼ãƒ‰ã€ä½œæ¥­ä¸­ã€‚ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiFiã‚’ä½¿ç”¨ã—ã¦ãƒœãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ãŒã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãªã„ã¨ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™-èª­ã¿è¾¼ã¾ã‚Œã€æ©Ÿèƒ½ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸå¾Œã€Blynkã«æ¥ç¶šã—ã¾ã™ã€‚ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiFi +ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒœãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€WiFiãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒæ¶ˆãˆã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚WiFiãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å¾©å…ƒã™ã‚‹ã¨ã€ãƒœãƒ¼ãƒ‰ã¨Blynkã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¾ã™ã€‚ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiFi +ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ãƒœãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒæ¶ˆãˆã¦è¡¨ç¤ºã•ã‚Œã¾ã™-ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒå¾©æ—§ã™ã‚‹ã¨ã€Blynkã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¾ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤§ä¸ˆå¤« ï¼šï¼‰</font></font></li>
</ol><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚è€ƒæ–‡çŒ®ä¸€è¦§</font></font></b><div class="spoiler_text"><ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">http://microsin.net/programming/ARM/freertos-part1.html</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">https://docs.espressif.com/projects/esp-idf/en/latest/api-reference/storage/nvs_flash.html</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/partition-tables.html</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">https://docs.blynk.cc/</a></li>
</ol><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479144/index.html">ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹</a></li>
<li><a href="../ja479146/index.html">ãƒã‚¤ãƒ‘ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ã®æ¯”è¼ƒ\ VPN</a></li>
<li><a href="../ja479150/index.html">è¾²æ¥­ç”¨ãƒ­ãƒœãƒƒãƒˆãŒé€²åŒ–ã—ã¦ã„ã‚‹</a></li>
<li><a href="../ja479152/index.html">npmã¨ãƒ“ãƒ«ãƒ‰ãªã—ã®Reactã¨Vue</a></li>
<li><a href="../ja479154/index.html">ã¾ã æˆ¦ã„ã§ã™ã‹ã€ãã‚Œã¨ã‚‚ååˆ†ã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja479158/index.html">ITILã®7ã¤ã®åŸºæœ¬åŸå‰‡</a></li>
<li><a href="../ja479162/index.html">å¤ªé™½ç³»ã®æƒ‘æ˜Ÿä¸Šã®ã‚ªãƒ¼ãƒ­ãƒ©</a></li>
<li><a href="../ja479164/index.html">EEGã¨ã¯ä½•ã‹ã€ãªãœãã‚ŒãŒå¿…è¦ãªã®ã‹</a></li>
<li><a href="../ja479166/index.html">tarantoolã®åˆ¶é™ä»˜ãæœ‰åŠ¹æœŸé™ä»˜ããƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹</a></li>
<li><a href="../ja479168/index.html">MODXãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Symfony 5 + APIãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§RESTful APIã‚’ä½œæˆã™ã‚‹æ–¹æ³•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>