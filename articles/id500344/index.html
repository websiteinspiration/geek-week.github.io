<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆🏿 🎃 🥨 Rumah pintar di atas roda ... Alice. Bagian 2. ZIGBEE 🤯 🎅 🧕🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kelanjutan epik dengan kontrol suara
 Di bagian sebelumnya, melalui Alice, suara itu dikendalikan oleh pengontrol MiLight. Tetapi pengendali seperti i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rumah pintar di atas roda ... Alice. Bagian 2. ZIGBEE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500344/"><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kelanjutan epik dengan kontrol suara</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bagian sebelumnya, melalui Alice, suara itu dikendalikan oleh pengontrol MiLight. Tetapi pengendali seperti itu sama sekali tidak ada di setiap rumah, yang sangat membatasi kemampuan kami. Oleh karena itu, saya mulai memperluas kontrol suara ke lampu biasa, lampu, lampu gantung, dan sebagainya, tetapi dengan perubahan minimal dari sistem pencahayaan standar. Semua yang diperlukan untuk sistem semacam itu adalah penggantian sakelar konvensional dengan sakelar cerdas yang beroperasi sesuai dengan protokol ZigBee dan pemasangan koordinator USB ZigBee CC2531. Tentu saja, dari artikel sebelumnya, kami sudah memiliki kolom Yandex yang pintar dan kekacauan yang disesuaikan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biaya CC2531 biaya 250 rubel, programmer untuk itu CC-Debugger Texas Instrument - 500 rubel. Sakelar pintar sentuh Livolo VL-C701Z-11 adalah yang paling mahal - sekitar 2.000 rubel masing-masing, dan beberapa saat kemudian sakelar tombol Aqara Wall Switch Zigbee juga ditambahkan sekitar tahun 2000.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awalnya, saya berencana untuk mengontrol sakelar melalui router gateway ZigBee, Livolo C700ZW-12, menghubungkannya ke hub terbuka dan mengarahkan menggunakan Alice melalui yandex2mqtt. Saya menghubungkan kelenjar ke listrik, mengatur aplikasi dari Livolo di telepon. Saya melihat gateway beralih, terhubung, dan semuanya bekerja dengan baik dari telepon. Tetapi hub terbuka dengan router tidak dapat digabungkan karena kurangnya fungsionalitas yang diperlukan di hub terbuka. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harus meninggalkan gateway dan menggabungkan switch secara langsung dengan dongle CC2531. Dan di sini proyek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zigbee2mqtt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari teman Koenkk </font><font style="vertical-align: inherit;">membantu dengan ini </font><font style="vertical-align: inherit;">. Sebagai hasilnya, kami berhasil menghubungkan koordinator ZigBee dengan sakelar cerdas, pertama memeriksa operasinya melalui kueri dalam topik mqtt untuk dianalisis, dan kemudian mengonfigurasi kontrol menggunakan Alice.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, bagaimana pengaturannya: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Jalankan sniffer CC2531 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan firmware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> koordinator dan hubungkan ke port usb. Untuk menghindari pesan tentang kekurangan daya, lebih baik untuk menghubungkan setidaknya 2A ke catu daya 5V. Kami memeriksa bahwa tongkat dalam sistem didefinisikan dengan benar: ls -l / dev / serial / by-id akan menampilkan sesuatu seperti usb-Texas_Instruments_TI_CC2531_USB_CDC ___ 0X00124B0458ED3DDF-if00 -&gt; ../../ttyACM0. Kehadiran bagian terakhir dari output "-&gt; ../../ttyACM0" sangat penting jika itu. Tongkat dapat memutuskan tanpa bagian ini dan tidak ada yang akan berhasil. Memutar tongkat membantu saya dengan masalah seperti itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Instal </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zigbee2mqtt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi jangan mulai.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Sangat penting untuk mengkonfigurasi /opt/zigbee2mqtt/data/configuration.yaml dengan benar. Faktanya adalah Livolo smart switches beroperasi pada saluran 26, jadi saluran ini harus secara eksplisit diatur dalam file. Dan juga penting untuk memperhatikan jumlah spasi di awal baris file. Untuk memeriksa sintaks file konfigurasi, Anda dapat menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validator YAML</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Setelah file konfigurasi terdaftar dengan benar dan dongle macet, jalankan zigbee2mqtt. Kemudian kita menginjak sakelar, mulai memasangkan dan melihat output konsol. Akan ada garis pertukaran data, saling rassharkivaniya antara perangkat dan akhirnya sesuatu seperti ini: </font></font><code>MQTT publish: topic 'zigbee2mqtt/0x001*********a8c9', payload '{"state_left":"OFF","state_right":"OFF","linkquality":60}'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ini berarti bahwa sakelar terhubung dan mengirimkan statusnya. Jika Anda menjalankan beberapa konsol lagi, maka Anda dapat mengontrol cahaya melalui topik mqtt: matikan</font></font><code>- mosquitto_pub -d -h localhost -t zigbee2mqtt/0x001*********a8c9/left/set -m OFF -u a**** -P *****</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan putar - </font></font><code>mosquitto_pub -d -h localhost -t zigbee2mqtt/0x001*********a8c9/left/set -m ON -u a**** -P *****</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan Anda juga dapat memeriksa tim di Topeka </font></font><code>mosquitto_sub -d -h localhost -t zigbee2mqtt/0x001*********a8c9/left/set -u a**** -P *****</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Omong-omong, untuk Livolo dan Aqara, topik tidak hanya berbeda dalam pengidentifikasi 0x0 ..., tetapi juga dalam struktur. Struktur topik untuk perangkat yang didukung dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Setelah kami memverifikasi bahwa kami dapat mengelola perangkat melalui mqtt, kami akan memasangkan semuanya dengan Yandex. Beberapa nuansa telah muncul di sini. Perintah untuk mengendalikan perangkat melalui zigbee2mqtt datang ke topik dalam bentuk ON / OFF, dan yandex2mqtt ternyata memberikan 1/0. Solusi untuk masalah ini adalah mengedit di yandex2mqtt file /mnt/data/root/yandex2mqtt/device.js. Apakah Anda perlu mengganti int = val di sakelar pada case "on"? ke 'on': 'off' bukannya '1': '0'. Secara alami, perintah switching harus diperbaiki di hub terbuka di topik yang sesuai. Tanpa ini, cahaya pada Milight akan berhenti bekerja. Dan hal yang paling menarik terungkap di sana - karena yandex2mqtt dan zigbee2mqtt menerbitkan semuanya di server mqtt lokal, tampaknya perangkat zenbee tidak memerlukan hub terbuka untuk mengelola perangkat.Bundel bekerja secara langsung - yandex (Alice) -yandex2mqtt-mqtt-zigbee2mqtt-device zigbee. Bahkan entah bagaimana caranya. Tapi mari kita lanjutkan. Kami akan mengajukan topik kontrol perangkat di file konfigurasi /mnt/data/root/yandex2mqtt/config.js ke perangkat virtual baru, perbarui daftar perangkat di sistem dialog Yandex dan Anda dapat menendang Alice untuk menyalakan lampu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Dimungkinkan juga untuk menghubungkan sepasang sensor Xiaomi, sensor kebocoran dan sensor suhu / kelembaban / tekanan ke sistem. </font><font style="vertical-align: inherit;">Mereka bekerja pada baterai 2032. Secara alami, mereka tidak dikontrol, tetapi mereka secara berkala menjatuhkan informasi seperti </font></font><code>#033[32mzigbee2mqtt:info #033[39m 2020-05-04 21:12:21: MQTT publish: topic 'zigbee2mqtt/0x0015************', payload '{"battery":91,"voltage":2985,"temperature":26.2,"humidity":28.65,"pressure":1006.9,"linkquality":52}' -   #  #033[32mzigbee2mqtt:info #033[39m 2020-05-04 21:21:07: MQTT publish: topic 'zigbee2mqtt/0x001************7', payload '{"battery":100,"voltage":3025,"linkquality":0,"water_leak":true}' </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensor kebocoran dalam segelas air </font><font style="vertical-align: inherit;">ke dalam topik </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sejauh ini, tidak ada manfaat khusus, tetapi jika semua ini otparsit dan melakukan sesuatu yang reaktif seperti mengirim SMS atau digit ke beberapa moncong web, maka itu akan sangat baik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sedikit video:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Pb8veRpRMTY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/9uNynR_LL-o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id500332/index.html">4 Mei Java Digest</a></li>
<li><a href="../id500334/index.html">Twister atau Kulkas di Pilot Brothers</a></li>
<li><a href="../id500336/index.html">Bagian 2: Modul dan AppStore. ESPboy - gadget untuk game retro dan eksperimen dengan IoT</a></li>
<li><a href="../id500338/index.html">[Terjemahan] Bilas</a></li>
<li><a href="../id500342/index.html">Apa podcast yang dimiliki oleh "Komite", "Habr" dan Sports.ru</a></li>
<li><a href="../id500346/index.html">Masalah dengan DNS di Kubernetes. Post-mortem publik</a></li>
<li><a href="../id500352/index.html">Bagaimana cara mendapatkan magang di Facebook dan mendapatkan tawaran di London? Ajukan Pertanyaan ke Insinyur Facebook</a></li>
<li><a href="../id500354/index.html">Cara baru untuk melacak data di Google Pengelola Tag - Penandaan Sisi Server</a></li>
<li><a href="../id500356/index.html">Transfer file langsung antar perangkat melalui WebRTC</a></li>
<li><a href="../id500360/index.html">Pertanyaan wawancara kesulitan menengah SQL terbaik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>