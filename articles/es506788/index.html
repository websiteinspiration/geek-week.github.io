<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ωüèª üîê ü•à Migraciones de bases de datos con Flyway üë®üèæ‚Äçüî¨ üë©üèº‚Äçüåæ üèâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se prepar√≥ una traducci√≥n del art√≠culo antes del inicio del curso de Desarrollador Java .
 
 
 1. Introducci√≥n
 Este art√≠culo describe los conceptos c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Migraciones de bases de datos con Flyway</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/506788/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se prepar√≥ una traducci√≥n del art√≠culo antes del inicio del curso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desarrollador Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Introducci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo describe los conceptos clave de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flyway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y un ejemplo del uso de este marco para cambiar continuamente el esquema de la base de datos usando la base de datos H2 en memoria como ejemplo usando el complemento flyway maven. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flyway actualiza las versiones de la base de datos mediante migraciones. Las migraciones pueden escribirse en SQL (con una sintaxis espec√≠fica para un DBMS espec√≠fico) o en Java. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las migraciones pueden ser versionadas o recurrentes. Los primeros tienen una versi√≥n √∫nica y se aplican exactamente una vez. Los segundos no tienen un n√∫mero de versi√≥n y se aplican cuando cambia su suma de verificaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las migraciones repetidas dentro de una sola ejecuci√≥n siempre se aplican despu√©s de completar las migraciones versionadas. </font><font style="vertical-align: inherit;">Las migraciones repetidas se aplican en el orden en que se describen. </font><font style="vertical-align: inherit;">En una migraci√≥n, todas las operaciones se realizan dentro de una sola transacci√≥n de base de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo, nos centraremos en usar el complemento Maven para migraciones de bases de datos.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Complemento Flyway Maven</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue el complemento flyway maven a </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs">&lt;plugin&gt;<font></font>
    &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;<font></font>
    &lt;artifactId&gt;flyway-maven-plugin&lt;/artifactId&gt;<font></font>
    &lt;version&gt;<span class="hljs-number">4.0</span><span class="hljs-number">.3</span>&lt;/version&gt;<font></font>
&lt;/plugin&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La versi√≥n actual del complemento se puede ver en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maven Central</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede encontrar una lista de par√°metros de complementos en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Los par√°metros del complemento se pueden configurar de cuatro maneras diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.1. </font></font><code><code>&lt;configuration&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
par√°metros de la </font><font style="vertical-align: inherit;">secci√≥n de </font><font style="vertical-align: inherit;">complementos </font><font style="vertical-align: inherit;">se pueden especificar directamente en la etiqueta en la secci√≥n de complementos en </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;plugin&gt;<font></font>
    &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;<font></font>
    &lt;artifactId&gt;flyway-maven-plugin&lt;/artifactId&gt;<font></font>
    &lt;version&gt;4.0.3&lt;/version&gt;<font></font>
    &lt;configuration&gt;<font></font>
        &lt;user&gt;databaseUser&lt;/user&gt;<font></font>
        &lt;password&gt;databasePassword&lt;/password&gt;<font></font>
        &lt;schemas&gt;<font></font>
            &lt;schema&gt;schemaName&lt;/schema&gt;<font></font>
        &lt;/schemas&gt;<font></font>
        ...<font></font>
    &lt;/configuration&gt;<font></font>
&lt;/plugin&gt;</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">Maven propiedades</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n puede configurar el complemento especificando par√°metros en </font></font><code><code>&lt;</code>properties&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs">&lt;project&gt;<font></font>
    ...<font></font>
    &lt;properties&gt;<font></font>
        &lt;flyway.user&gt;databaseUser&lt;/flyway.user&gt;<font></font>
        &lt;flyway.password&gt;databasePassword&lt;/flyway.password&gt;<font></font>
        &lt;flyway.schemas&gt;schemaName&lt;/flyway.schemas&gt;<font></font>
        ...<font></font>
    &lt;/properties&gt;<font></font>
    ...<font></font>
&lt;/project&gt;</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3. </font><font style="vertical-align: inherit;">Archivo de configuraci√≥n externo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O describa la configuraci√≥n en un </font></font><code>.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo </font><font style="vertical-align: inherit;">separado </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs">flyway.user=databaseUser<font></font>
flyway.password=databasePassword<font></font>
flyway.schemas=schemaName<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El nombre predeterminado es el archivo de configuraci√≥n </font></font><code>flyway.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Este archivo debe estar en el mismo directorio que el archivo </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La codificaci√≥n se establece en el par√°metro </font></font><code>flyway.encoding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(el valor predeterminado es UTF-8). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si usa un nombre diferente para el archivo (por ejemplo, </font></font><code>customConfig.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), debe especificarlo expl√≠citamente al llamar a maven:</font></font><br>
<br>
<pre><code class="java hljs">$ mvn -Dflyway.configFile=customConfig.properties</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4. </font><font style="vertical-align: inherit;">Propiedades del sistema</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, los par√°metros se pueden especificar como propiedades del sistema cuando se llama a maven desde la l√≠nea de comandos:</font></font><br>
<br>
<pre><code class="java hljs">$ mvn -Dflyway.user=databaseUser -Dflyway.password=databasePassword<font></font>
  -Dflyway.schemas=schemaName</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la configuraci√≥n se especifica de varias maneras, la prioridad ser√° la siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Propiedades del sistema</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivo de configuraci√≥n externo</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propiedades de la </font><font style="vertical-align: inherit;">secci√≥n</font></font><code>&gt;</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secci√≥n de </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configuraci√≥n del </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">complemento</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Ejemplo de migraci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta secci√≥n, consideraremos los pasos necesarios para migrar un esquema de base de datos usando la base de datos H2 en memoria como ejemplo usando el complemento maven. </font><font style="vertical-align: inherit;">Para configurar Flyway, utilizaremos un archivo externo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1. </font><font style="vertical-align: inherit;">POM cambios</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar, agregue una dependencia en H2:</font></font><br>
<br>
<pre><code class="java hljs">&lt;dependency&gt;<font></font>
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;<font></font>
    &lt;artifactId&gt;h2&lt;/artifactId&gt;<font></font>
    &lt;version&gt;<span class="hljs-number">1.4</span><span class="hljs-number">.196</span>&lt;/version&gt;<font></font>
&lt;/dependency&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ tambi√©n podemos consultar la √∫ltima versi√≥n de controlador disponible en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maven Central</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Agregue un complemento para Flyway, como se describi√≥ anteriormente.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2. </font><font style="vertical-align: inherit;">Configurar Flyway en un archivo externo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree un </font></font><code>$PROJECT_ROOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo </font></font><code>myFlywayConfig.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con los siguientes contenidos:</font></font><br>
<br>
<pre><code class="java hljs">flyway.user=databaseUser<font></font>
flyway.password=databasePassword<font></font>
flyway.schemas=app-db<font></font>
flyway.url=jdbc:h2:mem:DATABASE<font></font>
flyway.locations=filesystem:db/migration</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuraci√≥n anterior indica que los scripts de migraci√≥n est√°n en el directorio </font></font><code>db/migration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y para conectarse a la base de datos utilizando H2 </font></font><code>databaseUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>databasePassword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esquema de base de datos para la aplicaci√≥n </font></font><code>app-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, en los par√°metros </font></font><code>flyway.user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>flyway.password</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>flyway.url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe especificar el nombre, contrase√±a y URL de su base de datos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3. </font><font style="vertical-align: inherit;">Primera migraci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n las convenciones de Flyway, los nombres de los scripts de migraci√≥n deben estar en el siguiente formato:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Prefix&lt;code&gt;&gt;&lt;&lt;/code&gt;Version&gt;__&lt;code&gt;&lt;&lt;/code&gt;Description&gt;.sql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√≥nde:</font></font><br>
<br>
<ul>
<li><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prefijo&gt; - prefijo. </font><font style="vertical-align: inherit;">Para las migraciones versionadas, el valor predeterminado es "V". </font><font style="vertical-align: inherit;">El prefijo se configura a trav√©s de la propiedad flyway.sqlMigrationPrefix.</font></font></li>
<li><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versi√≥n&gt;: n√∫mero de versi√≥n de migraci√≥n. </font><font style="vertical-align: inherit;">Las versiones mayor y menor se pueden separar subrayando. </font><font style="vertical-align: inherit;">La versi√≥n siempre debe comenzar con 1.</font></font></li>
<li><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n&gt;: una descripci√≥n textual de la migraci√≥n. </font><font style="vertical-align: inherit;">La descripci√≥n debe estar separada del n√∫mero de versi√≥n por dos guiones bajos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo: </font></font><code>V1_1_0__my_first_migration.sql</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, creemos un directorio </font></font><code>db/migration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font></font><code>$PROJECT_ROOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la migraci√≥n del script </font></font><code>V1_0__create_employee_schema.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y SQL para crear la tabla </font></font><code>employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs">CREATE TABLE IF NOT EXISTS `employee` (<font></font>
 <font></font>
    `id` <span class="hljs-keyword">int</span> NOT NULL AUTO_INCREMENT PRIMARY KEY,<font></font>
    `name` varchar(<span class="hljs-number">20</span>),<font></font>
    `email` varchar(<span class="hljs-number">50</span>),<font></font>
    `date_of_birth` timestamp<font></font>
 <font></font>
)ENGINE=InnoDB DEFAULT CHARSET=UTF8;</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4. </font><font style="vertical-align: inherit;">Realizamos migraciones</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, </font></font><code>$PROJECT_ROOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejecute el siguiente comando maven para aplicar las migraciones de la base de datos:</font></font><br>
<br>
<pre><code class="java hljs">$ mvn clean flyway:migrate -Dflyway.configFile=myFlywayConfig.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestra primera migraci√≥n debe completarse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora el esquema de la base de datos se ve as√≠: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
empleado:</font></font><br>
<br>
<pre><code class="java hljs">+----+------+-------+---------------+<font></font>
| id | name | email | date_of_birth |<font></font>
+----+------+-------+---------------+</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos repetir los pasos anteriores para realizar otras migraciones.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5. </font><font style="vertical-align: inherit;">Segunda migraci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la segunda migraci√≥n, cree un archivo con el nombre que </font></font><code>V2_0_create_department_schema.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contenga las siguientes dos solicitudes:</font></font><br>
<br>
<pre><code class="java hljs">CREATE TABLE IF NOT EXISTS `department` (<font></font>
 <font></font>
`id` <span class="hljs-keyword">int</span> NOT NULL AUTO_INCREMENT PRIMARY KEY,<font></font>
`name` varchar(<span class="hljs-number">20</span>)<font></font>
 <font></font>
)ENGINE=InnoDB DEFAULT CHARSET=UTF8;<font></font>
 <font></font>
ALTER TABLE `employee` ADD `dept_id` <span class="hljs-keyword">int</span> AFTER `email`;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realicemos la migraci√≥n, tal como lo hicimos para la primera migraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora el esquema de nuestra base de datos ha cambiado: </font></font><code>employee</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ha agregado una nueva columna y se ha creado una nueva tabla </font></font><code>department</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<code>employee:</code><br>
<pre><code class="java hljs">+----+------+-------+---------+---------------+<font></font>
| id | name | email | dept_id | date_of_birth |<font></font>
+----+------+-------+---------+---------------+</code></pre><br>
<code>department:</code><br>
<br>
<pre><code class="java hljs">+----+------+<font></font>
| id | name |<font></font>
+----+------+</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar que ambas migraciones fueron exitosas, ejecute el siguiente comando maven:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ mvn flyway:info -Dflyway.configFile=myFlywayConfig.properties</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Desactivar la ruta de vuelo en Spring Boot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces puede que necesite deshabilitar las migraciones de Flyway. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto puede ser necesario durante las pruebas cuando se genera un esquema de base de datos basado en entidades. </font><font style="vertical-align: inherit;">En este caso, puede deshabilitar Flyway para el perfil de prueba. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Spring Boot, esto es muy simple.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1. </font><font style="vertical-align: inherit;">Spring boot 1.x</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo lo que necesitamos hacer es establecer la propiedad </font></font><code>flyway.enabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el archivo </font></font><code>application-test.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs">flyway.enabled=<span class="hljs-keyword">false</span></code></pre><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2. </font><font style="vertical-align: inherit;">Spring boot 2.x</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En versiones posteriores de Spring Boot, esta propiedad se ha cambiado a </font></font><br>
<br>
<pre><code class="java hljs">spring.flyway.enabled:<font></font>
spring.flyway.enabled=<span class="hljs-keyword">false</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3 V√≠a a√©rea vac√≠a Estrategia de migraci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si queremos deshabilitar solo la migraci√≥n autom√°tica de Flyway al inicio, pero queremos comenzar las migraciones manualmente, entonces usar las propiedades anteriores no funcionar√° para nosotros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto se debe al hecho de que Spring Boot no configurar√° autom√°ticamente los contenedores Flyway y, por lo tanto, tendremos que configurarlos nosotros mismos, lo que no es muy conveniente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, podemos dejar Flyway habilitado e implementar una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FlywayMigrationStrategy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vac√≠a </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmptyMigrationStrategyConfig</span> </span>{<font></font>
 <font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FlywayMigrationStrategy <span class="hljs-title">flywayMigrationStrategy</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> flyway -&gt; {
            <span class="hljs-comment">// do nothing </span><font></font>
        };<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, esto deshabilitar√° las migraciones de Flyway cuando se inicie la aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero a√∫n podemos comenzar la migraci√≥n manualmente:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@RunWith(SpringRunner.class)</span>
<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManualFlywayMigrationIntegrationTest</span> </span>{<font></font>
 <font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Flyway flyway;<font></font>
 <font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">skipAutomaticAndTriggerManualFlywayMigration</span><span class="hljs-params">()</span> </span>{<font></font>
        flyway.migrate();<font></font>
    }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. C√≥mo funciona Flyway</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para rastrear cu√°ndo, por qui√©n y qu√© migraciones se aplicaron, se agrega una tabla especial con metadatos al esquema de la base de datos. </font><font style="vertical-align: inherit;">Esta tabla tambi√©n almacena las sumas de verificaci√≥n de las migraciones e informaci√≥n sobre si la migraci√≥n fue exitosa o no. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El marco funciona de la siguiente manera:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comprueba el esquema de la base de datos para una tabla de metadatos (predeterminado </font></font><code>SCHEMA_VERSION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Si la tabla de metadatos no existe, la crea.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escanea el classpath para las migraciones disponibles.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compara las migraciones con una tabla de metadatos. </font><font style="vertical-align: inherit;">Si el n√∫mero de versi√≥n es menor o igual que la versi√≥n marcada como actual, entonces se ignora.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marca todas las migraciones restantes como pendientes. </font><font style="vertical-align: inherit;">Luego los ordena en n√∫meros de versi√≥n ascendentes y los ejecuta en el orden especificado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A medida que se aplican las migraciones, actualiza la tabla de metadatos.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. equipos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flyway tiene los siguientes equipos principales de gesti√≥n de la migraci√≥n:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Info</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Muestra el estado / versi√≥n actual del esquema de la base de datos. </font><font style="vertical-align: inherit;">Informaci√≥n sobre qu√© migraciones se esperan, cu√°les se aplicaron, el estado de las migraciones completadas y la fecha de su finalizaci√≥n.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migrar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Actualizaci√≥n del esquema de la base de datos a la versi√≥n actual. </font><font style="vertical-align: inherit;">Escanee un classpath para encontrar las migraciones disponibles y aplicar las migraciones pendientes.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La l√≠nea de base</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Instalar la versi√≥n del esquema de la base de datos, ignorando las migraciones hasta e incluyendo baselineVersion. </font><font style="vertical-align: inherit;">La l√≠nea de base lo ayuda a usar Flyway en una base de datos existente. </font><font style="vertical-align: inherit;">Las nuevas migraciones se aplican como de costumbre.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El validar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Comprobaci√≥n del esquema de base de datos actual contra las migraciones disponibles.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La reparaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Restaurar tabla de metadatos.</font></font></li>
<li><b>Clean</b>.     . ,     clean    .</li>
</ul><br>
<h3>7. </h3><br>
<ul>
<li>    ,   Flyway             .</li>
<li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a>.</li>
</ul><br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">     FLYWAY</a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es506758/index.html">Los productos organizaron una conferencia sobre el principio del c√≥digo abierto, y durante 10 a√±os cada participante es un organizador</a></li>
<li><a href="../es506762/index.html">Semana de la seguridad 25: conjunto de parches r√©cord de Microsoft</a></li>
<li><a href="../es506766/index.html">Nos negamos a las plataformas RPA pagas y estamos basados ‚Äã‚Äãen OpenSource (OpenRPA)</a></li>
<li><a href="../es506772/index.html">Para crear o rechazar: una prueba de ideas para la fuerza</a></li>
<li><a href="../es506786/index.html">Habilidad para buscar trabajo</a></li>
<li><a href="../es506790/index.html">Escenario de datos de esteroides: Introducci√≥n a la inteligencia de decisiones</a></li>
<li><a href="../es506792/index.html">Zephyr's Embedded: experiencia con STM32F7-Discovery</a></li>
<li><a href="../es506796/index.html">MREM - 200. Microscopio electr√≥nico originario de la URSS</a></li>
<li><a href="../es506798/index.html">Ciencia de datos para las humanidades: qu√© son los datos</a></li>
<li><a href="../es506806/index.html">MVP para Android: los beneficios de usar Moxy como biblioteca auxiliar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>