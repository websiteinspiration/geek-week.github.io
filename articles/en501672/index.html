<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüç≥ ‚úãüèæ üå± How mods for Unity games are developed. Part 2: writing your mod ‚öúÔ∏è ‚¨ÜÔ∏è üìá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this part, using an example of a mod for Beat Saber, we will look at the general principles of developing mods for Unity games, find out what diffi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How mods for Unity games are developed. Part 2: writing your mod</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501672/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this part, using an example of a mod for Beat Saber, we will look at the general principles of developing mods for Unity games, find out what difficulties are there, and also get acquainted with Harmony, a library for modifying game code used in RimWorld, Battletech, Cities: Skylines, and many other games.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although this article looks like a tutorial on how to write your own mod for Beat Saber, its purpose is to show what principles are used to create any custom mods and what problems you have to solve during development. </font><font style="vertical-align: inherit;">Everything described here, with some reservations, is applicable to all Unity games at least on Windows.</font></font></p><br>
<p><img src="https://habrastorage.org/webt/qz/-b/tw/qz-btwwnew2hj7pup0dp_el33g0.png"></p><a name="habracut"></a><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image Sources: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a></em></p><br>
<h2 id="v-predyduschey-serii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous series</font></font></h2><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Past part</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information from the first part is not needed to understand what will happen here, but still I advise you to read it.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is its brief (very) content:</font></font></p><br>
<p>  (   ) ‚Äî  dll-,        - ,        .       ,   dll-    .        ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">BepInEx</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">IPA</a>.  Beat Saber  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">BSIPA</a> ‚Äî   IPA.       Beat Saber,          IPA      Unity-.</p><br>
<h2 id="pro-beat-saber-i-mod-kotoryy-my-budem-delat"> Beat Saber  ,    </h2><br>
<p>Beat Saber        VR-.      , ,  ,   ,   Beat Saber.  , , ,           Youtube:</p><br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://youtu.be/Owz8uatQwO0</a></div><br>
<p>  ,     .      ( ),  ,      ,   ,    , ..  ,                .</p><br>
<p>       ,     .     5 ,           .        ,      .       Unity:   ,  ,     .</p><br>
<h2 id="podgotovka"></h2><br>
<p>     ,      .      Beat Saber   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">ModAssistant</a>,   ( ),     BSIPA, SongCore  BS_Utils      .    ,           ,     .</p><br>
<p>       ,    ,            .</p><br>
<h2 id="zamechanie-pro-versii">  </h2><br>
<p>,     ,     Beat Saber  1.9.1  BSIPA  4.0.5.    ,        -    ,    ,     .</p><br>
<h2 id="shag-0-minimalnyy-rabochiy-mod"> 0:   </h2><br>
<p>       ,  ,          ,   .</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Beat Saber Modding Group</a> (  BSMG).  ,      .     Visual Studio      ‚Äî  ,       .</p><br>
<p>            .      C# (  Rider),   C#-,  Class Library        .NET,   Unity (  4.7.2).   .    .</p><br>
<h4 id="manifestjson">manifest.json</h4><br>
<p>Json-,  -  BSIPA.      EmbeddedResource,        dll-.</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"https://github.com/beat-saber-modding-group/BSIPA-MetadataFileSchema/blob/master/Schema.json"</span>,
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"fck_r_sns"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A mod to track active time spent in the game"</span>,
  <span class="hljs-attr">"gameVersion"</span>: <span class="hljs-string">"1.8.0"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"BeatSaberTimeTracker"</span>,
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"BeatSaberTimeTracker"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.1-alpha"</span>,
  <span class="hljs-attr">"dependsOn"</span>: {}<font></font>
}</code></pre><br>
<p>$schema         .    GitHub   BSIPA.      ,    .  dependsOn ,         . BSIPA   ,     dll-. gameVersion  version  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> </a>.</p><br>
<h4 id="plugincs">Plugin.cs</h4><br>
<p>  ,       .  BSIPA 3    ,   IBeatSaberPlugin. BSIPA 3     dll- ,   ,   IBeatSaberPlugin,      ‚Äî   .  BSIPA 4   IBeatSaberPlugin.  BSIPA  ,   [Plugin],     [Init], [OnStart]  [OnExit].</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> IPA;
<span class="hljs-keyword">using</span> Logger = IPA.Logging.Logger;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">BeatSaberTimeTracker</span><font></font>
{<font></font>
    [<span class="hljs-meta">Plugin(RuntimeOptions.SingleStartInit)</span>]
    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Plugin</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger logger { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        [<span class="hljs-meta">Init</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Plugin</span>(<span class="hljs-params">Logger logger</span>)</span><font></font>
        {<font></font>
            Plugin.logger = logger;<font></font>
            logger.Debug(<span class="hljs-string">"Init"</span>);<font></font>
        }<font></font>
<font></font>
        [<span class="hljs-meta">OnStart</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnStart</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            logger.Debug(<span class="hljs-string">"OnStart"</span>);<font></font>
        }<font></font>
<font></font>
        [<span class="hljs-meta">OnExit</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnExit</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            logger.Debug(<span class="hljs-string">"OnExit"</span>);<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>    ,      Plugin. ,    (namespace)  ,      ‚Äî     BeatSaberTimeTracker.         ,    - .</p><br>
<p>  ,   ,    [Plugin], [Init], [OnStart]  [OnExit].          IPA.Loader.dll.  ,        ,  ,         Beat Saber -   Steam.  , Unity,     IPA    Beat Saber/Beat Saber_Data/Managed.        Steam        GitHub,   . BSMG  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a>.</p><br>
<p>  ,   dll-   Beat Saber/Plugins   .       VR-,        fpfc.        .  ,      .     ,    Beat Saber/Logs       .</p><br>
<pre><code class="plaintext hljs">[DEBUG @ 20:50:03 | BeatSaberTimeTracker] Init<font></font>
[DEBUG @ 20:50:03 | BeatSaberTimeTracker] OnStart<font></font>
[DEBUG @ 20:50:21 | BeatSaberTimeTracker] OnExit</code></pre><br>
<p>,   .</p><br>
<h4 id="vyvod-dlya-shaga-0">   0</h4><br>
<p>      .  -   main   .     ,    : -   , -    ,  -      .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<h2 id="shag-1-vyvodim-vremya-na-ekran"> 1:    </h2><br>
<p>    ,    - ,        ‚Äî   -     ,      .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a>     TimeTracker.  Plugin       ,       .</p><br>
<p>    TimeTracker   canvas   ,              .</p><br>
<p>   Awake:</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    Plugin.logger.Debug(<span class="hljs-string">"TimeTracker.Awake()"</span>);<font></font>
<font></font>
    GameObject canvasGo = <span class="hljs-keyword">new</span> GameObject(<span class="hljs-string">"Canvas"</span>);<font></font>
    canvasGo.transform.parent = transform;<font></font>
    _canvas = canvasGo.AddComponent&lt;Canvas&gt;();<font></font>
    _canvas.renderMode = RenderMode.WorldSpace;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> canvasTransform = _canvas.transform;<font></font>
    canvasTransform.position = <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">-1f</span>, <span class="hljs-number">3.05f</span>, <span class="hljs-number">2.5f</span>);<font></font>
    canvasTransform.localScale = Vector3.one;<font></font>
<font></font>
    _currentTimeText = CreateText(_canvas, <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0f</span>, <span class="hljs-number">0f</span>), <span class="hljs-string">""</span>);<font></font>
    _totalTimeText = CreateText(_canvas, <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0f</span>, <span class="hljs-number">-0.15f</span>), <span class="hljs-string">""</span>);<font></font>
}</code></pre><br>
<p> ,    Canvas,  ,    .     CreateText:</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> TextMeshProUGUI <span class="hljs-title">CreateText</span>(<span class="hljs-params">Canvas canvas, Vector2 position, <span class="hljs-keyword">string</span> text</span>)</span><font></font>
{<font></font>
    GameObject gameObject = <span class="hljs-keyword">new</span> GameObject(<span class="hljs-string">"CustomUIText"</span>);<font></font>
    gameObject.SetActive(<span class="hljs-literal">false</span>);<font></font>
    TextMeshProUGUI textMeshProUgui = gameObject.AddComponent&lt;TextMeshProUGUI&gt;();<font></font>
<font></font>
    textMeshProUgui.rectTransform.SetParent(canvas.transform, <span class="hljs-literal">false</span>);<font></font>
    textMeshProUgui.rectTransform.anchorMin = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>);<font></font>
    textMeshProUgui.rectTransform.anchorMax = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>);<font></font>
    textMeshProUgui.rectTransform.sizeDelta = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">1f</span>, <span class="hljs-number">1f</span>);<font></font>
    textMeshProUgui.rectTransform.transform.localPosition = Vector3.zero;<font></font>
    textMeshProUgui.rectTransform.anchoredPosition = position;<font></font>
<font></font>
    textMeshProUgui.text = text;<font></font>
    textMeshProUgui.fontSize = <span class="hljs-number">0.15f</span>;<font></font>
    textMeshProUgui.color = Color.white;<font></font>
    textMeshProUgui.alignment = TextAlignmentOptions.Left;<font></font>
    gameObject.SetActive(<span class="hljs-literal">true</span>);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> textMeshProUgui;<font></font>
}</code></pre><br>
<p>   , ,  ,      TextMeshProUGUI    RectTransform,          Unity.</p><br>
<p>           Unity- ‚Äî     Unity.      ,     ,           ‚Äî      . -      :  - ,  ,      .  ,  , . ,     ,  .</p><br>
<p>    ,       ,      400  :  20  20.       .      -      .</p><br>
<p><img src="https://habrastorage.org/webt/um/9n/ax/um9nax6baluuuupzsmems99gjbo.jpeg"></p><br>
<p> Update     :</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (Time.time &gt;= _nextTextUpdate)<font></font>
    {<font></font>
        _currentTimeText.text = DateTime.Now.ToString(<span class="hljs-string">"HH:mm"</span>);<font></font>
        _totalTimeText.text = <span class="hljs-string">$"Total: <span class="hljs-subst">{Mathf.FloorToInt(Time.time / <span class="hljs-number">60f</span>):<span class="hljs-number">00</span>}</span>:<span class="hljs-subst">{Mathf.FloorToInt(Time.time % <span class="hljs-number">60f</span>):<span class="hljs-number">00</span>}</span>"</span>;<font></font>
        _nextTextUpdate += TEXT_UPDATE_PERIOD;<font></font>
    }<font></font>
}</code></pre><br>
<p>    Plugin,     TimeTracker:</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">OnStart</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnStart</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    logger.Debug(<span class="hljs-string">"OnStart"</span>);<font></font>
<font></font>
    GameObject timeTrackerGo = <span class="hljs-keyword">new</span> GameObject(<span class="hljs-string">"TimeTracker"</span>);<font></font>
    timeTrackerGo.AddComponent&lt;TimeTracker&gt;();<font></font>
    Object.DontDestroyOnLoad(timeTrackerGo);<font></font>
}</code></pre><br>
<p>            ,      -    ,   DontDestroyOnLoad(‚Ä¶).   .</p><br>
<p>   ,     Unity    : UnityEngine.CoreModule.dll  GameObject  MonoBehaviour, UnityEngine.UI.dll  Unity.TextMeshPro.dll  TextMeshPro  UnityEngine.UIModule.dll  Canvas.      ,    .</p><br>
<p> dll-,      ,     .</p><br>
<p><img src="https://habrastorage.org/webt/pf/gp/es/pfgpesskv6cwdgop6yfivi1b0bg.jpeg"></p><br>
<p> :</p><br>
<pre><code class="plaintext hljs">[DEBUG @ 21:37:18 | BeatSaberTimeTracker] Init<font></font>
[DEBUG @ 21:37:18 | BeatSaberTimeTracker] OnStart<font></font>
[DEBUG @ 21:37:18 | BeatSaberTimeTracker] TimeTracker.Awake()<font></font>
[DEBUG @ 21:37:24 | BeatSaberTimeTracker] OnExit<font></font>
[DEBUG @ 21:37:25 | BeatSaberTimeTracker] TimeTracker.OnDestroy()</code></pre><br>
<p> ,        .       ‚Äî     ,      .  -       :    ,     . ,   .     .</p><br>
<p><img src="https://habrastorage.org/webt/hk/4l/9z/hk4l9ztejmfaembr2s2tpqmvawo.jpeg"></p><br>
<h4 id="vyvod-iz-shaga-1">   1</h4><br>
<p>     ,  ,      Unity     ,     .  ,   ,     ,   UI   .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   <br>
</a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<h2 id="shag-2-vzaimodeystvuem-s-logikoy-samoy-igry"> 2:     </h2><br>
<p>      .    ,   ,   UI ,    .             ,     .</p><br>
<p>  Update.      _trackActiveTime,       .         _activeTimeText.    ,   ,     .</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_trackActiveTime)<font></font>
    {<font></font>
        _activeTime += Time.deltaTime;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Time.time &gt;= _nextTextUpdate)<font></font>
    {<font></font>
        _currentTimeText.text = DateTime.Now.ToString(<span class="hljs-string">"HH:mm"</span>);<font></font>
        _totalTimeText.text = <span class="hljs-string">$"Total: <span class="hljs-subst">{Mathf.FloorToInt(Time.time / <span class="hljs-number">60f</span>):<span class="hljs-number">00</span>}</span>:<span class="hljs-subst">{Mathf.FloorToInt(Time.time % <span class="hljs-number">60f</span>):<span class="hljs-number">00</span>}</span>"</span>;<font></font>
        _activeTimeText.text = <span class="hljs-string">$"Active: <span class="hljs-subst">{Mathf.FloorToInt(_activeTime / <span class="hljs-number">60f</span>):<span class="hljs-number">00</span>}</span>:<span class="hljs-subst">{Mathf.FloorToInt(_activeTime % <span class="hljs-number">60f</span>):<span class="hljs-number">00</span>}</span>"</span>;<font></font>
        _nextTextUpdate += TEXT_UPDATE_PERIOD;<font></font>
    }<font></font>
}</code></pre><br>
<p>         :</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetTrackingMode</span>(<span class="hljs-params"><span class="hljs-keyword">bool</span> isTracking</span>)</span><font></font>
{<font></font>
    _trackActiveTime = isTracking;<font></font>
    _canvas.gameObject.SetActive(!isTracking);<font></font>
}</code></pre><br>
<p>   _trackActiveTime    .       ,      .</p><br>
<p>   -   ,     SetTrackingMode(true),    - ,  SetTrackingMode(false),          .      .        ,     ,    ,    .</p><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">BS_Utils</a>.       BS_Utils.dll   Beat Saber/Plugins (       ModAssistant).   BS_Utils  .    ,      .</p><br>
<pre><code class="json hljs"><span class="hljs-string">"dependsOn"</span>: {
    <span class="hljs-attr">"BS Utils"</span>: <span class="hljs-string">"^1.4.0"</span>
  },</code></pre><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> BS_Utils</a> ,   ,        .</p><br>
<pre><code class="cs hljs">BSEvents.gameSceneActive += EnableTrackingMode;<font></font>
BSEvents.menuSceneActive += DisableTrackingMode;<font></font>
BSEvents.songPaused += DisableTrackingMode;<font></font>
BSEvents.songUnpaused += EnableTrackingMode;</code></pre><br>
<p> EnableTrackingMode  DisableTrackingMode     ,           .</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnableTrackingMode</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    SetTrackingMode(<span class="hljs-literal">true</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DisableTrackingMode</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    SetTrackingMode(<span class="hljs-literal">false</span>);<font></font>
}</code></pre><br>
<p> ,  dll  Plugins,  , .</p><br>
<p><img src="https://habrastorage.org/webt/y-/-l/fe/y--lfe-jnjvkyrqgbeudspsie4a.jpeg"><br>
<img src="https://habrastorage.org/webt/xs/gt/dj/xsgtdj_hfxpevzpxdu9rp0h6cee.jpeg"><br>
<img src="https://habrastorage.org/webt/pw/wc/pd/pwwcpd5m2_ldraya3carfrmryss.jpeg"></p><br>
<p>       Beat Saber,         .  ,   ,   ,  ,   .     BS_Utils,      . BS_Utils        BSMG,     ,   -    .    ,    .      ,     .</p><br>
<h4 id="vyvod-iz-shaga-2">   2</h4><br>
<p>     , ,  ,    ,     . ,  Beat Saber  BS_Utils      ,  BSML ‚Äî  ,       xml-.</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<h2 id="shag-3-udalyaem-bs_utils-lezem-v-kod-igry"> 3:  BS_Utils,    </h2><br>
<p> BS_Utils      .   ,  BSEvents      .        .</p><br>
<h4 id="menusceneactive-i-gamesceneactive">menuSceneActive  gameSceneActive</h4><br>
<p>  ,           .      Unity    SceneManager,     sceneLoaded, sceneUnloaded  activeSceneChanged.            .       UnityEngine.CoreModule.dll  ,    SceneManager   .</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    SceneManager.sceneLoaded += OnSceneLoaded;<font></font>
    SceneManager.sceneUnloaded += OnSceneUnloaded;<font></font>
    SceneManager.activeSceneChanged += OnActiveSceneChanged;<font></font>
    ...<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnSceneLoaded</span>(<span class="hljs-params">Scene scene, LoadSceneMode mode</span>)</span><font></font>
{<font></font>
    Plugin.logger.Debug(<span class="hljs-string">"OnSceneLoaded: "</span> + scene.name + <span class="hljs-string">" ("</span> + mode + <span class="hljs-string">")"</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnSceneUnloaded</span>(<span class="hljs-params">Scene scene</span>)</span><font></font>
{<font></font>
    Plugin.logger.Debug(<span class="hljs-string">"OnSceneUnloaded: "</span> + scene.name);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnActiveSceneChanged</span>(<span class="hljs-params">Scene previous, Scene current</span>)</span><font></font>
{<font></font>
    Plugin.logger.Debug(<span class="hljs-string">"OnActiveSceneChanged: "</span> + previous.name + <span class="hljs-string">" -&gt; "</span> + current.name);<font></font>
}</code></pre><br>
<p> ,  ,    ,   ,   ,  .</p><br>
<pre><code class="plaintext hljs">[DEBUG @ 14:28:14 | BeatSaberTimeTracker] Plugin.Init<font></font>
[DEBUG @ 14:28:14 | BeatSaberTimeTracker] Plugin.OnStart<font></font>
[DEBUG @ 14:28:14 | BeatSaberTimeTracker] TimeTracker.Awake()<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnSceneLoaded: EmptyTransition (Additive)<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnActiveSceneChanged: PCInit -&gt; EmptyTransition<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnSceneLoaded: MainMenu (Additive)<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnSceneLoaded: MenuCore (Additive)<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnSceneLoaded: MenuEnvironment (Additive)<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnSceneLoaded: MenuViewControllers (Additive)<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnActiveSceneChanged: EmptyTransition -&gt; MenuViewControllers<font></font>
[DEBUG @ 14:28:15 | BeatSaberTimeTracker] OnSceneUnloaded: EmptyTransition<font></font>
[DEBUG @ 14:28:22 | BeatSaberTimeTracker] OnSceneLoaded: BigMirrorEnvironment (Additive)<font></font>
[DEBUG @ 14:28:22 | BeatSaberTimeTracker] OnSceneLoaded: StandardGameplay (Additive)<font></font>
[DEBUG @ 14:28:23 | BeatSaberTimeTracker] OnSceneLoaded: GameplayCore (Additive)<font></font>
[DEBUG @ 14:28:23 | BeatSaberTimeTracker] OnSceneLoaded: GameCore (Additive)<font></font>
[DEBUG @ 14:28:23 | BeatSaberTimeTracker] OnActiveSceneChanged: MenuViewControllers -&gt; GameCore<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnActiveSceneChanged: GameCore -&gt; MenuViewControllers<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnActiveSceneChanged: MenuViewControllers -&gt; MainMenu<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnActiveSceneChanged: MainMenu -&gt; MenuCore<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnActiveSceneChanged: MenuCore -&gt; MenuEnvironment<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnActiveSceneChanged: MenuEnvironment -&gt; MenuViewControllers<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnSceneUnloaded: BigMirrorEnvironment<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnSceneUnloaded: StandardGameplay<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnSceneUnloaded: GameplayCore<font></font>
[DEBUG @ 14:28:29 | BeatSaberTimeTracker] OnSceneUnloaded: GameCore<font></font>
[DEBUG @ 14:28:34 | BeatSaberTimeTracker] Plugin.OnExit<font></font>
[DEBUG @ 14:28:34 | BeatSaberTimeTracker] TimeTracker.OnDestroy()</code></pre><br>
<p>    ,   Beat Saber            Additive.    ,    ‚Äî  .     :      , ,    GameCore.  ,    ‚Äî    MenuCore.   MenuCore   ‚Äî   ,      ,      .       MenuViewControllers.    :               ,         .    .</p><br>
<p> OnActiveSceneChanged:        :</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnActiveSceneChanged</span>(<span class="hljs-params">Scene previous, Scene current</span>)</span><font></font>
{<font></font>
    Plugin.logger.Debug(<span class="hljs-string">"OnActiveSceneChanged: "</span> + previous.name + <span class="hljs-string">" -&gt; "</span> + current.name);
    <span class="hljs-keyword">switch</span> (current.name)<font></font>
    {<font></font>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"MenuViewControllers"</span>:<font></font>
            DisableTrackingMode();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"GameCore"</span>:<font></font>
            EnableTrackingMode();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
}</code></pre><br>
<h4 id="songpaused-i-songunpaused">songPaused  songUnpaused</h4><br>
<p>       ,     -.    ,     Beat Saber.   ¬´Beat Saber/Beat Saber_Data/Managed¬ª  2 : Main.dll  MainAssembly.dll.     MainAssembly.dll, -   2       . ,   -   Main.dll,  MainAssembly.dll       .   MainAssembly.dll,       Main.dll. , -       .</p><br>
<p>  ,        , ,   ,    Main.dll.     ,     .   BSMG   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">dnSpy</a>.   Rider    ,      ,   dnSpy     ,  . ,   ,   ‚Äî    ,    ,     Unity-.</p><br>
<p>  :   Main.dll   ,   ,   .  ,  - .      Discord- BSMG  . ,  , ,     ,   -  Main.dll  -   ( ).</p><br>
<p>      GamePause,         .     : Pause  Resume.    GamePause   : didPauseEvent  didResumeEvent. ,      - ,  GamePause   ,     .</p><br>
<p>,  -       GamePause.  Unity    :</p><br>
<pre><code class="cs hljs">Resources.FindObjectsOfTypeAll&lt;GamePause&gt;();</code></pre><br>
<p>   ,    ,       .   ,   .   -   ,    .  ,     -       .   ,       .      OnSceneLoaded  OnActiveSceneChanged,       GameCore         GamePause.   ,       ,   ,     :    ,    ,  GamePause  (   ),   Resources.FindObjectsOfTypeAll  ,    . ,  :</p><br>
<pre><code class="cs hljs"><span class="hljs-function">IEnumerator <span class="hljs-title">InitGamePauseCallbacks</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<font></font>
    {<font></font>
        GamePause[] comps = Resources.FindObjectsOfTypeAll&lt;GamePause&gt;();<font></font>
        <span class="hljs-keyword">if</span> (comps.Length &gt; <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            Plugin.logger.Debug(<span class="hljs-string">"GamePause has been found"</span>);<font></font>
            GamePause gamePause = comps[<span class="hljs-number">0</span>];<font></font>
            gamePause.didPauseEvent += DisableTrackingMode;<font></font>
            gamePause.didResumeEvent += EnableTrackingMode;<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
<font></font>
        Plugin.logger.Debug(<span class="hljs-string">"GamePause not found, skip a frame"</span>);
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>   OnActiveSceneChanged   GameCore:</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnActiveSceneChanged</span>(<span class="hljs-params">Scene previous, Scene current</span>)</span><font></font>
{<font></font>
    Plugin.logger.Debug(<span class="hljs-string">"OnActiveSceneChanged: "</span> + previous.name + <span class="hljs-string">" -&gt; "</span> + current.name);
    <span class="hljs-keyword">switch</span> (current.name)<font></font>
    {<font></font>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"MenuViewControllers"</span>:<font></font>
            DisableTrackingMode();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"GameCore"</span>:<font></font>
            EnableTrackingMode();<font></font>
            StartCoroutine(InitGamePauseCallbacks());<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p> ,    ,   .     .  ,  GamePause      GameCore,  ,       .     .</p><br>
<h4 id="vyvod-iz-shaga-3">   3</h4><br>
<p>    ,       .        ,       ,    .          .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<h2 id="shag-4-vmeshivaemsya-v-logiku-igry-s-pomoschyu-harmony"> 4:       Harmony</h2><br>
<p>    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Harmony</a> ‚Äî    C#-,      .   ‚Äî Andreas Pardeike (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">GitHub</a>),   iOS- /     (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Swedish Police Authority</a>).     Mono.Cecil     ,     dll-  .NET-, Harmony       (runtime).    ,   ,       ,   .       ,    .</p><br>
<p> Harmony       (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">patches</a>).    :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Prefix</a>. ,     .         ,  ,          .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Postfix</a>. ,     .      .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Transpiler</a>. ,      IL-.  ,     -   .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Finalizer</a>.            try/catch/finally,        catch,  finally.</li>
</ul><br>
<p>   ‚Äî  Prefix  Postfix. Transpiler  ,      C#,  IL-,         ,   -      Prefix/Postfix. Finalizer  ,     ,  Harmony 2.0,        .</p><br>
<p>      ,  ,  Harmony    ,      BS_Utils. ,  GamePause       ,      ,  ,   Harmony.  ,   GamePause   didPauseEvent  didResumeEvent,    -   .</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a>,   HarmonyPatcher.      : public static void ApplyPatches() {},      :</p><br>
<pre><code class="cs hljs">Harmony harmony = <span class="hljs-keyword">new</span> Harmony(<span class="hljs-string">"com.fck_r_sns.BeatSaberTimeTracker"</span>);<font></font>
harmony.PatchAll(Assembly.GetExecutingAssembly());</code></pre><br>
<p>   ,    ,     (   ). ¬´com.fck_r_sns.BeatSaberTimeTracker¬ª ‚Äî   .    ,         .     Plugin,         ,     HarmonyPatcher.ApplyPatches()   TimeTracker.</p><br>
<p>    .   ,    ,    .   ‚Äî      .  ,    ,        (,    Prefix ‚Äî  Prefix-),         (, [HarmonyPrefix]).   ,       ,      .      GamePause.Pause().    Postfix-,     ,     Pause()   Postfix-.</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">HarmonyPatch(typeof(GamePause), nameof(GamePause.Pause), MethodType.Normal)</span>]
<span class="hljs-keyword">class</span> <span class="hljs-title">GamePausePausePatch</span><font></font>
{<font></font>
    [<span class="hljs-meta">HarmonyPostfix</span>]
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestPostfixPatch</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Plugin.logger.Debug(<span class="hljs-string">"GamePause.Pause.TestPostfixPatch"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<p> [HarmonyPatch] ,       .   TestPostfixPatch   [HarmonyPostfix],   Postfix-.     GamePause.Resume() (    ), ,  ,  ,  ,  ,   ,  .</p><br>
<p>,   :</p><br>
<pre><code class="plaintext hljs">[DEBUG @ 16:21:55 | BeatSaberTimeTracker] Plugin.Init<font></font>
[DEBUG @ 16:21:55 | BeatSaberTimeTracker] Plugin.OnStart<font></font>
[DEBUG @ 16:21:55 | BeatSaberTimeTracker] HarmonyPatcher: Applied<font></font>
[DEBUG @ 16:21:55 | BeatSaberTimeTracker] TimeTracker.Awake()</code></pre><br>
<p>,  Postfix- :</p><br>
<pre><code class="plaintext hljs">[DEBUG @ 16:22:24 | BeatSaberTimeTracker] GamePause.Pause.TestPostfixPatch<font></font>
[DEBUG @ 16:22:31 | BeatSaberTimeTracker] GamePause.Resume.TestPostfixPatch</code></pre><br>
<p>, Harmony ,    .      ,   didPauseEvent  didResumeEvent  ,  ,    Postfix- - ,  TimeTracker      .       Harmony ‚Äî     .  TimeTracker ‚Äî  ,   -        .        .</p><br>
<p> ‚Äî   TimeTracker    . ,            Resources.FindObjectsOfTypeAll().  BS_Utils, ,  .</p><br>
<p> ‚Äî        BS_Utils.Utilities.BSEvents,      .     ,   .</p><br>
<p>  EventsHelper:</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">namespace</span> <span class="hljs-title">BeatSaberTimeTracker</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EventsHelper</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">event</span> Action onGamePaused;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">event</span> Action onGameResumed;<font></font>
    }<font></font>
}</code></pre><br>
<p>   ,     :</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">HarmonyPatch(typeof(GamePause), nameof(GamePause.Pause), MethodType.Normal)</span>]
<span class="hljs-keyword">class</span> <span class="hljs-title">GamePausePatchPause</span><font></font>
{<font></font>
    [<span class="hljs-meta">HarmonyPostfix</span>]
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FireOnGamePausedEvent</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        EventsHelper.FireOnGamePausedEvent();<font></font>
    }<font></font>
}</code></pre><br>
<p>GamePauseResumePatch  .     FireOnGamePausedEvent  FireOnGameResumedEvent,      -   .  TimeTracker         EventsHelper.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> </a> ‚Äî  -       ,      Resources.FindObjectsOfTypeAll().</p><br>
<p>      ,    . ,      .    GamePause.Pause()        .</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._pause)
  <span class="hljs-keyword">return</span>;
<span class="hljs-keyword">this</span>._pause = <span class="hljs-literal">true</span>;<font></font>
‚Ä¶</code></pre><br>
<p>Postfix-      :     ,      .  ,   EventsHelper   ,         .   Prefix-,       . Harmony       ,        .  Harmony     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a>:</p><br>
<ul>
<li> :  ,        .</li>
<li>__instance:    ,    .     this.</li>
<li>__state:        .    ,      .</li>
<li>__result:    .  ,   .</li>
<li> :   (3)   (_)     ,  Harmony      .</li>
</ul><br>
<p>  ,    :</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">struct</span> PauseState<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> wasPaused;<font></font>
}</code></pre><br>
<p>    ,    ,   ,      ,    . <code>PauseState __state</code> ‚Äî    ,   <code>bool __state</code>.</p><br>
<p>  Prefix-:</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">HarmonyPrefix</span>]
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CheckIfAlreadyPaused</span>(<span class="hljs-params"><span class="hljs-keyword">out</span> PauseState __state, <span class="hljs-keyword">bool</span> ____pause</span>)</span><font></font>
{<font></font>
    __state = <span class="hljs-keyword">new</span> PauseState { wasPaused = ____pause };<font></font>
}</code></pre><br>
<p>      out,     ,    <code>____pause</code> (<code>_pause</code>      ).   <code>____pause</code>  <code>__state</code> ‚Äî   .</p><br>
<p>  Postfx-:</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">HarmonyPostfix</span>]
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FireOnGamePausedEvent</span>(<span class="hljs-params">PauseState __state, <span class="hljs-keyword">bool</span> ____pause</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (!__state.wasPaused &amp;&amp; ____pause)<font></font>
    {<font></font>
        EventsHelper.FireOnGamePausedEvent();<font></font>
    }<font></font>
}</code></pre><br>
<p><code>__state</code>     ,     Prefix-.  wasPaused  <code>____pause</code>,  ,         .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a></p><br>
<p>   ,   .</p><br>
<h4 id="vyvod-iz-shaga-4">   4</h4><br>
<p>Harmony ‚Äî         ,    RimWorld, Battletech, Cities: Skylines, Kerbal Space Program, Oxygen Not Included, Stardew Valley, Subnautica    .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">   </a></p><br>
<h2 id="zaklyuchenie"></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating mods is a rather tedious process. </font><font style="vertical-align: inherit;">When developing mods, you need to constantly delve into the decompiled code, look for classes that do what you need, modify them, constantly rebuild the mods to check for changes in the game, suffer from the lack of a normal debugging mode and a full-fledged Unity editor.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And then the developers release a new version of the game, in which they changed the logic that was used in the mod, and you need to do it all over again.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501658/index.html">How to establish a workflow "in the distance": 7 practical steps</a></li>
<li><a href="../en501662/index.html">Why Axure could bend Sketch and Figma, but didn't bend</a></li>
<li><a href="../en501664/index.html">Video conferencing is now a market and new technologies. Longrid, part two</a></li>
<li><a href="../en501668/index.html">Providing communications of moving objects and tools to increase its reliability</a></li>
<li><a href="../en501670/index.html">How much is life or $ 2.1 million per injection: a wonderful gene therapy</a></li>
<li><a href="../en501674/index.html">Angular: make the code readable for the back-end. Bonus: swapping APIs and query caching</a></li>
<li><a href="../en501676/index.html">Compare c # operators?: Vs if-else vs switch</a></li>
<li><a href="../en501678/index.html">Universal GUI ~ = end to misery</a></li>
<li><a href="../en501680/index.html">Some tips on how to speed up the assembly of Docker images. For example, up to 30 seconds</a></li>
<li><a href="../en501684/index.html">Cloister -> easy OTP cluster management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>