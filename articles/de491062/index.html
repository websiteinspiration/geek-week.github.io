<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👍🏿 🎭 🚞 Winkel: Erstellen eines benutzerdefinierten Formularelements und Übergeben des Formularstatus an dieses 🥜 🖐🏾 👨🏽‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die verschiedenen Formen in unseren Webanwendungen bestehen häufig aus denselben Bausteinelementen. Komponenten-Frameworks helfen uns dabei, wiederhol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Winkel: Erstellen eines benutzerdefinierten Formularelements und Übergeben des Formularstatus an dieses</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491062/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die verschiedenen Formen in unseren Webanwendungen bestehen häufig aus denselben Bausteinelementen. </font><font style="vertical-align: inherit;">Komponenten-Frameworks helfen uns dabei, wiederholbaren Code loszuwerden, und jetzt möchte ich einen dieser Ansätze in Betracht ziehen. </font><font style="vertical-align: inherit;">Also, wie es in Angular üblich ist.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technische Aufgabe:</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie müssen die Komponente "Formularelement zur Eingabe von SNILS" erstellen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Komponente sollte die eingegebenen Werte nach Maske formatieren.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Komponente muss die Eingabe validieren.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Komponente sollte als Teil der reaktiven Form arbeiten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein unvollständiges Formular muss seinen Status zwischen den Neustarts beibehalten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Beim Laden der Seite sollte das bearbeitete Formular sofort Fehler anzeigen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird von Angular Material verwendet.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen eines Projekts und Installieren von Abhängigkeiten</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie ein Testprojekt</font></font></h4><br>
<pre><code class="plaintext hljs">ng new input-snils</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installieren Sie Bibliotheken von Drittanbietern</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst Angular Material selbst</font></font><br>
<br>
<pre><code class="plaintext hljs">ng add @angular/material</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann müssen wir die SNILS selbst gemäß den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regeln für die Berechnung der Prüfsumme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maskieren und überprüfen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie die Bibliotheken:</font></font><br>
<br>
<pre><code class="plaintext hljs">npm install ngx-mask ru-validation-codes</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speichern von Formulardaten</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorbereiten eines Dienstes für die Arbeit mit localStorage</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formulardaten werden in localStorage gespeichert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können sofort die Browsermethoden für die Arbeit mit LS verwenden. In Angular ist es jedoch üblich, zu versuchen, universellen Code zu schreiben und alle externen Abhängigkeiten unter Kontrolle zu halten. Es vereinfacht auch das Testen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher ist es korrekt, wenn die Klasse alle ihre Abhängigkeiten vom DI-Container erhält. Erinnern Sie sich an die Katze Matroskin - um etwas Unnötiges vom Injektor zu kaufen, müssen Sie zuerst etwas Unnötiges an den Injektor verkaufen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie einen </font><b><font style="vertical-align: inherit;">window.provider.ts-</font></b><font style="vertical-align: inherit;"> Anbieter</font></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { InjectionToken } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWindow</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> WINDOW = <span class="hljs-keyword">new</span> InjectionToken(<span class="hljs-string">'Window'</span>, {
  <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>,
  <span class="hljs-attr">factory</span>: getWindow,<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist denn hier los? </font><font style="vertical-align: inherit;">Angulars DI-Injektor merkt sich Token und verschenkt mit ihnen verknüpfte Objekte. </font><font style="vertical-align: inherit;">Token - Dies kann ein InjectionToken-Objekt, eine Zeichenfolge oder eine Klasse sein. </font><font style="vertical-align: inherit;">Dadurch wird ein neues InjectionToken auf Stammebene erstellt und mit der Factory kommuniziert, die den Browser zurückgibt </font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun , </font><font style="vertical-align: inherit;">da wir ein Fenster haben, lassen Sie </font><font style="vertical-align: inherit;">uns einen einfachen Dienst schaffen für die </font><font style="vertical-align: inherit;">Arbeit mit Localstorage </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">storage.service.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs">@Injectable({
  <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StorageService</span> </span>{<font></font>
  readonly prefix = <span class="hljs-string">'snils-input__'</span>;<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(<font></font>
    @Inject(WINDOW) private window: Window,<font></font>
  ) {}<font></font>
<font></font>
  public set&lt;T&gt;(key: string, <span class="hljs-attr">data</span>: T): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>.window.localStorage.setItem(<span class="hljs-keyword">this</span>.prefix + key, <span class="hljs-built_in">JSON</span>.stringify(data));<font></font>
  }<font></font>
<font></font>
  public get&lt;T&gt;(key: string): T {<font></font>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.window.localStorage.getItem(<span class="hljs-keyword">this</span>.prefix + key));<font></font>
    } <span class="hljs-keyword">catch</span> (e) { }<font></font>
  }<font></font>
<font></font>
  public remove(key: string): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>.window.localStorage.removeItem(<span class="hljs-keyword">this</span>.prefix + key);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
StorageService nimmt ein Fenster von einem Injektor und stellt eigene Wrapper zum Speichern und Lesen von Daten bereit. </font><font style="vertical-align: inherit;">Ich habe das Präfix nicht konfigurierbar gemacht, um den Artikel nicht mit einer Beschreibung zum Erstellen von Modulen mit einer Konfiguration zu überladen.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FormPersistModule</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erstellen einen einfachen Service zum Speichern von Formulardaten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">form-persist.service.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs">@Injectable({
  <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormPersistService</span> </span>{<font></font>
  private subscriptions: Record&lt;string, Subscription&gt; = {};<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(<font></font>
    private storageService: StorageService,<font></font>
  ) { }<font></font>
<font></font>
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@returns </span>restored data if exists
   */</span>
  public registerForm&lt;T&gt;(formName: string, <span class="hljs-attr">form</span>: AbstractControl): T {
    <span class="hljs-keyword">this</span>.subscriptions[formName]?.unsubscribe();
    <span class="hljs-keyword">this</span>.subscriptions[formName] = <span class="hljs-keyword">this</span>.createFormSubscription(formName, form);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.restoreData(formName, form);<font></font>
  }<font></font>
<font></font>
  public unregisterForm(formName: string): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">this</span>.storageService.remove(formName);<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.subscriptions[formName]?.unsubscribe();
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.subscriptions[formName];<font></font>
  }<font></font>
<font></font>
  public restoreData&lt;T&gt;(formName: string, <span class="hljs-attr">form</span>: AbstractControl): T {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">this</span>.storageService.get(formName) <span class="hljs-keyword">as</span> T;
    <span class="hljs-keyword">if</span> (data) {<font></font>
      form.patchValue(data, { <span class="hljs-attr">emitEvent</span>: <span class="hljs-literal">false</span> });<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> data;<font></font>
  }<font></font>
<font></font>
  private createFormSubscription(formName: string, <span class="hljs-attr">form</span>: AbstractControl): Subscription {
    <span class="hljs-keyword">return</span> form.valueChanges.pipe(<font></font>
      debounceTime(<span class="hljs-number">500</span>),<font></font>
    )<font></font>
      .subscribe(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.storageService.set(formName, value);<font></font>
      });<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FormPersistService kann Formulare mit dem übergebenen Zeichenfolgenschlüssel registrieren. Registrierung bedeutet, dass die Formulardaten bei jeder Änderung in LS gespeichert werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Registrierung wird auch der aus LS extrahierte Wert zurückgegeben, damit verstanden werden kann, dass das Formular bereits früher gespeichert wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unregister ( </font></font><code>unregisterForm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) beendet den Speichervorgang und löscht den Eintrag in LS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte die Speicherfunktionalität deklarativ beschreiben und nicht jedes Mal im Komponentencode. Mit Angular können Sie mithilfe von Anweisungen Wunder vollbringen, und genau das ist jetzt der Fall. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie die Anweisung </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">form-persist.directive.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs">@Directive({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'form[formPersist]'</span>, <span class="hljs-comment">// tslint:disable-line: directive-selector</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormPersistDirective</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> </span>{<font></font>
  @Input() formPersist: string;<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(<font></font>
    private formPersistService: FormPersistService,<font></font>
    @Self() private formGroup: FormGroupDirective,<font></font>
  ) { }<font></font>
<font></font>
  @HostListener(<span class="hljs-string">'submit'</span>)<font></font>
  onSubmit() {<font></font>
    <span class="hljs-keyword">this</span>.formPersistService.unregisterForm(<span class="hljs-keyword">this</span>.formPersist);<font></font>
  }<font></font>
<font></font>
  ngOnInit() {<font></font>
    <span class="hljs-keyword">const</span> savedValue = <span class="hljs-keyword">this</span>.formPersistService.registerForm(<span class="hljs-keyword">this</span>.formPersist, <span class="hljs-keyword">this</span>.formGroup.control);
    <span class="hljs-keyword">if</span> (savedValue) {
      <span class="hljs-keyword">this</span>.formGroup.control.markAllAsTouched();<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Überlagerung des Formulars zieht FormPersistDirective eine weitere Anweisung aus dem lokalen Injektor heraus - FormGroupDirective - und verwendet das reaktive Formularobjekt von dort, um sich bei FormPersistService zu registrieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Registrierungsschlüssel muss aus der Vorlage entnommen werden. Das Formular selbst enthält keine eindeutige Kennung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Absenden eines Formulars sollte die Registrierung storniert werden. </font><font style="vertical-align: inherit;">Warten Sie dazu mit HostListener auf das Submit-Ereignis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Richtlinie muss auch an Komponenten geliefert werden, in denen sie verwendet werden kann. </font><font style="vertical-align: inherit;">Es wird empfohlen, für jede wiederverwendete Entität separate kleine Module zu erstellen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">form-persist.module.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs">@NgModule({
  <span class="hljs-attr">declarations</span>: [FormPersistDirective],
  <span class="hljs-attr">exports</span>: [FormPersistDirective]<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormPersistModule</span> </span>{ }</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Element des SNILS-Formulars</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche Aufgaben sind ihm zugeordnet? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst müssen die Daten validiert werden.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snilsValidator</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Angular können Sie Ihre Validatoren an Formularsteuerelemente anhängen und Ihre eigenen erstellen. </font><font style="vertical-align: inherit;">Um die SNILS zu überprüfen, verwende ich die externe Bibliothek mit ru-Validierungscodes, und der Validator ist recht einfach. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snils.validator.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { checkSnils } <span class="hljs-keyword">from</span> <span class="hljs-string">'ru-validation-codes'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">snilsValidator</span>(<span class="hljs-params">control: AbstractControl</span>): <span class="hljs-title">ValidationErrors</span> | <span class="hljs-title">null</span> </span>{
  <span class="hljs-keyword">if</span> (control.value === <span class="hljs-string">''</span>  || control.value === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> checkSnils(control.value)<font></font>
    ? <span class="hljs-literal">null</span>
    : { <span class="hljs-attr">snils</span>: <span class="hljs-string">'error'</span> };<font></font>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponente InputSnilsComponent</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Komponentenvorlage besteht aus einem umschlossenen Eingabefeld, einer klassischen Version aus der Angular Material-Bibliothek. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit einem kleinen Zusatz wird der Eingabe mit der externen Bibliothek ngx-mask eine Eingabemaske überlagert. Hier deaktiviert die Eingabeparameter-Maske - setzt die Maske und dropSpecialCharacters - das Entfernen von speziellen Maskenzeichen aus dem Wert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informationen finden Sie in der Dokumentation zur ngx-Maske</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist die Komponentenvorlage </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input-snils.component.html</font></font></b><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">mat-form-field</span> <span class="hljs-attr">appearance</span>=<span class="hljs-string">"outline"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
    <span class="hljs-attr">matInput</span>
    <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"snils"</span>
    [<span class="hljs-attr">formControl</span>]=<span class="hljs-string">"formControl"</span>
    [<span class="hljs-attr">mask</span>]=<span class="hljs-string">"mask"</span>
    [<span class="hljs-attr">dropSpecialCharacters</span>]=<span class="hljs-string">"false"</span>
    [<span class="hljs-attr">placeholder</span>]=<span class="hljs-string">"placeholder"</span>
    [<span class="hljs-attr">readonly</span>]=<span class="hljs-string">"readonly"</span>
    [<span class="hljs-attr">required</span>]=<span class="hljs-string">"required"</span>
    [<span class="hljs-attr">tabIndex</span>]=<span class="hljs-string">"tabIndex"</span>
  &gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mat-error</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"formControl | snilsErrors: 'required'"</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">mat-error</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mat-error</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"formControl | snilsErrors: 'format'"</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">mat-error</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mat-error</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"formControl | snilsErrors: 'snils'"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">mat-error</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mat-form-field</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Frage ist, was ist das formControl | </font><font style="vertical-align: inherit;">snilsErrors? </font><font style="vertical-align: inherit;">Dies ist eine benutzerdefinierte Pipe zum Anzeigen von Fehlern. Jetzt werden wir sie erstellen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snils-error.pipe.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs">type ErrorType = <span class="hljs-string">'required'</span> | <span class="hljs-string">'format'</span> | <span class="hljs-string">'snils'</span>;<font></font>
<font></font>
@Pipe({<font></font>
  <span class="hljs-attr">name</span>: <span class="hljs-string">'snilsErrors'</span>,
  <span class="hljs-attr">pure</span>: <span class="hljs-literal">false</span>,<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SnilsErrorsPipe</span> <span class="hljs-title">implements</span> <span class="hljs-title">PipeTransform</span> </span>{<font></font>
<font></font>
  transform(control: AbstractControl, <span class="hljs-attr">errorrType</span>: ErrorType): boolean {
    <span class="hljs-keyword">switch</span> (errorrType) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'required'</span>: <span class="hljs-keyword">return</span> !control.hasError(<span class="hljs-string">'required'</span>);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'format'</span>: <span class="hljs-keyword">return</span> !control.hasError(<span class="hljs-string">'Mask error'</span>);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'snils'</span>: <span class="hljs-keyword">return</span> control.hasError(<span class="hljs-string">'Mask error'</span>) || !control.hasError(<span class="hljs-string">'snils'</span>);
      <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Rohr ist nicht sauber, was bedeutet, dass es jedes Mal ausgeführt wird, wenn Änderungen erkannt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pipe akzeptiert einen Fehlertypparameter und erkennt Fehler von drei Typen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Erforderlich" - Dieser Fehler stammt aus der integrierten Angular-Direktive RequiredValidator</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Snils" - Dieser Fehler stammt von unserem Validator snilsValidator</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mask error" - Dieser Fehler aus der MaskDirective-Direktive aus der ngx-mask-Bibliothek</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und es gibt einen booleschen Wert zurück - gibt es einen solchen Fehler oder nicht? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns </font><b><font style="vertical-align: inherit;">nun den</font></b><font style="vertical-align: inherit;"> Komponentencode </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input-snils.component.ts selbst an</font></font></b><br>
<br>
<pre><code class="javascript hljs">@Component({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-input-snils'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./input-snils.component.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'./input-snils.component.css'</span>],
  <span class="hljs-attr">encapsulation</span>: ViewEncapsulation.None,
  <span class="hljs-attr">providers</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">provide</span>: NG_VALUE_ACCESSOR,
      <span class="hljs-attr">useExisting</span>: forwardRef(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> InputSnilsComponent),
      <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span><font></font>
    },<font></font>
    {<font></font>
      <span class="hljs-attr">provide</span>: NG_VALIDATORS,
      <span class="hljs-attr">useExisting</span>: forwardRef(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> InputSnilsComponent),
      <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span>,<font></font>
    },<font></font>
    {<font></font>
      <span class="hljs-attr">provide</span>: STATE_VALUE_ACCESSOR,
      <span class="hljs-attr">useExisting</span>: forwardRef(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> InputSnilsComponent),<font></font>
    },<font></font>
  ]<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InputSnilsComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span>, <span class="hljs-title">ControlValueAccessor</span>, <span class="hljs-title">StateValueAccessor</span>, <span class="hljs-title">OnDestroy</span> </span>{<font></font>
  public mask = <span class="hljs-string">'000-000-000 00'</span>;<font></font>
  public formControl = <span class="hljs-keyword">new</span> FormControl(<span class="hljs-string">''</span>, [snilsValidator]);<font></font>
  private sub = <span class="hljs-keyword">new</span> Subscription();<font></font>
<font></font>
  @Input() readonly: boolean;<font></font>
  @Input() placeholder = <span class="hljs-string">''</span>;<font></font>
  @Input() tabIndex = <span class="hljs-number">0</span>;<font></font>
  @Input() required: boolean;<font></font>
<font></font>
  private onChange = <span class="hljs-function">(<span class="hljs-params">value: any</span>) =&gt;</span> { };<font></font>
  private onTouched = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { };<font></font>
  registerOnChange = <span class="hljs-function">(<span class="hljs-params">fn: (value: any</span>) =&gt;</span> {}) =&gt; <span class="hljs-keyword">this</span>.onChange = fn;<font></font>
  registerOnTouched = <span class="hljs-function">(<span class="hljs-params">fn: (</span>) =&gt;</span> {}) =&gt; <span class="hljs-keyword">this</span>.onTouched = fn;<font></font>
<font></font>
<font></font>
  ngOnInit() {<font></font>
    <span class="hljs-keyword">this</span>.sub = <span class="hljs-keyword">this</span>.linkForm();<font></font>
  }<font></font>
<font></font>
  ngOnDestroy() {<font></font>
    <span class="hljs-keyword">this</span>.sub.unsubscribe();<font></font>
  }<font></font>
<font></font>
  private linkForm(): Subscription {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.formControl.valueChanges.subscribe(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
      <span class="hljs-keyword">this</span>.onTouched();
      <span class="hljs-keyword">this</span>.onChange(value);<font></font>
    });<font></font>
  }<font></font>
<font></font>
  writeValue(outsideValue: string): <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">if</span> (outsideValue) {
      <span class="hljs-keyword">this</span>.onTouched();<font></font>
    }<font></font>
    <span class="hljs-keyword">this</span>.formControl.setValue(outsideValue, { <span class="hljs-attr">emitEvent</span>: <span class="hljs-literal">false</span> });<font></font>
  }<font></font>
<font></font>
  setDisabledState(disabled: boolean) {<font></font>
    disabled<font></font>
      ? <span class="hljs-keyword">this</span>.formControl.disable()<font></font>
      : <span class="hljs-keyword">this</span>.formControl.enable();<font></font>
  }<font></font>
<font></font>
  validate(): ValidationErrors | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.formControl.errors;<font></font>
  }<font></font>
<font></font>
  setPristineState(pristine: boolean) {<font></font>
    pristine<font></font>
      ? <span class="hljs-keyword">this</span>.formControl.markAsPristine()<font></font>
      : <span class="hljs-keyword">this</span>.formControl.markAsDirty();<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.formControl.updateValueAndValidity({ <span class="hljs-attr">emitEvent</span>: <span class="hljs-literal">false</span> });<font></font>
  }<font></font>
<font></font>
  setTouchedState(touched: boolean) {<font></font>
    touched<font></font>
      ? <span class="hljs-keyword">this</span>.formControl.markAsTouched()<font></font>
      : <span class="hljs-keyword">this</span>.formControl.markAsUntouched();<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.formControl.updateValueAndValidity({ <span class="hljs-attr">emitEvent</span>: <span class="hljs-literal">false</span> });<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele Dinge und ich werde nicht beschreiben, wie man mit ControlValueAccessor arbeitet. Sie können dies in der Angular-Dokumentation oder zum Beispiel hier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lesen. Tyapk.ru/blog/post/angular-custom-form-field-control</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Was muss hier erklärt werden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst verwenden wir das interne formControl-Formularsteuerelement, hängen es an seine Änderungen an, um die Wertänderung über die Methoden onChange und onTouched nach oben zu senden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Umgekehrt werden Änderungen am externen Formular über die Methoden writeValue und setDisabledState vorgenommen und in formControl wiedergegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweitens gibt es ein unbekanntes STATE_VALUE_ACCESSOR-Token, eine unbekannte StateValueAccessor-Schnittstelle und einige zusätzliche setPristineState- und setTouchedState-Methoden. Sie werden später erklärt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie in der Zwischenzeit ein persönliches Modul für die Komponente</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input-snils.module.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs">@NgModule({
  <span class="hljs-attr">declarations</span>: [InputSnilsComponent, SnilsErrorsPipe],
  <span class="hljs-attr">imports</span>: [<font></font>
    CommonModule,<font></font>
    MatFormFieldModule,<font></font>
    MatInputModule,<font></font>
    NgxMaskModule.forChild(),<font></font>
    ReactiveFormsModule,<font></font>
  ],<font></font>
  <span class="hljs-attr">exports</span>: [InputSnilsComponent],<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InputSnilsModule</span> </span>{ }</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status an einen Artikel übergeben</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Verwendung von ControlValueAccessor gibt es die folgende Nuance: Die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
reaktive Form hat berührte und makellose Zustände (im Folgenden einfach „Zustände“).</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makellos ist anfangs wahr und ändert sich in falsch, wenn der Steuerwert aus der Vorlage geändert wird</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anfänglich falsch berührt und wechselt zu wahr, wenn die Steuerung den Fokus verliert</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können auch zwangsweise festgelegt werden, dies hat jedoch keine Auswirkungen auf das Steuerelement im ControlValueAccessor. Bei unserer Komponente handelt es sich um formControl. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und Mattenfehlerfehler werden nur gerendert, wenn die aktuelle Steuerung berührt wird. Wir haben die Anforderung, dass das wiederhergestellte Formular sofort Validierungsfehler anzeigt, sodass FormPersistDirective markAllAsTouched ausführt, wenn der Formularwert aus localStorage gelesen wurde. Mattenfehler werden jedoch nicht angezeigt, da sie sich in unserer ControlValueAccessor-Komponente befinden. Sie hängen vom formControl-Steuerelement ab, und von diesem unabhängigen Steuerelement ist der berührte Status immer noch falsch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir brauchen einen Mechanismus, um diese Zustände zu werfen. Dazu können Sie Ihr eigenes Analogon zu ControlValueAccessor erstellen. Nennen wir es StateValueAccessor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst müssen Sie ein Token und eine Schnittstelle erstellen.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state-value-accessor.token.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> STATE_VALUE_ACCESSOR = <span class="hljs-keyword">new</span> InjectionToken&lt;StateValueAccessor&gt;(<span class="hljs-string">'STATE_VALUE_ACCESSOR'</span>);</code></pre><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state-value-accessor.interface.ts</font></font></b><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> interface StateValueAccessor {<font></font>
  setTouchedState?(touched: boolean): <span class="hljs-keyword">void</span>;<font></font>
  setPristineState?(pristine: boolean): <span class="hljs-keyword">void</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Schnittstelle beschreibt die Anforderungen an die Klasse, die sie implementiert, um (optional) zwei angegebene Methoden zu haben. </font><font style="vertical-align: inherit;">Diese Methoden sind in InputSnilsComponent implementiert und erzwingen diese Zustände der internen Steuerung formControl. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann benötigen Sie eine Direktive, um NgControl und unsere Komponente zu binden, die StateValueAccessor implementiert. </font><font style="vertical-align: inherit;">Es ist unmöglich, den Moment zu bestimmen, in dem sich der Status eines Formulars ändert. Wir wissen jedoch, dass Angular die Komponente bei jeder Änderung eines Formulars als auf einen Änderungserkennungszyklus wartend markiert. </font><font style="vertical-align: inherit;">Die getestete Komponente und ihre Nachkommen führen den ngDoCheck-Lebenszyklus-Hook aus, den unsere Direktive verwenden wird.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FormStatusesDirective</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie die Direktive </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">form-statuses.directive.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> noop: <span class="hljs-function">(<span class="hljs-params">v?: boolean</span>) =&gt;</span> <span class="hljs-keyword">void</span> = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { };<font></font>
<font></font>
@Directive({<font></font>
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'[formControlName],[ngModel],[formControl]'</span> <span class="hljs-comment">// tslint:disable-line: directive-selector</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormStatusesDirective</span> <span class="hljs-title">implements</span> <span class="hljs-title">DoCheck</span>, <span class="hljs-title">OnInit</span> </span>{<font></font>
  private setSVATouched = noop;<font></font>
  private setSVAPristine = noop;<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(<font></font>
    @Self() private control: NgControl,<font></font>
    @Self() @Optional()  @Inject(STATE_VALUE_ACCESSOR) private stateValueAccessor: StateValueAccessor,<font></font>
  ) { }<font></font>
<font></font>
  ngOnInit() {<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.stateValueAccessor?.setTouchedState) {
      <span class="hljs-keyword">this</span>.setSVATouched = wrapIfChanges(<span class="hljs-function"><span class="hljs-params">touched</span> =&gt;</span> <span class="hljs-keyword">this</span>.stateValueAccessor.setTouchedState(touched));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.stateValueAccessor?.setPristineState) {
      <span class="hljs-keyword">this</span>.setSVAPristine = wrapIfChanges(<span class="hljs-function"><span class="hljs-params">pristine</span> =&gt;</span> <span class="hljs-keyword">this</span>.stateValueAccessor.setPristineState(pristine));<font></font>
    }<font></font>
  }<font></font>
<font></font>
  ngDoCheck() {<font></font>
    <span class="hljs-keyword">this</span>.setSVAPristine(<span class="hljs-keyword">this</span>.control.pristine);
    <span class="hljs-keyword">this</span>.setSVATouched(<span class="hljs-keyword">this</span>.control.touched);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FormStatusesDirective überlagert alle möglichen Steuerelemente und prüft, ob StateValueAccessor vorhanden ist. </font><font style="vertical-align: inherit;">Zu diesem Zweck wird vom Injektor eine optionale Abhängigkeit vom Token STATE_VALUE_ACCESSOR angefordert, die die Komponente, die StateValueAccessor implementiert, hätte überprüfen müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn das Token nichts findet, passiert nichts. Die Methoden setSVATouched und setSVAPristine sind nur leere Funktionen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn StateValueAccessor gefunden wird, werden die Methoden setTouchedState und setPristineState für jede erkannte Statusänderung aufgerufen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt, der Direktive ein Modul zum Exportieren von </font><b><font style="vertical-align: inherit;">form-statuses.module.ts</font></b><font style="vertical-align: inherit;"> zur Verfügung zu stellen</font></font><br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="javascript hljs">@NgModule({
  <span class="hljs-attr">declarations</span>: [FormStatusesDirective],
  <span class="hljs-attr">exports</span>: [FormStatusesDirective]<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormStatusesModule</span> </span>{ }</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hauptseite</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen Sie das Formular selbst erstellen. </font><font style="vertical-align: inherit;">Platzieren Sie es auf der Hauptseite der AppComponent, um keine Aufregung zu verursachen. </font><font style="vertical-align: inherit;">In einer realen Anwendung ist es natürlich besser, eine separate Komponente für das Formular zu erstellen. </font><b><font style="vertical-align: inherit;">App.component.html</font></b></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vorlage</font></font><br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-wrapper"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"form"</span>
    [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"form"</span>
    <span class="hljs-attr">formPersist</span>=<span class="hljs-string">"inputSnils"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">app-input-snils</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"input-snils"</span>
      <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"snils"</span>
      [<span class="hljs-attr">required</span>]=<span class="hljs-string">"true"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">app-input-snils</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"ready-button"</span>
      <span class="hljs-attr">mat-raised-button</span>
      [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"form.invalid"</span>
      <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>
    &gt;</span><font></font>
      Submit<font></font>
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Direktive FormPersistDirective hängt am Formular, Angular erfährt davon über die Formularauswahl [formPersist]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Vorlage muss mit Variablen versehen sein, machen </font><b><font style="vertical-align: inherit;">wir</font></b><font style="vertical-align: inherit;"> es </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.component.ts</font></font></b><br>
<br>
<pre><code class="javascript hljs">@Component({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-root'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./app.component.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'./app.component.css'</span>]<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> </span>{<font></font>
  public form = <span class="hljs-keyword">new</span> FormGroup({
    <span class="hljs-attr">snils</span>: <span class="hljs-keyword">new</span> FormControl(<span class="hljs-string">''</span>, [Validators.required])<font></font>
  });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Komponentencode mit dem Formular war äußerst einfach und enthält nichts Überflüssiges. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sieht so aus: </font></font><br>
<img src="https://habrastorage.org/webt/qb/qa/ko/qbqakozek8aqxafpbojkbn3b65y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Quellcode kann auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub übernommen werden.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Die Demo auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stackblitz</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der Code auf stackblitz unterscheidet sich geringfügig, da die dortige Typoskript-Version den elvis-Operator noch nicht unterstützt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus gibt es immer noch Nuancen, die sich nicht im Artikel widerspiegeln. Wenn jemand sie benötigt, werde ich sie ergänzen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de491050/index.html">Registrierung für NeoQUEST-2020: Post-Apocalyptic World Open</a></li>
<li><a href="../de491052/index.html">Wie und warum Kuratoren an der HSE in St. Petersburg Neulingen Programmierern helfen</a></li>
<li><a href="../de491054/index.html">So signieren Sie E-Mail-Korrespondenz mit einem GPG-Schlüssel mithilfe von PKCS # 11-Token</a></li>
<li><a href="../de491056/index.html">Ampere Altra - der weltweit erste 80-Kern-ARM-Prozessor</a></li>
<li><a href="../de491058/index.html">Mortalität, Mortalität, Coronavirus und Matan</a></li>
<li><a href="../de491076/index.html">Clevere Arbeit mit RabbitMQ in NestJS</a></li>
<li><a href="../de491084/index.html">saneex.c: try / catch / finally basierend auf setjmp / longjmp (C99) schneller als Standard-C ++ - Ausnahmen ¹</a></li>
<li><a href="../de491086/index.html">Webix JavaScript-Bibliothek mit den Augen eines Anfängers. Teil 6. Serverinteraktion</a></li>
<li><a href="../de491088/index.html">GitHub: Neue Open Source Library für OSINT</a></li>
<li><a href="../de491090/index.html">Konvertieren Sie Textdokumente in C # in XML</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>