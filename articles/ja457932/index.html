<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🚀 🍌 🖐🏼 Positive Hack Days 9でのIDSバイパスコンテストの分析 🤾🏾 🍲 🍡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Positive Hack Days 2019国際フォーラムは、最初のIDSバイパスコンテストを主催しました。参加者は5つのノードのネットワークセグメントを調べ、サービスの脆弱性を悪用するか、指定された条件を満たす（たとえば、特定のHTTP応答を送信する）必要があり、フラグを取得する必要がありました...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Positive Hack Days 9でのIDSバイパスコンテストの分析</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/457932/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive Hack Days 2019国際フォーラムは、最初のIDSバイパスコンテストを主催しました。</font><font style="vertical-align: inherit;">参加者は5つのノードのネットワークセグメントを調べ、サービスの脆弱性を悪用するか、指定された条件を満たす（たとえば、特定のHTTP応答を送信する）必要があり、フラグを取得する必要がありました。</font><font style="vertical-align: inherit;">エクスプロイトを見つけることは簡単でしたが、IDSはタスクを複雑にしました。システムは参加者とホストの間に立って、すべてのネットワークパケットをチェックしました。</font><font style="vertical-align: inherit;">攻撃者は、署名が接続をブロックしたかどうかをダッシュ​​ボードで確認しました。</font><font style="vertical-align: inherit;">以下では、タスク自体について詳しく説明し、それらのソリューションを分析します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/f1/_h/yo/f1_hyoqa8lj-hzuyc6mtsd0txkk.png"></a><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.64.0.11-Struts</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクを解決した人の数の最初のノードはStrutsでした。</font><font style="vertical-align: inherit;">Nmapポートをスキャンすると、ポート8080でApache Strutsサービスが見つかります。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># nmap -Pn -sV -p1-10000 100.64.0.11</span><font></font>
631/tcp  open  ipp     CUPS 2.1<font></font>
8005/tcp open  mxi?<font></font>
8009/tcp open  ajp13   Apache Jserv (Protocol v1.3)<font></font>
8080/tcp open  http    Apache Tomcat/Coyote JSP engine 1.1</code></pre><br>
<img src="https://habrastorage.org/webt/wq/f1/qo/wqf1qokxeyza5c9aeelmgq14k2o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Strutsの脆弱性は2017年に消滅しました。OGNLインジェクションを使用すると、攻撃者は許可なしにStrutsで任意のコードを実行する可能性があります。</font><font style="vertical-align: inherit;">たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">エクスプロイトがありますが、</font><font style="vertical-align: inherit;">IDSが捕捉されます</font></font><br>
<br>
<code>[Drop] [**] [1:1001:1] Apache Struts2 OGNL inj in header (CVE-2017-5638) [**]</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。署名コード自体は参加者が利用できませんが、ログのメッセージから、その操作のメカニズムを理解できます。</font><font style="vertical-align: inherit;">この場合、シグニチャはHTTPでOGNLインジェクションを検出しました：</font></font><br>
<br>
<pre><code class="bash hljs">GET /showcase.action HTTP/1.1<font></font>
Accept-Encoding: identity<font></font>
Host: 100.64.0.11:8080<font></font>
Content-Type: %{(<span class="hljs-comment">#_='multipart/form-data')...</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IDSの動作を調べると、Content-Typeヘッダーの先頭で組み合わせ％{をキャッチしていることが明らかになります。</font><font style="vertical-align: inherit;">いくつかの解決策があります：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加者の@empty_jackは、文字の組み合わせを壊そうとしました％{ファジング用の独自の辞書を使用して、Content-Type：％$ {という行で解決策を考え出しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPリクエスト自体をファジングします。</font><font style="vertical-align: inherit;">メンバー@ c00lhax0rは、ヘッダーの先頭のヌル文字もIDSをバイパスすることを発見しました：Content-Type：\ 0 $ {。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2017-5638のほとんどのエクスプロイトは、パーセント記号を使用した注入を行います。</font><font style="vertical-align: inherit;">しかし、これと以前のApache Strutsの脆弱性の一部の研究者は</font><font style="vertical-align: inherit;">、インジェクションは％と$の両方で始まる可能</font><font style="vertical-align: inherit;">性があると</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書い</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ています。</font><font style="vertical-align: inherit;">したがって、$ {の組み合わせはIDS署名をバイパスし、システムでコードを実行します。</font><font style="vertical-align: inherit;">そのような決定は当初考えられました。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このタスクは最も簡単で、8人の参加者によって決定されました。 </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.64.0.10-Solr</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポート8983には、Javaで書かれたApache Solrサーバーがありました。</font></font><br>
<br>
<pre><code class="bash hljs">$ nmap -Pn -sV -p1-10000 100.64.0.10<font></font>
22/tcp   open  ssh     (protocol 2.0)<font></font>
8983/tcp open  http    Jetty<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/ob/ii/k5/obiik5lmfzzjsrwifmaldq_scaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Solr 5.3.0のエクスプロイトは簡単に見つかります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-CVE-2019-0192</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。攻撃者は、コレクション内のRMIサーバーのアドレスを偽装する可能性があります。操作には、Javaオブジェクト（ガジェット）のチェーンを生成し、さまざまな方法で配信するysoserialフレームワークが必要です。たとえば、JRMPサーバーから。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、額に前述のエクスプロイトを使用すると、IDSシグネチャトリガーが参加者に表示されます</font></font><br>
<br>
<code>[Drop] [**] [1:10002700:3001] ATTACK [PTsecurity] Java Object Deserialization RCE POP Chain (ysoserial Jdk7u21) [**] </code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。Jdk7u21は30のロードの1つにすぎず、その選択は脆弱なサービスで使用されるライブラリに依存します。 Jdk7u21ガジェットチェーンは、Java Development Kitバージョン7u21の標準クラスのみを使用し、CommonsCollections1チェーンには、広く使用されているApache Common Collections 3.1のクラスが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
攻撃者はSolrコレクションのRMIサーバーのアドレスを自分のアドレスに置き換え、JRMPサーバーを起動します。</font><font style="vertical-align: inherit;">Solrはアドレスでオブジェクトを要求し、悪意のあるJavaオブジェクトを受け取ります。</font><font style="vertical-align: inherit;">逆シリアル化後、コードはサーバーで実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シグニチャは、シリアル化されたJavaオブジェクト内の一連のクラスで起動されます。</font><font style="vertical-align: inherit;">これは攻撃者のマシンから送信され、トラフィック内で次のように始まります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ya/fv/vc/yafvvcxmlg9ogebwg8ag3jr5cwy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。この問題の解決策は簡単でした。</font><font style="vertical-align: inherit;">シグネチャはJdk7u21を明示的に参照しています。</font><font style="vertical-align: inherit;">それを回避するには、ガジェットの他のチェーンを試す必要がありました。</font><font style="vertical-align: inherit;">たとえば、CommonsCollectionsの1つです。</font><font style="vertical-align: inherit;">IDSの他のチェーンの署名はありませんでした。</font><font style="vertical-align: inherit;">参加者はシステムでシェルを受け取り、フラグを読み取ります。</font><font style="vertical-align: inherit;">5人の参加者がタスクを完了しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.64.0.12-SAMR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテストで最も困難で興味深いタスクの1つ。これは、445番目のポートが開いているWindowsマシンです。フラグはシステムの2人のユーザーの名前に分かれており、タスクを完了するには、Windowsノードのすべてのユーザーのリストを取得する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、MS17-010やその他のエクスプロイトはこのマシンでは機能しませんでした。列挙ユーザーは、たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impacket</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームワーク</font><font style="vertical-align: inherit;">からのスクリプト</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="bash hljs">$ python samrdump.py 100.64.0.12<font></font>
Impacket v0.9.15 - Copyright 2002-2016 Core Security Technologies<font></font>
<font></font>
[*] Retrieving endpoint list from 100.64.0.12<font></font>
[*] Trying protocol 445/SMB…<font></font>
Found domain(s):<font></font>
 . SAMR<font></font>
 . Builtin<font></font>
[*] Looking up users <span class="hljs-keyword">in</span> domain SAMR<font></font>
[-] The NETBIOS connection with the remote host timed out.<font></font>
[*] No entries received.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらのシナリオでも、ポート445でマシンにDCERPC要求を行います。しかし、すべてがそれほど単純ではありません。一部のパケットはIDSによってブロックされ、今回は2つのシグネチャがトリガーされます</font></font><br>
<br>
<code>[**] [1:2001:2] SAMR DCERPC Bind [**]</code><br>
<code>[Drop] [**] [1:2002:2] SAMR EnumDomainUsers Request [**]</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。最初の</font><font style="vertical-align: inherit;">シグネチャは</font><font style="vertical-align: inherit;">SAMRサービスへの接続を検出し、TCP接続にフラグを付けるだけです。そして2番目は、EnumDomainUsersからSAMRサービスへの要求によってトリガーされます。このサービスには、ユーザーを取得する別の方法があります：QueryDisplayInfo、QueryDisplayInfo2、QueryDisplayInfo3。それらのすべても署名によってブロックされました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DCERPCプロトコルとWindowsサービスは、リモートサイト管理に多大な機会を提供します。このプロトコルは、PsExecやBloodHoundなどの最もよく知られているツールで使用されます。 SAMRサービス、つまりSAMリモートプロトコルを使用すると、ユーザーのリストを含め、サイト上のアカウントを操作できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EnumDomainUsersを要求するために、Impacketは次のことを行います。SAMR </font></font><br>
<br>
<img src="https://habrastorage.org/webt/88/dl/dt/88dldti53r53mbn6mzcbhhhffje.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスへのDCERPC接続がSMBの上に確立され、それ以降のすべての要求はこのサービスのコンテキストに入ります。</font><font style="vertical-align: inherit;">スクリーンショットの最初と最後のパケットで署名が機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は割り当てに2つの手がかりを与えました：</font></font><br>
<br>
<blockquote><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDSにより2つのアラートが生成されます。</font><font style="vertical-align: inherit;">最初をよく見てください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このプロトコルのどの接続コマンドを知っていますか？</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはDCERPCプロトコルと接続を確立する方法についてです。</font><font style="vertical-align: inherit;">使用可能なPDUのリストでは、BindコマンドとAlter Contextコマンドがコンテキストの接続と変更を担当し、2番目のコマンドは接続を切断することなく現在のコンテキストを変更できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを解決するには、samrdumpスクリプトのロジックを書き換える必要がありました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえばUUID 3919286a-b10c-11d0-9ba8-00c04fd92ef5を使用して、別のサービスにバインドします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAMRに切り替えるには、コンテキストの変更を使用します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EnumDomainUsersにリクエストを送信します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更は3行に収まります。</font></font><br>
<br>
<pre><code class="bash hljs">&lt;         dce.bind(samr.MSRPC_UUID_SAMR)<font></font>
---<font></font>
&gt;         dce.bind(uuid.uuidtup_to_bin((<span class="hljs-string">"3919286a-b10c-11d0-9ba8-00c04fd92ef5"</span>, <span class="hljs-string">"0.0"</span>)))<font></font>
&gt;         dce.alter_ctx(samr.MSRPC_UUID_SAMR)<font></font>
&gt;         dce._ctx = 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
psih1337 @コンテストの勝者によって代替ソリューションが提案されました。</font><font style="vertical-align: inherit;">EnumDomainUsersクエリは、名前ではなくSID（セキュリティID）別のユーザーのリストを返しました。</font><font style="vertical-align: inherit;">SIDは乱数ではありません。</font><font style="vertical-align: inherit;">たとえば、LocalSystemアカウントのSIDはS-1-5-18であり、手動で作成したユーザーの場合は1000から始まります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、シードを1000から2000に手動でソートすると、システムで必要なアカウントが見つかる可能性が高くなります。</font><font style="vertical-align: inherit;">これらは、Sids 1008および1009 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の</font><font style="vertical-align: inherit;">下で見つかりました。</font><font style="vertical-align: inherit;">このタスクのソリューションには、DCERPCプロトコルの理解と、Windowsインフラストラクチャの研究経験が必要でした。</font><font style="vertical-align: inherit;">それを決めたのは@ psih1337だけでした。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.64.0.13-DNSCAT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポート80には、IPアドレスのフォームが記載されたWebページがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bc/fr/9a/bcfr9a7cne93vuqmzgwboqreaf8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPを指定すると、UDPはポート53に到着します。</font></font><br>
<br>
<pre><code class="bash hljs">17:40:45.501553 IP 100.64.0.13.38730 &gt; 100.64.0.187: 61936+ CNAME? dnscat.d2bc039ce800000000d6eae8eae3bf81fd84d1695f5888aba8dcec06d071.a73b3f0561ca4906d268214f4b70da1bdb50f75739ae0577139096732bf8.0d0a987ce23408bac15426a22e. (173)<font></font>
17:40:45.501639 IP 100.64.0.187 &gt; 100.64.0.13: ICMP 100.64.0.187 udp port domain unreachable, length 209<font></font>
17:40:46.520457 IP 100.64.0.13.38730 &gt; 100.64.0.187: 21842+ TXT? dnscat.7f4e039ce800000000d6eae8eae3bf81fd84d1695f5888aba8dcec06d071.a73b3f0561ca4906d268214f4b70da1bdb50f75739ae0577139096732bf8.0d0a987ce23408bac15426a22e. (173)<font></font>
17:40:46.520546 IP 100.64.0.187 &gt; 100.64.0.13: ICMP 100.64.0.187 udp port domain unreachable, length 209</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、これはDNSトンネル用のツールであるDNSCATです。フォームでIPアドレスを指定した後、DNSCATクライアントはそれに接続を確立しようとします。これが成功した場合、サーバー（つまり、参加者）は競合マシンでシェルを受け取り、フラグを引き出します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、DNSCATサーバーを上げて接続を受け入れようとすると、失敗します。IDS </font></font><br>
<br>
<code>[Drop] [**] [1:4001:1] 'dnscat' string found in DNS response [**]</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
署名は、サーバーからのトラフィックのdnscat行でトリガーされます-これはメッセージに明記されています。トラフィックを難読化または暗号化しても機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントコードを見ると、そのチェックが十分に厳格ではないことがわかります。つまり、dnscat行が回答にまったく表示されない場合があります。コードから削除するか、その場でNetSEDユーティリティで置き換えるだけです。すぐに置き換えるのははるかに簡単ですが、サーバーコードのパッチは引き続き提供します。</font></font><br>
<br>
<pre><code class="bash hljs">diff -r dnscat2/server/libs/dnser.rb dnscat2_bypass/server/libs/dnser.rb<font></font>
&lt;           segments &lt;&lt; unpack(<span class="hljs-string">"a#{len}"</span>)<font></font>
&gt;           segments &lt;&lt; [unpack(<span class="hljs-string">"a#{len}"</span>)[0].upcase]<font></font>
<font></font>
&lt;         name.split(/\./).each <span class="hljs-keyword">do</span> |segment|<font></font>
&gt;         name.upcase.split(/\./).each <span class="hljs-keyword">do</span> |segment|<font></font>
<font></font>
diff -r dnscat2/server/tunnel_drivers/driver_dns.rb dnscat2_bypass/server/tunnel_drivers/driver_dns.rb<font></font>
&lt;         response = (response == <span class="hljs-string">""</span> ? <span class="hljs-string">"dnscat"</span> : (<span class="hljs-string">"dnscat."</span> + response))<font></font>
&gt;         response = (response == <span class="hljs-string">""</span> ? <span class="hljs-string">"dnsCat"</span> : (<span class="hljs-string">"dnsCat."</span> + response))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテストでは、この課題に対して5つのソリューションがありました。 </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.64.0.14-POST</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この競争力のある車両から旗を受け取った人はいません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/do/5d/qk/do5dqker-2mysadlbelh9ccvthe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPアドレスがよく知られているフォームが表示されます。</font><font style="vertical-align: inherit;">誰かが新しいマルウェアのテストに参加することを勧めています。</font><font style="vertical-align: inherit;">その革新の1つは、IDSを未知の方法でバイパスすることです。</font><font style="vertical-align: inherit;">フラグの場合は、応答としてHTTPヘッダー "Server：ng1nx"を送信するだけです。</font><font style="vertical-align: inherit;">暑くなるでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
予想どおり、IPへのGETリクエストを取得し、IDSによってブロックされた応答を送信します。</font></font><br>
<br>
<code>[Drop] [**] [1:5002:1] 'ng1nx' Server header found. Malware shall not pass [**]</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヒントがあります：</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時々、ハードに見えるタスクが最も簡単です。</font><font style="vertical-align: inherit;">何も脆弱ではないと思われる場合、おそらくあなたの鼻の下に何かが欠けていますか？</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの鼻の前にある脆弱なものはIDSです。</font><font style="vertical-align: inherit;">応答ページから、オープンなSuricata IDSがあることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tk/gn/fr/tkgnfrt8ciux8w_6cvxznt7srrq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリ「Suricata IDS Bypass」の最初のリンクは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2018-6794につながり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">この脆弱性により、TCP通信（TCPハンドシェイク）の通常のコースに違反し、プロセスが完了する前にデータが送信された場合に、パケット検査がバイパスされる可能性があります。</font><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">Client    -&gt;  [SYN] [Seq=0 Ack=0]           -&gt;  Evil Server   <span class="hljs-comment"># 1/2</span>
Client    &lt;-  [SYN, ACK] [Seq=0 Ack=1]      &lt;-  Evil Server   <span class="hljs-comment"># 2/2</span>
Client    &lt;-  [PSH, ACK] [Seq=1 Ack=1]      &lt;-  Evil Server   <span class="hljs-comment"># Data here</span><font></font>
Client    &lt;-  [FIN, ACK] [Seq=83 Ack=1]     &lt;-  Evil Server<font></font>
Client    -&gt;  [ACK] [Seq=1 Ack=84]          -&gt;  Evil Server   <span class="hljs-comment"># 3/2</span>
Client    -&gt;  [PSH, ACK] [Seq=1 Ack= 4]     -&gt;  Evil Server    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エクスプロイトをダウンロードし、行を「ng1nx」に変更し、カーネルRSTパッケージをオフにして実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、このマシンからフラグを受け取った人はいませんでしたが、数人の参加者がソリューションに近かったです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテストに登録した49人の参加者、12人が少なくとも1つの旗を渡した。</font><font style="vertical-align: inherit;">興味深いのは、競合するタスク、特にSMBおよびDCERPCプロトコルを使用するタスクが一度にいくつかのソリューションを持つことができることです。</font><font style="vertical-align: inherit;">たぶん、いくつかのタスクを完了するための独自のアイデアがありますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上位の場所：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1位：@ psih1337</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2位：@ webr0ck</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3位：@empty_jack</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
署名応答統計：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iv/et/6q/ivet6qkq0at3trs0hyicqgz1vl8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての参加者に感謝！</font><font style="vertical-align: inherit;">来年はさらに難易度の異なる課題が増えるでしょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿者：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kirill Shipulin、Positive Technologies</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457916/index.html">CCAの能力におけるネットワークモジュールのWorldSkillsタスクのソリューション。パート2-基本設定</a></li>
<li><a href="../ja457920/index.html">ジェットワールド：会議Joker 2018のレポートへの無料アクセス+トップ10のレビュー</a></li>
<li><a href="../ja457926/index.html">アジャイル認定の比較、パート1-ICAgile、Scrum.org、ScrumAllianceおよびPMI</a></li>
<li><a href="../ja457928/index.html">2つの画像を比較するための深いランキング</a></li>
<li><a href="../ja457930/index.html">Pythonで静的に安全な動的型付け</a></li>
<li><a href="../ja457936/index.html">ロシアでの最初のZabbixカンファレンスにあなたを招待します</a></li>
<li><a href="../ja457940/index.html">相手方をのぞく方法</a></li>
<li><a href="../ja457942/index.html">Pythonの最適化について学んだこと</a></li>
<li><a href="../ja457946/index.html">グラフとチャートでデータを視覚化するための10の最高のJavaScriptライブラリ</a></li>
<li><a href="../ja457948/index.html">頭をぶち壊さなければならないボードゲーム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>