<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🍳 ✌🏽 👩🏽‍🌾 Mithril.js上的样本Simple Notes SPA 💛 🍎 📠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mithril.js是用于构建客户端Web应用程序的不受欢迎的工具。几乎没有有关此主题的出版物。在本文中，我想展示如何在Mithril上制作一个小型应用程序。该应用程序将基于此出版物（翻译）
 
 什么是米特里尔
 Mithril是一个反应式框架，旨在创建SPA（单页Web应用程序）。总而言之，这只...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mithril.js上的样本Simple Notes SPA</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492496/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用于构建客户端Web应用程序的不受欢迎的工具。</font><font style="vertical-align: inherit;">几乎没有有关此主题的出版物。</font><font style="vertical-align: inherit;">在本文中，我想展示如何在Mithril上制作一个小型应用程序。</font><font style="vertical-align: inherit;">该应用程序将基于此</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出版物</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻译</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么是米特里尔</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mithril是一个反应式框架，旨在创建SPA（单页Web应用程序）。总而言之，这只是JavaScript和API函数的13个签名。此外，还有一个秘银流库，该库不包含在秘银中，而是单独使用。秘银的核心包括路由应用程序和处理XHR请求。中心概念是抽象-虚拟节点（vnode）。虚拟节点只是具有一些属性集的js对象。虚拟节点由特殊功能m（）创建。接口的当前状态存储在虚拟节点列表（虚拟DOM）中。在最初呈现应用程序页面时，虚拟DOM被转换为DOM。当DOM API事件处理程序启动时，当m.request（）承诺完成时，并且URL发生更改（沿着应用程序的路径导航）时，会生成一个新的虚拟DOM数组，与旧版本比较，并且更改后的节点更改了浏览器DOM。除了DOM事件和m.request（）请求的完成之外，还可以使用m.redraw（）函数手动调用重绘。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
秘银盒中没有开箱即用的类似HTML的模板，没有JSX支持，尽管您可以根据需要将所有这些与各种插件结合使用。我不会在这里利用这些机会。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果m（）的第一个参数是字符串（例如'div'），则该函数返回一个简单的虚拟节点，因此，将在DOM中显示一个HTML标签。</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果m（）的第一个参数是对象或返回该对象的函数，则此类对象必须具有view（）方法，并且此类对象称为组件。反过来，组件的view（）方法应始终返回m（）函数（或类型为[m（），]的数组）。因此，我们可以构建组件对象的层次结构。很明显，最终所有组件都返回简单的vnode节点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
虚拟节点和组件都具有生命周期方法，它们被称为相同的oninit（），oncreate（），onbeforeupdate（）等。在页面渲染的特定时间点将调用这些方法中的每一个。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以将参数作为对象传递给虚拟节点或组件，该参数应该是m（）函数的第二个参数。您可以使用vnode.attrs表示法在节点内获得指向该对象的链接。 m（）函数的第三个参数是该节点的后代，可以通过vnode.children链接进行访问。除m（）函数外，m.trust（）函数还返回简单节点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
秘银的作者没有提供任何特殊的应用程序设计模式，尽管他建议避免使用一些不成功的解决方案，例如“太厚”的组件或操纵组件树的后代。作者也没有提供特殊的方式或方法来控制应用程序整体或组件的状态。尽管文档指出您不应使用节点本身的状态，但请对其进行操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
秘银的所有这些功能似乎非常不便，并且框架似乎尚未完成，没有特别的建议，没有状态/存储，没有reduce /事件分配器，没有模板。</font><font style="vertical-align: inherit;">通常，请尽力而为。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您需要的示例 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将使用：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js版本2.0.4</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS库</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pure.css</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本1.0.1</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontawesome v5.12</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图标</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rollup.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本1.32，用于构建应用程序</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgREST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本5.2.0，作为后端REST服务器</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL 9.6或更高版本作为数据库。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前端服务器在这里并不重要，它只需要给客户端提供index.html以及脚本和样式文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们不会在节点模块中安装mithril，并将应用程序代码和框架绑定到一个文件中。</font><font style="vertical-align: inherit;">应用程序代码和秘银将分别上传到页面。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不会描述这些工具的安装过程，尽管我可以说说postgREST，只是下载二进制文件，将其放在单独的文件夹中，创建一个test.conf配置文件，如下所示：</font></font><br>
<br>
<pre><code class="plaintext hljs">db-uri = "postgres://postgres:user1@localhost:5432/testbase"<font></font>
server-port= 5000<font></font>
# The name of which database schema to expose to REST clients<font></font>
db-schema= "public"<font></font>
# The database role to use when no client authentication is provided.<font></font>
# Can (and probably should) differ from user in db-uri<font></font>
db-anon-role = "postgres" </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同时，您的postgesql集群应具有testbase base和user1。</font><font style="vertical-align: inherit;">在此测试基础中，创建一个表：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-comment">-- Postgrest sql notes table </span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> notes (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">serial</span> primary <span class="hljs-keyword">key</span>,<font></font>
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">127</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">content</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
created <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,<font></font>
completed <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">with</span> <span class="hljs-built_in">time</span> zone,<font></font>
ddel <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用以下命令启动postgREST服务器：</font></font><br>
<br>
<pre><code class="bash hljs">postgrest test.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启动服务器后，它将显示有关连接到数据库以及它将在哪个端口上侦听客户端的信息性消息。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规划项目</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，如果大致了解mitril的工作原理，则需要弄清楚如何制作该应用程序。</font><font style="vertical-align: inherit;">这是计划：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将应用程序数据存储在本地对象中，我们称之为模型</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API应用程序将存储在单独的文件中</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们会将应用程序路由存储在单独的文件中</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径文件将是构建应用程序的入口点。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个单独的组件（我将使用组件渲染方案）以及与之关联的功能将存储在单独的文件中</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呈现模型数据的每个组件都可以访问模型。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组件DOM事件处理程序位于组件中</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们不需要自定义事件，而是本地DOM事件，这些事件的回调位于组件中。</font><font style="vertical-align: inherit;">我将使用两种方式绑定。</font><font style="vertical-align: inherit;">也许不是每个人都喜欢这种方法，但也不是每个人都喜欢redux或vuex。</font><font style="vertical-align: inherit;">而且，单向结合技术也可以使用秘银丝在米特里尔中实现。</font><font style="vertical-align: inherit;">但是在这种情况下，这是一个冗余解决方案。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序文件夹结构</font></font></h3><br>
<img src="https://habrastorage.org/webt/yp/uy/fa/ypuyfap4tlxl_ccqo86wbtb9h98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
公用文件夹将由前端服务器提供，其中有一个index.html文件以及带有样式和脚本的目录。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
src文件夹包含路由器的根目录和API定义，以及两个目录，分别用于模型和视图。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在项目的根目录下有一个rollup.config配置文件，该项目是使用以下命令构建的：</font></font><br>
<br>
<pre><code class="bash hljs">rollup –c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了避免让读者</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沉迷</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">github.com</font></a><font style="vertical-align: inherit;">上提供的大量代码</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">我将仅对主要实现元素进行评论，以演示二尖瓣的惯用方法。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API和路由器</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
API代码：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// used by backend server</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> restApi= {
  <span class="hljs-attr">notes</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">'notes'</span>, <span class="hljs-attr">editable</span>: [<span class="hljs-string">'add'</span>, <span class="hljs-string">'edit'</span>, <span class="hljs-string">'del'</span>] }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// used by routers</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appApi = {
  <span class="hljs-attr">root</span>: <span class="hljs-string">"/"</span>,<font></font>
}<font></font>
<span class="hljs-comment">// used by navBar</span>
<span class="hljs-comment">// here array of arrays though it may be hash eg</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appMenu = [<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Home'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'About'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Contacts'</span>],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我为REST服务器和路由器定义了API。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
路由器：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { restApi, appApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'./appApi'</span>;
<span class="hljs-keyword">import</span> { moModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'./model/moModel'</span>;
<span class="hljs-keyword">import</span> { vuView, vuApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuApp'</span>;
<span class="hljs-keyword">import</span> { vuNavBar } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuNavBar'</span>;<font></font>
<font></font>
<span class="hljs-comment">// application router</span>
<span class="hljs-keyword">const</span> appRouter = { [appApi.root]: {<font></font>
  render() {<font></font>
    <span class="hljs-keyword">const</span> view = m(vuApp, {
      <span class="hljs-attr">model</span>: moModel.getModel( restApi.notes ),<font></font>
    });<font></font>
    <span class="hljs-keyword">return</span> vuView( {<span class="hljs-attr">menu</span>: vuNavBar}, view);<font></font>
  }<font></font>
}};<font></font>
<font></font>
<span class="hljs-comment">// once per app</span>
m.route(<span class="hljs-built_in">document</span>.body, <span class="hljs-string">"/"</span>, appRouter);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此处，路由器安装在文档主体上。</font><font style="vertical-align: inherit;">路由器本身是一个描述路由和将在此路由上使用的组件的对象，render（）函数应返回vnode。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
appApi对象定义了所有有效的应用程序路由，而appMenu对象定义了该应用程序的所有可能的导航元素。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
渲染函数在调用时会生成一个应用程序模型，并将其传递给根节点。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用模式</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
存储相关数据的结构称为模型。</font><font style="vertical-align: inherit;">返回模型的函数的源代码：</font></font><br>
<br>
<pre><code class="javascript hljs">getModel(<font></font>
    {url=<span class="hljs-literal">null</span>, method=<span class="hljs-string">"GET"</span>, order_by=<span class="hljs-string">'id'</span>, editable=<span class="hljs-literal">null</span>} = {}<font></font>
  ) {<font></font>
<span class="hljs-comment">/**
  * url - string of model's REST API url
  * method - string of model's REST method
  * order_by - string "order by" with initially SELECT 
  * editable - array defines is model could changed
*/</span>
    <span class="hljs-keyword">const</span> model = {
      <span class="hljs-attr">url</span>: url,
      <span class="hljs-attr">method</span>: method,
      <span class="hljs-attr">order_by</span>: order_by,
      <span class="hljs-attr">editable</span>: editable,
      <span class="hljs-attr">key</span>: order_by, <span class="hljs-comment">// here single primary key only</span>
      <span class="hljs-attr">list</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// main data list </span>
      <span class="hljs-attr">item</span>: {}, <span class="hljs-comment">// note item</span>
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Promise error</span>
      <span class="hljs-attr">save</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// save status</span>
      <span class="hljs-attr">editMode</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// view switch flag</span>
      <span class="hljs-attr">word</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// dialog header word</span><font></font>
    };  <font></font>
    model.getItem= <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {<font></font>
      model.item= {};<font></font>
      <span class="hljs-keyword">if</span> ( !id ) {<font></font>
        model.editMode= <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">const</span> key= model.key;
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">let</span> it <span class="hljs-keyword">of</span> model.list ) {
        <span class="hljs-keyword">if</span> (it[key] == id) {<font></font>
          model.item= <span class="hljs-built_in">Object</span>.assign({}, it);
          <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
      }<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    };<font></font>
    <span class="hljs-keyword">return</span> model;<font></font>
  },</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 在这里它被初始化，并返回模型对象。</font><font style="vertical-align: inherit;">对象内部的链接可能会更改，但是指向对象本身的链接保持不变。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除了getModel函数之外，全局moModel对象还具有m.request（）mitry函数的包装函数，这些函数包括getList（模型）和formSubmit（事件，模型，方法）。</font><font style="vertical-align: inherit;">model参数实际上是对模型对象的引用，event是在提交表单时生成的事件对象，method是我们要用来保存注释的HTTP方法（POST是新注释，PATCH，DELETE是旧的）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
视图文件夹包含负责呈现单个页面元素的功能。</font><font style="vertical-align: inherit;">我将其分为4部分：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuApp-应用程序的根组件， </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNavBar-导航栏，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes-注释列表，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm-笔记编辑表单，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuDialog-HTML对话框元素 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
路由器确定在单个路由上返回了vuView（菜单，视图）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，该函数的定义：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuView= <span class="hljs-function">(<span class="hljs-params">appMenu, view</span>)=&gt;</span> m(vuMain, appMenu, view);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这只是返回vuMain组件的包装器，如果appMenu对象足够复杂，以至于嵌套对象的结构类似于外部对象，那么这种包装器是返回具有不同导航元素和子组件的组件的合适方法（您只需要编写更少的代码） 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VuMain组件：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> vuMain= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-comment">// We use ivnode as argument as it is initial vnode</span>
  <span class="hljs-keyword">const</span> { menu }= ivnode.attrs;
  <span class="hljs-keyword">return</span> { view(vnode) {
    <span class="hljs-comment">// IMPORTANT !</span>
    <span class="hljs-comment">// If we use vnode inside the view function we MUST provide it for view</span>
    <span class="hljs-keyword">return</span> [<font></font>
      m(menu),<font></font>
      m(<span class="hljs-string">'#layout'</span>, vnode.children)<font></font>
    ];<font></font>
  }};<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这仅返回导航的vnode和页面的实际内容。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在下文中，在可能定义组件的地方，我将使用闭包。</font><font style="vertical-align: inherit;">在页面的初始呈现期间，闭包被调用一次，并在本地存储所有传递给对象的链接以及它们自己的功能的定义。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关闭作为定义应该总是返回一个组件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上是应用程序内容组件：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuApp= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-comment">//initially get notes</span><font></font>
  moModel.getList( model );<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() { 
    <span class="hljs-keyword">return</span> [<font></font>
      m(vuNotes, { model }),<font></font>
      m(vuNoteForm, { model }),<font></font>
      vuModalDialog(model)<font></font>
    ];<font></font>
  }};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于我们已经有了一个模型，因此当我调用闭包时，我想从数据库中获取整个注释列表。</font><font style="vertical-align: inherit;">页面上将包含三个组件：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes-带“添加”按钮的注释列表，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm-笔记编辑表单，</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuModalDialog-我们将以模态显示的对话框元素，并在必要时猛击。 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于每个组件都需要知道如何绘制自身，因此我们将链接传递给每个组件中的模型对象。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
组件注释清单：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//Notes List</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuNotes= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-keyword">const</span> _display= <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> model.editMode ? <span class="hljs-string">'display:none'</span>: <span class="hljs-string">'display:block'</span>;
  <span class="hljs-keyword">const</span> vuNote= noteItem(model); <span class="hljs-comment">// returns note function</span><font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() {
    <span class="hljs-keyword">return</span> model.error ? m(<span class="hljs-string">'h2'</span>, {<span class="hljs-attr">style</span>: <span class="hljs-string">'color:red'</span>}, model.error) :<font></font>
    !model.list ? m(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'...LOADING'</span> ) :<font></font>
    m(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">style</span>: _display() }, [<font></font>
      m(addButton , { model } ),<font></font>
      m(<span class="hljs-string">'.pure-g'</span>, m(<span class="hljs-string">'.pure-u-1-2.pure-u-md-1-1'</span>,<font></font>
        m(<span class="hljs-string">'.notes'</span>, model.list.map( vuNote ) )<font></font>
      ))<font></font>
    ]);<font></font>
  }};<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
布尔editMode标志存储在模型对象中；如果标志值为true，则显示编辑形式，否则-注释列表。</font><font style="vertical-align: inherit;">您可以将测试提高一个级别，但是每次切换标志时，虚拟节点的数量和实际DOM节点的数量都会改变，这是不必要的工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们习惯于使用mitril，我们生成一个页面，使用三元运算符检查模型中属性的存在与否。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是返回注释显示功能的闭包：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> noteItem= <span class="hljs-function"><span class="hljs-params">model</span>=&gt;</span> {
  <span class="hljs-comment">// click event handler</span>
  <span class="hljs-keyword">const</span> event= <span class="hljs-function">(<span class="hljs-params"> msg, word=<span class="hljs-string">''</span>, time=<span class="hljs-literal">null</span></span>)=&gt;</span> <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    model.getItem(e.target.getAttribute(<span class="hljs-string">'data'</span>));
    <span class="hljs-keyword">if</span> ( !!msg ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">msg</span>: msg };<font></font>
      model.word= word;<font></font>
      <span class="hljs-keyword">if</span> ( !!time )<font></font>
        model.item.completed= time;<font></font>
      vuDialog.open();<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      model.editMode= <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  };<font></font>
  <span class="hljs-comment">// trash icon's click handler</span>
  <span class="hljs-keyword">const</span> _trash= event(<span class="hljs-string">'trash'</span>, <span class="hljs-string">'Dlelete'</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// check icon's click handler</span>
  <span class="hljs-keyword">const</span> _check= event(<span class="hljs-string">'check'</span>, <span class="hljs-string">'Complete'</span>,
    <span class="hljs-comment">// postgre timestamp string</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString().split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-string">'T'</span>, <span class="hljs-string">' '</span>));<font></font>
  <font></font>
  <span class="hljs-comment">// edit this note</span>
  <span class="hljs-keyword">const</span> _edit= event(<span class="hljs-string">''</span>);<font></font>
  <font></font>
  <span class="hljs-keyword">const</span> _time= <span class="hljs-function"><span class="hljs-params">ts</span>=&gt;</span> ts.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>];<font></font>
  <font></font>
  <span class="hljs-comment">// Single Note </span>
  <span class="hljs-keyword">const</span> _note= <span class="hljs-function"><span class="hljs-params">note</span>=&gt;</span> m(<span class="hljs-string">'section.note'</span>, {<span class="hljs-attr">key</span>: note.id}, [<font></font>
    m(<span class="hljs-string">'header.note-header'</span>, [ m(<span class="hljs-string">'p.note-meta'</span>, [
      <span class="hljs-comment">// note metadata</span>
      m(<span class="hljs-string">'span'</span>, { <span class="hljs-attr">style</span>: <span class="hljs-string">'padding: right: 3em'</span> }, <span class="hljs-string">`Created: <span class="hljs-subst">${_time( note.created )}</span>`</span>),<font></font>
      note.completed ? m(<span class="hljs-string">'span'</span>, <span class="hljs-string">`  Completed: <span class="hljs-subst">${_time( note.completed )}</span>`</span>) : <span class="hljs-string">''</span>, 
      <span class="hljs-comment">// note right panel </span>
      m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-trash'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _trash } )),<font></font>
      note.completed ? <span class="hljs-string">''</span> : [<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-pen'</span>, {<span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _edit } )),<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-check'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _check} ))<font></font>
      ]<font></font>
    ]),<font></font>
      m(<span class="hljs-string">'h2.note-title'</span>, { <span class="hljs-attr">style</span>: note.completed ? <span class="hljs-string">'text-decoration: line-through'</span>: <span class="hljs-string">''</span>}, note.title)<font></font>
    ]),<font></font>
    m(<span class="hljs-string">'.note-content'</span>, m(<span class="hljs-string">'p'</span>, note.content))<font></font>
  ]);<font></font>
  <span class="hljs-keyword">return</span> _note;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有点击处理程序均在本地定义。该模型不知道note对象的结构，我只定义了key属性，通过它我们可以从model.list数组中选择所需的元素。但是，组件必须确切知道其绘制的对象的结构。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不会提供用于编辑笔记的表单的代码的全文；我们只是单独查看表单提交处理程序：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// form submit handler</span>
  <span class="hljs-keyword">const</span> _submit= <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    e.preventDefault();<font></font>
    model.item.title= clean(model.item.title);<font></font>
    model.item.content= clean(model.item.content);<font></font>
    <span class="hljs-keyword">const</span> check= check_note(model.item);
    <span class="hljs-keyword">if</span> ( !!check ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">msg</span>: check }; <font></font>
      model.word= <span class="hljs-string">'Edit'</span>;<font></font>
      vuDialog.open();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">return</span> moModel.formSubmit(e, model, _method() ).then(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { model.editMode=<span class="hljs-literal">false</span>; <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;}).catch(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { vuDialog.open(); <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; } );<font></font>
  };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 由于定义发生在闭包中，因此我们有一个到模型的链接，并且我们返回了对结果进行后续处理的Promise：在正常完成请求或出现错误的情况下禁止显示表格-打开带有错误文本的对话框。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每次您访问后端服务器时，便笺列表都会重新读取。</font><font style="vertical-align: inherit;">在此示例中，尽管可以执行此操作，但无需调整内存中的列表。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看对话框组件</font><font style="vertical-align: inherit;">，唯一需要强调的是，在这种情况下，我使用对象文字来定义组件，因为我希望窗口打开和关闭功能可用于其他组件。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用javascript和mithril.js编写了一个小型SPA应用程序，试图坚持使用该框架的惯用法。</font><font style="vertical-align: inherit;">我想再次注意，这只是javascript代码。</font><font style="vertical-align: inherit;">也许不太干净。</font><font style="vertical-align: inherit;">该方法允许您封装一小段代码，隔离组件的机制并为所有组件使用通用状态。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN492482/index.html">3月16日至22日在莫斯科举行的数字活动</a></li>
<li><a href="../zh-CN492484/index.html">3月16日至3月22日在圣彼得堡举行的数字活动</a></li>
<li><a href="../zh-CN492486/index.html">例如Nuxt + Django + GraphQL</a></li>
<li><a href="../zh-CN492488/index.html">OpenID Connect：从通用到标准的内部应用程序授权</a></li>
<li><a href="../zh-CN492492/index.html">NikiRobot-教育机器人技术的发展</a></li>
<li><a href="../zh-CN492500/index.html">俄语科学车库。翻译美国节目的经验</a></li>
<li><a href="../zh-CN492502/index.html">MIP * = RE：引起物理学和数学上的多米诺效应的计算机科学领域的划时代证据</a></li>
<li><a href="../zh-CN492504/index.html">两次导入JS模块会怎样？</a></li>
<li><a href="../zh-CN492506/index.html">在Angular中呈现大列表的3种方法</a></li>
<li><a href="../zh-CN492508/index.html">为DevOps预订Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>