<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ üìõ ü•Å 7 dangerous mistakes that are easy to make in C # /. NET üéÇ üèª üó°Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A translation of the article was prepared ahead of the start of the course ‚ÄúC # ASP.NET Core Developer‚Äù .
 
 
 
 C # is a great language , and the .NE...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>7 dangerous mistakes that are easy to make in C # /. NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501796/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A translation of the article was prepared ahead of the start of the course </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúC # ASP.NET Core Developer‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/k8/vz/cz/k8vzcz5umofkpvfxz9zuj1pqibu.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C # is a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">great language</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and the .NET Framework is also very good. </font><font style="vertical-align: inherit;">Strong typing in C # helps to reduce the number of errors that you can provoke, in comparison with other languages. </font><font style="vertical-align: inherit;">Plus, its general intuitive design also helps a lot, compared to something like JavaScript (where </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true is false</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">However, each language has its own rake that is easy to tread on, along with erroneous ideas about the expected behavior of the language and infrastructure. </font><font style="vertical-align: inherit;">I will try to describe some of these errors in detail.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Do not understand delayed (lazy) execution</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I believe that experienced developers are aware of this .NET mechanism, but it may surprise less knowledgeable colleagues. In a nutshell, the methods / operators that return </font></font><code><code>IEnumerable&lt;</code>T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and use </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to return each result are not executed on the line of code that actually calls them - they are executed when the resulting collection is accessed in some way *. Note that most LINQ expressions eventually return their results with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As an example, consider the egregious unit test below.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(ArgumentNullException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Null_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-literal">null</span>);<font></font>
}<font></font>
[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(InvalidOperationException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Invalid_Operation_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-string">"test"</span>);
   <span class="hljs-keyword">var</span> firstItem = result.First();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerable&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">RepeatString5Times</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> toRepeat</span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">if</span> (toRepeat == <span class="hljs-literal">null</span>)
       <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(toRepeat));
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
   {   <font></font>
       <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"3 is a horrible number"</span>);
       <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{toRepeat}</span> - <span class="hljs-subst">{i}</span>"</span>;<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Both of these tests will fail. The first test will fail, because the result is not used anywhere, so the body of the method will never be executed. The second test will fail for another, slightly more non-trivial reason. Now we get the first result of calling our method to ensure that the method actually runs. However, the delayed execution mechanism will exit the method as soon as it can - in this case, we used only the first element, therefore, as soon as we pass the first iteration, the method stops its execution (therefore i == 3 will never be true). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Delayed execution is actually an interesting mechanism, especially because it makes it easy to chain LINQ queries, retrieving data only when your query is ready for use.</font></font><br>
<br>
<h3>2. ,   Dictionary      ,     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is especially unpleasant, and I‚Äôm sure that somewhere I have code that relies on this assumption. When you add items to the list </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, they are stored in the same order in which you add them - logically. Sometimes you need to have another object associated with an item in the list, and the obvious solution is to use a dictionary </font></font><code><code>Dictionary&lt;</code>TKey,TValue&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that allows you to specify a related value for the key. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then you can iterate over the dictionary using foreach, and in most cases it will behave as expected - you will access the elements in the same order in which they were added to the dictionary. However, this behavior </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is undefined</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - i.e. it is a happy coincidence, not something you can rely on and always expect. This is explained in</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but I think few people have carefully studied this page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To illustrate this, in the example below, the output will be as follows: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">third </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
second</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> dict = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt;();       <font></font>
dict.Add(<span class="hljs-string">"first"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Add(<span class="hljs-string">"second"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Remove(<span class="hljs-string">"first"</span>);<font></font>
dict.Add(<span class="hljs-string">"third"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> entry <span class="hljs-keyword">in</span> dict)<font></font>
{<font></font>
    Console.WriteLine(entry.Key);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not believe me? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check here online yourself</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Do not take into account flow safety</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Multithreading is great, if implemented correctly, you can significantly improve the performance of your application. However, as soon as you enter multithreading, you should be very, very careful with any objects that you will modify, because you may begin to encounter seemingly random errors if you are not careful enough. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simply put, many base classes in the .NET library are not </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thread safe.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- This means that Microsoft makes no guarantees that you can use this class in parallel using multiple threads. </font><font style="vertical-align: inherit;">This would not be a big problem if you could immediately find any problems associated with this, but the nature of multithreading implies that any problems that arise are very unstable and unpredictable - most likely, no two executions will produce the same result. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, consider this block of code that uses simple, but not thread-safe, </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> items = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;();
<span class="hljs-keyword">var</span> tasks = <span class="hljs-keyword">new</span> List&lt;Task&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
{<font></font>
   tasks.Add(Task.Run(() =&gt; {<font></font>
       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">10000</span>; k++)<font></font>
       {<font></font>
           items.Add(i);<font></font>
       }<font></font>
   }));<font></font>
}<font></font>
Task.WaitAll(tasks.ToArray());<font></font>
Console.WriteLine(items.Count);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, we add numbers from 0 to 4 to the list 10,000 times each, which means that the list should ultimately contain </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,000</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elements. </font><font style="vertical-align: inherit;">Should I? </font><font style="vertical-align: inherit;">Well, there‚Äôs a small chance that in the end it will be - but below are the results of 5 of my different launches:</font></font><br>
<br>
<pre><code class="plaintext hljs">28191<font></font>
23536<font></font>
44346<font></font>
40007<font></font>
40476</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check it yourself online here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, this is because the Add method is not atomic, which implies that the thread can interrupt the method, which can ultimately resize the array while another thread is in the process of adding, or add an element with the same index as the other thread. The IndexOutOfRange exception came to me a couple of times, probably because the size of the array changed during the addition to it. So what do we do here? We can use the lock keyword to ensure that only one thread can add an (Add) item to the list at one time, but this can significantly affect performance. Microsoft, being nice people, provides some great collections that</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">They are thread safe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and highly optimized in terms of performance. </font><font style="vertical-align: inherit;">I have already published </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an article describing how you can use them</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Abuse lazy (deferred) loading in LINQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lazy loading is a great feature for both LINQ to SQL and LINQ to Entities (Entity Framework), which allows you to load related table rows as needed. In one of my other projects, I have a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúModules‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> table and a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúResults‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> table </font><font style="vertical-align: inherit;">with a one-to-many relationship (a module can have many results). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qh/ds/ww/qhdsww2vr9-_oslbtzgqx8rle50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When I want to get a specific module, I certainly do not want the Entity Framework to return every Result that the Modules table has! Therefore, he is smart enough to execute a query to get results only when I need it. Thus, the code below will execute 2 queries - one to get the module, and the other to get the results (for each module),</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules;
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, what if I have hundreds of modules? </font><font style="vertical-align: inherit;">This means that a separate SQL query for receiving result records will be executed </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for each module! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviously, this will put a strain on the server and significantly slow down your application. </font><font style="vertical-align: inherit;">In the Entity Framework, the answer is very simple - you can specify that it include a specific set of results in your query. </font><font style="vertical-align: inherit;">See the modified code below, where only one SQL query will be executed, which will include each module and each result for this module (combined into one query, which the Entity Framework intelligently displays in your model),</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules.Include(b =&gt; b.Results);
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Don't understand how LINQ to SQL / Entity Frameworks translates queries</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we touched on the LINQ topic, I think it's worth mentioning how differently your code will execute if it is inside a LINQ query. Explaining at a high level, all of your code inside a LINQ query is translated into SQL using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expressions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - this seems obvious, but it‚Äôs very, very easy to forget the context you are in and ultimately introduce problems into your code base. Below I have compiled a list to describe some typical obstacles you may encounter. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most method calls will not work.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
So, imagine that you have the query below to separate the name of all modules with a colon and capture the second part.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> modules = <span class="hljs-keyword">from</span> m <span class="hljs-keyword">in</span> db.Modules
              <span class="hljs-keyword">select</span> m.Name.Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You will get an exception in most LINQ providers - there is no SQL translation for the Split method, some methods </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">may be</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supported, for example, adding days to a date, but it all depends on your provider. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Those that work may produce unexpected results ...</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Take the LINQ expression below (I have no idea why you would do this in practice, but please just imagine that this is a reasonable request).</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have any rows in the module table, it will give you the sum of the identifiers. </font><font style="vertical-align: inherit;">Sounds right! </font><font style="vertical-align: inherit;">But what if you execute it using LINQ to Objects instead? </font><font style="vertical-align: inherit;">We can do this by converting the collection of modules into a list before we execute our Sum method.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.ToList().Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shock, horror - it will do exactly the same! However, what if you did not have rows in the module table? LINQ to Objects returns 0, and the Entity Framework / LINQ to SQL version throws an </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidOperationException</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which says that it cannot convert ‚Äúint?‚Äù in ‚Äúint‚Äù ... such. This is because when you execute SUM in SQL for an empty set, NULL is returned instead of 0 - therefore, instead it tries to return a nullable int. Here are some </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tips to fix this if you encounter such a problem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Know when you just need to use the good old SQL.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are executing an extremely complex query, then your translated query may end up looking like something spit out, eaten up again and again spit out. </font><font style="vertical-align: inherit;">Unfortunately, I have no examples to demonstrate, but judging by the prevailing opinion, I really like using nested views, which makes code maintenance a nightmare. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, if you encounter any performance bottlenecks, it will be difficult for you to fix them because you do not have direct control over the generated SQL. </font><font style="vertical-align: inherit;">Either do it in SQL, or delegate it to the database administrator, if you or your company has one!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Wrong rounding</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now about something a little simpler than the previous paragraphs, but I always forgot about it, and ended up with unpleasant mistakes (and, if it is connected with finances, an angry fin / gene director). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The .NET Framework includes an excellent static method in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">called </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Round</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which takes a numeric value and rounds it to the specified decimal place. It works perfect most of the time, but what to do when you try to round 2.25 to the first decimal place? I assume that you probably expect it to round to 2.3 - that's what we're all used to, right? Well, in practice, it turns out that .NET uses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banker rounding</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which rounds the given example to 2.2! </font><font style="vertical-align: inherit;">This is due to the fact that bankers are rounded to the nearest even number if the number is at the ‚Äúmidpoint‚Äù. </font><font style="vertical-align: inherit;">Fortunately, this can easily be overridden in the Math.Round method.</font></font><br>
 <br>
<pre><code class="cs hljs">Math.Round(<span class="hljs-number">2.25</span>,<span class="hljs-number">1</span>, MidpointRounding.AwayFromZero)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Horrible class 'DBNull' </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This can cause unpleasant memories for some - ORM hides this filth from us, but if you delve into the world of naked ADO.NET (SqlDataReader and the like) you will meet DBNull.Value. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I'm not 100% sure of the reason </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">why</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL values ‚Äã‚Äãfrom the database are processed as follows (please comment below if you know!), but Microsoft decided to present them with a special type DBNull (with a static field Value). </font><font style="vertical-align: inherit;">I can give one of the advantages of this - you will not get any unpleasant NullReferenceException when accessing a database field that is NULL. </font><font style="vertical-align: inherit;">However, you should not only support the secondary way of checking for NULL values ‚Äã‚Äã(which is easy to forget, which can lead to serious errors), but you lose any of the great features of C # that help you work with null. </font><font style="vertical-align: inherit;">What could be as simple as</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) ?? <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
what eventually becomes ...</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) != DBNull.Value ? reader.GetString(<span class="hljs-number">0</span>) : <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ugh.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These are just some of the non-trivial ‚Äúrakes‚Äù that I have encountered in .NET - if you know more, I would like to hear from you below.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">ASP.NET Core:  </a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501784/index.html">If my car gets in the way</a></li>
<li><a href="../en501786/index.html">New application "Jellyfish". Why flutter?</a></li>
<li><a href="../en501788/index.html">Creating parametric objects in nanoCAD Design BIM</a></li>
<li><a href="../en501790/index.html">Nontrivial animations in SwiftUI</a></li>
<li><a href="../en501792/index.html">How FinFET's father helped save Moore's law</a></li>
<li><a href="../en501798/index.html">C++/Qt: –ø–æ—Ä–∞ –≤–∞–ª–∏—Ç—å?.</a></li>
<li><a href="../en501800/index.html">Small osinta session on modernization and production of radio communication systems for the Armed Forces of the Russian Federation</a></li>
<li><a href="../en501804/index.html">Dart. Everything you need to know about constants</a></li>
<li><a href="../en501806/index.html">ACS: problems, solutions and security risk management</a></li>
<li><a href="../en501808/index.html">The list of changes in D 2.092. Borrowing Borrowing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>