<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛄 ♥️ 🚶🏾 Speichern der Geschäftslogik in Swift Combine. Teil 1 🌖 💚 🐘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Datenorientiertes Kombinieren
 
 
 
 
 Die Übersetzung des Artikels wurde speziell für Studenten des Fortgeschrittenenkurses "iOS Developer" vorbereit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Speichern der Geschäftslogik in Swift Combine. Teil 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/487140/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenorientiertes Kombinieren</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/-6/vr/fp/-6vrfp7fsjumtkug45wzkpu8mde.png"><br>
<br>
<hr><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Übersetzung des Artikels wurde speziell für Studenten des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortgeschrittenenkurses "iOS Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vorbereitet </font><font style="vertical-align: inherit;">.</font></font></i><br>
</b><br>
<hr><br>
<img src="https://habrastorage.org/webt/hp/0d/0q/hp0d0qfoty-seoe-uqpjd-oqsrk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der vorherigen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reihe von Beiträgen haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir erfolgreich eine Plattform auf SwiftUI aufgebaut, mit der Sie die Reihenfolge der Werte, die durch den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Publisher</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Combine </font><font style="vertical-align: inherit;">gehen, frei beobachten können </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben auch eine Reihe von Beispielen demonstriert mehrere Standardoperatoren kombinieren, wie zum </font><font style="vertical-align: inherit;">Modifizieren und Umwandeln von Werten in der </font><font style="vertical-align: inherit;">Lage sind , </font><font style="vertical-align: inherit;">Sequenzen , </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">filter</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">map</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">drop</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">scan</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Darüber hinaus haben wir einige Operatoren vorgestellt, die die </font><font style="vertical-align: inherit;">Sequenz </font><font style="vertical-align: inherit;">verbinden ( </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zip</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CombineLatest</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) oder vereinheitlichen ( </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Merge</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Append</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An diesem Punkt könnten einige von Ihnen es leid sein, so viel Code für jedes Beispiel organisieren und pflegen zu müssen (zumindest bin ich schon müde). Sehen Sie, wie viele davon sich im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kombinations-Magic-Swiftui-Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Tutorial-Ordner befinden? Jedes der Beispiele ist eine Darstellung von SwiftUI. Jeder von ihnen überträgt einfach einen oder mehrere Verlage an </font></font><code>StreamView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>StreamView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signiert Verlage auf Knopfdruck. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher sollte ich in der Lage sein, beim Starten und Wiederverwenden der Anwendung programmgesteuert eine Liste der Herausgeber zu erstellen </font></font><code>StreamView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wie im folgenden Screenshot dargestellt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uw/vz/nw/uwvznw3n6nj58-kch_x5vnqhtdc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem bei dieser Lösung ist jedoch die Skalierbarkeit, wenn Sie viele Publisher erstellen müssen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meine Lösung für dieses Problem besteht darin, diese Herausgeber irgendwie zu speichern. </font><font style="vertical-align: inherit;">Wenn ich sie irgendwie serialisieren kann, kann ich sie speichern. </font><font style="vertical-align: inherit;">Wenn es mir gelingt, sie zu speichern, kann ich sie nicht nur ändern, ohne den Code zu ändern, sondern sie auch für andere Geräte freigeben, die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine unterstützen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lagerung und Transfer von Betreibern kombinieren</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns nun unsere Ziele genauer an. </font><font style="vertical-align: inherit;">Da wir eine Liste von Streams und Operatoren in einem Format haben </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, möchten wir sie in jeder Art von Speicher speichern können - zum Beispiel auf einer Festplatte oder in einer Datenbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich müssen wir auch in der Lage sein, die gespeicherten Daten zurück in den Herausgeber zu konvertieren, aber zusätzlich möchten wir in der Lage sein, diese Herausgeber mit Betreibern von einem Ort zum anderen auszutauschen, zu übertragen und zu verteilen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir eine solche Struktur in einer verteilten Umgebung eingerichtet haben, wie Sie vielleicht vermutet haben, kann ein zentraler Dienst beginnen, die Rechenlogik für eine Gruppe von Clients zu verwalten.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hp/0d/0q/hp0d0qfoty-seoe-uqpjd-oqsrk.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codierbare Struktur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie machen wir das? </font><font style="vertical-align: inherit;">Wir werden zunächst eine Struktur entwickeln, die serialisierbar und deserialisierbar ist. </font><font style="vertical-align: inherit;">Das Swift-Protokoll </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Codable</a> </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ermöglicht es uns, dies durch </font></font><code>JSONEncoder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">zu tun </font></font><code>JSONDecoder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Darüber hinaus muss die Struktur Daten und Verhaltensweisen für die kleinste Werteinheit im Stream bis hin zu komplexen Operatorketten korrekt darstellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor wir verstehen, welche Komponenten für die Strukturen erforderlich sind, die wir erstellen werden, erinnern wir uns an den Hauptstrom, den wir in der vorherigen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reihe von Beiträgen erstellt haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strom von Zahlen</font></font></h3><br>
<img src="https://habrastorage.org/webt/hg/n3/_f/hgn3_fnhmyzj7vggg4s3s2gd-xi.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist der einfachste Stream. </font><font style="vertical-align: inherit;">Wenn Sie jedoch genauer hinschauen, werden Sie feststellen, dass dies nicht nur eine Folge von Arrays ist. </font><font style="vertical-align: inherit;">Jeder der runden Blöcke hat einen eigenen Verzögerungsoperator ( </font></font><code>delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), der die tatsächliche Zeit bestimmt, zu der er gesendet werden soll. </font><font style="vertical-align: inherit;">Jeder Wert in Combine sieht folgendermaßen aus:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">Just</span>(value).delay(<span class="hljs-keyword">for</span>: .seconds(<span class="hljs-number">1</span>), scheduler: <span class="hljs-type">DispatchQueue</span>.main)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und im Allgemeinen sieht alles so aus:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> val1 = <span class="hljs-type">Just</span>(<span class="hljs-number">1</span>).delay(<span class="hljs-keyword">for</span>: .seconds(<span class="hljs-number">1</span>), scheduler:   <span class="hljs-type">DispatchQueue</span>.main)
<span class="hljs-keyword">let</span> val2 = <span class="hljs-type">Just</span>(<span class="hljs-number">2</span>).delay(<span class="hljs-keyword">for</span>: .seconds(<span class="hljs-number">1</span>), scheduler: <span class="hljs-type">DispatchQueue</span>.main)
<span class="hljs-keyword">let</span> val3 = ....
<span class="hljs-keyword">let</span> val4 = ....
<span class="hljs-keyword">let</span> publisher = val1.append(val2).append(val3).append(val4)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Wert wird um eine Sekunde verzögert, und dieselbe Anweisung wird zum nächsten Wert hinzugefügt </font></font><code>delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher lernen wir aus unseren Beobachtungen zwei Dinge.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Stream ist nicht die kleinste Einheit in einer Struktur. </font><font style="vertical-align: inherit;">Der kleinste ist der Wert des Streams.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeder Stream-Wert kann unbegrenzte Operatoren haben, die steuern, wann und welcher Wert übertragen wird.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie Ihr StreamItem</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Wert des Streams und seiner Operatoren die kleinste Einheit ist, erstellen wir zunächst seine Struktur. </font><font style="vertical-align: inherit;">Nennen wir sie </font></font><code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StreamItem</span>&lt;<span class="hljs-title">T</span>: <span class="hljs-title">Codable</span>&gt;: <span class="hljs-title">Codable</span> </span>{
 <span class="hljs-keyword">let</span> value: <span class="hljs-type">T</span>
 <span class="hljs-keyword">var</span> operators: [<span class="hljs-type">Operator</span>]<font></font>
}</code></pre><br>
<code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enthält den Wert des Streams und ein Array von Operatoren. </font><font style="vertical-align: inherit;">Entsprechend unseren Anforderungen möchten wir in der Lage sein, alles in der Struktur so zu erhalten, dass beides </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das Protokoll eingehalten werden </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Stream-Wert muss universell sein, um jeden Werttyp aufnehmen zu können.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie Ihr StreamModel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden die Struktur für die Operatoren später diskutieren. </font><font style="vertical-align: inherit;">Verbinden wir das Array </font></font><code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit </font></font><code>StreamModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StreamModel</span>&lt;<span class="hljs-title">T</span>: <span class="hljs-title">Codable</span>&gt;: <span class="hljs-title">Codable</span>, <span class="hljs-title">Identifiable</span> </span>{
 <span class="hljs-keyword">var</span> id: <span class="hljs-type">UUID</span>
 <span class="hljs-keyword">var</span> name: <span class="hljs-type">String?</span>
 <span class="hljs-keyword">var</span> description: <span class="hljs-type">String?</span>
 <span class="hljs-keyword">var</span> stream: [<span class="hljs-type">StreamItem</span>&lt;<span class="hljs-type">T</span>&gt;]<font></font>
}</code></pre><br>
<code>StreamModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enthält ein Array von </font></font><code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s. </font></font><code>StreamModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hat auch Eigenschaften für Bezeichner, Name und Beschreibung. </font><font style="vertical-align: inherit;">Auch hier sollte alles in </font></font><code>StreamModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">für die Speicherung und Verteilung codierbar sein.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie eine Operatorstruktur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erwähnt, können Bediener </font></font><code>delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Übertragungszeit ändern </font></font><code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Operator</span> </span>{
 <span class="hljs-keyword">case</span> delay(seconds: <span class="hljs-type">Double</span>)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir betrachten den Operator </font></font><code>delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">als eine Aufzählung ( </font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) mit einem zugeordneten Wert, um die Verzögerungszeit zu speichern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich </font></font><code>Operator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muss auch </font><font style="vertical-align: inherit;">die Aufzählung </font><font style="vertical-align: inherit;">übereinstimmen </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, einschließlich des Codierens und Decodierens verwandter Werte. </font><font style="vertical-align: inherit;">Siehe vollständige Implementierung unten.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Operator</span> </span>{
    <span class="hljs-keyword">case</span> delay(seconds: <span class="hljs-type">Double</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Operator</span>: <span class="hljs-title">Codable</span> </span>{<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">CodingKeys</span>: <span class="hljs-title">CodingKey</span> </span>{
        <span class="hljs-keyword">case</span> delay<font></font>
    }<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DelayParameters</span>: <span class="hljs-title">Codable</span> </span>{
        <span class="hljs-keyword">let</span> seconds: <span class="hljs-type">Double</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">CodingError</span>: <span class="hljs-title">Error</span> </span>{ <span class="hljs-keyword">case</span> decoding(<span class="hljs-type">String</span>) }<font></font>
<font></font>
    <span class="hljs-keyword">init</span>(from decoder: <span class="hljs-type">Decoder</span>) <span class="hljs-keyword">throws</span> {
        <span class="hljs-keyword">let</span> container = <span class="hljs-keyword">try</span> decoder.container(keyedBy: <span class="hljs-type">CodingKeys</span>.<span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> delayParameters = <span class="hljs-keyword">try</span>? container.decodeIfPresent(<span class="hljs-type">DelayParameters</span>.<span class="hljs-keyword">self</span>, forKey: .delay) {
            <span class="hljs-keyword">self</span> = .delay(seconds: delayParameters.seconds)
            <span class="hljs-keyword">return</span><font></font>
        }<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-type">CodingError</span>.decoding(<span class="hljs-string">"Decoding Failed. \(dump(container))"</span>)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encode</span><span class="hljs-params">(to encoder: Encoder)</span></span> <span class="hljs-keyword">throws</span> {
        <span class="hljs-keyword">var</span> container = encoder.container(keyedBy: <span class="hljs-type">CodingKeys</span>.<span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .delay(<span class="hljs-keyword">let</span> seconds):
            <span class="hljs-keyword">try</span> container.encode(<span class="hljs-type">DelayParameters</span>(seconds: seconds), forKey: .delay)<font></font>
        }<font></font>
    }<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben jetzt eine gute Struktur, um diesen sequentiellen Strom darzustellen, der mit einem zweiten Verzögerungsintervall Werte von 1 bis 4 erzeugt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l</font></font><pre><code class="swift hljs">et streamA = (<span class="hljs-number">1</span>...<span class="hljs-number">4</span>).<span class="hljs-built_in">map</span> { <span class="hljs-type">StreamItem</span>(value: $<span class="hljs-number">0</span>,<font></font>
operators: [.delay(seconds: <span class="hljs-number">1</span>)]) }
<span class="hljs-keyword">let</span> serialStreamA = <span class="hljs-type">StreamModel</span>(id: <span class="hljs-type">UUID</span>(), name: <span class="hljs-string">"Serial Stream A"</span>,<font></font>
description: <span class="hljs-literal">nil</span>, stream: streamA)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konvertieren Sie StreamModel in Publisher</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt haben wir eine Instanz des Streams erstellt. </font><font style="vertical-align: inherit;">Wenn wir es jedoch nicht in einen Verlag umwandeln, ist alles bedeutungslos. </font><font style="vertical-align: inherit;">Lass es uns versuchen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst bezieht sich jedes Operatormodell auf den tatsächlichen Kombinationsoperator, der diesem Herausgeber hinzugefügt und an den betriebenen Herausgeber zurückgegeben werden sollte.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Operator</span> </span>{
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">applyPublisher</span>&lt;T&gt;<span class="hljs-params">(<span class="hljs-number">_</span> publisher: AnyPublisher&lt;T, Never&gt;)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Never</span>&gt; {
  <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
    <span class="hljs-keyword">case</span> .delay(<span class="hljs-keyword">let</span> seconds):
    <span class="hljs-keyword">return</span> publisher.delay(<span class="hljs-keyword">for</span>: .seconds(seconds), scheduler: <span class="hljs-type">DispatchQueue</span>.main).eraseToAnyPublisher()<font></font>
  }<font></font>
 }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Moment gibt es nur einen Operatortyp - </font></font><code>delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir werden im Laufe der Zeit weitere hinzufügen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir Publisher für alle nutzen </font></font><code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">StreamItem</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">toPublisher</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Never</span>&gt; {
   <span class="hljs-keyword">var</span> publisher: <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Never</span>&gt; =
                  <span class="hljs-type">Just</span>(value).eraseToAnyPublisher()
   <span class="hljs-keyword">self</span>.operators.forEach {<font></font>
      publisher = $<span class="hljs-number">0</span>.applyPublisher(publisher)<font></font>
   }<font></font>
  <span class="hljs-keyword">return</span> publisher<font></font>
}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beginnen mit dem Wert </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Just</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, verallgemeinern ihn mit der Methode </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eraseToAnyPublisher</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und verwenden dann die Herausgeber aller verwandten Operatoren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Ebene erhalten </font></font><code>StreamModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir den Herausgeber des gesamten Streams.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">StreamModel</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">toPublisher</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Never</span>&gt; {
   <span class="hljs-keyword">let</span> intervalPublishers =
        <span class="hljs-keyword">self</span>.stream.<span class="hljs-built_in">map</span> { $<span class="hljs-number">0</span>.toPublisher() }
   <span class="hljs-keyword">var</span> publisher: <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Never</span>&gt;?
   <span class="hljs-keyword">for</span> intervalPublisher <span class="hljs-keyword">in</span> intervalPublishers {
     <span class="hljs-keyword">if</span> publisher == <span class="hljs-literal">nil</span> {<font></font>
       publisher = intervalPublisher<font></font>
       <span class="hljs-keyword">continue</span><font></font>
     }<font></font>
     publisher =<font></font>
        publisher?.append(intervalPublisher).eraseToAnyPublisher()<font></font>
   }<font></font>
   <span class="hljs-keyword">return</span> publisher ?? <span class="hljs-type">Empty</span>().eraseToAnyPublisher()<font></font>
 }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie haben es richtig erraten: Wir verwenden die Methode </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">append</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um Verlage zu kombinieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualisierung, Bearbeitung und erneut Visualisierung eines Streams</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir einfach den Publisher dekodieren, eine StreamView übertragen und erstellen (siehe, wie wir es in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">früheren Beiträgen gemacht haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Und zu guter Letzt: Jetzt können wir einfach bearbeiten </font></font><code>StreamModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, weitere </font></font><code>StreamItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit neuen Werten </font><font style="vertical-align: inherit;">hinzufügen </font><font style="vertical-align: inherit;">und dieses Modell sogar über das Internet mit anderen Geräten teilen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siehe die Demo unten. </font><font style="vertical-align: inherit;">Jetzt können wir Änderungen am Stream vornehmen, ohne den Code zu ändern.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4w/sk/um/4wskumt1ae-bbp9nty5_ageekjy.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nächstes Kapitel: Serialisieren / Deserialisieren von Filtern und Kartenoperatoren</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im nächsten Teil werden wir der Operatoraufzählung weitere Operatoren hinzufügen und diese auf Thread-Ebene anwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bis zum nächsten Mal finden Sie den Quellcode hier in diesem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine-Magic-Swifui-Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Ordner Combine-Playground. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir warten auf Ihre Kommentare und sind zu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einem offenen Webinar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Thema "iOS-Anwendung auf SwiftUI mit Kotlin Mobile Multiplatform" </font><font style="vertical-align: inherit;">eingeladen </font><font style="vertical-align: inherit;">.</font></font><br>
</b></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de487140/">https://habr.com/ru/post/de487140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487124/index.html">Interview mit Borey Yangel über Yandex Selbstfahrer und Alices Schöpfungsgeschichte</a></li>
<li><a href="../de487126/index.html">Wie Unternehmensentwicklungsteams GitLab und Mattermost ChatOps verwenden, um die Entwicklung zu beschleunigen</a></li>
<li><a href="../de487132/index.html">Wie wir ein verteiltes Team von mehreren hundert Mitarbeitern zu SAAS transferierten</a></li>
<li><a href="../de487136/index.html">Bereinigen Sie den Code für TypeScript - Teil 3</a></li>
<li><a href="../de487138/index.html">Graphentheorie im maschinellen Lernen für die Kleinsten</a></li>
<li><a href="../de487144/index.html">Testen Sie die Panoramakamera Jabra Panacast mit einem Betrachtungswinkel von 180 ° (Video)</a></li>
<li><a href="../de487146/index.html">ResizeObserver - ein neues leistungsstarkes Tool zum Arbeiten mit Anpassungsfähigkeit</a></li>
<li><a href="../de487154/index.html">Erkundung des Sand-Shaders des Journey-Spiels</a></li>
<li><a href="../de487162/index.html">Brauchen moderne Geschäftsleute und Unternehmen Privatsphäre?</a></li>
<li><a href="../de487168/index.html">Toxic Grandfather Interface Tales "Instrumental Trash" (s1 e2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>