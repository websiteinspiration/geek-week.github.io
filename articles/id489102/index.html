<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§üüèΩ üôáüèæ üèòÔ∏è Kehidupan layar palsu. "Ya, aku pribadi kenal Madonna" üë®üèª‚Äçüíª üôèüèæ üëàüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam perselisihan di Internet dan dalam kehidupan nyata, argumen yang didukung oleh bukti - tangkapan layar, foto, pesan / panggilan rekaman, rekaman...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kehidupan layar palsu. "Ya, aku pribadi kenal Madonna"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/489102/"><p><img src="https://habrastorage.org/webt/rf/rs/ak/rfrsak8khtg2wwesitvourhs-j8.jpeg"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam perselisihan di Internet dan dalam kehidupan nyata, argumen yang didukung oleh bukti - tangkapan layar, foto, pesan / panggilan rekaman, rekaman video, dll. - memiliki bobot terbesar.</font></font></p><br>
<p>     ‚Äî    .     .            ?</p><a name="habracut"></a><br>
<h2 id="vvedenie"></h2><br>
<p> ,       ,  -  - , , ,   .</p><br>
<p>          ‚Äî screenlife,      .   :        ,   .</p><br>
<p>     (,  ).   :  /       ,   .    ,    ,      .  :      ,    /    .</p><br>
<p>   :   screenlife,     ,  ,   .</p><br>
<p>,  , ‚Äî    Frida,    JavaScript   . ,    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DeepFace</a>.</p><br>
<h2 id="tehnicheskaya-storona-voprosa-ili-para-slov-o-frida">  ,     Frida</h2><br>
<p> ,   Frida    18 .</p><br>
<p>Frida ‚Äî      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dynamic Binary Instrumentation, DBI</a>),   runtime   JavaScript    blackbox  /       ‚Äî hooking  tracing  ,      ,      .    Frida    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>. Frida    ,      iOS.</p><br>
<h2 id="primerproof">/proof</h2><br>
<p><em></em>: iPhone 6s   iOS 13.2.3</p><br>
<p><em> </em>: Instagram (v126.0.0.13.120)</p><br>
<p><em></em>:      ,     .</p><br>
<p> ,         .       ‚Äî     .</p><br>
<h3 id="tldr">TL;DR</h3><br>
<ol>
<li> </li>
<li></li>
<li>     </li>
<li>     Frida</li>
<li>   </li>
</ol><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">‚Äú  iOS-  Jailbreak‚Äù</a>.</p><br>
<h3 id="chto-my-hotim-poluchit">   </h3><br>
<p>     :</p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/te2sLzaIz6I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>  ,    ,   .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.</p><br>
<p>         jailbreak,           .</p><br>
<p> ,  ,       .  UI    ,     ?      UI  Instagram:</p><br>
<p>    Madonna (   ):</p><br>
<p><img src="https://habrastorage.org/webt/5a/x5/xr/5ax5xrh3tpclltn6lfpe8tfa7no.png"></p><br>
<p>     ,     ( ):</p><br>
<p><img src="https://habrastorage.org/webt/fl/zx/nk/flzxnkb6oavntipq5bhokjsee1e.png"></p><br>
<p>      (    ):</p><br>
<p><img src="https://habrastorage.org/webt/-o/yx/v5/-oyxv5qanhbvoeyn56soywtmw3w.png"></p><br>
<p> ,     (  <code>origUser</code> ‚Äî original User),         (  <code>replUser</code> ‚Äî replicated User),   UI     ,      <code>origUser</code> ( ,   ).        <code>replUser</code>,   , ,   .  ,    ,        .    ,     ID <code>origUser</code>  <code>replUser</code>,   ,     .</p><br>
<h3 id="poluchaem-deshifrovannyy-ipa-fayl">  IPA </h3><br>
<p>,    Frida-,      (   IPA   Instagram).     :</p><br>
<ol>
<li>  Mac:   <code>Apple configurator 2</code>  AppStore,       .          .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></li>
<li>  iPhone jailbreak    iOS,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">frida-ios-dump</a>     .  ,  <em></em>  Frida.       ,     IPA  Instagram.   Frida   .</li>
</ol><br>
<p>  ,    .      iOS bundle   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a>.         Mach-O 64-bit arm64 :</p><br>
<ol>
<li><code>Instagram.App/Instagram</code> ‚Äî   </li>
<li><code>Instagram.app/Frameworks/InstagramAppCoreFramework.framework/InstagramAppCoreFramework</code> ‚Äî  Instagram</li>
<li><code>Instagram.app/Frameworks/FBSharedFramework.framework/FBSharedFramework</code> ‚Äî shared  Facebook,    InstagramAppCoreFramework  Instagram.</li>
</ol><br>
<h3 id="revyorsim-ispolnyaemye-fayly-instagram">   (Instagram)</h3><br>
<p>      ‚Äî <code>Insagram.App/Instagram</code>.        ,     IDA Pro.</p><br>
<p>    Instagram,  ,     ( 364),  Instagram ‚Äî   :</p><br>
<p><img src="https://habrastorage.org/webt/y6/q4/st/y6q4stq5gpkyplbkf6mm5f5_uli.png"></p><br>
<p>    ‚Äî   .       ,  .</p><br>
<h3 id="revyorsim-ispolnyaemye-fayly-instagramappcoreframework-i-fbsharedframework">   (InstagramAppCoreFramework  FBSharedFramework)</h3><br>
<p>     <code>InstagramAppCoreFramework</code>,     Instagram.</p><br>
<blockquote>   ,  <code>FBSharedFramework</code>    <code>Instagram</code>  <code>InstagramAppCoreFramework</code>,   (User, Direct Messages, Message ), controller  view     <code>InstagramAppCoreFramework</code>.</blockquote><p>    ,   direct .   ,      ‚ÄúMessage‚Äù   <code>origUser</code>,   direct  <code>replUser</code>.</p><br>
<h4 id="doxygen-dokumentaciya-po-hederam">Doxygen   </h4><br>
<p> <code>InstagramAppCoreFramework</code>  IDA Pro,  ,       250000 ,  ,       .    -,   doxygen-   header- Objective-C   .   header-    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">classdumpios</a>,   ARM64.  iPhone  jailbreak,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SSH  USB</a>       IPA  Instagram  :</p><br>
<pre><code class="bash hljs">iPhone:~/insta $ mkdir headers<font></font>
iPhone:~/insta $ cp Payload/Instagram.app/Frameworks/InstagramAppCoreFramework.framework/InstagramAppCoreFramework ./headers<font></font>
iPhone:~/insta $ cp Payload/Instagram.app/Frameworks/FBSharedFramework.framework/FBSharedFramework ./headers<font></font>
iPhone:~/insta $ <span class="hljs-built_in">cd</span> headers<font></font>
iPhone:~/insta/headers $ classdumpios -H InstagramAppCoreFramework -o IG_headers<font></font>
iPhone:~/insta/headers $ classdumpios -H FBSharedFramework -o FB_headers<font></font>
iPhone:~/insta/headers $ tar -czvf IG_headers.tar.gz IG_headers<font></font>
iPhone:~/insta/headers $ tar -czvf FB_headers.tar.gz FB_headers</code></pre><br>
<p>     header-  iPhone   ,     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    doxygen</a>    :</p><br>
<pre><code class="bash hljs">Host@Host:~/insta$ mkdir docs &amp;&amp; <span class="hljs-built_in">cd</span> docs<font></font>
Host@Host:~/insta/docs $ scp -P &lt;PORT&gt; root@&lt;IP&gt;:&lt;/path/to/instagram&gt;/insta/headers/IG_headers.tar.gz .<font></font>
Host@Host:~/insta/docs $ scp -P &lt;PORT&gt; root@&lt;IP&gt;:&lt;/path/to/instagram&gt;/insta/headers/FB_headers.tar.gz .<font></font>
Host@Host:~/insta/docs $ tar xf IG_headers.tar.gz<font></font>
Host@Host:~/insta/docs $ tar xf FB_headers.tar.gz<font></font>
Host@Host:~/insta/docs $ cp &lt;/path/to/dox.template&gt; .<font></font>
Host@Host:~/insta/docs $ doxygen dox.template</code></pre><br>
<p> doxygen- ,         .       .</p><br>
<p>    ,   <code>InstagramAppCoreFramework</code>  <code>FBSharedFramework</code>:</p><br>
<p><img src="https://habrastorage.org/webt/oz/ui/nw/ozuinwjukrw7_xsclh3pwhf5kja.png"></p><br>
<p>  ,       <code>IGAuthUserParser</code>:</p><br>
<p><img src="https://habrastorage.org/webt/wt/yh/nq/wtyhnqasxtro56iqd7es9b69bv8.png"></p><br>
<p>      ,        .</p><br>
<h3 id="pervyy-frida-skript"> Frida-</h3><br>
<p>         ,      .    ,            ,     Frida- ,    ,     ,   ,  backtrace,        .             .     .     trace-,           .</p><br>
<p>    Python-  Frida,    :</p><br>
<pre><code class="bash hljs">~ $ pip install --upgrade frida frida-tools</code></pre><br>
<p>,          frida-server.  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> (   JB)</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> (   JB)</a>.</p><br>
<p>       <code>- inputView:didTapStickerButton:</code>  <code>IGDirectThreadViewController</code>.   ?     ,       ,     .  ,           direct  (  ,     ,     ).   ,     ,      ,     ,     Frida.    <code>NativeFunction</code>  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> func = ObjC.classes.IGDirectThreadViewController[<span class="hljs-string">"inputView:didTapStickerButton:"</span>].implementation;</code></pre><br>
<p>  hook,       :</p><br>
<pre><code class="javascript hljs">Interceptor.attach(func, {
    <span class="hljs-attr">onEnter</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"-[IGDirectThreadViewController inputView:didTapStickerButton:] =&gt; onEnter"</span>);<font></font>
   },<font></font>
    <span class="hljs-attr">onLeave</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">retval</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"-[IGDirectThreadViewController inputView:didTapStickerButton:] &lt;= onLeave"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<p>     ,         .</p><br>
<p>    ,  ,      . , ,     ,    .</p><br>
<p> hook,   ,    ,    .   hook   ‚Äî  .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.     :</p><br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTracer</span>(<span class="hljs-params">className, methodName</span>) </span>{
    <span class="hljs-comment">//  NativeFunction   </span>
    <span class="hljs-keyword">var</span> impl = ObjC.classes[className][methodName].implementation;<font></font>
<font></font>
    Interceptor.attach(impl, {<font></font>
        <span class="hljs-attr">onEnter</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>) </span>{
            <span class="hljs-keyword">this</span>.log = []; <span class="hljs-comment">// ,       </span>
            <span class="hljs-keyword">this</span>.log.push(<span class="hljs-string">'('</span> + a[<span class="hljs-number">0</span>] + <span class="hljs-string">','</span> + Memory.readUtf8String(a[<span class="hljs-number">1</span>]) + <span class="hljs-string">') '</span> + className + <span class="hljs-string">' '</span> + methodName); <span class="hljs-comment">//   ,    ,    </span>
            <span class="hljs-keyword">if</span> (methodName.indexOf(<span class="hljs-string">':'</span>) !== <span class="hljs-number">-1</span>) { <span class="hljs-comment">//   ,  ":"</span>
                <span class="hljs-keyword">var</span> params = methodName.split(<span class="hljs-string">':'</span>);<font></font>
                params[<span class="hljs-number">0</span>] = params[<span class="hljs-number">0</span>].split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>];<font></font>
<font></font>
                <span class="hljs-comment">//      </span>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; params.length - <span class="hljs-number">1</span>; i++) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">this</span>.log.push(params[i] + <span class="hljs-string">': '</span> + <span class="hljs-keyword">new</span> ObjC.Object(a[<span class="hljs-number">2</span> + i]).toString());<font></font>
                    } <span class="hljs-keyword">catch</span> (e) {
                        <span class="hljs-keyword">this</span>.log.push(params[i] + <span class="hljs-string">': '</span> + a[<span class="hljs-number">2</span> + i].toString());<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">//     </span>
            <span class="hljs-keyword">this</span>.log.push(<font></font>
                Thread.backtrace(<span class="hljs-keyword">this</span>.context, Backtracer.ACCURATE)<font></font>
                    .map(DebugSymbol.fromAddress)<font></font>
                    .join(<span class="hljs-string">'\n'</span>)<font></font>
            );<font></font>
        },<font></font>
<font></font>
        <span class="hljs-attr">onLeave</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">r</span>) </span>{
            <span class="hljs-comment">// , ,  </span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">this</span>.log.push(<span class="hljs-string">'RET: '</span> + <span class="hljs-keyword">new</span> ObjC.Object(r).toString());<font></font>
            } <span class="hljs-keyword">catch</span> (e) {
                <span class="hljs-keyword">this</span>.log.push(<span class="hljs-string">'RET: '</span> + r.toString());<font></font>
            }<font></font>
<font></font>
            <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.log.join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span>);<font></font>
        }<font></font>
    });<font></font>
}</code></pre><br>
<p>     :</p><br>
<pre><code class="javascript hljs">addTracer(<span class="hljs-string">"IGDirectThreadViewController"</span>, <span class="hljs-string">"- inputView:didTapStickerButton:"</span>);</code></pre><br>
<p>   ,     (  Frida-   ,   USB):</p><br>
<pre><code class="bash hljs">$ frida -U -n Instagram -l &lt;/path/to/script&gt; --no-pause</code></pre><br>
<p>     direct          (      ).    :</p><br>
<pre><code class="plaintext hljs">(0x1269aea00,inputView:didTapStickerButton:) IGDirectThreadViewController - inputView:didTapStickerButton:<font></font>
inputView: &lt;IGDirectComposer: 0x125d241b0; frame = (0 607; 375 60); text = ''; autoresize = H; layer = &lt;CALayer: 0x281ef5fc0&gt;&gt;<font></font>
didTapStickerButton: &lt;IGDirectComposerButton: 0x127a5e210; baseClass = UIButton; frame = (319 10; 24 24); opaque = NO; tintColor = &lt;UIDynamicProviderColor: 0x281e29dc0; provider = &lt;__NSMallocBlock__: 0x2810cfdb0&gt;&gt;; layer = &lt;CALayer: 0x281e37900&gt;&gt;<font></font>
0x1072df1dc InstagramAppCoreFramework!IGHandleURLForIGInstagramToast<font></font>
0x18743bab0 UIKitCore!-[UIApplication sendAction:to:from:forEvent:]<font></font>
0x186e738ac UIKitCore!-[UIControl sendAction:to:forEvent:]<font></font>
0x186e73c10 UIKitCore!-[UIControl _sendActionsForEvents:withEvent:]<font></font>
0x186e72c2c UIKitCore!-[UIControl touchesEnded:withEvent:]<font></font>
0x1019378ac FBSharedFramework!IGCrashReportProcessorLatestUploadError<font></font>
0x187475288 UIKitCore!-[UIWindow _sendTouchesForEvent:]<font></font>
0x1874765c8 UIKitCore!-[UIWindow sendEvent:]<font></font>
0x187452b78 UIKitCore!-[UIApplication sendEvent:]<font></font>
0x1012e0784 FBSharedFramework!IGALLoggerSetTrackingNodeForView<font></font>
0x1874caef8 UIKitCore!__dispatchPreprocessedEventFromEventQueue<font></font>
0x1874cd454 UIKitCore!__handleEventQueueInternal<font></font>
0x1874c62c8 UIKitCore!__handleHIDEventFetcherDrain<font></font>
0x18334f7c4 CoreFoundation!__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__<font></font>
0x18334f71c CoreFoundation!__CFRunLoopDoSource0<font></font>
0x18334eeb4 CoreFoundation!__CFRunLoopDoSources0<font></font>
RET: nil</code></pre><br>
<h3 id="poisk-i-analiz-direct-chata">   direct </h3><br>
<p> ,        Instagram.        .</p><br>
<p> <code>Instagram</code>  direct  (  ,   )   <code>IGDirectThread</code> ( "<em>direct </em>", "<em>direct thread</em>", "<em></em>"       ).</p><br>
<p><img src="https://habrastorage.org/webt/0t/9x/ga/0t9xgamt77ml2wgmceu5nxosqwg.png"></p><br>
<p>     ,    ,   direct thread ‚Äî <code>_threadId</code>.       ID.      .      ,       ,   direct ,  .</p><br>
<p>    <code>_metadata</code>.        ( <code>_users</code>),    direct thread.</p><br>
<p>     <code>IGUser</code>.   ,       .    <code>_pk</code>,     .  <code>_pk</code>    , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></p><br>
<p>,  UI  <code>IGDirectThread</code>, ‚Äî <code>IGDirectThreadViewController</code>     ,        ,    .         ‚Äî  ,   .</p><br>
<p>  ,   direct       <code>IGDirectThreadViewController</code>.     ,    .     <code>-[IGDirectThreadViewController initWithUserSession:thread:entryPoint:perfComponents:]</code>.      Frida-hook   ,   ,       .   ,             <code>IGDirectThreadViewController</code>:</p><br>
<p><img src="https://habrastorage.org/webt/jw/e9/sg/jwe9sgoicawma5shtusovgs8jai.png"></p><br>
<p>          <code>IGDirectThread</code>.    , <code>IGDirectThread</code> ,  ,  direct   ,         .</p><br>
<h3 id="podmena-direct-chata"> direct </h3><br>
<p> ,     ,   :     <code>origUser</code>,    <code>IGDirectThread</code>  ,    <code>replUser</code>.         <code>Instagram</code> ,   <code>origUser</code>  <code>replUser</code> .    .    ‚Äî  <code>_pk</code> ,  <code>IGDirectThread</code>,    <code>_users</code> (   <code>_metadata</code>)    <code>_pk</code>.   ‚Äî    hook  <code>_threadId</code>    (,    ),    direct thread   ID.</p><br>
<p>     ,         direct thread ‚Äî      <code>IGDirectThread</code>  ,     direct   ,    (    <code>_users</code>):</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> IGDirectThreadViewControllerInitWithUserSession = ObjC.classes.IGDirectThreadViewController[<span class="hljs-string">"- initWithUserSession:thread:entryPoint:perfComponents:"</span>].implementation;<font></font>
<font></font>
Interceptor.attach(IGDirectThreadViewControllerInitWithUserSession, {<font></font>
    <span class="hljs-attr">onEnter</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
        <span class="hljs-keyword">this</span>.thread = <span class="hljs-keyword">new</span> ObjC.Object(args[<span class="hljs-number">3</span>]);<font></font>
<font></font>
        <span class="hljs-comment">/**
         * origUser  replUser -  ,   
         *    
         *
         *    direct thread    
         *   (origUser  replUser), 
         *    
        */</span>
        [origUser, replUser].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">user</span>) </span>{
            <span class="hljs-keyword">var</span> users = <span class="hljs-keyword">this</span>.thread.$ivars[<span class="hljs-string">"_metadata"</span>].$ivars[<span class="hljs-string">"_users"</span>];
            <span class="hljs-keyword">if</span> (users.count() == <span class="hljs-number">1</span> &amp;&amp; users.objectAtIndex_(<span class="hljs-number">0</span>).$ivars[<span class="hljs-string">"_pk"</span>] == user.pk &amp;&amp; user.thread == <span class="hljs-literal">undefined</span>) {<font></font>
                user.thread = <span class="hljs-keyword">this</span>.thread.retain();<font></font>
            }<font></font>
        }, <span class="hljs-keyword">this</span>);<font></font>
<font></font>
        <span class="hljs-comment">/**
         *       threadId  , 
         *   
         */</span>
        <span class="hljs-keyword">if</span> (origUser.threadId == <span class="hljs-literal">undefined</span> || replUser.threadId == <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">return</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">/* ,   thread  `origUser` */</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.thread.$ivars[<span class="hljs-string">"_threadId"</span>].equals(origUser.threadId)) {<font></font>
<font></font>
            <span class="hljs-comment">/**
             *  ,    IGDirectThread  ,
             *   `replUser`
            */</span>
            args[<span class="hljs-number">3</span>] = replUser.thread.retain();<font></font>
<font></font>
            <span class="hljs-comment">/**
             *      ,   
             *  
            */</span>
            replaceState = <span class="hljs-literal">true</span>;<font></font>
<font></font>
            <span class="hljs-built_in">console</span>.log(<font></font>
                FgGreen + <span class="hljs-string">"[+]"</span> + Reset +
                <span class="hljs-string">" Thread "</span> +<font></font>
                origUser.threadId +<font></font>
                <span class="hljs-string">" spoofed with "</span> +<font></font>
                replUser.threadId +<font></font>
                <span class="hljs-string">"!"</span><font></font>
            );<font></font>
        }<font></font>
    }<font></font>
});</code></pre><br>
<p>  Frida- (    ,  )   direct   <code>origUser</code>,     <code>replUser</code>!    ,   .         .</p><br>
<h3 id="izmenyaem-verhniy-bar">  </h3><br>
<p>   <code>IGDirectThreadViewController</code>  runtime,     ‚Äî <code>_viewModel</code>.    ?     <code>IGDirectThreadViewControllerViewModel</code>,     <code>_leftAlignedTitleViewModel</code> ,   <code>_leftAlignedTitleViewModel-&gt;_titleButton-&gt;_titleView-&gt;text</code>,    ,    (..  ,    direct ).  ,   <code>_viewModel</code>,   <code>origUser</code> (  ),         direct   <code>origUser</code> (,     )?</p><br>
<p>  ,   .        <code>origUser</code> ‚Äî ,    .      <code>replUser</code>         <code>replUser</code>.  ,     ‚Äî  <code>-[IGDirectViewController _updateThreadNavigationBar]</code>.        .    direct   <code>origUser</code>    <code>replUser</code>,     <code>origUser</code>,        .</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> IGDirectThreadViewControllerUpdateNavigationBar = ObjC.classes.IGDirectThreadViewController[<span class="hljs-string">"- _updateThreadNavigationBar"</span>].implementation;<font></font>
<font></font>
Interceptor.attach(IGDirectThreadViewControllerUpdateNavigationBar, {<font></font>
    <span class="hljs-attr">onLeave</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">retval</span>) </span>{
        <span class="hljs-comment">/**
         *        ,   
         *    replUser,   viewModel.  
         * ,     ,    direct 
         *  origUser    direct  replUser.
        */</span>
        <span class="hljs-keyword">if</span> (replaceState &amp;&amp; <span class="hljs-keyword">this</span>.controller.$ivars[<span class="hljs-string">"_threadId"</span>].equals(replUser.threadId)) {
            <span class="hljs-keyword">this</span>.controller.$ivars[<span class="hljs-string">"_viewModel"</span>] = origUser.viewModel.retain();<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (DEBUG) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"IGDirectThreadViewController[onLeave]: -_updateNavigationBar"</span>);<font></font>
    }<font></font>
});</code></pre><br>
<p>   .</p><br>
<h3 id="zamena-avatarki"> </h3><br>
<p>    ‚Äî    <code>IGUser</code>     <code>_profilePicURL</code>.    direct   <code>origUser</code>    <code>replUser</code>  <code>origUser</code>,        .      ,      .</p><br>
<p>         .</p><br>
<h3 id="nebolshie-problemy"> </h3><br>
<p>    ,          .      production-ready ,    ,    ,   .</p><br>
<p>    350   JavaScript     .     , ,   ‚Äî       ;)</p><br>
<h2 id="vzglyad-v-buduschee">  </h2><br>
<p>   ,  ,        (AR),              .</p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/gram.com/p/B8dxT5VBQ2Z/embed/captioned/?cr=1&amp;v=12&amp;wp=658&amp;rd=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h2 id="zaklyuchenie"></h2><br>
<p>       -                ‚Äî     ;)</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@d1g1</a>       ! :)</p><br>
<p><em>P.S.   </em></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id489080/index.html">Perkuat tim tangkas Anda menggunakan tahapan perkembangan Tacman</a></li>
<li><a href="../id489082/index.html">Jaringan saraf dalam perdagangan. Mengubur lebih awal</a></li>
<li><a href="../id489086/index.html">RabbitMQ. Bagian 2. Memahami Pertukaran</a></li>
<li><a href="../id489092/index.html">Bagaimana saya secara mandiri belajar bahasa baru dalam 12 bulan: panduan total</a></li>
<li><a href="../id489100/index.html">Analisis Data Koronavirus SARS-CoV-2 (2019-nCov)</a></li>
<li><a href="../id489106/index.html">Bagaimana saya keluar dari jurnalisme dan menjadi seorang programmer</a></li>
<li><a href="../id489108/index.html">Menambahkan Bidang Anda ke Laporan Pytest</a></li>
<li><a href="../id489118/index.html">Rekayasa terbalik dari rendering The Witcher 3: berbagai efek langit</a></li>
<li><a href="../id489122/index.html">Kueri OData yang diketik dalam TypeScript</a></li>
<li><a href="../id489128/index.html">Internasionalisasi: cara membawa produk ke pasar internasional (dan tidak menjadi gila)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>