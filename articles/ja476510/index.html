<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🔬 🐽 👨🏽‍⚖️ 馬は少し動きます。チェスビットボード 〰️ 👨🏾‍🤝‍👨🏽 🕕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは。この記事は、特に開発者向け OTUS アルゴリズムコースの学生向けに書いたもので、今日は私たちのブログの読者全員と共有したいと思います。
 
 チェスの馬がチェス盤の上に立って、考え込むようにチェス盤を覗きます。
 彼はいくつの異なる動きをすることができますか？
 
 
 
 チェスの発...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>馬は少し動きます。チェスビットボード</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/476510/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは。この記事は、特に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発者向け</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OTUS </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">アルゴリズム</font></a><font style="vertical-align: inherit;">コースの</font><font style="vertical-align: inherit;">学生向けに書いたもので</font><font style="vertical-align: inherit;">、今日は私たちのブログの読者全員と共有したいと思います。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
チェスの馬がチェス盤の上に立って、考え込むようにチェス盤を覗きます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はいくつの異なる動きをすることができますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/my/zy/utmyzy0_mqkvyn_pusxx5lfrzty.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェスの発明者に賞賛し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ボードには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64個の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セル</font><font style="vertical-align: inherit;">があります</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンピューターアーキテクトに賞賛</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ulong</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプに</font><font style="vertical-align: inherit;">も</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットがあります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この偶然は起こらなければなりませんでした！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
素晴らしいアイデアは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ボード全体</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの整数</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">保存することを提案します</font><font style="vertical-align: inherit;">。 -この解決のための特別な用語でもあります</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットボード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ビットボード。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは</font><font style="vertical-align: inherit;">、このアイデアを使用してチェスの騎士の移動数</font><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すばやく</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つける</font><font style="vertical-align: inherit;">方法は</font><font style="vertical-align: inherit;">？</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与えられた：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">knightNr-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">馬がいるボードのセル番号（0から63）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要です：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moveCount-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移動できるフィールドの数（2から8）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アルゴリズム。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
馬における細胞の1.Konvertirovat数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ULONGは、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボードのビットの値である</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">knightNr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">knightBits</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
すべての可能な移動馬のための2インストールビット</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">knightBits</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - &gt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movesBits</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
単一ビットの3.Podschitat番号</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movesBits</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - &gt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Movescountは、</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/v3/dj/of/v3djofmx_uekyv7kgyov6-omae0.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
最初のステップは非常に簡単であり、あなたが左にゼロビットシフトする必要が指定された数のポジション。</font></font><br>
<br>
<pre><code class="cpp hljs">	ulong knightBits = <span class="hljs-number">1</span> &lt;&lt; knightNr;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のステップはもう少し複雑です。</font><font style="vertical-align: inherit;">馬は8つの異なる方向に進むことができます。</font><font style="vertical-align: inherit;">これらのオフセットは「水平/垂直」ではなく、ビット位置で考慮します。</font><font style="vertical-align: inherit;">つまり、各移動の開始ビットをシフトするために必要なポジションの数を考慮します。</font><font style="vertical-align: inherit;">次に、論理的な「or」演算ですべてを「加算」します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボードの左側から右側への動きのリストを始めましょう：</font></font><br>
<br>
<pre><code class="cpp hljs">  movesBits = knightBits &lt;&lt;  <span class="hljs-number">6</span> | knightBits &gt;&gt; <span class="hljs-number">10</span> <span class="hljs-comment">//  b5  b3</span>
            | knightBits &lt;&lt; <span class="hljs-number">15</span> | knightBits &gt;&gt; <span class="hljs-number">17</span> <span class="hljs-comment">//  c6  c2</span>
            | knightBits &lt;&lt; <span class="hljs-number">17</span> | knightBits &gt;&gt; <span class="hljs-number">15</span> <span class="hljs-comment">//  e6  e2</span>
            | knightBits &lt;&lt; <span class="hljs-number">10</span> | knightBits &gt;&gt;  <span class="hljs-number">6</span> <span class="hljs-comment">//  f5  f3; </span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほんと、かっこいい！？ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、ボードの端には「ブラックホール」があります。たとえば、このアルゴリズムによれば、セルa4（ビット＃24）からセルg2（ビット＃14 = 24-10）に到達できます。このジャンプは</font><i><font style="vertical-align: inherit;">、</font></i><i><s><font style="vertical-align: inherit;">ブラックホールの</font></s></i><i><font style="vertical-align: inherit;">極端な垂直方向を</font></i><i><font style="vertical-align: inherit;">通過するボード上の</font></i><i><s><font style="vertical-align: inherit;">真空</font></s></i><i><font style="vertical-align: inherit;">で</font></i><i><s><font style="vertical-align: inherit;">球形の</font></s></i><i><font style="vertical-align: inherit;">チェス馬の</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テレポーテーション</font></font><s><font style="vertical-align: inherit;"></font></s><font style="vertical-align: inherit;"></font><s><font style="vertical-align: inherit;"></font></s><font style="vertical-align: inherit;"></font><s><font style="vertical-align: inherit;"></font></s><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
馬の量子ジャンプを除外するにはボードの端では、移動後に極端なストライプを「切断」する必要があります。たとえば、+ 6と-10（左側に2つのセル）の移動の場合、gとhの垂直方向で取得した値をキャンセルする必要があります。2つの移動で「左」に移動した後、これらの垂直方向で終了することはできないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、4ビットのグリッド定数が必要です。指定された垂直方向を除いて、すべてのビットが1に設定されています。つまり：</font></font><br>
<br>
<pre><code class="cpp hljs">        ulong nA  = <span class="hljs-number">0xFeFeFeFeFeFeFeFe</span>;<font></font>
        ulong nAB = <span class="hljs-number">0xFcFcFcFcFcFcFcFc</span>;<font></font>
        ulong  nH = <span class="hljs-number">0x7f7f7f7f7f7f7f7f</span>;<font></font>
        ulong nGH = <span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェス盤の上下には、馬を完全に吸収する「ブラックホール」もあるので、個別にチェックする必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
許容される馬の動きを生成するアルゴリズムは次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">   movesBits = nGH &amp; (knightBits &lt;&lt;  <span class="hljs-number">6</span> | knightBits &gt;&gt; <span class="hljs-number">10</span>)<font></font>
             |  nH &amp; (knightBits &lt;&lt; <span class="hljs-number">15</span> | knightBits &gt;&gt; <span class="hljs-number">17</span>)<font></font>
             | nA  &amp; (knightBits &lt;&lt; <span class="hljs-number">17</span> | knightBits &gt;&gt; <span class="hljs-number">15</span>)<font></font>
             | nAB &amp; (knightBits &lt;&lt; <span class="hljs-number">10</span> | knightBits &gt;&gt;  <span class="hljs-number">6</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に（！）高速に動作します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの目盛り-可能なすべての馬の冒険のビットマップがあります。</font><font style="vertical-align: inherit;">最も驚くべきことは、ボード上に複数の馬がいても、このアルゴリズムがうまく機能することです。</font><font style="vertical-align: inherit;">彼はすぐにすべての馬のすべての可能な動きを生成します！</font><font style="vertical-align: inherit;">本当、すごい！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビット数を数えるために残っています</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も簡単な方法</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、数値を1ビット右にシフトして1を数えることです。</font><font style="vertical-align: inherit;">難易度-64操作。</font><font style="vertical-align: inherit;">メモリ-64ビット。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も速い方法</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、各インデックスのビット数が0から65535まで書き込まれる65536要素のキャッシュ/配列を作成することです。そして、この配列から、その数の次の16ビットセグメントに対応する4つの要素を追加します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
難易度-4つの操作。</font><font style="vertical-align: inherit;">メモリ-64キロバイト。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複雑</font><b><font style="vertical-align: inherit;">な方法</font></b><font style="vertical-align: inherit;">を検討し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。その複雑さは、数の単一ビットの数と同じです。</font><font style="vertical-align: inherit;">多くの動きがないので、このアプローチは私たちにとって最も最適です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、数値から単位を引くと、すべての「正しい」ゼロが単位になり、最も外側の単位がゼロになることに注意してください。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-number">1001010100010000</span> - <span class="hljs-number">1</span> =
<span class="hljs-number">1001010100001111</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、これらの数値に論理演算子と演算を適用します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-number">1001010100010000</span> &amp;
<span class="hljs-number">1001010100001111</span> =
<span class="hljs-number">1001010100000000</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、このようにトリッキーな方法で、右端のユニットをゼロにリセットします。</font><font style="vertical-align: inherit;">結果としてゼロになるまでこの操作を繰り返します。</font><font style="vertical-align: inherit;">反復回数、つまり単一ビット数。</font><font style="vertical-align: inherit;">本当、すごい！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはこのアルゴリズムが完全に書かれている方法です：</font></font><br>
<br>
<pre><code class="cpp hljs">        <span class="hljs-keyword">int</span> movesCount = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (movesBits != <span class="hljs-number">0</span>)<font></font>
        {<font></font>
            movesBits &amp;= (movesBits - <span class="hljs-number">1</span>);<font></font>
            movesCount ++;<font></font>
        }<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題は解決された！</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このタスクには、もう1つの非常に単純で純粋な論理的解決策があります。チェス盤の端から騎士までの距離を決定することです（コーナーでは、2移動、3から6移動の端の近く、8移動の中心）。</font><font style="vertical-align: inherit;">しかし、この方法で問題を「正面から」解決しようとすると、ビットボード、垂直ビットマスク、シングルビットをすばやくカウントするためのアルゴリズム、および真空中の球形の馬のブラックホールについて</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はわかり</font><font style="vertical-align: inherit;">ません。</font><font style="vertical-align: inherit;">これ</font><font style="vertical-align: inherit;">で、</font><font style="vertical-align: inherit;">すべてについて理解できました。</font><font style="vertical-align: inherit;">チェスプログラマーの生活は、より豊かでより有意義な乾杯になりました！</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日曜大工のタスク：</font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェス王についても同じようにします。</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476490/index.html">最新のアプリケーション保護システム（WAF）の機能は、OWASPトップ10の脆弱性のリストよりもはるかに広いはずです。</a></li>
<li><a href="../ja476492/index.html">Base Unitのメモリに設定を保存する</a></li>
<li><a href="../ja476500/index.html">TopCoder Open 2019での挑戦：ケーキを6つの部分にカット</a></li>
<li><a href="../ja476502/index.html">監視システムの実装について顧客が語ったときに求めていること</a></li>
<li><a href="../ja476506/index.html">テクノテキスト、クライマックス：著者競争のフィナーレに近づく</a></li>
<li><a href="../ja476512/index.html">デジタルトランスフォーメーションで飛ばない方法</a></li>
<li><a href="../ja476514/index.html">インテルoneAPI-すべてに1つ、今-あなたにも</a></li>
<li><a href="../ja476516/index.html">「レポートに退屈する権利はない」：会議での発言についてのバルクサドグルスキーへのインタビュー</a></li>
<li><a href="../ja476518/index.html">スイスでのIT企業の登録：ステップバイステップのケース</a></li>
<li><a href="../ja476520/index.html">主はレガシーコードの領域で販売しています（オープンエンドのおとぎ話）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>