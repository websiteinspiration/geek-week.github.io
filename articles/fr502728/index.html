<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🏫 ⛰️ 🍳 Astuces intéressantes et astuces SSH 🚌 🙈 😂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quelques conseils sur l'utilisation efficace de SSH. Voyons comment:
 
 

- Utiliser l'authentification à deux facteurs pour les connexions SSH
- il e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Astuces intéressantes et astuces SSH</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502728/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques conseils sur l'utilisation efficace de SSH. </font><font style="vertical-align: inherit;">Voyons comment:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utiliser l'authentification à deux facteurs pour les connexions SSH</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est sûr d'utiliser le «transfert de clé» (transfert d'agent);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quitter une session SSH bloquée;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laissez le terminal ouvert lorsque vous quittez ou vous déconnectez;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partagez le terminal distant avec un ami (sans Zoom!).</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ib/ip/2b/ibip2baduhanlunu57eepm5ff3w.jpeg" alt="image"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authentification multifacteur SSH</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe cinq façons d'ajouter un deuxième facteur d'authentification dans SSH:</font></font><br>
<br>
<ol>
<li> <b> OpenSSH</b>     ( ). <br>
<br>
  2020   OpenSSH    FIDO U2F (Universal Second Factor).    ,   .<br>
<br>
          ,             8.2   .       <b><code>ssh -V</code></b>,      <b><code>nc [servername] 22</code></b>.<br>
<br>
       — <b><code>ecdsa-sk</code></b>  <b><code>ed25519-sk</code></b> (   ).             <b><code>$ ssh-keygen -t ecdsa-sk -f ~/.ssh/id_ecdsa_sk</code></b>.       ,    U2F .    U2F       ,   .<br>
<br>
          . OpenSSH        -sk-«» .        U2F .  ,       .      <b><code>$ ssh-keygen -t ecdsa-sk -O resident -f ~/.ssh/id_ecdsa_sk</code></b>.       ,        <b><code> $ ssh-add -K</code></b>.       .</li>
<li> <b> PIV+PKCS11  Yubikey.</b>      ,      SSH-,      .  Yubikey  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> U2F+SSH with PIV/PKCS11</a>.     ,     FIDO U2F.   ,  .</li>
<li> <b> ssh- <code>yubikey-agent.</code></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Filippo Valsorda</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">SSH-  Yubikeys</a>.         .</li>
<li> <b> Touch ID  <code>sekey</code>.</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Sekey</a> —  SSH-    ,       secure enclave  MacOS       Touch ID.</li>
<li> <b> Single Sign On SSH.</b>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a>  .  Single Sign On SSH   ,          ,    .</li>
</ol><br>
<br>
<h2>    (agent forwarding)</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le transfert d'une clé dans SSH permet à l'hôte distant d'accéder à votre agent SSH local. Lorsque votre client SSH utilise le transfert de clé (généralement activé par l'option </font></font><b><code>ssh -A</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), il y a 2 canaux dans la connexion - votre session interactive et le canal de transfert de clé. L'agent SSH local crée un socket IPC qui se connecte à l'hôte distant via ce canal. C'est dangereux car Un utilisateur disposant de privilèges root sur un hôte distant a accès à votre agent SSH local et peut potentiellement l'utiliser pour accéder aux ressources réseau en votre nom. Avec l'agent SSH standard fourni avec OpenSSH, vous ne savez jamais ce qui s'est passé. Mais si vous utilisez une clé U2F (ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekey</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), vous pouvez arrêter toute tentative d'utilisation de votre agent SSH.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même avec cette limitation, l'utilisation périodique du transfert de clé est parfaitement acceptable. </font><font style="vertical-align: inherit;">N'utilisez pas cette méthode pour toutes vos connexions. </font><font style="vertical-align: inherit;">Utilisez uniquement si vous êtes sûr de son besoin dans des situations spécifiques.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quitter une session SSH suspendue</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les sessions SSH se bloquent souvent en raison de pannes de réseau, d'une perte de contrôle par un programme exécutable ou l'une des séquences de contrôle de terminal qui bloquent l'entrée au clavier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques façons de sortir d'une session bloquée:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sortie automatique en cas de rupture du réseau. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans votre configuration SSH, </font></font><code><b>.ssh/config</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous devez ajouter: il </font><font style="vertical-align: inherit;">vérifiera la connexion en envoyant des requêtes d'écho à l'hôte distant toutes les </font><font style="vertical-align: inherit;">secondes. </font><font style="vertical-align: inherit;">Si plus de </font><font style="vertical-align: inherit;">ces demandes restent sans réponse, SSH fermera la connexion.</font></font><br>
<br>
<code><b>ServerAliveInterval 5<br>
ServerAliveCountMax 1<br>
</b></code><br>
<br>
<code><b>ssh</b></code><font style="vertical-align: inherit;"></font><code><b>ServerAliveInterval</b></code><font style="vertical-align: inherit;"></font><code><b>ServerAliveCountMax</b></code><font style="vertical-align: inherit;"></font></li>
<li><b> .</b> <code><b>ssh</b></code>   <code><b>~</b></code>     .  <code><b>~.</b></code>        (       ).<br>
<br>
 <code><b>~?</b></code>   ,      .       ,      <code><b>~</b></code> ,    .</li>
</ol><br>
<b>  ?</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand Internet a été inventé, les ordinateurs n'étaient pas particulièrement mobiles. Lorsque vous travaillez sur un ordinateur portable et basculez entre les réseaux WiFi IPv4, votre adresse IP change. Étant donné que SSH est basé sur une connexion TCP et que les connexions TCP dépendent de points de connexion avec des adresses IP fixes, chaque fois que vous vous connectez à un autre réseau, votre connexion SSH est perdue. Lorsque votre adresse IP change, il faut un certain temps avant que la pile réseau détecte que la connexion est perdue. Une connexion TCP n'implique pas un arrêt rapide de l'une des parties en cas de problèmes de réseau, elle essaiera donc de réessayer d'envoyer les données pendant un certain temps. Dans votre terminal, la session sera bloquée. IPv6 ajoute des fonctionnalités qui permettent aux appareils de conserver leur adresse IP lors de la commutation entre les réseaux.Donc, un jour, cela cessera d'être un problème.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment laisser un terminal ouvert sur un hôte distant</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe deux options pour enregistrer une session lorsque vous basculez entre les réseaux ou souhaitez vous déconnecter pendant un certain temps:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eternal Terminal</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si vous avez vraiment besoin d'une connexion qui </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne plante pas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , même si vous changez de réseau, utilisez le shell Mosh - mobile. </font><font style="vertical-align: inherit;">Mosh est un shell sécurisé qui utilise SSH pour initialiser une session (prise de contact), après quoi il bascule sur son propre canal crypté. </font><font style="vertical-align: inherit;">Ce canal est très stable. </font><font style="vertical-align: inherit;">Il peut gérer diverses situations, notamment les déconnexions d'Internet, la modification de l'adresse IP de votre ordinateur portable, les retards importants lors de la transmission sur le réseau, etc. </font><font style="vertical-align: inherit;">Grâce à la magie d'UDP et au protocole de synchronisation utilisé par Mosh.</font></font><br>
<br>
  Mosh       ,          60000–61000   UDP     .     mosh user@server  .<br>
<br>
Mosh        ,          SSH,      -    .          ,        . SSH        ,  ,  Mosh             .</li>
<li><b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">tmux</a>.</b>      ,           ,    tmux.   SSH- ,      <code><b>tmux attach</b></code>,     <code><b>tmux</b></code>.        —    ,      macOS       .<br>
<br>
  tmux   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Byobu</a> — ,        . Byobu    Ubuntu      macOS    Homebrew.</li>
</ol><br>
<br>
<h2>     </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous résolvez un problème complexe avec des serveurs, je voudrais partager une session SSH avec quelqu'un d'autre qui se trouve dans un autre endroit. </font><font style="vertical-align: inherit;">tmux est le meilleur outil de terminal de partage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez donc procéder comme suit:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assurez-vous qu'il est </font></font><code><b>tmux</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installé sur votre serveur dans DMZ (ou à l'endroit où vous souhaitez vous connecter).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez tous les deux vous connecter au serveur via SSH en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisant le même compte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'un de vous doit exécuter </font></font><code><b>tmux</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour créer une </font></font><code><b>tmux</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre doit exécuter la commande </font></font><code><b>tmux attach</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voila! </font><font style="vertical-align: inherit;">Vous avez partagé le terminal.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez besoin d'un réglage plus fin des sessions multi-utilisateurs, utilisez tmate, ce fork </font></font><code><b>tmux</b></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui vous permet de rendre les sessions partagées encore plus faciles. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traduit par Andrey Zinchenko, chef du département Rexoft Analytics</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502716/index.html">Vous ne pouvez pas partager votre ordinateur personnel? Faites un sur deux</a></li>
<li><a href="../fr502718/index.html">Le projet Talking Head, ou l'histoire du développement de logiciels pour un robot de téléprésence</a></li>
<li><a href="../fr502720/index.html">Tendances des tests à examiner en 2020</a></li>
<li><a href="../fr502722/index.html">Silicon Valley en russe. Comment fonctionne # ITX5 à Innopolis</a></li>
<li><a href="../fr502726/index.html">WebRTC Faire une application avec blackjack et appels vidéo</a></li>
<li><a href="../fr502730/index.html">Que savent les designers industriels des appareils que vous utilisez quotidiennement. Ou 50 ans de transformation d'une souris d'ordinateur</a></li>
<li><a href="../fr502732/index.html">Livre «Comment tester sur Google» - version électronique gratuite</a></li>
<li><a href="../fr502734/index.html">Ack better grep</a></li>
<li><a href="../fr502740/index.html">Comment désinfecter les avions à l'ère de Covid-19?</a></li>
<li><a href="../fr502742/index.html">Nous vous invitons à DINS DevOps EVENING (en ligne): l'évolution de Prometheus et Zabbix et le traitement des logs Nginx dans ClickHouse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>