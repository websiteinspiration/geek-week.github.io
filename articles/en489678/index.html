<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÜüèº üë®üèº‚Äç‚úàÔ∏è üê´ Indestructible memory, indestructible processes üëçüèª üëç üíê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having read recently ( 1 , 2 , 3 ) with what difficulty ‚Äúspace‚Äù processors are given, I involuntarily wondered if the ‚Äúprice‚Äù for stable iron is so hi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Indestructible memory, indestructible processes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489678/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fb/yl/uv/fbyluvlcmc7ubmta2h4tr4ppz74.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having read recently ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) with what difficulty ‚Äúspace‚Äù processors are given, I involuntarily wondered if the ‚Äúprice‚Äù for stable iron is so high, maybe it‚Äôs worth taking a step and, on the other hand, making ‚Äúsoftware‚Äù resistant to special factors? </font><font style="vertical-align: inherit;">But not application software, but rather its execution environment: compiler, OS. </font><font style="vertical-align: inherit;">Is it possible to make the execution of the program at any time possible to interrupt, reboot the system and continue from the same (or almost the same) place. </font><font style="vertical-align: inherit;">In the end, there is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hibernation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Radiation effects</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Almost everything that flies from space is capable of disrupting the operation of the microcircuit, it is only a matter of the amount of energy that ‚Äúit‚Äù brought with it. Even a photon, if it has a gamma-ray wavelength, is able to overcome several centimeters of aluminum and ionize the atom (s) or even cause a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuclear photoelectric effect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . An electron cannot penetrate through any dense obstacle, but if it is accelerated more strongly, it will emit a gamma quantum when braking with all the ensuing consequences. Given that the half-life of a free neutron is about 10 minutes, a rare (and very fast) neutron reaches us from the Sun. But the nuclei of anything fly by and are also capable of doing things. The neutrinos are perhaps not seen in anything like that.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How can one not recall Piglet with him: ‚Äúit is difficult to be brave when you are just a Very Small Being.‚Äù </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The consequences of cosmic radiation entering a semiconductor can be different. </font><font style="vertical-align: inherit;">This is the ionization of atoms and the violation of the crystal lattice and nuclear reactions. </font><font style="vertical-align: inherit;">This is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> silicon doping with </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thermal</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> neutrons in an atomic reactor </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">is</font></a><font style="vertical-align: inherit;"> described </font><font style="vertical-align: inherit;">, when Si (30) turns into P (31), and the desired semiconductor properties are achieved. </font><font style="vertical-align: inherit;">It‚Äôs not worth retelling the wonderful articles mentioned, we‚Äôll only note the following -</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some effects have a short-term effect and do not have long-term effects. </font><font style="vertical-align: inherit;">They can lead to errors that can be fixed either hardware or software. </font><font style="vertical-align: inherit;">In the worst case, a reboot helps.</font></font></li>
<li>     ,     .        -  .</li>
<li>            .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that effects of types 2 and 3, if they were able to be stopped, lead to gradual degradation of the microcircuit. For example, if </font><font style="vertical-align: inherit;">one of the (even 4) adders ‚Äúburned out‚Äù </font><font style="vertical-align: inherit;">in the </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">superscalar</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> processor, you can (at least speculatively not difficult) physically disable the power to the victim and use the remaining three, outwardly only a drop in performance will be noticeable. Similarly, if one of the internal pool registers is damaged, it may be marked as ‚Äúalways busy‚Äù and will not be able to participate in the planning of operations. The memory unit may become unavailable. ... But if something irreparable has deteriorated, you will have to raise the cold reserve. If he is.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúStaying in a cold reserve, by the way, does not protect the microcircuit from the accumulation of the dose, and even from the accumulation of charge in the gate insulator. </font><font style="vertical-align: inherit;">Moreover, microcircuits are known in which dose degradation without power supply is even worse than with it. </font><font style="vertical-align: inherit;">But all the single effects that cause hard failures require the inclusion of the chip. </font><font style="vertical-align: inherit;">With the power off, there may be bias effects, but they are not important for digital logic. ‚Äù </font><font style="vertical-align: inherit;">(</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amartology</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, there are two factors</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at any time, a failure may occur, which is treated by a reboot</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the system will gradually degrade (sequence of failures), most of the work will occur in conditions of partial degradation</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How do you live with all this? Due to reservation / tripling with voting throughout the hierarchy of functional blocks. In itself, tripling is not a panacea, it is necessary in order to understand which of the results is correct when one of the components fails. Then the failed component can be restarted and brought into line with two workers. But in the event of a failure, when the component cannot be brought into working condition, only cold reserve, if any, will help.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even if the failure does not look critical, it can cause serious problems. Suppose we have three synchronously working computers, in one of them (hypothetical, mentioned above) one of the adders failed. This is not a problem from the point of view of a computer that has remained operational, but it is a problem for the entire system since the affected computer will begin to be systematically late and serious efforts will be required for overall synchronization.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another example, a memory failure, as a result of which some of its range (even one page) has become unusable, is not critical from the point of view of a single computer. After diagnosis, the operating system is able to cope with this problem without using this range. But from the point of view of the trojan system, this is a disaster. Now, if there is a failure (which is treated by rebooting), we will need to bring the failed computer to a state identical to any of the remaining ones, but this is impossible because on other computers, this range is working and probably used. In principle, it is possible to prohibit this range on all three computers, however, it is not obvious that it will be possible to do this without restarting all computers in turn.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is a paradoxical situation when a system that is trojaned at the upper level is less reliable compared to a single computer that can adapt to gradual degradation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is worth mentioning the approach called </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lock-step</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , when two cores perform the same task with a shift of one or two clock cycles, and after that the results are compared. </font><font style="vertical-align: inherit;">If they are not equal, some piece of code is re-executed. </font><font style="vertical-align: inherit;">This does not work if there is an error in the memory or the general cache, however, it has its own protection. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is also an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">approach</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> where the compiler repeats the execution of part of the commands and compares the results. </font><font style="vertical-align: inherit;">Such a soft version of Lock-step. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Both of these approaches (thanks</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amartology</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">per tip) - an attempt to detect a failure and try to fix it with "little blood", without rebooting. </font><font style="vertical-align: inherit;">We will more likely consider the situation when a serious failure or non-critical failure occurs and a reboot is inevitable. </font><font style="vertical-align: inherit;">How to make sure that the program without any special efforts on its part could be interrupted at any moment, and then continue without serious losses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to teach hardware and OS to adapt to gradual degradation is a topic for another discussion.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What if</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The idea of ‚Äã‚Äãa stable / persistent memory is not new in itself, so the respected Dmitry Zavalishin (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dzavalishin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) proposed his concept of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">persistent memory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In his hands, this gave rise to a whole persistent </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phantom OS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in fact a virtual machine with corresponding overhead. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps, over time, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MRAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FRAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> technologies will mature </font><font style="vertical-align: inherit;">... while they are raw. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is also a legend about the on-board computer of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R-36M</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rocket </font><font style="vertical-align: inherit;">(15L579?), Which was able to launch through a radioactive cloud immediately after a close nuclear explosion. Applied memory on ferrite cores is immune to radiation. The recording cycle of such a memory is of the order of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">units of microseconds</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, so during the time that the rocket flies a few decimeters, there was a physical opportunity to maintain the context of the processor - the contents of registers and flags. </font><font style="vertical-align: inherit;">Waking up in a safe environment, the processor continued to work. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sounds believable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are some buts:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernation in its current form is not suitable. </font><font style="vertical-align: inherit;">It takes some effort and time. </font><font style="vertical-align: inherit;">We are trying to protect ourselves from a sudden failure. </font><font style="vertical-align: inherit;">It is not obvious that after this failure the processor is physically able to do at least something. </font><font style="vertical-align: inherit;">Similarly, in 15L579, the system receives a warning before the troubles begin and has time to protect against them.</font></font></li>
<li> ‚Äú‚Äù      ‚Äî    ,    ,    ‚Äî   .      ,    ()   ,    .</li>
<li>     ,   ,     .        ‚Äî   -.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, crash recovery is essentially a counterpart to exception handling. </font><font style="vertical-align: inherit;">Actually, the failure itself in most cases begins as a hardware interrupt. </font><font style="vertical-align: inherit;">The difference is that after the exception, we just can continue to work, and in this case we first need to restore the working context - the memory and state of the kernel of the operating system. </font><font style="vertical-align: inherit;">But the final part looks the same. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, how it should look from the side of the application programmer.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A look from outside the OS kernel</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since recovering from failures is similar to recovering from throwing an exception, then working with it may look similar. </font><font style="vertical-align: inherit;">For example, in C ++ we inherit the std :: tremendous_error class from std :: exception, catch it in a regular try / catch block and organize the processing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the author likes the semantics of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setjmp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">longjmp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (SJLJ) more because:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this is concise, just call the analog setjmp (&amp; buf) and resume work from the same place</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">even no ‚Äú&amp; buf‚Äù is required, just calling a system function that stores the current state</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">besides C ++, there are other great languages, not everywhere there is exception handling, but everywhere there is a call to system functions</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and there‚Äôs no need to modify the language, because we were originally going to act as invasively as possible</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At one time, SJLJ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lost to</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DWARF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> technique </font><font style="vertical-align: inherit;">(strictly speaking, dwarf is just an information recording format) in exception handling due to poorer performance, performance is not so important here. </font><font style="vertical-align: inherit;">In any case, maintaining the state will not be cheap; one must approach it responsibly.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A look from inside the OS kernel</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What needs to be saved, what does the context of the process execution consist of?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For each thread in user mode - the current ‚Äújmp_buf‚Äù with the necessary registers, this means that the OS must stop all threads of the calling process before saving the data</font></font></li>
<li>  ,      ‚Äî   .         (:   ),      (ex:   ).</li>
<li>      .        (ex:   ),   (ex:  TCP ).          .</li>
<li>  ,     .      ,       </li>
<li> .        ,     .   ,       ‚Äî  . ..           .<br>
<br>
 ,       ,           .           .</li>
<li>,          .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Information is not required for transcoding from virtual memory to physical and vice versa; upon restart, this information will be recreated by itself, possibly in a different way. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As for working with the file system. Among file systems, there are transactional ones. If the application requires precisely transactional behavior, the preservation of the process context should be synchronized with the confirmation of the file system transaction. On the other hand, for example, for recording text logs, it is logical to use a regular file system, transactionality here would be strange. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of all the above, the greatest questions are caused by the preservation of the contents of memory; the volume of everything else is insignificant in comparison with this. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runtime</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the library buffers memory allocations, asks them from the system in relatively large chunks, and distributes itself. </font><font style="vertical-align: inherit;">Therefore, creating / deleting segments is relatively few. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But programs work continuously with memory, in essence it is the memory subsystem that is usually the bottleneck in the calculations. </font><font style="vertical-align: inherit;">And all that can simplify our lives is hardware support for flags of modified pages. </font><font style="vertical-align: inherit;">It is expected that between the state saves, not too many modified pages appear. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on this, in the future we will deal with the contents of memory.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saving the contents of memory</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The desired behavior is close to databases - the DBMS can ‚Äúfall‚Äù at any time, but the work done will continue until the last commit. This is achieved by maintaining a transaction log, getting into which commit records will legalize all changes made to the transaction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, since the term ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transactional memory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù is busy, we will introduce another - ‚Äúindestructible memory‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Offhand you can see two methods by which this indestructible memory can be implemented. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option one</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , let's call it ‚Äúunpretentious‚Äù. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main idea is that all data changed in a transaction should be placed in RAM. Those. during operation, the swap mechanism does not save anything to disk, but during the commit, all changed pages are saved to the swap file.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Information about the selected segments and their connection with the place in the swap file is written to the log. During operation, this information is accumulated and recorded during the commit. When restarting, the system has the ability to create segments anew. The swap mechanism will be able to pull them up and the interrupted program will magically receive its data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, in this mode it is impossible, for example, to allocate a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calloc-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> th array larger than the available memory ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> th, by the way, is possible). However, this in any case would not be a very good idea.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even if such a regime applies only to processes that have declared themselves to be ‚Äúindestructible‚Äù, the amount of memory occupied by the current transactions of all such processes cannot exceed the physically available. The swap mechanism actually stops swapping and turns into a mechanism for storing recent transactions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this imposes a certain discipline on application developers, can lead to an uneven load on the disk, in general, this is not quite what we wanted, but it can work in embedded systems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A significant drawback of this option is that an fatal error during the commit, when only part of the pages were written, leads the corresponding process to an unstable state, after which it will have to be stopped. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out some kind of 50% inviolability.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option Two</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ‚ÄúShadow‚Äù </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To act as a transaction manager, you need to be a transaction manager. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's define entities:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> page </font><b><font style="vertical-align: inherit;">file</font></b><font style="vertical-align: inherit;"> contains data pages, so the size is a multiple of the size of the page. </font><font style="vertical-align: inherit;">We say the file, we mean the section rather, because </font><font style="vertical-align: inherit;">a fixed size improves system stability.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paging</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><b><font style="vertical-align: inherit;">page allocator</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It is necessary to select a page not only for user data, but also, for example, to record the state of the allocator itself. </font><font style="vertical-align: inherit;">As well as all that was mentioned above.</font></font></li>
<li><b> </b>.    ,        .     ,    , <br>
<i>(= ,  )</i>.</li>
<li><b> </b>.  ‚Äî     <br>
<ul>
<li>ID </li>
<li> </li>
<li>    ( )</li>
<li>ID     .</li>
</ul><br>
   -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">TLB</a>, ..     .<br>
<br>
          ( )     .             .            , ex:   (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Buddy Allocator</a>)       .<br>
<br>
    ,      .             .</li>
<li><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a> </b>.                  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">COW</a> (copy on write)   .    ,        .    COW,    -  ,             .           .<br>
<br>
  ‚Äî     -  ,           ‚Äú<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">dirty</a>‚Äù.             .</li>
<li>  ().              .<br>
<br>
 :           ,        .<br>
<br>
<u> </u>.    ,            .                .     ,     ,       .       .       ,      ?   ,    .<br>
<br>
        ,        .<br>
<br>
            ‚Äî <i>(=  ,  ,   ,   )</i>.<br>
<br>
       <br>
<i>(=,  )</i>.      .<br>
<br>
       .      ,     .      ,  ,      ,    .<br>
<br>
           ,      .     ,       .       .<br>
<br>
     ‚Äî             .       ,  ,         ,         ,    .<br>
    ,     ,      .<br>
<br>
        .</li>
<li><b> </b>.  ,      ,    ‚Äî           .        <u> ,        </u>?<br>
<br>
     ‚Äî             .        ,      .  ,        .         ,     ..         .<br>
<br>
  ‚Äî ,    SSD      !   ,     SSD  (       ‚Äú‚Äù )      .<br>
<br>
 ,         . <br>
<br>
   ‚Äî      .   ,     .       ,         .         (    ).<br>
<br>
   ,   ,     ,     . ,   ,    .   ,     ,   ,            .  ,    ‚Äî            .           .</li>
<li><b>Checkpoint</b>. <br>
<br>
,       ,        ,  ,    .    ‚Äî    .      ,          .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">checkpoint</a>.           .<br>
<br>
 . <u></u>.  -      checkpoint- .   .<br>
<br>
,             .            -  . <br>
<br>
    checkpoint-.               ,    /  .<br>
<br>
-,        -   /,     .       ,   ( ...).       .<br>
<br>
<u></u>.              .   .     ,        .    ‚Äî  ,      checkpoint.</li>
</ol><br>
<h4>     </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is a pity that there are no storage devices that are completely resistant to long-term operation in space conditions. Ferrite cores were resistant to radiation, but had their own specific problems due to the large number of soldered joints. Plus low capacity, low speed and high complexity of manufacturing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nevertheless, you must be able to reliably write and read this data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An obvious candidate is flash memory. Flash was not initially highly reliable due to the low number of valid write cycles, so special </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">methods</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> were developed to work with it </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was previously mentioned that tripling is used to work with unreliable elements, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">RAID1 is</font></a><font style="vertical-align: inherit;"> enough here</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">because </font><font style="vertical-align: inherit;">if the recording fails due to the control values, it is known which of the two pages was written incorrectly and must be overwritten.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, now we have in our hands all four letters of the word </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - atomicity, achieved </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - consistency, </font></font><br>
 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - isolation </font><font style="vertical-align: inherit;">is evident </font><font style="vertical-align: inherit;">, is achieved naturally. </font><font style="vertical-align: inherit;">If you do not consider the case of shared memory. </font><font style="vertical-align: inherit;">And at the moment we are not considering it. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - persistence, the only time we tried to cheat when we released the process after a commit without waiting for the physical recording of all the data in its memory to disk. </font><font style="vertical-align: inherit;">In the worst case, this will lead to a rollback to the previous transaction. </font><font style="vertical-align: inherit;">It is unclear how critical this is for both performance and durability. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Just a quick note. </font><font style="vertical-align: inherit;">We do not have a mechanism for rollback transactions, rollback can only be a fatal error. </font><font style="vertical-align: inherit;">Technically (it seems) it is easy to implement a transaction rollback program as an analogue of longjmp. </font><font style="vertical-align: inherit;">But this is a much more advanced version of longjmp since </font><font style="vertical-align: inherit;">completely restores the internal state of the process at the time of ‚Äúsetjmp‚Äù, avoiding memory leaks, allows the transition not only from the bottom up the stack ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Perhaps, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenLink Virtouso</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DBMS server </font><font style="vertical-align: inherit;">, available also as free software </font><font style="vertical-align: inherit;">, can be considered the prototype of the transaction manager </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Thanks to Valery Shunkov (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amartology</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and Anton Bondarev (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abondarev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) for a meaningful and very useful discussion. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPPPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Illustration by </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anna Rusakova</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489666/index.html">Overloading in C ++. Part II Operator Overload</a></li>
<li><a href="../en489668/index.html">CPU limits and aggressive throttling in Kubernetes</a></li>
<li><a href="../en489672/index.html">We revive the hexapod. Part two</a></li>
<li><a href="../en489674/index.html">Angular: a clear introduction to NGRX</a></li>
<li><a href="../en489676/index.html">We make a clone of the food delivery service using Nuxt.js, GraphQL, Strapi and Stripe. Part 1/7</a></li>
<li><a href="../en489682/index.html">Cross-Origin Read Blocking (CORB) in Chrome Extensions</a></li>
<li><a href="../en489684/index.html">This is the norm - 4: solving problems with normal maps</a></li>
<li><a href="../en489688/index.html">OData + RxJava + Retrofit 2 for android application</a></li>
<li><a href="../en489692/index.html">Using RabbitMQ with MonsterMQ Part 3</a></li>
<li><a href="../en489696/index.html">How bioacoustics helps explore the animal kingdom</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>