<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ»â€ğŸ« ğŸ‘¿ ğŸš“ ĞœĞ¾Ğ½Ğ°Ğ´Ñ‹ ĞºĞ°Ğº Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ° ğŸ¤– ğŸ ğŸ¥¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=", , , , ,   ( ).
 

 ,  , , , .
 

 , ?
 

 , ( ) : , T , T- â€” . , , â€” , , , , , â€¦ - . 
 

, , , : , .
 

 , , , : , , , , , . .
 
 

, ? : , , , . , ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ĞœĞ¾Ğ½Ğ°Ğ´Ñ‹ ĞºĞ°Ğº Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490112/"><p><img src="https://habrastorage.org/webt/e0/o5/67/e0o567enf-lqa86zlzf_fxfd3qi.png"></p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>  ,       ,  ,       , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a>          ( ).</p><br>
<p>    ,    <em>  </em>,       ,   ,             .</p><br>
<p>          ,    ?</p><br>
<p>  ,    (      )      :               ,     T      ,   T-    â€” .     ,   ,   â€”  ,    , ,         , , â€¦       -   . </p><br>
<p>,     ,      ,        :     ,        .</p><br>
<p>      ,       ,    ,     : , , ,  , ,   .             .</p><a name="habracut"></a><br>
<h2 id="vstuplenie"></h2><br>
<p>,    ?         :     ,      ,     ,     .       ,   ,    ,      ,    ,       .</p><br>
<p>       ,   ,  .      C#. Scala   , Rust     ,        ,   Haskell   . </p><br>
<p>      ,        C# 10 (   ),   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> Shapes</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> HKT</a>.        (aka , aka ).      ,          ,     </p><br>
<pre><code class="cs">public shape JsonDeserialize&lt;T&gt;
{
    static T Deserialize(JObject input);
}</code></pre><br>
<p>      <code>JsonSerializationException: Could not create an instance</code>    .                ,     .</p><br>
<p>     : -,      (  ),    ,  -,    . , <code>ICollection&lt;T&gt;</code>   <code>IReadOnlyCollection&lt;T&gt;</code>,        .   ,       .       .   -   -  <code>where T : Number</code>,    ,     ,    :     <code>Number</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  </a>.</p><br>
<p>       -  . ,    :</p><br>
<pre><code class="cs">public static T&lt;int&gt; CreateSomethingOfInts&lt;T&gt;() where T : &lt;&gt;, new() 
{
    return new T&lt;int&gt;();
}</code></pre><br>
<p>,  ,      ,    :</p><br>
<pre><code class="cs">//         

var list = CreateSomethingOfInts&lt;List&gt;();
var hashSet = CreateSomethingOfInts&lt;HashSet&gt;();
// â€¦
// Array&lt;T&gt;, Nullable&lt;T&gt;, LinkedList&lt;T&gt;, ... -     
//    Array&lt;int&gt;, Nullable&lt;int&gt;, LinkedList&lt;int&gt;, ...</code></pre><br>
<p>             C# 8.     ,    ,          .       ,         .</p><br>
<p> ,    , .</p><br>
<h2 id="functor">Functor</h2><br>
<p>      â€”  . "  ,      !" â€”  . ,   â€”      ,     ,     .</p><br>
<p>,   ?           ,          ,  <em> â€”   ,   Functor</em>  :</p><br>
<pre><code class="cs">public shape Functor&lt;T&gt; where T : &lt;&gt;
{
    static T&lt;B&gt; Map&lt;A, B&gt;(T&lt;A&gt; source, Func&lt;A, B&gt; mapFunc);
}</code></pre><br>
<p>,  .   ,       " ,   ".     ,      <code>Mappable</code>,   , ,    <code>Map</code>,     -,   <code>A</code>,    ,      <code>B</code>.</p><br>
<p>,        <code>ToString</code>,   .    ,      .     ,   ,   -.   â€”      ,    - .     <code>A =&gt; B</code>,         .     <code>Map</code>      ,  ,   <code>A</code>,      <code>B</code>. </p><br>
<p> <code>Map</code>   :   <code>mapFunc</code>  Identity-  <code>x =&gt; x</code>,     .  ,   "" ,         : </p><br>
<pre><code class="cs">Map(something, x =&gt; x) === something</code></pre><br>
<p>   , ,  , ,          ,            <code>mapFunc</code>.    ,  ,   ,     <code>Map</code>  .</p><br>
<p>         ?<br>
,  ,  :</p><br>
<pre><code class="cs">public extension EnumerableFunctor of IEnumerable : Functor&lt;IEnumerable&gt;
{
    public static IEnumerable&lt;B&gt; Map&lt;A, B&gt;(IEnumerable&lt;A&gt; source, Func&lt;A, B&gt; map) =&gt;
        source.Select(map);
}

//   
var range = Enumerable.Range(1, 10);
Console.WriteLine(Map(range, x =&gt; x).SequenceEquals(x)) //  True</code></pre><br>
<p>      ,   ,      !     ,    IEnumerable â€”  ,   </p><br>
<p>       ?  ,        100   .</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p>    Nullable.      :</p><br>
<pre><code class="cs">public extension NullableFunctor of Nullable : Functor&lt;Nullable&gt;
{
    public static B? Map&lt;A, B&gt;(A? source, Func&lt;A, B&gt; map) =&gt;
        source is A notNullSource ? map(notNullSource) : default(B?);
}

//   
int? nullableTen = 10;
int? nullableNull = null;
Console.WriteLine(Map(nullableTen, x =&gt; x) == nullableTen); //  True
Console.WriteLine(Map(nullableNull, x =&gt; x) == nullableNull); //  True</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><em>  </em></a></p><br>
<p>   ,  Nullable â€”   .</p><br>
<p>   â€” <code>Task</code>,     <code>Map</code> .</p></div></div><br>
<hr><br>
<p>           ,     :     ,    .   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">" "</a>.    ,       ,      ,   .</p><br>
<p><img src="https://habrastorage.org/webt/e0/-s/he/e0-shev4g3jrl3isbyvof8g3rhy.png"><br>
<em>Map     ,     ,      </em></p><br>
<p>           â€”  !           ...</p><br>
<h2 id="applicative">Applicative</h2><br>
<p> !     ,   :</p><br>
<pre><code class="cs">public shape Applicative&lt;T&gt; where T : &lt;&gt;
{
    static T&lt;A&gt; Pure&lt;A&gt;(A a);
    static T&lt;C&gt; LiftA2&lt;A, B, C&gt;(T&lt;A&gt; ta, T&lt;B&gt; tb, Func&lt;A,B,C&gt; map2);
}</code></pre><br>
<p>   ?  ,   ,  :</p><br>
<ol>
<li>     .     <code>where T : new()</code>,   ,  <code>new()</code>   ,    .</li>
<li>   .   ,        <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code>  ,    <code>A, B</code>  <code>C</code>,     <code>T&lt;C&gt;</code>.  <code>LiftA2</code>   ,     <strong>""</strong>   <strong></strong>   <code>A</code>  <code>B</code>    <strong></strong> <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code> . </li>
</ol><br>
<p>?  .      - â€“   -  .    ,         , ,  - ?</p><br>
<p>"Talk is cheap, show me the code",          ,   ,     .      â€”      ,  ,      -    â€”    .    :</p><br>
<pre><code class="cs">public extension EnumerableApplicative of IEnumerable : Applicative&lt;IEnumerable&gt;
{
    static IEnumerable&lt;A&gt; Pure&lt;A&gt;(A a) =&gt; new[] { a };
    static IEnumerable&lt;C&gt; LiftA2&lt;A, B, C&gt;(IEnumerable&lt;A&gt; ta, 
                                          IEnumerable&lt;B&gt; tb, 
                                          Func&lt;A, B, C&gt; map2) =&gt;
            ta.SelectMany(a =&gt; tb.Select(b =&gt; map2(a, b)));
}</code></pre><br>
<p>,     .   â€”       ,     <code>public extension</code>.     -      ,       ,     (       ).</p><br>
<p>   Nullable?   :</p><br>
<pre><code class="cs">public extension NullableApplicative of IEnumerable : Applicative&lt;Nullable&gt;
{
    static A? Pure&lt;A&gt;(A a) =&gt; a;
    static C? LiftA2&lt;A, B, C&gt;(A? ta, B? tb, Func&lt;A, B, C&gt; map2) =&gt;
        (ta, tb) switch {
            (A a, B b) =&gt; map2(a, b), //    null -  
            _ =&gt; default(C?)          // -  -  null
        };
}</code></pre><br>
<p>        "  ",     ,      "  ,   , ...".  ,             ,     ,      .       <code>ZipList</code>:</p><br>
<pre><code class="cs">public class ZipList&lt;T&gt; : IEnumerable&lt;T&gt;
{
    private IEnumerable&lt;T&gt; _inner;

    // ..    IEnumerable&lt;T&gt;   
}

public extension ZipListApplicative of ZipList : Applicative&lt;IEnumerable&gt;
{
    static IEnumerable&lt;A&gt; Pure&lt;A&gt;(A a) =&gt;
        //        'a'
        Enumerable.Repeat(a, int.MaxValue); 
    static IEnumerable&lt;C&gt; LiftA2&lt;A, B, C&gt;(IEnumerable&lt;A&gt; ta, 
                                          IEnumerable&lt;B&gt; tb, 
                                          Func&lt;A, B, C&gt; map2) =&gt;
        ta.Zip(tb, map2);
}</code></pre><br>
<p>, ZipList     ,    .      Applicative    ,       Zip.</p><br>
<p> ,   ,  -   ?      ? ,        â€”  -     , -   ,       ,    - . ,   ,           ,  : <code>(F&lt;A&gt;, F&lt;B&gt;) -&gt; F&lt;(A, B)&gt;</code>.  :</p><br>
<pre><code class="cs">public static T&lt;(A, B)&gt; Combine(T&lt;A&gt; ta, T&lt;B&gt; tb) =&gt;
    LiftA2(ta, tb, (a, b) =&gt; (a, b));

var eta = Enumerable.Range(3, 2);
var etb = Enumerable.Range(15, 4);

int? nta = 10;
int? ntb = null;

Combine(eta, etb) // [(3, 15), (3, 16), (3, 17), (3, 18), (4, 15), (4, 16), (4, 17), (4, 18)]
Combine(nta, nta) // (10, 10)
Combine(nta, ntb) // Null
Combine(new ZipList&lt;int&gt;(eta), new ZipList&lt;int&gt;(etb)) //  [(3, 15), (4, 16)]</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><em>  </em></a></p><br>
<p>  ,  ,    .    â€” ,      Combine,        ,         .        ,       ,      ,  null.  ZipList      ,          .  ,     <strong>   </strong> (   <code>(a, b) =&gt; (a, b)</code>)  <strong> </strong> ( <code>T&lt;&gt;</code>).  ,   ,    ,      ( /// ),    , ,    ,           .</p><br>
<p> ,     ,   ,    ,      .          ,  ,  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">"  "</a>.        ,      .</p><br>
<p><img src="https://habrastorage.org/webt/j1/oa/im/j1oaimjis07hw_6i-qjyiuhnnvo.png"><br>
<em>pure    ,   </em></p><br>
<p><img src="https://habrastorage.org/webt/l_/wi/if/l_wiif07ubisactdwbk4danqk3e.png"><br>
<em>liftA2       ,   <br>
    ,  </em></p><br>
<p>,       ,   ,         " ".   ? ""            . ,      ,   .    <code>LiftA2</code>          . ,     ,        ,     null â€”   .           - . </p><br>
<p>  ?   <code>LiftA2</code>  <code>Pure</code>   <code>Map</code>:</p><br>
<pre><code class="cs">static T&lt;B&gt; MapAnyFunctor&lt;T, A, B&gt;(T&lt;A&gt; source, Func&lt;A, B&gt; map) where T : Applicative =&gt;
    LiftA2(source, Pure(0), (a, _) =&gt; map(a));</code></pre><br>
<p>  ?   â€”         <code>Pure</code>     <code>T&lt;&gt;</code>.     <code>T&lt;A&gt;</code>  <code>T&lt;&gt;</code>,      <code>LiftA2</code>.     ,        ,  <code>map</code>     <code>T&lt;A&gt;</code>.     ,     .     :</p><br>
<pre><code class="cs">public shape Applicative&lt;T&gt; : Functor&lt;T&gt; where T : &lt;&gt;
{
    static T&lt;A&gt; Pure&lt;A&gt;(A a);
    static T&lt;C&gt; LiftA2&lt;A, B, C&gt;(T&lt;A&gt; ta, T&lt;B&gt; tb, Func&lt;A,B,C&gt; map2);
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><em>  </em></a>.  ,    ,   .</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><p>      <code>Task&lt;T&gt;</code>:</p><br>
<pre><code class="cs">public extension TaskApplicative of Task: Applicative&lt;Task&gt;
{
    public static Task&lt;A&gt; Pure&lt;A&gt;(A a) =&gt; Task.FromResult(a);

    public static async Task&lt;C&gt; LiftA2&lt;A, B, C&gt;(Task&lt;A&gt; ta, Task&lt;B&gt; tb, Func&lt;A, B, C&gt; map2)
    {
        await Task.WhenAll(ta, tb);
        return map2(ta.Result, tb.Result);
    }
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><em>  </em></a></p></div></div><br>
<h2 id="monad">Monad</h2><br>
<p>  . ,      .   <br>
   ,      :</p><br>
<pre><code class="cs">public shape Monad&lt;T&gt; where T : &lt;&gt;
{
    static T&lt;A&gt; Pure&lt;A&gt;(A a);
    static T&lt;B&gt; Bind&lt;A, B&gt;(T&lt;A&gt; ta, Func&lt;A, T&lt;B&gt;&gt; mapInner);
}</code></pre><br>
<p>  -, :</p><br>
<blockquote> â€”      Pure  Bind,     <code>T&lt;A&gt;</code>  ,    <code>A</code>  <code>T&lt;B&gt;</code>,       <code>T&lt;B&gt;</code></blockquote><p>     , .     ,     :         <code></code>.        <code>A</code>    ,     <code>B</code>.  <code>Bind</code>  ""    ,    <code>(T&lt;A&gt;, A =&gt; T&lt;B&gt;)</code>  <code>T&lt;B&gt;</code>.</p><br>
<p>   â€”   ,       ,       :</p><br>
<pre><code class="cs">public extension EnumerableMonad of IEnumerable : Monad&lt;IEnumerable&gt;
{
    static IEnumerable&lt;B&gt; Bind&lt;A, B&gt;(IEnumerable&lt;A&gt; ta, Func&lt;A, IEnumerable&lt;B&gt;&gt; mapInner) =&gt;
        ta.SelectMany(mapInner);
    // Pure      
}</code></pre><br>
<p> ,  <code>Nullable</code>   .    <code>ZipList</code>?   , ,  :        ,      ,        ,     (   ).<br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>  ,    ,      .     ZipList     ,        .</p><br>
<p><img src="https://habrastorage.org/webt/pf/4v/hw/pf4vhwatfeubgnipglnsoslzgig.png"><br>
<em>                       </em></p><br>
<p>    ,   <code>Pure</code>   :      .   <code>LiftA2</code>,           <code>Pure</code>  <code>Bind</code>,    .</p><br>
<p> ,    ,     ,     . ,   ,         do-.     :</p><br>
<pre><code class="haskell">let foo = do
  a &lt;- someA
  b &lt;- someB
  pure (doSomethingWith a b)</code></pre><br>
<p>    <code>Bind</code>     :</p><br>
<pre><code class="cs">var foo = Bind(someA, a =&gt; Bind(SomeB, b =&gt; Pure(DoSomethingWIth(a,b)))</code></pre><br>
<p>  .      <code>&lt;-</code>      <code>Bind</code>,<br>
,   â€”    ,     .<br>
.</p><br>
<p> ,    ,     . </p><br>
<p>     ?          . ,    ?</p><br>
<pre><code class="cs">var values = from x in new []{ 1, 2, 3 }
             from y in new []{ 4, 5, 6 }
             select x + y;</code></pre><br>
<p>   ,  do-    (    ):</p><br>
<pre><code class="haskell">let values = do 
    x &lt;- [1,2,3]
    y &lt;- [4,5,6]
    pure (x + y)</code></pre><br>
<p>     :</p><br>
<pre><code class="cs">var maybeA = GetMaybeA();
var maybeB = maybeA?.GetB();
var maybeC = maybeB?.GetC();
var result = maybeC;</code></pre><br>
<p>  do-   Maybe (  Option,      â€” Nullable):</p><br>
<pre><code class="haskell">let result = do
    maybeA &lt;- getMaybeA
    maybeB &lt;- getB maybeA
    maybeC &lt;- getC maybeB
    pure maybeC</code></pre><br>
<p>    ?</p><br>
<pre><code class="cs">var valueA = await GetSomeA();
var valueB = await GetSomeB(valueA);
var result = valueB;</code></pre><br>
<p>  do-   IO (    , ,  ,    <code>Task</code>  ):</p><br>
<pre><code class="haskell">let result = do
    valueA &lt;- getSomeA
    valueB &lt;- getSomeB valueA
    pure valueB</code></pre><br>
<p>        <em></em>    ,<br>
      :      <code>T&lt;&gt;</code>  <br>
 <code>A</code>  <code>T&lt;B&gt;</code>,  <code>T&lt;B&gt;</code>,   <code>A[]  A -&gt; B[]</code>,  <code>A?  A -&gt; B?</code>,<br>
 <code>Task&lt;A&gt;  A -&gt; Task&lt;B&gt;</code>,â€¦      .</p><br>
<p>           ...</p><br>
<h2 id="zachem-nam-monady">  </h2><br>
<h3 id="uproschenie-sintaksisa-yazyka">  </h3><br>
<p> ,    ,    . ,    ,     " -,    - ".  -,  LINQ,  null propagation     .        .      nullable-? , -   , ,   -    .    ?    ,      . ,    ,   ,         -    LINQ- (,  <code>First</code>   ). </p><br>
<p>       ,     :    <code>MapAnyFunctor</code>      .     <code>async enumerable</code>,  -  (    ,          CancallationToken?),      ?  - ,   ?</p><br>
<p>         <em>    </em>,      : <code>List</code>  <code>IO</code>.</p><br>
<p>  ,      ,    :   .   Rust       ,   .  :  try-,  Try-,     -,  -. ,         <code>async enumerable</code>,     ,     ,      .</p><br>
<p>       do-,       ,   ,    ,        ,         .</p><br>
<p> <strong></strong>:      <em></em>,           -.  ,      ,         ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>.    ,        (  ,        <code>Par</code>)? ,  ,  C# 15,  , ,  .     .</p><br>
<h3 id="uproschenie-standartnoy-biblioteki-yazyka">   </h3><br>
<p>     ,    " -,    -".    ,         Bind.   <code>ContinueWith</code>,  <code>SelectMany</code>,   .           ,   Rust    .  <code>Option</code>/<code>Result</code>/<code>Future</code>   <em></em> ,      ,          : <strong></strong>    <code>Monad</code>,       <code>MonadFail</code>/<code>Bifunctor</code>/...,      . </p><br>
<p>     ?   -   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>   1.29  flatten  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>      ,   .       ,   .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>    transpose  Option/Result   ,  ,  <code>transpose</code>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>    0.8  <strong>2013 </strong>. <code>transpose</code>   (     IO   )    ,  7  ,   .</p><br>
<p>   ,    :    <code>Monad</code>  <strong></strong> ,    <code>transpose/flatten/...</code>       <strong></strong>. ,     -    ,      ,    .     ,     2015       . ,  ,        ,         . </p><br>
<p>     .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">System.Linq.Async</a>.        ,    LINQ  corefx,    async-await. ,   <em></em> ,    .     ,      .    ,   -  .        <code>filterM</code>/<code>mapM</code>/<code>whateverM</code>,           //â€¦ ,      (  <code>M</code>  ),          .</p><br>
<p>,     ,    </p><br>
<h3 id="storonnie-biblioteki"> </h3><br>
<p> ,   Monad (    )  ,      . , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>,           .       ,    "" â€”        ,         ,        (     ),     ,    ,     ,      . </p><br>
<p>          ,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><em>  </em></a>     ,   Go .        Functor/Applicative/Monad/â€¦     .    HKT â€”    ,    ,          ,          . ,     ,       ,   .      ,     ,        .</p><br>
<p>  , ,    . ,    ,   IEnumerable.     â€”     .   ORM     IQueryable,        ,        ORM      .       -  ,           ,         ?        ?</p><br>
<p>           ,       .            Haskell,       <code>My.Big.Corporation.Utils</code>,      ,       "      ".     ,    ,       ,     ,          -. </p><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><p> ,   â€”   ,   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a> â€”          ,      . ,    "   ",    ,         ,         .  â€”  ,   .</p></div></div><br>
<p>,  ,       ,       :     -  .         .     Akka,     .     ,     â€”         ,    ? , ,      -      ,      , ,       .        ,         ,   ,   ,  -   ,            ,   -   .       ,      ,    .  ,     ,      ,      ,            .</p><br>
<p><img src="https://habrastorage.org/webt/ym/vc/gc/ymvcgcyndroyfat4cmnrd2jnvck.png"></p><br>
<p>  ,      ,    ,    ,    â€”     .   , ,  -         ,      â€”   ,  - ,   ,       ,       .   â€”  ,   ,    â€”  ,        â€”  ,        .</p><br>
<h3 id="vyrazitelnost"></h3><br>
<p>        .  ,  ,      :         SOLID.  ?  ,  ,    ,   :</p><br>
<pre><code class="cs">public M&lt;Comment&gt; GetArticleComment&lt;M&gt;(int articleId) 
    where M : MonadWriter&lt;LogMessage[]&gt;, MonadReader&lt;Config&gt;, MonadHttp&lt;AllowedSite&gt;</code></pre><br>
<p> MonadWriter/MonadReader/MonadHttp â€”       SOLID ,        .       ,       (     <code>LogMessage</code>!),   (  <code>Config</code>!)    Http (   <code>AllowedSite</code>!),          . </p><br>
<p>,    ,       .     ,     ,     Task.   <code>return 10</code>,     <code>Task&lt;int&gt;</code>.</p><br>
<p>    ,   Task     <code>M</code>,    â€”  ,     . </p><br>
<p>,           SOLID,           â€”  .     Autofac/Windsor/Ninject/â€¦     "  ",      <code>where</code>   ,      ,      .    ,     ,     ,    . </p><br>
<h3 id="testiruemost"></h3><br>
<p>    ,       ,    ,    .</p><br>
<p>  ,      ,     ,      .     : ,    ,     -   -  . </p><br>
<pre><code class="cs">class MyService 
{
    async Task&lt;Comment&gt; SomeBusinessLogicAsync(int commentId) {
        var comment = await this.remoteClient.GetAsync($"some/url/{commentId}");
        // .. do stuff ..
        return await DoOtherStuffAsync(comment);
    }
}</code></pre><br>
<p>     .      C#   ?<br>
,        ,   <code>MyService</code>  <code>remoteClient</code>    ,     . </p><br>
<p>    -  ,   <code>httpClient</code>,         (        ,  ),   act/assert  .</p><br>
<p>      ?    ,   (    )  Id,          :</p><br>
<pre><code class="cs">public class Id&lt;T&gt;
{
    public T Value { get; }

    public Id(T value)
    {
        Value = value
    }
}

public extension IdMonad of Id : Monad&lt;Id&gt;
{
    static IdMonad&lt;A&gt; Pure&lt;A&gt;(A a) =&gt; new Id&lt;A&gt;(a); //   
    static IdMonad&lt;B&gt; Bind&lt;A, B&gt;(IdMonad&lt;A&gt; ta, Func&lt;A, IdMonad&lt;B&gt;&gt; mapInner)  =&gt;
        mapInner(ta.Value); //      
    //  map  liftA2  -
}</code></pre><br>
<p>  :</p><br>
<pre><code class="cs">Task&lt;Comment&gt; SomeBusinessLogicAsync(int commentId);</code></pre><br>
<p> </p><br>
<pre><code class="cs">M&lt;Comment&gt; SomeBusinessLogicAsync&lt;M&gt;(int commentId) where M : Monad =&gt;
    this.remoteClient.Get($"some/url/{commentId}").Bind(comment =&gt; 
        // .. do stuff ..
        return DoOtherStuff(comment);
    );</code></pre><br>
<p> do-    11,    .      :</p><br>
<pre><code class="cs">var comment = await myService.SomeBusinessLogicAsync&lt;Task&gt;(547);</code></pre><br>
<p>    :</p><br>
<pre><code class="cs">var comment = myService.SomeBusinessLogicAsync&lt;Id&gt;(547).Value;</code></pre><br>
<p>    !        ,    SOLID (       ).     ,      ,       ,      .  ,    .       ,       <em>- </em>.        ,        .    <strong></strong>      .             ,       . </p><br>
<p>  â€”      .    ,     <code>Task.FromResult</code> -    .     ,    ,    .       :        :   ,   .    "    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">    </a>",  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>.     ,     ,   .</p><br>
<p> ,    <code>M</code>   ,    <code>Task</code>  <code>Id</code>,     , , ,     (   <code>M</code>        ),     ( <code>M</code> â€” Option),     ( <code>M</code> â€” Result),   .     â€”       .       ,      , ,     â€”   ,      . :  â€” ,  â€” .</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p><img src="https://habrastorage.org/webt/ai/qx/_m/aiqx_map8rpzdm85xgzslo0aqwg.png"></p><br>
<p> ,    ,     .       Traversable,  Foldable,         ,    ,        ,  .</p><br>
<p> ,          :</p><br>
<ul>
<li><p> (. Mappable)</p><br>
<p> :   ,   <code>Map</code>  ,      .</p><br>
<p>:       ,  <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code>.</p><br>
<p>:        ;<br>
   </p><br>
</li>
<li><p>  (, . PairMappable) </p><br>
<p> :   ,    <code>Pure</code>  <code>LiftA2</code>,   <br>
   ( ,   ).   <br>
    "".</p><br>
<p>:        <code>T&lt;A&gt;</code>  <code>T&lt;B&gt;</code>   <code>T&lt;C&gt;</code>. </p><br>
<p>:    (, List, Option, ZipList, ..);<br>
   -  </p><br>
</li>
<li><p> (. NestedJoinMappable):</p><br>
<p> :   ,    <code>Pure</code>  <code>Bind</code> (  ).<br>
       "".</p><br>
<p>:    <em></em> ,  <code>T&lt;B&gt;</code>   <code>A</code>, <br>
         <code>T&lt;A&gt;</code></p><br>
<p>:    ,    ;    - </p><br>
</li>
</ul><br>
<p>,   ,   (     )   -  ,    , </p><br>
<ul>
<li>   (   )</li>
<li>    ,       </li>
</ul><br>
<p> ,         ,       ,   ,        .</p><br>
<p> â€”  ,    .   â€”   ,      ,     "     ,   <em></em> "  .       <abbr title="Programming Defeatism: No technique will remove all bugs, so let's go with what worked in the 70s">     </abbr>,    ,     .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490096/index.html">ä¸ºRaspberry Piåˆ¶ä½œå¾®å‹USBé›†çº¿å™¨çš„ç®€ä¾¿æ–¹æ³•</a></li>
<li><a href="../zh-CN490100/index.html">å¼€å‘ç”¨äºåˆ†æ•£å¼è¸æ¿è½¦ç§Ÿèµçš„è½¯ä»¶ã€‚è°è¯´ä¼šå®¹æ˜“ï¼Ÿ</a></li>
<li><a href="../zh-CN490102/index.html">wcåˆ°Dï¼š712ä¸ªå­—ç¬¦ï¼ˆæ— å•ä¸ªåˆ†æ”¯ï¼‰</a></li>
<li><a href="../zh-CN490104/index.html">åšä¸–çš„æ™ºèƒ½é®é˜³æ¿ã€‚åŸå‹æµ‹è¯•</a></li>
<li><a href="../zh-CN490110/index.html">ä»å¼€å‘äººå‘˜åˆ°ç»ç†ï¼Œåä¹‹äº¦ç„¶</a></li>
<li><a href="../zh-CN490114/index.html">Yandex.Practicum-æ•°æ®åˆ†æå¸ˆã€‚æ¯•ä¸š</a></li>
<li><a href="../zh-CN490118/index.html">å…³äºSERMçš„10ä¸ªæœ€é‡è¦çš„äº‹å®</a></li>
<li><a href="../zh-CN490120/index.html">ç ”ç©¶æ¯”ç‰¹éŸ³</a></li>
<li><a href="../zh-CN490126/index.html">æ–°åŠ å¡ç”µå­æ”¯ä»˜è®¸å¯è¯çš„ç±»å‹ä»¥åŠå¦‚ä½•è·å¾—ï¼Ÿ</a></li>
<li><a href="../zh-CN490130/index.html">ä¸Šå¤ç‰©å“ï¼šæ•°ç å½•éŸ³å¸¦ä½œä¸ºå‘çƒ§å‹æ ¼å¼</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>