<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ğŸ“¹ Terraform, repositÃ³rios mono e conformidade como cÃ³digo ğŸ‘©ğŸ½â€ğŸ’¼ ğŸ‘‡ğŸ» ğŸ‘©ğŸ¿â€ğŸ­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OlÃ¡ a todos. A OTUS abriu o recrutamento para um novo grupo no curso â€œPlataforma de infraestrutura baseada no Kubernetesâ€. Nesse contexto, preparamos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Terraform, repositÃ³rios mono e conformidade como cÃ³digo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/496162/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OlÃ¡ a todos. </font><font style="vertical-align: inherit;">A OTUS abriu o recrutamento para um novo grupo no curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œPlataforma de infraestrutura baseada no Kubernetesâ€. Nesse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contexto, preparamos uma traduÃ§Ã£o de material interessante sobre o tema.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/_-/a_/zq/_-a_zqk4jh1yeiuysg6pmfprejm.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VocÃª pode ser um daqueles que usam terraform para Infraestrutura como um cÃ³digo e estÃ¡ se perguntando como usÃ¡-lo de maneira mais produtiva e segura. Em geral, recentemente, isso incomodou muitos. Todos nÃ³s escrevemos configuraÃ§Ãµes e cÃ³digos usando diferentes ferramentas, idiomas e gastamos uma quantidade considerÃ¡vel de tempo, tornando-os mais legÃ­veis, extensÃ­veis e escalÃ¡veis. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/v9/dq/ctv9dqpci5uhnejvqacfdlzve5q.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Talvez o problema esteja em nÃ³s mesmos?</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O cÃ³digo escrito deve criar valor ou resolver um problema, alÃ©m de ser reutilizÃ¡vel para desduplicaÃ§Ã£o. Normalmente, esse tipo de discussÃ£o termina com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Vamos usar os mÃ³dulos"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Todos nÃ³s usamos mÃ³dulos terraform, certo? Eu poderia escrever muitas histÃ³rias com problemas devido Ã  modularidade excessiva, mas essa Ã© uma histÃ³ria completamente diferente e nÃ£o o farei.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/up/tu/x2/uptux2lqssssnc_yyadvetw4sa0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NÃ£o eu nÃ£o vou. NÃ£o insista, nÃ£o ... Ok, talvez mais tarde.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Existe uma prÃ¡tica bem conhecida - marcar cÃ³digo ao usar mÃ³dulos para bloquear o mÃ³dulo raiz, a fim de garantir sua operaÃ§Ã£o, mesmo ao alterar o cÃ³digo do mÃ³dulo. Essa abordagem deve se tornar um princÃ­pio de equipe, no qual os mÃ³dulos apropriados sÃ£o marcados e usados â€‹â€‹apropriadamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... mas e as dependÃªncias? E se eu tiver </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">120</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mÃ³dulos em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">120</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> repositÃ³rios diferentes e a alteraÃ§Ã£o de um mÃ³dulo afetar outros 20 mÃ³dulos. Isso significa que precisamos fazer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 + 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solicitaÃ§Ãµes pull? Se o nÃºmero mÃ­nimo de revisores for 2, isso significa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21 x 2 = 44</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reveja. A sÃ©rio! Simplesmente paralisamos o comando â€œmudando um mÃ³duloâ€ e todos comeÃ§arÃ£o a enviar memes ou gifs do Senhor dos AnÃ©is, e o resto do dia serÃ¡ perdido. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/97/hp/mh97hpwsk28i70xcrk_g-jkie-u.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um PR para notificar a todos, um PR para reunir todos, algemar e mergulhar na escuridÃ£o</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vale a pena trabalhar? Devemos reduzir o nÃºmero de revisores? Ou, talvez, faÃ§a uma exceÃ§Ã£o para os mÃ³dulos e nÃ£o exija PR se a alteraÃ§Ã£o tiver um grande impacto. Mesmo? VocÃª quer andar cegamente em uma floresta escura e profunda? Ou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuni-los todos, perfurar e mergulhar na escuridÃ£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NÃ£o, nÃ£o altere a ordem da revisÃ£o. Se vocÃª acha que trabalhar com relaÃ§Ãµes pÃºblicas Ã© correto, cumpra-as. Se vocÃª possui pipelines inteligentes ou se esforÃ§a para dominar, continue com essa abordagem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, o problema nÃ£o Ã© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"como vocÃª trabalha"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"qual Ã© a estrutura dos seus repositÃ³rios git"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q9/qd/1m/q9qd1mffdrpnnfs2ywarhzzojwk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã‰ semelhante ao que senti quando apliquei a sugestÃ£o abaixo.Vamos </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
voltar ao bÃ¡sico. </font><font style="vertical-align: inherit;">Quais sÃ£o os requisitos gerais para um repositÃ³rio com mÃ³dulos terraform?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele deve ser marcado para que nÃ£o haja alteraÃ§Ãµes de interrupÃ§Ã£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qualquer alteraÃ§Ã£o deve poder testar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As alteraÃ§Ãµes devem passar por uma revisÃ£o mÃºtua.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sugiro o seguinte - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NÃƒO use </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">micro-repositÃ³rios para mÃ³dulos de terraform. </font><font style="vertical-align: inherit;">Use um repositÃ³rio mono</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VocÃª pode marcar todo o repositÃ³rio quando houver uma alteraÃ§Ã£o / requisito</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qualquer alteraÃ§Ã£o, PR ou push pode ser testada.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qualquer alteraÃ§Ã£o pode passar pela revisÃ£o.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ff/si/dm/ffsidmva0173goa0qakuisrr5o4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu tenho forÃ§a!</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ok, mas qual serÃ¡ a estrutura deste repositÃ³rio? Nos Ãºltimos quatro anos, tive muitas falhas relacionadas a isso e cheguei Ã  conclusÃ£o de que um diretÃ³rio separado para o mÃ³dulo seria a melhor soluÃ§Ã£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/0j/0g/rs0j0gfsrkk45cfmo0j8oemoe-4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estrutura de diretÃ³rio de exemplo para um repositÃ³rio mono. Veja a alteraÃ§Ã£o tags_override?</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Assim, uma mudanÃ§a de mÃ³dulo que afeta 20 outros mÃ³dulos Ã© de apenas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 PR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! Mesmo se vocÃª adicionar 5 revisores a este PR, a revisÃ£o serÃ¡ muito rÃ¡pida em comparaÃ§Ã£o com os micro-repositÃ³rios. Se vocÃª usa o Github, isso Ã© ainda melhor! VocÃª pode usar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CODEOWNERS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para mÃ³dulos que possuem mantenedores / proprietÃ¡rios, e quaisquer alteraÃ§Ãµes nesses mÃ³dulos DEVEM ser aprovadas por esse proprietÃ¡rio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã“timo, mas como usar esse mÃ³dulo, localizado no diretÃ³rio de repositÃ³rio Ãºnico? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FÃ¡cil:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">module</span> <span class="hljs-string">"from_mono_repo"</span> {<font></font>
 source = <span class="hljs-string">"git::ssh://.../&lt;org&gt;/&lt;repo&gt;.git//&lt;my_module_dir&gt;"</span><font></font>
 ...<font></font>
}<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"from_mono_repo_with_tags"</span> {<font></font>
  source = <span class="hljs-string">"git::ssh://..../&lt;org&gt;/&lt;repo&gt;.git//&lt;mod_dir&gt;?ref=1.2.4"</span><font></font>
  ...<font></font>
}<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"from_micro_repo"</span> {<font></font>
  source = <span class="hljs-string">"git::ssh://.../&lt;org&gt;/&lt;mod_repo&gt;.git"</span><font></font>
  ...<font></font>
}<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"from_micro_repo_with_tags"</span> {<font></font>
  source = <span class="hljs-string">"git::ssh://.../&lt;org&gt;/&lt;mod_repo&gt;.git?ref=1.2.4"</span><font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quais sÃ£o as desvantagens desse tipo de estrutura? </font><font style="vertical-align: inherit;">Bem, se vocÃª tentar testar "todos os mÃ³dulos" com PR / alteraÃ§Ã£o, poderÃ¡ obter 1,5 horas de pipelines de CI. </font><font style="vertical-align: inherit;">VocÃª precisa encontrar os mÃ³dulos modificados no PR. </font><font style="vertical-align: inherit;">Eu faÃ§o assim:</font></font><br>
<br>
<pre><code class="java hljs">changed_modules=$(git diff --name-only $(git rev-parse origin/master) HEAD | cut -d <span class="hljs-string">"/"</span> -f1 | grep ^aws- | uniq)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HÃ¡ outra desvantagem: sempre que vocÃª executa o "terraform init", ele carrega todo o repositÃ³rio no diretÃ³rio .terraform. Mas nunca tive problemas com isso, pois executo meus pipes em contÃªineres escalÃ¡veis â€‹â€‹do AWS CodeBuild. Se vocÃª usa o Jenkins e o Jenkins Slaves persistente, pode ter esse problema. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cm/fd/jz/cmfdjzpaet7z2bwg5wjvclj2sm4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NÃ£o nos faÃ§a chorar.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Com um mono-repositÃ³rio, vocÃª ainda tem todas as vantagens dos micro-repositÃ³rios, mas como bÃ´nus, reduz o custo de manutenÃ§Ã£o de seus mÃ³dulos. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Honestamente, depois de trabalhar nesse modo, a proposta de usar micro-repositÃ³rios para mÃ³dulos de terraform deve ser considerada um crime.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã“timo, e o teste de unidade? VocÃª realmente precisa disso? ... Em geral, o que exatamente vocÃª quer dizer com teste de unidade. VocÃª realmente vai verificar se o recurso da AWS foi criado corretamente? De quem Ã© a responsabilidade: terraform ou uma API que lida com a criaÃ§Ã£o de recursos? Talvez devÃªssemos nos concentrar mais em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testes negativos e na idempotÃªncia do cÃ³digo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar a idempotÃªncia do cÃ³digo, o terraform fornece um excelente parÃ¢metro chamado </font></font><code>-detailed-exitcode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Apenas corra:</font></font><br>
<br>
<pre><code class="java hljs">&gt; terraform plan -detailed-exitcode</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, corra </font></font><code>terraform apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e Ã© isso. Pelo menos, vocÃª terÃ¡ certeza de que seu cÃ³digo Ã© idempotente e nÃ£o cria novos recursos devido a uma sequÃªncia aleatÃ³ria ou outra coisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o teste negativo? O que, em geral, Ã© um teste negativo? Na verdade, isso nÃ£o Ã© muito diferente do teste de unidade, mas vocÃª deve prestar atenÃ§Ã£o em situaÃ§Ãµes negativas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ninguÃ©m tem permissÃ£o para criar um bucket S3 pÃºblico e nÃ£o criptografado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, em vez de verificar se um depÃ³sito S3 estÃ¡ realmente sendo criado, vocÃª, de fato, com base em um conjunto de polÃ­ticas, verifica se o seu cÃ³digo cria um recurso. Como fazer isso? O Terraform Enterprise fornece uma Ã³tima ferramenta para isso, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sentinel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... mas tambÃ©m existem alternativas de cÃ³digo aberto. Atualmente, existem muitas ferramentas para anÃ¡lise estÃ¡tica do cÃ³digo HCL. Essas ferramentas, baseadas em prÃ¡ticas recomendadas comuns, nÃ£o permitirÃ£o que vocÃª faÃ§a algo indesejado, mas e se nÃ£o tiver o teste que vocÃª precisa ... ou, pior ainda, se sua situaÃ§Ã£o for um pouco diferente. Por exemplo, vocÃª deseja permitir que alguns buckets do S3 sejam tornados pÃºblicos com base em determinadas condiÃ§Ãµes, o que, de fato, serÃ¡ um bug de seguranÃ§a para essas ferramentas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã‰ aqui que </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">a conformidade com terraform</font></a><font style="vertical-align: inherit;"> aparece</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Essa ferramenta nÃ£o apenas permitirÃ¡ que vocÃª escreva seus prÃ³prios testes nos quais vocÃª pode determinar o que deseja como polÃ­tica da sua empresa, mas tambÃ©m ajuda a separar seguranÃ§a e desenvolvimento movendo a seguranÃ§a para a esquerda. </font><font style="vertical-align: inherit;">Parece bastante controverso, certo? </font><font style="vertical-align: inherit;">NÃ£o. </font><font style="vertical-align: inherit;">Enquanto que? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2g/sc/i1/2gsci1q3cc5xgjy2-iazueeaere.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logotipo de conformidade com terraform</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Primeiro, a conformidade com terraform usa o Behavior Driven Development (BDD).</font></font><br>
<br>
<pre><code class="java hljs">Feature: Ensure that we have encryption everywhere.<font></font>
<font></font>
    Scenario: Reject <span class="hljs-keyword">if</span> an S3 bucket is not encrypted<font></font>
        Given I have aws_s3_bucket defined<font></font>
        Then it must contain server_side_encryption_configuration</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique se a criptografia estÃ¡ ativada.Se</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
isso nÃ£o for suficiente, vocÃª pode escrever com mais detalhes:</font></font><br>
<br>
<pre><code class="java hljs">Feature: Ensure that we have encryption everywhere.<font></font>
<font></font>
    Scenario: Reject <span class="hljs-keyword">if</span> an S3 bucket is not encrypted with KMS<font></font>
        Given I have aws_s3_bucket defined<font></font>
        Then it must contain server_side_encryption_configuration<font></font>
        And it must contain rule<font></font>
        And it must contain apply_server_side_encryption_by_default<font></font>
        And it must contain sse_algorithm<font></font>
        And its value must match the <span class="hljs-string">"aws:kms"</span> regex</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprofundamos e verificamos se o KMS Ã© usado para criptografia.O</font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
cÃ³digo de terraform para este teste:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_kms_key"</span> <span class="hljs-string">"mykey"</span> {<font></font>
 description             = <span class="hljs-string">"This key is used to encrypt bucket objects"</span>
 deletion_window_in_days = <span class="hljs-number">10</span><font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_s3_bucket"</span> <span class="hljs-string">"mybucket"</span> {<font></font>
 bucket = <span class="hljs-string">"mybucket"</span><font></font>
<font></font>
 server_side_encryption_configuration {<font></font>
   rule {<font></font>
     apply_server_side_encryption_by_default {<font></font>
       kms_master_key_id = <span class="hljs-string">"${aws_kms_key.mykey.arn}"</span>
       sse_algorithm     = <span class="hljs-string">"aws:kms"</span><font></font>
     }<font></font>
   }<font></font>
 }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, os testes sÃ£o entendidos literalmente por TUDO na sua organizaÃ§Ã£o. Aqui vocÃª pode delegar a gravaÃ§Ã£o desses testes em um serviÃ§o de seguranÃ§a ou em desenvolvedores com conhecimento suficiente de seguranÃ§a. Essa ferramenta tambÃ©m permite armazenar arquivos BDD em outro repositÃ³rio. Isso ajudarÃ¡ a diferenciar a responsabilidade quando as alteraÃ§Ãµes no cÃ³digo e nas polÃ­ticas de seguranÃ§a associadas ao seu cÃ³digo forem duas entidades diferentes. Podem ser equipes diferentes com diferentes ciclos de vida. IncrÃ­vel nÃ©? Bem, pelo menos para mim foi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obter mais informaÃ§Ãµes sobre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conformidade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">terraform,</font></a><font style="vertical-align: inherit;"> consulte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta apresentaÃ§Ã£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resolvemos muitos problemas com </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">a conformidade</font></a><font style="vertical-align: inherit;"> com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terraform</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, especialmente onde os serviÃ§os de seguranÃ§a estÃ£o bastante distantes das equipes de desenvolvimento e podem nÃ£o entender o que os desenvolvedores estÃ£o fazendo. VocÃª jÃ¡ adivinha o que estÃ¡ acontecendo nessas organizaÃ§Ãµes. Normalmente, o serviÃ§o de seguranÃ§a comeÃ§a a bloquear tudo o que Ã© suspeito e cria um sistema de seguranÃ§a baseado na seguranÃ§a do perÃ­metro. Oh Deus ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em muitas situaÃ§Ãµes, usar apenas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terraform</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conformidade com terraform</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para equipes que projetam (ou acompanham) a infraestrutura ajudaram a colocar essas duas equipes diferentes na mesma mesa. Quando sua equipe de seguranÃ§a comeÃ§a a desenvolver algo com feedback imediato de todos os pipelines de desenvolvimento, ela geralmente obtÃ©m a motivaÃ§Ã£o para fazer cada vez mais. Bem, geralmente ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, ao usar terraform, estruturamos repositÃ³rios git da seguinte maneira: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/d_/ln/vld_ln5d9trbudgjtb2wft-32vk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã‰ claro que isso Ã© bastante arrogante. </font><font style="vertical-align: inherit;">Mas tive sorte (ou nÃ£o?) De trabalhar com uma estrutura mais detalhada em vÃ¡rias organizaÃ§Ãµes. </font><font style="vertical-align: inherit;">Infelizmente, tudo isso nÃ£o terminou muito bem. </font><font style="vertical-align: inherit;">O final feliz deve estar oculto no nÃºmero 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me saber se vocÃª tem alguma histÃ³ria de sucesso com micro repositÃ³rios, estou realmente interessado!</font></font><br>
<br>
<hr><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convidamos vocÃª a uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liÃ§Ã£o gratuita</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na qual </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consideraremos os componentes de uma futura plataforma de infraestrutura e veremos como entregar nosso aplicativo corretamente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496148/index.html">PadrÃµes de design estrutural no ES6 + no exemplo de Game of Thrones</a></li>
<li><a href="../pt496152/index.html">AutomaÃ§Ã£o de rede. Caso da vida</a></li>
<li><a href="../pt496154/index.html">AutomaÃ§Ã£o de atendimento ao cliente: uma soluÃ§Ã£o completa da DeepPavlov</a></li>
<li><a href="../pt496156/index.html">Como os sistemas de anÃ¡lise de trÃ¡fego detectam tÃ¡ticas de hackers por MITRE ATT & CK, parte 3</a></li>
<li><a href="../pt496160/index.html">Estudamos o mecanismo VoIP do Mediastreamer2. Parte 5</a></li>
<li><a href="../pt496164/index.html">Durante a crise, perdi meu emprego e agora tenho medo de escrever um cÃ³digo inteligente para nÃ£o assustar as Ãºltimas vagas</a></li>
<li><a href="../pt496166/index.html">Doctrine ResultSetMapping com exemplos</a></li>
<li><a href="../pt496170/index.html">Estamos condenados # 1 // Udalenka em crise e morte da originalidade</a></li>
<li><a href="../pt496174/index.html">A demanda crescente por anÃ¡lises, equipes de produtos, Amazon, Israel, Cingapura, trabalho remoto etc. - discutiu muito.</a></li>
<li><a href="../pt496176/index.html">Grande conferÃªncia virtual: experiÃªncia do mundo real na proteÃ§Ã£o de dados de empresas digitais modernas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>