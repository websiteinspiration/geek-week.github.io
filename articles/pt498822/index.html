<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüè´ üë¶üèΩ üçÅ Desenvolvimento e cria√ß√£o do zero de uma m√°quina de arcade para quatro jogadores ü§∞üèº üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø üî°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em novembro de 2019, abandonei o emprego e decidi dedicar v√°rios meses ao aprendizado de uma nova habilidade que desejava aprender h√° muito tempo. Naq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento e cria√ß√£o do zero de uma m√°quina de arcade para quatro jogadores</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498822/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a6/10f/ede/6a610fede3bc45535fdcd0b8b3d6a9d7.jpg" alt="imagem"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em novembro de 2019, abandonei o emprego e decidi dedicar v√°rios meses ao aprendizado de uma nova habilidade que desejava aprender h√° muito tempo. Naquela √©poca, eu trabalhava como desenvolvedor web. Antes disso, estudei desenvolvimento de software. E ainda mais cedo, quando crian√ßa, eu estava constantemente experimentando eletr√¥nicos e programas. Portanto, eu me senti confiante o suficiente na cria√ß√£o de software. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, sempre houve essa coisa m√°gica chamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúferro‚Äù</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que uso diariamente, mas n√£o tenho id√©ia de como ela realmente funciona. Um desenvolvedor de software (e especialmente um desenvolvedor web) n√£o precisa entender o hardware. Como todo c√≥digo de desenvolvimento da web √© de n√≠vel muito alto, raramente acontece que o problema com o nosso software esteja relacionado ao hardware.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, nunca trabalhei em ‚Äúferro‚Äù e n√£o tinha nenhum conhecimento geral sobre engenharia el√©trica, exceto aqueles que nos foram dados no ensino m√©dio. E eu queria mudar essa situa√ß√£o. Estabeleci uma meta absurda, que na √©poca parecia muito distante do meu conjunto de conhecimentos. E ent√£o ... eu apenas comecei a experimentar. Planejei verificar at√© onde poderia ir antes de ficar sem motiva√ß√£o. Eu n√£o esperava alcan√ßar meu objetivo, mas de alguma forma consegui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° o meu resultado:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/npsSCkFGR0g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meu objetivo incr√≠vel era criar um console de videogame para quatro jogadores do zero. Ele usa um microcontrolador como um c√©rebro e uma faixa de LED como um monitor. Usando um joystick e quatro bot√µes para cada jogador localizado nas bordas da mesa, os jogadores controlam um jogo que √© carregado dinamicamente no sistema a partir de um chip de mem√≥ria. Gra√ßas a isso, a jogabilidade no dispositivo se assemelha aos bons consoles antigos. S√≥ que agora n√£o precisamos soprar o cartucho para se livrar dos bugs.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para minha surpresa ... eu realmente pude concluir o projeto. </font><font style="vertical-align: inherit;">Levei cerca de tr√™s meses √∫teis para ciclos de experimentos, falhas, leitura de documenta√ß√£o, desespero e novas tentativas. </font><font style="vertical-align: inherit;">Seria necess√°rio fixar o n√∫mero de horas de trabalho para saber quanto tempo gastei nisso. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vou assumir</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que cerca de 800-900 horas. </font><font style="vertical-align: inherit;">(Supondo que eu trabalhasse 6/7 dias por semana, entre 8 e 10 horas por dia, o que √© bastante pr√≥ximo da verdade.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentei documentar o processo de minhas experi√™ncias do come√ßo ao fim, tirando fotos e gravando v√≠deos. </font><font style="vertical-align: inherit;">Com este post, documentarei o projeto e minha experi√™ncia por mim mesmo. </font><font style="vertical-align: inherit;">Espero que, para voc√™, isso se torne uma fonte de inspira√ß√£o se voc√™ tamb√©m decidir assumir um projeto igualmente incr√≠vel.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indo pro trabalho</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu disse no come√ßo do artigo, quando iniciei o projeto, eu n√£o tinha conhecimento de eletr√¥nica, exceto pela f√≥rmula incorretamente lembrada da lei de Ohm. Portanto, primeiro, eu precisava estudar como a eletr√¥nica funciona na pr√°tica e s√≥ ent√£o tentar montar um console de jogos. Eu nem sabia como ligar o LED usando o microcontrolador. Ent√£o, meu primeiro passo: encomendar uma eletr√¥nica simples e um microcontrolador para experimentos. Para come√ßar, tentarei ligar o LED. Estou quase certo de que minha primeira tentativa de ligar o LED levou √† sua queima. Mas isso n√£o foi documentado na c√¢mera, ent√£o vamos fingir que n√£o era.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65d/3f9/4b4/65d3f94b409f452f2b89b61cebe87851.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experimentos com um microcontrolador, resistores, um transistor e um LED. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este foi o primeiro marco importante. </font><font style="vertical-align: inherit;">Agora sabemos como criar c√≥digo que roda no microcontrolador. </font><font style="vertical-align: inherit;">Tamb√©m aprendemos a usar transistores como um simples interruptor el√©trico para ligar um LED. </font><font style="vertical-align: inherit;">Surpreendente!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aventura com EEPROM</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b93/544/2b3/b935442b3b1db1c8c8e390c134394a6d.gif"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 1. Usando registradores de deslocamento para controlar 16 linhas de sa√≠da com apenas 3 pinos de sa√≠da.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Parte do projeto foi a capacidade de escrever l√≥gica de jogo em chips de mem√≥ria (EEPROM). Eles deveriam ter sido lidos quando um cartucho com um player √© inserido no sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A longo prazo, me machucou o fato de n√£o ter aprendido informa√ß√µes suficientes sobre que tipo de EEPROM deveria ser usado neste projeto. Eu era t√£o apaixonado que comprei os velhos chips EEPROM paralelos (W27C512). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para escrever ou ler a partir deles, eu precisava definir um sinal alto ou baixo nas 16 linhas. Se eu n√£o quisesse ocupar todos os contatos de sa√≠da do microcontrolador, seria l√≥gico aprender como usar os registradores de deslocamento.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e51/17c/73e/e5117c73e685322a816450c33a198278.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 2. O circuito usado em uma tentativa malsucedida de ler / gravar dados em um chip EEPROM paralelo.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Com apenas alguns contatos, podemos controlar separadamente todas as 16 linhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos aplicar esse conhecimento √† EEPROM! Sim mas n√£o. N√£o consegui </font><font style="vertical-align: inherit;">gravar dados na EEPROM de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forma est√°vel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este tipo de chip requer 12-14 V para remover ou gravar bytes. Tentei fornec√™-los usando transistores como interruptores para fornecer tens√£o aumentada. E pelo que entendi, deve funcionar. Mas n√£o deu certo. Ainda n√£o entendi qual √© exatamente o problema. Na fig. A Figura 2 mostra os circuitos que tentei usar para ler / gravar bytes de / para EEPROM.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c8/55b/2cc/7c855b2cccc52a790973701590912927.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 3. Um circuito que l√™ / grava com √™xito bytes em um chip EEPROM serial.Finalmente</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
, tendo estudado mais informa√ß√µes sobre esse t√≥pico, aprendi que hoje as EEPROMs paralelas n√£o s√£o usadas com tanta frequ√™ncia. Geralmente, os desenvolvedores preferem o EEPROM I2C serial e, portanto, √© muito mais f√°cil encontrar tutoriais sobre eles. (Por exemplo, este </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incr√≠vel tutorial do Sparkfun</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na fig. </font><font style="vertical-align: inherit;">A Figura 3 mostra meu esquema para ler e gravar dados em EEPROMs seriais ... √â MUITO mais simples e muito mais confi√°vel. </font><font style="vertical-align: inherit;">Isso me ensinou que voc√™ n√£o deveria estar muito feliz em pedir pe√ßas e tentar desenvolver o projeto muito rapidamente. </font><font style="vertical-align: inherit;">Passamos cerca de 1 a 2 semanas em EEPROMs paralelas e, por fim, n√£o as usamos. </font><font style="vertical-align: inherit;">No entanto, no processo, aprendemos muito em eletr√¥nica e especifica√ß√µes de leitura (o que por si s√≥ √© uma habilidade). </font><font style="vertical-align: inherit;">Os esfor√ßos n√£o foram completamente desperdi√ßados.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, como fazemos de qualquer maneira?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora podemos ler e gravar nos chips de mem√≥ria. </font><font style="vertical-align: inherit;">Qual ser√° o pr√≥ximo passo? </font><font style="vertical-align: inherit;">Nesta fase, ser√° l√≥gico descrever meu plano de console com mais detalhes usando v√°rios desenhos como exemplo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbd/be2/3c5/fbdbe23c5506e650261938ce053e01a5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plano geral. Este ser√° um console de jogo com controladores para quatro jogadores. Cada jogador possui um joystick e v√°rios bot√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≠rculo vermelho marca o plugue do cartucho de jogo. Esse conector ter√° quatro pinos de metal que o console usa para ler EEPROMs seriais e carregar jogos na mem√≥ria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verde mostra como planejamos criar uma tela de tiras de LED. Quer√≠amos que o pixel da tela fosse uma mancha quadrada e luminosa de cor, n√£o um ponto que se misturasse com outros pontos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para alcan√ßar o efeito desejado, usamos esse esquema para separar as fontes de luz uma da outra. Ao mesmo tempo, dispersa a luz que cai no topo da tela. (As faixas brancas abaixo da grade indicam a faixa de LED)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu decidi fazer um display LED de 42x42. Ou seja, no total s√£o obtidos 1764 LEDs. Eu escolhi o n√∫mero 42, porque, gra√ßas a isso, o tamanho da mesa ser√° ideal para quatro pessoas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ligar tantos LEDs √© uma tarefa assustadora. No brilho m√°ximo, o LED RGB consome 60 mA de corrente. (que d√° branco com brilho m√°ximo). Se multiplicarmos pelo n√∫mero total de LEDs, obteremos o consumo m√°ximo de corrente de 105,84 A a 5 V! Para nos aproximarmos dessa corrente, adquirimos uma fonte de alimenta√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SE-600‚Äì5 MEAN WELL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele pode fornecer corrente de at√© 100 A. O que √© menos do que teoricamente poss√≠vel 105 A. Mas n√£o pretendo exibir telas totalmente brancas com brilho m√°ximo nos jogos. </font><font style="vertical-align: inherit;">Al√©m disso, podemos limitar o brilho programaticamente. </font><font style="vertical-align: inherit;">Tamb√©m adicionaremos fus√≠veis para evitar exceder acidentalmente esse limite de 100 A.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/332/a49/769/332a49769fc921086ed5072e01879586.gif"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. </font><font style="vertical-align: inherit;">4. Prot√≥tipo de papel√£o para um display LED 3x3. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltarei √† montagem dessa tela mais tarde. </font><font style="vertical-align: inherit;">Primeiro voc√™ precisa fazer a prototipagem. </font><font style="vertical-align: inherit;">Vamos ver se conseguimos fazer com que uma pequena tela de LED funcione. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse prot√≥tipo 3x3 √© composto de v√°rios peda√ßos de papel√£o que separam pixels e um peda√ßo de papel comum para impressoras que dispersa a luz. </font><font style="vertical-align: inherit;">Funcionou muito bem! </font><font style="vertical-align: inherit;">Recebemos uma confirma√ß√£o maravilhosa da capacidade de trabalho do conceito.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar os LEDs usando um microcontrolador, usamos a biblioteca FastLED. Entretanto, se os LEDs forem controlados por um barramento de dados, √© imposs√≠vel atualizar 1764 LEDs a uma velocidade suficiente para jogos. Dada uma frequ√™ncia de 800 kHz, podemos atingir uma taxa de quadros de aproximadamente 17 quadros por segundo. N√£o √© exatamente o que nos esfor√ßamos. Pessoalmente, gosto de jogar com pelo menos 60FPS. Felizmente, isso √© poss√≠vel. √â suficiente usar mais de um barramento de dados. A tela de 42x42 pode ser convenientemente dividida em 7 partes iguais. Cada uma dessas partes pode ser controlada separadamente, com seu pr√≥prio barramento de dados. Isso √© poss√≠vel gra√ßas ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uso da fun√ß√£o de sa√≠da paralela da biblioteca FastLED no microcontrolador Teensy 4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Usando 7 barramentos de dados, podemos obter uma taxa de atualiza√ß√£o m√°xima de aproximadamente 120FPS!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o planejei isso, mas por puro acaso, no in√≠cio do projeto, escolhi esse microcontrolador espec√≠fico. </font><font style="vertical-align: inherit;">Pareceu-me que para o bom funcionamento dos jogos exigiria o r√°pido tempo de processamento fornecido por este MK. </font><font style="vertical-align: inherit;">O prot√≥tipo na Fig. </font><font style="vertical-align: inherit;">4 j√° √© controlado pela fun√ß√£o de sa√≠da paralela. </font><font style="vertical-align: inherit;">No entanto, neste prot√≥tipo, usamos apenas 2 barramentos de dados, apenas para testar se tudo realmente funcionar√° como indicado.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como vamos executar c√≥digo com EEPROM?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, nesta fase, podemos ler e escrever na EEPROM e tamb√©m temos uma prova pr√°tica do conceito da tela LED. Qual √© o pr√≥ximo? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Restam apenas duas tarefas t√©cnicas s√©rias: a organiza√ß√£o do m√©todo de entrada para todos os jogadores (bot√µes e joysticks). E tamb√©m precisamos descobrir como executar a l√≥gica do jogo da EEPROM e exibir os resultados dessas instru√ß√µes no visor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os bot√µes e joysticks solicitados ainda n√£o chegaram. Portanto, primeiro estaremos envolvidos na execu√ß√£o da l√≥gica do jogo da EEPROM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem v√°rias maneiras de executar instru√ß√µes (c√≥digo) da EEPROM. No entanto, primeiro precisamos definir certos requisitos: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) O c√≥digo deve ser f√°cil de escrever. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) O c√≥digo deve ser pequeno (tamanho do arquivo).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) O c√≥digo deve poder interagir com bibliotecas prontas, por exemplo, FastLED, a fim de reduzir a quantidade de meu trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) O c√≥digo deve ser capaz de carregar na RAM o mais r√°pido poss√≠vel, a fim de reduzir o tempo de carregamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Voc√™ precisa emular o c√≥digo em um PC comum para testar jogos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) Nossa solu√ß√£o deve ser de alto desempenho (fornecer pelo menos 60FPS). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) Uma solu√ß√£o n√£o deve exigir a compra de um grande n√∫mero de equipamentos adicionais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8) A solu√ß√£o deve funcionar no Teensy 4.0 MK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
9) A solu√ß√£o deve ser f√°cil de implementar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu vim com quatro maneiras diferentes de executar c√≥digo da EEPROM:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Escrevemos na EEPROM o c√≥digo Arduino compilado usual. Em seguida, fazemos o programador externo do Arduino ler o c√≥digo compilado da EEPROM e reprogramar o Arduino em tempo real toda vez que um novo jogo √© carregado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Carregamos o c√≥digo do assembler na RAM e o executamos a partir da√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Utilizamos um interpretador de c√≥digo pronto, por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArduinoBASIC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitlash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - N√≥s escrevemos nosso pr√≥prio interpretador de c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° uma breve compara√ß√£o das vantagens e desvantagens das quatro solu√ß√µes para o nosso projeto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75d/9e6/f9c/75d9e6f9c00e8c1067278d2317de5ae3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(1) O tamanho do arquivo para uma solu√ß√£o com um programador externo √© terr√≠vel. Juntamente com a l√≥gica do jogo, todas as bibliotecas de c√≥digo que usamos neste projeto devem ser armazenadas na EEPROM. Para exibir o estado do jogo, cada EEPROM deve ter sua pr√≥pria c√≥pia da biblioteca FastLED. Isso n√£o √© nada bom. Provavelmente, esse problema pode ser contornado adicionando-se o c√≥digo base a um programador externo, que √© ent√£o combinado com o c√≥digo na EEPROM antes de programar o Arduino. Isso seria uma tarefa de alto risco, porque n√£o √© t√£o f√°cil encontrar tutoriais na Internet. Provavelmente gastar√≠amos muito tempo nisso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(2) Executar o assembler a partir da RAM √© uma √≥tima op√ß√£o. Por isso, decidi considerar. A complexidade da escrita de c√≥digo pode ser reduzida usando uma linguagem de alto n√≠vel, por exemplo, C, que √© compilada no c√≥digo correto do assembler. No entanto, n√£o estava claro como seria f√°cil faz√™-lo interagir com outras bibliotecas no Arduino, ent√£o decidi abandon√°-lo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(3) Usar um int√©rprete pronto tamb√©m √© uma solu√ß√£o muito boa. No entanto, tanto quanto eu sei, todos esses int√©rpretes s√£o executados com base em cadeias de caracteres. Essas linhas longas devem ser gravadas na EEPROM. Esse n√£o √© um problema t√£o grande, mas definitivamente n√£o √© a melhor maneira de minimizar o tamanho do arquivo. Al√©m disso, n√£o estava claro se esses int√©rpretes poderiam interagir com as bibliotecas do Arduino. Portanto, decidi que usar int√©rpretes prontos n√£o √© uma boa ideia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(4) Finalmente, temos a solu√ß√£o 4: criar nosso pr√≥prio interpretador de c√≥digo. Satisfaz todos os requisitos, porque a maneira como o int√©rprete √© implementado depende inteiramente de mim. Ele </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vai</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ter alta velocidade se eu conseguir alta velocidade do pr√≥prio int√©rprete. </font><font style="vertical-align: inherit;">Sim, o tamanho do arquivo ser√° pequeno e o c√≥digo ser√° f√°cil de escrever ... se eu mesmo fornecer isso. </font><font style="vertical-align: inherit;">Em outras palavras, teremos controle completo sobre tudo. </font><font style="vertical-align: inherit;">E se eu fizer um esfor√ßo, tudo sair√° perfeitamente. </font><font style="vertical-align: inherit;">A √∫nica desvantagem s√©ria de tal solu√ß√£o ser√° um longo tempo de desenvolvimento. </font><font style="vertical-align: inherit;">Voc√™ deve se lembrar que passei de 800 a 900 horas nesse projeto. </font><font style="vertical-align: inherit;">Ou seja, √© √≥bvio que decidi escolher a solu√ß√£o 4 - para criar meu pr√≥prio interpretador de c√≥digo. </font><font style="vertical-align: inherit;">O tempo n√£o foi um problema para mim. </font><font style="vertical-align: inherit;">Aproveitei esta oportunidade para aprender como as linguagens de programa√ß√£o s√£o criadas. </font><font style="vertical-align: inherit;">Vou descobrir por que uma ou outra decis√£o arquitet√¥nica foi tomada nessas linguagens.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nascimento do ArcadableScript</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O princ√≠pio geral do int√©rprete √© bastante simples. </font><font style="vertical-align: inherit;">N√£o entrarei em detalhes de sua estrutura interna, porque no momento da reda√ß√£o, planejava reescrever completamente o int√©rprete para que se tornasse mais eficiente e fosse mais f√°cil para ele escrever c√≥digo. </font><font style="vertical-align: inherit;">No entanto, o b√°sico permanece o mesmo. </font><font style="vertical-align: inherit;">O int√©rprete executar√° um loop de c√≥digo simples para cada medida do jogo:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d38/795/8cf/d387958cf2e11b21d122f66d7f530918.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma grande desvantagem desse esquema √© que a entrada e o estado do jogo s√£o verificados apenas uma vez por quadro. </font><font style="vertical-align: inherit;">Para jogos que n√£o exigem uma rea√ß√£o r√°pida, isso √© normal. </font><font style="vertical-align: inherit;">No entanto, em outros jogos, o jogador n√£o poder√° reagir entre os quadros. </font><font style="vertical-align: inherit;">Vou resolver esse problema na pr√≥xima vers√£o do int√©rprete.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ee2/fe1/843ee2fe188d8a16ea99f0e9e427b9ef.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIG. 5</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No diagrama com a fig. A Figura 5 mostra como planejei atualizar o int√©rprete em um futuro pr√≥ximo, criando dois ciclos separados para o estado do jogo e os quadros do jogo. Isso nos permitir√° atualizar o estado do jogo centenas de vezes por segundo e a exibi√ß√£o - apenas 60 vezes por segundo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, no Teensy 4.0, n√£o √© poss√≠vel executar o c√≥digo multithread do hardware. Portanto, n√£o seremos capazes de realizar esses dois ciclos em paralelo. Mas tenho certeza de que vou inventar alguma coisa.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e56/8c7/878/e568c78787bb1b00b2aee6c406071050.gif"></div><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9bd/b45/225/9bdb45225d410ef24bcc8e5fa3b325c3.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de algum tempo, consegui escrever dois programas simples usando minha pr√≥pria linguagem de c√≥digo de c√≥digo inventada. Eles usam n√∫meros brutos como entrada para minimizar o tamanho do arquivo. Ou seja, completei a escrita desses dois programas, literalmente anotando listas de n√∫meros que o int√©rprete pode entender. Para dar uma id√©ia de qu√£o leg√≠vel √© esse bytecode, demonstrarei as instru√ß√µes reais usadas no programa de exemplo que move um ponto pela tela:</font></font><br>
<br>
<blockquote><code><pre>// TODO: Write/read all untyped... data to/from ROM
  int untypedGamestate[] = {
    0, // Previous time, to keep track of game time/framerate.
    0, // Player position x.
    0, // Player position y.
    0, // Player R color value.
    0, // Player G color value.
    255, // Player B color value.
  };
  int untypedValues[][3] = {
    // ID, Type, Value
    {0, 0, 0}, // Move up button value 
    {1, 0, 1}, // Move right button value
    {2, 0, 2},  // Move down button value
    {3, 0, 3},  // Move left button value
    {4, 3, 1},  // True/1
    {5, 3, 0},  // False/0
    {6, 4, 0},  // Current millis since game start
    {7, 2, 0},  // Gamestate previous time
    {8, 2, 1},  // Gamestate player x
    {9, 2, 2},  // Gamestate player y
    {10, 2, 3}, // Gamestate player r color
    {11, 2, 4}, // Gamestate player g color
    {12, 2, 5}, // Gamestate player b color
    {13, 3, 1}, // Move player up after button press boundary check
    {14, 1, 0}, // System config screen width
    {15, 1, 1}, // System config screen height
    {16, 3, 3}, // Move player down after button press boundary check
    {17, 3, 5}, // Move player left after button press boundary check
    {18, 3, 7}, // Move player right after button press boundary check
  }
  int untypedCalculations[][5] = {
    // ID, ending, valueLeftID, calculationRightID, calculationOperator
    {0, 0, 9, 1, 1}, // Current player y position - 1
    {1, 1, 4, 0, 0}, // True/1
    {2, 1, 0, 0, 0}, // Up button
    {3, 1, 2, 0, 0}, // Down button
    {4, 1, 5, 0, 0}, // False/0
    {5, 1, 9, 0, 0}, // Current player y position
    {6, 0, 15, 1, 1} // screenheight - 1
    {7, 0, 9, 1, 0}, // Current player y position + 1
    {8, 1, 3, 0, 0}, // Left button
    {9, 1, 1, 0, 0}, // Right button
    {10, 1, 8, 0, 0}, // Current player x position
    {11, 0, 8, 1, 0}, // Current player x position + 1
    {12, 0, 8, 1, 1}, // Current player x position - 1
    {13, 0, 14, 1, 1} // screenwidth - 1
  }
  int untypedInstructions[][10] = {
    // ID, rootInstruction, conditionCalculationLeftID, conditionCalculationRightID, conditionOperator, conditionSuccesValueLeftID,
    // conditionSuccessCalculationRightID, hasFailedCondition, conditionFailedValueLeftID, conditionFailedCalculationRightID
    {0, 1, 2, 1, 0, 13, 0, 0, 0, 0}, // move player up when up button is pressed.
    {1, 0, 5, 4, 1, 9, 0, 0, 0, 0}, // move the player up when the boundary is not reached.
    {2, 1, 3, 1, 0, 16, 0, 0, 0, 0}, // move player down when down button is pressed. 
    {3, 0, 5, 6, 1, 9, 7, 0, 0, 0} // move the player down when the boundary is not reached.
    {4, 1, 8, 1, 0, 17, 0, 0, 0, 0}, // move player left when left button is pressed.
    {5, 0, 10, 4, 1, 8, 12, 0, 0, 0}, // move the player left when the boundary is not reached.
    {6, 1, 9, 1, 0, 18, 0, 0, 0, 0}, // move player right when right button is pressed.
    {7, 0, 10, 13, 1, 8, 11, 0, 0, 0}, // move the player right when the boundary is not reached.
  };</pre></code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ dedicar algum tempo para estudar cuidadosamente o c√≥digo, poder√° entender como a vers√£o anterior desse int√©rprete funcionou. O princ√≠pio geral do uso de "valores", "c√°lculos" e "instru√ß√µes" √© preservado na vers√£o atual. No entanto, muita coisa mudou. N√£o temos mais uma lista fixa de valores de estados de jogos, agora eles s√£o apenas parte da lista regular de valores. Al√©m disso, separamos as ‚Äúcondi√ß√µes‚Äù das instru√ß√µes. Gra√ßas a isso, podemos reutilizar as instru√ß√µes no c√≥digo, o que reduz o tamanho do arquivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o vamos entrar em detalhes do int√©rprete, porque na vers√£o redesenhada, tudo isso mudar√° em breve.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, estamos no est√°gio em que sabemos ler / gravar na EEPROM e podemos executar instru√ß√µes com base em matrizes de n√∫meros comuns. </font><font style="vertical-align: inherit;">O pr√≥ximo passo l√≥gico ser√° remover listas de instru√ß√µes codificadas do c√≥digo e grav√°-las na EEPROM. </font><font style="vertical-align: inherit;">A partir de agora, poderemos tentar ler e executar as instru√ß√µes armazenadas na EEPROM.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99f/787/c14/99f787c142065459798925f8a58105c7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta fase, temos todas as provas da capacidade de trabalho dos conceitos que precisamos para come√ßar a criar o resultado final! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, cada parte individual do prot√≥tipo que criamos ainda exige muito trabalho. </font><font style="vertical-align: inherit;">Mas, na minha opini√£o, as tarefas mais dif√≠ceis j√° foram resolvidas. </font><font style="vertical-align: inherit;">Tudo o que eu precisava fazer era desenvolver o que j√° tinha. </font><font style="vertical-align: inherit;">Tudo √© simples!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conjunto de exibi√ß√£o de LED</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9d/661/fa9/f9d661fa96cd940cd19d0dd4c0f49930.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Demorou muito trabalho para montar a tela. Muito trabalho. Comecei por ter que soldar fios em 42 tiras separadas. Cada tira requer tr√™s fios de um lado e dois do outro. Ou seja, apenas cerca de 200 fios. Antes deste projeto, eu n√£o tinha muita pr√°tica em solda, ent√£o voc√™ pode perceber claramente que quanto mais eu fa√ßo solda, mais forte √© a qualidade. Obviamente, no final, tive que refazer muitas das primeiras faixas de LED, porque n√£o gostei do resultado. Tudo isso faz parte do processo de aprendizado!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ec/9b3/604/2ec9b36040aadbe6007c8d3e7bf20d34.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo passo: conectamos todas as tiras de LED a um grande painel de madeira. Olhando para tr√°s, acho que talvez por uma melhor condutividade t√©rmica tenha valido a pena usar uma folha de metal, porque depois de uma hora de opera√ß√£o a tela agora fica quente (40-50 ¬∞ C). Mas isso ainda n√£o acontece com tanta frequ√™ncia, por isso n√£o √© um grande problema. No entanto, se eu decidisse repetir o projeto, corrigiria esse aspecto.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ba/7b3/ebd/0ba7b3ebdd11e0349049d5bbf6c04761.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, conectamos fios de di√¢metro maior aos condutores positivos e negativos das tiras de LED. Devemos garantir que os fios de grande di√¢metro suportem de forma confi√°vel uma corrente m√°xima de 100 A. Para prote√ß√£o adicional, tamb√©m adicionamos fus√≠veis de 15 A a cada parte da tela.Neste </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
est√°gio, estamos prontos para fazer as primeiras tentativas de controlar a tela. Depois de muitas falhas e manipula√ß√µes com par√¢metros e fios de software, finalmente consegui exibir uma √∫nica cor no monitor sem distor√ß√£o e interfer√™ncia. Demorou muito tempo e o resultado ainda estava longe de ser perfeito. Por um longo tempo, eu ainda tive problemas com sinais distorcidos at√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postar uma pergunta sobre isso em electronics.stackexchange.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pessoas excelentes deste site me ajudaram a diagnosticar o problema. </font><font style="vertical-align: inherit;">Ainda n√£o entendi completamente do que se tratava, mas, conectando os condutores negativos diretamente ao longo dos barramentos de dados, desde o aterramento do MK ao terminal de aterramento pr√≥ximo √† entrada de dados, consegui resolv√™-lo. </font><font style="vertical-align: inherit;">Desde ent√£o, n√£o tive problemas com distor√ß√µes na tela.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78d/f76/e76/78df76e76fa5ca0494056dc1b7546e8c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como vimos na ilustra√ß√£o acima, duas camadas de material s√£o sobrepostas nas tiras de LED. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como material para este revestimento, precisamos de algo forte, transparente, mas disperso. </font><font style="vertical-align: inherit;">No entanto, eu n√£o queria usar o vidro porque √© caro e fr√°gil. </font><font style="vertical-align: inherit;">Por isso, decidi usar um poliestireno transparente padr√£o. </font><font style="vertical-align: inherit;">Para que ele dispersasse a luz, eu a tratei com uma lixa fina a tal ponto que era imposs√≠vel olhar atrav√©s dela. </font><font style="vertical-align: inherit;">Tudo √© muito simples.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito mais tempo foi gasto na cria√ß√£o de uma grade que seria localizada diretamente em cima das tiras. Pensei em encomendar uma grade com os par√¢metros necess√°rios, mas eles me chamaram de um pre√ßo de cerca de 500 euros. Na minha opini√£o, ela n√£o valia a pena. Portanto, eu tive que coletar n√≥s mesmos. Para isso, precisamos de tiras de pl√°stico brancas finas (com no m√°ximo 2 mm de espessura), dur√°veis ‚Äã‚Äãe opacas. Muitos requisitos. Portanto, a sele√ß√£o do material certo levou muito tempo. Como se viu, listras de persianas s√£o ideais.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4d/069/ecc/c4d069ecc77f2597d1e5093b225333c2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, fizemos um suporte pequeno para fazer cortes uniformes e uniformes em faixas largas. Neste caso, foram obtidas tiras de pl√°stico bastante pequenas. Ent√£o precis√°vamos fazer incis√µes no meio de cada faixa exatamente nos lugares certos. Isso √© necess√°rio para conectar os peda√ßos de pl√°stico e montar a grade. √â o que fa√ßo na terceira foto. Antes de fazer isso, verifique se a largura da serra √© a mesma ou um pouco maior que a largura da tira que voc√™ cortou. Caso contr√°rio, a grade n√£o pode ser montada. No meu caso, descobriu-se que uma serra para metal tem uma espessura ideal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na quarta foto, o resultado da montagem de todas as tiras na grade √© vis√≠vel. </font><font style="vertical-align: inherit;">Era um trabalho muito chato e mon√≥tono, mas a grade acabou sendo muito dur√°vel. </font><font style="vertical-align: inherit;">Em geral, parece que todas as c√©lulas t√™m o mesmo tamanho. </font><font style="vertical-align: inherit;">N√£o h√° muita varia√ß√£o entre os tamanhos das c√©lulas; caso contr√°rio, a tela pareceria estranha, ent√£o tudo ficou muito bom. </font><font style="vertical-align: inherit;">Estou satisfeito com esta grelha.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e5/c98/a63/3e5c98a63af67f3ba0102a455a939724.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois coloquei a grade em uma moldura de madeira que executava v√°rias tarefas. </font><font style="vertical-align: inherit;">Primeiro, ela segura uma folha de poliestireno no topo da grelha. </font><font style="vertical-align: inherit;">Ele garante que a grade n√£o se mova. </font><font style="vertical-align: inherit;">Al√©m disso, uma moldura de madeira pressiona todos os fios para que prendam com mais seguran√ßa e n√£o possam se soltar acidentalmente (o que aconteceu algumas vezes quando mudei a tela).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/817/19a/c01/81719ac01006db1add78e0f394d1fffb.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta fotografia mostra uma folha de poliestireno lixada colocada em uma gradinha. </font><font style="vertical-align: inherit;">Observe que a grade agora est√° quase invis√≠vel, e √© isso que quer√≠amos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3eb/a69/4e8/3eba694e869e4fc489af81f01c6de832.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de passar longas horas experimentando a implementa√ß√£o correta do controle de exibi√ß√£o, finalmente conseguimos faz√™-lo funcionar. Um enorme problema foi a preserva√ß√£o da integridade dos sinais. Mas como eu disse acima. A comunidade de electronics.stackexchange me ajudou com isso! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tela √© brilhante, muito mais brilhante do que eu esperava. Era necess√°rio prever isso, solicitando uma unidade de 100 A para sua fonte de alimenta√ß√£o.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0a/092/371/a0a09237152f40f6ce6cb24aaa8d3e89.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu j√° disse v√°rias vezes, usamos a biblioteca FastLED para controlar os LEDs. </font><font style="vertical-align: inherit;">Mas n√£o mencionei o fato de que tamb√©m uso uma vers√£o modificada da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca FastLED-GFX de </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J√ºrgen Skrocki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (que √© uma porta da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adafruit-GFX-Library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">para renderiza√ß√£o simples de figuras no visor </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As altera√ß√µes nesta biblioteca s√£o pequenas, mas foram necess√°rias para que o int√©rprete pudesse se comunicar com a biblioteca de uma maneira conveniente.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√©rebros e ...</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das √∫ltimas tarefas t√©cnicas que precisam ser resolvidas para concluir este projeto √© a conclus√£o do c√©rebro do console. Voc√™ precisa transform√°-los em um conjunto conveniente e compacto. Mas primeiro precisamos descobrir como lidar com todos os sinais de entrada dos players. Deixe-me lembr√°-lo de que cada jogador possui 4 bot√µes e um joystick. Isso √© um total de 16 sinais de entrada digital e 8 anal√≥gicos. O MK nunca possui contatos suficientes para tal entrada; al√©m disso, dois pinos do barramento de dados j√° s√£o usados ‚Äã‚Äãpara ler a EEPROM e 7 pinos do barramento de dados paralelos s√£o necess√°rios para controlar a exibi√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver esse problema, usamos um par de registradores de deslocamento para entrada digital. E para todas as entradas anal√≥gicas, usaremos um multiplexador anal√≥gico.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be4/362/3d4/be43623d4bc69b23ee153bf4e0fc191b.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquema para leitura / grava√ß√£o simult√¢nea de EEOPROM, processamento de entrada do player e controle de exibi√ß√£o.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E ent√£o a confus√£o come√ßa. Deixe-me explicar o que est√° acontecendo nesta foto, da esquerda para a direita. No topo da t√°bua de p√£o esquerda, h√° 7 barramentos de dados usados ‚Äã‚Äãpara controlar a exibi√ß√£o. Abaixo est√° a √°rea em que a EEPROM pode ser inserida e onde √© lida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No topo da t√°bua de p√£o do meio, h√° um multiplexador anal√≥gico. Este multiplexador pode receber at√© 16 sinais de entrada anal√≥gicos e, dependendo dos sinais de entrada no multiplexador, conecte um dos sinais anal√≥gicos ao MK. Portanto, precisamos apenas de um pino de entrada anal√≥gica e um par de pinos de entrada digital para processar 16 entradas anal√≥gicas. Parece que nenhuma entrada anal√≥gica est√° conectada ao multiplexador nesta foto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sob o multiplexador √© MK Teensy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na placa de ensaio correta, processamos sinais de entrada digital. Nesta foto, 16 sinais digitais s√£o simplesmente conectados ao terra. Eu ainda estava esperando os bot√µes chegarem, ent√£o testei todos os 16 sinais digitais dessa maneira. Gra√ßas aos registros de deslocamento, foram necess√°rios apenas 4 pinos para controlar todos os sinais digitais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo o sistema √© um enorme caos n√£o confi√°vel. </font><font style="vertical-align: inherit;">√â necess√°rio torn√°-lo mais compacto para que n√£o se afaste de uma expira√ß√£o descuidada. </font><font style="vertical-align: inherit;">Portanto, pedi v√°rias placas de prototipagem e comecei a soldar novamente!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/351/a13/ea7/351a13ea70ae3f30f125304080770dcc.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e86/af8/04c/e86af804cc17b0925735084d862a2204.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E isso acabou sendo uma tarefa dif√≠cil! </font><font style="vertical-align: inherit;">No entanto, essa foi uma excelente ocasi√£o para aprender a soldar com precis√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para criar esse circuito, usei como exemplo o caos dos fios na t√°bua de p√£o. </font><font style="vertical-align: inherit;">Depois, tentei criar um circuito mais inteligente, para que os componentes que deveriam se comunicar fossem o mais pr√≥ximo poss√≠vel. </font><font style="vertical-align: inherit;">Ent√£o, tentei me livrar da necessidade de puxar muitos fios. </font><font style="vertical-align: inherit;">Agora acho que voc√™ poderia usar algumas ferramentas de modelagem para projetar o circuito. </font><font style="vertical-align: inherit;">Mas ainda assim ficou muito bem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu decidi projetar um circuito de duas camadas. Na placa prot√≥tipo inferior, todas as entradas s√£o processadas. Em cada uma das 4 conex√µes de entrada, tenho 8 linhas de entrada (1 - terra, 1 - positiva, 4 - entrada digital, 2 - entrada anal√≥gica). O MK se comunica com a camada inferior usando quatro conex√µes pr√≥ximas aos registradores de deslocamento e quatro conex√µes pr√≥ximas ao multiplexador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fonte de alimenta√ß√£o est√° localizada na camada superior, √† direita, existem 7 barramentos de dados de sa√≠da para a tela e, na parte inferior, h√° contatos para a leitura da EEPROM. E, finalmente, no centro, √© claro, est√° o microcontrolador.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e36/b63/416/e36b63416aa9c6b7cfad5c3c3f3918e7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre as placas de controle principais e a entrada dos jogadores, coloquei placas intermedi√°rias para reduzir o n√∫mero de fios necess√°rios em ambos os lados de 12 para 8, porque n√£o √© necess√°rio usar todos os 5 fios terra que v√£o da placa principal √† placa de entrada. </font><font style="vertical-align: inherit;">Um aterramento √© suficiente para todos os bot√µes e o joystick. </font><font style="vertical-align: inherit;">Portanto, existem quatro dessas placas intermedi√°rias. </font><font style="vertical-align: inherit;">Gosto que voc√™ perceba uma melhoria na qualidade de cada pr√≥ximo painel que coletar.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d4/6b0/5ab/6d46b05abd9ced550837adb796becb9e.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como nunca recebi os bot√µes encomendados, encomendei outro conjunto de outro vendedor e depois de alguns dias recebi-o. </font><font style="vertical-align: inherit;">Isso nos permitiu finalmente come√ßar a testar todos os bot√µes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd3/083/a72/fd3083a7252ec45ff226ccaf9c3ee18a.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta fase, tamb√©m escrevi o primeiro jogo que pode ser jogado no console. Sim, agora eu chamo de console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consegui porque, no processo de trabalhar na tela, aprimorei simultaneamente o int√©rprete. Em particular, eu consegui melhorar o pr√≥prio processo de desenvolvimento ao escrever c√≥digo. Esse processo n√£o √© t√£o interessante externamente, por isso decidi n√£o o documentar particularmente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6f/fed/54f/a6ffed54fd1a461d601e1424ccf9de2d.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criei um ambiente de desenvolvimento simples para escrever c√≥digo que pode ser executado no console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse ambiente funciona em um navegador e permite escrever c√≥digo para o console sem mexer nas listas ca√≥ticas de n√∫meros que vimos acima. </font><font style="vertical-align: inherit;">Al√©m disso, criei um emulador de console que √© executado no mesmo aplicativo da web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A capacidade de emular jogos para o console em um aplicativo da Web economizou muito tempo, porque a depura√ß√£o em um PC √© muito mais f√°cil do que em um MK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O emulador n√£o √© perfeito. </font><font style="vertical-align: inherit;">Existem alguns erros que distinguem a emula√ß√£o da reprodu√ß√£o em uma vers√£o real do console. </font><font style="vertical-align: inherit;">Tentarei elimin√°-los no futuro quando escrever uma nova vers√£o do int√©rprete. </font><font style="vertical-align: inherit;">A necessidade de suportar duas vers√µes do int√©rprete (uma escrita em C ++ e a outra em TS) foi um pouco irritante, mas valeu a pena.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juntando tudo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo est√° pronto. </font><font style="vertical-align: inherit;">Podemos exibir imagens com base na l√≥gica do jogo tirada da EEPROM e processar a entrada do jogador a partir de bot√µes e joysticks. </font><font style="vertical-align: inherit;">Agora precisamos combinar tudo isso em um dispositivo dur√°vel.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df9/c7a/ebc/df9c7aebc3b77c16e5332a91ea52c04a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comecei fazendo furos nas placas de alum√≠nio que prendem os bot√µes e os joysticks no lugar. </font><font style="vertical-align: inherit;">Em seguida, foi poss√≠vel inserir essas placas nas ranhuras da caixa de madeira em que estavam convenientemente recuadas. </font><font style="vertical-align: inherit;">Gra√ßas a isso, os jogadores n√£o poder√£o arranhar acidentalmente o metal.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff9/911/305/ff991130552aade0b73c9241f014f781.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/989/61b/d54/98961bd54b0b66591cc5de96b952d17f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Coletamos tudo ao redor da tela e adicionamos pernas dobr√°veis ‚Äã‚Äãconfi√°veis ‚Äã‚Äã(para f√°cil armazenamento). </font><font style="vertical-align: inherit;">As placas de metal pintadas com tinta preta parecem muito bonitas. </font><font style="vertical-align: inherit;">H√° uma sensa√ß√£o de que o projeto est√° realmente avan√ßando para a conclus√£o.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/171/5e8/1ee/1715e81ee0aad78e45735d8354761956.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas √© claro que me enganei ao acreditar que o projeto estava quase completo. </font><font style="vertical-align: inherit;">Aqui est√° a apar√™ncia do console por cerca de um m√™s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Coletamos tudo, entendemos que o bot√£o n√£o funciona. </font><font style="vertical-align: inherit;">Desmontamos novamente, resolvemos o problema com o bot√£o </font><font style="vertical-align: inherit;">Tudo parece funcionar. </font><font style="vertical-align: inherit;">Entendemos que o joystick n√£o funciona. </font><font style="vertical-align: inherit;">Desmonte novamente. </font><font style="vertical-align: inherit;">Mais cedo ou mais tarde, todos os bot√µes e joysticks come√ßam a funcionar. </font><font style="vertical-align: inherit;">Mas ent√£o os LEDs param de funcionar. </font><font style="vertical-align: inherit;">Para corrigi-los, √© necess√°rio desmontar o console inteiro e remontar desde o in√≠cio. </font><font style="vertical-align: inherit;">Isso durou cerca de um m√™s, at√© que finalmente tudo funcionou.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado</font></font></h1><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/N37waS4YijA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/797/f90/9fd/797f909fdad045379aa381c6d005422f.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo est√° pronto! Depois de iniciar o trabalho no projeto, j√° se passaram 3 a 4 meses. Portanto, √© l√≥gico que minha motiva√ß√£o para continuar a melhorar o int√©rprete, pintar a √°rvore e desenvolver novos jogos j√° tenha secado. No momento da reda√ß√£o deste texto, j√° havia um m√™s, quando eu estive envolvido pela √∫ltima vez no projeto. Finalmente ganhei for√ßas para escrever este post documental para mim e para voc√™, meu leitor. Embora eu n√£o espere que algu√©m em s√£ consci√™ncia leia realmente tudo o que escrevi, espero que voc√™ tenha gostado de ver fotos do desenvolvimento gradual do projeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas se voc√™ ler tudo isso, poder√° estar interessado no reposit√≥rio Github do projeto. Claro, todo o meu c√≥digo √© de c√≥digo aberto! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/Arcadable</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Outros planos de desenvolvimento de projetos:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Primeiro, voc√™ precisa criar um cartucho mais bonito para jogar Pong for four, como mostra o √∫ltimo v√≠deo. </font><font style="vertical-align: inherit;">Embora seja um peda√ßo de papel√£o com peda√ßos curvos de papel alum√≠nio, que s√£o usados ‚Äã‚Äãcomo superf√≠cies de contato. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Al√©m disso, quero pintar melhor o console. </font><font style="vertical-align: inherit;">Inicialmente, planejei pint√°-lo com amigos muito experientes que gostam de pintar. </font><font style="vertical-align: inherit;">No entanto, agora devido √† pandemia, isso n√£o √© poss√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Finalmente, como eu disse algumas vezes, vou reescrever o int√©rprete de uma maneira mais eficiente. </font><font style="vertical-align: inherit;">Tamb√©m melhorarei o ambiente de desenvolvimento para facilitar os jogos. </font><font style="vertical-align: inherit;">Atualmente, o design de aplicativos da Web est√° prejudicando a produtividade.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fb/339/925/2fb3399255938735b58a888c18aaaba8.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compensa√ß√£o pela grava√ß√£o de v√≠deos verticais.</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498800/index.html">Como eu ensinei meu computador a jogar Dobble com OpenCV e Deep Learning</a></li>
<li><a href="../pt498808/index.html">Vim com suporte YAML para Kubernetes</a></li>
<li><a href="../pt498814/index.html">Voc√™ falhou em uma pergunta te√≥rica sobre a Seguridade Social e ela acabou com voc√™. Isto √© normal? // Estamos condenados # 3</a></li>
<li><a href="../pt498816/index.html">A verdade, antes de tudo, ou por que o sistema precisa ser projetado com base no dispositivo de banco de dados</a></li>
<li><a href="../pt498820/index.html">Algumas perguntas mais complicadas sobre .NET e C #</a></li>
<li><a href="../pt498826/index.html">SIL e Salesforce</a></li>
<li><a href="../pt498828/index.html">Como o sal de mesa e as prote√≠nas aumentam a sobreviv√™ncia do implante</a></li>
<li><a href="../pt498830/index.html">Hash + cache: otimiza√ß√£o do processamento de fluxo</a></li>
<li><a href="../pt498832/index.html">Vis√£o geral das possibilidades do Qt Creator 4.12 e QBS 1.16 para programar microcontroladores</a></li>
<li><a href="../pt498834/index.html">33 mitaps online da semana. Escolha um ou tenha tempo para tudo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>