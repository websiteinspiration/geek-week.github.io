<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ñ¢Ô∏è üë∑ ü§∞ Distribution de donn√©es dans Apache Ignite üì¨ ü§ê üëåüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="salut! Ce message est une version l√©g√®rement abr√©g√©e de ma conf√©rence √©ponyme lors de la r√©union de la communaut√© Apache Ignite . Vous pouvez regarder...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Distribution de donn√©es dans Apache Ignite</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/gridgain/blog/489962/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salut! </font><font style="vertical-align: inherit;">Ce message est une version l√©g√®rement abr√©g√©e de ma conf√©rence √©ponyme lors de la r√©union de la communaut√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Ignite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regarder la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> version vid√©o compl√®te avec des questions et r√©ponses </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">ici</font></a><font style="vertical-align: inherit;"> , et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©charger les</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diapositives </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">ici</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans le rapport, j'ai essay√© de montrer par des exemples comment les donn√©es sont distribu√©es dans Apache Ignite.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi avez-vous besoin de distribuer quoi que ce soit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un historique assez standard du d√©veloppement de tout syst√®me n√©cessitant le stockage et le traitement de donn√©es est la r√©alisation d'un certain plafond. Soit il y a beaucoup de donn√©es et elles ne sont pas physiquement plac√©es sur le p√©riph√©rique de stockage, soit la charge augmente √† un rythme tel qu'un serveur n'est plus en mesure de traiter un tel nombre de demandes. Il y a des cas fr√©quents o√π les deux se produisent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En r√®gle g√©n√©rale, ils parviennent √† l'une des deux solutions: soit le partage du stockage existant, soit le passage √† une base de donn√©es distribu√©e. Les deux solutions ont un certain nombre de caract√©ristiques communes, la plus √©vidente √©tant l'utilisation de plusieurs n≈ìuds pour travailler avec des donn√©es. De plus, de nombreux n≈ìuds que j'appellerai topologie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me de la distribution des donn√©es entre les n≈ìuds de topologie peut √™tre formul√© comme un ensemble d'exigences auxquelles notre distribution doit satisfaire:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un algorithme est n√©cessaire qui permettra √† tous les n≈ìuds de la topologie et des applications clientes de parvenir √† la m√™me conclusion sur le ou les n≈ìuds sur lesquels l'objet (ou la cl√©) se trouve.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uniformit√© de distribution. </font><font style="vertical-align: inherit;">Plus les donn√©es sont r√©parties uniform√©ment entre les n≈ìuds, plus la charge sur ces n≈ìuds sera r√©partie de mani√®re uniforme. </font><font style="vertical-align: inherit;">Ici, je fais l'hypoth√®se que nos n≈ìuds ont approximativement les m√™mes ressources.</font></font></li>
<li>  .      ,       ,    .   ,       ,       ,     .<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atteindre les deux premi√®res exigences est assez facile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une approche famili√®re, souvent utilis√©e lors de l'√©quilibrage de la charge entre des serveurs fonctionnellement √©quivalents, divisant le module N, o√π N est le nombre de n≈ìuds dans la topologie et nous avons une correspondance biunivoque entre le num√©ro de n≈ìud et son identifiant. Il suffit ensuite de repr√©senter la cl√© de l'objet sous forme de valeur num√©rique √† l'aide d'une fonction de hachage et de prendre le reste de la division par N de la valeur obtenue. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zi/7x/ii/zi7xiiu8xmrjgaeghuc8xkekubk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le diagramme montre la r√©partition de 16 cl√©s sur 3 n≈ìuds. On peut voir que cette distribution est uniforme, et l'algorithme d'obtention du n≈ìud pour l'objet est simple et garantit que si tous les n≈ìuds de la topologie utilisent cet algorithme, alors le m√™me r√©sultat sera obtenu pour la m√™me cl√© et le m√™me N.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais que se passe-t-il si nous introduisons le 4e n≈ìud dans la topologie? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/82/ro/-i/82ro-ipa6d3lw8stb_fx7e9_wos.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre fonction a chang√©, maintenant nous prenons le reste de la division par 4, pas par 3. Et si la fonction a chang√©, alors la distribution a chang√©, et beaucoup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, l'emplacement pr√©c√©dent des objets pour la version pr√©c√©dente de la topologie de trois n≈ìuds est affich√© en rouge et la position des objets pour la nouvelle version de la topologie de quatre n≈ìuds est respectivement verte. C'est tr√®s similaire aux fichiers diff habituels, mais au lieu de fichiers, nous avons des n≈ìuds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est facile de voir que les donn√©es ont √©t√© d√©plac√©es non seulement vers le nouveau n≈ìud, mais √©galement qu'il y a eu un √©change de donn√©es entre les n≈ìuds qui √©taient d√©j√† dans la topologie. Ceux. nous observons un trafic parasite entre les n≈ìuds et l'exigence d'un changement minimal de distribution n'est pas remplie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici deux fa√ßons courantes de r√©soudre le probl√®me de la distribution des donn√©es en tenant compte de ces exigences:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hachage coh√©rent</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plus grand algorithme de poids al√©atoire (HRW), √©galement connu sous le nom de hachage Rendezvous.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces deux algorithmes sont tr√®s simples. </font><font style="vertical-align: inherit;">Leurs descriptions sur Wikip√©dia tiennent en plusieurs phrases. </font><font style="vertical-align: inherit;">Bien qu'il soit difficile de les appeler √©vidents. </font><font style="vertical-align: inherit;">Pour ceux qui sont int√©ress√©s, je recommande de lire les articles originaux </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Name-BasedMapping Scheme for Rendezvous</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le plus compr√©hensible, √† mon avis, l'id√©e d'un algorithme de hachage coh√©rent </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est v√©hicul√©e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">ce cours de Stanford</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons ces algorithmes plus en d√©tail.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hachage coh√©rent</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'astuce sous-jacente √† l'algorithme de hachage coh√©rent consiste √† mapper les n≈ìuds et les objets stock√©s sur le m√™me espace d'identifiant. </font><font style="vertical-align: inherit;">Cela rend nos entit√©s, objets et n≈ìuds apparemment diff√©rents comparables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour obtenir un tel mapping, on applique simplement la m√™me fonction de hachage aux cl√©s des objets et aux identifiants des n≈ìuds. </font><font style="vertical-align: inherit;">Le r√©sultat de la fonction de hachage pour le n≈ìud sera appel√© un jeton, cela nous sera utile plus tard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous repr√©sentons notre espace identifiant sous la forme d'un cercle, c'est-√†-dire </font><font style="vertical-align: inherit;">nous supposons simplement que la valeur d'identifiant maximale suit imm√©diatement la valeur d'identifiant minimale.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, afin de d√©terminer sur quel n≈ìud r√©side l'objet, vous devez obtenir la valeur de la fonction de hachage √† partir de sa cl√©, puis simplement vous d√©placer dans le sens des aiguilles d'une montre autour du cercle jusqu'√† ce que nous rencontrions le jeton d'un n≈ìud sur le chemin. La direction du mouvement est sans importance, mais elle doit √™tre fixe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mouvement imaginaire dans le sens des aiguilles d'une montre est fonctionnellement √©quivalent √† une recherche binaire dans un tableau tri√© de jetons de n≈ìud. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ca/dh/fy/cadhfyrlc9b_maoinnjw0kvp6fm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le diagramme, chaque secteur d'une couleur particuli√®re refl√®te l'espace identifiant dont un n≈ìud particulier est responsable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous ajoutons un nouveau n≈ìud, alors ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v7/an/3r/v7an3r9bwxn9hnziy-w7umr5viq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... il divisera l'un des secteurs en deux parties et reprendra compl√®tement les cl√©s correspondantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, le n≈ìud 3 a repris une partie des cl√©s du n≈ìud 1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, cette approche donne une distribution assez in√©gale des objets entre les n≈ìuds, car il d√©pend fortement des identifiants des n≈ìuds eux-m√™mes. Comment cette approche peut-elle √™tre am√©lior√©e? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez affecter plusieurs jetons aux n≈ìuds (g√©n√©ralement des centaines). Cela peut √™tre r√©alis√©, par exemple, en introduisant de nombreuses fonctions de hachage pour le n≈ìud (une par jeton) ou en appliquant de mani√®re r√©p√©t√©e la m√™me fonction de hachage au jeton obtenu √† l'√©tape pr√©c√©dente. Mais il ne faut pas oublier les collisions. Il ne doit pas y avoir deux n≈ìuds avec le m√™me jeton. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7i/m2/ay/7im2ay5cr_ydc5hh62vlwcaqhp0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, chaque n≈ìud poss√®de 4 jetons.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quoi d'autre est important √† mentionner: si nous voulons garantir la s√©curit√© des donn√©es en cas de sortie d'un n≈ìud de la topologie, nous devons stocker les cl√©s sur plusieurs n≈ìuds (ce que l'on appelle des r√©pliques ou des sauvegardes). </font><font style="vertical-align: inherit;">Dans le cas de l'algorithme de hachage coh√©rent, les r√©pliques seront les N-1 n≈ìuds suivants sur le cercle, o√π N est le facteur de r√©plication. </font><font style="vertical-align: inherit;">Bien s√ªr, l'ordre des n≈ìuds doit √™tre d√©termin√© par un jeton sp√©cifique (par exemple, par le premier), car </font><font style="vertical-align: inherit;">lors de l'utilisation de plusieurs jetons pour chacun d'eux, la disposition des n≈ìuds peut diff√©rer. </font><font style="vertical-align: inherit;">Faites attention au sch√©ma: il n'a pas de sch√©ma clair de r√©p√©tition des n≈ìuds.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant √† l'exigence d'un changement minimal de la distribution lors du changement de topologie, elle est satisfaite car l'ordre mutuel des n≈ìuds sur le cercle est inchang√©. </font><font style="vertical-align: inherit;">Ceux. </font><font style="vertical-align: inherit;">la suppression d'un n≈ìud de la topologie ne changera pas la relation d'ordre entre les n≈ìuds restants.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hachage de rendez-vous</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme de hachage Rendezvous semble encore plus simple que le hachage coh√©rent. L'algorithme est bas√© sur le m√™me principe d'invariance des relations d'ordre. Mais au lieu de rendre les n≈ìuds et les objets comparables, nous ne faisons que des n≈ìuds pour un objet sp√©cifique. Ceux. nous d√©terminons la relation d'ordre entre les n≈ìuds pour chaque objet ind√©pendamment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une fois, le hachage nous aide. Mais maintenant, afin de d√©terminer le poids du n≈ìud N pour un objet O donn√©, nous m√©langeons l'identifiant de l'objet avec l'identifiant du n≈ìud et prenons le hachage de ce m√©lange. Apr√®s avoir effectu√© cette op√©ration pour chaque n≈ìud, nous obtenons un ensemble de poids selon lequel nous trions les n≈ìuds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le n≈ìud qui s'est av√©r√© √™tre le premier et sera responsable du stockage de l'objet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que tous les n≈ìuds de la topologie utilisent les m√™mes donn√©es d'entr√©e, le r√©sultat pour eux sera identique. Ce qui satisfait la premi√®re exigence. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ox/hs/bw/oxhsbwgq8xrlfrirs8xupmx3hww.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons un exemple. Ici, nous avons une relation d'ordre entre trois n≈ìuds pour quatre cl√©s diff√©rentes. Le jaune indique le n≈ìud avec le poids le plus √©lev√©, c'est-√†-dire le n≈ìud qui sera finalement responsable d'une cl√© particuli√®re. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez un autre n≈ìud √† la topologie.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/a9/4s/hca94sz_p5pz-lwflppuqlm7c54.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je l'ai d√©lib√©r√©ment plac√© sur la diagonale pour prendre en compte toutes les options possibles. Ici, le n≈ìud 3, affich√© en vert, est entr√© dans la topologie. Par cons√©quent, la r√©partition du poids des n≈ìuds pour chacune des cl√©s a chang√©. Le rouge indique les n≈ìuds qui ont chang√© leur emplacement dans la liste pour une cl√© particuli√®re, car les poids de ces n≈ìuds √©taient inf√©rieurs au poids du n≈ìud ajout√©. Cependant, cette modification n'a affect√© qu'une seule des cl√©s, K3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©rivons perfidement un n≈ìud d'une topologie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ds/gr/d_/dsgrd_q9ai9yi9p5x08ubfgflem.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une fois, les changements n'ont affect√© qu'une seule touche, cette fois K1. Les objets restants n'ont pas √©t√© affect√©s. La raison, comme dans le cas du hachage coh√©rent, est l'invariance de la relation d'ordre entre n'importe quelle paire de n≈ìuds. Ceux. l'exigence d'un changement minimal de distribution est satisfaite et il n'y a pas de trafic parasite entre les n≈ìuds.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La distribution des rendez-vous semble assez bonne et ne n√©cessite pas de trucs suppl√©mentaires par rapport au hachage coh√©rent comme les jetons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cas o√π nous voulons prendre en charge la r√©plication, le n≈ìud suivant de la liste sera le premier r√©plica de l'objet, le n≈ìud suivant sera le deuxi√®me r√©plica, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation du hachage de rendez-vous dans Apache Ignite</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction dite d'affinit√© est responsable de la distribution des donn√©es dans Apache Ignite (voir l'interface </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AffinityFunction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). L'impl√©mentation par d√©faut est le hachage de rendez-vous (voir la classe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RendezvousAffinityFunction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose √† laquelle vous devez faire attention est qu'Apache Ignite ne mappe pas directement les objets stock√©s aux n≈ìuds de topologie. Au lieu de cela, un concept suppl√©mentaire est introduit - la partition. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une partition est un conteneur d'objets et une unit√© de r√©plication. De plus, le nombre de partitions pour un cache particulier (il s'agit d'un analogue de la table dans les bases de donn√©es famili√®res) est d√©fini au stade de la configuration et ne change pas pendant le cycle de vie du cache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous pouvons afficher des objets sur des partitions en utilisant une division modulo efficace, et utiliser le hachage de rendez-vous pour afficher des partitions sur des n≈ìuds. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wd/wr/vt/wdwrvtuau9ywcgq4uqk0hhqscu8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce que le nombre de partitions pour le cache est une constante, alors nous pouvons calculer la distribution de partition par n≈ìuds une fois et mettre en cache le r√©sultat jusqu'√† ce que la topologie soit modifi√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque n≈ìud calcule cette distribution ind√©pendamment, mais sur tous les n≈ìuds avec les m√™mes donn√©es d'entr√©e, cette distribution sera identique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La partition peut avoir plusieurs copies, nous les appelons des sauvegardes. La partition principale est appel√©e la partition principale.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la meilleure r√©partition des cl√©s entre les partitions et les partitions par n≈ìuds, la r√®gle suivante doit √™tre respect√©e: le nombre de partitions doit √™tre consid√©rablement sup√©rieur au nombre de n≈ìuds, √† son tour, le nombre de cl√©s doit √™tre consid√©rablement sup√©rieur au nombre de partitions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les caches dans Ignite sont partitionn√©s et r√©pliqu√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un cache partitionn√©, le nombre de sauvegardes est d√©fini lors de la cr√©ation du cache. Les partitions - primaires et sauvegardes - sont r√©parties uniform√©ment entre les n≈ìuds. Un tel cache est le mieux adapt√© pour travailler avec des donn√©es op√©rationnelles, comme fournit les meilleures performances d'√©criture, qui d√©pendent directement du nombre de sauvegardes. En g√©n√©ral, plus il y a de sauvegardes, plus les n≈ìuds doivent confirmer l'enregistrement de cl√©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/fs/_u/hhfs_ujczi2m1p8kl4c5z3p2ra4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, le cache a une sauvegarde. </font><font style="vertical-align: inherit;">Ceux. </font><font style="vertical-align: inherit;">nous pouvons perdre un n≈ìud et ne pas perdre de donn√©es, car </font><font style="vertical-align: inherit;">Les sauvegardes de partition ne sont jamais stock√©es sur le m√™me n≈ìud que la partition principale ou son autre sauvegarde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cache r√©pliqu√©, le nombre de sauvegardes est toujours √©gal au nombre de n≈ìuds de topologie moins 1. Autrement dit, </font><font style="vertical-align: inherit;">chaque n≈ìud contient toujours des copies de toutes les partitions. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n-/fk/by/n-fkbyie-hipm40twvyg_erjjm0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tel cache est le mieux adapt√© pour travailler avec des donn√©es rarement modifi√©es (par exemple, des r√©pertoires) et offre la plus grande disponibilit√©, car </font><font style="vertical-align: inherit;">nous pouvons perdre N-1 n≈ìuds (dans ce cas 3) sans perdre de donn√©es. </font><font style="vertical-align: inherit;">Toujours dans cette option, nous obtiendrons des performances de lecture maximales si nous permettons de lire les donn√©es √† la fois des partitions principales et des sauvegardes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colocation de donn√©es dans Apache Ignite</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La collocation est un concept important √† garder √† l'esprit pour de meilleures performances. La colocation est le placement de tout objet au m√™me endroit. Dans notre cas, les objets sont des entit√©s stock√©es dans le cache et un lieu est un n≈ìud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les objets sont distribu√©s par des partitions de la m√™me fonction d'affinit√©, il est logique que les objets avec la m√™me cl√© d'affinit√© tombent dans la m√™me partition, et donc sur le m√™me n≈ìud. Dans Ignite, cela s'appelle la colocation par affinit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par d√©faut, une cl√© d'affinit√© est la cl√© primaire d'un objet. Mais dans Ignite, vous pouvez utiliser n'importe quel autre champ d'un objet comme cl√© d'affinit√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La collocation r√©duit consid√©rablement la quantit√© de donn√©es envoy√©es entre les n≈ìuds pour effectuer des calculs ou des requ√™tes SQL, ce qui entra√Æne naturellement une r√©duction du temps consacr√© √† ces t√¢ches. Consid√©rez ce concept par l'exemple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit notre mod√®le de donn√©es compos√© de deux entit√©s: ordre (Order) et position de l'ordre (OrderItem). Une commande peut correspondre √† de nombreux articles. Les identifiants de commande et d'√©l√©ment de campagne sont ind√©pendants, mais l'√©l√©ment de campagne poss√®de une cl√© √©trang√®re qui fait r√©f√©rence √† la commande correspondante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que nous devons effectuer une t√¢che qui, pour chaque commande, doit effectuer des calculs pour les positions de cette commande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par d√©faut, une cl√© d'affinit√© est une cl√© primaire. Par cons√©quent, les ordres et les positions seront r√©partis entre les n≈ìuds conform√©ment √† leurs cl√©s primaires, qui, je le rappelle, sont ind√©pendantes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tk/q-/vq/tkq-vq1_sbghpcqdsz8ythpehim.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le diagramme, les ordres sont repr√©sent√©s par des carr√©s et des positions en cercles. La couleur indique que l'article appartient √† la commande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cette distribution de donn√©es, notre t√¢che hypoth√©tique sera envoy√©e au n≈ìud o√π se trouve l'ordre souhait√©, puis elle devra lire les positions de tous les autres n≈ìuds, ou envoyer une sous-t√¢che √† ces n≈ìuds et obtenir le r√©sultat du calcul. Il s'agit d'une interaction r√©seau inutile qui peut et doit √™tre √©vit√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si nous disons √† Ignite que les articles de la commande doivent √™tre plac√©s sur les m√™mes n≈ìuds que les commandes elles-m√™mes, c'est-√†-dire collecter des donn√©es? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme cl√© d'affinit√© pour la position, nous prendrons la cl√© √©trang√®re OrderId et ce champ sera utilis√© lors du calcul de la partition √† laquelle appartient l'enregistrement. De plus, √† l'int√©rieur de la partition, nous pouvons toujours trouver notre objet par la cl√© primaire.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lv/uq/kg/lvuqkgzf9gpoot8gjnr25uxb6ve.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, si les deux caches (Order et OrderItem) utilisent la m√™me fonction d'affinit√© avec les m√™mes param√®tres, nos donn√©es seront √† proximit√© et nous n'aurons pas besoin de faire le tour du r√©seau pour les articles command√©s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration d'affinit√© dans Apache Ignite</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'impl√©mentation actuelle, un objet de fonction d'affinit√© est un param√®tre de configuration de cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction d'affinit√© elle-m√™me prend les arguments suivants lors de la cr√©ation:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nombre de partitions;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nombre de sauvegardes (en fait, c'est aussi le param√®tre de configuration du cache);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtre de sauvegarde;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flag excludeNeighbors.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces param√®tres ne peuvent pas √™tre modifi√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec le nombre de partitions et de sauvegardes, tout semble clair. Je parlerai du filtre de sauvegarde et du drapeau excludeNeighbors un peu plus tard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au moment de l'ex√©cution, la fonction d'affinit√© d'entr√©e re√ßoit la topologie de cluster actuelle - essentiellement une liste de n≈ìuds de cluster - et calcule la distribution de partition par n≈ìuds selon les exemples que j'ai montr√©s lorsque j'ai parl√© de l'algorithme de hachage de rendez-vous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant au filtre de sauvegarde, il s'agit d'un pr√©dicat qui vous permet d'interdire aux fonctions d'affinit√© d'affecter des partitions de sauvegarde √† un n≈ìud pour lequel le pr√©dicat a renvoy√© false. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, supposons que nos n≈ìuds physiques - serveurs - sont situ√©s dans le centre de donn√©es dans des racks diff√©rents. En r√®gle g√©n√©rale, chaque rack a sa propre alimentation ind√©pendante ...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5e/ts/wy/5etswypgpotv2e9exzu3gsyl9f8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... et si nous perdons le rack, nous perdons les donn√©es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/hy/5d/nzhy5dzl77t7pxhtxbtqubcbzek.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, nous avons perdu la moiti√© des partitions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais si nous d√©finissons le bon filtre de sauvegarde, la distribution changera de telle mani√®re ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/20/90/gy/2090gyzlg_0-80-dhkw8hvplftm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... que si le rack est perdu, les donn√©es ne seront pas perdues et elles seront toujours disponibles. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oo/eg/k5/ooegk5vas7xhk7qzrergws5ieli.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'indicateur excludeNeighbors remplit une fonction similaire, et en fait c'est une abr√©viation pour un cas sp√©cifique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Souvent, plusieurs n≈ìuds Ignite s'ex√©cutent sur le m√™me h√¥te physique. Ce cas est tr√®s similaire √† l'exemple avec des racks dans le centre de donn√©es, seulement maintenant nous combattons la perte de donn√©es avec la perte de l'h√¥te, pas les racks. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tk/ze/wn/tkzewnmjc5iigjd_appzyvfoheo.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le reste est le m√™me. Vous pouvez impl√©menter ce comportement √† l'aide d'un filtre de sauvegarde. Ce drapeau est un h√©ritage historique et pourrait √™tre supprim√© dans la prochaine version majeure d'Ignite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que j'ai parl√© de la fonction d'affinit√© et de la distribution des donn√©es tout ce qu'un d√©veloppeur utilisant Apache Ignite doit savoir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion, regardons un exemple de r√©partition de 16 partitions selon la topologie de 3 n≈ìuds. Pour plus de simplicit√© et de clart√©, nous pensons que les partitions n'ont pas de sauvegarde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je viens de prendre et d'√©crire un petit test qui m'a apport√© la vraie distribution: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yy/lm/np/yylmnpenoifogzoo0lig3kzw_5g.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, l'uniformit√© de la distribution n'est pas id√©ale. Mais l'erreur sera sensiblement plus faible avec une augmentation du nombre de n≈ìuds et de partitions. La r√®gle principale √† respecter est que le nombre de partitions est nettement sup√©rieur au nombre de n≈ìuds. D√©sormais, dans Ignite, le nombre de partitions par d√©faut pour un cache partitionn√© est 1024. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez maintenant un nouveau n≈ìud √† la topologie.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xd/xf/sp/xdxfspt29ky3x0gfceqi_xiswv0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une partie des parties s'est d√©plac√©e vers lui. Dans le m√™me temps, l'exigence d'un changement minimal de distribution a √©t√© observ√©e: le nouveau n≈ìud a re√ßu une partie des partitions, tandis que les autres n≈ìuds n'ont pas √©chang√© de partitions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous supprimons de la topologie le n≈ìud qui y √©tait pr√©sent √† l'√©tape initiale: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/b5/il/ymb5ilednyy4dxf6ynojfva7gao.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
maintenant toutes les partitions qui √©taient associ√©es au n≈ìud z√©ro ont √©t√© redistribu√©es vers d'autres n≈ìuds de la topologie, sans violer nos exigences de distribution.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, la solution √† des probl√®mes complexes repose souvent sur des id√©es assez banales, quoique pas tout √† fait √©videntes. </font><font style="vertical-align: inherit;">Les solutions d√©crites sont utilis√©es dans la plupart des bases de donn√©es distribu√©es et font du bon travail. </font><font style="vertical-align: inherit;">Mais ces d√©cisions sont al√©atoires et donc l'uniformit√© de la distribution est loin d'√™tre id√©ale. </font><font style="vertical-align: inherit;">L'uniformit√© peut-elle √™tre am√©lior√©e sans sacrifier les performances et autres exigences de distribution? </font><font style="vertical-align: inherit;">La question reste ouverte.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489952/index.html">Fonds d'√©cran anim√©s et motivants</a></li>
<li><a href="../fr489954/index.html">Seagate SkyHawk AI - √©norme et vindicatif</a></li>
<li><a href="../fr489956/index.html">Nous animons facilement RecyclerView sans passer √† ViewPager2</a></li>
<li><a href="../fr489958/index.html">Explication: pourquoi le wc sur Haskell s'est av√©r√© ¬´plus rapide¬ª que l'analogue sur C</a></li>
<li><a href="../fr489960/index.html">Construction automatis√©e d'une application Delphi</a></li>
<li><a href="../fr489968/index.html">Nous captons la d√©gradation des piles AA et AAA √† des courants de 0,3 √† partir de la capacit√©</a></li>
<li><a href="../fr489970/index.html">Programmeur, Pack et John Steinbeck</a></li>
<li><a href="../fr489974/index.html">Kha vs HTML5: Compiler JavaScript en C ++</a></li>
<li><a href="../fr489984/index.html">AMA √† propos d'Udalenka: demandez - nous r√©pondons</a></li>
<li><a href="../fr489986/index.html">Utilitaire Power Stage Designer - Power Developer Developer Tool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>