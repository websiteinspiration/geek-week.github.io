<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§πüèª ‚ÑπÔ∏è ‚ôâÔ∏è Trolley Robot 2.0. Part 1. Autonomous navigation of a home robot based on ROS üèõÔ∏è ü¶Ñ üöè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The project was built on the basis of another well-known project in its circles - linorobot (linorobot.org), using components available to a simple la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Trolley Robot 2.0. Part 1. Autonomous navigation of a home robot based on ROS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502076/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The project was built on the basis of another well-known project in its circles - linorobot (linorobot.org), using components available to a simple layman. </font><font style="vertical-align: inherit;">The goals that were set: to achieve autonomous movement of the robot at home using low-cost components, to evaluate the performance of mini-PCs for the stated purposes, to configure the navigation stack to move in the narrow spaces of the Khrushchev.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OGxB34-heds" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iron</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The list of components in the solids is as follows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raspberry pi 3b - 2800 r.;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lidar rplidar a1 - 7500 p.;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">power bridges l298n -2pcs - 400 rub .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wheelset with encoders of type A and B - 2000 r. </font><font style="vertical-align: inherit;">(210 rpm - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teenzy 3.2 - 2100 r .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imu 9250 (either 9150 or 6050) - 240 p.;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">power bank at 10000mH - 1500 r.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 batteries 18650 and holder -600 p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step-down converter dc-dc c 5V to 3.3V - 20p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a piece of plywood, parquet -? </font><font style="vertical-align: inherit;">rub.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total: 17160 p. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* The cost can be reduced by replacing teenzy with arduino mega 2560 (600 p.), And lidar by replacing kinect v.1 (1000 p.): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/vb/v4/ecvbv42ipnldzd5vhureodavsqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, it should be noted that the first kinect has a minimum visibility (blind area) of 0.5 m, which can negatively affect navigation in cramped conditions and it is rather bulky. </font><font style="vertical-align: inherit;">The lidar has a blind zone of less than 0.2 m. Kinect v.2 will not fit raspberry 3b (it does not have usb 3.0). </font><font style="vertical-align: inherit;">Arduino mega is inferior to teenzy in size (and some characteristics), in addition, you will have to slightly rework the code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, the ‚Äúdesign‚Äù looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ou/ru/x9/ourux9icibrxsh4ruai61e3wkx4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yg/bh/0h/ygbh0hlvz8juq6qi4e9tarrhznq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is no beauty here, of course, but this is not about it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the robot itself, it is highly desirable to have an external PC on which graphical shells for visualizing the actions of the robot (rviz, gazebo) will be launched.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robot assembly</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is painted in detail on the project website - a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , so let us dwell on the points that cause difficulties. </font><font style="vertical-align: inherit;">First you need to consider that the encoders on the wheelset are powered by 3.3V and, when 5V is applied, fail perfectly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The linorobot installation script is successfully installed on ubuntu 16.04, ubuntu 18.04. </font><font style="vertical-align: inherit;">ROS versions: ROS kinetic or ROS melodic. </font><font style="vertical-align: inherit;">On raspberry 3b, you must first create a swap file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main teenzy code is along the way:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware/lib/config<font></font>
nano lino_base_config.h<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And poured into it with the command:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware<font></font>
platformio run --target upload<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The above bundles of commands will be used quite often, so it makes sense to add them to aliases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Because of the difficulties in assembling the robot, the correct correlation of connected contacts going from l298n to teenzy can be troublesome. </font><font style="vertical-align: inherit;">Despite the extremely clear connection diagram, the wheels can behave differently and have to experiment, choosing the correct pin assignment in the code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In my case, it turned out like this:</font></font><br>
<br>
<pre><code class="bash hljs">/// ENCODER PINS
<span class="hljs-comment">#define MOTOR1_ENCODER_A 14</span>
<span class="hljs-comment">#define MOTOR1_ENCODER_B 15 </span><font></font>
<font></font>
<span class="hljs-comment">#define MOTOR2_ENCODER_A 11</span>
<span class="hljs-comment">#define MOTOR2_ENCODER_B 12 </span><font></font>
//MOTOR PINS<font></font>
<span class="hljs-comment">#ifdef USE_L298_DRIVER</span>
  <span class="hljs-comment">#define MOTOR_DRIVER L298</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR1_PWM 21</span>
  <span class="hljs-comment">#define MOTOR1_IN_A 1</span>
  <span class="hljs-comment">#define MOTOR1_IN_B 20</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR2_PWM 5</span>
  <span class="hljs-comment">#define MOTOR2_IN_A 8</span>
  <span class="hljs-comment">#define MOTOR2_IN_B 6</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second point is to prescribe the specification of the robot wheels:</font></font><br>
<br>
<pre><code class="bash hljs">//define your robot<span class="hljs-string">' specs here
#define MAX_RPM 210               // motor'</span>s maximum RPM
<span class="hljs-comment">#define COUNTS_PER_REV 1365       // wheel encoder's no of ticks per rev</span>
<span class="hljs-comment">#define WHEEL_DIAMETER 0.065       // wheel's diameter in meters</span>
<span class="hljs-comment">#define PWM_BITS 8                // PWM Resolution of the microcontroller</span>
<span class="hljs-comment">#define LR_WHEELS_DISTANCE 0.235  // distance between left and right wheels</span>
<span class="hljs-comment">#define FR_WHEELS_DISTANCE 0.30   // distance between front and rear wheels. Ignore this if you're on 2WD/ACKERMANN</span>
<span class="hljs-comment">#define MAX_STEERING_ANGLE 0.415  // max steering angle. This only applies to Ackermann st</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPM can be found in the wheel specification, but CPR (COUNTS_PER_REV) is the calculated value. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPR = PPR x 4. PPR of our wheels 341. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* PPR can either be viewed in the specification or run the code on the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">roslaunch linorobot minimal.launch robot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and spin the wheel 360 degrees. PPR will be equal to the numerical value that will be displayed on the screen after wheel rotation: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/7z/ks/be7zksecqhlyuyv-e_dkxqdyrwe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* PPR = abs (RECENT_COUNT - INITIAL_COUNT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So CPR = 1364. You also need to set WHEEL_DIAMETER and LR_WHEELS_DISTANCE in meters. Moreover, LR_WHEELS_DISTANCE is the distance between the central axles of the wheels, and not from edge to edge. Other indicators can be ignored if the robot is two-wheeled, differential (not omni). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The third point that can cause difficulties - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imu calibration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. To do this, following the instructions, it is necessary to fix the robot in certain positions. The hints will be in the code when executing the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rosrun imu_calib do_calib script</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/fj/9e/ggfj9eg71ilp0baj7rvshjl-fmw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
after completion imu_calib.yaml with settings will be generated. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is better to perform calibration, despite the fact that there is a default file with imu settings. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* In addition, it turned out that imu calibration can affect the direction of movement of the robot through teleop (left instead of right and vice versa, while the movement back and forth was correct). The situation was not solved by rearrangement of pins in the code. Imu itself was fixed and calibrated with upside down brackets, as fixed on the back of the robot base. His (imu) further flip without recalibration solved the problem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fourth point - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pid calibration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the project website, the procedure for how to implement the adjustment is described in detail - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, it will be difficult for a beginner to figure out what it is and how to work with it. </font><font style="vertical-align: inherit;">In general, pid regulation is needed to ensure that the robot moves uniformly, without jerking / sudden braking. </font><font style="vertical-align: inherit;">Three parameters are responsible for this: p, i, d. </font><font style="vertical-align: inherit;">Their values ‚Äã‚Äãare contained in the main code uploaded to teenzy:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define K_P 2.0 // P constant angle</span>
<span class="hljs-comment">#define K_I 0.3 // I constant</span>
<span class="hljs-comment">#define K_D 0.1 // D constant</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can experiment with them by running on the robot:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot minimal.launch
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further on the external PC in three different terminals:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun lino_pid pid_configure<font></font>
rosrun teleop_twist_keyboard teleop_twist_keyboard.py<font></font>
rqt<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By moving the sliders p, d, i in the rqt terminal, and then controlling the robot in the teleop_twist_keyboard terminal, you can achieve the necessary results without having to download the code with the new pid parameters each time in teenzy: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/9m/ef/qr9mefipf7mqz9vwqqyqkktkeug.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, everything happens on the fly and at that time in the firmware teenzy may have completely different meanings. </font><font style="vertical-align: inherit;">* You can not focus on charts, because </font><font style="vertical-align: inherit;">visually, and so it will be understood HOW the robot is traveling. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They recommend starting with setting the values ‚Äã‚Äãp = 1.0, d = 0.1, i = 0.1. </font><font style="vertical-align: inherit;">In our case, the values ‚Äã‚Äãare as follows (obtained experimentally) p = 2.0, i = 0.3, d = 0.1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, these values ‚Äã‚Äãmust be set in the code and filled in teenzy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, do not forget to set in the code (DEBUG 0 instead of DEBUG 1):</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define DEBUG 0</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Odometry</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For orientation of the robot and subsequent navigation, lidar data, imu and wheel encoder data are used. If imu calibration is performed correctly, the lidar is correctly installed, and the encoder values ‚Äã‚Äãare correct, then there should be no problems with odometry. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To check the correctness of odometry, you need to ride a bit on the robot via teleop and see the values ‚Äã‚Äãin the odom topic, this is written on the project page - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And also look into the visual shell of rviz: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rr/td/si/rrtdsilkdlggf3ifjhk1uhl8bz0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One cell in rviz is 1 m, so it is advisable for the robot to pass this meter both in the visual editor and also in kind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, the distance traveled is displayed in the indicator w: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/oj/l6/i1ojl6vg5jyugymjwgk-5cfsrlm.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should also tend to 1 m. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same applies to the rotation angles of the robot:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l0/uf/bv/l0ufbvhsko99na50frablnrvsc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* In rviz and live, the robot must rotate at the same angles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Odometry from a lidar is defined in a similar way - a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link. The</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> distance from the lidar to the nearest wall both live and in rviz should match.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In ROS, special attention is given to transformations - tf. </font><font style="vertical-align: inherit;">In general terms, this concept describes the correlation of objects relative to each other in space. </font><font style="vertical-align: inherit;">So that objects do not hang in the air, and the program understands how they are presented relative to each other, it is necessary to pay attention to the tf setting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the project, all tf connections are already configured relative to each other and you only need to adjust the indicators, for example, indicate how the lidar is located. </font><font style="vertical-align: inherit;">This is necessary for the robot to understand that the obstacle did not arise directly in front of him, but in front of the lidar, which is separated from the center of the robot at a certain distance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's go to the appropriate directory:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch<font></font>
nano bringup.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The base itself is located at a distance of 0.065 m from the floor:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_footprint_to_base_link"</span> args=<span class="hljs-string">"0 0 0.065 0 0 0  /base_footprint /base_link "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In laser.launch, you need to set the location of the lidar relative to the center of the robot base:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch/include<font></font>
nano laser.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In my case, the lidar is shifted along the x axis: -0.08, y: 0.04 and "rises" above the base (z axis): 0.08m:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf2_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_link_to_laser"</span>
args=<span class="hljs-string">"-0.08 0.04 0.08 0 0 0  /base_link /laser "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In rviz, this location can be observed visually: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1v/rz/gj/1vrzgjmhx-gf-jar7jxfbhcovte.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While not far from the lidar, </font><font style="vertical-align: inherit;">we‚Äôll adjust </font><font style="vertical-align: inherit;">its frequency so that it gives out more points (by default it gives 4k), this will help in building the map:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> linorobot/launch/include/lidar<font></font>
nano rplidar.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add parameter:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"scan_mode"</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Boost"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and change </font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"angle_compensate"</span>    <span class="hljs-attr">type</span>=<span class="hljs-string">"bool"</span>   <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now 8k is at our disposal: The </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zf/u0/fq/zfu0fqd4d7nwmuv50am1qhwqxbm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
physical location of the lidar on the robot also matters:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/46/mw/vq/46mwvqq3kj7nxpskvoadm7xe738.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Building a 2d room map</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the project website it is proposed to build a room map by launching in two terminals:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot bringup.launch<font></font>
roslaunch linorobot slam.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, practice has shown that slam, which comes by default with the project, refuses to work when the lidar mode is 8k: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/xa/a5/zexaa5f_1byvgcvvvkvcr7cowbi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
while in 4k mode, the cards are not very successful, they are very noisy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, it is better to use another slam - hector-slam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to install it is indicated </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After installation, the procedure for creating a map will be the same, but instead of roslaunch linorobot slam.launch, run roslaunch my_hector_mapping my_launch.launch </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maps are cleaner, but then they are better to modify in a graphical editor, removing unnecessary ones, especially if the lidar collided with mirrors when building the map : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cn/zo/jv/cnzojvfwpkwgldoo3mylfwwh-yg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not forget to save the room map:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun map_server map_saver -f my-map
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Maps are better obtained in a pleasant twilight, this will squeeze the most out of the budget lidar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To be continued.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502056/index.html">How to Build a Smart Home and Not Go Crazy</a></li>
<li><a href="../en502066/index.html">Simple console commands that everyone should know</a></li>
<li><a href="../en502068/index.html">110 volts on your computer</a></li>
<li><a href="../en502070/index.html">The history of Pentax (article plus video)</a></li>
<li><a href="../en502072/index.html">Docking the ISS using JavaScript and compass</a></li>
<li><a href="../en502080/index.html">Kanban method: Example PNZ No. 1, the measurement-study process in a startup</a></li>
<li><a href="../en502084/index.html">Checking the portal of regional public services under load through puppeteer</a></li>
<li><a href="../en502086/index.html">Setting up Minio so that the user can only work with his bucket</a></li>
<li><a href="../en502088/index.html">A tale of excess and lost time. According to py3</a></li>
<li><a href="../en502092/index.html">Technological and regulatory support for digital trust services in the Russian Federation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>