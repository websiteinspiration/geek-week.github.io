<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😽 💚 👎🏽 Simulation physique de centaines de milliers de particules sur Unity + DOTS ⁉️ 🙍🏻 🆑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="À un moment donné, en me promenant dans les étendues du World Wide Web sur l'un des sites, j'ai trouvé un élément JS interactif - une image composée d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Simulation physique de centaines de milliers de particules sur Unity + DOTS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498630/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À un moment donné, en me promenant dans les étendues du World Wide Web sur l'un des sites, j'ai trouvé un élément JS interactif - une image composée de particules se séparant à l'approche du curseur de la souris. </font><font style="vertical-align: inherit;">Il y avait un désir de programmer une simulation d'un tel comportement sur Unity et de vérifier quelles performances peuvent être retirées du moteur. </font><font style="vertical-align: inherit;">Je partage avec vous les solutions techniques et mes observations reçues lors du processus de mise en œuvre.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nj/dl/cv/njdlcvymmooeqpufewcyt-mzb9m.png" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat est le suivant:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/zi/ik/k3/ziikk35cekb2ju-m5korvwfdj-s.gif"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour y parvenir, vous devez résoudre les problèmes suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">décrire la physique des particules;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assurer la vitesse optimale de calcul de position sur chaque trame;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">choisissez un moyen de dessiner rapidement un grand nombre de particules sur l'écran.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La physique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour décrire le comportement souhaité des particules, nous devons formuler seulement trois principes: le désir de réduire la distance jusqu'au point de départ, le désir de «s'envoler» du curseur de la souris et l'amortissement du mouvement. </font><font style="vertical-align: inherit;">Nous n'avons pas besoin d'interactions physiques et de formules exactes, nous avons seulement besoin de principes généraux, se déplaçant selon lesquels la particule se comportera de manière délibérée. </font><font style="vertical-align: inherit;">Par souci de simplicité, la masse est exclue de toutes les formules - nous convenons de la considérer comme unique.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réduire la distance jusqu'à la position de départ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que la particule s'efforce de revenir à sa position d'origine, la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loi de Hooke</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous conviendra </font><font style="vertical-align: inherit;">: la force dirigée vers la position initiale sera linéairement proportionnelle à la distance qui la sépare. </font><font style="vertical-align: inherit;">La particule s'est envolée deux fois plus loin de la position initiale - deux fois plus forte, elle «tire» en arrière, tout est simple.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La distance du curseur</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour être intéressant, les particules doivent en quelque sorte interagir avec le curseur, se permettre de «pousser» depuis la position de départ. </font><font style="vertical-align: inherit;">J'ai pris la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gravité</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le signe opposé comme </font><font style="vertical-align: inherit;">base de cette interaction </font><font style="vertical-align: inherit;">: les particules seront repoussées par une force inversement proportionnelle au carré de la distance entre la position du curseur de la souris et la position actuelle de la particule et dirigées le long du vecteur du curseur à la particule.</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mo>=</mo><mo>&amp;#x2212;</mo><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><msup><mi>r</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.679ex" height="2.884ex" viewBox="0 -916.9 5028.5 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-3D" x="1027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2212" x="2083" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="2862" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2F" x="3622" y="0"></use><g transform="translate(4123,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-32" x="638" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mo>=</mo><mo>−</mo><mi>C</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">F = -C/r^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.766ex" height="2.134ex" viewBox="0 -809.3 760.5 918.9" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">C</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une certaine constante qui régule l'interaction.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atténuation</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous nous limitons aux deux formules précédentes, la particule après avoir réglé l'amplitude initiale oscillera pour toujours, car il n'y a nulle part où perdre de l'énergie dans le cadre d'un tel modèle. </font><font style="vertical-align: inherit;">Nous simulerons l'atténuation comme la force de la résistance visqueuse du milieu, qui, selon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la loi de Stokes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , est linéairement proportionnelle à la vitesse des particules et dirigée dans la direction opposée au mouvement. </font><font style="vertical-align: inherit;">Nous sommes satisfaits des restrictions imposées à l'applicabilité de cette formule, car dans ce cas, nous ne nous intéressons pas à la précision absolue de l'interaction physique, mais uniquement au principe.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résultat</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous obtenons la formule de la force agissant sur la particule à un moment arbitraire dans le temps:</font></font><br>
<p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>F</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mi>s</mi></msub><mo>=</mo><msub><mi>C</mi><mi>a</mi></msub><mo>&amp;#x2217;</mo><mo stretchy=&quot;false&quot;>(</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>&amp;#x2212;</mo><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mn>0</mn></msub><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2212;</mo><mfrac><msub><mi>C</mi><mi>r</mi></msub><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>&amp;#x2212;</mo><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mi>r</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mn>2</mn></msup></mrow></mfrac><mo>&amp;#x2217;</mo><mfrac><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>&amp;#x2212;</mo><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mi>r</mi></msub></mrow><mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>&amp;#x2212;</mo><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>x</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mi>r</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></mfrac><mo>&amp;#x2212;</mo><msub><mi>C</mi><mi>d</mi></msub><mo>&amp;#x2217;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mover><mi>v</mi><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo></mover></mrow><mo>,</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="54.689ex" height="6.384ex" viewBox="0 -1508.9 23546.5 2748.8" role="img" focusable="false" style="vertical-align: -2.88ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="761" y="246"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-73" x="1078" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-3D" x="1472" y="0"></use><g transform="translate(2528,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-61" x="1011" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2217" x="3940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-28" x="4663" y="0"></use><g transform="translate(5052,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2212" x="5847" y="0"></use><g transform="translate(6848,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-30" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-29" x="7874" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2212" x="8486" y="0"></use><g transform="translate(9264,0)"><g transform="translate(342,0)"><rect stroke="none" width="4475" height="60" x="0" y="220"></rect><g transform="translate(1670,676)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-72" x="1011" y="-213"></use></g><g transform="translate(60,-925)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="278" y="0"></use><g transform="translate(557,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2212" x="1351" y="0"></use><g transform="translate(2352,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-72" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="3344" y="0"></use><g transform="translate(3622,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-32" x="393" y="675"></use></g></g></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2217" x="14424" y="0"></use><g transform="translate(14925,0)"><g transform="translate(342,0)"><rect stroke="none" width="4021" height="60" x="0" y="220"></rect><g transform="translate(617,676)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2212" x="794" y="0"></use><g transform="translate(1795,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-72" x="809" y="-213"></use></g></g><g transform="translate(60,-726)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="278" y="0"></use><g transform="translate(557,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2212" x="1351" y="0"></use><g transform="translate(2352,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="549" y="8"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-72" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="3344" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-7C" x="3622" y="0"></use></g></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2212" x="19630" y="0"></use><g transform="translate(20631,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-64" x="1011" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2217" x="22039" y="0"></use><g transform="translate(22761,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-76" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-20D7" x="505" y="9"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2C" x="23268" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>F</mi><mo stretchy="false">→</mo></mover></mrow><mi>s</mi></msub><mo>=</mo><msub><mi>C</mi><mi>a</mi></msub><mo>∗</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>−</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mn>0</mn></msub><mo stretchy="false">)</mo><mo>−</mo><mfrac><msub><mi>C</mi><mi>r</mi></msub><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>−</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mi>r</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>2</mn></msup></mrow></mfrac><mo>∗</mo><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>−</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mi>r</mi></msub></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>−</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mi>r</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></mfrac><mo>−</mo><msub><mi>C</mi><mi>d</mi></msub><mo>∗</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">→</mo></mover></mrow><mo>,</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3">\vec{F}_s=C_a*(\vec{x}-\vec{x}_0)-\frac{C_r}{||\vec{x}-\vec{x}_r||^2}*\frac{\vec{x}-\vec{x}_r}{||\vec{x}-\vec{x}_r||}-C_d*\vec{v},</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Où </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>,</mo><mi>v</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.491ex" height="1.884ex" viewBox="0 -540.2 1503.2 811.3" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2C" x="572" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-76" x="1017" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>,</mo><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">x, v</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - position actuelle et vitesse des particules,</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>0</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.884ex" viewBox="0 -540.2 1026.4 811.3" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-30" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-5">x_0</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la position initiale,</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mi>r</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.303ex" height="1.759ex" viewBox="0 -540.2 991.8 757.5" role="img" focusable="false" style="vertical-align: -0.505ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-72" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>r</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">x_r</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - position du curseur,</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mi>a</mi></msub><mo>,</mo><msub><mi>C</mi><mi>r</mi></msub><mo>,</mo><msub><mi>C</mi><mi>d</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.221ex" height="2.509ex" viewBox="0 -809.3 4400.7 1080.4" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-61" x="1011" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2C" x="1189" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-72" x="1011" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMAIN-2C" x="2769" y="0"></use><g transform="translate(3215,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/498630/&amp;usg=ALkJrhhs87_-CQFn7qRn7ILMoG7vP5vGUg#MJMATHI-64" x="1011" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>C</mi><mi>a</mi></msub><mo>,</mo><msub><mi>C</mi><mi>r</mi></msub><mo>,</mo><msub><mi>C</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-7">C_a, C_r, C_d</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont respectivement les coefficients d'attraction, de répulsion et d'atténuation.</font></font><a name="Equation"></a><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre animation</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/ae/i5/21/aei521dteubbenx4oiceuk9wnfw.gif"><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comportement de programmation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que dans notre modèle, les particules sont indépendantes les unes des autres et que leur comportement est déterminé uniquement par leurs caractéristiques et leurs constantes communes, le calcul de l'état mis à jour est idéalement adapté à la parallélisation. Compte tenu de mon intérêt de longue date pour Unity </font></font><abbr title="Pile technologique orientée données"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOTS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , j'ai décidé d'appliquer cette technologie pour résoudre le problème formulé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DOTS est un développement relativement récent du moteur Unity, une pile technologique axée sur l'écriture de code multithread haute performance. Sur Habré, il y a une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction d'un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> article introductif dans DOTS. Grâce à l'utilisation de l' </font></font><abbr title="Système de composants d'entité"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , du </font><font style="vertical-align: inherit;">modèle architectural de </font><font style="vertical-align: inherit;">Jobs System et du compilateur Burst, DOTS permet d'écrire du code multithread rapide, tout en réduisant la probabilité d'un tir dans le pied.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'essence de l'écriture d'un programme dans l' </font></font><abbr title="Système de composants d'entité"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est de séparer le code en composants ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">composants</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) qui décrivent l'état, systèmes ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systèmes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) qui décrivent le comportement et l'interaction des composants, et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entités</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - objets qui contiennent un ensemble de composants.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composants</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous aurons besoin des composants suivants:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//    ( )</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> AttractorPosData : IComponentData<font></font>
{<font></font>
   <span class="hljs-keyword">public</span> float2 Value;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> VelocityData : IComponentData<font></font>
{<font></font>
   <span class="hljs-keyword">public</span> float2 Value;<font></font>
} <font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> AccelerationData : IComponentData<font></font>
{<font></font>
   <span class="hljs-keyword">public</span> float2 Value;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> ParticleData : IComponentData <font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Color color;
    <span class="hljs-keyword">public</span> Matrix4x4 matrix;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec les composants, tout est assez simple, allez aux systèmes:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//   </span>
[<span class="hljs-meta">UpdateBefore(typeof(MoveSystem))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">VelocityUpdateSystem</span> : <span class="hljs-title">SystemBase</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> time = Time.DeltaTime;<font></font>
        Entities.ForEach((<span class="hljs-keyword">ref</span> VelocityData velocity, 
                <span class="hljs-keyword">in</span> AccelerationData acceleration) =&gt;<font></font>
            {<font></font>
                velocity.Value += time * acceleration.Value;<font></font>
            })<font></font>
            .ScheduleParallel();<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoveSystem</span> : <span class="hljs-title">SystemBase</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> time = Time.DeltaTime;<font></font>
        Entities.ForEach((<span class="hljs-keyword">ref</span> Translation t, <span class="hljs-keyword">in</span> VelocityData velocity) =&gt;<font></font>
            {<font></font>
                t.Value.xy += time * velocity.Value;<font></font>
            })<font></font>
            .ScheduleParallel();<font></font>
    }<font></font>
}<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez contrôler la séquence des systèmes à l'aide d'attributs </font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">UpdateBeforeAttribute</span>]<font></font>
[<span class="hljs-meta">UpdateAfterAttribute</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus grand système qui décrit le comportement sera le système de mise à jour de l'accélération, agissant conformément à la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formule</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dérivée </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">UpdateBefore(typeof(VelocityUpdateSystem))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AccelerationSystem</span> : <span class="hljs-title">SystemBase</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        float2 repulsorPos = Globals.Repulsor.Position;<font></font>
<font></font>
        <span class="hljs-comment">//   </span>
        <span class="hljs-keyword">var</span> attractionPower = Globals.SettingsHolder.SettingsModel.Attraction;
        <span class="hljs-comment">//  </span>
        <span class="hljs-keyword">var</span> repulsionPower = Globals.SettingsHolder.SettingsModel.Repulsion;
        <span class="hljs-comment">//  </span>
        <span class="hljs-keyword">var</span> dampingPower = Globals.SettingsHolder.SettingsModel.Damping;<font></font>
        Entities.ForEach((<font></font>
                <span class="hljs-keyword">ref</span> AccelerationData acceleration, 
                <span class="hljs-keyword">in</span> AttractorPosData attractorPos, 
                <span class="hljs-keyword">in</span> Translation t,
                <span class="hljs-keyword">in</span> VelocityData velocity) =&gt;<font></font>
            {<font></font>
                <span class="hljs-comment">//  </span>
                <span class="hljs-keyword">var</span> attraction = (attractorPos.Value - t.Value.xy) * attractionPower;<font></font>
<font></font>
                <span class="hljs-keyword">var</span> distSqr = math.distancesq(repulsorPos, t.Value.xy);
                <span class="hljs-comment">//  </span>
                <span class="hljs-keyword">var</span> repulsion = -math.normalizesafe(repulsorPos - t.Value.xy) <font></font>
                    / distSqr * repulsionPower;<font></font>
<font></font>
                <span class="hljs-comment">//  </span>
                <span class="hljs-keyword">var</span> damping = -velocity.Value * dampingPower;<font></font>
<font></font>
                acceleration.Value = attraction + repulsion + damping;<font></font>
            })<font></font>
            .ScheduleParallel();<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendre</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgré le nombre potentiellement énorme de particules à afficher, vous pouvez utiliser pour tous le même maillage carré de deux polygones, ainsi que le même matériau, ce qui permettrait de les rendre tous en un seul appel, sinon pour un seul " mais ": toutes les particules, en général, ont des couleurs différentes, sinon l'image résultante sera très ennuyeuse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le shader Unity standard </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Sprites / Default»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut utiliser l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instance de GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour optimiser le rendu des objets avec des sprites et des couleurs inégales, en les combinant en un seul appel de dessin, mais dans ce cas, un lien vers la texture et la couleur de chaque objet spécifique doit être défini à partir d'un script, auquel de ECS, nous n'avons pas accès. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution peut être la méthode </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphics.DrawMeshInstanced</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui vous permet de dessiner plusieurs fois un maillage en un seul appel avec des paramètres de matériau différents, en utilisant la même instance de GPU. </font><font style="vertical-align: inherit;">Cela ressemble à ceci:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">UpdateAfter(typeof(TrsMatrixCalculationSystem))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpriteSheetRenderer</span> : <span class="hljs-title">SystemBase</span><font></font>
{<font></font>
    <span class="hljs-comment">// DrawMeshInstanced     1023    </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> BatchCount = <span class="hljs-number">1023</span>;
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> List&lt;Matrix4x4&gt; _matrixList = <span class="hljs-keyword">new</span> List&lt;Matrix4x4&gt;(BatchCount);
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> List&lt;Vector4&gt; _colorList = <span class="hljs-keyword">new</span> List&lt;Vector4&gt;(BatchCount);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> materialPropertyBlock = <span class="hljs-keyword">new</span> MaterialPropertyBlock();
        <span class="hljs-keyword">var</span> quadMesh = Globals.Quad;
        <span class="hljs-keyword">var</span> material = Globals.ParticleMaterial;<font></font>
<font></font>
        <span class="hljs-comment">//        </span>
        <span class="hljs-comment">//   </span>
        <span class="hljs-keyword">var</span> shaderPropertyId = Shader.PropertyToID(<span class="hljs-string">"_Color"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">var</span> entityQuery = GetEntityQuery(<span class="hljs-keyword">typeof</span>(ParticleData));
        <span class="hljs-comment">//   ,   ParticleData</span>
        <span class="hljs-keyword">var</span> animationData = <font></font>
                   entityQuery.ToComponentDataArray&lt;ParticleData&gt;(Allocator.TempJob);<font></font>
        <span class="hljs-keyword">var</span> layer = LayerMask.NameToLayer(<span class="hljs-string">"Particles"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> meshCount = <span class="hljs-number">0</span>; <font></font>
              meshCount &lt; animationData.Length; <font></font>
              meshCount += BatchCount)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> batchSize = math.min(BatchCount, animationData.Length - meshCount);<font></font>
            _matrixList.Clear();<font></font>
            _colorList.Clear();<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = meshCount; i &lt; meshCount + batchSize; i++)<font></font>
            {<font></font>
                _matrixList.Add(animationData[i].matrix);<font></font>
                _colorList.Add(animationData[i].color);<font></font>
            }<font></font>
<font></font>
            materialPropertyBlock.SetVectorArray(shaderPropertyId, _colorList);<font></font>
            Graphics.DrawMeshInstanced(<font></font>
                quadMesh,<font></font>
                <span class="hljs-number">0</span>,<font></font>
                material,<font></font>
                _matrixList,<font></font>
                materialPropertyBlock,<font></font>
                ShadowCastingMode.Off, <span class="hljs-literal">false</span>, layer);<font></font>
        }<font></font>
<font></font>
        animationData.Dispose();<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour rendre un groupe d'objets à l'aide de cette méthode, vous devez collecter un tableau de matrices de transition et les propriétés des matériaux qui sont censées varier. </font><font style="vertical-align: inherit;">Le système de rendu, comme vous pouvez le voir, est exécuté après le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TrsMatrixCalculationSystem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un système auxiliaire qui calcule la matrice de transition pour chacune des particules, ce qui semble très simple:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">UpdateAfter(typeof(MoveSystem))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TrsMatrixCalculationSystem</span> : <span class="hljs-title">SystemBase</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//   scale   </span>
        <span class="hljs-keyword">var</span> scale = Globals.SettingsHolder.SettingsModel.ParticlesScale;<font></font>
        Entities.ForEach((<span class="hljs-keyword">ref</span> ParticleData data, <span class="hljs-keyword">in</span> Translation translation) =&gt;<font></font>
            {<font></font>
                data.matrix = Matrix4x4.TRS(translation.Value, Quaternion.identity,<font></font>
                    <span class="hljs-keyword">new</span> Vector3(scale, scale, scale));<font></font>
            })<font></font>
            .ScheduleParallel();<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation de 46 000 particules</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/2z/ji/yk/2zjiykutabsgl4pg6qpuphxxsw0.gif"><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est temps de parler de la raison pour laquelle (en plus, bien sûr, de la satisfaction esthétique). </font><font style="vertical-align: inherit;">Dans Unity, pour le moment, il est possible de choisir entre deux </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scripts de backend</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (implémentations </font></font><abbr title="Runtime de langage commun"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLR</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): le bon vieux </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mono</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et une solution plus moderne des développeurs Unity - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IL2CPP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comparez les performances de génération de ces deux implémentations d'exécution:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nombre de particules sur l'écran</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fréquence d'images moyenne, Mono</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fréquence d'images moyenne, IL2CPP</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">66</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">130</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200 000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">57</font></font></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spécifications du PC: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QHD 2560x1440 </font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Core i5-9600K </font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 Go de RAM </font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSI GeForce RTX 2080 SUPER VENTUS XS OC 8,0 Go </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/oq/aq/yh/oqaqyh3frvpelp5-wqq4pt2qjl4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">160 000 particules</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il est à noter que, dans cette expérience de vide sphérique, IL2CPP surpasse Mono environ deux fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon le profileur, littéralement tout le temps passé sur l'image est consacré au système de rendu, les calculs des autres systèmes sont pratiquement «gratuits»: </font></font><br>
<img src="https://habrastorage.org/webt/fe/ap/6y/feap6y37oxytyf3acvhpn_h6_us.png"> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity Editor </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/a2/pv/i6/a2pvi6zlukwnxderl4zk6k2fg6u.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Il est à noter que la plupart du temps est consacré au processus de conversion des couleurs de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Color</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vector4</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et d'ajout à la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liste. ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous pouvons facilement nous débarrasser de la première - nous reporterons la transformation au moment de la génération des particules, car la couleur ne change pas dans le processus:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">// </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> ParticleData : IComponentData<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Color color;
    <span class="hljs-keyword">public</span> Matrix4x4 matrix;<font></font>
}<font></font>
<span class="hljs-comment">// </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> ParticleData : IComponentData<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Vector4 color;
    <span class="hljs-keyword">public</span> Matrix4x4 matrix;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce changement nous a permis de nous débarrasser complètement de l'opération de conversion coûteuse: le </font></font><img src="https://habrastorage.org/webt/su/kz/fk/sukzfklw-xmgirni-jbtc0fw5qw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nombre d'images par seconde pour 200 000 particules après qu'il soit passé à 61. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est possible d'optimiser le remplissage des listes, par exemple, pour stocker tous les tableaux de couleurs, en les générant une fois, mais cette solution ne me semble donc pas élégante, donc Je serai heureux de suggestions constructives dans les commentaires.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECS en général et Unity DOTS en particulier sont d'excellents outils pour des scénarios et des classes de tâches spécifiques. </font><font style="vertical-align: inherit;">Ils remplissent leur rôle dans le traitement efficace d'une énorme quantité de données et vous permettent de créer des simulations qui, en leur absence, auraient demandé beaucoup plus d'efforts. </font><font style="vertical-align: inherit;">Cependant, ne considérez pas DOTS comme une «solution miracle» et jetez des pierres aux développeurs qui adhèrent aux concepts Unity traditionnels dans les nouveaux projets - DOTS n'est pas pour tout le monde et pas pour chaque tâche.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout le monde peut se familiariser avec le projet dans mon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiel github</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais comment installer la build comme fond d'écran sur </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wallpaper Engine</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498614/index.html">Analyse d'une série de vidéos promotionnelles pour le jeu Spin Voyage</a></li>
<li><a href="../fr498618/index.html">Android dans un contrôleur industriel</a></li>
<li><a href="../fr498620/index.html">Toucher le monde: biomécanique des récepteurs de la peau humaine</a></li>
<li><a href="../fr498624/index.html">[Instruction] Création de tests Google (formulaires Google)</a></li>
<li><a href="../fr498628/index.html">Comment construire un accélérateur de fusée pour les scripts PowerCLI </a></li>
<li><a href="../fr498632/index.html">Peptide pour un beau mulâtre</a></li>
<li><a href="../fr498634/index.html">11 questions stupides à un orthopédiste et masseuse sur le travail à l'ordinateur et pas seulement</a></li>
<li><a href="../fr498636/index.html">Shader simple pour les lumières ponctuelles dans le brouillard</a></li>
<li><a href="../fr498638/index.html">Arcade 3D dans le navigateur: comment nous avons créé le jeu sur React + Redux</a></li>
<li><a href="../fr498642/index.html">Geeek Club: comment nous avons collecté 137 000 $ sur Kickstarter pour un concepteur de PCB bricolage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>