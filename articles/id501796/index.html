<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🏫 🎷 🖕 7 kesalahan berbahaya yang mudah dilakukan di C # /. NET 💃 👭 🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Terjemahan artikel disiapkan sebelum dimulainya kursus "C # ASP.NET Core Developer" .
 
 
 
 C # adalah bahasa yang bagus , dan .NET Framework juga sa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>7 kesalahan berbahaya yang mudah dilakukan di C # /. NET</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501796/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terjemahan artikel disiapkan sebelum dimulainya kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C # ASP.NET Core Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/k8/vz/cz/k8vzcz5umofkpvfxz9zuj1pqibu.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C # adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bahasa yang bagus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan .NET Framework juga sangat bagus. </font><font style="vertical-align: inherit;">Mengetik dengan kuat di C # membantu mengurangi jumlah kesalahan yang dapat Anda lakukan, dibandingkan dengan bahasa lain. </font><font style="vertical-align: inherit;">Plus, desain intuitif umumnya juga banyak membantu, dibandingkan dengan sesuatu seperti JavaScript (di mana </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar salah</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Namun, setiap bahasa memiliki rake sendiri yang mudah digunakan, bersama dengan ide-ide keliru tentang perilaku yang diharapkan dari bahasa dan infrastruktur. </font><font style="vertical-align: inherit;">Saya akan mencoba menjelaskan beberapa kesalahan ini secara rinci.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Tidak mengerti eksekusi yang tertunda (malas)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya percaya bahwa pengembang yang berpengalaman menyadari mekanisme .NET ini, tetapi mungkin mengejutkan kolega yang kurang berpengetahuan. Singkatnya, metode / operator yang kembali </font></font><code><code>IEnumerable&lt;</code>T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan digunakan </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mengembalikan setiap hasil tidak dieksekusi dalam baris kode yang benar-benar memanggil mereka - mereka dieksekusi ketika koleksi yang dihasilkan diakses dalam beberapa cara *. Perhatikan bahwa sebagian besar ekspresi LINQ akhirnya mengembalikan hasilnya dengan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasil</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai contoh, pertimbangkan uji unit mengerikan di bawah ini.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(ArgumentNullException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Null_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-literal">null</span>);<font></font>
}<font></font>
[<span class="hljs-meta">TestMethod</span>]<font></font>
[<span class="hljs-meta">ExpectedException(typeof(InvalidOperationException))</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Ensure_Invalid_Operation_Exception_Is_Thrown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">var</span> result = RepeatString5Times(<span class="hljs-string">"test"</span>);
   <span class="hljs-keyword">var</span> firstItem = result.First();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerable&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">RepeatString5Times</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> toRepeat</span>)</span><font></font>
{<font></font>
   <span class="hljs-keyword">if</span> (toRepeat == <span class="hljs-literal">null</span>)
       <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(toRepeat));
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
   {   <font></font>
       <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"3 is a horrible number"</span>);
       <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{toRepeat}</span> - <span class="hljs-subst">{i}</span>"</span>;<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kedua tes ini akan gagal. Tes pertama akan gagal, karena hasilnya tidak digunakan di mana pun, sehingga tubuh metode tidak akan pernah dieksekusi. Tes kedua akan gagal karena alasan lain, sedikit lebih non-sepele. Sekarang kita mendapatkan hasil pertama memanggil metode kita untuk memastikan bahwa metode itu benar-benar berjalan. Namun, mekanisme eksekusi yang tertunda akan keluar dari metode secepatnya - dalam kasus ini, kami hanya menggunakan elemen pertama, oleh karena itu, segera setelah kami melewati iterasi pertama, metode tersebut menghentikan eksekusi (karena itu saya == 3 tidak akan pernah benar). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eksekusi yang tertunda sebenarnya merupakan mekanisme yang menarik, terutama karena membuatnya mudah untuk mem-chain query LINQ, mengambil data hanya ketika kueri Anda siap digunakan.</font></font><br>
<br>
<h3>2. ,   Dictionary      ,     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini sangat tidak menyenangkan, dan saya yakin di suatu tempat saya memiliki kode yang bergantung pada asumsi ini. Ketika Anda menambahkan item ke daftar </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mereka disimpan dalam urutan yang sama di mana Anda menambahkannya - secara logis. Terkadang Anda perlu memiliki objek lain yang terkait dengan item dalam daftar, dan solusi yang jelas adalah menggunakan kamus </font></font><code><code>Dictionary&lt;</code>TKey,TValue&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang memungkinkan Anda menentukan nilai terkait untuk kunci tersebut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian Anda dapat beralih ke kamus menggunakan foreach, dan dalam kebanyakan kasus akan berperilaku seperti yang diharapkan - Anda akan mengakses elemen dalam urutan yang sama di mana mereka ditambahkan ke kamus. Namun, perilaku </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini tidak terdefinisi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - yaitu ini adalah kebetulan yang menyenangkan, bukan sesuatu yang bisa Anda andalkan dan selalu harapkan. Ini dijelaskan dalam</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentasi Microsoft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi saya pikir beberapa orang telah mempelajari halaman ini dengan seksama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menggambarkan hal ini, dalam contoh di bawah ini, outputnya adalah sebagai berikut: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ketiga </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
detik</font></font></i><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> dict = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt;();       <font></font>
dict.Add(<span class="hljs-string">"first"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Add(<span class="hljs-string">"second"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());<font></font>
dict.Remove(<span class="hljs-string">"first"</span>);<font></font>
dict.Add(<span class="hljs-string">"third"</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>());
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> entry <span class="hljs-keyword">in</span> dict)<font></font>
{<font></font>
    Console.WriteLine(entry.Key);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan percaya padaku? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Periksa sendiri di sini secara online</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Jangan memperhitungkan keamanan aliran akun</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Multithreading bagus, jika diterapkan dengan benar, Anda dapat secara signifikan meningkatkan kinerja aplikasi Anda. Namun, segera setelah Anda memasukkan multithreading, Anda harus sangat, sangat berhati-hati dengan objek yang akan Anda modifikasi, karena Anda mungkin mulai menemukan kesalahan yang tampaknya acak jika Anda tidak cukup berhati-hati. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sederhananya, banyak kelas dasar di perpustakaan .NET tidak </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aman utas.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ini berarti bahwa Microsoft tidak membuat jaminan bahwa Anda dapat menggunakan kelas ini secara paralel menggunakan beberapa utas. </font><font style="vertical-align: inherit;">Ini tidak akan menjadi masalah besar jika Anda dapat segera menemukan masalah yang terkait dengan ini, tetapi sifat multithreading menyiratkan bahwa setiap masalah yang muncul sangat tidak stabil dan tidak dapat diprediksi - kemungkinan besar, tidak ada dua eksekusi yang akan menghasilkan hasil yang sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai contoh, pertimbangkan blok kode ini yang menggunakan sederhana, tetapi tidak aman-thread </font></font><code><code>List&lt;T&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> items = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;();
<span class="hljs-keyword">var</span> tasks = <span class="hljs-keyword">new</span> List&lt;Task&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)<font></font>
{<font></font>
   tasks.Add(Task.Run(() =&gt; {<font></font>
       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">10000</span>; k++)<font></font>
       {<font></font>
           items.Add(i);<font></font>
       }<font></font>
   }));<font></font>
}<font></font>
Task.WaitAll(tasks.ToArray());<font></font>
Console.WriteLine(items.Count);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami menambahkan angka dari 0 hingga 4 ke daftar masing-masing 10.000 kali, yang berarti bahwa daftar tersebut pada akhirnya harus berisi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50.000</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elemen. </font><font style="vertical-align: inherit;">Haruskah saya? </font><font style="vertical-align: inherit;">Ya, ada kemungkinan kecil bahwa pada akhirnya akan terjadi - tetapi di bawah ini adalah hasil dari 5 peluncuran saya yang berbeda:</font></font><br>
<br>
<pre><code class="plaintext hljs">28191<font></font>
23536<font></font>
44346<font></font>
40007<font></font>
40476</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memeriksanya sendiri online di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faktanya, ini karena metode Add bukan atomik, yang menyiratkan bahwa utas dapat mengganggu metode tersebut, yang pada akhirnya dapat mengubah ukuran array sementara utas lain sedang dalam proses menambahkan, atau menambahkan elemen dengan indeks yang sama sebagai utas lainnya. Pengecualian IndexOutOfRange datang kepada saya beberapa kali, mungkin karena ukuran array berubah selama penambahan itu. Jadi apa yang kita lakukan di sini? Kami dapat menggunakan kata kunci kunci untuk memastikan bahwa hanya satu utas yang dapat menambahkan (Tambahkan) item ke daftar pada satu waktu, tetapi ini dapat secara signifikan mempengaruhi kinerja. Microsoft, sebagai orang baik, menyediakan beberapa koleksi hebat itu</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mereka aman</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan sangat dioptimalkan dalam hal kinerja. </font><font style="vertical-align: inherit;">Saya sudah menerbitkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel yang menjelaskan bagaimana Anda bisa menggunakannya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Pelanggaran pemalas (ditangguhkan) memuat dalam LINQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemuatan malas adalah fitur hebat untuk LINQ ke SQL dan LINQ ke Entitas (Kerangka Entitas), yang memungkinkan Anda memuat baris tabel terkait sesuai kebutuhan. Dalam salah satu proyek saya yang lain, saya memiliki </font><font style="vertical-align: inherit;">tabel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Modul"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan tabel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Hasil"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan hubungan satu-ke-banyak (modul dapat memiliki banyak hasil). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qh/ds/ww/qhdsww2vr9-_oslbtzgqx8rle50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika saya ingin mendapatkan modul tertentu, saya tentu tidak ingin Kerangka Entitas mengembalikan setiap Hasil yang dimiliki tabel Modul! Karena itu, ia cukup pintar untuk mengeksekusi kueri untuk mendapatkan hasil hanya ketika saya membutuhkannya. Dengan demikian, kode di bawah ini akan menjalankan 2 pertanyaan - satu untuk mendapatkan modul, dan yang lainnya untuk mendapatkan hasil (untuk setiap modul),</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules;
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, bagaimana jika saya memiliki ratusan modul? </font><font style="vertical-align: inherit;">Ini berarti bahwa permintaan SQL terpisah untuk menerima catatan hasil akan dieksekusi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk setiap modul! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jelas, ini akan membuat server Anda tegang dan secara signifikan memperlambat aplikasi Anda. </font><font style="vertical-align: inherit;">Dalam Kerangka Entitas, jawabannya sangat sederhana - Anda bisa menentukan bahwa itu menyertakan serangkaian hasil tertentu dalam permintaan Anda. </font><font style="vertical-align: inherit;">Lihat kode yang dimodifikasi di bawah ini, di mana hanya satu query SQL yang akan dieksekusi, yang akan mencakup setiap modul dan setiap hasil untuk modul ini (digabungkan menjadi satu query, yang ditampilkan oleh Entity Framework secara cerdas dalam model Anda),</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> DBEntities())<font></font>
{<font></font>
   <span class="hljs-keyword">var</span> modules = db.Modules.Include(b =&gt; b.Results);
   <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> module <span class="hljs-keyword">in</span> modules)<font></font>
   {<font></font>
       <span class="hljs-keyword">var</span> moduleType = module.Results;
      <span class="hljs-comment">//   </span><font></font>
   }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Tidak mengerti bagaimana LINQ ke SQL / Entity Frameworks menerjemahkan kueri</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kami menyentuh pada topik LINQ, saya pikir layak menyebutkan betapa berbedanya kode Anda akan dieksekusi jika ada di dalam permintaan LINQ. Menjelaskan pada tingkat tinggi, semua kode Anda di dalam kueri LINQ diterjemahkan ke dalam SQL menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ekspresi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ini tampak jelas, tetapi sangat, sangat mudah untuk melupakan konteks tempat Anda berada dan pada akhirnya menimbulkan masalah ke dalam basis kode Anda. Di bawah ini saya telah menyusun daftar untuk menggambarkan beberapa kendala khas yang mungkin Anda temui. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagian besar panggilan metode tidak akan berfungsi.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jadi, bayangkan Anda memiliki kueri di bawah ini untuk memisahkan nama semua modul dengan titik dua dan menangkap bagian kedua.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> modules = <span class="hljs-keyword">from</span> m <span class="hljs-keyword">in</span> db.Modules
              <span class="hljs-keyword">select</span> m.Name.Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda akan mendapatkan pengecualian di sebagian besar penyedia LINQ - tidak ada terjemahan SQL untuk metode Split, beberapa metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mungkin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> didukung, misalnya, menambahkan hari ke tanggal, tetapi semuanya tergantung pada penyedia Anda. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mereka yang bekerja mungkin menghasilkan hasil yang tidak terduga ...</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ambil ungkapan LINQ di bawah ini (saya tidak tahu mengapa Anda akan melakukan ini dalam praktek, tapi tolong bayangkan bahwa ini adalah permintaan yang masuk akal).</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memiliki baris dalam tabel modul, itu akan memberi Anda jumlah pengidentifikasi. </font><font style="vertical-align: inherit;">Kedengarannya benar! </font><font style="vertical-align: inherit;">Tapi bagaimana jika Anda menjalankannya menggunakan LINQ to Objects? </font><font style="vertical-align: inherit;">Kita dapat melakukan ini dengan mengubah koleksi modul menjadi daftar sebelum kita menjalankan metode Sum kita.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> modules = db.Modules.ToList().Sum(a =&gt; a.ID);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shock, horor - ini akan melakukan hal yang persis sama! Namun, bagaimana jika Anda tidak memiliki baris dalam tabel modul? LINQ ke Objects mengembalikan 0, dan Entity Framework / LINQ ke versi SQL melempar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidOperationException</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengatakan bahwa itu tidak dapat mengkonversi "int?" di "int" ... seperti itu. Ini karena ketika Anda menjalankan SUM dalam SQL untuk set kosong, NULL dikembalikan bukan 0 - karena itu, alih-alih mencoba mengembalikan int nullable. Berikut adalah beberapa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tips untuk memperbaikinya jika Anda menghadapi masalah seperti itu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahu kapan Anda hanya perlu menggunakan SQL lama yang bagus.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda menjalankan kueri yang sangat kompleks, maka kueri yang diterjemahkan mungkin berakhir seperti sesuatu yang dimuntahkan, dimakan berulang-ulang. </font><font style="vertical-align: inherit;">Sayangnya, saya tidak punya contoh untuk ditunjukkan, tetapi dilihat dari pendapat yang berlaku, saya sangat suka menggunakan pandangan bersarang, yang membuat pemeliharaan kode mimpi buruk. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga, jika Anda mengalami hambatan kinerja, akan sulit bagi Anda untuk memperbaikinya, karena Anda tidak memiliki kontrol langsung atas SQL yang dihasilkan. </font><font style="vertical-align: inherit;">Baik melakukannya dalam SQL, atau mendelegasikannya ke administrator database, jika Anda atau perusahaan Anda memilikinya!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Pembulatan yang salah</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang tentang sesuatu yang sedikit lebih sederhana dari paragraf sebelumnya, tetapi saya selalu lupa tentang hal itu, dan berakhir dengan kesalahan yang tidak menyenangkan (dan, jika itu terkait dengan keuangan, seorang direktur sirip / gen yang marah). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NET Framework. Termasuk metode statis yang sangat baik di kelas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matematika yang</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> disebut </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Round</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengambil nilai numerik dan membulatkannya ke tempat desimal yang ditentukan. Ini berfungsi sempurna sebagian besar waktu, tetapi apa yang harus dilakukan ketika Anda mencoba untuk membulatkan 2,25 ke tempat desimal pertama? Saya berasumsi bahwa Anda mungkin berharap untuk membulatkan ke 2.3 - itulah yang kita semua terbiasa, kan? Nah, dalam prakteknya, ternyata .NET menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pembulatan bankir</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang membulatkan contoh yang diberikan ke 2.2! </font><font style="vertical-align: inherit;">Ini disebabkan oleh fakta bahwa para bankir dibulatkan ke angka genap terdekat jika angka itu ada di “titik tengah”. </font><font style="vertical-align: inherit;">Untungnya, ini dapat dengan mudah diganti dalam metode Math.Round.</font></font><br>
 <br>
<pre><code class="cs hljs">Math.Round(<span class="hljs-number">2.25</span>,<span class="hljs-number">1</span>, MidpointRounding.AwayFromZero)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Kelas mengerikan 'DBNull' </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dapat menyebabkan kenangan yang tidak menyenangkan bagi sebagian orang - ORM menyembunyikan kekotoran ini dari kami, tetapi jika Anda mempelajari dunia telanjang ADO.NET (SqlDataReader dan sejenisnya) Anda akan bertemu dengan DBNull.Value. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak 100% yakin alasan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengapa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nilai NULL dari database diproses sebagai berikut (tolong beri komentar di bawah jika Anda tahu!), Tetapi Microsoft memutuskan untuk menyajikannya dengan tipe khusus DBNull (dengan Nilai bidang statis). </font><font style="vertical-align: inherit;">Saya dapat memberikan salah satu kelebihannya - Anda tidak akan mendapatkan NullReferenceException yang tidak menyenangkan saat mengakses bidang database yang NULL. </font><font style="vertical-align: inherit;">Namun, Anda seharusnya tidak hanya mendukung cara sekunder memeriksa nilai NULL (yang mudah dilupakan, yang dapat menyebabkan kesalahan serius), tetapi Anda kehilangan salah satu fitur hebat C # yang membantu Anda bekerja dengan nol. </font><font style="vertical-align: inherit;">Apa yang bisa sesederhana itu</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) ?? <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apa yang akhirnya menjadi ...</font></font><br>
 <br>
<pre><code class="cs hljs">reader.GetString(<span class="hljs-number">0</span>) != DBNull.Value ? reader.GetString(<span class="hljs-number">0</span>) : <span class="hljs-string">"NULL"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ugh.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini hanya beberapa "garu" non-sepele yang saya temui di .NET - jika Anda tahu lebih banyak, saya ingin mendengar dari Anda di bawah ini.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ASP.NET Core:  </a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id501784/index.html">Jika mobil saya menghalangi</a></li>
<li><a href="../id501786/index.html">Aplikasi baru "Ubur-ubur". Mengapa bergetar?</a></li>
<li><a href="../id501788/index.html">Membuat objek parametrik dalam BIM Desain nanoCAD</a></li>
<li><a href="../id501790/index.html">Animasi nontrivial di SwiftUI</a></li>
<li><a href="../id501792/index.html">Bagaimana ayah FinFET membantu menyelamatkan hukum Moore</a></li>
<li><a href="../id501798/index.html">C++/Qt: пора валить?.</a></li>
<li><a href="../id501800/index.html">Sesi osinta kecil tentang modernisasi dan produksi sistem komunikasi radio untuk Angkatan Bersenjata Federasi Rusia</a></li>
<li><a href="../id501804/index.html">Anak panah. Semua yang perlu Anda ketahui tentang konstanta</a></li>
<li><a href="../id501806/index.html">ACS: masalah, solusi dan manajemen risiko keamanan</a></li>
<li><a href="../id501808/index.html">Daftar perubahan dalam D 2.092. Meminjam Meminjam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>