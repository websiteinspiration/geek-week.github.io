<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∫ ‚õ¥Ô∏è üî† COVID-19 Telegramm-Bot // Wir beantworten FAQ-Fragen automatisch üèá ü§ôüèº ü§æüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Zusammenhang mit dem allgemeinen Hype um Coronavirus habe ich beschlossen, zumindest etwas N√ºtzliches zu tun (aber nicht weniger Hype). In diesem A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>COVID-19 Telegramm-Bot // Wir beantworten FAQ-Fragen automatisch</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494118/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Zusammenhang mit dem allgemeinen Hype um Coronavirus habe ich beschlossen, zumindest etwas N√ºtzliches zu tun (aber nicht weniger Hype). </font><font style="vertical-align: inherit;">In diesem Artikel werde ich dar√ºber sprechen, wie der Telegramm-Bot mithilfe regelbasierter NLP-Methoden in 2,5 Stunden erstellt und bereitgestellt wird (so lange habe ich gebraucht), um h√§ufig gestellte Fragen am Beispiel COVID-19 zu beantworten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Laufe der Arbeit werden wir das gute alte Python, die Telegramm-API, einige Standard-NLP-Bibliotheken sowie Docker verwenden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/68/e4/tw/68e4twfyppio_uy1o1dojajfeca.jpeg"><br>
<a name="habracut"></a><br>
<blockquote><img src="https://habrastorage.org/webt/fi/0x/4z/fi0x4z2nhcc3-3bdzugakb4csji.png" align="left"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UFO Care Minute</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Pandemie COVID-19, eine potenziell schwere akute Atemwegsinfektion, die durch das SARS-CoV-2-Coronavirus (2019-nCoV) verursacht wird, wurde weltweit offiziell angek√ºndigt. </font><font style="vertical-align: inherit;">Zu diesem Thema gibt es viele Informationen zu Habr√© - denken Sie immer daran, dass es sowohl zuverl√§ssig / n√ºtzlich sein kann als auch umgekehrt.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir bitten Sie dringend, ver√∂ffentlichte Informationen zu kritisieren.</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offizielle Quellen</font></font></b><div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">C   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">C </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">  ()</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> </a></li>
<li>       </li>
</ul><br>
     ,      .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Waschen Sie Ihre H√§nde, k√ºmmern Sie sich um Ihre Lieben, bleiben Sie wann immer m√∂glich zu Hause und arbeiten Sie aus der Ferne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lesen Sie Ver√∂ffentlichungen √ºber: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coronavirus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heimarbeit</font></font></a></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurzes Vorwort</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel beschreibt den Prozess der Erstellung eines einfachen Telegramm-Bots, der h√§ufig gestellte Fragen zu COVID-19 beantwortet. </font><font style="vertical-align: inherit;">Die Entwicklungstechnologie ist √§u√üerst einfach und vielseitig und kann f√ºr alle anderen F√§lle verwendet werden. </font><font style="vertical-align: inherit;">Ich betone noch einmal, dass ich nicht vorgebe, auf dem neuesten Stand der Technik zu sein, sondern nur eine einfache und effektive L√∂sung anbiete, die wiederverwendet werden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da ich glaube, dass der Leser dieses Artikels bereits Erfahrung mit Python hat, gehen wir davon aus, dass Sie Python 3.X bereits installiert haben und die erforderlichen Entwicklungstools (PyCharm, VS Code) haben. Sie k√∂nnen einen Bot in Telegram √ºber BotFather erstellen und Deshalb werde ich diese Dinge √ºberspringen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Konfigurieren Sie die API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als erstes m√ºssen Sie die Wrapper-Bibliothek f√ºr die Telegramm-API " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">installieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Standardbefehl hierf√ºr lautet:</font></font><br>
<br>
<pre><code class="python hljs">pip install python-telegram-bot --upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als N√§chstes erstellen wir den Rahmen f√ºr unser kleines Programm, indem wir "Handler" f√ºr die folgenden Bot-Ereignisse definieren:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start - Bot's Startbefehl;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help - Hilfebefehl (Hilfe);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachricht - Textnachrichtenverarbeitung;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler - ein Fehler.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Signatur der Handler sieht folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment"># </span>
    <span class="hljs-keyword">pass</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes definieren wir in Analogie zum Beispiel aus der Bibliotheksdokumentation die Hauptfunktion, in der wir alle diese Handler zuweisen und den Bot starten:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_answer</span>():</span>
    <span class="hljs-string">"""Start the bot."""</span>
    <span class="hljs-comment"># Create the Updater and pass it your bot's token.</span>
    <span class="hljs-comment"># Make sure to set use_context=True to use the new context based callbacks</span>
    <span class="hljs-comment"># Post version 12 this will no longer be necessary</span>
    updater = Updater(<span class="hljs-string">"Token"</span>, use_context=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-comment"># Get the dispatcher to register handlers</span><font></font>
    dp = updater.dispatcher<font></font>
<font></font>
    <span class="hljs-comment"># on different commands - answer in Telegram</span>
    dp.add_handler(CommandHandler(<span class="hljs-string">"start"</span>, start))<font></font>
    dp.add_handler(CommandHandler(<span class="hljs-string">"help"</span>, help))<font></font>
<font></font>
    <span class="hljs-comment"># on noncommand i.e message - echo the message on Telegram</span><font></font>
    dp.add_handler(MessageHandler(Filters.text, message))<font></font>
<font></font>
    <span class="hljs-comment"># log all errors</span><font></font>
    dp.add_error_handler(error)<font></font>
<font></font>
    <span class="hljs-comment"># Start the Bot</span><font></font>
    updater.start_polling()<font></font>
<font></font>
    <span class="hljs-comment"># Run the bot until you press Ctrl-C or the process receives SIGINT,</span>
    <span class="hljs-comment"># SIGTERM or SIGABRT. This should be used most of the time, since</span>
    <span class="hljs-comment"># start_polling() is non-blocking and will stop the bot gracefully.</span><font></font>
    updater.idle()<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<font></font>
    get_answer()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mache Sie darauf aufmerksam, dass es zwei Mechanismen gibt, um einen Bot zu starten:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard Polling - Periodisches Polling von Bot unter Verwendung von Standard-Telegramm-API-Tools f√ºr neue Ereignisse ( </font></font><code>updater.start_polling()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webhook - Wir starten unseren Server mit einem Endpunkt, zu dem Ereignisse vom Bot kommen, f√ºr den HTTPS erforderlich ist.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie bereits bemerkt haben, verwenden wir der Einfachheit halber das Standard-Polling.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Wir f√ºllen Standardhandler mit Logik aus</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit einem einfachen, f√ºllen Sie den Anfang aus und helfen Sie den Handlern mit Standardantworten. Wir erhalten so etwas:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /start is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
!
        COVID-19.
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /help is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
     (  COVID-19).
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Benutzer nun die Befehle / start oder / help sendet, erh√§lt er die von uns vorgeschriebene Antwort. </font><font style="vertical-align: inherit;">Ich mache Sie darauf aufmerksam, dass der Text in Markdown formatiert ist</font></font><br>
<br>
<pre><code class="python hljs">parse_mode=telegram.ParseMode.MARKDOWN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie als N√§chstes dem Fehlerbehandler die Fehlerprotokollierung hinzu:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Log Errors caused by Updates."""</span>
    logger.warning(<span class="hljs-string">'Update "%s" caused error "%s"'</span>, update, context.error)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns nun √ºberpr√ºfen, ob unser Bot funktioniert. </font><font style="vertical-align: inherit;">Kopieren Sie </font><font style="vertical-align: inherit;">den gesamten Code geschrieben in einer einzigen Datei, zum Beispiel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.py</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">F√ºgen Sie die erforderlichen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importe hinzu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºhren Sie die Datei aus und gehen Sie zu Telegramm ( </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vergessen Sie nicht, Ihr Token in den Code einzuf√ºgen</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Wir schreiben die Befehle / start und / help und freuen uns:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/jf/bo/hnjfbobptb1e1no0h-nl5cdegt4.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Wir verarbeiten die Nachricht und generieren eine Antwort</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste, was wir zur Beantwortung der Frage ben√∂tigen, ist die Knowledge Base. </font><font style="vertical-align: inherit;">Am einfachsten ist es, eine einfache JSON-Datei in Form von Schl√ºsselwertwerten zu erstellen, wobei Schl√ºssel der Text der vorgeschlagenen Frage und Wert die Antwort auf die Frage ist. </font><font style="vertical-align: inherit;">Beispiel f√ºr eine Wissensdatenbank:</font></font><br>
<br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"      ?"</span>: <span class="hljs-string">"  ‚Äî  .     -     ,     ,     ,        .    ,      ,   .        ,     ."</span>,
  <span class="hljs-attr">"   ?"</span>: <span class="hljs-string">"  :\n     \n    \n    \n     \n\n         ,    ."</span>,
  <span class="hljs-attr">"  ?"</span>: <span class="hljs-string">" :\n- (    , , )\n- (  )"</span>,<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Algorithmus zur Beantwortung der Frage lautet wie folgt:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erhalten den Text der Frage vom Benutzer;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lemmatisieren Sie alle W√∂rter im Text des Benutzers.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir vergleichen den resultierenden Text nicht klar mit allen lemmatisierten Fragen aus der Wissensbasis ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Levenshtein-Abstand</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir w√§hlen die ‚Äû√§hnlichste‚Äú Frage aus der Wissensbasis aus.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir senden die Antwort auf die ausgew√§hlte Frage an den Benutzer.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Umsetzung unserer Pl√§ne ben√∂tigen wir Bibliotheken: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fuzzywuzzy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (f√ºr Fuzzy-Vergleiche) und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pymorphy2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (f√ºr die Lemmatisierung). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie eine neue Datei und implementieren Sie den Sounded-Algorithmus:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> fuzzywuzzy <span class="hljs-keyword">import</span> fuzz
<span class="hljs-keyword">import</span> pymorphy2<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
morph = pymorphy2.MorphAnalyzer()<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"faq.json"</span>) <span class="hljs-keyword">as</span> json_file:<font></font>
    faq = json.load(json_file)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classify_question</span>(<span class="hljs-params">text</span>):</span>
    <span class="hljs-comment">#  </span>
    text = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> text.split())<font></font>
    questions = list(faq.keys())<font></font>
    scores = list()<font></font>
    <span class="hljs-comment">#      </span>
    <span class="hljs-keyword">for</span> question <span class="hljs-keyword">in</span> questions:
        <span class="hljs-comment">#    </span>
        norm_question = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> question.split())
        <span class="hljs-comment">#       </span><font></font>
        scores.append(fuzz.token_sort_ratio(norm_question.lower(), text.lower()))<font></font>
    <span class="hljs-comment"># </span><font></font>
    answer = faq[questions[scores.index(max(scores))]]<font></font>
<font></font>
    <span class="hljs-keyword">return</span> answer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor wir einen Nachrichtenhandler schreiben, schreiben wir eine Funktion, die den Korrespondenzverlauf in einer tsv-Datei speichert:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump_data</span>(<span class="hljs-params">user, question, answer</span>):</span><font></font>
    username = user.username<font></font>
    full_name = user.full_name<font></font>
    id = user.id<font></font>
<font></font>
    str = <span class="hljs-string">"""{username}\t{full_name}\t{id}\t{question}\t{answer}\n"""</span>.format(username=username,<font></font>
                                                                 full_name=full_name,<font></font>
                                                                 id=id,<font></font>
                                                                 question=question,<font></font>
                                                                 answer=answer)<font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"/data/dump.tsv"</span>, <span class="hljs-string">"a"</span>) <span class="hljs-keyword">as</span> myfile:<font></font>
        myfile.write(str)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt verwenden wir die Methode, die wir in der Nachrichtentext-Handler-Nachricht geschrieben haben:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Answer the user message."""</span>
    <span class="hljs-comment"># </span><font></font>
    answer = classify_question(update.message.text)<font></font>
    <span class="hljs-comment">#  </span><font></font>
    dump_data(update.message.from_user, update.message.text, answer)<font></font>
    <span class="hljs-comment"># </span>
    update.message.reply_text(answer)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila, jetzt geh zum Telegramm und genie√üe das Schreiben:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/id/fj/2h/idfj2hjue-vkxmusxsd6hibl-zu.jpeg" width="300"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Konfigurieren Sie Docker und stellen Sie die Anwendung bereit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie der Klassiker sagte: "Wenn Sie ausf√ºhren, ist die Ausf√ºhrung wundersch√∂n." Damit wir alles als Personen haben, konfigurieren wir die Containerisierung mithilfe von Docker Compose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daf√ºr brauchen wir:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker-Datei erstellen - Definiert das Image des Containers und den Einstiegspunkt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker-compose.yml erstellen - Startet viele Container mit einer einzigen Docker-Datei (in unserem Fall ist dies nicht erforderlich, aber wenn Sie √ºber viele Dienste verf√ºgen, ist dies hilfreich.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie boot.sh (das Skript ist direkt f√ºr den Start verantwortlich).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, der Inhalt der Docker-Datei:</font></font><br>
<br>
<pre><code class="plaintext hljs">#<font></font>
FROM python:3.6.6-slim<font></font>
<font></font>
#  <font></font>
WORKDIR /home/alex/covid-bot<font></font>
<font></font>
#  requirements.txt<font></font>
COPY requirements.txt ./<font></font>
<font></font>
# Install required libs<font></font>
RUN pip install --upgrade pip -r requirements.txt; exit 0<font></font>
<font></font>
#      <font></font>
COPY data data<font></font>
<font></font>
#   <font></font>
COPY app.py faq.json reply_generator.py boot.sh  ./<font></font>
<font></font>
#   <font></font>
RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<font></font>
<font></font>
# <font></font>
RUN chmod +x boot.sh<font></font>
<font></font>
#  <font></font>
ENTRYPOINT ["./boot.sh"]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Inhalt von docker-compose.yml:</font></font><br>
<br>
<pre><code class="plaintext hljs"># docker-compose<font></font>
version: '2'<font></font>
#  <font></font>
services:<font></font>
  bot:<font></font>
    restart: unless-stopped<font></font>
    image: covid19_rus_bot:latest<font></font>
    container_name: covid19_rus_bot<font></font>
    #    boot.sh<font></font>
    environment:<font></font>
      - SERVICE_TYPE=covid19_rus_bot<font></font>
    # volume      <font></font>
    volumes: <font></font>
        - ./data:/data<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Inhalt von boot.sh:</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/bash<font></font>
if [ -n $SERVICE_TYPE ]<font></font>
then<font></font>
  if [ $SERVICE_TYPE == "covid19_rus_bot" ]<font></font>
  then<font></font>
    exec python app.py<font></font>
    exit<font></font>
  fi<font></font>
else<font></font>
  echo -e "SERVICE_TYPE not set\n"<font></font>
fi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sind also bereit, um all dies zu starten, m√ºssen Sie die folgenden Befehle im Projektordner ausf√ºhren:</font></font><br>
<br>
<pre><code class="bash hljs">sudo docker build -t covid19_rus_bot:latest .<font></font>
sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das war's, unser Bot ist bereit.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anstelle einer Schlussfolgerung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie erwartet ist der gesamte Code im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verf√ºgbar </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser von mir gezeigte Ansatz kann auf jeden Fall zur Beantwortung von FAQ-Fragen angewendet werden. Passen Sie einfach die Wissensdatenbank an! Die Wissensbasis kann auch verbessert werden, indem die Struktur von Schl√ºssel und Wert in Arrays ge√§ndert wird, sodass jedes Paar eine Reihe potenzieller Fragen zu einem Thema und eine Reihe potenzieller Antworten auf diese Fragen enth√§lt (zur Abwechslung k√∂nnen die Antworten zuf√§llig ausgew√§hlt werden). Nat√ºrlich ist der regelbasierte Ansatz f√ºr die Skalierung nicht zu flexibel, aber ich bin sicher, dass dieser Ansatz einer Wissensbasis mit etwa 500 Fragen standhalten wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diejenigen, die bis zum Ende gelesen haben, lade ich Sie ein, meinen Bot </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auszuprobieren </font><font style="vertical-align: inherit;">.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de494094/index.html">3D mach es selbst. Teil 1: Pixel und Linien</a></li>
<li><a href="../de494096/index.html">Intranet-Bereitstellung. Erfahrung, Fehler, Empfehlungen</a></li>
<li><a href="../de494098/index.html">Imperativer Ansatz f√ºr reaktive Daten am Beispiel von Jetbrains KTor und R2DBC</a></li>
<li><a href="../de494100/index.html">Was Sie brauchen, um das ideale Modell eines Bildungszentrums f√ºr die Ausbildung von IT-Spezialisten zu schaffen</a></li>
<li><a href="../de494114/index.html">Wie man die Anzahl reduziert und die Lesbarkeit von Code in React-Redux, Redux-Saga erh√∂ht</a></li>
<li><a href="../de494124/index.html">Zusammenbau eines 8-Bit-Computers: So reduzieren Sie die Anzahl der Chips auf sechs</a></li>
<li><a href="../de494126/index.html">TOP WISSENSCHAFT. Februar Medien 10: Crab Zombie Feministinnen, pr√§historische Salamander und √ºbertriebene Alkoholiker</a></li>
<li><a href="../de494128/index.html">Hackspace Neuron - ein Treffpunkt f√ºr Hacker in Moskau</a></li>
<li><a href="../de494130/index.html">Was passiert mit Online-Events? Einige unserer Statistiken</a></li>
<li><a href="../de494132/index.html">Befunge Compiler in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>