<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçò üñ≤Ô∏è ‚öóÔ∏è 3D do it yourself. Part 1: pixels and lines üíñ ü§ûüèª üñ•Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to devote this series of articles to readers who want to explore the world of 3D programming from scratch, to people who want to learn the basi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>3D do it yourself. Part 1: pixels and lines</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494094/"><img src="https://habrastorage.org/webt/-u/-n/6a/-u-n6axbw6fowganklzotzai0sk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I want to devote this series of articles to readers who want to explore the world of 3D programming from scratch, to people who want to learn the basics of creating the 3D component of games and applications. </font><font style="vertical-align: inherit;">We will implement each operation from scratch in order to understand every aspect, even if there is already a ready-made function that makes it faster. </font><font style="vertical-align: inherit;">Having learned, we will switch to the built-in tools for working with 3D. </font><font style="vertical-align: inherit;">After reading the series of articles, you will understand how to create complex three-dimensional scenes with light, shadows, textures and effects, how to do all this without deep knowledge in mathematics, and much more. </font><font style="vertical-align: inherit;">You can do all this both independently and with the help of ready-made tools.</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the first part we will consider:</font></font><br>
</b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendering concepts (software, hardware)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is a pixel / surface?</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detailed analysis of line output</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order not to waste your precious time reading articles, which may be incomprehensible to an unprepared person, I will immediately turn to the requirements. You can safely start reading articles on 3D, if you know the basics of programming in any language, because I will focus only on the study of 3D programming, and not on the study of the features of the language and the fundamentals of programming. As for the mathematical preparation, you should not worry here, although many have no desire to study 3D, because they are frightened by complex calculations and furious formulas because of which nightmares later dream, but in fact there is nothing to worry about. I will try to explain as clearly as possible everything necessary for 3D, you just have to be able to multiply, divide, add and subtract. So, if you have passed the selection criteria, you can start reading.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before starting to explore the interesting world of 3D, let's choose a programming language for examples, as well as a development environment. What language should I choose for programming 3D graphics? Anyone, you can work where you are most comfortable, the math will be the same everywhere. In this article, all examples will be shown in the context of JS (here tomatoes fly into me). Why js? It's simple - lately I have been working mainly with him, and therefore I can more effectively convey the essence to you. I will bypass all the features of JS in the examples, because we need only the most basic features that any language has, so we will pay attention specifically to 3D. But you choose what you love, because in the articles, all formulas will not be tied to the features of any programming language. Which environment to choose? It does not matter,in the case of JS, any text editor is suitable, you can use the one that is closer to you.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All examples will use canvas for painting, as with it, you can start drawing very quickly, without detailed analysis. Canvas is a powerful tool, with a lot of ready-made methods for drawing, but of all its features, for the first time, we will only use pixel output!&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All three-dimensional displays on the screen using pixels, later in the articles you will see how this happens. Will it slow down? Without hardware acceleration (for example, acceleration by a video card) - will be. In the first article, we will not use accelerations, we will write everything from scratch in order to understand the basic aspects of 3D. Let's look at a few terms that will be mentioned in future articles:</font></font><br>
<br>
<ul>
<li><i> (Rendering)</i> ‚Äî    3D-    . ,     3D-     ,        ,        .</li>
<li><i>  (Software Rendering) </i> ‚Äî     .  ,  , ,    -  .       ,     .       3D-   ,    ‚Äî  .</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware Rendering</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - A hardware-assisted rendering process. </font><font style="vertical-align: inherit;">I use it games and applications. </font><font style="vertical-align: inherit;">Everything works very fast, because </font><font style="vertical-align: inherit;">a lot of routine computing takes over the video card, which is designed for this.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I do not aspire to the title "definition of the year" and I try to state all descriptions of terms as clearly as possible. </font><font style="vertical-align: inherit;">The main thing is to understand the idea, which can then be developed independently. </font><font style="vertical-align: inherit;">I also want to draw attention to the fact that all the code examples that will be shown in the articles are often not optimized for speed, in order to maintain ease of understanding. </font><font style="vertical-align: inherit;">When you understand the main thing - how 3D graphics work, you can optimize everything yourself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, create a project, for me it's just a text </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file, with the following content:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>3D it‚Äôs easy. Part 1<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">&lt;!--         --&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"surface"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"800"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"600"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//    </span>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not focus too much on JS and canvas now - these are not the main characters of this article. </font><font style="vertical-align: inherit;">But for a general understanding, I‚Äôll clarify that &lt;canvas ...&gt; is a rectangle (in my case, 800 by 600 pixels in size) on which I will display all the graphics. </font><font style="vertical-align: inherit;">I registered canvas once and will not change it anymore.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span> ‚Ä¶ <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Script - an element within which we will write all the logic for rendering 3D graphics with our own hands (in JavaScript).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we just reviewed the structure of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file of the </font><font style="vertical-align: inherit;">newly created project, we will begin to deal with 3D graphics.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we draw something in the window, this in the final count turns into pixels, because it is them that the monitor displays. The more pixels, the sharper the picture, but the computer also loads more. How is what we draw in the window stored? The graphics in any window can be represented as an array of pixels, and the pixel itself is just a color. That is, a screen resolution of 800x600 means that our window contains 600 lines of 800 pixels each, namely 800 * 600 = 480000 pixels, a lot, isn't it? Pixels are stored in an array. Let's think in which array we would store the pixels. If we should have 800 by 600 pixels, then the most obvious option is in a two-dimensional array of 800 by 600. And this is almost the right option, or rather, the completely correct option. But the pixels of the window, it is better to store in a one-dimensional array of 480,000 elements (if the resolution is 800 by 600),just because it‚Äôs faster to work with a one-dimensional array, because it is stored in memory in a continuous sequence of bytes (everything lies nearby and therefore it is easy to get it). In a two-dimensional array (for example, in the case of JS), each line can be scattered at different places in memory, so accessing the elements of such an array will take longer. Also, to iterate over a one-dimensional array, only 1 cycle is needed, and for two-dimensional integers 2, given the need to do tens of thousands of iterations of the cycle, the speed is important here. What is a pixel in such an array? As mentioned above - this is just a color, or rather 3 of its components (red, green, blue). Any, even the most colorful picture is just an array of pixels of different colors. A pixel in memory can be stored as you like, either an array of 3 elements, or in a structure where red, gree,blue; or something else. An image consisting of an array of pixels that we just parse, I will continue to call the surface. It turns out that since everything that is displayed on the screen is stored in an array of pixels, then changing elements (pixels) in this array - we will pixel-by-pixel change the image on the screen. This is exactly what we will do in this article.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is no pixel drawing function in canvas, but it is possible to access a one-dimensional array of pixels, which we discussed above. </font><font style="vertical-align: inherit;">How to do this is shown in the example below (this and all examples in the future will only be inside the script element):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     ()    </span>
<span class="hljs-keyword">const</span> ctx = <span class="hljs-built_in">document</span>
.getElementById(<span class="hljs-string">'surface'</span>)<font></font>
.getContext(<span class="hljs-string">'2d'</span>)<font></font>
<font></font>
<span class="hljs-comment">//     ,   &nbsp;</span>
<span class="hljs-comment">// +       </span>
<span class="hljs-keyword">const</span> imageData = ctx.createImageData(<span class="hljs-number">800</span>, <span class="hljs-number">600</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the example, imageData is an object in which there are 3 properties:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">height and width</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - integers storing the height and width of the window for drawing</font></font><br>
</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 8-bit unsigned integer array (you can store numbers in the range from 0 to 255 in it)</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The data array has a simple but explanatory structure. </font><font style="vertical-align: inherit;">This one-dimensional array stores data of each pixel, which we will display on the screen in the following format:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first 4 elements of the array (indices 0,1,2,3) are the data of the first pixel in the first row. The second 4 elements (indices 4, 5, 6, 7) are the data of the second pixel of the first row. When we get to the 800th pixel of the first line, provided that the window is 800 pixels wide - the 801th pixel will already belong to the second line. If we change it, on the screen we will see that the 1st pixel of the 2nd row has changed (although by the count in the array it will be the 801st pixel). Why is there 4 elements for each pixel in the array? This is because in canvas, in addition to allocating 1 element for each color - red, green, blue (these are 3 elements), 1 more element for transparency (they also say the alpha channel or opacity). Alpha channel, like color, is set in the range from 0 (transparent) to 255 (opaque). With this structure, we get a 32-bit image,because each pixel consists of 4 elements of 8 bits. To summarize: each pixel contains: red, green, blue colors and alpha channel (transparency). This color scheme is called ARGB (Alpha Red Green Blue). And the fact that each pixel occupies 32 bits says that we have a 32 bit image (they also say an image with a color depth of 32 bits).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By default, the entire array of pixels imageData.data (data is a property in which the array of pixels, and imageData is just an object) is filled with the values ‚Äã‚Äã0, and if we tried to output such an array, we would not see anything interesting on the screen, because 0 , 0, 0 is black, but since the transparency here will also be 0, and this is a completely transparent color, we won‚Äôt even see black on the screen!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is inconvenient to work directly with such a one-dimensional array, so we will write a class for it in which we will create methods for drawing. I will name the class - Drawer. This class will store only the necessary data and carry out the necessary calculations, abstracting as much as possible from the tool used for rendering. That is why we will place all the calculations and work with the array in it. And the very call to the display method on canvas, we will place outside the class, because there might be something else instead of canvas. In this case, our class will not have to be changed. To work with an array of pixels (surface), it is more convenient for us to save it in the Drawer class, as well as the width and height of the image, so that we can correctly access the desired pixel. So, the Drawer class, while preserving the minimum data necessary for drawing, looks like this for me:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Drawer</span> </span>{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;surface = <span class="hljs-literal">null</span>
&nbsp;&nbsp;&nbsp;&nbsp;width = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;height = <span class="hljs-number">0</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(surface, width, height) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface = surface
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.width = width
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.height = height<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see in the constructor, the Drawer class takes all the necessary data and saves it. </font><font style="vertical-align: inherit;">Now you can create an instance of this class and pass an array of pixels, width and height into it (we already have all this data, because we created it above and stored it in imageData):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> drawer = <span class="hljs-keyword">new</span> Drawer(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;imageData.data,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;imageData.width,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;imageData.height<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the Drawer class, we will write several drawing functions, for ease of work in the future. </font><font style="vertical-align: inherit;">We will have a function for drawing a pixel, a function for drawing a line, and in further articles functions for drawing a triangle and other shapes will appear. </font><font style="vertical-align: inherit;">But let's start with the pixel drawing method. </font><font style="vertical-align: inherit;">I'll call him drawPixel. </font><font style="vertical-align: inherit;">If we draw a pixel, then it should have coordinates, as well as color:</font></font><br>
<br>
<pre><code class="javascript hljs">drawPixel(x, y, r, g, b)&nbsp; { }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that the drawPixel function does not accept the alpha parameter (transparency), and above we figured out that the pixel array consists of 3 color parameters and 1 transparency parameter. I didn‚Äôt specifically indicate transparency, since we absolutely do not need it for examples. By default, we will set 255 (i.e. everything will be opaque). Now let's think about how to write the desired color into an array of pixels in x, y coordinates. Since we have all the information about the image is stored in a one-dimensional array, in which 1 pixel (8 bits) is allocated for each pixel. To access the desired pixel in the array, we first need to determine the red location index, because any pixel begins with it (eg [r, g, b, a]). A little explanation of the structure of the array:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/4j/8o/uz4j8olujyuhzo3z1anuexucnoc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The table in green indicates how color components are stored in a one-dimensional surface array. Their indices in the same array are indicated in blue, and the coordinates of the pixel that accepts the drawPixel functions, which we need to convert to indices in the one-dimensional array, indicate r, g, b, a for the pixel in blue. So, from the table it can be seen that for each pixel the red component of the color comes first, let's start with it. Suppose we want to change the red component of the pixel color in the coordinates X1Y1 with an image size of 2 by 2 pixels. In the table we see that this is index 12, but how to calculate it? First we find the index of the row we need, for this we multiply the image width by Y and by 4 (the number of values ‚Äã‚Äãper pixel) - this will be:</font></font><br>
<br>
<pre><code class="plaintext hljs">width * y * 4 <font></font>
//  :<font></font>
2 * 1 * 4 = 8</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We see that the 2nd line begins with index 8. If we compare with the plate, the result converges. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you need to add a column offset to the found row index to get the desired red index. </font><font style="vertical-align: inherit;">To do this, add X times 4 to the row index. The full formula will be:</font></font><br>
<br>
<pre><code class="plaintext hljs">width * y * 4 + x * 4 <font></font>
//     :<font></font>
(width * y + x) * 4<font></font>
//  :<font></font>
(2 * 1 + 1) * 4 = 12</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we compare 12 with the table and see that the pixel X1Y1 really starts with index 12. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To find the indices of other color components, you need to add the color offset to the red index: +1 (green), +2 (blue), +3 (alpha) . </font><font style="vertical-align: inherit;">Now we can implement the drawPixel method inside the Drawer class using the formula above:</font></font><br>
<br>
<pre><code class="javascript hljs">drawPixel(x, y, r, g, b) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> offset = (<span class="hljs-keyword">this</span>.width * y + x) * <span class="hljs-number">4</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset] = r
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">1</span>] = g
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">2</span>] = b
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">3</span>] = <span class="hljs-number">255</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this drawPixel method, I rendered the repeating part of the formula to the offset constant. It is also seen that in alpha I just write 255, because it is in the structure, but now we do not need to output pixels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is time to test the code and finally see the first pixel on the screen. Here is an example using the pixel render method:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     Drawer</span>
drawer.drawPixel(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
drawer.drawPixel(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<font></font>
<font></font>
<span class="hljs-comment">//         canvas</span>
ctx.putImageData(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the example above, I draw 2 pixels, one red 255, 0, 0, the other blue 0, 0, 255. But the changes in the imageData.data array (it is also the surface inside the Drawer class) will not appear on the screen. To draw, you need to call ctx.putImageData (imageData, 0, 0), where imageData is the object in which the pixel array and width / height of the drawing area, and 0, 0 is the point relative to which the pixel array will be displayed (always leave 0, 0 ) If you did everything correctly, then you will have the following picture in the upper left of the canvas element in the browser window: Did you see the </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d8/xn/cz/d8xnczchpgfg-9amhgdlyrpvzma.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pixels? They are so small, and how much work has been done.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's try to add a bit of dynamics to the example, for example, so that every 10 milliseconds our pixel shifts to the right (we change X pixels by +1 every 10 milliseconds), we correct the pixel drawing code by one at an interval:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> x = <span class="hljs-number">10</span>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;drawer.drawPixel(x++, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ctx.putImageData(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
<font></font>
}, <span class="hljs-number">10</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this example, I left only the output of the blue pixel and wrapped the setInterval function with the parameter 10 in JavaScript. This means that the code will be called approximately every 10 milliseconds. If you run such an example, you will see that instead of a pixel shifting to the right, you will have something like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/0v/uu/8o0vuuurtmmqgu8uy7sufdka16o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Such a long strip (or trace) remains because we do not clear the color of the previous pixel in the surface array, so with each invocation of the interval, we also add one pixel. Let's write a method that will clean the surface to its original state. In other words, fill the array with zeros. Add the clearSurface method to the Drawer class:</font></font><br>
<br>
<pre><code class="javascript hljs">clearSurface() {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> surfaceSize = <span class="hljs-keyword">this</span>.width * <span class="hljs-keyword">this</span>.height * <span class="hljs-number">4</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; surfaceSize; i++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.surface[i] = <span class="hljs-number">0</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are no logic in this array, just padding with zeros. </font><font style="vertical-align: inherit;">It is recommended that you call this method each time before drawing a new image. </font><font style="vertical-align: inherit;">In the case of pixel animation, before drawing this pixel:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> x = <span class="hljs-number">10</span>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;drawer.clearSurface()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;drawer.drawPixel(x++, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ctx.putImageData(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
}, <span class="hljs-number">10</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now if you run this example, the pixel will shift to the right, one by one - without an unnecessary trace from previous coordinates. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last thing we implement in the first article is the line drawing method. </font><font style="vertical-align: inherit;">Add it, of course, to the Drawer class. </font><font style="vertical-align: inherit;">The method I will call drawLine. </font><font style="vertical-align: inherit;">What will he take? </font><font style="vertical-align: inherit;">Unlike a point, the line still has the coordinates at which it ends. </font><font style="vertical-align: inherit;">In other words, the line has a beginning, end and color, which we will pass to the method:</font></font><br>
<br>
<pre><code class="javascript hljs">drawLine(x1, y1, x2, y2, r, g, b) { }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any line consists of pixels, it remains only to correctly fill it with pixels from x1, y1 to x2, y2. To begin with, since the line consists of pixels, then we will output it pixel by pixel in the loop, but how to calculate how many pixels to output? For example, to draw a line from [0, 0] to [3, 0] it is intuitively clear that you need 4 pixels ([0, 0], [1, 0], [2, 0], [3, 0],) . But from [12, 6] to [43, 14], it is already not clear how long the line will be (how many pixels to display) and what coordinates they will have. To do this, recall a little geometry. So, we have a line that starts at x1, y1 and ends at x2, y2.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ou/z7/ip/ouz7ipd2uiokmmijlro7wldayzw.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's draw a dotted line from the beginning and the end so that we get a triangle (picture above). </font><font style="vertical-align: inherit;">We will see that at the junction of the drawn lines an angle of 90 degrees has formed. </font><font style="vertical-align: inherit;">If the triangle has such an angle, then the triangle is called rectangular, and its sides, between which the angle is 90 degrees, are called legs. </font><font style="vertical-align: inherit;">The third solid line (which we are trying to draw) is called hypotenuse in a triangle. </font><font style="vertical-align: inherit;">Using these two introduced legs (c1 and c2 in the figure), we can calculate the length of the hypotenuse using the Pythagorean theorem. </font><font style="vertical-align: inherit;">Let's see how to do it. </font><font style="vertical-align: inherit;">The formula for the length of the hypotenuse (or line length) will be as follows:&nbsp;</font></font><br>
<p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x433;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x438;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43F;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43E;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x435;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43D;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x443;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x437;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x430;</mo></mrow><mo>=</mo><msqrt><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43A;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x430;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x435;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><msup><mn>1</mn><mn>2</mn></msup><mo>+</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x43A;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x430;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x435;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x442;</mo></mrow><msup><mn>2</mn><mn>2</mn></msup></msqrt></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.778ex" height="4.759ex" viewBox="0 -1401.3 13682.2 2049.1" role="img" focusable="false" style="vertical-align: -1.505ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text><g transform="translate(376,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(861,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1345,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1776,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(2152,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(2535,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(3019,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(3450,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(3790,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgze2zTkhMSsTwnIHWUIHdt6Ptuwg#MJMAIN-3D" x="4499" y="0"></use><g transform="translate(5555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgze2zTkhMSsTwnIHWUIHdt6Ptuwg#MJSZ2-221A" x="0" y="87"></use><rect stroke="none" width="7126" height="60" x="1000" y="1178"></rect><g transform="translate(1000,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text><g transform="translate(430,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(861,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1237,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1620,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(1997,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgze2zTkhMSsTwnIHWUIHdt6Ptuwg#MJMAIN-31" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgze2zTkhMSsTwnIHWUIHdt6Ptuwg#MJMAIN-32" x="707" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgze2zTkhMSsTwnIHWUIHdt6Ptuwg#MJMAIN-2B" x="3173" y="0"></use><g transform="translate(4174,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(4605,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(5035,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(5412,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(5795,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(53.819) matrix(1 0 0 -1 0 0)"></text></g><g transform="translate(6171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgze2zTkhMSsTwnIHWUIHdt6Ptuwg#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/494094/&amp;usg=ALkJrhgze2zTkhMSsTwnIHWUIHdt6Ptuwg#MJMAIN-32" x="707" y="583"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mo>=</mo><msqrt><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><msup><mn>1</mn><mn>2</mn></msup><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo></mo></mrow><msup><mn>2</mn><mn>2</mn></msup></msqrt></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> = \sqrt{1^2 + 2^2}</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to get both legs is also seen from the triangle. </font><font style="vertical-align: inherit;">Now, using the formula above, we find the hypotenuse, which will be the long line (the number of pixels):</font></font><br>
<br>
<pre><code class="javascript hljs">&nbsp;drawLine(x1, y1, x2, y2, r, g, b) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c1 = y2 - y1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c2 = x2 - x1<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> length = <span class="hljs-built_in">Math</span>.sqrt(c1 * c1 + c2 * c2)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We already know how many pixels to draw to draw a line. But we do not yet know how pixels are shifted. That is, we need to draw a line from x1, y1 to x2, y2, we know that the line length will be, for example, 20 pixels. We can draw the 1st pixel in x1, y1 and the last in x2, y2, but how to find the coordinates of the intermediate pixels? To do this, we need to get how to shift each next pixel with respect to x1, y1 to get the desired line. I will give one more example in order to better understand what kind of displacement we are talking about. We have points [0, 0] and [0, 3], we need to draw a line on them. From the example it is clearly seen that the next point after [0, 0] will be [0, 1], and then [0, 2] and finally [0, 3]. That is, X of each point was not shifted, well, or we can say that it was shifted by 0 pixels, and Y was shifted by 1 pixel, this is the offset,it can be written as [0, 1]. Another example: we have a point [0, 0] and a point [3, 6], let's try to calculate in our mind how they shift, the first will be [0, 0], then [0.5, 1], then [1, 2] then [1.5, 3] and so on to [3, 6], in this example the offset will be [0.5, 1]. How to calculate it?&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can use the following formula:</font></font><br>
<br>
<pre><code class="javascript hljs">   = <span class="hljs-number">2</span> /  <font></font>
  Y = <span class="hljs-number">1</span> /  &nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the program code, we will have this:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> xStep = c2 / length
<span class="hljs-keyword">const</span> yStep = c1 / length</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All the data is already there: the length of the line, the offset of the pixels along X and Y. We start in the cycle to draw:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.drawPixel(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(x1 + xStep * i),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(y1 + yStep * i),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r, g, b,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As the X coordinate of the Pixel function, we pass the beginning of the X line + offset X * i, thus, getting the coordinate of the i-th pixel, we also calculate the Y coordinate. Math.trunc is a method in JS that allows you to discard the fractional part of a number. </font><font style="vertical-align: inherit;">The whole method code looks like this:</font></font><br>
<br>
<pre><code class="javascript hljs">drawLine(x1, y1, x2, y2, r, g, b) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c1 = y2 - y1
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> c2 = x2 - x1<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> length = <span class="hljs-built_in">Math</span>.sqrt(c1 * c1 + c2 * c2)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> xStep = c2 / length
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> yStep = c1 / length<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.drawPixel(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(x1 + xStep * i),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.trunc(y1 + yStep * i),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r, g, b,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first part has come to an end, a long but exciting path to comprehending the 3D world. </font><font style="vertical-align: inherit;">There was nothing three-dimensional yet, but we performed preparatory operations for drawing: we implemented the functions of drawing a pixel, a line, clearing a window and learned a few terms. </font><font style="vertical-align: inherit;">All code of the Drawer class can be viewed under the spoiler:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drawer class code</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Drawer</span> </span>{<font></font>
  surface = <span class="hljs-literal">null</span>
  width = <span class="hljs-number">0</span>
  height = <span class="hljs-number">0</span><font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(surface, width, height) {
    <span class="hljs-keyword">this</span>.surface = surface
    <span class="hljs-keyword">this</span>.width = width
    <span class="hljs-keyword">this</span>.height = height<font></font>
  }<font></font>
<font></font>
  drawPixel(x, y, r, g, b)  {<font></font>
    <span class="hljs-keyword">const</span> offset = (<span class="hljs-keyword">this</span>.width * y + x) * <span class="hljs-number">4</span><font></font>
<font></font>
    <span class="hljs-keyword">this</span>.surface[offset] = r
    <span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">1</span>] = g
    <span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">2</span>] = b
    <span class="hljs-keyword">this</span>.surface[offset + <span class="hljs-number">3</span>] = <span class="hljs-number">255</span><font></font>
  }<font></font>
<font></font>
  drawLine(x1, y1, x2, y2, r, g, b) {<font></font>
    <span class="hljs-keyword">const</span> c1 = y2 - y1
    <span class="hljs-keyword">const</span> c2 = x2 - x1<font></font>
<font></font>
    <span class="hljs-keyword">const</span> length = <span class="hljs-built_in">Math</span>.sqrt(c1 * c1 + c2 * c2)<font></font>
<font></font>
    <span class="hljs-keyword">const</span> xStep = c2 / length
    <span class="hljs-keyword">const</span> yStep = c1 / length<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span> ; i &lt; length ; i++) {
        <span class="hljs-keyword">this</span>.drawPixel(
          <span class="hljs-built_in">Math</span>.trunc(x1 + xStep * i),
          <span class="hljs-built_in">Math</span>.trunc(y1 + yStep * i),<font></font>
          r, g, b,<font></font>
        )<font></font>
    }<font></font>
  }<font></font>
<font></font>
  clearSurface() {<font></font>
    <span class="hljs-keyword">const</span> surfaceSize = <span class="hljs-keyword">this</span>.width * <span class="hljs-keyword">this</span>.height * <span class="hljs-number">4</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; surfaceSize; i++) {
      <span class="hljs-keyword">this</span>.surface[i] = <span class="hljs-number">0</span><font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre></div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's next?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the next article, we will look at how such a simple operation as the output of a pixel and a line can turn into interesting 3D objects. </font><font style="vertical-align: inherit;">We will get acquainted with matrices and operations on them, display a three-dimensional object in a window and even add animation.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494076/index.html">Analysis: investor behavior strategies during stock market crashes</a></li>
<li><a href="../en494082/index.html">Dalenka: the most useful articles about effective work from home</a></li>
<li><a href="../en494084/index.html">Coronavirus: online information services</a></li>
<li><a href="../en494090/index.html">Celery throttling - setting rate limit for queues</a></li>
<li><a href="../en494092/index.html">Degradation of the connected structure</a></li>
<li><a href="../en494096/index.html">Intranet deployment. Experience, mistakes, recommendations</a></li>
<li><a href="../en494098/index.html">Imperative approach to reactive data on the example of Jetbrains KTor and R2DBC</a></li>
<li><a href="../en494100/index.html">What you need to create the ideal model of an educational center for training IT-specialists</a></li>
<li><a href="../en494110/index.html">Property-based testing for JavaScript and UI: an unusual approach to automated tests</a></li>
<li><a href="../en494114/index.html">How to reduce the number and increase the readability of code in react-redux, redux-saga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>