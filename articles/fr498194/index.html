<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤹🏻 📶 🎠 Localisateur de services - Dissiper les mythes 💳 ☂️ 📜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il est étonnant de voir comment une pratique démontrant de bonnes performances et la convivialité d'une plate-forme est diabolisée dans un camp d'adhé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Localisateur de services - Dissiper les mythes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498194/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/q0/yb/tf/q0ybtf5xhq0ygzxuevhduuup9k0.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est étonnant de voir comment une pratique démontrant de bonnes performances et la convivialité d'une plate-forme est diabolisée dans un camp d'adhérents d'une autre plate-forme. </font><font style="vertical-align: inherit;">Ce sort est entièrement ressenti par le modèle de Service Locator, qui est très populaire dans .Net et a une mauvaise réputation dans iOS.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans certains articles, ServiceLocator est négligé, le qualifiant de «vélo». </font><font style="vertical-align: inherit;">D'autres soutiennent que c'est contre-modèle. </font><font style="vertical-align: inherit;">Il y a ceux qui essaient de maintenir la neutralité en décrivant les côtés positifs et négatifs du localisateur. </font><font style="vertical-align: inherit;">Dans une large mesure, Habrahabr lui-même contribue à ces persécutions, qui contient plusieurs articles similaires avec des références croisées. </font><font style="vertical-align: inherit;">Chaque nouveau développeur qui rencontre l'implémentation de Latitude est presque immédiatement infecté par la négligence - eh bien, de nombreux développeurs ne peuvent pas critiquer la même chose sans raisons objectives.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des articles</font></font></b>
                        <div class="spoiler_text"><ul>
<li>2010: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern</a>/</li>
<li>2015 :<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> https://habr.com/ru/company/rambler-co/blog/258325/</a></li>
<li>2015: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/ru/post/270005/</a></li>
<li>2016: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/ru/company/jugru/blog/300886/</a></li>
<li>2017: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/ru/company/badoo/blog/344506/</a></li>
<li>2018: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/ru/company/redmadrobot/blog/352088</a></li>
</ul><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est ce que c'est vraiment? Pour reprendre les mots d'un personnage célèbre: «N'aimez-vous pas les chats? Oui, vous ne les avez tout simplement pas! " En fait, avez-vous essayé de manger de la viande non salée? Et brut cru? Vous n'avez pas à faire d'effort pour comprendre ce que manger du porc est mauvais, surtout le vendredi soir. Ainsi, avec le modèle Service Locator - plus la prévalence des informations brutes est élevée - plus les préjugés contre elles sont importants.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c-/gf/0d/c-gf0dpfbeujk8--liho9lp_wwm.jpeg" align="left" width="300"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'un des plus grands esprits de l'antiquité, Titus Lucretius Car était convaincu que le soleil tourne autour de la terre malgré le fait que dans les autres parties de son livre "Sur la nature des choses", relatives au 1er siècle avant JC. de nombreuses prévisions scientifiques précises ont été faites - de la force de gravité à la physique nucléaire. Sans remettre en cause le pouvoir d'autorité, nous montrons que certains préjugés sont facilement nivelés en utilisant un levier de la bonne longueur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, rappelez-vous ce qu'est un localisateur de services et à quoi il peut servir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un service est un objet autonome qui encapsule la logique métier en lui-même et peut avoir des liens avec d'autres objets. En fait, une instance de n'importe quelle classe peut agir comme un service. Très souvent, au lieu du concept de service, le concept de «manager» est utilisé. Cependant, une situation courante est lorsqu'une classe statique agit comme un gestionnaire, qui manipule les données du référentiel. L'essence du service est qu'il s'agit d'une instance de la classe, avec toutes les conséquences qui en découlent. Cela signifie qu'il ne peut pas exister dans le vide - il doit avoir un support auquel il est attaché pendant la durée de vie de l'application. Un tel transporteur est un localisateur de services.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisateur (application ou développeur) demande un service du type spécifié au localisateur de services et reçoit une instance prête à l'emploi. Très similaire à une usine abstraite, non? La différence est que chaque fois que vous demandez une instance du type spécifié au localisateur de services, vous recevrez la même instance encore et encore, qui stocke les données qui ont déjà été utilisées. Il semblerait que le service se comporte comme un singleton typique, mais ce n'est pas le cas. Vous pouvez créer autant d'instances du service que vous le souhaitez et les utiliser indépendamment à votre discrétion. Dans le même temps, chacun d'eux encapsulera les données que vous y publierez tout au long de votre vie.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e0/yp/wf/e0ypwfrqeyyykocycqh6lz8gtjy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi cela pourrait-il être nécessaire? L'exemple le plus évident et le plus apprécié est le profil utilisateur. Si vous n'utilisez pas de stockage sous la forme de UserSettings ou CoreData, alors pendant toute la durée de vie de l'application, vous devrez maintenir le lien vers une instance de la classe UserProfile quelque part afin de l'utiliser sur différents écrans de l'application. De plus, si une telle instance n'est pas un singleton, elle devra être transférée d'un formulaire à un autre. La difficulté surviendra inévitablement lorsque, dans un certain cycle de développement de l'application, vous devrez créer un utilisateur temporaire ou un autre utilisateur indépendant. Sington devient immédiatement un goulot d'étranglement. Et les instances indépendantes commencent à surcharger la logique d'application, dont la complexité augmente de façon exponentielle à mesure que de plus en plus de contrôleurs intéressés par l'instance sont ajoutés.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/pm/yf/hkpmyf9gnih2yltehozvkdqdbew.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le localisateur de services résout élégamment ce problème: si vous avez une classe UserProfile abstraite et les classes spécifiques DefaultUserPrifile et TemporatyUserProfile héritées d'elle (avec une implémentation absolument vide, c'est-à-dire pratiquement identique), l'accès au localisateur de service vous renverra deux objets indépendants identiques.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre application du localisateur est le transfert d'instances de données via une chaîne de contrôleurs: sur le premier contrôleur, vous créez (recevez) un objet et le modifiez, et sur le dernier - utilisez les données que vous avez entrées sur le premier objet. Si le nombre de contrôleurs est assez important et qu'ils sont situés sur la pile, l'utilisation d'un délégué à ces fins sera assez difficile. De même, il est souvent nécessaire à la racine de la pile d'afficher des informations qui ont changé sur son sommet immédiatement après avoir minimisé la pile (nous nous souvenons que la pile aime supprimer toutes les instances créées dans sa copie). Cependant, si en haut de la pile vous recevez un service et le modifiez, et après cela lancez le pliage de la pile, alors lorsque le contrôleur racine devient disponible pour l'utilisateur, les données modifiées seront enregistrées et seront disponibles pour l'affichage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De manière générale, si vous utilisez le modèle "Coordinateur", comme il est décrit dans la plupart des didacticiels (par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), vous devez soit placer son instance de la classe dans AppDelegate, soit transmettre un lien vers le coordinateur à tous les ViewControllers qui va l'utiliser. Nécessaire? Et pourquoi, en fait?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e0/yp/wf/e0ypwfrqeyyykocycqh6lz8gtjy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Personnellement, je préfère AppDelegate pour briller. </font><font style="vertical-align: inherit;">Et pour hériter d'ICoordinatable et définir le champ du coordinateur - non seulement passe du temps (ce qui, comme nous le savons, équivaut à de l'argent), mais prive également la possibilité d'une programmation déclarative humaine via des storyboards. </font><font style="vertical-align: inherit;">Non, ce n'est pas notre méthode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La création d'un coordinateur en tant que service fait gracieusement les inconvénients des avantages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous n'avez pas besoin de vous soucier du maintien de l'intégrité du coordinateur;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le coordinateur devient disponible tout au long de l'application, même dans les contrôleurs qui ne sont pas hérités d'ICoordinatable;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous ne lancez un coordinateur que lorsque vous en avez besoin.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser le coordinateur avec le storyboard dans n'importe quel ordre (pratique pour vous).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation d'un coordinateur avec un storyboard vous permet de créer des mécanismes de navigation non évidents mais efficaces.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le coordinateur est la moitié du modèle «Navigateur» (le mécanisme pour se déplacer dans l'application via un chemin calculé à l'aide d'un routeur). </font><font style="vertical-align: inherit;">Avec sa mise en œuvre, la complexité augmente d'un ordre de grandeur. </font><font style="vertical-align: inherit;">Fonctionnalités du navigateur en conjonction avec le localisateur de services - il s'agit d'un vaste sujet distinct. </font><font style="vertical-align: inherit;">Revenons à notre localisateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les raisons objectives qui conduisent à la raison pour laquelle le localisateur de service est mauvais incluent la complexité de sa maintenance pour un service particulier et l'incapacité de contrôler l'état de la mémoire du localisateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mécanisme traditionnel de création d'un service est ce code:</font></font><br>
<br>
<pre><code class="swift hljs">...
 <span class="hljs-type">ServiceLocator</span>.shared.addService(<span class="hljs-type">CurrentUserProvider</span>() <span class="hljs-keyword">as</span> <span class="hljs-type">CurrentUserProviding</span>)<font></font>
...<font></font>
<span class="hljs-keyword">let</span> userProvider: <span class="hljs-type">UserProviding?</span> =  <span class="hljs-type">ServiceLocator</span>.shared.getService()
<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> provider =  userProvider <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
<span class="hljs-keyword">self</span>.user = provider.currentUser()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou comme ça:</font></font><br>
<br>
<pre><code class="swift hljs">&nbsp;<span class="hljs-keyword">if</span> let_:<span class="hljs-type">ProfileService</span> = <span class="hljs-type">ServiceLocator</span>.service() {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.addService(<span class="hljs-type">ProfileService</span>())<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; }<font></font>
&nbsp;<span class="hljs-keyword">let</span> service:<span class="hljs-type">ProfileService</span> = <span class="hljs-type">ServiceLocator</span>.service()!<font></font>
&nbsp; service.update(name: <span class="hljs-string">"MyName"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est-il terrible? </font><font style="vertical-align: inherit;">Vous devez d'abord enregistrer le service, puis l'extraire pour l'utiliser. </font><font style="vertical-align: inherit;">Dans le premier cas, il est garanti qu'elle existera lorsqu'elle sera demandée. </font><font style="vertical-align: inherit;">Mais le second ne crée pas le service avant qu'il ne soit nécessaire. </font><font style="vertical-align: inherit;">Si vous devez retirer le service dans de nombreux endroits, l'alternative de choix peut vous rendre fou. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il est facile de transformer tout cela en un tel code:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">ProfileService</span>.service.update(name: <span class="hljs-string">"MyName"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, l'instance de service est garantie d'exister, car si elle est absente, elle est créée par le service lui-même. </font><font style="vertical-align: inherit;">Rien de plus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxième revendication du localisateur est apparemment due au fait que les développeurs qui effectuent le traçage de modèle avec C # oublient le travail du ramasse-miettes et ne prennent pas la peine de fournir la possibilité de nettoyer le localisateur d'une instance inutile, bien que ce ne soit pas du tout difficile:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">ProfileService</span>.service.remove()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ne le faites pas, lorsque vous vous tournerez vers ProfileService.service (), nous obtiendrons une instance du service avec lequel nous avons déjà travaillé à un endroit arbitraire de l'application. Mais si vous supprimez (), lors de l'accès au service, vous obtiendrez une copie propre. Dans certains cas, au lieu de remove (), vous pouvez rendre clear () en effaçant la partie prédéfinie des données et en continuant à travailler avec la même instance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application de test démontre le travail coordonné de deux services: le profil utilisateur et le coordinateur. Le coordinateur n'est pas le but de l'article, mais seulement un exemple pratique.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/d3/n5/pi/d3n5pivlyhibh_g6b9yoqrmpvpu.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vidéo montre que la valeur entrée dans le champ est transmise à chaque écran suivant de l'application. </font><font style="vertical-align: inherit;">Et sur l'écran final, le coordinateur est appelé pour lancer l'application depuis le premier écran. </font><font style="vertical-align: inherit;">Notez que le pliage traditionnel de la pile de navigation ne se produit pas ici - il est éjecté entièrement de la mémoire, une nouvelle pile commence à sa place. </font><font style="vertical-align: inherit;">Si vous commentez la ligne de suppression du service de profil, le nom d'utilisateur sera transféré sur le premier écran, comme si nous avions réduit la pile de navigation.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-type">ProfileService</span>.service.remove()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application entière se compose de deux contrôleurs de vue, avec un minimum d'opérations préparatoires.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/no/k_/sd/nok_sdvjddqny_nnk-v5te7tkhm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
StartViewController:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StartViewController</span>: <span class="hljs-title">UIViewController</span> </span>{<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBOutlet</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> nameField: <span class="hljs-type">UITextField!</span><font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">super</span>.viewDidLoad()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.nameField.text = <span class="hljs-type">ProfileService</span>.service.info.name<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBAction</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">startAction</span><span class="hljs-params">(<span class="hljs-number">_</span> sender: UIButton)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ProfileService</span>.service.update(name: <span class="hljs-keyword">self</span>.nameField.text ?? <span class="hljs-string">""</span>)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">CoordinatorService</span>.service.coordinator.startPageController()<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PageViewController:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageViewController</span>: <span class="hljs-title">UIViewController</span> </span>{<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBOutlet</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> nameLabel: <span class="hljs-type">UILabel!</span><font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">super</span>.viewDidLoad()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.nameLabel.text = <span class="hljs-type">ProfileService</span>.service.info.name<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-meta">@IBAction</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">finishAction</span><span class="hljs-params">(<span class="hljs-number">_</span> sender: UIButton)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ProfileService</span>.service.remove()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">CoordinatorService</span>.service.coordinator.start()<font></font>
&nbsp; &nbsp; }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le premier contrôleur, une instance de profil est créée dans la méthode viewDidLoad () et les informations de nom d'utilisateur sont chargées dans le champ de saisie. Et après avoir cliqué sur le bouton Se connecter, les données de service sont à nouveau mises à jour. Après quoi, il y a une transition forcée vers la première page de l'assistant. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'intérieur de l'assistant, les données s'affichent à l'écran. Mais l'événement n'est lié à un bouton que sur le dernier écran du storyboard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que cela puisse être compliqué? Mais au cours des 5 dernières années, j'ai rencontré constamment des développeurs qui ne comprennent pas comment tout cela fonctionne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, tout le travail principal a lieu dans le localisateur et le service lui-même. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Localisateur:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Foundation<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">IService</span> </span>{
&nbsp; &nbsp; <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> service: <span class="hljs-type">Self</span> {<span class="hljs-keyword">get</span>}<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span></span><font></font>
}<font></font>
<span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">IServiceLocator</span> </span>{
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span>&lt;T&gt;<span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">T?</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceLocator</span>: <span class="hljs-title">IServiceLocator</span> </span>{<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> instance = <span class="hljs-type">ServiceLocator</span>()
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> services: [<span class="hljs-type">String</span>: <span class="hljs-type">Any</span>] = [:]<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-comment">// MARK: - Public methods</span>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">service</span>&lt;<span class="hljs-title">T</span>&gt;() -&gt; <span class="hljs-title">T</span>? </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> instance.service()<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">addService</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-title">_</span> <span class="hljs-title">service</span>: <span class="hljs-title">T</span>) </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> instance.addService(service)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">clear</span>() </span>{<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; instance.services.removeAll()<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span> <span class="hljs-title">removeService</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-title">_</span> <span class="hljs-title">service</span>: <span class="hljs-title">T</span>) </span>{<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; instance.removeService(service)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">service</span>&lt;T&gt;<span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">T?</span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> key = typeName(<span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> services[key] <span class="hljs-keyword">as</span>? <span class="hljs-type">T</span><font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-comment">// MARK: - Private methods</span>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> fun caddService&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-number">_</span> service: <span class="hljs-type">T</span>) {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> key = typeName(<span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; services[key] = service<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">removeService</span>&lt;T&gt;<span class="hljs-params">(<span class="hljs-number">_</span> service: T)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> key = typeName(<span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; services.removeValue(forKey: key)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">typeName</span><span class="hljs-params">(<span class="hljs-number">_</span> some: <span class="hljs-keyword">Any</span>)</span></span> -&gt; <span class="hljs-type">String</span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> (some isAny.<span class="hljs-type">Type</span>) ? <span class="hljs-string">"\(some)"</span> : <span class="hljs-string">"\(type(of: some))"</span><font></font>
&nbsp; &nbsp; }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous regardez de plus près, vous remarquerez que vous pouvez potentiellement nettoyer toute la zone de données du localisateur en une seule action: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ServiceLocator.clear () Un </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
profil de service n'est pas beaucoup plus compliqué:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProfileService</span>: <span class="hljs-title">IService</span> </span>{<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> (<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> info = <span class="hljs-type">ProfileInfo</span>()<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">var</span> <span class="hljs-title">service</span>: <span class="hljs-title">ProfileService</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> service: <span class="hljs-type">ProfileService</span> = <span class="hljs-type">ServiceLocator</span>.service() {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> service = <span class="hljs-type">ProfileService</span>()
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.addService(service)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.info = <span class="hljs-type">ProfileInfo</span>()<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.removeService(<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">update</span><span class="hljs-params">(name: String)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.info.name = name<font></font>
&nbsp; &nbsp; }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ProfileInfo</span> </span>{<font></font>
&nbsp; &nbsp; varname = <span class="hljs-string">""</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut être encore simplifié en déplaçant la zone de données à l'intérieur du service lui-même. </font><font style="vertical-align: inherit;">Mais sous cette forme, il devient clair le domaine de responsabilité du modèle de données et du service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est possible que pour le travail de vos services vous ayez à effectuer certaines opérations préparatoires, comme c'est le cas avec la création d'un service coordinateur.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> UIKit<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoordinatorService</span>: <span class="hljs-title">IService</span> </span>{<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> (<span class="hljs-keyword">set</span>)<span class="hljs-keyword">var</span> coordinator: <span class="hljs-type">MainCoordinator!</span><font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-keyword">var</span> navController: <span class="hljs-type">UINavigationController</span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.coordinator.navigationController<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">var</span> <span class="hljs-title">service</span>: <span class="hljs-title">CoordinatorService</span> </span>{
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> service: <span class="hljs-type">CoordinatorService</span> = <span class="hljs-type">ServiceLocator</span>.service() {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> service = <span class="hljs-type">CoordinatorService</span>()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; service.load()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.addService(service)
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">return</span> service<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {<font></font>
&nbsp; &nbsp; }<font></font>
<font></font>
&nbsp; &nbsp; <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">ServiceLocator</span>.removeService(<span class="hljs-keyword">self</span>)<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp;&nbsp; &nbsp;<font></font>
&nbsp; &nbsp; <span class="hljs-comment">// MARK - Private</span>
&nbsp; &nbsp; <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">load</span><span class="hljs-params">()</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> nc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = <span class="hljs-type">UINavigationController</span>()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; nc.navigationBar.isHidden = <span class="hljs-literal">true</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.coordinator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = <span class="hljs-type">MainCoordinator</span>(navigationController:nc)<font></font>
&nbsp; &nbsp; }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, vous pouvez voir qu'au moment où le service est placé dans le localisateur, la pile de navigation est créée et transmise à l'instance de classe coordinatrice. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous utilisez iOS 13 (apparemment ci-dessus), assurez-vous de modifier la classe SceneDelegate. </font><font style="vertical-align: inherit;">Il est nécessaire d'assurer l'exécution de ce code:</font></font><br>
<br>
<pre><code class="swift hljs">&nbsp;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">scene</span><span class="hljs-params">(<span class="hljs-number">_</span> scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions)</span></span> {
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> scene = (scene <span class="hljs-keyword">as</span>? <span class="hljs-type">UIWindowScene</span>) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">let</span> window = <span class="hljs-type">UIWindow</span>(windowScene: scene)<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; window.rootViewController = <span class="hljs-type">CoordinatorService</span>.service.navController
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-keyword">self</span>.window = window
&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-type">CoordinatorService</span>.service.coordinator.start()<font></font>
&nbsp; &nbsp; &nbsp; &nbsp; window.makeKeyAndVisible()<font></font>
&nbsp; &nbsp; }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous extrayons la pile de navigation par défaut et l'associons à la fenêtre principale de l'application, puis ouvrons la fenêtre de démarrage de l'application avec le contrôleur StartViewController. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code source du scénario de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test est disponible sur GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498178/index.html">Nous travaillons à domicile: diffusion de photos</a></li>
<li><a href="../fr498180/index.html">Revérifier Newton Game Dynamics avec l'analyseur statique PVS-Studio</a></li>
<li><a href="../fr498186/index.html">Services basés sur des réseaux de neurones pour les concepteurs</a></li>
<li><a href="../fr498188/index.html">Théories des probabilités: préparer une entrevue et résoudre les «paradoxes»</a></li>
<li><a href="../fr498192/index.html">Sac cosmétique stéroïde: XD Design Urban Bumbag Review</a></li>
<li><a href="../fr498200/index.html">Plateforme de données pour le reporting réglementaire</a></li>
<li><a href="../fr498202/index.html">Landing Digest. Spécialiste de la sécurité de l'information</a></li>
<li><a href="../fr498206/index.html">Créer un backend graphql sur Golang</a></li>
<li><a href="../fr498208/index.html">Semaine de la sécurité 17: Implications de l'attaque du serveur Linux</a></li>
<li><a href="../fr498214/index.html">Maria Popova: «Certains ont découvert OpenStreetMap pour la première fois car ils ont marqué la berce du Caucase sur la carte»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>