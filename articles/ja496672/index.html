<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈴 🕣 🕺🏻 IDA FREEおよびその他の無料ツールを使用した活用と逆転の紹介。第2章 👩🏻‍🎨 👩🏿 🧓🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最初の部分では、このコースを受講するのに役立ついくつかのツールをインストールしました。彼らの特徴は、それらがすべて無料であることです。有料ツールは使用せず、IDAやPYCHARMなどの有料バージョンがあるツールでは、無料またはコミュニティバージョンを使用します。
 
 演習を始める前に、いくつかの概...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IDA FREEおよびその他の無料ツールを使用した活用と逆転の紹介。第2章</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496672/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の部分では、このコースを受講するのに役立ついくつかのツールをインストールしました。</font><font style="vertical-align: inherit;">彼らの特徴は、それらがすべて無料であることです。</font><font style="vertical-align: inherit;">有料ツールは使用せず、IDAやPYCHARMなどの有料バージョンがあるツールでは、無料またはコミュニティバージョンを使用します。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
演習を始める前に、いくつかの概念を見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バッグとは何ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BAGは、コンピュータープログラム（ソフトウェア）またはコンピューターを作成するプロセスの失敗または欠如の結果です。特定の障害は、ソフトウェアのライフサイクルのどの段階でも発生する可能性がありますが、最も明らかな障害は、開発およびプログラミングの段階で発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつも言っているように、プログラマーは間違いを犯す可能性があり、これらのエラーはプログラムのクラッシュやバグを引き起こす可能性があります。これまでのところ、私は何も新しいことを言っていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は、BAGと脆弱性の違いを知ることです。脆弱性とは何かを見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
脆弱性とは何ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
脆弱性は、プログラムを使用してコンピューターシステムのセキュリティを侵害することを可能にする特定の種類のバグです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、脆弱性により、プログラムが意図していないアクションを実行し、それらを悪用することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
言い換えれば、脆弱性は特定の種類のバグであり、それらの間のサブセットです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/xv/dz/vexvdzddt1ik8nomu0jbz2yxjyi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、脆弱性にはさまざまな種類があります。</font><font style="vertical-align: inherit;">WINDOWSの脆弱性の調査と悪用に焦点を当てます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エクスプロイトとは何ですか？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPLOITは、別のプログラムの脆弱性を悪用しようとするコンピュータープログラムです。エクスプロイトの最終的な目的は、たとえば、攻撃されたシステムを破壊またはシャットダウンするなどの悪意のあるものになる可能性がありますが、通常、不正な方法で情報にアクセスし、自分の利益のために、または第三者への他の攻撃のソースとして使用するためのセキュリティ対策の違反です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
脆弱性の悪用は、アプリケーションまたはシステム自体の障害、ローカルまたはリモートマシンでのネイティブコードの実行につながる可能性があります。その操作と複雑さは、脆弱性自体、環境、および操作中に目標が持つ対策に依存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
調査する最初の種類の脆弱性は、バッファオーバーフローです。</font><font style="vertical-align: inherit;">最も単純な例から始めて、徐々に複雑さを増やしていきます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、システムのセキュリティ機能はアクティブ化されませんが、それらを徐々にアクティブ化して、それらをどのように処理できるか、どのような状況で対処するかを調べます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファとは？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BUFFERは、データの保存と管理のために予約された特定のサイズのメモリ空間です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本的な例は、コンテンツを保存するために持っている20リットルの瓶です。</font><font style="vertical-align: inherit;">最大サイズである20リットル以下にすることができます。</font><font style="vertical-align: inherit;">1つのタンクにさらに多くを保存する場合は、バッファーのサイズを増やす方法を見つける必要があります。それ以外の場合、たとえば、20リットルの缶に40リットルを保存しようとすると、オーバーフローします。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファオーバーフィルとは何ですか？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BUFFER OVERFLOWは、コンピュータープログラムが連続するメモリブロックにデータを書き込むことによって予約されたメモリ量を超えると発生します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.welivesecurity.com/la-es/tag/buffer-overflow-la-es</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
実際、データ量の測定など、プログラムコードに必要なセキュリティチェックがない場合、アプリケーションでバッファオーバーフローが発生します。これはバッファにコピーされ、バッファサイズを超えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バッファオーバーフローの最も一般的なタイプは、スタックバッファオーバーフローとヒープバッファオーバーフローです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここにバッファオーバーフローの定義が表示されます。前の例では、20リットルのタンクに40リットルを注ぐと、理解できるようにオーバーフローします。</font><font style="vertical-align: inherit;">これは、バッファオーバーフローを引き起こすオーバーフローです。</font><font style="vertical-align: inherit;">最大容量を超えると、タンクがオーバーフローします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、スタックとヒープの違いについて説明します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタックとは何ですか？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STACKは、関数が実行されている間だけ必要なローカル関数変数を格納するために使用されます。</font><font style="vertical-align: inherit;">ほとんどのプログラミング言語では、変数をスタックに保持したい場合は、コンパイル時に変数の大きさを知ることが重要です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOTとは何ですか？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヒープは、動的メモリを予約するために使用されます。その有効寿命は事前にわかっていませんが、しばらく続くことが予想されます。サイズがわからない場合や実行時に決定される場合は、サイズを計算してヒープに予約する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヒープは、サイズが異なるオブジェクトにも使用されます。これは、コンパイル時に使用される期間がわからないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はエクスプロイトの作成者として13年以上会社で働いています。私が入社したときに私が雇ったすべての人に対して私たちが最初に行ったことは、有名なジェラルドリチャートのスタックとヒープを解明することでした。彼はCORE SECURITYの創設者の1人であり、エクスプロイト分析の第一人者です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なスタックからゆっくり始めます。もちろん、私が言ったように、それらは現時点では最小限の保護でコンパイルされ、操作を容易にするために32ビットです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STACK1タスクのソースコードを見てみましょう。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://drive.google.com/open?id=16btJAetpa1V5yHDZE2bnnFWTQNpsUR4H</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
エクササイズを含むフォルダーがあり、中にはSTACK1_VS_2017.CPPと呼ばれるソースコードSTACK1があります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#define _CRT_SECURE_NO_WARNINGS</span>
<span class="hljs-comment">#define _CRT_SECURE_NO_DEPRECATE</span><font></font>
<font></font>
<span class="hljs-comment">#include &lt;stdlib.h&gt;</span>
<span class="hljs-comment">#include  &lt;stdio.h&gt; </span>
<span class="hljs-comment">#include "Windows.h"</span><font></font>
<font></font>
<font></font>
int main(int argc, char **argv) <font></font>
{<font></font>
<font></font>
<font></font>
	MessageBoxA((HWND)<span class="hljs-number">-0</span>, (LPCSTR) <span class="hljs-string">"Imprimir You win..\n"</span>, (LPCSTR)<span class="hljs-string">"Vamosss"</span>, (UINT)<span class="hljs-number">0</span>);<font></font>
<font></font>
	int cookie;<font></font>
	char buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	printf(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) printf(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを理解して、バッファオーバーフローが発生する可能性がある場所と、それがスタックまたはヒープのどちらでバッファオーバーフローになるかを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MessageBoxA関数呼び出しがSTACK1ソースコードに追加され、解決を促す小さなメッセージが表示されます。これは、何も影響を与えない単なる追加です。これは指定されたWINDOWS関数への標準の呼び出しであり、ここでは分析しません。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この関数に関する情報が必要な人は、こちらから入手できます。</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数内にローカル変数がある場合は、それらの場所を予約する必要があることがわかっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、GERARDO RICHARTによって作成されたこのソースコードが残ります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカル変数用にスペースを予約するプログラムの最初の部分が赤で表示されます。この場合、2つのローカル変数COOKIEとBUFがあります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の表でデータ型を確認できます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。他のタイプの変数もそこにあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは32ビットにコンパイルされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COOKIE変数のタイプはINTであるため、この変数用に4バイトのメモリが予約されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1x/xh/qr/1xxhqrcrft6amjldaqun6yvffro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BUF変数の場合は、配列または文字列（文字サイズ= 1バイト）であることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/0f/py/5j0fpyugggmbrkvzktqjibwstuk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それら。つまり、80文字の配列になります。その長さは80x1 = 80バイトになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列について何がわかるか分からない人は、こちらから：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//www.programiz.com/c-programming/c-arrays</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、配列は同じデータ型の多くの値を格納できます。</font><font style="vertical-align: inherit;">あなたは彼に、どんな種類のデータがあり、どれだけあるかを伝えなければなりません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e8/do/ab/e8doabufhyuyqjdwz95qlikvcim.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の例では、これは整数の配列です。</font><font style="vertical-align: inherit;">それは100バイトであり、各整数は4バイトを取るため、配列の長さは100 x 4 = 400バイトになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の例では、FLOATは4バイトを取るため、5 FLOATの配列になるため、その長さは5 x 4 = 20バイトになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
低レベルで配列を分析すると、それが予約済みのメモリ空間またはバッファであることがわかります。</font><font style="vertical-align: inherit;">これは、メモリ領域を予約する唯一の方法ではありません。</font><font style="vertical-align: inherit;">内容を保存するためのバッファとなる、メモリ内の予約スペースも必要とする他のタイプの変数データが​​あります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
演習に戻ります。 </font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、80 x 1 = 80バイト長の文字の配列です。 20リットル瓶のように見えます。 80バイトを超えて保存しようとすると、バンクがオーバーフローします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、BUFバッファーが使用される場所を確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/ac/nt/kpacnt_0dfwci5pzs4ubozc4tou.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
赤い矢印でマークされた2つの場所でバッファが使用されていることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の命令にはPRINTF関数があり、コンソールにメッセージを表示するために使用されます。これは引用符付きの文字列になります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string">"buf: %08x cookie: %08x\n"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、PRINTF関数は、文字列を引用符で囲んで印刷するだけでなく、指定された形式で文字列を印刷します。内部のパーセンテージは、出力行が作成されることを示しています。文字列は関数の最初の引数にすぎないことがわかります。出力形式とその他の引数は複数になる可能性があります（形式の各引数％ごとに1つあります）。私たちの場合は、2つあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hq/j5/ol/hqj5ollvpzgitrc29p3ywimufvm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、2％のX形式があるため、PRINTF形式の表</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vn/bt/b7/vnbtb7zfdmzy19wtmyd6mzxkit4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を参照すると、関数はこれらの整数（INT）を取得し、それらを数値システム16の基数とともに出力行に挿入することがわかり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">16進形式で。 08は、数値に含まれる数字が8桁未満の場合、関数がスペースで埋めることを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「buf：％31x」の出力、およびbufは次のようになります</font></font><br>
<br>
<pre><code class="cpp hljs">buf:             <span class="hljs-number">19F</span>ED4 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、数字の前にスペースが入っていることがわかります。出力を表示するいくつかの修飾子があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考えられるすべてのケースがここにリストされています：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">//www.cplusplus.com/reference/cstdio/printf/</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
私たちのケースはこれです：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/pa/g_/tfpag_nbzmhvrzf1gzsqczecfw4.png"><br>
<br>
<img src="https://habrastorage.org/webt/ja/yq/wo/jayqwocmor7ctp0y1tnykptorle.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は切り捨てられないことがわかります。挿入する引数の長さが値より小さい場合にのみ、スペースで埋められます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font><font style="vertical-align: inherit;">Xの前にあります。</font><font style="vertical-align: inherit;">したがって、この関数は2つの引数から取得される2つの16進数を出力することがわかります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数にはメモリアドレスと格納可能な値があることがわかっています。</font><font style="vertical-align: inherit;">20リットルの瓶のようです。</font><font style="vertical-align: inherit;">内容や意味があります。</font><font style="vertical-align: inherit;">リットルは内部に保管されていますが、同様の缶でいっぱいのガレージを持っている場合も、私が持っているすべての缶の中のどこに缶が欲しいかを判断する方法が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＆記号はこれを示します。</font><font style="vertical-align: inherit;">内容や値ではなく、jarのアドレスまたは場所を返します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンパサンドの定義</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMPERSANDは、データが格納される変数のメモリアドレスを示すために使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、コンソールで実行可能ファイルを実行すると、たとえば、PRINTF関数を実行すると、次</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ry/bs/g6/rybsg6crsldpimnhgfopd2-oddq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
のように表示されます。PCでアドレスが変更される可能性がありますが、両方のアドレスの下位アドレスがBUFアドレスと一致しているため、これらのアドレスは次のように配置されていることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xf/-j/yc/xf-jycqtfpqcdyu_5tfsuv19uae.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BUFアドレスはCOOKIEアドレスよりも小さいため、増加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これらの可変アドレスは私たちに何を伝えますか？ （私の場合、＆BUF = 0x19FED4および＆COOKIE = 0x19FF24）</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6s/xy/8a/6sxy8am2y6d2skgyu7pmsz-wd7i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらも16進形式です。これが％X形式だったことを覚えていますか？そこで、追加なしで表す10進数を区別するために0xを前に付けます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PYTHONコンソールまたはPYCHARMで減算を実行する</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/-u/hw/rd-uhwhszxlontfjic1tl7cqmvo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
と、COOKIE変数はBUFバッファーの終了位置から正確に開始されるため、80バイトの結果が得られます。そのため、差によってバッファーのサイズがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの場合、このタイプの変数をソースコードに基づいて作成すると、コンパイラーがソースコードで予約されているものよりも大きなサイズを提供する場合があります。コンパイラは、少なくとも80バイトを予約することを保証します。彼はより少なく、より多くを予約することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のところ、PRINTF関数を備えているため、コード、変数のサイズ、およびそれらの位置についてはすでにわかっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、BUFバッファーが使用されている別の場所を見てみましょう。これは、プログラムがアドレスを出力するだけで、データの格納には使用されないためです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、赤い線のGETは、キーボードからデータを入力するための関数です。 Enterキーを押すまでデータが入力されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムは、ユーザーが入力したデータの量を制限できません。また、このデータを確認する方法もありません。 ENTERキーを押す前に入力したものはすべて、BUFバッファーにコピーされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが問題です。 BUFは最大80バイトしか保存できないと述べたので、さらに入力すると、バッファーオーバーフローが発生します。ユーザーが80バイトを超える書き込みを行うと、タンクがオーバーフローして液体が滴下するため、これがすべての条件になります。 。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pr/tv/0e/prtv0eh97rud78cpbrvpqmn7vd4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のところ、BUFの下にはCOOKIE変数があるため、オーバーフローによって上書きされ、制御可能な値で埋められます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、80 * Aと4 * Bを書き込むと、80 * AがBUFに入力され、4 * BがCOOKIEに入力される場合、誰かがコンソールで文字を印刷すると、値は低くなります。 ASCII。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/ff/lh/bxfflhk6qfthec5v64o3kr90ey8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cookieには、値0x42に相当する4文字のBが入力されるため、Cookie値が0x42424242であることを保証できます。私のコンピューターでは、Cookieアドレス0x19FF24のコンテンツは0x42424242になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0x19FF24 =&gt; 42424242 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/zl/zb/mnzlzbrka2otg0rszogmqu3xwmo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、COOKIE値をオーバーフローさせて制御する方法についてはすでに見てきました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
演習を完了するには、「勝利」を印刷する必要があります。このため、COOKIEは値0x41424344に等しい必要があり、オーバーフローがなければ、COOKIE値はプログラムの最初から変更されていないため、これは不可能です。 「あなたが勝つ」と出力することはできません。そのために、バッファオーバーフローを使用します。これにより、プログラムがプログラムされたもの以外のアクションを実行する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、「you win」と入力することはできません。オーバーフローのみがこれを実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AAAAAAAA </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、たとえば、80 * Aと4 * Bを渡す代わりに、「あなたが勝つ」と印刷するには、80 * AとDCBAの文字を渡す必要があります。これにより、値がCOOKIEに保存されます。 ASCII。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
44434241</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.arumeinformatica.es/blog/los-formatos-big-endian-y-little-endian/</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
データの保存形式は、LITTLE ENDIANです。つまり、メモリ内のデータは、簡単に言うと逆の順序で格納されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/91/jh/wo/91jhwoo4rj058xjbp9jdp089vw4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーケンス0x41424344が保存されると、システムは次のようにメモリに保存します：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
44 43 42 41 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このため、メモリにコピーすると、入力と同時にコピーが発生するため、メモリから読み取るときに値を逆の順序で書き込む必要があります正しい形でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールで実行可能ファイルを実行できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wn/sn/yo/wnsnyolnlocppvkl573pmu-luva.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、GET関数が入力を要求するようにカーソルを点滅させます。 80文字のAを慎重に入力し、次にDCBAを入力します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PYTHONまたはPYCHARMコンソールで、行を印刷し、引用符なしでコピーしてコンソールに貼り付け、狂ったように印刷されないようにしてから、Enterキーを押して入力します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/9n/bh/um9nbhsmtv_w2cko2d1lwvelqwq.png"><br>
<br>
<img src="https://habrastorage.org/webt/rm/nr/be/rmnrbe4pvbxovetmml_n85dwc4q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「あなたが勝つ」ことがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはデバッガーで確認できます。これにはX64DBGを使用します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/el/2x/db/el2xdbqsgxwi5rh22txd_hqnnx0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
32ビット版を選びました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/ep/e2/lyepe2znpbsedu8edqur13iocau.png"><br>
<br>
<img src="https://habrastorage.org/webt/ux/4u/pt/ux4upt903tftde_hfpteze3irho.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NTDLL.DLLライブラリで停止した場合は、F9でもう一度RUNを押します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STACK1モジュールの最初の命令（ENTRY POINTと呼ばれる）、またはモジュールによって実行される最初の命令でデバッガーが停止することがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/va/y-/qf/vay-qf4tqfkxmlik0892lukku7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、これはソースコードとは異なります。コンパイラは、実行可能ファイルを機能させて正しく実行するために多くのコードを追加することを理解する必要があります。主な機能を探してみます。プログラムの行を見ることで、自分自身を方向付けることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pg/hv/c9/pghvc9kf8f8xjzdpk4yigw5w5vy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在の地域での検索のみを選択しました。行が同じセクションにあることはわかっています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/a3/fj/qc/a3fjqcvl8iqrupyr4oz2trl0viw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、コンパイラーが追加したプログラム行やその他の行があることがわかります。行の1つをダブルクリックします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/fc/b6/uafcb61zxgu6jbg2yraawefum50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、あなたはもっともっと見ることができます。 MessageBoxA、PRINTF、GETS関数の呼び出しと、値0x41424344との比較が表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、SNOWMANを逆コンパイルするためのプラグインを追加しています。コードを逆コンパイルする方法を確認することができます。コンパイルされたファイルからソースコードまたは可能な限り類似したものを取得しようとしている方法。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r0/hs/-w/r0hs-w2cpoquwejdry_pogmxlpu.png"><br>
<br>
<img src="https://habrastorage.org/webt/8h/ib/j_/8hibj_rzmyn_5gwvlg-bqhg4upk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは完璧ではないことがわかりますが、以前よりも優れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数の先頭にBPを置き、デバッガーが停止するまでF9を押します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/wz/em/9jwzemcr76ij1vfdvy9pcdx9gaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数の引数がわからない人のために。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/su/31/rtsu317d7gmqo_u7parcbcxfagg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回の場合、メイン関数には引数がありますが、関数内では使用されません。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは2つの引数があり、実行可能ファイルが32ビットにコンパイルされるときにスタックを介して渡されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数呼び出しの直前に、引数はスタックに格納されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数の最初で停止すると、スタックの最初の値はRETURN ADDRESSになります。つまり、関数が完了した後に関数が戻る場所であり、この値より下はこの関数の引数になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RETURN ADDRESSを右クリックし、[FWLOW DWORD IN DISASSEMBLER]を選択すると、関数の完了後にデバッガーがどこに戻るかがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9o/jb/1s/9ojb1skptq9fvde0hlbque803qs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はここに戻ってきます。これは、main関数が上位の呼び出しから呼び出されたことを意味します。ここにBPを配置し、演習を再開して、それが正しいことを確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/8c/sc/8w8cscopqchym1ubcx2zuazrohq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BPを少し早く入れて、プログラムを再起動します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w8/hc/te/w8hctep2w06vcaqzx_ouz4zguws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバッガーはここで停止します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/mk/3h/hymk3hx1u-myzmmlnygmmeadmww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのPUSH命令を使用して、メイン関数の引数を保存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、関数の引数について詳しく知りたい方のためのリンクです</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。https</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">//publications.gbdirect.co.uk/c_book/chapter10/arguments_to_main.html</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これはそれほど難しくありません。 ARGCの最初の引数はINTで、プログラムの実行に使用されるコンソールパラメータの数（実行可能ファイルへのパスを含む）を示し、ARGVは文字列へのポインタの配列です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドラインを変更すると、さらに引数を渡してリロードすることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_a/1o/jc/_a1ojcg0g9lie1le3ouoyuyrtxo.png"><br>
<br>
<img src="https://habrastorage.org/webt/9f/pb/uy/9fpbuygn9gtz4osszzcffsurz9m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、PUSH命令を使用して引数を保存しようとすると、デバッガーが停止します。保存される最初の引数は最も遠く、保存する最後の引数は関数の最初の引数になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トレースし、各PUSH命令が引数を保存します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1u/yj/rp/1uyjrps22gzfc0re25uhcu-p8a8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、関数の引数を確認できます。上記は、ARGCの最初の引数です。これは、コンソールに渡される引数の数を示すため、3です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vk/il/0i/vkil0istebtffechadwuwyqt2u8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの引数があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、F7キーを押してSTEP INTOを実行し、関数を入力します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、CALLに入ると、デバッガはRETURN ADDRESSをスタックに保存することがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/xc/fw/gpxcfwbg8jr538d3c45oyrqke6e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、関数を入力するときにすでに述べたように、スタックに保存される最初の要素はRETURN ADDRESS（32ビットコンパイルの場合）です。以下は、関数の引数で、最初の引数が最初で、残りが順番に続きます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qk/s4/bi/qks4bikctvy6i3oxg7sy2ipop_o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見てきたように、2番目の引数はポインターの配列です。ここで、引数として渡される3つの行への3つのポインターがあることがメモリでわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c5/f3/kn/c5f3knt9kreq8r5kmfzqgvnv2zw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、関数の最初で停止しました。少し下には、RETURN ADDRESSESとARGUMENTSがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
64ビットバージョンでは引数が異なる方法で渡されるため、ファイルが32ビットでコンパイルされることを明確にします。後で見ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、関数の実行が開始されます。最初のものは、いわゆるPROLOGUEです。これは、呼び出した関数のEBP値を格納します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ka/ss/9k/kass9k6zty8_-nxgxomh2zb6iui.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、EBP値が戻りアドレスのすぐ上に保持されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/da/gi/uodagirflnltomk1uqlo9dawbjo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F7を使用して指示に従う場合。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EBP GUARDADO値が戻りアドレスの上のスタックにあることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/ml/wi/gwmlwilzarr_u67xp_-6dg5-m0w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PROLOGUEの次の命令：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MOV EBP、ESP </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、保存され、私たちの関数を呼び出す親関数であった現在の関数のEBP値を設定します（この場合、私の主な関数はEBPベースの関数で、他の場合は異なる場合があります。後で参照してください）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のESP値をEBPに配置することで、現在の関数のフレームを確実に作成します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bw/d0/8u/bwd08ut1gamkdw-5m9y58cqmdrw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、この関数はEBPまたはEBP BASEDに基づいているため、EBP値は関数内に格納され、参照として受け入れられ、ESPが変更されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/fm/rm/31fmrm3jsa9gz0dwzonyf4lh4wa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このEBP値がベースとして使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EBPベースの関数では、変数と引数に、このアドレスからの距離によって名前を付けることができます。これは、エピローグまでEBP値に格納されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リストで、現在受け入れているEBP値を参照して、EBP-4またはEBP-54と呼ばれるいくつかの変数を確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EBPがPROLOGUEの後に値を取得するとすぐに、それはドレインのように見えるため、引数は常にその方向に向かうため、EBP + XXXは引数を参照します（格納されたEBPおよびRETURN ADDRESSも低いですが、リンクはありません）コードでは）、変数はこのアドレスの上にありますが、EBP-XXXへのリンクはローカル変数を参照しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、EBPベースの関数では、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EBP + XXXX =関数に渡される引数</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EBP-XXXX =ローカル関数変数</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PROLOGUEの後、変数用にスペースを予約する方法がいくつかあります。私たちのケースでは、これはESPを上に移動することによって行われ、その下の残りのスペースはすべての可変長の合計のために予約され、場合によっては、コンパイラーに依存する少しだけ念のために予約されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00401043 | 83EC 54 | SUB ESP、54 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESPはリンクのままであるEBPの上にあり、10進数に変換された0x54は84であり、これはBUFとCOOKIEの長さの合計です。それぞれ80と4だったことを覚えておいてください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/h8/sz/hxh8sz1xa-15otyztxyu8dl6g34.png"><br>
<br>
<img src="https://habrastorage.org/webt/1a/84/bv/1a84bvou8z1bdrr0rkcjyqvqvg8.png"><br>
<br>
<img src="https://habrastorage.org/webt/yv/sh/tv/yvshtvouwajuyoqcvfptuhfa7oa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行時に、サイズが84バイトのBUFおよびCOOKIE変数用のスペースが作成されます。水平方向の最初の列をクリックしてEBP値を確認し、スタックでその値を見つけることができます。明らかに、今は低くなります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w1/eg/vc/w1egvc6xx-pgpprzf6pfvcuicn0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここをダブルクリックします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/1s/i2/gl1si2koeosh8u7seukoagohri4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、スタックにもEBPに関する値があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、EBP-4はリストと一致し、-4はスタックの最初の列に表示され、説明ではEBP-4としても表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pw/_w/2l/pw_w2lyzbza2xlwmthujrqsdado.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トレースすると、変数を予約するためにESPが配置された場所から、変数に割り当てられたスペースを考慮する必要があるため、常に上に移動することがわかります。 MessageBoxAに対して4つのプッシュを実行すると、デバッガーは変数を予約済みスペースの上に配置し、ESPを増やします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ny/sm/cn/nysmcnqbcdrmrl-q4nbtfi85r_8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタックを見ると、予約スペースに赤でマークされた4つの緑の引数が追加されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dg/-t/ty/dg-ttymvnjmjq3u-68oeoixwcgw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MessageBoxA関数を入力すると、この関数のRETURN ADDRESSがスタックに格納されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/gb/kg/acgbkgp58eatqpqgducvgxoqzca.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MessageBoxAの戻りアドレスは次のとおりです。 F8でトレースしてこの関数のRETに到達したら、MessageBoxAを実行します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/nb/qm/vvnbqmlpj06asy7qqwuwipvvzjq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバッガーがMessageBoxA呼び出しのすぐ下に戻ることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/ct/do/fmctdoieugal4uiig_pzcvvwfr8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、MessageBoxA関数に渡したPUSH値とこの関数のRETURN ADDRESSはすでに使用されており、関数が呼び出される前と同様に、ESPは予約済み領域のすぐ上にあります。同じことがPRINTF関数の呼び出しでも起こります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PRINTF関数を渡した後、BUFおよびCOOKIEアドレスが出力されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/tj/8z/qotj8zivsh5xnhiglbkibu53dh4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のマシンのBUFアドレスは0x19FED4になり、COOKIEアドレスは0x19FF24になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、プログラムはBUFアドレスを読み取り、それをGETS関数に渡してBUFに入力します。アドレスが0x19FED4コンソールの表示と一致するかどうかを確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6b/kg/-l/6bkg-lgioczisxsz0s9mlp1omz0.png"><br>
<br>
<img src="https://habrastorage.org/webt/sg/qp/e1/sgqpe1ypgqar2o_5plt8tjlcb0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、EBP-54であることがわかります。 -54が表示されているスタックをダブルクリックすると、アドレスが私のマシンのBUF = 0x19FED4であることが表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d2/ff/wh/d2ffwhnayhtqxh8h1vgknmubaji.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、入力したデータをこのアドレスに保存するときに、それらをダンプに入れて、バイトがどのように格納されているかを確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fu/mz/9h/fumz9hojfwk_mzv4fwhx9rjzfjw.png"><br>
<br>
<img src="https://habrastorage.org/webt/r6/hx/lm/r6hxlmsrelhvlr-tjfdss11mulm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうぞ。また、データがないため、下には何も表示されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F8を使用してGETS関数を呼び出すときは、コンソールに移動し、Enterキーを押してBUFバッファーを埋め、COOKIEを書き直す必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z2/ye/e6/z2yee6bmvi02vjrqpz5-dscio0a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のマシンでは、COOKIE変数は19FF24でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、プログラムはcookieを0x41424344と比較します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/am/p4/ja/amp4ja-l9lkyf8trocairpbj3e0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のようにHORIZONをEBP値に設定した場合、EBP-4はアドレスに加えてCOOKIEであると表示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p4/uo/0u/p4uo0ufah0vdsro_ngyrym3txxm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここをダブルクリックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数が-4のスタックレベルであるため、EBP-4はCOOKIEであり、HORIZONをゼロにしています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x2/gu/kx/x2gukxgn7arw1lk9_w9fj3y3qbu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムはジャンプせず、あなたが勝利したことを示します！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0e/qv/cl/0eqvclf1uxc7dg8hmgp22ka_3sm.png"><br>
<br>
<img src="https://habrastorage.org/webt/5b/fs/mj/5bfsmjqijpcan7zdmidh-pqj6eg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちはあなたが勝つという目標を手動で達成します！.. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバッガであるX64DBGを使用してSTACK1を動的に分析しました。これを行うには、IDA PRO、GHIDRA、RADAREなどの他のツールを使用する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PYTHONからエクササイズを操作するためのスクリプトモデルを作ることができます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> Popen, PIPE<font></font>
<font></font>
payload = <span class="hljs-string">b"A"</span> * <span class="hljs-number">80</span> + <span class="hljs-string">b"\x44\x43\x42\x41"</span><font></font>
<font></font>
p1 = Popen(<span class="hljs-string">r"C:\Users\ricardo\Desktop\abos y stack nuevos\STACK1_VS_2017.exe"</span>, stdin=PIPE)
<span class="hljs-keyword">print</span> (<span class="hljs-string">"PID: %s"</span> % hex(p1.pid))
<span class="hljs-keyword">print</span> (<span class="hljs-string">"Enter para continuar"</span>)<font></font>
p1.communicate(payload)<font></font>
p1.wait()<font></font>
input()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PYTHON 3の場合、PRINT関数に括弧を入れて、バイトにする必要がある行を追加するときは注意する必要があります（PYTHON 2の行の前にbを置きます）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パスが正しいことを確認し、ファイルを実行します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5b/fs/mj/5bfsmjqijpcan7zdmidh-pqj6eg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
良い。 STACK1を操作するためのPYTHON 3のスクリプトモデルが既にあります。次のパートでは、IDA、RADARE、およびGHIDRAの静解析を続けます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xg/65/w_/xg65w_m85xv1anv5a7uhbuvatuc.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STACK1タスクに加えて、バージョン2、3、および4もあることに注意してください。それらを解決することができます。それらは非常にシンプルでSTACK1に似ているので、退屈しないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のパートでは、IDA FREE、RADARE、およびGHIDRAについて説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のパート3でお会いしましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リカルド・ナルバハ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2019/10/25 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS＃1</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
美しいPDFは私のホームページにダウンロードできます-yasha.su </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS＃2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに記事の続きを書き</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ますhttps://habr.com/en/post/464117/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリスカスペルスキー神父の助けを集めた方法と何について起こりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
退屈しないでください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja496652/index.html">プッシャーを使用してLaravelにリアルタイム通知を追加する方法</a></li>
<li><a href="../ja496654/index.html">問題＃35：ITトレーニング-主要企業の現在の問題と課題</a></li>
<li><a href="../ja496664/index.html">さまざまな仕事、黒、白、赤</a></li>
<li><a href="../ja496666/index.html">Mediastreamer2 VoIPエンジンを研究します。パート8</a></li>
<li><a href="../ja496670/index.html">パンデミック後、社会は変わるのでしょうか？</a></li>
<li><a href="../ja496674/index.html">連結財務諸表をどのように生成しますか？</a></li>
<li><a href="../ja496680/index.html">業界4.1：ロボットの所有権、ニューラルネットワーク、オープンソースの収益化</a></li>
<li><a href="../ja496682/index.html">要求に応じてプロを維持する方法</a></li>
<li><a href="../ja496686/index.html">MITER ATT＆CKによるトラフィック分析システムによるハッカーの戦術の検出方法、パート4</a></li>
<li><a href="../ja496690/index.html">コロナウイルス制御技術</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>