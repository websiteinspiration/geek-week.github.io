<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìä üõåüèø üßíüèΩ Una vez m√°s, unos 433 MHz transmisores y receptores üßëüèø‚Äçü§ù‚Äçüßëüèª ü•ä üí∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El conjunto m√°s simple de receptor y transmisor ISM de 433 MHz ha ganado una merecida popularidad entre los amantes de la electr√≥nica. Los kits son ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Una vez m√°s, unos 433 MHz transmisores y receptores</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491530/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El conjunto m√°s simple de receptor y transmisor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><font style="vertical-align: inherit;">433 MHz </font><font style="vertical-align: inherit;">ha </font><font style="vertical-align: inherit;">ganado una merecida popularidad entre los amantes de la electr√≥nica. Los kits son baratos (incluso en Chip-Deep puedes comprarlos por 300 rublos, y en Ali, dicen, generalmente por cincuenta d√≥lares), son simples y confiables. Adem√°s (que probablemente no sospeche), este es el m√©todo de intercambio de datos inal√°mbrico de mayor alcance y penetraci√≥n: una se√±al a una frecuencia de 433 MHz pasa mucho mejor a trav√©s de obst√°culos y opera a una distancia mayor que en la popular banda de 2.4 GHz (433 MHz est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">completamente retrasado por una</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pared de medio metro de concreto, y el Wi-Fi ya est√° muriendo por 10 cent√≠metros). Admito que aparecieron recientemente los m√≥dulos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MBee-868</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al estar equipados con una antena apropiada (direccional), "disparan" a√∫n m√°s, pero son al menos un orden de magnitud m√°s caros, m√°s dif√≠ciles de conectar, requieren gesti√≥n de ahorro de energ√≠a y preconfiguraci√≥n. </font><font style="vertical-align: inherit;">Y adem√°s, la frecuencia de 868 MHz pasa a trav√©s de obst√°culos dos veces m√°s mala (aunque, por supuesto, es incomparablemente mejor que la frecuencia de 2.4 GHz). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a04/2bb/c3c/a042bbc3ca312c739041b507e7ca4b5e.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, se ha escrito mucho sobre transmisores y receptores de 433 MHz (incluso en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concentrador)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sin embargo, parece que nadie sabe c√≥mo incluir correctamente este kit en el circuito por alguna extra√±a raz√≥n. </font><font style="vertical-align: inherit;">Cuando una vez m√°s le√≠ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que el kit " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tom√≥ 8 metros dentro de la l√≠nea de visi√≥n, el noveno metro no pudo ser dominado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", Se me rompi√≥ la paciencia. </font><font style="vertical-align: inherit;">¬øQu√© otros 8 metros? </font><font style="vertical-align: inherit;">En 40-50 habr√≠a cre√≠do, aunque en realidad, probablemente, el rango es a√∫n mayor.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena se√±alar que resuelvo a√∫n m√°s el problema de crear una l√≠nea para transferir datos arbitrarios, y no solo controlar cualquier enchufe inteligente o barco modelo. Mi tarea es m√°s complicada, pero a√∫n as√≠ la distancia de operaci√≥n confiable es mucho mayor. Adem√°s, en tal tarea es importante no solo y no tanto la distancia dentro de la l√≠nea de visi√≥n (puede servir solo como comparaci√≥n), sino la capacidad de penetrar varios obst√°culos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tengo un kit de este tipo que trabaja en el pa√≠s a una distancia de aproximadamente 25-30 metros en un √°ngulo agudo con respecto a la pared de troncos, de modo que aproximadamente un metro (en total) de paredes y particiones, parcialmente protegido por aislamiento de aluminio, est√° en la ruta de la se√±al. A una distancia mucho m√°s corta, casi directamente detr√°s de la pared, WiFi ya est√° perdiendo se√±al por completo. En la ciudad, la se√±al termina desde un extremo de un departamento urbano de tres habitaciones al otro a trav√©s de dos divisiones interiores, as√≠ como desde el balc√≥n, donde en una l√≠nea recta entre el transmisor y el receptor hay al menos 80 cent√≠metros de ladrillo y una divisi√≥n de yeso. No utilic√© ninguna opci√≥n de kit m√°s costosa mencionada en la revisi√≥n anterior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una ventaja adicional del kit es que, en pausas, el transmisor no consume nada y sin modos de suspensi√≥n especiales, simplemente por el principio de su dispositivo (la corriente de consumo en reposo es comparable a las corrientes de fuga del colector de un transistor bloqueado, es decir, aproximadamente 100 nA). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos cu√°les son las trampas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexi√≥n del transmisor</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El transmisor (se llama FS1000A), como vemos en su diagrama a continuaci√≥n, es el generador m√°s simple basado en un resonador SAW de 433 MHz. </font><font style="vertical-align: inherit;">El generador se ensambla en el transistor Q1, y el transistor Q2, en base al cual se suministran los datos digitales, es simplemente una clave que conecta el generador a la alimentaci√≥n (al bus GND) en presencia de un alto nivel (unidad l√≥gica) en la entrada. </font><font style="vertical-align: inherit;">La potencia puede ser de 5 a 12 voltios y, seg√∫n los fabricantes, cuanto mayor sea la potencia, m√°s lejos funcionar√° la conexi√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a21/50c/737/a2150c737eb648ed465e060aa2d178ae.png" width="400"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No he notado las ventajas fundamentales de una mayor nutrici√≥n como parte de mi tarea. Sin embargo, uno no debe descuidar el hecho de que no hay requisitos especiales de energ√≠a aqu√≠, y con un aumento de voltaje, el dispositivo solo funcionar√° mejor. Es conveniente conectar el transmisor directamente al voltaje de un adaptador de 9-12 voltios, una bater√≠a o un conjunto de 6 bater√≠as (pin Vin Arduino). Con una fuente de alimentaci√≥n no estabilizada, que puede superar los 12 voltios (como, por ejemplo, con bater√≠as), generalmente desacople el transmisor del circuito principal con un estabilizador de 9 voltios separado (puede usar el 78L09 m√°s simple), y no veo ninguna diferencia en la operaci√≥n entre los 9 y 12 voltios. Con Uno o Nano, puede usar el estabilizador de 5 voltios incorporado para alimentar el controlador y otros circuitos (por ejemplo, sensores)y para Mini (especialmente sus clones baratos), le recomendar√≠a que coloque un estabilizador de 5 voltios por separado, conect√°ndolo al pin de 5V.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cabe se√±alar que recientemente han aparecido transmisores que parecen algo no est√°ndar (ver. Fig. A continuaci√≥n). Result√≥ que la ausencia de un acelerador L1 (tres vueltas), del que solo quedaban agujeros, una ficci√≥n, simplemente fue reemplazado por el componente SMD correspondiente. Lo peor de esta opci√≥n es diferente: la impresi√≥n descuidada puede ser enga√±osa con respecto a la conexi√≥n de los pines de datos y la alimentaci√≥n. La conexi√≥n correcta se muestra en la figura, es la misma para todas las opciones:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/db4/cfc/e17/db4cfce176c768cc5f3504edfbf91513.png" width="250"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Lo m√°s sorprendente en este asunto es que cuando los datos y la potencia se mezclan, el transmisor contin√∫a trabajando a distancias cortas! </font><font style="vertical-align: inherit;">Si observa el circuito, comprender√° qu√© es: la base Q2 a trav√©s de la resistencia est√° conectada a la fuente de alimentaci√≥n, el transistor siempre est√° abierto y no afecta el funcionamiento del circuito. </font><font style="vertical-align: inherit;">Un nivel l√≥gico alto en el bus de energ√≠a solo alimenta el generador en el momento adecuado. </font><font style="vertical-align: inherit;">Los absurdos comienzan a cierta distancia: est√° claro que, desde una conclusi√≥n l√≥gica, la fuente de energ√≠a es mala.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexi√≥n del receptor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comprar un receptor (puede llamarse MX-RM-5V o XD-RF-5V), preste atenci√≥n a la longitud de los terminales: de alguna manera me encontr√© con un lote completo con pines acortados, lo que provoc√≥ que el </font><font style="vertical-align: inherit;">receptor se caiga </font><font style="vertical-align: inherit;">del conector </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PBS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√°ndar </font><font style="vertical-align: inherit;">con la menor distorsi√≥n y su Tuve que unirme espec√≠ficamente al tablero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El circuito receptor es mucho m√°s complicado (no lo jugar√©, pero puedes encontrarlo, por ejemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Debe recibir y amplificar una se√±al de alta frecuencia, filtrar la frecuencia de 433 MHz, aislar r√°fagas y convertirlas a niveles l√≥gicos. El receptor tiene un acelerador de sintonizaci√≥n (en el centro del tablero), pero sin instrumentos precisos para medir las caracter√≠sticas de amplitud-frecuencia, no recomiendo girarlo; lo m√°s probable es que no mejore nada, solo lo estropear√°.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya a una corta distancia la se√±al ser√° mucho menos interferencia, est√° claro que debemos lidiar con la interferencia en todos los frentes: circuitos y m√©todos de software. Las bibliotecas hacen lo √∫ltimo por nosotros, pero no importa qu√© matem√°ticas se usen en el procesamiento del software, es recomendable hacer todo primero para que la unidad l√≥gica en la salida aparezca solo cuando una se√±al √∫til explote y no aparezca cuando haya interferencia. En otras palabras, ser√≠a bueno desconectarse al m√°ximo de antemano de la interferencia durante la recepci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√©todo est√°ndar de reducci√≥n de ruido, conocido en mi tiempo por cada estudiante que ha ensamblado al menos una radio o amplificador, es que para los nodos que son sensibles a la interferencia, es necesario hacer una fuente de alimentaci√≥n separada, aislada al m√°ximo de otros circuitos. Puede hacerlo de diferentes maneras: una vez que instal√≥ un diodo zener separado, ahora a menudo a√≠slan la potencia de un nodo problem√°tico con un filtro LC (esto se recomienda, por ejemplo, para ADC, consulte las hojas de datos para controladores AVR). Pero en nuestras condiciones, cuando los componentes modernos son peque√±os y baratos, es m√°s f√°cil colocar un estabilizador separado del resto en el receptor.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/bd3/85b/94a/bd385b94af583fa8c188053297965c1b.png" width="400"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un estabilizador, por ejemplo, del tipo LP2950-5.0 m√°s dos condensadores necesarios para √©l en la opci√≥n m√°s barata (cuando ambos condensadores son de cer√°mica, en el rango de 1-3 microfaradios) agregar√° sesenta como m√°ximo al costo de su circuito. Pero prefiero no ahorrar: en la salida puse una cer√°mica ordinaria, y en la entrada un electrolito (10-100 microfaradios), adem√°s, estado s√≥lido (pol√≠mero) o t√°ntalo. Los condensadores de cer√°mica se pueden prescindir tanto de all√≠ como de all√≠, si el voltaje de entrada de 7-12 voltios proviene de bater√≠as de bater√≠a o de otro estabilizador anal√≥gico. Las fuentes estabilizadas pulsadas y los rectificadores no estabilizados m√°s simples requieren un filtrado adicional. Puedes usar electrolitos de aluminio baratos si colocas un 0.1 microfaradio de cer√°mica paralelo a √©l,es incluso mejor poner una inductancia en serie en la entrada de varias fracciones o unidades de miligenri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El estabilizador debe instalarse directamente cerca del receptor, la longitud de los conductores debe ser m√≠nima. En lugar del LP2950, ‚Äã‚Äãpuede tomar el LM2931 o similar con un voltaje de alimentaci√≥n peque√±o (esto es especialmente importante si el circuito funciona con bater√≠as; para un LM78L05 normal, el voltaje de entrada debe ser de al menos 7,5 y preferiblemente de 8 a 9 voltios).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En comparaci√≥n con el caso de alimentar el receptor directamente desde Arduino, como se recomienda en todas las publicaciones (no he visto excepciones), se sorprender√° del efecto obtenido: el alcance y la capacidad de penetrar a trav√©s de las paredes aumentan significativamente de inmediato. El receptor, junto con el estabilizador, se puede llevar a cabo en una caja peque√±a separada para mayor comodidad. Puede conectar su salida al controlador en el cuerpo principal con cualquier cable de tres hilos (dos fuentes de alimentaci√≥n y un conductor de se√±al) de hasta 3 metros de largo, y tal vez m√°s. Esto es m√°s conveniente porque todav√≠a se necesitan antenas, y de acuerdo con las reglas, ser√° mejor si son paralelas entre s√≠ en el espacio, y los casos grandes no siempre se pueden colocar para que las antenas sobresalgan en la orientaci√≥n correcta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la versi√≥n m√°s simple, como antenas, puede hacerlo con trozos de cable de un solo n√∫cleo con una secci√≥n transversal de al menos 0,5 mm y una longitud de 17 cm ¬± 1-3 mm. </font><font style="vertical-align: inherit;">¬°No utilice cables de montaje trenzados! </font><font style="vertical-align: inherit;">Se venden antenas espirales m√°s compactas, pero personalmente no he probado su efectividad. </font><font style="vertical-align: inherit;">La punta de la antena, tanto del transmisor como del receptor, est√° sellada en el orificio correspondiente en la esquina de la placa (no se equivoque en la versi√≥n mejorada del transmisor; la palabra ANT tambi√©n est√° fuera de lugar all√≠, vea la figura anterior).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generaci√≥n y procesamiento de datos transmitidos.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es el segundo inconveniente importante de la mayor√≠a de las revisiones sobre nuestro tema: los autores se limitan a alg√∫n problema local, sin formularlo de manera general, como transferir datos arbitrarios en un paquete. Como entendi√≥ por la descripci√≥n anterior, nuestro conjunto solo puede transmitir una secuencia simple de bits. La biblioteca est√°ndar de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualWire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> los </font><font style="vertical-align: inherit;">codifica de una manera especial (cada t√©trada se codifica con 6 bits, se agrega un encabezado de sincronizaci√≥n al frente y se agrega una suma de verificaci√≥n para todo el paquete) y convierte la salida en una secuencia m√°s familiar de bytes. Pero el programador ya tiene que lidiar con eso por su cuenta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, suponemos que el transmisor y el receptor est√°n conectados al Arduino. Adem√°s de VirtualWire, en relaci√≥n con el auge de las "casas inteligentes", hay muchas otras cosas como RC-Switch o RemoteSwitch, pero est√°n enfocadas en otras tareas, y claramente no vale la pena usarlas para transferir datos arbitrarios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La longitud m√°xima de un solo mensaje en VirtualWire es de 27 bytes (consulte la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). La transmisi√≥n de un mensaje completo (se complementa autom√°ticamente con una firma 0xb38, un valor de longitud del mensaje y una suma de comprobaci√≥n) a la velocidad elegida de 1200 bps es de 0,35 segundos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuanto m√°s, por cierto, la velocidad de transmisi√≥n seleccionada, el rango de transmisi√≥n ser√° menor. Por la experiencia de usar RS-232, se sabe que con un rango creciente, la velocidad de transmisi√≥n permisible disminuye exponencialmente: a una velocidad de 19,200, una l√≠nea sin blindaje corre por 15 metros, a 9600 - 150 metros, y a una velocidad de 1200 - m√°s de un kil√≥metro. Ser√≠a interesante descubrir experimentalmente la naturaleza de esta dependencia para nuestro caso, porque aqu√≠ mucho depende de las matem√°ticas utilizadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La inicializaci√≥n del transmisor en VirtualWire se ve as√≠:</font></font><br>
<br>
<pre><code class="cpp hljs">. . . . .
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;VirtualWire.h&gt;</span></span><font></font>
. . . . .<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  vw_setup(<span class="hljs-number">1200</span>); <span class="hljs-comment">//   VirtualWire</span>
  vw_set_tx_pin(<span class="hljs-number">10</span>);   <span class="hljs-comment">//   VirtualWire D10</span><font></font>
. . . . .<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analizaremos los principios de generaci√≥n de datos utilizando un ejemplo espec√≠fico. Tengamos un sensor remoto de temperatura y humedad. Da valores (variables de temperatura y humedad) en forma de un n√∫mero real con un signo (flotante). Para que sea m√°s f√°cil de entender en el extremo receptor, todos reduciremos a un n√∫mero entero positivo con el n√∫mero de decimales al menos 4, traduciremos los bits individualmente en caracteres ASCII, transferiremos la cadena resultante y realizaremos operaciones inversas en el extremo receptor. Por supuesto, puede simplificar la tarea (por ejemplo, prescindir de la conversi√≥n a ASCII y acortar los n√∫meros), pero de esta forma resulta ser la misma para casi cualquier tipo de datos digitales, lo que simplifica el desmontaje al recibirlos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la pr√°ctica, es conveniente usar el tipo de cadena para redactar un mensaje, algo como esto:</font></font><br>
<br>
<pre><code class="cpp hljs">. . . . .
<span class="hljs-comment">//    </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ledPin 13 <span class="hljs-comment">//  (D13,  19 ATmega) </span></span>
<span class="hljs-keyword">char</span> msg[<span class="hljs-number">13</span>];
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> tmpr=<span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> hum=<span class="hljs-number">0</span>;<font></font>
. . . . .<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
  delay(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 1 c</span>
<span class="hljs-keyword">float</span> temperature;
<span class="hljs-keyword">float</span> humidity;<font></font>
. . . . .  <span class="hljs-comment">//   temperature  humidity  </span>
<span class="hljs-comment">//       4 :</span>
  tmpr = temperature*<span class="hljs-number">10</span>+<span class="hljs-number">2731</span>; <span class="hljs-comment">//2731 =     </span>
<span class="hljs-comment">//    4 :</span>
  hum = humidity*<span class="hljs-number">10</span>+<span class="hljs-number">1000</span>; 
<span class="hljs-comment">//  :</span>
  digitalWrite (ledPin,HIGH); <span class="hljs-comment">//  ‚Äî  </span>
  String strMsg=<span class="hljs-string">"DAH"</span>; <span class="hljs-comment">// - </span>
  strMsg+=tmpr; <span class="hljs-comment">//  </span>
  strMsg+=hum; <span class="hljs-comment">// </span>
  strMsg.toCharArray(msg,<span class="hljs-number">12</span>); <span class="hljs-comment">//   , 12 ‚Äì  </span>
<span class="hljs-comment">//  :</span>
  vw_send((<span class="hljs-keyword">uint8_t</span> *)msg, <span class="hljs-built_in">strlen</span>(msg)); <span class="hljs-comment">//  </span>
  vw_wait_tx(); <span class="hljs-comment">//   </span>
  delay(<span class="hljs-number">500</span>); <span class="hljs-comment">// 500 </span>
  digitalWrite (ledPin, LOW); <span class="hljs-comment">//  ‚Äî  </span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si necesita transferir n√∫meros m√°s precisos con una gran cantidad de d√≠gitos, simplemente aumente la longitud de la matriz de mensajes. Las variables globales "vol√°tiles" tmpr y hum son necesarias si promedia varias lecturas, de lo contrario, tambi√©n pueden declararse locales dentro de la funci√≥n loop (). El mensaje, como puede ver, consiste en valores de temperatura y humedad convertidos, en cadenas ASCII de cuatro bytes cada una, precedidas por una cadena de tres caracteres "DAH" (los caracteres pueden ser cualquier otro de la tabla ASCII). Esta es una firma que le permitir√° distinguir este mensaje de los otros posibles enviados por dispositivos similares. No descuide la firma, incluso si cree que no se esperan otros dispositivos cercanos en este rango, al mismo tiempo sirve como una garant√≠a adicional de la integridad de los datos recibidos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta tambi√©n que al convertir una cadena en una matriz, debe especificar un car√°cter m√°s que la longitud total del mensaje (3 + 4 + 4 = 11), esto tiene en cuenta el car√°cter cero que cierra la cadena. </font><font style="vertical-align: inherit;">Y el tama√±o de la matriz msg [] debe especificarse con un margen y puede ser cualquiera, en este caso de 13 a 27 bytes. </font><font style="vertical-align: inherit;">Al transmitir, a√∫n enviar√° exactamente lo mismo que devolver√° la funci√≥n strlen (msg), es decir, 11 bytes + un car√°cter nulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte receptora, la matriz resultante de c√≥digos ASCII deber√° analizarse. </font><font style="vertical-align: inherit;">Pero primero debes aceptarlo. </font><font style="vertical-align: inherit;">Para inicializar la recepci√≥n, se realizan las siguientes acciones:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;VirtualWire.h&gt;</span></span>
<span class="hljs-keyword">char</span> str[<span class="hljs-number">5</span>];     ASCII  
  <span class="hljs-keyword">uint8_t</span> buf [VW_MAX_MESSAGE_LEN];  <span class="hljs-comment">//    </span>
  <span class="hljs-keyword">uint8_t</span> buflen = VW_MAX_MESSAGE_LEN;  <span class="hljs-comment">// max   </span><font></font>
. . . . .<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  vw_set_rx_pin(<span class="hljs-number">2</span>); <span class="hljs-comment">//D2   VirtualWire</span>
  vw_setup(<span class="hljs-number">1200</span>); <span class="hljs-comment">//   VirtualWire</span><font></font>
. . . . .<font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, la t√©cnica para analizar una l√≠nea es esta:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
  vw_rx_start();  <span class="hljs-comment">//  </span>
  buflen = VW_MAX_MESSAGE_LEN; <span class="hljs-comment">//    </span>
 <span class="hljs-keyword">if</span> (vw_have_message()) { <span class="hljs-comment">// </span>
 <span class="hljs-keyword">if</span> (vw_get_message(buf, &amp;buflen)) <span class="hljs-comment">//   </span><font></font>
  {<font></font>
    vw_rx_stop(); <span class="hljs-comment">//   :</span>
        <span class="hljs-keyword">for</span> (byte i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">3</span>; i++)  <span class="hljs-comment">//    </span>
                str[i]= buf[i]; <span class="hljs-comment">// </span>
                str[<span class="hljs-number">3</span>]=<span class="hljs-string">'\0'</span>;
      <span class="hljs-keyword">if</span> ((str[<span class="hljs-number">0</span>]==<span class="hljs-string">'D'</span>)&amp;&amp;(str[<span class="hljs-number">1</span>]==<span class="hljs-string">'A'</span>)&amp;&amp;(str[<span class="hljs-number">2</span>]==<span class="hljs-string">'H'</span>)) {
<span class="hljs-comment">// ,  </span>
       <span class="hljs-keyword">for</span> (byte i=<span class="hljs-number">3</span>;i&lt;<span class="hljs-number">7</span>;i++)  <span class="hljs-comment">//    </span>
                str[i<span class="hljs-number">-3</span>]= buf[i]; <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">int</span> tmpr=atoi(str); <span class="hljs-comment">//   </span>
      tmpr=tmpr<span class="hljs-number">-2731</span>; <span class="hljs-comment">// 2731,     </span>
. . . . .<span class="hljs-comment">//    10    float,  </span>
. . . . . <span class="hljs-comment">//    -</span>
<span class="hljs-comment">// :</span>
      <span class="hljs-keyword">for</span> (byte i=<span class="hljs-number">7</span>;i&lt;<span class="hljs-number">11</span>;i++)  <span class="hljs-comment">//    </span>
                str[i<span class="hljs-number">-7</span>]= buf[i]; <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">int</span> hh = atoi(str); <span class="hljs-comment">//   </span>
      hh=(hh<span class="hljs-number">-1000</span>)/<span class="hljs-number">10</span>;
      <span class="hljs-keyword">if</span> (hh&gt;<span class="hljs-number">99</span>) hh=<span class="hljs-number">99</span>; <span class="hljs-comment">//   %,  </span>
. . . . . <span class="hljs-comment">// -</span>
   } <span class="hljs-comment">//end   DAT</span>
  } <span class="hljs-comment">//end  </span>
 } <span class="hljs-comment">// </span>
} <span class="hljs-comment">// end loop</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que ahora tenga menos preguntas sobre el uso de estos dispositivos baratos y f√°ciles de usar.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es491518/index.html">Noticias del mundo de OpenStreetMap No. 501 (18/02/2020/24/02/2020)</a></li>
<li><a href="../es491520/index.html">Convierta xls a xlsx y xml en C #</a></li>
<li><a href="../es491522/index.html">¬øPor qu√© las mujeres viven m√°s?</a></li>
<li><a href="../es491524/index.html">Stas Afanasyev. Juno Tuber√≠as basadas en io.Reader / io.Writer. Parte 2</a></li>
<li><a href="../es491528/index.html">Mi experiencia es realizar 1000 entrevistas. Sinopsis del informe de Yegor Bugaenko</a></li>
<li><a href="../es491532/index.html">Laravel + Docker + Gitlab. D√≥nde empezar</a></li>
<li><a href="../es491534/index.html">Una breve gu√≠a para usar GDB</a></li>
<li><a href="../es491536/index.html">YouTube: error. Por favor, int√©ntelo de nuevo m√°s tarde. ID de reproducci√≥n: <...></a></li>
<li><a href="../es491540/index.html">Redes para un especialista en TI novato. Base obligatoria</a></li>
<li><a href="../es491542/index.html">Transformaci√≥n de color: b√∫squedas de tabla de adelgazamiento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>