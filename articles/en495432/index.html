<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóÇÔ∏è üöµüèª ‚ôåÔ∏è Singleton with pitfalls ‚ôÄÔ∏è üåâ üíÜüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction
 

There are a huge number of patterns and antipatterns of programming. Often the use of patterns dictates to us the experience and the a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Singleton with pitfalls</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495432/"><h1 id="vvedenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are a huge number of patterns and antipatterns of programming. </font><font style="vertical-align: inherit;">Often the use of patterns dictates to us the experience and the actual knowledge of themselves. </font><font style="vertical-align: inherit;">In this article I want to discuss with you the application of the </font></font><strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Singleton</font></font></em></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pattern </font><font style="vertical-align: inherit;">, namely its implementation in Net as applied to Unity.</font></font></p><a name="habracut"></a> <br>
<h1 id="singleton"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Singleton</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I note that I am writing code in a team, so I take as much work as possible inside the code in order to unload the team and eliminate the need to think about some of the difficulties of implementing certain patterns in Unity.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Studying the literature on Net </font></font><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in relation to this question </font></font><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,</font></font></a></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and as a result of work on several projects, the following class was born:</font></font></p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> UnityEngine;<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>    .</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;typeparam name="T"&gt;</span>,    <span class="hljs-doctag">&lt;/typeparam&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;remarks&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>        OnDestroy  OnApplicationQuit</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>      IsAlive.     </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> ,        .</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>      Awake, OnDestroy, </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> OnApplicationQuit    </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> base.Awake()  .</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>    Initialization -      </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>  .</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>     unity,    </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>   .    ,    </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>       .</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> </span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>  :</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>     -  "CLR via C#"</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span>     - Chris Dickinson "Unity 2017 Game optimization"</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span><span class="hljs-doctag">&lt;/remarks&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span>&lt;T&gt; : <span class="hljs-title">MonoBehaviour</span> <span class="hljs-keyword">where</span> <span class="hljs-title">T</span> : <span class="hljs-title">Singleton</span>&lt;T&gt;<font></font>
{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> T instance = <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> alive = <span class="hljs-literal">true</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> T Instance<font></font>
    {<font></font>
        <span class="hljs-keyword">get</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (instance != <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">return</span> instance;<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span><font></font>
            {<font></font>
                <span class="hljs-comment">//Find T</span><font></font>
                T[] managers = GameObject.FindObjectsOfType&lt;T&gt;();<font></font>
                <span class="hljs-keyword">if</span> (managers != <span class="hljs-literal">null</span>)<font></font>
                {<font></font>
                    <span class="hljs-keyword">if</span> (managers.Length == <span class="hljs-number">1</span>)<font></font>
                    {<font></font>
                        instance = managers[<span class="hljs-number">0</span>];<font></font>
                        DontDestroyOnLoad(instance);<font></font>
                        <span class="hljs-keyword">return</span> instance;<font></font>
                    }<font></font>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        <span class="hljs-keyword">if</span> (managers.Length &gt; <span class="hljs-number">1</span>)<font></font>
                        {<font></font>
                            Debug.LogError(<span class="hljs-string">$"Have more that one <span class="hljs-subst">{<span class="hljs-keyword">typeof</span>(T).Name}</span> in scene. "</span> +
                                            <span class="hljs-string">"But this is Singleton! Check project."</span>);
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; managers.Length; ++i)<font></font>
                            {<font></font>
                                T manager = managers[i];<font></font>
                                Destroy(manager.gameObject);<font></font>
                            }<font></font>
                        }<font></font>
                    }<font></font>
                }<font></font>
                <span class="hljs-comment">//create </span>
                GameObject go = <span class="hljs-keyword">new</span> GameObject(<span class="hljs-keyword">typeof</span>(T).Name, <span class="hljs-keyword">typeof</span>(T));<font></font>
                instance = go.GetComponent&lt;T&gt;();<font></font>
        instance.Initialization();<font></font>
                DontDestroyOnLoad(instance.gameObject);<font></font>
                <span class="hljs-keyword">return</span> instance;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">//Can be initialized externally</span>
        <span class="hljs-keyword">set</span><font></font>
        {<font></font>
            instance = <span class="hljs-keyword">value</span> <span class="hljs-keyword">as</span> T;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> Check flag if need work from OnDestroy or OnApplicationExit</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> IsAlive<font></font>
    {<font></font>
        <span class="hljs-keyword">get</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">return</span> instance.alive;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            DontDestroyOnLoad(gameObject);<font></font>
            instance = <span class="hljs-keyword">this</span> <span class="hljs-keyword">as</span> T;<font></font>
            Initialization();<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span><font></font>
        {<font></font>
            Debug.LogError(<span class="hljs-string">$"Have more that one <span class="hljs-subst">{<span class="hljs-keyword">typeof</span>(T).Name}</span> in scene. "</span> +
                            <span class="hljs-string">"But this is Singleton! Check project."</span>);<font></font>
            DestroyImmediate(<span class="hljs-keyword">this</span>);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnDestroy</span>(<span class="hljs-params"></span>)</span> { alive = <span class="hljs-literal">false</span>; }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnApplicationQuit</span>(<span class="hljs-params"></span>)</span> { alive = <span class="hljs-literal">false</span>; }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialization</span>(<span class="hljs-params"></span>)</span> { }<font></font>
}<font></font>
</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will focus on several aspects.</font></font></p><br>
<h2 id="sozdanie-obekta"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object Creation</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When expanding a project, and even more so working as a team&gt; 3 people, a situation often arises when the sequence of creating objects becomes unclear. </font><font style="vertical-align: inherit;">Strictly speaking </font></font><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the sequence of calls to </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awake () is</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> random (of course, this is not entirely true, and the process can be influenced, but the documentation is holy), which is why it is necessary to eliminate this annoying drawback by implementing the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instance {get;}</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> property </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As a result, we get full access to the singleton from </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awake () of</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> other classes.</font></font></p><br>
<p>     ,      <strong>Lazy,        <strong>Awake()</strong>   .</strong><br>
</p><p>     4-<sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">4</a></sup>,      ,       <strong>Instance{get;}</strong>.</p><br>
<h2 id="inicializaciya-obekta"> </h2><br>
<p>   Unity ‚Äî    <strong>Awake()</strong>. ,     ,     <strong>Initialization()</strong>.               (<em>KISS</em>).</p><br>
<h2 id="vneshnyaya-inicializaciya"> </h2><br>
<p>   ,       <em>DI</em>  <em>SD</em>.          .     .</p><br>
<h2 id="unichtozhenie-obekta"> </h2><br>
<p> ,    ,       <strong>OnDestroy()</strong>, <strong>OnApplicationQuit()</strong>       <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">5</a></sup>:</p><br>
<blockquote>Did you spawn new GameObjects from OnDestroy?</blockquote><p> ,   ,     ,    .   ,       <strong>IsAlive()</strong>,   ,    .   ,   ...</p><br>
<h1 id="zaklyuchenie"></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Increasingly, I come to the conclusion that using the Unity paradigm it is possible to implement my projects without Singleton. </font><font style="vertical-align: inherit;">Often, applying this pattern makes your code highly-connected and extremely fragile.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thank.</font></font></p><br>
<h1 id="istochniki"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Richter J. "CLR via C #. Programming on Microsoft.NET # Framework 4.5 in C #", 2013</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.codingame.com/playgrounds/1979/different-ways-to-implement-singleton-in--net-and-make-people-hate-you-along-the-way</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.unity3d.com/en/current/ScriptReference/MonoBehaviour.Awake.html</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://ru.wikipedia.org/wiki/Design_Patterns</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dickinson Chris "Unity 2017 Game Optimization, Second Edition", 2017</font></font></p><cut text=""></cut></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495414/index.html">Consequences of fear</a></li>
<li><a href="../en495416/index.html">pipeplot - interactive visualization of the data stream from pipe in the console</a></li>
<li><a href="../en495418/index.html">Blazor Client Side Online Store: Part 4 - Add Items to Cart</a></li>
<li><a href="../en495420/index.html">Sort by n-pyramid</a></li>
<li><a href="../en495422/index.html">Profession: Mobile Developer</a></li>
<li><a href="../en495434/index.html">What happened to transport over the past two weeks</a></li>
<li><a href="../en495436/index.html">We open access to the practical course on working with the DLP system</a></li>
<li><a href="../en495438/index.html">R language for Excel users (free video course)</a></li>
<li><a href="../en495440/index.html">The servers in the Netherlands are almost over: new orders may not be possible to fulfill, will the VPS and the Internet end?</a></li>
<li><a href="../en495444/index.html">Arrays in C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>