<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¾â€ğŸ­ ğŸ¦ ğŸ¥¥ ä½¿ç”¨RealSense D435æµ‹é‡åˆ°ç‰©ä½“çš„è·ç¦» ğŸ‘¨â€ğŸ« ğŸ¤·ğŸ¼ ğŸ¤¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¦‚ä»Šï¼Œæ£€æµ‹å›¾åƒä¸­çš„å¯¹è±¡çš„ä»»åŠ¡æ˜¯æœºå™¨è§†è§‰é¢†åŸŸçš„é¢†å…ˆè€…ä¹‹ä¸€ã€‚å®ƒçš„æœ¬è´¨ä¸ä»…æ˜¯å¯¹å›¾ç‰‡ä¸­çš„å¯¹è±¡è¿›è¡Œåˆ†ç±»ï¼Œè€Œä¸”è¿˜æŒ‡ç¤ºå…¶ç¡®åˆ‡ä½ç½®ã€‚
 
 å¯¹è±¡æ£€æµ‹çš„ç»“æœå¯ä»¥è¡¥å……æœ‰å…³æ­¤å¯¹è±¡ä½äºå¤šè¿œçš„ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨Intel RealSense D435æ·±åº¦æ‘„åƒå¤´è§£å†³è·ç¦»æµ‹é‡é—®é¢˜ï¼Œè¯¥æ‘„åƒå¤´å¯ä»¥æµ‹é‡æ¯ä¸ªç‚¹çš„æ·±åº¦ã€‚
 
 åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨RealSense D435æµ‹é‡åˆ°ç‰©ä½“çš„è·ç¦»</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487508/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä»Šï¼Œæ£€æµ‹å›¾åƒä¸­çš„å¯¹è±¡çš„ä»»åŠ¡æ˜¯æœºå™¨è§†è§‰é¢†åŸŸçš„é¢†å…ˆè€…ä¹‹ä¸€ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„æœ¬è´¨ä¸ä»…æ˜¯å¯¹å›¾ç‰‡ä¸­çš„å¯¹è±¡è¿›è¡Œåˆ†ç±»ï¼Œè€Œä¸”è¿˜æŒ‡ç¤ºå…¶ç¡®åˆ‡ä½ç½®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹è±¡æ£€æµ‹çš„ç»“æœå¯ä»¥è¡¥å……æœ‰å…³æ­¤å¯¹è±¡ä½äºå¤šè¿œçš„ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel RealSense D435æ·±åº¦æ‘„åƒå¤´</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£å†³è·ç¦»æµ‹é‡é—®é¢˜</font><font style="vertical-align: inherit;">ï¼Œè¯¥</font><i><font style="vertical-align: inherit;">æ‘„åƒå¤´</font></i><font style="vertical-align: inherit;">å¯ä»¥æµ‹é‡æ¯ä¸ªç‚¹çš„æ·±åº¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è§£å†³ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCVåº“</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’ŒRealSenseæŠ€æœ¯</font><font style="vertical-align: inherit;">å®æ—¶æµ‹é‡åˆ°å¯¹è±¡çš„è·ç¦»çš„é—®é¢˜</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w0/82/ry/w082ryb3uo34yl4ps6ll0viqk7u.png" alt="å›¾ç‰‡"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ±‚</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®æ„Ÿæ‘„åƒå¤´</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è¦æµ‹é‡è·ç¦»ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®æ„ŸD435æ·±åº¦æ‘„åƒå¤´</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯¹äºæ­¤ç¤ºä¾‹ï¼Œ</font><font style="vertical-align: inherit;">æ— éœ€</font><font style="vertical-align: inherit;">å®‰è£…</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RealSense SDK</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pyrealsense2åº“</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ‰€æœ‰ä»£ç ï¼Œä¸ºäº†ä¾¿äºæ¼”ç¤ºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python 3.7</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–å†™</font><font style="vertical-align: inherit;">ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyrealsense2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">pip install pyrealsense2</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCVåº“</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCVåº“</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆä»3.4å¼€å§‹çš„ä»»ä½•ç‰ˆæœ¬éƒ½æ˜¯åˆé€‚çš„ï¼‰ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®˜æ–¹ç½‘ç«™ä¸ŠæŸ¥çœ‹åº“å®‰è£…æ‰‹å†Œ</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€èµ·ï¼Œ</font><font style="vertical-align: inherit;">å°†å®‰è£…å¦ä¸€ä¸ªå¿…è¦çš„åº“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-numpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©ä½“æ£€æµ‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©è§†é¢‘ä¸­çš„å¯¹è±¡ã€‚ä¸ºäº†å®æ—¶æ£€æµ‹ç‰©ä½“ï¼Œæ‰€è°“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ä¸€çº§</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å‹ï¼ˆä¾‹å¦‚</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retina Netï¼ŒSSDå’ŒYOLO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰åœ¨æ“ä½œé€Ÿåº¦ä¸Šå¾ˆèƒœä¸€</font><i><font style="vertical-align: inherit;">ç­¹</font></i><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ç®€åŒ–å®éªŒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç»è¿‡è®­ç»ƒçš„æ¨¡å‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSDLite Mobilenet v2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ç›¸åï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–ä»¥ä¸€ç§æˆ–å¦ä¸€ç§å½¢å¼è¿”å›å¯¹è±¡åæ ‡çš„æ¨¡å‹ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥åœ¨å®˜æ–¹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TensorFlowä¿¡æ¯åº“ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹è½½åŒ…å«æ¨¡å‹æ–‡ä»¶çš„å­˜æ¡£</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½’æ¡£æ–‡ä»¶åŒ…å«äºŒè¿›åˆ¶</font><i><font style="vertical-align: inherit;">.pb</font></i><font style="vertical-align: inherit;">æ ¼å¼çš„å†»ç»“è®¡ç®—å›¾</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä»¥åŠå„ç§é…ç½®ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯è¦åœ¨OpenCVä¸­ä½¿ç”¨è¯¥æ¨¡å‹ï¼Œæ‚¨è¿˜å¿…é¡»å…·æœ‰</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.pbtxt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡æœ¬æ ¼å¼çš„è®¡ç®—å›¾</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒä¸åœ¨å­˜æ¡£ä¸­ï¼Œå› æ­¤å¿…é¡»æ‰‹åŠ¨ç”Ÿæˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚¨å­˜åº“å¤åˆ¶ä¸¤ä¸ªè„šæœ¬</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/opencv/opencv/blob/master/samples/dnn/tf_text_graph_ssd.py</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/opencv/opencv/blob/master/samples/dnn/tf_text_graph_common.py</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŒ‡å®šå¿…è¦çš„è·¯å¾„ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">python tf_text_graph_ssd.py --input /path/to/model.pb --config /path/to/example.config --output /path/to/graph.pbtxt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¾“å‡ºæ˜¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">graph.pbtxt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ç°æœ‰çš„æ¨¡å‹æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­ã€‚</font><font style="vertical-align: inherit;">å°±æˆ‘è€Œè¨€ï¼Œè¿™æ˜¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">models /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶å¤¹</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘å±•å†ç¨‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ä¸€åˆ‡éƒ½å‡†å¤‡å¥½è¿›è¡Œå¼€å‘äº†ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å¼€å§‹ç¼–å†™ä»£ç ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å¯¼å…¥å¿…è¦çš„åº“ï¼Œå¹¶åœ¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">draw_predictionsï¼ˆï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•ä¸Šåˆ›å»ºä¸€ä¸ªå­˜æ ¹</font><font style="vertical-align: inherit;">ï¼Œç¨åå°†éœ€è¦å®ƒï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pyrealsense2 <span class="hljs-keyword">as</span> rs
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> cv2 <span class="hljs-keyword">as</span> cv<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">draw_predictions</span>(<span class="hljs-params">pred_img, color_img, depth_image</span>):</span>
    <span class="hljs-keyword">pass</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸»è¦å¯¹è±¡ï¼š</font></font><br>
<br>
<pre><code class="python hljs">pipeline = rs.pipeline() <span class="hljs-comment"># &lt;-  pipeline      </span>
config = rs.config() <span class="hljs-comment"># &lt;-      </span>
colorizer = rs.colorizer() <span class="hljs-comment"># &lt;-      </span><font></font>
<font></font>
spatial = rs.spatial_filter()<font></font>
spatial.set_option(rs.option.holes_fill, <span class="hljs-number">3</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬åˆå§‹åŒ–</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å‹ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸Šé¢ç”Ÿæˆ</font><font style="vertical-align: inherit;">çš„</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.pbtxt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶å¯¹æˆ‘ä»¬</font><font style="vertical-align: inherit;">æœ‰ç”¨</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  </span><font></font>
model = cv.dnn.readNetFromTensorflow(<font></font>
    <span class="hljs-string">"models/ssdlite_mobilenet_v2_coco_2018_05_09/frozen_inference_graph.pb"</span>, 
    <span class="hljs-string">"models/ssdlite_mobilenet_v2_coco_2018_05_09/graph.pbtxt"</span><font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å¼€å§‹æ‘„åƒå¤´æµï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  2 : RGB  depth</span>
config.enable_stream(rs.stream.color, <span class="hljs-number">640</span>, <span class="hljs-number">480</span>, rs.format.bgr8, <span class="hljs-number">30</span>)<font></font>
config.enable_stream(rs.stream.depth, <span class="hljs-number">640</span>, <span class="hljs-number">480</span>, rs.format.z16, <span class="hljs-number">30</span>)<font></font>
profile = pipeline.start(config)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä»¥</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BGR</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¼å¼æ•è·é¢œè‰²æµ</font><font style="vertical-align: inherit;">ï¼Œå› ä¸º</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹</font><font style="vertical-align: inherit;">è¿™æ˜¯ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„æ ¼å¼</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å¼€å§‹ä¸€ä¸ªå‘¨æœŸï¼Œåœ¨è¯¥å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬å°†ä¾æ¬¡æ•è·å’Œå¤„ç†å¸§ï¼š</font></font><br>
<br>
<pre><code class="python hljs">cv.namedWindow(<span class="hljs-string">"RealSense object detection"</span>, cv.WINDOW_AUTOSIZE)
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment">#     ""  ""</span><font></font>
        frames = pipeline.wait_for_frames()<font></font>
        depth_frame = frames.get_depth_frame()<font></font>
        color_frame = frames.get_color_frame()<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> depth_frame <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> color_frame:
            <span class="hljs-keyword">continue</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è¿›ä¸€æ­¥å¤„ç†å¸§ï¼Œæˆ‘ä»¬ä»¥</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°ç»„</font><font style="vertical-align: inherit;">çš„å½¢å¼è¡¨ç¤ºå®ƒä»¬</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="python hljs">        <span class="hljs-comment">#    numpy-</span><font></font>
        depth_image = np.asanyarray(depth_frame.get_data())<font></font>
        color_image = np.asanyarray(color_frame.get_data())<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å‹æ¥æ£€æµ‹ï¼š</font></font><br>
<br>
<pre><code class="python hljs">        <span class="hljs-comment">#  </span>
        model.setInput(cv.dnn.blobFromImage(color_image, size=(<span class="hljs-number">300</span>, <span class="hljs-number">300</span>), swapRB=<span class="hljs-literal">True</span>, crop=<span class="hljs-literal">False</span>))<font></font>
        pred = model.forward()<font></font>
        draw_predictions(pred, color_image, depth_image)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬åœ¨çª—å£ä¸­ç»˜åˆ¶ç»“æœï¼š</font></font><br>
<br>
<pre><code class="python hljs">	<span class="hljs-comment">#     </span>
        colorized_depth = cv.applyColorMap(cv.convertScaleAbs(depth_image, alpha=<span class="hljs-number">0.03</span>), cv.COLORMAP_JET)
        <span class="hljs-comment">#    </span><font></font>
        images = np.hstack((color_image, colorized_depth))<font></font>
        cv.imshow(<span class="hljs-string">"RealSense object detection"</span>, images)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç¼–å†™é€€å‡ºå¾ªç¯çš„æ¡ä»¶ï¼š</font></font><br>
<br>
<pre><code class="python hljs">	<span class="hljs-comment">#    'ESC'  'q'</span>
        key = cv.waitKey(<span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFF</span>
        <span class="hljs-keyword">if</span> (key == <span class="hljs-number">27</span>) <span class="hljs-keyword">or</span> (key == ord(<span class="hljs-string">'q'</span>)):<font></font>
            cv.destroyWindow(<span class="hljs-string">"RealSense object detection"</span>)
            <span class="hljs-keyword">break</span>        
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…³é—­æµï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">finally</span>:<font></font>
    pipeline.stop()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿˜æœ‰æœ€åä¸€ä¸ªã€‚</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¡«å†™</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€å¼€å§‹åˆ›å»º</font><i><font style="vertical-align: inherit;">çš„draw_predictionsï¼ˆï¼‰</font></i><font style="vertical-align: inherit;">æ¸²æŸ“æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘åˆ°ç‰©ä½“çš„è·ç¦»ã€‚</font><font style="vertical-align: inherit;">æˆ‘å†³å®šæŒ‰ä»¥ä¸‹æ–¹å¼è®¡ç®—è·ç¦»ï¼šå–æ‰€å‘ç°å¯¹è±¡æ¡†æ¶ä¸­æ‰€æœ‰è·ç¦»ç‚¹çš„å¹³å‡å€¼ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">draw_predictions</span>(<span class="hljs-params">pred_img, color_img, depth_image</span>):</span>
    <span class="hljs-keyword">for</span> detection <span class="hljs-keyword">in</span> pred_img[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,:,:]:<font></font>
        score = float(detection[<span class="hljs-number">2</span>])
        <span class="hljs-comment">#            50%</span>
        <span class="hljs-keyword">if</span> score &gt; <span class="hljs-number">0.5</span>:<font></font>
            left = detection[<span class="hljs-number">3</span>] * color_img.shape[<span class="hljs-number">1</span>]<font></font>
            top = detection[<span class="hljs-number">4</span>] * color_img.shape[<span class="hljs-number">0</span>]<font></font>
            right = detection[<span class="hljs-number">5</span>] * color_img.shape[<span class="hljs-number">1</span>]<font></font>
            bottom = detection[<span class="hljs-number">6</span>] * color_img.shape[<span class="hljs-number">0</span>]<font></font>
            cv.rectangle(color_img, (int(left), int(top)), (int(right), int(bottom)), (<span class="hljs-number">210</span>, <span class="hljs-number">230</span>, <span class="hljs-number">23</span>), <span class="hljs-number">2</span>)<font></font>
            <font></font>
            <span class="hljs-comment">#    </span><font></font>
            depth = depth_image[int(left):int(right), int(top):int(bottom)].astype(float)<font></font>
            depth_scale = profile.get_device().first_depth_sensor().get_depth_scale()<font></font>
            depth = depth * depth_scale<font></font>
            dist,_,_,_ = cv.mean(depth)<font></font>
            dist = round(dist, <span class="hljs-number">1</span>)<font></font>
            cv.putText(color_img, <span class="hljs-string">"dist: "</span>+str(dist)+<span class="hljs-string">"m"</span>, (int(left), int(top)<span class="hljs-number">-5</span>), cv.FONT_HERSHEY_PLAIN, <span class="hljs-number">1</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)
</code></pre><br>
<img src="https://habrastorage.org/webt/x_/vf/co/x_vfcoyruqkixnlockdww9hbut4.png" alt="å›¾ç‰‡"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæ•´ä»£ç </font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> pyrealsense2 <span class="hljs-keyword">as</span> rs
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> cv2 <span class="hljs-keyword">as</span> cv<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">draw_predictions</span>(<span class="hljs-params">pred_img, color_img, depth_image</span>):</span> <span class="hljs-comment"># &lt;-        </span>
    <span class="hljs-keyword">for</span> detection <span class="hljs-keyword">in</span> pred_img[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,:,:]:<font></font>
        score = float(detection[<span class="hljs-number">2</span>])
        <span class="hljs-comment">#            50%</span>
        <span class="hljs-keyword">if</span> score &gt; <span class="hljs-number">0.5</span>:<font></font>
            left = detection[<span class="hljs-number">3</span>] * color_img.shape[<span class="hljs-number">1</span>]<font></font>
            top = detection[<span class="hljs-number">4</span>] * color_img.shape[<span class="hljs-number">0</span>]<font></font>
            right = detection[<span class="hljs-number">5</span>] * color_img.shape[<span class="hljs-number">1</span>]<font></font>
            bottom = detection[<span class="hljs-number">6</span>] * color_img.shape[<span class="hljs-number">0</span>]<font></font>
            cv.rectangle(color_img, (int(left), int(top)), (int(right), int(bottom)), (<span class="hljs-number">210</span>, <span class="hljs-number">230</span>, <span class="hljs-number">23</span>), <span class="hljs-number">2</span>)<font></font>
            <font></font>
            <span class="hljs-comment">#    </span><font></font>
            depth = depth_image[int(left):int(right), int(top):int(bottom)].astype(float)<font></font>
            depth_scale = profile.get_device().first_depth_sensor().get_depth_scale()<font></font>
            depth = depth * depth_scale<font></font>
            dist,_,_,_ = cv.mean(depth)<font></font>
            dist = round(dist, <span class="hljs-number">1</span>)<font></font>
            cv.putText(color_img, <span class="hljs-string">"dist: "</span>+str(dist)+<span class="hljs-string">"m"</span>, (int(left), int(top)<span class="hljs-number">-5</span>), cv.FONT_HERSHEY_PLAIN, <span class="hljs-number">1</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)<font></font>
<font></font>
<font></font>
pipeline = rs.pipeline() <span class="hljs-comment"># &lt;-  pipeline      </span>
config = rs.config() <span class="hljs-comment"># &lt;-      </span>
colorizer = rs.colorizer() <span class="hljs-comment"># &lt;-      </span><font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
model = cv.dnn.readNetFromTensorflow(<font></font>
    <span class="hljs-string">"models/ssdlite_mobilenet_v2_coco_2018_05_09/frozen_inference_graph.pb"</span>, 
    <span class="hljs-string">"models/ssdlite_mobilenet_v2_coco_2018_05_09/graph.pbtxt"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#  2 : RGB  depth</span>
config.enable_stream(rs.stream.color, <span class="hljs-number">640</span>, <span class="hljs-number">480</span>, rs.format.bgr8, <span class="hljs-number">30</span>)<font></font>
config.enable_stream(rs.stream.depth, <span class="hljs-number">640</span>, <span class="hljs-number">480</span>, rs.format.z16, <span class="hljs-number">30</span>)<font></font>
profile = pipeline.start(config)<font></font>
<font></font>
cv.namedWindow(<span class="hljs-string">"RealSense object detection"</span>, cv.WINDOW_AUTOSIZE)
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment">#     ""  ""</span><font></font>
        frames = pipeline.wait_for_frames()<font></font>
        depth_frame = frames.get_depth_frame()<font></font>
        color_frame = frames.get_color_frame()<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> depth_frame <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> color_frame:
            <span class="hljs-keyword">continue</span><font></font>
<font></font>
        <span class="hljs-comment">#    numpy-</span><font></font>
        depth_image = np.asanyarray(depth_frame.get_data())<font></font>
        color_image = np.asanyarray(color_frame.get_data())<font></font>
        <font></font>
        <span class="hljs-comment">#  </span>
        model.setInput(cv.dnn.blobFromImage(color_image, size=(<span class="hljs-number">300</span>, <span class="hljs-number">300</span>), swapRB=<span class="hljs-literal">True</span>, crop=<span class="hljs-literal">False</span>))<font></font>
        pred = model.forward()<font></font>
        draw_predictions(pred, color_image, depth_image)<font></font>
<font></font>
        <span class="hljs-comment">#     </span>
        colorized_depth = cv.applyColorMap(cv.convertScaleAbs(depth_image, alpha=<span class="hljs-number">0.03</span>), cv.COLORMAP_JET)
        <span class="hljs-comment">#    </span><font></font>
        images = np.hstack((color_image, colorized_depth))<font></font>
        cv.imshow(<span class="hljs-string">"RealSense object detection"</span>, images)<font></font>
        <font></font>
        <span class="hljs-comment">#    'ESC'  'q'</span>
        key = cv.waitKey(<span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFF</span>
        <span class="hljs-keyword">if</span> (key == <span class="hljs-number">27</span>) <span class="hljs-keyword">or</span> (key == ord(<span class="hljs-string">'q'</span>)):<font></font>
            cv.destroyWindow(<span class="hljs-string">"RealSense object detection"</span>)
            <span class="hljs-keyword">break</span><font></font>
<font></font>
<span class="hljs-keyword">finally</span>:<font></font>
    pipeline.stop()</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è„šæœ¬æ¥ä¼°è®¡åˆ°é€‰å®šå¯¹è±¡çš„è·ç¦»ã€‚</font><font style="vertical-align: inherit;">è¯¥ç®—æ³•å¯èƒ½ä¼šçŠ¯çº¦50å˜ç±³çš„é”™è¯¯ï¼Œä½†æ€»ä½“ä¸Šåœ¨å››ç±³ä¹‹å†…æ•ˆæœå¾ˆå¥½ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†æé«˜æµ‹é‡ç²¾åº¦ï¼Œæ‚¨å¯ä»¥å°†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyrealsense2ä¸­</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åµŒå…¥çš„å…¶ä»–æ»¤é•œåº”ç”¨äºæ·±åº¦å›¾ä»¥</font><font style="vertical-align: inherit;">æé«˜å›¾åƒè´¨é‡ï¼Œæˆ–è€…ä¿®æ”¹æ·±åº¦è®¡ç®—ç®—æ³•æœ¬èº«ï¼ˆä¾‹å¦‚ï¼Œè®¡ç®—åŠ æƒå¹³å‡å€¼æˆ–åœ¨ä¸€ä¸ªä¸­å¿ƒåŒºåŸŸä¸­æµ‹é‡è·ç¦»ï¼‰ã€‚</font><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œä»»åŠ¡å¹¶ä¸å›°éš¾ï¼Œä½†å¾ˆæœ‰è¶£ã€‚</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN487508/">https://habr.com/ru/post/zh-CN487508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN487488/index.html">åº”ç”¨ç½‘ç»œå¼‚å¸¸åˆ†æå·¥å…·çš„æ¡ˆä¾‹ï¼šæ£€æµ‹æ¶æ„ä»£ç çš„ä¼ æ’­</a></li>
<li><a href="../zh-CN487490/index.html">æ²¡æœ‰CLRçš„MS SQLä¸Šçš„XSLè½¬æ¢</a></li>
<li><a href="../zh-CN487498/index.html">é€‰æ‹©æ•°æ®åº“è¿›è¡Œåˆ†æ</a></li>
<li><a href="../zh-CN487502/index.html">æ‰“å°æœºæ‰“å°æ—¶ä½¿ç”¨SNMPè½®è¯¢æ‰“å°è®¾å¤‡</a></li>
<li><a href="../zh-CN487504/index.html">åˆ°ä¿„ç½—æ–¯ç§‘å­¦æ—¥ï¼Œå°†è¯„é€‰å‡º2019å¹´å›½å†…ç§‘å­¦å®¶çš„æœ€ä½³æˆå°±</a></li>
<li><a href="../zh-CN487510/index.html">æ”¾å°„æ€§äº§å“ã€‚ä¼½ç›å…‰è°±ä»ªã€‚ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN487512/index.html">å¦‚ä½•åœ¨ç”µæŠ¥ç»„ä¸­å®ç°å¿½ç•¥è¢«é˜»æ­¢çš„ç”¨æˆ·ï¼Ÿ</a></li>
<li><a href="../zh-CN487514/index.html">Qrator Labså¹´åº¦ç½‘ç»œå®‰å…¨æ€§å’Œå¯ç”¨æ€§æŠ¥å‘Š</a></li>
<li><a href="../zh-CN487516/index.html">ä½¿ç”¨Prefetchæ–‡ä»¶çš„æ”»å‡»è€…çš„ç‹©çŒæŠ€æœ¯å’Œç­–ç•¥</a></li>
<li><a href="../zh-CN487518/index.html">æ”¾å°„æ€§äº§å“ã€‚ä¼½ç›å…‰è°±ä»ªã€‚ç¬¬2éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>