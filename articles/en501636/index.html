<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõï ‚õ∑Ô∏è ü•ü How to deploy Kubernetes cluster in Morpheus in 30 minutes üöá üë®üèø üëÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many companies have the task of rapidly deploying Kubernetes clusters. It‚Äôs good when the cluster is created automatically. But it‚Äôs even better when ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to deploy Kubernetes cluster in Morpheus in 30 minutes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/501636/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many companies have the task of rapidly deploying Kubernetes clusters. </font><font style="vertical-align: inherit;">It‚Äôs good when the cluster is created automatically. </font><font style="vertical-align: inherit;">But it‚Äôs even better when a user, for example, a developer, can create a cluster and then manage it ‚Äúby button‚Äù without involving devops for this. </font><font style="vertical-align: inherit;">In our cloud lab, we saw how the Morpheus hybrid cloud management platform handles the creation of the Kubernetes cluster: they automated deployment and evaluated the management and scalability of the cluster.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af3/38a/629/af338a6296d8d080583c9ab2fb1cb092.jpg"></div><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is Morpheus? </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Morpheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> platform </font><font style="vertical-align: inherit;">is primarily focused on the creation and management of hybrid clouds (Cloud Management Platform, CMP). And the ability to deploy Kubernetes in this application is a bonus for its owners. But since the question of Kubernetes usually sounds one of the first in conversations ‚Äúbeyond the clouds,‚Äù we decided to show the whole process from its creation to scaling. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today, Morpheus is the leader of the Gartner quadrant in its class. We tested the system in our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laboratory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on private and hybrid clouds, and against the background of "classmates" it has several features. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, Morpheus integrates with a large number of resource providers. Today there are over 80 such opportunities for integration out of the box, and their number is constantly growing.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What functionality is ‚Äúwired‚Äù in Morpheus? </font><font style="vertical-align: inherit;">Possibility of creating instances, automation of DevOps-processes due to quick configuration and delivery of bare metal, VM and containerized applications. </font><font style="vertical-align: inherit;">In use, the product simplifies many routine tasks by providing scalability, monitoring, and backup. </font><font style="vertical-align: inherit;">Morpheus also supports role-based access configuration and resource allocation matching mechanisms. </font><font style="vertical-align: inherit;">The advantage of this software are tools for optimizing computing resources.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparing to create a Kubernetes cluster</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the process of creating a Kubernetes cluster on the VMware platform using the cluster instance mechanism. </font><font style="vertical-align: inherit;">As a result, users of the hybrid cloud will be able to create and scale the Kubernetes cluster using the portal or through the API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, let's understand what instances are and consider the capabilities of the Morpheus library.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instances </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An instance is a set of containers or virtual machines that are associated with one horizontally scalable service. </font><font style="vertical-align: inherit;">In addition to simple instances (virtual machines, containers, DBMS), Morpheus creates and deploys cluster instances. </font><font style="vertical-align: inherit;">The diagram below gives an idea of ‚Äã‚Äãwhich components a cluster instance is formed from.</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b23/51b/f30/b2351bf309fcef1ca2bcee37cdf1b45b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, an instance consists of templates (cluster layouts), and templates, in turn, are associated with nodes (node ‚Äã‚Äãtype). </font><font style="vertical-align: inherit;">All of the above components are elements of the Morpheus library.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Morpheus Library </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creating your own instance is done using the Library section. </font><font style="vertical-align: inherit;">The screenshot shows a part of the Morpheus interface that displays all sections of the library.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33c/1cf/0fa/33c1cf0fa4cabe66400bb3d2fbe89d0c.jpg"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instance Types</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stores existing instances, allows you to create new ones and publish them in a directory. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layouts is</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> designed to create service templates. The template defines the configuration of the future service and the cloud in which the service will be deployed. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node Types</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> allows you to create virtual images (nodes) from a single source image with a different set of output content. For example, you have the original Centos 7 image used in Node1 and Node2. When calling the template with Node1, the user will receive the Centos 7 service with the Nginx package, when calling the template with Node2 - Centos7 with Apachee. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option Types,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you can create options to add additional metadata to the templates. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option Lists</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">needed to import option lists from external sources. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File Templates</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contains configuration files that can be used to automate the configuration of services at different stages of deployment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scripts</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are scripts in the future, they are used for automation. </font><font style="vertical-align: inherit;">Scripts have a parameter indicating the necessary moment of their launch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster Layouts</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section </font><font style="vertical-align: inherit;">is similar in functionality to Layouts. </font><font style="vertical-align: inherit;">The difference is that the templates created in Cluster Layouts are used to form cluster instances.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating a Cluster Instance </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the instances and capabilities of the library, you can deploy a Kubernetes cluster. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first stage: preparing virtual images for master and worker. </font></font></strong> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's go to the Node Types library section and create two new nodes.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's start with the master. </font><font style="vertical-align: inherit;">The screenshot below shows the settings dialog box. </font><font style="vertical-align: inherit;">First, set name and short name, as well as the version. </font><font style="vertical-align: inherit;">In the TECHNOLOGY field, select VMware, this parameter defines the cloud resource for which the image is created. </font><font style="vertical-align: inherit;">Next, we indicate the image of the operating system - in our example, this is Centos 7 from the Morpheus standard library. </font><font style="vertical-align: inherit;">And we also determine which scripts will be run to configure and initialize master`a.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/443/6d1/661/4436d1661862632544099667b8368aed.jpg"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For worker, the settings are similar, with the exception of a set of scripts. </font><font style="vertical-align: inherit;">It‚Äôs enough to install Docker and kubeadm, and then run the join script that connects Worker to Master.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/832/853/d74/832853d740c5536faccf47facd3ba838.jpg"></div><br>
</li>
</ol><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The next step is to create a Cluster Layout. </font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We press the ADD button in the corresponding section of the library, after which the dialog box for setting the new template opens.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set the name and version of the template and select Kubernetes Cluster in the CLUSTER TYPE drop-down list.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0b/f88/90b/d0bf8890b204bb47ab50f98be2594579.jpg"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TECHNOLOGY - the resource provider for which this template is intended. </font><font style="vertical-align: inherit;">Let's get back to our original outline. </font><font style="vertical-align: inherit;">The Kubernetes instance has 3 templates. </font><font style="vertical-align: inherit;">The first two are for AWS and can only be selected if AWS is connected to Morpheus as a managed resource. </font><font style="vertical-align: inherit;">In our example, VMware vSphere is used as a resource provider, and we select it in the TECHNOLOGY field.</font></font></li>
<li>      Master  Worker. <br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b6/089/561/6b6089561f8862f7e2a2d3d67b2772d7.jpg"></div><br>
<br>
   .    Node Type  Master  Worker  ¬´Kubernetes Cluster Master Centos (local)¬ª  ¬´Kubernetes Cluster Worker (local)¬ª .     ,        ¬´Search nodes¬ª,      . <br>
<br>
   Count  Priority. Count ‚Äî    . Priority ‚Äî       .   ,   .        master ‚Äî 0,     .       3 worker`.</li>
<li>      . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the template is available in the service catalog. </font><font style="vertical-align: inherit;">Consider the process of ordering the Kubernetes Cluster service, as well as the possibility of scaling it.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating a Kubernetes Cluster </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cluster instances are available from the Clusters section of the Infrastructure tab. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/409/c55/741/409c5574144ee0a9b879b60627d8ae7d.jpg"></div><br>
 <br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Group tab - select a resource group. </font><font style="vertical-align: inherit;">In our example, it is the only one.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the Name tab, select the cloud in which the cluster is deployed. </font><font style="vertical-align: inherit;">For us, this is VMware. </font><font style="vertical-align: inherit;">We set the cluster name and define the visibility settings (Public - available in all tenants, Private - available only in the tenant of the current user).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure tab - here we select the template and cluster configuration. </font><font style="vertical-align: inherit;">Our cluster instance has 4 templates for the VMware cloud. </font><font style="vertical-align: inherit;">We use the created "Jet Demo Cluster".</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f1/496/8dd/4f14968ddb02e9b38152c9c3d5fa5c68.jpg"></div><br>
PLAN ‚Äî    Master.<br>
<br>
VOLUMES ‚Äî   ,     master  worker. <br>
<br>
NETWORKS ‚Äî    .      ,   .<br>
<br>
POD CIDR ‚Äî    POD`.<br>
<br>
WORKER PLAN ‚Äî    Worker`. <br>
<br>
NUMBER OF WORKERS ‚Äî    ,         Node Type.     .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/120/43c/82a/12043c82ad9b75d03aca4f46894f16c3.jpg"></div><br>
</li>
<li>  Automation    Workflow.    Workflow  ,        .  ‚Äî   Complete. <br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f81/754/bf4/f81754bf44f5967a21d0e477fbb482ad.jpg"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Morpheus begins to deploy a Kubernetes cluster. </font><font style="vertical-align: inherit;">In the selected configuration, the process will take about 30 minutes. </font><font style="vertical-align: inherit;">After that, the cluster will be available for launching containers with applications.</font></font></li>
</ol><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster deployment process</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, a virtual machine is deployed from the Kubernetes Cluster Master Centos (local) image. </font><font style="vertical-align: inherit;">Then the master configuration scripts will be run one by one. </font><font style="vertical-align: inherit;">After the installation and configuration of the master is completed, from the Kubernetes Cluster Worker (local) template, VMs for future workers will be deployed. </font><font style="vertical-align: inherit;">Next, scripts will be launched again, which will install the necessary components on the worker. </font><font style="vertical-align: inherit;">After all the images have been deployed, Post Provision scripts will be launched on the workers, connecting them to the cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cluster deployment steps are illustrated in the diagram:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ad/1ac/838/9ad1ac8388b7bb70cc0feb6104fa0ea0.jpg"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster Instance Management</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the features of the control panel for a deployed instance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to basic information about the cost of the ordered service and cluster performance, you can get information about the available namespace, as well as create new ones directly from the interface. </font><font style="vertical-align: inherit;">Information about running services and containers is presented on a special tab.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f48/f23/53f/f48f2353fcf9c62512a2aa3f6d97889d.jpg"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster scaling </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adding workers to the cluster is quite simple. </font><font style="vertical-align: inherit;">To do this, select the corresponding menu item on the Actions tab of the cluster instance control panel.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e6/c3c/342/2e6c3c3427a622559e2133ecc16771bd.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, in the dialog that appears, set the configuration and accept the settings. After that, the new Worker will automatically deploy and join the cluster. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">***</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Creation and scaling of Kubernetes clusters in Morpheus is not inferior in its simplicity to specialized applications. We emphasize once again that in this platform this functionality is far from the only one. It is a huge list of supported applications, virtualization platforms and infrastructure services that is Morpheus's strong point. Moreover, there are both ready-made templates and the ability to create your own library tools and a large number of images, scripts and configuration files available from the box. The tool is quite flexible and, in comparison with competitors, relatively easy to deploy.</font></font><br>
<br>
<i>:  , -   ¬´ ¬ª</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501624/index.html">Actual models of linguistic localization in the field of IT and digital communications. Part 2</a></li>
<li><a href="../en501628/index.html">Interview with Alexander Filippov, Lead Game Designer World of Tanks Blitz</a></li>
<li><a href="../en501630/index.html">Five security risks when working remotely</a></li>
<li><a href="../en501632/index.html">5 JavaScript libraries for working with strings</a></li>
<li><a href="../en501634/index.html">CSS functions min (), max () and clamp ()</a></li>
<li><a href="../en501642/index.html">Which is better: confirmation of the action or the possibility of its cancellation?</a></li>
<li><a href="../en501644/index.html">CSS Animation Performance Analysis</a></li>
<li><a href="../en501646/index.html">Go, Vue and 3 days to develop: a real-time system for monitoring patients</a></li>
<li><a href="../en501648/index.html">10 extensions for VS Code, without which I can not program</a></li>
<li><a href="../en501650/index.html">What is inside a .wasm file? Introducing wasm-decompile</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>