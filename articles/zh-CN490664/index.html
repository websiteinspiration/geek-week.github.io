<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦁 👧🏻 🉑 PHP：array_key_exists的搜索速度比in_array快500倍 👨‍👩‍👦 🐞 😸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在2014年，他们已经撰写了有关数组搜索的文章，但几乎没人知道。
 
 从那时起，已经发布了许多版本的PHP，但尚未修复，这意味着反馈很差，很少有人知道。在python上是相同的，在3 *中比在2.7中差。
 
 有时您需要在一个字符串数组中找到一个字符串 -在不同算法中非常频繁的操作，并且如果数组...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PHP：array_key_exists的搜索速度比in_array快500倍</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490664/"><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在2014年，他们已经撰写了有关数组搜索的文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但几乎没人知道。</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
从那时起，已经发布了许多版本的PHP，但尚未修复，这意味着反馈很差，很少有人知道。在python上是相同的，在3 *中比在2.7中差。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时您需要在一个字符串数组中找到一个字符串</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -在不同算法中非常频繁的操作，并且如果数组很小并且看上去有点而不是处于循环中，则in_array是正常的，它不会影响整体速度，但是如果您需要大数据并查找十亿行和十亿次的数组，那么这很关键：更好的时间，而不是每周。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个简单的测试显示：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in_array在6-9秒内查找</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone.com/Yb1mDa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6600ms</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，array_key_exists查找相同的东西，但比250（php5.6 / py3。*）快400倍以上（php7.3 / py2.7）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone .com / gwSmFc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（周期增加了100倍）12ms（6600/12 = 550倍+加载和缓存导致的-10％扩展）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为什么会发生这种情况？</font><font style="vertical-align: inherit;">详细考虑：</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1）在纯汇编程序中查找字符串是对字符串数组（快速或冒泡）进行排序，然后进行二进制搜索。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
二进制搜索日志中的步数（n）次取决于数组的大小，并且比简单搜索小得多。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以一次对字符串数组进行一次排序，然后进行缓存，然后进行十亿次搜索。</font><font style="vertical-align: inherit;">但这无济于事。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认情况下，排序会再次发生，尽管他们写道，它们通过散列在7.2 in_array中得到了改善，但并没有太大改善。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2）在关联中搜索索引/关键字（作为字符串）。数组/字典通过字符串哈希和冲突处理发生（哈希搜索错误）。哈希是数组的数字索引，并通过2个步骤从数组中获取数字索引（零元素的地址）+ offset *带有此哈希的字符串数组的指针的大小。 +蛮力碰撞，平均步伐比二进制搜索少。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建字典元素$ m [key] = val时，索引哈希将自动自动进行一次并被缓存。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
散列的大小，散列算法已缝制到PCP引擎中，并且无法更改，尽管源代码是开放的，但您可以下载更改并编译服务器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您无法继续阅读，只需将in_array更改为array_combine + array_key_exists。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过散列搜索时的步骤数取决于冲突数和具有相同散列的行数。它们需要进行排序，或者也需要进行排序和二进制搜索。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了减少冲突，可以分配更多的内存，如果现在不再像50年前那样问题了，当时电磁线圈上的1 kb内存像飞机一样花费很大。那时所有的基本算法都被发明出来了：sort / zip / gif / jpg /等-它们不需要很多内存，但是它们很糟糕，现在它们要好得多，但是它们需要1-16 MB的大量内存。是的，有些服务器具有256 MB的服务器，每个服务器都有一个单独的流，而16 MB已经足够了，但是在普通用户的设备上至少1 GB，而16 MB的存储桶中却有一个小数目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果将调用array_key_exists函数的调用替换为isset（$ m [key]）构造，您将获得更大的效果，它不会清除命令队列和缓存，不使用堆栈，并且速度提高了大约20％。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您创建前两个字母的数组-4 * 16kb，并首先在偏移量（索引=第一个字符的代码+ 2nd * 256）处查找指向字符串其余部分的哈希数组的指针，然后查找一个由字符串组成的小数组，则可以加快处理速度碰撞要小得多。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它需要更多的内存，算法也更复杂，但是搜索速度要快30倍以上。但这不是用php实现的，您可以编写so / dll库并调用它，或者要求开发人员在7.5中添加它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以通过mySQL搜索，但是您需要对查询进行分组，但它仍然会比较慢。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS：这种方法是我在加速一个大型慢速网站时通过键入，直觉和经验偶然发现的，其中有很多这样的技巧和窍门，我设法将数据从40秒导出到0.8秒，并使用排序和过滤器输出列表，还有很多其他尽管标准技术，框架和框架很方便并且可以加快开发速度，但是它们做起来太慢了。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490650/index.html">初学者IT专家编写简历的主要错误</a></li>
<li><a href="../zh-CN490652/index.html">后勤。介绍 只是复杂</a></li>
<li><a href="../zh-CN490654/index.html">点缀MQ系列气体传感器-深入了解数据表和调试</a></li>
<li><a href="../zh-CN490656/index.html">Camunda外部任务-使用弹性和可扩展架构构建应用程序的强大工具</a></li>
<li><a href="../zh-CN490660/index.html">我们如何确保CityMobile的增长</a></li>
<li><a href="../zh-CN490668/index.html">从产品到项目的转换历史，反之亦然（以莫斯科地区的善良为例）</a></li>
<li><a href="../zh-CN490670/index.html">如何让汽车为您编写代码测试</a></li>
<li><a href="../zh-CN490674/index.html">哈勃·威克利（Habr Wickley）＃41 /更多自动驾驶汽车，教授。Fortran，Yandex，机器人的痛苦，如何阻止竞争对手的网站</a></li>
<li><a href="../zh-CN490676/index.html">单元测试，科学和数学</a></li>
<li><a href="../zh-CN490678/index.html">将RabbitMQ与MonsterMQ结合使用第5部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>