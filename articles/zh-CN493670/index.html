<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐭 ◻️ 💃🏽 丰田普锐斯媒体系统（第2部分） 👩‍🚀 🙌 👂🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="替换丰田Prius媒体系统的项目继续进行。
 
 在本文中-PHY，传输和将数据包传输到主机设备，最终可以在Prius的真实本机头上进行验证。
 
 童话很快影响了事情，但事情很快就完成了。今天，我继续了两年前开始的关于Prius媒体系统重新设计的旷日持久的项目。
 
  历史主题  — USB-A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>丰田普锐斯媒体系统（第2部分）</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493670/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替换</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丰田Prius媒体系统</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的项目继续进行</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">。</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中-PHY，传输和将数据包传输到主机设备，最终可以在Prius的真实本机头上进行验证。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
童话很快影响了事情，但事情很快就完成了。</font><font style="vertical-align: inherit;">今天，我继续了两年前开始的关于Prius媒体系统重新设计的旷日持久的项目。</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">历史主题</font></font></b>
                        <div class="spoiler_text">   —  USB-AVC    ,        .           ,     , ..       ++ —     ,  . <br>
<br>
  ,    ,        ,     ,           . <br>
<br>
,      ,     ,   PHY- . <br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，从一开始。</font><font style="vertical-align: inherit;">互联网适配器AVC-LAN上挖的时候，我经常看到类似的解决方案</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在讨论中，这样的评论经常会漏掉：</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">老实说，它不能很好地工作，或者说所有人都不能很好地工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
虽然轮胎可以在带有99年历史的Spacio的旧收音机上完美读取。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初，我从根本上反对做某事，并且结构不稳定的解决方案不适合我。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将重复轮胎的反向工程。走。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们连接到带电汽车上的总线，并删除波形：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/cz/uf/ccczuftggnmbqqtebaewgwcx_3e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包的开头。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/ac/v-/wu/acv-wuwaaoywpav08fjqekdyaq8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">钻头在中间的某个地方，更大。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/l3/cy/ba/l3cyba6lailk2fcxp9274-eltlk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与ACK非常相似。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
以下是关于这个奇怪步骤的更多信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我已经从存储的数据中截取了波形的屏幕截图，在获取数据时，我没有立即注意获取数据的电压范围。当他画画时，他不得不再次下车，以确保自己没有幸免于难。是的，差分总线的跨度仅为200mV（!!!）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，转到同事ST485使用的数据表，然后在其中看到以下内容：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/ui/n8/dmuin85kauk3hwji9d6w4d2dx5w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，在这里找到了所有麻烦的根源，因此，我们必须与电阻一起使用，并向松香之神祈祷，以便转换器可以在特定的机器上工作。接近极限工作是邪恶的。但是，更有趣的是，对于AVC-LAN（根据其规范，它实际上是NEC的某些IE-Bus的克隆）（链接会更进一步），活动状态是120mV以上的电压，尽管事实是ST485有权考虑小于200mV的任何东西都为零。好吧，就是说，如果由于生产偏差，ST485的阈值电平略低，并且在总线上出现的裕度略高于正常水平（允许最高6伏），那么，当然，ST485将能够接收这样的信号。而这些制造误差是</font><b><font style="vertical-align: inherit;">有时</font></b><font style="vertical-align: inherit;">迫使带有ST485的设备组成的唯一原因</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作。当然，我们不会在发展中寄予如此幸福。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基于相同的ST485和运算放大器的第二个可用解决方案，我不喜欢大量的组件。好吧，毕竟我们生活在21世纪。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解决方案：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有用于AVC-LAN的特殊转换器。但是我无法以负担得起的价格购买到该设备。中国兄弟会再次进行救援，发现了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HA12240FP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其电压</font><b><font style="vertical-align: inherit;">差可</font></b><font style="vertical-align: inherit;">感知对数。数据表中的“ 1”为80..110 mV。这将使我们的轮胎能够以几乎两倍的余量设置有效水平。安排</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们在第一部分中提到的STM32F103上产生了</font><font style="vertical-align: inherit;">该方案</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ds/mj/ey/dsmjeylhhd1tldlydzj7kdf8yky.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方案匆忙诞生，其中包含</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。总线驱动器必须由5V供电。如果是这样，则如图所示，它们的差值会上升。阈值，并且并非所有数据包都被接受。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我认为，一切都很简单，不需要描述。也许除了RX1 / 2的支路选择不是偶然的事实之外，电路的第一个版本需要“文件细化”才能将信号发送到捕获/比较输入，因为我想用它来测量脉冲长度。替代解决方案-状态更改的轮询和中断会失去软件实现的准确性和复杂性。加-我想至少并行接收两行（头部中有三行），如果正面在两条线上重合，那么如果不使用捕获/比较功能，您可以告别任何可接受的精度的想法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
包中数据的进一步分析在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写得很好</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，鉴于链接不一致，我将在此简要重复一下：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">差分总线，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里他们</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写了有关日志级别的解释。</font><font style="vertical-align: inherit;">&lt;20mV时为“ 1”，记录。</font><font style="vertical-align: inherit;">“ 0”-&gt; 110mV。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位长度为40 µs，前20 µs始终为“ 0”，后7 µs始终为“ 1”，中间为位值。</font></font><br>
<img src="https://habrastorage.org/webt/vv/6_/_8/vv6__8pbidlx43eqnvjbupnee3g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好，交通信号灯：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/u2/k-/i1u2k-ji3f5mckou9r7mut6nzkm.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起始位-超过180μs </font></font></li>
<li>        (ACK).    «»,    - :<br>
<br>
<img src="https://habrastorage.org/webt/pg/sl/hq/pgslhqq84ha2ytwegw9njtlq6we.png"><br>
<br>
  ACK-    ,    Dallas 1-wire,      ,  , , .    ,   . 1     ,      «0» ( ,    ),     .2  ,      ,    ,   .  .3 ,        (1),     ,           ,    7  ,    . «1». <br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧...我们弄清楚了物理层，画了电路，把电路板拆开了。结果是这样的：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_d/4y/gj/_d4ygj2rf315jb9yqodcdfh7dda.png"><br>
<br>
<img src="https://habrastorage.org/webt/fu/om/rm/fuomrmmvbepdwmvpiqrmh1efezm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
印刷电路板的输出有些不成功，不是因为QR码在丝网印刷中不起作用。关于RX支脚的选择，电路中存在错误（在上图中，我已经对其进行了校正），并且三个线路驱动器已离婚。在编写和调试程序的过程中，我意识到，如果您可以稳定运行至少两个程序，那就很好了。是的，不需要更多。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧...该设备被证明是简单而有效的，而水平不匹配的建设性问题已得到解决。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在程序中进一步：</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>   .   ,        .  : *         USB —     ,    ,     «»  .    . *      ,             8,  6-    ,   4.4   .       ,    ,       . </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android监视器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可完全逆转总线逻辑。</font><font style="vertical-align: inherit;">如果有人精通Android和Kotlin，我将不胜感激有机会进行咨询。</font><font style="vertical-align: inherit;">这些是一次胆小妄为的尝试，以便一次掌握所有内容，因此，如果没有新的通过，就不要通过引用进入存储库：</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD：固定的时间</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小号</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ë数据，而不是微秒为毫秒。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN493660/index.html">CSS：完整的calc（）功能指南</a></li>
<li><a href="../zh-CN493662/index.html">太空力量</a></li>
<li><a href="../zh-CN493664/index.html">COVID-19传播速率分析并在dstack.ai上发布结果</a></li>
<li><a href="../zh-CN493666/index.html">我们如何教授人工智能来回答支持问题。体验Yandex.Taxi</a></li>
<li><a href="../zh-CN493668/index.html">我如何创建下一个网站构建器</a></li>
<li><a href="../zh-CN493674/index.html">网络视频播放器概述</a></li>
<li><a href="../zh-CN493678/index.html">波士顿动力：从美国陆军订单到现货商用机器人</a></li>
<li><a href="../zh-CN493680/index.html">10个技巧如何不合并在线功夫</a></li>
<li><a href="../zh-CN493682/index.html">如何选择长期投资：沃伦·巴菲特的投资组合中有6股</a></li>
<li><a href="../zh-CN493686/index.html">棋盘游戏关于黑客代码策划者的神秘渊源</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>