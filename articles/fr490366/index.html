<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍾 👩🏾‍🏭 🔱 Dois-je stocker des polices Google sur mon serveur? 🕺🏾 🆑 💪🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au cours des dernières semaines, par coïncidence au travail et dans des projets tiers, j'ai beaucoup appris sur les polices Web, ainsi que sur Google ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Dois-je stocker des polices Google sur mon serveur?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/490366/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au cours des dernières semaines, par coïncidence au travail et dans des projets tiers, j'ai beaucoup appris sur les polices Web, ainsi que sur Google Fonts en particulier. Grâce à cela, je peux donner une réponse plus détaillée à une question qui me paraissait simple dans le passé: devriez-vous stocker des polices Google sur votre serveur?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objectivement parlant, j'avoue que les polices ne sont pas mon fort. Je préfère une approche plus pratique et ne me concentre pas sur le design (regardez ce site et assurez-vous qu'il l'est) et avant cela je ne ressentais pas le besoin d'utiliser des polices non standard. Bien sûr, ils ont l'air un peu plus agréables et «marquent» le texte. Mais pour le texte principal, cela n'a guère de sens. Je n'ai jamais évalué l'article (ou lié à son contenu différemment), simplement parce qu'une belle police a été utilisée pour le soumettre. Cependant, j'étais pleinement conscient de l'impact négatif des polices supplémentaires sur les performances et la vitesse de chargement des pages, alors je suis peut-être biaisé à cause de cela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, beaucoup peuvent être en désaccord avec moi, et les polices, qu'elles soient importantes pour moi personnellement ou non, sont régulièrement utilisées par de nombreux autres développeurs, et souvent elles n'ont tout simplement pas le choix. </font><font style="vertical-align: inherit;">Voyons ce qui peut être fait pour ne pas perdre en vitesse sur le site, et laissons les designers heureux.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auto-hébergé vs ressources externes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelques années, il était normal d'utiliser CDN pour connecter des ressources partagées (par exemple, jQuery avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code.jquery.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://almanac."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oui, ils l'utilisent encore beaucoup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Pour clarifier, par CDN ici, je veux dire charger des ressources à partir du domaine de quelqu'un d'autre, pas de votre propre CDN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La raison en était que les navigateurs étaient censés limiter le nombre de connexions à chaque domaine (généralement à 6 connexions), donc l'utilisation d'un autre domaine vous a donné 6 autres connexions. Cela pouvait être vrai dans le passé (en particulier lorsque la restriction était &lt;6 domaines) et avant que le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.tunetheweb.com/security/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS ne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devienne la norme, ce </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui augmentait considérablement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">coûts de</font></a><font style="vertical-align: inherit;"> connexion. De plus, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.tunetheweb.com/performance/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bénéficie en fait de l'utilisation d'une connexion (surtout!), donc l'utilisation d'autres domaines est souvent une perte de performances plutôt qu'une acquisition. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre façon d'y parvenir était de diviser le domaine principal avec un ou plusieurs sous-domaines techniques (par exemple, assets.example.com), et dans ce cas, les polices n'apparaissent pas à nouveau sur votre domaine principal, d'où votre page Web est chargée. Néanmoins, cette méthode a les mêmes problèmes de connexion, donc cela ne peut pas être appelé un gain de performances, même si c'était le cas auparavant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre avantage d'un CDN public était la forte probabilité que les visiteurs aient déjà cette version de jQuery conditionnelle dans le cache. Mais, encore une fois, je suis convaincu que c'est trop. Il y a tellement de bibliothèques et leurs versions, et</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.speedshop.co/2015/11/05/page-weight-doesnt-matter.html&amp;usg=ALkJrhjlim2ny3sVNqDRmmBgyPDW2dHH2Q#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le cache du navigateur est plus petit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qu'il n'y paraît, une telle correspondance est donc très peu probable. De plus, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari utilise un cache HTTP unique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour chaque domaine visité, pour des raisons de confidentialité (cache à double clé), et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome introduira également cette fonction prochainement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ainsi, il n'y a plus rien à discuter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce sujet se transforme en une conversation sur l'impact des CDN tiers sur la confidentialité. Vous ne savez pas comment et pourquoi ils suivent vos utilisateurs, ce qui ne peut pas arriver avec une solution auto-hébergée. Et les récentes innovations de la loi obligent de nombreux sites à répertorier explicitement tous les cookies utilisés sur le site. Ce n'est pas la tâche la plus simple lors de l'utilisation de CDN tiers.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depuis longtemps, je suis convaincu que les CDN tiers ou même le partage de vos propres domaines sont très loin du gain de performance promis. Trop souvent, vous pouvez trouver des sites où le domaine principal ne distribue que index.html, puis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perdre beaucoup de temps à configurer de nouvelles connexions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sans parler des implications de sécurité du téléchargement de ressources à partir de sites tiers. Oui, il y a le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais cela peut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://nooshu.github.io/blog/2019/12/17/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">causer des problèmes inattendus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et honnêtement, je ne vois pas l'intérêt. S'il s'agit d'une ressource statique (où vous pouvez utiliser SRI), puis stockez-la localement, et si elle n'est pas statique (car le contenu peut changer), vous ne pouvez pas utiliser SRI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, l'utilisation de ressources provenant de sources tierces menace de devenir un point de défaillance unique (SPOF) et de désactiver votre site. </font><font style="vertical-align: inherit;">Cela s'est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">produit plus d'une fois</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et bien qu'il puisse sembler peu probable que les polices Google tombent, elles peuvent être bloquées par les mandataires de l'entreprise ou par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des pays entiers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, de plus en plus de gens conseillent </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de garder leurs ressources statiques à la maison</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , idéalement sur le domaine à partir duquel vous distribuez des pages Web. </font><font style="vertical-align: inherit;">Les polices sont des ressources statiques, donc la même chose s'applique à elles, non? </font><font style="vertical-align: inherit;">Eh bien, il s'avère que tout n'est pas si simple, car les polices ont leurs propres particularités et techniques d'optimisation, ce qui peut rendre le stockage local un peu plus compliqué ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Fonts et leur fonctionnement</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Fonts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une ressource géniale si vous aimez les polices. 977 polices gratuites que tout le monde peut utiliser gratuitement. Les polices commerciales sont souvent ridiculement chères et généralement sous licence plutôt que vendues, c'est-à-dire que les frais sont facturés en fonction du nombre attendu de pages vues. Par conséquent, avoir autant de polices gratuites et si faciles à utiliser dans une collection est très utile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ce n'est pas tout. Google Fonts, comme de nombreux fournisseurs de ressources pour les sites (voir l'exemple jQuery ci-dessus), fournit des CDN et stocke des polices que tout le monde peut utiliser directement à partir de ses serveurs. Cela signifie que vous pouvez commencer à utiliser des polices en ajoutant simplement une ligne de code sur votre site pour charger la feuille de style:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css?family=Lato&amp;display=swap"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez également ajouter plus de propriétés et de polices sur une seule ligne pour charger plusieurs polices et variantes de chacune d'entre elles:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i,900%7CPoppins:300,400,700,900&amp;display=swap"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'inconvénient est une baisse des performances (l'avantage est également dans les performances, mais ce n'est pas si évident, nous y arriverons). </font><font style="vertical-align: inherit;">Le problème est que votre site (par exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.example.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) charge une feuille de style à partir de fonts.googleapis.com, qui renvoie du CSS avec des règles de police. </font><font style="vertical-align: inherit;">Voici la source du lien dans l'exemple ci-dessus:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-comment">/* latin-ext */</span>
<span class="hljs-keyword">@font-face</span> {
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Lato'</span>;
  <span class="hljs-attribute">font-style</span>: normal;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
  <span class="hljs-attribute">font-display</span>: swap;
  <span class="hljs-attribute">src</span>: <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato Regular'</span>), <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato-Regular'</span>), <span class="hljs-built_in">url</span>(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjxAwXiWtFCfQ7A.woff2) <span class="hljs-built_in">format</span>(<span class="hljs-string">'woff2'</span>);
  <span class="hljs-attribute">unicode-range</span>: U+<span class="hljs-number">0100</span>-<span class="hljs-number">024</span>F, U+<span class="hljs-number">0259</span>, U+<span class="hljs-number">1</span>E00-<span class="hljs-number">1</span>EFF, U+<span class="hljs-number">2020</span>, U+<span class="hljs-number">20</span>A0-<span class="hljs-number">20</span>AB, U+<span class="hljs-number">20</span>AD-<span class="hljs-number">20</span>CF, U+<span class="hljs-number">2113</span>, U+<span class="hljs-number">2</span>C60-<span class="hljs-number">2</span>C7F, U+A720-A7FF;<font></font>
}<font></font>
<span class="hljs-comment">/* latin */</span>
<span class="hljs-keyword">@font-face</span> {
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Lato'</span>;
  <span class="hljs-attribute">font-style</span>: normal;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
  <span class="hljs-attribute">font-display</span>: swap;
  <span class="hljs-attribute">src</span>: <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato Regular'</span>), <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato-Regular'</span>), <span class="hljs-built_in">url</span>(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wXiWtFCc.woff2) <span class="hljs-built_in">format</span>(<span class="hljs-string">'woff2'</span>);
  <span class="hljs-attribute">unicode-range</span>: U+<span class="hljs-number">0000</span>-<span class="hljs-number">00</span>FF, U+<span class="hljs-number">0131</span>, U+<span class="hljs-number">0152</span>-<span class="hljs-number">0153</span>, U+<span class="hljs-number">02</span>BB-<span class="hljs-number">02</span>BC, U+<span class="hljs-number">02</span>C6, U+<span class="hljs-number">02</span>DA, U+<span class="hljs-number">02</span>DC, U+<span class="hljs-number">2000</span>-<span class="hljs-number">206</span>F, U+<span class="hljs-number">2074</span>, U+<span class="hljs-number">20</span>AC, U+<span class="hljs-number">2122</span>, U+<span class="hljs-number">2191</span>, U+<span class="hljs-number">2193</span>, U+<span class="hljs-number">2212</span>, U+<span class="hljs-number">2215</span>, U+FEFF, U+FFFD;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous parlerons de ce que certains de ces paramètres signifient plus tard (et aussi de la raison pour laquelle il existe deux règles de police), mais pour l'instant cela signifie que vous pouvez utiliser cette police dans vos styles comme ceci:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Lato'</span>, sans-serif;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, vous devez maintenant vous connecter à fonts.googleapis.com, télécharger CSS, puis vous connecter à fonts.gstatic.com et télécharger les polices elles-mêmes (pourquoi Google ne peut pas héberger à la fois CSS et les polices sur le même domaine - je ne comprends vraiment pas!). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les polices sont souvent détectées par le navigateur avec un retard lors du chargement de la page (après tout, vous devez charger CSS pour trouver des liens vers celles-ci). Mais les polices Google sont découvertes encore plus tard, car CSS doit être téléchargé à partir d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un autre</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> domaine, puis les polices du troisième domaine et, comme je l'ai mentionné, l'établissement d'une connexion HTTPS n'est pas non plus instantané. Cela peut être vu dans le diagramme en cascade ci-dessous généré par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (notez que tous les tests ont été exécutés avec Chrome - 3GSlow):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/94/si/uk/94siukfgpsuc3y8vvcenns7d8rm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ligne 1 montre que le HTML est chargé en premier. </font><font style="vertical-align: inherit;">Ensuite, dès qu'il est téléchargé et lu en moins de 2 secondes, le navigateur détecte la nécessité de charger le CSS Google Fonts et le charge à la ligne 4. Il faut une seconde pour établir une connexion, puis un fichier est téléchargé pendant 3,5 secondes. </font><font style="vertical-align: inherit;">Enfin, le navigateur a découvert l'existence de notre police et la charge sur la ligne 6, après avoir perdu encore 1 ¼ de seconde sur le chemin de la connexion avec fonts.gstatic.com. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, l'utilisation de cette police de Google Fonts nous coûte trois secondes entières de productivité à partir du moment où le HTML est disponible, sans tenir compte du temps de téléchargement de la police elle-même!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accélérer les polices Google en préchargeant les ressources </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez atténuer ce terrible impact sur les performances lors du chargement de CSS et de polices de deux domaines différents. Le premier domaine (pour CSS) doit être situé plus près du début du fichier index.html afin que le navigateur le lise dès que possible, mais le second est toujours masqué. Cependant, nous savons à quoi ressemblera ce domaine (fonts.gstatic.com), nous pouvons donc ouvrir la connexion à l'avance afin de gagner du temps sur la deuxième connexion plus tard:</font></font><br>
<br>
<pre><code class="xml hljs">
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.gstatic.com"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preconnect"</span> <span class="hljs-attr">crossorigin</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css?family=Lato&amp;display=swap"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors du nouveau test, nous voyons l'image suivante: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0-/ab/1r/0-ab1rf2caybdrxaloc5xrs6d0k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous voyons que la connexion sur la ligne 5 est ouverte à l'avance, avant de charger CSS. Nous gagnons donc plus d'une seconde (téléchargement de polices en 4 secondes, pas 5.25), car nous avons réussi à éviter de perdre du temps lors de la connexion et les polices sont téléchargées immédiatement après la lecture des CSS Google Fonts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pourriez penser que vous pouvez continuer et précharger la police entière, au lieu d'être content de ne rejoindre que le domaine, mais Google Fonts appelle les polices des hachages uniques. Dans l'exemple ci-dessus, la police téléchargée s'appelle S6uyw4BMUTPHjx4wXg.woff2, pas lato.woff2, donc le préchargement n'est pas possible sauf si vous voulez que votre site plante un jour lorsque Google décide soudainement de changer ce hachage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans tous les cas, si vous utilisez Google Fonts et n'avez pas l'intention de faire autre chose après avoir lu cette note, ajoutez au moins une connexion préliminaire au domaine, si ce n'est pas déjà fait. Ce n'est qu'une ligne de code et cela devrait améliorer considérablement les performances de votre page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, Google Fonts donne une commande similaire dans les en-têtes HTTP lors du rendu CSS:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1g/7n/lg/1g7nlg8c-qteofu6cr1t3eep2bi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais dans de nombreux cas, cela n'aidera pas beaucoup, car au moment où vous recevez les en-têtes de réponse HTTP du serveur avec CSS, le navigateur sait déjà que vous souhaitez vous connecter à ce domaine pour télécharger des polices. </font><font style="vertical-align: inherit;">Il est donc préférable pour vous de le spécifier dans le code HTML afin que la précharge fonctionne plus tôt (peu importe qu'elle soit dupliquée de cette manière, la deuxième tentative sera simplement ignorée). </font><font style="vertical-align: inherit;">Cependant, si votre page est toujours en cours de traitement au moment de la réception des en-têtes du serveur CSS de Google Fonts et que le DOM n'est pas prêt (c'est peut-être un signe de trop de JavaScript sur votre page?), Cela peut aider à améliorer les performances lorsqu'il devient finalement clair quelle police à télécharger.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affichage des polices: échange</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le code de font-face ci-dessus, vous pouvez voir la police-display: swap; line. Il s'agit d'une instruction relativement nouvelle. Il peut être ajouté à la déclaration de police et il indiquera au navigateur d'utiliser d'abord la solution de repli, c'est-à-dire la police système (sans-serif dans cet exemple), puis la remplacer par la police réelle après l'avoir téléchargée. De cette façon, vous pouvez éviter les retards dans le chargement du contenu lorsque la police n'a pas encore été chargée et également améliorer les performances.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, cela conduit à une épidémie de texte sans style (FOUT) - les mêmes «sauts» de contenu pendant le chargement de la page, mais certaines personnes ne l'aiment pas (mon avis est d'accord, le contenu est plus important que le style, mais le texte sautant à travers la page est ennuyeux, cependant cela peut être atténué en modifiant la police de rechange). Une alternative est le texte flash invisible (FOIT). Dans ce cas, le texte est masqué jusqu'à ce que la police apparaisse, ce qui retarde évidemment le téléchargement et peut causer d'autres problèmes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si du texte se charge, mais d'autres pas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans tous les cas, avant l'introduction de l'affichage des polices: swap, différents navigateurs traitaient cela différemment - certains, comme IE et Edge, utilisaient FOUT, d'autres utilisaient FOIT, et ils avaient des temps différents avant d'attendre que les polices attendent. Pour cette raison, si la police ne se chargeait pas, votre contenu pourrait rester invisible pendant longtemps. L'introduction de font-display: swap a permis aux développeurs de sites Web de décider par eux-mêmes comment cela se produirait. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart des navigateurs prennent en charge l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affichage de police: swap, à l'exception d'IE et Edge, mais comme mentionné ci-dessus, ils l'utilisent par défaut de toute façon. Les polices Google </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prennent également en charge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diverses options d'affichage des polices et offrent l'affichage des polices: permuter par défaut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, une autre astuce si vous utilisez les polices Google est de vérifier que vous avez le paramètre &amp; display = swap dans l'URL, et si ce n'est pas le cas (il n'a été pris en charge que récemment), ajoutez-le: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, remplacez ceci:</font></font><br>
<br>
<pre><code class="xml hljs">
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.gstatic.com"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preconnect"</span> <span class="hljs-attr">crossorigin</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css?family=Lato"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur ce:</font></font><br>
<br>
<pre><code class="xml hljs">
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.gstatic.com"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preconnect"</span> <span class="hljs-attr">crossorigin</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css?family=Lato&amp;display=swap"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez également </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spécifier l'une des autres valeurs d'affichage de police</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , par exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facultative</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , si vous le souhaitez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, cela ne résout que la moitié du problème. </font><font style="vertical-align: inherit;">Cette instruction est en CSS, qui renvoie les polices Google, elle n'est donc utile qu'après avoir téléchargé le fichier CSS. </font><font style="vertical-align: inherit;">Ainsi, cela aide à faire face au retard lors du chargement des polices elles-mêmes, mais cela n'aide pas pendant que vous attendez le chargement de ce CSS. </font><font style="vertical-align: inherit;">C'est donc une bonne amélioration (au moins pour ceux qui préfèrent FOUT), mais toujours pas la solution dans son ensemble.</font></font><br>
<br>
<h2>  Google Fonts</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aidé à créer Web Almanac</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (un aperçu fantastique de l'état d'Internet - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://almanac."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voyez par</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous-même si vous ne l'avez pas encore vu) et le lent téléchargement des polices Google sur notre site m'a énervé et je voulais le réparer. Surtout FOUT avec affichage de police: échange. Je me demandais si nous pouvions réduire l'impact de cela, et la solution locale semblait stocker des fichiers localement, éventuellement en utilisant le préchargement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons déjà utilisé les techniques ci-dessus (préchargement et affichage des polices: swap;), mais, bien sûr, il serait préférable de s'éloigner de la connexion CSS de l'extérieur. Nous savons ce qu'il y aura dans ce CSS. Alors, choisissez en toute confiance auto-hébergé? C'est là que ça devient intéressant ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai trouvé un script pratique sur GitHub ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Font Download</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ce qui m'a aidé à télécharger toutes les différentes options de police (car il y en avait beaucoup, jusqu'à 9 selon la page), puis à copier le CSS, qu'il affichait dans notre feuille de style principale, et à télécharger les polices sur le serveur. Il existe d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autres outils en ligne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui font de même. Tout semblait fonctionner, et nous nous sommes débarrassés du chargement CSS ennuyeux et de la nécessité de travailler avec deux domaines. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, en y regardant de plus près, j'ai remarqué que les polices étaient plus grandes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1w/hk/fs/1whkfsun5mb15p76jzen2eft4wk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, il y a eu une augmentation significative de la taille (jusqu'à 74% supplémentaires pour certains d'entre eux!) Par rapport aux polices Google téléchargées (à droite) et aux polices placées localement (à gauche). Au début, je pensais que cela était dû à mon serveur Web local, par exemple, en raison de la désactivation de la compression. Mais les polices WOFF2 sont servies sans compression par le serveur Web - ou du moins il devrait l'être - puisque le format inclut la compression Brotli. De plus, la capture d'écran ci-dessus montre les octets téléchargés (noirs en haut), ainsi que les octets non compressés (légèrement plus légers en bas) pour chaque colonne (ils sont assez similaires dans les deux colonnes, car les polices sont vraiment envoyées sans compression par le serveur Web, mais les octets téléchargés incluent des en-têtes HTTP , donc ils sont un peu plus grands), et il y avait des différences dans les octets compressés et non compressés, donc ce n'est pas la question.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La comparaison des règles de police de caractères obtenues à l'aide de l'outil avec celles d'origine a révélé une différence: de </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Fonts:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-comment">/* latin-ext */</span>
<span class="hljs-keyword">@font-face</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Lato'</span>;
    <span class="hljs-attribute">font-style</span>: normal;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
    <span class="hljs-attribute">font-display</span>: swap;
    <span class="hljs-attribute">src</span>: <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato Regular'</span>), <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato-Regular'</span>), <span class="hljs-built_in">url</span>(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjxAwXiWtFCfQ7A.woff2) <span class="hljs-built_in">format</span>(<span class="hljs-string">'woff2'</span>);
    <span class="hljs-attribute">unicode-range</span>: U+<span class="hljs-number">0100</span>-<span class="hljs-number">024</span>F, U+<span class="hljs-number">0259</span>, U+<span class="hljs-number">1</span>E00-<span class="hljs-number">1</span>EFF, U+<span class="hljs-number">2020</span>, U+<span class="hljs-number">20</span>A0-<span class="hljs-number">20</span>AB, U+<span class="hljs-number">20</span>AD-<span class="hljs-number">20</span>CF, U+<span class="hljs-number">2113</span>, U+<span class="hljs-number">2</span>C60-<span class="hljs-number">2</span>C7F, U+A720-A7FF;<font></font>
}<font></font>
<span class="hljs-comment">/* latin */</span>
<span class="hljs-keyword">@font-face</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Lato'</span>;
    <span class="hljs-attribute">font-style</span>: normal;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
    <span class="hljs-attribute">font-display</span>: swap;
    <span class="hljs-attribute">src</span>: <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato Regular'</span>), <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato-Regular'</span>), <span class="hljs-built_in">url</span>(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wXiWtFCc.woff2) <span class="hljs-built_in">format</span>(<span class="hljs-string">'woff2'</span>);
    <span class="hljs-attribute">unicode-range</span>: U+<span class="hljs-number">0000</span>-<span class="hljs-number">00</span>FF, U+<span class="hljs-number">0131</span>, U+<span class="hljs-number">0152</span>-<span class="hljs-number">0153</span>, U+<span class="hljs-number">02</span>BB-<span class="hljs-number">02</span>BC, U+<span class="hljs-number">02</span>C6, U+<span class="hljs-number">02</span>DA, U+<span class="hljs-number">02</span>DC, U+<span class="hljs-number">2000</span>-<span class="hljs-number">206</span>F, U+<span class="hljs-number">2074</span>, U+<span class="hljs-number">20</span>AC, U+<span class="hljs-number">2122</span>, U+<span class="hljs-number">2191</span>, U+<span class="hljs-number">2193</span>, U+<span class="hljs-number">2212</span>, U+<span class="hljs-number">2215</span>, U+FEFF, U+FFFD;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depuis l'outil de téléchargement:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-keyword">@font-face</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Lato'</span>;
    <span class="hljs-attribute">font-style</span>: normal;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
    <span class="hljs-attribute">src</span>:
        <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato Regular'</span>),
        <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato-Regular'</span>),
        <span class="hljs-comment">/* from https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wXg.woff2 */</span>
        <span class="hljs-built_in">url</span>(<span class="hljs-string">'Lato_400.woff2'</span>) <span class="hljs-built_in">format</span>(<span class="hljs-string">'woff2'</span>),
        <span class="hljs-comment">/* from https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wWA.woff */</span>
        <span class="hljs-built_in">url</span>(<span class="hljs-string">'Lato_400.woff'</span>) <span class="hljs-built_in">format</span>(<span class="hljs-string">'woff'</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première différence est que nous avons perdu la police d'affichage: swap line, mais cela peut être corrigé sans problème. </font><font style="vertical-align: inherit;">Beaucoup plus intéressant est le fait que Google Fonts distribue deux polices - et inclut différentes plages Unicode. </font><font style="vertical-align: inherit;">Cela est dû au sous-ensemble de polices et réduit les fichiers de polices.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous-ensemble de polices</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sous-ensemble de polices est la suppression des caractères que vous n'allez pas utiliser pour réduire la taille du fichier de police. En règle générale, la plupart des occidentaux n'utilisent que des caractères latins, et télécharger une police avec tous les caractères que vous n'utiliserez probablement pas est irrationnel. J'en avais entendu parler auparavant, mais je n'ai jamais pensé à quel point cela pouvait être important! Google Fonts affiche automatiquement une police avec un ensemble de caractères latins et, si possible, connecte une deuxième police pour les caractères latins étendus (par exemple, Ā), qui ne sera téléchargée que si nécessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, vous pouvez également demander une police spéciale qui ne contient que les caractères dont vous avez besoin avec le paramètre text: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://fonts.googleapis.com/css?family=Lato&amp;text=ABC</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À en juger par d'autres observations, l'outil de chargement de polices que j'ai utilisé prend apparemment en charge le sous-ensemble de polices, mais uniquement pour l'ensemble de la «langue» (latin ou latin étendu), et il combine les deux sous-ensembles de caractères dans un seul fichier. </font><font style="vertical-align: inherit;">À la fin, je suis retourné à l'utilisation de ce que mon navigateur utilisait et j'ai cessé d'utiliser cet outil. </font><font style="vertical-align: inherit;">Cela a donné des tailles de fichier similaires (avec une légère différence en raison des en-têtes HTTP dans mon environnement de développement), mais j'ai rapidement constaté qu'il ne s'agissait pas uniquement d'un sous-ensemble de polices.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Fonts distribue intelligemment les polices</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les polices Google ne rendent pas toujours le même CSS et cela </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dépend de l'agent utilisateur utilisé</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par exemple, pour Internet Explorer 11, il envoie les informations suivantes:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-keyword">@font-face</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Lato'</span>;
    <span class="hljs-attribute">font-style</span>: normal;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
    <span class="hljs-attribute">font-display</span>: swap;
    <span class="hljs-attribute">src</span>: <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato Regular'</span>), <span class="hljs-built_in">local</span>(<span class="hljs-string">'Lato-Regular'</span>), <span class="hljs-built_in">url</span>(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wWA.woff) <span class="hljs-built_in">format</span>(<span class="hljs-string">'woff'</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, vous pouvez voir qu'il ne fournit que le format WOFF, car IE 11 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne prend pas en charge WOFF2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et pour la même raison, la plage unicode n'est pas spécifiée. Il donne font-display: swap (comme je l'ai souligné dans l'URL pour CSS), bien que le navigateur ne le supporte pas, mais cela ne nuit pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas seulement le fabricant et la version du navigateur. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conseil de police</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclut des instructions supplémentaires dans le fichier de police, qui sont ensuite utilisées pour fournir le meilleur affichage de la police - en particulier sur les écrans à faible résolution ou pour les très petites tailles. L'affichage des polices est utilisé sur Windows, mais pas sur MacOS, donc selon le système d'exploitation avec lequel vous travaillez lors de la réception des polices Google, à l'aide d'un navigateur (même si vous utilisez Chrome sur chaque plate-forme), vous pouvez obtenir des fichiers de polices avec affichage ou sans lui. Si vous téléchargez la version Windows et l'utilisez vous-même, les utilisateurs de MacOS souffriront en fait de la nécessité de traiter de gros fichiers de polices remplis d'indices inutilisés, et si vous faites le contraire, vous risquez de faire en sorte que les utilisateurs de Windows souffrent d'un affichage des polices pire, sans indication de police.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque j'ai utilisé Google Fonts et que j'ai téléchargé des polices pour une utilisation locale, je l'ai fait sur mon Mac, j'ai donc obtenu des fichiers plus petits. </font><font style="vertical-align: inherit;">Lorsque j'ai utilisé l'outil, j'ai obtenu des polices complètes, avec des indices. </font><font style="vertical-align: inherit;">C'était donc une autre raison de la grande différence de taille! </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'indice de police est-il toujours pertinent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car les écrans haute définition sont devenus plus courants - c'est une bonne question, et de nombreuses polices sont initialement livrées sans allusion, car il faut beaucoup de temps pour les créer. </font><font style="vertical-align: inherit;">Lorsqu'il est présent - il peut augmenter considérablement la taille de la police. </font><font style="vertical-align: inherit;">Dans le cas de Lato, la taille est doublée. </font><font style="vertical-align: inherit;">Cela vaut-il la charge de travail supplémentaire que vous rencontrerez en abandonnant les polices Google et en localisant les polices localement? </font><font style="vertical-align: inherit;">C'est une autre décision que vous devez prendre pour vous-même.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, Google Fonts CDN est pris en charge par un script intelligent qui donne les polices les plus appropriées, les optimisant pour maintenir des performances maximales. En passant au stockage local des polices, vous devrez configurer tout cela vous-même, et vous risquez de perdre l'affichage correct de vos polices dans certains navigateurs si vous ne le faites pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour Web Almanac, nous avons examiné les statistiques sur les navigateurs des visiteurs et décidé de ne prendre en charge que WOFF2, et d'utiliser également des versions de MacOS sans allusion, car elles pèsent deux fois moins. Ce CSS simplifié (d'autant plus que la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plage unicode est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prise en charge par tous les navigateurs qui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prennent en charge WOFF2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), et les utilisateurs d'IE 11 et d'autres anciens navigateurs voient par défaut sans-serif, ce qui ne semble pas très bon, mais à notre avis, les polices sont une amélioration progressive, et même sans elles, le site est encore plus qu'utilisable. En outre, les anciens navigateurs peuvent même bénéficier de l'utilisation des polices par défaut du système, car ils sont susceptibles d'être utilisés sur des machines plus anciennes et de faible puissance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez également </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apporter d'autres ajustements aux polices que</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous utilisez si vous le souhaitez (vérifiez d'abord les licences!), Mais la copie des polices Google par défaut utilisées dans Chrome sur MacOS est probablement suffisante pour la plupart d'entre nous si vous souhaitez prendre en charge uniquement les navigateurs WOFF2 sans allusion. .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Néanmoins, si nous nous installions sur Google Fonts, nous aurions alors WOFF (et même des formats plus anciens) et des indices si nécessaire, sans avoir besoin d'une configuration approfondie de substitution de la police correcte en fonction du navigateur. </font><font style="vertical-align: inherit;">Ainsi, l'utilisation de Google Fonts pour les polices présente toujours certains avantages, et en choisissant le stockage local, vous les refusez. </font><font style="vertical-align: inherit;">Cela s'applique également à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toute amélioration future des polices Google</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Améliorations futures des polices</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depuis que je me suis plongé dans le sujet des polices et j'ai averti que vous pourriez perdre tous les avantages futurs de Google Fonts en allant au stockage local, je veux m'éloigner un peu du sujet principal et parler d'autres choses intéressantes que j'ai découvertes. </font><font style="vertical-align: inherit;">Quels sont les grands changements à venir dans le monde des polices? </font><font style="vertical-align: inherit;">Eh bien, il y a deux changements qui sont actuellement en cours de discussion et qui peuvent affecter les polices à l'avenir (et peuvent donc être pris en charge par Google Fonts, éventuellement par défaut si vous choisissez d'utiliser ce service): les polices variables et l'enrichissement progressif des polices .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polices variables</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les polices variables</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous permettent d'utiliser différents styles de police sans avoir à télécharger des fichiers individuels. J'ai mentionné plus tôt que Web Almanac utilise jusqu'à 9 fichiers de polices différents, mais en réalité il ne s'agit que de 2 polices. La raison est simple - le site utilise également des versions en gras, en italique, en gras et même plus fines de l'un ou des deux. De nombreuses variantes de la même police peuvent sembler inappropriées et vous pourriez penser que le navigateur lui-même fera face à la tâche de changer l'épaisseur du texte ou d'écrire en italique. Oui c'est possible. Mais chaque navigateur le fait un peu différemment, et les résultats </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peuvent être radicalement différents</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc beaucoup les appellent des «polices artificielles».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule façon de garantir le même affichage est d'utiliser une «vraie police» spécifiquement pour chaque style dont vous avez besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les polices variables </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standardisent l'affichage de diverses variantes de police</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le besoin de fichiers supplémentaires disparaît. Théoriquement, nous pourrions remplacer ces 9 polices par 2 lorsque leurs versions de polices variables seront disponibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ouvre une tonne de possibilités d'utilisation des polices sur Internet. Bien qu'il me semble que les 9 options pour les deux polices sont trop, en réalité ce n'est pas trop, tandis que les polices variables permettraient des variations infinies. Sur les appareils mobiles, vous pouvez définir une épaisseur légèrement différente pour le "gras" que sur les ordinateurs de bureau et les tablettes. Polices variables avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelques instructions CSS simples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permettre cela sans le coût des ressources pour télécharger une police supplémentaire. Récemment à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DotCSS, </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jason Pamental a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parlé des polices variables et a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">montré</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comment obtenir une page magnifiquement conçue avec ce qui semble être beaucoup de polices différentes - le tout en utilisant un seul fichier! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de polices variables </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signifie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> également le </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">chargement de toutes les variantes de polices en même temps</font></a><font style="vertical-align: inherit;"> , évitant la confusion causée par les problèmes mentionnés précédemment. Cela entraîne également moins de redessins de la mise en page: sans polices variables, la page </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera redessinée par le</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> navigateur encore et encore à mesure que chaque variante de police se charge. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les polices variables ont un bon support</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans les navigateurs modernes, mais leur inconvénient est la grande taille, car le stockage de différentes variantes de police nécessite plus d'espace, comme c'est le cas avec l'indication de police. </font><font style="vertical-align: inherit;">Cela dépend de la police, mais généralement ils sont deux fois plus grands après compression, donc pour justifier leur utilisation, vous devez avoir besoin d'au moins deux styles. </font><font style="vertical-align: inherit;">Même ainsi, il serait préférable de préférer un fichier plus petit qui est téléchargé pour afficher le texte critique, plutôt qu'un fichier plus grand pour afficher tout le texte. </font><font style="vertical-align: inherit;">Et encore une fois, l'utilisation de font-display: swap peut-elle être une solution moins problématique? </font><font style="vertical-align: inherit;">C'est à chaque propriétaire de site d'en décider!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enrichissement progressif des polices</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'enrichissement progressif des polices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en substance, prend le sous-ensemble à un nouveau niveau et vous permet de télécharger des définitions de caractères supplémentaires selon les besoins sous la forme d'un flux d'informations supplémentaires qui complète la police actuellement chargée, mais n'ajoute pas de définition supplémentaire. Cela peut sembler un petit avantage pour nous occidentaux, mais pour d'autres langues - en particulier en Extrême-Orient - les fichiers de polices peuvent être très massifs (par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 Mo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), en raison du grand nombre de caractères dans ces langues. Pour cette raison, les polices Web sont moins couramment utilisées dans ces pays et l'enrichissement progressif des polices peut avoir un effet positif sur la situation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'enrichissement progressif des polices, si je comprends bien, est à un stade beaucoup plus précoce que les polices variables, mais il existe</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">démo en ligne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans tous les cas, il s'agit d'un autre changement potentiellement intéressant lié aux polices.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Fonts continuera-t-il de s'améliorer?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné le fonctionnement de Google Fonts, il est facile d'imaginer qu'il puisse continuer de croître avec de nouvelles améliorations, telles que celles décrites dans cet article (ou bien d'autres!), Rien qu'en changeant le CSS que vous donnez. Et il peut le faire judicieusement. Par exemple, déterminer si votre navigateur prend en charge les nouvelles technologies (comme il le fait maintenant avec le format de police - WOFF ou WOFF2), ou d'autres manières. Par exemple, si vous demandez plus de deux polices et donnez une police variable moins gourmande en ressources, vous pouvez automatiser et créer un lien vers le même fichier de polices dans plusieurs annonces de type police, et si vous ne demandez qu'une seule option, faites référence à une plus légère, police traditionnelle. Sons farfelus? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ils l'ont déjà fait avec une police.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Oswald)! Honnêtement, je ne sais pas si la même chose est possible avec l'enrichissement progressif des polices, car je ne comprends pas bien le principe de son travail, mais ce sera intéressant à voir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il convient de mentionner que l'utilisation de Google Fonts, lors de la mise à jour des polices, par exemple, pour ajouter de nouveaux jeux de caractères ou corriger des erreurs dans les glyphes, vous obtenez automatiquement de nouvelles polices. Avec le stockage local, cela ne fonctionnera pas - du moins pas sans intervention d'une seule main. Peut-être pourriez-vous regarder dans le sens des demandes de proxy via votre domaine et prendre ainsi le meilleur des deux options, mais cela sera très probablement plus lent et nécessitera une configuration et une gestion supplémentaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'un autre côté, le stockage local offre une stabilité, car certaines mises à jour peuvent affecter votre conception, par exemple, si un titre sur une ligne commence à s'étirer à deux en raison d'un changement de police. </font><font style="vertical-align: inherit;">Il y a une catégorie de gens qui sont très en colère à cause de cela</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avantages du stockage des polices locales</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc discuté de nombreuses théories, et bien qu'il y ait des avantages potentiels évidents du stockage local, il y a aussi des difficultés à considérer, et donc l'utilisation de Google Fonts présente également des avantages évidents. Alors, l'auto-hébergement en vaut-il la peine? Cela dépend des commodités réelles dans une situation particulière. Si la différence de performances est insignifiante, il peut être utile de continuer à utiliser les polices Google, si elles sont importantes, respectivement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour Web Almanac, nous avons récemment </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://github.com/HTTPArchive/almanac."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sélectionné le stockage local de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Google Fonts, et les tests ont montré des changements spectaculaires:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oa/xy/ha/oaxyhappghsnk9rj-l4qoicboki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'image inférieure contient des polices locales sur notre serveur de test, et vous pouvez voir que le temps de téléchargement a été divisé par deux - de 6 à 3 secondes! Après une analyse plus approfondie, j'ai vu que la productivité augmentait encore plus (3 ⅓ secondes d'économies)! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui n'est pas si évident (mais ce que nous verrons plus tard) - à ce stade, les polices ne sont pas entièrement chargées sur aucune des images - avec le stockage local, cela prend 7,5 secondes et 10,5 secondes lors de l'utilisation de Google Fonts. Cependant, les polices utilisées sont assez similaires aux polices standard, et il n'y a pas de sauts notables dans la mise en page. Cela peut être vu dans le diagramme ci-dessous:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ai/zw/vu/aizwvu3sstjfwd68gd7gzhez4im.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le diagramme montre que la page avec stockage local (en rouge) est presque complètement chargée en 2,4 secondes, puis est mise à jour plusieurs fois au fur et à mesure du chargement des images, après quoi les polices sont également affichées. Oui, je voudrais que tout soit encore plus fluide, mais il est toujours impossible d'optimiser certains coûts de téléchargement de polices.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La raison pour laquelle les améliorations sont vraiment tangibles est due à une chose que je n'ai pas prise en compte au début: le rendu des blocs CSS. Donc, s'il existe un lien vers Google Fonts CSS, le navigateur ne retarde pas seulement l'affichage du texte - il retarde l'affichage de tout le contenu de la page! La police est une amélioration progressive, nous pouvons donc afficher en toute sécurité le reste de la page, et même le texte lui-même (avec les polices standard / de secours), mais pas le navigateur - il voit juste qu'il y a du CSS et essaie de le charger, reportant le téléchargement le reste de la page. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a pas de chargement asynchrone pour CSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- mais peut-être devrait-il en être ainsi? Néanmoins, nous risquons qu'en cas de problème de connexion à Google Fonts, l'intégralité de votre site soit inaccessible jusqu'à ce que le navigateur cesse de traiter le lien! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v6/3_/oo/v63_oow5ktzvixadg7tpirrthcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le tableau de comparaison ci-dessus, la ligne verte verticale Start Render se produit dès 6 secondes - car elle doit attendre que Google Fonts CSS se charge sur la ligne 12, passant la moitié du temps à se connecter au domaine et l'autre moitié à se charger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comparez cela avec la version locale: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x6/hm/4c/x6hm4c_omalxhr4ogx_5pueneci.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous pouvons commencer le rendu dès que le CSS du site est chargé et traité en 2,5 secondes. En effet, il n'y a pas de retard dans la connexion au domaine Google Fonts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les deux cas, nous voyons que le début du rendu se produit avant le chargement des polices, et grâce à la magie de font-display: swap, le texte est toujours visible. Par conséquent, au moins lors de l'utilisation de font-display: swap, il serait préférable que les polices Google ne soient pas chargées à l'aide du rendu de blocage CSS, mais, par exemple, chargées via JavaScript asynchrone, qui insère les polices CSS dans la page uniquement après comment ils sont téléchargés. Si le processus était implémenté de cette manière, les retards de rendu ne se produiraient pas, cependant, il y a toujours des retards de connexion et une longue attente pour que le texte s'affiche correctement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: J'ai créé un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">problème sur GitHub Google Fonts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec une suggestion pour ajouter un moyen de télécharger Google Fonts sans bloquer le rendu - votez si vous le souhaitez aussi!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zach Leatherman préconise cette approche pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réduire le nombre de redessins</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et montre que cela est également possible avec JavaScript seul, sans avoir besoin d'un fichier CSS. </font><font style="vertical-align: inherit;">Ensuite, cela montre d'autres avantages de la gestion de vos polices avec JavaScript, par exemple, vous pouvez refuser de télécharger des polices du tout si le site est ouvert à partir d'un réseau lent (à l'aide de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API d'informations réseau</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ou si l'utilisateur a activé les paramètres </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save-Data</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prefers-Reduced-Motion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Fonctionnalités intéressantes!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Préchargement des polices</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que vous vous serez éloigné des URL hachées de Google, vous pourrez précharger la police pour améliorer encore les performances. Cependant, cette option présente des défauts potentiels, comme Andy Davies l'a expliqué dans l'article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preloading Fonts and the Puzzle of Priorities</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fondamentalement, en préchargeant les polices et en les déplaçant dans l'ordre de priorité, vous réduisez implicitement la priorité des autres téléchargements critiques (par exemple, CSS), et en raison d'une erreur dans Chrome, les polices </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peuvent même</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dépasser certaines d'entre elles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le préchargement lorsque la police ne sera pas utilisée entraînera une charge excessive inutile - par exemple, si la version locale existe et peut être utilisée en priorité, ou si le navigateur ne prend pas en charge ce format de police (bien que tous les navigateurs prenant en charge le préchargement prennent également en charge WOFF2 ) Parallèlement à la recommandation d'utiliser le préchargement, Google </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous en avertit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clairement </font><font style="vertical-align: inherit;">, et il est agréable de voir qu'ils y prêtent attention.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous utilisez la fonction font-display: swap, le besoin de précharge peut ne pas être aussi fort. </font><font style="vertical-align: inherit;">Bien que dans ce cas, vous pouvez toujours gagner du temps en téléchargeant le nombre minimum requis de polices et en évitant ainsi FOUT et redessiner. </font><font style="vertical-align: inherit;">Pour le moment, nous n'utilisons pas le préchargement dans Web Almanac et avant de commencer, nous avons besoin de quelques tests supplémentaires, mais pour l'instant je suis satisfait de ce qui est.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Répondre à une question dans le titre de l'article: oui, ça vaut le coup, car le gain de performances est important. </font><font style="vertical-align: inherit;">Bien sûr, vos résultats peuvent varier, car tout dépend du site particulier, alors testez, testez et testez à nouveau. </font><font style="vertical-align: inherit;">Mais, je pense, c'est toujours la meilleure option, en termes de performances, pour la plupart des sites.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, Google Fonts n'est pas seulement un référentiel de centaines de polices gratuites - c'est également un mécanisme de livraison intelligent qui utilise bon nombre des dernières techniques d'optimisation pour rendre les polices les plus appropriées avec un effort minimal de la part du propriétaire du site. En passant à l'auto-hébergé, idéalement, vous devez réimplémenter de nombreuses améliorations utiles, telles que l'affichage de la police: échange, suppression des indices de police (au moins pour certains navigateurs), ou sinon, vous ne pouvez que nuire aux performances des plus lourds fichiers de polices.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas une tâche facile (et Google Fonts le fait pour vous, oui). Mais comme l'utilisation du format WOFF2 est désormais la seule option réaliste et que les navigateurs prennent bien en charge la plupart des techniques d'optimisation, tout est devenu beaucoup plus facile qu'auparavant. Néanmoins, cela vaut la peine d'avoir des connaissances sur les polices Web avant de tout configurer (j'espère que ce message a aidé à cela!), Et en même temps, gardez un œil sur les nouveaux changements dans le monde des polices, car il y aura sans aucun doute de nouvelles améliorations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, peut-être étions-nous trop soucieux d'optimisation et avec le stockage local, nous pouvons nous permettre d'utiliser la police complète, sans sous-ensemble et avec des indices? Sur le site Web de Google Fonts, vous pouvez télécharger n'importe quelle police et c'est relativement simple, bien qu'il soit étrange que l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archive n'inclue pas les formats WOFF et WOFF2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lors de l'utilisation de cette méthode de chargement, qui est complètement incompréhensible pour moi! </font><font style="vertical-align: inherit;">Cependant, si vous êtes vraiment intéressé à améliorer les performances (et vous devriez être intéressé!), Alors vous devriez essayer de faire la bonne chose. </font><font style="vertical-align: inherit;">Cet article montre seulement que c'est un peu plus compliqué que de simplement télécharger et placer des polices sur votre site, comme je m'y attendais toujours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wow, quelque chose de texte s'est avéré plus long que prévu! </font><font style="vertical-align: inherit;">Mais j'espère que vous étiez aussi intéressé par la compréhension du sujet que vous l'êtes et que vous avez maintenant quelques nouvelles idées pour accélérer le téléchargement des polices sur votre site. </font><font style="vertical-align: inherit;">Je vous recommande fortement de suivre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jason</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zach</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur Twitter pour en savoir plus sur les polices et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour en savoir plus sur la vitesse globale des applications Web.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490354/index.html">Renforcer la culture de la sécurité de l'information dans les sociétés fintech</a></li>
<li><a href="../fr490356/index.html">Présentation de Kubernetes CCM (Cloud Controller Manager) pour Yandex.Cloud</a></li>
<li><a href="../fr490358/index.html">Un programmeur moderne doit-il être capable de créer des algorithmes?</a></li>
<li><a href="../fr490362/index.html">Kubernetes dans l'esprit du piratage: notre chemin vers les microservices et un modèle prêt à l'emploi pour la mise en œuvre</a></li>
<li><a href="../fr490364/index.html">Les centres de données consomment beaucoup d'électricité, mais ne menacent pas encore le climat</a></li>
<li><a href="../fr490372/index.html">Entretien chez Dodo Pizza</a></li>
<li><a href="../fr490376/index.html">Pluriel</a></li>
<li><a href="../fr490378/index.html">IPv6 - un monde merveilleux qui mérite une transition rapide vers lui</a></li>
<li><a href="../fr490380/index.html">Achèvement retardé du pod lorsqu'il est supprimé</a></li>
<li><a href="../fr490382/index.html">Contenu FunCorp iOS Meetup # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>