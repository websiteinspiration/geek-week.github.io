<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌🏻 🖤 🧝🏽 Welche Möglichkeiten bietet Spring, um sein Verhalten anzupassen? 🚴🏻 👶🏽 🍱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo alle zusammen. In Kontakt Vladislav Rodin. Derzeit bin ich Leiter des High Load Architect-Kurses bei OTUS und unterrichte auch Kurse zur Softwar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Welche Möglichkeiten bietet Spring, um sein Verhalten anzupassen?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501930/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo alle zusammen. </font><font style="vertical-align: inherit;">In Kontakt Vladislav Rodin. </font><font style="vertical-align: inherit;">Derzeit bin ich Leiter des High Load Architect-Kurses bei OTUS und unterrichte auch Kurse zur Softwarearchitektur. </font></font></i><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neben dem Unterrichten schreibe ich auch urheberrechtlich geschütztes Material für den OTUS-Blog über den Haber und möchte mit dem heutigen Artikel zusammenfallen, um den Kurs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Entwickler auf dem Spring Framework"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu starten </font><font style="vertical-align: inherit;">, der jetzt für die Rekrutierung offen ist.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/pz/w4/uv/pzw4uv5fvldfmljzvc4v3flumdc.png"><br>
<hr><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus Sicht des Lesers sieht der Code der Anwendung, die Spring verwendet, recht einfach aus: Einige Beans werden deklariert, Klassen werden mit Anmerkungen markiert, und dann werden die Beans bei Bedarf injiziert, alles funktioniert einwandfrei. Ein neugieriger Leser hat jedoch eine Frage: „Wie funktioniert es? Was ist los?". In diesem Artikel werden wir versuchen, diese Frage zu beantworten, aber nicht, um die müßige Neugier zu befriedigen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spring Framework ist dafür bekannt, flexibel genug zu sein und bietet Optionen zum Anpassen des Verhaltens des Frameworks. </font><font style="vertical-align: inherit;">Im Frühling gibt es auch eine Reihe interessanter Regeln für das Anwenden bestimmter Anmerkungen (z. B. Transactional). </font><font style="vertical-align: inherit;">Um die Bedeutung dieser Regeln zu verstehen, sie ableiten zu können und um zu verstehen, was und wie Sie im Frühjahr konfigurieren können, müssen Sie verschiedene Funktionsprinzipien für das verstehen, was sich im Frühjahr unter der Haube befindet. </font><font style="vertical-align: inherit;">Wie Sie wissen, befreit die Kenntnis mehrerer Prinzipien von der Kenntnis vieler Tatsachen. </font><font style="vertical-align: inherit;">Ich schlage vor, dass Sie sich mit diesen Prinzipien vertraut machen, wenn Sie sie natürlich noch nicht kennen.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurationen lesen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu Beginn müssen Sie die Konfigurationen in Ihrer Anwendung analysieren. </font><font style="vertical-align: inherit;">Da es verschiedene Arten von Konfigurationen gibt (XML-, Groovy-, Java-Konfigurationen, Konfiguration basierend auf Anmerkungen), werden verschiedene Methoden zum Lesen verwendet. </font><font style="vertical-align: inherit;">Auf die eine oder andere Weise wird eine Karte der Form Map &lt;String, BeanDefinition&gt; gesammelt, in der die Namen der Beans ihren Bean-Definitionen zugewiesen werden. </font><font style="vertical-align: inherit;">Objekte der BeanDefinition-Klasse sind Metainformationen zu Beans und enthalten die ID, den Namen, die Klasse, die Zerstörungs- und die Init-Methode der Bean. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispiele für Klassen, die an diesem Prozess beteiligt sind: GroovyBeanDefinitionReader, XmlBeanDefinitionReader, AnnotatedBeanDefinitionReader, Implementierung der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinitionReader-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schnittstelle </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beandefinitionen einrichten</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben also Beschreibungen von Bohnen, aber es gibt keine Bohnen selbst, sie wurden noch nicht erstellt. </font><font style="vertical-align: inherit;">Vor dem Erstellen von Beans bietet Spring die Möglichkeit, die resultierenden BeanDefinitions anzupassen. </font><font style="vertical-align: inherit;">Für diese Zwecke wird die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanFactoryPostProcessor-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schnittstelle </font><b><font style="vertical-align: inherit;">verwendet</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es sieht aus wie das:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanFactoryPostProcessor</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Methodenparameter dieser Schnittstelle ermöglicht die Verwendung einer eigenen getBeanDefinitionNames-Methode, um die Namen abzurufen, mit denen Sie BeanDefinitions aus der Map abrufen und bearbeiten können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum könnte dies erforderlich sein? </font><font style="vertical-align: inherit;">Angenommen, einige Beans benötigen Details, um eine Verbindung zu einem externen System wie einer Datenbank herzustellen. </font><font style="vertical-align: inherit;">Wir möchten, dass die Beans bereits mit den Details erstellt werden, aber die Details selbst werden in der Eigenschaftendatei gespeichert. </font><font style="vertical-align: inherit;">Wir können einen der Standard-BeanFactoryPostProcessors - PropertySourcesPlaceholderConfigurer anwenden, der die Eigenschaft name in der BeanDefinition durch den tatsächlichen Wert ersetzt, der in der Eigenschaftendatei gespeichert ist. </font><font style="vertical-align: inherit;">Das heißt, es ersetzt tatsächlich Value ("user") durch Value ("root") in BeanDefinion. </font><font style="vertical-align: inherit;">Damit dies funktioniert, muss natürlich der PropertySourcesPlaceholderConfigurer verbunden sein. </font><font style="vertical-align: inherit;">Dies ist jedoch nicht darauf beschränkt. Sie können Ihren BeanFactoryPostProcessor registrieren, in dem Sie die Logik implementieren können, die Sie zur Verarbeitung von BeanDefinitions benötigen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bohnen erstellen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zeitpunkt haben wir eine Map, die die Namen der Beans enthält, die sich in den Schlüsseln befinden, und die konfigurierten BeanDefinitions anhand der Werte. Jetzt müssen Sie diese Bohnen erstellen. Dies ist, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">was BeanFactory tut</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Hier können Sie jedoch Anpassungen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vornehmen,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indem Sie Ihre </font><b><font style="vertical-align: inherit;">FactoryBean</font></b><font style="vertical-align: inherit;"> schreiben und registrieren </font><font style="vertical-align: inherit;">. FactoryBean ist eine Schnittstelle des Formulars:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FactoryBean</span> </span>{
    <span class="hljs-function">T <span class="hljs-title">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;<font></font>
    Class&lt;?&gt; getObjectType();<font></font>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSingleton</span><span class="hljs-params">()</span></span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher erstellt eine BeanFactory eine Bean selbst, wenn der Bean-Klasse keine FactoryBean entspricht, oder fordert die FactoryBean auf, diese Bean zu erstellen. </font><font style="vertical-align: inherit;">Es gibt eine kleine Nuance: Wenn der Umfang der Bean Singletone ist, wird die Bean zu diesem Zeitpunkt erstellt. Wenn ein Prototyp vorhanden ist, wird diese Bean jedes Mal, wenn sie benötigt wird, von der BeanFactory angefordert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis erhalten wir wieder eine Karte, die jedoch bereits etwas anders ist: Die Schlüssel enthalten die Namen der Bohnen und die Werte der Bohnen selbst. </font><font style="vertical-align: inherit;">Dies gilt jedoch nur für Singletones.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bohnen konfigurieren</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt kommt die interessanteste Etappe. Wir haben eine Karte mit den erstellten Beans, aber diese Beans wurden noch nicht konfiguriert. Das heißt, wir haben keine Anmerkungen verarbeitet, die den Status der Bean festlegen: Autowired, Value. Wir haben auch keine Anmerkungen verarbeitet, die das Verhalten der Bean ändern: Transactional, Async. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit BeanPostProcessors</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die wiederum Implementierungen der entsprechenden Schnittstelle sind, </font><font style="vertical-align: inherit;">können wir dieses Problem lösen </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanPostProcessor</span> </span>{
    <span class="hljs-function">Object <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException</span>;
    <span class="hljs-function">Object <span class="hljs-title">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sehen 2 Methoden mit beängstigenden, aber umfassenden Namen. Beide Methoden verwenden eine Bean als Eingabe, von der Sie abfragen können, um welche Klasse es sich handelt, und verwenden dann die Reflection-API, um Anmerkungen zu verarbeiten. Rückgabe-Bean-Methoden, möglicherweise ersetzt durch Proxy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für jede Bean, bevor sie in den Kontext gestellt wird, geschieht Folgendes: Die postProcessBeforeInitialization-Methoden werden für alle BeanPostProcessors ausgelöst, dann wird die init-Methode ausgelöst und anschließend werden die postProcessAfterInitialization-Methoden auch für alle BeanPostProcessors ausgelöst.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese beiden Methoden haben unterschiedliche Semantiken: postProcessBeforeInitialization verarbeitet Statusanmerkungen, postProcessAfterInitialization verarbeitet das Verhalten, da Proxy zum Verarbeiten des Verhaltens verwendet wird, was zum Verlust von Anmerkungen führen kann. Deshalb ändert sich das Verhalten an letzter Stelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wo ist die Anpassung? Wir können unsere Annotation BeanPostProcessor dafür schreiben, und Spring wird sie verarbeiten. Damit der BeanPostProcessor funktioniert, muss er jedoch auch als Bean registriert sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um beispielsweise eine Zufallszahl in das Feld einzubetten, erstellen wir eine InjectRandomInt-Annotation (hängen an den Feldern), erstellen und registrieren einen InjectRandomIntBeanPostProcessor, in dessen erster Methode wir die erstellte Annotation verarbeiten, und in der zweiten Methode geben wir einfach die eingehende Bean zurück.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Beans zu profilieren, erstellen Sie eine Profilanmerkung, die an Methoden gesendet wird, erstellen und registrieren Sie einen ProfileBeanPostProcessor, bei der ersten Methode geben wir die eingehende Bean zurück, und bei der zweiten Methode geben wir einen Proxy zurück, der den Aufruf der ursprünglichen Methode mit Protokollierung der Beschneidungs- und Ausführungszeit umschließt.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfahren Sie mehr über den Kurs</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de501914/index.html">Streamen Sie Modern Web Live 2020 - Best UX-Praktiken in unbestimmten Zeiten</a></li>
<li><a href="../de501918/index.html">Das Buch "Game Design. Rezepte für den Erfolg der besten Computerspiele von Super Mario und Doom bis Assassin's Creed und so weiter »</a></li>
<li><a href="../de501922/index.html">IoT, wo Sie nicht gewartet haben. Entwicklung und Erprobung (Teil 1)</a></li>
<li><a href="../de501924/index.html">Wie erstelle ich ein Venn-Diagramm mit 50 Kreisen? Visualisierung von Sets und der Geschichte meines Open Source Python-Projekts</a></li>
<li><a href="../de501928/index.html">PM Online Mitap mit Lautsprechern von Atlassian (Jira), Wrike und Productboard</a></li>
<li><a href="../de501932/index.html">Beschleunigung der Umsetzung von KI-Projekten im Waldbetrieb Segezha</a></li>
<li><a href="../de501934/index.html">Veröffentlichen Sie die VKUI-Komponentendesignbibliothek in Figma</a></li>
<li><a href="../de501938/index.html">Prometheus, geh nicht: 6 alternative Überwachungstools für Kubernetes</a></li>
<li><a href="../de501940/index.html">Ein bisschen über Neutralino.js</a></li>
<li><a href="../de501942/index.html">Kanban-Methode: Verstehen Sie Ihren Prozess als kollektiven Lernprozess</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>