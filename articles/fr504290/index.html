<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤪 💪🏾 📖 Test de charge en tant que service CI pour les développeurs ☁️ 👲 🏥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'un des problèmes que rencontrent souvent les éditeurs de logiciels multiproduits est la duplication des compétences des ingénieurs - développeurs, t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Test de charge en tant que service CI pour les développeurs</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/504290/"><img src="https://habrastorage.org/webt/r5/fa/5g/r5fa5gszksri1ly608-wffhunqu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des problèmes que rencontrent souvent les éditeurs de logiciels multiproduits est la duplication des compétences des ingénieurs - développeurs, testeurs et administrateurs d'infrastructure - dans presque toutes les équipes. Cela vaut également pour les ingénieurs coûteux - experts dans le domaine des tests de charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de s'engager dans leurs responsabilités directes et d'utiliser leur expérience unique pour construire le processus de test de charge, en choisissant une méthodologie, des mesures optimales et en écrivant des autotests en fonction des profils de charge, les ingénieurs doivent souvent déployer l'infrastructure de test à partir de zéro, configurer les outils de chargement et les intégrer. dans les systèmes CI, configurer la surveillance et la publication des rapports.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez trouver des solutions à certains problèmes d'organisation dans les tests que nous utilisons chez Positive Technologies dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un autre article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et je parlerai ici de la possibilité d’intégrer des tests de charge dans un pipeline CI commun en utilisant le concept de «test de charge en tant que service». </font><font style="vertical-align: inherit;">Vous apprendrez comment et quelles images Docker des sources de charge peuvent être utilisées dans le pipeline CI; </font><font style="vertical-align: inherit;">Comment connecter des sources de charge à votre projet CI à l'aide d'un modèle d'assemblage; </font><font style="vertical-align: inherit;">à quoi ressemble un tube de démonstration pour exécuter des tests de charge et publier des résultats. </font><font style="vertical-align: inherit;">Cet article peut être utile aux ingénieurs de test logiciel et aux ingénieurs d'automatisation de CI qui ont pensé à l'architecture de leur système de charge.</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essence du concept</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le concept de test de charge en tant que service implique la capacité d'intégrer les outils de charge Apache JMeter, Yandex.Tank et ses propres cadres dans un système d'intégration continue arbitraire. Une démonstration sera faite pour GitLab CI, mais les principes sont communs à tous les systèmes CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le test de charge en tant que service est un service centralisé pour effectuer des tests de charge. Les tests de charge sont exécutés dans des pools d'agents dédiés, les résultats sont publiés automatiquement dans GitLab Pages, Influx DB et Grafana ou dans les systèmes de rapports de test (TestRail, ReportPortal, etc.). L'automatisation et la mise à l'échelle sont réalisées aussi simplement que possible - en ajoutant et en paramétrant le modèle gitlab-ci.yml habituel dans le projet GitLab CI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'avantage de l'approche est que l'ensemble de l'infrastructure CI, les agents de charge, les images docker des sources de charge, les pipelines de test et la publication des rapports sont pris en charge par le service d'automatisation central (ingénieurs DevOps), et les ingénieurs de test de charge peuvent concentrer leurs efforts sur le développement de tests et l'analyse de leurs résultats, sans aborder les problèmes d'infrastructure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour simplifier la description, nous supposons que l'application ou le serveur de test cible est déjà déployé et configuré à l'avance (pour cela, des scripts automatisés en Python, SaltStack, Ansible, etc. peuvent être utilisés). Ensuite, tout le concept du stress testing en tant que service s'inscrit en trois étapes: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">préparation, test, publication des rapports</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Plus de détails sur le schéma (toutes les photos sont cliquables):</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/uc/no/nj/ucnonjamcikvuob-3njskwev-he.png"></a><br>
<br>
<h2>      </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors des tests de résistance, nous essayons d'adhérer aux </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normes et à la méthodologie de l'ISTQB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous utilisons la terminologie appropriée et les mesures recommandées. Je vais donner une courte liste de concepts de base et de définitions dans les tests de charge. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agent de chargement (agent de chargement)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la machine virtuelle sur laquelle l'application sera lancée - la source de la charge (Apache JMeter, Yandex.Tank ou module de chargement auto-écrit). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le but du test (cible)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un serveur ou une application installée sur le serveur qui sera soumis à une charge. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas de test (cas de test)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un ensemble d'étapes paramétrées: actions de l'utilisateur et réactions attendues à ces actions, avec demandes et réponses de réseau fixes, en fonction des paramètres spécifiés.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profil ou plan de charge (profil)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthodologie ISTQB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Section 4.2.4, p. 43), les profils de charge déterminent les métriques critiques pour un test particulier et les options pour changer les paramètres de charge pendant le test. Vous pouvez voir des exemples de profils sur la figure. </font><b><font style="vertical-align: inherit;">Test</font></b><font style="vertical-align: inherit;"> est un script avec un ensemble de paramètres prédéfinis. </font><b><font style="vertical-align: inherit;">Plan de</font></b><font style="vertical-align: inherit;"> test - suite de tests et profil de charge. </font><b><font style="vertical-align: inherit;">Testrun (testrun)</font></b><font style="vertical-align: inherit;"> - une itération d'exécution d'un test avec un scénario de charge entièrement exécuté et un rapport reçu. </font><b><font style="vertical-align: inherit;">Requête réseau (requête)</font></b><font style="vertical-align: inherit;"> - Une requête HTTP envoyée de l'agent à la cible. </font><b><font style="vertical-align: inherit;">Réponse du réseau (réponse)</font></b><font style="vertical-align: inherit;"> - Une réponse HTTP envoyée de la cible à l'agent.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/qm/iq/d5/qmiqd5egscabj6hrmlnufxnyv4m.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'état de réponse HTTP est un code de réponse standard du serveur d'applications. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transaction (transaction) - un cycle complet de «demande - réponse». </font><font style="vertical-align: inherit;">Une transaction est comptée depuis le début de l'envoi d'une demande (demande) jusqu'à la fin de la réception d'une réponse (réponse). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statut de transaction (statut de transaction)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - était-il possible de terminer avec succès le cycle "demande-réponse". </font><font style="vertical-align: inherit;">S'il y a eu une erreur dans cette boucle, alors la transaction entière est considérée comme infructueuse. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temps de réponse (latence)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - temps entre la fin de l'envoi d'une demande (demande) et le début de la réception d'une réponse (réponse). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Métriques de chargement (métriques)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - les caractéristiques du service chargé et de l'agent de chargement définies au cours du processus de test de charge.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesures de base pour mesurer les paramètres de charge</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesures</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les plus courantes et recommandées dans la méthodologie </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">ISTQB</font></a><font style="vertical-align: inherit;"> (p. 36, 52) sont présentées dans le tableau ci-dessous. </font><font style="vertical-align: inherit;">Des mesures similaires pour l'agent et la cible sont affichées sur la même ligne.</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Charger les métriques de l'agent</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesures du système cible ou de l'application testée sous charge</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nombre de&nbsp;&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vCPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de mémoire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - "repasser" les caractéristiques de l'agent de charge</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memory, Disk usage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la dynamique du chargement du processeur, de la mémoire et du disque </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pendant les tests. </font><font style="vertical-align: inherit;">Généralement mesuré en pourcentage des </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
valeurs maximales disponibles.</font></font></td>
</tr>
<tr>
<td><b>Network throughput</b> (on load agent) —   <br>
   , <br>
   . <br>
      (bps)</td>
<td><b>Network throughput</b>(on target) —     <br>
  .       (bps)</td>
</tr>
<tr>
<td><b>Virtual users</b>—   , <br>
    <br>
   </td>
<td><b>Virtual users status</b>, Passed/Failed/Total —    <br>
     <br>
  ,     .<br>
<br>
 ,      <br>
  ,    . <br>
   ,       <br>
      </td>
</tr>
<tr>
<td><b>Requests per second (minute)</b>—      ( ).<br>
<br>
   :     . <br>
       </td>
<td><b>Responses per second (minute)</b><br>
 —      ( ).<br>
<br>
   :   <br>
       <br>
 </td>
</tr>
<tr>
<td></td>
<td><b>HTTP responses status</b>—     <br>
  ,   . <br>
, 200 OK   , <br>
 404 —    </td>
</tr>
<tr>
<td></td>
<td><b>Latency</b> ( ) —    <br>
  (request)     (response). <br>
    (ms)</td>
</tr>
<tr>
<td></td>
<td><b>Transaction response time</b>—    , <br>
  « — ». <br>
      (request) <br>
    (response).<br>
<br>
      ( ) <br>
 :  , <br>
,  , , 90- . <br>
    —   <br>
  . <br>
    , <br>
    , <br>
     </td>
</tr>
<tr>
<td></td>
<td><b>Transactions per second (minute)</b> —   <br>
   (), <br>
       <br>
    . <br>
    </td>
</tr>
<tr>
<td></td>
<td><b>Transactions status</b> , Passed / Failed / Total —  <br>
,     .<br>
<br>
    <br>
    <br>
     </td>
</tr>
</tbody>
</table></div><br>
<h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le schéma de base des tests de charge est très simple et se compose de trois étapes principales, que j'ai déjà mentionnées: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Préparer - Tester - Rapport</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-à-dire préparer des objectifs de test et définir des paramètres pour les sources de charge, puis effectuer des tests de charge et, enfin, générer et publier un rapport sur les tests. </font><font style="vertical-align: inherit;">
Notes sur le schéma:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/o5/s5/z5/o5s5z5f79dpui3ojk5vbwgsayso.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QA.Tester - expert en stress tests,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target est l'application cible pour laquelle vous devez connaître son comportement sous charge.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classificateur des entités, étapes et étapes du diagramme</font></font></h2><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étapes et étapes</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que ce passe-t-il</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À l'entrée</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle est la sortie</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Préparer: phase de préparation des tests</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paramètres de charge</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Définition et initialisation </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
des </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
paramètres de charge </font><font style="vertical-align: inherit;">utilisateur </font><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sélection des métriques et </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
préparation d'un plan de test </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(profil de charge)</font></font></td>
<td>  <br>
  <br>
-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>VM</b></td>
<td>   <br>
   <br>
 </td>
<td>    <br>
   <br>
 </td>
<td>  <br>
 </td>
</tr>
<tr>
<td><b>Env</b></td>
<td>    <br>
  <br>
  </td>
<td>   <br>
 <br>
   <br>
 </td>
<td> : <br>
,   , <br>
   <br>
 </td>
</tr>
<tr>
<td><b>LoadAgents</b></td>
<td>,    <br>
 . <br>
  -  <br>
  </td>
<td>-   <br>
(, JM   )<br>
  <br>
 </td>
<td>   <br>
   <br>
</td>
</tr>
<tr>
<td colspan="4">Test:    .    ,       GitLab CI</td>
</tr>
<tr>
<td><b>Load</b></td>
<td>   <br>
  -<br>
   </td>
<td>  <br>
  <br>
 <br>
-<br>
 </td>
<td>  <br>
 <br>
 <br>
      </td>
</tr>
<tr>
<td><b>RunAgents</b></td>
<td>  <br>
   <br>
  <br>
  <br>
   <br>
  </td>
<td>-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>Logs</b></td>
<td> «»  <br>
   : <br>
    , <br>
   <br>
 ,    </td>
<td></td>
<td>  <br>
 <br>
 </td>
</tr>
<tr>
<td><b>Metrics</b></td>
<td> «»    </td>
<td></td>
<td>    <br>
  </td>
</tr>
<tr>
<td colspan="4">Report:     </td>
</tr>
<tr>
<td><b>Generator</b></td>
<td>  <br>
   <br>
  «» <br>
  <br>
   <br>
 , <br>
   <br>
</td>
<td>  <br>
 <br>
 <br>
   <br>
   </td>
<td> «»  <br>
 ,   <br>
   <br>
   ,<br>
   </td>
</tr>
<tr>
<td><b>Publish</b></td>
<td>  <br>
  <br>
   <br>
</td>
<td> «» <br>
  ,  <br>
    <br>
</td>
<td>   <br>
   <br>
,  <br>
  </td>
</tr>
</tbody>
</table></div><br>
<h2>    CI-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons à la partie pratique. Je veux montrer comment, sur certains projets de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive Technologies,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous avons mis en œuvre le concept de test de charge en tant que service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, avec l'aide de nos ingénieurs DevOps, nous avons créé un pool d'agents dédié dans GitLab CI pour exécuter des tests de charge. Afin de ne pas les confondre dans les modèles avec d'autres, tels que les pools d'assemblages, nous avons ajouté des balises à ces agents, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balises</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : load. Vous pouvez utiliser toutes les autres balises claires. Ils sont définis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lors de l'inscription des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coureurs GitLab CI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment connaître la puissance requise par le matériel? Les caractéristiques des agents de charge - une quantité suffisante de vCPU, de RAM et de disque - peuvent être calculées sur la base du fait que Docker, Python (pour Yandex.Tank), l'agent GitLab CI, Java (pour Apache JMeter) doivent être exécutés sur l'agent. Pour Java sous JMeter, il est également recommandé d'utiliser un minimum de 512 Mo de RAM et, comme limite supérieure, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80% de la mémoire disponible</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, sur la base de notre expérience, nous recommandons d'utiliser au moins 4 vCPU, 4 Go de RAM, 60 Go de SSD pour les agents de charge. La bande passante de la carte réseau est déterminée en fonction des exigences du profil de charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons principalement deux sources de charge - les images docker Apache JMeter et Yandex.Tank. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Il s'agit de l'outil open source de Yandex pour les tests de stress. Son architecture modulaire est basée sur le générateur de requêtes HTTP asynchrone à hautes performances basé sur les hits Phantom. Le réservoir a une surveillance intégrée des ressources du serveur testé en utilisant le protocole SSH, peut arrêter automatiquement le test selon les conditions données, peut produire les résultats à la fois sur la console et sous forme de graphiques, vous pouvez y connecter vos modules pour étendre les fonctionnalités. Soit dit en passant, nous avons utilisé Tank alors qu'il n'était pas encore courant. Dans l'article « </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank et automatisation des tests de charge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> », vous pouvez lire l'histoire de la façon dont, en 2013, nous l'avons utilisé pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">effectuer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des tests de charge de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">PT Appllication Firewall</font></a><font style="vertical-align: inherit;"> - l'un des produits de notre société. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache JMeter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est un outil open source pour effectuer des tests de résistance Apache. Il peut également être utilisé pour tester des applications Web statiques et dynamiques. JMeter prend en charge un grand nombre de protocoles et de façons d'interagir avec les applications: HTTP, HTTPS (Java, NodeJS, PHP, ASP.NET, etc.), les services Web SOAP / REST, FTP, TCP, LDAP, SMTP (S), POP3 (S ) et IMAP (S), des bases de données via JDBC, peuvent exécuter des commandes shell et travailler avec des objets Java. JMeter dispose d'un IDE pour créer, déboguer et exécuter des plans de test. Il existe également une CLI pour travailler sur la ligne de commande de tout système d'exploitation Java compatible (Linux, Windows, Mac OS X). L'outil peut générer dynamiquement un rapport de test HTML.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour faciliter l'utilisation au sein de notre entreprise, pour permettre aux testeurs de changer et d'ajouter l'environnement, nous avons créé des images de docker des sources de charge sur GitLab CI avec publication dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-register</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interne </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">sur Artifactory</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De cette façon, il s'avère plus rapide et plus facile de les connecter dans des pipelines pour les tests de charge. </font><font style="vertical-align: inherit;">Comment faire docker pousser le registre via GitLab CI - voir les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier docker de base pour Yandex.Tank nous avons pris ceci:</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM direvius/yandex-tank<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et pour Apache JMeter celui-ci:</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM vmarrazzo/jmeter<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez lire le fonctionnement de notre système d'intégration continue dans l'article « </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatisation des processus de développement: comment nous avons implémenté les idées DevOps dans les technologies positives</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ».</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modèle et pipeline</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple de modèle pour effectuer des tests de charge est disponible dans le projet de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">démonstration</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vous </font><font style="vertical-align: inherit;">pouvez lire les instructions d'utilisation du modèle </font><font style="vertical-align: inherit;">dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier Lisezmoi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans le modèle lui-même (le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier .gitlab-ci.yml</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), il y a des notes sur ce dont telle ou telle étape est responsable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le modèle est très simple et illustre les trois étapes du test de charge décrites ci-dessus dans le diagramme: préparation, test et publication des rapports. Responsable du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">répertoire des étapes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">préparation, test et rapport</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ol>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prepare</a>           .       ,     -    docker registry:       Test.         .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Test</a>     ,      .     : Yandex.Tank, Apache JMeter,    .         job-.     :<br>
 <ul>
<li>  Yandex.Tank    .<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">/tests/yandextank.sh</a>,</li>
<li>  Apache JMeter    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">./tests/jmeter.sh</a>.</li>
</ul><br>
:         CI-        .     ,    bash-.   ,       —    QA-.               .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">./tests</a>.<br>
 </li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Report</a>      ,    Test,   ,   GitLab Pages    .  GitLab Pages ,      ./public        index.html.     GitLab Pages    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>.<br>
<br>
,   : <ul>
<li> JMeter  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitLab Pages</a>,</li>
<li> Yandex.Tank  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InfluxDB  Grafana</a>.</li>
</ul><br>
   :<ul>
<li>HTML-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitLab Pages</a>,</li>
<li> InfluxDB    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grafana</a>.</li>
</ul></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un exemple de démonstration, un pipeline avec des tests de charge et deux sources de charge (vous pouvez désactiver inutiles) ressemble à ceci: </font><font style="vertical-align: inherit;">
Apache JMeter peut générer un rapport HTML lui-même, il est donc plus rentable de l'enregistrer dans les pages GitLab à l'aide d'outils standard. </font><font style="vertical-align: inherit;">Voici à quoi ressemble le rapport Apache JMeter: </font><font style="vertical-align: inherit;">
Dans la démo de Yandex.Tank, vous ne verrez qu'un </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">faux rapport de texte</font></a><font style="vertical-align: inherit;"> dans la section des pages GitLab. </font><font style="vertical-align: inherit;">Pendant les tests, le Tank est capable d'enregistrer les résultats dans la base de données InfluxDB, et à partir de là, ils peuvent être affichés, par exemple, dans Grafana (la configuration est effectuée dans le fichier </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">./tests/example-yandextank-test.yml</font></a><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Voici à quoi ressemble le rapport de Tank à Grafana:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/t6/0f/bx/t60fbxhrvwnju5mubzwmifhjmn0.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/fr/pl/pr/frplprdv1ns3obkqrpn2i4tgetu.png"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/a6/y9/zw/a6y9zw9ej6wcy_g5pk69s1ncrpa.png"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'article, j'ai parlé du concept de "test de charge en tant que service" (test de charge en tant que service). L'idée principale est d'utiliser l'infrastructure de pools préconfigurés d'agents de chargement, d'images Docker des sources de charge, de systèmes de reporting et d'un pipeline les unissant dans GitLab CI basé sur un simple modèle .gitlab-ci.yml (exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par référence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Tout cela est pris en charge par une petite équipe d'ingénieurs en automatisation et est reproduit à la demande des équipes de produits. J'espère que cela vous aidera à préparer et à mettre en œuvre un programme similaire dans votre entreprise. Merci de votre attention! </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS Je tiens à remercier chaleureusement mes collègues, Sergey Kurbanov et Nikolay Yusev, pour leur assistance technique à la mise en œuvre du concept de test de charge en tant que service dans notre entreprise. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auteur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timur Gilmullin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - député. </font><font style="vertical-align: inherit;">Responsable Technologie et Processus de Développement (DevOps), Technologies Positives</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr504264/index.html">Commentaire Huawei Review: commentez les publications Wi-Fi 6 et obtenez des prix</a></li>
<li><a href="../fr504270/index.html">Svelte est-il un bon choix pour la mise en œuvre de widgets?</a></li>
<li><a href="../fr504276/index.html">Top 10 des livres pour développeurs</a></li>
<li><a href="../fr504282/index.html">Création d'architecture d'entreprise dans NSPK</a></li>
<li><a href="../fr504284/index.html">Le livre «Pure Agile. Les bases de la flexibilité</a></li>
<li><a href="../fr504296/index.html">Génération de branches aléatoires en Python</a></li>
<li><a href="../fr504306/index.html">Comment le matériel russe est-il conçu pour le stockage Aerodisk Vostok sur Elbrus</a></li>
<li><a href="../fr504310/index.html">Dichotomie des données: repenser la relation avec les données et les services</a></li>
<li><a href="../fr504312/index.html">Registre unifié des programmes russes et de la GPL. Mes cinq cents</a></li>
<li><a href="../fr504314/index.html">Implémentation des commandes Docker Pull et Docker Push sans client Docker via des requêtes HTTP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>