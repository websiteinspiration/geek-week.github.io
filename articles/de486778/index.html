<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèæ üï∞Ô∏è üìã SSO zur Microservice-Architektur. Wir benutzen Keycloak. Teilenummer 1 ‚òùÔ∏è üë©‚Äç‚öñÔ∏è üëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In jedem gro√üen Unternehmen ist die X5 Retail Group keine Ausnahme, da die Anzahl der Projekte, f√ºr die eine Benutzerauthentifizierung erforderlich is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SSO zur Microservice-Architektur. Wir benutzen Keycloak. Teilenummer 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/486778/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In jedem gro√üen Unternehmen ist die X5 Retail Group keine Ausnahme, da die Anzahl der Projekte, f√ºr die eine Benutzerauthentifizierung erforderlich ist, mit zunehmender Anzahl der Projekte zunimmt. Im Laufe der Zeit ist ein nahtloser √úbergang von Benutzern von einer Anwendung zu einer anderen erforderlich, und dann muss ein Single-Sing-On (SSO) f√ºr einen einzelnen Server verwendet werden. Aber was ist, wenn Identit√§tsanbieter wie AD oder andere, die keine zus√§tzlichen Attribute haben, bereits in verschiedenen Projekten verwendet werden? Eine Klasse von Systemen, die als "Identit√§tsbroker" bezeichnet werden, wird zur Rettung kommen. Am funktionalsten sind seine Vertreter wie Keycloak, Gravitee Access Management usw. In den meisten F√§llen k√∂nnen Nutzungsszenarien unterschiedlich sein: Maschineninteraktion, Benutzerbeteiligung usw. Die L√∂sung muss flexible und skalierbare Funktionen unterst√ºtzen.In der Lage, alle Anforderungen in einem zu kombinieren, und eine solche L√∂sung in unserem Unternehmen ist jetzt ein Indikatorbroker - Keycloak.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/bi/eh/hmbiehmxsfcq_cfltz8xj0mhrgc.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak ist ein Open Source-Produkt zur Authentifizierung und Zugriffskontrolle, das von RedHat unterst√ºtzt wird. </font><font style="vertical-align: inherit;">Es ist die Basis f√ºr die Produkte des Unternehmens, die SSO - RH-SSO verwenden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundlegendes Konzept </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie sich mit Entscheidungen und Ans√§tzen befassen, sollten Sie die Begriffe und die Reihenfolge der Prozesse festlegen: Bei der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mm/j1/c2/mmj1c2uynwb23y5j4me13zzcrb4.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifizierung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird ein Subjekt anhand seiner Kennung erkannt (dh es wird ein Name, ein Login oder eine Nummer festgelegt). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Authentifizierung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Authentifizierungsverfahren (ein Benutzer wird mit einem Kennwort √ºberpr√ºft, ein Brief wird durch elektronische Signatur √ºberpr√ºft usw.). Die </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorisierung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist die Bereitstellung des Zugriffs auf eine Ressource (z. B. E-Mail).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keycloak Identity Broker</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keycloak</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine Open-Source-L√∂sung f√ºr das Identit√§ts- und Zugriffsmanagement, die f√ºr die Verwendung in ICs entwickelt wurde, in denen Mikroservice-Architekturmuster verwendet werden k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak bietet Funktionen wie Single Sign-On (SSO), Brokeridentifikation und Social Login, Benutzerverbund, Clientadapter, Administratorkonsole und Kontoverwaltungskonsole. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grundlegende Funktionen, die in Keycloak unterst√ºtzt werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single-Sign-On und Single-Sign-Out f√ºr browserbasierte Anwendungen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterst√ºtzung f√ºr OpenID / OAuth 2.0 / SAML.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identity Brokering - Authentifizierung mit externen OpenID Connect- oder SAML-Identit√§tsanbietern.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Social Login - Unterst√ºtzung f√ºr Google, GitHub, Facebook, Twitter zur Benutzeridentifikation.</font></font></li>
<li>User Federation ‚Äì    LDAP  Active Directory     .</li>
<li>Kerberos bridge ‚Äì  Kerberos     .</li>
<li>Admin Console ‚Äî         Web.</li>
<li>Account Management Console ‚Äì     .</li>
<li>      .</li>
<li>2FA Authentication ‚Äì  TOTP/HOTP   Google Authenticator  FreeOTP.</li>
<li>Login Flows ‚Äì   ,      .</li>
<li>Session Management ‚Äì        .</li>
<li>Token Mappers ‚Äì   ,       .</li>
<li>    realm, application  .</li>
<li>CORS Support ‚Äì      CORS.</li>
<li>Service Provider Interfaces (SPI) ‚Äì   SPI,      :  ,  ,     .</li>
<li>   JavaScript applications, WildFly, JBoss EAP, Fuse, Tomcat, Jetty, Spring.</li>
<li>    ,  OpenID Connect Relying Party library  SAML 2.0 Service Provider Library.</li>
<li>    plugins.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr CI / CD-Prozesse sowie f√ºr die Automatisierung von Verwaltungsprozessen in Keycloak kann die REST-API / JAVA-API verwendet werden. </font><font style="vertical-align: inherit;">Die Dokumentation ist in elektronischer Form verf√ºgbar: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REST API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/rest-api/index.html</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
JAVA API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.keycloak.org/docs-api/8.0/javadocs /index.html</font></font></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enterprise Identity Provider (vor Ort)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die M√∂glichkeit, Benutzer √ºber Benutzerverbunddienste zu authentifizieren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/s9/cl/8js9cl3cx9whnsshxcel0xynpqs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Pass-Through-Authentifizierung kann ebenfalls verwendet werden. Wenn sich Benutzer an Arbeitsstationen mit Kerberos (LDAP oder AD) authentifizieren, k√∂nnen sie automatisch in Keycloak authentifiziert werden, ohne ihren Benutzernamen und ihr Kennwort erneut angeben zu m√ºssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr die Authentifizierung und weitere Autorisierung von Benutzern kann ein relationales DBMS verwendet werden, das am besten f√ºr Entwicklungsumgebungen geeignet ist, da es keine langfristigen Einstellungen und Integrationen in den fr√ºhen Phasen von Projekten erfordert. Standardm√§√üig verwendet Keycloak ein integriertes DBMS zum Speichern von Einstellungen und Benutzerdaten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Liste der unterst√ºtzten DBMS ist umfangreich und umfasst: MS SQL, Oracle, PostgreSQL, MariaDB, Oracle und andere. </font><font style="vertical-align: inherit;">Die derzeit am meisten getesteten sind Oracle 12C Release1 RAC und Galera 3.12 Cluster f√ºr MariaDB 10.1.19.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identit√§tsanbieter - Social Login </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist m√∂glich, ein Login aus sozialen Netzwerken zu verwenden. </font><font style="vertical-align: inherit;">Um die Authentifizierung von Benutzern zu aktivieren, wird die Keycloack-Administratorkonsole verwendet. </font><font style="vertical-align: inherit;">√Ñnderungen am Anwendungscode sind nicht erforderlich. Diese Funktionalit√§t ist sofort verf√ºgbar und kann in jeder Phase des Projekts aktiviert werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bs/rj/vp/bsrjvpxnw7eojom-_bv816iwoxk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Authentifizierung von Benutzern k√∂nnen OpenID / SAML-Identit√§tsanbieter verwendet werden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typische Autorisierungsszenarien mit OAuth2 in Keycloak</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authorization Code Flow</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - wird bei serverseitigen Anwendungen verwendet. Eine der h√§ufigsten Arten von Berechtigungsberechtigungen, da sie sich gut f√ºr Serveranwendungen eignet, bei denen der Anwendungsquellcode und die Clientdaten f√ºr Au√üenstehende nicht zug√§nglich sind. Der Prozess basiert in diesem Fall auf der Umleitung. Die Anwendung sollte in der Lage sein, mit dem Benutzeragenten (Benutzeragenten), z. B. einem Webbrowser, zu interagieren, um API-Autorisierungscodes zu erhalten, die √ºber den Benutzeragenten umgeleitet werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impliziter Fluss</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - wird von Mobil- oder Webanwendungen verwendet (Anwendungen, die auf dem Ger√§t des Benutzers ausgef√ºhrt werden).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine implizite Art von Autorisierungsberechtigung wird von Mobil- und Webanwendungen verwendet, bei denen die Privatsph√§re des Kunden nicht garantiert werden kann. </font><font style="vertical-align: inherit;">Der implizite Berechtigungstyp verwendet auch die Benutzeragentenumleitung, und das Zugriffstoken wird zur weiteren Verwendung in der Anwendung an den Benutzeragenten √ºbergeben. </font><font style="vertical-align: inherit;">Dadurch wird das Token dem Benutzer und anderen Anwendungen auf dem Ger√§t des Benutzers zur Verf√ºgung gestellt. </font><font style="vertical-align: inherit;">Mit dieser Art von Autorisierungsberechtigung wird die Anwendung nicht authentifiziert, und der Prozess selbst basiert auf einer Umleitungs-URL (zuvor im Dienst registriert).</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implicit Flow unterst√ºtzt keine Aktualisierungstoken.
</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grant Flow f√ºr Client-Anmeldeinformationen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">Wird</font></b><font style="vertical-align: inherit;"> verwendet, wenn die Anwendung auf die API zugreift. </font><font style="vertical-align: inherit;">Diese Art der Autorisierungsberechtigung wird normalerweise f√ºr Server-zu-Server-Interaktionen verwendet, die ohne sofortige Benutzerinteraktion im Hintergrund ausgef√ºhrt werden m√ºssen. </font><font style="vertical-align: inherit;">Der Client-Anmeldeinformationsfluss erm√∂glicht es dem Webdienst (dem vertraulichen Client), seine eigenen Anmeldeinformationen zu verwenden, anstatt sich beim Aufrufen eines anderen Webdienstes als Benutzer f√ºr die Authentifizierung auszugeben. </font><font style="vertical-align: inherit;">F√ºr eine h√∂here Sicherheitsstufe kann der aufrufende Dienst ein Zertifikat (anstelle eines gemeinsamen Geheimnisses) als Anmeldeinformationen verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die OAuth2-Spezifikation ist in </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6749 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-8252 </font></font></a> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-6819 beschrieben</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JWT-Token und seine Vorteile</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JWT (JSON Web Token) ist ein offener Standard ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tools.ietf.org/html/rfc7519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), der eine kompakte und eigenst√§ndige Methode zum sicheren √úbertragen von Informationen zwischen Parteien als JSON-Objekt definiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gem√§√ü dem Standard besteht das Token aus drei Teilen im Basis-64-Format, die durch Punkte getrennt sind. </font><font style="vertical-align: inherit;">Der erste Teil hei√üt Header und enth√§lt den Tokentyp und den Namen des Hash-Algorithmus zum Abrufen einer digitalen Signatur. </font><font style="vertical-align: inherit;">Der zweite Teil speichert die grundlegenden Informationen (Benutzer, Attribute usw.). </font><font style="vertical-align: inherit;">Der dritte Teil ist eine digitale Signatur.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;codierter Header&gt;. &lt;codierte Nutzlast&gt;. &lt;Signatur&gt;</font></font></oembed><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speichern Sie niemals ein Token in Ihrer Datenbank. </font><font style="vertical-align: inherit;">Da ein g√ºltiges Token einem Kennwort entspricht, entspricht das Speichern eines Tokens dem Speichern eines Kennworts im Klartext.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Zugriffstoken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Token, das seinem Besitzer Zugriff auf die gesch√ºtzten Ressourcen des Servers gew√§hrt. </font><font style="vertical-align: inherit;">Normalerweise hat es eine kurze Lebensdauer und kann zus√§tzliche Informationen enthalten, z. B. die IP-Adresse der Partei, die dieses Token anfordert. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Aktualisierungstoken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Token, mit dem Clients nach Ablauf ihrer Lebensdauer neue Zugriffstoken anfordern k√∂nnen. </font><font style="vertical-align: inherit;">Diese Token werden normalerweise f√ºr einen langen Zeitraum ausgegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hauptvorteile der Anwendung in der Microservice-Architektur:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die M√∂glichkeit, √ºber eine einmalige Authentifizierung auf verschiedene Anwendungen und Dienste zuzugreifen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn im Benutzerprofil eine Reihe erforderlicher Attribute fehlen, k√∂nnen Daten angereichert werden, die der Nutzlast hinzugef√ºgt werden k√∂nnen, einschlie√ülich automatisierter und spontaner Daten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist nicht erforderlich, Informationen zu aktiven Sitzungen zu speichern. Die Serveranwendung sollte nur die Signatur √ºberpr√ºfen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flexiblere Zugriffskontrolle mit zus√§tzlichen Attributen in der Nutzlast.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Verwendung einer Tokensignatur f√ºr den Header und die Nutzdaten erh√∂ht die Sicherheit der gesamten L√∂sung.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JWT Token - Zusammensetzung</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Header</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Standardm√§√üig enth√§lt der Header nur den Token-Typ und den f√ºr die Verschl√ºsselung verwendeten Algorithmus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Token-Typ wird in der Taste "typ" gespeichert. </font><font style="vertical-align: inherit;">Die Taste "typ" wird im JWT ignoriert. </font><font style="vertical-align: inherit;">Wenn der Typschl√ºssel vorhanden ist, muss sein Wert JWT sein, um anzuzeigen, dass dieses Objekt ein JSON-Web-Token ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Alg-Schl√ºssel definiert den Algorithmus, der zum Verschl√ºsseln des Tokens verwendet wird. </font><font style="vertical-align: inherit;">Standardm√§√üig sollte HS256 eingestellt sein. </font><font style="vertical-align: inherit;">Der Header ist in base64 codiert.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "HS256", "typ": "JWT"}</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutzlast (Inhalt)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die Nutzlast speichert alle Informationen, die √ºberpr√ºft werden m√ºssen. </font><font style="vertical-align: inherit;">Jeder Schl√ºssel in der Nutzlast wird als "Anweisung" bezeichnet. </font><font style="vertical-align: inherit;">Beispielsweise kann die Bewerbung nur auf Einladung (geschlossene Promo) eingegeben werden. </font><font style="vertical-align: inherit;">Wenn wir jemanden zur Teilnahme einladen m√∂chten, senden wir ihm einen Einladungsbrief. </font><font style="vertical-align: inherit;">Es ist wichtig zu √ºberpr√ºfen, ob die E-Mail-Adresse der Person geh√∂rt, die die Einladung annimmt. Daher nehmen wir diese Adresse in die Nutzdaten auf. Dazu speichern wir sie im E-Mail-Schl√ºssel</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"email": "example@x5.ru"}
</font></font></oembed><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Schl√ºssel in der Nutzlast k√∂nnen beliebig sein. </font><font style="vertical-align: inherit;">Es gibt jedoch einige reservierte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iss (Aussteller) - definiert die Anwendung, von der das Token gesendet wird.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub (Betreff) - Definiert das Thema des Tokens.</font></font></li>
<li>aud (Audience) ‚Äì       URI,     .     JWT   ,        ‚Äî   .</li>
<li>exp (Expiration Time) ‚Äî ,     .  JWT ,           . Exp       unix .</li>
<li>nbf (Not Before) ‚Äî    unix ,  ,    .</li>
<li>iat (Issued At) ‚Äî     ,            JWT. iat       unix .</li>
<li>Jti (JWT ID) ‚Äî ,      c  .</li>
</ul><br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist wichtig zu verstehen, dass die Nutzdaten nicht in verschl√ºsselter Form √ºbertragen werden (obwohl Token eingebettet werden k√∂nnen und dann verschl√ºsselte Daten √ºbertragen werden k√∂nnen). </font><font style="vertical-align: inherit;">Daher ist es unm√∂glich, geheime Informationen darin zu speichern. </font><font style="vertical-align: inherit;">Wie der Header ist die Nutzlast in base64 codiert.</font></font></oembed><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signatur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wenn wir einen Header und eine Nutzlast haben, k√∂nnen wir die Signatur berechnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Base64-codiert: Header und Payload werden √ºbernommen und zu einer Linie durch einen Punkt zusammengefasst. </font><font style="vertical-align: inherit;">Diese Zeile und der geheime Schl√ºssel werden dann an die Eingabe des im Header angegebenen Verschl√ºsselungsalgorithmus gesendet (Schl√ºssel "alg"). </font><font style="vertical-align: inherit;">Der Schl√ºssel kann eine beliebige Zeichenfolge sein. </font><font style="vertical-align: inherit;">L√§ngere Saiten sind vorzuziehen, da die √úbereinstimmung l√§nger dauert.</font></font><br>
<br>
<oembed><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{"alg": "RSA1_5", "payload": "A128CBC-HS256"}</font></font></oembed><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keycloak-Failovercluster-Architektur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn f√ºr alle Projekte ein einziger Cluster verwendet wird, sind die Anforderungen an eine L√∂sung f√ºr SSO erh√∂ht. Wenn die Anzahl der Projekte gering ist, sind diese Anforderungen nicht f√ºr alle Projekte so sp√ºrbar, aber mit zunehmender Anzahl von Benutzern und Integrationen steigen die Anforderungen an Verf√ºgbarkeit und Produktivit√§t. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Erh√∂hen des Ausfallrisikos eines einzelnen SSO erh√∂ht die Anforderungen an die L√∂sungsarchitektur und die f√ºr die Komponentenredundanz verwendeten Methoden und f√ºhrt zu einer sehr engen SLA. In dieser Hinsicht verf√ºgen Projekte h√§ufiger bei der Entwicklung oder in der fr√ºhen Phase der Implementierung von L√∂sungen √ºber eine eigene nicht fehlertolerante Infrastruktur. W√§hrend Sie sich entwickeln, m√ºssen Sie die M√∂glichkeit der Entwicklung und Skalierung festlegen. Am flexibelsten ist es, einen Failovercluster mithilfe der Containervirtualisierung oder eines Hybridansatzes zu erstellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um in Aktiv / Aktiv- und Aktiv / Passiv-Clustern arbeiten zu k√∂nnen, muss die Datenkonsistenz in einer relationalen Datenbank sichergestellt werden. Beide Datenbankknoten m√ºssen synchron zwischen verschiedenen geoverteilten Rechenzentren repliziert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das einfachste Beispiel f√ºr eine ausfallsichere Installation. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/tw/7w/xotw7wkifwb3h6nnclvnjbbe72c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche Vorteile bietet die Verwendung eines einzelnen Clusters:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hohe Verf√ºgbarkeit und Leistung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterst√ºtzung f√ºr Betriebsarten: Aktiv / Aktiv, Aktiv / Passiv.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die F√§higkeit zur dynamischen Skalierung - bei Verwendung der Containervirtualisierung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√∂glichkeit der zentralen Verwaltung und √úberwachung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einheitlicher Ansatz zur Identifizierung / Authentifizierung / Autorisierung von Benutzern in Projekten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transparentere Interaktion zwischen verschiedenen Projekten ohne Beteiligung der Benutzer.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die M√∂glichkeit, das JWT-Token in verschiedenen Projekten wiederzuverwenden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein einziger Vertrauenspunkt.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnellerer Start von Projekten mithilfe von Microservices / Containervirtualisierung (keine zus√§tzlichen Komponenten m√ºssen ausgel√∂st und konfiguriert werden).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√∂glicherweise der Erwerb von kommerzieller Unterst√ºtzung durch den Anbieter. </font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dinge, die bei der Planung eines Clusters zu beachten sind</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keycloak verwendet ein DBMS-Verwaltungssystem zum Speichern: Bereiche, Clients, Benutzer usw. Es wird </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
eine Vielzahl von DBMS unterst√ºtzt: MS SQL, Oracle, MySQL, PostgreSQL. </font><font style="vertical-align: inherit;">Keycloak verf√ºgt √ºber eine eigene integrierte relationale Datenbank. </font><font style="vertical-align: inherit;">Die Verwendung f√ºr nicht geladene Umgebungen wie Entwicklungsumgebungen wird empfohlen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um in Aktiv / Aktiv- und Aktiv / Passiv-Clustern zu arbeiten, muss die Konsistenz der Daten in einer relationalen Datenbank sichergestellt werden, und beide Knoten des Datenbankclusters werden synchron zwischen den Rechenzentren repliziert.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verteilter Cache (Infinspan)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit der Cluster ordnungsgem√§√ü funktioniert, ist eine zus√§tzliche Synchronisierung der folgenden Cache-Typen mithilfe von JBoss Data Grid erforderlich: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Authentifizierungssitzungen - werden zum Speichern von Daten w√§hrend der Authentifizierung eines bestimmten Benutzers verwendet. </font><font style="vertical-align: inherit;">Anforderungen aus diesem Cache umfassen normalerweise nur den Browser und den Keycloak-Server, nicht die Anwendung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aktionstoken - werden f√ºr Szenarien verwendet, in denen der Benutzer die Aktion asynchron (per E-Mail) best√§tigen muss. </font><font style="vertical-align: inherit;">W√§hrend des Passwort-Streams zum Vergessen wird beispielsweise der Infinispan-Cache von actionTokens verwendet, um Metadaten zu verwandten Aktionsmarkierungen zu verfolgen, die bereits verwendet wurden, sodass sie nicht wiederverwendet werden k√∂nnen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zwischenspeichern und Ung√ºltigmachen persistenter Daten - wird zum Zwischenspeichern persistenter Daten verwendet, um unn√∂tige Datenbankabfragen zu vermeiden. </font><font style="vertical-align: inherit;">Wenn ein Keycloak-Server Daten aktualisiert, sollten dies allen anderen Keycloak-Servern in allen Rechenzentren bekannt sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arbeit - wird nur zum Senden von Ung√ºltigkeitsnachrichten zwischen Clusterknoten und Rechenzentren verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Benutzersitzungen - Dient zum Speichern von Daten zu Benutzersitzungen, die f√ºr die Browsersitzung eines Benutzers g√ºltig sind. </font><font style="vertical-align: inherit;">Der Cache muss HTTP-Anforderungen des Endbenutzers und der Anwendung verarbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brute-Force-Schutz - wird verwendet, um fehlgeschlagene Anmeldedaten zu verfolgen.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lastverteilung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Load Balancer ist ein einzelner Einstiegspunkt in Keycloak und sollte Sticky Sessions unterst√ºtzen. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendungsserver</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie werden verwendet, um die Interaktion von Komponenten untereinander zu steuern. Sie k√∂nnen mithilfe vorhandener Automatisierungstools und dynamischer Skalierung von Infrastrukturautomatisierungstools virtualisiert oder containerisiert werden. </font><font style="vertical-align: inherit;">Die h√§ufigsten Bereitstellungsszenarien in OpenShift, Kubernetes, Rancher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit ist der erste Teil - theoretisch - beendet. </font><font style="vertical-align: inherit;">In der folgenden Artikelserie werden Beispiele f√ºr Integrationen mit verschiedenen Identifikationsanbietern und Konfigurationsbeispiele diskutiert.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de486778/">https://habr.com/ru/post/de486778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486764/index.html">Do-it-yourself Schema.org: Anpassen des Mikrolayouts ohne Programmierer</a></li>
<li><a href="../de486766/index.html">Wie √ºbertrage ich alle Transaktionen online auf dem archaischen Factoring-Markt? Erfahrung mit Sberbank Factoring</a></li>
<li><a href="../de486768/index.html">√úberarbeitung des Webasyst-Administrationsbereichs</a></li>
<li><a href="../de486772/index.html">Brennen, aber nicht brennen - brennen, um zu gl√§nzen</a></li>
<li><a href="../de486776/index.html">Code-Vervollst√§ndigung und Typpr√ºfung f√ºr boto3</a></li>
<li><a href="../de486780/index.html">Frontend-Entwicklung im Unternehmen: Was es ist und wie es effektiv gemacht werden kann</a></li>
<li><a href="../de486782/index.html">UI / UX - Design. Trends und Prognosen f√ºr 2020</a></li>
<li><a href="../de486784/index.html">Die Lumiere-Br√ºder haben nie getr√§umt</a></li>
<li><a href="../de486788/index.html">Webinar ‚ÄûFern√ºberwachung und Ger√§tediagnose. Winnum CNC Solution Fallstudien ¬ª</a></li>
<li><a href="../de486790/index.html">Und wieder Qbot - eine neue Art von Banking-Trojanern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>