<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚫 🏩 🗑️ Gagnez du temps, des nerfs et des heures de travail ↙️ 💨 👨🏽‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos projets sont généralement régionaux et les clients, généralement des ministères. Mais, en plus du secteur public, des organisations privées utilis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Gagnez du temps, des nerfs et des heures de travail</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/barsgroup/blog/495942/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos projets sont généralement régionaux et les clients, généralement des ministères. </font><font style="vertical-align: inherit;">Mais, en plus du secteur public, des organisations privées utilisent également nos systèmes. </font><font style="vertical-align: inherit;">Il n'y a pratiquement aucun problème avec eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, les principaux projets sont régionaux, et parfois il y a des problèmes avec eux. </font><font style="vertical-align: inherit;">Par exemple, avec les performances, lorsque dans des régions à partir de 20 000, nos précieux utilisateurs sont dans la période de déploiement de nouvelles fonctionnalités sur les serveurs de produits. </font><font style="vertical-align: inherit;">C’est une douleur ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m’appelle Ruslan et je suis impliqué dans l’escorte des systèmes d’information du groupe BARS et dans le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">développement d’un robot tueur pour les DBAs en série brutaux</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le jeûne n'est pas pour les faibles de cœur - beaucoup de lettres et d'images.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_2/kf/av/_2kfavets7hbt3nwzvy_bd9mqos.jpeg"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ awr</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines de nos applications fonctionnent sur Oracle DBMS. Il y a des projets sur le SGBD PostgreSQL. Oracle a une chose merveilleuse - la collecte de statistiques sur la charge du SGBD, qui met en évidence les problèmes existants et donne même des recommandations pour l'élimination - Automatic Workload Repository (AWR). À un moment donné (à savoir, au moment de la douleur), les développeurs ont constamment demandé à collecter des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapports AWR pour l'analyse des performances</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Honnêtement, nous nous sommes rendus sur le serveur SGBD, avons collecté des rapports, nous les avons traînés et nous les avons envoyés pour analyse en production. Une fois après le 5, il a commencé à se fatiguer ... après le 10 - pour provoquer une irritation ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un jour, un de mes collègues a exprimé l'idée que tout ce qui est fait plus d'une fois devrait être automatisé. Jusqu'au moment de l'agacement, pour être honnête, je n'y ai pas pensé et j'ai essayé d'automatiser tout ce qui peut être automatisé, mais souvent ce n'était pas demandé et c'était plus une recherche qu'une application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis j'ai pensé: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Les administrateurs ne sont pas nécessaires pour générer un rapport ..."</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Après tout, collecter un rapport, c'est exécuter le script sql @ $ ORACLE_HOME / rdbms / admin / awrrpt.sql et récupérer le rapport du serveur à nous-mêmes ... Oh oui, nous ne laissons pas le développement aller en vente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, j'ai recherché les informations nécessaires sur Google, créé une fonction à partir de l'article sur une base de test, tiré le script et un miracle - le rapport a été collecté et il peut être enregistré localement. A créé des fonctions où les rapports AWR étaient souvent nécessaires, a expliqué aux développeurs comment l'utiliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À cette époque, pendant mon temps libre, après avoir parlé avec @BotFather, j'ai créé un bot Telegram pour moi, juste pour le plaisir. J'ai foiré une simple fonctionnalité là-bas - pour montrer l'heure actuelle, les taux de change, la météo, lui ai appris à envoyer des compliments à ma femme (alors une fille) selon un horaire. Peut-être qu'à ce moment-là, envoyer des compliments était la fonctionnalité la plus recherchée de mon bot, ma femme a apprécié.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc. Les développeurs nous écrivent dans Telegram, nous leur envoyons un rapport dans Telegram ... Mais que se passe-t-il s'ils ne nous écrivent pas, mais au bot? En effet, ce sera mieux pour tout le monde, le rapport sera reçu plus rapidement, et surtout, par nous. L'idée de la première fonctionnalité recherchée est donc née pour mon bot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai commencé la mise en œuvre. Je l'ai fait, comme je l'ai géré, en PHP (en fait notre application est en PHP, je le comprends plus qu'en Python). L'encodeur vient de moi, donc je ne montrerai pas mon code :) Le </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bot vit dans notre réseau d'entreprise, il a accès à certains projets, y compris les bases de données cibles. Afin de ne pas déranger les paramètres de la commande ou du menu, j'ai vissé cette fonctionnalité à un chat de groupe avec des notifications de surveillance. Le bot sait donc immédiatement sur quelle base de données collecter le rapport. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayant reçu une commande de la forme </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ awr N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, où N est le nombre d'heures complètes pour lesquelles un rapport est nécessaire (par défaut - 1 heure), même pendant une semaine, si la base de données ne redémarre pas, le bot commence immédiatement à travailler, collecte le rapport, le publie en tant que page Web et juste là (presque ici) donne un lien vers un rapport bien nécessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous suivons le lien et le voici, le rapport AWR: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/yr/tk/kiyrtktigm4qjsumovp2vl4roa0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme prévu, les développeurs ont fait face à cette génération de rapport, a même remercié quelqu'un. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayant apprécié la commodité de l'équipe, les chefs de projet des autres régions ont souhaité la même chose, car ils </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtiennent surtout du luli du client soucieux des</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performances et de la disponibilité des systèmes. Ajout d'un bot à d'autres chats. Ils l'utilisent toujours, et je m'en réjouis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus tard, des collègues du CIT ont écrit sur la façon dont nous collectons les rapports, ils le voulaient également. </font><font style="vertical-align: inherit;">Je ne les ai pas ajoutés à nos chats, j'ai créé un chat séparé avec la génération de rapports sur un planning et sur demande.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ pgBadger</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons d'autres applications en PHP en collaboration avec PostgreSQL. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implémentation de la collecte du rapport pgBadger pour ceux qui en ont besoin sur le même principe - dans les chats de groupe. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au début, ils l'ont utilisé, mais ils se sont arrêtés. </font><font style="vertical-align: inherit;">Découpe fonctionnelle inutile.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ devoir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre département, il y a des quarts de nuit et, en conséquence, il y a un horaire. </font><font style="vertical-align: inherit;">C'est dans google tables. </font><font style="vertical-align: inherit;">Il n'est pas toujours pratique de rechercher un lien, d'ouvrir un horaire, de chercher par vous-même ... Un des anciens collègues a également joué avec son bot Telegram et a introduit des </font><b><font style="vertical-align: inherit;">notifications sur le début d'un quart de travail pour les employés</font></b><font style="vertical-align: inherit;"> du département dans le chat de notre département </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le bot analyse le programme, détermine le préposé par la date du jour et, selon le programme ou sur demande, indique qui est en service aujourd'hui. </font><font style="vertical-align: inherit;">Cela s'est avéré super, confortable. </font><font style="vertical-align: inherit;">C'est vrai, je n'ai pas vraiment aimé le format du message. </font><font style="vertical-align: inherit;">De plus, pour les employés d'un autre service (par exemple, le centre d'affaires «Médecine»), les informations sur le service dans d'autres domaines ne sont pas vraiment nécessaires, mais vous devez savoir qui est de service en «Médecine» en cas de problème. </font><font style="vertical-align: inherit;">J'ai décidé «d'emprunter» la fonctionnalité, mais de changer ce que je n'aimais pas. </font><font style="vertical-align: inherit;">J'ai créé un format de message pratique pour moi et pour les autres, en supprimant les informations redondantes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ tnls</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après le «test de plume» de l'automatisation via le bot Telegram, de nombreuses idées différentes sont apparues, mais je voulais faire les choses strictement nécessaires. J'ai décidé de tenir des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statistiques sur les appels.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour accéder aux projets de nos clients, nous avons mis en place ce que l'on appelle le «serveur hop» ou le serveur de transfert. Des connexions VPN y sont établies, puis via ssh, des ports d'application, des bases de données et d'autres sondes auxiliaires sont transmis à notre réseau local pour faciliter l'accès aux projets de nos employés, sans problèmes avec les connexions VPN. Il suffit de configurer une connexion VPN à notre réseau d'entreprise.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les statistiques d'appels suggèrent que souvent, après la chute d'un des tunnels (en cas de problème de réseau, par timeout par exemple), ils se retournent pour rétablir l'accès au projet. </font><font style="vertical-align: inherit;">Dans la plupart des cas, il suffit de redémarrer la connexion et tout se passe bien. </font><font style="vertical-align: inherit;">Faisons-le vous-même. </font><font style="vertical-align: inherit;">Voici la commande: </font></font><br>
<img src="https://habrastorage.org/webt/pq/th/ad/pqthadwkyi0tegqd7tn2qzrpxws.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
« Fall par » à l'élément de menu souhaité, sélectionnez votre projet, attendez une minute et tout le </font><font style="vertical-align: inherit;">monde est heureux et satisfait ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand une commande est reçue, par un léger mouvement de </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> octets et les </font><font style="vertical-align: inherit;">bits, les connecte bot au serveur de transfert, sachant à l' </font><font style="vertical-align: inherit;">avance les besoins d'expédition à redémarrer, et fait son travail - rétablit la connexion au projet. </font><font style="vertical-align: inherit;">J'ai écrit des instructions pour résoudre ces problèmes par moi-même. </font><font style="vertical-align: inherit;">Et nous n'avons été contactés que si l'outil fourni ne fonctionne pas ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ ecp_to_pem</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, les statistiques ont montré qu'il est souvent nécessaire de convertir la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signature numérique Crypto Pro au format pem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base64</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) pour diverses intégrations, et nous en avons beaucoup. Tâche: vous prenez le conteneur, le copiez sur un ordinateur Windows avec l'utilitaire P12FromGostCSP installé (soit dit en passant, payé), le convertissez en pfx et convertissez pfx en utilisant OpenSSL (avec prise en charge du cryptage GOST) en pem. Pas très pratique, mais je le veux au clic d'un doigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google est à nouveau venu à la rescousse. Trouvé l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilité d'une personne aimable</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Recueilli, comme écrit dans le fichier README - gagné. Il a appris au bot à travailler avec l'utilitaire et a obtenu une conversion presque instantanée.</font></font><br>
<img src="https://habrastorage.org/webt/aq/qo/yu/aqqoyu8qmwsrjbske46acai6bie.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au moment de la mise en œuvre finale, un ordre a été émis pour passer à un nouveau format de cryptage - gost-2012. </font><font style="vertical-align: inherit;">Pour autant que je m'en souvienne, l'utilitaire à ce moment-là ne fonctionnait qu'avec l'ancien GOST (2001), c'était peut-être généralement un autre utilitaire similaire d'une autre bonne personne, je ne me souviens pas exactement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après la transition vers le nouveau GOST, la fonctionnalité du bot a été supprimée pour des raisons de sécurité. </font><font style="vertical-align: inherit;">L'implémenté dans un conteneur Docker.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerfile, qui a soudainement besoin de:</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">FROM ubuntu:16.04                                                                                                                                                                        <font></font>
RUN apt update &amp;&amp; apt -y install git sudo wget unzip gcc g++ make &amp;&amp; \                       <font></font>
   cd /srv/ &amp;&amp; git clone https://github.com/kov-serg/get-cpcert.git &amp;&amp; \                    <font></font>
   cd get-cpcert &amp;&amp; chmod +x *.sh &amp;&amp; ./prepare.sh &amp;&amp; ./build.sh &amp;&amp; \                        <font></font>
   mkdir -p /srv/{in,out} &amp;&amp; \                                                              <font></font>
   echo '#!/bin/bash' &gt; /srv/getpem.sh &amp;&amp; \                                                 <font></font>
   echo 'cd /srv/get-cpcert' &gt;&gt; /srv/getpem.sh &amp;&amp; \                                         <font></font>
   echo './get-cpcert /srv/in/$CONT.000 $PASS &gt; /srv/out/$CONT.pem' &gt;&gt; /srv/getpem.sh &amp;&amp; \  <font></font>
   chmod +x /srv/getpem.sh                                                                  ENTRYPOINT /srv/getpem.sh</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour convertir, vous devez placer le conteneur source (un répertoire de la forme xxx.000) dans le répertoire / srv / in et récupérer le pem fini dans / srv / out. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Convertir:</font></font><br>
<br>
<pre><code class="plaintext hljs"> docker run -t -i -e CONT='&lt;   ( ".000")&gt;' -e PASS='&lt;  &gt;' -v /srv/in:/srv/in -v /srv/out:/srv/out --name ecptopem &lt;  &gt;/med/ecptopem:latest </code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ emstop et / emstart</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois, notre entreprise a obtenu un DBA Oracle très cool, avec plus d'expérience dans l'administration du SGBD et dans le développement. Et cela ne s'est pas produit tout de suite avec une connexion ssh aux serveurs SGBD: soit il ne sait pas où se connecter et comment, alors les accès ne sont pas clairement décrits, il est impossible de se transmettre quelque chose. Eh bien, nous sommes heureux de vous aider, avons parlé de la façon de vous connecter et avons transmis Enterprise Manager pour cela. Mais avec ssh, cela n'a toujours pas fonctionné. L'un des collègues l'a expliqué simplement: pur-sang DBA :) Nous avons décidé que si nous devions resserrer quelque chose sur le serveur, nous le ferions nous-mêmes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EM se bloque sous une charge lourde et le redémarre ... vous devez vous connecter via ssh et redémarrer via le terminal. </font><font style="vertical-align: inherit;">"Les administrateurs le savent bien", a décidé notre nouveau collègue. </font><font style="vertical-align: inherit;">Les charges importantes sur le SGBD ne sont pas rares chez nous, les demandes de redémarrage EM sont également fréquentes. </font><font style="vertical-align: inherit;">Puis le même scénario: tension, irritation et recherche d'une solution au problème. </font><font style="vertical-align: inherit;">Ainsi, dans le même groupe de discussions, la commande: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ emstop et / emstart est apparue.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/kk/yd/8j/kkyd8jikdyflvrkkoqvyens8dym.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ tuer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cas de forte concurrence à la base, et cela arrive parfois, vous devez décharger rapidement la base de données. </font><font style="vertical-align: inherit;">Le moyen le plus rapide est de tuer le processus problématique ... Pour ce faire, connectez-vous via ssh, kill -9 ... Le bot vous aidera! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jb/8q/cs/jb8qcsft8ce6jp5e7rijqtvcjti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alexey a apprécié l'équipe et lui a donné un nom affectueux - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Kilyalka»</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou un pistolet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois, après avoir vu comment Alex essaye et souffre, chaque fois que vous entrez / tuez xxx pour chacun des processus, j'ai décidé d'ajouter du «multilatéralisme» à notre arme: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5d/sc/kh/5dsckh_3qe5lhmvhop1pmxkt1hk.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c'est mieux! </font><font style="vertical-align: inherit;">Tout pour toi, Alex, travaille juste, mon cher! </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturellement, l'accès à une commande aussi importante était limité </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par user_id - "protection contre le fou".</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voyant comment Lesha clouait intelligemment les processus sur le serveur de base de données, plusieurs personnes ont essayé d'entrer une commande avec un numéro de processus aléatoire, mais vous ne pouvez pas tromper mon robot intelligent, il a immédiatement refusé.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ alertlog </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, juste au cas où, j'aurais fait une commande: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ alertlog &lt;nombre de lignes&gt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - obtenir le nombre spécifié de lignes alertlog'a Le </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bot extrait alertlog et l'envoie à notre service, tel que pastebin, appelé pyste, et envoie un lien vers la pâte pour le chat de demande.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ chèques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puis vint une demande de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">surveillance des performances réelles de notre application.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jusqu'à présent, le support technique du projet a collecté ces données à la main. Pas une affaire! Nos vaillants testeurs ont développé des cas de test pour cela. Le journal de test résultant n'est pas très pratique à lire, un utilisateur inexpérimenté comprendra longtemps et non le fait qu'il mettra en évidence les informations nécessaires. Et nous n'aimons pas faire de nos mains ce que nous ne pouvons pas faire de nos mains ... Une nouvelle tâche pour le bot! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/--/u6/1l/--u61ld0yk0fljkwuerjn3g8zsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La commande / checks affiche un menu simple et sans ambiguïté, cette fois, nos gars ont appris à utiliser cette commande sans instructions! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous sélectionnez l'élément souhaité, au lieu du menu, une notification apparaît sur le début du test afin que les utilisateurs impatients n'exécutent pas notre test 100500 fois:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/xv/sv/j7xvsv_byo8gdw7y3qweig15msq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fonction de l'élément de menu sélectionné, un test spécifique est lancé depuis notre réseau, à savoir depuis la machine où réside le bot (jmeter y est pré-configuré, les tests nécessaires sont placés ...) ou immédiatement depuis le centre de données (depuis la machine préparée à côté de l'application), de sorte que lors du test éliminez les retards du réseau, ou minimisez-les. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir terminé le test et reçu le journal, le bot l'analyse et affiche le résultat sous une forme «lisible par l'homme»:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7w/xp/s8/7wxps8jupg80bbq_uuywyz1-gag.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collection de métriques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonctionnalité est «entrée» et les chefs de projet qui le souhaitent ont reçu une telle fonction pour leurs régions. Et un chef de projet compatissant a déclaré: "Je veux avoir des statistiques à temps!" Quelqu'un du CIT lui a dit qu'il serait pratique de surveiller tout cela dans Zabbix. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbix, donc Zabbix ... J'ai</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
pensé qu'il fallait se préparer à la nécessité de dupliquer la solution ... J'ai conçu l'idée dans un conteneur docker. Dans le conteneur, selon le calendrier (toutes les 10 minutes), jmeter est lancé, ajoute le journal à un endroit spécifique, php le parse et affiche les données nécessaires sous la forme d'une page Web. Zabbix utilise la clé web.page.get pour obtenir cette page, sélectionne régulièrement les données nécessaires pour certains éléments dépendants et construit un graphique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/aq/cd/oqaqcdqj2mjodianmnwmrucyix8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que ce ne soit pas mal. </font><font style="vertical-align: inherit;">En observant le graphique, nous voyons tout d'abord la vitesse approximative de l'application, et si des pics sont détectés sur le graphique, nous savons à peu près où se trouve le «bouchon». </font><font style="vertical-align: inherit;">Tout est simple. </font><font style="vertical-align: inherit;">Jusqu'à présent, il s'est avéré être en demande uniquement pour une région, mais je suis prêt à le reproduire pour ceux qui le souhaitent.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Développement d'applications</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas si longtemps, des statistiques sur des tâches du même type ont donné des idées pour simplifier et faciliter le travail. Sur certains projets, sur les serveurs d'applications, il est nécessaire d'installer les conteneurs de clés de Crypto Pro, ils sont nombreux et la signature numérique expirera avec le temps. Parfois, 2 tâches «volent» par jour. Mais j'ai considéré que l'utilisation du bot à ces fins n'était pas sûre et j'ai décidé de faire la fonctionnalité directement dans l'application. Naturellement avec autorisation et contrôle d'accès. Si vous disposez des privilèges nécessaires, un élément de menu supplémentaire sera disponible pour travailler avec les signatures numériques, l'installation, la suppression, l'affichage des informations, etc. ... Pour le moment, la fonctionnalité est en cours de développement. Il s'est avéré que ce n'est pas très difficile, vous devez lire un peu les instructions, regarder des exemples de code, demander à des collègues plus expérimentés en développement, et c'est parti.Au cours de la recherche, des idées sont apparues pour être ajoutées à la demande. Je ne construirai pas de plans napoléoniens - il y a du développement, laissez chacun faire ce qu'il veut. Mais pour l'instant c'est intéressant - je le fais moi-même.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des plans</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit, de nombreuses idées différentes sont nées pour utiliser notre bot et pas seulement - en général, disons, des idées de «points d'automatisation», beaucoup d'entre elles ont été oubliées, car je n'ai pas eu le temps de les écrire. </font><font style="vertical-align: inherit;">Maintenant, j'essaie d'écrire tout ce qui me vient à l'esprit et je recommande aux autres de faire de même. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais Alex n'oublie pas de jeter sa Wishlist. </font><font style="vertical-align: inherit;">Parmi ces derniers: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ kill_sql SQL_ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tue toutes les sessions avec une telle requête SQL_ID </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ kill_block</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tue la session de blocage racine </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ show_em</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - montre une image de performance EM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trick, veut </font><b><font style="vertical-align: inherit;">assembler</font></b><font style="vertical-align: inherit;"> DBA depuis le téléphone =) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ainsi que nous travaillons pour le bien de la patrie! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et comment vous épargnez-vous des tâches routinières et inintéressantes?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espère que la lecture s'est avérée intéressante, et peut-être même utile à quelqu'un, et je n'ai pas réussi à fatiguer le lecteur ... Bonne chance à nous tous.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495924/index.html">Pourquoi est-il si difficile de construire un bon modèle de distribution COVID-19?</a></li>
<li><a href="../fr495926/index.html">Nous écrivons le firmware pour TI cc2530 sur Z-Stack 3.0 pour relais Zigbee Sonoff BASICZBR3 avec capteur ds18b20</a></li>
<li><a href="../fr495932/index.html">Quelle est la signification cachée des auteurs dans le guide SCRUM. Partie 1. À propos du processus</a></li>
<li><a href="../fr495934/index.html">Gouvernance des données à domicile</a></li>
<li><a href="../fr495938/index.html">Une sélection d'articles sur l'apprentissage automatique: cas, guides et études pour mars 2020</a></li>
<li><a href="../fr495944/index.html">Mise à jour du TOP50 (classement des supercalculateurs CIS): dynamique et tendances</a></li>
<li><a href="../fr495946/index.html">Norbert Wiener: le père distrait de la cybernétique</a></li>
<li><a href="../fr495948/index.html">Rouille intégrée. Développement pour les processeurs Cortex-M3 utilisant la carte de débogage STM32F103C8T6 (Black Pill)</a></li>
<li><a href="../fr495954/index.html">Comment Cisco fonctionne-t-il en mode d'accès à distance et dans un périmètre absent depuis 20 ans?</a></li>
<li><a href="../fr495956/index.html">Faut que vous y allez rapidement. Optimisation des demandes de contenu de messagerie IMAP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>