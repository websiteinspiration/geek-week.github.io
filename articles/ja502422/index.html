<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😸 👨🏽‍🤝‍👨🏻 🧑🏾‍🤝‍🧑🏽 いくつかの簡単な手順でReact Nativeアプリケーションのサイズを60％削減 📅 ⛰️ 👨‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ミューチュアルで働いています。彼女はブラジルで、同等の信用の分野で働いています。私たちは借り手と貸し手が互いにつながるのを助けます。前者は良い賭けを求め、後者は市場がそれらを提供できるものを超える収入を求めます。当社の製品は幅広いユーザーに使用されており、大きな国で働いています。その結果、React...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>いくつかの簡単な手順でReact Nativeアプリケーションのサイズを60％削減</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/502422/"><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミューチュアルで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">働いてい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">彼女はブラジルで、同等の信用の分野で働いています。</font><font style="vertical-align: inherit;">私たちは借り手と貸し手が互いにつながるのを助けます。</font><font style="vertical-align: inherit;">前者は良い賭けを求め、後者は市場がそれらを提供できるものを超える収入を求めます。</font><font style="vertical-align: inherit;">当社の製品は幅広いユーザーに使用されており、大きな国で働いています。</font><font style="vertical-align: inherit;">その結果、React NativeベースのiOSおよびAndroidアプリは、非常に異なるデバイスにダウンロードされます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/59/3g/lf/593glf1nnlud4u0pbaogbghegiy.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーの大部分がアプリケーションを低価格のデバイスにインストールすることに注意してください。</font><font style="vertical-align: inherit;">Facebookの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">デバイス年クラス</font></a><font style="vertical-align: inherit;">ライブラリのデータを使用して、このような結論を導き出すことができます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">デバイスのモデルに関する情報を受け取ったこのライブラリは、このデバイスが高級フラッグシップフォンと見なされる年を報告します。</font><font style="vertical-align: inherit;">たとえば、ユーザーの間で最も人気のある電話はSamsung Galaxy A10です。</font><font style="vertical-align: inherit;">この電話は、2019年にリリースされましたが、2013年にのみフラグシップと見なすことができました。ユーザーデバイスのデータを分析すると、これらのデバイスの85％が2015年以前にのみハイエンドデバイスとして認識されたと言えます。</font><font style="vertical-align: inherit;">このため、モバイルアプリケーションを最適化するための特別な要件があります。</font><font style="vertical-align: inherit;">最適化の目標は、デバイスが弱いユーザーでも快適にアプリケーションを使用できるようにすることです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/e6b/cf3/1e2e6bcf354e0ed85e47f70b1570dbba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定の年にフラグシップとして認識される可能性のあるデバイスの割合</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この点で、アプリケーションのサイズに細心の注意を払いました。 Android版の場合は26.8MB。これはそれほど大きなサイズではありませんが、ユーザーのアプリケーションの中央サイズを超えることは間違いありません。この数字は、Google Play Consoleによれば、16.3 MBです。アプリケーションのサイズは、料金プランが限られているユーザーや、メモリデバイスが少ないユーザーにとって決定的な要素となり、ユーザーはインストールするアプリケーションを慎重に選択する必要があります。その結果、一部のアプリケーションをアンインストールする必要があります。借り手はこのアプリケーションを通じて毎月の分割払いを支払うので、これは相互アプリケーションの場合に特に重要です。借り手が私たちのアプリケーションをアンインストールするとき、彼が時間通りに支払いをする可能性は大幅に減少します。そして、これは私たちのプラットフォームを使用する投資家の収益に直接影響します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/cea/78e/72ccea78ee7c05e86b626c0cf6ea45ef.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相互アプリケーションのサイズは、ユーザーの</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
アプリケーションの</font><i><font color="#999999"><font style="vertical-align: inherit;">中央サイズよりもはるかに大きく、</font></font></i><font style="vertical-align: inherit;">アプリケーションのサイズはアンインストールのレベルに影響するだけではありません。サイズは、アプリケーション設定の変換率にも影響します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここだ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Google Playのチームによって書かれた本には良い記事が。この記事では、アプリケーションサイズの重要性について説明します。特に、APKファイルのサイズが6 MB増えるごとに、インストールの変換率が1％減少すると言われています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らはまた、予算のデバイスが標準である発展途上国では、この効果はさらに強いという事実について話します。つまり、新興市場でAPKファイルのサイズを10 MB削減すると、インストールの変換率が約2.5％増加します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/624/15d/1c162415de7e88ff4c5ed89853b6483b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまな国でAPKファイルのサイズを削減する10 Mbごとにインストールの変換率を上げる（Googleの内部データによると）</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
アプリケーションのサイズを縮小すると、アンインストールのレベルとアプリケーション設定の変換率にどのように影響するかということに非常に動機付けられました。</font><font style="vertical-align: inherit;">その結果、ユーザーの利便性を考慮して、可能な限りアプリケーションのサイズを縮小することを目的とした作業に着手しました。</font><font style="vertical-align: inherit;">このプロジェクトの最初のステップは</font><font style="vertical-align: inherit;">、Android開発者に対するGoogle</font><font style="vertical-align: inherit;">の公式</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推奨事項</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を分析する</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">こと</font></a><font style="vertical-align: inherit;">でした。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android App Bundle</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
推奨事項を読んで、アプリケーションのサイズを削減する最も簡単な方法は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android App Bundle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（AAB）</font><font style="vertical-align: inherit;">と呼ばれる新しいアプリケーション配布方法を使用することであることを学びました</font><font style="vertical-align: inherit;">。この時まで、アプリケーションを配布し、</font><font style="vertical-align: inherit;">ほとんどのAndroidデバイスで実行できる</font><font style="vertical-align: inherit;">古き良き</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Androidパッケージ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（APK）</font><font style="vertical-align: inherit;">ファイルを収集</font><font style="vertical-align: inherit;">して、Google Play Consoleにアップロードしました。ただし、AABバンドルには、コンパイルされたコードとリソースのみが含まれています。その結果、Googleはダウンロード時に、仕様とCPUアーキテクチャを考慮して、さまざまなタイプのデバイス用に最適化されたAPKファイルを生成する責任があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトのビルドプロセスに簡単な変更を加えることで、これ以上の努力をせずにアプリケーションのサイズを大幅に削減できることがわかりました。これは真実には良すぎる！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドキュメントを読んだ後、React Native Gradleビルドスクリプトを変更して、現在のスクリプトの代わりに</font></font><code>assembleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行できる</font><font style="vertical-align: inherit;">ようにしました</font></font><code>bundleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これで、AABファイルを作成することができました。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Playstore</font></a><font style="vertical-align: inherit;">へ</font><font style="vertical-align: inherit;">のマテリアルの直接アップロードに関して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Fastlane</font></a></font><code>supply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成に</font><font style="vertical-align: inherit;">いくつかの変更を加えた後</font><font style="vertical-align: inherit;">、AABに切り替え、アプリケーションの新しいバージョンがGoogle Play Consoleに表示されました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この変更だけで、ユーザーのデバイスに転送されるAPKファイルのサイズが縮小されました。減少の範囲は9.1〜12.4 Mbでした。結局のところ、Android App Bundleの使用は、実際にアプリケーションのサイズを削減できる効果的な手法です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/feb/57b/9e5feb57bf54450425a6dc54da48f613.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古いAPKファイルと新しいAABバンドルを使用すると、さまざまなデバイスでのアプリケーションのサイズが14.4〜17.7 MB</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Trueになる可能性があるため、注意が必要です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hermes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">React Nativeを使用する場合</font><font style="vertical-align: inherit;">、依存関係を更新する必要がある場合があります</font></font><code>soloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（詳細は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を参照</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">そうしないと、重大なエラーを含むアプリケーションをユーザーに提供するリスクがあります。</font><font style="vertical-align: inherit;">幸運なことに、プロジェクトのアルファリリースのテスト中にこの問題を特定することができました。</font><font style="vertical-align: inherit;">ただし、ローカルテスト中やAPKファイルのビルド中には表示されないため、エラーは本番環境に簡単に入り込む可能性があります。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Androidサイズアナライザーを使用したアプリケーションリソースの最適化</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドキュメントで見つかったアプリケーションを最適化するための次の提案は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Androidサイズアナライザーの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用でした</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、Androidアプリケーションを分析し、サイズを小さくする方法を探すコマンドラインツールです。</font><font style="vertical-align: inherit;">このツールは、次の形式のコマンドを使用して起動しました。</font></font><br>
<br>
<pre><code class="javascript hljs">size-analyzer check-bundle [BUNDLE].aab
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、最適化できる優れたアプリケーションリソースと画像のリストを取得しました。</font><font style="vertical-align: inherit;">ProGuardのセットアップも推奨されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/a26/0b0/ed0a260b0a19878cf664c53ec54c9026.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズ分析レポート</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ProGuard</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProGuardは、Javaバイトコードを圧縮、難読化、最適化するためのツールです。</font><font style="vertical-align: inherit;">一部のAndroidライブラリと互換性がない可能性があることを知ったため、このツールを使用する可能性についてはまだ検討していません。</font><font style="vertical-align: inherit;">アプリケーションのサイズをできる限り早く小さくし、これをできるだけ簡単にするために努力したため、この最適化方法は将来的に残すことにしました。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app大規模なアプリリソース</font></font></font></h3><br><font style="vertical-align: inherit;"></font><code>size-analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーを使用し</font><font style="vertical-align: inherit;">
て</font><font style="vertical-align: inherit;">もう一度</font><font style="vertical-align: inherit;">実行する</font><font style="vertical-align: inherit;">と、</font></font><code>-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズでソートされたアプリケーションリソースのリストが表示されます。</font><font style="vertical-align: inherit;">このツールは、ユーザーがアプリケーションをどのように操作するかについて正確に何も知らないため、削除するリソースとアプリケーションに動的にロードするリソースを個別に決定する機会を与えてくれました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/d84/262/900d84262161b1440fe03e0d8b0d4fab.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズでソートされた大きなアプリケーションリソースの</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
リストこのリストの最初で最大のリソースは、React Native JavaScriptバンドルでした。</font><font style="vertical-align: inherit;">このバンドルを分割して動的にロードすることはできません。</font><font style="vertical-align: inherit;">しかし、後でそれについて考えます。</font><font style="vertical-align: inherit;">リストのさらに下には、大きなフォントファイル（TTF）と画像ファイル（JPGおよびPNG）があります。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍不要な画像</font></font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storybookで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
使用されている巨大なJPG画像にすぐに注意が向けられました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このシステムを使用して、コンポーネントを開発およびテストします。</font><font style="vertical-align: inherit;">これは、プロジェクトの製品版に含まれる2 MBのゴミです。</font><font style="vertical-align: inherit;">恥ずべき間違い！</font><font style="vertical-align: inherit;">このようなことが起こったとき、私たちは深刻な愚かさをやったような気がします。</font><font style="vertical-align: inherit;">しかし、ソフトウェア開発の複雑な世界では、誰もが間違いを犯します。</font><font style="vertical-align: inherit;">私はあなたがあなたの間違いについて公に話すなら、他の開発者がこれらの間違いから学ぶのを助けると信じています。</font><font style="vertical-align: inherit;">サイズが徐々に大きくなっているアプリケーションのリソース構造を分析しないと、同じミスをする可能性があります。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍フォント</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不要な画像をすばやく削除した後、リソースリストの他の要素の分析に進みました。多くの組み込みフォントが含まれていることは明らかでした。これについてデザイナーと話し合ったところ、古いコンポーネントの多くは活版印刷のマニュアルに厳密に準拠していることで違いはないと語られました。したがって、削除できるコンポーネント、および適切な更新済みフォントを使用できるコンポーネントがわかりました。これにより、使用するフォントを6本から4本に減らすことができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが気づいたもう1つのことは、フォントファイル自体のサイズです。それぞれのサイズは約670 Kbでした。これは、非圧縮バンドルの4つのフォントが驚くほどの2.7 Mbを占めることを意味します。しかし、幸いなことに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FontForge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">呼ばれるツール</font><font style="vertical-align: inherit;">を使用して、フォントファイルを深く分析および変更できます。このツールを使用して、フォントファイルのサイズが大きい主な理由は、拡張キリル文字と不要なグリフであることがわかりました。アプリケーションのテキスト部分は完全にポルトガル語で書かれているので、これをすべて安全に削除できます。この変更のおかげで、フォントファイルのサイズを670 Kbから70 Kbに90％削減することができました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d0/144/f9c/7d0144f9c3954dee6570347075fbe392.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォントに含まれる一部のグリフの例</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
不要なフォントを削除して残りのフォントを最適化したため、アプリケーションのサイズを3.8 Mb削減できました。</font><font style="vertical-align: inherit;">これにより、APKファイルの合計サイズが2 MB減少しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/62c/a55/52b62ca55ea0178919421a1c08304adc.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化前のフォントとそのサイズのリスト</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83e/374/6db/83e3746db754c475501170c6e4372c49.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化後のフォントとそのサイズのリスト</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images画像の最適化</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションにまだ残っている画像を分析した後、それらのいくつかは非常に大きいことに気付きました。</font><font style="vertical-align: inherit;">これらの画像のいくつかを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TinyPNG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グラフィック最適化</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ツールで</font></a><font style="vertical-align: inherit;">処理したところ、これらの画像</font><font style="vertical-align: inherit;">のサイズが大幅に縮小されました。</font><font style="vertical-align: inherit;">その後、アプリケーションで使用されるすべてのJPGおよびPNG画像を最適化することを決定しました。</font><font style="vertical-align: inherit;">それらの41がありました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/8e9/9e6/aa58e99e6307077787f37d0d60fc59db.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化前後の画像</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これにより、画像のサイズを2.5 MBから756 KBに、つまり70％削減する機会が得られました。</font><font style="vertical-align: inherit;">ただし、画像は以前に最適化されていなかったため、最終的なAPKファイルの作成中に圧縮されました。</font><font style="vertical-align: inherit;">私たちの最適化により、ユーザーがダウンロードしたアプリケーションのサイズが500 KBだけ減少したことがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、私たちはすでに迅速な最適化のすべての可能性を使い果たしていることに気付きました。</font><font style="vertical-align: inherit;">リソースの最適化を継続するには、多大な努力またはわずかな改善のみが必要です。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React Native JavaScript Bundle Optimization</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Androidプラットフォームに固有のアプリケーションリソースを見つけたら、JavaScriptバンドルを分析します。</font><font style="vertical-align: inherit;">バンドルの最適化は、3つの理由から良いアイデアと考えることができます。</font><font style="vertical-align: inherit;">まず、完成したAPKファイルのサイズを縮小します。</font><font style="vertical-align: inherit;">次に、JS仮想マシンはより少ないコードを処理する必要があるため、これによりアプリケーションの起動が速くなります。</font><font style="vertical-align: inherit;">最後に、そして最も重要なこととして、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodePush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して週に数回行うOTA更新を高速化します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍バンドルアナライザーとコードの最適化</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バンドルのサイズを小さくする方法を決定するには、まず、バンドルで最も多く使用されているものを把握する必要がありました。これを行うために、優れたオープンソースツールの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react-native-bundle-visualizer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しました</font><font style="vertical-align: inherit;">。その助けを借りてプロジェクトを分析した後、対応するエンティティのサイズを示す、すべてのフォルダーとすべてのアプリケーションの依存関係が存在する視覚化を得ました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f2/641/4c0/7f26414c02bec1a7cf7bcd6b901fb837.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を</font><i><font color="#999999"><font style="vertical-align: inherit;">示す、相互アプリケーションのフロントエンドのコードベースのライブラリとフォルダーのスナップショット</font></font></i><font style="vertical-align: inherit;">バンドルの合計サイズは5.49 Mbであることがわかりました。このボリュームの57.8％はフォルダーからの依存関係</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、27.5％-アプリケーションコードで</font><font style="vertical-align: inherit;">表され</font><font style="vertical-align: inherit;">ます。残りは、私たちが使用したツールを特定できませんでした。バンドルのアセンブリプロセス中に、未使用のコードはすでに削除されているため、アプリケーションで実際に使用されているコードが表示されました。しかし、これを考慮しても、バンドルでは常に改善できるものが見つかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの最大の依存関係は</font></font><code>math.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。このライブラリは、その名前が示すように、多くの数学演算を実装しています。サーバーですべての重要な計算を実行し、その後、結果をアプリケーションに送信するだけなので、このライブラリは特に必要ありません。アプリケーションコードを見ると、ライブラリはいくつかの単純な操作を実行するためだけに使用されていることがわかりました。これは、習慣のためにサーバーコードに取り組んだ開発者によって使用された可能性が高いです。ライブラリから適切なメソッドをすばやく抽出してコードベースに組み込み、この依存関係を完全に取り除きました。これにより、バンドルのサイズを4.64 Mbに減らすことができました。ライブラリを1つだけ拒否すると、バンドルのサイズを15.5％削減できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、ストーリーブックを使用してコンポーネントを開発およびテストします。確かに、対応する機能はローカル環境と中間環境でのみ使用できる必要があります。エンドユーザーはこれを必要としません。このおかげで、変数を使用して</font></font><code>ENVIRONMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アプリケーションの対応する部分の包含を制御しました。これはアクセスを制限するのに適していますが、バンドラーはこの変数に書き込まれる値を知ることができません。この制限により、すべてのStorybookコードが製品バンドルに含まれました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を修正するために、このセクションのインポートを単一のファイルに分離しました。次に、このファイルの2つのバージョンを作成しました。1つはStorybookを含み、もう1つはコンポーネントレイアウトのみを含むプロダクション用です。バンドルの本番バージョンを準備するときにこれらのファイルを切り替えるために、プロジェクトがビルドされる前に実行されるスクリプトを記述して、ファイルを別のファイルに変更しました。この方法のおかげで、アプリケーションの本番バージョンからStorybookコードを完全に削除</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でき、Storybookの「ストーリー」の構成に関する</font><font style="vertical-align: inherit;">依存関係</font><font style="vertical-align: inherit;">と通常のコードの</font><font style="vertical-align: inherit;">両方を削除</font><font style="vertical-align: inherit;">できました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/4cc/276/9964cc2769a8a23b3b18d5b0d273cfd9.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つのバージョンのインデックスファイルでStorybookフォルダーを更新しました。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これらの2つの変更により、バンドルサイズが5.49 MBから4.2 MBに減少しました。</font><font style="vertical-align: inherit;">これは、特に、アプリケーションの読み込みと更新が高速になることを意味します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/06f/f53/03406ff53c8a918119c9febd41e6d752.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終的なバンドルのサイズは4.2 MBでした。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これらすべての改善を行った後、アプリケーションを再びPlayストアにダウンロードしました。</font><font style="vertical-align: inherit;">これで、完成したAPKファイルのサイズが10.5〜13.7 Mbの範囲になることが通知されました。</font><font style="vertical-align: inherit;">これは、アプリケーションのサイズが元々26.8 MBであったという事実を考えると、プロジェクトサイズが約60％大幅に削減されたことを意味します。</font><font style="vertical-align: inherit;">したがって、Google Playチームの記事で述べたように、インストールのコンバージョン率は3.75％増加することを十分に期待できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/715/69e/cec/71569ececb25a15225a48cef54bfb254.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションの元のAPKバージョンと、上記のすべての改善が行われた最終的なAABバージョンとの比較</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、ビジネス指向のプログラマーとして、プロジェクトをより迅速に開発するために、場合によっては、企業の技術的負債が増えることを知っています。</font><font style="vertical-align: inherit;">これは、市場で自分の場所を見つけようとしているMutualのような若いスタートアップに特に当てはまります。</font><font style="vertical-align: inherit;">しかし、この負債を守らないと、2 MBのテストイメージを本番環境に送信したり、巨大なライブラリを不当に使用したりするなど、迷惑な間違いをする可能性があります。</font><font style="vertical-align: inherit;">技術的負債が暴走してトラブルを引き起こすことは許されるべきではない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、開発者は、プロジェクトを最適化するために利用できる機会を単に逃してしまうことがよくあります。</font><font style="vertical-align: inherit;">したがって、プロジェクトを批判的に分析することが推奨される場合があります。</font><font style="vertical-align: inherit;">アプリケーションのサイズ、速度、またはその他の側面をすばやく最適化する機会を逃したかどうかを確認するだけです。</font><font style="vertical-align: inherit;">アプリケーションを分析して作業を計画し、プロジェクトを改善するのに2日しかかかりませんでした。これにより、アプリケーションのサイズを60％削減することができました。</font><font style="vertical-align: inherit;">このような短時間で同じ結果が得られるものを思いつくのは困難です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React Nativeプロジェクトをどのように最適化しますか？</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja502412/index.html">別の方法でギョーシェ</a></li>
<li><a href="../ja502414/index.html">FOSSニュースNo. 16-2020年5月11〜17日の無料およびオープンソースソフトウェアのレビュー</a></li>
<li><a href="../ja502416/index.html">SQLを補完します。パート1.構文解析の複雑さ。ANTLRファイルのファイナライズに関するストーリー</a></li>
<li><a href="../ja502418/index.html">3D画像モニター</a></li>
<li><a href="../ja502420/index.html">Twitterのデザインで興味深いCSSが見つかりました</a></li>
<li><a href="../ja502424/index.html">JavaScriptパッケージ全体のインポートを停止する</a></li>
<li><a href="../ja502428/index.html">構文のグッズジュリア</a></li>
<li><a href="../ja502430/index.html">Kubernetesのベストプラクティス。準備テストと活性テストを備えたKubernetes実行可能性テスト</a></li>
<li><a href="../ja502432/index.html">先週のフロントエンドの世界からの新鮮な食材のダイジェストNo. 415（2020年5月11日〜17日）</a></li>
<li><a href="../ja502436/index.html">CI TeamCity-AndroidおよびUIテストのビルドプロセスの自動化</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>