<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏾 🎿 👩🏻‍⚕️ Windows 10とキーボードの例を使ったPCの操作について、その1 🤾🏽 👨‍👨‍👦 👨‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私の名前はAndrey Artemyevです。以前はMicrosoftでWindows 10のコアを担当していました。以前はWindows 10x（WCOS）、XBox、Windows Phone、Microsoft Edgeを担当していました。教育目的のために、キーボード入力とWindows 10...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Windows 10とキーボードの例を使ったPCの操作について、その1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483330/"><img src="https://habrastorage.org/getpro/habr/post_images/6ed/cc5/03a/6edcc503a335a1fab1c8f9c5d3e8c970.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の名前はAndrey Artemyevです。以前はMicrosoftでWindows 10のコアを担当していました。以前はWindows 10x（WCOS）、XBox、Windows Phone、Microsoft Edgeを担当していました。</font><font style="vertical-align: inherit;">教育目的のために、キーボード入力とWindows 10の例でコンピューターがどのように機能するかについてお話ししたいと思います。このシリーズの記事は、主に技術専門の学生を対象としています。</font><font style="vertical-align: inherit;">キーボードから押されたキーに関する情報がNotepad.exeに表示されるパスを検討します。</font><font style="vertical-align: inherit;">トピックの広大さと学際性のため、コメントに報告されている記事に不正確な点があるかもしれません。</font><font style="vertical-align: inherit;">Windowsの開発速度により、一部の情報は古くなっている可能性があります。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トピックの深さはどれくらいですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、コンピュータを検討できるレベルについて説明します。</font><font style="vertical-align: inherit;">各レベルは前のレベルに基づいています。</font><font style="vertical-align: inherit;">上から始めましょう。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションレベル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すべてのユーザーアプリケーションはここにあります。これは、ブラウザー、Microsoft Office、メモ帳、IIS Webサーバー、SQL Server、Javaや.Netなどのさまざまなミドルウェア、およびRuby、PHP、Batファイルなどのすべてのスクリプト言語です。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オペレーティングシステムレベル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">OSは次のように考えることができます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースマネージャー-メモリ、ハードドライブ、プリンター、画面、キーボード、コンピューターで実行されているプログラムによって共有される限られたリソース。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシン-ファイルは仮想オブジェクトの良い例です。</font><font style="vertical-align: inherit;">これは、ディスク上のデータの抽象化、それを操作するためのAPIを表し、アクセス権の概念も追加します。</font><font style="vertical-align: inherit;">ファイルの代わりに、データコンテナーと完全に異なるAPIの概念が存在する可能性があります。</font><font style="vertical-align: inherit;">OSにはそのような仮想オブジェクトが多数あります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォーム-OSは、プログラムを構築するためのソフトウェアモデルとプリミティブを提供します。</font><font style="vertical-align: inherit;">たとえば、Windows Drivers Frameworkを使用すると、ドライバーをすばやく開発できます。Windowsのウィンドウは、複雑なユーザーインターフェイスを構築するために使用されます。</font><font style="vertical-align: inherit;">Dll-プラグインを介してプログラムの機能を拡張するためのモデルと、キーボードトラップを介してスクリーンリーダーを実装するためのメカニズムを提供します（LowLevelKeyboardフックを参照）。</font></font></li>
</ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オペレーティングシステムは、レイヤーとコンポーネントに分かれています。</font><font style="vertical-align: inherit;">一般的に、Windows 10のアーキテクチャは次のようになります。</font><font style="vertical-align: inherit;">これについては、後で詳しく説明します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0d/c49/012/d0dc490125573433c187c4626a37349c.png" alt="画像"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンピュータアーキテクチャレベル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、特定のフォームファクターを備えたマザーボード、チップセットと呼ばれるマイクロ回路にエンコードされた組み込み関数、およびグラフィックカード、ネットワークカード、追加のランダムアクセスメモリ（RAM）、ハードドライブ、キーボードなどを接続することでコンピューターの機能を拡張できるポートで表されます。ポートは、1秒あたり数千のリクエストを処理するサーバー、インターネットを使用するタブレット、または複数のビデオカードを備えたゲーム用PCのいずれであっても、コンピューターの速度と機能に影響を与え、コンピューターの目的を決定します。 OSはマザーボードの機能を抽象化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロ回路は下の図のように見え、キーボードからデータを読み取ってさらに転送し、最終的にプロセッサに到達するなど、低レベルのタスクのための単純なプログラムを実行するミニコンピューターです。原則として、それらはCでプログラム可能なアナログのプログラム不可能なマイクロ回路またはマイクロコントローラーとして実装されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af4/8eb/3d2/af48eb3d2a8789c05baa1e2d73332336.png" alt="画像"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マザーボードは、バスを介して相互に通信し、それらを介して、接続されたデバイスからプロセッサに、またはその逆にデータを循環させるマイクロ回路のコロニーと見なすことができます。チップセットは一種のコンピューター神経系です。マザーボード上のすべてのチップは、元々互いに動作するように作成されていました。それらの一部には、タイマーやBIOS設定の保存などの特別な機能がある場合があります。おそらくそれらの中で最も重要なのは、電力が供給されるとすぐに実行を開始する組み込みプログラム（ファームウェア、BIOS、UEFI）を備えたプログラムでしょう。彼女は、Windowsブートローダーを備えたハードドライブを見つけ、それに制御を移します。これにより、OS実行可能ファイルが起動されます。これは、Windows10.exe、実際にはNtOsKrnl.exeと呼ばれます。 BIOSは、ハードウェアの製造元とオペレーティングシステムの間の合意により、何を探すべきかを認識しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マザーボードの周りに、携帯電話、ゲームコンソール、サーバーステーション、またはスマートデバイスを組み立てることができます。下の写真は、マザーボードの一般的なフォームファクタです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1c/bed/c41/a1cbedc411a37a00ca6d50df0f425b1b.png" alt="画像"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロアーキテクチャレベル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はプロセッサ（CPU）で表されます。これはマザーボードの心臓部であり、CPUにサービスを提供するにはチップセット全体が必要です。プロセッサはコンピュータ内のコンピュータであり、スレッドスケジューラがプロセッサのコンテキストを変更したときにコマンドのフローがオンザフライで行われるため、ファームウェアを必要としない、より強力で高度なマイクロコントローラです。プロセッサの機能は、サブシステムに分割されます。たとえば、数学および論理演算に関与するコンポーネント、数学コプロセッサ、キャッシュなどです。以前はマザーボード上の別のチップでしたが、現在では割り込みコントローラーやノースブリッジと呼ばれるチップなど、CPUの一部になっているため、処理速度が向上しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロ</font><i><font style="vertical-align: inherit;">アーキテクチャーはアーキテクチャー</font></i><font style="vertical-align: inherit;">と同じではありません</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 CPUのすべての機能は、連携して動作するコンポーネントに分かれています。これらのコンポーネントとそれらの相互作用はマイクロアーキテクチャです。以下のフローチャートでは、色付きの長方形と正方形で表されています。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><img src="https://habrastorage.org/getpro/habr/post_images/c95/f4a/6ad/c95f4a6add0ecc6be595adac8c068da0.png" alt="画像" width="130"></td>
<td><img src="https://habrastorage.org/getpro/habr/post_images/866/180/258/8661802584a5b7ebdef171036825c5b0.png" alt="画像" align="right"></td>
</tr>
</tbody></table></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロセッサアーキテクチャ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は基本的に、たとえばモバイルデバイスで使用されるx86、x64、またはARMアーキテクチャに対応するために必要な機能を説明するドキュメントです。このドキュメントでは、サポートする必要のあるコマンド、レジスタ割り当て、および操作ロジックについて説明します。 Intel、AMD、Elbrusプロセッサの作成者は、この機能を好きなように実装し、コマンド、レジスタ、フラグ、割り込みの形式で新しい機能を追加できます。OSがそれらを認識している場合は、それを使用できます。 OOPに関しては、CPUアーキテクチャーがインターフェースであり、マイクロアーキテクチャーがその実装です。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">論理</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 CPUブロック図の色付きの長方形は、0と1のシーケンスで演算を実行する論理回路で構成されています。プロセッサはすべてのデータと命令をビット形式（0と1）で認識します。式によれば、10進数は0と1のシーケンスとして表すことができますが、特定の数値の意味はコンテキストによって異なります。コード、数字、文字を使用できます。算術論理演算装置（ALU）は、ビットごとの演算によって2つの数値を加算できます。加算、減算、乗算、除算のビットごとのアルゴリズムは古くから知られており、論理回路の開発者はそれらを効果的に実装するだけで済みます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a97/b4e/902/a97b4e90250616f49a642ab9dcc31107.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デジタル回路はゼロと1のレベルでデータを処理しますが、アナログ回路は物理法則の利用に依存しています。シフト、AND、OR、XORなどの単純なビット操作を実行します。これらのプリミティブにより、より複雑な操作が実装されます。以下の図は、トランジスタを介して実装されたアナログAND演算子を示しています。回路の出力では、ゼロ以外の電圧は、両方の入力接点（Bx1とBx2）にある場合にのみ存在し、それ以外の場合はゼロボルトです。 C＃の&amp;&amp;演算子も同じように機能します。デジタル回路は、最終的にはアナログに基づいています。論理回路の物理的論理要素は、電子的だけでなく、機械的、油圧的、光学的、その他の方法でも実装できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06e/4b7/36c/06e4b736c6362af773f5e5a87f19c08a.png" alt="画像"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放射性元素のレベル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。物理的にアナログの回路は、物理法則を実際に利用する無線要素に依存しています。主にこれらは半導体です。特定の条件下では、電気を伝導する場合と伝導しない場合があります。ダイオードは電流を一方向にのみ伝導します。はんだ付けされていない場合、180度回転し、はんだ付けされると、電流は流れません。トランジスタは、制御レッグに電圧がある場合にのみ電流を流します。人類はトランジスタを微細化することを学んだので、何百万という小さなボードに配置することができます。下の写真では、半導体ラジオ要素と、電子顕微鏡下でナノトランジスタの隣にある従来のトランジスタを示しています。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><div style="text-align:center;"><img src="https://habrastorage.org/webt/n-/ux/k5/n-uxk5c1ocjoowqllgwa6rcpt8a.png" alt="画像"></div><br>
</td>
<td><img src="https://habrastorage.org/getpro/habr/post_images/892/7e0/8e2/8927e08e29467115b932c7593f85bbb3.png" alt="画像"><br>
</td>
</tr>
</tbody></table></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理法則のレベル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして最後に、最低レベルは、半導体無線要素に含まれる物理法則のレベルです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c99/65c/2a9/c9965c2a920dbcc67b4280d1c49dcefa.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OSレベルについて多く話し、コンピュータアーキテクチャ、マイクロアーキテクチャ、アナログ回路、および無線要素については少し話します。</font><font style="vertical-align: inherit;">最後の部分については、これがどのように連携するかを理解している必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オペレーティングシステムの基本</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが大学でアセンブリ言語に行ったとき、多くの学生が「カーネルとユーザーモード」などの巧妙な言葉からだまされていました。その下では、非常に有名なロール認証システムがすべての下に隠されており、すべてのサイトに少なくとも「管理者」がアクセスできます。すべてのページと「ユーザー」はアクセスが制限されています。同様に、「コア」の役割はCPUのすべての機能にアクセスでき、「ユーザー」の役割はすべてのプロセッサコマンドおよびすべての引数を持たない場合があります。このロールモデルに加えて、オペレーティングシステムはクライアント/サーバーアーキテクチャの原則に基づいて構築されています。サーバーはOSの機能を実装するコアであり、クライアントはユーザープログラムです。 Webの世界では、クライアントとサーバーは物理的に分離されています。これらは、ネットワークを介して通信する2つの異なるコンピューターです。OSでは、クライアントとサーバーは同じマシンと同じハードウェアにあります。サーバーには、顧客がその状態を変更できる特定のAPIがあります。たとえば、Twitter APIを使用すると、投稿を作成してログインし、ツイートフィードをモバイルクライアントにアップロードできます。 WindowsにはWin APIがあり、タスクの範囲が広いので面倒ですが、現在、Windowsには約330,000のAPIとUWPアプリ用のAPIがあります。 Twitterのコンセプトが投稿、ユーザー、フィードなど、だれにでもだいぶわかりづらい場合、OSのコンセプトは、その内部をいくらか深くする必要があるかもしれません。したがって、Windows APIは、OSの内部構造を理解しないと理解しにくい場合があります。タスクの範囲が広いので面倒ですが、今日のWindowsには約33万のAPIとUWPアプリ用のAPIがあります。 Twitterのコンセプトが投稿、ユーザー、フィードなど、だれにでもだいぶわかりづらい場合、OSのコンセプトは、その内部をいくらか深くする必要があるかもしれません。したがって、Windows APIは、OSの内部構造を理解しないと理解しにくい場合があります。タスクの範囲が広いので面倒ですが、今日のWindowsには約33万のAPIとUWPアプリ用のAPIがあります。 Twitterのコンセプトが投稿、ユーザー、フィードなど、だれにでもだいぶわかりづらい場合、OSのコンセプトは、その内部をいくらか深くする必要があるかもしれません。したがって、Windows APIは、OSの内部構造を理解しないと理解しにくい場合があります。</font></font><br>
<br>
<i>        .     .        ,    ,  ,  ,      (Kernel)        — CSRSS.exe (Windows), PSXSS.exe (POSIX), OS2SS.exe (OS/2)  WSL (Windows SubSystem for Linux).       —   .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画面にウィンドウが表示されると、このウィンドウを説明するデータ構造がOSのサーバー部分（カーネルモード）に表示されます。これは、画面上の位置、サイズ、タイトルテキスト、OSがアプリケーションにイベントへの応答を許可するウィンドウ機能です。</font><font style="vertical-align: inherit;">OSには多くのサブシステムが存在するため、1つのオブジェクトを説明する複数のデータ構造が存在する可能性があります。たとえば、ユーザープロセスに関する情報はコンポーネントにあります。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executive</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -OSのロジックです。</font><font style="vertical-align: inherit;">このレイヤーは、プロセスが実行できることと実行できないことを確認します。</font><font style="vertical-align: inherit;">このファイルには、親プロセス、プロセス開始パラメーター（プロセス環境ブロック）、関連するユーザーアカウント、プロセスexeファイルの名前に関する情報が含まれています。</font></font></li>
<li><i>Kernel</i> —    ,    .           ,      ,    .</li>
<li><i>Windowing subsystem</i> —   GDI       .     , pen  .</li>
<li><i>DirectX </i> —      DirectX: , , DX-,   GPU,    .</li>
<li><i> Windows</i>    CSRSS.exe (Client Server Runtime SubSystem). Windows    POSIX ( PSXSS.exe)  OS/2 (OS2SS.exe).        Windows   ,         CSRSS.exe   win32k.sys,       — win32k.sys, win32kbase.sys  win32kfull.sys.     Process Group Data, Shutdown level, Session Data  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのOSからプログラムを転送するには、ソースコードを見つけて特別な方法で再コンパイルし、OS APIへのすべての呼び出しがPSXdll.dll（NETAPI.DLLおよびOS / 2のDOSCALLS.DLLおよびWindowsアプリケーションのUser32.dll）。これは、Windows APIの薄いラッパーでした。一部のAPIの状態は、PSXSS.exeサブシステム（OS2SS.exe）のプロセスで保存されました。すべてのAPIを1対1にマップできるわけではないため、このようなプログラムは不安定に動作しました。 LinuxサポートはWindows 10で追加され、まったく異なる方法で機能します。 Linuxサブシステムはカーネルモードでホストされ、LinuxのWindowsサブシステムとLinuxの違いは、異なるビルド間とほぼ同じです。特にWSLでは、PICOプロセスという新しいタイプのプロセスが導入されました。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントとは何ですか？</font><font style="vertical-align: inherit;">これは論理的にグループ化された機能です。</font><font style="vertical-align: inherit;">コンポーネントは、OOPクラス、dll、フォルダー、共通の接頭辞、名前空間、アーキテクチャー内のレイヤーを持つ関数のセットと呼ぶことができます。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントとサーバーのパーティショニングの詳細</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントとサーバーの分離は、CPUの組み込み機能、メモリ共有、ソフトウェアチェックを使用して実装されます。 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
機器メーカーはOS開発者と協力しているため、プロセッサにはオペレーティングシステムの作成者のニーズを考慮して作成されたメカニズムがあります。最近のすべてのプロセッサには、ユーザーが現在実行可能なコードとして理解されるユーザーロールメカニズムが実装されています。 Webアプリケーションでは、ログインユーザーの役割は変数に格納され、明確な名前のAdminまたはUserに加えて、この役割のIDを持ちます。これは、文字列よりも数値を比較する方が速くて簡単であるため、認証時によく使用されます。プロセッサでは、現在のユーザーの役割は、「CurrentUser.Role.Id」ではなく、「セキュリティリング」と呼ばれるフィールドに保存されます。ほとんどのプロセッサでは、このフィールドは0から3までの4つの値を取ります。Windowsは「カーネルモード」と呼ばれる役割に0を使用します。なぜなら、これは最も特権的なモードであり、「ユーザーモード」の役割にとって最大の価値であり、最も限定的な役割だからです。 0と1、2と3の違いは無視できるため、残りの役割は使用されません。これらの役割は、アドレス指定できるメモリページを制限するか、一部の命令を呼び出すことができないか、特定の引数でそれらを呼び出すことができません。キーボードなどのデバイスとデータを交換するためのI / Oポートテクノロジーの使用にも制限がありますが、10年間使用されていません。カーネルモードへの切り替えは、syscallコマンドによって行われます。syscallコマンドは、Windows APIへのポインターの配列内で呼び出される関数をインデックスによって見つけます。このアレイへのポインタは、OSの起動時に特別なプロセッサレジスタに格納されます。それが最も限定的な役割だからです。 0と1、2と3の違いは無視できるため、残りの役割は使用されません。これらの役割は、アドレス指定できるメモリページを制限するか、一部の命令を呼び出すことができないか、特定の引数でそれらを呼び出すことができません。キーボードなどのデバイスとデータを交換するためのI / Oポートテクノロジーの使用にも制限がありますが、10年間使用されていません。カーネルモードへの切り替えは、syscallコマンドによって行われます。syscallコマンドは、Windows APIへのポインターの配列内で呼び出される関数をインデックスによって見つけます。このアレイへのポインタは、OSの起動時に特別なプロセッサレジスタに格納されます。それが最も限定的な役割だからです。 0と1、2と3の違いは無視できるため、残りの役割は使用されません。これらの役割は、アドレス指定できるメモリページを制限するか、一部の命令を呼び出すことができないか、特定の引数でそれらを呼び出すことができません。キーボードなどのデバイスとデータを交換するためのI / Oポートテクノロジーの使用にも制限がありますが、10年間使用されていません。カーネルモードへの切り替えは、syscallコマンドによって行われます。syscallコマンドは、Windows APIへのポインターの配列内で呼び出される関数をインデックスによって見つけます。このアレイへのポインタは、OSの起動時に特別なプロセッサレジスタに格納されます。これらの役割は、アドレス指定できるメモリページを制限するか、一部の命令を呼び出すことができないか、特定の引数でそれらを呼び出すことができません。キーボードなどのデバイスとデータを交換するためのI / Oポートテクノロジーの使用にも制限がありますが、10年間使用されていません。カーネルモードへの切り替えは、syscallコマンドによって行われます。syscallコマンドは、Windows APIへのポインターの配列内で呼び出される関数をインデックスによって見つけます。このアレイへのポインタは、OSの起動時に特別なプロセッサレジスタに格納されます。これらの役割は、アドレス指定できるメモリページを制限するか、一部の命令を呼び出すことができないか、特定の引数でそれらを呼び出すことができません。キーボードなどのデバイスとデータを交換するためのI / Oポートテクノロジーの使用にも制限がありますが、10年間使用されていません。カーネルモードへの切り替えは、syscallコマンドによって行われます。syscallコマンドは、Windows APIへのポインターの配列内で呼び出される関数をインデックスによって見つけます。このアレイへのポインタは、OSの起動時に特別なプロセッサレジスタに格納されます。カーネルモードへの切り替えは、syscallコマンドによって行われます。syscallコマンドは、Windows APIへのポインターの配列内で呼び出される関数をインデックスによって見つけます。このアレイへのポインタは、OSの起動時に特別なプロセッサレジスタに格納されます。カーネルモードへの切り替えは、syscallコマンドによって行われます。syscallコマンドは、Windows APIへのポインターの配列内で呼び出される関数をインデックスによって見つけます。このアレイへのポインタは、OSの起動時に特別なプロセッサレジスタに格納されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
具体的には、CPUレジスタをフィールドと呼びました。 C＃でプログラムを作成する場合、クラスに必要な数のフィールドを追加して、わかりやすい名前を付けることができます。プロセッサとマイクロコントローラの場合、フィールドはレジスタと呼ばれます。鉄片を設計するときは、この段階で、必要なレジスター（フィールド）の数、それらのサイズ、およびそれらに割り当てる機能を理解しておく必要があります。これで、考えられるすべての状況と考えられない状況のすべての状況でこれで十分です。クラスに16の定義済みフィールドがあるC＃のようなプログラミング言語でプログラムを作成する必要があり、ローカル変数を使用できないと想像してください。それら。同じフィールドを使用して、ログインしたユーザー、ソートされた配列、一時データ、またはメソッドの結果を格納できます。そのようなフィールドの名前はできるだけ一般的である必要があります。tempData、funcResultの代わりに、奇妙な名前EAX、AH、AL、DXなどがあります。x86アーキテクチャでC＃のプロセッサエミュレータを作成した場合、コードは次のようになります（DIV-除算、整数除算コマンド）。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf8/591/9ec/bf85919ec30d58a3099f070ca4d3fb29.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明のために、カーネルモードチェックを追加しました。ゼロ除算エラーが発生した場合、プロセッサは割り込みを介してOSに通知します（イベントをスローします）。ブート時に、OSは、割り込みベクトルと呼ばれる関数へのポインタの1次元配列をプロセッサに提供します。各インデックスは、ゼロによる除算など、ある種のイベントに対応します。 OSは、OSが実行されているプロセッサのアーキテクチャを認識しているため、配列内の関数へのポインタを配置できます。 CPUはこの関数を呼び出し、OSは独自のコードを持っています。たとえば、Windowsは、デバッガがインストールされているかどうかをレジストリで調べ、エラーが発生したことを示すメッセージを表示します。デバッガを実行して、発生した場所を調べることができます。割り込みは、通常のプログラム実行の過程で介入し、割り込みハンドラーを実行できるようにするため、割り込みと呼ばれます。割り込みハンドラーは、その完了後にのみプログラムの実行に戻ることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
割り込みは、プロセッサだけでなく、外部デバイス（キーボード、マウス）またはプログラムコードによっても生成できます。スレッドスケジューラはタイマーを設定し、内部アルゴリズムによって実行される別のスレッドを割り当てるために、1つのクォンタム（既定では、Windows Serverでは約15ミリ秒）の間隔で割り込みを生成します。 Visual Studioでのプログラムの段階的な実行も、割り込みメカニズムに依存しています。フラグはプロセッサーで設定され、各コマンドの後で、Windowsデバッグエンジンによって処理され、Visual Studio APIを介して通知される割り込みを引き起こします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモリ共有は、仮想メモリのおかげで実装されています。 OSはリソースマネージャーであり、仮想マシンであると以前に述べました。 1 GBのRAMがある場合でも、32ビットWindowsは4 GBのRAMがある場合と同じように機能します。あなたは本当に1GB、そして実質的に4GBを持っています。現代のコンピューターは、チューリングマシンまたはフォンノイマンアーキテクチャの理論モデルに基づいています（一部変更あり）。これらのモデルによれば、コンピュータのメモリは1バイトのサイズのセルで構成されるテープです。これらのセルは、通常4096バイト（4Kb）のページにグループ化されます。</font></font><br>
<br>
<ul>
<li> . . CPU      ,         .         ,    ,      ,    ,     .          .</li>
<li>   ,        .   RAM        4.      RAM ,        .</li>
<li>       ,         ( new  ++)       / . Exe-     ,                 c .    .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各プロセスによるRAMの排他的使用をシミュレートします。</font><font style="vertical-align: inherit;">スレッドスケジューラがスレッドの実行をスケジュールすると、プロセスの仮想ページのマッピングに関する情報がプロセッサレジスタの物理ページに読み込まれ、スレッドコードがアドレスの読み書きを試みると、プロセッサはそれを正しく変換します。</font><font style="vertical-align: inherit;">プロセスに加えて、エミュレーションはRAMの排他的使用に依存して、グローバルメッセージキューなど、個々のユーザーに固有のコードとデータを含むセッションに依存します。</font><font style="vertical-align: inherit;">Windows 10には、スレッド、プロセス、およびセッションコンテキストがあります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows 10は、テープの最初のセルをユーザースペースに使用し、最後のセルをそれ自体（カーネルモードスペース）に使用します。このセルには、システムの状態を表すオブジェクトが格納されます。 </font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><img src="https://habrastorage.org/getpro/habr/post_images/408/16a/902/40816a9024699299059fb89ccafce914.png" alt="画像"></td>
<td><img src="https://habrastorage.org/getpro/habr/post_images/412/73c/19d/41273c19d64c2067dd276e7030c52baf.png" alt="画像"></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64ビットアドレスでは、16エクサバイト（18,446,744,073,709,551,616メモリセル）をアドレス指定できます。最近のプロセッサはまだそれほど多くのRAMをサポートしていないため、アドレスの下位48ビットのみを使用し、残りの16ビットは上位で埋められます。したがって、Win x64は、上の図で黒でマークされているアドレスの一部を使用しません。しかし、これは64ビットWindowsが256 TbのRAMを「認識」しているという意味ではありません。 IA64アーキテクチャーでは最大8TBの仮想メモリー、x64では7TB。 Windows 10でサポートされている物理メモリの制限は2TBです。これは、多数のWindowsでテストされていないためです。 Windows 10でサポートされるRAMの量は、主にOSのエディションによって決まり、高価になるほど高くなります。</font></font><br>
<br>
<i>     (HEX) ,     ?       ,              .           ,    —    . CPU       —       CPU         .  HEX         .     , 32  ( 64)   .   —    ,   HEX       ,    .<br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソフトウェアをクライアントサーバー（カーネルモード-ユーザーモード）に分割する方法は、上記のメカニズムよりもはるかに退屈です。</font><font style="vertical-align: inherit;">プロセスとスレッドは、特別な属性でマークすることができます。または、スレッド/プロセスへのポインターのリストを保存して、コードでチェックすることもできます。</font><font style="vertical-align: inherit;">Webアプリケーションで認証を行ったことがあれば、私が話していることをよく理解しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windowsは何で構成されていますか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラミングのすべての領域で抽象化またはコンポーネントへの分割があり、Windowsもいくつかのコンポーネントに分割されていることは直感的に明らかです。</font><font style="vertical-align: inherit;">コンポーネントは、OOPクラス、ファイル、dll、フォルダーなどの機能の単位として理解されます。</font><font style="vertical-align: inherit;">以下の図のコンポーネントは、個々の* .sys、* .dllファイル、または関数名にプレフィックスを追加することによって論理的にグループ化された一連のAPIのいずれかであり、システムの古い部分はCで記述されており、クラスをサポートしていません。</font><font style="vertical-align: inherit;">新しいパーツは、多くの場合C ++で記述されています。</font><font style="vertical-align: inherit;">拡大すると、Windowsは次のようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e1/deb/851/1e1deb8515a27d045a3c1627c79647a1.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネントを下から上に見ていきましょう。</font></font><br>
<br>
<ul>
<li><i>Hyper-V Hypervisor</i> —      Windows    .  ,  Hyper-V     ,              ,           .</li>
<li><i>HAL.dll</i> — Hardware Abtraction Layer —       — ,  ,  —       Windows      HAL.dll,        .        ,   ,  .    ,       -   ACPI.sys.<br>
<br>
<i>  Advanced Configuration and Power Interface?  1996       UI,                .<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ec/6af/7ac/3ec6af7ac9065a490c5125713cc598c7.png" alt="画像"></div><br>
 1996    ACPI,            , ..          . ACPI       ,   CD drive, ..      .</i><br>
</li>
<li><i>Device Drivers</i> —    .         *.sys,          ,            . Process Explorer  SysInternals          .</li>
<li><i>Kernel</i> — <i>Kernel Mode Execution Environment</i>,   ,   ,  ,    .     .</li>
<li><i>Executive</i> —    ,      - .</li>
<li><i>Windowing &amp; Graphics</i> —    DirectX       .</li>
<li><i>NtDll.dll</i> —                      .   dll   ,       ( ..  dll)    . Nt   Native,       Native American. ..  API  ,     .      dll   Nt (NtDestroyMenu).  Win API         User32.dll.          NtDll.dll,    Nt*       (level of indirection) — subsystem dll   User32.dll  PSXdll.dll  DOSCALLS.DLL      Windows. NtDll.dll        (<b>S</b>ession <b>M</b>anagement <b>S</b>ub <b>S</b>ystem<b>.exe</b>, <b>Win</b>dows<b>Init</b>itialize<b>.exe</b>  .),       . </li>
<li><i>SubSystem dlls</i> —        .  Windows      User32.dll. - API            ,    Nt*   NtDll.dll,   CreateFile     NtCreateFile).</li>
<li><i>Environment Subsystems</i> — CSRSS.exe,  Windows.     POSIX ( PSXSS.exe)  OS/2 (OS2SS.exe). Windows Subsystem for Linux   -.</li>
<li><i>System Processes</i> —       ,   LSASS.exe (Local Security Authority SubSystem)       .</li>
<li><i>Service Processes</i> —   Windows ( Plug and Play Manager)       *.exe .     SvcHost.exe      ,    *.dll-.         SvcHost’. </li>
<li><i>User Processes</i> —  .        — , ,    .        .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで私は最初の部分を終えます。</font><font style="vertical-align: inherit;">次は、キーパスがどこから始まるか見てみましょう。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja483318/index.html">30分でWebサービスを監視するボット：電報+ bash + cron</a></li>
<li><a href="../ja483320/index.html">中世のVR博物館の作成</a></li>
<li><a href="../ja483322/index.html">REST API開発-コードファーストアプローチとは何ですか？</a></li>
<li><a href="../ja483324/index.html">ITチームの柔軟なプロセス</a></li>
<li><a href="../ja483328/index.html">REST API-HATEOASとは何ですか？</a></li>
<li><a href="../ja483332/index.html">CES 2020、IBM、および新しい量子コンピューターの最初の真の商用利用</a></li>
<li><a href="../ja483340/index.html">ICDが拡張現実クエストを開始</a></li>
<li><a href="../ja483346/index.html">ブロックチェーンはどのように会計を変更しますか？</a></li>
<li><a href="../ja483348/index.html">パスポートの数値の「類似度」を計算する方法。タイプミスがあっても同じことを見つける</a></li>
<li><a href="../ja483350/index.html">.NETドキュメントの新機能（2019年12月）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>