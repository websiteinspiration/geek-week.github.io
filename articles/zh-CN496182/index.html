<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤µğŸ½ âš“ï¸ ğŸ˜½ Apache Kafka for Dummies ğŸ—¼ ğŸ² ğŸ‘¸ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¯¹äºé‚£äº›åˆšåˆšå¼€å§‹äº†è§£å¾®æœåŠ¡æ¶æ„å’ŒApache KafkaæœåŠ¡çš„äººæ¥è¯´ï¼Œæœ¬æ–‡å°†æ˜¯æœ‰ç”¨çš„ã€‚è¯¥ææ–™å¹¶ä¸å£°ç§°æ˜¯è¯¦ç»†çš„æ•™ç¨‹ï¼Œä½†æ˜¯å¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿå…¥é—¨è¯¥æŠ€æœ¯ã€‚æˆ‘å°†è®¨è®ºå¦‚ä½•åœ¨Windows 10ä¸Šå®‰è£…å’Œé…ç½®Kafkaã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨Intellij IDEAå’ŒSpring Bootåˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚
 
 åšä»€ä¹ˆçš„ï¼Ÿ
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Apache Kafka for Dummies</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496182/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºé‚£äº›åˆšåˆšå¼€å§‹äº†è§£å¾®æœåŠ¡æ¶æ„å’ŒApache KafkaæœåŠ¡çš„äººæ¥è¯´ï¼Œæœ¬æ–‡å°†æ˜¯æœ‰ç”¨çš„ã€‚</font><font style="vertical-align: inherit;">è¯¥ææ–™å¹¶ä¸å£°ç§°æ˜¯è¯¦ç»†çš„æ•™ç¨‹ï¼Œä½†æ˜¯å¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿå…¥é—¨è¯¥æŠ€æœ¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†è®¨è®ºå¦‚ä½•åœ¨Windows 10ä¸Šå®‰è£…å’Œé…ç½®Kafkaã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨Intellij IDEAå’ŒSpring Bootåˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åšä»€ä¹ˆçš„ï¼Ÿ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¼€å‘äººå‘˜ä»æœªé‡åˆ°è¿‡å¯èƒ½éœ€è¦è¿™äº›å·¥å…·çš„æƒ…å†µï¼Œè¿™å¾€å¾€ä¼šä½¿äººä»¬éš¾ä»¥ç†è§£å„ç§å·¥å…·ã€‚å¯¹äºKafkaï¼Œè¿™æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚æˆ‘ä»¬æè¿°äº†è¿™ç§æŠ€æœ¯å°†æœ‰ç”¨çš„æƒ…å†µã€‚å¦‚æœæ‚¨å…·æœ‰æ•´ä½“åº”ç”¨ç¨‹åºæ¶æ„ï¼Œé‚£ä¹ˆæ‚¨å½“ç„¶ä¸éœ€è¦ä»»ä½•Kafkaã€‚ä¸€åˆ‡éƒ½éšç€å‘å¾®æœåŠ¡çš„è¿‡æ¸¡è€Œæ”¹å˜ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæˆ–å¦ä¸€ä¸ªåŠŸèƒ½çš„ç‹¬ç«‹ç¨‹åºï¼Œå¯ä»¥ç‹¬ç«‹äºå…¶ä»–å¾®æœåŠ¡å¯åŠ¨ã€‚å¯ä»¥å°†å¾®æœåŠ¡ä¸åŠå…¬å®¤ä¸­çš„å‘˜å·¥è¿›è¡Œæ¯”è¾ƒï¼Œåè€…ååœ¨åˆ†å¼€çš„åŠå…¬æ¡Œæ—å¹¶ç‹¬ç«‹è§£å†³ä»–ä»¬çš„é—®é¢˜ã€‚å¦‚æœæ²¡æœ‰ä¸­å¤®åè°ƒï¼Œè¿™æ ·ä¸€ä¸ªåˆ†æ•£çš„å›¢é˜Ÿçš„å·¥ä½œæ˜¯ä¸å¯æƒ³è±¡çš„ã€‚å‘˜å·¥åº”è¯¥èƒ½å¤Ÿå½¼æ­¤äº¤æ¢ä¿¡æ¯å’Œå·¥ä½œç»“æœã€‚ç”¨äºå¾®æœåŠ¡çš„Apache Kafkaæ—¨åœ¨è§£å†³æ­¤é—®é¢˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Kafkaæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä»£ç†ã€‚å€ŸåŠ©å®ƒï¼Œå¾®æœåŠ¡å¯ä»¥å½¼æ­¤äº¤äº’ï¼Œå‘é€å’Œæ¥æ”¶é‡è¦ä¿¡æ¯ã€‚å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸ä¸ºæ­¤ä½¿ç”¨å¸¸è§„POST-è¯·æ±‚ï¼Œå°±å¯ä»¥åœ¨å…¶ä¸»ä½“ä¸­ä»¥ç›¸åŒçš„æ–¹å¼ä¼ è¾“å¿…è¦çš„æ•°æ®å¹¶è·å¾—ç­”æ¡ˆï¼Ÿè¿™ç§æ–¹æ³•æœ‰è®¸å¤šæ˜æ˜¾çš„ç¼ºç‚¹ã€‚ä¾‹å¦‚ï¼Œç”Ÿäº§è€…ï¼ˆå‘é€æ¶ˆæ¯çš„æœåŠ¡ï¼‰åªèƒ½å“åº”äºæ¶ˆè´¹è€…ï¼ˆæ¥æ”¶æ•°æ®çš„æœåŠ¡ï¼‰çš„è¯·æ±‚ä»¥å“åº”çš„å½¢å¼å‘é€æ•°æ®ã€‚å‡è®¾ä½¿ç”¨è€…å‘é€äº†ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œè€Œç”Ÿäº§è€…å›ç­”äº†è¯¥è¯·æ±‚ã€‚æ­¤æ—¶ï¼Œç”±äºæŸç§åŸå› ï¼Œæ¶ˆè´¹è€…æ— æ³•æ¥å—ç­”æ¡ˆã€‚æ•°æ®å°†å¦‚ä½•å¤„ç†ï¼Ÿä»–ä»¬ä¼šè¿·è·¯çš„ã€‚ä½¿ç”¨è€…å°†å†æ¬¡å¿…é¡»å‘é€è¯·æ±‚ï¼Œå¹¶å¸Œæœ›åœ¨æ­¤æœŸé—´ä»–æƒ³è¦æ¥æ”¶çš„æ•°æ®æ²¡æœ‰æ”¹å˜ï¼Œç”Ÿäº§è€…ä»å‡†å¤‡æ¥å—è¯¥è¯·æ±‚ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Kafkaè§£å†³äº†åœ¨å¾®æœåŠ¡ä¹‹é—´äº¤æ¢æ¶ˆæ¯æ—¶å‡ºç°çš„è¿™ä¸ªé—®é¢˜å’Œè®¸å¤šå…¶ä»–é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">ä¸èƒ½å¿˜è®°ï¼Œä¸ä¸­æ–­å’Œæ–¹ä¾¿çš„æ•°æ®äº¤æ¢æ˜¯ç¡®ä¿å¾®æœåŠ¡ä½“ç³»ç»“æ„ç¨³å®šè¿è¡Œæ‰€å¿…é¡»è§£å†³çš„å…³é”®é—®é¢˜ä¹‹ä¸€ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨Windows 10ä¸Šå®‰è£…å’Œé…ç½®ZooKeeperå’ŒApache Kafka</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæ‚¨éœ€è¦çŸ¥é“çš„ç¬¬ä¸€ä»¶äº‹æ˜¯Apache Kafkaåœ¨ZooKeeperæœåŠ¡ä¹‹ä¸Šè¿è¡Œã€‚ ZooKeeperæ˜¯ä¸€ç§åˆ†å¸ƒå¼é…ç½®å’ŒåŒæ­¥æœåŠ¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£çš„ä¸€åˆ‡ã€‚åœ¨å¼€å§‹ä½¿ç”¨Kafkaä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ä¸‹è½½ï¼Œé…ç½®å’Œè¿è¡Œå®ƒã€‚åœ¨å¼€å§‹ä½¿ç”¨ZooKeeperä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…å¹¶é…ç½®äº†JREã€‚</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ZooKeeper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†æ–‡ä»¶ä»ä¸‹è½½çš„ZooKeeperå­˜æ¡£ä¸­æå–åˆ°ç£ç›˜ä¸Šçš„æ–‡ä»¶å¤¹ä¸­ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¸¦æœ‰ç‰ˆæœ¬å·çš„zookeeperæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°confæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­æ‰¾åˆ°æ–‡ä»¶â€œ zoo_sample.cfgâ€ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ho/ke/pz/hokepzidcuiupzigc3i3wtlxi6s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤åˆ¶å®ƒï¼Œå¹¶å°†å‰¯æœ¬åç§°æ›´æ”¹ä¸ºâ€œ zoo.cfgâ€ã€‚æ‰“å¼€å¤åˆ¶æ–‡ä»¶ï¼Œç„¶ååœ¨å…¶ä¸­æ‰¾åˆ°è¡ŒdataDir = / tmp / zookeeperã€‚åœ¨è¿™ä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬å°†å®Œæ•´è·¯å¾„å†™å…¥åˆ°zookeeper-x.x.xæ–‡ä»¶å¤¹ä¸­ã€‚å¯¹æˆ‘æ¥è¯´çœ‹èµ·æ¥åƒè¿™æ ·ï¼šdataDir = Cï¼š\\ ZooKeeper \\ zookeeper-3.6.0 </font></font><br>
<img src="https://habrastorage.org/webt/ri/sk/2h/risk2h-3u771fpod5vvxodydrhy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬æ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼šZOOKEEPER_HOME = Cï¼š\ ZooKeeper \ zookeeper-3.4.9ï¼Œå¹¶åœ¨ç³»ç»Ÿå˜é‡Pathçš„æœ«å°¾æ·»åŠ æ¡ç›®ï¼š;ï¼…ZOOKEEPER_HOME ï¼…\ bin; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¡Œå‘½ä»¤è¡Œå¹¶ç¼–å†™å‘½ä»¤ï¼š</font></font><br>
<br>
<pre><code class="cs hljs">zkserver</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 å¦‚æœä¸€åˆ‡æ“ä½œæ­£ç¡®ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/rs/i6/b-rsi6uqc40e77tchqnimmhsgo8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ„å‘³ç€ZooKeeperæ­£å¸¸å¯åŠ¨ã€‚æˆ‘ä»¬ç›´æ¥è¿›è¡ŒApache KafkaæœåŠ¡å™¨çš„å®‰è£…å’Œé…ç½®ã€‚ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬å¹¶æå–å­˜æ¡£çš„å†…å®¹ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kafka.apache.org/downloads</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åœ¨Kafkaæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°configæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°server.propertiesæ–‡ä»¶å¹¶æ‰“å¼€å®ƒã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/o5/m0/pxo5m032s0lvvmjqbhmfaazfnog.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æ‰¾åˆ°è¡Œlog.dirs = / tmp / kafka-logsï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å‡ºKafkaå°†ä¿å­˜æ—¥å¿—çš„è·¯å¾„ï¼šlog.dirs = cï¼š/ kafka / kafka-logsã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gh/bi/mg/ghbimgkxct-2ox1a8s8klpackco.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­ï¼Œç¼–è¾‘zookeeper.propertiesæ–‡ä»¶ã€‚æˆ‘ä»¬å°†è¡ŒdataDir = / tmp / zookeeperæ›´æ”¹ä¸ºdataDir = cï¼š/ kafka / zookeeper-dataï¼Œè€Œä¸ä¼šå¿˜è®°åœ¨ç£ç›˜åç§°åæŒ‡å‡ºæŒ‡å‘Kafkaæ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚å¦‚æœä¸€åˆ‡æ­£ç¡®ï¼Œåˆ™å¯ä»¥è¿è¡ŒZooKeeperå’ŒKafkaã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/nd/mr/ydndmrfkovlk4z75mc99lbs3clk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºæŸäº›äººæ¥è¯´ï¼Œæ²¡æœ‰GUIæ¥æ§åˆ¶Kafkaå¯èƒ½ä»¤äººä¸å¿«ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿè®¸è¿™æ˜¯å› ä¸ºè¯¥æœåŠ¡æ˜¯ä¸“ä¸ºè‹›åˆ»çš„ä¹¦å‘†å­è®¾è®¡çš„ï¼Œä¸“é—¨ç”¨äºæ§åˆ¶å°ã€‚</font><font style="vertical-align: inherit;">ä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼ï¼Œè¦è¿è¡ŒKafkaï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‘½ä»¤è¡Œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæ‚¨éœ€è¦å¯åŠ¨ZooKeeperã€‚</font><font style="vertical-align: inherit;">åœ¨åŒ…å«kafkaçš„æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰¾åˆ°bin / windowsæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°å¯åŠ¨zookeeper-server-start.batæœåŠ¡çš„æ–‡ä»¶ï¼Œå•å‡»è¯¥æ–‡ä»¶ã€‚</font><font style="vertical-align: inherit;">ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï¼Ÿ</font><font style="vertical-align: inherit;">åº”è¯¥æ˜¯è¿™æ ·ã€‚</font><font style="vertical-align: inherit;">æ‰“å¼€æ­¤æ–‡ä»¶å¤¹ä¸­çš„æ§åˆ¶å°ï¼Œç„¶åè¾“å…¥ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"> start zookeeper-server-start.bat</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ä¸å†å·¥ä½œäº†å—ï¼Ÿ</font><font style="vertical-align: inherit;">è¿™æ˜¯å¸¸æ€ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å› ä¸ºzookeeper-server-start.batéœ€è¦ä½¿ç”¨zookeeper.propertiesæ–‡ä»¶ä¸­æŒ‡å®šçš„å‚æ•°ï¼Œæ­£å¦‚æˆ‘ä»¬å›æƒ³çš„é‚£æ ·ï¼Œè¯¥æ–‡ä»¶ä½äºconfigæ–‡ä»¶å¤¹ä¸­ä»¥è¿›è¡Œå·¥ä½œã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å†™åˆ°æ§åˆ¶å°ï¼š</font></font><br>
<br>
<pre><code class="cs hljs">start zookeeper-server-start.bat c:\kafka\config\zookeeper.properties </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ä¸€åˆ‡åº”è¯¥æ­£å¸¸å¼€å§‹ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wn/q1/hr/wnq1hrvtfit6o_mgsqkdkrzcjiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å†æ¬¡æ‰“å¼€æ­¤æ–‡ä»¶å¤¹ä¸­çš„æ§åˆ¶å°ï¼ˆä¸è¦å…³é—­ZooKeeperï¼ï¼‰ï¼Œç„¶åè¿è¡Œkafkaï¼š</font></font><br>
<br>
<pre><code class="cs hljs">start kafka-server-start.bat c:\kafka\config\server.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ä¸æ¯æ¬¡éƒ½åœ¨å‘½ä»¤è¡Œä¸Šç¼–å†™å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨æ—§çš„è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•å¹¶åˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å†…å®¹çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼š</font></font><br>
<br>
<pre><code class="cs hljs">start C:\kafka\bin\windows\zookeeper-server-start.bat C:\kafka\config\zookeeper.properties<font></font>
timeout <span class="hljs-number">10</span>
start C:\kafka\bin\windows\kafka-server-start.bat C:\kafka\config\server.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éœ€è¦è¶…æ—¶10è¡Œæ¥è®¾ç½®å¯åŠ¨zookeeperå’Œkafkaä¹‹é—´çš„æš‚åœã€‚</font><font style="vertical-align: inherit;">å¦‚æœä¸€åˆ‡æ­£ç¡®ï¼Œå•å‡»æ‰¹å¤„ç†æ–‡ä»¶æ—¶ï¼Œå°†æ‰“å¼€ä¸¤ä¸ªæ§åˆ¶å°ï¼Œåˆ†åˆ«è¿è¡Œzookeeperå’Œkafkaï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥ä»å‘½ä»¤è¡Œåˆ›å»ºå¸¦æœ‰å¿…éœ€å‚æ•°çš„æ¶ˆæ¯ç”Ÿäº§è€…å’Œä½¿ç”¨è€…ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œé™¤éæµ‹è¯•æœåŠ¡ï¼Œå¦åˆ™å¯èƒ½éœ€è¦å®ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å¯¹å¦‚ä½•ä½¿ç”¨IDEAçš„kafkaæ›´åŠ æ„Ÿå…´è¶£ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸IDEAçš„kafkaä¸€èµ·ä½¿ç”¨</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ç¼–å†™æœ€ç®€å•çš„åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå°†åŒæ—¶æ˜¯æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œä½¿ç”¨è€…ï¼Œç„¶åå‘å…¶æ·»åŠ æœ‰ç”¨çš„åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªæ–°çš„springé¡¹ç›®ã€‚</font><font style="vertical-align: inherit;">æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¼¹ç°§åˆå§‹åŒ–å™¨ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ ä¾èµ–é¡¹org.springframework.kafkaå’Œspring-boot-starter-web </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n8/tv/vd/n8tvvda_h1eedp1j7iodblqnv3u.png"><br>
<br>
<img src="https://habrastorage.org/webt/so/kb/pw/sokbpw-hvkzn8ihnzsokhqn0-yo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœï¼Œpom.xmlæ–‡ä»¶åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/oc/ub/gwocubssaaqvggzlya-mgdwso24.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦KafkaTemplate &lt;Kï¼ŒV&gt;å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå¯¹è±¡å·²è¾“å…¥ã€‚</font><font style="vertical-align: inherit;">ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯†é’¥çš„ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¶ˆæ¯æœ¬èº«ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªå‚æ•°éƒ½è¡¨ç¤ºä¸ºStringã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨ç±»æ§åˆ¶å™¨ä¸­åˆ›å»ºå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å£°æ˜KafkaTemplateå¹¶è¦æ±‚Springé€šè¿‡æ³¨é‡Šå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªåŠ¨æ¥çº¿</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬çš„ç”Ÿäº§è€…å·²ç»å‡†å¤‡å°±ç»ªã€‚å‰©ä¸‹è¦åšçš„å°±æ˜¯åœ¨å…¶ä¸Šè°ƒç”¨sendï¼ˆï¼‰æ–¹æ³•ã€‚æ­¤æ–¹æ³•æœ‰å¤šä¸ªé‡è½½ç‰ˆæœ¬ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å…·æœ‰3ä¸ªå‚æ•°çš„é€‰é¡¹-å‘é€ï¼ˆå­—ç¬¦ä¸²ä¸»é¢˜ï¼ŒKé”®ï¼ŒVæ•°æ®ï¼‰ã€‚ç”±äºKafkaTemplateæ˜¯ç”¨å­—ç¬¦ä¸²é”®å…¥çš„ï¼Œå› æ­¤sendæ–¹æ³•ä¸­çš„é”®å’Œæ•°æ®å°†æ˜¯å­—ç¬¦ä¸²ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šä¸»é¢˜ï¼Œå³æ¶ˆæ¯å°†å‘é€åˆ°çš„ä¸»é¢˜ï¼Œä»¥åŠæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä»¥æ¥æ”¶æ¶ˆæ¯çš„ä¸»é¢˜ã€‚å¦‚æœsendæ–¹æ³•ä¸­æŒ‡å®šçš„ä¸»é¢˜ä¸å­˜åœ¨ï¼Œå®ƒå°†è‡ªåŠ¨åˆ›å»ºã€‚å®Œæ•´çš„ç±»æ–‡æœ¬å¦‚ä¸‹æ‰€ç¤ºã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("msg")</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MsgController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;<font></font>
<font></font>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendOrder</span><span class="hljs-params">(String msgId, String msg)</span></span>{<font></font>
        kafkaTemplate.send(<span class="hljs-string">"msg"</span>, msgId, msg);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ§åˆ¶å™¨æ˜ å°„åˆ°</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬åœ°ä¸»æœº</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š8080 / msgï¼Œå¯†é’¥å’Œæ¶ˆæ¯æœ¬èº«åœ¨è¯·æ±‚ä¸»ä½“ä¸­ä¼ è¾“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¶ˆæ¯å‘é€è€…å·²å‡†å¤‡å°±ç»ªï¼Œç°åœ¨åˆ›å»ºä¸€ä¸ªä¾¦å¬å™¨ã€‚</font><font style="vertical-align: inherit;">Springè¿˜å¯ä»¥è®©æ‚¨è½»æ¾å®Œæˆæ­¤æ“ä½œã€‚</font><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªæ–¹æ³•å¹¶ç”¨@KafkaListeneræ‰¹æ³¨å¯¹å…¶è¿›è¡Œæ ‡è®°å°±è¶³å¤Ÿäº†ï¼Œåœ¨è¯¥æ‰¹æ³¨çš„å‚æ•°ä¸­ï¼Œæ‚¨ä»…å¯ä»¥æŒ‡å®šè¦æ”¶å¬çš„ä¸»é¢˜ã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@KafkaListener(topics="msg")</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ ‡æœ‰æ³¨é‡Šçš„æ–¹æ³•æœ¬èº«å¯ä»¥æŒ‡å®šä¸€ä¸ªå¯æ¥å—çš„å‚æ•°ï¼Œè¯¥å‚æ•°å…·æœ‰ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ç±»å‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†åœ¨å…¶ä¸­åˆ›å»ºä½¿ç”¨è€…çš„ç±»å¿…é¡»ç”¨@EnableKafkaæ‰¹æ³¨æ ‡è®°ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@EnableKafka</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleKafkaExampleApplication</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@KafkaListener(topics="msg")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">msgListener</span><span class="hljs-params">(String msg)</span></span>{<font></font>
        System.out.println(msg);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<font></font>
        SpringApplication.run(SimpleKafkaExampleApplication.class, args);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦å¤–ï¼Œåœ¨application.propertyè®¾ç½®æ–‡ä»¶ä¸­ï¼Œæ‚¨å¿…é¡»æŒ‡å®šç¤¼å®¾å‚æ•°groupe-idã€‚</font><font style="vertical-align: inherit;">å¦‚æœä¸è¿™æ ·åšï¼Œè¯¥åº”ç”¨ç¨‹åºå°†æ— æ³•å¯åŠ¨ã€‚</font><font style="vertical-align: inherit;">è¯¥å‚æ•°çš„ç±»å‹ä¸ºStringï¼Œå¯ä»¥æ˜¯ä»»ä½•å€¼ã€‚</font></font><br>
<br>
<pre><code class="cs hljs">spring.kafka.consumer.<span class="hljs-keyword">group</span>-id=app<span class="hljs-number">.1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æœ€ç®€å•çš„kafkaé¡¹ç›®å·²å‡†å¤‡å°±ç»ªã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰æ¶ˆæ¯çš„å‘é€è€…å’Œæ¥æ”¶è€…ã€‚</font><font style="vertical-align: inherit;">å®ƒä»ç„¶åªèƒ½è¿è¡Œã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œä½¿ç”¨æˆ‘ä»¬å…ˆå‰ç¼–å†™çš„æ‰¹å¤„ç†æ–‡ä»¶å¯åŠ¨ZooKeeperå’ŒKafkaï¼Œç„¶åå¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨Postmanå‘é€è¯·æ±‚æœ€æ–¹ä¾¿ã€‚</font><font style="vertical-align: inherit;">åœ¨è¯·æ±‚çš„æ­£æ–‡ä¸­ï¼Œä¸è¦å¿˜è®°æŒ‡å®šå‚æ•°msgIdå’Œmsgã€‚</font></font><br>
<img src="https://habrastorage.org/webt/_o/og/jt/_oogjtlzajgbbnpsf8sjg8k0num.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæˆ‘ä»¬åœ¨IDEAä¸­çœ‹åˆ°è¿™æ ·çš„å›¾ç‰‡ï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ï¼šç”Ÿäº§è€…å‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°äº†è¯¥æ¶ˆæ¯å¹¶å°†å…¶æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚</font></font><br>
<img src="https://habrastorage.org/webt/kg/zq/j3/kgzqj38qw5q67mmr0fa2ijucflw.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿é¡¹ç›®å¤æ‚åŒ–</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨Kafkaçš„å®é™…é¡¹ç›®è‚¯å®šæ¯”æˆ‘ä»¬åˆ›å»ºçš„é¡¹ç›®å¤æ‚ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å¼„æ¸…äº†æœåŠ¡çš„åŸºæœ¬åŠŸèƒ½ï¼Œè¯·è€ƒè™‘å®ƒæä¾›äº†å“ªäº›é™„åŠ åŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ”¹å–„ç”Ÿäº§è€…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‰“å¼€sendï¼ˆï¼‰æ–¹æ³•ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°å…¶æ‰€æœ‰å˜ä½“çš„è¿”å›å€¼å‡ä¸ºListenableFuture &lt;SendResult &lt;Kï¼ŒV &gt;&gt;ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¸è¯¦ç»†è€ƒè™‘æ­¤æ¥å£çš„åŠŸèƒ½ã€‚åœ¨è¿™é‡Œè¶³ä»¥è¯´å‡ºéœ€è¦æŸ¥çœ‹å‘é€æ¶ˆæ¯çš„ç»“æœã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@PostMapping</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendMsg</span><span class="hljs-params">(String msgId, String msg)</span></span>{<font></font>
    ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; future = kafkaTemplate.send(<span class="hljs-string">"msg"</span>, msgId, msg);<font></font>
    future.addCallback(System.out::println, System.err::println);<font></font>
    kafkaTemplate.flush();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
addCallbackï¼ˆï¼‰æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°-SuccessCallbackå’ŒFailureCallbackã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬éƒ½æ˜¯åŠŸèƒ½æ¥å£ã€‚</font><font style="vertical-align: inherit;">ä»åç§°ä¸­æ‚¨å¯ä»¥ç†è§£ï¼Œç¬¬ä¸€ä¸ªæ–¹æ³•å°†ç”±äºæˆåŠŸå‘é€æ¶ˆæ¯è€Œè¢«è°ƒç”¨ï¼Œç¬¬äºŒä¸ªæ–¹æ³•å°†ç”±äºé”™è¯¯è€Œè¢«è°ƒç”¨ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œè¯¥é¡¹ç›®ï¼Œæˆ‘ä»¬å°†åœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="cs hljs">SendResult [producerRecord=ProducerRecord(topic=msg, partition=<span class="hljs-literal">null</span>, headers=RecordHeaders(headers = [], isReadOnly = <span class="hljs-literal">true</span>), key=<span class="hljs-number">1</span>, <span class="hljs-keyword">value</span>=Hello, world!, timestamp=<span class="hljs-literal">null</span>), recordMetadata=msg<span class="hljs-number">-0</span>@<span class="hljs-number">6</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬å†æ¬¡ä»”ç»†çœ‹çœ‹æˆ‘ä»¬çš„åˆ¶ä½œäººã€‚</font><font style="vertical-align: inherit;">æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœå¯†é’¥ä¸æ˜¯Stringï¼Œè€Œæ˜¯Longï¼Œä½†æ˜¯ä½œä¸ºä¼ è¾“çš„æ¶ˆæ¯ï¼Œç”šè‡³æ›´ç³Ÿ-æŸç§å¤æ‚çš„DTOï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œ</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hl/3m/81/hl3m81wnp81kngs_abmdx9wemlm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬</font><font style="vertical-align: inherit;">å°è¯•å°†é”®æ›´æ”¹ä¸ºæ•°å­—å€¼... </font><font style="vertical-align: inherit;">å¦‚æœåœ¨ç”Ÿäº§è€…ä¸­å°†LongæŒ‡å®šä¸ºé”®ï¼Œåˆ™åº”ç”¨ç¨‹åºå°†æ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯å½“æ‚¨å°è¯•å‘é€æ¶ˆæ¯æ—¶ï¼Œå°†æŠ›å‡ºClassCastExceptionå¹¶ä¸”å°†æŠ¥å‘ŠLongç±»æ— æ³•è½¬æ¢ä¸ºStringç±»ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/ti/tz/fetitzsqvkjsetoigt8lwodxcbk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœå°è¯•æ‰‹åŠ¨åˆ›å»ºKafkaTemplateå¯¹è±¡ï¼Œåˆ™ä¼šçœ‹åˆ°ProducerFactory &lt;Kï¼ŒV&gt;æ¥å£å¯¹è±¡ï¼ˆä¾‹å¦‚DefaultKafkaProducerFactory &lt;&gt;ï¼‰ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚ä¸ºäº†åˆ›å»ºDefaultKafkaProducerFactoryï¼Œæˆ‘ä»¬éœ€è¦å°†åŒ…å«å…¶ç”Ÿäº§è€…è®¾ç½®çš„Mapä¼ é€’ç»™å…¶æ„é€ å‡½æ•°ã€‚ç”¨äºé…ç½®å’Œåˆ›å»ºç”Ÿäº§è€…çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨å•ç‹¬çš„ç±»ä¸­ã€‚ä¸ºæ­¤ï¼Œè¯·åˆ›å»ºé…ç½®åŒ…ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºKafkaProducerConfigç±»ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KafkaProducerConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> String kafkaServer=<span class="hljs-string">"localhost:9092"</span>;<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">producerConfigs</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Object&gt; props = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<font></font>
                kafkaServer);<font></font>
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,<font></font>
                LongSerializer.class);<font></font>
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,<font></font>
                StringSerializer.class);<font></font>
        <span class="hljs-keyword">return</span> props;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ProducerFactory&lt;Long, String&gt; <span class="hljs-title">producerFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> KafkaTemplate&lt;Long, String&gt; <span class="hljs-title">kafkaTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> KafkaTemplate&lt;&gt;(producerFactory());<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨producerConfigsï¼ˆï¼‰æ–¹æ³•ä¸­ï¼Œä½¿ç”¨é…ç½®åˆ›å»ºä¸€ä¸ªæ˜ å°„ï¼Œå¹¶æŒ‡å®šLongSerializer.classä½œä¸ºå¯†é’¥çš„åºåˆ—åŒ–å™¨ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¼€å§‹ï¼Œå‘é€æ¥è‡ªPostmançš„è¯·æ±‚ï¼Œç„¶åçœ‹åˆ°ä¸€åˆ‡æ­£å¸¸è¿è¡Œï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œè€Œæ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´æ”¹ä¼ è¾“å€¼çš„ç±»å‹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æ²¡æœ‰Javaåº“ä¸­çš„æ ‡å‡†ç±»ï¼Œè€Œæ˜¯æŸç§è‡ªå®šä¹‰DTOï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</font><font style="vertical-align: inherit;">è¿™ä¹ˆè¯´å§ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDto</span> </span>{
    <span class="hljs-keyword">private</span> Long age;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> Address address;<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>{
    <span class="hljs-keyword">private</span> String country;
    <span class="hljs-keyword">private</span> String city;
    <span class="hljs-keyword">private</span> String street;
    <span class="hljs-keyword">private</span> Long homeNumber;
    <span class="hljs-keyword">private</span> Long flatNumber;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦å°†DTOä½œä¸ºæ¶ˆæ¯å‘é€ï¼Œæ‚¨éœ€è¦å¯¹ç”Ÿäº§è€…é…ç½®è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚</font><font style="vertical-align: inherit;">å°†JsonSerializer.classæŒ‡å®šä¸ºæ¶ˆæ¯å€¼çš„åºåˆ—åŒ–å™¨ï¼Œå¹¶ä¸”ä¸è¦å¿˜è®°åœ¨æ‰€æœ‰åœ°æ–¹éƒ½å°†Stringç±»å‹æ›´æ”¹ä¸ºUserDtoã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KafkaProducerConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> String kafkaServer=<span class="hljs-string">"localhost:9092"</span>;<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">producerConfigs</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Object&gt; props = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<font></font>
                kafkaServer);<font></font>
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,<font></font>
                LongSerializer.class);<font></font>
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,<font></font>
                JsonSerializer.class);<font></font>
        <span class="hljs-keyword">return</span> props;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ProducerFactory&lt;Long, UserDto&gt; <span class="hljs-title">producerFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> KafkaTemplate&lt;Long, UserDto&gt; <span class="hljs-title">kafkaTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> KafkaTemplate&lt;&gt;(producerFactory());<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‘é€ä¿¡æ¯ã€‚æ§åˆ¶å°ä¸­å°†æ˜¾ç¤ºä»¥ä¸‹è¡Œï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e8/2f/xu/e82fxufwzg_yai2rs5vx5athbts.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ä½¿ç”¨è€…å¤æ‚åŒ–ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå¸¦æœ‰æ³¨é‡Š@KafkaListenerï¼ˆtopics =â€œ msgâ€ï¼‰æ ‡è®°çš„æ–¹æ³•public void msgListenerï¼ˆString msgï¼‰å°†Stringä½œä¸ºå‚æ•°å¹¶å°†å…¶æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚å¦‚æœæˆ‘ä»¬æƒ³è·å–ä¼ è¾“æ¶ˆæ¯çš„å…¶ä»–å‚æ•°ï¼Œä¾‹å¦‚å¯†é’¥æˆ–åˆ†åŒºï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»æ›´æ”¹ä¼ è¾“å€¼çš„ç±»å‹ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@KafkaListener(topics="msg")</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">orderListener</span><span class="hljs-params">(ConsumerRecord&lt;Long, UserDto&gt; record)</span></span>{<font></font>
    System.out.println(record.partition());<font></font>
    System.out.println(record.key());<font></font>
    System.out.println(record.value());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»ConsumerRecordå¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ‰€æœ‰å‚æ•°ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/ml/pw/zqmlpw7o5xzb0fxxzq7rez5qjpa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çœ‹åˆ°ä»£æ›¿æ§åˆ¶å°ä¸Šçš„é”®ï¼Œè€Œæ˜¯æ˜¾ç¤ºäº†æŸç§krakozyabryã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨StringDeserializeræ¥ååºåˆ—åŒ–é”®ï¼Œå¹¶ä¸”å¦‚æœæˆ‘ä»¬å¸Œæœ›ä»¥æ•´æ•°æ ¼å¼æ­£ç¡®æ˜¾ç¤ºé”®ï¼Œåˆ™å¿…é¡»å°†å…¶æ›´æ”¹ä¸ºLongDeserializerã€‚è¦åœ¨configåŒ…ä¸­é…ç½®ä½¿ç”¨è€…ï¼Œè¯·åˆ›å»ºKafkaConsumerConfigç±»ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KafkaConsumerConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.kafka.bootstrap-servers}")</span>
    <span class="hljs-keyword">private</span> String kafkaServer;<font></font>
<font></font>
    <span class="hljs-meta">@Value("${spring.kafka.consumer.group-id}")</span>
    <span class="hljs-keyword">private</span> String kafkaGroupId;<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">consumerConfigs</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Object&gt; props = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer);<font></font>
        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, LongDeserializer.class);<font></font>
        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);<font></font>
        props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId);<font></font>
        <span class="hljs-keyword">return</span> props;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> KafkaListenerContainerFactory&lt;?&gt; kafkaListenerContainerFactory() {<font></font>
        ConcurrentKafkaListenerContainerFactory&lt;Long, UserDto&gt; factory =<font></font>
                <span class="hljs-keyword">new</span> ConcurrentKafkaListenerContainerFactory&lt;&gt;();<font></font>
        factory.setConsumerFactory(consumerFactory());<font></font>
        <span class="hljs-keyword">return</span> factory;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ConsumerFactory&lt;Long, UserDto&gt; <span class="hljs-title">consumerFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs());<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KafkaConsumerConfigç±»ä¸æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„KafkaProducerConfigéå¸¸ç›¸ä¼¼ã€‚è¿˜æœ‰ä¸€ä¸ªMapï¼Œå…¶ä¸­åŒ…å«å¿…è¦çš„é…ç½®ï¼Œä¾‹å¦‚ï¼Œé”®å’Œå€¼çš„ååºåˆ—åŒ–å™¨ã€‚åˆ›å»ºçš„æ˜ å°„ç”¨äºåˆ›å»ºConsumerFactory &lt;&gt;ï¼Œè€Œåè€…åˆéœ€è¦ç”¨äºåˆ›å»ºKafkaListenerContainerFactory &lt;ï¼Ÿ&gt;ã€‚ä¸€ä¸ªé‡è¦çš„ç»†èŠ‚ï¼šè¿”å›KafkaListenerContainerFactory &lt;ï¼Ÿ&gt;çš„æ–¹æ³•åº”ç§°ä¸ºkafkaListenerContainerFactoryï¼ˆï¼‰ï¼Œå¦åˆ™Springå°†æ— æ³•æ‰¾åˆ°æ‰€éœ€çš„beanï¼Œå¹¶ä¸”é¡¹ç›®å°†æ— æ³•ç¼–è¯‘ã€‚æˆ‘ä»¬å¼€å§‹ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6x/mb/t9/6xmbt9zj5i6uzdx95a7ck4hjjxk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çœ‹åˆ°ç°åœ¨å¯†é’¥å·²æŒ‰åŸæ ·æ˜¾ç¤ºï¼Œè¿™æ„å‘³ç€ä¸€åˆ‡æ­£å¸¸ã€‚</font><font style="vertical-align: inherit;">å½“ç„¶ï¼ŒApache Kafkaçš„åŠŸèƒ½è¿œè¿œè¶…å‡ºäº†æœ¬æ–‡ä¸­ä»‹ç»çš„åŠŸèƒ½ï¼Œä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›é˜…è¯»åèƒ½å¯¹è¿™é¡¹æœåŠ¡æœ‰æ‰€äº†è§£ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤šæ´—æ‰‹ï¼Œæˆ´å£ç½©ï¼Œä¸è¦æ— æ•…å¤–å‡ºï¼Œä¿æŒå¥åº·ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN496170/index.html">æˆ‘ä»¬æ³¨å®šäº†ç¬¬ä¸€å// // Udalenkaé™·å…¥å±æœºå’Œç‹¬åˆ›æ€§çš„æ­»äº¡</a></li>
<li><a href="../zh-CN496174/index.html">å¯¹åˆ†æï¼Œäº§å“å›¢é˜Ÿï¼Œäºšé©¬é€Šï¼Œä»¥è‰²åˆ—ï¼Œæ–°åŠ å¡ï¼Œè¿œç¨‹å·¥ä½œç­‰çš„éœ€æ±‚å¢åŠ -è®¨è®ºäº†å¾ˆå¤šã€‚</a></li>
<li><a href="../zh-CN496176/index.html">å¤§å‹è™šæ‹Ÿä¼šè®®ï¼šä¿æŠ¤ç°ä»£æ•°å­—å…¬å¸çš„æ•°æ®çš„çœŸå®ç»éªŒ</a></li>
<li><a href="../zh-CN496178/index.html">æ–¯å¨å¤«ç‰¹5.2ã€‚æ‰€æœ‰å˜æ›´æ¦‚è¿°</a></li>
<li><a href="../zh-CN496180/index.html">ç…§é¡¾é’æ˜¥çš„é˜´å½±</a></li>
<li><a href="../zh-CN496184/index.html">LEDæ˜¾ç¤ºæŠ€æœ¯ï¼šMicro-LED vs. è¿·ä½ LED</a></li>
<li><a href="../zh-CN496186/index.html">ä»¥Word2Vecä¸ºä¾‹çš„é”™è¯¯åå‘ä¼ æ’­ç®—æ³•</a></li>
<li><a href="../zh-CN496188/index.html">å¦‚ä½•åœæ­¢ç‹‚æ¬¢çœ‹ç”µè§†èŠ‚ç›®å¹¶å¼€å§‹ç”Ÿæ´»</a></li>
<li><a href="../zh-CN496190/index.html">å…³äºçŸ­è¯­åŠ¨è¯2</a></li>
<li><a href="../zh-CN496192/index.html">ä»Goè°ƒç”¨Rustå‡½æ•°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>