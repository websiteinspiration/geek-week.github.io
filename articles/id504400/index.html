<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍⚖️ 🙌🏻 🕥 Caching. Bagian 2: 60 hari sebelum rilis 🙅🏽 🎱 🛬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo! Saya sudah menulis kepada Anda tentang bagaimana mempromosikan inisiatif dalam sebuah perusahaan. Lebih tepatnya, bagaimana (kadang-kadang) ini ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Caching. Bagian 2: 60 hari sebelum rilis</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/504400/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo! </font><font style="vertical-align: inherit;">Saya sudah menulis kepada Anda tentang bagaimana mempromosikan inisiatif dalam sebuah perusahaan. </font><font style="vertical-align: inherit;">Lebih tepatnya, bagaimana (kadang-kadang) ini berhasil, dan kesulitan apa yang mungkin timbul: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retrospektif penggaruk. </font><font style="vertical-align: inherit;">Bagaimana solusi buatan sendiri ternyata lebih keren daripada solusi berbayar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana kami memilih sistem caching. </font><font style="vertical-align: inherit;">Bagian 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hari ini saya ingin melanjutkan dan berbicara tentang momen psikologis yang paling menegangkan dalam proyek itu, tentang mana dua artikel pertama - ketika hasil dari proyek ditentukan bukan oleh keterampilan teknis tim, melainkan kepercayaan pada perhitungan dan kemauan mereka untuk mencapai tujuan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harus mengatakan - saya pikir untuk membawa proyek ke momen yang intens - itu adalah kesalahan yang jauh digunakan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lshaya daripada heroisme dengan merentangkan proyek dari masalah ini ....</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi, saya tidak menyembunyikan pengalaman ini dan rela membagikannya - karena saya mempertimbangkan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tepatnya area bermasalah adalah titik pertumbuhan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masalah terbesar "tiba" tepatnya dari tempat yang tidak Anda harapkan</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kombinasi dari poin-poin ini - hanya mengharuskan Anda untuk berbagi pengalaman indah tentang "cara mendapatkan selokan tiba-tiba." </font><font style="vertical-align: inherit;">Tapi, perlu dicatat, situasi yang serupa luar biasa di perusahaan Sportmaster. </font><font style="vertical-align: inherit;">Artinya, ada kemungkinan bahwa situasi ini akan terjadi lagi - perencanaan dan definisi tanggung jawab sekarang - pada tingkat yang sama sekali berbeda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, sepertinya perkenalan sudah cukup, jika Anda siap - selamat datang di kucing.</font></font><br>
 <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/sa/3o/8k/sa3o8kskmgz_ptdsflpadmiycra.png"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juni 2017 </font><font style="vertical-align: inherit;">Kami memodifikasi panel admin. </font><font style="vertical-align: inherit;">Panel admin tidak hanya seperangkat formulir dan tabel di antarmuka web - nilai yang dimasukkan harus direkatkan dengan puluhan data lain yang kami dapatkan dari sistem pihak ketiga. </font><font style="vertical-align: inherit;">Plus, entah bagaimana mengubah dan, akhirnya, mengirimkannya kepada konsumen (yang utamanya adalah situs ElasticSearch Sportmaster). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesulitan utama hanya untuk mengkonversi dan mengirim. </font><font style="vertical-align: inherit;">Yaitu:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda perlu menyediakan data dalam bentuk json, yang masing-masing berbobot 100Kb, dan beberapa muncul hingga 10MB (memindai ketersediaan dan kriteria pengiriman barang ke toko)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ada json dengan struktur yang memiliki lampiran rekursif dari setiap tingkat sarang (misalnya, menu di dalam item menu, di mana ada item menu lagi, dll.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pernyataan akhir tidak disetujui dan terus berubah (misalnya, bekerja dengan barang oleh Model digantikan oleh pendekatan ketika kami bekerja dengan Model Warna). </font><font style="vertical-align: inherit;">Secara konstan - ini beberapa kali seminggu, dengan tingkat puncak 2 kali sehari selama seminggu.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika 2 poin pertama adalah murni teknis, dan ditentukan oleh tugas itu sendiri, maka dengan poin ke-3, tentu saja, Anda harus menghadapinya secara organisasi. </font><font style="vertical-align: inherit;">Tapi, dunia nyata jauh dari ideal, jadi kami bekerja dengan apa yang kami miliki. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yaitu, mereka menemukan cara cepat memusatkan formulir web dan objek mereka di sisi server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu orang dari tim ditunjuk untuk peran "tamparan formulir" profesional dan, menggunakan komponen web yang disiapkan, meluncurkan demo untuk ui lebih cepat daripada analis mengoreksi gambar ui ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi untuk mengubah skema transformasi, kompleksitas muncul di sini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kami pergi dengan cara biasa - untuk melakukan transformasi dalam sql-query ke Oracle. Ada spesialis DB di tim. Itu berlangsung sampai saat ketika permintaan adalah 2 halaman teks sql kontinu. Saya bisa terus dan terus, tetapi ketika perubahan datang dari analis - secara objektif, hal yang paling sulit adalah menemukan tempat di mana membuat perubahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analis menyatakan aturan dalam skema, yang, meskipun mereka dicat dalam sesuatu yang terlepas dari kode (sesuatu dari visio / draw.io / gliffy), tetapi ada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">begitu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mirip dengan kotak dan panah di sistem ETL (misalnya, Pentaho Kettle, yang pada waktu itu digunakan untuk memasok data ke situs web Sportmaster). Sekarang, jika kita tidak memiliki query SQL, tetapi skema ETL! Kemudian pernyataan dan solusinya akan dinyatakan secara topologis identik, yang berarti bahwa mengedit kode dapat memakan waktu sebanyak mengedit pernyataan!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi dengan sistem ETL ada kesulitan lain. Ketel Pentaho yang sama - sangat bagus ketika Anda perlu membuat indeks baru di ElasticSearch, di mana untuk menulis semua data yang dilem dari beberapa sumber (komentar: sebenarnya, Ketel Pentaho yang tidak berfungsi dengan baik, karena tidak menggunakan javascript dalam transformasi terkait dengan kelas java di mana konsumen mengakses data - karena ini, Anda dapat menulis sesuatu yang Anda tidak dapat berubah menjadi objek pojo yang diperlukan nanti, tetapi ini adalah topik yang terpisah, jauh dari jalan utama artikel). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi apa yang harus dilakukan ketika di panel admin pengguna mengoreksi satu bidang dalam satu dokumen? Untuk mengirimkan perubahan ini ke situs web ElasticSearch Sportmaster, jangan buat indeks baru untuk mengisi semua dokumen jenis ini, termasuk yang diperbarui!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin bahwa ketika satu objek dalam data input berubah, maka kirim pembaruan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ke</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ElasticSearch situs </font><i><font style="vertical-align: inherit;">hanya</font></i><font style="vertical-align: inherit;"> untuk dokumen output yang sesuai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oke, dokumen masukan itu sendiri, tapi bagaimanapun, sesuai dengan skema transformasi, itu bisa dilampirkan ke dokumen dari jenis yang berbeda melalui bergabung! Jadi, Anda perlu menganalisis skema transformasi dan menghitung dokumen keluaran mana yang akan dipengaruhi oleh perubahan data di sumber. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pencarian produk kotak untuk mengatasi masalah ini tidak mengarah pada apa pun. Tidak ditemukan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ketika mereka putus asa untuk menemukan, mereka menemukan jawabannya, tetapi bagaimana cara kerjanya di dalam, dan bagaimana ini bisa dilakukan? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gagasan muncul segera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika ETL akhir dapat dipecah menjadi bagian-bagian penyusunnya, yang masing-masing memiliki tipe tertentu dari himpunan terbatas (misalnya, filter, gabung, dll.), Maka dimungkinkan untuk membuat himpunan node khusus yang terbatas yang sama yang sesuai dengan yang asli, tetapi dengan perbedaan bahwa mereka bekerja bukan dengan data itu sendiri, tetapi dengan perubahan mereka? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara terperinci, dengan contoh dan poin utama dalam implementasi, solusi kami - saya ingin membahas dalam artikel terpisah. Untuk menghadapi posisi pendukung - ini akan membutuhkan perendaman serius, kemampuan untuk berpikir secara abstrak dan mengandalkan apa yang belum terwujud. Memang, itu akan menarik justru dari sudut pandang matematika dan menarik hanya untuk orang-orang Habrovit yang tertarik pada </font><font style="vertical-align: inherit;">detail </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teknis</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini saya hanya bisa mengatakan bahwa kami membuat model matematika di mana kami menggambarkan 7 jenis node dan menunjukkan bahwa sistem ini lengkap - yaitu, menggunakan 7 jenis node dan koneksi di antara mereka - skema transformasi data apa pun dapat diekspresikan. </font><font style="vertical-align: inherit;">Implementasinya didasarkan pada penggunaan aktif untuk memperoleh dan merekam data dengan kunci (yaitu dengan kunci, tanpa syarat tambahan). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, solusi kami memiliki titik kuat mengenai semua kesulitan pengantar:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data harus diberikan dalam bentuk json -&gt; kita bekerja dengan objek pojo (objek java lama polos, jika seseorang tidak menemukan waktu ketika penunjukan tersebut digunakan), yang mudah untuk menyalip di json</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ada json dengan struktur yang memiliki embeddings rekursif dari setiap tingkat sarang -&gt; lagi, pojo (hal utama adalah bahwa tidak ada loop, tetapi berapa banyak tingkat sarang tidak penting, mudah untuk memproses di Jawa melalui rekursi)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pernyataan terakhir terus berubah -&gt; sangat baik, karena kami mengubah skema transformasi lebih cepat daripada keinginan analis (dalam diagram) untuk eksperimen</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari saat-saat berisiko, hanya satu - kita menulis solusinya dari awal, atas keinginan kita sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, jebakan itu tidak lama datang.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Momen spesial N1. </font><font style="vertical-align: inherit;">Perangkap. </font><font style="vertical-align: inherit;">“Diperkirakan dengan baik”</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kejutan lain yang bersifat organisasional adalah bahwa pada saat yang sama dengan perkembangan kami, repositori master utama pindah ke versi baru, dan format di mana repositori ini menyediakan data berubah. Dan alangkah baiknya jika sistem kami segera bekerja dengan penyimpanan baru, dan tidak dengan yang lama. Tetapi penyimpanan baru belum siap. Tapi kemudian, struktur data diketahui dan mereka bisa memberi kita demo di mana sejumlah kecil data terkait akan dituangkan. Pergi? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, di dalam pendekatan produk, ketika bekerja dengan aliran pasokan nilai, sebuah peringatan secara tegas dipalu ke semua optimis: ada pemblokir -&gt; tugas tidak bekerja, titik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi kemudian, ketergantungan seperti itu bahkan tidak menimbulkan kecurigaan. Memang, kami gembira dari kesuksesan dengan prosesor Delta prototipe - sistem untuk memproses data delta (implementasi model matematika ketika perubahan dalam data output dihitung menggunakan skema transformasi sebagai respons terhadap perubahan dalam input data). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di antara semua skema transformasi, satu adalah yang paling penting. Selain fakta bahwa sirkuit itu sendiri adalah yang terbesar dan paling kompleks, ada juga persyaratan ketat untuk transformasi yang harus dilakukan sesuai dengan sirkuit ini - batas waktu pada pelaksanaan jumlah penuh data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, transformasi harus dilakukan 15 menit dan tidak lebih lama. Input utama adalah tabel dengan 5,5 juta catatan. Pada tahap pengembangan, tabel belum diisi. Lebih tepatnya, itu diisi dengan data uji kecil yang ditetapkan dalam jumlah 10 ribu baris.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baiklah, mari kita mulai. Dalam implementasi pertama, prosesor Delta bekerja pada HashMap sebagai penyimpanan Nilai-Kunci (izinkan saya mengingatkan Anda, kami perlu membaca dan menulis banyak objek dengan kunci). Tentu saja, bahwa pada volume produksi, semua objek perantara tidak akan muat di memori - karena itu, alih-alih HashMap, kami beralih ke Hazelcast. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengapa persis Hazelcast - jadi karena produk ini sudah dikenal, digunakan di backend ke situs Sportmaster. Plus, ini adalah sistem terdistribusi dan, seperti yang terlihat bagi kami - jika seorang teman melakukan sesuatu yang salah dengan kinerja - kami menambahkan lebih banyak contoh ke beberapa mesin dan masalah terselesaikan. Dalam kasus ekstrim - selusin mobil. Penskalaan horisontal dan semua hal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami meluncurkan prosesor Delta kami untuk transformasi yang ditargetkan. Ini bekerja hampir secara instan. Ini bisa dimengerti - datanya hanya 10 ribu bukannya 5,5 juta. Oleh karena itu, kami mengalikan waktu yang diukur dengan 550, dan kami mendapatkan hasilnya: sekitar 2 menit. Baik! Bahkan - kemenangan! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah awal dari pekerjaan proyek - tepat ketika Anda perlu memutuskan arsitektur, mengkonfirmasi hipotesis (melakukan tes yang mengkonfirmasi mereka), mengintegrasikan solusi pilot secara vertikal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena tes menunjukkan hasil yang sangat baik - yaitu, kami mengkonfirmasi semua hipotesis, kami dengan cepat membalikkan pilot - menyatukan "kerangka" yang terintegrasi secara vertikal untuk sebagian kecil fungsi. Dan mereka memulai pengkodean utama - mengisi "kerangka dengan daging."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang berhasil dan bersemangat terlibat. Hingga hari yang indah itu, ketika satu </font><font style="vertical-align: inherit;">set data </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lengkap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diunggah ke toko induk </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan tes pada set ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah 2 menit tidak berhasil. Saya juga tidak bekerja setelah 5, 10, 15 menit. Artinya, mereka tidak cocok dengan kerangka kerja yang diperlukan. Tetapi, dengan siapa hal itu tidak terjadi, akan perlu untuk men-tweak sesuatu secara detail dan bugar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi tes tidak bekerja satu jam kemudian. Dan bahkan setelah 2 jam ada harapan bahwa dia akan bekerja, dan kami akan mencari apa yang diperketat. Sisa-sisa harapan bahkan setelah 5 jam. Tapi, setelah 10 jam, ketika mereka pulang, tetapi tes masih tidak berhasil - tidak ada harapan lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalahnya adalah bahwa pada hari berikutnya, ketika mereka datang ke kantor, tes masih rajin bekerja. Akibatnya, itu bergulir selama 30 jam, tidak menunggu, dimatikan.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malapetaka! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalahnya terlokalisasi dengan cukup cepat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hazelcast - ketika mengerjakan sejumlah kecil data - sebenarnya menggulirkan semua yang ada dalam memori. </font><font style="vertical-align: inherit;">Tetapi ketika diminta untuk membuang data pada disk - kinerja dicelupkan ribuan kali. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemrograman akan menjadi pekerjaan yang membosankan dan hambar, jika bukan karena pihak berwenang dan kewajiban untuk memberikan produk jadi. </font><font style="vertical-align: inherit;">Jadi kami, secara harfiah sehari kemudian, setelah kami menerima set data lengkap - kita perlu pergi ke pihak berwenang dengan laporan tentang bagaimana tes pada volume produksi berlalu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah pilihan yang sangat serius dan sulit:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">katakan “apa adanya” = tinggalkan proyek</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">katakan "sesuka saya" = untuk mengambil risiko, mungkin, tidak diketahui apakah kami dapat memperbaiki masalahnya</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memahami perasaan apa yang muncul dalam kasus ini, hanya mungkin untuk sepenuhnya berinvestasi dalam ide, untuk merealisasikan rencana selama setengah tahun, untuk menciptakan produk yang akan membantu rekan kerja memecahkan lapisan besar masalah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, menyerahkan ciptaan Anda yang tercinta sangat sulit. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah karakteristik semua orang - kami menyukai apa yang telah kami lakukan dengan banyak upaya. Oleh karena itu, sulit untuk mendengar kritik - Anda harus secara sadar melakukan upaya untuk menerima umpan balik secara memadai.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, kami memutuskan bahwa masih ada sangat, sangat banyak sistem berbeda yang dapat digunakan sebagai penyimpanan Nilai-Kunci, dan jika Hazelcast tidak cocok, maka sesuatu pasti akan berfungsi. </font><font style="vertical-align: inherit;">Artinya, mereka memutuskan untuk mengambil risiko. </font><font style="vertical-align: inherit;">Untuk pembenaran kita, kita dapat mengatakan bahwa itu belum "tenggat waktu berdarah" - secara umum, masih ada sedikit waktu untuk "pindah" ke solusi cadangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada pertemuan dengan bos-bos itu, manajer kami mengindikasikan bahwa "tes menunjukkan bahwa sistem bekerja dengan stabil pada volume produksi, tidak rusak". </font><font style="vertical-align: inherit;">Memang, sistem bekerja dengan stabil. </font><u><font style="vertical-align: inherit;">60</font></u><font style="vertical-align: inherit;"> hari </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
untuk rilis </font><font style="vertical-align: inherit;">.</font></font><u><font style="vertical-align: inherit;"></font></u><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Momen spesial N2. </font><font style="vertical-align: inherit;">Bukan jebakan, tapi bukan penemuan. </font><font style="vertical-align: inherit;">"Kurang itu lebih"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menemukan pengganti Hazelcast dengan peran data warehouse Key-Value, kami menyusun daftar semua kandidat - kami mendapat daftar 31 produk. Ini semua yang saya berhasil google dan cari tahu dari teman-teman saya. Selanjutnya, Google memberikan beberapa opsi yang benar-benar cabul, seperti makalah siswa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menguji kandidat lebih cepat, kami menyiapkan tes kecil yang, dalam beberapa menit peluncuran, menunjukkan kinerja pada volume yang tepat. Dan mereka memparalelkan pekerjaan - semua orang mengambil sistem berikutnya dari daftar, mengonfigurasi, menjalankan tes, mengambil yang berikutnya. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mereka bekerja dengan cepat, mematikan beberapa sistem sehari.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada sistem ke-18, menjadi jelas bahwa ini tidak ada gunanya. Di bawah profil beban kami - tidak ada sistem ini yang dipertajam. Mereka memiliki banyak kerutan dan garis untuk membuatnya nyaman digunakan, banyak pendekatan indah untuk penskalaan horizontal - tetapi ini tidak memberi kita keuntungan apa pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membutuhkan sistem yang _fast_ menyimpan kunci ke objek pada disk dan membaca kunci dengan cepat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika demikian, kami menguraikan algoritme tentang bagaimana ini dapat diterapkan. Secara umum, tampaknya cukup layak - jika pada saat yang sama: a) mengorbankan jumlah data yang akan menempati disk, b) memiliki perkiraan jumlah dan ukuran karakteristik data di setiap tabel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sesuatu yang bergaya, mengalokasikan memori (pada disk) untuk objek dengan margin, potongan volume maksimum tetap. Kemudian gunakan tabel indeks ... dan seterusnya ...</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beruntung tidak sampai seperti ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keselamatan datang dalam bentuk RocksDB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah produk dari Facebook yang dirancang untuk membaca cepat dan menyimpan berbagai byte ke disk. Pada saat yang sama, akses ke file disediakan melalui antarmuka yang mirip dengan penyimpanan Key-Value. Faktanya, kuncinya adalah array byte, nilainya array array byte. Dioptimalkan untuk melakukan pekerjaan ini dengan cepat dan andal. Semua. Jika Anda membutuhkan sesuatu yang lebih indah dan tingkat tinggi - mainkan sendiri. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang kita butuhkan!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RocksDB, melesat dalam peran penyimpanan Key-Value - membawa indikator uji target ke level 5 jam. </font><font style="vertical-align: inherit;">Itu jauh dari 15 menit, tetapi hal utama dilakukan. </font><font style="vertical-align: inherit;">Hal utama adalah memahami apa yang terjadi, untuk memahami bahwa menulis ke disk secepat mungkin, lebih cepat daripada tidak mungkin. </font><font style="vertical-align: inherit;">Pada SSD, dalam pengujian yang disempurnakan, RocksDB memeras 400Mb / s, dan itu sudah cukup untuk tugas kami. </font><font style="vertical-align: inherit;">Penundaan - di suatu tempat di kita, dalam kode yang mengikat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font><font style="vertical-align: inherit;">kode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kita</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang berarti kita bisa mengatasinya. </font><font style="vertical-align: inherit;">Mari kita pisahkan, tapi kita bisa mengatasinya.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Momen spesial N3. </font><font style="vertical-align: inherit;">Dukung. </font><font style="vertical-align: inherit;">"Perhitungan teoretis"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki algoritma dan input. Kami mengambil rentang input data, menghitung berapa banyak tindakan yang harus dilakukan sistem, bagaimana tindakan ini dinyatakan dalam biaya run-time JVM (menetapkan nilai ke variabel, memasukkan metode, membuat objek, menyalin array byte, dll.), Ditambah berapa banyak panggilan ke RocksDB harus diadakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut perhitungan, ternyata mereka harus bertemu 2 menit (kira-kira, seperti yang ditunjukkan tes untuk HashMap di awal, tapi ini hanya kebetulan - algoritme telah berubah sejak saat itu). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, tes berjalan selama 5 jam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang, sebelum rilis </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hari. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah tanggal khusus - sekarang tidak mungkin untuk runtuh - kita tidak akan punya waktu untuk beralih ke opsi cadangan.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, pada hari ini manajer proyek dipanggil ke pihak berwenang. Pertanyaannya sama - punya waktu, apakah semuanya baik-baik saja? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ip/ci/ps/ipcipst6tfldoo7vmigaxcmsmta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah cara terbaik untuk menggambarkan situasi ini - gambar sampul diperpanjang untuk artikel ini. Artinya, bos diperlihatkan bagian gambar yang diberikan dalam judul. Namun dalam kenyataannya - seperti itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun, pada kenyataannya, tentu saja - kami sama sekali tidak lucu. Dan katakan bahwa "Semuanya keren!" - ini hanya mungkin bagi seseorang dengan keterampilan penguasaan diri yang sangat kuat. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hormat, sangat besar untuk manajer, untuk percaya, percaya pengembang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sungguh, kode benar-benar tersedia - menunjukkan 5 jam. Perhitungan teoritis - menunjukkan 2 menit. Bagaimana ini bisa dipercaya?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi itu mungkin jika: model dirumuskan dengan jelas, bagaimana cara menghitung dapat dipahami, dan nilai apa yang harus diganti juga bisa dimengerti. Artinya, kenyataan bahwa dalam kenyataannya eksekusi membutuhkan lebih banyak waktu berarti bahwa dalam kenyataannya bukan kode yang kita harapkan untuk dieksekusi di sana yang dieksekusi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas utama adalah menemukan "pemberat" dalam kode. Artinya, beberapa tindakan dilakukan selain aliran utama pembuatan data akhir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terburu-buru. Tes unit, komposisi fungsional, fragmentasi fungsi dan lokalisasi tempat dengan jumlah waktu yang tidak proporsional yang dihabiskan untuk pelaksanaan. Banyak hal telah dilakukan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepanjang jalan, kami merumuskan tempat-tempat di mana Anda dapat mengencangkannya dengan serius.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, serialisasi. </font><font style="vertical-align: inherit;">Pertama kali menggunakan java.io. standar </font><font style="vertical-align: inherit;">Tetapi jika kita mempercepat Cryo, maka dalam kasus kita, kita mendapatkan peningkatan 2,5 kali lipat dalam kecepatan serialisasi dan pengurangan 3 kali lipat dalam volume data serial (yang berarti IO 3 kali lebih kecil, yang hanya memakan sumber daya utama). </font><font style="vertical-align: inherit;">Tetapi, secara lebih rinci, ini adalah topik untuk artikel teknis yang terpisah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi poin kuncinya, atau "tempat gajah bersembunyi" - saya akan coba uraikan dalam satu paragraf.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poin khusus 4. Penerimaan untuk menemukan solusi. </font><font style="vertical-align: inherit;">“Masalah = Solusi”</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika kita mendapatkan / mengatur dengan kunci - dalam perhitungan itu berjalan sebagai 1 operasi, mempengaruhi IO dalam volume yang sama dengan kunci + nilai objek (dalam bentuk serial, tentu saja). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi bagaimana jika objek itu sendiri yang kita panggil get / set adalah Map, yang juga kita dapatkan dengan get / set dari disk. Berapa banyak IO akan dilakukan dalam kasus ini? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam perhitungan kami, fitur ini tidak diperhitungkan. Artinya, itu dianggap sebagai 1 IO untuk kunci + objek-nilai. Tetapi faktanya?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, dalam penyimpanan Nilai-Kunci, dengan kunci-1 ada objek obj-1 dengan tipe Map, di mana objek obj-2 tertentu harus disimpan di bawah kunci key-2. Di sini kami berpikir bahwa operasi akan membutuhkan IO untuk key-2 + obj-2. Namun pada kenyataannya, Anda perlu mempertimbangkan obj-1, memanipulasinya dan mengirimkannya ke IO: key-1 + obj-1. Dan jika itu adalah Peta di mana ada 1000 objek, maka konsumsi IO akan menjadi sekitar 1000 kali lebih banyak. Dan jika 10.000 objek, maka ... Begitulah cara mereka mendapatkan "pemberat". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika masalah diidentifikasi, solusinya biasanya jelas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus kami, ini telah menjadi struktur khusus untuk manipulasi di dalam Peta bersarang. </font><font style="vertical-align: inherit;">Yaitu, Nilai-Kunci seperti itu, yang untuk mendapatkan / mengatur mengambil dua kunci sekaligus, yang harus diterapkan secara berurutan: kunci-1, kunci-2 - yaitu, untuk tingkat pertama dan untuk yang bersarang. </font><font style="vertical-align: inherit;">Bagaimana menerapkan struktur seperti itu - saya akan memberi tahu Anda secara detail dengan senang hati, tetapi sekali lagi, dalam artikel teknis yang terpisah. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, dari episode ini, saya menekankan dan mempromosikan fitur seperti itu: masalah yang sangat terperinci adalah solusi yang baik.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyelesaian</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel ini, saya mencoba menunjukkan poin dan jebakan organisasi yang mungkin muncul. </font><font style="vertical-align: inherit;">Perangkap seperti itu sangat jelas terlihat "dari samping" atau seiring waktu, tetapi sangat mudah untuk masuk ke dalamnya ketika Anda pertama kali menemukan diri Anda di sebelahnya. </font><font style="vertical-align: inherit;">Saya harap seseorang akan mengingat deskripsi seperti itu, dan pada saat yang tepat pengingat akan bekerja, "Saya pernah mendengar sesuatu seperti itu di suatu tempat sebelumnya." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan, yang paling penting - sekarang semuanya diceritakan tentang prosesnya, tentang momen psikologis, tentang momen organisasi. </font><font style="vertical-align: inherit;">Sekarang kami memiliki gagasan tentang tugas apa dan dalam kondisi apa sistem dibuat. </font><font style="vertical-align: inherit;">Sekarang - Anda dapat dan harus memberi tahu tentang sistem dari sisi teknis - model matematika seperti apa ini, dan trik apa dalam kode yang kami gunakan, dan solusi inovatif apa yang kami pikirkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentang ini di artikel selanjutnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sementara itu, Selamat Kode Baru!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id504374/index.html">Traversal grafik sederhana: pencarian mendalam dan luas-pertama menggunakan JavaScript sebagai contoh</a></li>
<li><a href="../id504382/index.html">Bagaimana saya (PhD Neurobiologi) menjadi Ilmuwan Data dalam 6 bulan</a></li>
<li><a href="../id504384/index.html">Secara bertahap perkenalkan TypeScript ke dalam proyek React Anda</a></li>
<li><a href="../id504386/index.html">Vassbotn H. Kelas Variabel Virtual</a></li>
<li><a href="../id504392/index.html">Berapa banyak programmer dan kata-kata yang Anda butuhkan untuk mengenali paspor tulisan tangan?</a></li>
<li><a href="../id504402/index.html">29 Mei Java Digest</a></li>
<li><a href="../id504408/index.html">Templat kerangka kerja pengujian yang sederhana dan nyaman pada selenide untuk autotest UI</a></li>
<li><a href="../id504412/index.html">Kejuaraan pemrograman online "Open Finals of Moscow Training"</a></li>
<li><a href="../id504414/index.html">Bagaimana Microsoft Membunuh AppGet</a></li>
<li><a href="../id504420/index.html">Menulis arena PvP berbasis giliran dengan gerakan simultan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>