<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎠 🚃 ⌛️ Aeronetエピソード3の開始：ボールを見つける 🧗 📖 ⏺️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今日は、Raspberry PIカメラで赤いボールを検出する方法と、ドローンをそれに向ける方法を見ていきます。
 
 

以前の記事では、自律型の仮想ドローンと実際のドローンの打ち上げを詳細に検討しました。ドローンが本当の目標を見つける時が来ました。
 先に述べたように、目標は赤いボールです。
 ラ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aeronetエピソード3の開始：ボールを見つける</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462923/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日は、Raspberry PIカメラで赤いボールを検出する方法と、ドローンをそれに向ける方法を見ていきます。</font></font><br>
<img src="https://habrastorage.org/webt/zd/kx/lw/zdkxlwtyy5po69awqvocprrbivq.png" alt="風船を検索"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前の記事では、自律型の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドローン</font><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドローンの</font><font style="vertical-align: inherit;">打ち上げを詳細に検討しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ドローンが本当の目標を見つける時が来ました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に述べたように、目標は赤いボールです。</font></font></p><br>
<h2 id="podgotovka-raspberry"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラズベリーの準備</font></font></h2><br>
<p>       Desktop –  Raspbian.              .<br>
    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Desktop- Raspbian</a>.<br>
    Raspbian   ++,   Raspberry,    .      headless-Raspberry   ,  VNC.<br>
  :</p><br>
<ol>
<li> VNC  raspi-config</li>
<li>   Wifi  raspberry.   wpa_supplicant     ,    wifi   Raspberry  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</li>
<li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">realvnc</a>.</li>
</ol><br>
<p>     —  OpenCV:</p><br>
<pre><code class="bash hljs">sudo apt-get install python-opencv
</code></pre><br>
<h2 id="hsv-filtr-dlya-videopotoka">HSV   </h2><br>
<p>          –    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  HSV</a>,   –      (Hue),  (Saturation)   (value),   cv2.inRange.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.</p><br>
<p>     ,     – ,         (HUE),  ,       :<br>
<img src="https://habrastorage.org/webt/ep/ha/i4/ephai4xomvv7ouhb3igivfeaxfe.png" alt="HSVスケール"></p><br>
<p>       –      «»  ,       .   H, S  V        invert –       ,     .</p><br>
<div class="spoiler"><b class="spoiler_title">    :</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nothing</span>(<span class="hljs-params">*arg</span>):</span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
cv2.namedWindow( <span class="hljs-string">"result"</span> ) <span class="hljs-comment">#   </span>
cv2.namedWindow( <span class="hljs-string">"img"</span> ) <span class="hljs-comment">#  </span>
cv2.namedWindow( <span class="hljs-string">"settings"</span> ) <span class="hljs-comment">#   </span><font></font>
<font></font>
cap = cv2.VideoCapture(<span class="hljs-number">0</span>)<span class="hljs-comment">#video.create_capture(0)</span>
<span class="hljs-comment">#  6        </span>
cv2.createTrackbar(<span class="hljs-string">'invert'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'s1'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'v1'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'h2'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'s2'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'v2'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, nothing)<font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    flag, img = cap.read()<font></font>
    hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV )<font></font>
    <span class="hljs-comment">#   </span>
    invert = cv2.getTrackbarPos(<span class="hljs-string">'invert'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    h1 = cv2.getTrackbarPos(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    s1 = cv2.getTrackbarPos(<span class="hljs-string">'s1'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    v1 = cv2.getTrackbarPos(<span class="hljs-string">'v1'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    h2 = cv2.getTrackbarPos(<span class="hljs-string">'h2'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    s2 = cv2.getTrackbarPos(<span class="hljs-string">'s2'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    v2 = cv2.getTrackbarPos(<span class="hljs-string">'v2'</span>, <span class="hljs-string">'settings'</span>)
    <span class="hljs-comment">#      </span><font></font>
    h_min = np.array((h1, s1, v1), np.uint8)<font></font>
    h_max = np.array((h2, s2, v2), np.uint8)<font></font>
<font></font>
    <span class="hljs-comment">#       HSV</span><font></font>
    thresh = cv2.inRange(hsv, h_min, h_max)<font></font>
    <span class="hljs-keyword">if</span> invert&gt;<span class="hljs-number">0</span>:<font></font>
        cv2.bitwise_not(thresh,thresh)<font></font>
<font></font>
    cv2.imshow(<span class="hljs-string">'result'</span>, thresh) <font></font>
    cv2.imshow(<span class="hljs-string">'img'</span>, img) <font></font>
<font></font>
    ch = cv2.waitKey(<span class="hljs-number">5</span>)
    <span class="hljs-keyword">if</span> ch == <span class="hljs-number">27</span>:
        <span class="hljs-keyword">break</span><font></font>
<font></font>
cap.release()<font></font>
cv2.destroyAllWindows()</code></pre></div></div><br>
<p>      :</p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/DlWqoHN2omM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h2 id="raschyot-polozheniya-sharika-v-prostranstve">    </h2><br>
<p> ,             <code>cv2.findContours</code>.</p><br>
<p>       ,  ,   1010 ,       –     .       –     , ..  .</p><br>
<p>      :         ,     (  ),          ,    .  ,      «» +      –      .</p><br>
<div class="spoiler"><b class="spoiler_title">     :</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#coding=utf-8</span>
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> math<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nothing</span>(<span class="hljs-params">*arg</span>):</span>
        <span class="hljs-keyword">pass</span><font></font>
<font></font>
cv2.namedWindow( <span class="hljs-string">"result"</span> ) <span class="hljs-comment">#   </span>
cv2.namedWindow( <span class="hljs-string">"source"</span> ) <span class="hljs-comment"># source video</span>
cv2.namedWindow( <span class="hljs-string">"settings"</span> ) <span class="hljs-comment">#   </span><font></font>
<font></font>
cap = cv2.VideoCapture(<span class="hljs-number">0</span>)<font></font>
cap.set(cv2.CAP_PROP_FRAME_WIDTH, <span class="hljs-number">320</span>)<font></font>
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, <span class="hljs-number">240</span>)<font></font>
cap.set(cv2.CAP_PROP_FPS,<span class="hljs-number">40</span>)<font></font>
<font></font>
<span class="hljs-comment">#  6        </span>
cv2.createTrackbar(<span class="hljs-string">'invert'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'s1'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'v1'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'h2'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'s2'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, nothing)<font></font>
cv2.createTrackbar(<span class="hljs-string">'v2'</span>, <span class="hljs-string">'settings'</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, nothing)<font></font>
crange = [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<font></font>
<font></font>
<span class="hljs-comment">#set up initial values</span>
cv2.setTrackbarPos(<span class="hljs-string">'invert'</span>,<span class="hljs-string">'settings'</span>,<span class="hljs-number">1</span>)<font></font>
cv2.setTrackbarPos(<span class="hljs-string">'h1'</span>,<span class="hljs-string">'settings'</span>,<span class="hljs-number">7</span>)<font></font>
cv2.setTrackbarPos(<span class="hljs-string">'h2'</span>,<span class="hljs-string">'settings'</span>,<span class="hljs-number">158</span>)<font></font>
cv2.setTrackbarPos(<span class="hljs-string">'s1'</span>,<span class="hljs-string">'settings'</span>,<span class="hljs-number">0</span>)<font></font>
cv2.setTrackbarPos(<span class="hljs-string">'s2'</span>,<span class="hljs-string">'settings'</span>,<span class="hljs-number">255</span>)<font></font>
cv2.setTrackbarPos(<span class="hljs-string">'v1'</span>,<span class="hljs-string">'settings'</span>,<span class="hljs-number">0</span>)<font></font>
cv2.setTrackbarPos(<span class="hljs-string">'v2'</span>,<span class="hljs-string">'settings'</span>,<span class="hljs-number">255</span>)<font></font>
<font></font>
color_blue = (<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>)<font></font>
color_red = (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>)<font></font>
color_green = (<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>)<font></font>
color_white = (<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>)<font></font>
color_yellow = (<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>)<font></font>
color_black = (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<font></font>
real_ballon_r = <span class="hljs-number">0.145</span> <span class="hljs-comment">#baloon real radius in meters</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
    flag, img = cap.read()<font></font>
    hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV )<font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    invert = cv2.getTrackbarPos(<span class="hljs-string">'invert'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    h1 = cv2.getTrackbarPos(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    s1 = cv2.getTrackbarPos(<span class="hljs-string">'s1'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    v1 = cv2.getTrackbarPos(<span class="hljs-string">'v1'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    h2 = cv2.getTrackbarPos(<span class="hljs-string">'h2'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    s2 = cv2.getTrackbarPos(<span class="hljs-string">'s2'</span>, <span class="hljs-string">'settings'</span>)<font></font>
    v2 = cv2.getTrackbarPos(<span class="hljs-string">'v2'</span>, <span class="hljs-string">'settings'</span>)<font></font>
<font></font>
    <span class="hljs-comment">#      </span><font></font>
    h_min = np.array((h1, s1, v1), np.uint8)<font></font>
    h_max = np.array((h2, s2, v2), np.uint8)<font></font>
<font></font>
    <span class="hljs-comment">#       HSV</span><font></font>
    thresh = cv2.inRange(hsv, h_min, h_max)<font></font>
    <span class="hljs-keyword">if</span> invert&gt;<span class="hljs-number">0</span>:<font></font>
        cv2.bitwise_not(thresh,thresh)<font></font>
    <span class="hljs-comment">#find contours</span><font></font>
    _, contours0, hierarchy = cv2.findContours( thresh.copy(), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_NONE)<font></font>
    max_area = <span class="hljs-number">0</span>
    max_center_x=<span class="hljs-literal">None</span>
    max_center_y=<span class="hljs-literal">None</span>
    max_baloon_r=<span class="hljs-literal">None</span>
    max_yaw_shift=<span class="hljs-literal">None</span>
    <span class="hljs-keyword">for</span> cnt <span class="hljs-keyword">in</span> contours0:<font></font>
        rect = cv2.minAreaRect(cnt)<font></font>
        box = cv2.boxPoints(rect)<font></font>
        box = np.int0(box)<font></font>
        center = (int(rect[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]),int(rect[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]))<font></font>
        area = int(rect[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]*rect[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])
        <span class="hljs-keyword">if</span> area &gt; <span class="hljs-number">100</span>:<font></font>
            baloon_r = int(math.sqrt(area)/<span class="hljs-number">2</span>)<font></font>
            yaw_shift = int( (center[<span class="hljs-number">0</span>] - <span class="hljs-number">320</span>/<span class="hljs-number">2</span>) * <span class="hljs-number">130</span> / <span class="hljs-number">320</span>) <span class="hljs-comment"># 130 degree camera for 320 pics image</span>
            cv2.circle(img, center, baloon_r , color_red, <span class="hljs-number">1</span>)<font></font>
<font></font>
            <span class="hljs-keyword">if</span> area&gt;max_area:<font></font>
                max_area=area<font></font>
                max_center_x = center[<span class="hljs-number">0</span>]<font></font>
                max_center_y = center[<span class="hljs-number">1</span>]<font></font>
                max_baloon_r = baloon_r<font></font>
                max_yaw_shift = yaw_shift<font></font>
<font></font>
    <span class="hljs-comment">#draw main baloon</span>
    <span class="hljs-keyword">if</span> max_area&gt;<span class="hljs-number">0</span>:<font></font>
        cv2.circle(img, (max_center_x,max_center_y), max_baloon_r+<span class="hljs-number">2</span> , color_blue, <span class="hljs-number">2</span>)<font></font>
        cv2.putText(img, <span class="hljs-string">"D=%d"</span> % int(max_baloon_r*<span class="hljs-number">2</span>), (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>, color_red, <span class="hljs-number">1</span>)<font></font>
        cv2.putText(img, <span class="hljs-string">"angle=%d '"</span> % max_yaw_shift, (<span class="hljs-number">10</span>, <span class="hljs-number">40</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>, color_green, <span class="hljs-number">1</span>)<font></font>
        max_distance = real_ballon_r/math.tan(max_baloon_r/<span class="hljs-number">320.0</span>*(math.pi*<span class="hljs-number">160.0</span>/<span class="hljs-number">360.0</span>)) <span class="hljs-comment">#distance to baloon</span>
        <span class="hljs-comment">#print max_distance</span>
        cv2.putText(img, <span class="hljs-string">"%f m"</span> % max_distance, (<span class="hljs-number">10</span>, <span class="hljs-number">60</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>, color_blue, <span class="hljs-number">1</span>)<font></font>
        cv2.line(img, (max_center_x, <span class="hljs-number">1</span>), (max_center_x, <span class="hljs-number">239</span>) , color_white, <span class="hljs-number">1</span>)<font></font>
        cv2.line(img, (<span class="hljs-number">1</span>,max_center_y), (<span class="hljs-number">319</span>, max_center_y) , color_white, <span class="hljs-number">1</span>)<font></font>
<font></font>
    <span class="hljs-comment">#draw target</span>
    cv2.line(img, (<span class="hljs-number">320</span>/<span class="hljs-number">2</span><span class="hljs-number">-10</span>, <span class="hljs-number">240</span>/<span class="hljs-number">2</span><span class="hljs-number">-10</span>), (<span class="hljs-number">320</span>/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>, <span class="hljs-number">240</span>/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>) , color_yellow, <span class="hljs-number">1</span>)<font></font>
    cv2.line(img, (<span class="hljs-number">320</span>/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>, <span class="hljs-number">240</span>/<span class="hljs-number">2</span><span class="hljs-number">-10</span>), (<span class="hljs-number">320</span>/<span class="hljs-number">2</span><span class="hljs-number">-10</span>, <span class="hljs-number">240</span>/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>) , color_yellow, <span class="hljs-number">1</span>)
    <span class="hljs-comment"># show results</span>
    cv2.imshow(<span class="hljs-string">'source'</span>, img) <font></font>
    cv2.imshow(<span class="hljs-string">'result'</span>, thresh) <font></font>
<font></font>
    ch = cv2.waitKey(<span class="hljs-number">5</span>)
    <span class="hljs-keyword">if</span> ch == <span class="hljs-number">27</span>:
        <span class="hljs-keyword">break</span><font></font>
<font></font>
cap.release()<font></font>
cv2.destroyAllWindows()</code></pre></div></div><br>
<p>              ,        .         .     .</p><br>
<h2 id="paket-ros-obnaruzhivayuschiy-sharik"> ROS,  </h2><br>
<p>      headless-Raspberry   ROS.   ROS- baloon,     :</p><br>
<ol>
<li> mavros,      </li>
<li>    .             ROS-</li>
<li> web_video_server –  ROS,           </li>
</ol><br>
<p>  ROS- –    -       ROS:</p><br>
<ol>
<li><strong>  .</strong>   ROS    yaml-,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>.       (  ),     ROS     yaml-.</li>
<li><strong>   .</strong>           ROS-.</li>
<li><strong>   </strong>  ROS- <code>/baloon_detector/twist</code></li>
<li><strong>  </strong>  ROS- <code>/baloon_detector/image_filter</code>  <code>/baloon_detector/image_result</code></li>
</ol><br>
<p>        <code>python baloon_pose_cv.py</code> –       –       ROS,       .</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> ROS-</a>,      .</p><br>
<p>    ROS   ,    ROS:</p><br>
<pre><code class="bash hljs">mkdir -p ~/baloon_ws/src
<span class="hljs-built_in">cd</span> ~/baloon_ws/<font></font>
catkin_make<font></font>
<span class="hljs-built_in">source</span> devel/setup.bash
<span class="hljs-built_in">cd</span> src<font></font>
catkin_create_pkg baloon std_msgs rospy </code></pre><br>
<p>   ~/baloon_ws/src/baloon/src ,     :</p><br>
<ol>
<li>baloon_pose_cv.py –   </li>
<li>baloon_cv.launch – launch-    ROS </li>
<li>fe130_320_01.yaml – ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.       ,            ,  3D-    ..</li>
<li>baloon.service, roscore.env –      ROS </li>
</ol><br>
<p>     :</p><br>
<div class="spoiler"><b class="spoiler_title">baloon_pose_cv.py -    </b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># coding=UTF-8</span>
<span class="hljs-comment"># zuza baloon seeker</span>
<span class="hljs-keyword">import</span> rospy
<span class="hljs-keyword">from</span> sensor_msgs.msg <span class="hljs-keyword">import</span> CameraInfo, Image
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">from</span> cv_bridge <span class="hljs-keyword">import</span> CvBridge, CvBridgeError
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-comment">#import tf.transformations as t</span>
<span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> TwistStamped, Quaternion, Point, PoseStamped, TransformStamped
<span class="hljs-keyword">import</span> copy
<span class="hljs-keyword">from</span> std_msgs.msg <span class="hljs-keyword">import</span> ColorRGBA
<span class="hljs-keyword">import</span> tf2_ros
<span class="hljs-keyword">import</span> math 
<span class="hljs-keyword">import</span> yaml<font></font>
<font></font>
my_cam_info=<span class="hljs-literal">None</span>
my_fps=<span class="hljs-number">0</span>
my_last_fps=<span class="hljs-number">0</span><font></font>
my_time_fps=time.time()<font></font>
bridge = CvBridge()<font></font>
mtx=<span class="hljs-literal">None</span>
dist=<span class="hljs-literal">None</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raspicam_loop_cv</span>():</span> 
    <span class="hljs-keyword">global</span> my_fps, my_last_fps, my_time_fps, mtx, dist
    <span class="hljs-comment"># initialize the camera and grab a reference to the raw camera capture</span>
    camera = cv2.VideoCapture(<span class="hljs-number">0</span>)<font></font>
    camera.set(cv2.CAP_PROP_FRAME_WIDTH, my_cam_info.width)<font></font>
    camera.set(cv2.CAP_PROP_FRAME_HEIGHT, my_cam_info.height)<font></font>
    camera.set(cv2.CAP_PROP_FPS, rospy.get_param(<span class="hljs-string">'/baloon_detector/framerate'</span>))
    <span class="hljs-comment"># allow the camera to warmup</span>
    time.sleep(<span class="hljs-number">0.1</span>)<font></font>
<font></font>
    color_blue = (<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>)<font></font>
    color_red = (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>)<font></font>
    color_green = (<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>)<font></font>
    color_white = (<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>)<font></font>
    color_yellow = (<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>)<font></font>
    color_black = (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    invert = rospy.get_param(<span class="hljs-string">'/baloon_detector/invert'</span>)<font></font>
    h1 = rospy.get_param(<span class="hljs-string">'/baloon_detector/h1'</span>)<font></font>
    s1 = rospy.get_param(<span class="hljs-string">'/baloon_detector/s1'</span>)<font></font>
    v1 = rospy.get_param(<span class="hljs-string">'/baloon_detector/v1'</span>)<font></font>
    h2 = rospy.get_param(<span class="hljs-string">'/baloon_detector/h2'</span>)<font></font>
    s2 = rospy.get_param(<span class="hljs-string">'/baloon_detector/s2'</span>)<font></font>
    v2 = rospy.get_param(<span class="hljs-string">'/baloon_detector/v2'</span>)<font></font>
    real_ballon_r = rospy.get_param(<span class="hljs-string">'/baloon_detector/real_ballon_r'</span>)<font></font>
<font></font>
    <span class="hljs-comment">#      </span><font></font>
    h_min = np.array((h1, s1, v1), np.uint8)<font></font>
    h_max = np.array((h2, s2, v2), np.uint8)<font></font>
<font></font>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown(): <font></font>
      ret, image_raw = camera.read()<font></font>
      <span class="hljs-comment"># calculate FPS</span><font></font>
      cur_time2 = time.time()<font></font>
      <span class="hljs-keyword">if</span> cur_time2-my_time_fps&gt;<span class="hljs-number">5</span>:<font></font>
          my_last_fps=my_fps<font></font>
          my_fps=<span class="hljs-number">1</span><font></font>
          my_time_fps=cur_time2<font></font>
      <span class="hljs-keyword">else</span>:<font></font>
          my_fps+=<span class="hljs-number">1</span><font></font>
<font></font>
      image_hsv = cv2.cvtColor(image_raw, cv2.COLOR_BGR2HSV )<font></font>
      <span class="hljs-comment">#       HSV</span><font></font>
      thresh = cv2.inRange(image_hsv, h_min, h_max)<font></font>
      <span class="hljs-keyword">if</span> invert&gt;<span class="hljs-number">0</span>:<font></font>
          cv2.bitwise_not(thresh,thresh)<font></font>
      <span class="hljs-comment">#find contours</span><font></font>
      _, contours0, hierarchy = cv2.findContours( thresh.copy(), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_NONE)<font></font>
      max_area = <span class="hljs-number">0</span>
      max_center_x=<span class="hljs-literal">None</span>
      max_center_y=<span class="hljs-literal">None</span>
      max_baloon_r=<span class="hljs-literal">None</span>
      max_yaw_shift=<span class="hljs-literal">None</span>
      <span class="hljs-keyword">for</span> cnt <span class="hljs-keyword">in</span> contours0:<font></font>
        rect = cv2.minAreaRect(cnt)<font></font>
        box = cv2.boxPoints(rect)<font></font>
        box = np.int0(box)<font></font>
        center = (int(rect[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]),int(rect[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]))<font></font>
        area = int(rect[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]*rect[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])
        <span class="hljs-keyword">if</span> area &gt; <span class="hljs-number">100</span>:<font></font>
            baloon_r = int(math.sqrt(area)/<span class="hljs-number">2</span>)<font></font>
            yaw_shift = int( (center[<span class="hljs-number">0</span>] - my_cam_info.width/<span class="hljs-number">2</span>) * <span class="hljs-number">130</span> / my_cam_info.width) <span class="hljs-comment"># 130 degree camera for my_cam_info.width pics image</span>
            cv2.circle(image_raw, center, baloon_r , color_red, <span class="hljs-number">1</span>)
            <span class="hljs-keyword">if</span> area&gt;max_area:<font></font>
                max_area=area<font></font>
                max_center_x = center[<span class="hljs-number">0</span>]<font></font>
                max_center_y = center[<span class="hljs-number">1</span>]<font></font>
                max_baloon_r = baloon_r<font></font>
                max_yaw_shift = yaw_shift<font></font>
      <span class="hljs-comment">#draw main baloon</span>
      <span class="hljs-keyword">if</span> max_area&gt;<span class="hljs-number">0</span>:<font></font>
        cv2.circle(image_raw, (max_center_x,max_center_y), max_baloon_r+<span class="hljs-number">2</span> , color_blue, <span class="hljs-number">2</span>)<font></font>
        cv2.putText(image_raw, <span class="hljs-string">"D=%d"</span> % int(max_baloon_r*<span class="hljs-number">2</span>), (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>, color_red, <span class="hljs-number">1</span>)<font></font>
        cv2.putText(image_raw, <span class="hljs-string">"angle=%d '"</span> % max_yaw_shift, (<span class="hljs-number">10</span>, <span class="hljs-number">40</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>, color_green, <span class="hljs-number">1</span>)<font></font>
        max_distance = real_ballon_r/math.tan(max_baloon_r/float(my_cam_info.width)*(math.pi*<span class="hljs-number">160.0</span>/<span class="hljs-number">360.0</span>)) <span class="hljs-comment">#distance to baloon</span>
        <span class="hljs-comment">#print max_distance</span>
        cv2.putText(image_raw, <span class="hljs-string">"%f m"</span> % max_distance, (<span class="hljs-number">10</span>, <span class="hljs-number">60</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>, color_blue, <span class="hljs-number">1</span>)<font></font>
        cv2.line(image_raw, (max_center_x, <span class="hljs-number">1</span>), (max_center_x, my_cam_info.height<span class="hljs-number">-1</span>) , color_white, <span class="hljs-number">1</span>)<font></font>
        cv2.line(image_raw, (<span class="hljs-number">1</span>,max_center_y), (my_cam_info.width<span class="hljs-number">-1</span>, max_center_y) , color_white, <span class="hljs-number">1</span>)
        <span class="hljs-comment"># post baloon Twist</span><font></font>
        tws = TwistStamped()<font></font>
        tws.header.stamp = rospy.Time.now()<font></font>
        tws.header.frame_id = <span class="hljs-string">'fcu'</span><font></font>
        tws.twist.linear.x = max_distance<font></font>
        tws.twist.angular.z = float(-max_yaw_shift)/<span class="hljs-number">360.0</span>*math.pi<span class="hljs-comment">#yaw</span>
        tws.twist.angular.y = float( (max_center_y - my_cam_info.height/<span class="hljs-number">2</span>) * <span class="hljs-number">130.0</span> / my_cam_info.height) /<span class="hljs-number">360.0</span>*math.pi <span class="hljs-comment">#pitch</span><font></font>
        publisher_baloontwist.publish(tws)<font></font>
<font></font>
      <span class="hljs-comment">#draw target</span>
      cv2.line(image_raw, (my_cam_info.width/<span class="hljs-number">2</span><span class="hljs-number">-10</span>, my_cam_info.height/<span class="hljs-number">2</span><span class="hljs-number">-10</span>), (my_cam_info.width/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>, my_cam_info.height/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>) , color_yellow, <span class="hljs-number">1</span>)<font></font>
      cv2.line(image_raw, (my_cam_info.width/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>, my_cam_info.height/<span class="hljs-number">2</span><span class="hljs-number">-10</span>), (my_cam_info.width/<span class="hljs-number">2</span><span class="hljs-number">-10</span>, my_cam_info.height/<span class="hljs-number">2</span>+<span class="hljs-number">10</span>) , color_yellow, <span class="hljs-number">1</span>)
      <span class="hljs-comment">#Draw FPS on image</span>
      cv2.putText(image_raw,<span class="hljs-string">"fps: "</span>+str(my_last_fps/<span class="hljs-number">5</span>),(<span class="hljs-number">120</span>,<span class="hljs-number">20</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>,(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>),<span class="hljs-number">1</span>,cv2.LINE_AA)
      <span class="hljs-comment">#  1   5,     </span>
      <span class="hljs-keyword">if</span> my_fps%<span class="hljs-number">5</span>==<span class="hljs-number">0</span>: 
        <span class="hljs-keyword">try</span>:<font></font>
          publisher_image_raw_result.publish(bridge.cv2_to_imgmsg(image_raw,<span class="hljs-string">"bgr8"</span>))<font></font>
          publisher_image_raw_filter.publish(bridge.cv2_to_imgmsg(thresh, <span class="hljs-string">"mono8"</span>))
        <span class="hljs-keyword">except</span> CvBridgeError <span class="hljs-keyword">as</span> e:<font></font>
          print(e)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">publish_dummy_vp</span>(<span class="hljs-params">event</span>):</span><font></font>
    ps = PoseStamped()<font></font>
    ps.header.stamp = rospy.Time.now()<font></font>
    ps.header.frame_id = <span class="hljs-string">'local_origin'</span>
    ps.pose.orientation.w = <span class="hljs-number">1</span>;<font></font>
    publisher_vp.publish(ps);<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">callback_handle_pose</span>(<span class="hljs-params">mavros_pose</span>):</span>
    rospy.loginfo(<span class="hljs-string">"Got mavros pose, stop publishing zeroes."</span>)<font></font>
    dummy_timer.shutdown() <font></font>
    handle_pose_sub.unregister()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_camera_info_yaml</span>():</span>
    <span class="hljs-keyword">global</span> mtx, dist, my_cam_info<font></font>
    my_cam_info = CameraInfo()<font></font>
    filename = rospy.get_param(<span class="hljs-string">'/baloon_detector/camera_info_url'</span>)
    <span class="hljs-keyword">with</span> open(filename, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> ymlfile:<font></font>
        cfg = yaml.load(ymlfile)<font></font>
    my_cam_info.width = cfg[<span class="hljs-string">'image_width'</span>]<font></font>
    my_cam_info.height= cfg[<span class="hljs-string">'image_height'</span>]<font></font>
    my_cam_info.K = cfg[<span class="hljs-string">'camera_matrix'</span>][<span class="hljs-string">'data'</span>]<font></font>
    my_cam_info.D = cfg[<span class="hljs-string">'distortion_coefficients'</span>][<span class="hljs-string">'data'</span>]<font></font>
<font></font>
    mtx=np.zeros((<span class="hljs-number">3</span>,<span class="hljs-number">3</span>))<font></font>
    dist=np.zeros((<span class="hljs-number">1</span>,<span class="hljs-number">5</span>))
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):
      <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):<font></font>
        mtx[i,j]=my_cam_info.K[i*<span class="hljs-number">3</span>+j]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):<font></font>
      dist[<span class="hljs-number">0</span>,i]=my_cam_info.D[i]
    <span class="hljs-keyword">print</span> mtx, dist   <font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    rospy.init_node(<span class="hljs-string">'baloon_detector'</span>)
    <span class="hljs-comment">## init pose publishing from FCU</span>
    publisher_vp = rospy.Publisher(<span class="hljs-string">'/mavros/vision_pose/pose'</span>, PoseStamped, queue_size=<span class="hljs-number">1</span>)<font></font>
    dummy_timer=rospy.Timer(rospy.Duration(<span class="hljs-number">0.5</span>), publish_dummy_vp)<font></font>
    handle_pose_sub = rospy.Subscriber(<span class="hljs-string">'mavros/local_position/pose'</span>, PoseStamped, callback_handle_pose)<font></font>
<font></font>
    <span class="hljs-comment">## init camera</span><font></font>
    process_camera_info_yaml()<font></font>
    <span class="hljs-keyword">print</span> my_cam_info<font></font>
    rospy.loginfo(<span class="hljs-string">"image translation starting........."</span>)<font></font>
    publisher_image_raw_filter = rospy.Publisher(<span class="hljs-string">'baloon_detector/image_filter'</span>, Image, queue_size=<span class="hljs-number">1</span>)<font></font>
    publisher_image_raw_result = rospy.Publisher(<span class="hljs-string">'baloon_detector/image_result'</span>, Image, queue_size=<span class="hljs-number">1</span>)<font></font>
    publisher_baloontwist= rospy.Publisher(<span class="hljs-string">'baloon_detector/twist'</span>, TwistStamped ,queue_size=<span class="hljs-number">1</span>)<font></font>
    raspicam_loop_cv()<font></font>
    <span class="hljs-keyword">try</span>:<font></font>
      rospy.spin()<font></font>
    <span class="hljs-keyword">except</span> KeyboardInterrupt:<font></font>
      print(<span class="hljs-string">"Shutting down"</span>)</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">baloon_cv.launch – launch-    ROS </b><div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">launch</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- mavros --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"$(find mavros)/launch/px4.launch"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"fcu_url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/dev/ttyAMA0:921600"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"gcs_url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"tcp-l://0.0.0.0:5760"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-comment">&lt;!-- baloon pose estimator --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"baloon_detector"</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"baloon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"baloon_pose_cv.py"</span> <span class="hljs-attr">output</span>=<span class="hljs-string">"screen"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"invert"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"h1"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"7"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"h2"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"158"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"s1"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"s2"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"255"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"v1"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"v2"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"255"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"real_ballon_r"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0.145"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"camera_info_url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$(find baloon)/src/fe130_320_01.yaml"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"framerate"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"40"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">node</span>&gt;</span> <font></font>
<font></font>
    <span class="hljs-comment">&lt;!-- web video server --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"web_video_server"</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"web_video_server"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"web_video_server"</span> <span class="hljs-attr">required</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">respawn</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">respawn_delay</span>=<span class="hljs-string">"5"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">launch</span>&gt;</span></code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">fe130_320_01.yaml -   </b><div class="spoiler_text"><pre><code class="xml hljs">image_width: 320<font></font>
image_height: 240<font></font>
camera_name: main_camera_optical<font></font>
camera_matrix:<font></font>
  rows: 3<font></font>
  cols: 3<font></font>
  data: [251.8636348237197, 0, 161.853506252244, 0, 252.36606604425, 102.0038140308112, 0, 0, 1]<font></font>
distortion_model: plumb_bob<font></font>
distortion_coefficients:<font></font>
  rows: 1<font></font>
  cols: 5<font></font>
  data: [-0.4424451138703088, 0.1594038086314775, 0.006694781700363117, 0.00174908936506397, 0]<font></font>
rectification_matrix:<font></font>
  rows: 3<font></font>
  cols: 3<font></font>
  data: [1, 0, 0, 0, 1, 0, 0, 0, 1]<font></font>
projection_matrix:<font></font>
  rows: 3<font></font>
  cols: 4<font></font>
  data: [174.0442047119141, 0, 163.822732720786, 0, 0, 175.2916412353516, 105.5565883832869, 0, 0, 0, 1, 0]</code></pre></div></div><br>
<p>     baloon_ws/src/baloon/src,    " " (cmod +x)  baloon_pose_cv.py  baloon.service. ,    ,   ROS- :</p><br>
<pre><code class="bash hljs">roslaunch baloon baloon_cv.launch
</code></pre><br>
<p>            -:<br>
<img src="https://habrastorage.org/webt/bk/mi/-c/bkmi-c9yhazorag5didbbi4g6lq.png"></p><br>
<p>        <code>/baloon_detector/twist</code>:</p><br>
<pre><code class="bash hljs">pi@raspberry:~ $ rostopic list |grep baloon<font></font>
/baloon_detector/image_filter<font></font>
/baloon_detector/image_result<font></font>
/baloon_detector/twist<font></font>
<font></font>
pi@raspberry:~ $ rostopic <span class="hljs-built_in">echo</span> /baloon_detector/twist<font></font>
header:<font></font>
  seq: 1<font></font>
  stamp:<font></font>
    secs: 1554730508<font></font>
    nsecs: 603406906<font></font>
  frame_id: <span class="hljs-string">"fcu"</span><font></font>
twist:<font></font>
  linear:<font></font>
    x: 6.6452559203<font></font>
    y: 0.0<font></font>
    z: 0.0<font></font>
  angular:<font></font>
    x: 0.0<font></font>
    y: 0.137081068334<font></font>
    z: -0.165806278939<font></font>
---</code></pre><br>
<p>       Raspberry.<br>
      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">systemd</a> baloon.service,  :</p><br>
<pre><code class="xml hljs">[Unit]<font></font>
Description=BALOON ROS package<font></font>
Requires=roscore.service<font></font>
After=roscore.service<font></font>
<font></font>
[Service]<font></font>
EnvironmentFile=/home/pi/baloon_ws/src/baloon/src/roscore.env<font></font>
ExecStart=/opt/ros/kinetic/bin/roslaunch baloon baloon_cv.launch --wait<font></font>
Restart=on-abort<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br>
<p>      roscore.env:</p><br>
<pre><code class="bash hljs">ROS_ROOT=/opt/ros/kinetic/share/ros<font></font>
ROS_DISTRO=kinetic<font></font>
ROS_PACKAGE_PATH=/home/pi/baloon_ws/src:/opt/ros/kinetic/share<font></font>
ROS_PORT=11311<font></font>
ROS_MASTER_URI=http://localhost:11311<font></font>
CMAKE_PREFIX_PATH=/home/pi/baloon_ws/devel:/opt/ros/kinetic<font></font>
PATH=/opt/ros/kinetic/bin:/usr/<span class="hljs-built_in">local</span>/sbin:/usr/<span class="hljs-built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/<span class="hljs-built_in">local</span>/games:/snap/bin<font></font>
LD_LIBRARY_PATH=/opt/ros/kinetic/lib<font></font>
PYTHONPATH=/home/pi/catkin_ws/devel/lib/python2.7/dist-packages:/opt/ros/kinetic/lib/python2.7/dist-packages<font></font>
ROS_IP=192.168.11.1</code></pre><br>
<p>       : </p><br>
<pre><code class="bash hljs">sudo systemctl <span class="hljs-built_in">enable</span> ~/baloon_ws/src/baloon/src/baloon.service<font></font>
sudo systemctl start baloon</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これで、Raspberryの起動時にノードが自動的に起動するはずです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンド</font></font><code>sudo systemctl stop baloon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">ノードを停止したり</font><font style="vertical-align: inherit;">、自動実行をキャンセル</font><font style="vertical-align: inherit;">したりできます</font></font><code>sudo systemctl disable balloon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちの行動の結果、システムが車載コンピューターで起動したときに起動される「自動ボール検出器」を受け取りました。 </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のパートでは、ホーミングドローンの最終打ち上げに進みます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラムのソースコード</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がGithubに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップロードさ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">れ</font></a><font style="vertical-align: inherit;">ます。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja462907/index.html">ngFanaticウィークリー</a></li>
<li><a href="../ja462909/index.html">ASICの進化の成果：メーカー、SHA-256のマイナー、天文学的なハッシュレートの奇妙さ</a></li>
<li><a href="../ja462911/index.html">電気自動車のハンドルを握る1年</a></li>
<li><a href="../ja462915/index.html">Cinebench R20の目を通してパフォーマンスAMD EPYC 7452</a></li>
<li><a href="../ja462917/index.html">RによるWebスクレイピング。KinopoiskとIMDBの映画の評価の比較</a></li>
<li><a href="../ja462929/index.html">私はあなたを参照してください：バットマスキング戦術</a></li>
<li><a href="../ja462933/index.html">インターネットブロッキングのしくみ：実際の例を使用した最新の方法の概要</a></li>
<li><a href="../ja462935/index.html">オープンプランのオフィスで働きながら集中力を保つ方法は？</a></li>
<li><a href="../ja462937/index.html">ITインフラストラクチャを制御する永続的なファブリックの概念</a></li>
<li><a href="../ja462939/index.html">トップ10 C ++ロシアレポートとオープンアクセス会議のプレイリスト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>