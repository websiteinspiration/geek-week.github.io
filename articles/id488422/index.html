<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😦 🎣 💪🏻 10 baris kode untuk mengurangi rasa sakit proyek Vue Anda 💏 ⏩ 🖖🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... atau keakraban dengan plugin Vue JS sebagai contoh dari bus acara terintegrasi
 Beberapa kata tentang ...
 Halo semuanya! Saya akan segera melakuk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>10 baris kode untuk mengurangi rasa sakit proyek Vue Anda</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odin_ingram_micro/blog/488422/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... atau keakraban dengan plugin Vue JS sebagai contoh dari bus acara terintegrasi</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa kata tentang ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halo semuanya! </font><font style="vertical-align: inherit;">Saya akan segera melakukan reservasi. </font><font style="vertical-align: inherit;">Saya benar-benar menyukai VueJS, saya telah aktif menulis tentang hal ini selama lebih dari 2 tahun dan saya tidak berpikir bahwa pengembangannya dapat menyakitkan setidaknya untuk beberapa tingkat yang signifikan :)</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sisi lain, kami selalu berusaha menemukan solusi universal yang akan membantu menghabiskan lebih sedikit waktu untuk pekerjaan mekanik dan lebih pada apa yang benar-benar menarik. Terkadang solusinya sangat berhasil. Salah satunya saya ingin berbagi dengan Anda. 10 baris yang akan dibahas (spoiler: pada akhirnya akan ada lebih banyak) lahir dalam proses mengerjakan proyek Cloud Blue-Connect, yang merupakan aplikasi yang cukup besar dengan 400+ komponen. Solusi yang kami temukan sudah terintegrasi ke dalam berbagai titik sistem dan selama lebih dari setengah tahun tidak pernah membutuhkan koreksi, sehingga dapat dengan aman dianggap berhasil diuji stabilitasnya.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan yang terakhir. </font><font style="vertical-align: inherit;">Sebelum melanjutkan langsung ke solusinya, saya ingin sedikit lebih memikirkan deskripsi dari tiga jenis interaksi antara komponen Vue di antara mereka sendiri: prinsip aliran searah, pola toko, dan bus peristiwa. </font><font style="vertical-align: inherit;">Jika penjelasan ini tidak perlu (atau membosankan) untuk Anda, langsung ke bagian dengan solusinya - semuanya sesingkat dan teknis mungkin.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sedikit tentang bagaimana komponen Vue berkomunikasi satu sama lain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin pertanyaan pertama yang ditimbulkan seseorang yang menulis komponen pertamanya adalah bagaimana ia akan menerima data untuk pekerjaan dan bagaimana, pada gilirannya, ia akan mengirimkan data yang ia terima "keluar". </font><font style="vertical-align: inherit;">Prinsip interaksi yang diadopsi dalam kerangka Vue JS disebut ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aliran data searah</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Singkatnya, prinsip ini terdengar seperti "properti - turun, peristiwa - naik." Yaitu, untuk menerima data dari luar ("dari atas"), kami mendaftarkan properti khusus di dalam komponen di mana kerangka kerja menulis, jika perlu, data kami diperoleh dari "luar". Untuk mentransfer data "naik", di dalam komponen di tempat yang tepat, kami memanggil metode kerangka kerja $ emit khusus, yang meneruskan data kami ke penangan komponen induk. Pada saat yang sama, di Vue JS kita tidak bisa hanya "menyiarkan" acara hingga kedalaman yang tidak terbatas (seperti misalnya dalam Angular 1.x). Itu "muncul" hanya satu tingkat, ke orang tua langsung. Hal yang sama berlaku untuk acara. Untuk mentransfernya ke tingkat berikutnya, untuk masing-masing Anda juga perlu mendaftarkan antarmuka khusus - properti dan acara yang akan mengirimkan "pesan" kami lebih lanjut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dapat digambarkan sebagai gedung kantor di mana pekerja hanya dapat bergerak dari lantai mereka ke lantai tetangga - satu naik dan turun satu. Jadi, untuk mentransfer "dokumen untuk penandatanganan" dari lantai lima ke lantai dua, dibutuhkan tiga pekerja yang akan mengirimkannya dari lantai lima ke lantai dua, dan kemudian tiga orang lagi yang akan mengembalikannya ke lantai lima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Tapi ini tidak nyaman!" Tentu saja, ini tidak selalu nyaman dari sudut pandang pengembangan, tetapi melihat kode masing-masing komponen, kita bisa melihat apa dan kepada siapa itu dilewati. Kita tidak perlu mengingat seluruh struktur aplikasi untuk memahami apakah komponen kita sedang dalam perjalanan ke acara tersebut atau tidak. Kita dapat melihat ini dari komponen induk.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun keuntungan dari pendekatan ini dapat dipahami, ia juga memiliki kelemahan yang jelas, yaitu, kohesi komponen yang tinggi. </font><font style="vertical-align: inherit;">Sederhananya, agar kita dapat menempatkan beberapa komponen dalam struktur, kita perlu overlay dengan antarmuka yang diperlukan untuk mengelola kondisinya. </font><font style="vertical-align: inherit;">Untuk mengurangi konektivitas ini, mereka sering menggunakan "alat manajemen negara". </font><font style="vertical-align: inherit;">Mungkin alat paling populer untuk Vue adalah ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vuex (samping)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melanjutkan analogi kami dengan gedung kantor, Vuex Stor adalah layanan pos internal. Bayangkan di setiap lantai kantor ada jendela untuk menerbitkan dan menerima paket. Di lantai lima mereka mentransfer dokumen No. 11 untuk ditandatangani, dan di lantai kedua mereka secara berkala bertanya: "Apakah ada dokumen untuk ditandatangani?", Tanda tangani dokumen yang ada dan kembalikan. Pada yang kelima mereka juga bertanya: "Apakah ada penandatangan?" Pada saat yang sama, karyawan dapat pindah ke lantai lain atau ke kamar lain - prinsip kerja tidak akan berubah saat surat berfungsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kira-kira dengan prinsip ini pola yang disebut Toko juga berfungsi. Menggunakan antarmuka Vuex, gudang data global terdaftar dan dikonfigurasikan, dan komponen berlangganannya. Dan tidak masalah pada level apa struktur banding terjadi, toko akan selalu memberikan informasi yang benar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya pada masalah ini semua sudah diselesaikan. Tetapi pada suatu titik di gedung metaforis kami, satu karyawan ingin memanggil yang lain untuk makan siang ... atau melaporkan beberapa jenis kesalahan. Dan di sini yang aneh dimulai. Pesan itu sendiri tidak memerlukan transmisi seperti itu. Tetapi untuk menggunakan surat Anda perlu mentransfer sesuatu. Kemudian karyawan kami membuat kode. Satu bola hijau - pergi makan siang, dua kubus merah - kesalahan aplikasi E-981273 terjadi, tiga koin kuning - periksa surat Anda dan sebagainya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mudah ditebak bahwa dengan bantuan metafora canggung ini saya menggambarkan situasi ketika kita perlu memastikan respons komponen kita terhadap peristiwa yang terjadi di komponen lain, yang dengan sendirinya tidak terhubung dengan cara apa pun dengan aliran data. </font><font style="vertical-align: inherit;">Menyimpan item baru selesai - Anda harus mengambil kembali koleksi. </font><font style="vertical-align: inherit;">Telah terjadi kesalahan 403 Tidak Resmi - Anda harus memulai logout pengguna dan sebagainya. </font><font style="vertical-align: inherit;">Praktik yang biasa (dan jauh dari yang terbaik) dalam hal ini adalah membuat bendera di dalam toko atau untuk secara tidak langsung menafsirkan data yang disimpan dan perubahannya. </font><font style="vertical-align: inherit;">Ini dengan cepat menyebabkan pencemaran baik toko itu sendiri maupun logika komponen di sekitarnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada tahap ini, kita mulai berpikir tentang cara melewati peristiwa secara langsung, melewati seluruh rantai komponen. </font><font style="vertical-align: inherit;">Dan, sedikit google atau mencari-cari dalam dokumentasi, kami menemukan sebuah pola ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bus acara</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari sudut pandang teknis, bus peristiwa adalah objek yang memungkinkan menggunakan satu metode khusus untuk meluncurkan "peristiwa" dan berlangganan untuk itu menggunakan yang lain. Dengan kata lain, ketika berlangganan event eventA, objek ini menyimpan fungsi handler yang lewat di dalam strukturnya, yang akan dipanggil ketika metode peluncuran dengan kunci eventA dipanggil di suatu tempat dalam aplikasi. Untuk menandatangani atau menjalankannya sudah cukup untuk mengaksesnya melalui impor atau dengan referensi, dan Anda selesai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara metaforis, di "gedung" kami, sebuah bus adalah obrolan yang umum di dalam pembawa pesan. Komponen berlangganan "obrolan umum" dimana komponen lain mengirim pesan. Segera setelah "pesan" muncul di "obrolan", di mana komponen telah berlangganan, pawang akan mulai.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada banyak cara berbeda untuk membuat bus acara. </font><font style="vertical-align: inherit;">Anda bisa menulis sendiri atau menggunakan solusi siap pakai - RxJS yang sama, yang menyediakan fungsionalitas sangat besar untuk bekerja dengan seluruh aliran acara. </font><font style="vertical-align: inherit;">Tetapi paling sering ketika bekerja dengan VueJS yang mereka gunakan, anehnya, VueJS sendiri. </font><font style="vertical-align: inherit;">Contoh Vue dibuat melalui konstruktor (Vue baru ()) menyediakan antarmuka acara yang indah dan ringkas, dijelaskan dalam dokumentasi resmi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita mendekati pertanyaan berikutnya ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang kita inginkan?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami ingin membangun sebuah bus acara di aplikasi kami. </font><font style="vertical-align: inherit;">Tetapi kami memiliki dua persyaratan tambahan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itu harus mudah diakses di setiap komponen. </font><font style="vertical-align: inherit;">Memisahkan impor ke masing-masing dari puluhan komponen tampaknya berlebihan bagi kami.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itu harus modular. </font><font style="vertical-align: inherit;">Kami tidak ingin mengingat semua nama acara untuk menghindari situasi ketika "item-made" event memecat handler dari seluruh aplikasi. </font><font style="vertical-align: inherit;">Oleh karena itu, kami ingin dapat dengan mudah memisahkan fragmen kecil dari komponen pohon menjadi modul terpisah dan menyiarkan acara di dalamnya, dan tidak di luar.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengimplementasikan fungsionalitas yang mengesankan seperti itu, kami menggunakan antarmuka plug-in yang kuat yang disediakan oleh VueJS. </font><font style="vertical-align: inherit;">Anda dapat membiasakan diri dengan lebih detail di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di halaman ini dengan dokumentasi resmi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayo daftarkan plugin kita terlebih dahulu. </font><font style="vertical-align: inherit;">Untuk melakukan ini, tepat sebelum titik inisialisasi aplikasi Vue kami (sebelum memanggil Vue. $ Mount ()) kami menempatkan blok berikut:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { }, <font></font>
});<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faktanya, plugin Vue adalah cara untuk memperluas fungsionalitas framework di seluruh level aplikasi. Antarmuka plugin menyediakan beberapa cara untuk berintegrasi ke dalam komponen, tetapi hari ini kami akan memperkenalkan antarmuka mixin. Metode ini menerima objek yang memperluas keterangan setiap komponen sebelum memulai siklus hidup dalam aplikasi.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Kode komponen yang kami tulis lebih cenderung bukan komponen itu sendiri, tetapi deskripsi perilaku dan enkapsulasi bagian tertentu dari logika yang digunakan kerangka kerja pada berbagai tahap siklus hidupnya. Inisialisasi plug-in berada di luar siklus hidup komponen, sebelum itu, oleh karena itu kami kami mengatakan "deskriptor", bukan komponen, untuk menekankan bahwa kode yang ditulis dalam file kami, dan bukan entitas yang merupakan produk dari kerangka kerja, akan ditransfer ke bagian mixin dari plugin)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) {     <font></font>
    vue.mixin({}); <span class="hljs-comment">// &lt;--</span><font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objek kosong inilah yang akan berisi ekstensi untuk komponen kami. Tapi sebagai permulaan, berhenti lagi. Dalam kasus kami, kami ingin membuat antarmuka untuk mengakses bus di tingkat setiap komponen. Mari tambahkan bidang '$ broadcast' ke deskriptor kami, ini akan menyimpan tautan ke bus kami. Untuk melakukan ini, gunakan Vue.prototype:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <span class="hljs-comment">// &lt;--</span><font></font>
    vue.mixin({}); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita perlu membuat bus itu sendiri, tetapi pertama-tama mari kita ingat persyaratan modularitas dan menganggap bahwa dalam deskriptor komponen kita akan mendeklarasikan modul baru dengan bidang "$ module" dengan beberapa nilai teks (kita akan membutuhkannya sedikit kemudian). </font><font style="vertical-align: inherit;">Jika bidang $ module ditentukan dalam komponen itu sendiri, kami akan membuat bus baru untuk itu, jika tidak, kami akan meneruskan tautan ke induk melalui bidang $ induk. </font><font style="vertical-align: inherit;">Perhatikan bahwa bidang deskriptor akan tersedia bagi kami melalui bidang $ options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan menempatkan pembuatan bus kami pada tahap sedini mungkin - di hook sebelum Membuat.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() {  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
 	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, mari kita isi cabang logis. </font><font style="vertical-align: inherit;">Jika deskriptor berisi deklarasi modul baru, buat instance bus baru, jika tidak, ambil tautan dari $ parent.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue();  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast;  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami membuang pengumuman plugin, kami menganggap ... 1, 2, 3, 4 ... 10 baris, seperti yang saya janjikan! </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bisakah kita melakukannya dengan lebih baik?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja kita bisa. </font><font style="vertical-align: inherit;">Kode ini mudah diperluas. </font><font style="vertical-align: inherit;">Misalnya, dalam kasus kami, selain $ broadcast, kami memutuskan untuk menambahkan antarmuka $ rootBroadcast, yang memberikan akses ke satu bus untuk seluruh aplikasi. </font><font style="vertical-align: inherit;">Acara yang dijalankan oleh pengguna pada $ broadcast bus digandakan pada $ rootBroadcast bus sehingga Anda dapat berlangganan semua acara modul tertentu (dalam hal ini, nama acara akan diteruskan ke penangan sebagai argumen pertama) atau ke semua acara aplikasi secara umum (kemudian nama modul akan diteruskan ke handler dengan argumen pertama, nama acara dengan yang kedua, dan data yang dikirimkan dengan peristiwa tersebut akan diteruskan dengan argumen berikut). </font><font style="vertical-align: inherit;">Desain ini akan memungkinkan kita untuk membangun interaksi antara modul, serta menggantung satu penangan tunggal pada acara-acara modul yang berbeda.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// This one emits event  </span>
<span class="hljs-keyword">this</span>.$broadcast.$emit(‘my-event’, ‘PARAM_A’); 
<span class="hljs-comment">// This is standard subscription inside module </span>
<span class="hljs-keyword">this</span>.$broadcast.$on(‘my-event’, (paramA) =&gt; {…}); 
<span class="hljs-comment">// This subscription will work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‘my-event’, (<span class="hljs-built_in">module</span>, paramA) =&gt; {…}); 
<span class="hljs-comment">// This subscription will also work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‘*’, (event, <span class="hljs-built_in">module</span>, paramA) =&gt; {…});
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat bagaimana kita bisa mencapai ini: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, buat satu bus, yang akan diatur melalui $ rootBroadcast, dan isian itu sendiri dengan tautan:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue(); <span class="hljs-comment">// &lt;--</span><font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus; <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita memerlukan keanggotaan modul di setiap komponen, jadi mari kita memperluas definisi modularitas seperti ini:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kita perlu membuat acara di bus lokal modular mencerminkan cara kita perlu ke root. </font><font style="vertical-align: inherit;">Untuk melakukan ini, pertama-tama kita harus membuat antarmuka proxy yang sederhana dan menempatkan bus itu sendiri di properti pribadi kondisional $ bus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan akhirnya, tambahkan metode proxy ke objek - karena sekarang bidang $ broadcast tidak menyediakan akses langsung ke bus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
        <span class="hljs-comment">// &gt;&gt;&gt;</span>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">…attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(…attrs);           
          <span class="hljs-keyword">const</span> [event, …attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, …attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‘*’, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, …attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">…attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(…attrs);<font></font>
        };<font></font>
        <span class="hljs-comment">// &lt;&lt;&lt;</span><font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, sebagai sentuhan terakhir, mari kita ingat bahwa kita mendapatkan akses ke bus dengan menutup, yang berarti bahwa penangan yang ditambahkan sekali tidak akan dihapus dengan komponen, tetapi akan hidup selama seluruh waktu bekerja dengan aplikasi. Ini dapat menyebabkan efek samping yang tidak menyenangkan, jadi mari kita tambahkan fungsi pembersihan pendengar ke bus kami di akhir siklus hidup komponen:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeDestroy() {                               <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">this</span>.$broadcast.$off(<span class="hljs-keyword">this</span>.$broadcastEvents);  <span class="hljs-comment">// &lt;--</span><font></font>
      },<font></font>
<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">this</span>.$broadcastEvents = [];  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">…attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcastEvents.push(attrs[<span class="hljs-number">0</span>]);   <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(…attrs);           
          <span class="hljs-keyword">const</span> [event, …attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, …attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‘*’, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, …attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">…attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(…attrs);<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$off =: <span class="hljs-function">(<span class="hljs-params">...attrs</span>) =&gt;</span> {  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$off(...attrs);   <span class="hljs-comment">// &lt;--</span><font></font>
        };<font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, opsi ini memberikan fungsionalitas yang lebih menarik, meski kurang ringkas. </font><font style="vertical-align: inherit;">Dengannya, Anda dapat menerapkan sistem komunikasi alternatif yang lengkap antar komponen. </font><font style="vertical-align: inherit;">Selain itu, ia sepenuhnya di bawah kendali kami dan tidak membawa ketergantungan eksternal ke dalam proyek kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harap setelah membaca Anda memperoleh atau menyegarkan kembali pengetahuan Anda tentang plugin Vue, dan mungkin lain kali Anda perlu menambahkan beberapa fungsionalitas generik ke aplikasi Anda, Anda dapat mengimplementasikannya lebih efisien - tanpa menambahkan dependensi eksternal.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488408/index.html">STM32 Ethernet-RS485 IoT Gateway</a></li>
<li><a href="../id488410/index.html">7 pelajaran yang saya pelajari dalam sepuluh tahun dalam pembangunan</a></li>
<li><a href="../id488412/index.html">Membuat bot Discord berdasarkan discord.js</a></li>
<li><a href="../id488416/index.html">SLAE - Ujian Ahli Perakitan Linux</a></li>
<li><a href="../id488418/index.html">REST API Authentication dengan Spring Security dan MongoDB</a></li>
<li><a href="../id488424/index.html">Apa yang akan terjadi pada ITSM pada tahun 2020?</a></li>
<li><a href="../id488426/index.html">Bagaimana cara melakukan review kode? Bagian 2: meninjau navigasi, kecepatan, komentar, konflik</a></li>
<li><a href="../id488428/index.html">Bagaimana kami memprediksi masa depan dalam pencarian Yandex: dari perbaikan bug ke kueri penemuan</a></li>
<li><a href="../id488432/index.html">Snoop Project alat luar biasa untuk intelijen Internet, yang telah lama ditunggu-tunggu oleh pengguna RuNet - tersedia</a></li>
<li><a href="../id488436/index.html">Buat musik chiptune open-source dengan cepat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>