<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🤝‍👨🏼 ⛲️ 🐜 Comment créer une API sur n'importe quelle application Android. Par exemple, WhatsApp 👨🏿‍🎨 🏉 🕺🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations! Ma tâche a été dessinée: il est nécessaire d'intégrer des messagers dans le système CRM, sinon il est difficile d'analyser le travail des...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment créer une API sur n'importe quelle application Android. Par exemple, WhatsApp</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487182/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salutations! </font><font style="vertical-align: inherit;">Ma tâche a été dessinée: il est nécessaire d'intégrer des messagers dans le système CRM, sinon il est difficile d'analyser le travail des managers lorsqu'ils communiquent avec les clients à l'aide d'un seul téléphone «fonctionnel». </font><font style="vertical-align: inherit;">Et la première chose à faire a été de connecter WhatsApp, l'un des messagers instantanés les plus populaires pour notre public cible.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse de la situation ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout ce qui semblait nécessaire était d'envoyer et de recevoir des messages. </font><font style="vertical-align: inherit;">Et tant de pièges ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. API officielle</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y avait alors aucune API officielle dans la version. </font><font style="vertical-align: inherit;">Mais Facebook a réussi à envoyer un lien vers le formulaire pour connecter l'API officielle, qui est en cours de test.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Service tiers. </font><font style="vertical-align: inherit;">Connexion via WhatsApp WEB</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai envisagé l'option d'une méthode "grise", l'utilisation d'un service non officiel qui envoie des messages via l'interface WEB, se connecte en scannant un code QR. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais cela dépend de l'API de quelqu'un d'autre, à tout moment tout peut tomber, et je ne voulais pas transférer les numéros de client au service de quelqu'un d'autre. </font><font style="vertical-align: inherit;">Et écrire sous l'API de l'auteur de quelqu'un d'autre, que vous devrez réécrire lorsque vous passerez à un autre service, est également un plaisir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, vous devez également garder le téléphone allumé (bien que certains services moyennant des frais supplémentaires aient résolu ce problème :)</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Mode manuel</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plantez une personne, laissez les messages copier-coller aux clients. </font><font style="vertical-align: inherit;">Blague comme une blague, mais de cette idée est née une solution!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Décision</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoi de message</font></font></h4><br>
<img src="https://habrastorage.org/webt/so/gq/rf/sogqrfasclcuugve3ytmcgzpmuu.jpeg" alt="image" align="right" width="200"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe un tel programme pour automatiser les actions pour Android, appelé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tasker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l'un des premiers programmes de ce type. </font><font style="vertical-align: inherit;">Mais je ne l'ai pas compris la première fois ... J'ai cherché des analogues, je suis tombé sur le programme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automagic</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans celui-ci, les événements, actions et branches sont dessinés sous forme de diagramme.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hors sujet</font></font></b><div class="spoiler_text">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HiAsm</a>,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et j'ai trouvé une solution, nous n'avons pas besoin de droits root. </font><font style="vertical-align: inherit;">Il s'est avéré en utilisant une méthode de poke scientifique pour dessiner un script d'envoi de message, puis j'appellerai le flux, donc chaque algorithme dessiné individuel est appelé dans ce programme. </font><font style="vertical-align: inherit;">Et maintenant, nous allons analyser son travail:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capture d'écran du flux de messages WhatsApp</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/so/gq/rf/sogqrfasclcuugve3ytmcgzpmuu.jpeg" alt="image"><br>
</div></div><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les 5 secondes, un événement est généré par une minuterie périodique et transmis au bloc suivant.</font></font></li>
<li> HTTP Request   ,      ,   ?    PHP.</li>
<li>   JSON.</li>
<li>      ,    ,  .</li>
<li>,    ,  ,  ,    .    ,     ,  ,   , :</li>
<li>    ,            WhatsApp'</li>
<li> .  Control UI.            (   ),          .<br>
<br>
<div class="spoiler"><b class="spoiler_title">   ,  ,   </b><div class="spoiler_text"><pre><code class="plaintext hljs">sleep(2000);  // 2    <font></font>
 <font></font>
sle = 200;<font></font>
ch_c = 0;<font></font>
ch = false;<font></font>
is_sended = false;<font></font>
 <font></font>
sleep(sle);<font></font>
ch = existsElementById("com.whatsapp:id/entry"); // ,      <font></font>
sleep(sle);<font></font>
if (ch == false) {<font></font>
  ch = existsElementById("com.whatsapp:id/entry"); //  <font></font>
  ch_c = ch_c + 1;<font></font>
  sleep(1500);<font></font>
}<font></font>
<font></font>
if (ch == false) {<font></font>
  ch = existsElementById("com.whatsapp:id/entry"); <font></font>
  ch_c = ch_c + 1;<font></font>
  sleep(5500);<font></font>
}<font></font>
<font></font>
ch = existsElementById("com.whatsapp:id/entry");<font></font>
sleep(sle);<font></font>
setText2ById("com.whatsapp:id/entry",text); //  <font></font>
sleep(sle);<font></font>
<font></font>
clickById("com.whatsapp:id/send");  //   <font></font>
sleep(sle);<font></font>
back();<font></font>
sleep(sle);<font></font>
back();<font></font>
status = 2;<font></font>
<font></font>
if(ch == true) {  //   , ,    <font></font>
  is_sended = true;<font></font>
  status = 1;<font></font>
}<font></font>
</code></pre><br>
</div></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous envoyons les résultats de l'envoi d'un message au serveur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous revenons à l'écran d'accueil.</font></font></li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recevoir des messages</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La réception de messages est beaucoup plus facile. </font><font style="vertical-align: inherit;">Nous avons mis l'événement sur une notification du messager. </font><font style="vertical-align: inherit;">Dès qu'une notification arrive, marquez-la comme lue et envoyez-la telle quelle au serveur. </font><font style="vertical-align: inherit;">Cela analyse déjà le destinataire et le texte.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capture d'écran de l'algorithme de réception des messages</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/bx/in/yk/bxinykvye4lswsi-ytvurajxkra.jpeg"><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avantages, inconvénients, raffinement et plans</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme remplit parfaitement la fonction principale d'envoi d'un message. Étant donné que l'interface WEB n'est pas utilisée, prendre un bain au messager est moins risqué, comme il me semble. J'ai loué un serveur virtuel faible, j'y ai installé Android et j'ai tout transféré. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il faut environ 5 secondes pour envoyer un message à un nouveau contact. Pour vérifier la livraison et lire le message, j'ai développé un flux séparé, mais il est sous forme de brouillon et parfois ne fonctionne pas. Par conséquent, à propos de lui plus tard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le moment, la fonction de réception de messages multimédias (photos, audio, pièces jointes) n'est pas implémentée, mais elle peut être téléchargée à partir de WhatsApp à l'aide du bouton de partage de messages à l'avenir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un peu plus tard, je veux écrire un tronc SIP au-dessus de la machine virtuelle sur laquelle le messager s'exécute, à travers lequel il sera possible d'appeler via WhatsApp comme via SIP ^. ^ Ce qui peut réduire les coûts de communication. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux également prendre des captures d'écran d'avatars et les envoyer au serveur pour joindre une miniature à un contact dans le système CRM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, en général, le plus intéressant: cette méthode d'encapsulation dans l'API convient à presque toutes les applications pour Android :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a été initialement développé et lancé sur Android 9, xiaomi mi 9 se, root n'est pas correct.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487168/index.html">Toxic Grandfather Interface Tales “Instrumental Trash” (s1 e2)</a></li>
<li><a href="../fr487172/index.html">Cours ouvert "Deep Learning in NLP" des créateurs de DeepPavlov basé sur le cours cs224n</a></li>
<li><a href="../fr487174/index.html">Augmentez votre instance de Webogram avec proxy via nginx</a></li>
<li><a href="../fr487176/index.html">Maintenez COVID-19. Tout sur la filtration de l'air pandémique</a></li>
<li><a href="../fr487178/index.html">Étude de marché Timlid en Russie</a></li>
<li><a href="../fr487184/index.html">Comment j'ai pensé au téléviseur «intelligent» de Samsung - examen approfondi</a></li>
<li><a href="../fr487186/index.html">J'ai publié le code source de ma première application web</a></li>
<li><a href="../fr487188/index.html">TTY est un terminal qui n'est pas destiné à un usage domestique</a></li>
<li><a href="../fr487196/index.html">OS Sivelkiriya: mission et formulaire de lancement</a></li>
<li><a href="../fr487198/index.html">Attention! Homo Consciousness. je</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>