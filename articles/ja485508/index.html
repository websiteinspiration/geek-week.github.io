<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>➖ 👨🏽‍💼 💠 機能的なDBMSおよびNoSQL ERPに向けて：残高の保管とコスト計算 👍🏿 ☣️ 🗻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！
 
 ERPの設計における関数型プログラミングの原則の適用性については、引き続き調査を行っています。では前の記事、私たちは、建築の基礎を築いた、と逆の文の例を使用して、簡単な畳み込みの構築を実証し、これが必要な理由について話しました。実際、イベントソーシングアプローチが提案され...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>機能的なDBMSおよびNoSQL ERPに向けて：残高の保管とコスト計算</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485508/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ERPの設計における関数型プログラミングの原則の適用性については、引き続き調査を行っています。では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の記事、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは、建築の基礎を築いた、と逆の文の例を使用して、簡単な畳み込みの構築を実証し、これが必要な理由について話しました。実際、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントソーシング</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプローチが提案され</font><font style="vertical-align: inherit;">ていますが、データベースが不変部分と可変部分に分離されているため、1つのシステムで、マップ/削減ストレージとメモリ内DBMSの利点を組み合わせて、パフォーマンスの問題とスケーラビリティの問題の両方を解決しています。この記事では、（そしてTypeScriptと</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Denoランタイムの</font></a><font style="vertical-align: inherit;">プロトタイプを示し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、そのようなシステムにインスタント残高のレジスタを保存し、コストを計算する方法。最初の記事を読んでいない人のために-簡単な要約：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ジャーナル</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 RDBMSに基づいて構築されたERPは、競争力のある巨大な可変状態であるため、拡張性がなく、監査が不十分で、運用の信頼性が低くなります（データの不整合が発生します）。機能的なERPでは、すべてのデータは、不変の一次ドキュメントの時系列に並べられたジャーナルの形式で編成され、これらのドキュメント以外には何もありません。リンクは完全なIDによって新しいドキュメントから古いドキュメントに解決され（その逆もありません）、他のすべてのデータ（残高、レジスター、比較）は計算された畳み込み、つまりドキュメントフローの純粋な関数のキャッシュされた結果です。状態の欠如+関数の可聴性により、信頼性が向上し（ブロックチェーンはこのスキームに完全に適合します）、ボーナスとして、ハードではなくストレージスキーム+適応キャッシュ（テーブルに基づいて編成されます）が簡素化されます。</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、ERPのデータフラグメントがどのように見えるかです。</font></font></b><div class="spoiler_text"><pre><code class="json hljs"><span class="hljs-comment">//  </span><font></font>
{<font></font>
	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"person"</span>, <span class="hljs-comment">//  ,     </span>
	<span class="hljs-attr">"key"</span>: <span class="hljs-string">"person.0"</span>, <span class="hljs-comment">//   </span>
	<span class="hljs-attr">"id"</span>: <span class="hljs-string">"person.0^1580006048190"</span>, <span class="hljs-comment">//  +    ID</span>
	<span class="hljs-attr">"erp_type"</span>: <span class="hljs-string">"person.retail"</span>,
	<span class="hljs-attr">"name"</span>: <span class="hljs-string">"   "</span><font></font>
}<font></font>
<span class="hljs-comment">//  ""</span><font></font>
{<font></font>
	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"purch"</span>,
	<span class="hljs-attr">"key"</span>: <span class="hljs-string">"purch.XXX"</span>,
	<span class="hljs-attr">"id"</span>: <span class="hljs-string">"purch.XXX^1580006158787"</span>,
	<span class="hljs-attr">"date"</span>: <span class="hljs-string">"2020-01-21"</span>,
	<span class="hljs-attr">"person"</span>: <span class="hljs-string">"person.0^1580006048190"</span>, <span class="hljs-comment">//   </span>
	<span class="hljs-attr">"stock"</span>: <span class="hljs-string">"stock.0^1580006048190"</span>, <span class="hljs-comment">//   </span>
	<span class="hljs-attr">"lines"</span>: [<font></font>
		{<font></font>
			<span class="hljs-attr">"nomen"</span>: <span class="hljs-string">"nomen.0^1580006048190"</span>, <span class="hljs-comment">//   </span>
			<span class="hljs-attr">"qty"</span>: <span class="hljs-number">10000</span>,
			<span class="hljs-attr">"price"</span>: <span class="hljs-number">116.62545127448834</span><font></font>
		}<font></font>
	]<font></font>
}<font></font>
</code></pre></div></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.耐性と変異性</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ドキュメントジャーナルは2つの異なる部分に分かれています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の大きな</font><font style="vertical-align: inherit;">部分はJSONファイルにあり、順次読み取りに使用でき、サーバーノードにコピーできるため、読み取りの同時実行性が確保されます。</font><font style="vertical-align: inherit;">不変部分で計算されたたたみ込みはキャッシュされ、シフトされるまで、イミュニティポイントも変更されません（つまり、複製されます）。</font></font></li>
<li> <b></b> ,      (   —  ),       (  ),       (,    ,    ..).      ,          .</li>
</ul><br>
<b>3. </b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 JOINのセマンティクスがないため、SQL言語は不適切であり、すべてのアルゴリズムはfilter / reduce関数スタイルで記述されており、特定のタイプのドキュメント用のトリガー（イベントハンドラー）もあります。フィルター/縮小の計算は、畳み込みと呼ばれます。アプリケーション開発者のたたみ込みアルゴリズムは、ドキュメントジャーナルのフルパスのように見えますが、カーネルは実行中に最適化を行います。不変部分から計算された中間結果は、キャッシュから取得され、可変部分から「カウント」されます。したがって、2回目の起動から開始して、コンボリューションは完全にRAMで計算され、100万のドキュメントで1秒未満の時間がかかります（これを例で示します）。変更可能なドキュメントのすべての変更を追跡することは非常に難しいため、畳み込みは呼び出しごとにカウントされます（命令型反応型アプローチ）。また、RAM内の計算は安価であり、このアプローチのユーザーコードは大幅に簡素化されます。たたみ込みでは、他のたたみ込みの結果を使用して、IDでドキュメントを抽出し、キーでトップキャッシュ内のドキュメントを検索できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.ドキュメントのバージョン管理とキャッシュ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">各ドキュメントには一意のキーと一意のID（キー+タイムスタンプ）があります。</font><font style="vertical-align: inherit;">同じキーを持つドキュメントはグループに編成され、最後のレコードが最新（最新）であり、残りは履歴です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュとは、削除可能なすべてのものであり、データベースの起動時にドキュメントジャーナルから再び復元されます。</font><font style="vertical-align: inherit;">私たちのシステムには3つのキャッシュがあります。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDアクセス付きの</font><b><font style="vertical-align: inherit;">ドキュメントキャッシュ</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常、これらは経費率ジャーナルなどのディレクトリと半永久的なドキュメントです。</font><font style="vertical-align: inherit;">キャッシング属性（yes / no）はドキュメントのタイプに関連付けられており、キャッシュはデータベースの最初の起動時に初期化され、カーネルによってサポートされます。</font></font></li>
<li><b>- </b>    .         (   ).   -    , -     /   .</li>
<li><b> </b>,           / .   —      +     (     ),    —     (     ).</li>
</ul><br>
<h4>  ()</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事の実際のトピックである、残留物の保管について説明します。最初に頭に浮かぶのは、残りをたたみ込みとして実装することです。その入力パラメーターはアナリストの組み合わせになります（たとえば、命名+ウェアハウス+バッチ）。ただし、ERPではコストを計算する必要があります。コストをバランスと比較する必要があります（FIFOアルゴリズム、バッチFIFO、倉庫平均-理論的には、アナリストの任意の組み合わせのコストを平均化できます）。つまり、残りは独立したエンティティとして必要であり、すべてがシステム内のドキュメントであるため、残りも特別なタイプの「バランス」を持つドキュメントです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残高は、購入/販売/移動などのドキュメントの行の投稿時にトリガーによって生成されます。バランスキーはアナリストの組み合わせであり、履歴グループから同じキーとバランスをとり、その最後の要素はトップキャッシュに保存され、すぐに利用できます。残高は転記ではないため、集計されません。最後のレコードが関連し、最も古いレコードが履歴を保持します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残高は、数量をストレージユニットに保存し、金額をメイン通貨で保存し、2番目の通貨を最初の通貨に分割します。アナリストの交点で瞬時コストを取得します。</font><font style="vertical-align: inherit;">したがって、システムは残差の完全な履歴だけでなく、結果の監査にプラスになるコストの完全な履歴も保存します。</font><font style="vertical-align: inherit;">天びんは軽量で、天びんの最大数はドキュメントの行数に等しく（行がアナリストの組み合わせでグループ化されている場合は実際には少ない）、トップバランスエントリの数はデータベースのボリュームに依存せず、残高の制御とコストの計算に関与するアナリストの組み合わせの数によって決定されるため、サイズトップキャッシュは常に予測可能です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消耗品を投稿する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当初、残高は「購入」タイプの領収書ドキュメントによって形成され、費用ドキュメントによって調整されます。</font><font style="vertical-align: inherit;">たとえば、販売ドキュメントのトリガーは次のことを行います。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トップキャッシュから現在の残高を抽出します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数量の可用性を確認します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントの行の現在の残高へのリンクと即時コストを保存します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">金額と金額が削減された新しいバランスシートを生成します</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
販売時の残高変動の例</font></font><br>
<br>
<pre><code class="json hljs"><span class="hljs-comment">//   </span><font></font>
{<font></font>
	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"bal"</span>,
	<span class="hljs-attr">"key"</span>: <span class="hljs-string">"bal|nomen.0|stock.0"</span>,
	<span class="hljs-attr">"id"</span>: <span class="hljs-string">"bal|nomen.0|stock.0^1580006158787"</span>,
	<span class="hljs-attr">"qty"</span>: <span class="hljs-number">11209</span>, <span class="hljs-comment">// </span>
	<span class="hljs-attr">"val"</span>: <span class="hljs-number">1392411.5073958784</span> <span class="hljs-comment">// </span><font></font>
}<font></font>
<span class="hljs-comment">//  ""</span><font></font>
{<font></font>
	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"sale"</span>,
	<span class="hljs-attr">"key"</span>: <span class="hljs-string">"sale.XXX"</span>,
	<span class="hljs-attr">"id"</span>: <span class="hljs-string">"sale.XXX^1580006184280"</span>,
	<span class="hljs-attr">"date"</span>: <span class="hljs-string">"2020-01-21"</span>,
	<span class="hljs-attr">"person"</span>: <span class="hljs-string">"person.0^1580006048190"</span>,
	<span class="hljs-attr">"stock"</span>: <span class="hljs-string">"stock.0^1580006048190"</span>,
	<span class="hljs-attr">"lines"</span>: [<font></font>
		{<font></font>
			<span class="hljs-attr">"nomen"</span>: <span class="hljs-string">"nomen.0^1580006048190"</span>,
			<span class="hljs-attr">"qty"</span>: <span class="hljs-number">20</span>,
			<span class="hljs-attr">"price"</span>: <span class="hljs-number">295.5228788368553</span>, <span class="hljs-comment">//  </span>
			<span class="hljs-attr">"cost"</span>: <span class="hljs-number">124.22263425781769</span>, <span class="hljs-comment">// </span>
			<span class="hljs-attr">"from"</span>: <span class="hljs-string">"bal|nomen.0|stock.0^1580006158787"</span> <span class="hljs-comment">// -</span><font></font>
		}<font></font>
	]<font></font>
}<font></font>
<span class="hljs-comment">//   </span><font></font>
{<font></font>
	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"bal"</span>,
	<span class="hljs-attr">"key"</span>: <span class="hljs-string">"bal|nomen.0|stock.0"</span>,
	<span class="hljs-attr">"id"</span>: <span class="hljs-string">"bal|nomen.0|stock.0^1580006184281"</span>,
	<span class="hljs-attr">"qty"</span>: <span class="hljs-number">11189</span>,
	<span class="hljs-attr">"val"</span>: <span class="hljs-number">1389927.054710722</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScriptドキュメントハンドラクラスコード</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Document, DocClass, IDBCore } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/DBMeta.ts'</span><font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sale</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DocClass</span> </span>{
    <span class="hljs-keyword">static</span> before_add(doc: Document, <span class="hljs-attr">db</span>: IDBCore): [boolean, string?] {
        <span class="hljs-keyword">let</span> err = <span class="hljs-string">''</span>
        doc.lines.forEach(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> key = <span class="hljs-string">'bal'</span> + <span class="hljs-string">'|'</span> + db.key_from_id(line.nomen) + <span class="hljs-string">'|'</span> + db.key_from_id(doc.stock)
            <span class="hljs-keyword">const</span> bal = db.get_top(key, <span class="hljs-literal">true</span>) <span class="hljs-comment">// true -  ,    -</span>
            <span class="hljs-keyword">const</span> bal_qty = bal?.qty ?? <span class="hljs-number">0</span> <span class="hljs-comment">//  </span>
            <span class="hljs-keyword">const</span> bal_val = bal?.val ?? <span class="hljs-number">0</span> <span class="hljs-comment">//  </span>
            <span class="hljs-keyword">if</span> (bal_qty &lt; line.qty) {<font></font>
                err += <span class="hljs-string">'\n"'</span> + key + <span class="hljs-string">'": requested '</span> + line.qty + <span class="hljs-string">' but balance is only '</span> + bal_qty<font></font>
            } <span class="hljs-keyword">else</span> {<font></font>
                line.cost = bal_val / bal_qty <span class="hljs-comment">//    </span><font></font>
                line.from = bal.id<font></font>
            }<font></font>
        })<font></font>
        <span class="hljs-keyword">return</span>  err !== <span class="hljs-string">''</span> ? [<span class="hljs-literal">false</span>, err] : [<span class="hljs-literal">true</span>,]<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">static</span> after_add(doc: Document, <span class="hljs-attr">db</span>: IDBCore): <span class="hljs-keyword">void</span> {<font></font>
        doc.lines.forEach(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> key = <span class="hljs-string">'bal'</span> + <span class="hljs-string">'|'</span> + db.key_from_id(line.nomen) + <span class="hljs-string">'|'</span> + db.key_from_id(doc.stock)
            <span class="hljs-keyword">const</span> bal = db.get_top(key, <span class="hljs-literal">true</span>)
            <span class="hljs-keyword">const</span> bal_qty = bal?.qty ?? <span class="hljs-number">0</span>
            <span class="hljs-keyword">const</span> bal_val = bal?.val ?? <span class="hljs-number">0</span><font></font>
            db.add_mut(<font></font>
                { <font></font>
                    <span class="hljs-attr">type</span>: <span class="hljs-string">'bal'</span>, 
                    <span class="hljs-attr">key</span>: key,
                    <span class="hljs-attr">qty</span>: bal_qty - line.qty,
                    <span class="hljs-attr">val</span>: bal_val - line.cost * line.qty <span class="hljs-comment">// cost   before_add()</span><font></font>
                }<font></font>
            )<font></font>
        })<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、費用を経費明細に直接保存するのではなく、貸借対照表から参照して取得することは可能ですが、実際には、残高はドキュメントであり、たくさんあり、すべてをキャッシュすることは不可能であり、ディスクから読み取ることによってIDでドキュメントを取得するのは高価です（迅速なアクセスのために順次ファイルにインデックスを付ける方法-次回はお知らせします）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コメンテーターが指摘した主な問題はシステムのパフォーマンスであり、比較的関連性の高いデータ量を測定するためにすべてのものがあります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースデータの生成</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのシステムは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5,000の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取引先（サプライヤーと顧客）、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3,000の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイテム、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">倉庫、および</font><font style="vertical-align: inherit;">購入、転送、販売の各タイプの10 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">万の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントで構成されます。ドキュメントはランダムに生成され、ドキュメントあたり平均8.5行です。購入と販売ラインは、その結果、1つの取引（及び1バランス）を生成し、動きの二行</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300K</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要文書について生成する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">340万</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">州のERPの毎月のボリュームと一致している取引、。同様の方法で可変部分を生成しますが、体積は10分の1です。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">スクリプトで</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ドキュメントを生成し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">購入から始めましょう。残りのドキュメントの間に、トリガーはアイテムと倉庫の交差点で残高をチェックし、少なくとも1つのラインが通過しない場合、スクリプトは新しいドキュメントを生成しようとします。</font><font style="vertical-align: inherit;">残高はトリガーによって自動的に作成されます。アナリストの組み合わせの最大数は、アイテム数*倉庫数に等しくなります。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">150k。</font></font></b><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBとキャッシュサイズ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトが完了すると、次のデータベースメトリックが表示されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変部分：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.7kk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント（プライマリ300k、残りは残高）-ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">770 Mb</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可変部分：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">370k</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント（30kプライマリ、残りはバランス）-ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">76 Mb</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントのトップキャッシュ：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">158,000</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント（参照+残高の現在のスライス）-ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 MB</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントキャッシュ：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.8k</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント（ディレクトリのみ）-ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;1 Mb</font></font></b></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベンチマーク</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ベースの初期化。</font><font style="vertical-align: inherit;">キャッシュファイルがない場合、データベースは最初の起動時にフルスキャンを実装します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変データファイル（キャッシュされたタイプのドキュメントのキャッシュを埋める）-55 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秒</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可変データファイル（データ全体をメモリに読み込み、トップキャッシュを更新）</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-6秒</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュが存在する場合、ベースを上げる方が高速です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可変データファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-6秒</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トップキャッシュファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1.8秒</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他のキャッシュ-1秒未満</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の呼び出しで</font><font style="vertical-align: inherit;">
ユーザーの畳み込み（たとえば、</font><font style="vertical-align: inherit;">ターンオーバーシート</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成する</font><font style="vertical-align: inherit;">ための</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">スクリプトを実行</font></a><font style="vertical-align: inherit;">）は、不変ファイルのスキャンを起動し、可変データは既にRAMでスキャンされています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不変データファイル-55 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秒</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリ内の可変配列</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-0.2秒</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
後続の呼び出しでは、入力パラメーターが一致すると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reduce（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は結果を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.2秒</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">返し</font><font style="vertical-align: inherit;">ますが、毎回以下を実行します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーごとにリデュースキャッシュから結果を抽出（パラメーターを考慮）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリ内の可変配列のスキャン（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">370k</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィルタリングされたドキュメントに畳み込みアルゴリズムを適用して結果を「数える」（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20k</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は、このような量のデータ、私のシングルコアラップトップ、DBMSの完全な欠如（これは単なるプロトタイプであることを忘れないでください）、およびTypeScript言語のワンパスアルゴリズム（これは、企業にとって軽薄な選択と見なされます）にとって非常に魅力的です。バックエンドアプリケーション）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技術的最適化</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードのパフォーマンスを調べたところ、80％以上の時間がファイルの読み取りとUnicodeの解析、つまり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File.read（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TextDecoder（）。Decode（）に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">費やされていることがわかりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さらに、</font><font style="vertical-align: inherit;">Deno </font><font style="vertical-align: inherit;">の高レベルのファイル</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェイス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は非同期のみであり、私が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近発見したよう</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非同期/待機の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">価格は</font><font style="vertical-align: inherit;">私のタスクに</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">高すぎます。</font><font style="vertical-align: inherit;">したがって、私は独自の同期</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">リーダー</font></a><font style="vertical-align: inherit;">を作成する必要がありました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最適化を気にせずに、純粋な読み取りの速度を3倍、またはJSON解析で数えると-2倍、同時にグローバルに非同期を排除します。</font><font style="vertical-align: inherit;">おそらく、この部分は低レベル（またはおそらくプロジェクト全体）に書き直す必要があります。</font><font style="vertical-align: inherit;">ディスクへのデータの書き込みも許容できないほど遅いですが、これはプロトタイプにとってそれほど重要ではありません。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらなるステップ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.次のERPアルゴリズムの実装を機能的なスタイルで示します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予備管理と未解決のニーズ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サプライチェーン計画</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">間接費を考慮した生産コストの計算</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.ネストされたトランザクションの実装を実証します（このアーキテクチャーの場合、ドキュメントの削除はなく、変更はドキュメントの新しいバージョンの追加にあるため、非常に簡単です）。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.マルチユーザーモードでFuncDBを転送します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CQRSの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原則に従って</font><font style="vertical-align: inherit;">、不変データのスキャンは、いわゆる不変のデータベースファイルのコピー先（またはネットワーク経由での変化）の「クライアント」ノード、および現在のデータ、キャッシュ、トランザクションの処理は、専用の「サーバー」ノードを介して実行されます。これにより、すべての重い操作と遅い操作をスケーリングし、トランザクションサーバーを簡単、つまり高速にすることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.シーケンシャルファイルのインデックス作成により、キャッシュされていないドキュメントのIDによる取得の高速化（もちろん、これはシングルパスアルゴリズムの概念に違反しますが、可能性がある場合は、ない場合より常に優れています）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、機能的なDBMS / ERPのアイデアを放棄する単一の理由は見つかりませんでした。特定のタスク（会計および計画）に対するそのようなDBMSの非普遍性にもかかわらず、ターゲットシステムのスケーラビリティ、可聴性、および信頼性を複数の機会で得ることができるためです。 FIの原則。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なプロジェクトコード</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
誰かが自分でプレイしたい場合：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">デノを</font></a><font style="vertical-align: inherit;">インストールする</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリを複製する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残基制御を使用してデータベース生成スクリプトを実行します（generate_sample_database_with_balanses.ts）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ルートフォルダーにある例1..4のスクリプトを実行する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自の例を考え、エンコードしてテストし、フィードバックを送ってください</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソール出力はLinux用に設計されています。おそらくWindows環境ではesc-sequencesは正しく機能しませんが、確認するものはありません:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご清聴ありがとうございました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485492/index.html">科学者は宇宙がどれほど速く拡大していると言います</a></li>
<li><a href="../ja485496/index.html">LyX：総論。パート1</a></li>
<li><a href="../ja485498/index.html">Springのリアクティブアプリケーションの例（2020年1月14日からリリース）</a></li>
<li><a href="../ja485502/index.html">OpenStreetMap No. 495の世界からのニュース（2020年1月7日から2020年1月13日）</a></li>
<li><a href="../ja485504/index.html">顔認識を禁止することで、私たちは要点を逃します</a></li>
<li><a href="../ja485510/index.html">開発者である場合に製品を単独で起動する方法：Laravelの作成者であるTaylor Otvelからのヒント。パート3：あきらめないでください</a></li>
<li><a href="../ja485514/index.html">EBlink-ARM Cortex-Mマイクロコントローラー用GDBサーバー</a></li>
<li><a href="../ja485518/index.html">構成可能ではないものを構成しようとする：すべてを上げる</a></li>
<li><a href="../ja485520/index.html">Laravelの例でのモデルのフィルタリングの概念</a></li>
<li><a href="../ja485522/index.html">ハックザボックス-ウォークスルーAI。JDWPのSreach、SSH転送、およびRCEへのAPIテキストでのSQLi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>