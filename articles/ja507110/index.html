<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏽‍🤝‍🧑🏽 🎚️ 🚶🏿 LinuxおよびmacOSで動作するC＃プロジェクトのエラーを見つける方法 👨🏼‍💼 🧘🏻 🎃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studioはよく知られた静的コードアナライザーであり、ソースに隠された多くのトリッキーなエラーを見つけることができます。新しいバージョンのベータテストが最近完了しました。このテストでは、LinuxおよびmacOSのC＃プロジェクトを分析できます。さらに、アナライザーをJetBrains C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>LinuxおよびmacOSで動作するC＃プロジェクトのエラーを見つける方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="写真8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioはよく知られた静的コードアナライザーであり、ソースに隠された多くのトリッキーなエラーを見つけることができます。</font><font style="vertical-align: inherit;">新しいバージョンのベータテストが最近完了しました。このテストでは、LinuxおよびmacOSのC＃プロジェクトを分析できます。</font><font style="vertical-align: inherit;">さらに、アナライザーをJetBrains Cross-Platform IDE-Riderと統合できるようになりました。</font><font style="vertical-align: inherit;">この記事では、オープンソースプロジェクトのRavenDBをチェックする例について、これらの機能を理解することができます。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しばらく前に、同僚の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セルゲイヴァシリエフ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、</font><font style="vertical-align: inherit;">開発中のPVS-Studioスタティックアナライザーの新しいバージョンのベータテストを開始し</font><font style="vertical-align: inherit;">た</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こと</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">メモを</font></a><font style="vertical-align: inherit;">書きました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これでベータテストが完了し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリックして新しいバージョンをダウンロードできます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同じ記事で、コンソールインターフェイスと</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、Linux / macOSでC＃プロジェクトを分析する方法を検討します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、いくつかの興味深いアナライザー操作の伝統的な分析を行います。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="写真5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検証のために、オープンなRavenDBプロジェクトが選択されました。その</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計は約5000のソースコードファイルです。</font><font style="vertical-align: inherit;">かなり人気のあるNoSQLデータベースです。</font><font style="vertical-align: inherit;">詳細は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウェブサイトをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その規模に惹かれたことは容易に想像できます。このような大規模で、間違いなく深刻なプロジェクトでは、おそらく興味深いものがあるでしょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドラインインターフェース</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、コンソールで分析する方法を検討します。</font><font style="vertical-align: inherit;">私の意見では、このセクションは、アナライザーをCIシステムに統合したい人にとって特に興味深いでしょう。</font><font style="vertical-align: inherit;">分析を開始するチームにはいくつかの興味深いオプションがありますが、一般的なケースでは、すべてが非常に簡単です。</font><font style="vertical-align: inherit;">RavenDBを分析するには、プロジェクトフォルダーに移動し、コンソールに次のように入力します。</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-tフラグ（ターゲットの略）は、検証のためのソリューションまたはプロジェクトファイルを指定するために使用されます。</font><font style="vertical-align: inherit;">上記の行は分析を開始し、作業の結果として、見つかったエラーを含むファイルを形成します。</font><font style="vertical-align: inherit;">簡単ですね。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライダー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Riderでのアナライザーの操作は、Visual Studioとほぼ同じです。</font><font style="vertical-align: inherit;">プラグインのシンプルで直感的なインターフェースにより、数回クリックするだけでプロジェクトをチェックできます。</font><font style="vertical-align: inherit;">これは誇張ではありません。RavenDB分析を行うには、[ツール]トップメニューをクリックし、[PVS-Studio]をポイントして、[現在のソリューション/プロジェクトの確認]をクリックするだけです。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="写真2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析結果は、PVS-Studioタブのウィンドウの下部に表示されます（まあ、他にどれですか:)）。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="写真3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visual Studioのプラグインと同様に、警告をダブルクリックすると、関連付けられている場所が表示されます。すべてが便利でわかりやすいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに重要なことに、PVS-Studioツールはエラーを示すだけでなく、大規模な古いプロジェクトでも静的分析手法を簡単に実装できるインフラストラクチャを備えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的な考え方は次のとおりです。ユーザーはアナライザーを起動し、多くの警告を受けました。長年に渡って開発されたプロジェクトは生きており、発展し、お金を稼いでいるので、レポートには重大な欠陥を示す警告があまりありません。言い換えれば、重大なバグは、何らかの方法で、または顧客からのフィードバックのおかげで、すでに何らかの方法で修正されています。したがって、アナライザーが現在検出するすべてのものは、技術的な負債と見なすことができます。これは、すぐに排除しようとすることは現実的ではありません。今のところこれらの警告を無視することは合理的ですが、すでに定期的な分析を実行している新しいコードを書くことは合理的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioに、これらの警告を無関係と見なして（後で技術的な負債を延期する）、再度表示しないように指示できます。アナライザーは特別なファイルを作成し、そこにこれまでに興味のないエラーに関する情報を格納します。そして、PVS-Studioは、新規または変更されたコードに対してのみ警告を発行します。さらに、これらはすべて巧妙に実装されています。たとえば、ファイルの先頭に空の行が追加された場合、アナライザは実際には何も変更されていないことを理解し、何も表示されません。このマークアップファイルは、バージョン管理システムに埋め込むことができます。ファイルは大きいですが、敷設しても意味がない場合が多いので、怖くはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、すべてのプログラマーに、新規または変更されたコードのみに関連する警告が表示されます。したがって、アナライザーは翌日と呼ばれるものを使用し始めることができます。そして、後で技術的負債に戻って、エラーを徐々に修正し、アナライザーを構成することが可能になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Riderの既存のコードに関する警告を抑制するには、ツール-&gt; PVS-Studioのトップメニューに移動し、[すべてのメッセージを抑制する]をクリックします。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="写真1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在表示されているすべての操作が抑制リストに分類されることを警告するウィンドウが表示されたら、[OK]をクリックします。</font><font style="vertical-align: inherit;">その結果、抑制ファイルがプロジェクトフォルダーに作成され、以降の作業でアナライザーによって考慮されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Riderにはすでにいくつかのエラーを正しく強調表示するアナライザーがあることに注意してください。</font><font style="vertical-align: inherit;">したがって、PVS-Studioからの一連の警告は、エディターの観点から疑わしいコードを指しています。</font><font style="vertical-align: inherit;">それにもかかわらず、PVS-Studioは、JetBrainsからアナライザーの敏感な目から逃れることができるエラーをかなり頻繁に見つけます。</font><font style="vertical-align: inherit;">そのため、最も効果的な解決策は、チームで作業できるようにすることです。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="写真10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そしてデザートに</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、約束どおり、検証の結果に従ってアナライザーがどのような警告を表示したかを検討します。プロジェクトには膨大な数のソースコードファイルが含まれているため、不審な瞬間が数多く見つかることは驚くに値しません。することは何もありません-誰もが間違いを犯しますが、タイムリーにそれらを検出して修正するためにあらゆる努力をすることが重要です。静的分析は、このタスクを大幅に簡略化できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェックの結果、約1,000件の警告が表示されました。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="写真11"></div><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
クリックすると、警告レベルの詳細を確認できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、すべてのトリガーが超恐ろしい間違いを示しているわけではありません。</font><font style="vertical-align: inherit;">これがそうである場合、少なくとも何かがプロジェクトで機能した可能性は低いです:)。</font><font style="vertical-align: inherit;">ただし、アナライザーが「不良」である場合、コードは奇妙に見え、慎重に調査する必要があることを理解することが重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、このプロジェクトは多くの興味深いポジティブを発見しました。</font><font style="vertical-align: inherit;">それでも、記事が非常に大きくなることを望まないので、そのうちのいくつかのみを検討します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加のチェックだけですか？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'dirpath == null'は常にfalseです。 PosixHelper.cs（124）Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この操作はさまざまな方法で考えることができます。一方で、追加のチェックはもちろんあまり良くありませんが、それ自体は間違いではありません。一方、検討する価値はあります。このコードは、プログラマが意図したとおりに実際に機能するのでしょうか。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、開発者は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返さ</font><font style="vertical-align: inherit;">ないことを本当に知りませんでした</font><font style="vertical-align: inherit;">。そうでない場合は、彼が達成したかったことを想定できます。</font><font style="vertical-align: inherit;">問題のディレクトリの親を取得できない場合は、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を呼び出す必要があります。もしそうなら、</font><i><font style="vertical-align: inherit;">nullを</font></i><font style="vertical-align: inherit;">チェックし</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理にかなっています。</font><font style="vertical-align: inherit;">ただし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の結果で</font><font style="vertical-align: inherit;">はなく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドによって返される値</font><font style="vertical-align: inherit;">を考慮する必要</font><font style="vertical-align: inherit;">があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それ以外の場合は</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">GetParent</font></i><font style="vertical-align: inherit;">メソッドで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">返す</font><font style="vertical-align: inherit;">と、</font><i><font style="vertical-align: inherit;">ToStringを</font></i><font style="vertical-align: inherit;">呼び出すときに例外が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スローされ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">典型的なヌル</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証された後、 'item'オブジェクトが使用されました。チェック行：249、247。ActiveTransactions.cs（249）、ActiveTransactions.cs（247）Voron </font><i><font style="vertical-align: inherit;">アイテムが</font></i><font style="vertical-align: inherit;">実際に</font><i><font style="vertical-align: inherit;">nullの</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
場合に何が起こるかにより、コードが奇妙に見え</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。実際、</font><i><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></i><font style="vertical-align: inherit;">も</font><i><font style="vertical-align: inherit;">nullの</font></i><font style="vertical-align: inherit;">場合、条件はtrueであり、</font><i><font style="vertical-align: inherit;">item.Id</font></i><font style="vertical-align: inherit;">を取得しようとすると</font><font style="vertical-align: inherit;">例外がスローされます。また、</font><i><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></i><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">できない</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">は、条件 " </font><i><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「それは単に余計だ。それはときにのみチェックされているので、これがある</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">項目== nullを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。まあ、突然場合</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">項目が</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">することはできません</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、全体の状態はその意味を失い、唯一の不必要なネスティングを追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はここにいると思う、たぶん間違った論理演算子が選択</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
される公平に言えば、Riderに組み込まれているアナライザーもこのフラグメントを潜在的に危険であるとマークしていることに注意してください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もう一度チェック？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 '_continuationState.Count&gt; 0'は常にtrueです。</font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs（152）Sparrow </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、外部条件で、コレクション内の要素の数が1より大きいことを確認し、次の行で、3項演算子がそれらの数が0より大きいことを確認します。1つのチェックが異なるように見えるはずです。</font><font style="vertical-align: inherit;">いずれにしても、このコードは非常に疑わしく見え、必要に応じて慎重に調査して処理する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能なNRE</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に、「node.Indexer」オブジェクトが使用されました。チェック行：1180、1182。ExpressionStringBuilder.cs（1180）、ExpressionStringBuilder.cs（1182）Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これはPVS-StudioとRiderが疑わしいと考える別の場所です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確か</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、表現は多少異なります</font><i><font style="vertical-align: inherit;">。JetBrainsのアナライザー</font></i><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">node.Indexer.DeclaringType</font></i><font style="vertical-align: inherit;">を「Possible NullReferenceException」というコメントで</font><font style="vertical-align: inherit;">強調表示します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらのレビューアも、このフラグメントで実際に例外がスローされる可能性があると主張しています。 PVS-Studioからの警告は、ここで間違いがあり得ることを示しているだけでなく、なぜ彼がそのような意見を持っていたのかも説明しています。それはささいなことのようですが、いいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実は間違いがあるわけではありません。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexerが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正確に指定され</font><font style="vertical-align: inherit;">ている可能性があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexerの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">両方が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ない</font><font style="vertical-align: inherit;">場合、状況は許容され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合にのみ、両方のアナライザーの所定の操作を偽と見なすことができます。</font><font style="vertical-align: inherit;">したがって、すべての可能なオプションを注意深く分析することは価値があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、あなたがより深く掘るなら？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'command！= Null'は常にtrueです。 AsyncDocumentSession.Load.cs（175）Raven.Client </font><i><font style="vertical-align: inherit;">CreateRequestメソッド</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">nullを</font></i><font style="vertical-align: inherit;">返さない</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ため、警告が発行され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。実際、コードを見てこれを確認してください：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、このチェックはそのような問題ではありませんが、特定の状況ではメソッドがnullを返すために使用された可能性がありますが、現在は例外がスローされます。</font><font style="vertical-align: inherit;">誰が知っているか、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をチェックする代わりに</font><font style="vertical-align: inherit;">、try-catchが存在</font><font style="vertical-align: inherit;">する可能性</font><font style="vertical-align: inherit;">があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたは非常に合理的な質問があるかもしれません：ここでスローされた例外はどこですか？</font><font style="vertical-align: inherit;">そうでない場合でも、追加のチェックがあるだけで、ここで間違いはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし悲しいかな、メソッドが実行されると、実際に例外が2回スローされる可能性があります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの最初</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のコンストラクターで</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従来のコピーペースト</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの類似したコードフラグメントが見つかりました。おそらく、これはタイプミスです。 SmugglerResult.cs（256）、SmugglerResult.cs（253）Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少なくとも誰かがコードを見てここで奇妙なことを見るのではないかと疑っています。この関数は14の類似した条件で構成されており、すべての変数はUpdatedで終わります。ここで小さな部分を指定しても、エラーはすぐには表示されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
人間の脳は文字通りそのようなコードで何かを探すことを拒否します。同時に、PVS-Studioは、それが割り当てられていることを簡単に発見しました。おそらく、それは完全に間違っており、次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
代入演算子の右側の一番下の行が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdatedである</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことは論理的です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">静的分析がなければ、この奇妙さは、それが原因で十分に深刻な何かが壊れた場合にのみ見つかると確信しています。</font><font style="vertical-align: inherit;">プログラマは、事前に知っている場合を除いて、問題がこの関数に隠されていることに気付くことができます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それか "？？"</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく「??」演算子は、予期されたものとは異なる方法で動作します。その優先順位は、左側にある他の演算子の優先順位よりも低くなっています。 InMemoryDocumentSessionOperations.cs（1952）Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、これがまったく間違いではない可能性、つまり意図したとおりである可能性は残っています。しかし、この場所は非常に疑わしいです。結局のところ、関数のアイデアは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == nullで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0を返さないことであると想定することは論理的</font><i><font style="vertical-align: inherit;">です。</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
演算子の優先順位に関連するエラーが本当にあると思います。この場合、ブラケットを置く必要があります：</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、突然すべてが本当に計画されている場合は、おそらくそれを明示的に指摘する必要があります。そうすれば、コードを読み取るアナライザーとプログラマーは質問をしなくなります。</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、これは好みの問題です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを渡す</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ValidateLicense」メソッドに渡される引数の順序が誤っている可能性があります：「newLicense」および「oldLicense」。</font><font style="vertical-align: inherit;">LicenseHelper.cs（177）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
引数が疑わしい順序でメソッドに渡されました。</font><font style="vertical-align: inherit;">実際、広告を見てみましょう。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioがこのようなエラーを検出できることは非常に嬉しいことです。</font><font style="vertical-align: inherit;">これは、動的分析に対する静的分析の利点の問題の良い例です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記にかかわらず、私は最初に、これらの引数がどの順序で渡されるかは重要ではない可能性があることを示唆しました。</font><font style="vertical-align: inherit;">もちろん、この場合、名前は正しく選択されていませんが、何ができるでしょうか。</font><font style="vertical-align: inherit;">ただし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の内部構造は</font><font style="vertical-align: inherit;">、これらのパラメーターがまだ異なる意味を持つことを示唆しています。</font><font style="vertical-align: inherit;">この関数のコードは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリックして表示できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">続行しない</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式「GetCounterValueAndCheckIfShouldSkip（item.DocumentId、null、prop、out long value、out bool delete）」は常にfalseです。 RavenEtlDocumentTransformer.cs（362）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンクを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリックして完全に検討できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告は</font><font style="vertical-align: inherit;">、このループの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">継続</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">に到達できない</font><font style="vertical-align: inherit;">ことを示してい</font><font style="vertical-align: inherit;">ます。もしそうなら、フラグメントは本当に奇妙です。しかし、それは単なる誤検知ですか？しかし、ライダーはこれについて誓いません。</font><i><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドを見てください</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、このメソッドは</font><i><font style="vertical-align: inherit;">function</font></i><font style="vertical-align: inherit;">！= </font><i><font style="vertical-align: inherit;">Nullの</font></i><font style="vertical-align: inherit;">場合にのみ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返すことができ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">前に検討したコードでは、このパラメーターの場所に正確にnullポインターが渡されます。</font><font style="vertical-align: inherit;">したがって、</font><i><font style="vertical-align: inherit;">継続</font></i><font style="vertical-align: inherit;">呼び出しは</font><font style="vertical-align: inherit;">実際には到達できません。</font><font style="vertical-align: inherit;">
この瞬間は、無害な脱落と、状態のいくつかの間違いに関連する問題の両方になる可能性があります。</font><font style="vertical-align: inherit;">いずれにせよ、あなたはそれに注意を払うべきです。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信頼するが確認する</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">評価される場合、条件式の一部は常にtrueです：属性！= Null。</font><font style="vertical-align: inherit;">LicenseStatus.cs（28）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に奇妙なフラグメント。</font><font style="vertical-align: inherit;">通常、余分なチェックは少なくとも何らかの方法で分離されます。ここでは、変数とnullポインターの対応が次の行で直接チェックされます。</font><font style="vertical-align: inherit;">そのコードは、おそらくプログラマが望んでいたものとはまったく違うようです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullにはならないnull可能</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式「suspend.HasValue」は常にtrueです。</font><font style="vertical-align: inherit;">RachisAdminHandler.cs（116）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一見無害な「追加」チェック。</font><font style="vertical-align: inherit;">アナライザがそれをそのようなものであると考える理由はまだ明らかではありませんが。</font><i><font style="vertical-align: inherit;">ターン</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、この関数は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返す場合があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">はい、そしてライダーはそのチェックが不要であるとは考えませんでした。</font><font style="vertical-align: inherit;">ユニコーンは失敗しましたか？</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="写真15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを</font><i><font style="vertical-align: inherit;">確認</font></i><font style="vertical-align: inherit;">すると</font><font style="vertical-align: inherit;">どうなるでしょうか。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
うーん、パラメータ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">required</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThrowRequiredMember</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドが呼び出され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">彼は何をしているのかしら？</font><font style="vertical-align: inherit;">:)まあ、確かに残っていることは間違いありません：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まとめます。開発者は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出します</font><font style="vertical-align: inherit;">。彼はおそらく、メソッドが必要な値を取得できない可能性があると考えています。その結果、結果として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が返され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。内部では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">呼び出され</font></i><font style="vertical-align: inherit;">ます。問題が発生した場合は、nullを返すか、例外をスローします。 2番目は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必須</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定されている</font><font style="vertical-align: inherit;">場合に発生</font><font style="vertical-align: inherit;">し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。また、これがデフォルト値です。同時に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryStringを呼び出す</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、上記のコードを見ると、送信されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度</font><font style="vertical-align: inherit;">、アナライザーが誓っ</font><font style="vertical-align: inherit;">た</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドのコードを見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が値を取得できなかっ</font><font style="vertical-align: inherit;">
た場合、設計上、スレッドはここで中断されるべきではないよう</font><font style="vertical-align: inherit;">です。実際、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックするブロックの後で</font><font style="vertical-align: inherit;">、さまざまなアクションが実行され、値が返されます。設計上、これらのアクションは</font><i><font style="vertical-align: inherit;">GetBoolValueQueryString</font></i><font style="vertical-align: inherit;">メソッドの成功に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関係なく</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行されると</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">思い</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。実際に何が起こりますか？実行スレッドは例外によって中断されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この点を正しくするために</font><font style="vertical-align: inherit;">、2番目のパラメーターの</font><i><font style="vertical-align: inherit;">必須</font></i><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryStringをfalseに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渡す</font><font style="vertical-align: inherit;">必要があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。その後、すべてが実際に期待どおりに動作します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に述べたように、アナライザーが間違っているように見える場合があります（隠すべき罪は何か、場合によっては起こります）。</font><font style="vertical-align: inherit;">また、非常に頻繁に、警告は重要ではないように見えます。</font><font style="vertical-align: inherit;">ここには追加のチェックがあるようですが、大丈夫です。</font><font style="vertical-align: inherit;">まあ、それ以上に-私たちはそれを削除して問題はありません-警告は消えます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
操作が奇妙でわかりにくいと思われる場合でも、急いでfalseとマークしないでください。</font><font style="vertical-align: inherit;">アナライザーがその場所を問題があると見なす理由を理解し、その後決定を行う必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇妙な</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーター ' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">numberOfResults</font></a><font style="vertical-align: inherit;"> 'は、使用前にメソッド本体で常に書き換えられます。</font><font style="vertical-align: inherit;">DocumentHandler.cs（273）、DocumentHandler.cs（267）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数に渡されたパラメーターは使用されませんが、すぐに上書きされます。</font><font style="vertical-align: inherit;">なぜここに必要なのですか？</font><font style="vertical-align: inherit;">彼らはそれをrefに通したかったのですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドが既存のコードでどのように使用されているかを知りたいと思いました。</font><font style="vertical-align: inherit;">プライベートなのであまり多くないでほしいと思いました。</font><font style="vertical-align: inherit;">ライダーのおかげで、電話がかかってきた場所を簡単に見つけることができました。</font><font style="vertical-align: inherit;">これは唯一の場所でした：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数には0が割り当てられ、次にメソッドに渡され、その結果がそれに割り当てられます。</font><font style="vertical-align: inherit;">また、メソッド内では、このパラメーターは決して使用されません。</font><font style="vertical-align: inherit;">Em。</font><font style="vertical-align: inherit;">なぜこれなのか</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="写真6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">間違った論理演算子</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3'は常にfalseです。</font><font style="vertical-align: inherit;">おそらく '||' </font><font style="vertical-align: inherit;">ここでは演算子を使用する必要があります。</font><font style="vertical-align: inherit;">QueryMetadata.cs（861）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全なメソッドは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で表示でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回は明らかなエラーがあり、間違った論理演算子を使用しています。</font><font style="vertical-align: inherit;">現在の形式では、2未満で3を超える値がないため、引数の数のチェックは機能しません。開発者の本当の意図は、例外コンストラクターに渡される最初の引数によって簡単に明らかになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇妙な試み方法</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">評価される場合、条件式の一部は常にtrueです：isMethod。 QueryParser.cs（1797）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全なメソッドは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構造体</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Method（field、out var method）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int.TryParseの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ような標準メソッドを思い出させました</font><font style="vertical-align: inherit;">。このようなメソッドは結果を取得して出力変数に書き込もうとし、操作の成功のフラグは戻り値です。このような関数を使用するコードは通常、戻り値をチェックし、それに基づいて特定の操作を実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の意見では、</font><i><font style="vertical-align: inherit;">メソッド</font></i><font style="vertical-align: inherit;">関数</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このようにここで使用されます。</font><font style="vertical-align: inherit;">さらに、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の結果は、</font><font style="vertical-align: inherit;">それを呼び出す</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの戻り値です</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり、条件での検証が無意味であることを示します。つまり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返すことはありません</font><font style="vertical-align: inherit;">。それでは、そのような構造の使用は何ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、アナライザーが間違っていないことを確認します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、このメソッドの戻り値は常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。そして、すべてが計画どおりだった場合、これは奇妙ですが、原則として問題ではありません。しかし、そうでない場合はどうでしょうか？</font><font style="vertical-align: inherit;">コードが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ここ</font></a><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">表示される</font><i><font style="vertical-align: inherit;">ReadMethodArguments</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数は</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">場合によっては例外をスローします。これは、メソッドがタスクを正しく実行できない場合に発生します。</font><i><font style="vertical-align: inherit;">Method</font></i><font style="vertical-align: inherit;"> 
関数を呼び出すコードは、</font><font style="vertical-align: inherit;">例外をスローするように設計されていないようです。ほとんどの場合、out変数の値を正しく取得できない場合、</font><i><font style="vertical-align: inherit;">Method</font></i><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">は</font><i><font style="vertical-align: inherit;">false</font></i><font style="vertical-align: inherit;">を返し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。ただし、現在の実装では、代わりに例外がスローされます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれにせよ、このフラグメントに注意を払う価値があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null！= null？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">評価される場合、条件式の一部は常にfalseです：m_curEdgeBlock！= Null。</font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs（803）Raven.Debug </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数にnullポインターが割り当てられ、数行後に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不等式がチェックされ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index！= M_curEdgeBlock.Index + 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をチェックするコードは無意味になり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">また、例外がスローされることはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フラグメントが非常に奇妙に見えるため、何かが正常に機能していないと想定するのは当然です。</font><font style="vertical-align: inherit;">ここではチェックはまったく必要ないか、何らかの方法で正しく実装されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トリガーを検討することもできますが、その逆です。</font><font style="vertical-align: inherit;">この応答が偽である状況を想像してみましょう。</font><font style="vertical-align: inherit;">これは、変数の値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を呼び出して変更できる場合にのみ可能だと思います</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ただし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はプライベートフィールドであり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は同じクラスで初期化される標準キューです。</font><font style="vertical-align: inherit;">したがって、への呼び出しが非常に疑問である</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デキューは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何とかの値に影響を及ぼす可能性があり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlockを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、トリガーはおそらく偽ではありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初またはnull</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「mainSchema」のnull参照が</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">発生する</font></a><font style="vertical-align: inherit;">可能性があります。 'Tables.FirstOrDefault'はデフォルトのnull値を返すことができます。 DatabaseSchema.cs（31）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この</font><font style="vertical-align: inherit;">操作は</font><font style="vertical-align: inherit;">、一見、理解しにくいように見えるかもしれません。実際、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><i><font style="vertical-align: inherit;">それと</font></i><font style="vertical-align: inherit;">何</font><font style="vertical-align: inherit;">をする必要が</font><i><font style="vertical-align: inherit;">あり</font></i><font style="vertical-align: inherit;">ますか？アナライザーが誓う理由を明確にするために、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を調べる必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">First</font></i><font style="vertical-align: inherit;">ではなく</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドの呼び出し</font><font style="vertical-align: inherit;">は、指定された条件に一致する要素がコレクションに含まれていない可能性があるためと考えられます。この場合、</font><i><font style="vertical-align: inherit;">FirstOrDefault</font></i><font style="vertical-align: inherit;">、及び、従って、</font><i><font style="vertical-align: inherit;">GetTableが</font></i><font style="vertical-align: inherit;">返され</font><i><font style="vertical-align: inherit;">ヌルを</font></i><font style="vertical-align: inherit;">ので、</font><i><font style="vertical-align: inherit;">TableSchemaが</font></i><font style="vertical-align: inherit;">参照型です。このため、PVS-Studioは、このコードでnullポインターを逆参照する試みが発生する可能性があると述べています。</font><font style="vertical-align: inherit;">
実行が</font><i><font style="vertical-align: inherit;">NullReferenceExceptionで</font></i><font style="vertical-align: inherit;">中断しないように、このような場合をチェックすることはまだ価値があるかもしれません</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">Tables.FirstOrDefault</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">nullを</font></i><font style="vertical-align: inherit;">返す</font><font style="vertical-align: inherit;">オプション</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">不可能な場合は、使用しても意味がありません。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではなく</font><i><font style="vertical-align: inherit;">FirstOrDefault</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常に真実</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザー警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式は常に真です。</font><font style="vertical-align: inherit;">おそらく「&amp;&amp;」演算子をここで使用する必要があります。</font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs（21）Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
間違った論理演算子が選択される可能性が最も高い状況のもう1つの例。</font><font style="vertical-align: inherit;">この場合、変数は比較対象の値の少なくとも1つと確実に等しくないため、条件は常にtrueです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「||」</font><font style="vertical-align: inherit;">「&amp;&amp;」に置き換える必要があります。</font><font style="vertical-align: inherit;">次に、書かれたものが理にかなっています。</font><font style="vertical-align: inherit;">それでも論理演算子が正しく選択されている場合、最も可能性の高い条件の1つは他の変数の比較です。</font><font style="vertical-align: inherit;">何らかの方法で、このフラグメントは非常に疑わしく見え、分析する必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、この場所に来てくれた皆さんに感謝したい。記事はかなり長くなりましたが、PVS-Studioアナライザーの新しいバージョンを理解し、見つかったエラーを調査するために私と一緒に作業することに興味を持っていただければ幸いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
操作の数を減らさないことを開発者が主な目標として設定する必要があることを覚えておくことが重要です。空のエラーログを取得するためではなく、PVS-Studioを使用する必要があります。ポジティブと戦うことは、ソースコードが苦しんでいる病気の症状と戦うことに似ています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーのメッセージを見るときは、常にこれまたはその警告が発行される理由を常に理解するようにしてください。</font><font style="vertical-align: inherit;">アナライザーが警告を発行したロジックを理解することによってのみ、それがエラーを示しているかどうかを結論付けることができます。</font><font style="vertical-align: inherit;">この場合、あなたは症状ではなく病気と戦うでしょう。</font><font style="vertical-align: inherit;">そして、それはあなたのコードがよりクリーンでより健康になる方法です。</font><font style="vertical-align: inherit;">そしてもちろん、そのようなすばらしい情報源で問題がずっと少なくなるでしょう。</font><font style="vertical-align: inherit;">それらをまったく持たない方がいいですが:)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="写真16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Nikita Lipilin。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinuxおよびmacOSで動作するC＃プロジェクトでエラーを見つける方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja507086/index.html">USBモデムHUAWEI E3372経由でSMSを送信するには、BashスクリプトをC＃コードに変換します</a></li>
<li><a href="../ja507090/index.html">技術チームがスタートアップをどのように構築できるか、または機能監視からAIOpsプラットフォームへのパス</a></li>
<li><a href="../ja507092/index.html">2つ目のオンラインmitap Zabbixにご招待します</a></li>
<li><a href="../ja507104/index.html">インポートの大きな違い：Typescriptでのインポートによる不確実性の明確化</a></li>
<li><a href="../ja507106/index.html">DNS-over-HTTPSの実装はどうですか</a></li>
<li><a href="../ja507112/index.html">PayOnline | ビジネスのためのインターネット獲得</a></li>
<li><a href="../ja507114/index.html">オードエクセル：34年の魔法</a></li>
<li><a href="../ja507116/index.html">「削除されました。」昨日のオフィスデベロッパーからのメモ。パート2</a></li>
<li><a href="../ja507124/index.html">PDBは貴重な毛皮だけではありません</a></li>
<li><a href="../ja507132/index.html">ウラジミール・キトフ：「先駆的な科学者が1950年代に普遍的なコンピューター化をどのように予見したかを理解することは不可能です！」</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>