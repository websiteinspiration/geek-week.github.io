<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏱️ 🤷🏽 🤐 加快前端速度。当许多服务器请求都很好时 🙎🏾 ⬅️ 🕗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文介绍了一些加快加载前端应用程序以实现快速响应用户界面的方法。
 
 我们将讨论前端的一般体系结构，如何预加载必要的资源并增加它们在缓存中的可能性。我们将讨论如何从后端提供资源，以及何时可以将自己限制为静态页面而不是交互式客户端应用程序。
 
 下载过程分为三个阶段。对于每个阶段，我们都制定了提高...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>加快前端速度。当许多服务器请求都很好时</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/490210/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文介绍了一些加快加载前端应用程序以实现快速响应用户界面的方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将讨论前端的一般体系结构，如何预加载必要的资源并增加它们在缓存中的可能性。</font><font style="vertical-align: inherit;">我们将讨论如何从后端提供资源，以及何时可以将自己限制为静态页面而不是交互式客户端应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下载过程分为三个阶段。</font><font style="vertical-align: inherit;">对于每个阶段，我们都制定了提高生产率的一般策略：</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始渲染</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用户需要多长时间才能看到至少一些东西</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">减少渲染阻止请求</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免顺序链</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重用服务器连接</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即时渲染的服务人员</font></font></li>
</ul></li>
<li><b> </b>:   ,     <br>
<ul>
<li>    .    .    <br>
</li>
<li>,        <br>
</li>
<li>       <br>
</li>
<li>     <br>
</li>
<li>    </li>
</ul></li>
<li><b> </b>:        <br>
<ul>
<li>    ,   <br>
</li>
<li>      </li>
</ul></li>
</ol><a name="habracut"></a><br>
<h1> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在初始渲染之前，用户在屏幕上看不到任何东西。我们需要什么渲染？至少上载HTML文档，并在大多数情况下上载其他资源，例如CSS和JavaScript文件。一旦可用，浏览器就可以开始某种渲染。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">本文通篇</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
提供了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表</font><font style="vertical-align: inherit;">。您网站的查询顺序可能看起来像这样。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/36a/970/f6e/36a970f6e3069679776958e6e0ef10d8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTML文档加载了许多其他文件，并且在下载文件后呈现了页面。请注意，CSS文件是彼此并行加载的，因此每个其他请求不会增加明显的延迟。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（注意：在屏幕截图中，gov.uk是一个示例，其中</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">HTTP / 2</font></a><font style="vertical-align: inherit;">现在已</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便资源域可以重用现有连接。</font><font style="vertical-align: inherit;">请参阅下面的服务器连接。）</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">减少渲染阻止请求</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
样式表和（默认情况下）脚本会阻止其下方任何内容的呈现。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有几种解决方法：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将脚本标签移到正文底部 </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用异步模式下载脚本 </font></font><code>async</code><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果应按顺序加载JS或CSS，则最好将它们嵌入小片段中</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免与阻止渲染的顺序请求进行对话</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
渲染站点的延迟不一定与阻止渲染的大量请求相关。</font><font style="vertical-align: inherit;">更重要的是每个资源的大小及其下载的开始时间。</font><font style="vertical-align: inherit;">也就是说，浏览器突然意识到需要下载该资源的时刻。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果浏览器仅在完成另一个请求后才检测到需要下载文件，则存在一系列请求。</font><font style="vertical-align: inherit;">可能由于多种原因而形成：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS </font><font style="vertical-align: inherit;">规则</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS文件引用的Web字体</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可下载的JavaScript或脚本标签</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看一下这个例子：</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ebe/a1b/e44/ebea1be44487e800d63034b7fb2e9b79.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这个站点上的一个CSS文件通过rule加载Google字体</font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着浏览器必须轮流执行以下请求：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML文件</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS应用</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google字体的CSS</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google字体Woff文件（未在图中显示）</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要解决此问题，请先将Google字体CSS请求从标记</font></font><code>@import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移到HTML文档中的链接。</font><font style="vertical-align: inherit;">因此，我们将链接缩短了一个链接。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了进一步加快速度，</font><font style="vertical-align: inherit;">请将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google字体CSS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接</font><b><font style="vertical-align: inherit;">嵌入</font></b><font style="vertical-align: inherit;"> HTML或CSS文件中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（请注意，来自Google字体服务器的CSS响应取决于用户代理行。如果您使用IE8进行请求，则CSS将引用EOT文件，IE11浏览器将接收woff文件，而现代浏览器将接收woff2文件。如果您同意旧版浏览器只能使用系统字体，您只需将CSS文件的内容复制并粘贴到您自己）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即使在开始渲染之后，用户也不太可能与页面进行交互，因为需要加载字体以显示文本。</font><font style="vertical-align: inherit;">我想避免这种额外的网络延迟。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swap参数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里很有用</font><font style="vertical-align: inherit;">，它允许您将其</font></font><code>font-display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与Google字体</font><font style="vertical-align: inherit;">一起使用</font><font style="vertical-align: inherit;">，并在本地存储字体。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有时查询链无法解析。</font><font style="vertical-align: inherit;">在这种情况下，您可能</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑</font><b><font style="vertical-align: inherit;">preload或preconnect标签</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，以上示例中的网站可能</font></font><code>fonts.googleapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实际CSS请求到达之前就已连接。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重用服务器连接以加快请求</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要建立与服务器的新连接，通常需要在浏览器和服务器之间交换三个数据包：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS查询</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立TCP连接</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立SSL连接</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
建立连接后，还需要至少交换一个数据包才能发送请求和接收响应。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下面图表所示，我们开始与四个不同的服务器的连接：</font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>optimizely.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>googletagmanager.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code>googelapis.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后续的服务器请求可能会重用现有的连接</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">下载</font></font><code>base.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">下载的</font></font><code>index1.css</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度更快，因为它们位于与服务器</font></font><code>hostgator.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立连接</font><font style="vertical-align: inherit;">的同一服务器</font><font style="vertical-align: inherit;">上。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/78d/f76/03c/78df7603c84c54788fbec82a7d0622c7.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">减小文件大小并使用CDN</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您控制两个影响查询执行时间的因素：资源文件的大小和服务器的位置。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
向用户发送尽可能少的数据，并确保将其压缩（例如，使用brotli或gzip）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
内容交付网络（CDN）的服务器遍布世界各地。</font><font style="vertical-align: inherit;">用户可以连接到更近的CDN服务器，而不必连接到中央服务器。</font><font style="vertical-align: inherit;">因此，分组交换将更快。</font><font style="vertical-align: inherit;">这特别适用于静态资源，例如CSS，JavaScript和图像，因为它们很容易通过CDN进行分发。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与服务人员一起消除网络延迟</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务人员可让您在将请求发送到网络之前拦截请求。</font><font style="vertical-align: inherit;">这意味着</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">答案几乎马上就来了</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c0c/5b2/7bd/c0c5b27bd4df5e42b3b8e57b2dfb02f2.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，这仅在您真的不需要从网络接收数据的情况下才有效。</font><font style="vertical-align: inherit;">答案应该已经被缓存，因此，好处仅会在第二次下载应用程序时出现。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下面的服务人员缓存呈现页面所需的HTML和CSS。</font><font style="vertical-align: inherit;">当应用程序再次加载时，它会尝试自行发出缓存的资源-并仅在不可用时访问网络。</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">"install"</span>, <span class="hljs-keyword">async</span> e =&gt; {<font></font>
 caches.open(<span class="hljs-string">"v1"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cache</span>) </span>{
   <span class="hljs-keyword">return</span> cache.addAll([<span class="hljs-string">"/app"</span>, <span class="hljs-string">"/app.css"</span>]);<font></font>
 });<font></font>
});<font></font>
<font></font>
self.addEventListener(<span class="hljs-string">"fetch"</span>, event =&gt; {<font></font>
 event.respondWith(<font></font>
   caches.match(event.request).then(<span class="hljs-function"><span class="hljs-params">cachedResponse</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> cachedResponse || fetch(event.request);<font></font>
   })<font></font>
 );<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本指南中，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细说明了如何使用服务工作者预加载和缓存资源。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载申请书</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，用户在屏幕上看到了一些东西。</font><font style="vertical-align: inherit;">他使用该应用程序需要采取什么进一步的步骤？</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载应用程序代码（JS和CSS）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载页面所需的数据</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载其他数据和图像</font></font></li>
</ol><br>
<img src="https://habrastorage.org/getpro/habr/post_images/175/e7f/810/175e7f810d7e33f9647203ad609b402f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，不仅从网络下载数据可能会延迟渲染。</font><font style="vertical-align: inherit;">加载代码后，浏览器应进行分析，编译和执行。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅下载必要的代码，并最大化缓存中的命中次数</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“破坏软件包”表示仅下载当前页面所需的代码，而不下载整个应用程序。</font><font style="vertical-align: inherit;">这也意味着即使其他部分已更改并且需要重新加载，也可以缓存软件包的某些部分。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，代码分为以下几部分：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定页面的代码（特定于页面）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用应用代码</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很少更改的第三方模块（非常适合缓存！）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webpack可以自动执行此优化，破坏代码并减少总体负载。</font><font style="vertical-align: inherit;">使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimization.splitChunks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象将代码分为几部分</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将运行时（运行时）分成一个单独的文件：这样，您可以从长期缓存中受益。</font><font style="vertical-align: inherit;">伊万·阿库洛夫（Ivan Akulov）撰写了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细的指南，介绍如何将程序包分成单独的文件并在Webpack中进行缓存</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
无法自动为特定页面分配代码。</font><font style="vertical-align: inherit;">您必须手动识别可以单独下载的那些部分。</font><font style="vertical-align: inherit;">通常，这是特定的路径或页面集。</font><font style="vertical-align: inherit;">使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态导入</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来延迟加载此代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将整个程序包分成几部分将增加下载应用程序的请求数量。但是，如果并行执行请求，这并不是一个大问题，特别是如果使用HTTP / 2协议加载站点。您可以在下图中的前三个查询中看到这一点：</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/995/816/714/9958167144c54dc634d1b7daa03077e3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，在图中也可以看到两个连续的查询。这些片段仅在此特定页面才需要，它们通过进行动态加载</font></font><code>import()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以尝试通过插入标签preload </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preload</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来解决问题</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/955/2cf/efc/9552cfefcbb751b50e378a0834320b73.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是我们看到页面总加载时间增加了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
资源预加载有时会适得其反，因为它会延迟更重要文件的加载。读</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安迪·戴维斯（Andy Davis）关于预加载字体</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及此过程如何阻止页面渲染开始</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">的文章</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载页面数据</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您的应用程序可能应该显示一些数据。</font><font style="vertical-align: inherit;">您可以使用以下提示尽早下载此数据，而不会造成不必要的渲染延迟。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始下载数据之前，请勿等待软件包的完整下载。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是一系列顺序请求的特例：下载整个应用程序包，然后此代码为页面请求必要的数据。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有两种方法可以避免这种情况：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将数据嵌入HTML文档</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用文档内部的内置脚本运行数据请求</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将数据嵌入HTML中可确保应用程序不等待加载。由于您不需要处理引导状态，因此它还降低了系统的复杂性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，如果这种技术延迟了初始渲染，那么这并不是一个好主意。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这种情况下，如果您要通过服务工作者提交缓存的HTML文档，也可以使用内置脚本来下载此数据。您可以将其作为全局对象使用，这是一个承诺：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.userDataPromise = fetch(<span class="hljs-string">"/me"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果数据准备就绪，并且在这种情况下，应用程序可以立即开始渲染或等待直到准备就绪。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用这两种方法时，您需要事先知道页面将在应用程序开始呈现之前加载哪些数据。</font><font style="vertical-align: inherit;">对于与用户相关的数据（用户名，通知等），这通常很明显，但是对于特定页面特定的内容则更加困难。</font><font style="vertical-align: inherit;">突出显示最重要的页面并为它们编写自己的逻辑也许是有意义的。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等待不相关的数据时不要阻塞渲染</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有时，要生成数据，您需要在后端运行缓慢的复杂逻辑。</font><font style="vertical-align: inherit;">在这种情况下，如果足以使应用程序正常运行和交互，则可以尝试首先下载数据的简单版本。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，分析工具可以在加载数据之前首先下载所有图表的列表。</font><font style="vertical-align: inherit;">这使用户可以立即搜索他感兴趣的图表，还有助于将后端请求分发到不同的服务器。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/996/ab6/613/996ab66136976b0b22d95e7778fb4664.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免连续数据查询</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这可能与上一段相反，那就是最好将非必需数据放在单独的请求中。</font><font style="vertical-align: inherit;">因此，您应该澄清：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果每个完成的请求都不会导致向用户显示更多信息</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请避免使用顺序数据请求链</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与其先查询哪个用户已登录然后再请求其组列表，不如先返回组列表以及第一个请求中的用户信息。</font><font style="vertical-align: inherit;">您可以为此使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是端点</font></font><code>user?includeTeams=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以正常工作。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端渲染</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器端渲染意味着预先渲染应用程序，因此应客户端请求返回整页HTML。客户端看到页面已完全呈现，而无需等待其他代码或数据加载！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于服务器仅向客户端发送静态HTML，因此应用程序此时无法交互。您需要下载应用程序本身，启动呈现逻辑，然后将必要的事件侦听器连接到DOM。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果查看非交互式内容本身很有价值，请使用服务器端呈现。将呈现的HTML缓存在服务器上并立即将其立即返回给所有用户也很不错。例如，使用React显示博客帖子时，服务器端渲染效果很好。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Yanashek的这篇文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述了如何结合服务工作者和服务器端渲染。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一页</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在某个时候，用户将要按下一个按钮并转到下一页。</font><font style="vertical-align: inherit;">从打开起始页面的那一刻起，您就可以控制浏览器中发生的事情，因此可以为下一次交互做准备。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源预载</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您预加载了下一页所需的代码，则当用户开始导航时，延迟消失。</font><font style="vertical-align: inherit;">使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预取标签</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>webpackPrefetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态导入：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>(
    <span class="hljs-comment">/* webpackPrefetch: true, webpackChunkName: "todo-list" */</span> <span class="hljs-string">"./TodoList"</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑流量和带宽给用户带来的负担，特别是如果用户通过移动连接连接时。</font><font style="vertical-align: inherit;">如果有人下载了该网站的移动版本，并且数据存储模式处于活动状态，则合理地进行较小的预加载是合理的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从战略上考虑用户之前需要的应用程序部分。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重用已经下载的数据</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在应用程序本地缓存数据，并使用它避免将来的请求。</font><font style="vertical-align: inherit;">如果用户从其组列表转到“编辑组”页面，则可以立即进行转换，从而重复使用以前下载的有关该组的数据。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，如果该对象经常由其他用户编辑，并且下载的数据可能已过时，则此方法将无效。</font><font style="vertical-align: inherit;">在这些情况下，可以选择先显示现有的只读数据，同时执行对更新数据的请求。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文列出了许多因素，这些因素可能会在加载过程的不同阶段降低您的页面速度。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome DevTools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebPageTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lighthouse之</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的工具</font><font style="vertical-align: inherit;">将帮助您确定哪些因素会影响您的应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，很少有优化立即向各个方向发展。我们需要找出对用户影响最大的内容，并专注于此。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在撰写本文时，我意识到了一件重要的事情：我根深蒂固地相信许多单独的服务器请求都不利于性能。</font><font style="vertical-align: inherit;">过去就是这种情况，当时每个请求都需要一个单独的连接，而浏览器每个域只允许几个连接。</font><font style="vertical-align: inherit;">但是对于HTTP / 2和现代浏览器，情况已不再如此。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有很多赞成将应用程序拆分为多个部分的理由（使用乘法查询）。</font><font style="vertical-align: inherit;">这样一来，您只能下载必要的资源，并且最好使用缓存，因为只有更改过的文件才需要重新加载。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490196/index.html">[Flipper Zero]拒绝Raspberry Pi，从头开始制作我们自己的板子。寻找合适的WiFi芯片</a></li>
<li><a href="../zh-CN490198/index.html">信任但要验证！在演示厅Pult.ru中使用带爱普生投影仪的家庭影院演示区</a></li>
<li><a href="../zh-CN490202/index.html">查询计数：Django基本性能测试</a></li>
<li><a href="../zh-CN490204/index.html">2020年3月HR和IT招聘人员的事件摘要</a></li>
<li><a href="../zh-CN490208/index.html">DUMP2020的后端部分：戏ter，迷，失败</a></li>
<li><a href="../zh-CN490222/index.html">死亡日标准图书馆</a></li>
<li><a href="../zh-CN490224/index.html">时尚的隐形</a></li>
<li><a href="../zh-CN490226/index.html">Blending和Unity Terrain：如何摆脱交叉点并停止使眼睛受伤</a></li>
<li><a href="../zh-CN490232/index.html">使用AWS ELB进行负载平衡</a></li>
<li><a href="../zh-CN490242/index.html">SIM800x模块的GSM定位服务及其与Yandex.Locator API的配合</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>