<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñï üßò üïµüèΩ Offer in London in one day: how to get it and what to do after moving üßôüèª üïµüèø üë©üèæ‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! 
 
 We have big plans for 2020. We intend to actively develop Badoo and Bumble, so we are seriously expanding the technical team. And tod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Offer in London in one day: how to get it and what to do after moving</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/487914/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have big plans for 2020. We intend to actively develop Badoo and Bumble, so we are seriously expanding the technical team. And today we announce the massive hiring of PHP developers in our London office.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2017, we tried a new search format - hiring event: we bring cool developers to Moscow, conduct interviews in one day and immediately make an offer to suitable candidates. All expenses for a trip to the capital, of course, are incurred. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The format has worked well, and we have many open positions again, so we are announcing a new PHP Hiring Event.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The rules are the same: show a high </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> result </font><font style="vertical-align: inherit;">before March 1, successfully pass the interview on March 21 or 22 in Moscow - and on the same day receive an offer to the Badoo London office.&nbsp;</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD: the test is completed, thanks to all participants! </font><font style="vertical-align: inherit;">We have already notified the finalists and warned that the dates of the interview are postponed indefinitely for the comfort and safety of candidates. </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/ms/iu/2b/msiu2bgffxdkk5nkvcxak2v77ns.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the cut, I‚Äôll tell you:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">more about the test;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">what projects we are engaged in: photo optimization, video streaming, machine learning for letters, transition to new versions of PHP and much more.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are a PHP shnik and want to move to London, welcome to kat!</font></font><br>
<br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to pass the test</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The test</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consists of five tasks. Exactly 90 minutes are allotted to the decision: it will not work to delay or pause the process. Before you begin, make sure you have enough time.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In three tasks, you need to write code / SQL queries, and in the remaining two we expect to see detailed answers to questions. Test published on HackerRank. We recommend practicing on the test tasks of the platform in order to get comfortable with the interface.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decisions are made until 2020-03-01 23:59:59 UTC. Based on the test results, we will select approximately 60 candidates whom we will invite to Moscow for an interview.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The company covers all expenses for a trip to Moscow, as well as expenses associated with moving to London. </font><font style="vertical-align: inherit;">We help get working visas to the family members of our new colleague, pay for the flight, rent a house for the duration of the search, pay a cash bonus for the move and help in improving English. </font><font style="vertical-align: inherit;">You can get acquainted with the team already at the interview stage: the developers themselves conduct interviews at the hiring event.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What the server development team does&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are responsible for the backend of dating services Badoo and Bumble. </font><font style="vertical-align: inherit;">In addition to swipe left and right to find a partner, the applications have video streaming, chat with audio messages, searching for people nearby, integration with payment services and much more. </font><font style="vertical-align: inherit;">A relatively simple interface hides a lot of logic in PHP and Go (and it gets more and more).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our team has more than 40 people. </font><font style="vertical-align: inherit;">The work can be divided into two large parts:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new functionality in applications,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">technical projects - improvement of tools, optimization, work with technical debt.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will talk about the most interesting projects that we have implemented over the past two years.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cool chips in the product</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The market for dating applications is dynamic and competitive, therefore our main goal is the development of the product: it must remain interesting and safe for users.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Learned to hide too "personal" photos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some users send chat photos of an erotic nature, even if the interlocutor did not ask for such gifts.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The task that we had to solve was to teach the application to distinguish ‚Äúprivate‚Äù photos (18+) from ordinary ones and show them chatted in the chat, allowing the recipient to decide for himself whether he wants to see them in their entirety.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Together with the R&amp;D team, we created a service on Go with a neural network that can recognize "private" photos. </font><font style="vertical-align: inherit;">If the likelihood that the photo is erotic is higher than the set threshold, a special flag is put in the message and the client handles this situation accordingly: shows a blurred stub asking if the recipient wants to see what is inside.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We run all tasks through A / B tests, and also carefully cover the key points of the new functionality with statistics. </font><font style="vertical-align: inherit;">So, we found out that about 200,000 are sent per day of ‚Äúprivate‚Äù photos. And also, that often these photos are still viewed and not complain about the sender.&nbsp;&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Added audio and video chat messages</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Over the past two years, we have drawn up features to advanced messengers and gave users the opportunity to exchange multimedia messages. </font><font style="vertical-align: inherit;">Implementation of this option on the server side was quite simple due to the flexible architecture of the mobile API and its own CDN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When designing multimedia messages in the chat, we transferred the file upload from the main client-server API to the separate HTTP services located inside the CDN. </font><font style="vertical-align: inherit;">We use a single repository, so from the point of view of code support, this solution did not cause any problems. </font><font style="vertical-align: inherit;">But it made it possible to use tools optimized for the nature of the load:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the mobile API (binary protocol) is sharpened by the exchange of short commands and at the peak passes through itself more than 100,000 requests per second;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDN is tuned for working with multimedia and is capable of delivering 200,000 photos per second (we </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">talked</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> about CDN optimizations in detail </font><font style="vertical-align: inherit;">at the Uptime day conference).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the point of view of CDN, the type of the downloaded file does not matter much, and we already had video conversion. </font><font style="vertical-align: inherit;">We could only correctly process the new types (audio and video) in the protocol of the mobile API.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Learned how to build ML-models without R&amp;D</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2018, we created our own framework for automating the training of models on our data. Now any backend developer can independently build a model tailored for his application, without attracting colleagues from R&amp;D.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This framework is able to collect hundreds of metrics, both universal (gender, age, activity in the application), and specific, significant for each specific model. Algorithms for constructing ML-models are flexibly configured, and graphs of the results are available for analytics ‚Äúout of the box‚Äù. At the output, the framework provides a working model that responds quickly enough (within 10-100 ms) so that it can be called from PHP directly in user requests without sacrificing UX.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Last year, we integrated the framework into various parts of our application: anti-spam systems, rating the application and some others. </font><font style="vertical-align: inherit;">Mail ML is one of the most successful applications: the model predicts the probability of a click on the link in the email for a specific user. </font><font style="vertical-align: inherit;">The model learns from the data of other users, similar to the recipient of the email with ‚Äúimportant‚Äù attributes, and the ‚Äúimportance‚Äù is calculated automatically by the framework. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After evaluating the results, we stopped sending emails with the least chance of clicking on links. </font><font style="vertical-align: inherit;">Due to this we:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">increased user loyalty, which resulted in improved activity metrics in the service: people do not like "hopeless" letters;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">increased inbox rate in key mailers: email services like senders with high CTR.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launched video streaming</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are always looking for new opportunities for development. When video streaming began to gain momentum, we decided to integrate it into our application. Predicting the success of the project was not easy, so in order to reduce costs, we did not plunge headlong into the development of our solution, but found a company that provided the platform and SDK with the functionality we needed.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We were required to build feature logic, client-server interaction, implement options for sending and paying gifts, provide fast moderation of content (both the video stream and comments) and cover everything with metrics. </font><font style="vertical-align: inherit;">We have assembled a cross-functional team from different departments and divisions: client development, server development, billing, platform, back office, BI analytics, design and product management. </font><font style="vertical-align: inherit;">All settled down in one office space - and work began to boil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We determined the functionality of the first version (MVP) - and a month later we launched a feature in one country after another. </font><font style="vertical-align: inherit;">For several weeks we rolled it out in different countries, and today video streaming is available everywhere.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Broadcast user messages on the Arbat</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was a very unusual promotion: all October, Badoo users sent messages to a huge video billboard located on Novy Arbat in Moscow. In a month, 23,000 messages were sent to us, of which 12,000 were successfully moderated and hit the screen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A billboard is such a smart TV with a browser and our JavaScript client inside. Five-minute commercials were shown on the screen, in each of which three minutes were given to us.&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/3q/0g/qu3q0gzmqjtfrrb0y_dh73ddqpm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, all users wanted to see the sent message on the screen with their own eyes. To make this possible, we had to answer the question when each of the messages appears there.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We should inform the user about the time of showing after moderation. Technically, at this point, the message fell into our internal schedule with a clear start time and duration, which was calculated dynamically: from 30 seconds to five minutes (depending on the number of senders).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The difficulty was that the provider, for its part, did not provide the ability to control and track the time of the commercial, so it was necessary to cunningly synchronize our schedule with the schedule of the provider, constantly monitor and adjust if necessary. It helped us that we noticed (logging is our everything!) That a few tens of seconds before the next video was shown, the smart TV reloads the page. It was impossible to focus on this time, but on it one could notice shifts in the schedule, which sometimes reached 15-30 seconds. We set up the monitoring of shifts on our side and at the moments of operation we started to request the time of the nearest show from the provider.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the process of setting up this system, our engineer, who worked from a cafe opposite the billboard, ate an impressive amount of croissants and drank many cups of coffee, but thanks to him, the broadcast of user messages went smoothly and there were no serious incidents.&nbsp;</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technical projects</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite the large volume of grocery work, we devote a lot of time to technical projects. </font><font style="vertical-align: inherit;">Most of them relate to the performance of our applications, as well as the development and improvement of internal tools.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liveprof Open Source Project</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have long had the opportunity to enable XHProf on production for a specific request, but this is not always enough. Requests are different, but for systematic work on performance, I want to see the big picture for all requests. Therefore, such an idea was born: launch XHProf automatically on a small part of the queries, and aggregate the results. This is how the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liveprof</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">appeared</font></a><font style="vertical-align: inherit;"> , which we put in open access. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the process of processing the request, there is logic that, based on the probabilities and the API method, decides whether to start XHProf. Profiling results are written to disk, and then delivered to a separate server, where they are placed in raw form in MySQL.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Once a day, a script is run that aggregates the results for each brand, platform, and API method. </font><font style="vertical-align: inherit;">Thus, we can see the results of profiling for specific requests from Badoo iOS (both in the form of a tree and in the form of a flame graph), we can see what percentage of the cluster it takes to call an individual function (for example, how much it costs to collect a URL for a photo), and recently added the output of this information directly to PhpStorm.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migrating to PHP 7.4</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
New versions of PHP are pleased with the performance improvement. Over the last two transitions (from 7.0 to 7.2 and from 7.2 to 7.4), our department was responsible. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The transition</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> begins long before the official release. First, we manually run the tests with the new version and ... we face a huge number of problems. Some of them are easily solved, while others require some time.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When most of the problems have been resolved, we switch to the new version in the developer environment, for some time we monitor error logs and collect feedback from developers and QA engineers. By the time of the official release of the stable version, we are ready to test on production: first we run it on one machine and gradually lay it out on the others.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But after the new version is distributed on all servers, the transition does not end: we continue to check the syntax with both versions of PHP (new and previous). </font><font style="vertical-align: inherit;">Thus, we are convinced that the developers did not start using the new syntax and that we can switch to the old version at any time if unexpected problems arise in the new one. </font><font style="vertical-align: inherit;">For example, before the New Year holidays, we discovered a small problem with a memory leak in PHP 7.4, decided not to risk it and returned to the previous version before the holidays. </font><font style="vertical-align: inherit;">After the holidays, having dealt with the problem, we again rolled out version 7.4 and still use it.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go aggregation of requests</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the PHP update, our struggle for performance does not end there. We have a powerful framework that does a lot of work at the start: from initialization to various checks required for each request.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We decided to conduct a simple experiment. We selected a part of the commands for which the server‚Äôs response is not critical (for example, sending statistics from the client or choosing the ‚ÄúNo‚Äù option in the swipe game), and wrote a service on Go that accepts such requests, saves them, and then sends them to the server in a packet ( for each user). Thus, we can very easily save on initializing the application without rewriting the main code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The experiment turned out to be successful: according to our estimates, we can save a few percent of the CPU (which in our case is more than ten servers) without rewriting the main code, but at the cost of complicating the operation and the logic of work. </font><font style="vertical-align: inherit;">To complete the picture, we decided to wait for the results of experiments with PHP 7.4 preload and RoadRunner in order to choose the optimal solution according to the ratio of winnings and complexity of implementation.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photo optimization</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
User activity directly depends on some technical projects. For example, the faster we show photos, the more actively people swipe, the more matches happen, the more new pairs form and so on.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In October 2018, one of our brands, Bumble, decided to enter the Indian market. Since we did not know anything about the speed of the local Internet, we decided to conduct a series of experiments with the quality and size of photographs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We launch all technical experiments under A / B tests. This allows you to see not only the difference in the behavior and activity of different groups, but also statistics on the operation of the application on the client, broken down by options. We were interested in time to download pictures and time for decoding and display.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infrastructure, in addition to storage servers, we allocate a cluster of photo caches - these are the servers that store the most commonly used pictures. Since there are a huge number of smartphones with different screens in the world, we store photos in several basic sizes and convert them on the fly to the size and format requested by the client.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The task we wanted to solve was to choose the optimal format (JPEG, WebP, PJPEG), image size and quality. In theory, the WebP format should be the best, but it is the most expensive in terms of conversion on the fly: instead of saving traffic, you need to buy more photo cache servers. Along with this, we decided to test how CDNs in the region will help improve UX.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Several of our engineers were sent there to launch a project in India. So we had not only dry numbers, but also people who could test the application on different operators on the spot, compare its work with the work of other applications, and so on.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The results of the experiments allowed us to choose the best options for the quality and size of photographs. </font><font style="vertical-align: inherit;">For example, we saw that the logic of preloading photos on the client plays a large role in user activity. </font><font style="vertical-align: inherit;">And despite the fact that photos in WebP download faster, the positive effect was noticeable only in mobile browsers. </font><font style="vertical-align: inherit;">The same story with CDN: we tested three external CDN services and, despite the acceleration of content delivery, did not see any positive changes in activity. </font><font style="vertical-align: inherit;">As a result, we turned on WebP for mobile browsers and saved on power, leaving all other clients in JPEG format.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Own video streaming</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As I mentioned above, the first version of video streaming was launched using an external service. The experiment was considered successful - and we began to prepare software and infrastructure for launch in our data centers.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the help of ready-made transcoder (for squeezing the video stream from the user) and Edge-servers (for distributing the stream to the user) we had to build a system similar to an external boxed solution. And, of course, a lot had to be finalized with a ‚Äúfile‚Äù on the go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, initially each Edge server connected to each transcoder server, which complicated scaling and increased internal traffic. We wrote client balancing in such a way that clients of one stream go to the least number of Edge servers, taking into account the popularity of each particular stream.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another example, when we had to be quick-witted, is the logic of changing the quality of a stream in WebRTC: due to the fact that we use two quality options, the standard algorithm was demolished and it worked only towards decreasing the bitrate. </font><font style="vertical-align: inherit;">I had to go deeper and edit the algorithm used inside the WebRTC library. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, WebRTC signaling, by default, passed too much information about hosts on the network to the client. </font><font style="vertical-align: inherit;">The solution was a proxy server on Go, which gives the client only what he needs to know, and in addition collects a lot of useful information about connected clients.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the start of research to full implementation, the project took more than six months, but as a result, we were able to significantly reduce costs by abandoning external services.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance optimization</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is not a one-time project for our team - this is an important area to which we also pay a lot of attention. Our main cluster serving requests from applications consists of hundreds of servers, and therefore it is profitable for us to invest time in work on optimizing the application: each percentage won costs us several physical servers.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We constantly monitor the total load on our cluster and the load for each specific API call. If a certain threshold is exceeded, we begin to search and optimize bottlenecks. The larger the excess, the more people get involved. This approach is fully justified: in the past two years, the cluster growth rate has been half the rate of growth of the audience of our services.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We actively share knowledge gained during optimization work at conferences and meetings. </font><font style="vertical-align: inherit;">More details about our projects and studies can be found in articles and reports by Pasha Murzakov:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP performance: planning, profiling, optimizing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fighting a shared-nothing model: PHP 7.4 preload, RoadRunner and others</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How 200 lines on Go helped us free 15 servers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control over old and unused code</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have quite intensive development, and the pace of launching product tasks and experiments is also growing as the company grows. </font><font style="vertical-align: inherit;">Under such conditions, the code base becomes more complex and less controlled. </font><font style="vertical-align: inherit;">The situation is exacerbated by several platforms and users with older versions of applications and operating systems.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We try to keep our code base ‚Äúclean‚Äù in order to maintain a high pace of work:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automatically create tasks to remove the code after the completion of the product experiment;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automated tracking of old versions of applications and operating systems and the code branches used in them;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduced tools to automatically search for unused code.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can learn more about our results at the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Badoo PHP Meetup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will be held this Saturday, February 15th.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, these are not all the projects that I want to talk about. Over the past two years, we have struggled with spammers and snappers, sawed our plugin for PhpStorm, tested various KV repositories (and chose Aerospike), experimented a lot, shared knowledge in articles, at conferences and not only. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But if you decide that we are only working, then this is not so. Each team has its own team building budget. Our colleagues visited Amsterdam, Edinburgh, Prague and other cities. And last year we organized a general meeting of the department in Croatia: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z0/th/tz/z0thtz68shyqbfbn_lgjojxdzru.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And we also know how to photoshop.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
On </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moving to London and the office in Soho</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we already told, therefore we will not dwell on the details in this article - just show a couple of photos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sb/ul/em/sbulemvjxw8ipp50njicr4epm6m.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Big photo</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/vn/eh/yi/vnehyidqkpljpndkvqnsqkxtlhu.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/a3/vb/rk/a3vbrkj0avtmfek7j7p9kreezfo.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/7h/le/ya/7hleyaxbrafxfip4hyq9rpevowg.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/lt/h8/jw/lth8jww4mra-4adg9_tay4istm4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/hy/ub/0n/hyub0ngeapscepq0jibotaexl6u.jpeg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hiring event is the easiest and fastest way to join our team. </font><font style="vertical-align: inherit;">We accept answers to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> until March 1 inclusive. </font><font style="vertical-align: inherit;">Then we will take a week to analyze the results and call those who coped with the tasks.&nbsp;</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to get to work for us in London, but don‚Äôt want to take the test, there is another option: just respond to vacancies on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , this opportunity is always available. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have any questions, feel free to ask them in the comments or send me private messages.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Good luck</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487902/index.html">From fire to fire: refractory solid-state electrolyte for lithium-ion batteries</a></li>
<li><a href="../en487906/index.html">The book "Computer Networks. Principles, Technologies, Protocols: Anniversary Edition ¬ª</a></li>
<li><a href="../en487908/index.html">The beginning of the war of technological processes: 5 nm and 3 nm</a></li>
<li><a href="../en487910/index.html">Natural laws and elegant mathematics: problems and solutions</a></li>
<li><a href="../en487912/index.html">9 tips to speed up the hiring process in 2020</a></li>
<li><a href="../en487916/index.html">The story of compact audio: how miniature bobbins migrated into a cassette form factor</a></li>
<li><a href="../en487920/index.html">Overloading in C ++. Part I. Overloading functions and templates</a></li>
<li><a href="../en487922/index.html">Learning to deploy microservices. Part 1. Spring Boot and Docker</a></li>
<li><a href="../en487924/index.html">Kim Dotcom: Caught, the most wanted person online. Part 3</a></li>
<li><a href="../en487926/index.html">In search of physical education</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>