<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíù üë©üèΩ‚Äçü§ù‚Äçüë®üèæ ü§≥üèΩ Secure access to a smart home in the absence of a public IP (part 1) üöµüèæ ‚ô¶Ô∏è üë°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction
 It is difficult to choose a capacious title that reflects the meaning, so I will immediately describe the task that I set for myself. 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Secure access to a smart home in the absence of a public IP (part 1)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504716/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is difficult to choose a capacious title that reflects the meaning, so I will immediately describe the task that I set for myself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a "smart home". </font><font style="vertical-align: inherit;">In my case, this is a fanless home server with ioBroker, although this is not important. </font><font style="vertical-align: inherit;">In addition to home stuff, I want to hook sensors to it from the outside (for example, on an ESP32 from a remote greenhouse). </font><font style="vertical-align: inherit;">I decided to do this through mqtt. </font><font style="vertical-align: inherit;">Access to the interface from the Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The usual thing. </font><font style="vertical-align: inherit;">But there are nuances:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The provider has no way to give me a public IP address. </font><font style="vertical-align: inherit;">And there are no other providers.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I do not like binding to specific cloud services. </font><font style="vertical-align: inherit;">An external service may also close (as gbridge recently sent a notification). </font><font style="vertical-align: inherit;">And just in case of failure it is not clear what to do. </font><font style="vertical-align: inherit;">I prefer my own, which can be transferred, redone with little blood if something happens.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safety is important. </font><font style="vertical-align: inherit;">Not paranoia, but putting ioBroker on the Internet, especially considering that there are several services exhibited (flot ...). </font><font style="vertical-align: inherit;">No, really.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further I want to show not immediately the result, but the process. </font><font style="vertical-align: inherit;">How it went, how Wishlist were transformed, decisions changed. </font><font style="vertical-align: inherit;">It is possible that some points can be solved more correctly / efficiently (I am not a system administrator, not a developer). </font><font style="vertical-align: inherit;">Or maybe someone will not go this far and take advantage of an interim solution that, for example, I did not find safe or convenient for myself. </font><font style="vertical-align: inherit;">Actually, what is described in this part is quite a working option, but for me it‚Äôs ‚Äúintermediate‚Äù.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Public address for mqtt</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At home, the public IP on the router does not shine (I'm not talking about fixed, this can be solved through dyndns and analogues), namely, the provider gives 10.x.x.x, without options. </font><font style="vertical-align: inherit;">So, you need to rent a small VPS, and make a probros through it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The easiest way is to tunnel through ssh. </font><font style="vertical-align: inherit;">On the home server (I will call it iob.xxx.xx) I execute:</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh -N -T -R pub.xxx.xx:1883:127.0.0.1:1883 a@iob.xxx.xx </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connecting to port 1883 of the external server pub.xxx.xx, in reality you find yourself on your home iob: 1883 with the mqtt (mosquito) container running. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturally, it is necessary that this starts automatically, the connection is restored after a failure. </font><font style="vertical-align: inherit;">Therefore, I used autossh, designing it as a service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/etc/systemd/system/ssh_mqtt.service:</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Description=SSH Tunnel mqtt<font></font>
After=network.target<font></font>
<font></font>
[Service]<font></font>
Environment="AUTOSSH_GATETIME=0"<font></font>
ExecStart=autossh -M 0 -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3" -NR pub.xxx.xx:1883:127.0.0.1:1883 -i /home/a/.ssh/id_rsa a@pub.xxx.xx<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All sorts of systemctl enable / restart, etc. I will not describe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, despite autossh, I was haunted by constant freezes. So I decided that there is no need to produce entities and settled on the usual ssh: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/etc/systemd/system/ssh_mqtt.service:</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Description=SSH Tunnel mqtt<font></font>
After=network.target<font></font>
<font></font>
[Service]<font></font>
Restart=always<font></font>
RestartSec=20<font></font>
User=anri<font></font>
ExecStart=/bin/ssh -N -T -R pub.xxx.xx:1883:127.0.0.1:1883 -i /home/a/.ssh/id_rsa a@pub.xxx.xx<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Subsequently, by the way, it turned out that this provider is so oblique. Well, or the cheapest rate for 45 rubles / month so crookedly works for him. The session hangs periodically, even when it is simply connected via ssh (MobaXterm). So in the end I ordered myself a VPS from another (55 rubles / month), and the problems with freezes disappeared. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, I chose for myself where to take VPS not only on the basis of price, but also taking into account ping (10-20ms). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, this option is quite normal, especially considering that subsequently I made an Internet connection exclusively to port 8883 via TLS. Those. The password for mosquitto was transmitted encrypted.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Subsequently made client certificates mandatory. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">first, at the TLS level, you need to present a client certificate, and then log in with the password name specified in mosquito. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">it‚Äôs not so easy to get to the password search phase. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accordingly, at first I used the server certificate from LetsEncrypt, then, due to the need for client certificates, I switched to self-signing.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since in the process I also worked on the software for ESP32, I noticed (or just thought, I don‚Äôt remember anymore) that when there are problems with the VPN connection, the battery will be consumed much faster. </font><font style="vertical-align: inherit;">During normal operation, the cycle: Wake up, apply power to the sensors, connect to WiFi, establish a connection with the mqtt server, read the sensor readings as they are ready, transfer to mqtt, turn off the power from the sensors, go into deep sleep for 10 minutes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normally, such a cycle takes about 4 seconds. </font><font style="vertical-align: inherit;">1.5-2 seconds - connection to WiFi, an extra second due to the transition to mqtt over TLS. </font><font style="vertical-align: inherit;">It suits you for 4 seconds, all the same, the sensors need time to wake up. </font><font style="vertical-align: inherit;">But if the VPN went down (it was clearly visible when autossh fell off), what should I do? </font><font style="vertical-align: inherit;">Of course, I set up so that after 20 seconds the system would fall asleep anyway. </font><font style="vertical-align: inherit;">But 20 seconds instead of 4 is very noticeable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, I decided that it is better to keep the mqtt server on an external VPS. </font><font style="vertical-align: inherit;">Now that everything works like a clock, I'm not sure if this is necessary. </font><font style="vertical-align: inherit;">But I don‚Äôt see any sense in remaking it back.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Public Address for Vis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vis is a popular visualization system at ioBroker. You could not bother, and configure it yourself on https and likewise just forward the port. Moreover, she can ask for a password at the application level. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But that is not cool. Especially considering that for work it connects additional services. Say, I draw graphs in flot, relatively speaking, I connect to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vis.xxx.xx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 8082 / vis / index.html, but inside there are links to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vis.xxx.xxx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> graphs </font><font style="vertical-align: inherit;">: 8082 / flot / index.html. At some point, it turned out that when connecting to / vis, a password is asked, and the graph interface is accessible without a password.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At some moments it was generally strange - I was authorized on vis, I see the graph, but at the bottom right there is a translucent ‚ÄúNo connection to server‚Äù window. Rewrote for this css block to hide it. But, as soon as I began to use frame to switch between graphs on the same screen, it turned out that my overlap on the display in the frame did not work. (As it turned out later, it should be so). I turn off authorization - everything is fine, no swearing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So I decided on the same external server to raise nginx in reverse proxy mode. And already make authorization on it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the browser it worked. But the native application iobroker.vis from the Play Market could not log in this way. And I wanted to use it. Although this is actually a browser in the window, but it has a number of nice features. Let's say set the scale (93% in vertical mode), and the image fits. On another device with a different screen resolution, you simply select the coefficient, and that‚Äôs it. And in the browser you need to adjust every time ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Okay, I think. I‚Äôll add a tricky code in the URL instead of the password. Type </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vis.xxx.xx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 8082 / &lt;long sequence&gt; /vis/index.html. Often such a trick is used. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Almost earned. But with glitches, digging showed that this web application was not written correctly. Many links inside it are not relative, but from the root.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Okay, I found several links, I wrote for them, they say, if the referrer contains such code, still trust, rewrite the URL, etc. </font><font style="vertical-align: inherit;">But they gradually came to light. </font><font style="vertical-align: inherit;">So I decided that this is crooked, wrong, and a different approach is needed.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I decided to sacrifice a little access universality. Let me have access from my laptop, smartphone. But from other people's devices, from the Internet cafe is not necessary, I‚Äôll manage. Then you can put a small client that will install the VPN. And inside it, neither SSL nor authorization is required. And at the same time you do not need to redo the links. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The simplest way for me was Zerotier. For my OS (Windows, Android, Linux) there are clients. And there are even ready-made ones in the docker. Yes. I run everything in docker, about the features of this later. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You install the client, enter a unique code for your network, then </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">confirm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it </font><font style="vertical-align: inherit;">in the Web interface on </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">my.zerotier.com</font></a><font style="vertical-align: inherit;"> , if necessary, set a static address from your personal private network (a la 10.20.30.0), and that‚Äôs it. All connected clients see each other.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only thing I had to deal with a bit was "how to connect to a remote server from a device in your home WiFi without starting the client." Well, my home server is already a client, even if it routes itself. It turned out that everything is simple. The home network 192.168.x.0 should be registered on my.zerotier.com in the Managed Routes section, specifying as my gateway, of course, this is my home server. Well, in the WiFi network, configure the route accordingly (on the WiFi router, statics 10.20.30.0 on the home server). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When connecting a Zerotier client, you can specify a different DNS server. Those. I connected the client, and the domain name resolves not to a public address, but to a private one, because DNS now points to the home server, where dnsmasq palm off for individual IP records from the Zerotier private network.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even Zerotier pleased with the effective choice of a route for connection. </font><font style="vertical-align: inherit;">If I activate a Zerotier client in home WiFi, ping to the home computer (its IP address issued by Zerotier) is the same couple of milliseconds as without a client (just via WiFi). </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">Connecting to the cloud is only at the first moment. </font><font style="vertical-align: inherit;">Further traffic exchange is carried out directly, not through the cloud. </font><font style="vertical-align: inherit;">If you install, for example, OpenVPN on VPS, the same traffic ran from the client to VPS, and then back to the same WiFi network to the home server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In principle, there is even a chip to put your moon servers. </font><font style="vertical-align: inherit;">Almost in a network cut off from the Internet, all this economy is to be deployed.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the result?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32 sends its data to the mqtt server deployed on the VPS. Over TLS, client certificate required. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A VPN through Zerotier is installed with the home server. Sonoff rfBridge communicates with the Tasmota firmware through this home server from mqtt to VPS. There is no way to set TLS with a client certificate, so the usual MQTT is configured for 1883. Anyway, after all, the home server will encrypt this traffic using Zerotier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, I connect to vis from the home network directly, and from the Internet by activating the Zerotier client. You can not turn it off at all, this also works. But only sometimes I need other VPN clients (for example, go to the "ILV-forbidden"). Two VPNs on one smartphone did not immediately become friends, but I did not understand.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is very simple. </font><font style="vertical-align: inherit;">But the worm swallowed the soul. </font><font style="vertical-align: inherit;">Although I do not have a nuclear reactor, but all of a sudden? </font><font style="vertical-align: inherit;">There was a case when they broke TeamViewer (a company, not specifically client software), and through them gained access to many accounts. </font><font style="vertical-align: inherit;">And in general, I wrote at the very beginning that I love everything mine. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So the next step, I switched from Zerotier to OpenVPN. </font><font style="vertical-align: inherit;">Everything is in my hands. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only ‚Äúalien‚Äù is the provider‚Äôs VPS. </font><font style="vertical-align: inherit;">Well, I‚Äôm specially launching everything in docker containers to be able to instantly move. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If I knew how much I would have to deal with OpenVPN, maybe I would not. </font><font style="vertical-align: inherit;">In fairness - the main problems were precisely because of the containers.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the next article I‚Äôll talk about OpenVPN and the configuration features in my conditions (containers, routing of other devices from the home network). There will be more configs, technical details and difficulties. But immediately the second part did not begin to write without this. It would not be clear why such perversions are necessary at all. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And just in case, a question for those who know: although I have a VPS and a small one (512MB RAM), it is used less than 1%. docker stats: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/fp/ka/8vfpkabqind44rkwfcycs7b7ais.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And I got the idea to launch it all just like a container on some Google Cloud Run, Amazon Fargate, or something similar. Deploying a server with all sorts of fail2ban through ansible is not a problem. Install Docker too. But why, if you need only a small fraction of its resources? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, according to my calculations, the same Fargate would cost me many times more.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maybe I didn‚Äôt understand something? </font><font style="vertical-align: inherit;">So it would be interesting to have a small container purely for forwarding the port home, and not a whole VPS. </font><font style="vertical-align: inherit;">There's no such thing?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504706/index.html">Auto Wi-Fi Power Management</a></li>
<li><a href="../en504708/index.html">Sectigo certificate issue after May 30, 2020 and solution method</a></li>
<li><a href="../en504710/index.html">FOSS News No. 18 - a review of free and open source news for May 25-31, 2020</a></li>
<li><a href="../en504712/index.html">Why am I not using SharedViewModel for fragments?</a></li>
<li><a href="../en504714/index.html">Go software measurement tools</a></li>
<li><a href="../en504718/index.html">The digest of fresh materials from the world of the front-end for the last week No. 417 (May 25 - 31, 2020)</a></li>
<li><a href="../en504720/index.html">The fastest template engine for PHP</a></li>
<li><a href="../en504722/index.html">HLS in MP4 using ffmpeg in a browser</a></li>
<li><a href="../en504724/index.html">Connectionism</a></li>
<li><a href="../en504726/index.html">4 agreements</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>