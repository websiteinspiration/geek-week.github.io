<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💎 👨🏿‍🌾 👡 Pembaruan Proses CI / CD: teamcity 😾 🏨 🎦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah artikel kedua dalam seri tentang memperbarui proses CI / CD. Sampai saat itu, persiapan sedang dilakukan untuk menyiapkan alat-alat baru, y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pembaruan Proses CI / CD: teamcity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496342/"><img src="https://habrastorage.org/webt/cu/y-/hg/cuy-hgxvywohqkg_tbyr2wn268c.png" alt="gambar" align="left" width="300"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah artikel kedua dalam seri tentang memperbarui proses CI / CD. Sampai saat itu, persiapan sedang dilakukan untuk menyiapkan alat-alat baru, yaitu: perencanaan, rapat umum harian, menyelesaikan perselisihan, secara umum, semua tanpa itu tidak mungkin untuk secara kompeten membangun proses kerja. Dan sekarang, semua masalah telah diselesaikan, kami yakin bahwa kami dapat melanjutkan pengembangan, dan kode kami tidak akan tenggelam ke dalam lubang hitam dengan awal musim panas.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biarkan saya mengingatkan Anda daftar isi daftar artikel, serta hasil singkat dari bagian sebelumnya. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 1: apa itu, mengapa tidak seperti, perencanaan, sedikit bash.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saya akan menyebut bagian ini hampir teknis. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 2: teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian 3: penyebaran gurita.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bagian 4: di belakang layar. Momen tidak menyenangkan, rencanakan masa depan, mungkin juga FAQ. Kemungkinan besar, itu juga bisa disebut dekat-teknis.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memberi pelanggan konsep bukti dari sistem pengiriman pembaruan yang baru, mengidentifikasi kekurangan dari sistem yang ada, memilih dasar untuk yang baru, membuat rencana transisi, dan mengubah repositori lincah kami menjadi git. Juga, pada bagian sebelumnya, kami menjelaskan fitur-fitur proyek yang akan mempengaruhi seluruh proses selanjutnya.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti disebutkan sebelumnya, solusi yang ada tidak memenuhi persyaratan modern. Awalnya, kemungkinan besar, satu build dikonfigurasikan dalam ccnet. Bangunan pertama yang memulai semuanya (seperti big bang, yeah). Kemudian, tampaknya, orang yang mengatur semuanya, menekan ctrl + c, ctrl + v, mengoreksi beberapa baris, dan menerima konfigurasi baru. Dan untuk semua waktu berikutnya, ini dilakukan dalam jumlah yang cukup sehingga kode sumber pada server build memakan lebih dari 60G. Dan ini hanya sumbernya! Dan ada log, buat artefak, file sementara, dan sebagainya. Hanya ini yang membuat saya berpikir. Melihat sistem yang lama, orang dapat melihat yang berikut: langkah build dilakukan untuk setiap modul. Bahkan, inti yang sama sudah dirakit. Dan rakitan ini disimpan untuk setiap modul (bersama dengan sumber) di server.Hasil pembangunan (90% identik) didorong ke repositori lokal (penyebaran git), dan juga, tentu saja, mengambil tempat mereka. Itu mungkin dan perlu untuk meninggalkan ini.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengaturan Umum&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada tahap ini, diasumsikan bahwa sudah ada tim yang terkonfigurasi dan gurita. </font><font style="vertical-align: inherit;">Pada tahap instalasi dan konfigurasi, kami tidak berhenti secara detail. </font><font style="vertical-align: inherit;">Untuk kenyamanan, kami menuliskan url dan api-token dari gurita di tim env, yang, omong-omong, untuk proyek root terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/vw/ir/savwiryxdsw8fpgrgvdzavejho0.png" alt="gambar"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserPassword</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah akses api ke pengguna teamcity (akan diperlukan nanti), </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.buildPath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env .sourcePath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - path default ke file build dan source, masing-masing, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoApiKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - token dan url dari gurita. </font><font style="vertical-align: inherit;">Mereka masih </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.teamcityUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menambahkan. </font><font style="vertical-align: inherit;">Baiklah, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tt.exe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- jalur ke utilitas transformasi teks. </font><font style="vertical-align: inherit;">Utilitas ini menghasilkan semua konfigurasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari plugin pihak ketiga, hanya integrasi Octopus Deploy yang diinstal.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar tidak membebani jumlah teks yang sudah sangat besar, hanya langkah-langkah di mana ada sesuatu yang layak diperhatikan akan diperiksa secara rinci. </font><font style="vertical-align: inherit;">Diasumsikan bahwa segala sesuatu yang lain dapat dimengerti berdasarkan data yang disajikan dan pengetahuan pembaca. </font><font style="vertical-align: inherit;">Bagaimanapun, jika Anda memiliki pertanyaan, saya akan dengan senang hati menjawabnya.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rincian proyek, versi, nama</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya adalah skema proyek (seperti gambar, karena ada masalah dengan menampilkan daftar multilevel): </font></font><br>
<img src="https://habrastorage.org/webt/-4/oq/gh/-4oqghadht5sr4rdpk7f3igz5do.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan membuat versi paket-paket sebagai berikut: major.minor.patch, di mana major sejauh ini 1, minor adalah build build dari konfigurasi Build, patch adalah counter build untuk konfigurasi Menyebarkan (tidak diperlukan untuk konfigurasi Bangun, karena itu selalu 0). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> versi lama dijelaskan di sini. Kami sedang mendesain ulang sehingga didasarkan pada tag git. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3v/kl/ov/3vklovvjqjnhwa8yg0b3lxtduns.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai contoh, di sini 1 adalah mayor, 95 minor, dan 1 adalah patch.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam proses baru untuk modul akan ada satu build yang kemudian akan digunakan untuk setiap modul. Artinya, kode sumber disimpan dalam satu salinan untuk setiap lingkungan, hasil build juga, karena itu umum untuk semua modul. Konfigurasi dan pustaka unik dikemas dalam satu paket pada tahap penyebaran. Ini secara efektif akan menggunakan ruang disk dan mengurangi waktu pengiriman setiap paket. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada tahap persiapan, ada pertemuan singkat terpisah tentang konvensi penamaan file konfigurasi. Dulu (itu hanya), tetapi tidak selalu sama. Selain itu, nama konfigurasi tidak selalu mengandung informasi yang cukup. Akibatnya, semua nama konfigurasi adalah sebagai berikut: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfigurationType.Environment.ModName.config</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di mana ConfigurationType dapat berupa AppSettings, Web, dll. </font><font style="vertical-align: inherit;">Lingkungan - pengembangan, pengujian, pementasan, produksi. </font><font style="vertical-align: inherit;">ModName adalah nama unik dari modul.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modul</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua proyek Modul bekerja dengan prinsip yang sama.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap lingkungan memiliki konfigurasi Build yang:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melakukan pengembalian nuget (Penginstal NuGet, pengembalian nuget)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menghasilkan konfigurasi (Baris Perintah, transformasi teks)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi buildit (Visual studio sln)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengambil file dari env.buildPath di zip dan mendorongnya ke gurita (Octopus deploy: push packages)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rilis pembuatan (tidak ada penyebaran) (Octopus deploy membuat rilis)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mereset versi tambalan (PowerShell)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada juga menggunakan konfigurasi yang bekerja berdasarkan pada templat dan lakukan hal berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengambil konfigurasi yang dihasilkan pada tahap build (langkah 2) (Octopus menyebarkan paket push)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyebarkan rilis inti (yang dibuat pada langkah 6 dari build) (Octopus deploy: deploy release)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rilis penyebaran individu (yang dibuat pada langkah 1 dari konfigurasi saat ini) (Octopus deploy: deploy rilis)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menampilkan daftar semua domain untuk modul ini dalam log (langkah untuk kenyamanan penguji dan pengembang). </font><font style="vertical-align: inherit;">(Powershell).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk setiap konfigurasi penggunaan, konfigurasi pembangunan ditambahkan ke dependensi. </font><font style="vertical-align: inherit;">Ini memungkinkan untuk meluncurkan build secara otomatis ketika digunakan jika tidak relevan, serta kemampuan untuk mereset versi patch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi deploy_all. </font><font style="vertical-align: inherit;">Sebenarnya, ini adalah rantai build yang menjelaskan bahwa Anda harus menjalankan build terlebih dahulu jika tidak relevan, dan kemudian menginstal semua mode secara bersamaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/ps/ck/rqpsckl2g8rrt9voltbt082itcu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita </font><font style="vertical-align: inherit;">lihat </font><font style="vertical-align: inherit;">beberapa langkah dengan lebih detail.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengaturan Build.General</font></font></h3><br>
<img src="https://habrastorage.org/webt/g_/5j/b9/g_5jb95h7ei6qexbvckqd8sxs7e.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari yang tidak biasa hanya membangun format angka. </font><font style="vertical-align: inherit;">Akan dijelaskan nanti.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.env</font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/nr/bx/a4nrbxt_8ol6yjuo64npqfxuota.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
menarik di sini adalah: </font><i><font style="vertical-align: inherit;">env.coreProjectName</font></i><font style="vertical-align: inherit;"> - ditetapkan untuk seluruh proyek. </font><font style="vertical-align: inherit;">Diperlukan untuk mengidentifikasi proyek di gurita. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.Environment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ditetapkan untuk proyek Modul. </font><font style="vertical-align: inherit;">Penting untuk memilih konfigurasi yang benar tergantung pada lingkungan. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoChannel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - saluran dalam gurita tempat paket itu jatuh. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sama</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seperti </font><i><font style="vertical-align: inherit;">env.Environment</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.serviceName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah nama solusinya. </font><font style="vertical-align: inherit;">Pada dasarnya, variabel ditambahkan untuk memudahkan visualisasi. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantRoleTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tag </font><i><font style="vertical-align: inherit;">penyewa</font></i><font style="vertical-align: inherit;"> di gurita. </font><font style="vertical-align: inherit;">Lebih detail di bagian gurita.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bangun.4 </font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/da/r1/a4dar1z6_kawzfttqbuvoivu_mm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan ke arsip dengan nama </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% env.serviceName%.% Build.number% .zip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file dari direktori dengan hasil build, tidak termasuk semua konfigurasi, dan lain-lain dari folder bin / asli. </font><font style="vertical-align: inherit;">Yang terakhir secara manual ditambahkan ke server web sekali dan tidak ada yang akan menyentuhnya lagi. </font><font style="vertical-align: inherit;">Jika perlu, mereka juga akan diperbarui secara manual (untuk ini direncanakan untuk menulis skrip terpisah, tetapi kami akan jujur). </font><font style="vertical-align: inherit;">Hal ini disebabkan oleh fakta bahwa perpustakaan-perpustakaan ini "dipegang" oleh kumpulan IIS, dan untuk penyebaran yang sukses itu harus dihentikan dan kemudian diluncurkan, yang membutuhkan waktu. </font><font style="vertical-align: inherit;">Dengan mengecualikan pustaka ini dari penyebaran, kita dapat melewati langkah menghentikan kumpulan, yang akan mengurangi waktu penyebaran, dan, dengan demikian, downtime.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bangun.5</font></font></h3><br>
<img src="https://habrastorage.org/webt/us/hu/zx/ushuzxwer8u3iwqnuuqpjbuoodo.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya pikir semuanya jelas di sini, kecuali mengapa bidang Lingkungan kosong. </font><font style="vertical-align: inherit;">Dalam paket apa yang didapat, gurita membuat keputusan berdasarkan tag pra-rilis (dikonfigurasi dalam saluran). </font><font style="vertical-align: inherit;">Tag ini terkandung dalam </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.number%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (stage-yang sama di layar dalam Build.General). </font><font style="vertical-align: inherit;">Jadi dalam hal ini ternyata lebih nyaman. </font><font style="vertical-align: inherit;">Juga patut memperhatikan kotak centang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Tampilkan proses penyebaran"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jika tidak diinstal, timsity menganggap build berhasil segera setelah gurita telah memulai (tetapi belum selesai!) Pekerjaan. </font><font style="vertical-align: inherit;">Yaitu, jika kotak centang tidak diinstal dan ada yang salah selama fase penerapan - tanpa melihat antarmuka gurita, kami tidak akan mengetahuinya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bangun.6</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada yang aneh, hanya skrip PowerShell dan informasi dari dokumentasi teamcity.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$pair</span> = <span class="hljs-string">"%env.apiUserName%:%env.apiUserPassword%"</span>
<span class="hljs-variable">$encodedCreds</span> = [<span class="hljs-type">System.Convert</span>]::ToBase64String([<span class="hljs-type">System.Text.Encoding</span>]::ASCII.GetBytes(<span class="hljs-variable">$pair</span>))
<span class="hljs-variable">$basicAuthValue</span> = <span class="hljs-string">"Basic <span class="hljs-variable">$encodedCreds</span>"</span>
<span class="hljs-variable">$depUri</span>=<span class="hljs-string">"%env.teamcityUrl%/app/rest/buildTypes?locator=snapshotDependency:(from:(build:(id:%teamcity.build.id%)),includeInitial:false)"</span>
<span class="hljs-comment"># Get all dependencies of main build</span>
<span class="hljs-variable">$result</span> = (<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$depUri</span>)
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$i</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$result</span>.buildTypes.buildType.Count) { <span class="hljs-variable">$buildId</span> += <span class="hljs-variable">$result</span>.buildTypes.buildType.id }
<span class="hljs-variable">$buildId</span> = <span class="hljs-variable">$buildId</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">'Module_DeployAll'</span> }
<span class="hljs-comment"># Reset all child build counters to 1. This build counters are patch versions in every build. (1.build.patch)</span>
<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buildId</span>.Count; <span class="hljs-variable">$i</span>++) {
  <span class="hljs-variable">$buildCounterUri</span> = <span class="hljs-string">"%env.teamcityUrl%/httpAuth/app/rest/buildTypes/"</span>+<span class="hljs-variable">$buildId</span>[<span class="hljs-variable">$i</span>]+<span class="hljs-string">"/settings/buildNumberCounter"</span>
  <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Method</span> Put <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'accept'</span>=<span class="hljs-string">'text/plain'</span>; <span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$buildCounterUri</span> <span class="hljs-literal">-ContentType</span> <span class="hljs-string">"text/plain"</span> <span class="hljs-literal">-Body</span> <span class="hljs-number">1</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita membutuhkan pengguna api di teamcity (env dibuat untuknya). </font><font style="vertical-align: inherit;">Kami masuk, mengambil semua konfigurasi yang bergantung pada konfigurasi Build, dan mereset counter build mereka ke 1. Artinya, untuk setiap versi patch, ini merupakan indikator berapa kali build yang sama digunakan untuk modul tertentu. </font><font style="vertical-align: inherit;">Jika tidak ada 1, itu berarti ada masalah dengan proses penempatan atau pengerjaan modul pada versi saat ini, dan membutuhkan perhatian.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyebarkan. Umum</font></font></h3><br>
<img src="https://habrastorage.org/webt/aa/lx/p4/aalxp4uzeiofjnfo0tfdx57z0cs.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Format versi: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.% dep.Module_Build.build.counter%.% Build.counter% -staging</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di mana </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah variabel sistem tim yang nilainya sesuai dengan konter build dari konfigurasi Build yang sesuai (harus ditambahkan ke dependensi). </font><font style="vertical-align: inherit;">Faktanya, di sini 1 adalah versi utama, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> minor, dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah patch. </font><font style="vertical-align: inherit;">pementasan adalah tag pra-rilis.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebarkan</font></font></h3><br>
<img src="https://habrastorage.org/webt/wl/lc/sv/wllcsv3zxji40gzu-p1ef-vlgu4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menambahkan modul baru, hanya konfigurasi untuk penyebarannya yang ditambahkan dan nilai variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName diindikasikan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Semua variabel lain diwarisi dari proyek induk. </font><font style="vertical-align: inherit;">Variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantModTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk gurita dibentuk dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyebarkan.2</font></font></h3><br>
<img src="https://habrastorage.org/webt/zt/yx/2q/ztyx2q7ffqxfpwxtsrrol6ojfqy.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menyebarkan paket inti.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nomor rilis terbaru - gunakan rilis terbaru yang tersedia untuk lingkungan ini. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tag penyewa - tag klien / organisasi. </font><font style="vertical-align: inherit;">Lebih detail di bagian gurita. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parameter cli tambahan. </font><font style="vertical-align: inherit;">Di sini kami menunjukkan saluran di mana paket kami akan jatuh, serta parameter tambahan. </font><font style="vertical-align: inherit;">Ini juga akan dibahas secara terpisah di bagian gurita.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyebarkan.3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti Deploy.2, hanya paket modul individual yang digunakan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyebarkan.4</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah ini juga akan dijelaskan secara rinci di bawah ini, karena menerima data dari gurita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi untuk situs web Perusahaan dan modul Khusus dibangun di atas prinsip yang sama, dan poin utama di dalamnya adalah sama, jadi saya tidak melihat titik untuk menggambarkannya dalam detail yang sama. Mereka adalah satu, mereka tidak harus digunakan berkali-kali, dan sebenarnya ada nuget restore, transformasi teks, msbuild, push gurita, gurita membuat rilis + penyebaran.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelajari lebih lanjut tentang konfigurasi unik. </font><font style="vertical-align: inherit;">Untuk beberapa mod, mungkin tidak ada lingkungan (misalnya, pementasan), mereka harus dikerahkan ke server lain, atau Anda harus secara manual mengatur pengidentifikasi klien (mengambil konfigurasi dasar dan mengubah beberapa bidang di dalamnya menggunakan PowerShell). </font><font style="vertical-align: inherit;">Artinya, mereka bekerja dengan prinsip yang sama dengan modul utama. </font><font style="vertical-align: inherit;">Keunikan mereka terletak pada kenyataan bahwa langkah-langkah ditambahkan / diubah untuk mereka, atau server penempatan diubah dan mereka tidak sesuai dengan templat, sehingga dibutuhkan sedikit lebih lama untuk membuatnya. </font><font style="vertical-align: inherit;">Untungnya, ada beberapa dari mereka.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamcity: Ringkasan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementasi teamcity memungkinkan pendekatan yang lebih optimal untuk proses perakitan aplikasi. Sekarang ini membutuhkan waktu jauh lebih sedikit: alih-alih membangun kode yang sama setiap kali, kita membangunnya sekali. Kami juga memanfaatkan ruang disk, lalu lintas jaringan, dan waktu komputasi dengan lebih baik. Sebelumnya, jumlah paket untuk penyebaran (repositori dengan artefak) sama dengan jumlah modul. Setiap paket memiliki berat sekitar 100 juta dalam bentuk terkompresi. Sekarang kita memiliki jumlah paket satu lebih banyak dari jumlah modul, dengan satu paket dengan berat sekitar 100 juta yang sama, dan sisanya sekitar 500 ribu. Ditambah antarmuka yang lebih ramah pengguna, log yang mudah digunakan, dan yang paling penting - mengurangi waktu untuk memelihara sistem build dan menambahkan konfigurasi. Sekarang menambahkan modul baru membutuhkan waktu 15 menit hingga setengah jam.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara terpisah, harus dikatakan tentang template, karena itu adalah standarisasi yang memungkinkan kita menghemat waktu untuk membuat konfigurasi baru dan pemeliharaan lebih lanjut. Semua konfigurasi untuk berinteraksi dengan gurita (penyebaran) dibangun berdasarkan satu templat. Pertama, memungkinkan untuk menyatukan, dan karenanya menyederhanakan proses. Kedua, seperti yang telah disebutkan, menghemat waktu untuk menambahkan konfigurasi baru: kami telah menyambungkan templat, mengubah satu variabel, dan hanya itu. Dan yang paling penting, template menyederhanakan perawatan. Semua perubahan yang dibuat pada templat diwarisi oleh konfigurasi berdasarkan itu. Jadi, jika kita perlu menambahkan beberapa langkah ke semua konfigurasi sekaligus, kita tidak perlu mengklik semuanya, cukup tambahkan langkah ini ke templat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, proses pengaturan teamcity berjalan seiring dengan pengaturan gurita. </font><font style="vertical-align: inherit;">Sangat tidak mungkin untuk dijelaskan secara paralel dalam teks, karena ada kemungkinan besar kebingungan. </font><font style="vertical-align: inherit;">Oleh karena itu, uraian telah dibagikan, dan pada bagian ini hanya langkah-langkah untuk menyediakan CI yang dijelaskan. </font><font style="vertical-align: inherit;">Proses pengaturan gurita akan dijelaskan sebagai berikut.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id496332/index.html">Antidron: refleksi serangan UAV dan quadrocopter</a></li>
<li><a href="../id496334/index.html">Dell U4919DW Review: Monitor Layar Lengkung 49-inci Ultra-Lebar</a></li>
<li><a href="../id496336/index.html">Untuk apa smart meter?</a></li>
<li><a href="../id496338/index.html">Krisis dan hanya itu</a></li>
<li><a href="../id496340/index.html">Kami melatih jaringan kompetitif-generatif untuk menggambar di Azure ML</a></li>
<li><a href="../id496344/index.html">Apakah karantina online hackathon saat yang tepat?</a></li>
<li><a href="../id496346/index.html">Kami menambahkan cek hash pemburu rootkit ke dalam skrip harian</a></li>
<li><a href="../id496348/index.html">Studi Kasus API Penyimpanan Web</a></li>
<li><a href="../id496350/index.html">Kamu tidak boleh lewat! - Printer 3D menjawab coronavirus</a></li>
<li><a href="../id496354/index.html">Pemrograman komputer ternary: bermain dengan emulator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>