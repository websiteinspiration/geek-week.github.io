<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíµ üõ∂ üí™üèø Conf√©rence DEFCON 27. Buttplug: True Penetration Testing. Partie 1 üëêüèº ü§∂üèæ üöß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les analystes estiment qu'il existe actuellement environ 10 milliards d'appareils du monde de l'Internet des objets (IoT). Parfois, ces appareils gagn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Conf√©rence DEFCON 27. Buttplug: True Penetration Testing. Partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495378/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les analystes estiment qu'il existe actuellement environ 10 milliards d'appareils du monde de l'Internet des objets (IoT). Parfois, ces appareils gagnent leur place sur le march√©, grimpant litt√©ralement les culs humains. Il s'est av√©r√© que les puces radio bon march√© et de faible puissance ne sont pas seulement id√©ales pour la domotique - elles changent √©galement la fa√ßon dont les gens interagissent avec les jouets sexuels. Dans ce rapport, nous allons plonger dans le monde de la t√©l√©vision dildonique, la technologie du sexe √† distance dans laquelle les sensations tactiles, thermiques et autres sont transmises entre partenaires via une ligne de communication bidirectionnelle. L'orateur vous dira que la s√©curit√© des jouets sexuels √©lectroniques √©lectroniques Buttplug peut √™tre oppos√©e √† un attaquant qui trouve et exploite des vuln√©rabilit√©s √† chaque niveau de la pile. En fin de compte, cela permet aux sextoys eux-m√™mes d'√™tre compromis,et les appareils auxquels ils se connectent.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un pirate avec le surnom de smea, ou Smealum, a commenc√© sa carri√®re en tant que d√©veloppeur de jeux vid√©o pour des consoles de jeux telles que Nintendo DS, en essayant simultan√©ment de les casser. √Ä un moment donn√©, les consoles ont acquis de s√©rieux syst√®mes de s√©curit√© et Smea est pass√© de logiciels locaux √† des techniques de d√©veloppement pour les casser. Smea est connu pour son ¬´travail¬ª sur Nintendo 3DS et Wii U, bien qu'il ait √©galement contribu√© au d√©veloppement d'exploits pour les navigateurs Web et les piles de virtualisation les plus populaires. Probablement, maintenant, il s'est int√©ress√© √† percer des plugs anaux ¬´intelligents¬ª.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour √† tous, je suis Smia, et aujourd'hui nous allons parler de la fa√ßon de casser un plug de d√©marrage. C'est un objet que je tiens dans ma main, je ne sais pas si vous l'avez d√©j√† vu, personnellement je ne le sais pas. Mais au cours des 2 derni√®res ann√©es, j'ai rencontr√© de nombreux repr√©sentants int√©ressants de l'industrie de l'IoT, alors maintenant le tour de cette chose est venu. Vous vous demandez peut-√™tre comment vous pouvez casser un bootplag, car ce n'est qu'un morceau de silicone qui doit √™tre ins√©r√© quelque part, et vous conviendrez qu'il n'y a pas beaucoup d'endroits pour cela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, cela ne n√©cessite aucune √©lectronique. Mais au cours des derni√®res ann√©es, voire des d√©cennies, une nouvelle industrie d'appareils √©lectroniques appel√©e teledildonika est apparue. L'origine de ce terme est montr√©e sur la diapositive: le mot grec "tele" signifie "de loin", et l'anglais "gode" ne signifie rien de plus qu'un gode. J'ai essay√© de trouver l'origine du mot gode, mais personne ne sait d'o√π il vient. Mais c'est compr√©hensible, non? L'id√©e est que vous voulez faire des jouets sexuels qui peuvent √™tre contr√¥l√©s √† distance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe plusieurs sc√©narios pour cela. Je veux juste vous expliquer comment cela fonctionne, car tout le monde n'est pas familier avec de tels appareils. Ainsi, vous prenez le bootplag, l'ins√©rez o√π cela est n√©cessaire et pouvez le contr√¥ler √† distance o√π vous voulez - depuis votre t√©l√©phone, ordinateur portable, etc. Il s'agit du premier sc√©nario appel√© "jeu solo". Le deuxi√®me sc√©nario que j'ai appel√© "multijoueur local" - c'est lorsque vous transf√©rez le contr√¥le de cette chose √† quelqu'un d'autre. C'est une chose assez r√©elle qui est souvent annonc√©e - vous pouvez, par exemple, aller dans un bar avec elle et personne ne saura √† quel point c'est amusant. Mais techniquement, cela cr√©e un nouveau vecteur d'attaque, car vous donnez le contr√¥le de l'appareil √† un √©tranger, et ici le mod√®le de menace change vraiment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisi√®me sc√©nario, ¬´multijoueur √† distance¬ª, est similaire au deuxi√®me, seulement maintenant vous autorisez une autre personne √† contr√¥ler l'appareil via Internet. N'oubliez pas que cette personne peut √™tre un √©tranger. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/nb/hr/mnnbhrbihysuf1iengokudmgudm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour beaucoup, avoir des relations sexuelles √† distance semble assez cool et amusant, et je ne vais pas en plaisanter. Certains utilisent la t√©l√©dildonie pour gagner leur vie, et le sc√©nario 3B est appel√© ¬´multijoueur payant √† distance¬ª. Par cons√©quent, le fait que j'essaie de casser le plug anal n'est pas seulement un divertissement - cela donne une certaine justification √† mes √©tudes de p√©n√©tration.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gn/g0/m4/gng0m40-kjudzygpgp6fkeczt_i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de gens, je ne sais pas comment les appeler - gar√ßons, filles - offrent un divertissement sexuel dynamique sur Internet, permettant √† d'autres personnes de contr√¥ler leurs jouets sexuels pour de l'argent. L'entreprise qui produit ces m√©gots a un brevet pour le concept de d√©duction des b√©n√©fices lors de l'utilisation de ses produits pour des jeux sexuels sur Internet. Dans ce sc√©nario, pour des d√©ductions de 5 $, vous avez le droit de placer un lien, par exemple, sur Twitter, pour donner √† quelqu'un la possibilit√© de g√©rer votre bootplag pendant une dur√©e limit√©e. Puisque les gens comptent sur ces jouets comme outils pour gagner de l'argent, √† mon avis, il est tr√®s important de consid√©rer leur s√©curit√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons les sc√©narios qui int√©ressent les attaquants. Le premier est un piratage local, lorsqu'un attaquant qui se trouve √† port√©e de l'appareil intercepte le contr√¥le via une communication sans fil. Il y a eu beaucoup de recherches sur cette m√©thode de piratage, donc nous ne serons pas coinc√©s avec notre attention dessus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/wb/8g/gywb8gehwmsgsmf_5pra4m_lmr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Techniquement, une telle intervention peut √™tre consid√©r√©e comme un abus sexuel, donc qu'elle soit l√©gale ou non, n'essayez pas de le faire. Selon le sc√©nario suivant, un attaquant fait la m√™me chose, mais √† distance, via Internet. Comme je l'ai d√©j√† dit, si vous gagnez comme √ßa, vous pourriez tr√®s bien fournir √† un √©tranger - un attaquant un acc√®s √† distance √† votre sextoy.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela signifie qu'un pirate peut compromettre vos jouets sexuels ¬´intelligents¬ª ou appareils connexes, bref, vous faire du mal, et c'est tout √† fait l√©gal, puisque vous-m√™me vous y avez donn√© acc√®s. Pour un pirate, c'est une option plus int√©ressante, nous allons donc y rester un peu plus longtemps. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/cb/hz/8vcbhzhmae_kgh9ka8v37s2jg_8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisi√®me sc√©nario est le contraire - l'attaquant lui-m√™me utilise le plug-in de d√©marrage pour prendre le contr√¥le d'un ordinateur ou d'un t√©l√©phone et pirater des p√©riph√©riques situ√©s du c√¥t√© de l'utilisateur qui participe √† distance √† des jeux avec le plug-in. Les gens ne comprennent pas que c'est un vrai risque, mais vous imaginez probablement √† quel point les plug anal peuvent √™tre insidieux (rires dans le hall). Nous explorons √©galement ce sc√©nario.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vn/tv/sr/vntvsrxrvefsyh_y7k48hqd7fiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que vous avez une id√©e du monde de la t√©l√©dildonie, voyons √† quoi il ressemble dans la pratique. Sur la diapositive, vous voyez un mod√®le de gode appel√© Lovense Hush, et plus tard je vous montrerai une d√©mo avec cette chose en ondes. Il s'agit du premier mod√®le de gode-t√©l√©dildonique au monde, un plug anal qui peut √™tre contr√¥l√© depuis votre t√©l√©phone ou votre ordinateur. Il existe des applications pour IoS et Android pour ce boot-plag, vous pouvez le contr√¥ler √† partir d'un ordinateur ex√©cutant Mac OS et Windows. Les applications mobiles prennent en charge des fonctionnalit√©s sociales telles que le chat, le partage de texte, d'images, de vid√©os et le contr√¥le des jouets avec des amis ou des inconnus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/ry/zq/b-ryzqagf71doiiyxeoj_hzvzm8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour Windows, vous devez utiliser une cl√© USB sp√©ciale, que je montrerai plus tard, car maintenant ce plug-in de d√©marrage est connect√© √† mon ordinateur. La cl√© de lecteur flash √©lectronique a √©t√© d√©velopp√©e par la m√™me soci√©t√©, ¬´Lovens¬ª, un fabricant d'un plug-in de d√©marrage qui a cr√©√© son propre √©cosyst√®me de godes ¬´intelligents¬ª et prend environ 5 $ de commission pour une session sur Internet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bv/lg/dl/bvlgdlcsp4qckbaej8gps_szkua.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diapositive suivante montre ma vision d'une attaque sur une prise de d√©marrage √† l'aide d'une application PC. Il existe une connexion BLE (BlueTooth Low Energy) entre la prise de d√©marrage et la cl√© USB, la cl√© est connect√©e √† l'ordinateur de l'utilisateur, qui √† son tour est connect√© √† Internet. Le sc√©nario n ¬∞ 1 est utilis√© par un attaquant sur la section de cl√© USB de connexion de d√©marrage, c'est-√†-dire que la connexion BLE est attaqu√©e. En fait, il n'y a aucune protection, de sorte que tout √©tranger peut prendre le contr√¥le de ce jouet. L'ann√©e derni√®re, il y a eu une discussion s√©rieuse sur un outil appel√© BTLE Jack, qui vous permet d'attaquer avec succ√®s une telle connexion.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l_/ma/24/l_ma24foabt77cti9__dmq7ufam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sc√©nario n ¬∞ 2 consiste √† attaquer une section de la connexion Internet de l'ordinateur d'un utilisateur. Le troisi√®me sc√©nario est une tentative de piratage dans l'un des trois sites: BLE, USB, Internet. Il est probable qu'il existe un projet de plug-in ouvert ... vous pouvez rire, c'√©tait une blague. Alors, par o√π commencer nos ¬´vrais tests de p√©n√©tration¬ª?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cj/ov/21/cjov21ngohs6fh0gqaccbp2mdn0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai trouv√© aucun code ni binaire pour le gode et le dongle lui-m√™me, mais il existe des fichiers d'application binaires pour les appareils mobiles et un ordinateur disponibles en t√©l√©chargement sur Internet. J'ai install√© ces fichiers sur mon ordinateur et commenc√© √† travailler dessus. Sur la diapositive suivante, vous voyez l'interface de l'application pour g√©rer le plug-in de d√©marrage. Au centre de l'√©cran, il y a un curseur pour r√©gler la vibration du jouet, et √† gauche se trouve le panneau de commande avec des boutons - acc√®s au compte, mode de contr√¥le sur le r√©seau local, mode de t√©l√©commande via Internet. Afin de comprendre la structure de l'application, il vous suffit de lire un peu de code JavaScript d√©routant.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/tc/l_/gytcl_o4cfm0iolamia3r6cfryo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'aime pas JavaScript, mais ce qui est bien c'est la pr√©sence d'un tas de noms de variables et de noms de champs d'objets, et tout cela est parfaitement r√©tro-con√ßu. D√©posez simplement le code dans Beautifier et d√©couvrez comment cela fonctionne. Une fois que vous faites cela, vous pouvez commencer √† comprendre le fonctionnement de la cl√© √©lectronique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fp/km/1s/fpkm1shgzrwislgaj09vm2ileg8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©couvrant qu'il ne s'agit que d'un port s√©rie pour la connexion via USB, j'ai commenc√© √† flairer le trafic entre la cl√© et l'application. Faites attention aux lignes √† droite de la diapositive - tout d'abord, j'ai remarqu√© que les messages entre le dongle et l'application √©taient au format texte JSON. Pour le code JavaScript, cela est familier, mais pour une cl√© USB, qui est un microcontr√¥leur 32 bits, l'int√©gration de l'analyseur JSON semble √©trange ... Pour nous, c'est tr√®s pratique, car les analyseurs JSON contiennent g√©n√©ralement des bogues de firmware qui peuvent √™tre utilis√©s.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/5r/rk/hj5rrk2imjq5byefebbencwwmsg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, trouver des bogues sans le code cl√© lui-m√™me est une t√¢che fastidieuse, mais depuis que j'ai le code d'application, j'ai commenc√© √† chercher un m√©canisme pour mettre √† jour le firmware de la cl√© USB et j'ai rapidement trouv√© ce que je voulais - l'URL du n≈ìud de mise √† jour. Il s'est av√©r√© que le firmware n'√©tait pas crypt√© ou sign√© de quelque fa√ßon que ce soit, alors je viens de le t√©l√©charger et j'ai obtenu un binaire pour analyse. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/q7/vs/xcq7vsjbakxsctt8th2gd_fwhni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, j'ai commenc√© l'ing√©nierie inverse et attir√© l'attention sur 2 choses. Tout d'abord, il existe 2 gestionnaires de commandes pour le port USB s√©rie. Le premier utilise des commandes simples telles que la r√©initialisation ou le type d'appareil, le second utilise des commandes telles que DFU pour mettre √† jour le firmware de l'appareil, afin que nous ayons la possibilit√© d'envoyer ces commandes et de mettre √† jour le firmware.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/ol/b-/oyolb-kfxvjs8uq4ccxmvyrowdw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir examin√© l'analyseur JSON, qui nous int√©resse le plus, j'ai d√©couvert le bogue attendu - la fonction parseJsonString. Il a juste besoin d'allouer une copie de la cha√Æne d'origine dans un nouveau tampon et de travailler avec des choses comme les s√©quences d'√©chappement. Lors du calcul de la longueur du nouveau tampon, il ne correspond pas √† la longueur r√©elle utilis√©e. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/n7/vw/pon7vwgs51_0b0xicll5adjy0km.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette fonction fonctionne comme ceci: elle prend en charge une s√©quence d'√©chappement de 5 param√®tres U au lieu, comme pr√©vu, de les √©galer √† 0. Gr√¢ce √† cela, nous pouvons √©viter une cha√Æne termin√©e par un caract√®re nul et rendre la longueur de la premi√®re cha√Æne calcul√©e incorrecte.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/am/4y/lgam4y0v4ijpkvue8j2snjfr7xm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette petite animation montre ce qui se passe ici. La barre oblique inverse avant U signifie que 6 caract√®res doivent √™tre supprim√©s. Ensuite, la fonction saute √† travers le terminateur nul, ce qui est un probl√®me. Ensuite, le processus continue, tous les caract√®res sont copi√©s et tombent dans le tampon avec une longueur de seulement 6 octets. Ici, le deuxi√®me probl√®me appara√Æt - le risque de d√©bordements de tampon. C'est g√©nial, mais nous ne savons toujours pas comment fonctionne le mat√©riel du dongle. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/ea/hl/wjeahlydyx11z5kl0e_entwcoiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous savons avec certitude qu'elle n'a pas de randomisation de l'espace d'adressage ASLR, elle n'a pas de pile de cookies, mais il est possible que la cl√© ait une protection telle que la pr√©vention de l'ex√©cution des donn√©es DEP ou la protection XN qui emp√™che l'ex√©cution de code en m√©moire, √† l'exception de la r√©gion .text.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La cl√© est √©quip√©e d'une puce SoC NRF51822 avec un processeur Cortex M0, sans protection DEP, qui est tr√®s populaire pour les appareils BLE et √©quip√©e d'un tas de contacts de d√©bogage. Par cons√©quent, il est assez simple de se connecter √† cette cl√© en y soudant quelques √©l√©ments et en effectuant le d√©bogage via l'interface de d√©bogage et de clignotement des puces SWD si elle n'est pas d√©sactiv√©e dans les param√®tres d'usine. En se connectant via SWD, nous pouvons vider le contenu du tas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re qu'il n'est utilis√© que pour l'analyseur JSON, ce qui n'est pas tr√®s cool, mais le tas contient des m√©tadonn√©es. Alors, que peut-on g√¢cher ici? Bien s√ªr, tas de m√©tadonn√©es! De cette fa√ßon, nous cr√©ons un exploit pour l'analyseur JSON.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qw/9o/zh/qw9ozhk_k6ixcm_iupcoyvun3xa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tas n'est qu'une liste gratuite. Si vous regardez ce code, vous pouvez voir que chaque distribution a sa propre longueur et son propre pointeur. Si vous utilisez un d√©passement de tampon, vous pouvez g√¢cher la longueur et la position du pointeur suivant, ce qui vous permet de contr√¥ler l'emplacement de la prochaine distribution. En y copiant une nouvelle ligne, vous pouvez facilement organiser des donn√©es arbitraires dans un endroit arbitraire. Tout cela peut √™tre fait lorsque le d√©bogueur est connect√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tb/hk/y7/tbhky7ub8kj5cbgpjhmrl-frong.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le c√¥t√© droit de la diapositive, vous voyez une pile qui est r√©initialis√©e et compl√®tement remplac√©e avec seulement 8 caract√®res. Cela nous donne l'ex√©cution du code de la cl√© USB, ce qui est plut√¥t cool.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je me suis souvenu que, malheureusement, ce dongle dispose d'un mode de mise √† jour d'urgence du firmware DFU. Je m'attendais √† ce que, par analogie avec le piratage des consoles de jeux, ce mode serve √† authentifier la mise √† jour de toutes les mani√®res possibles. Il s'av√®re que la DFU utilise ici le calcul de somme de contr√¥le CRC16 classique, qui, si vous comprenez la cryptographie, n'est pas une authentification d'aucune sorte. Je ne pense pas qu'ils voulaient vraiment utiliser l'authentification dans ce cas, tr√®s probablement ils ont juste d√©cid√© que peu de gens seraient int√©ress√©s √† ex√©cuter le code de cl√© USB pour la prise de d√©marrage. Cependant, cela m'a int√©ress√©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/lg/py/iflgpyq2h1z6kusfwcpqf-x0vxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le moment, j'avais 2 fa√ßons diff√©rentes d'ex√©cuter du code sur cet appareil, mais se disputer avec l'analyseur JSON, sur lequel j'ai pass√© beaucoup de temps, s'est av√©r√© peu efficace en raison de la pr√©sence du mode DFU. Plus tard, nous consid√©rerons cette m√©thode avec la vuln√©rabilit√© existante de l'analyseur. Jusqu'√† pr√©sent, je me suis davantage int√©ress√© √† savoir s'il √©tait possible de simplement modifier le fichier main.bin, recalculer son CRC16 et l'int√©grer √† l'aide du programme inclus dans l'application Lovense Remote. Il s'est av√©r√© que c'√©tait possible. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, nous avons obtenu une cl√© USB qui a √©t√© compromise √† l'aide d'une application PC, et c'√©tait certainement la partie la plus facile √† casser. Ayant pris le contr√¥le de la cl√©, j'ai commenc√© √† chercher un moyen d'ex√©cuter du code sur le plug boot lui-m√™me.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vi/k2/vm/vik2vmib-ohaqm0hlaaldyaqmgc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, je me suis tourn√© vers le "mat√©riel" de notre sextoy - probablement il y avait aussi un d√©bogueur dessus, et √ßa valait le coup d'oeil. Apr√®s avoir examin√© la prise de d√©marrage, j'ai trouv√© une puce plus s√©rieuse, avec une grande quantit√© de m√©moire flash et de RAM et un processeur Cortex M4 plus puissant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai facilement compris ce qui manquait et ce qui se trouvait √† bord du bootplag. Il n'y a pas de DEP, comme sur un dongle, en haut il y a des fils menant √† la batterie, ensuite le port de charge, les contacts du moteur du vibreur, plusieurs plots de contact pour le d√©bogage et une antenne Bluetooth. Ainsi, gr√¢ce √† la pr√©sence de SWD, l'appareil peut facilement √™tre reflasher.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r8/ln/rd/r8lnrdx8uis5lkt3f-gtdkpssr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous voyez ce qui s'est pass√© - je n'ai pas d'actionnaire, mais dans le sac il y aura toujours un tas de plugs pour les exp√©riences. Ensuite, j'ai commenc√© l'ing√©nierie inverse et le d√©bogage du bootplag, en r√©initialisant le firmware d'origine. Il n'y avait pas d'analyseurs JSON, seulement des commandes simples, mais en grand nombre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pensais que si le mode de mise √† jour du firmware du dongle √©tait si dangereux, il est possible qu'il existe des vuln√©rabilit√©s. Il s'est av√©r√© comme √ßa. √Ä la suite de la recherche DFU, j'ai trouv√© 2 choses: le gestionnaire de commandes DFU normal et la ligne DfuTarg dans le secteur de d√©marrage. Ce DfuTarg est utilis√© de la m√™me mani√®re que l'identifiant du plugin de d√©marrage LVS-Z00, c'est-√†-dire qu'il est similaire au chargeur de d√©marrage DFU pour BLE. Par cons√©quent, en mode DFU, le journal de d√©marrage est reconnu comme un p√©riph√©rique sous le nom DfuTarg, et cet identifiant unique peut √™tre utilis√© pour rechercher le p√©riph√©rique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, si vous lui envoyez exactement la m√™me commande DFU que nous avons envoy√©e √† la cl√©, le bootplag passera en mode de mise √† jour du firmware de l'appareil. Pour le flashage, vous pouvez utiliser les outils propri√©taires du fabricant du microcircuit Nordic Semiconductor - nRF Toolbox.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/iy/pr/xbiyprlhoukirnf_su9htx71rqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'aide d'un renifleur mat√©riel, vous pouvez visualiser les paquets BLE dans Wireshark. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/ea/9o/xcea9of9tdquhsfcjnjglzcsj78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai envoy√© un court message "bonjour de la fiche", et cela signifie que vous pouvez ex√©cuter le code sur le batplag sans aucun piratage, et ce n'est pas une vuln√©rabilit√©, mais juste une sorte de conception de d√©veloppeur qui vous permet de reflasher l'appareil. Peut-√™tre que la communaut√© open source aimerait cette solution. L'essentiel est que toute personne qui peut se connecter √† votre plug-in de d√©marrage peut ex√©cuter son propre code dessus, et c'est d√©j√† une chose assez dangereuse. Dans ce cas, le pirate doit se trouver dans la zone de la connexion locale, c'est-√†-dire √™tre suffisamment proche du jouet sexuel pour en prendre le contr√¥le via un dongle compromis et un canal BLE. Dans le m√™me temps, vous pouvez utiliser le dongle lui-m√™me ou tout autre appareil BLE.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d_/uo/uy/d_uouyokp1p8mdsyx2x0yehkl14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La question est, que peut-on vraiment faire avec le plug-in de d√©marrage, avoir la possibilit√© d'ex√©cuter son propre code dessus? J'ai quelques id√©es. La premi√®re - prendre le contr√¥le de cette chose, vous pouvez cr√©er un bootplag de ransomware. Vous pouvez modifier son firmware pour que l'utilisateur ne puisse pas activer le mode DFU jusqu'√† ce que vous lui fournissiez une certaine cl√©, ou vous d√©sactivez simplement la fonction de vibration et demandez 50 dollars pour d√©verrouiller cet appareil utile.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cl/jb/ob/cljbobzlggrarkc30am8im-fe14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour beaucoup, cela servira comme une sorte de vaccin contre l'utilisation de ces jouets. La deuxi√®me id√©e est de transformer le bootplag en arme. Il a une batterie assez puissante qui alimente le moteur du vibrateur, on peut dire que 80% du contenu du plug boot est une batterie. Vous vous souvenez probablement de ce qui s'est pass√© avec les smartphones Samsung Galaxy Note - ils viennent d'exploser (rires), il est donc probable que cela puisse se produire avec des plugs. Je ne sais pas quelle est la probabilit√© de son explosion, mais si vous avez beaucoup de jouets sexuels avec un moteur, vous devriez y penser. L'√©quipe de d√©veloppement affirme que ces choses sont absolument s√ªres, malgr√© la pr√©sence de nombreuses pi√®ces mobiles. Mais si tel est le cas, la fonction de s√©curit√© de l'appareil est cod√©e par logiciel, pas par mat√©riel.Dans ce cas, l'ex√©cution de code malveillant peut avoir des cons√©quences d√©sastreuses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les jouets sexuels √©quip√©s d'une pompe √† air sont √©galement dangereux. Ils ont √©galement un moteur assez puissant avec une batterie, vous devez donc √©galement y faire attention. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, la derni√®re id√©e est un plug-in de combat hostile. Hostile, non pas dans le sens o√π il est capable de vous faire sauter le cul, mais dans le fait qu'il peut servir de moyen pour pirater le reste de vos appareils. Par cons√©quent, nous consid√©rerons la prise de bataille du point de vue de son hostilit√©, qui est assur√©e par l'ex√©cution de code malveillant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons de savoir s'il est possible d'ex√©cuter du code dans l'application pour le plug-in de d√©marrage en consid√©rant comment il traite les messages entrants.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/ov/1v/g_ov1vzowj7o8hifa6xhfoo5gmq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä gauche, vous voyez un rappel en JavaScript, et √† droite comment il interagit avec l'application via le port s√©rie. Le rappel est plac√© dans une cha√Æne, puis trait√© par un tas de fonctions diff√©rentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re fonction est de trouver la cl√©, elle traite les messages d'initialisation provenant de la cl√©. La deuxi√®me fonction est activ√©e (¬´Donn√©es¬ª), une fonction de traitement qui accepte un paquet JSON entrant, dont la longueur, en passant, ne peut pas d√©passer 32 caract√®res. Ensuite, l'analyse et tout le reste est fait. En fait, il n'y a pas de traitement s√©rieux ici - juste une demande est faite pour l'√©tat de l'appareil, v√©rifiant la charge de la batterie et les frais g√©n√©raux similaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La derni√®re fonction est beaucoup plus int√©ressante - je l'appelle le journal de d√©bogage, bien qu'il n'ait en fait aucun nom dans le vrai code. Cette fonction enregistre tout ce qui entre dans le p√©riph√©rique via le port s√©rie et r√©initialise ces lignes sur la console qui, si n√©cessaire, affiche un message d'erreur. De plus, cette fonction cr√©e un nouvel √©l√©ment DOM en tant qu'√©l√©ment HTML et jette tout ce contenu re√ßu via le port s√©rie dans ce HTML. Je ne suis pas d√©veloppeur Web, mais je pense que c'est une grave vuln√©rabilit√© XSS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, si vous contr√¥lez le dongle, vous pouvez envoyer n'importe quoi via le port s√©rie, for√ßant l'application √† interpr√©ter cela comme du HTML. </font><font style="vertical-align: inherit;">C'est le probl√®me, car HTML a la capacit√© de cr√©er un nouveau code JavaScript dans une application install√©e sur votre ordinateur, c'est-√†-dire qu'il peut le compromettre. </font><font style="vertical-align: inherit;">La question est de savoir quels logiciels malveillants peuvent √™tre invent√©s, sachant que seuls 32 caract√®res sont autoris√©s √† la fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22:00 min </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conf√©rence DEFCON 27. Plug anal: v√©ritable test de p√©n√©tration. </font><font style="vertical-align: inherit;">Partie 2</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√© pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495366/index.html">16 types de programmeurs ou d√©veloppeurs ne sont pas les m√™mes robots</a></li>
<li><a href="../fr495368/index.html">Nous nous auto-enregistrons pour les auto-chiens qui se prom√®nent dans des conditions d'auto-isolement</a></li>
<li><a href="../fr495370/index.html">Le public est mauvais</a></li>
<li><a href="../fr495374/index.html">Plafonnier d√©coratif General Lumino 02</a></li>
<li><a href="../fr495376/index.html">Ennui de quarantaine. Comment d√©penser le plus d'argent dans Azure en un clic</a></li>
<li><a href="../fr495380/index.html">Grand pare-feu √©gyptien</a></li>
<li><a href="../fr495384/index.html">Mon exp√©rience de stage chez Microsoft Redmond et l'obtention d'une offre</a></li>
<li><a href="../fr495388/index.html">√âmission de t√©l√©vision des ann√©es 1970 qui est devenue un anc√™tre de l'eSport</a></li>
<li><a href="../fr495390/index.html">STM32CubeMonitor m√©rite un essai</a></li>
<li><a href="../fr495392/index.html">Comment rechercher des bugs sur le front-end: 4 √©tapes principales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>