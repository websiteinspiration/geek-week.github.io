<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥üèª üçü üïµüèæ Blitz.Engine: Asset System üì≤ ü¶ê üéôÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avant de comprendre comment fonctionne le syst√®me d'actifs du moteur Blitz.Engine , nous devons d√©cider quel actif est et ce que nous entendons exacte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Blitz.Engine: Asset System</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498300/"><img src="https://habrastorage.org/webt/yk/rv/sv/ykrvsv2-nadxe5rvvs7gj8iw-9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de comprendre comment fonctionne le syst√®me d'actifs du moteur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blitz.Engine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous devons d√©cider quel actif est et ce que nous entendons exactement par syst√®me d'actifs. Selon Wikipedia, un actif de jeu est un objet num√©rique, compos√© principalement des m√™mes donn√©es, une entit√© indivisible qui repr√©sente une partie du contenu du jeu et poss√®de certaines propri√©t√©s. Du point de vue du mod√®le de programme, un actif peut appara√Ætre comme un objet cr√©√© sur un ensemble de donn√©es. Les actifs peuvent √™tre stock√©s dans un fichier s√©par√©. √Ä son tour, un syst√®me d'actifs est un grand nombre de codes de programme charg√©s de charger et d'exploiter des actifs de diff√©rents types.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, un syst√®me d'actifs est une grande partie du moteur de jeu, qui peut devenir un assistant fid√®le pour les d√©veloppeurs de jeux ou transformer leur vie en enfer. </font><font style="vertical-align: inherit;">√Ä mon avis, la d√©cision logique √©tait de concentrer cet ¬´enfer¬ª en un seul endroit, en prot√©geant soigneusement les autres d√©veloppeurs de l'√©quipe. </font><font style="vertical-align: inherit;">Nous allons vous parler de ce que nous avons fait dans cette s√©rie d'articles - allons-y!</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Articles pr√©vus sur le sujet:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ânonc√© des exigences et aper√ßu de l'architecture</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cycle de vie des actifs</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©sentation d√©taill√©e de la classe AssetManager</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int√©gration dans ECS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GlobalAssetCache</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exigences et raisons</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les exigences du syst√®me de chargement des actifs sont n√©es entre un rocher et un endroit dur. </font><font style="vertical-align: inherit;">Une enclume √©tait le d√©sir de faire quelque chose enferm√© en soi pour qu'il fonctionne sans √©crire de code externe. </font><font style="vertical-align: inherit;">Eh bien, ou presque sans √©crire de code externe. </font><font style="vertical-align: inherit;">Le marteau est devenu r√©alit√©. </font><font style="vertical-align: inherit;">Et voici ce que nous avons fini avec:</font></font><br>
<br>
<ol>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestion automatique de la m√©moire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui signifie qu'il n'est pas n√©cessaire d'appeler la fonction de lib√©ration de l'actif. </font><font style="vertical-align: inherit;">Autrement dit, d√®s que tous les objets externes utilisant l'actif sont d√©truits, l'actif est d√©truit. </font><font style="vertical-align: inherit;">La motivation est simple: √©crire moins de code. </font><font style="vertical-align: inherit;">Moins de code signifie moins d'erreurs.</font></font></li>
<li><i> <b></b>  </i>,           (    AssetManager‚Äôa).   ,      .   ‚Äî      .       ,     ¬´¬ª    .<br>
    ,      ,       ().       ‚Äî    ,  . ,     ,              .         ,      ,    .        ,   ,    .</li>
<li><i>   </i>      .  :        .         ,         .</li>
<li><i> (shared)  </i>. ,         .  ,    .           ¬´¬ª ,               .</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Priorisez le chargement des actifs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il n'y a que 3 niveaux de priorit√©: √âlev√©, Moyen, Faible. </font><font style="vertical-align: inherit;">Dans la m√™me priorit√©, les actifs sont charg√©s dans l'ordre de la demande. </font><font style="vertical-align: inherit;">Imaginez une situation: un joueur clique sur ¬´Pour se battre¬ª et le chargement du niveau commence. </font><font style="vertical-align: inherit;">Parall√®lement √† cela, la t√¢che de pr√©paration de l'image-objet de l'√©cran de chargement tombe dans la file d'attente de t√©l√©chargement. </font><font style="vertical-align: inherit;">Mais puisque certains des √©l√©ments de niveau sont entr√©s dans la file d'attente avant le sprite, le joueur regarde l'√©cran noir pendant un certain temps.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, nous avons formul√© une r√®gle simple pour nous-m√™mes: "Tout ce qui peut √™tre fait sur le thread AssetManager doit √™tre fait sur le thread AssetManager." </font><font style="vertical-align: inherit;">Par exemple, pr√©parer une partition du paysage et de la texture des normales sur la base d'une carte de hauteur, relier un programme GPU, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques d√©tails d'impl√©mentation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de commencer √† comprendre le fonctionnement du syst√®me de chargement d'actifs, nous devons nous familiariser avec deux classes largement utilis√©es dans le moteur Blitz.Engine:</font></font><br>
<br>
<ul>
<li><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: informations d'ex√©cution sur un type. </font><font style="vertical-align: inherit;">Ce type est similaire au type </font></font><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du langage C #, √† l'exception qu'il ne donne pas acc√®s aux champs et aux m√©thodes du type. </font><font style="vertical-align: inherit;">Contient: tapez le nom, un certain nombre de signes comme </font></font><code>is_floating, is_pointer, is_const</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, etc. </font><font style="vertical-align: inherit;">La m√©thode </font></font><code>Type::instance&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie une constante au sein d'un seul lancement d'application </font></font><code>const Type*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui vous permet de v√©rifier le formulaire</font></font><code>if (type == Type::instance&lt;T&gt;())</code></li>
<li><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: permet de regrouper la valeur de tout type mobile ou copiable. </font><font style="vertical-align: inherit;">La connaissance du type de package est </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stock√©e en tant que const </font></font><code>Type*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sait calculer un hachage en fonction de son contenu, et sait √©galement comparer le contenu pour l'√©galit√©. </font><font style="vertical-align: inherit;">En cours de route, il vous permet d'effectuer des conversions du type actuel vers un autre. </font><font style="vertical-align: inherit;">C'est une sorte de repenser n'importe quelle classe de la biblioth√®que standard ou de la biblioth√®que boost.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Liste de tous les actifs syst√®me de chargement est bas√© sur trois classes: </font></font><code>AssetManager, AssetBase, IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cependant, avant de proc√©der √† la description de ces classes, il faut dire que le code externe utilise un alias </font></font><code>Asset&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©clar√© comme ceci:</font></font><br>
<br>
<pre><code class="cpp hljs">Asset = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
o√π T est un AssetBase ou un type sp√©cifique d'actif. En utilisant shared_ptr partout, nous atteignons la satisfaction de l'exigence num√©ro 1 (gestion automatique de la m√©moire). </font></font><br>
<br>
<code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Il s'agit d'une classe finie qui n'a pas d'h√©ritiers. Cette classe d√©finit le cycle de vie d'un actif et envoie des messages sur les changements d'√©tat d'un actif. Il </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stocke </font><font style="vertical-align: inherit;">√©galement </font><font style="vertical-align: inherit;">un arbre de d√©pendance entre les actifs et une liaison d'actif aux fichiers sur le disque, √©coute </font></font><code>FileWatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et impl√©mente un rechargement d'actif. Et surtout, il </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lance un thread s√©par√©, impl√©mente une file d'attente de t√¢ches pour pr√©parer l'actif et encapsule toute la synchronisation avec d'autres threads d'application (la demande d'actif peut √™tre ex√©cut√©e √† partir de n'importe quel thread d'application, y compris le flux de t√©l√©chargement). </font><font style="vertical-align: inherit;">Fonctionne en </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m√™me temps </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec un atout abstrait</font></font><code>AssetBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, d√©l√©guant la t√¢che de cr√©ation et de chargement d'un actif d'un type sp√©cifique √† l'h√©ritier de </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je vais vous en dire plus sur la fa√ßon dont cela se produit dans les articles suivants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cadre de l'exigence num√©ro 4 (partage des actifs), l'une des questions les plus br√ªlantes √©tait ¬´quoi utiliser comme identifiant d'actif?¬ª </font><font style="vertical-align: inherit;">La solution la plus simple et apparemment √©vidente serait d'utiliser le chemin d'acc√®s au fichier √† t√©l√©charger. </font><font style="vertical-align: inherit;">Cependant, cette d√©cision impose un certain nombre de limitations s√©rieuses:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour cr√©er un actif, ce dernier doit √™tre repr√©sent√© sous la forme d'un fichier sur disque, ce qui supprime la possibilit√© de cr√©er des actifs d'ex√©cution bas√©s sur d'autres actifs.</font></font></li>
<li>    . ,    GPUProgram     (defines).      ,       .</li>
<li>         ,   .</li>
<li>        .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'avons pas consid√©r√© les paragraphes 3 et 4 comme un argument au tout d√©but, car personne ne pensait m√™me que cela pourrait √™tre utile. Cependant, ces fonctionnalit√©s ont par la suite grandement facilit√© le d√©veloppement de l'√©diteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous avons d√©cid√© d'utiliser la cl√© d'actif comme identifiant, qui au niveau </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est repr√©sent√© par le type </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. L' </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√©ritier sait </font><font style="vertical-align: inherit;">interpr√©ter </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Lui-m√™me </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne conna√Æt que la relation entre le type de cl√© et l'h√©ritier </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le code qui demande un actif sait g√©n√©ralement de quel type d'actif il a besoin et fonctionne avec une cl√© d'un type sp√©cifique. Tout se passe comme ceci:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Texture</span>:</span> <span class="hljs-keyword">public</span> AssetBase<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PathKey</span>
    {</span><font></font>
        FilePath path;<font></font>
        <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">hash</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> PathKey&amp; other);<font></font>
    };<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryKey</span>
    {</span>
        u32 width = <span class="hljs-number">1</span>;<font></font>
        u32 height = <span class="hljs-number">1</span>;<font></font>
        u32 level_count = <span class="hljs-number">1</span>;<font></font>
        TextureFormat format = RBGA8;<font></font>
        TextureType type = TEX_2D;<font></font>
        <span class="hljs-function">Vector&lt;Vector&lt;u8*&gt;&gt; data</span>; <span class="hljs-comment">// Face&lt;MipLevels&lt;Image&gt;&gt;</span><font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">hash</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> MemoryKey&amp; other);<font></font>
    };<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextureSerializer</span>:</span> <span class="hljs-keyword">public</span> IAssetSerializer<font></font>
{<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssetManager</span> <span class="hljs-title">final</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    Asset&lt;T&gt; <span class="hljs-title">get_asset</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Any&amp; key, ...)</span></span>;
    <span class="hljs-function">Asset&lt;AssetBase&gt; <span class="hljs-title">get_asset</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Any&amp; key, ...)</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
   ...<font></font>
   <span class="hljs-function">Texture::PathKey <span class="hljs-title">key</span><span class="hljs-params">(<span class="hljs-string">"/path_to_asset"</span>)</span></span>;<font></font>
   Asset&lt;Texture&gt; asset = asset_manager-&gt;get_asset&lt;Texture&gt;(key);<font></font>
   ...<font></font>
<font></font>
   Texture::MemoryKey mem_key;<font></font>
   mem_key.width = <span class="hljs-number">128</span>;<font></font>
   mem_key.format = <span class="hljs-number">128</span>;<font></font>
   mem_key.level_count = <span class="hljs-number">1</span>;<font></font>
   mem_key.format = A8;<font></font>
   mem_key.type = TEX_2D;<font></font>
   Vector&lt;u8*&gt;&amp; mip_chain = mem_key.data.emplace_back();<font></font>
   mip_chain.push_back(generage_sdf_font());<font></font>
   <font></font>
   Asset&lt;Texture&gt; sdf_font_texture = asset_manager-&gt;get_asset&lt;Texture&gt;(mem_key);<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La m√©thode </font></font><code>hash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et l'op√©rateur de comparaison √† l'int√©rieur </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont n√©cessaires pour le fonctionnement des op√©rations de classe correspondantes </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais nous ne nous attarderons pas sur cela en d√©tail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, ce qui se passe dans le code ci-dessus: au moment de l'appel, la </font></font><code>get_asset(key)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cl√© sera copi√©e dans un objet temporaire du type </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui, √† son tour, sera pass√© √† la m√©thode </font></font><code>get_asset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ensuite, </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prenez le type de cl√© de l'argument. Dans notre cas, ce sera:</font></font><br>
<br>
<pre><code class="cpp hljs">Type::instance&lt;MyAsset::PathKey&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par ce type, il trouvera l'objet s√©rialiseur et d√©l√©guera au s√©rialiseur toutes les op√©rations suivantes (cr√©ation et chargement). </font></font><br>
<br>
<code>AssetBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Il s'agit de la classe de base pour tous les types d'actifs dans le moteur. </font><font style="vertical-align: inherit;">Cette classe stocke la cl√© d'actif, l'√©tat actuel de l'actif (charg√©, dans la file d'attente, etc.), ainsi que le texte d'erreur si le chargement de l'actif a √©chou√©. </font><font style="vertical-align: inherit;">En fait, la structure interne est un peu plus compliqu√©e, mais nous consid√©rerons cela avec le cycle de vie des actifs. </font></font><br>
<br>
<code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme son nom l'indique, est la classe de base de l'entit√© qui pr√©pare l'actif. </font><font style="vertical-align: inherit;">En fait, l'h√©ritier de cette classe ne charge pas seulement l'actif:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affectation et d√©sallocation d'un objet d'actif d'un type sp√©cifique.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chargement d'un √©l√©ment d'un type sp√©cifique.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilation d'une liste de chemins de fichiers sur la base desquels l'actif est construit. </font><font style="vertical-align: inherit;">Cette liste est n√©cessaire pour le m√©canisme de rechargement des actifs lorsqu'un fichier change. </font><font style="vertical-align: inherit;">La question se pose: pourquoi la liste des chemins, et pas un seul chemin? </font><font style="vertical-align: inherit;">Des ressources simples, comme les textures, peuvent vraiment √™tre construites sur la base d'un seul fichier. </font><font style="vertical-align: inherit;">Cependant, si nous regardons le shader, nous verrons que le red√©marrage devrait se produire non seulement si le texte du shader est modifi√©, mais √©galement si le fichier connect√© au shader est modifi√© via la directive include.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrement de l'actif sur le disque. </font><font style="vertical-align: inherit;">Il est activement utilis√© √† la fois lors de la modification des ressources et de la pr√©paration des ressources pour le jeu.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indique les types de cl√©s qu'il prend en charge.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et la derni√®re question que je veux mettre en √©vidence dans le cadre de cet article: pourquoi pourriez-vous avoir besoin de plusieurs types de cl√©s sur un s√©rialiseur / actif? </font><font style="vertical-align: inherit;">Disons-le √† son tour.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un s√©rialiseur - plusieurs types de cl√©s</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons un exemple d'actif </font></font><code>GPUProgram</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c'est-√†-dire un shader). </font><font style="vertical-align: inherit;">Afin de charger un shader dans notre moteur, les informations suivantes sont requises:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chemin d'acc√®s au fichier shader.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des d√©finitions de pr√©processeur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sc√®ne pour laquelle le shader est assembl√© et compil√© (sommet, fragment, calcul).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nom du point d'entr√©e.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En rassemblant ces informations, nous obtenons la cl√© de shader, qui est utilis√©e dans le jeu. Cependant, lors du d√©veloppement d'un jeu ou d'un moteur, il est souvent n√©cessaire d'afficher des informations de d√©bogage √† l'√©cran, parfois avec un shader sp√©cifique. Et dans cette situation, il peut √™tre pratique d'√©crire le texte du shader directement dans le code. Pour ce faire, nous pouvons obtenir le deuxi√®me type de cl√© qui, au lieu du chemin d'acc√®s au fichier et de la liste des d√©finitions de pr√©processeur, contiendra le texte du shader. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons un autre exemple: la texture. La fa√ßon la plus simple de cr√©er une texture est de la charger √† partir du disque. Pour ce faire, nous avons besoin du chemin d'acc√®s au fichier ( </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Mais nous pouvons √©galement g√©n√©rer le contenu de la texture de mani√®re algorithmique et cr√©er une texture √† partir d'un tableau d'octets ( </font></font><code>MemoryKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Le troisi√®me type de cl√© peut √™tre une cl√© pour cr√©er une </font></font><code>RenderTarget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture ( </font></font><code>RTKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon le type de cl√©, diff√©rents moteurs de rast√©risation de glyphes peuvent √™tre utilis√©s: stb (StbFontKey), FreeType (FTFontKet) ou un g√©n√©rateur de polices de champ de distance sign√© auto-sign√© (SDFFontKey). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'animation d'images cl√©s peut √™tre charg√©e ( </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ou g√©n√©r√©e par du code ( </font></font><code>MemoryKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un atout - plusieurs types de cl√©s</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez que nous avons un </font></font><code>ParticleEffect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atout qui d√©crit les r√®gles de g√©n√©ration de particules. De plus, nous avons un √©diteur pratique pour cet actif. En m√™me temps, l'√©diteur de niveau et l'√©diteur de particules sont une seule application multi-fen√™tres. Ceci est pratique car vous pouvez ouvrir un niveau, y placer une source de particules et regarder l'effet dans l'environnement du niveau, tout en modifiant l'effet lui-m√™me. Si nous avons un type de cl√©, alors l‚Äôobjet effet utilis√© dans le monde de l‚Äô√©dition d‚Äôeffets et dans le monde des niveaux est le m√™me. Toutes les modifications apport√©es dans l'√©diteur d'effets seront imm√©diatement visibles dans le niveau. √Ä premi√®re vue, cela peut sembler une bonne id√©e, mais examinons les sc√©narios suivants:</font></font><br>
<br>
<ol>
<li>    ,   ,    ,    .   ,            . </li>
<li>-       ,    .        ,            .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, une situation est possible dans laquelle nous cr√©ons deux types d'actifs diff√©rents √† partir d'un fichier sur un disque en utilisant deux types de cl√©s diff√©rents. </font><font style="vertical-align: inherit;">En utilisant le type de cl√© ¬´jeu¬ª, nous cr√©ons une structure de donn√©es optimis√©e pour un travail rapide dans le jeu. </font><font style="vertical-align: inherit;">En utilisant le type de cl√© "√©ditorial", nous cr√©ons une structure de donn√©es qui est pratique pour l'√©dition. </font><font style="vertical-align: inherit;">De cette fa√ßon, notre √©diteur impl√©mente l'√©dition </font></font><code>BlendTree</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les animations squelettiques. </font><font style="vertical-align: inherit;">Bas√© sur un type de cl√©, le syst√®me d'actifs nous construit un actif avec un arbre honn√™te √† l'int√©rieur et un tas de signaux sur le changement de topologie, ce qui est tr√®s pratique lors de l'√©dition, mais assez lentement dans le jeu. </font><font style="vertical-align: inherit;">Selon un type de cl√© diff√©rent, le s√©rialiseur cr√©e un autre type d'actif: l'actif n'a aucune m√©thode pour modifier l'arborescence et l'arborescence elle-m√™me est transform√©e en un tableau de n≈ìuds, o√π le lien vers le n≈ìud est un index dans le tableau.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âpilogue</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©sumer, je voudrais concentrer votre attention sur les solutions qui ont surtout influenc√© le d√©veloppement ult√©rieur du moteur:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation d'une structure personnalis√©e comme cl√© d'actif et non comme chemin de fichier.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chargement des ressources uniquement en mode asynchrone.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un sch√©ma flexible pour g√©rer le partage des actifs (un actif - plusieurs types de cl√©s).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La possibilit√© de recevoir des actifs du m√™me type en utilisant diff√©rentes sources de donn√©es (prise en charge de plusieurs types de cl√©s dans un s√©rialiseur).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous apprendrez comment exactement ces d√©cisions ont influenc√© la mise en ≈ìuvre du code interne et du code externe dans la prochaine s√©rie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auteur:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exmix</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498290/index.html">Hydrologie proc√©durale: simulation dynamique des rivi√®res et des lacs</a></li>
<li><a href="../fr498292/index.html">√âconomisez beaucoup d'argent sur de gros volumes dans PostgreSQL</a></li>
<li><a href="../fr498294/index.html">D√©tection d'objets Reconnaissez et r√©gnez. Partie 1</a></li>
<li><a href="../fr498296/index.html">Conception au niveau du syst√®me. Partie 1. De l'id√©e au syst√®me</a></li>
<li><a href="../fr498298/index.html">Les entreprises utilisent des primes de bogue pour acheter le silence des pirates</a></li>
<li><a href="../fr498302/index.html">Licence avanc√©e de l'OIT. Pourquoi est-il n√©cessaire maintenant?</a></li>
<li><a href="../fr498304/index.html">Automatisez les t√¢ches d'administration de l'API VMware vSphere √† l'aide d'Ansible</a></li>
<li><a href="../fr498308/index.html">Algorithme g√©n√©tique Python pour trouver des extrema globaux</a></li>
<li><a href="../fr498310/index.html">Trois pi√®ges de l'apprentissage automatique et comment les √©viter</a></li>
<li><a href="../fr498312/index.html">D√©veloppement d'un r√©seau √©lectrique d'a√©ronefs utilisant une conception orient√©e mod√®le</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>