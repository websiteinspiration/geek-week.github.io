<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧠 🎥 ✌🏼 Apache Hadoopコード品質：本番VSテスト 👨🏾‍🚀 🍀 〰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="高品質の製品コードを取得するには、最大のテストカバレッジを提供するだけでは不十分です。確かに、高い結果を達成するためには、メインプロジェクトのコードとテストが完全にまとまった形で機能する必要があります。したがって、メインコードと同じくらいテストに注意を払う必要があります。優れたテストを作成することは...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Apache Hadoopコード品質：本番VSテスト</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/480928/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c48/f76/cf1/c48f76cf15c8138ce1d944918b1dcc07.png" alt="写真1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
高品質の製品コードを取得するには、最大のテストカバレッジを提供するだけでは不十分です。</font><font style="vertical-align: inherit;">確かに、高い結果を達成するためには、メインプロジェクトのコードとテストが完全にまとまった形で機能する必要があります。</font><font style="vertical-align: inherit;">したがって、メインコードと同じくらいテストに注意を払う必要があります。</font><font style="vertical-align: inherit;">優れたテストを作成することは、本番環境でリグレッションを捉えるための鍵です。</font><font style="vertical-align: inherit;">テストのバグが本番環境よりも悪くないという事実の重要性を示すために、PVS-Studio静的アナライザーからの警告の次の分析を検討します。</font><font style="vertical-align: inherit;">ターゲット：Apache Hadoop。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトについて</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かつてビッグデータに興味を持っていた人は、おそらく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Hadoopの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ようなプロジェクトについて聞いたり、作業したことがあるでしょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">つまり、Hadoopは、ビッグデータシステムを構築して操作するための基礎として使用できるフレームワークです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hadoopは4つのメインモジュールで構成されており、それぞれがビッグデータ分析システムに必要な特定のタスクを実行します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hadoop共通</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapreduce </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hadoop分散ファイルシステム（Hadoop分散ファイルシステム）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">糸</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、インターネット上で理解するための資料はたくさんあります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">検証について</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">
示されて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">いる</font></a><font style="vertical-align: inherit;">ように</font><font style="vertical-align: inherit;">、PVS-Studioはさまざまな方法でプロジェクトに統合できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mavenプラグインを使用します。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradleプラグインを使用します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IntellJ IDEAの使用</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザを直接使用します。 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HadoopはMavenビルドシステムに基づいて構築されているため、検証に問題はありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドキュメントのスクリプトを統合し、pom.xmlの1つをわずかに調整した（依存関係に存在しないモジュールがあった）ため、分析が完了しました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析後、最も興味深い警告を選択したところ、製品コードとテストの両方で同じ数の警告が発生していることに気付きました。通常、テストに該当するアナライザートリガーは考慮しません。しかし、それらを分けて、「テスト」カテゴリからの警告を無視することはできませんでした。 "何故なの？" -テストのバグにも影響があるので、私は考えました。それらは不正確または部分的なテストにつながる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、最も興味深い警告を収集し、それらをコード（本番、テスト）と4つの主要なHadoopモジュールで分割して、アナライザー操作のパーサーに注目します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生産コード</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hadoop共通</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6033</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じキー「KDC_BIND_ADDRESS」を持つアイテムはすでに追加されています。</font><font style="vertical-align: inherit;">MiniKdc.java（163）、MiniKdc.java（162）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MiniKdc</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Set&lt;String&gt; PROPERTIES = <span class="hljs-keyword">new</span> HashSet&lt;String&gt;();<font></font>
  ....<font></font>
  <span class="hljs-keyword">static</span> {<font></font>
    PROPERTIES.add(ORG_NAME);<font></font>
    PROPERTIES.add(ORG_DOMAIN);<font></font>
    PROPERTIES.add(KDC_BIND_ADDRESS);<font></font>
    PROPERTIES.add(KDC_BIND_ADDRESS); <span class="hljs-comment">// &lt;=</span><font></font>
    PROPERTIES.add(KDC_PORT);<font></font>
    PROPERTIES.add(INSTANCE);<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HashSetに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2回追加された</font><font style="vertical-align: inherit;">値は、プロジェクトをチェックする際の一般的な欠陥です。</font><font style="vertical-align: inherit;">実際、2番目の追加は無視されます。</font><font style="vertical-align: inherit;">まあ、この複製が不条理な事故なら。</font><font style="vertical-align: inherit;">しかし、それが本当に別の価値を追加することを意味する場合はどうでしょうか</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapreduce</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6072</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの類似したコードフラグメントが見つかりました。おそらく、これはタイプミスであり、「localArchives」の代わりに「localFiles」変数を使用する必要があります。 LocalDistributedCacheManager.java（183）、LocalDistributedCacheManager.java（178）、LocalDistributedCacheManager.java（176）、LocalDistributedCacheManager.java（181）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">(JobConf conf, JobID jobId)</span> <span class="hljs-keyword">throws</span> IOException </span>{<font></font>
  ....<font></font>
  <span class="hljs-comment">// Update the configuration object with localized data.</span>
  <span class="hljs-keyword">if</span> (!localArchives.isEmpty()) {<font></font>
    conf.set(MRJobConfig.CACHE_LOCALARCHIVES, StringUtils<font></font>
        .arrayToString(localArchives.toArray(<span class="hljs-keyword">new</span> String[localArchives  <span class="hljs-comment">// &lt;=</span><font></font>
            .size()])));<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (!localFiles.isEmpty()) {<font></font>
    conf.set(MRJobConfig.CACHE_LOCALFILES, StringUtils<font></font>
        .arrayToString(localFiles.toArray(<span class="hljs-keyword">new</span> String[localArchives     <span class="hljs-comment">// &lt;=</span><font></font>
            .size()])));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagnostics V6072は、非常に興味深い発見をすることがあります。</font><font style="vertical-align: inherit;">診断の本質は、1つまたは2つの変数をコピーアンドペーストして置き換えることで取得したのと同じタイプのコードフラグメントを検索することですが、一部の変数は「過小評価」されていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコードはこれを示しています。</font><font style="vertical-align: inherit;">最初のブロックでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localArchives</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を使用してアクションが実行され、</font><font style="vertical-align: inherit;">同じタイプの次の</font><font style="vertical-align: inherit;">ブロックでは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localFilesを使用</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">してアクションが実行さ</font><font style="vertical-align: inherit;">れ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、このコードをよく検討し、コードのレビューでよくあるように、すぐに検討しない場合は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localArchives</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を置き換えるのを忘れた場所に注意してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような見落としは、次のシナリオにつながる可能性があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我々が持っていると仮定</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localArchives</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（サイズ= 4）と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localFiles</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（サイズ= 2）。</font></font></li>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localFiles.toArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列</font><i><font style="vertical-align: inherit;">（新しいString [localArchives.size（）]）</font></i><font style="vertical-align: inherit;">を作成すると、最後の2つの要素が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">になり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">（[“ pathToFile1”、“ pathToFile2”、null、null]）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その後、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org.apache.hadoop.util.StringUtils.arrayToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、最後のファイル名が "null"（ "pathToFile1、pathToFile2、null、null" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として表される配列の文字列表現を返します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このすべてが渡され、そのような場合にどのようなチェックがあるかを誰が知っているか=）。</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6007</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'children.size（）&gt; 0'は常にtrueです。</font><font style="vertical-align: inherit;">Queue.java（347）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isHierarchySameAs</span><span class="hljs-params">(Queue newState)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (children == <span class="hljs-keyword">null</span> || children.size() == <span class="hljs-number">0</span>) {<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(children.size() &gt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0での要素数のチェックは個別に行われるため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">children.size（）&gt; 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">さらにチェックする</font><font style="vertical-align: inherit;">と常にtrueになります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HDFS</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '％'演算子の左側と右側に同一のサブ式 'this.bucketSize'があります。</font><font style="vertical-align: inherit;">RollingWindow.java（79）</font></font><br>
<br>
<pre><code class="java hljs">  RollingWindow(<span class="hljs-keyword">int</span> windowLenMs, <span class="hljs-keyword">int</span> numBuckets) {<font></font>
    buckets = <span class="hljs-keyword">new</span> Bucket[numBuckets];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; numBuckets; i++) {<font></font>
      buckets[i] = <span class="hljs-keyword">new</span> Bucket();<font></font>
    }<font></font>
    <span class="hljs-keyword">this</span>.windowLenMs = windowLenMs;
    <span class="hljs-keyword">this</span>.bucketSize = windowLenMs / numBuckets;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.bucketSize % bucketSize != <span class="hljs-number">0</span>) {         <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(
          <span class="hljs-string">"The bucket size in the rolling window is not integer: windowLenMs= "</span>
              + windowLenMs + <span class="hljs-string">" numBuckets= "</span> + numBuckets);<font></font>
    }<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この欠点は、変数がそれ自体に分割されるという事実にあります。</font><font style="vertical-align: inherit;">その結果、多重度のチェックは常に成功し、不正な入力データ（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windowLenMs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numBuckets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の場合、例外はスローされません。</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">糸</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6067</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つ以上のケースブランチが同じアクションを実行します。</font><font style="vertical-align: inherit;">TimelineEntityV2Converter.java（386）、TimelineEntityV2Converter.java（389）</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApplicationReport
 <span class="hljs-title">convertToApplicationReport</span><span class="hljs-params">(TimelineEntity entity)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (metrics != <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">long</span> vcoreSeconds = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">long</span> memorySeconds = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">long</span> preemptedVcoreSeconds = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">long</span> preemptedMemorySeconds = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (TimelineMetric metric : metrics) {
      <span class="hljs-keyword">switch</span> (metric.getId()) {
      <span class="hljs-keyword">case</span> ApplicationMetricsConstants.APP_CPU_METRICS:<font></font>
        vcoreSeconds = getAverageValue(metric.getValues().values());<font></font>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> ApplicationMetricsConstants.APP_MEM_METRICS:<font></font>
        memorySeconds = ....;<font></font>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> ApplicationMetricsConstants.APP_MEM_PREEMPT_METRICS:<font></font>
        preemptedVcoreSeconds = ....;                         <span class="hljs-comment">// &lt;=</span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> ApplicationMetricsConstants.APP_CPU_PREEMPT_METRICS:<font></font>
        preemptedVcoreSeconds = ....;                         <span class="hljs-comment">// &lt;=</span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">default</span>:
        <span class="hljs-comment">// Should not happen..</span>
        <span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケースの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランチでは、同じコードが断片化します。これは常に起こります！圧倒的な数のケースでは、これは実際の間違いではなく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイッチの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リファクタリングについて考える機会にすぎません</font><font style="vertical-align: inherit;">。しかし、問題のケースではありません。繰り返されるコードスニペットでは、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preemptedVcoreSecondsの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><i><font style="vertical-align: inherit;">が設定され</font></i><font style="vertical-align: inherit;">ます。あなたはすべての変数と定数の名前に注意を払う場合は、の場合はという結論に来ることができる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metric.getId（）== APP_MEM_PREEMPT_METRICS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、変数の値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preemptedMemorySecondsが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定されるべきで</font><font style="vertical-align: inherit;">はなく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preemptedVcoreSeconds</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。この点で、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preemptedMemorySeconds</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「switch」ステートメントを実行した後、常に0が残り、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preemptedVcoreSeconds</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値</font><font style="vertical-align: inherit;">が正しくない場合があります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6046</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不正なフォーマット。</font><font style="vertical-align: inherit;">異なる数のフォーマット項目が予期されています。</font><font style="vertical-align: inherit;">使用されない引数：2. AbstractSchedulerPlanFollower.java（186）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">synchronizePlan</span><span class="hljs-params">(Plan plan, <span class="hljs-keyword">boolean</span> shouldReplan)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span><font></font>
  {<font></font>
    setQueueEntitlement(planQueueName, ....);<font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> (YarnException e)<font></font>
  {<font></font>
    LOG.warn(<span class="hljs-string">"Exception while trying to size reservation for plan: {}"</span>,<font></font>
              currResId,<font></font>
              planQueueName,<font></font>
              e);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロギング時に</font><font style="vertical-align: inherit;">
未使用の変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">planQueueName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここでは、コピーが多すぎるか、フォーマット文字列が変更されていません。</font><font style="vertical-align: inherit;">それにもかかわらず、私は古き良き、時には弱気なサービスのコピーと貼り付けに傾倒しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストコード</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hadoop共通</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6072</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの類似したコードフラグメントが見つかりました。</font><font style="vertical-align: inherit;">おそらく、これはタイプミスであり、「allSecretsA」の代わりに「allSecretsB」変数を使用する必要があります。</font><font style="vertical-align: inherit;">TestZKSignerSecretProvider.java（316）、TestZKSignerSecretProvider.java（309）、TestZKSignerSecretProvider.java（306）、TestZKSignerSecretProvider.java（313）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMultiple</span><span class="hljs-params">(<span class="hljs-keyword">int</span> order)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
    ....<font></font>
    currentSecretA = secretProviderA.getCurrentSecret();<font></font>
    allSecretsA = secretProviderA.getAllSecrets();<font></font>
    Assert.assertArrayEquals(secretA2, currentSecretA);<font></font>
    Assert.assertEquals(<span class="hljs-number">2</span>, allSecretsA.length);         <span class="hljs-comment">// &lt;=</span>
    Assert.assertArrayEquals(secretA2, allSecretsA[<span class="hljs-number">0</span>]);<font></font>
    Assert.assertArrayEquals(secretA1, allSecretsA[<span class="hljs-number">1</span>]);<font></font>
<font></font>
    currentSecretB = secretProviderB.getCurrentSecret();<font></font>
    allSecretsB = secretProviderB.getAllSecrets();<font></font>
    Assert.assertArrayEquals(secretA2, currentSecretB);<font></font>
    Assert.assertEquals(<span class="hljs-number">2</span>, allSecretsA.length);        <span class="hljs-comment">// &lt;=</span>
    Assert.assertArrayEquals(secretA2, allSecretsB[<span class="hljs-number">0</span>]);<font></font>
    Assert.assertArrayEquals(secretA1, allSecretsB[<span class="hljs-number">1</span>]);<font></font>
    ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして再びV6072。</font><font style="vertical-align: inherit;">変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allSecretsA</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allSecretsBに</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">注意</font></i><font style="vertical-align: inherit;">して</font><i><font style="vertical-align: inherit;">ください</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6043</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「for」演算子の検査を検討してください。</font><font style="vertical-align: inherit;">イテレータの初期値と最終値は同じです。</font><font style="vertical-align: inherit;">TestTFile.java（235）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">readPrepWithUnknownLength</span><span class="hljs-params">(Scanner scanner, <span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> n)</span>
    <span class="hljs-keyword">throws</span> IOException </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = start; i &lt; start; i++) {<font></font>
    String key = String.format(localFormatter, i);<font></font>
    <span class="hljs-keyword">byte</span>[] read = readKey(scanner);<font></font>
    assertTrue(<span class="hljs-string">"keys not equal"</span>, Arrays.equals(key.getBytes(), read));
    <span class="hljs-keyword">try</span> {<font></font>
      read = readValue(scanner);<font></font>
      assertTrue(<span class="hljs-keyword">false</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">catch</span> (IOException ie) {
      <span class="hljs-comment">// should have thrown exception</span><font></font>
    }<font></font>
    String value = <span class="hljs-string">"value"</span> + key;<font></font>
    read = readLongValue(scanner, value.getBytes().length);<font></font>
    assertTrue(<span class="hljs-string">"values nto equal"</span>, Arrays.equals(read, value.getBytes()));<font></font>
    scanner.advance();<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> (start + n);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
常にグリーンなテストですか？</font><font style="vertical-align: inherit;">=）。</font><font style="vertical-align: inherit;">テストの一部であるループの本体は実行されません。</font><font style="vertical-align: inherit;">これは</font><font style="vertical-align: inherit;">、カウンターの開始値と終了値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートメントで</font><font style="vertical-align: inherit;">一致</font><font style="vertical-align: inherit;">している</font><i><font style="vertical-align: inherit;">ため</font></i><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">結果として、条件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i &lt;startは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すぐにfalseを返し、これがこの動作につながります。</font><font style="vertical-align: inherit;">私はテストでファイルを実行し、ループ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i &lt;（start + n）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の条件で書き込む必要があるという結論に達しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapreduce</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a href = " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.viva64.com/en/w/v6007</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "&gt; V6007式 'byteAm &lt;0'は常にfalseです。</font><font style="vertical-align: inherit;">DataWriter.java（322）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">GenerateOutput <span class="hljs-title">writeSegment</span><span class="hljs-params">(<span class="hljs-keyword">long</span> byteAm, OutputStream out)</span>
    <span class="hljs-keyword">throws</span> IOException </span>{
  <span class="hljs-keyword">long</span> headerLen = getHeaderLength();
  <span class="hljs-keyword">if</span> (byteAm &lt; headerLen) {
    <span class="hljs-comment">// not enough bytes to write even the header</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GenerateOutput(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
  }<font></font>
  <span class="hljs-comment">// adjust for header length</span><font></font>
  byteAm -= headerLen;<font></font>
  <span class="hljs-keyword">if</span> (byteAm &lt; <span class="hljs-number">0</span>) {    <span class="hljs-comment">// &lt;=</span>
    byteAm = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byteAm &lt;0は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常にfalseです。</font><font style="vertical-align: inherit;">理解するために、上のコードを上に移動しましょう。</font><font style="vertical-align: inherit;">テストの実行が操作</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byteAm-= headerLen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">到達</font><font style="vertical-align: inherit;">すると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byteAm&gt; = headerLen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が存在することになります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここから、減算を実行した後、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byteAm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値</font><font style="vertical-align: inherit;">が負になることはありません。</font><font style="vertical-align: inherit;">Q.E.D.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HDFS</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6072</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの類似したコードフラグメントが見つかりました。</font><font style="vertical-align: inherit;">おそらく、これはタイプミスであり、「normalDir」の代わりに「normalFile」変数を使用する必要があります。</font><font style="vertical-align: inherit;">TestWebHDFS.java（625）、TestWebHDFS.java（615）、TestWebHDFS.java（614）、TestWebHDFS.java（624）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testWebHdfsErasureCodingFiles</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">final</span> Path normalDir = <span class="hljs-keyword">new</span> Path(<span class="hljs-string">"/dir"</span>);<font></font>
  dfs.mkdirs(normalDir);<font></font>
  <span class="hljs-keyword">final</span> Path normalFile = <span class="hljs-keyword">new</span> Path(normalDir, <span class="hljs-string">"file.log"</span>);<font></font>
  ....<font></font>
  <span class="hljs-comment">// logic block #1</span><font></font>
  FileStatus expectedNormalDirStatus = dfs.getFileStatus(normalDir);<font></font>
  FileStatus actualNormalDirStatus = webHdfs.getFileStatus(normalDir); <span class="hljs-comment">// &lt;=</span><font></font>
  Assert.assertEquals(expectedNormalDirStatus.isErasureCoded(),<font></font>
                      actualNormalDirStatus.isErasureCoded());<font></font>
  ContractTestUtils.assertNotErasureCoded(dfs, normalDir);<font></font>
  assertTrue(normalDir + <span class="hljs-string">" should have erasure coding unset in "</span> + ....);<font></font>
<font></font>
  <span class="hljs-comment">// logic block #2</span><font></font>
  FileStatus expectedNormalFileStatus = dfs.getFileStatus(normalFile);<font></font>
  FileStatus actualNormalFileStatus = webHdfs.getFileStatus(normalDir); <span class="hljs-comment">// &lt;=</span><font></font>
  Assert.assertEquals(expectedNormalFileStatus.isErasureCoded(),<font></font>
                      actualNormalFileStatus.isErasureCoded());<font></font>
  ContractTestUtils.assertNotErasureCoded(dfs, normalFile);<font></font>
  assertTrue( normalFile + <span class="hljs-string">" should have erasure coding unset in "</span> + ....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それを信じてはいけない、そして再びV6072！</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normalDir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normalFile変数に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従うだけ</font><i><font style="vertical-align: inherit;">です</font></i></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6027</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数は、同じ関数の呼び出しを通じて初期化されます。おそらくエラーまたは最適化されていないコードです。 TestDFSAdmin.java（883）、TestDFSAdmin.java（879）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">verifyNodesAndCorruptBlocks</span><span class="hljs-params">(
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> numDn,
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> numLiveDn,
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> numCorruptBlocks,
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> numCorruptECBlockGroups,
    <span class="hljs-keyword">final</span> DFSClient client,
    <span class="hljs-keyword">final</span> Long highestPriorityLowRedundancyReplicatedBlocks,
    <span class="hljs-keyword">final</span> Long highestPriorityLowRedundancyECBlocks)</span>
    <span class="hljs-keyword">throws</span> IOException
</span>{
  <span class="hljs-comment">/* init vars */</span><font></font>
  ....<font></font>
  <span class="hljs-keyword">final</span> String expectedCorruptedECBlockGroupsStr = String.format(
      <span class="hljs-string">"Block groups with corrupt internal blocks: %d"</span>,<font></font>
      numCorruptECBlockGroups);<font></font>
  <span class="hljs-keyword">final</span> String highestPriorityLowRedundancyReplicatedBlocksStr<font></font>
      = String.format(<font></font>
      <span class="hljs-string">"\tLow redundancy blocks with highest priority "</span> +
          <span class="hljs-string">"to recover: %d"</span>,<font></font>
      highestPriorityLowRedundancyReplicatedBlocks);<font></font>
  <span class="hljs-keyword">final</span> String highestPriorityLowRedundancyECBlocksStr = String.format(
      <span class="hljs-string">"\tLow redundancy blocks with highest priority "</span> +
          <span class="hljs-string">"to recover: %d"</span>,<font></font>
      highestPriorityLowRedundancyReplicatedBlocks);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このフラグメントでは、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highestPriorityLowRedundancyReplicatedBlocksStr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highestPriorityLowRedundancyECBlocksStrが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ値で初期化されています。多くの場合、そうであるべきですが、この状況ではありません。ここでの変数名は長く、互いに類似しているので、コピーと貼り付けで対応する変更がなかったことに驚かないでください。この状況を修正するには、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highestPriorityLowRedundancyECBlocksStrを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化するときに</font><font style="vertical-align: inherit;">、入力パラメーター</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highestPriorityLowRedundancyECBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する必要があります</font><font style="vertical-align: inherit;">。これに加えて、ほとんどの場合、フォーマット文字列を修正する必要があります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到達不能コードが検出されました。エラーが発生している可能性があります。 TestReplaceDatanodeFailureReplication.java（222）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span>
<span class="hljs-title">verifyFileContent</span><span class="hljs-params">(...., SlowWriter[] slowwriters)</span> <span class="hljs-keyword">throws</span> IOException
</span>{<font></font>
  LOG.info(<span class="hljs-string">"Verify the file"</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; slowwriters.length; i++) {<font></font>
    LOG.info(slowwriters[i].filepath + ....);<font></font>
    FSDataInputStream in = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">try</span> {<font></font>
      in = fs.open(slowwriters[i].filepath);<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>, x;; j++) {<font></font>
        x = in.read();<font></font>
        <span class="hljs-keyword">if</span> ((x) != -<span class="hljs-number">1</span>) {<font></font>
          Assert.assertEquals(j, x);<font></font>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span>;<font></font>
        }<font></font>
      }<font></font>
    } <span class="hljs-keyword">finally</span> {<font></font>
      IOUtils.closeStream(in);<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは</font><font style="vertical-align: inherit;">、ループ内の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i ++</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カウンターを変更すること</font><font style="vertical-align: inherit;">は不可能で</font><font style="vertical-align: inherit;">あることを誓い</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">つまり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループ</font><i><font style="vertical-align: inherit;">（int i = 0; i &lt;slowwriters.length; i ++）{....}では</font></i><font style="vertical-align: inherit;">、1回の繰り返ししか実行されません。</font><font style="vertical-align: inherit;">その理由を調べてみましょう。</font><font style="vertical-align: inherit;">したがって、最初の反復では、ストリームを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slowwriters [0]に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">対応するファイルに関連付けて、</font><font style="vertical-align: inherit;">さらに読み取ります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループ</font><i><font style="vertical-align: inherit;">（int j = 0、x ;; j ++）</font></i><font style="vertical-align: inherit;">を通じて、</font><font style="vertical-align: inherit;">ファイルの内容をバイト単位で読み取ります。ここで、</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">適切なものを読み取る場合は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assertEqualsを使用</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して、読み取ったバイトをカウンター</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在の値と比較します</font><font style="vertical-align: inherit;">（検証に失敗した場合は、失敗してテストを終了します）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルがテストに合格し、ファイルの終わりに達した場合（読み取り-1）、メソッドを終了します。 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スローライター[0]を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックするときに何が起こっ</font><font style="vertical-align: inherit;">ても、問題は次の要素をチェックすることにはなりません。</font><font style="vertical-align: inherit;">ほとんどの</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returnの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代わりに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用</font><i><font style="vertical-align: inherit;">する</font></i><font style="vertical-align: inherit;">必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">糸</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到達不能コードが検出されました。</font><font style="vertical-align: inherit;">エラーが発生している可能性があります。</font><font style="vertical-align: inherit;">TestNodeManager.java（176）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 
<span class="hljs-title">testCreationOfNodeLabelsProviderService</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
  <span class="hljs-keyword">try</span> {<font></font>
    ....<font></font>
  } <span class="hljs-keyword">catch</span> (Exception e) {<font></font>
    Assert.fail(<span class="hljs-string">"Exception caught"</span>);<font></font>
    e.printStackTrace();<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この状況では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assert.fail</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">がテストを中断する</font><font style="vertical-align: inherit;">ため、例外が発生した場合、スタックトレースは出力されません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例外がキャッチされたという十分なメッセージがある場合は、混乱しないように、スタックトレースの出力を削除する必要があります。</font><font style="vertical-align: inherit;">印刷が必要な場合は、交換するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような場所はたくさんあります：</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6019到達不能コードが検出されました。</font><font style="vertical-align: inherit;">エラーが発生している可能性があります。</font><font style="vertical-align: inherit;">TestResourceTrackerService.java（928）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6019到達不能コードが検出されました。</font><font style="vertical-align: inherit;">エラーが発生している可能性があります。</font><font style="vertical-align: inherit;">TestResourceTrackerService.java（737）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6019到達不能コードが検出されました。</font><font style="vertical-align: inherit;">エラーが発生している可能性があります。</font><font style="vertical-align: inherit;">TestResourceTrackerService.java（685）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">....</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V6072</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの類似したコードフラグメントが見つかりました。</font><font style="vertical-align: inherit;">おそらく、これはタイプミスであり、「usercache」の代わりに「publicCache」変数を使用する必要があります。</font><font style="vertical-align: inherit;">TestResourceLocalizationService.java（315）、TestResourceLocalizationService.java（309）、TestResourceLocalizationService.java（307）、TestResourceLocalizationService.java（313）</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDirectoryCleanupOnNewlyCreatedStateStore</span><span class="hljs-params">()</span>
    <span class="hljs-keyword">throws</span> IOException, URISyntaxException
</span>{<font></font>
  ....<font></font>
  <span class="hljs-comment">// verify directory creation</span>
  <span class="hljs-keyword">for</span> (Path p : localDirs) {<font></font>
    p = <span class="hljs-keyword">new</span> Path((<span class="hljs-keyword">new</span> URI(p.toString())).getPath());<font></font>
<font></font>
    <span class="hljs-comment">// logic block #1</span>
    Path usercache = <span class="hljs-keyword">new</span> Path(p, ContainerLocalizer.USERCACHE);<font></font>
    verify(spylfs).rename(eq(usercache), any(Path.class), any()); // &lt;=<font></font>
    verify(spylfs).mkdir(eq(usercache), ....);<font></font>
<font></font>
    // logic block #<span class="hljs-number">2</span>
    Path publicCache = <span class="hljs-keyword">new</span> Path(p, ContainerLocalizer.FILECACHE);<font></font>
    verify(spylfs).rename(eq(usercache), any(Path.class), any()); // &lt;=<font></font>
    verify(spylfs).mkdir(eq(publicCache), ....);<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後に、再びV6072 =）。</font><font style="vertical-align: inherit;">不審なスニペットを理解するための変数：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usercache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publicCache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発中、数十万行のコードが書き込まれます。プロダクションコードがバグ、欠陥、欠点を排除しようとしている場合（開発者は自分のコードをテストし、コードレビューを行うなど）、テストは明らかにこれよりも劣ります。テストの欠陥は、「グリーンティック」の背後に静かに隠れることがあります。また、今日の警告の分析からわかるように、成功したテストは常に保証されたテストとはほど遠いものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Hadoopコードベースをチェックする際、静的分析は、実稼働に入るコードだけでなく、開発で重要な役割を果たすテストの必要性も示しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、コードとテストベースの品質に関心がある場合は、静的分析に目を向けることをお勧めします。</font><font style="vertical-align: inherit;">そして、私が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を試すことを提案するテストの最初の申請者</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Maxim Stefanov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Hadoop Code Quality：Production VS Test</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja480914/index.html">初心者向けのマイクロサービス</a></li>
<li><a href="../ja480920/index.html">長距離PoEを使用したTP-Linkスイッチのテスト。そして、古いモデルのアップグレードについて少し</a></li>
<li><a href="../ja480922/index.html">Evgeny Usvitsky：「世界中の誰もが地理データを自由に取得できる場所を知っています-OSMでのみ」</a></li>
<li><a href="../ja480924/index.html">MediEvilのリメイクの作成者がゲームのカルトボスを再設計した方法と理由</a></li>
<li><a href="../ja480926/index.html">物理的に正確なレンダリングの確率理論</a></li>
<li><a href="../ja480930/index.html">すべてを入力</a></li>
<li><a href="../ja480938/index.html">ロシアの裁判官の目を通した暗号通貨</a></li>
<li><a href="../ja480940/index.html">キュウリとセレノイドを使用したクロスブラウザーUIテストをGitlab CIで実行します。</a></li>
<li><a href="../ja480944/index.html">2020年のメールマーケティングのトップ5トレンド</a></li>
<li><a href="../ja480946/index.html">今日のKubernetes（だけでなく）のログ：期待と現実</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>