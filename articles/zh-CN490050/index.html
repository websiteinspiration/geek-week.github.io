<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ ğŸ‘· ğŸï¸ ä½¿ç”¨Apache ArrowæµåŒ–åˆ—æ•°æ® ğŸ‘†ğŸ¿ ğŸ•• ğŸ§”ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡çš„ç¿»è¯‘æ˜¯ä¸“é—¨ä¸ºæ•°æ®å·¥ç¨‹å¸ˆè¯¾ç¨‹çš„å­¦ç”Ÿå‡†å¤‡çš„ã€‚
 
 
 
 åœ¨è¿‡å»çš„å‡ å‘¨ä¸­ï¼Œæˆ‘å’ŒNong Liå‘Apache Arrowæ·»åŠ äº†äºŒè¿›åˆ¶æµæ ¼å¼ï¼Œä»¥è¡¥å……ç°æœ‰çš„éšæœºè®¿é—®/ IPCæ–‡ä»¶æ ¼å¼ã€‚æˆ‘ä»¬æœ‰Javaï¼ŒC ++å’ŒPythonç»‘å®šçš„å®ç°ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨æ ¼å¼çš„å·¥ä½œåŸç†ï¼Œå¹¶è¯´æ˜å¦‚ä½•ä¸ºDataFrameç†Š...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Apache ArrowæµåŒ–åˆ—æ•°æ®</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/490050/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æ–‡çš„ç¿»è¯‘æ˜¯ä¸“é—¨ä¸º</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®å·¥ç¨‹å¸ˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¾ç¨‹çš„å­¦ç”Ÿå‡†å¤‡çš„</font><font style="vertical-align: inherit;">ã€‚</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/6b/3m/kz/6b3mkzihfzscol1hedy_gppa2f0.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿‡å»çš„å‡ å‘¨ä¸­ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å’ŒNong Li</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Arrow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ äº†</font><font style="vertical-align: inherit;">äºŒè¿›åˆ¶æµæ ¼å¼ï¼Œ</font><font style="vertical-align: inherit;">ä»¥</font><font style="vertical-align: inherit;">è¡¥å……ç°æœ‰çš„éšæœºè®¿é—®/ IPCæ–‡ä»¶æ ¼å¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰Javaï¼ŒC ++å’ŒPythonç»‘å®šçš„å®ç°ã€‚</font><font style="vertical-align: inherit;">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨æ ¼å¼çš„å·¥ä½œåŸç†ï¼Œå¹¶è¯´æ˜å¦‚ä½•ä¸ºDataFrameç†ŠçŒ«å®ç°éå¸¸é«˜çš„æ•°æ®ååé‡ã€‚</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ—æ•°æ®æµ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 æˆ‘ä»Arrowç”¨æˆ·é‚£é‡Œå¾—åˆ°çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯å°†å¤§å‹è¡¨æ ¼æ•°æ®é›†ä»é¢å‘è¡Œæˆ–é¢å‘è¡Œçš„æ ¼å¼è½¬æ¢ä¸ºåˆ—æ ¼å¼çš„é«˜æ˜‚æˆæœ¬çš„é—®é¢˜ã€‚å¯¹äºæ•°åƒå…†å­—èŠ‚çš„æ•°æ®é›†ï¼Œåœ¨å†…å­˜æˆ–ç£ç›˜ä¸­è¿›è¡Œè½¬ç½®å¯èƒ½æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºæµæ•°æ®ï¼Œä¸ç®¡æºæ•°æ®æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯åˆ—ï¼Œä¸€ç§é€‰æ‹©æ˜¯å‘é€å°çš„å­—ç¬¦ä¸²åŒ…ï¼Œå…¶ä¸­æ¯ä¸ªå­—ç¬¦ä¸²éƒ½åŒ…å«åˆ—å¸ƒå±€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨Apache Arrowä¸­ï¼Œä»£è¡¨ä¸€ä¸ªè¡¨å—çš„å†…å­˜ä¸­åˆ—æ•°ç»„çš„é›†åˆç§°ä¸ºè®°å½•æ‰¹å¤„ç†ã€‚è¦è¡¨ç¤ºé€»è¾‘è¡¨çš„å•ä¸ªæ•°æ®ç»“æ„ï¼Œå¯ä»¥æ”¶é›†å‡ ä¸ªè®°å½•åŒ…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç°æœ‰çš„â€œéšæœºè®¿é—®â€æ–‡ä»¶æ ¼å¼ä¸­ï¼Œæˆ‘ä»¬è®°å½•å…ƒæ•°æ®ï¼Œè¯¥å…ƒæ•°æ®åŒ…å«è¡¨å¸ƒå±€å’Œæ–‡ä»¶æœ«å°¾å—çš„ä½ç½®ï¼Œè¿™ä½¿æ‚¨å¯ä»¥éå¸¸ä¾¿å®œåœ°ä»æ•°æ®é›†ä¸­é€‰æ‹©ä»»ä½•è®°å½•åŒ…æˆ–ä»»ä½•åˆ—ã€‚</font><font style="vertical-align: inherit;">ä»¥æµæ ¼å¼ï¼Œæˆ‘ä»¬å‘é€ä¸€ç³»åˆ—æ¶ˆæ¯ï¼šä¸€ä¸ªæ–¹æ¡ˆï¼Œç„¶åä¸€ä¸ªæˆ–å¤šä¸ªè®°å½•åŒ…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸åŒçš„æ ¼å¼ç±»ä¼¼äºæ­¤å›¾æ‰€ç¤ºï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/kd/jq/ofkdjqyesvfqkmj92jntxjuqani.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyArrowæµï¼šåº”ç”¨ç¨‹åº</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ä¸ºäº†å‘æ‚¨å±•ç¤ºè¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘å°†åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºå•ä¸ªæµå—çš„ç¤ºä¾‹æ•°æ®é›†ï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">import</span> time
<span class="hljs-attribute">import</span> numpy as np
<span class="hljs-attribute">import</span> pandas as pd
<span class="hljs-attribute">import</span> pyarrow as pa<font></font>
<font></font>
<span class="hljs-attribute">def</span> generate_data(total_size, ncols):
    <span class="hljs-attribute">nrows</span> = int(total_size / ncols / np.dtype('float<span class="hljs-number">64</span>').itemsize)
    <span class="hljs-attribute">return</span> pd.DataFrame({<font></font>
        '<span class="hljs-attribute">c</span>' + str(i): np.random.randn(nrows)
        <span class="hljs-attribute">for</span> i in range(ncols)<font></font>
    })	</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬è¦è®°å½•1 GBçš„æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®ç”±1 MBçš„å—ç»„æˆï¼Œæ€»å…±1024ä¸ªå—ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºå…·æœ‰16åˆ—çš„ç¬¬ä¸€ä¸ª1 MBæ•°æ®å¸§ï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">KILOBYTE</span> = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">10</span>
<span class="hljs-attribute">MEGABYTE</span> = KILOBYTE * KILOBYTE
<span class="hljs-attribute">DATA_SIZE</span> = <span class="hljs-number">1024</span> * MEGABYTE
<span class="hljs-attribute">NCOLS</span> = <span class="hljs-number">16</span><font></font>
<font></font>
<span class="hljs-attribute">df</span> = generate_data(MEGABYTE, NCOLS)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ç„¶åæˆ‘å°†å®ƒä»¬è½¬æ¢ä¸º</font></font><code>pyarrow.RecordBatch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">batch</span> = pa.RecordBatch.from_pandas(df)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ç°åœ¨ï¼Œæˆ‘å°†åˆ›å»ºä¸€ä¸ªè¾“å‡ºæµï¼Œè¯¥æµå°†å†™å…¥RAMå¹¶åˆ›å»º</font></font><code>StreamWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">sink</span> = pa.InMemoryOutputStream()
<span class="hljs-attribute">stream_writer</span> = pa.StreamWriter(sink, batch.schema)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ç„¶åæˆ‘ä»¬å†™å…¥1024ä¸ªå—ï¼Œè¿™äº›å—æœ€ç»ˆå°†æ„æˆ1GBçš„æ•°æ®é›†ï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">for</span> i in range(DATA_SIZE // MEGABYTE):
    <span class="hljs-attribute">stream_writer</span>.write_batch(batch)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ç”±äºæˆ‘ä»¬æ˜¯åœ¨RAMä¸­ç¼–å†™çš„ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸€ä¸ªç¼“å†²åŒºä¸­è·å–æ•´ä¸ªæµï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">In</span><span class="hljs-meta"> [13]: source = sink.get_result()

In [14]: source
Out[14]: &lt;pyarrow.io.Buffer at 0x7f2df7118f80&gt;

In [15]: source.size
Out[15]: 1074750744</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ç”±äºæ­¤æ•°æ®åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤è¯»å‡ºArrowè®°å½•æ•°æ®åŒ…æ˜¯é›¶å¤åˆ¶æ“ä½œã€‚</font><font style="vertical-align: inherit;">æˆ‘æ‰“å¼€StreamReaderï¼Œè¯»å–ä¸­çš„æ•°æ®</font></font><code>pyarrow.Table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸º</font></font><code>DataFrame pandas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">In</span><span class="hljs-meta"> [16]: reader = pa.StreamReader(source)

In [17]: table = reader.read_all()

In [18]: table
Out[18]: &lt;pyarrow.table.Table at 0x7fae8281f6f0&gt;

In [19]: df = table.to_pandas()

In [20]: df.memory_usage().sum()
Out[20]: 1073741904</span></code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯æ‚¨å¯èƒ½ä¼šæœ‰ç–‘é—®ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œå¾—æœ‰å¤šå¿«ï¼Ÿ</font><font style="vertical-align: inherit;">å—å¤§å°å¦‚ä½•å½±å“è·å–DataFrameç†ŠçŒ«çš„æ€§èƒ½ï¼Ÿ</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµåª’ä½“æ€§èƒ½</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 éšç€æµå¼ä¼ è¾“å—çš„å¤§å°å‡å°ï¼Œç”±äºæ•ˆç‡ä½ä¸‹çš„ç¼“å­˜è®¿é—®æ–¹æ¡ˆï¼Œåœ¨ç†ŠçŒ«ä¸­é‡å»ºè¿ç»­DataFrameåˆ—çš„æˆæœ¬å¢åŠ ã€‚ä½¿ç”¨C ++æ•°æ®ç»“æ„å’Œæ•°ç»„åŠå…¶å†…å­˜ç¼“å†²åŒºä¹Ÿæœ‰ä¸€äº›å¼€é”€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ï¼ˆå››æ ¸Xeon E3-1505Mï¼‰ä¸Šï¼Œå¯¹äº1 MBï¼Œç»“æœæ˜¯ï¼š</font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">In</span><span class="hljs-meta"> [20]: %timeit pa.StreamReader(source).read_all().to_pandas()
10 loops, best of 3: 129 ms per loop</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 äº‹å®è¯æ˜ï¼Œæ¢å¤1024ä¸ª1MBå—çš„1Gb DataFrameçš„æœ‰æ•ˆå¸¦å®½ä¸º7.75 Gb / sã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ›´å¤§æˆ–æ›´å°çš„å—ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</font><font style="vertical-align: inherit;">ç»“æœå¦‚ä¸‹ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_2/qz/4j/_2qz4j7k7keun29itu0bx-cnklw.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 æ€§èƒ½ä»256Kå—æ˜¾ç€ä¸‹é™åˆ°64Kã€‚</font><font style="vertical-align: inherit;">æˆ‘æ„Ÿåˆ°æƒŠè®¶çš„æ˜¯1 MBçš„å—å¤„ç†é€Ÿåº¦å¿«äº16 MBã€‚</font><font style="vertical-align: inherit;">å€¼å¾—è¿›è¡Œæ›´æ·±å…¥çš„ç ”ç©¶ï¼Œå¹¶äº†è§£è¿™æ˜¯å¦æ˜¯æ­£æ€åˆ†å¸ƒæˆ–æ˜¯å¦æœ‰å…¶ä»–å› ç´ å½±å“å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¯¥æ ¼å¼çš„å½“å‰å®ç°ä¸­ï¼ŒåŸåˆ™ä¸Šä¸å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå› æ­¤å†…å­˜å’Œå¯¼çº¿ä¸­çš„å¤§å°å¤§è‡´ç›¸åŒã€‚</font><font style="vertical-align: inherit;">å°†æ¥ï¼Œå‹ç¼©å¯èƒ½ä¼šæˆä¸ºé™„åŠ é€‰é¡¹ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 æµå¼åˆ—æ•°æ®æ˜¯ä½¿ç”¨å°å—å°†å¤§å‹æ•°æ®é›†ä¼ è¾“åˆ°è¯¸å¦‚ç†ŠçŒ«ä¹‹ç±»çš„åˆ—åˆ†æå·¥å…·çš„æœ‰æ•ˆæ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨é¢å‘è¡Œå­˜å‚¨çš„æ•°æ®æœåŠ¡å¯ä»¥ä¼ è¾“å’Œè½¬ç½®è¾ƒå°çš„æ•°æ®å—ï¼Œè¿™äº›æ•°æ®å—å¯¹äºå¤„ç†å™¨çš„L2å’ŒL3ç¼“å­˜æ›´ä¸ºæ–¹ä¾¿ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Œæ•´ä»£ç </font></font><br>
<br>
<pre><code class="apache hljs"><span class="hljs-attribute">import</span> time
<span class="hljs-attribute">import</span> numpy as np
<span class="hljs-attribute">import</span> pandas as pd
<span class="hljs-attribute">import</span> pyarrow as pa<font></font>
<font></font>
<span class="hljs-attribute">def</span> generate_data(total_size, ncols):
    <span class="hljs-attribute">nrows</span> = total_size / ncols / np.dtype('float<span class="hljs-number">64</span>').itemsize
    <span class="hljs-attribute">return</span> pd.DataFrame({<font></font>
        '<span class="hljs-attribute">c</span>' + str(i): np.random.randn(nrows)
        <span class="hljs-attribute">for</span> i in range(ncols)<font></font>
    })<font></font>
<font></font>
<span class="hljs-attribute">KILOBYTE</span> = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">10</span>
<span class="hljs-attribute">MEGABYTE</span> = KILOBYTE * KILOBYTE
<span class="hljs-attribute">DATA_SIZE</span> = <span class="hljs-number">1024</span> * MEGABYTE
<span class="hljs-attribute">NCOLS</span> = <span class="hljs-number">16</span><font></font>
<font></font>
<span class="hljs-attribute">def</span> get_timing(f, niter):
    <span class="hljs-attribute">start</span> = time.clock_gettime(time.CLOCK_REALTIME)
    <span class="hljs-attribute">for</span> i in range(niter):
        <span class="hljs-attribute">f</span>()
    <span class="hljs-attribute">return</span> (time.clock_gettime(time.CLOCK_REALTIME) - start) / NITER<font></font>
<font></font>
<span class="hljs-attribute">def</span> read_as_dataframe(klass, source):
    <span class="hljs-attribute">reader</span> = klass(source)
    <span class="hljs-attribute">table</span> = reader.read_all()
    <span class="hljs-attribute">return</span> table.to_pandas()
<span class="hljs-attribute">NITER</span> = <span class="hljs-number">5</span>
<span class="hljs-attribute">results</span> =<span class="hljs-meta"> []</span><font></font>
<font></font>
<span class="hljs-attribute">CHUNKSIZES</span> =<span class="hljs-meta"> [16 * KILOBYTE, 64 * KILOBYTE, 256 * KILOBYTE, MEGABYTE, 16 * MEGABYTE]</span><font></font>
<font></font>
<span class="hljs-attribute">for</span> chunksize in CHUNKSIZES:
    <span class="hljs-attribute">nchunks</span> = DATA_SIZE // chunksize
    <span class="hljs-attribute">batch</span> = pa.RecordBatch.from_pandas(generate_data(chunksize, NCOLS))<font></font>
<font></font>
    <span class="hljs-attribute">sink</span> = pa.InMemoryOutputStream()
    <span class="hljs-attribute">stream_writer</span> = pa.StreamWriter(sink, batch.schema)<font></font>
<font></font>
    <span class="hljs-attribute">for</span> i in range(nchunks):
        <span class="hljs-attribute">stream_writer</span>.write_batch(batch)<font></font>
<font></font>
    <span class="hljs-attribute">source</span> = sink.get_result()<font></font>
<font></font>
    <span class="hljs-attribute">elapsed</span> = get_timing(lambda: read_as_dataframe(pa.StreamReader, source), NITER)<font></font>
<font></font>
    <span class="hljs-attribute">result</span> = (chunksize, elapsed)
    <span class="hljs-attribute">print</span>(result)
    <span class="hljs-attribute">results</span>.append(result)</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490034/index.html">Raffeisenbankçš„ML REPAèšä¼šï¼šç»§ç»­å¹¿æ’­</a></li>
<li><a href="../zh-CN490040/index.html">Windowsä¸­ä½¿ç”¨Dockerç®¡ç†çš„Python-Celery</a></li>
<li><a href="../zh-CN490042/index.html">ç§¯ææŠ€æœ¯ç ”ç©¶ï¼š8ä¸ªé‡‘èæœºæ„ä¸­æœ‰7ä¸ªå¯ä»¥ä»Internetè¿›å…¥ç½‘ç»œ</a></li>
<li><a href="../zh-CN490044/index.html">å®¢æˆ·çœ¼ä¸­çš„CRMå®æ–½</a></li>
<li><a href="../zh-CN490046/index.html">NDA for development-â€œå‰©ä½™â€æ¡æ¬¾å’Œå…¶ä»–ä¿æŠ¤è‡ªå·±çš„æ–¹å¼</a></li>
<li><a href="../zh-CN490052/index.html">iOSåº”ç”¨å¯ä»¥ä»è®¾å¤‡çš„å‰ªè´´æ¿å’ŒMacOSå¨èƒç›‘è§†è°ƒæŸ¥ä¸­çªƒå–æ•°æ®</a></li>
<li><a href="../zh-CN490056/index.html">é»‘åŒ£å­ï¼šå¿˜è®°æ—¥å¿—</a></li>
<li><a href="../zh-CN490060/index.html">æœç´¢çŸ¥è¯†å›¾ï¼šä»å¤šä¸ªæ¥æºæ„å»º</a></li>
<li><a href="../zh-CN490066/index.html">ä»ä¸­å›½åˆ°å—æï¼šå…±åŒè§£å†³ä¸­å¾®å­è´¨é‡éš¾é¢˜</a></li>
<li><a href="../zh-CN490068/index.html">é€šè¿‡å¯¹ä¼ªéšæœºåºåˆ—è¿›è¡Œæ’åºæ¥ä¼ªé€ éšæœºæ€§å’Œå˜æ¢</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>