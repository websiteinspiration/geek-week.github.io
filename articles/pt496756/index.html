<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úîÔ∏è üë¥üèæ üõåüèΩ AWS Lambda em a√ß√£o. Parte 2: conhecendo as ferramentas de desenvolvimento e teste üíÜüèª üßñüèΩ üë®üèæ‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este guia √© o resultado da experi√™ncia pessoal no desenvolvimento e teste de aplicativos sem servidor, al√©m de manobras entre muletas e bicicletas ao ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda em a√ß√£o. Parte 2: conhecendo as ferramentas de desenvolvimento e teste</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/496756/"><img src="https://habrastorage.org/webt/7w/hp/bb/7whpbbwttpekzxdq4-7sgs28rio.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este guia √© o resultado da experi√™ncia pessoal no desenvolvimento e teste de aplicativos sem servidor, al√©m de manobras entre muletas e bicicletas ao tentar test√°-los. Quando comecei a desenvolver aplicativos sem servidor, tive que descobrir tudo com minhas m√£os, n√£o havia guias claros ou ferramentas convenientes para desenvolvimento e teste local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora a situa√ß√£o est√° mudando: as ferramentas come√ßaram a aparecer, mas n√£o √© f√°cil encontrar manuais sobre o uso deles. Neste artigo, mostrarei com um exemplo simples como trabalhar com a nova funcionalidade. Voc√™ pode domin√°-lo facilmente e contornar os problemas e bugs que tive a ‚Äúsorte‚Äù de encontrar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ aprender√° como desenvolver usando o console do navegador AWS, SAM-CLI e IntelljIDEA. </font><font style="vertical-align: inherit;">Tamb√©m falarei sobre testes: integra√ß√£o, E2E e testes de unidade. </font><font style="vertical-align: inherit;">E, finalmente, discutiremos quanto custar√° uma solu√ß√£o (spoiler: voc√™ pode economizar muito). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo ser√° √∫til para aqueles que come√ßam a desenvolver aplicativos sem servidor e ainda n√£o est√£o familiarizados com suas ferramentas e abordagens.</font></font><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que ser√° discutido</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√° a todos! </font><font style="vertical-align: inherit;">Meu nome √© Alexander Gruzdev e tenho o prazer de apresentar a segunda parte do artigo sobre o uso e desenvolvimento de solu√ß√µes sem servidor baseadas no AWS Lambda. </font><font style="vertical-align: inherit;">Na sequ√™ncia, falaremos sobre as maneiras de desenvolver e testar a solu√ß√£o desde a primeira parte ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda in Action em Java 11. Visitamos o Serverless em "Produ√ß√£o"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde a publica√ß√£o do √∫ltimo artigo, o aplicativo de teste foi ligeiramente redesenhado, mas o significado principal permanece o mesmo. </font><font style="vertical-align: inherit;">Este √© um formul√°rio HTML trivial "Fale conosco", que envia dados do formul√°rio para a API do Gateway por meio de solicita√ß√µes HTTP e, por sua vez, proxies a solicita√ß√£o de processamento para o AWS Lambda. </font><font style="vertical-align: inherit;">Durante o processamento, o lambda grava dados na tabela do DynamoDB e envia uma carta pelo AWS SES. </font><font style="vertical-align: inherit;">O diagrama do componente √© apresentado abaixo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/zp/wd/aczpwdfofm_vp7xqrjdis2gsblu.png" alt="Diagrama de componentes"><br>
<br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conte√∫do</font></font></h1><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenvolvimento usando o AWS Browser Console</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenvolvimento usando SAM-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenvolvimento usando IntelljIDEA</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipos de teste</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Custos sem servidor</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links √öteis</font></font></a></li>
</ol><br>
<br>
<a name="Part1"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Desenvolvimento usando o console do navegador AWS</font></font></h1><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Console da AWS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O console da AWS fornece acesso a qualquer servi√ßo da AWS, seja seu servidor virtual EC2, IAM ou configura√ß√µes de pol√≠tica de acesso / fun√ß√£o do AWS Lambda com todos os par√¢metros que podem ser alterados em tempo real sem reimplementa√ß√£o pelos sistemas de Entrega Cont√≠nua / Implanta√ß√£o Cont√≠nua. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso acelera bastante o processo de desenvolvimento e alguns tipos de teste. </font><font style="vertical-align: inherit;">Tamb√©m ajuda a controlar visualmente os par√¢metros de inicializa√ß√£o e opera√ß√£o de seus aplicativos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Console do Gateway de API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O console permite monitorar o estado atual do aplicativo, gerenciar seus ambientes e fornecer novas vers√µes. </font><font style="vertical-align: inherit;">Vou mostrar como isso pode ser usado para verificar a sa√∫de do meio ambiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver como esse console "m√°gico" se parece na captura de tela da guia Recursos do aplicativo Fale conosco: </font><font style="vertical-align: inherit;">
A captura de tela mostra como a solicita√ß√£o do cliente atrav√©s da API do Gateway entra no lambda e como a resposta ser√° retornada ao cliente quando o recurso / contact for chamado pelo m√©todo POST.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/f7/fe/s2/f7fes2uz9qxcpj9dqmko6zuxalc.png" alt="Recursos de gateway"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicita√ß√£o de m√©todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a primeira etapa no processamento da solicita√ß√£o. </font><font style="vertical-align: inherit;">No nosso caso, ele n√£o cont√©m nenhuma configura√ß√£o, mas pode conter, por exemplo, configura√ß√µes para autoriza√ß√£o.</font></font><br>
</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicita√ß√£o de integra√ß√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> significa que a solicita√ß√£o HTTP ser√° transmitida ao lambda em um formato especial: cont√©m todas as informa√ß√µes enviadas pelo cliente e detalhes sobre o contexto chamado.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A resposta de integra√ß√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diz que o cliente HTTP receber√° a resposta diretamente do lambda. </font><font style="vertical-align: inherit;">Portanto, voc√™ mesmo √© respons√°vel pela forma√ß√£o do corpo de resposta em lambda.</font></font></li>
</ul><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desativar integra√ß√£o de proxy</font></font></b>
                        <div class="spoiler_text">     API Gateway  ,    <i>Use Lambda Proxy integration</i>   <i>Integration Request</i>.          . ,          ,     .<br>
<br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amostra de solicita√ß√£o de integra√ß√£o</font></font></b>
                        <div class="spoiler_text">    SAM init      <i>events</i>,     ,      <i>Integration request</i>.    ,   AWS    ,     .         AWS Lambda.<br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pressione o bot√£o TESTE para verificar se o aplicativo est√° funcionando. </font><font style="vertical-align: inherit;">Isso lhe dar√° acesso √†s chamadas da API do Gateway HTTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na captura de tela a seguir, enviei uma solicita√ß√£o para aquecer o lambda: </font><font style="vertical-align: inherit;">
Al√©m de responder √† solicita√ß√£o, a API do Gateway exibe logs detalhados. </font><font style="vertical-align: inherit;">Da mesma forma, voc√™ pode fazer uma solicita√ß√£o real substituindo o corpo da solicita√ß√£o JSON no formato:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ia/kf/ga/iakfgafb8t4-9aocr5o-e5dspy0.png" alt="Solicita√ß√£o de teste do gateway"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<pre><code class="javascript hljs">{
    <span class="hljs-string">"subject"</span>: <span class="hljs-string">"Email subject"</span>,
    <span class="hljs-string">"question"</span>: <span class="hljs-string">"Your question‚Ä¶"</span>,
    <span class="hljs-string">"username"</span>: <span class="hljs-string">"Your name‚Ä¶"</span>,
    <span class="hljs-string">"phone"</span>: <span class="hljs-string">"Your phone‚Ä¶"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"Your email‚Ä¶"</span><font></font>
} <font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, voc√™ pode testar manualmente sua API sem formul√°rios de interface do usu√°rio e aplicativos de front-end, separando assim o desenvolvimento de front-end e back-end. </font><font style="vertical-align: inherit;">Como alternativa ao console interno, voc√™ pode usar o Postman ou qualquer outro cliente HTTP.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carteiro como alternativa</font></font></b>
                        <div class="spoiler_text">   HTTP-     Postman.         .   ,   API Gateway       AWS ,              API. ,  ,       AWS .<br>
</div>
                    </div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lambda Console</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para teste e desenvolvimento, al√©m das solicita√ß√µes da API do Gateway, voc√™ pode usar o console do navegador AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sua tela √© dividida em v√°rios blocos:</font></font><br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Designer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mostra gatilhos e camadas existentes. </font><font style="vertical-align: inherit;">No nosso caso, o gatilho √© o API Gateway. </font><font style="vertical-align: inherit;">Se clicarmos nele, todas as informa√ß√µes necess√°rias ser√£o abertas: URL, est√°gio, caminho do recurso.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aliases</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dispon√≠veis ao selecionar um alias lambda espec√≠fico) permite configurar a distribui√ß√£o do tr√°fego por vers√£o do lambda. </font><font style="vertical-align: inherit;">Mais sobre isso no pr√≥ximo par√°grafo.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/hs/3s/b8/hs3sb8_jvymnm4bnmtn1yvgcamg.png"></a></li>
<li><i>Function code</i> ‚Äî        .      zip-  ,    .       ,   Function code      .         Python/NodeJs. <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/1l/p1/0y/1lp10yo_zd7tcbcr7cyu-dyxtlw.png"></a></li>
<li><i>Environment variables.</i> ,      .  ,        ,     .    ,         . ,    ,        .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/hx/sg/z_/hxsgz_-adludvt4phrfgebnjqa4.png"></a></li>
<li><i>Tags</i> ‚Äî  ,       , ,    ,    .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/qm/za/bt/qmzabtb2nt-yo9tedqlxluhop8e.png"></a></li>
<li><i>Execution role</i> ‚Äî      (   ) ,      .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/bf/rk/3s/bfrk3sw8ig7rseuhnwr4mr8o8-c.png"></a></li>
<li><i>Basic settings</i> ‚Äî         .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ds/lr/cj/dslrcjorhygk_bmfzlxp5ddxqz0.png"></a></li>
<li><i>Network</i>:      -  ,          VPC.    ‚Äî   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  .</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/-i/lz/hm/-ilzhms_ty6b7i7pex7pc1dbcbw.png"></a></li>
<li><i>AWS X-Ray</i>   .           AWS-. <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/pj/l6/qz/pjl6qzbt3133iqwonql03wd96qs.png"></a></li>
<li><i> Reserve concurrency</i>     ,                  .          .<br>
   Provisioned concurrency</li>
<li><i>Provisioned concurrency</i> ‚Äî    .       ,          .     ,     ‚Äî    .          Free Tier .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/mb/gt/sq/mbgtsqv1iueoy6js88rv4rusi7s.png"></a></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A chamada ass√≠ncrona</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permite configurar o tratamento especial de solicita√ß√µes ass√≠ncronas. </font><font style="vertical-align: inherit;">Indicamos quantas chamadas repetidas devem ser feitas em caso de erro e por quanto tempo a solicita√ß√£o pode travar na fila. </font><font style="vertical-align: inherit;">Opcionalmente, voc√™ pode especificar uma fila para processar solicita√ß√µes que falham.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/fp/g_/zi/fpg_ziuv-ouv4yeeejmxqlko-za.png"></a><br>
</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxies do banco de dados</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© outro novo recurso que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite configurar o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acesso ao banco de dados por meio de proxies na forma de API Gateway + Lambda.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/bp/f4/fw/bpf4fw1yjd0ayzsolj0vbhnjrfs.png"></a></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, vamos ver como desenvolver a partir deste console. </font><font style="vertical-align: inherit;">Al√©m de alterar os par√¢metros, a funcionalidade </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar Eventos de Teste</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser usada para criar uma solicita√ß√£o de teste. </font><font style="vertical-align: inherit;">Uma lista bastante extensa est√° dispon√≠vel, mas aproveitaremos o que j√° anexei no projeto:</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pedido de ContactUs</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs">{
  <span class="hljs-string">"body"</span>: <span class="hljs-string">"{\"subject\": \"Question\",\"question\": \"How much does it cost\",\"username\": \"Alex\",\"phone\": \"+79999999999\",\"email\": \"alex@gmail.com\"}"</span>,
  <span class="hljs-string">"resource"</span>: <span class="hljs-string">"/{proxy+}"</span>,
  <span class="hljs-string">"path"</span>: <span class="hljs-string">"/path/to/resource"</span>,
  <span class="hljs-string">"httpMethod"</span>: <span class="hljs-string">"POST"</span>,
  <span class="hljs-string">"isBase64Encoded"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"queryStringParameters"</span>: {
    <span class="hljs-string">"foo"</span>: <span class="hljs-string">"bar"</span><font></font>
  },<font></font>
  <span class="hljs-string">"pathParameters"</span>: {
    <span class="hljs-string">"proxy"</span>: <span class="hljs-string">"/path/to/resource"</span><font></font>
  },<font></font>
  <span class="hljs-string">"stageVariables"</span>: {
    <span class="hljs-string">"baz"</span>: <span class="hljs-string">"qux"</span><font></font>
  },<font></font>
  <span class="hljs-string">"headers"</span>: {
    <span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span>,
    <span class="hljs-string">"Accept-Encoding"</span>: <span class="hljs-string">"gzip, deflate, sdch"</span>,
    <span class="hljs-string">"Accept-Language"</span>: <span class="hljs-string">"en-US,en;q=0.8"</span>,
    <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"max-age=0"</span>,
    <span class="hljs-string">"CloudFront-Forwarded-Proto"</span>: <span class="hljs-string">"https"</span>,
    <span class="hljs-string">"CloudFront-Is-Desktop-Viewer"</span>: <span class="hljs-string">"true"</span>,
    <span class="hljs-string">"CloudFront-Is-Mobile-Viewer"</span>: <span class="hljs-string">"false"</span>,
    <span class="hljs-string">"CloudFront-Is-SmartTV-Viewer"</span>: <span class="hljs-string">"false"</span>,
    <span class="hljs-string">"CloudFront-Is-Tablet-Viewer"</span>: <span class="hljs-string">"false"</span>,
    <span class="hljs-string">"CloudFront-Viewer-Country"</span>: <span class="hljs-string">"US"</span>,
    <span class="hljs-string">"Host"</span>: <span class="hljs-string">"1234567890.execute-api.us-east-1.amazonaws.com"</span>,
    <span class="hljs-string">"Upgrade-Insecure-Requests"</span>: <span class="hljs-string">"1"</span>,
    <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Custom User Agent String"</span>,
    <span class="hljs-string">"Via"</span>: <span class="hljs-string">"1.1 08f323deadbeefa7af34d5feb414ce27.cloudfront.net (CloudFront)"</span>,
    <span class="hljs-string">"X-Amz-Cf-Id"</span>: <span class="hljs-string">"cDehVQoZnx43VYQb9j2-nvCh-9z396Uhbp027Y2JvkCPNLmGJHqlaA=="</span>,
    <span class="hljs-string">"X-Forwarded-For"</span>: <span class="hljs-string">"127.0.0.1, 127.0.0.2"</span>,
    <span class="hljs-string">"X-Forwarded-Port"</span>: <span class="hljs-string">"443"</span>,
    <span class="hljs-string">"X-Forwarded-Proto"</span>: <span class="hljs-string">"https"</span><font></font>
  },<font></font>
  <span class="hljs-string">"requestContext"</span>: {
    <span class="hljs-string">"accountId"</span>: <span class="hljs-string">"123456789012"</span>,
    <span class="hljs-string">"resourceId"</span>: <span class="hljs-string">"123456"</span>,
    <span class="hljs-string">"stage"</span>: <span class="hljs-string">"prod"</span>,
    <span class="hljs-string">"requestId"</span>: <span class="hljs-string">"c6af9ac6-7b61-11e6-9a41-93e8deadbeef"</span>,
    <span class="hljs-string">"requestTime"</span>: <span class="hljs-string">"09/Apr/2015:12:34:56 +0000"</span>,
    <span class="hljs-string">"requestTimeEpoch"</span>: <span class="hljs-number">1428582896000</span>,
    <span class="hljs-string">"identity"</span>: {
      <span class="hljs-string">"cognitoIdentityPoolId"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"accountId"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"cognitoIdentityId"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"caller"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"accessKey"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"sourceIp"</span>: <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"cognitoAuthenticationType"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"cognitoAuthenticationProvider"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"userArn"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"userAgent"</span>: <span class="hljs-string">"Custom User Agent String"</span>,
      <span class="hljs-string">"user"</span>: <span class="hljs-literal">null</span><font></font>
    },<font></font>
    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/prod/path/to/resource"</span>,
    <span class="hljs-string">"resourcePath"</span>: <span class="hljs-string">"/{proxy+}"</span>,
    <span class="hljs-string">"httpMethod"</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-string">"apiId"</span>: <span class="hljs-string">"1234567890"</span>,
    <span class="hljs-string">"protocol"</span>: <span class="hljs-string">"HTTP/1.1"</span><font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s incluir a solicita√ß√£o, clique em </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e veja o resultado do lambda: </font><font style="vertical-align: inherit;">
Lambda retorna JSON, que cont√©m o c√≥digo de status e o corpo da resposta. </font><font style="vertical-align: inherit;">O valor do corpo ir√° diretamente para o cliente que chamou a API do Gateway. </font><font style="vertical-align: inherit;">Al√©m disso, a captura de tela possui as caracter√≠sticas da chamada: o tempo de execu√ß√£o, o tempo de execu√ß√£o pelo qual pagaremos, a quantidade m√°xima de mem√≥ria que o lambda consumiu. </font><font style="vertical-align: inherit;">Contando com essas m√©tricas, podemos configurar a quantidade ideal de mem√≥ria para que o lambda corresponda aos seus requisitos de pre√ßo / taxa de resposta.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/oc/vw/w1/ocvww1tut1fhx0czz5ijzjnpvhg.png" alt="Recursos de gateway"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando o console da AWS para testar a implanta√ß√£o de can√°rias</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, vamos tocar em um ponto importante relacionado √† implanta√ß√£o de uma nova vers√£o do lambda. </font><font style="vertical-align: inherit;">Especifiquei esses par√¢metros quando escrevi o modelo SAM:</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro par√¢metro adiciona automaticamente um alias </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ativo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a cada nova vers√£o do lambda </font><font style="vertical-align: inherit;">.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre aliases</font></font></b>
                        <div class="spoiler_text">     ,   .    ,         ,       API Gateway.      1, 2, 3   .    <i>LATEST</i>,     .     2  3   API Gateway (Stage   AWS),          Gateway-Lambda.  API Gateway      (ARN ),      <i>LATEST</i>. <br>
 <br>
 ‚Äî    (  ), ,      ,    ARN .      ,         Stage  API Gateway      .  ,    API Gateway: dev, qa  prod       .<br>
<br>
         ,    ,      .       ,        .  , live,    .    live-    , , ,    ,       CloudWatch.<br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para testar a implanta√ß√£o do canary, voc√™ pode usar o console da API do Gateway e o console do Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, voc√™ precisa alterar o c√≥digo lambda para que ele retorne uma resposta diferente. </font><font style="vertical-align: inherit;">Por exemplo, no processo de aquecimento, especifique a Vers√£o 2 em vez da Vers√£o 1. Na resposta, este ser√° o nosso marcador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, usando a funcionalidade da API do Teste de Gateway, podemos garantir que, dentro de dez minutos, ao enviar solicita√ß√µes de AQUECIMENTO, apenas 10% das respostas ter√£o a Vers√£o 2 no corpo da resposta. </font><font style="vertical-align: inherit;">Ap√≥s esse per√≠odo, a vers√£o 2. retornar√° 100% das solicita√ß√µes.Al√©m </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
do console da API do Gateway, podemos usar o console Lambda, onde, ap√≥s selecionar o alias necess√°rio, vemos uma pol√≠tica de distribui√ß√£o de tr√°fego que pode ser controlada.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/hs/3s/b8/hs3sb8_jvymnm4bnmtn1yvgcamg.png" alt="Alias ‚Äã‚Äãdo Lambda"></a><br>
<br>
<br>
<a name="Part2"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Desenvolvimento local usando SAM-CLI</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° algum tempo, uma das principais desvantagens do uso do lambda era considerada inconveniente no desenvolvimento e teste na m√°quina local. Agora a situa√ß√£o mudou bastante: a estrutura SAM apareceu, o que permite n√£o apenas coletar e implantar solu√ß√µes, mas tamb√©m simplifica o desenvolvimento local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, voc√™ pode chamar seu lambda diretamente do console:</font></font><br>
<pre><code class="bash hljs">sam <span class="hljs-built_in">local</span> invoke -e ./events/warm_up_request.json ContactUsFunction
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comando √© ativado a partir do diret√≥rio com o modelo SAM e transfere o conte√∫do do arquivo JSON para a entrada lambda ContactUsFunction (este √© o nome l√≥gico no modelo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, usando este comando, o SAM gera a imagem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lambci / lambda: java11</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na janela de encaixe </font><font style="vertical-align: inherit;">e executa seu c√≥digo nela. </font><font style="vertical-align: inherit;">Para acessar servi√ßos remotos, como o SES, sua configura√ß√£o da AWS com uma chave de segredo / acesso √© usada e, portanto, deve estar atualizada. </font><font style="vertical-align: inherit;">Outro ponto importante: se voc√™ n√£o adicionar um cabe√ßalho para o modo de aquecimento, os servi√ßos reais do AWS SES e DynamoDB ser√£o chamados.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registro de chamadas aqui</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam <span class="hljs-built_in">local</span> invoke -e ./events/warm_up_request.json ContactUsFunction<font></font>
Invoking com.gralll.sam.App::handleRequest (java11)<font></font>
Fetching lambci/lambda:java11 Docker container image......<font></font>
Mounting F:\aws\projects\contact-us-sam-app\.aws-sam\build\ContactUsFunction as /var/task:ro,delegated inside runtime container<font></font>
?[32mSTART RequestId: a86d65fa-1f19-15c5-93b8-d87631c80ee2 Version: <span class="hljs-variable">$LATEST</span>?[0m<font></font>
2020-01-06 19:09:17 a86d65fa-1f19-15c5-93b8-d87631c80ee2 INFO  App - Request was received<font></font>
2020-01-06 19:09:17 a86d65fa-1f19-15c5-93b8-d87631c80ee2 DEBUG App - {<font></font>
  <span class="hljs-string">"body"</span> : <span class="hljs-string">"{\"subject\": \"Question\",\"question\": \"How much does it cost\",\"username\": \"Alex\",\"phone\": \"+79999999999\",\"email\": \"alex@gmail.com\"}"</span>,
  <span class="hljs-string">"resource"</span> : <span class="hljs-string">"/{proxy+}"</span>,
  <span class="hljs-string">"requestContext"</span> : {
    <span class="hljs-string">"resourceId"</span> : <span class="hljs-string">"123456"</span>,
    <span class="hljs-string">"apiId"</span> : <span class="hljs-string">"1234567890"</span>,
    <span class="hljs-string">"resourcePath"</span> : <span class="hljs-string">"/{proxy+}"</span>,
    <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
    <span class="hljs-string">"requestId"</span> : <span class="hljs-string">"c6af9ac6-7b61-11e6-9a41-93e8deadbeef"</span>,
    <span class="hljs-string">"extendedRequestId"</span> : null,
    <span class="hljs-string">"accountId"</span> : <span class="hljs-string">"123456789012"</span>,
    <span class="hljs-string">"identity"</span> : {
      <span class="hljs-string">"apiKey"</span> : null,
      <span class="hljs-string">"apiKeyId"</span> : null,
      <span class="hljs-string">"userArn"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationType"</span> : null,
      <span class="hljs-string">"caller"</span> : null,
      <span class="hljs-string">"userAgent"</span> : <span class="hljs-string">"Custom User Agent String"</span>,
      <span class="hljs-string">"user"</span> : null,
      <span class="hljs-string">"cognitoIdentityPoolId"</span> : null,
      <span class="hljs-string">"cognitoIdentityId"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationProvider"</span> : null,
      <span class="hljs-string">"sourceIp"</span> : <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"accountId"</span> : null,
      <span class="hljs-string">"accessKey"</span> : null<font></font>
    },<font></font>
    <span class="hljs-string">"authorizer"</span> : null,
    <span class="hljs-string">"stage"</span> : <span class="hljs-string">"prod"</span>,
    <span class="hljs-string">"path"</span> : <span class="hljs-string">"/prod/path/to/resource"</span>,
    <span class="hljs-string">"protocol"</span> : <span class="hljs-string">"HTTP/1.1"</span>,
    <span class="hljs-string">"requestTime"</span> : <span class="hljs-string">"09/Apr/2015:12:34:56 +0000"</span>,
    <span class="hljs-string">"requestTimeEpoch"</span> : 1428582896000,
    <span class="hljs-string">"elb"</span> : null<font></font>
  },<font></font>
  <span class="hljs-string">"multiValueQueryStringParameters"</span> : { },
  <span class="hljs-string">"multiValueHeaders"</span> : {
    <span class="hljs-string">"X-WARM-UP"</span> : [ <span class="hljs-string">"13"</span> ]<font></font>
  },<font></font>
  <span class="hljs-string">"pathParameters"</span> : {
    <span class="hljs-string">"proxy"</span> : <span class="hljs-string">"/path/to/resource"</span><font></font>
  },<font></font>
  <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
  <span class="hljs-string">"stageVariables"</span> : {
    <span class="hljs-string">"baz"</span> : <span class="hljs-string">"qux"</span><font></font>
  },<font></font>
  <span class="hljs-string">"path"</span> : <span class="hljs-string">"/path/to/resource"</span>,
  <span class="hljs-string">"isBase64Encoded"</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">"requestSource"</span> : <span class="hljs-string">"API_GATEWAY"</span><font></font>
}<font></font>
2020-01-06 19:09:17 a86d65fa-1f19-15c5-93b8-d87631c80ee2 INFO  App - Lambda was warmed up<font></font>
?[32mEND RequestId: a86d65fa-1f19-15c5-93b8-d87631c80ee2?[0m<font></font>
?[32mREPORT RequestId: a86d65fa-1f19-15c5-93b8-d87631c80ee2     Init Duration: 1984.55 ms       Duration: 42.22 ms      Billed Duration: 100 ms Memory Size: 256 MB     Max Memory Used: 102 MB ?[0m<font></font>
{<span class="hljs-string">"statusCode"</span>:201,<span class="hljs-string">"multiValueHeaders"</span>:{<span class="hljs-string">"Access-Control-Allow-Origin"</span>:[<span class="hljs-string">"*"</span>]},<span class="hljs-string">"body"</span>:{<span class="hljs-string">"response"</span>:<span class="hljs-string">"Lambda was warmed up. V1"</span>},<span class="hljs-string">"isBase64Encoded"</span>:<span class="hljs-literal">false</span>}
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do log lambda, as informa√ß√µes de servi√ßo no status da chamada e uma resposta no formato JSON s√£o gravadas no console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A API do Gateway, como a lambda, pode ser executada localmente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s executamos o comando:</font></font><br>
<pre><code class="bash hljs">sam <span class="hljs-built_in">local</span> start-api
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Log do console na inicializa√ß√£o</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam <span class="hljs-built_in">local</span> start-api<font></font>
Mounting ContactUsFunction at http://127.0.0.1:3000/contact [POST, OPTIONS]<font></font>
You can now browse to the above endpoints to invoke your <span class="hljs-built_in">functions</span>. You <span class="hljs-keyword">do</span> not need to restart/reload SAM CLI <span class="hljs-keyword">while</span> working on your <span class="hljs-built_in">functions</span>, changes will be reflected instantly/automatically. You only need to restart SAM CLI <span class="hljs-keyword">if</span> you update your AWS SAM template<font></font>
2020-01-06 22:20:30  * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit)<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de iniciar o servidor, podemos executar solicita√ß√µes. </font><font style="vertical-align: inherit;">Vou usar o Postman e enviar uma solicita√ß√£o para aquecer o lambda.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/_e/hg/vs/_ehgvsftbjygwjcu3iiol-vky68.png"></a><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No console, vemos</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">Invoking com.gralll.sam.App::handleRequest (java11)<font></font>
Fetching lambci/lambda:java11 Docker container image......<font></font>
Mounting F:\aws\projects\contact-us-sam-app\.aws-sam\build\ContactUsFunction as /var/task:ro,delegated inside runtime container<font></font>
?[32mSTART RequestId: 27868750-3637-1f80-3d80-53a724da16ef Version: <span class="hljs-variable">$LATEST</span>?[0m<font></font>
2020-01-06 19:28:09 27868750-3637-1f80-3d80-53a724da16ef INFO  App - Request was received<font></font>
2020-01-06 19:28:09 27868750-3637-1f80-3d80-53a724da16ef DEBUG App - {<font></font>
  <span class="hljs-string">"body"</span> : <span class="hljs-string">"{\r\n  \"subject\": \"Question\",\r\n  \"question\": \"How much does it cost\",\r\n  \"username\": \"Alex\",\r\n  \"phone\": \"+79999999999\",\r\n  \"email\": \"alex@gmail.com\"\r\n}"</span>,
  <span class="hljs-string">"resource"</span> : <span class="hljs-string">"/contact"</span>,
  <span class="hljs-string">"requestContext"</span> : {
    <span class="hljs-string">"resourceId"</span> : <span class="hljs-string">"123456"</span>,
    <span class="hljs-string">"apiId"</span> : <span class="hljs-string">"1234567890"</span>,
    <span class="hljs-string">"resourcePath"</span> : <span class="hljs-string">"/contact"</span>,
    <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
    <span class="hljs-string">"requestId"</span> : <span class="hljs-string">"c6af9ac6-7b61-11e6-9a41-93e8deadbeef"</span>,
    <span class="hljs-string">"extendedRequestId"</span> : null,
    <span class="hljs-string">"accountId"</span> : <span class="hljs-string">"123456789012"</span>,
    <span class="hljs-string">"identity"</span> : {
      <span class="hljs-string">"apiKey"</span> : null,
      <span class="hljs-string">"apiKeyId"</span> : null,
      <span class="hljs-string">"userArn"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationType"</span> : null,
      <span class="hljs-string">"caller"</span> : null,
      <span class="hljs-string">"userAgent"</span> : <span class="hljs-string">"Custom User Agent String"</span>,
      <span class="hljs-string">"user"</span> : null,
      <span class="hljs-string">"cognitoIdentityPoolId"</span> : null,
      <span class="hljs-string">"cognitoIdentityId"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationProvider"</span> : null,
      <span class="hljs-string">"sourceIp"</span> : <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"accountId"</span> : null,
      <span class="hljs-string">"accessKey"</span> : null<font></font>
    },<font></font>
    <span class="hljs-string">"authorizer"</span> : null,
    <span class="hljs-string">"stage"</span> : <span class="hljs-string">"Prod"</span>,
    <span class="hljs-string">"path"</span> : <span class="hljs-string">"/contact"</span>,
    <span class="hljs-string">"protocol"</span> : null,
    <span class="hljs-string">"requestTime"</span> : null,
    <span class="hljs-string">"requestTimeEpoch"</span> : 0,
    <span class="hljs-string">"elb"</span> : null<font></font>
  },<font></font>
  <span class="hljs-string">"multiValueQueryStringParameters"</span> : null,
  <span class="hljs-string">"multiValueHeaders"</span> : {
    <span class="hljs-string">"Accept"</span> : [ <span class="hljs-string">"application/json"</span> ],
    <span class="hljs-string">"Accept-Encoding"</span> : [ <span class="hljs-string">"gzip, deflate, br"</span> ],
    <span class="hljs-string">"Accept-Language"</span> : [ <span class="hljs-string">"ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7"</span> ],
    <span class="hljs-string">"Cache-Control"</span> : [ <span class="hljs-string">"no-cache"</span> ],
    <span class="hljs-string">"Connection"</span> : [ <span class="hljs-string">"keep-alive"</span> ],
    <span class="hljs-string">"Content-Length"</span> : [ <span class="hljs-string">"150"</span> ],
    <span class="hljs-string">"Content-Type"</span> : [ <span class="hljs-string">"text/plain;charset=UTF-8"</span> ],
    <span class="hljs-string">"Host"</span> : [ <span class="hljs-string">"127.0.0.1:3000"</span> ],
    <span class="hljs-string">"Origin"</span> : [ <span class="hljs-string">"chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop"</span> ],
    <span class="hljs-string">"Postman-Token"</span> : [ <span class="hljs-string">"5cadaccd-6fae-5bc2-b4ef-63900a1725ff"</span> ],
    <span class="hljs-string">"Sec-Fetch-Mode"</span> : [ <span class="hljs-string">"cors"</span> ],
    <span class="hljs-string">"Sec-Fetch-Site"</span> : [ <span class="hljs-string">"cross-site"</span> ],
    <span class="hljs-string">"User-Agent"</span> : [ <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"</span> ],
    <span class="hljs-string">"X-Forwarded-Port"</span> : [ <span class="hljs-string">"3000"</span> ],
    <span class="hljs-string">"X-Forwarded-Proto"</span> : [ <span class="hljs-string">"http"</span> ],
    <span class="hljs-string">"X-Warm-Up"</span> : [ <span class="hljs-string">"123"</span> ]<font></font>
  },<font></font>
  <span class="hljs-string">"pathParameters"</span> : null,
  <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
  <span class="hljs-string">"stageVariables"</span> : null,
  <span class="hljs-string">"path"</span> : <span class="hljs-string">"/contact"</span>,
  <span class="hljs-string">"isBase64Encoded"</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">"requestSource"</span> : <span class="hljs-string">"API_GATEWAY"</span><font></font>
}<font></font>
2020-01-06 19:28:09 27868750-3637-1f80-3d80-53a724da16ef INFO  App - Lambda was warmed up<font></font>
?[32mEND RequestId: 27868750-3637-1f80-3d80-53a724da16ef?[0m<font></font>
?[32mREPORT RequestId: 27868750-3637-1f80-3d80-53a724da16ef     Init Duration: 1951.87 ms       Duration: 42.91 ms      Billed Duration: 100 ms Memory Size: 256 MB     Max Memory Used: 102 MB ?[0m<font></font>
2020-01-06 22:28:11 127.0.0.1 - - [06/Jan/2020 22:28:11] <span class="hljs-string">"POST /contact HTTP/1.1"</span> 201 -
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logs, √© claro, n√£o s√£o formatados da melhor maneira. </font><font style="vertical-align: inherit;">Espero que isso seja corrigido no futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Importante: ao alterar o c√≥digo lambda, n√£o √© necess√°rio reiniciar a API. </font><font style="vertical-align: inherit;">√â suficiente reconstruir o lambda com o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando sam build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre bugs</font></font></b>
                        <div class="spoiler_text">        Java-  <i>aws-serverless-java-container-core</i>,    :       502 .    :<br>
<pre><code class="bash hljs">Invalid API Gateway Response Keys: {<span class="hljs-string">'base64Encoded'</span>} <span class="hljs-keyword">in</span> {<span class="hljs-string">'statusCode'</span>: 200, <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span>}, <span class="hljs-string">'body'</span>: <span class="hljs-string">'Hello World'</span>, <span class="hljs-string">'base64Encoded'</span>: False} 
</code></pre><br>
  - ,   API Gateway    AWS       JsonProperty.     <i>'isBase64Encoded'</i>   <i>'base64Encoded'</i>, , ,    .   ,       Java- ContactUsProxyResponse  AwsProxyRequest.<br>
</div>
                    </div><br>
<br>
<a name="Part3"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Chamadas locais da IDEA</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo descrito no par√°grafo acima √© a funcionalidade da ferramenta SAM. √â controlado a partir da linha de comando e pode ser integrado a qualquer interface. Foi exatamente isso que foi feito no plug-in do IntelljIDEA AWS Toolkit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este plug-in adiciona configura√ß√µes adicionais para iniciar um lambda diretamente do IDE. √â assim que a janela de configura√ß√£o se parece. </font><font style="vertical-align: inherit;">
Voc√™ deve selecionar um modelo com uma descri√ß√£o do lambda ou definir as configura√ß√µes manualmente. </font><font style="vertical-align: inherit;">
No primeiro caso, a quantidade de mem√≥ria e idioma para compila√ß√£o ser√° obtida automaticamente do modelo. No segundo caso, voc√™ pode configurar a quantidade de RAM e fazer um c√°lculo aproximado do limite. </font><font style="vertical-align: inherit;">
Outro plug-in permite executar a configura√ß√£o diretamente da janela do editor de c√≥digo Java ou do yaml-template. Imagens abaixo:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/2s/8u/xk/2s8uxk8n8gfza3p9z9ewugw-xge.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/8o/um/83/8oum83fe_tkz8suqmxzg-evjpaa.png"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/iw/ma/is/iwmais_steqx3sfhwstdxk7ncwa.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso, de fato, √© tudo. </font><font style="vertical-align: inherit;">Ao executar a configura√ß√£o customizada, voc√™ simplesmente automatiza chamadas lambda frequentes no console. </font><font style="vertical-align: inherit;">Concorda, bastante confort√°vel?</font></font><br>
<br>
<a name="Part4"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Teste</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui falamos sobre os tipos de testes para lambdas. </font><font style="vertical-align: inherit;">Como usei Java no exemplo, os testes tamb√©m incluir√£o ferramentas bastante padr√£o para testes de unidade e integra√ß√£o: Junit 4, Mockito e PowerMockito.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes unit√°rios</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cobrir o c√≥digo lambda com testes de unidade, voc√™ n√£o precisa ter conhecimentos espec√≠ficos. </font><font style="vertical-align: inherit;">√â suficiente aplicar pr√°ticas Java padr√£o: bloqueie todas as depend√™ncias da classe e tente testar todos os casos poss√≠veis de processamento de solicita√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o adicionei todos os cen√°rios de teste e me limitei a dois cen√°rios positivos e dois negativos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro teste positivo verifica se, se houver um cabe√ßalho X-WARM-UP, n√£o haver√° solicita√ß√µes no DbService e no EmailService. </font><font style="vertical-align: inherit;">O segundo caso verifica se esses servi√ßos ser√£o chamados se a solicita√ß√£o for real. </font><font style="vertical-align: inherit;">Estes s√£o os testes mais simples, e eu omiti parte dos cheques neles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cen√°rios negativos s√£o uma verifica√ß√£o de resposta no caso de um erro de processamento do cliente ou servidor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes de integra√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto aos testes de integra√ß√£o, decidi verificar o DbService e seu trabalho com a tabela DynamoDB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, usei a ferramenta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Localstack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta solu√ß√£o fornece mokas gratuitos para servi√ßos da AWS que s√£o executados como cont√™ineres de docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para instalar esta solu√ß√£o, basta executar os comandos:</font></font><br>
<pre><code class="bash hljs">pip install localstack<font></font>
localstack start<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou voc√™ pode usar o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo docker-compose</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-compor para elevar apenas o DynamoDB</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">version: <span class="hljs-string">'2.1'</span><font></font>
services:<font></font>
  localstack:<font></font>
    container_name: <span class="hljs-string">"<span class="hljs-variable">${LOCALSTACK_DOCKER_NAME-localstack_main}</span>"</span><font></font>
    image: localstack/localstack<font></font>
    ports:<font></font>
      - <span class="hljs-string">"4567-4599:4567-4599"</span>
      - <span class="hljs-string">"<span class="hljs-variable">${PORT_WEB_UI-8080}</span>:<span class="hljs-variable">${PORT_WEB_UI-8080}</span>"</span><font></font>
    environment:<font></font>
      - SERVICES=dynamodb<font></font>
      - DEBUG=<span class="hljs-variable">${DEBUG- }</span>
      - DATA_DIR=<span class="hljs-variable">${DATA_DIR- }</span>
      - PORT_WEB_UI=<span class="hljs-variable">${PORT_WEB_UI- }</span>
      - LAMBDA_EXECUTOR=<span class="hljs-variable">${LAMBDA_EXECUTOR- }</span>
      - KINESIS_ERROR_PROBABILITY=<span class="hljs-variable">${KINESIS_ERROR_PROBABILITY- }</span><font></font>
      - DOCKER_HOST=unix:///var/run/docker.sock<font></font>
    volumes:<font></font>
      - <span class="hljs-string">"<span class="hljs-variable">${TMPDIR:-/tmp/localstack}</span>:/tmp/localstack"</span>
      - <span class="hljs-string">"/var/run/docker.sock:/var/run/docker.sock"</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O comando start gera todos os servi√ßos da AWS dispon√≠veis por padr√£o. </font><font style="vertical-align: inherit;">Para aumentar o DynamoDB especificamente, basta definir a vari√°vel de ambiente:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-built_in">set</span> SERVICES=dynamodb
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LocalstackTestRunner for Junit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especial </font><font style="vertical-align: inherit;">que permite iniciar os servi√ßos necess√°rios usando a configura√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@LocalstackDockerProperties</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, escrever um teste para o DbService se parece com o seguinte:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione sobre a classe de teste. </font></font><br>
<pre><code class="java hljs"><span class="hljs-meta">@RunWith(LocalstackTestRunner.class)</span>
<span class="hljs-meta">@LocalstackDockerProperties(services = { "dynamodb" })</span>
</code></pre> <br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie uma tabela </font></font><br>
 <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></b>
                        <div class="spoiler_text"> <pre><code class="java hljs"><span class="hljs-meta">@Before</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{<font></font>
    AmazonDynamoDB clientDynamoDB = TestUtils.getClientDynamoDB();<font></font>
    dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(clientDynamoDB);<font></font>
    dbService = <span class="hljs-keyword">new</span> DbService(dynamoDB);<font></font>
<font></font>
    dynamoDB.createTable(<font></font>
            <span class="hljs-keyword">new</span> CreateTableRequest()<font></font>
                    .withTableName(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                    .withKeySchema(<span class="hljs-keyword">new</span> KeySchemaElement(<span class="hljs-string">"Id"</span>, KeyType.HASH))<font></font>
                    .withAttributeDefinitions(<span class="hljs-keyword">new</span> AttributeDefinition(<span class="hljs-string">"Id"</span>, ScalarAttributeType.S))<font></font>
                    .withProvisionedThroughput(<span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">10L</span>, <span class="hljs-number">10L</span>)));<font></font>
}<font></font>
                </code></pre><br>
 </div>
                    </div><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s descrevemos o cen√°rio de teste</font></font><br>
 <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></b>
                        <div class="spoiler_text"> <pre><code class="java hljs"><span class="hljs-comment">// given</span>
ContactUsRequest contactUsRequest = <span class="hljs-keyword">new</span> ContactUsRequest(<span class="hljs-string">"subject"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"+79991234545"</span>, <span class="hljs-string">"123@mail.ru"</span>, <span class="hljs-string">"Qeustion"</span>);<font></font>
<font></font>
<span class="hljs-comment">// when</span>
dbService.putContactUsRequest(<span class="hljs-string">"123"</span>, contactUsRequest);<font></font>
<font></font>
<span class="hljs-comment">// then</span>
Item item = dynamoDB.getTable(<span class="hljs-string">"ContactUsTable"</span>).getItem(<span class="hljs-keyword">new</span> PrimaryKey(<span class="hljs-string">"Id"</span>, <span class="hljs-string">"123"</span>));<font></font>
assertEquals(contactUsRequest.getSubject(), item.get(<span class="hljs-string">"Subject"</span>));<font></font>
assertEquals(contactUsRequest.getUsername(), item.get(<span class="hljs-string">"Username"</span>));<font></font>
assertEquals(contactUsRequest.getPhone(), item.get(<span class="hljs-string">"Phone"</span>));<font></font>
assertEquals(contactUsRequest.getEmail(), item.get(<span class="hljs-string">"Email"</span>));<font></font>
assertEquals(contactUsRequest.getQuestion(), item.get(<span class="hljs-string">"Question"</span>));
              </code></pre><br>
 </div>
                    </div><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o se esque√ßa de excluir a tabela ap√≥s o teste.</font></font><br>
 <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></b>
                        <div class="spoiler_text"> <pre><code class="java hljs"><span class="hljs-meta">@After</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tearDown</span><span class="hljs-params">()</span> </span>{<font></font>
    dynamoDB.getTable(<span class="hljs-string">"ContactUsTable"</span>).delete();<font></font>
}<font></font>
               </code></pre><br>
 </div>
                    </div><br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, usando o Localstack, obtemos uma gama bastante ampla de simula√ß√µes da AWS que permitem emular o trabalho desses servi√ßos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes E2E</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para reproduzir os cen√°rios E2E, √© melhor aumentar os servi√ßos de teste da AWS especificamente para executar testes, se, √© claro, houver essa oportunidade. </font><font style="vertical-align: inherit;">Isso pode ser feito usando o modelo CloudFormation opcional, no qual os recursos ser√£o c√≥pias do modelo principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O teste pode ser feito chamando o lambda por meio da AWS-CLI e processando o resultado com qualquer ferramenta dispon√≠vel. </font><font style="vertical-align: inherit;">Voc√™ ainda pode fazer uma chamada em testes de unidade, mas sem criar mobs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testes de performance</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o teste de desempenho merece um artigo separado ou mesmo um livro, n√£o tentarei colocar todas as informa√ß√µes aqui. </font><font style="vertical-align: inherit;">Em resumo, ao falar sobre teste de estresse, lembre-se de que quase todos os servi√ßos da AWS n√£o s√£o gratuitos e voc√™ deve estar preparado para estimar os poss√≠veis custos com anteced√™ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ deseja avaliar os recursos necess√°rios para um lambda, use o console da interface do usu√°rio e fa√ßa algumas chamadas de teste. </font><font style="vertical-align: inherit;">Em seguida, usando a l√≥gica e a matem√°tica comuns, avalie quanto o desempenho da sua lambda aumenta dependendo da quantidade de recursos dispon√≠veis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o se esque√ßa do CloudWatch. </font><font style="vertical-align: inherit;">Com sua ajuda, voc√™ pode criar pain√©is bastante indicativos e, com base neles, determinar quais par√¢metros de lambda e gastos voc√™ pode pagar.</font></font><br>
<br>
<a name="Part5"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. O custo de solu√ß√µes sem servidor</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A avalia√ß√£o de uma solu√ß√£o √© sempre espec√≠fica, porque voc√™ precisa considerar n√£o apenas o custo de uma chamada, mas tamb√©m o tr√°fego de entrada / sa√≠da, o custo de armazenamento em cache, registro e monitoramento. </font><font style="vertical-align: inherit;">Se voc√™ estiver pensando em usar o lambda, tente prever a carga que seu servi√ßo manipular√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se forem chamadas √∫nicas ou um processo ETL que √© executado a cada poucas horas / dias, √© mais prov√°vel que o lambda pague. </font><font style="vertical-align: inherit;">Se voc√™ prever uma carga de v√°rias consultas por segundo, fa√ßa uma estimativa precisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo, forne√ßo estimativas aproximadas do custo do lambda e do servidor EC2 mais barato, para que voc√™ entenda quais valores est√£o em quest√£o: </font><font style="vertical-align: inherit;">
Os seguintes par√¢metros para o lambda foram usados ‚Äã‚Äãpara calcular:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/p_/0w/ij/p_0wij6j_z2xop6dbt185485llc.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempo de espera:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 150 milissegundos</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pre√ßo:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ 0,00001667 para 1GB-s</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mem√≥ria:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 256 MB</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para EC2 t2.nano:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pre√ßo:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ 4.75 por m√™s</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mem√≥ria:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 512 MB</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vCPU:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carga m√°xima:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5% de CPU por m√™s</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peguei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui os</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dados de carregamento do EC2, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">de</font></a><font style="vertical-align: inherit;"> acordo com esses c√°lculos, o servidor especificado pode suportar uma carga constante de 0,3 solicita√ß√µes por segundo. √Ä medida que a carga aumenta, o tempo de resposta aumenta, o que reduzir√° a efici√™ncia desse servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos esses c√°lculos s√£o bastante abstratos e n√£o levam em considera√ß√£o muitos fatores: descontos em um adiantamento ou em um grande n√∫mero de solicita√ß√µes, tempo de execu√ß√£o do lambda e assim por diante. Mas eles mostram que, com uma carga de menos de 1 solicita√ß√£o por segundo, o lambda custa menos que o servidor EC2 mais barato. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, n√£o esque√ßa de adicionar o pre√ßo do ALB ao pre√ßo do EC2 se voc√™ precisar manter v√°rias r√©plicas de aplicativos ou IPs el√°sticos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gr/wc/md/grwcmd0t5swk3uwf-shmglewttu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os testes e o desenvolvimento local de solu√ß√µes sem servidor s√£o menos populares que os mesmos microsservi√ßos. </font><font style="vertical-align: inherit;">No entanto, mais e mais pessoas estudam e aplicam essas tecnologias e oferecem a chance de v√°rios produtos de c√≥digo aberto se tornarem melhores e mais eficientes. </font><font style="vertical-align: inherit;">Essas solu√ß√µes simplificam bastante a vida das empresas que precisam lan√ßar um produto o mais r√°pido poss√≠vel e n√£o precisam configurar toda a infraestrutura. </font><font style="vertical-align: inherit;">Mas mesmo em produtos j√° desenvolvidos, acho que existe um lugar para bancos de dados sem servidor ou lambdas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o pretendo ser um especialista na √°rea de teste de solu√ß√µes sem servidor, mas, com base na minha experi√™ncia pessoal positiva, decidi destacar os pontos principais deste artigo. </font><font style="vertical-align: inherit;">Espero que sejam √∫teis para algu√©m, e talvez alguns de voc√™s possam me complementar ou at√© me corrigir, pelo que ficarei muito feliz.</font></font><br>
<br>
<a name="Part6"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links √öteis</font></font></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda em a√ß√£o. </font><font style="vertical-align: inherit;">Parte 1</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  GitHub</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Localstack Git </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> docker-compose   Localstack</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   EC2  AWS Lambda</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> AWS-CLI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> SAM-CLI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> AWS-CLI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> SAM-</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   AWS Lambda</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496742/index.html">Sobre uma solu√ß√£o para o problema de ladr√µes e prostitutas em sistemas de servi√ßos educacionais on-line</a></li>
<li><a href="../pt496744/index.html">Como economizar finan√ßas e at√© ganhar dinheiro diante da queda dos mercados: produtos estruturais</a></li>
<li><a href="../pt496750/index.html">Estratifica√ß√£o ou como aprender a confiar em dados</a></li>
<li><a href="../pt496752/index.html">Como o v√≠rus Ebola nos ensinou a lidar com os dados de infec√ß√£o e esquecemos todas as li√ß√µes dele</a></li>
<li><a href="../pt496754/index.html">Not√≠cias do mundo do OpenStreetMap n¬∫ 506 (03.24.2020-30.03.2020)</a></li>
<li><a href="../pt496758/index.html">Sa√∫de medieval digital. Transforma√ß√£o tecnol√≥gica global ap√≥s COVID-19</a></li>
<li><a href="../pt496760/index.html">Fluxo do usu√°rio: como criar aplicativos e sites populares</a></li>
<li><a href="../pt496762/index.html">Simula√ß√£o de eros√£o de superf√≠cie baseada em part√≠culas</a></li>
<li><a href="../pt496764/index.html">Pequeno, mas orgulhoso: DuckDuckGo vs. Monstros de an√∫ncios</a></li>
<li><a href="../pt496766/index.html">O que √© o Azure Stack HCI e como ele funciona</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>