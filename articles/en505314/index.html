<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ #‚É£ üßóüèø Linux time synchronization: NTP, Chrony, and systemd-timesyncd üëâüèø ‚òÇÔ∏è üíáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most people keep track of time. We get up on time to perform our morning rituals and go to work, take a break for lunch, meet the project deadlines, c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linux time synchronization: NTP, Chrony, and systemd-timesyncd</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/505314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/ts/k3/m-tsk33gxcmkrlh4yuqdaxl4ytk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most people keep track of time. </font><font style="vertical-align: inherit;">We get up on time to perform our morning rituals and go to work, take a break for lunch, meet the project deadlines, celebrate birthdays and holidays, board a plane and so on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover: some of us are obsessed with time. </font><font style="vertical-align: inherit;">My watch is powered by solar energy and receives the exact time from the National Institute of Standards and Technology ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) in Fort Collins, Colorado via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWVB Longwave Radio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Time signals are synchronized with the atomic clock, also located at Fort Collins. </font><font style="vertical-align: inherit;">My Fitbit synchronizes with my phone, which synchronizes with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server </font><font style="vertical-align: inherit;">, which ultimately synchronizes with the atomic clock.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Devices also keep track of time</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are many reasons why our devices and computers need accurate time. For example, in the banking sector, stock markets, and other financial enterprises, transactions must be performed in the proper order, and accurate timing is critical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our phones, tablets, cars, GPS systems and computers require precise time and date settings. I want the clock on the desktop of my computer to show the correct time. I want my local calendar to have reminders at the right time. The correct time also ensures that the cron and systemd jobs are started at the right time.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Date and time are also important for logging, so it‚Äôs a little easier to find certain logs based on date and time. </font><font style="vertical-align: inherit;">For example, I once worked at DevOps (they didn‚Äôt call it that at that time) and set up an email system in North Carolina. </font><font style="vertical-align: inherit;">We used to process over 20 million emails a day. </font><font style="vertical-align: inherit;">Tracking e-mail through a series of servers or determining the exact sequence of events using log files on geographically dispersed hosts can be much easier if the computers are synchronized in time.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One time - many hours</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linux hosts must be aware that there is a system time and RTC time. RTC (Real Time Clock) is a bit strange and not very accurate name for a hardware clock. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The hardware clock runs continuously even when the computer is turned off using the battery on the system‚Äôs motherboard. The main function of RTC is to store the time when the connection to the time server is not available. In those days when it was impossible to connect to the time server via the Internet, each computer had to have an accurate internal clock. Operating systems had to access RTC at boot time, and the user had to manually set the system time using the hardware BIOS configuration interface to make sure it was correct.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hardware watches do not understand the concept of time zones; </font><font style="vertical-align: inherit;">RTC only stores time, not the time zone or offset from UTC (Coordinated Universal Time, which is also known as GMT or Greenwich Mean Time). </font><font style="vertical-align: inherit;">You can install RTC using the tool, which I will discuss later in this article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
System time is the time that the OS displays on the GUI clock on your desktop, in the output of the date command, in the timestamps of the logs. </font><font style="vertical-align: inherit;">This also applies to the time files were created, modified, and opened. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtc man</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> page </font><font style="vertical-align: inherit;">has a full description of RTC and the system clock.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does NTP have?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Computers around the world use NTP (Network Time Protocol) to synchronize their time with standard reference clocks over the Internet using a hierarchy of NTP servers. The main time servers are located at level 1, and they are directly connected to various national time services at level 0 via satellite, radio or even modems over telephone lines. Time services at level 0 can be an atomic clock, a radio receiver that is tuned to the signals transmitted by the atomic clock, or a GPS receiver using high-precision clock signals transmitted by GPS satellites.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the vast majority of reference servers, several thousand public NTP stratum 2 servers are open, which are available to everyone. </font><font style="vertical-align: inherit;">Many organizations and users (including me) with a large number of hosts that require an NTP server prefer to install their own time servers, so only one local host addresses stratum 2 or 3. Then they configure the remaining nodes on the network to use the local time server . </font><font style="vertical-align: inherit;">In the case of my home network, this is a level 3 server.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Various NTP implementations </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The initial implementation of NTP is ntpd. Then two newer ones joined her, chronyd and systemd-timesyncd. All three synchronize the local host time with the NTP time server. The systemd-timesyncd service is not as reliable as chronyd, but this is sufficient for most purposes. If RTC is not synchronized, it can gradually adjust the system time to synchronize with the NTP server when the local system time is slightly shifted. The systemd-timesync service cannot be used as a time server. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrony</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is an NTP implementation that contains two programs: the chronyd daemon and a command line interface called chronyc. Chrony has some features that in many cases are simply irreplaceable:</font></font><br>
<br>
<ul>
<li>Chrony       ,    ntpd.       ,    .</li>
<li>     , ,           ,      -   ,       .</li>
<li>    ,        .</li>
<li>    .</li>
<li>    Chrony    .             .</li>
<li>Chrony       .          .</li>
<li>Chrony     NTP-.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Once again: NTP is a protocol that can be implemented on a Linux host using Chrony or systemd-timesyncd. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The RPM packages NTP, Chrony, and systemd-timesyncd are available in standard Fedora repositories. </font><font style="vertical-align: inherit;">RPM systemd-udev is a kernel event manager that is installed by default in Fedora but is not required. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can install all three and switch between them, but this will create an extra headache. </font><font style="vertical-align: inherit;">So it‚Äôs better not to. </font><font style="vertical-align: inherit;">Current releases of Fedora, CentOS, and RHEL have migrated to Chrony as a standard implementation, and they also have systemd-timesyncd. </font><font style="vertical-align: inherit;">I believe that Chrony works well, provides a better interface than the NTP service, provides much more information and increases control, which system administrators will certainly enjoy.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disabling NTP Services </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Your host may already have the NTP service running. </font><font style="vertical-align: inherit;">If so, you need to disable it before switching to something else. </font><font style="vertical-align: inherit;">I had chronyd running, so I used the following commands to stop and disable it. </font><font style="vertical-align: inherit;">Run the appropriate commands for any NTP daemon that you use on your host:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl disable chronyd ; systemctl stop chronyd</span><font></font>
Removed /etc/systemd/system/multi-user.target.wants/chronyd.service.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verify that the service is stopped and disabled:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status chronyd</span><font></font>
‚óè chronyd.service - NTP client/server<font></font>
     Loaded: loaded (/usr/lib/systemd/system/chronyd.service; disabled; vendor preset: enabled)<font></font>
     Active: inactive (dead)<font></font>
       Docs: man:chronyd(8)<font></font>
             man:chrony.conf(5)<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check status before launch</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The system clock synchronization status allows you to determine if the NTP service is running. </font><font style="vertical-align: inherit;">Since you haven't started NTP yet, the timesync-status command will hint at this:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl timesync-status</span>
Failed to query server: Could not activate remote peer.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A direct status request provides important information. </font><font style="vertical-align: inherit;">For example, the timedatectl command with no argument or parameters executes the default status subcommand:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl status</span><font></font>
           Local time: Fri 2020-05-15 08:43:10 EDT  <font></font>
           Universal time: Fri 2020-05-15 12:43:10 UTC  <font></font>
                 RTC time: Fri 2020-05-15 08:43:08      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: no                          <font></font>
              NTP service: inactive                    <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes                    <font></font>
<font></font>
Warning: The system is configured to <span class="hljs-built_in">read</span> the RTC time <span class="hljs-keyword">in</span> the <span class="hljs-built_in">local</span> time zone.<font></font>
         This mode cannot be fully supported. It will create various problems<font></font>
         with time zone changes and daylight saving time adjustments. The RTC<font></font>
         time is never updated, it relies on external facilities to maintain it.<font></font>
         If at all possible, use RTC <span class="hljs-keyword">in</span> UTC by calling
         <span class="hljs-string">'timedatectl set-local-rtc 0'</span>.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So you get the local time for your host, UTC time and RTC time. In this case, the system time is set to the America / New_York (TZ) time zone, the RTC is set to the time in the local time zone, and the NTP service is not active. RTC time began to deviate slightly from the system time. This is normal for systems whose clocks have not been synchronized. The amount of offset on the host depends on the time elapsed since the last system synchronization.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also received a warning about using local time for RTC - this applies to changes in the time zone and daylight saving time settings. </font><font style="vertical-align: inherit;">If the computer is turned off at the moment when it is necessary to make changes, the RTC time will not change. </font><font style="vertical-align: inherit;">But for servers or other hosts that work around the clock, this is not a problem at all. </font><font style="vertical-align: inherit;">In addition, any service that provides NTP time synchronization will adjust the host time at the initial start-up phase, so once the start is complete, the time will become correct again.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time zone setting</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usually you specify the time zone during the installation procedure, and you have no task to change it in the future. However, there are times when you need to change the time zone. There are several tools that can help. Linux uses time zone files to determine the local time zone of the host. These files are located in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / share / zoneinfo directory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . By default, for my time zone, the system writes this: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / localtime -&gt; ../usr/share/zoneinfo/America/New_York</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . But you do not need to know such subtleties to change the time zone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main thing is to know the official name of the time zone for your location and the corresponding team. Say you want to change the time zone to Los Angeles:</font></font><br>
<br>
<pre><code class="bash hljs">
[root@testvm2 ~]<span class="hljs-comment"># timedatectl list-timezones | column</span><font></font>
&lt;SNIP&gt;<font></font>
America/La_Paz                  Europe/Budapest<font></font>
America/Lima                    Europe/Chisinau<font></font>
America/Los_Angeles             Europe/Copenhagen<font></font>
America/Maceio                  Europe/Dublin<font></font>
America/Managua                 Europe/Gibraltar<font></font>
America/Manaus                  Europe/Helsinki<font></font>
&lt;SNIP&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you can set the time zone. </font><font style="vertical-align: inherit;">I used the date command to check for changes, but you can also use timedatectl:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 04:47:49 PM EDT<font></font>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl set-timezone America/Los_Angeles</span>
[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 01:48:23 PM PDT<font></font>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you can again change the time zone of your host to local time.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The systemd timesync daemon provides an NTP implementation that is easy to manage in the context of systemd. </font><font style="vertical-align: inherit;">It is installed by default in Fedora and Ubuntu. </font><font style="vertical-align: inherit;">However, it starts by default only in Ubuntu. </font><font style="vertical-align: inherit;">I'm not sure about the other distributions. </font><font style="vertical-align: inherit;">You can check for yourself:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status systemd-timesyncd</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuring systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The configuration file for systemd-timesyncd is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/timesyncd.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is a simple file with fewer options included than in the old NTP and chronyd services. </font><font style="vertical-align: inherit;">Here is the contents of this file (without further changes) on my Fedora virtual machine:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#  This file is part of systemd.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="hljs-comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="hljs-comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="hljs-comment">#  (at your option) any later version.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Entries in this file show the compile time defaults.</span>
<span class="hljs-comment"># You can change settings by editing this file.</span>
<span class="hljs-comment"># Defaults can be restored by simply deleting this file.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># See timesyncd.conf(5) for details.</span><font></font>
<font></font>
[Time]<font></font>
<span class="hljs-comment">#NTP=</span>
<span class="hljs-comment">#FallbackNTP=0.fedora.pool.ntp.org 1.fedora.pool.ntp.org 2.fedora.pool.ntp.org 3.fedora.pool.ntp.org</span>
<span class="hljs-comment">#RootDistanceMaxSec=5</span>
<span class="hljs-comment">#PollIntervalMinSec=32</span>
<span class="hljs-comment">#PollIntervalMaxSec=2048</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only section it contains, apart from comments, is [Time]. </font><font style="vertical-align: inherit;">All other lines are commented out. </font><font style="vertical-align: inherit;">These are the default values, they do not need to be changed (unless you have a reason for this). </font><font style="vertical-align: inherit;">If you do not have the NTP time server defined in the NTP = line, Fedora uses the Fedora backup time server by default. </font><font style="vertical-align: inherit;">I usually add my time server:</font></font><br>
<br>
<pre><code class="bash hljs">NTP=myntpserver</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch timesync</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can start and make systemd-timesyncd active like this:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># systemctl enable systemd-timesyncd.service</span><font></font>
Created symlink /etc/systemd/system/dbus-org.freedesktop.timesync1.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
Created symlink /etc/systemd/system/sysinit.target.wants/systemd-timesyncd.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
[root@testvm2 ~]<span class="hljs-comment"># systemctl start systemd-timesyncd.service</span>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware Clock Installation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's what the situation looks like after running timesyncd:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Sat 2020-05-16 14:34:54 EDT  <font></font>
           Universal time: Sat 2020-05-16 18:34:54 UTC  <font></font>
                 RTC time: Sat 2020-05-16 14:34:53      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: no    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, the difference between RTC and local time (EDT) does not exceed a second, and the discrepancy increases by a couple of seconds over the next few days. Since there is no concept of time zones in RTC, the timedatectl command must perform a comparison to determine the desired time zone. If the RTC does not exactly match the local time, then it does not match the local time zone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Looking for more information, I checked the status of systemd-timesync and found this:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># systemctl status systemd-timesyncd.service</span><font></font>
‚óè systemd-timesyncd.service - Network Time Synchronization<font></font>
     Loaded: loaded (/usr/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: disabled)<font></font>
     Active: active (running) since Sat 2020-05-16 13:56:53 EDT; 18h ago<font></font>
       Docs: man:systemd-timesyncd.service(8)<font></font>
   Main PID: 822 (systemd-timesyn)<font></font>
     Status: <span class="hljs-string">"Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org)."</span>
      Tasks: 2 (<span class="hljs-built_in">limit</span>: 10365)<font></font>
     Memory: 2.8M<font></font>
        CPU: 476ms<font></font>
     CGroup: /system.slice/systemd-timesyncd.service<font></font>
             ‚îî‚îÄ822 /usr/lib/systemd/systemd-timesyncd<font></font>
<font></font>
May 16 09:57:24 testvm2.both.org systemd[1]: Starting Network Time Synchronization...<font></font>
May 16 09:57:24 testvm2.both.org systemd-timesyncd[822]: System clock time <span class="hljs-built_in">unset</span> or jumped backwards, restoring from recorded timestamp: Sat 2020-05-16 13:56:53 EDT<font></font>
May 16 13:56:53 testvm2.both.org systemd[1]: Started Network Time Synchronization.<font></font>
May 16 13:57:56 testvm2.both.org systemd-timesyncd[822]: Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org).<font></font>
[root@testvm2 systemd]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pay attention to the log message, which says that the system time is not set or reset back. </font><font style="vertical-align: inherit;">The Timesync service sets the system time based on a timestamp. </font><font style="vertical-align: inherit;">Timestamps are maintained by the timesync daemon and are created upon each successful synchronization. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The timedatectl command is not able to take the value of the hardware clock from the system clock. </font><font style="vertical-align: inherit;">She can set the time and date only from the value entered on the command line. </font><font style="vertical-align: inherit;">You can set RTC to the same value as the system time using the hwclock command:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># /sbin/hwclock --systohc --localtime</span>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Mon 2020-05-18 13:56:46 EDT  <font></font>
           Universal time: Mon 2020-05-18 17:56:46 UTC  <font></font>
                 RTC time: Mon 2020-05-18 13:56:46      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The --localtime option indicates that the hardware clock shows local time, not UTC.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why do you need RTC at all?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any NTP implementation will set the system clock at startup. </font><font style="vertical-align: inherit;">And then why RTC? </font><font style="vertical-align: inherit;">This is not entirely true: this will only happen if you have a network connection to a time server. </font><font style="vertical-align: inherit;">However, many systems do not have constant access to the network connection, so the hardware clock is useful for Linux to set the system time based on them. </font><font style="vertical-align: inherit;">This is better than setting the time manually, even if it may deviate from real time.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article discusses some tools for managing date, time, and time zones. The systemd-timesyncd tool provides an NTP client that can synchronize time on a local host with an NTP server. However, systemd-timesyncd does not provide a server service, so if you need an NTP server on your network, you must use something else - for example, Chrony, to work as a server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I prefer to have a single implementation for any services on my network, so I use Chrony. If you do not need a local NTP server or if you do not mind using Chrony as a server and systemd-timesyncd as an SNTP client. After all, there is no need to use the additional features of Chrony as a client, if you are satisfied with the functionality of systemd-timesyncd.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One more note: you are not required to use systemd tools to implement NTP. </font><font style="vertical-align: inherit;">You can use the old version of ntpd, Chrony, or another NTP implementation. </font><font style="vertical-align: inherit;">After all, systemd consists of a large number of services; </font><font style="vertical-align: inherit;">many of them are optional, so you can turn them off and use something else instead. </font><font style="vertical-align: inherit;">This is not a huge monolithic monster. </font><font style="vertical-align: inherit;">You may not like systemd or parts of it, but you must make an informed decision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I like the NTP implementation in systemd, but I prefer Chrony because it suits my needs better. </font><font style="vertical-align: inherit;">This is Linux, baby -)</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As an advertisement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VDSina offers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servers for any task</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a huge selection of operating systems for automatic installation, it is possible to install any OS with its own </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a convenient </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">control panel of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> its own design and daily payment. </font><font style="vertical-align: inherit;">Recall that we have eternal servers that are definitely timeless;)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505298/index.html">Flight of Crew Dragon in photos and video</a></li>
<li><a href="../en505300/index.html">Oil industry for engineers, programmers, mathematicians and the masses of workers, part 1</a></li>
<li><a href="../en505302/index.html">10 circuit design tips</a></li>
<li><a href="../en505306/index.html">From games to e-commerce projects. Changing the two-year program of Technopark</a></li>
<li><a href="../en505310/index.html">What distinguishes technologically advanced companies and how techlide can help your team grow</a></li>
<li><a href="../en505322/index.html">Dispatcher of the future: how will his role in the service company change?</a></li>
<li><a href="../en505330/index.html">How to not create a cryptocurrency from scratch in 3 years</a></li>
<li><a href="../en505336/index.html">How to: Manet or Monet? Neural network responds</a></li>
<li><a href="../en505340/index.html">Walmart employees try to prove that anti-theft AI doesn't work</a></li>
<li><a href="../en505342/index.html">Dependency injection and the dependency inversion principle are NOT ONE AND SAME</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>