<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯФ╗ ЁЯТЦ ЁЯЩЖЁЯП╝ рд▓рд╛рдЗрди рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЛрдмреЛрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд╕рднреА рдЪрд░рдгреЛрдВ, рдпрд╛ STM32 рдХреЗ рд╕рд╛рде рд╕рднреА рд░реЗрдХ рдХреЛ рдХреИрд╕реЗ рдЗрдХрдЯреНрдард╛ рдХрд┐рдпрд╛ рдЬрд╛рдП ЁЯХФ ЁЯТХ тЫ╕я╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣реЗрд▓реЛ, рд╣реЗрдмреНрд░! 
 
 рдпрд╣ рдкреНрд░рдХрд╛рд╢рди рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЛрдмреЛрдЯ рдмрдирд╛рдиреЗ рдореЗрдВ рдореЗрд░реЗ рдЕрдиреБрднрд╡ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдЧрд╛, рдЕрд░реНрдерд╛рддреН рд▓рд╛рдЗрди рдХреЗ рдмрд╛рджред рдореИрдВ рд╕рд░реНрдХрд┐рдЯрд░реА рдХреЛ рдбрд┐рдЬрд╛рдЗрди рдХрд░рдиреЗ рдФрд░ рдПрдХ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>рд▓рд╛рдЗрди рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЛрдмреЛрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд╕рднреА рдЪрд░рдгреЛрдВ, рдпрд╛ STM32 рдХреЗ рд╕рд╛рде рд╕рднреА рд░реЗрдХ рдХреЛ рдХреИрд╕реЗ рдЗрдХрдЯреНрдард╛ рдХрд┐рдпрд╛ рдЬрд╛рдП</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497782/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрд▓реЛ, рд╣реЗрдмреНрд░! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдкреНрд░рдХрд╛рд╢рди рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЛрдмреЛрдЯ рдмрдирд╛рдиреЗ рдореЗрдВ рдореЗрд░реЗ рдЕрдиреБрднрд╡ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдЧрд╛, рдЕрд░реНрдерд╛рддреН рд▓рд╛рдЗрди рдХреЗ рдмрд╛рджред </font><font style="vertical-align: inherit;">рдореИрдВ рд╕рд░реНрдХрд┐рдЯрд░реА рдХреЛ рдбрд┐рдЬрд╛рдЗрди рдХрд░рдиреЗ рдФрд░ рдПрдХ рдореБрджреНрд░рд┐рдд рд╕рд░реНрдХрд┐рдЯ рдмреЛрд░реНрдб рдХреЛ рдПрдХ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдФрд░ рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рд▓рд┐рдП рдЖрджреЗрд╢ рджреЗрдиреЗ рд╕реЗ рд╕рднреА рдЪрд░рдгреЛрдВ рдХреЛ рдмрддрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓рд╛рдЗрди рдХреЗ рд╕рд╛рде рд░реЛрдмреЛрдЯреЛрдВ рдХреА рджреМрдбрд╝ рд▓рдВрдмреЗ рд╕рдордп рд╕реЗ рд╢реБрд░реБрдЖрддреА рд░реЛрдмреЛрдЯрд┐рдХреНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рдкрд░реАрдХреНрд╖рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓рдЧрднрдЧ рд╕рднреА рдХреНрд╖реЗрддреНрд░реАрдп рдФрд░ рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдп рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛рдУрдВ рдореЗрдВ рдпрд╣ рджрд┐рд╢рд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд░реЛрдмреЛрдЯ рдмрдирд╛рдХрд░ рдЖрдк рд▓рдЧрднрдЧ рд╣рд░ рдЬрдЧрд╣ рднрд╛рдЧ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡рд┐рд╢реНрд╡рд╡рд┐рджреНрдпрд╛рд▓рдп рдХреЗ рдкрд╣рд▓реЗ рд╡рд░реНрд╖ рдореЗрдВ, рдПрд▓рдИрдбреА рдХреЗ рдкрд╣рд▓реЗ рдкрд▓рдХ рдЭрдкрдХрдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рдЕрдЧрд▓рд╛ рдХрд╛рд░реНрдп рдерд╛ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдирд┐рд░реВрдкрдг</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдИ рднреА рд╡рд┐рдХрд╛рд╕ рддрдХрдиреАрдХреА рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдмреЛрдлрд┐рдирд┐рд╕реНрдЯ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛рдУрдВ рдХреЗ рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдирд┐рдпрдореЛрдВ рдХреЛ рдЯреАрдХреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЖрдпрд╛рдореЛрдВ (25x25x25 рд╕реЗрдореА рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ) рдФрд░ рд░реЛрдмреЛрдЯ рдХреЗ рд╡рдЬрди (1 рдХрд┐рд▓реЛ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ) рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЯреНрд░реИрдХ рдХреЗ рдЖрдХрд╛рд░ рдФрд░ рдЗрд╕рдХреА рдЪреМрдбрд╝рд╛рдИ 1.5 рд╕реЗрдореА рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред рдЯреНрд░реИрдХ рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдПрдХ рдереНрд░реЗрд╢реЛрд▓реНрдб рдиреНрдпреВрдирддрдо рд╕рдордп рдЧреБрдЬрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ (60 рд╕реЗрдХрдВрдб)ред ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рд░реНрдп рд╕реНрдкрд╖реНрдЯ рд╣реИ, рд╣рдореЗрдВ рдПрдХ рд░реЛрдмреЛрдЯ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдиреНрдпреВрдирддрдо рд╕рдордп рдореЗрдВ рд╢реБрд░реВ рд╕реЗ рдЕрдВрдд рддрдХ рдЗрд╕рдХреЗ рд╕рд╛рде рдбреНрд░рд╛рдЗрд╡рд┐рдВрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдХрд▓реНрдкрдирд╛ рд░рдЪрдирд╛</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд░реЛрдмреЛрдЯ рдХрд╛ рдореВрд▓ STM32F103C8T6 рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рд╣реИ, рдпрд╣ QRE1113 рдСрдкреНрдЯрд┐рдХрд▓ рд╕реЗрдВрд╕рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреНрд░реИрдХ рдЬрд╛рдирдХрд╛рд░реА рдкрдврд╝рддрд╛ рд╣реИ рдФрд░ A3906 рдЪрд╛рд▓рдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрдВрдЬрдиреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рд╕реНрдкрд╖реНрдЯрддрд╛ рдХреЗ рд▓рд┐рдП, рд╕реЗрдВрд╕рд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдПрд▓рдИрдбреА рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рд╣реА рд╕реЗрдВрд╕рд░ рдмреНрд▓реИрдХ рд▓рд╛рдЗрди рдХреЛ "рджреЗрдЦрддрд╛ рд╣реИ", рдПрд▓рдИрдбреА рд▓рд╛рдЗрдЯ рдЕрдк рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рдбрд┐рдмрдЧрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдХрд░рддрд╛ рд╣реИред рдПрдХ рд╢рдХреНрддрд┐ рд╕реНрд░реЛрдд рдХреЗ рд░реВрдк рдореЗрдВ, 3.7 рд╡реА рдХреЗ рд╡реЛрд▓реНрдЯреЗрдЬ рдХреЗ рд╕рд╛рде рдПрдХ рд▓реА-рдкреЛ рдкреНрд░рдХрд╛рд░ 18650 рдмреИрдЯрд░реА рдФрд░ рдПрдХ рдЪрд╛рд░реНрдЬ рдЪрд┐рдк LTC4054ES5 рдЪреБрдирд╛ рдЧрдпрд╛ рдерд╛ред рд▓реЗрдХрд┐рди рдореЛрдЯрд░реНрд╕ рдХреЗ рд╕рд╣реА рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП, рдХрдо рд╕реЗ рдХрдо 6 рд╡реА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдореИрдВрдиреЗ рддрд░реНрдХ рднрд╛рдЧ рдХреА рдЖрдкреВрд░реНрддрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП LM2577 рдбреАрд╕реА-рдбреАрд╕реА рдЪрд░рдг-рдЕрдк рд╡реЛрд▓реНрдЯреЗрдЬ рдХрдирд╡рд░реНрдЯрд░ рдФрд░ LM1117 рд░реИрдЦрд┐рдХ 3.3 V рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ред</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/getpro/habr/post_images/aa5/0a0/ddf/aa50a0ddf75671c4ee28137f1fbf8c47.jpg" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдкрд╣рд▓реА рдЧрд▓рддрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдПрдХ рдЬреЛрдбрд╝реА рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдкреЙрд╡рд░ рдкрд┐рди рдорд┐рд▓рд╛рдпрд╛ рдФрд░ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдореЗрдВ рдХрдИ рдШрдВрдЯреЛрдВ рддрдХ рдПрдХ рд╕рдорд╕реНрдпрд╛ рдХреА рддрд▓рд╛рд╢ рдореЗрдВ рд░рд╣рд╛, рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдореБрдЭреЗ рдЙрдиреНрд╣реЗрдВ рдХрд╛рдЯрдирд╛ рдкрдбрд╝рд╛ред рддрдм рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдкреИрджрд╛ рд╣реБрдИ рдХрд┐ рд╕рднреА рд╕реЗрдВрд╕рд░ рд▓рд╛рдЗрди рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рдХрд░рддреЗ рдереЗ, рдореЗрд░реА рдкрд╣рд▓реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдпрд╣ рдереА рдХрд┐ рдореИрдВрдиреЗ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рдЬрд▓рд╛ рджрд┐рдпрд╛ рдерд╛ рдпрд╛ рдЖрдЦрд┐рд░реА рдЪрд░рдг рдореЗрдВ рдмрд┐рдЬрд▓реА рдХреА рдЖрдкреВрд░реНрддрд┐ рдХреЗ рдЯреВрдЯреЗ рд╣реБрдП рдкреИрд░ рдмрд┐рд▓реНрдХреБрд▓ рднреА рдирд╣реАрдВ рдереЗ, рдпрд╛ рдХрд┐ рдореИрдВрдиреЗ рд╕рдВрдкрд░реНрдХреЛрдВ рдХреЛ рдЦрд░рд╛рдм рдХрд░ рджрд┐рдпрд╛ рдерд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдЖрд╕реНрдЯрд╕реАрд▓рд╕реНрдХрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдореИрдВрдиреЗ рдкрд╛рдпрд╛ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рд╕реНрд╡рдпрдВ рд╕реЗрдВрд╕рд░ рдореЗрдВ рдереА, 10 рд╕реЗрдВрд╕рд░ 4 рдореЗрдВ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдпрд╛, рдЙрдиреНрд╣реЗрдВ рдирдП рд▓реЛрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдорд╕реНрдпрд╛ рджрд┐рдЦрд╛рдИ рджреА - рддреАрди рд╕реВрдЪрдХ рдПрд▓рдИрдмреА рдкреАрдмреА 3, рдкреАрдмреА 4 рдФрд░ рдкреАрдП 15 рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдПред рдЕрдкрдиреЗ рд╕рднреА рдХреЛрдб рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдФрд░ рджреЗрдЦрдиреЗ рдХреЗ рдмрд╛рдж, рдореБрдЭреЗ рдЧреИрд░-рдХрд╛рдордХрд╛рдЬреА рдФрд░ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдХреА рд╢реБрд░реВрдЖрдд рдореЗрдВ рдХреЛрдИ рдЕрдВрддрд░ рдирд╣реАрдВ рдорд┐рд▓рд╛, рд╣рд░ рдЬрдЧрд╣ рдкреБрд╢ рдкреБрд▓, 10 рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ рдФрд░ рдШрдбрд╝реА рд╕рдХреНрд╖рдо рдереАред рдЖрд╕реНрдЯрд╕реАрд▓реЛрдЧреНрд░рд╛рдо рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдПрдХ рдкрд┐рди рдХреЛ рдкреНрд▓рд╕ рдореЗрдВ рдЖрдХрд░реНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдбрд┐рдмрдЧ рдореЛрдб рдореЗрдВ рднреА рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рднреА рд░реАрд╕реЗрдЯ рдирд╣реАрдВ рд╣реБрдЖ, рдореБрдЭреЗ рдПрд╣рд╕рд╛рд╕ рд╣реБрдЖ рдХрд┐ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдЬрд▓рд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдбреЗрдЯрд╛рд╢реАрдЯ рдХреЛ рдмрдВрдж рдХрд░рддреЗ рд╣реБрдП, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдПрдХ рдЕрдЬреАрдм рд╕рдВрдпреЛрдЧ рд╕реЗ, рдЗрди рдкрд┐рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ JTAG рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдореИрдВ SWD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реБрдП рдХрд┐ рдпрд╣ рдмрджрддрд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдореИрдВрдиреЗ JTAG рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдФрд░ рдЗрд╕рд╕реЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдорджрдж рдорд┐рд▓реА (рдиреАрдЪреЗ рджреЗрдЦреЗрдВ)ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдорд┐рдиреА рдирд┐рд╖реНрдХрд░реНрд╖, рд╕рднреА рдЪрд░рдгреЛрдВ рдореЗрдВ рд╕рд╣реА рдкреЛрд╖рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдкрдХреЛ рдмрд╛рдж рдореЗрдВ рдЬрд▓рд╛ рд╣реБрдЖ рдХреБрдЫ рди рд╕рдордЭреЗрдВ рдпрд╛ рдпрд╣ рдЕрдиреНрдп рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдХрд╛рдо рди рдХрд░реЗред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреЛрдЬрдирд╛ рдореЗрдВ рдХреНрдпрд╛ рд╕реБрдзрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВрдиреЗ рдЪрд╛рд░реНрдЬ рдЪрд┐рдк рд▓рдЧрд╛рдиреЗ рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдпрд╛, рд▓реЗрдХрд┐рди рдореИрдВ рдирд┐рд░реНрд╡рд╣рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреВрд▓ рдЧрдпрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдХреЛрдИ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИ, рдкреНрд▓рд╕ 2020 рдореЗрдВ рдореИрдВрдиреЗ рдЯрд╛рдЗрдк рд╕реА рдХреЗ рдмрдЬрд╛рдп рдорд┐рдиреА рдпреВрдПрд╕рдмреА рд▓рдЧрд╛рдпрд╛ред рдореИрдВ рдмреИрдЯрд░реА рдЪрд╛рд░реНрдЬ рдкрд░ рдирдЬрд░ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдХреЛрдИ рдПрдбреАрд╕реА рдкрд┐рди рдирд╣реАрдВ рдмрдЪрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдбреНрд░рд╛рдЗрд╡рд░ рдЪреБрдирддреЗ рд╕рдордп, рдореИрдВрдиреЗ 6 V рдФрд░ 700 mA рдЗрдВрдЬрди рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди рдЗрд╕ рдмрд╛рдд рдкрд░ рдзреНрдпрд╛рди рдирд╣реАрдВ рджрд┐рдпрд╛ рдХрд┐ рдЗрд╕рдХрд╛ рдЕрдзрд┐рдХрддрдо рд╡реЛрд▓реНрдЯреЗрдЬ 9 V рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ 12 V рдХреЛ рдкрд╕рдВрдж рдХрд░реВрдВрдЧрд╛ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреАрд╕реАрдмреА рдбрд┐рдЬрд╛рдЗрди</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рд░реЛрдмреЛрдЯ рдХреЗ рдкреАрдкреА рдФрд░ рдЕрдВрд╢рдХрд╛рд▓рд┐рдХ рдордВрдЪ рдХреЗ рдЖрдХрд╛рд░ рдФрд░ рдЖрдХрд╛рд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рд╣рдо рдпрд╛рдж рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдирд┐рдпрдореЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЖрдпрд╛рдо 25x25 рд╕реЗрдореА рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдпрд╣ рднреА рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдЬрдм рдЪреАрди рдореЗрдВ рдПрдХ рдХрд╛рд░рдЦрд╛рдиреЗ (PCBWay) рдкрд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдСрд░реНрдбрд░ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ 10x10 рд╕реЗрдореА рд╕реЗ рдЕрдзрд┐рдХ рдХреЗ рдмреЛрд░реНрдб рдХреАрдордд рдореЗрдВ рдХрд╛рдлреА рд╡реГрджреНрдзрд┐ рдХрд░рддреЗ рд╣реИрдВред рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдпрд╛рдореЛрдВ рдХрд╛ рдЪреБрдирд╛рд╡ рд╕реНрдкрд╖реНрдЯ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рд╕реЗрдВрд╕рд░ рдХреЛ рд╕рдордорд┐рдд рд░реВрдк рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рдмреЛрд░реНрдб рдХреЗ рдиреАрдЪреЗ), рд▓рд╛рдЗрди рдХреА рдЪреМрдбрд╝рд╛рдИ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рдФрд░ рдлрд┐рд░ рд╕рдмрд╕реЗ рднрд╛рд░реА рддрддреНрд╡, рдЬреИрд╕реЗ рдХрд┐ рдореЛрдЯрд░реНрд╕ рдФрд░ рдмреИрдЯрд░реАред рдПрд▓ рдИ рдбреА рдХреЛ рдмреЛрд░реНрдб рдХреЗ рд╡рд┐рдкрд░реАрдд рдХрд┐рдирд╛рд░реЗ рдкрд░ рдЗрд╕реА рд╕реЗрдВрд╕рд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, рд╣рдо рдордВрдЪ рдХреЗ рдкреАрдЫреЗ рдПрдХ рдкрд╛рд╡рд░ рд╕реНрд╡рд┐рдЪ рдФрд░ рдПрдХ рдмреИрдЯрд░реА рдЪрд╛рд░реНрдЬ рдХрдиреЗрдХреНрдЯрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рд╢реЗрд╖ рддрддреНрд╡ рдХреЗрдВрджреНрд░ рдХреЗ рдХрд░реАрдм рд╕реЗрдЯ рд╣реЛрддреЗ рд╣реИрдВред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╡рд░реНрдЧ рдХреЗ рдмрдЬрд╛рдп рдмреЛрд░реНрдб рдХреЗ рдЦрд╛рд▓реА рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдХрд╛рдЯрдХрд░, рд░реЛрдмреЛрдЯ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХреА рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рднреНрдп рдЫрд╡рд┐ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛рддреА рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрдо рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЕрджреНрд╡рд┐рддреАрдп рддрддреНрд╡реЛрдВ рдХреЗ рдХрд╛рд░рдг рдмреЛрд░реНрдб рдХрд╛рдлреА рд╕рд░рд▓ рдирд┐рдХрд▓рд╛ред </font><font style="vertical-align: inherit;">рдХреБрд▓ 2 рдкрд░рддреЗрдВ рдиреНрдпреВрдирддрдо рдЯреНрд░реИрдХ рдореЛрдЯрд╛рдИ 0.25 рдорд┐рдореАред </font><font style="vertical-align: inherit;">рдЧреЗрд░рдмрд░ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдорджрд░рдмреЛрд░реНрдб рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ рдореБрдЦреМрдЯрд╛ рдХреЗ рд╕рдлреЗрдж рд░рдВрдЧ рдХрд╛ рдЪрдпрди рдХрд░рдХреЗ рдЗрд╕реЗ рдХрд╛рд░рдЦрд╛рдиреЗ рдореЗрдВ рднреЗрдЬ рджрд┐рдпрд╛, рдлрд┐рд░ рдореБрдЭреЗ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реБрдИред </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/57e/f74/2c8/57ef742c8e35e324720908b0758200cc.jpg" alt="рдЫрд╡рд┐"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рддрддреНрд╡реЛрдВ рдХреЗ рд╕рд╛рде рдмреЛрд░реНрдб рдХрд╛ рдПрдХ 3 рдбреА рджреГрд╢реНрдпред </font><font style="vertical-align: inherit;">рд▓рд╛рдЗрд╡ рдлреЛрдЯреЛ рдЕрдВрдд рдореЗрдВ рд╣реЛрдЧрд╛ред</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/37f/a8b/65d/37fa8b65d80595744c2e2436490b304e.jpg" alt="рдЫрд╡рд┐"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЛрд░реНрдб рдореЗрдВ рдЕрдВрддрд┐рдо рд░реВрдк рджреЗрдиреЗ рдХреА рдХреНрдпрд╛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВрдиреЗ рдХреБрдЫ рддрддреНрд╡реЛрдВ рдХреЛ рдмреИрдЯрд░реА рдХреЗ рдкреНрд▓рд╛рд╕реНрдЯрд┐рдХ рдорд╛рдорд▓реЗ рдХреЗ рдХрд░реАрдм рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдорд┐рд▓рд╛рдк рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдерд╛, рдФрд░ рдорд┐рд▓рд╛рдк рдХреЗ рд▓рд┐рдП рдФрд░ рднреА рдореБрд╢реНрдХрд┐рд▓ред </font><font style="vertical-align: inherit;">рдореИрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХрдиреЗрдХреНрдЯрд░ SWD, UART рдФрд░ рдЗрдВрдЬрдиреЛрдВ рдХреЗ рдкрд┐рдирдЖрдЙрдЯ рдкрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░рдирд╛ рднреВрд▓ рдЧрдпрд╛, рдирддреАрдЬрддрди, рдореБрдЭреЗ рд╕рд░реНрдХрд┐рдЯ рдореЗрдВ рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрдЯрдХреЛрдВ рдХреА рдЦрд░реАрдж</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд░ рдЪреАрдЬ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рди рдХреА рдкреНрд░рддрд┐ рдпреВрдирд┐рдЯ рдЙрдЪреНрдЪрддрдо рд╕рд╛рдкреЗрдХреНрд╖ рд▓рд╛рдЧрддреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЖрдк рдХреЛ рдмрдЪрд╛рдиреЗ рдФрд░ рдмрдЪрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдЙрдЪрд┐рдд рд╕реАрдорд╛ рдХреЗ рднреАрддрд░, рдЗрд╕рд▓рд┐рдП рдПрдХ рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХреНрд╕ рд╕реНрдЯреЛрд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ 4.5 рдЧреБрдирд╛ рд╕рд╕реНрддрд╛ Aliexpress рдХреЗ рд▓рд┐рдП рд▓рд╛рдЗрди рд╕реЗрдВрд╕рд░ рдХрд╛ рдСрд░реНрдбрд░ рдХрд░рдирд╛, рдореИрдВрдиреЗ рдЗрд╕ рддрдереНрдп рдХреЗ рд▓рд┐рдП рднреБрдЧрддрд╛рди рдХрд┐рдпрд╛ рдХрд┐ рдЙрдирдореЗрдВ рд╕реЗ рд▓рдЧрднрдЧ 40% рдмрджрд▓ рдЧрдПред рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдФрд░ рдпрд╣ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдареАрдХ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред </font><font style="vertical-align: inherit;">рджреВрд╕рд░реА рдУрд░, рдореИрдВ 460 рд░реВрдмрд▓ рдХреЗ рд▓рд┐рдП LM2577 рдЪрд┐рдк рдЦрд░реАрджрдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддрд╛ рдерд╛, рдЬрдмрдХрд┐ рд╕рднреА рд╕реНрдЯреНрд░реИрдкрд┐рдВрдЧ рд╡рд╛рд▓реЗ рдореЙрдбреНрдпреВрд▓ рдХреА рд▓рд╛рдЧрдд 100 рд░реВрдмрд▓ рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЕрд▓реА рдХреЛ рднрд╛рдЧреЛрдВ рдХрд╛ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛, рдПрдХ рд╕реНрдерд╛рдиреАрдп рд╕реНрдЯреЛрд░ рдореЗрдВ рдПрдХ рдФрд░ рд╣рд┐рд╕реНрд╕рд╛ рджреЗрдиреЗ рдХрд╛ рдЖрджреЗрд╢ рджрд┐рдпрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ рдореЗрд░реЗ рдЕрдиреБрдорд╛рдирд┐рдд рдШрдЯрдХ рд▓рд╛рдЧрдд рд╣реИрдВ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрдЬрди рдФрд░ рдкрд╣рд┐рдпреЗ - 800 рд░реВрдмрд▓;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреИрдЯрд░реА рдФрд░ рдорд╛рдорд▓рд╛ - 400 рд░реВрдмрд▓;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд╛рд░реНрдЬрд░ - 300 рд░реВрдмрд▓;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдФрд░ рдбреНрд░рд╛рдЗрд╡рд░ - 200 рд░реВрдмрд▓;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреЗрдмрд▓рд╛рдЗрдЬрд░реНрд╕ - 400 рд░реВрдмрд▓;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рд▓реАрд╡рд░реА 2400/10 = 240 рд░реВрдмрд▓ рдкреНрд░рддрд┐ рдпреВрдирд┐рдЯ рдХреЗ рд╕рд╛рде рдлреАрд╕ 10 рдпреВрдирд┐рдЯ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рдХреА рд╣рд╛рд░реНрдиреЗрд╕ - 150 рд░реВрдмрд▓ред</font></font></li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрд▓:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4650 рд░реВрдмрд▓ рдШрдЯрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдХреБрд▓ рд▓рд╛рдЧрдд, рдпрд╛ 2490 рдпрджрд┐ рдЖрдк рд╢реЗрд╖ рдиреМ рдЕрдкреНрд░рдпреБрдХреНрдд рдмреЛрд░реНрдбреЛрдВ рдХреА рдХреАрдордд рдШрдЯрд╛рддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: рдореИрдВрдиреЗ рдмреЛрд░реНрдб рдФрд░ рдШрдЯрдХ рд╕реНрдерд╛рдкрдирд╛ рдХреА рд▓рд╛рдЧрдд рдФрд░ 10 рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рдкреНрд░рддрд┐ рдмреИрдЪ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдХреАрдордд рдмрдврд╝рдХрд░ 16,000 рд░реВрдмрд▓ рд╣реЛ рдЧрдИред </font><font style="vertical-align: inherit;">рдРрд╕реЗ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдФрд░ рд╕рдордп рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд▓рди рд╡рд┐рдзрд┐</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдиреЗ рд╕рд░рд▓рддрдо рддрд░реАрдХреЗ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛, рдпрджрд┐ рд▓рд╛рдЗрди рд╕рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЪрд╛рд▓реВ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╕рд╣реА рдЗрдВрдЬрди рдзреАрдорд╛ рд╣реЛрдирд╛ рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдХрд░реАрдм рд▓рд╛рдЗрди рдХреЛ рдзреАрдорд╛ рдХрд░ рджреЗрдЧрд╛, рдЗрдВрдЬрди рдзреАрдорд╛ рдХрд╛рдо рдХрд░реЗрдЧрд╛, рдЬрдм рддрдХ рдХрд┐ рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрдВрдж рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдмрд╛рдПрдВ рдЗрдВрдЬрди рдЕрдзрд┐рдХрддрдо рдЧрддрд┐ рдкрд░ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред рд▓рд╛рдЗрди рдХреА рдУрд░ рдореБрдбрд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рд╕рдорд╛рди рд╕реНрдерд┐рддрд┐ рдпрджрд┐ рд░реЗрдЦрд╛ рдмрд╛рдИрдВ рдУрд░ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд░реЛрдмреЛрдЯ рдХреЗрдВрджреНрд░реАрдп рд╕реЗрдВрд╕рд░ рдХреЛ рд▓рд╛рдЗрди рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ, рд╕реНрдерд┐рд░ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/22b/07d/9ab/22b07d9ab0c0795c33cda8c42236e18f.jpg" alt="рдЫрд╡рд┐"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд┐рддреНрд░реЛрдВ рдореЗрдВ рдПрд▓реНрдЧреЛрд░рд┐рджрдо</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ae3/234/6c5/ae32346c5611292cf0b7fc155317da5a.jpg" alt="рдЫрд╡рд┐"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b47/403/545/b47403545480435eed6c7b362dbad0bd.jpg" alt="рдЫрд╡рд┐"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/5d8/55b/68c/5d855b68c11937aa1196d6d281c5c939.jpg" alt="рдЫрд╡рд┐"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/42c/481/545/42c4815453ca35de5c6dc32570e09506.jpg" alt="рдЫрд╡рд┐"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/587/7ee/4db/5877ee4db1610d2aab5ace1af4cd27b3.jpg" alt="рдЫрд╡рд┐"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдиреНрдп рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рднреА рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рд╕рднреА рд╕реЗрдВрд╕рд░ рдиреЗ рдПрдХ рд░реЗрдЦрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╣рдо рдЪреМрд░рд╛рд╣реЗ рдХреЛ рдкрд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдЖрдЧреЗ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╛ рдпрджрд┐ рдХреЗрд╡рд▓ рдЪрд░рдо рд╕реЗрдВрд╕рд░ рдиреЗ рд░реЗрдЦрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рд╣реИ, рддреЛ рд╣рдо рдлрд┐рдирд┐рд╢ рд▓рд╛рдЗрди рдкрд░ рдкрд╣реБрдВрдЪреЗ рдФрд░ рд╣рдореЗрдВ рд░реЛрдХрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд╕реНрддрд░ рдкрд░, рдЖрдкрдХреЛ рдПрдХ рдЯреИрдореНрдмреЛрд░рд┐рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд╣рд░рд╛ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдЯреЙрд▓рд┐рдХ рдЯреНрд░реВ рд╕реНрдЯреВрдбрд┐рдпреЛ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдХреЗрд╡рд▓ CMSIS рдФрд░ FreeRTOS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред FreeRTOS рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдзрд╛ рд╕рдкреНрддрд╛рд╣ рдХрд╛ рд╕рдордп, рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рдм рдХреБрдЫ рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди рд╕рдВрдХрд▓рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдкрдХрдбрд╝рд╛, рддрдп 1, 63 рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛, рдпрд╛ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ рдереА, рд▓реЗрдХрд┐рди рдирд┐рдпрдВрддреНрд░рдХ рдХреНрд░реИрд╢ рд╣реЛ рдЧрдпрд╛ред рдХреБрдЫ рдмрд┐рдВрджреБ рдкрд░, рдореБрдЭреЗ рдПрд╣рд╕рд╛рд╕ рд╣реБрдЖ рдХрд┐ рдореЗрд░реЗ рд╣рд╛рде рдХрд╛ рд╕реНрддрд░ ... рдЕрднреВрддрдкреВрд░реНрд╡ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдЧрдпрд╛ рдФрд░ рдпрд╣ рд╕реЛрдЪрдиреЗ рдХрд╛ рд╕рдордп рдерд╛ рдХрд┐ рдореИрдВ рдХреНрдпрд╛ рдХрд░ рд░рд╣рд╛ рдерд╛ рдФрд░ рдореИрдВ рдХреНрдпрд╛ рдХрд░ рд░рд╣рд╛ рдерд╛ред рд╕рдореБрджрд╛рдп рдХреЗ рд╕рд╛рдерд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдореИрдВрдиреЗ рд╕рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ рдЦреБрджрд╛рдИ рд╢реБрд░реВ рдХрд░ рджреА рдФрд░ рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдореБрдЭреЗ рдХрдИ рдорджрдж рдорд┐рд▓реАрдВ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдореЗрд░реА рдорджрдж рдХреА (рдиреАрдЪреЗ рджреЗрдЦреЗрдВ)ред рдирддреАрдЬрддрди, рдореИрдВ рдлреНрд░реАрдЖрд░рдЯреАрдУрдПрд╕ рдХреЛ рд╣рд░рд╛рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рд░рд╣рд╛ рдФрд░ рдЕрдм рддрдХ рдореИрдВрдиреЗ рдЗрд╕реЗ 0% рдкрд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдореИрдВрдиреЗ рдПрдХ рдХрд╛рдо рдореЗрдВ рд╕рдм рдХреБрдЫ рднрд░ рджрд┐рдпрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдБ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реАрдбрд┐рдпреЛ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдЦ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЗрд╕ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдЦ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдиреЗ рдореБрдЭреЗ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдорджрдж рдХреА </font><font style="vertical-align: inherit;">ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдордп рдкреНрд░рдгрд╛рд▓реА, рдпрд╣рд╛рдВ рдореБрдЭреЗ рдЕрднреА рднреА рдпрдХреАрди рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпрд╣ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдкреАрдПрд▓рдПрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ 48 рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдЖрд╡реГрддреНрддрд┐ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдореИрдВрдиреЗ 24 рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ (/ 2) рдХреЛ рдПрдорд╕реАрдУ рдХреЗ рдкреИрд░ рдкрд░ рджреЗрдЦрд╛, рдирд╣реАрдВ, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ 22-25 рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ рдХрд╛ рд╕рдВрдХреЗрдд рджреВрд░ рд╕реЗ рд╕рд╛рдЗрди рдЬреИрд╕рд╛ рджрд┐рдЦ рд░рд╣рд╛ рдерд╛ред рдЙрд╕реА рд╕рдордп, рдореИрдВрдиреЗ FreeRTOS рдХреЙрдиреНрдлрд┐рдЧрд░ рдореЗрдВ 48 рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдФрд░ рджреЗрд░реА рд╕реЗ 500 рдПрдордПрд╕ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдФрд░ рдЗрд╕реЗ рдЪрд▓рд╛рдпрд╛, рджреЗрдЦрд╛ рдХрд┐ рдореЗрд░рд╛ 500 рдПрдордПрд╕ 300 рдореЗрдВ рдмрджрд▓ рдЧрдпрд╛, рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рд╛ рдЧрдпрд╛, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдореБрдЭреЗ рд▓рдХреНрд╖реНрдп 500 рдПрдордПрд╕ рд╣реА рдорд┐рд▓рддрд╛ рд╣реИ, рдЬрдм рдЖрдВрддрд░рд┐рдХ рдЬрдирд░реЗрдЯрд░ рд╕реЗ 8 рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ, рдФрд░ рдЖрд╡реГрддреНрддрд┐ рдореВрд▓реНрдп рдкрд░ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред FreeRTOS рдХреЙрдиреНрдлрд┐рдЧрд░ рдкрд░ рдмрд┐рд▓реНрдХреБрд▓ рднреА рдЕрд╕рд░ рдирд╣реАрдВ рдкрдбрд╝рд╛, 1 Hz рдФрд░ 48 GHz рджреЛрдиреЛрдВ рд╕реЗрдЯ рдХрд░реЗрдВред рдореИрдВрдиреЗ 48 рдореЗрдЧрд╛рд╣рд░реНрдЯреНрдЬ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдФрд░ 300 рдПрдордПрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдореИрдВрдиреЗ рдЧрд▓рддреА рд╕реЗ рдЯреНрд░реВ рд╕реНрдЯреВрдбрд┐рдпреЛ рдХреЛ рд░рд┐рдмреВрдЯ рдХрд░ рджрд┐рдпрд╛ рдФрд░ рдпрд╣ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд░реВрдк рд╕реЗ рдореИрдВрдиреЗ рд╕реЛрдЪрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд┐рдпрд╛, рдФрд░ рд╢реБрд░реБрдЖрдд рд╕реЗ рд╣реА рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рднреА рдлрд╝рд╛рдЗрд▓ рдкрдереЛрдВ рдХрд╛ рд╕рдВрдХреЗрдд рджрд┐рдпрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдКрдкрд░ рд╡рд░реНрдгрд┐рдд JTAG рдФрд░ рдПрд▓ рдИ рдбреА рдХреА рд╕рдорд╕реНрдпрд╛, рд╕рдорд╛рдзрд╛рди </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ</font></a><font style="vertical-align: inherit;"> рдкрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЖрдкрдХреЛ рдЗрд╕реЗ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкрд┐рди рдкреАрдмреА 3, рдкреАрдмреА 4 рдФрд░ рдкреАрдП 15 рддрдХ рдкрд╣реБрдВрдЪ рдореБрдХреНрдд рд╣реЛ рдЬрд╛рдПрдЧреАред</font></font><br>
<br>
<pre><code class="cpp hljs">AFIO-&gt;MAPR |= AFIO_MAPR_SWJ_CFG_JTAGDISABLE;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреА рд╕рдВрд░рдЪрдирд╛ рд▓рдЧрднрдЧ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдвреЗрд░ рд╕рд╛рд░рд╛ рдХреЛрдб</font></font></b>
                        <div class="spoiler_text">1.   ;<br>
<pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RCC_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{						<span class="hljs-comment">// Quartz 16 MHz</span><font></font>
<font></font>
	RCC-&gt;CFGR |= RCC_CFGR_PLLXTPRE;	<span class="hljs-comment">// PLLXTPRE set divider (/2) = 8 MHz</span><font></font>
<font></font>
	RCC-&gt;CR |= RCC_CR_HSEON;			<span class="hljs-comment">// On HSE</span>
	<span class="hljs-keyword">while</span> (!(RCC-&gt;CR &amp; RCC_CR_HSERDY)) {<font></font>
	};<font></font>
<font></font>
	RCC-&gt;CFGR |= (RCC_CFGR_PLLMULL6);     <span class="hljs-comment">// Setup PLLMULL set multiplier (x6) = 48 MHz</span><font></font>
<font></font>
	RCC-&gt;CFGR |= RCC_CFGR_PLLSRC;		<span class="hljs-comment">// PLLSRC set HSE</span><font></font>
<font></font>
	RCC-&gt;CR |= RCC_CR_PLLON;			<span class="hljs-comment">// ON PLL</span>
	<span class="hljs-keyword">while</span> (!(RCC-&gt;CR &amp; RCC_CR_PLLRDY)) {<font></font>
	};<font></font>
<font></font>
	FLASH-&gt;ACR &amp;= ~FLASH_ACR_LATENCY;	<span class="hljs-comment">// Setup FLASH</span><font></font>
	FLASH-&gt;ACR |= FLASH_ACR_LATENCY_1;<font></font>
<font></font>
	RCC-&gt;CFGR |= RCC_CFGR_HPRE_DIV1; 	<span class="hljs-comment">// Set not divider (AHB) = 48 MHz</span>
	RCC-&gt;CFGR |= RCC_CFGR_PPRE1_DIV2; 	<span class="hljs-comment">// Set divider (/2) (APB1) = 24 MHz</span>
	RCC-&gt;CFGR |= RCC_CFGR_PPRE2_DIV1; 	<span class="hljs-comment">// Set not divider (APB2) = 48 MHz</span><font></font>
<font></font>
	RCC-&gt;CFGR &amp;= ~RCC_CFGR_SW; 		<span class="hljs-comment">// Setup SW, select PLL</span><font></font>
	RCC-&gt;CFGR |= RCC_CFGR_SW_PLL;<font></font>
<font></font>
<span class="hljs-comment">//	RCC-&gt;CFGR |= RCC_CFGR_MCO_SYSCLK;</span><font></font>
<font></font>
}<font></font>
</code></pre><br>
2.  ,      ,     ,      Push Pull;<br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GPIO_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
	RCC-&gt;APB2ENR |=	(RCC_APB2ENR_IOPAEN | RCC_APB2ENR_IOPBEN | RCC_APB2ENR_AFIOEN); <span class="hljs-comment">// Enable clock portA, portB and Alternative function</span><font></font>
<font></font>
	AFIO-&gt;MAPR |= AFIO_MAPR_SWJ_CFG_JTAGDISABLE;	<span class="hljs-comment">// Disable JTAG for pins B3,B4 and A15</span><font></font>
<font></font>
	<span class="hljs-comment">//---------------LED: (B3 to B9; A11, A12, A15); Output mode: Push Pull, max 10 MHz---------------//</span><font></font>
<font></font>
	GPIOB-&gt;CRL &amp;= ~(GPIO_CRL_CNF3 | GPIO_CRL_MODE3);	<span class="hljs-comment">// Setup B3 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRL |= GPIO_CRL_MODE3_0;<font></font>
<font></font>
	GPIOB-&gt;CRL &amp;= ~(GPIO_CRL_CNF4 | GPIO_CRL_MODE4);	<span class="hljs-comment">// Setup B3 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRL |= GPIO_CRL_MODE4_0;<font></font>
<font></font>
	GPIOB-&gt;CRL &amp;= ~(GPIO_CRL_CNF5 | GPIO_CRL_MODE5);	<span class="hljs-comment">// Setup B4 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRL |= GPIO_CRL_MODE5_0;<font></font>
<font></font>
	GPIOB-&gt;CRL &amp;= ~(GPIO_CRL_CNF6 | GPIO_CRL_MODE6);	<span class="hljs-comment">// Setup B5 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRL |= GPIO_CRL_MODE6_0;<font></font>
<font></font>
	GPIOB-&gt;CRL &amp;= ~(GPIO_CRL_CNF7 | GPIO_CRL_MODE7);	<span class="hljs-comment">// Setup B6 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRL |= GPIO_CRL_MODE7_0;<font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF8 | GPIO_CRH_MODE8);	<span class="hljs-comment">// Setup B7 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRH |= GPIO_CRH_MODE8_0;<font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF9 | GPIO_CRH_MODE9);	<span class="hljs-comment">// Setup B8 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRH |= GPIO_CRH_MODE9_0;<font></font>
<font></font>
	GPIOA-&gt;CRH &amp;= ~(GPIO_CRH_CNF11 | GPIO_CRH_MODE11);	<span class="hljs-comment">// Setup A11 pins PP, 10MHz</span><font></font>
	GPIOA-&gt;CRH |= GPIO_CRH_MODE11_0;<font></font>
<font></font>
	GPIOA-&gt;CRH &amp;= ~(GPIO_CRH_CNF12 | GPIO_CRH_MODE12);	<span class="hljs-comment">// Setup A12 pins PP, 10MHz</span><font></font>
	GPIOA-&gt;CRH |= GPIO_CRH_MODE12_0;<font></font>
<font></font>
	GPIOA-&gt;CRH &amp;= ~(GPIO_CRH_CNF15 | GPIO_CRH_MODE15);	<span class="hljs-comment">// Setup A15 pins PP, 10MHz</span><font></font>
	GPIOA-&gt;CRH |= GPIO_CRH_MODE15_0;<font></font>
<font></font>
	<span class="hljs-comment">//--Motors: (A8 to A10; B12 to B15); Output and input (B12, B13) mode: Alternative function, PWM - Push Pull, max 10 MHz--//</span><font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF12 | GPIO_CRH_MODE12);		<span class="hljs-comment">// Setup B12 pins analog input</span><font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF13 | GPIO_CRH_MODE13);		<span class="hljs-comment">// Setup B13 pins analog input</span><font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF14   | GPIO_CRH_MODE14);	<span class="hljs-comment">// Setup B14 pins PP, 10MHz</span><font></font>
	GPIOB-&gt;CRH |=  GPIO_CRH_MODE14_0;<font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF15   | GPIO_CRH_MODE15);	<span class="hljs-comment">// Setup B15 pins PP, AF, 10MHz</span><font></font>
	GPIOB-&gt;CRH |=  (GPIO_CRH_CNF15_1 | GPIO_CRH_MODE15_0);<font></font>
<font></font>
	GPIOA-&gt;CRH &amp;= ~(GPIO_CRH_CNF8 | GPIO_CRH_MODE8);		<span class="hljs-comment">// Setup A10 pins PP, 10MHz</span><font></font>
	GPIOA-&gt;CRH |= GPIO_CRH_MODE8_0;<font></font>
<font></font>
	GPIOA-&gt;CRH &amp;= ~(GPIO_CRH_CNF9    | GPIO_CRH_MODE9);		<span class="hljs-comment">// Setup A9 pins PP, AF, 10MHz</span><font></font>
	GPIOA-&gt;CRH |=  (GPIO_CRH_CNF9_1  | GPIO_CRH_MODE9_0);<font></font>
<font></font>
	GPIOA-&gt;CRH &amp;= ~(GPIO_CRH_CNF10 | GPIO_CRH_MODE10);		<span class="hljs-comment">// Setup A10 pins PP, 10MHz</span><font></font>
	GPIOA-&gt;CRH |= GPIO_CRH_MODE10_0;<font></font>
<font></font>
	<span class="hljs-comment">//--UART3: (B10 - TX; B11 - RX); Output mode: Alternative function, UART - Push Pull, max 10 MHz--//</span><font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF10   | GPIO_CRH_MODE10);	<span class="hljs-comment">// Setup B10 pins PP, AF, 10MHz</span><font></font>
	GPIOB-&gt;CRH |=  (GPIO_CRH_CNF10_1 | GPIO_CRH_MODE10_0);<font></font>
<font></font>
	GPIOB-&gt;CRH &amp;= ~(GPIO_CRH_CNF11   | GPIO_CRH_MODE11);	<span class="hljs-comment">// Setup B11 pins PP, AF, 10MHz</span><font></font>
	GPIOB-&gt;CRH |=  (GPIO_CRH_CNF11_1 | GPIO_CRH_MODE11_0);<font></font>
<font></font>
	<span class="hljs-comment">//--Optical sensors: (B0, B1, A0 - A7); Input mode: Analog--//</span><font></font>
<font></font>
	GPIOB-&gt;CRL &amp;= ~(GPIO_CRL_CNF0 | GPIO_CRL_MODE0);	<span class="hljs-comment">// Setup B0 pins analog input</span>
	GPIOB-&gt;CRL &amp;= ~(GPIO_CRL_CNF1 | GPIO_CRL_MODE1);	<span class="hljs-comment">// Setup B1 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF0 | GPIO_CRL_MODE0);	<span class="hljs-comment">// Setup A0 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF1 | GPIO_CRL_MODE1);	<span class="hljs-comment">// Setup A1 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF2 | GPIO_CRL_MODE2);	<span class="hljs-comment">// Setup A2 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF3 | GPIO_CRL_MODE3);	<span class="hljs-comment">// Setup A3 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF4 | GPIO_CRL_MODE4);	<span class="hljs-comment">// Setup A4 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF5 | GPIO_CRL_MODE5);	<span class="hljs-comment">// Setup A5 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF6 | GPIO_CRL_MODE6);	<span class="hljs-comment">// Setup A6 pins analog input</span>
	GPIOA-&gt;CRL &amp;= ~(GPIO_CRL_CNF7 | GPIO_CRL_MODE7);	<span class="hljs-comment">// Setup A7 pins analog input</span><font></font>
<font></font>
}<font></font>
</code></pre><br>
3.       DMA,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>;<br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">uint16_t</span> adc_buf[<span class="hljs-number">10</span>];<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ADC_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
	 RCC-&gt;AHBENR |= RCC_AHBENR_DMA1EN;<font></font>
	 DMA1_Channel1-&gt;CPAR = (<span class="hljs-keyword">uint32_t</span>) &amp;ADC1-&gt;DR;		<span class="hljs-comment">//   </span>
	 DMA1_Channel1-&gt;CMAR = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>) adc_buf;   	<span class="hljs-comment">//    </span><font></font>
<font></font>
	 DMA1_Channel1-&gt;CNDTR = <span class="hljs-number">10</span>;			  				<span class="hljs-comment">//    </span>
	 DMA1_Channel1-&gt;CCR &amp;= ~DMA_CCR_EN;			   		<span class="hljs-comment">//   </span>
	 DMA1_Channel1-&gt;CCR |= DMA_CCR_MSIZE_0;		  		<span class="hljs-comment">//   16 bit</span>
	 DMA1_Channel1-&gt;CCR |= DMA_CCR_PSIZE_0;		 		<span class="hljs-comment">//   16 bit</span>
	 DMA1_Channel1-&gt;CCR |= DMA_CCR_MINC;			  	<span class="hljs-comment">// memory increment mode</span><font></font>
	 DMA1_Channel1-&gt;CCR |= DMA_CCR_CIRC;<font></font>
	 DMA1_Channel1-&gt;CCR |= DMA_CCR_TCIE;				<span class="hljs-comment">//    </span>
	 DMA1_Channel1-&gt;CCR |= DMA_CCR_EN;				  	<span class="hljs-comment">//  </span>
	 NVIC_SetPriority(DMA1_Channel1_IRQn, <span class="hljs-number">10</span>);<font></font>
	 NVIC_EnableIRQ(DMA1_Channel1_IRQn);<font></font>
<font></font>
	 RCC-&gt;CFGR &amp;= ~RCC_CFGR_ADCPRE;<font></font>
	 RCC-&gt;CFGR |= RCC_CFGR_ADCPRE_DIV8;<font></font>
	 RCC-&gt;APB2ENR |= RCC_APB2ENR_ADC1EN;<font></font>
<font></font>
	 ADC1-&gt;SQR3 = <span class="hljs-number">0</span>;			<span class="hljs-comment">// 1</span>
	 ADC1-&gt;SQR3 |= <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">5</span>;		<span class="hljs-comment">// 2     </span>
	 ADC1-&gt;SQR3 |= <span class="hljs-number">2</span> &lt;&lt; <span class="hljs-number">10</span>;		<span class="hljs-comment">// 3</span>
	 ADC1-&gt;SQR3 |= <span class="hljs-number">3</span> &lt;&lt; <span class="hljs-number">15</span>;		<span class="hljs-comment">// 4</span>
	 ADC1-&gt;SQR3 |= <span class="hljs-number">4</span> &lt;&lt; <span class="hljs-number">20</span>;		<span class="hljs-comment">// 5</span>
	 ADC1-&gt;SQR3 |= <span class="hljs-number">5</span> &lt;&lt; <span class="hljs-number">25</span>;		<span class="hljs-comment">// 6</span>
	 ADC1-&gt;SQR2 = <span class="hljs-number">6</span>;			<span class="hljs-comment">// 7</span>
	 ADC1-&gt;SQR2 |= <span class="hljs-number">7</span> &lt;&lt; <span class="hljs-number">5</span>;		<span class="hljs-comment">// 8</span>
	 ADC1-&gt;SQR2 |= <span class="hljs-number">8</span> &lt;&lt; <span class="hljs-number">10</span>;		<span class="hljs-comment">// 9</span>
	 ADC1-&gt;SQR2 |= <span class="hljs-number">9</span> &lt;&lt; <span class="hljs-number">15</span>;		<span class="hljs-comment">// 10</span><font></font>
<font></font>
	 ADC1-&gt;CR2 = ADC_CR2_EXTSEL_0 | ADC_CR2_EXTSEL_1 | ADC_CR2_EXTSEL_2<font></font>
	 | ADC_CR2_EXTTRIG;<font></font>
	 ADC1-&gt;SMPR1 = <span class="hljs-number">0</span>;					 		<span class="hljs-comment">//   </span>
	 ADC1-&gt;SMPR2 = <span class="hljs-number">0</span>;					 		<span class="hljs-comment">//</span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">0</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 0,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">1</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 1,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">2</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 2,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">3</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 3,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">4</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 4,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">5</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 5,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">6</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 6,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">7</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 7,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">8</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 8,   6 </span>
	 ADC1-&gt;SMPR2 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">9</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 9,   6 </span>
	 ADC1-&gt;SMPR1 |= (<span class="hljs-keyword">uint32_t</span>) (<span class="hljs-number">6</span> &lt;&lt; (<span class="hljs-number">0</span> * <span class="hljs-number">3</span>)); 	<span class="hljs-comment">// 10,   6 </span><font></font>
<font></font>
	 ADC1-&gt;CR2 |= ADC_CR2_ADON;<font></font>
<font></font>
	 ADC1-&gt;CR2 |= ADC_CR2_RSTCAL;<font></font>
	 <span class="hljs-keyword">while</span> ((ADC1-&gt;CR2 &amp; ADC_CR2_RSTCAL) == ADC_CR2_RSTCAL) {<font></font>
	 }<font></font>
<font></font>
	 ADC1-&gt;CR2 |= ADC_CR2_CAL;<font></font>
<font></font>
	 <span class="hljs-keyword">while</span> ((ADC1-&gt;CR2 &amp; ADC_CR2_RSTCAL) == ADC_CR2_CAL) {<font></font>
	 }<font></font>
<font></font>
	 ADC1-&gt;SQR1 |= <span class="hljs-number">9</span> &lt;&lt; <span class="hljs-number">20</span>;						<span class="hljs-comment">//  </span>
	 ADC1-&gt;CR1 |= ADC_CR1_SCAN;					<span class="hljs-comment">//  </span>
	 ADC1-&gt;CR2 |= ADC_CR2_DMA;				  	<span class="hljs-comment">// DMA on</span>
	 <span class="hljs-comment">// ADC1-&gt;CR2 |= ADC_CR2_CONT;</span><font></font>
<font></font>
	 <span class="hljs-comment">//  ADC1-&gt;CR2 |= ADC_CR2_SWSTART;</span><font></font>
	 ADC1-&gt;CR2 |= ADC_CR2_ADON;<font></font>
<font></font>
}<font></font>
</code></pre><br>
4.        ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>;<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TIM1_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
	<span class="hljs-comment">/*************** Enable TIM1 (CH1) ***************/</span><font></font>
	RCC-&gt;APB2ENR |= RCC_APB2ENR_TIM1EN;<font></font>
	TIM1-&gt;CCER = <span class="hljs-number">0</span>;										<span class="hljs-comment">//  CCER ( )</span>
	TIM1-&gt;ARR = <span class="hljs-number">1000</span>; 									<span class="hljs-comment">//  ,     </span>
	TIM1-&gt;PSC = <span class="hljs-number">48</span> - <span class="hljs-number">1</span>;                					<span class="hljs-comment">// </span>
	TIM1-&gt;BDTR |= TIM_BDTR_MOE;     					<span class="hljs-comment">//     </span><font></font>
<font></font>
	TIM1-&gt;CCR2 = <span class="hljs-number">0</span>; 									<span class="hljs-comment">//       (  0  TIM1-&gt;ARR)</span>
	TIM1-&gt;CCMR1 |= TIM_CCMR1_OC2M_1 | TIM_CCMR1_OC2M_2; <span class="hljs-comment">//     </span>
	TIM1-&gt;CCER |= (TIM_CCER_CC2P |TIM_CCER_CC2E); 		<span class="hljs-comment">//        </span>
														<span class="hljs-comment">//   -   3</span>
	TIM1-&gt;CCR3 = <span class="hljs-number">0</span>; 									<span class="hljs-comment">//       (  0  TIM1-&gt;ARR)</span>
	TIM1-&gt;CCMR2 |= TIM_CCMR2_OC3M_1 | TIM_CCMR2_OC3M_2; <span class="hljs-comment">//     </span>
	TIM1-&gt;CCER |= TIM_CCER_CC3NE; 						<span class="hljs-comment">//        </span><font></font>
	TIM1-&gt;CCER &amp;= ~TIM_CCER_CC3NP;<font></font>
<font></font>
	TIM1-&gt;CR1 |= TIM_CR1_CEN;<font></font>
}<font></font>
</code></pre><br>
5.  UART  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> </a>     ;<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">UART3_Init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
	RCC-&gt;APB1ENR |= RCC_APB1ENR_USART3EN;<font></font>
<font></font>
	USART3-&gt;BRR = <span class="hljs-number">0xD0</span>;						<span class="hljs-comment">// Speed = 115200; (24 000 000 + (115200 / 2)) / 115200 = 208 -&gt; 0xD0</span><font></font>
<font></font>
	USART3-&gt;CR1 |= USART_CR1_TE | USART_CR1_RE | USART_CR1_UE;<font></font>
<font></font>
<span class="hljs-comment">//	USART3-&gt;CR1 |= USART_CR1_RXNEIE;</span>
<span class="hljs-comment">//	NVIC_EnableIRQ(USART3_IRQn);</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">UART3_Send</span><span class="hljs-params">(<span class="hljs-keyword">char</span> chr)</span> </span>{
	<span class="hljs-keyword">while</span> (!(USART3-&gt;SR &amp; USART_SR_TC))<font></font>
		;<font></font>
	USART3-&gt;DR = chr;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">UART3_Send_String</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* str)</span> </span>{
	<span class="hljs-keyword">uint8_t</span> i = <span class="hljs-number">0</span>;<font></font>
<font></font>
	<span class="hljs-keyword">while</span> (str[i])<font></font>
		UART3_Send(str[i++]);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">UART3_Send_Number_Float</span><span class="hljs-params">(<span class="hljs-keyword">float</span> data)</span></span>{<font></font>
<font></font>
	<span class="hljs-keyword">char</span> str[<span class="hljs-number">100</span>];<font></font>
<font></font>
	<span class="hljs-keyword">char</span> *tmpSign = (data &lt; <span class="hljs-number">0</span>) ? <span class="hljs-string">"-"</span> : <span class="hljs-string">""</span>;
	<span class="hljs-keyword">float</span> tmpVal = (data &lt; <span class="hljs-number">0</span>) ? -data : data;<font></font>
<font></font>
	<span class="hljs-keyword">int</span> tmpInt1 = tmpVal;                  <span class="hljs-comment">// Get the integer (678).</span>
	<span class="hljs-keyword">float</span> tmpFrac = tmpVal - tmpInt1;      <span class="hljs-comment">// Get fraction (0.0123).</span>
	<span class="hljs-keyword">int</span> tmpInt2 = trunc(tmpFrac * <span class="hljs-number">10</span>);  <span class="hljs-comment">// Turn into integer (123).	int tmpInt2 = trunc(tmpFrac * 10000)</span><font></font>
<font></font>
	<span class="hljs-comment">// Print as parts, note that you need 0-padding for fractional bit.</span><font></font>
<font></font>
	<span class="hljs-built_in">sprintf</span> (str, <span class="hljs-string">"%s%d.%01d"</span>, tmpSign, tmpInt1, tmpInt2);<font></font>
<font></font>
	UART3_Send_String(str);<font></font>
}<font></font>
</code></pre><br>
6.     FreeRtos config<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*
 * FreeRTOS Kernel V10.3.1
 * Copyright (C) 2020 Amazon.com, Inc. or its affiliates.  All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * http://www.FreeRTOS.org
 * http://aws.amazon.com/freertos
 *
 * 1 tab == 4 spaces!
 */</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> FREERTOS_CONFIG_H</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREERTOS_CONFIG_H</span><font></font>
<font></font>
<span class="hljs-comment">/* Library includes. */</span>
<span class="hljs-comment">//#include "stm32f10x_lib.h"</span>
<span class="hljs-comment">/*-----------------------------------------------------------
 * Application specific definitions.
 *
 * These definitions should be adjusted for your particular hardware and
 * application requirements.
 *
 * THESE PARAMETERS ARE DESCRIBED WITHIN THE 'CONFIGURATION' SECTION OF THE
 * FreeRTOS API DOCUMENTATION AVAILABLE ON THE FreeRTOS.org WEB SITE. 
 *
 * See http://www.freertos.org/a00110.html
 *----------------------------------------------------------*/</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> vPortSVCHandler SVC_Handler		<span class="hljs-comment">// fix problem</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xPortPendSVHandler PendSV_Handler</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> vPortSVCHandler SVC_Handler</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xPortSysTickHandler SysTick_Handler</span><font></font>
<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configUSE_PREEMPTION		1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configUSE_IDLE_HOOK			0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configUSE_TICK_HOOK			1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configCPU_CLOCK_HZ			( ( unsigned long ) 48000000 )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configTICK_RATE_HZ			( ( TickType_t ) 1000 )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configMAX_PRIORITIES		( 5 )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configMINIMAL_STACK_SIZE	( ( unsigned short ) 32 )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configTOTAL_HEAP_SIZE		( ( size_t ) ( 17 * 1024 ) )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configMAX_TASK_NAME_LEN		( 16 )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configUSE_TRACE_FACILITY	0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configUSE_16_BIT_TICKS		0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configIDLE_SHOULD_YIELD		1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configUSE_MUTEXES			1</span><font></font>
<font></font>
<span class="hljs-comment">/* Co-routine definitions. */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configUSE_CO_ROUTINES 		0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configMAX_CO_ROUTINE_PRIORITIES ( 2 )</span><font></font>
<font></font>
<span class="hljs-comment">/* Set the following definitions to 1 to include the API function, or zero
 to exclude the API function. */</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INCLUDE_vTaskPrioritySet		1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INCLUDE_uxTaskPriorityGet		1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INCLUDE_vTaskDelete				1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INCLUDE_vTaskCleanUpResources	0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INCLUDE_vTaskSuspend			1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INCLUDE_vTaskDelayUntil			1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INCLUDE_vTaskDelay				1</span><font></font>
<font></font>
<span class="hljs-comment">/* This is the raw value as per the Cortex-M3 NVIC.  Values can be 255
 (lowest) to 0 (1?) (highest). */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configKERNEL_INTERRUPT_PRIORITY 		255</span>
<span class="hljs-comment">/* !!!! configMAX_SYSCALL_INTERRUPT_PRIORITY must not be set to zero !!!!
 See http://www.FreeRTOS.org/RTOS-Cortex-M3-M4.html. */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configMAX_SYSCALL_INTERRUPT_PRIORITY 	191 <span class="hljs-comment">/* equivalent to 0xb0, or priority 11. */</span></span><font></font>
<font></font>
<span class="hljs-comment">/* This is the value being used as per the ST library which permits 16
 priority values, 0 to 15.  This must correspond to the
 configKERNEL_INTERRUPT_PRIORITY setting.  Here 15 corresponds to the lowest
 NVIC value of 255. */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> configLIBRARY_KERNEL_INTERRUPT_PRIORITY	15</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* FREERTOS_CONFIG_H */</span></span><font></font>
<font></font>
</code></pre><br>
7.    main;<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"main.h"</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vTaskUART2</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *argument)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vTaskConvADC</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *argument)</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">Motor</span><span class="hljs-params">(<span class="hljs-keyword">int32_t</span> which, <span class="hljs-keyword">int32_t</span> speed, <span class="hljs-keyword">int32_t</span> turn)</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">IndicatorLED</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> number, <span class="hljs-keyword">uint32_t</span> status)</span></span>;<font></font>
<font></font>
<font></font>
<span class="hljs-comment">//define      typedef enum :)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MotorLeft		1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MotorRight		0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MoveBack		0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MoveForward		1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MaxSpeedMotor	1000</span><font></font>
<font></font>
<span class="hljs-keyword">uint16_t</span> adc_buf[<span class="hljs-number">10</span>];				<span class="hljs-comment">// Buffer DMA ADC sensors</span>
<span class="hljs-keyword">uint16_t</span> SensWhiteOrBlack[<span class="hljs-number">10</span>];		<span class="hljs-comment">// Buffer sensors white or black</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
	RCC_Init();<font></font>
	GPIO_Init();<font></font>
	TIM1_Init();<font></font>
	UART3_Init();<font></font>
	ADC_Init();<font></font>
<font></font>
	xTaskCreate(vTaskUART2, <span class="hljs-string">"UART"</span>, <span class="hljs-number">512</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<font></font>
	xTaskCreate(vTaskConvADC, <span class="hljs-string">"ADC"</span>, <span class="hljs-number">128</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
	UART3_Send_String(<span class="hljs-string">"Start program\r\n"</span>);<font></font>
<font></font>
	GPIOA-&gt;BSRR |= GPIO_BSRR_BS10;	<span class="hljs-comment">// Motor enable</span><font></font>
<font></font>
	vTaskStartScheduler();<font></font>
<font></font>
	<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {<font></font>
<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">/*************************************Tasks***************************************/</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vTaskUART2</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *argument)</span> </span>{<font></font>
<font></font>
	<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {<font></font>
<font></font>
<span class="hljs-comment">//-------------------Read sensors from buff DMA ADC, and print to UART3-------------//</span><font></font>
<font></font>
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++)<font></font>
		{<font></font>
<font></font>
			<span class="hljs-keyword">if</span> (adc_buf[i] &lt;= <span class="hljs-number">300</span>)		<span class="hljs-comment">// value sens is white</span><font></font>
			{<font></font>
				IndicatorLED(i, <span class="hljs-number">0</span>);<font></font>
				SensWhiteOrBlack[i] = <span class="hljs-number">0</span>;<font></font>
			} <span class="hljs-keyword">else</span>						<span class="hljs-comment">// else value sens is black</span><font></font>
			{<font></font>
				IndicatorLED(i, <span class="hljs-number">1</span>);<font></font>
				SensWhiteOrBlack[i] = <span class="hljs-number">1</span>;<font></font>
			}<font></font>
<font></font>
<span class="hljs-comment">//			UART3_Send_Number_Float(SensWhiteOrBlack[i]);</span>
<span class="hljs-comment">//			UART3_Send_String("\t");</span><font></font>
		}<font></font>
<span class="hljs-comment">///		UART3_Send_String("\r\n");</span><font></font>
<font></font>
<span class="hljs-comment">//-----------------------------------------Move-----------------------------------------//</span><font></font>
<font></font>
<font></font>
		<span class="hljs-comment">//----Normal mode----//</span>
		<span class="hljs-keyword">float</span> devMotorLeft  = <span class="hljs-number">1</span>;
		<span class="hljs-keyword">float</span> devMotorRight = <span class="hljs-number">1</span>;
		<span class="hljs-keyword">uint32_t</span> flagSizeBuf = <span class="hljs-number">0</span>;<font></font>
<font></font>
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">6</span>; i &lt;= <span class="hljs-number">9</span>; i++)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (SensWhiteOrBlack[i])<font></font>
			{<font></font>
				flagSizeBuf = <span class="hljs-number">1</span>;<font></font>
<font></font>
				<span class="hljs-keyword">if</span>(i == <span class="hljs-number">6</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorRight = <span class="hljs-number">0.75</span>;<font></font>
				}<font></font>
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">7</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorRight = <span class="hljs-number">0.5</span>;<font></font>
				}<font></font>
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">8</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorRight = <span class="hljs-number">0.25</span>;<font></font>
				}<font></font>
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">9</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorRight = <span class="hljs-number">0.0</span>;<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
<font></font>
		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">5</span>; i &gt;= <span class="hljs-number">0</span>; i--)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span>(SensWhiteOrBlack[i])<font></font>
			{<font></font>
				flagSizeBuf = <span class="hljs-number">1</span>;<font></font>
<font></font>
				<span class="hljs-keyword">if</span>(i == <span class="hljs-number">3</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorLeft = <span class="hljs-number">0.75</span>;<font></font>
				}<font></font>
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">2</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorLeft = <span class="hljs-number">0.5</span>;<font></font>
				}<font></font>
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">1</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorLeft = <span class="hljs-number">0.25</span>;<font></font>
				}<font></font>
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">0</span> &amp;&amp; SensWhiteOrBlack[i] == <span class="hljs-number">1</span>)<font></font>
				{<font></font>
					devMotorLeft = <span class="hljs-number">0.0</span>;<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
<font></font>
		<span class="hljs-keyword">if</span>(!flagSizeBuf)<font></font>
		{<font></font>
			devMotorLeft  = <span class="hljs-number">0</span>;<font></font>
			devMotorRight = <span class="hljs-number">0</span>;<font></font>
		}<font></font>
<font></font>
		Motor(MotorRight, (<span class="hljs-keyword">int32_t</span>)(MaxSpeedMotor * (<span class="hljs-keyword">float</span>)devMotorRight), MoveForward);<font></font>
		Motor(MotorLeft,  (<span class="hljs-keyword">int32_t</span>)(MaxSpeedMotor * (<span class="hljs-keyword">float</span>)devMotorLeft),  MoveForward);<font></font>
<font></font>
<font></font>
<span class="hljs-comment">/*
		if (adc_buf[0] &gt; 1000)
		{
			Motor(MotorLeft, 500, MoveBack);
		}
		else if (adc_buf[0] &lt;= 1000)
		{
			Motor(MotorLeft, 0, MoveForward);
		}

		if (adc_buf[9] &gt; 1000)
		{
			Motor(MotorRight, 500, MoveBack);//Motor(0, 500, 1);	MotorRight	MoveBack
		}
		else if (adc_buf[9] &lt;= 1000)
		{
			Motor(MotorRight, 0, MoveForward);
		}
*/</span><font></font>
<font></font>
		vTaskDelay(<span class="hljs-number">50</span>);<font></font>
	}<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vTaskConvADC</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *argument)</span> </span>{<font></font>
<font></font>
	<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {<font></font>
<font></font>
		<span class="hljs-comment">// just void :)</span><font></font>
<font></font>
		vTaskDelay(<span class="hljs-number">5000</span>);<font></font>
	}<font></font>
<font></font>
}<font></font>
<span class="hljs-comment">/**********************************Function*************************************/</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">IndicatorLED</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> number, <span class="hljs-keyword">uint32_t</span> status)</span> </span>{<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">0</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BS9;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">0</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BR9;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">1</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BS8;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">1</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BR8;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">2</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BS7;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">2</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BR7;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">3</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BS6;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">3</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BR6;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">4</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BS5;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">4</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BR5;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">5</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BS4;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">5</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BR4;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">6</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BS3;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">6</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOB-&gt;BSRR |= GPIO_BSRR_BR3;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">7</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOA-&gt;BSRR |= GPIO_BSRR_BS15;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">7</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOA-&gt;BSRR |= GPIO_BSRR_BR15;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">8</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOA-&gt;BSRR |= GPIO_BSRR_BS12;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">8</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOA-&gt;BSRR |= GPIO_BSRR_BR12;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (number == <span class="hljs-number">9</span> &amp;&amp; status == <span class="hljs-number">0</span>) {<font></font>
		GPIOA-&gt;BSRR |= GPIO_BSRR_BS11;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number == <span class="hljs-number">9</span> &amp;&amp; status == <span class="hljs-number">1</span>) {<font></font>
		GPIOA-&gt;BSRR |= GPIO_BSRR_BR11;<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">Motor</span><span class="hljs-params">(<span class="hljs-keyword">int32_t</span> which, <span class="hljs-keyword">int32_t</span> speed, <span class="hljs-keyword">int32_t</span> turn)</span> </span>{<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (which == <span class="hljs-number">0</span>)	<span class="hljs-comment">//Right motor</span><font></font>
	{<font></font>
		UART3_Send_Number_Float(speed);<font></font>
		UART3_Send_String(<span class="hljs-string">"\t"</span>);<font></font>
<font></font>
		<span class="hljs-keyword">if</span> (speed &gt; <span class="hljs-number">0</span> &amp;&amp; speed &lt;= <span class="hljs-number">1000</span>)<font></font>
		{<font></font>
			TIM1-&gt;CCR3 = speed;<font></font>
			<span class="hljs-keyword">if</span> (turn == <span class="hljs-number">0</span>) 	<span class="hljs-comment">// back</span><font></font>
			{<font></font>
				GPIOB-&gt;BSRR |= GPIO_BSRR_BS14;<font></font>
			}<font></font>
			<span class="hljs-keyword">else</span>			<span class="hljs-comment">//forward</span><font></font>
			{<font></font>
				GPIOB-&gt;BSRR |= GPIO_BSRR_BR14;<font></font>
			}<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span>		<span class="hljs-comment">//disable motor</span><font></font>
		{<font></font>
			TIM1-&gt;CCR3 = <span class="hljs-number">0</span>;<font></font>
			GPIOB-&gt;BSRR |= GPIO_BSRR_BR14;<font></font>
<font></font>
		}<font></font>
<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (which == <span class="hljs-number">1</span>)	<span class="hljs-comment">//left motor</span><font></font>
	{<font></font>
		UART3_Send_Number_Float(speed);<font></font>
		UART3_Send_String(<span class="hljs-string">"\r\n"</span>);<font></font>
<font></font>
		<span class="hljs-keyword">if</span> (speed &gt; <span class="hljs-number">0</span> &amp;&amp; speed &lt;= <span class="hljs-number">1000</span>)<font></font>
		{<font></font>
			TIM1-&gt;CCR2 = speed;<font></font>
			<span class="hljs-keyword">if</span> (turn == <span class="hljs-number">1</span>) 	<span class="hljs-comment">// back</span><font></font>
			{<font></font>
				GPIOA-&gt;BSRR |= GPIO_BSRR_BS8;<font></font>
			}<font></font>
			<span class="hljs-keyword">else</span>			<span class="hljs-comment">//forward</span><font></font>
			{<font></font>
				GPIOA-&gt;BSRR |= GPIO_BSRR_BR8;<font></font>
			}<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span>		<span class="hljs-comment">//disable motor</span><font></font>
		{<font></font>
			TIM1-&gt;CCR2 = <span class="hljs-number">0</span>;<font></font>
			GPIOA-&gt;BSRR |= GPIO_BSRR_BS8;<font></font>
<font></font>
		}<font></font>
<font></font>
	}<font></font>
<font></font>
<font></font>
<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*************************************IRQ***************************************/</span>
<span class="hljs-comment">/*
 void USART2_IRQHandler(void) {

 if (USART2-&gt;SR &amp; USART_CR1_RXNEIE) {

 USART2-&gt;SR &amp;= ~USART_CR1_RXNEIE;

 if (USART2-&gt;DR == '0') {
 UART2_Send_String("OFF\r\n");
 GPIOC-&gt;BSRR = GPIO_BSRR_BS13;
 } else if (USART2-&gt;DR == '1') {
 UART2_Send_String("ON\r\n");
 GPIOC-&gt;BSRR = GPIO_BSRR_BR13;
 } else if (USART2-&gt;DR == '2') {
 uint16_t d0 = ADC1-&gt;DR;
 float Vdd = 1.2 * 4069 / d0;
 UART2_Send(Vdd);
 GPIOC-&gt;BSRR = GPIO_BSRR_BR13;
 }
 }
 }
 */</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DMA1_Channel1_IRQHandler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
<font></font>
	DMA1-&gt;IFCR = DMA_IFCR_CGIF1 | DMA_IFCR_CTCIF1;	<span class="hljs-comment">// clear DMA interrupt flags</span>
	DMA1_Channel1-&gt;CCR &amp;= ~DMA_CCR_EN;					<span class="hljs-comment">//  </span>
	<span class="hljs-comment">/*
	 * Code
	 */</span>
	DMA1_Channel1-&gt;CCR |= DMA_CCR_EN;			   <span class="hljs-comment">//  </span><font></font>
	ADC1-&gt;CR2 |= ADC_CR2_ADON;<font></font>
}<font></font>
<font></font>
</code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдереЛрдбрд╝реА рдмрд╛рдд рдХрд░реЛ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрдИ рд╡рд░реНрд╖реЛрдВ рд╕реЗ рдореЗрд░реА рдпреЛрдЬрдирд╛рдУрдВ рдкрд░ рд▓рдЯрдХреА рд╣реБрдИ рд╣реИ рдФрд░ рд╣рд░ рд╕рдордп рдЗрд╕реЗ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдкрдиреЗ рддрд╛рд░реНрдХрд┐рдХ рдирд┐рд╖реНрдХрд░реНрд╖ рдкрд░ рдкрд╣реБрдВрдЪ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдореБрдЭреЗ рдмрд╣реБрдд рдЦреБрд╢реА рд╣реЛ рд░рд╣реА рд╣реИ, рдореИрдВ рдЗрд╕реЗ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдЦреЛрд▓рдирд╛ рдФрд░ рдЗрд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдордВрдЪ / рдирд┐рд░реНрдорд╛рддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдмреЗрдЪрдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛, рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ, рддреЛ рд╕реБрдореЛрдЗрд╕реНрдЯ рдХрд╛ рд░реЛрдмреЛрдЯ рджреВрд░ рдирд╣реАрдВ рд╣реИ, рдФрд░ рд╡рд╣рд╛рдВ рдЕрдиреНрдп рд▓реЛрдЧ рдЬрд╛рдПрдВрдЧреЗред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдЦ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрдИ рдпреЛрдЬрдирд╛ рдирд╣реАрдВ рдереА, рд▓реЗрдХрд┐рди рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдореЗрдВ рднрд╛рдЧ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВ рдлреЛрдЯреЛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд▓рдЧрднрдЧ рднреВрд▓ рдЧрдпрд╛ рдерд╛, рдХреБрдЫ рдШрдЯрдХ рдЕрднреА рддрдХ рдирд╣реАрдВ рдЖрдП рд╣реИрдВ, рдФрд░ рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдХреА рд╕рдордп рд╕реАрдорд╛ рдХрд▓ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ DIY рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдерд╛, рдЗрд╕рдХреЗ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдирд╣реАрдВред</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдмреЛрдЯ рдлреЛрдЯреЛ</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/6f6/961/400/6f6961400a8062733354fd8ac85b41a0.jpg" alt="image"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдпрд╣рд╛рдБ рдПрдХ рдорд┐рдиреА рдкрд░реАрдХреНрд╖рдг рд╡реАрдбрд┐рдпреЛ рд╣реИ</font></font><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Hk-FURUHLvc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi497764/index.html">рдкреАрд╕реА рдФрд░ рдХрдВрд╕реЛрд▓ рдХреЗ рд▓рд┐рдП рдкреЛрд░реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЧреЗрдо рдХреИрд╕реЗ рддреИрдпрд╛рд░ рдХрд░реЗрдВ</a></li>
<li><a href="../hi497768/index.html">рдХреАрдЯрд╛рдгреБрд╢реЛрдзрди рд╕реНрд╡рдЪрд╛рд▓рди</a></li>
<li><a href="../hi497770/index.html">рдкреЗрд╢ рд╣реИ PyCaret: рдПрдХ рдУрдкрди рд▓реЛ-рдХреЛрдб рдкрд╛рдпрдерди рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА</a></li>
<li><a href="../hi497772/index.html">рд╡рд╛рд░реНрдорд┐рдВрдЧ рдореЗрдВ рд╡рд┐рдХрд╛рд╕ - рдореИрдХреНрд╕рд┐рдо рдмреЗрд░рд┐рд╢рд┐рдХреЛрд╡ рдХреЗ рд╕рд╛рде рдмреИрдардХ, рдордВрдЪ рдХреЗ рдкреНрд░рдореБрдЦ (рднрд╛рдЧ II)</a></li>
<li><a href="../hi497780/index.html">рд▓реИрдЯрд┐рди рдЕрдореЗрд░рд┐рдХрд╛ рдореЗрдВ рддреАрди рд╕рд╛рд▓: рдореИрдВ рдПрдХ рд╕рдкрдиреЗ рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ рдирд┐рдХрд▓рд╛ рдФрд░ рдХреБрд▓ "рд░реАрд╕реЗрдЯ" рдХреЗ рдмрд╛рдж рд▓реМрдЯрд╛</a></li>
<li><a href="../hi497784/index.html">рд╣реБрдЖрд╡реЗрдИ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬрд╝ рдЙрдкрдХрд░рдг рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдбреЗрдЯрд╛ рдХреЗрдВрджреНрд░реЛрдВ рдХреЗ рдЖрдзреБрдирд┐рдХ рдЖрдИрд╕реАрдЯреА рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП HiDC рд╕рдорд╛рдзрд╛рди</a></li>
<li><a href="../hi497786/index.html">рдЕрдм рдЬреВрддреЗ рдХреЗ рд╕рд╛рде рдПрдХ shoemaker, рдпрд╛ рд╣рдо рдХреИрд╕реЗ рд╣рдорд╛рд░реЗ рдЕрдкрдиреЗ рд╢реИрд▓реА рдЧрд╛рдЗрдб рдорд┐рд▓рд╛</a></li>
<li><a href="../hi497788/index.html">рдбрд┐рдЬрд╛рдЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╢реАрд░реНрд╖ 10 рдХреНрд░реЛрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди</a></li>
<li><a href="../hi497790/index.html">рд╣рдо рдЖрдкрдХреЛ DINS QA EVENING рдореЗрдВ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: рдкреЛрд╕реНрдЯрдореИрди рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд╡рд░реЗрдЬ рдореВрд▓реНрдпрд╛рдВрдХрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рддреЗ рд╣реБрдП</a></li>
<li><a href="../hi497792/index.html">рдПрдХ рдиреМрд╕рд┐рдЦрд┐рдпрд╛ рд╢реЗрдпрд░ рдирд┐рд╡реЗрд╢рдХ рдХреЗ рдЙрдкрдХрд░рдг: рдЯреЗрд╕реНрдЯ рдПрдХреНрд╕реЗрд╕, рд╕реНрдЯрд╛рд░реНрдЯ рдЯреИрд░рд┐рдл, рдЯреНрд░реЗрдбрд┐рдВрдЧ рдЯрд░реНрдорд┐рдирд▓</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>