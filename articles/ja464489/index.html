<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤷 👨🏿‍🎤 🥛 サンプルのビルドボット 🙅🏽 ☣️ 💘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ソフトウェアパッケージを組み立ててGitリポジトリからサイトに配信するプロセスをセットアップする必要がありました。そして、それほど昔ではないが、ここHabrでビルドボットに関する記事（最後のリンク）を見て、これを試して適用することにしました。
 

buildbotは分散システムであるため、各アーキ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>サンプルのビルドボット</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464489/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソフトウェアパッケージを組み立ててGitリポジトリからサイトに配信するプロセスをセットアップする必要がありました。</font><font style="vertical-align: inherit;">そして、それほど昔ではないが、ここHabrでビルドボットに関する記事（最後のリンク）を見て、これを試して適用することにしました。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buildbotは分散システムであるため、各アーキテクチャとOSが個別のアセンブリホストを作成することは論理的です。</font><font style="vertical-align: inherit;">私たちの場合、これらはLXCコンテナー（Linuxの場合）とqemu（Windowsの場合）になります。</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vm-srv-build1-centos 7、buildbotマスターとワーカーの1つがあります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vm-srv-build2-DEBパッケージをビルドするためのdebian 10</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vm-srv-build3-Windows 10、アセンブリについて、あなたはあなた自身が何を理解しています</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーのクラスターを管理するための1C racのグラフィカルな面である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rac GUI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を収集し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">Linuxの場合、各OSの標準ツールが使用され、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freewrapを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用して、tclスクリプトからWindows用のexeファイルが作成されます</font><font style="vertical-align: inherit;">。</font></font></p><a name="habracut"></a><br>
<h3 id="ustanovka"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取り付け</font></font></h3><br>
<h4 id="gnulinux"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU / Linux</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストールの場合は、ネットワーク上のドキュメントは十分です</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そしてそれは特別な問題を引き起こしません：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マスターのために：</font></font></p><br>
<pre><code class="bash hljs">pip3 install buildbot<font></font>
pip3 install twisted<font></font>
pip3 install autobahn<font></font>
pip3 install pysqlite3<font></font>
pip3 install sqlalchemy sqlalchemy-migrate<font></font>
pip3 install buildbot-www buildbot-grid-view buildbot-console-view buildbot-waterfall-view<font></font>
pip3 install python-dateutil</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「労働者」にとってはこれで十分です：</font></font></p><br>
<pre><code class="bash hljs">pip3 install buildbot-worker</code></pre><br>
<p>,        ,       .       ,  ,   ProxMox VE.            (centos: rpmdevtools  .; debian: build-essential, dh-make, pbuilder  ..)</p><br>
<p>    buildbot      ,       ,   :</p><br>
<pre><code class="bash hljs">
adduser buildbot</code></pre><br>
<p>    ,      ():</p><br>
<p>Systemd    :</p><br>
<pre><code class="bash hljs">touch /etc/systemd/buildbot-master.service <font></font>
<font></font>
[Unit]<font></font>
Description=BuildBot master service<font></font>
After=network.target<font></font>
<font></font>
[Service]<font></font>
User=buildbot<font></font>
Group=buildbot<font></font>
WorkingDirectory=/home/buildbot/master<font></font>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/buildbot start --nodaemon<font></font>
ExecReload=/bin/<span class="hljs-built_in">kill</span> -HUP <span class="hljs-variable">$MAINPID</span><font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br>
<p> ""</p><br>
<pre><code class="bash hljs">touch /etc/systemd/buildbot-worker.service <font></font>
<font></font>
[Unit]<font></font>
Description=BuildBot worker service<font></font>
After=network.target<font></font>
<font></font>
[Service]master<font></font>
User=buildbot<font></font>
Group=buildbot<font></font>
WorkingDirectory=/home/buildbot/worker<font></font>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/buildbot-worker start --nodaemon<font></font>
<font></font>
[Install]<font></font>
WantedBy=buildbot-master.service</code></pre><br>
<p>    (  )   /usr/local/,         :</p><br>
<pre><code class="bash hljs">nano /root/.bash_profile<font></font>
<font></font>
PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$HOME</span>/.<span class="hljs-built_in">local</span>/bin:<span class="hljs-variable">$HOME</span>/bin:/usr/<span class="hljs-built_in">local</span>/bin</code></pre><br>
<p> ,      "" (  ),      buildbot    :</p><br>
<p>   vm-srv-build1:</p><br>
<pre><code class="bash hljs">su - buildbot<font></font>
mkdir /home/buildbot/worker<font></font>
<span class="hljs-built_in">cd</span> ~<font></font>
buildbot-worker create-worker --<span class="hljs-built_in">umask</span>=0o22 --keepalive=60 worker vm-srv-build1:4000 CentOS 123456</code></pre><br>
<p>   vm-srv-build2:</p><br>
<pre><code class="bash hljs">su - buildbot<font></font>
mkdir /home/buildbot/worker<font></font>
<span class="hljs-built_in">cd</span> ~<font></font>
buildbot-worker create-worker --<span class="hljs-built_in">umask</span>=0o22 --keepalive=60 worker vm-srv-build1:4000 Debian-10 123456</code></pre><br>
<p> -  buildbot-worker  </p><br>
<pre><code class="bash hljs">systemctl start buildbot-worker</code></pre><br>
<h4 id="ms-windows">MS Windows</h4><br>
<p>  ""    windows,        Win10.<br>
  :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Python</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">PyWIN</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Git</a></li>
<li>  -     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Build Tools for Visual Studio 2019</a></li>
<li>7Zip</li>
</ul><br>
<p> ,    ,     buildbot:</p><br>
<pre><code class="bash hljs">pip install buildbot-worker</code></pre><br>
<p>  </p><br>
<pre><code class="bash hljs">md c:\worker</code></pre><br>
<p> </p><br>
<pre><code class="bash hljs">buildbot-worker start c:\worker</code></pre><br>
<p>   (.  c:\worker\twistd.log),    "",   ,        (   powershell    ):</p><br>
<pre><code class="bash hljs">buildbot_worker_windows_service.exe --user VM-SRV-BUILD3\buildbot --password 123456 --startup auto install<font></font>
New-ItemProperty -path Registry::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\BuildBot\Parameters -Name directories -PropertyType String -Value c:\worker<font></font>
</code></pre><br>
<p>   </p><br>
<pre><code class="bash hljs">Start-Service buildbot</code></pre><br>
<p> ""   ,     ,     .</p><br>
<h3 id="nastroyka-mastera"> </h3><br>
<p> ,     (  ),      buildbot    :</p><br>
<pre><code class="bash hljs">su - buildbot<font></font>
mkdir /home/buildbot/master<font></font>
<span class="hljs-built_in">cd</span> ~<font></font>
buildbot create-master master</code></pre><br>
<p>     builds</p><br>
<pre><code class="bash hljs">mkdir /home/buildbot/builds</code></pre><br>
<p>  /home/buildbot/master/    master.cfg.       python       ,       .</p><br>
<pre><code class="bash hljs">nano /home/buildbot/master/master.cfg</code></pre><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os, re
<span class="hljs-keyword">from</span> buildbot.plugins <span class="hljs-keyword">import</span> steps, util, schedulers, worker, changes, reporters<font></font>
<font></font>
c= BuildmasterConfig ={}<font></font>
<font></font>
<span class="hljs-comment">#   .</span>
c[<span class="hljs-string">'workers'</span>] = [ worker.Worker(<span class="hljs-string">'CentOS'</span>, <span class="hljs-string">'123456'</span>), worker.Worker(<span class="hljs-string">'Debian-10'</span>, <span class="hljs-string">'123456'</span>), worker.Worker(<span class="hljs-string">'Windows-10'</span>, <span class="hljs-string">'123456'</span>)]<font></font>
c[<span class="hljs-string">'protocols'</span>] = {<span class="hljs-string">'pb'</span>: {<span class="hljs-string">'port'</span>: <span class="hljs-number">4000</span>}} <font></font>
<font></font>
<span class="hljs-comment">#     </span>
c[<span class="hljs-string">'change_source'</span>] = []<font></font>
c[<span class="hljs-string">'change_source'</span>].append(changes.GitPoller(<font></font>
       repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
       project = <span class="hljs-string">'Rac-GUI'</span>,<font></font>
       branches = <span class="hljs-literal">True</span>,<font></font>
       pollInterval = <span class="hljs-number">60</span><font></font>
      )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#   </span>
c[<span class="hljs-string">'schedulers'</span>] = []<font></font>
c[<span class="hljs-string">'schedulers'</span>].append(schedulers.SingleBranchScheduler(<font></font>
       name=<span class="hljs-string">"Rac-GUI-schedulers"</span>,<font></font>
       change_filter=util.ChangeFilter(branch=<span class="hljs-string">'master'</span>),<font></font>
       builderNames=[<span class="hljs-string">"Rac-GUI-RPM-builder"</span>, <span class="hljs-string">"Rac-GUI-DEB-builder"</span>, <span class="hljs-string">"Rac-GUI-WIN-builder"</span>],<font></font>
       properties = {<span class="hljs-string">'owner'</span>: <span class="hljs-string">'admin'</span>}<font></font>
       )<font></font>
)<font></font>
<span class="hljs-meta">@util.renderer</span><font></font>
<font></font>
<span class="hljs-comment">######################################3</span>
<span class="hljs-comment">#  RPM-</span><font></font>
 rac_gui_build_RPM = util.BuildFactory()<font></font>
<font></font>
rac_gui_build_RPM.addStep(steps.Git(<font></font>
       repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
       workdir = <span class="hljs-string">'rac-gui'</span>,<font></font>
       haltOnFailure = <span class="hljs-literal">True</span>,<font></font>
       submodules = <span class="hljs-literal">True</span>,<font></font>
       mode=<span class="hljs-string">'full'</span>,<font></font>
       progress = <span class="hljs-literal">True</span>)<font></font>
)</code></pre><br>
<p>     ,        master.cfg,     rac_gui.tcl  ,       :</p><br>
<pre><code class="python hljs"><span class="hljs-comment">######################################################</span>
<span class="hljs-comment">#        Rac GUI</span><font></font>
...<font></font>
<span class="hljs-comment"># version: 1.0.3</span>
<span class="hljs-comment"># release: 1</span></code></pre><br>
<p>     buildbot   .   ,    grep.  buildbot       "" (  ,    ).     (property). ..   ,         ,   version  release.     ,       :</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#      </span><font></font>
rac_gui_build_RPM.addStep(<font></font>
       steps.SetPropertyFromCommand(<font></font>
       command=<span class="hljs-string">"grep version ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'"</span>, property=<span class="hljs-string">"version"</span><font></font>
       )<font></font>
)<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_RPM.addStep(<font></font>
       steps.SetPropertyFromCommand(<font></font>
       command=<span class="hljs-string">"grep release ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'"</span>, property=<span class="hljs-string">"release"</span><font></font>
       )<font></font>
)</code></pre><br>
<p>      util.Interpolate().</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#  </span><font></font>
rac_gui_build_RPM.addStep(<font></font>
       steps.ShellCommand(<font></font>
          command=[<span class="hljs-string">"tar"</span>, <span class="hljs-string">"czf"</span>, util.Interpolate(<span class="hljs-string">"/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>), <span class="hljs-string">"../rac-gui"</span>]<font></font>
       )<font></font>
)</code></pre><br>
<p>   ,         ,       .</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#  spec</span><font></font>
rac_gui_build_RPM.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"cp"</span>, <span class="hljs-string">"../rac-gui/rac_gui.spec"</span>, <span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>]))</code></pre><br>
<p>          sed, ..     spec-  </p><br>
<pre><code class="python hljs"><span class="hljs-comment">#  </span><font></font>
rac_gui_build_RPM.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, util.Interpolate(<span class="hljs-string">"s/.*Version:.*/Version:\t%(prop:version)s/"</span>), <span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>]))
<span class="hljs-comment">#  </span><font></font>
rac_gui_build_RPM.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, util.Interpolate(<span class="hljs-string">"s/.*Release:.*/Release:\t%(prop:release)s/"</span>), <span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
rac_gui_build_RPM.addStep(steps.RpmBuild(<font></font>
       specfile=<span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>,<font></font>
       dist=<span class="hljs-string">'.el5'</span>,<font></font>
       topdir=<span class="hljs-string">'/home/buildbot/rpmbuild'</span>,<font></font>
       builddir=<span class="hljs-string">'/home/buildbot/rpmbuild/build'</span>,<font></font>
       rpmdir=<span class="hljs-string">'/home/buildbot/rpmbuild/RPMS'</span>,<font></font>
       sourcedir=<span class="hljs-string">'/home/buildbot/rpmbuild/SOURCES'</span><font></font>
      )<font></font>
)</code></pre><br>
<p>         .              .</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#    </span><font></font>
rac_gui_build_RPM.addStep(<font></font>
       steps.FileUpload(<font></font>
          workersrc=util.Interpolate(<span class="hljs-string">"/home/buildbot/rpmbuild/RPMS/noarch/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>),<font></font>
          masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>)<font></font>
      )<font></font>
)<font></font>
<font></font>
rac_gui_build_RPM.addStep(<font></font>
       steps.FileUpload(<font></font>
       workersrc=util.Interpolate(<span class="hljs-string">"/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>),<font></font>
          masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>)<font></font>
       )<font></font>
)</code></pre><br>
<p>          .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  tcl.</p><br>
<pre><code class="python hljs">rac_gui_build_RPM.addStep(<font></font>
        steps.MasterShellCommand(<font></font>
            command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
                util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>),<font></font>
                util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>)]<font></font>
        )<font></font>
)<font></font>
<font></font>
rac_gui_build_RPM.addStep(<font></font>
        steps.MasterShellCommand(<font></font>
            command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
                util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>),<font></font>
                util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>)]<font></font>
        )<font></font>
)</code></pre><br>
<p>   RPM .       DEB-.            ,      .</p><br>
<pre><code class="python hljs"><font></font>
rac_gui_build_DEB = util.BuildFactory()<font></font>
<font></font>
rac_gui_build_DEB.addStep(steps.Git(<font></font>
       repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
       haltOnFailure = <span class="hljs-literal">True</span>,<font></font>
       submodules = <span class="hljs-literal">True</span>,<font></font>
       mode=<span class="hljs-string">'full'</span>,<font></font>
       workdir=<span class="hljs-string">'build'</span>,<font></font>
       progress = <span class="hljs-literal">True</span>)<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_DEB.addStep(<font></font>
       steps.SetPropertyFromCommand(<font></font>
       command=<span class="hljs-string">"grep version rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'"</span>, property=<span class="hljs-string">"version"</span><font></font>
       )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_DEB.addStep(<font></font>
       steps.SetPropertyFromCommand(<font></font>
       command=<span class="hljs-string">"grep release rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'"</span>, property=<span class="hljs-string">"release"</span><font></font>
       )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
    rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"mv"</span>, <span class="hljs-string">"rac_gui.tcl"</span>, <span class="hljs-string">"racgui"</span>]))</code></pre><br>
<p> RPM-      rpm      ,      :</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#    </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, <span class="hljs-string">"s+^set\ dir(lib)+set\ dir(lib)\ /usr/share/rac-gui/lib ;#+g"</span>, <span class="hljs-string">"racgui"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, <span class="hljs-string">"s+\[pwd\]+/usr/share/rac-gui+g"</span>, <span class="hljs-string">"racgui"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"tar"</span>, <span class="hljs-string">"czf"</span>, util.Interpolate(<span class="hljs-string">"../rac-gui_%(prop:version)s.orig.tar.gz"</span>), <span class="hljs-string">"."</span>]))<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"dpkg-buildpackage"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_DEB.addStep(<font></font>
       steps.FileUpload(<font></font>
       workersrc=util.Interpolate(<span class="hljs-string">"../rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>),<font></font>
           masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>)<font></font>
       )<font></font>
)<font></font>
rac_gui_build_DEB.addStep(<font></font>
        steps.MasterShellCommand(<font></font>
            command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
             util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>),<font></font>
             util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>)]<font></font>
        )<font></font>
)</code></pre><br>
<p>  DEB ,  windows!</p><br>
<pre><code class="python hljs">rac_gui_build_WIN = util.BuildFactory()<font></font>
<font></font>
rac_gui_build_WIN.addStep(steps.Git(<font></font>
       repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
       haltOnFailure = <span class="hljs-literal">True</span>,<font></font>
       submodules = <span class="hljs-literal">True</span>,<font></font>
       mode=<span class="hljs-string">'full'</span>,<font></font>
       workdir=<span class="hljs-string">'build'</span>,<font></font>
       progress = <span class="hljs-literal">True</span>)<font></font>
)</code></pre><br>
<p>   windows   grep  sed ( ?)    powershell</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#      </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
       steps.SetPropertyFromCommand(<font></font>
       command=<span class="hljs-string">"powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'version:') -split '\\s')[2]"</span>,<font></font>
       property=<span class="hljs-string">"version"</span><font></font>
       )<font></font>
    )<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
       steps.SetPropertyFromCommand(<font></font>
       command=<span class="hljs-string">"powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'release:') -split '\\s')[2]"</span>,<font></font>
       property=<span class="hljs-string">"release"</span><font></font>
       )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
rac_gui_build_WIN.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"c:\\bin\\freewrap.exe"</span>, <span class="hljs-string">"rac_gui.tcl"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#  ,  </span><font></font>
rac_gui_build_WIN.addStep(steps.ShellCommand(<font></font>
       command=[<span class="hljs-string">"c:\\Program Files\\7-zip\\7z.exe"</span>, <span class="hljs-string">"a"</span>, <span class="hljs-string">"-r"</span>, util.Interpolate(<span class="hljs-string">"..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>), <span class="hljs-string">"..\\build"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
       steps.FileUpload(<font></font>
       workersrc=util.Interpolate(<span class="hljs-string">"..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>),<font></font>
           masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>)<font></font>
       )<font></font>
)<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
        steps.MasterShellCommand(<font></font>
            command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
            util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>),<font></font>
            util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>)]<font></font>
       )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#       </span>
c[<span class="hljs-string">'builders'</span>] = [<font></font>
        util.BuilderConfig(name=<span class="hljs-string">"Rac-GUI-RPM-builder"</span>, workername=<span class="hljs-string">'CentOS'</span>, factory=rac_gui_build_RPM),<font></font>
        util.BuilderConfig(name=<span class="hljs-string">"Rac-GUI-DEB-builder"</span>, workername=<span class="hljs-string">'Debian-10'</span>, factory=rac_gui_build_DEB),<font></font>
        util.BuilderConfig(name=<span class="hljs-string">"Rac-GUI-WIN-builder"</span>, workername=<span class="hljs-string">'Windows-10'</span>, factory=rac_gui_build_WIN),<font></font>
]</code></pre><br>
<p>         </p><br>
<pre><code class="python hljs">
c[<span class="hljs-string">'services'</span>] = []<font></font>
<font></font>
template=<span class="hljs-string">u'''\
    &lt;h4&gt;Build status: {{ summary }}&lt;/h4&gt;
    &lt;p&gt; Worker used: {{ workername }}&lt;/p&gt;
    {% for step in build['steps'] %}
    &lt;p&gt; {{ step['name'] }}: {{ step['result'] }}&lt;/p&gt;
    {% endfor %}
    &lt;p&gt;&lt;b&gt; -- The Buildbot&lt;/b&gt;&lt;/p&gt;
    '''</span><font></font>
<font></font>
mailNotifier = reporters.MailNotifier(fromaddr=<span class="hljs-string">"builder@domain.ru"</span>,<font></font>
             sendToInterestedUsers=<span class="hljs-literal">False</span>,<font></font>
             mode=(<span class="hljs-string">'all'</span>),<font></font>
             extraRecipients=[<span class="hljs-string">"admin@domain.ru"</span>],<font></font>
             relayhost=<span class="hljs-string">"mail.domain.ru"</span>,<font></font>
             smtpPort=<span class="hljs-number">587</span>,<font></font>
             smtpUser=<span class="hljs-string">"builder@domain.ru"</span>,<font></font>
             smtpPassword=<span class="hljs-string">"******"</span>,<font></font>
             messageFormatter=reporters.MessageFormatter(<font></font>
                                 template=template, template_type=<span class="hljs-string">'html'</span>,<font></font>
                                 wantProperties=<span class="hljs-literal">True</span>, wantSteps=<span class="hljs-literal">True</span>))<font></font>
<font></font>
c[<span class="hljs-string">'services'</span>].append(mailNotifier)<font></font>
<font></font>
<span class="hljs-comment">#   </span>
c[<span class="hljs-string">'title'</span>] = <span class="hljs-string">"The process of bulding"</span>
c[<span class="hljs-string">'titleURL'</span>] = <span class="hljs-string">"http://vm-srv-build1:80/"</span>
c[<span class="hljs-string">'buildbotURL'</span>] = <span class="hljs-string">"http://vm-srv-build1/"</span>
c[<span class="hljs-string">'www'</span>] = dict(port=<span class="hljs-number">80</span>,<font></font>
                plugins=dict(waterfall_view={}, console_view={}, grid_view={}))<font></font>
c[<span class="hljs-string">'db'</span>] = {
       <span class="hljs-string">'db_url'</span> : <span class="hljs-string">"sqlite:///state.sqlite"</span>
}</code></pre><br>
<p>       :</p><br>
<pre><code class="bash hljs">systemctl restart buildbot-master</code></pre><br>
<p>              .      ,     '''''/home/buildbot/master/twistd.log'''''   :</p><br>
<pre><code class="plaintext hljs"> 2019-07-24 16:50:35+0300 [-] Loading buildbot.tac...<font></font>
 2019-07-24 16:50:35+0300 [-] Loaded.<font></font>
 2019-07-24 16:50:35+0300 [-] twistd 19.2.1 (/usr/bin/python3.6 3.6.8) starting up.<font></font>
 2019-07-24 16:50:35+0300 [-] reactor class: twisted.internet.epollreactor.EPollReactor.<font></font>
 2019-07-24 16:50:35+0300 [-] Starting BuildMaster -- buildbot.version: 2.3.1<font></font>
 2019-07-24 16:50:35+0300 [-] Loading configuration from '/home/buildbot/master/master.cfg'<font></font>
 2019-07-24 16:50:36+0300 [-] /usr/local/lib/python3.6/site-packages/buildbot/config.py:90: buildbot.config.ConfigWarning: [0.9.0 and later] `buildbotNetUsageData` is not configured and defaults to basic.<font></font>
        This parameter helps the buildbot development team to understand the installation base.<font></font>
        No personal information is collected.<font></font>
        Only installation software version info and plugin usage is sent.<font></font>
        You can `opt-out` by setting this variable to None.<font></font>
        Or `opt-in` for more information by setting it to "full".<font></font>
<font></font>
 2019-07-24 16:50:36+0300 [-] Setting up database with URL 'sqlite:/state.sqlite'<font></font>
 2019-07-24 16:50:36+0300 [-] setting database journal mode to 'wal'<font></font>
 2019-07-24 16:50:36+0300 [-] adding 1 new services, removing 0<font></font>
 2019-07-24 16:50:36+0300 [-] adding 1 new change_sources, removing 0<font></font>
 2019-07-24 16:50:36+0300 [-] gitpoller: using workdir '/home/buildbot/master/gitpoller-work'<font></font>
 2019-07-24 16:50:36+0300 [-] adding 3 new builders, removing 0<font></font>
 2019-07-24 16:50:36+0300 [-] adding 1 new schedulers, removing 0<font></font>
 2019-07-24 16:50:36+0300 [-] initializing www plugin 'waterfall_view'<font></font>
 2019-07-24 16:50:36+0300 [-] initializing www plugin 'console_view'<font></font>
 2019-07-24 16:50:36+0300 [-] initializing www plugin 'grid_view'<font></font>
 2019-07-24 16:50:36+0300 [-] NOTE: www plugin 'sitenav' is installed but not configured<font></font>
 2019-07-24 16:50:36+0300 [-] initializing www plugin 'waterfall_view'<font></font>
 2019-07-24 16:50:36+0300 [-] initializing www plugin 'console_view'<font></font>
 2019-07-24 16:50:36+0300 [-] initializing www plugin 'grid_view'<font></font>
 2019-07-24 16:50:36+0300 [-] NOTE: www plugin 'sitenav' is installed but not configured<font></font>
 2019-07-24 16:50:36+0300 [-] BuildbotSite starting on 80<font></font>
 2019-07-24 16:50:36+0300 [-] Starting factory &lt;buildbot.www.service.BuildbotSite object at 0x7fe31c2657b8&gt;<font></font>
 2019-07-24 16:50:36+0300 [-] adding 3 new workers, removing 0<font></font>
 2019-07-24 16:50:36+0300 [-] PBServerFactory starting on 4000<font></font>
 2019-07-24 16:50:36+0300 [-] Starting factory &lt;twisted.spread.pb.PBServerFactory object at 0x7fe31c147470&gt;<font></font>
 2019-07-24 16:50:37+0300 [-] BuildMaster is running<font></font>
 2019-07-24 16:50:37+0300 [-] buildbotNetUsageData: sending {'installid': 'b6193b126b96689351d2fe95787c5a03fc0879f9', 'versions': {'Python': '3.6.8', 'Buildbot': '2.3.1', 'Twisted': '19.2.1'}, 'platform': {'platform': 'Linux-4.15.18-10- pve-x86_64-with-centos-7.6.1810-Core', 'system': 'Linux', 'machine': 'x86_64', 'processor': 'x86_64', 'python_implementation': 'CPython', 'version': '#1 SMP PVE 4.15.18-32', 'distro': 'centos:7'}, 'plugins': {'buildbot/worker/base/Worker': 3, 'buildbot/config/BuilderConfig': 3, 'buildbot/schedulers/basic/SingleBranchScheduler': 1, 'buildbot/reporters/mail/MailNotifier': 1, 'buildbot/changes/gitpoller/GitPoller': 1, 'buildbot/steps/worker/MakeDirectory': 1, 'buildbot/steps/source/git/Git': 3, 'buildbot/steps/shell/ShellCommand': 9, 'buildbot/steps/package/rpm/rpmbuild/RpmBuild': 1}, 'db': 'sqlite', 'mq': 'simple', 'www_plugins': ['waterfall_view', 'console_view', 'grid_view']}<font></font>
 2019-07-24 16:50:37+0300 [Broker,0,127.0.0.1] worker 'CentOS' attaching from IPv4Address(type='TCP', host='127.0.0.1', port=37332)<font></font>
 2019-07-24 16:50:37+0300 [Broker,0,127.0.0.1] Got workerinfo from 'CentOS'<font></font>
 2019-07-24 16:50:37+0300 [-] bot attached<font></font>
 2019-07-24 16:50:37+0300 [Broker,0,127.0.0.1] Worker CentOS attached to Rac-GUI-RPM-builder<font></font>
 2019-07-24 16:50:37+0300 [-] buildbotNetUsageData: buildbot.net said: ok<font></font>
 2019-07-24 16:50:39+0300 [Broker,1,192.168.55.15] worker 'Windows-10' attaching from IPv4Address(type='TCP', host='192.168.5.145', port=49831)<font></font>
 2019-07-24 16:50:39+0300 [Broker,1,192.168.55.15] Got workerinfo from 'Windows-10'<font></font>
 2019-07-24 16:50:40+0300 [-] bot attached<font></font>
 2019-07-24 16:50:40+0300 [Broker,1,192.168.55.15] Worker Windows-10 attached to Rac-GUI-WIN-builder<font></font>
 2019-07-24 16:50:41+0300 [Broker,2,192.168.55.99] worker 'Debian-10' attaching from IPv4Address(type='TCP', host='192.168.5.9', port=44430)<font></font>
 2019-07-24 16:50:41+0300 [Broker,2,192.168.55.99] Got workerinfo from 'Debian-10'<font></font>
 2019-07-24 16:50:41+0300 [-] bot attached<font></font>
 2019-07-24 16:50:41+0300 [Broker,2,192.168.55.99] Worker Debian-10 attached to Rac-GUI-DEB-builder</code></pre><br>
<p>    .      -e.      ,     -     ..</p><br>
<p>         "Builds" -&gt; "Workers"</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/425/92a/182/42592a182ecbe305bea2bff87c28755e.png" alt="画像"></p><br>
<p> ,       (..   Git-),      .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/614/d81/2a1/614d812a145d9f25d7267d71de13c678.png" alt="画像"></p><br>
<p>             ,    ,    ..</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/aeb/945/d73/aeb945d73a63cb5b3ead878ebf6fe774.png" alt="画像"></p><br>
<div class="spoiler"><b class="spoiler_title">     </b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os, re
<span class="hljs-keyword">from</span> buildbot.plugins <span class="hljs-keyword">import</span> steps, util, schedulers, worker, changes, reporters<font></font>
<font></font>
c= BuildmasterConfig ={}<font></font>
<font></font>
c[<span class="hljs-string">'workers'</span>] = [ worker.Worker(<span class="hljs-string">'CentOS'</span>, <span class="hljs-string">'123456'</span>), worker.Worker(<span class="hljs-string">'Debian-10'</span>, <span class="hljs-string">'123456'</span>), worker.Worker(<span class="hljs-string">'Windows-10'</span>, <span class="hljs-string">'123456'</span>)]<font></font>
c[<span class="hljs-string">'protocols'</span>] = {<span class="hljs-string">'pb'</span>: {<span class="hljs-string">'port'</span>: <span class="hljs-number">4000</span>}} <font></font>
<font></font>
c[<span class="hljs-string">'change_source'</span>] = []<font></font>
c[<span class="hljs-string">'change_source'</span>].append(changes.GitPoller(<font></font>
    repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
    project = <span class="hljs-string">'Rac-GUI'</span>,<font></font>
    branches = <span class="hljs-literal">True</span>,<font></font>
    pollInterval = <span class="hljs-number">600</span><font></font>
    ))<font></font>
<font></font>
<span class="hljs-comment">#   </span>
c[<span class="hljs-string">'schedulers'</span>] = []<font></font>
c[<span class="hljs-string">'schedulers'</span>].append(schedulers.SingleBranchScheduler(<font></font>
    name=<span class="hljs-string">"Rac-GUI-schedulers"</span>,<font></font>
    change_filter=util.ChangeFilter(branch=<span class="hljs-string">'master'</span>),<font></font>
    builderNames=[<span class="hljs-string">"Rac-GUI-RPM-builder"</span>, <span class="hljs-string">"Rac-GUI-DEB-builder"</span>, <span class="hljs-string">"Rac-GUI-WIN-builder"</span>],<font></font>
    properties = {<span class="hljs-string">'owner'</span>: <span class="hljs-string">'admin'</span>}<font></font>
    ))<font></font>
<span class="hljs-meta">@util.renderer</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_name_version_release</span>(<span class="hljs-params">props</span>):</span>
    prog_name = <span class="hljs-string">"rac-gui"</span>
    prog_version = <span class="hljs-string">"1.0.3"</span>
    prog_release = <span class="hljs-string">"3"</span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> {
    <span class="hljs-string">"prog_name"</span>: prog_name
    <span class="hljs-comment">#"prog_version": prog_version,</span>
    <span class="hljs-comment">#"prog_release": prog_release</span><font></font>
}<font></font>
<font></font>
rac_gui_build_RPM = util.BuildFactory()<font></font>
<font></font>
rac_gui_build_RPM.addStep(steps.Git(<font></font>
    repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
    workdir = <span class="hljs-string">'rac-gui'</span>,<font></font>
    haltOnFailure = <span class="hljs-literal">True</span>,<font></font>
    submodules = <span class="hljs-literal">True</span>,<font></font>
    mode=<span class="hljs-string">'full'</span>,<font></font>
    progress = <span class="hljs-literal">True</span>)<font></font>
    )<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_RPM.addStep(<font></font>
    steps.SetPropertyFromCommand(<font></font>
    command=<span class="hljs-string">"grep version ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'"</span>, property=<span class="hljs-string">"version"</span><font></font>
    )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_RPM.addStep(<font></font>
    steps.SetPropertyFromCommand(<font></font>
    command=<span class="hljs-string">"grep release ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'"</span>, property=<span class="hljs-string">"release"</span><font></font>
    )<font></font>
)<font></font>
<font></font>
rac_gui_build_RPM.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"tar"</span>, <span class="hljs-string">"czf"</span>, util.Interpolate(<span class="hljs-string">"/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>), <span class="hljs-string">"../rac-gui"</span>]))<font></font>
<font></font>
rac_gui_build_RPM.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"cp"</span>, <span class="hljs-string">"../rac-gui/rac_gui.spec"</span>, <span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>]))<font></font>
<font></font>
rac_gui_build_RPM.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, util.Interpolate(<span class="hljs-string">"s/.*Version:.*/Version:\t%(prop:version)s/"</span>), <span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>]))<font></font>
<font></font>
rac_gui_build_RPM.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, util.Interpolate(<span class="hljs-string">"s/.*Release:.*/Release:\t%(prop:release)s/"</span>), <span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>]))<font></font>
<font></font>
rac_gui_build_RPM.addStep(steps.RpmBuild(<font></font>
    specfile=<span class="hljs-string">"/home/buildbot/rpmbuild/SPECS/rac_gui.spec"</span>,<font></font>
    dist=<span class="hljs-string">'.el5'</span>,<font></font>
    topdir=<span class="hljs-string">'/home/buildbot/rpmbuild'</span>,<font></font>
    builddir=<span class="hljs-string">'/home/buildbot/rpmbuild/build'</span>,<font></font>
    rpmdir=<span class="hljs-string">'/home/buildbot/rpmbuild/RPMS'</span>,<font></font>
    sourcedir=<span class="hljs-string">'/home/buildbot/rpmbuild/SOURCES'</span><font></font>
    ))<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_RPM.addStep(<font></font>
    steps.FileUpload(<font></font>
    workersrc=util.Interpolate(<span class="hljs-string">"/home/buildbot/rpmbuild/RPMS/noarch/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>),<font></font>
        masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>)<font></font>
    )<font></font>
)<font></font>
<font></font>
rac_gui_build_RPM.addStep(<font></font>
    steps.FileUpload(<font></font>
    workersrc=util.Interpolate(<span class="hljs-string">"/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>),<font></font>
        masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>)<font></font>
    )<font></font>
)<font></font>
<font></font>
rac_gui_build_RPM.addStep(<font></font>
    steps.MasterShellCommand(<font></font>
    command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
     util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>),<font></font>
     util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span>)]<font></font>
    )<font></font>
)<font></font>
<font></font>
rac_gui_build_RPM.addStep(<font></font>
    steps.MasterShellCommand(<font></font>
    command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
     util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>),<font></font>
     util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span>)]<font></font>
    )<font></font>
)<font></font>
<span class="hljs-comment">####################################</span>
<span class="hljs-comment">##      DEB </span>
<span class="hljs-comment">####################################</span><font></font>
<font></font>
rac_gui_build_DEB = util.BuildFactory()<font></font>
<font></font>
rac_gui_build_DEB.addStep(steps.Git(<font></font>
    repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
    haltOnFailure = <span class="hljs-literal">True</span>,<font></font>
    submodules = <span class="hljs-literal">True</span>,<font></font>
    mode=<span class="hljs-string">'full'</span>,<font></font>
    workdir=<span class="hljs-string">'build'</span>,<font></font>
    progress = <span class="hljs-literal">True</span>)<font></font>
    )<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_DEB.addStep(<font></font>
    steps.SetPropertyFromCommand(<font></font>
    command=<span class="hljs-string">"grep version rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'"</span>, property=<span class="hljs-string">"version"</span><font></font>
    )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_DEB.addStep(<font></font>
    steps.SetPropertyFromCommand(<font></font>
    command=<span class="hljs-string">"grep release rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'"</span>, property=<span class="hljs-string">"release"</span><font></font>
    )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"mv"</span>, <span class="hljs-string">"rac_gui.tcl"</span>, <span class="hljs-string">"racgui"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, <span class="hljs-string">"s+^set\ dir(lib)+set\ dir(lib)\ /usr/share/rac-gui/lib ;#+g"</span>, <span class="hljs-string">"racgui"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"sed"</span>, <span class="hljs-string">"-i"</span>, <span class="hljs-string">"s+\[pwd\]+/usr/share/rac-gui+g"</span>, <span class="hljs-string">"racgui"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"tar"</span>, <span class="hljs-string">"czf"</span>, util.Interpolate(<span class="hljs-string">"../rac-gui_%(prop:version)s.orig.tar.gz"</span>), <span class="hljs-string">"."</span>]))<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
rac_gui_build_DEB.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"dpkg-buildpackage"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_DEB.addStep(<font></font>
    steps.FileUpload(<font></font>
    workersrc=util.Interpolate(<span class="hljs-string">"../rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>),<font></font>
        masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>)<font></font>
    )<font></font>
)<font></font>
<font></font>
rac_gui_build_DEB.addStep(<font></font>
    steps.MasterShellCommand(<font></font>
    command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
     util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>),<font></font>
     util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"</span>)]<font></font>
    )<font></font>
)<font></font>
<span class="hljs-comment">############################################</span>
<span class="hljs-comment">#       WIN</span>
<span class="hljs-comment">############################################</span><font></font>
<font></font>
rac_gui_build_WIN = util.BuildFactory()<font></font>
<font></font>
rac_gui_build_WIN.addStep(steps.Git(<font></font>
    repourl = <span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span>,<font></font>
    haltOnFailure = <span class="hljs-literal">True</span>,<font></font>
    submodules = <span class="hljs-literal">True</span>,<font></font>
    mode=<span class="hljs-string">'full'</span>,<font></font>
    workdir=<span class="hljs-string">'build'</span>,<font></font>
    progress = <span class="hljs-literal">True</span>)<font></font>
    )<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
    steps.SetPropertyFromCommand(<font></font>
    command=<span class="hljs-string">"powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'version:') -split '\\s')[2]"</span>,<font></font>
    property=<span class="hljs-string">"version"</span><font></font>
    )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#      </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
    steps.SetPropertyFromCommand(<font></font>
    command=<span class="hljs-string">"powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'release:') -split '\\s')[2]"</span>,<font></font>
    property=<span class="hljs-string">"release"</span><font></font>
    )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
rac_gui_build_WIN.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"c:\\bin\\freewrap.exe"</span>, <span class="hljs-string">"rac_gui.tcl"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#  ,  </span><font></font>
rac_gui_build_WIN.addStep(steps.ShellCommand(<font></font>
    command=[<span class="hljs-string">"c:\\Program Files\\7-zip\\7z.exe"</span>, <span class="hljs-string">"a"</span>, <span class="hljs-string">"-r"</span>, util.Interpolate(<span class="hljs-string">"..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>), <span class="hljs-string">"..\\build"</span>]))<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
    steps.FileUpload(<font></font>
    workersrc=util.Interpolate(<span class="hljs-string">"..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>),<font></font>
        masterdest=util.Interpolate(<span class="hljs-string">"/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>)<font></font>
    )<font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
rac_gui_build_WIN.addStep(<font></font>
    steps.MasterShellCommand(<font></font>
    command=[<span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span>,<font></font>
     util.Interpolate(<span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>),<font></font>
     util.Interpolate(<span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"</span>)]<font></font>
    )<font></font>
)<font></font>
<font></font>
c[<span class="hljs-string">'builders'</span>] = [<font></font>
        util.BuilderConfig(name=<span class="hljs-string">"Rac-GUI-RPM-builder"</span>, workername=<span class="hljs-string">'CentOS'</span>, factory=rac_gui_build_RPM),<font></font>
        util.BuilderConfig(name=<span class="hljs-string">"Rac-GUI-DEB-builder"</span>, workername=<span class="hljs-string">'Debian-10'</span>, factory=rac_gui_build_DEB),<font></font>
        util.BuilderConfig(name=<span class="hljs-string">"Rac-GUI-WIN-builder"</span>, workername=<span class="hljs-string">'Windows-10'</span>, factory=rac_gui_build_WIN),<font></font>
]<font></font>
<font></font>
c[<span class="hljs-string">'services'</span>] = []<font></font>
<font></font>
template=<span class="hljs-string">u'''\
&lt;h4&gt;Build status: {{ summary }}&lt;/h4&gt;
&lt;p&gt; Worker used: {{ workername }}&lt;/p&gt;
{% for step in build['steps'] %}
&lt;p&gt; {{ step['name'] }}: {{ step['result'] }}&lt;/p&gt;
{% endfor %}
&lt;p&gt;&lt;b&gt; -- The Buildbot&lt;/b&gt;&lt;/p&gt;
'''</span><font></font>
<font></font>
mailNotifier = reporters.MailNotifier(fromaddr=<span class="hljs-string">"112@icvibor.ru"</span>,<font></font>
          sendToInterestedUsers=<span class="hljs-literal">False</span>,<font></font>
          mode=(<span class="hljs-string">'all'</span>),<font></font>
          extraRecipients=[<span class="hljs-string">"my@domain.local"</span>],<font></font>
          relayhost=<span class="hljs-string">"mail.domain.local"</span>,<font></font>
          smtpPort=<span class="hljs-number">587</span>,<font></font>
          smtpUser=<span class="hljs-string">"buildbot@domain.local"</span>,<font></font>
          smtpPassword=<span class="hljs-string">"**********"</span>,<font></font>
          messageFormatter=reporters.MessageFormatter(<font></font>
                                 template=template, template_type=<span class="hljs-string">'html'</span>,<font></font>
                                 wantProperties=<span class="hljs-literal">True</span>, wantSteps=<span class="hljs-literal">True</span>))<font></font>
<font></font>
c[<span class="hljs-string">'services'</span>].append(mailNotifier)<font></font>
<font></font>
c[<span class="hljs-string">'title'</span>] = <span class="hljs-string">"The process of bulding"</span>
c[<span class="hljs-string">'titleURL'</span>] = <span class="hljs-string">"http://vm-srv-build1:80/"</span><font></font>
<font></font>
c[<span class="hljs-string">'buildbotURL'</span>] = <span class="hljs-string">"http://vm-srv-build1/"</span><font></font>
<font></font>
c[<span class="hljs-string">'www'</span>] = dict(port=<span class="hljs-number">80</span>,<font></font>
                plugins=dict(waterfall_view={}, console_view={}, grid_view={}))<font></font>
c[<span class="hljs-string">'db'</span>] = {
    <span class="hljs-string">'db_url'</span> : <span class="hljs-string">"sqlite:///state.sqlite"</span>
}</code></pre></div></div><br>
<h3 id="materialy"></h3><br>
<p>     :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Continuous Integration   BuildBot</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Buildbot:         </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    Buildbot  Ubuntu 16.04</a></li>
<li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Buildbot Tutorial</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464471/index.html">The DudeでのプリンターSNMPモニタリング</a></li>
<li><a href="../ja464479/index.html">「関連分野の初心者プログラマのマニフェスト」またはそのような人生にどうやってやってきたか</a></li>
<li><a href="../ja464481/index.html">スタジオでトレーニングとモチベーションシステムを構築する方法</a></li>
<li><a href="../ja464485/index.html">ShIoTiny：ウェットルームの換気（プロジェクト例）</a></li>
<li><a href="../ja464487/index.html">選択によりドキュメントを入力するためのインターフェースを構築しています</a></li>
<li><a href="../ja464491/index.html">Vivaldi 2.7-沈黙の中での激しい生活</a></li>
<li><a href="../ja464495/index.html">管理コミュニケーションチームチームとしてのチーム開発と反省</a></li>
<li><a href="../ja464497/index.html">不眠症と神経衰弱の治療薬としてのJIRA</a></li>
<li><a href="../ja464499/index.html">"マット。ウォールストリートモデル」またはクラウドITインフラストラクチャのコストを最適化する試み</a></li>
<li><a href="../ja464503/index.html">aircrack-ngと一致するWi-Fiパスワード</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>