<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏴󠁧󠁢󠁥󠁮󠁧󠁿 👨 👨🏾‍🎨 قم بتسريع البحث في Have I Have Pwned إلى 49 ميكرو ثانية (C ++) 👩🏼‍🚒 👩‍❤️‍💋‍👨 👂🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="لقد عرفت منذ فترة طويلة موقع Have I Have Pwned (HIBP) . صحيح ، حتى وقت قريب ، لم يكن هناك أبداً. كان لدي دائما كلمتين سر. تم استخدام واحد منهم بشكل مت...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>قم بتسريع البحث في Have I Have Pwned إلى 49 ميكرو ثانية (C ++)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490920/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fu/rg/hn/furghncw9u08teobuskqawx2y7u.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لقد عرفت منذ فترة طويلة موقع </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have I Have Pwned (HIBP)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . صحيح ، حتى وقت قريب ، لم يكن هناك أبداً. كان لدي دائما كلمتين سر. تم استخدام واحد منهم بشكل متكرر لبريد القمامة واثنين من الحسابات على مواقع غريبة. ولكن كان علي أن أرفض ذلك ، لأنه تم اختراق البريد. ولأكون صادقًا ، أنا ممتن للهاكر لأن هذا الحدث جعلني أراجع كلمات المرور الخاصة بي - الطريقة التي أستخدمها وخزنها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بالطبع ، قمت بتغيير كلمات المرور على جميع الحسابات التي يوجد بها كلمة مرور مخترقة. ثم تساءلت عما إذا كانت كلمة المرور المسربة في قاعدة بيانات HIBP. لم أرغب في إدخال كلمة المرور على الموقع ، لذلك قمت بتنزيل قاعدة البيانات (</font></font><code>pwned-passwords-sha1-ordered-by-count-v5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">القاعدة مثيرة للإعجاب للغاية. </font><font style="vertical-align: inherit;">هذا ملف نصي بحجم 22.8 غيغابايت مع مجموعة من تجزئات SHA-1 ، عدد مرات حدوث كلمة المرور مع هذا التجزئة في كل سطر مع عداد. </font><font style="vertical-align: inherit;">اكتشفت SHA-1 لكلمة مروري المتشققة وحاولت العثور عليها.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">محتويات</font></font></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[G] ممثل</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هيكل ثلاثي</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بحث ثنائي</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">فرز</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لماذا الدمج؟</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تماثل</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لا تكن لقيط أناني</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ب 3</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ترتيب بالإدراج</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">منفصل أم لا؟</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خصائص شجرة HIBP</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ملف إلاخراج</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المعايير</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أوكون - مكتبة و CLI</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الروابط والمناقشة</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">شكرا للقراءة</font></font></a></li>
</ul><br>
<a name="1"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[G] ممثل</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لدينا ملف نصي مع تجزئة في كل سطر. </font><font style="vertical-align: inherit;">ربما يكون أفضل مكان للذهاب هو grep. </font></font><br>
<br>
<code>grep -m 1 '^XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX' pwned-passwords-sha1-ordered-by-count-v5.txt</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كانت كلمة المرور الخاصة بي في أعلى القائمة مع تردد أكثر من 1500 مرة ، لذا فهي سيئة حقًا. </font><font style="vertical-align: inherit;">تبعا لذلك ، عادت نتائج البحث على الفور تقريبا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ولكن ليس لدى الجميع كلمات مرور ضعيفة. </font><font style="vertical-align: inherit;">أردت التحقق من الوقت المستغرق للعثور على أسوأ سيناريو - آخر تجزئة في الملف: </font></font><br>
<br>
<code>time grep -m 1 '^4541A1E4605EEBF3F4C166329C18502DF75D348A' pwned-passwords-sha1-ordered-by-count-v5.txt</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
النتيجة: </font></font><code>33,35s user 23,39s system 41% cpu 2:15,35 total</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هذا أمر محزن. </font><font style="vertical-align: inherit;">بعد كل شيء ، منذ اختراق بريدي ، أردت التحقق من وجود جميع كلمات المرور القديمة والجديدة في قاعدة البيانات. </font><font style="vertical-align: inherit;">لكن جريب لمدة دقيقتين ببساطة لا يسمح لك بالقيام بذلك بشكل مريح. </font><font style="vertical-align: inherit;">بالطبع ، يمكنني كتابة نص برمجي وتشغيله والذهاب في نزهة على الأقدام ، ولكن هذا ليس خيارًا. </font><font style="vertical-align: inherit;">كنت أرغب في إيجاد حل أفضل وتعلم شيء ما.</font></font><br>
<br>
<a name="2"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هيكل ثلاثي</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كانت الفكرة الأولى هي استخدام بنية بيانات trie. يبدو الهيكل مثاليًا لتخزين تجزئات SHA-1. الأبجدية صغيرة ، وبالتالي فإن العقد ستكون صغيرة ، وكذلك الملف الناتج. ربما تناسبها حتى في ذاكرة الوصول العشوائي؟ يجب أن يكون البحث الأساسي سريعًا جدًا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذا نفذت هذا الهيكل. ثم أخذ أول 1،000،000 تجزئة من قاعدة البيانات المصدر لبناء الملف الناتج والتحقق مما إذا كان كل شيء في الملف الذي تم إنشاؤه. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نعم ، يمكنني العثور على كل شيء في الملف ، لذلك عملت البنية بشكل جيد. كانت المشكلة مختلفة.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تم إصدار الملف الناتج بحجم 2283686592B (2.2 جيجابايت). هذا ليس جيدا. دعونا نحسب ونرى ما سيحدث. العقدة هي بنية بسيطة تتكون من ستة عشر قيمًا 32 بت. القيم هي "مؤشرات" إلى العقد التالية برمز تجزئة SHA-1 المحدد. لذلك ، تأخذ عقدة واحدة 16 * 4 بايت = 64 بايت. يبدو أن قليلا؟ ولكن إذا فكرت في الأمر ، فإن العقدة الواحدة تمثل حرفًا واحدًا في التجزئة. وبالتالي ، في أسوأ الحالات ، ستأخذ تجزئة SHA-1 40 * 64 بايت = 2560 بايت. هذا أسوأ بكثير من ، على سبيل المثال ، التمثيل النصي للتجزئة التي تستغرق 40 بايت فقط. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتميز هيكل trie بميزة إعادة استخدام العقد. إذا كان لديك كلمتين </font></font><code>aaa</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">و </font></font><code>abb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">، ثم يتم إعادة استخدامها عقدة الأحرف الأولى، لأن الشخصيات هي نفسها - </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
دعونا نعود إلى مشكلتنا. </font><font style="vertical-align: inherit;">دعونا نحسب عدد العقد المخزنة في الملف الناتج: </font></font><code>file_size / node_size = 2283686592 / 64 = 35682603</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن دعونا نرى عدد العقد التي سيتم إنشاؤها في أسوأ حالة من مليون تجزئة: </font></font><code>1000000 * 40 = 40000000</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وبالتالي ، فإن بنية trie تعيد استخدام </font></font><code>40000000 - 35682603 = 4317397</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">العقد </font><font style="vertical-align: inherit;">فقط </font><font style="vertical-align: inherit;">، وهو 10.8 ٪ من السيناريو الأسوأ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بمثل هذه المؤشرات ، سيأخذ الملف الناتج لقاعدة بيانات HIBP بأكملها 1421513361920 بايت (1.02 تيرابايت). </font><font style="vertical-align: inherit;">ليس لدي ما يكفي من محركات الأقراص الثابتة للتحقق من سرعة البحث الرئيسي. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في ذلك اليوم ، اكتشفت أن بنية trie غير مناسبة للبيانات العشوائية نسبيًا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
دعونا نبحث عن حل آخر.</font></font><br>
<br>
<a name="3"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بحث ثنائي</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تحتوي تجزئات SHA-1 على ميزتين جميلتين: يمكن مقارنتهما ببعضهما البعض وجميعهما بنفس الحجم. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بفضل هذا ، يمكننا معالجة قاعدة بيانات HIBP الأصلية وإنشاء ملف من قيم SHA-1 المصنفة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ولكن كيف يتم فرز ملف 22 جيجا بايت؟ </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">سؤال. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لماذا فرز الملف المصدر؟ </font><font style="vertical-align: inherit;">يقوم HIBP بإرجاع ملف مع سلاسل تم فرزها بالفعل حسب التجزئة. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إجابة. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أنا فقط لم أفكر في ذلك. </font><font style="vertical-align: inherit;">في تلك اللحظة لم أكن أعرف عن الملف الذي تم فرزه.</font></font></i> <br>
<br>
<a name="4"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">فرز</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
فرز جميع التجزئة في ذاكرة الوصول العشوائي ليس خيارًا ؛ ليس لدي الكثير من ذاكرة الوصول العشوائي. </font><font style="vertical-align: inherit;">كان الحل هو:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تقسيم ملف كبير إلى أصغر حجمًا يتناسب مع ذاكرة الوصول العشوائي</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قم بتنزيل البيانات من الملفات الصغيرة ، وفرزها في ذاكرة الوصول العشوائي واكتب مرة أخرى إلى الملفات.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اجمع كل الملفات الصغيرة والمفروشة في ملف واحد كبير.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
باستخدام ملف كبير مفروز ، يمكنك البحث في التجزئة باستخدام بحث ثنائي. </font><font style="vertical-align: inherit;">الوصول إلى القرص الصلب مهم. </font><font style="vertical-align: inherit;">دعنا نحسب عدد النتائج المطلوبة في البحث الثنائي: </font></font><code>log2(555278657) = 29.0486367039</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أي 30 نتيجة. </font><font style="vertical-align: inherit;">لا باس به. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في المرحلة الأولى ، يمكن إجراء التحسين. </font><font style="vertical-align: inherit;">تحويل تجزئات النص إلى بيانات ثنائية. </font><font style="vertical-align: inherit;">سيؤدي ذلك إلى تقليل حجم البيانات الناتجة إلى النصف: من 22 إلى 11 جيجابايت. </font><font style="vertical-align: inherit;">غرامة.</font></font><br>
<br>
<a name="5"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لماذا الدمج؟</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في تلك اللحظة ، أدركت أنه يمكنك القيام بذكاء أكبر. </font><font style="vertical-align: inherit;">ماذا لو لم تقم بدمج الملفات الصغيرة في ملف واحد كبير ، لكنك قمت بإجراء بحث ثنائي في الملفات الصغيرة التي تم فرزها في ذاكرة الوصول العشوائي؟ </font><font style="vertical-align: inherit;">تكمن المشكلة في كيفية العثور على الملف المطلوب الذي تبحث فيه عن المفتاح. </font><font style="vertical-align: inherit;">والحل بسيط جدا. </font><font style="vertical-align: inherit;">نهج جديد:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أنشئ 256 ملفًا باسم "00" ... "FF".</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">عند قراءة التجزئة من ملف كبير ، اكتب التجزئة التي تبدأ بـ "00 .." إلى ملف يسمى "00" ، والتجزئة التي تبدأ بـ "01 .." - إلى ملف "01" وهكذا.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قم بتنزيل البيانات من الملفات الصغيرة ، وفرزها في ذاكرة الوصول العشوائي واكتب مرة أخرى إلى الملفات.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كل شيء بسيط للغاية. </font><font style="vertical-align: inherit;">بالإضافة إلى ذلك ، يظهر خيار تحسين آخر. </font><font style="vertical-align: inherit;">إذا تم تخزين التجزئة في الملف "00" ، فإننا نعلم أنه يبدأ بـ "00". </font><font style="vertical-align: inherit;">إذا تم تخزين التجزئة في الملف "F2" ، فسيبدأ بالحرف "F2". </font><font style="vertical-align: inherit;">وبالتالي ، عند كتابة التجزئة إلى الملفات الصغيرة ، يمكننا حذف البايت الأول من كل تجزئة! </font><font style="vertical-align: inherit;">هذه 5٪ من جميع البيانات. </font><font style="vertical-align: inherit;">يتم حفظ 555 ميغابايت في المجموع.</font></font><br>
<br>
<a name="6"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تماثل</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يوفر الفصل في ملفات أصغر فرصة أخرى للتحسين. </font><font style="vertical-align: inherit;">الملفات مستقلة عن بعضها البعض ، لذلك يمكننا فرزها بالتوازي. </font><font style="vertical-align: inherit;">نتذكر أن كل معالجاتك تحب التعرق في نفس الوقت ؛)</font></font><br>
<br>
<a name="7"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لا تكن لقيط أناني</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عندما نفذت الحل المذكور أعلاه ، أدركت أن الآخرين ربما يواجهون مشكلة مماثلة. ربما يقوم العديد من الآخرين أيضًا بتنزيل قاعدة بيانات HIBP والبحث فيها. لذلك قررت مشاركة عملي. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
قبل ذلك ، قمت مرة أخرى بمراجعة نهجي ووجدت بعض المشاكل التي أود حلها قبل نشر الكود والأدوات على Github. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أولاً ، بصفتي مستخدمًا نهائيًا ، لا أريد استخدام أداة تنشئ العديد من الملفات الغريبة بأسماء غريبة ، والتي لا يتضح فيها ما تم تخزينه ، وما إلى ذلك. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
حسنًا ، يمكن حل ذلك من خلال دمج الملفات "00" .. "FF" في ملف واحد كبير.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لسوء الحظ ، فإن وجود ملف واحد كبير للفرز يطرح مشكلة جديدة. </font><font style="vertical-align: inherit;">ماذا لو كنت أرغب في إدراج تجزئة في هذا الملف؟ </font><font style="vertical-align: inherit;">تجزئة واحدة فقط. </font><font style="vertical-align: inherit;">هذا فقط 20 بايت. </font><font style="vertical-align: inherit;">أوه ، يبدأ التجزئة بـ "000000000 ..". </font><font style="vertical-align: inherit;">حسنا. </font><font style="vertical-align: inherit;">دعونا نحرر مساحة لذلك بنقل 11 غيغابايت من التجزئة الأخرى ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أنت تفهم ما هي المشكلة. </font><font style="vertical-align: inherit;">إدخال البيانات في منتصف الملف ليس أسرع عملية. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عيب آخر لهذا النهج هو أنك تحتاج إلى تخزين وحدات البايت الأولى مرة أخرى - فهي 555 ميغابايت من البيانات. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وأخيرًا وليس آخرًا ، فإن البحث الثنائي على البيانات المخزنة على محرك الأقراص الثابتة أبطأ بكثير من الوصول إلى ذاكرة الوصول العشوائي. </font><font style="vertical-align: inherit;">أعني ، هذا هو قراءة القرص 30 مقابل قراءة القرص 0.</font></font><br>
<br>
<a name="8"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ب 3</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
مرة أخرى. </font><font style="vertical-align: inherit;">ما لدينا وما نريد تحقيقه. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لدينا 11 غيغابايت من القيم الثنائية. </font><font style="vertical-align: inherit;">جميع القيم قابلة للمقارنة ولها نفس الحجم. </font><font style="vertical-align: inherit;">نريد معرفة ما إذا كان مفتاح معين موجودًا في البيانات المخزنة ، ونريد أيضًا تغيير قاعدة البيانات. </font><font style="vertical-align: inherit;">ولكي يعمل كل شيء بسرعة. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/18c/851/d23/18c851d23c6bbe290fcccb763c6f09eb.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B- شجرة؟ </font><font style="vertical-align: inherit;">حق </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تسمح لك شجرة B بتقليل الوصول إلى القرص عند البحث أو التعديل أو ما إلى ذلك. إنها تحتوي على ميزات أكثر بكثير ، لكننا نحتاج إلى هاتين الخاصيتين.</font></font><br>
<br>
<a name="9"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ترتيب بالإدراج</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الخطوة الأولى هي تحويل البيانات من ملف المصدر HIBP إلى شجرة B. هذا يعني أنك بحاجة إلى استخراج جميع التجزئة بالتساوي وإدخالها في الهيكل. خوارزمية الإدراج المعتادة مناسبة لذلك. ولكن في حالتنا ، يمكنك القيام بعمل أفضل. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يعد إدراج الكثير من البيانات الأولية في شجرة B سيناريو معروفًا. لقد اخترع الحكماء نهجًا أفضل لهذا من الإدخال المعتاد. بادئ ذي بدء ، تحتاج إلى فرز البيانات. يمكن القيام بذلك كما هو موضح أعلاه (تقسيم الملف إلى ملفات أصغر وفرزها في ذاكرة الوصول العشوائي). ثم أدخل البيانات في الشجرة.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الخوارزمية المعتادة ، إذا وجدت العقدة الطرفية حيث تريد إدراج القيمة وتم ملؤها ، فإنك تقوم بإنشاء عقدة جديدة (على اليمين) وتوزع القيم بالتساوي بين العقدتين ، اليسرى واليمنى (بالإضافة إلى قيمة واحدة تذهب إلى العقدة الأصلية ولكن هذا ليس مهمًا هنا). باختصار ، دائمًا ما تكون القيم الموجودة في العقدة اليسرى أقل من القيم الموجودة في اليمين. والحقيقة هي أنه عند إدراج البيانات التي تم فرزها ، فأنت تعلم أن القيم الأصغر لن يتم إدراجها بعد الآن في الشجرة ، لذلك لن تذهب المزيد من القيم إلى العقدة اليسرى. العقدة اليسرى تبقى نصف فارغة طوال الوقت. علاوة على ذلك ، إذا قمت بإدخال قيم كافية ، فقد تجد أن العقدة الصحيحة ممتلئة ، لذا تحتاج إلى نقل نصف القيم إلى العقدة اليمنى الجديدة. تبقى العقدة المقسمة نصف فارغة ، كما في الحالة السابقة. إلخ…</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ونتيجة لذلك ، بعد كل الإدخالات ، تحصل على شجرة تكون فيها نصف العقد تقريبًا فارغة. </font><font style="vertical-align: inherit;">هذا ليس استخدامًا فعالًا جدًا للمساحة. </font><font style="vertical-align: inherit;">يمكننا القيام بعمل أفضل.</font></font><br>
<br>
<a name="10"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">منفصل أم لا؟</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في حالة إدراج البيانات المصنفة ، يمكنك إجراء تعديل صغير على خوارزمية الإدراج. </font><font style="vertical-align: inherit;">إذا كانت العقدة التي تريد لصق القيمة فيها ممتلئة ، فلا تقسمها. </font><font style="vertical-align: inherit;">ما عليك سوى إنشاء عقدة جديدة وفارغة ولصق القيمة في العقدة الأصلية. </font><font style="vertical-align: inherit;">بعد ذلك ، عند إدراج القيم التالية (التي تكون أكبر من القيم السابقة) ، تقوم بإدراجها في عقدة جديدة فارغة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
للحفاظ على خصائص شجرة B ، بعد كل عمليات الإدراج ، من الضروري فرز العقد في أقصى اليمين في كل طبقة من الشجرة (باستثناء الجذر) وتقسيم قيم هذه العقدة المتطرفة وجارها الأيسر بالتساوي. </font><font style="vertical-align: inherit;">حتى تحصل على أصغر شجرة ممكنة.</font></font><br>
<br>
<a name="11"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خصائص شجرة HIBP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند تصميم شجرة B ، تحتاج إلى اختيار ترتيبها. </font><font style="vertical-align: inherit;">يوضح عدد القيم التي يمكن تخزينها في عقدة واحدة ، وكذلك عدد الأطفال الذين يمكن أن يكون للعقدة. </font><font style="vertical-align: inherit;">من خلال معالجة هذه المعلمة ، يمكننا معالجة ارتفاع الشجرة ، الحجم الثنائي للعقدة ، إلخ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في HIBP ، لدينا </font></font><code>555278657</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تجزئات. </font><font style="vertical-align: inherit;">افترض أننا نريد شجرة بارتفاع ثلاثة (لذلك لا نحتاج إلى أكثر من ثلاث عمليات قراءة للتحقق من وجود التجزئة). </font><font style="vertical-align: inherit;">نحن بحاجة إلى العثور على قيمة M مثل هذا </font></font><code>logM(555278657) &lt; 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">اخترت 1024. هذه ليست أصغر قيمة ممكنة ، لكنها تترك إمكانية إدخال المزيد من التجزئة والحفاظ على ارتفاع الشجرة.</font></font><br>
<br>
<a name="12"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ملف إلاخراج</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
حجم ملف HIBP المصدر هو 22.8 جيجا بايت. </font><font style="vertical-align: inherit;">ملف الإخراج مع شجرة B هو 12.4 غيغابايت. </font><font style="vertical-align: inherit;">يستغرق الأمر حوالي 11 دقيقة لإنشائه على جهازي (Intel Core i7-6700 ، 3.4 GHz ، 16 GB RAM) ، القرص الصلب (وليس SSD).</font></font><br>
<br>
<a name="13"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المعايير</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يظهر خيار B-tree نتيجة جيدة:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">الوقت [μs] | </font><font style="vertical-align: inherit;">٪ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| -----------------: | ------------: | ------------: |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">أوكون | </font><font style="vertical-align: inherit;">49 | </font><font style="vertical-align: inherit;">100 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">grep '^ hash' | </font><font style="vertical-align: inherit;">135'350'000 | </font><font style="vertical-align: inherit;">276'224'489 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">جريب | </font><font style="vertical-align: inherit;">135'480'000 | </font><font style="vertical-align: inherit;">276'489'795 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">C ++ سطرا بسطر | </font><font style="vertical-align: inherit;">135'720'201 | </font><font style="vertical-align: inherit;">276'980'002 |</font></font></pre><br>
<a name="14"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أوكون - مكتبة و CLI</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كما قلت ، أردت مشاركة عملي مع العالم. قمت بتطبيق مكتبة وواجهة سطر أوامر لمعالجة قاعدة بيانات HIBP والبحث بسرعة عن التجزئة. البحث سريع للغاية بحيث يمكن ، على سبيل المثال ، أن يتم دمجه في مدير كلمات المرور وإعطاء ملاحظات للمستخدم في كل مرة يتم الضغط على مفتاح. هناك العديد من الاستخدامات الممكنة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تحتوي المكتبة على واجهة C ، لذلك يمكن استخدامها في كل مكان تقريبًا. CLI هو CLI. يمكنك ببساطة إنشاء وتشغيل (: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الرمز موجود في </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مستودع التخزين الخاص بي</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إخلاء المسؤولية: لا توفر okon بعد واجهة لإدخال القيم في شجرة B التي تم إنشاؤها. </font><font style="vertical-align: inherit;">يمكنه فقط معالجة ملف HIBP ، وإنشاء شجرة B والبحث فيها. </font><font style="vertical-align: inherit;">تعمل هذه الوظائف بشكل جيد جدًا ، لذلك قررت مشاركة الرمز ومتابعة العمل على الإدخال والوظائف المحتملة الأخرى.</font></font><br>
<br>
<a name="15"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الروابط والمناقشة</font></font></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هيكل ثلاثي</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">شجرة ب</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لقد تم Pwned الموقع</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مستودع الرموز</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / cpp</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ص / الأمن</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أخبار هاكر</font></font></a></li>
</ul><br>
<a name="16"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">شكرا للقراءة</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(:</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar490906/index.html">طرحت شركة Yandex إصدارًا تجريبيًا من Aura المستقل - aura.top. هل هي القمة؟</a></li>
<li><a href="../ar490908/index.html">تخزين بيانات المنطقة</a></li>
<li><a href="../ar490912/index.html">كيف اخترنا في Sportmaster نظام التخزين المؤقت. الجزء الأول</a></li>
<li><a href="../ar490916/index.html">مشاكل التفاعل مع الفرق الخارجية في المشاريع الكبيرة</a></li>
<li><a href="../ar490918/index.html">أندريه زاريتسكي ، ألكسندر تروخانوف (تابع): "لم يكن لدينا اسم ، ولكن كان هناك غطرسة"</a></li>
<li><a href="../ar490924/index.html">ما هو Windows PowerShell وماذا يأكل؟ الجزء الثاني: مقدمة في لغة البرمجة</a></li>
<li><a href="../ar490926/index.html">مسار الكرة الوحدة 2d للمبتدئين</a></li>
<li><a href="../ar490932/index.html">[توقعات] Motornet - شبكة لتبادل البيانات للمركبات الآلية</a></li>
<li><a href="../ar490936/index.html">إنشاء ML على iOS</a></li>
<li><a href="../ar490938/index.html">نكتب الآلاف من ملفات السجل في كل مرة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>