<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤪 👩🏼‍🏭 🤰🏻 AWSおよびBambooのCI / CD 🚘 👇 🏂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私たちのチームは、1人の開発者と1人のDevOpsエンジニアで構成されています。私はアプリケーションをAmazon ECSクラスターにデプロイする責任があります。CI / CDサーバーとして、私はBambooを使用しています。この記事では、開発環境にアプリケーションをデプロイする方法について詳しく説...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWSおよびBambooのCI / CD</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/458648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのチームは、1人の開発者と1人のDevOpsエンジニアで構成されています。</font><font style="vertical-align: inherit;">私はアプリケーションをAmazon ECSクラスターにデプロイする責任があります。</font><font style="vertical-align: inherit;">CI / CDサーバーとして、私はBambooを使用しています。</font><font style="vertical-align: inherit;">この記事では、開発環境にアプリケーションをデプロイする方法について詳しく説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cn/bu/3w/cnbu3wmmjkhiqhwgxpuhk3pu2fc.png"><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ev/oz/rs/evozrsbpwhmgd0zodgrz4pukurm.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dockerイメージを作成する </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで私はこれらのステップに従います：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ1：Dockerをインストールして構成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順2：Bambooでアーティファクトを構成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ3：Amazon ECRリポジトリを設定します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ4：BambooでDockerイメージをビルドします。</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ1：Dockerをインストールして構成する </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Bambooがインストールされているサーバーをアップグレードし、必要なパッケージをインストールして、Dockerリポジトリをセットアップします。</font><font style="vertical-align: inherit;">ここでは、CentOS 7オペレーティングシステムにBambooをインストールしたことに注意してください。他のオペレーティングシステムに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインストールする方法については、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">www.docker.comを参照</font></a><font style="vertical-align: inherit;">して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ sudo yum update <font></font>
$ sudo yum install -y yum-utils device-mapper-persistent-data lvm2 <font></font>
$ sudo yum-config-manager --add-repo <font></font>
https://download.docker.com/linux/centos/docker-ce.repo <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Dockerアプリケーションをインストールしてサービスを開始します。 </font></font><br>
<br>
<pre><code class="plaintext hljs">$ sudo yum install docker-ce docker-ce-cli containerd.io<font></font>
$ sudo systemctl enable docker <font></font>
$ sudo systemctl start docker <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、bambooユーザーをDockerグループに追加します。 </font></font><br>
<br>
<pre><code class="plaintext hljs">$ sudo usermod -aG docker bamboo <font></font>
$ sudo su - bamboo <font></font>
$ docker run hello-world<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのコマンドを実行した後、dockerが「Hello from Docker！」というメッセージで応答する場合、これは私のインストールが正しく機能していることを意味します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順2. Bambooでアーティファクトを構成する</font></font></h1><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grails</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ではアプリケーション開発が進行中です</font><font style="vertical-align: inherit;">。アプリケーションをコンパイルすると、拡張子warのファイルが作成されます。このファイルは、Bamboo用語ではアーティファクトです。このファイルを後続のタスクで使用するようにBambooを構成します。これを行うには、私はに行く</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブ</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/xf/rh/l2xfrhlwvte_3enperkvbqadtey.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のように、とGrailsのタスクを設定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/6l/s7/ba6ls73snayld5eazip7mcc0eg4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、Grailsのが最初のビルドフォルダをクリアしていることがわかり、その後、テストを実行し、最終的にはdevの環境のためのwarファイルを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーティファクト」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タブ</font><font style="vertical-align: inherit;">と「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーティファクト</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">作成」</font></b><font style="vertical-align: inherit;">ボタンをクリックします</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">アーティファクト</font></b><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">次のよう</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2a/sj/am/2asjam033lqmwc9txcj_slq_5jc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
に設定します</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/_b/wb/jw_bwbdddrwx1pa1gh7etxonvys.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。Grailsはwarファイルを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / libs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクトリに配置し</font><font style="vertical-align: inherit;">ます。</font><b><font style="vertical-align: inherit;">共有</font></b><font style="vertical-align: inherit;">オプションをチェックします</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、後でこのアーティファクトが必要になるため。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今私は、デプロイメントプロジェクトを作成し、私のビルド計画で使用するアーティファクトを指定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y7/fs/uf/y7fsufkg7rsi-6d3i-hfk8o6rlc.png"><br>
<br>
<img src="https://habrastorage.org/webt/s7/nf/tu/s7nftu9r8vwudgjzi1qdtlaljpw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私も設定する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーティファクトのダウンロード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク</font><font style="vertical-align: inherit;">：展開プロジェクトでは</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ie/vv/uv/ievvuvkegkneya15tqd9xlcayhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このように、竹は今warファイルを使用するように設定されています。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ3. Amazon ECRリポジトリを構成する </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazon ECRは、イメージ用のDockerストレージおよび管理サービスです。</font><font style="vertical-align: inherit;">設定するには、AWSコンソールを開いてECRを選択する必要があり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ys/fd/1i/ysfd1ijutkdnzcugeldnemvywl4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。リポジトリを作成したら、次のアドレスを取得します。</font></font><br>
<br>
<pre><code class="plaintext hljs">aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定が完了したら、ここでは、ログイン方法、リポジトリからのイメージのダウンロード方法、およびリポジトリへのイメージのアップロード方法についても説明されています。 </font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ4：BambooでDockerイメージをビルドする</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Dockerイメージの構築を開始するトリガーを構成する必要があります。</font><font style="vertical-align: inherit;">これを行うには</font><font style="vertical-align: inherit;">、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トリガー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブに移動して[ </font><b><font style="vertical-align: inherit;">トリガー</font></b><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ev/gq/nu/evgqnu95-my1ralvlnxrw6tx3fe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで</font><font style="vertical-align: inherit;">は、プロジェクトのコンパイル後にDockerイメージが収集されるように、</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プランを正常にビルドした後</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">ビルド</font></b><font style="vertical-align: inherit;"> ]オプションを選択します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Dockerイメージのビルドタスクを追加する必要があります。</font><font style="vertical-align: inherit;">これを行うには</font><font style="vertical-align: inherit;">、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブ</font><font style="vertical-align: inherit;">に移動し、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクの追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">をクリック</font><font style="vertical-align: inherit;">して、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプを選択します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">説明を入力</font><font style="vertical-align: inherit;">し、ドロップダウンメニューから</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerイメージのビルド]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を選択</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">では</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド、</font><font style="vertical-align: inherit;">入力します。</font></font><br>
<br>
<pre><code class="plaintext hljs"> aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest. 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dockerfileについては、次のようになります。 </font></font><br>
<br>
<pre><code class="plaintext hljs">FROM openjdk:8-jre <font></font>
COPY *.war /usr/src/onboard.war <font></font>
WORKDIR /usr/src <font></font>
CMD ["/bin/bash", "-c", "java -DdataSource.url=$DATASOURCE_URL -DdataSource.username=$DATASOURCE_USERNAME -DdataSource.password=$DATASOURCE_PASSWORD -jar onboard.war"] <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションを起動するときに、データベースを指定する必要があります。</font><font style="vertical-align: inherit;">環境変数DATASOURCE_URL、DATASOURCE_USERNAME、DATASOURCE_PASSWORDは、この情報をアプリケーションに送信するために使用されますが、それらの値はコンテナーの起動時に設定されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、アプリケーションでDockerイメージをアセンブルするためのセットアッププロセスが完了しました。</font><font style="vertical-align: inherit;">次のステップは、Amazon ECRリポジトリへのこのイメージのダウンロードを構成することです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/n_/3t/yxn_3t_bqhvr2azfbyaywzadhpe.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Elastic Container Registryに画像をアップロードする </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elastic Container Registryを使用して、Bambooを使用して収集した画像を保存できます。</font><font style="vertical-align: inherit;">これを達成するには、次の手順に従います。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ1. Amazon ECR Docker Credential Helperをインストールする </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2. IAMロールをBambooサーバーに接続する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ3：Dockerイメージの起動ジョブを構成する </font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ1. Amazon ECR Docker Credential Helperをインストールする </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DockerイメージをAmazon ECRにダウンロードするには、認証情報が必要です。</font><font style="vertical-align: inherit;">これらの資格情報は、コマンドを実行して取得できます</font></font><br>
<br>
<pre><code class="plaintext hljs">aws ecr get-login
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これらの資格情報は12時間のみ有効です。</font><font style="vertical-align: inherit;">したがって、イメージをECRにアップロードする前に毎回上記のコマンドを実行するか、一時的な資格情報を最新に保ち、ECRにログインするECR Docker Credential Helperをインストールできます。</font><font style="vertical-align: inherit;">次の手順に従って、ECR Docker Credential Helperをインストールします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">git</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインストールし</font><font style="vertical-align: inherit;">、次にgithubリポジトリのクローンを作成</font><font style="vertical-align: inherit;">する必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ sudo yum install git <font></font>
$ sudo su - bamboo <font></font>
$ git clone <font></font>
https://github.com/awslabs/amazon-ecr-credential-helper.git <font></font>
$ make docker <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、次の行を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/home/bamboo/.docker/config.json</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルに</font><i><font style="vertical-align: inherit;">追加</font></i><font style="vertical-align: inherit;">する必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">{ <font></font>
        "credsStore": "ecr-login" <font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイルしたアプリケーションを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / binディレクトリに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コピーします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ exit <font></font>
$ sudo cp /home/bamboo/docker-credential-ecr-login /usr/bin/ <font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ2. IAMロールをBambooサーバーに接続する </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BambooサーバーでECRを使用できるようにするには、ロールを作成し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AmazonEC2ContainerRegistryPowerUser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリシーをこのロール</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">追加して、</font><font style="vertical-align: inherit;">このロールをEC2 Bambooインスタンスにアタッチ</font><font style="vertical-align: inherit;">する必要があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">AWSコンソールを開き、IAMを選択します。</font><font style="vertical-align: inherit;">次に、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create role</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンを</font><font style="vertical-align: inherit;">
クリックし、</font><b><font style="vertical-align: inherit;">次に</font></b><font style="vertical-align: inherit;">示すように</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWSサービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EC2を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1o/vs/jf/1ovsjfchxa3p-bgv4y-6unnz8sk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next：Permissions</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリック</font><font style="vertical-align: inherit;">し、次の画面で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AmazonEC2ContainerRegistryPowerUser</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリシーを見つけて選択します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、ロールの作成を完了し、それをBambooサーバーにアタッチします。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ3：Dockerイメージの起動ジョブを構成する </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが作成し、Dockerイメージとwarファイルを組み合わせたアプリケーション。次に、このイメージをリポジトリにアップロードする必要があります。これを行うには、別のDockerタスクを追加します。今回は、イメージをECRリポジトリーにアップロードします。</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブに移動し、</font><b><font style="vertical-align: inherit;">[タスクの</font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">をクリック</font><font style="vertical-align: inherit;">して、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプを選択します</font><font style="vertical-align: inherit;">。説明を入力</font><font style="vertical-align: inherit;">し、ドロップダウンメニューから</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DockerイメージをDockerレジストリにプッシュ]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を選択</font><font style="vertical-align: inherit;">します。 [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムレジストリ]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を選択</font><font style="vertical-align: inherit;">し、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドにリポジトリアドレスを入力します</font><font style="vertical-align: inherit;">。以下のために</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証タイプ、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は選択</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用するエージェントのネイティブ資格情報</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、DockerイメージをAmazon ECRリポジトリにロードするためのセットアッププロセスが完了しました。</font><font style="vertical-align: inherit;">次の手順では、コンテナアプリケーションを起動するようにクラスタとサービスを設定するプロセスについて説明します。</font><font style="vertical-align: inherit;">ただし、その前に、コンテナの起動オプションを構成する必要があります。</font><font style="vertical-align: inherit;">これが今から行うことです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/ku/os/f7kuosux7wvkojanpgoy8zd7wya.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amazon ECSタスク定義を作成する </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスク定義-ここでは、コンテナー実行パラメーターが書き込まれます。</font><font style="vertical-align: inherit;">このアプリケーションでは、コンテナの起動時にパラメータが指定されるデータベースを使用しているため、このセクションではデータベースも作成します。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon RDS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をデータベースとして使用し、データベース</font><font style="vertical-align: inherit;">にアクセスするためのパスワードを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Systems Managerパラメータストア</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に暗号化された形式で保存しています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">タスク定義を作成するには、次の手順に従います。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ1. Amazon RDSインスタンスにデータベースを作成します。</font></font></li>
<li> 2.  AWS Systems Manager Parameter Store;</li>
<li> 3.  Task Definition. </li>
</ul><br>
<h1>  1.      Amazon RDS </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプリケーションではPostgreSQLデータベースを使用しています。データベースを作成するには、AWSコンソールを開き、Amazon RDSサービスを選択し、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">作成</font></b><font style="vertical-align: inherit;"> ]ボタンをクリックし</font><font style="vertical-align: inherit;">て、データベースエンジンとして</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を選択し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。次のページで</font><font style="vertical-align: inherit;">、作業環境として</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dev / Test</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">を選択し</font><font style="vertical-align: inherit;">、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次へ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックします</font><font style="vertical-align: inherit;">。次に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBインスタンス識別子をonboard-dev-db</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスターユーザー名</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devdbadminに指定し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。次に、次のページに移動して、VPC、サブネットグループ、セキュリティグループを構成します。このデータベースはプライベートネットワークで使用されるため、</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パブリックアクセシビリティ]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターで</font><font style="vertical-align: inherit;">選択します</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いいえ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース名」</font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">devdb</font></b><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">入力</font><font style="vertical-align: inherit;">して、「</font><b><font style="vertical-align: inherit;">データベース</font></b><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンをクリックし</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ2. AWS Systems Managerパラメータストアを設定する </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号化された形式でデータベースのパスワードを保存します。</font><font style="vertical-align: inherit;">これを行うには、AWSコンソールを開き、AWS Systems Manager→共有リソース→パラメータストア→パラメータの作成に移動します。</font><font style="vertical-align: inherit;">パラメータ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として</font><b><font style="vertical-align: inherit;">devdbpassword</font></b><font style="vertical-align: inherit;">を入力</font><font style="vertical-align: inherit;">し、パラメータタイプとして</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecureString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">選択してから、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドにデータベースパスワードを入力します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ3.タスク定義を作成する </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazon ECSは、コンテナーアプリケーションが実行されるクラスターです。タスク定義を使用して、コンテナーアプリケーションのランタイムパラメーターを指定します。このようなパラメーターを設定するには、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいタスク定義を作成</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックします</font><font style="vertical-align: inherit;">。次に、スタートアップの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">種類</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として</font><b><font style="vertical-align: inherit;">Fargate</font></b><font style="vertical-align: inherit;">を選択</font><font style="vertical-align: inherit;">し、次の手順に</font><b><font style="vertical-align: inherit;">進み</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。ここでは、名前を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onboard-dev-taskdefに設定し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[タスク実行IAMロールフィールド]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターで、</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいロールの作成]を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。このアプリケーションに割り当てられるリソースについては、2 GBのメモリと1つのvCPUを意味します。次に、コンテナーの起動オプションを追加する必要があります。コンテナーに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onboard-dev-container</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という名前を付け</font><font style="vertical-align: inherit;">ます。私はこのようにイメージ名を付けます：</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 Amazon ECR Docker Credential HelperがECR認証を処理するため</font><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プライベートリポジトリ認証</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションは</font><font style="vertical-align: inherit;">オフのままにします。開発環境では、アプリケーションはポート8080で使用できるので、ポートマッピングパラメーターには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8080</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">書き込み</font><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコルを選択します</font><font style="vertical-align: inherit;">。データベースURLパラメータ、ユーザー名、パスワードは、環境変数を使用してコンテナに渡されます。これらのパラメーターは、「環境変数」セクションで設定します。</font><font style="vertical-align: inherit;">パラメーターストアから</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devdbpassword</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターの値を取得するために</font><font style="vertical-align: inherit;">、タイプ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValueFrom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を指定します</font><font style="vertical-align: inherit;">。私が設定する最後のものは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログ設定です</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ここで私は選択します</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudWatch Logsを自動構成します</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これで、タスク定義の作成が完了しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、ecsTaskExecutionRoleロールには、パラメーターストアからdevdbpasswordを取得するポリシーが必要です。これを行うには、IAMロールに移動し、ecsTaskExecutionRoleを選択して、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インラインポリシーの追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">クリックします</font><font style="vertical-align: inherit;">。この場合、ビジュアルエディターを使用して追加しています。したがって、[サービス]フィールドに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Systems Manager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と入力</font><font style="vertical-align: inherit;">し、[アクション]フィールドに「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParameters」と入力し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。次に、[ </font><font style="vertical-align: inherit;">リソース]フィールドの</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARNの追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリック</font><font style="vertical-align: inherit;">して値を入力します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2j/wd/6r/2jwd6r5dpp41jbjj4g7gctfeafw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、[ポリシーの確認]をクリックして設定されたパラメーターの値を確認し、名前を付けて、ecsTaskExecutionRole構成の操作を終了します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、コンテナ起動アプリケーションの設定が完了しました。</font><font style="vertical-align: inherit;">次に、ECSクラスターとサービスを作成する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0k/u7/xn/0ku7xnp7bctypewbbcwyzdda_-y.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amazon ECSサービスを作成する </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテナーアプリケーションは、ECSクラスター内のサービスとして実行されます。</font><font style="vertical-align: inherit;">構成するには、次の手順を実行する必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ1. Amazon ECSクラスターを作成します。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2：サービスを作成する </font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ1. Amazon ECSクラスターを作成する </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECSクラスターを作成するには、AWSコンソールに移動してECSサービスを選択します。</font><font style="vertical-align: inherit;">次に、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create Cluster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックして</font><font style="vertical-align: inherit;">、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Networking only</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cluster]テンプレートを選択します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次のページで、クラスターに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onboard-dev-cluster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という名前を付けて、クラスター</font><font style="vertical-align: inherit;">の作成を完了します。</font><font style="vertical-align: inherit;">これで、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fargate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベースのECSクラスタができました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2：サービスを作成する</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスを作成するには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onboard-dev-cluster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク</font><font style="vertical-align: inherit;">をクリックし、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブに移動して</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックし</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。以下のための</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">発射タイプIは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fargateを選択し、ために</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク定義Iは、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オンボードの-DEV-のtaskdefを選択します。さらに、「クラスター」フィールドでonboard-dev-clusterを選択します。 「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス名」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドに、</font><font style="vertical-align: inherit;">onboard-devと書き込みます。</font><font style="vertical-align: inherit;">今はアプリケーションを起動したくないので、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク数</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーター</font><font style="vertical-align: inherit;">をゼロ</font><font style="vertical-align: inherit;">に設定しました</font><font style="vertical-align: inherit;">。 [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小正常パーセント]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターの値</font><font style="vertical-align: inherit;">を100のままにし、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大パーセント]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を200のままにします。</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開の種類]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターで、</font><font style="vertical-align: inherit;">[ </font><b><font style="vertical-align: inherit;">ローリング更新]を</font></b><font style="vertical-align: inherit;">選択します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のステップに進みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure Network]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページの</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster VPC]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターで</font><font style="vertical-align: inherit;">、以前に作成した</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Development VPC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">というVPCを選択します</font><font style="vertical-align: inherit;">。開発中のアプリケーションはプライベートネットワークでのみ使用できるため、2つのプライベートサブネットを選択します。セキュリティグループを構成するには、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編集</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックし、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[既存のセキュリティグループの選択</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><font style="vertical-align: inherit;">を選択して</font><b><font style="vertical-align: inherit;">から</font></b><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セキュリティグループを選択し</font><font style="vertical-align: inherit;">、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックし</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パブリックIPの自動割り当て]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターで、</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を選択し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。次に、</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロードバランサーの種類]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターで</font><font style="vertical-align: inherit;">[ </font><b><font style="vertical-align: inherit;">なし]</font></b><font style="vertical-align: inherit;">を選択します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス検出統合を有効にする</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]オプションを</font><b><font style="vertical-align: inherit;">オフのままにし</font></b><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それから私はクリック</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、[次へ]を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスを作成します</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、実行中のジョブの数がゼロのサービスがあります。</font><font style="vertical-align: inherit;">次のステップでアプリケーションの起動を構成します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dg/_9/er/dg_9er1txnjnjbhpkrcmn5af4lk.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービス更新 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者がアプリケーションコードを更新するとすぐに、デプロイはDockerイメージを作成し、それをElastic Container Registryにアップロードし、最後にコンテナーアプリケーションをECS Fargateクラスターのサービスとして起動します。</font><font style="vertical-align: inherit;">現時点では、クラスターで実行されているジョブの数はゼロです。</font><font style="vertical-align: inherit;">アプリケーションを開始するには、サービスを更新して、数量を1に指定する必要があります。</font><font style="vertical-align: inherit;">私はこれを達成するためにこれらのステップに従います：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ1. Tasks for AWS Bambooプラグインをインストールします。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2. ECSサービスの更新 </font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ1. AWS Bambooプラグインのタスクをインストールする </font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Bambooのタスク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、BambooビルドおよびデプロイプロジェクトからのAWSリソースの準備と操作を簡素化するプラグインです。</font><font style="vertical-align: inherit;">このプラグインをインストールする</font><font style="vertical-align: inherit;">には、</font><font style="vertical-align: inherit;">デプロイメントプロジェクトに移動し、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクの追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] </font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">クリック</font><font style="vertical-align: inherit;">し、Atlassian Marketplaceに移動して、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWSのタスク（Bamboo）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインストールし</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ステップ2. ECSサービスの更新 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にデプロイメントプロジェクトで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon ECSサービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジョブを追加し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、ジョブの説明フィールドに「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update Service for onBoard-dev」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と書き込み</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">[Action]フィールドで、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update Service]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Force new deployment]を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、アプリケーション起動領域として米国東部（オハイオ）を選択します。</font><font style="vertical-align: inherit;">次に、タスク定義、クラスター、およびサービスの適切なフィールドARN（Amazonリソース名）に書き込みます。</font><font style="vertical-align: inherit;">このタスクでは、実行中のタスクの必要な数を1に更新します。</font><font style="vertical-align: inherit;">次に、展開構成のテキストボックスに次の値を入力します。</font></font><br>
<br>
<pre><code class="plaintext hljs">{ <font></font>
  "maximumPercent": 200, <font></font>
  "minimumHealthyPercent": 100 <font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のように、パブリックIPなしのネットワークをセットアップしています。 </font></font><br>
<br>
<pre><code class="plaintext hljs">{ <font></font>
   "awsvpcConfiguration": { <font></font>
        "assignPublicIp": "DISABLED", <font></font>
        "subnets": ["subnet-ID1", "subnet-ID2"], <font></font>
        "securityGroups": ["sg-ID"] <font></font>
    } <font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">AWS Security Credentialsの</font></b><font style="vertical-align: inherit;"> [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
セクション</font><font style="vertical-align: inherit;">で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EC2のIAM Role]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を選択します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ECSを更新できるようにする必要があるため、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AmazonECS_FullAccess</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリシー</font><font style="vertical-align: inherit;">をBamboo EC2インスタンスに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">アタッチ</font></a><font style="vertical-align: inherit;">しています。これを行うには、AWSコンソールを開き、[IAM]を選択します。次に、Bambooサーバーに使用するロールを選択します。 [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリシー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">アタッチ</font></b><font style="vertical-align: inherit;"> ]ボタンをクリックし</font><font style="vertical-align: inherit;">、AmazonECS_FullAccessポリシーを見つけて、左側のチェックボックスをオンにして、ポリシーのアタッチを完了します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、AWSとBambooを使用したCI / CDセットアップは終了です。</font><font style="vertical-align: inherit;">したがって、開発者がアプリケーションコードを更新すると、このコードがリポジトリにアップロードされ、テストとアプリケーションアセンブリが起動します。</font><font style="vertical-align: inherit;">次に、Dockerイメージがアプリケーションwarファイルで構築され、このイメージがAmazon ECRリポジトリにコピーされます。</font><font style="vertical-align: inherit;">次に、Amazon ECSクラスターでコンテナーアプリケーションがサービスとして起動され、現在のアプリケーションが停止されていない場合は更新されます。</font><font style="vertical-align: inherit;">リソースを節約するためにアプリケーションが停止した場合、アプリケーションは単に起動します。</font><font style="vertical-align: inherit;">開発環境でアプリケーションを確認した後、クラスターで実行されているジョブの数をゼロに指定することにより、アプリケーションを停止できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事が好きで、改善のアイデアがある場合は、コメントに書き込んでください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458636/index.html">Tutu.ruオフィスのmitla DevLeadsのビデオ</a></li>
<li><a href="../ja458638/index.html">Intel oneAPIプロジェクト：多くのアーキテクチャ、1つのAPI</a></li>
<li><a href="../ja458640/index.html">長いダッシュを見つける</a></li>
<li><a href="../ja458642/index.html">ヒューリスティックの代わりに理論：フロントエンド開発者としてより良くなる</a></li>
<li><a href="../ja458646/index.html">一言で言えば、原子スワップ</a></li>
<li><a href="../ja458650/index.html">サイバーチャレンジ。新しいレベル。Rostelecom Solarからのオンライン競争</a></li>
<li><a href="../ja458652/index.html">RamblerFront＆Meetup＃7</a></li>
<li><a href="../ja458654/index.html">通常の雇用された労働者によって書かれた間に、Lurkウイルスは銀行をハッキングしました</a></li>
<li><a href="../ja458658/index.html">仮想マシンからLXCコンテナーへの移行：理由、利点、すぐに使える手順</a></li>
<li><a href="../ja458660/index.html">ソフトウェアの展開に失敗するとCloudflareサービスがクラッシュする</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>