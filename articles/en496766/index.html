<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöü üïµüèæ üïµüèΩ What is Azure Stack HCI and how does it work ü§Ωüèø ü§òüèΩ ‚ûó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! Today we want to talk about what the Azure Stack HCI platform is all about. Including what it is in general, from what hardware is assemb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>What is Azure Stack HCI and how does it work</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/496766/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr! </font><font style="vertical-align: inherit;">Today we want to talk about what the Azure Stack HCI platform is all about. </font><font style="vertical-align: inherit;">Including what it is in general, from what hardware is assembled, what software contains, how it works, and that‚Äôs all. </font><font style="vertical-align: inherit;">Join now!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/a8/ns/msa8nsszbolcqdqftfpzhmhkkci.png"><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is a guest post from the guys from AltaStor. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AltaStor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a system integrator specializing in building solutions for reliable data storage. </font><font style="vertical-align: inherit;">Thanks to the accumulated expertise in building failover clusters and HCI, an individual solution is selected for each client that is best suited for its tasks.</font></font></blockquote><a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the Azure Stack HCI?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a hyperconverged solution that combines several products:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware from a Microsoft Certified OEM Partner.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server 2019 Datacenter Operating System.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Admin Center software.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Azure Services if necessary.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This solution has existed on the market for a long time, and some of our customers have long and successfully used it. </font><font style="vertical-align: inherit;">However, they do not publish the performance test results of their installation. </font><font style="vertical-align: inherit;">We decided to fill this gap and talk about our experience using Azure Stack HCI with one specific example. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For documentation and general information on Azure Stack HCI, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">click here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
&nbsp;<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Booth layout</font></font></h2>&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/086/5d0/047/0865d0047d86f46f5e2999f9abac8409.jpg"><br>
&nbsp;<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipment</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Building a solution requires a hardware platform recommended by Microsoft. Leading manufacturers of server hardware - HPE, Dell EMC, Fujitsu, Hitachi, Lenovo, etc. - developed their configurations, tested them for compatibility and certified for Azure Stack HCI. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A complete list of compatible equipment is available </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depending on the types of drives used, the platform components will vary. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We prefer to build such solutions on the basis of Fujitsu servers with the pre-installed Windows Server 2019 Datacenter operating system. This manufacturer after the sale supports the entire software and hardware complex as a complete solution, and not just its hardware. This is important both for us, as partners, and for the end customer.</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently, Fujitsu has five configurations certified for different types of drives, server models, and number of nodes. The maximum number of nodes for Azure Stack HCI is 16, the minimum is 2, but some configurations are limited to 4. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All compatible Fujitsu configurations can be viewed </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For installation, we chose the most efficient configuration from the currently certified - Fujitsu Primergy with SSD drives for storing data, and Intel Optane ultra-fast memory modules connected via NVMe interface as the system cache. We expect to get a software-defined All-Flash array with performance comparable to classic storage with SSD drives and NVMe cache.</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All-Flash storage systems of industry leaders have similar media type configurations. </font><font style="vertical-align: inherit;">We know what IOPS and latency indicators can be obtained in practice from similar systems and look forward to similar performance from Azure Stack HCI based on the selected Fujitsu configuration. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/097/a99/1f1/097a991f1f820647f030183802c834e3.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The architecture of this Fujitsu solution is described in detail in a document available </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We recommend that you familiarize yourself with it before installation. </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/468/866/9ae/4688669aee12df9248e368a88c758af0.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The document describes the limitations of the architecture, typical connection schemes, and a lot of other information useful at the implementation stage.</font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9b5/f47/26c/9b5f4726c82a82d0d12d6dafd967e443.jpg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Switches</font></font></h2>&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fujitsu's solution uses its own PSWITCH Ethernet switch. </font><font style="vertical-align: inherit;">For ourselves, we noted the following advantages:&nbsp;</font></font><br>
&nbsp;<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The switches of this series are very productive, at a low cost.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The switches are quite simple to configure and use the CISCO-like interface. </font><font style="vertical-align: inherit;">Engineers did not encounter any difficulties during installation.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are no proprietary excesses in administration and competent documentation is available.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fujitsu switching equipment is one of the industry leaders in Japan. </font><font style="vertical-align: inherit;">It has recently become available on the Russian market, but is already regularly used in projects by our architects and other Fujitsu partners. </font><font style="vertical-align: inherit;">A limited number of models are currently available.&nbsp;</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Learn more about Fujitsu switches on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
&nbsp;<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside the server, Intel Optane memory cards occupy a significant part of the space.&nbsp; </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/895/742/c12/895742c127ddef9ed35f44ddbfc2b6fa.jpg"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/5bb/1dd/77f/5bb1dd77f0079b9babe09973b132156b.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intel pays a lot of attention to performance under high heat demand. On the one hand, for maximum quality cooling, large radiators are used. On the other hand, this limits the cooling air flow inside the entire server.&nbsp; </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is one of the key points that is taken into account when certifying the configuration - it is necessary to consider all possible scenarios in which, due to insufficient cooling, the servers can overheat the Optane module, or vice versa.</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When moving the server room, our clients have more than once faced with a situation when the air conditioning system has not yet been put into operation. Therefore, we decided to check how demanding this installation is to the cooling system and measure the life of the platform under load outside the cooled server room.&nbsp;&nbsp; </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The tests were carried out at room temperature, but we did not encounter any thermal limitations, or a decrease in performance or the appearance of errors due to overheating. We have seen from our own experience that the tested servers support the declared working capacity at an ambient temperature of up to +45 degrees Celsius.&nbsp; </font></font><br>
&nbsp;<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This experiment should not be taken as a recommendation to abandon the use of special server rooms with high-quality ventilation. </font><font style="vertical-align: inherit;">When choosing a hardware solutions provider, be sure to pay attention to the maximum temperature package.</font></font><br>
&nbsp;<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware platform assembly</font></font></h2>&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Front view: </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7b5/53b/5eb/7b553b5eb67aaa8405b3aec5eb7ddfd7.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rear view: </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/1db/a71/be8/1dba71be8bf20b34a2874dfb64d2e758.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Only one switch was used in the test. </font><font style="vertical-align: inherit;">For commercial use, we always recommend that you reserve access paths using at least two switches. </font><font style="vertical-align: inherit;">According to our statistics, the most common hardware failure in clusters is an accidental cable break or a broken contact in the connector.&nbsp;</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fujitsu RX1330 was used as a server with control software. </font><font style="vertical-align: inherit;">He was also assigned the functions of an arbiter and quorum server.</font></font><br>
&nbsp;<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster Deployment</font></font></h2>&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first stage consisted of physical installation of hardware components, connecting interface cables, etc. </font><font style="vertical-align: inherit;">This was followed by software setup, as </font><font style="vertical-align: inherit;">The operating system is already preinstalled. </font><font style="vertical-align: inherit;">We deployed Storage Space Direct on each server and built a cluster of 2 nodes and an arbiter. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we used the Fujitsu Infrastructure Manager utility, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Admin Center</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> extension </font><font style="vertical-align: inherit;">that integrates closely with Fujitsu server hardware and contains all the management tools from Azure, such as:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Azure Site Recovery provides high availability and disaster recovery as a service (DRaaS).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Azure Monitor is a centralized site for monitoring the operation of applications, networks and infrastructure with in-depth AI-based analytics.</font></font><br>
</li>
<li>¬´-¬ª   Azure          .<br>
</li>
<li> Azure Backup     ,      -.<br>
</li>
<li> ¬´  Azure¬ª          Windows,   Azure    .<br>
</li>
<li>  Azure          Azure  VPN-  ¬´ ‚Äî ¬ª.<br>
</li>
<li> ¬´  Azure¬ª     .&nbsp;<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The extension allows you to automate a number of tasks that can also be performed directly in the Admin Center. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gathered Storage Pool, created Volumes in it. </font><font style="vertical-align: inherit;">These volumes are subsequently located virtual machines for which we conducted performance tests. </font><font style="vertical-align: inherit;">Both volumes and virtual machines are conveniently managed from a single window. </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f25/a14/7cf/f25a147cf1d43eb65ce7afab6c5f2e6a.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Through Fujitsu Infrastructure Manager, it‚Äôs also convenient to do many things about scheduled maintenance and microcode updates. </font><font style="vertical-align: inherit;">The status of all equipment is clearly displayed, much can be automated. </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/364/a36/bed/364a36bed36a81528668e7d705699c11.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are two versions of the Fujitsu Infrastructure Manager utility - paid and free:</font></font><br>
&nbsp;<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Free. </font><font style="vertical-align: inherit;">Available for download from the manufacturer‚Äôs website, it is quite enough for server management.</font></font><br>
</li>
<li>.       Microsoft Azure HCI ‚Äî      Windows Server     .<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For deep Primergy integration with Microsoft Azure Stack HCI, you need a server management plug-in from Windows Server, which is available only in the paid version. Therefore, the FUJITSU Integrated System PRIMEFLEX for Microsoft Azure Stack HCI solution is part of it.&nbsp; </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The more installation you have, the more valuable the automation that the utility provides. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are only 2 nodes in our stand and we could do all the work manually. If you have 4 nodes or more, the software will significantly reduce your installation and administration efforts. The utility cost is less than 1% of the project, but significantly speeds up the commissioning of equipment. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the Windows Admin Center, the Fujitsu Infrastructure Manager Orchestra is an expansion pack:</font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/03b/747/11d/03b74711d36cdbe8d7809619e3b38e6f.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same screenshot shows the composition of the server disk subsystem: two Optane modules are used as a cache extension, and five SSD disks as a Tier-1 storage pool.</font></font><br>
&nbsp;<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important points</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When building a solution, there are several nuances that must be borne in mind: There </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
are two ways to manage Microsoft Azure Stack HCI - through the Windows Admin Center or the Fujitsu Infrastructure Manager.&nbsp; </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Admin Center also has its advantages - you can deploy it on anything, even on a laptop; there is the ability to control from the command line. With it, the administrator can do almost anything.&nbsp; </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is also Cluster Manager - an indispensable tool for any problems with the cluster.&nbsp; </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When deploying Witness (quorum server), it is important to add it to Active Directory and check its availability to all nodes. The requirements for this task are minimal, and it can be placed on any base server.</font></font><br>
<img src="https://habrastorage.org/getpro/habr/post_images/081/cfc/f9b/081cfcf9b862e035a65600f1138f5dfe.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the point of view of Windows Server, there are three types of disk devices - NVMe, SSD and HDD. The logic of the work is as follows: NVMe devices are the read / write cache, SSD is the Tier-1 storage level; HDD - Tier-2 storage level. Next, you can configure policies for moving data between pools. NVDIMMs can also be used as a cache. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The default block size for tearing is 4K, but may vary depending on the type of file system in the virtual machine. This will subsequently affect performance. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We use NVMe modules as a cache, so the speed of reading and writing data will be very different - this will be clearly seen in performance tests:</font></font><br>
&nbsp;<br>
<ul>
<li>                 ( ),    SSD (Tier-1,  ).<br>
</li>
<li>       NVMe    ,       ,       .    .<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before creating a cluster, validation and all tests in the Failover Cluster Manager must be completed. </font><font style="vertical-align: inherit;">The report needs to be saved, because without it it will not be possible to open a service call in Microsoft support, if ever needed. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When adding new nodes to an existing cluster, the nodes will be automatically added to the Storage pool. </font><font style="vertical-align: inherit;">After 15 minutes, the cluster will automatically rebuild, rebuild and balance the Storage pool. </font><font style="vertical-align: inherit;">This may affect performance during the rebuild.</font></font><br>
&nbsp;<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance tests</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's move on to the most interesting part - load testing. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testing configuration:</font></font><br>
&nbsp;<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two Fujitsu PRIMERGY RX2540 servers assembled in a cluster;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">each server has two Intel Optane storage class memory modules installed, used to expand the read / write cache;</font></font><br>
</li>
<li>      SSD,      ,<br>
</li>
<li>      erasure coding ( RAID-5).<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, it is a software-defined storage system running Windows Server 2019 Azure Stack HCI. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We start the first test with 12 virtual machines running on both nodes. The read / write load profile is 70:30, block size = 8k. The block size was chosen based on the fact that most modern transactional databases and OLTP loads use just such a block size and approximately the same read / write ratio. </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/6b2/d7c/9da/6b2d7c9dac708b1f4d5330e3f0742e00.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The steady-state cluster performance is 428k IOPS with a delay of 0.487 ms. This is a really worthy result, which is quite comparable to what you can get on a specialized all-flash storage system from many manufacturers.&nbsp;</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Independent tests with a similar load profile are provided on the spcresults.org resource - this is the SPC-1 test. The difference with our configuration is only in the block size - it is 4k. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we significantly simplify the methodology for comparing the results, we can divide into two IOPS indicators obtained for all-flash storage systems and compare them with the numbers we received at the same response time. The results obtained on our cluster of two mid-level servers are quite comparable with most storage systems.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, such a comparison is not very correct, because in our case, an increase in the number of disks will affect performance and delays quite differently than with a specialized storage system. But, even taking into account all these assumptions, it can be said that a couple of years ago such performance figures could only be seen on a multi-controller external storage system of an average or even higher level. Today this is achievable on a hyperconverged solution. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The performance picture changes significantly when deduplication and measurements are turned on with the previous block size = 8k. If you simply enable deduplication on the same load profile, then performance will be less than 300k IOPS.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we run two load profiles with a block of 8KB where one profile is 100% read and the other 100% write, then below are the best numbers that we were able to get: </font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ed8/e3d/5e3/ed8e3d5e3a387044eb8b52b8fa45ca41.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We see excellent reading results, especially if we take into account a delay of 12 Œºs. </font><font style="vertical-align: inherit;">Here Optane really does a great job as a read cache with proactive algorithms for predictive data transfer to the cache. </font><font style="vertical-align: inherit;">Yes, and the storage pool itself, located on the SSD, also shows very good read numbers. </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the write speed is very different. </font><font style="vertical-align: inherit;">Here are a few serious factors:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The architecture of the solution, when data falling into the cache of one node is copied over the network to the cache of the second node.</font></font><br>
</li>
<li>  :         ‚Äî  ,         Optane.          . <br>
<br>
            45%,            ,      ‚Äî ,     .       .<br>
</li>
<li>   SSD       SSD ‚Äî    3D-NAND ,         3D-NAND.<br>
</li>
</ul><br>
<h2></h2><br>
<ul>
<li> OLTP-      ‚Äì       8k    .&nbsp;&nbsp;<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deduplication can be enabled at any time, but it significantly reduces performance. </font><font style="vertical-align: inherit;">The deduplication efficiency in our tests was 45% with a performance drop of more than 25%.&nbsp;</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This gives you freedom of choice - either higher storage performance or almost twice as much capacity. </font><font style="vertical-align: inherit;">Also, much will depend on the load profile and the ability to compress the recorded data.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Due to the architecture of the solution, sequential write operations significantly increase the response time.&nbsp;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is not in vain that Microsoft requires building a solution only on the basis of validated configurations from OEM partners - this avoids many problems both during the initial installation and during further work.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Working with the hardware from Fujitsu, as always, left only a positive impression. </font><font style="vertical-align: inherit;">This is a sensible documentation, and many useful additions from Infrastructure Manager - this software package really greatly simplifies system management. </font><font style="vertical-align: inherit;">This is especially important when increasing the number of nodes.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fujitsu's PRIMEFLEX solution includes a set of scripts that speeds up the deployment process. </font><font style="vertical-align: inherit;">They make it easy to start and configure in general, and Fujitsu PRIMERGY servers in particular.</font></font><br>
</li>
</ul><br>
<img src="https://habrastorage.org/getpro/habr/post_images/fdc/a11/060/fdca11060f83e478d5edd39134097dfa.jpg"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For those who are not interested in self-tuning the solution, there is the opportunity to conclude a Technical Solution Contract with Fujitsu. </font><font style="vertical-align: inherit;">In this case, the technical specialists of the vendor will deploy everything on a turnkey basis and will provide further support.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496756/index.html">AWS Lambda in Action. Part 2: getting to know development and testing tools</a></li>
<li><a href="../en496758/index.html">Digital medieval healthcare. Global technological transformation after COVID-19</a></li>
<li><a href="../en496760/index.html">User flow: how to create popular applications and sites</a></li>
<li><a href="../en496762/index.html">Particle based surface erosion simulation</a></li>
<li><a href="../en496764/index.html">Small but Proud: DuckDuckGo vs. Ad Monsters</a></li>
<li><a href="../en496768/index.html">Forget about RGB and HEX</a></li>
<li><a href="../en496770/index.html">Automated engineer apartment. Part 1: statement of the problem, choice of iron</a></li>
<li><a href="../en496772/index.html">Unmanned vehicles should ‚Äúkeep in mind‚Äù the brands of cars driven by the toughest drivers</a></li>
<li><a href="../en496774/index.html">We raise our full-fledged Minecraft game server with mini-games. Part 3. Installing mini-games</a></li>
<li><a href="../en496776/index.html">Hacking Unmanned Vehicles: Who Will Be Responsible (RAND Corporation study)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>