<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌱 ➡️ 👿 Wright In The Shadows ☕️ 🐟 🔵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah kisah tentang salah satu tugas yang kami siapkan untuk tahap kualifikasi CTFZone , yang diadakan pada akhir November. Anda dapat membaca te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wright In The Shadows</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/bizone/blog/486390/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini adalah kisah tentang salah satu tugas yang kami siapkan untuk tahap kualifikasi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CTFZone</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang diadakan pada akhir November. Anda dapat membaca tentang proses persiapan kualifikasi di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda mulai dengan dua file: decrypt_flag.py dan ntfs_volume.raw. Mari kita lihat skripnya. Dia membuka file bernama key.bin, dan kemudian, menggunakan loop, dia mencoba untuk mengambil string biner 34 byte dari setiap offset di dalam file, yang kemudian digunakan sebagai input untuk fungsi PBKDF2. Setiap kunci yang dikembalikan digunakan sebagai kunci XOR untuk mendekripsi string terenkripsi yang dijahit ke dalam kode. Jika hash MD5 yang didekripsi cocok dengan nilai yang telah ditentukan dalam bentuk yang didekripsi, skrip menggunakan data yang diterima untuk membuat dan mencetak bendera.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, Anda perlu menemukan file key.bin. </font><font style="vertical-align: inherit;">Tidak mungkin menyortir semua offset di dalam file gambar (ntfs_volume.raw), karena proses menemukan kuncinya akan terlalu lambat. </font><font style="vertical-align: inherit;">Ini tidak dilarang oleh aturan, tetapi Anda tentu tidak akan punya waktu sebelum akhir KKP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File gambar berisi tabel partisi MBR satu-partisi. </font><font style="vertical-align: inherit;">Offset-nya adalah 2.048 sektor 512-byte, dan berisi sistem file NTFS, tetapi file key.bin tidak ada:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ fls -o 2048 -r -p ntfs_volume.raw | grep -F key.bin | wc –l<font></font>
0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NTFS menyimpan nama file yang disandikan UTF-16LE. </font><font style="vertical-align: inherit;">Ayo coba cari di dalamnya!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/c4/9n/5g/c49n5g_kmk7j-ga2zo5nzthtad0.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil pencarian untuk catatan file</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Setelah mempelajari hasil pencarian, kami fokus pada catatan file yang dimulai dengan tanda tangan FILE [1]. </font><font style="vertical-align: inherit;">Inilah satu-satunya entri seperti itu:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wv/-x/id/wv-xid-sp4valyl_kmqxj9e2o5s.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rekor Ditemukan</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tujuan sudah dekat! Kami memiliki catatan file, tetapi kami membutuhkan data. Dalam NTFS, mereka disimpan dalam atribut $ DATA, yang bisa penduduk atau bukan penduduk [2]. Untuk catatan yang kami temukan, atribut ini dimulai pada offset 0 × 3AADD00 dan menunjukkan data yang bukan penduduk (ini berarti bahwa informasi disimpan di luar catatan file). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi di mana tepatnya data dari file yang diinginkan? Untuk menjawab pertanyaan ini, perlu untuk men-decode apa yang disebut pasangan pemetaan, atau data berjalan (pasangan “panjang blok - blok offset”) [3]. Data berjalan dari file yang diinginkan adalah sebagai berikut (perhatikan offset 0 × 3AADD40): 22 53 01 A0 4E 21 05 31 C1 11 38 30 00. Atau, jika kita mengatur ulang mereka:</font></font><br>
<br>
<pre><code class="plaintext hljs">1.	22 53 01 A0 4E<font></font>
2.	21 05 31 C1<font></font>
3.	11 38 30 00</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File ini terdiri dari tiga fragmen, ukuran yang pertama adalah 339 cluster, dan dimulai dengan cluster # 20128. Untuk kode kami menggunakan PBKDF2, potongan ini besar. Seperti yang ditunjukkan dalam header sistem file, ukuran satu cluster adalah 4096 byte:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ fsstat -o 2048 ntfs_volume.raw | grep 'Cluster Size'<font></font>
Cluster Size: 4096</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat data untuk offset ini (dalam byte): </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2048 * 512 + 20128 * 4096 = 83492864. Kami akan mengekstraksi sejumlah informasi penting (misalnya, 128 byte) dari sini, masukkan ke dalam file baru, yang akan kami panggil key.bin, jalankan skrip ... Tidak ada yang berhasil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin file itu tidak disimpan pada saat ini, tetapi dalam versi sebelumnya dari sistem file (format sebelumnya) - jangan lupa bahwa kami tidak melihat catatan tentang file yang dihapus dengan nama yang sama. Berapa ukuran cluster sebelumnya? Mari kita mencari header sistem file dengan tanda tangan NTFS [4]. Mungkin kami beruntung dan kami benar-benar menemukan tajuk dari format sebelumnya.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s3/mp/na/s3mpnalay_jhx-yvaytbqgp4qta.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil pencarian untuk header sistem file</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Posisi pertama dan terakhir dalam hasil merujuk pada sistem file saat ini, tetapi header sistem file yang terletak di antara mereka tampaknya milik format sebelumnya. Dan mereka memiliki ukuran cluster yang berbeda!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lo/co/hb/locohbcqzrc6_etzqfxfnb1tusk.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Header sistem file dari versi sebelumnya.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ukuran sektor tersebut ditulis pada offset 0 × 4554800B: 00 02, atau 512. Tetapi ukuran cluster tersebut dicatat pada offset 0 × 0x4554800D: F7, atau 247. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami memiliki ukuran cluster (dalam byte) bersama kami 512 * 247 = 126464. Semacam omong kosong! Jika Anda percaya parser NTFS [5], nilai seperti itu harus memiliki tanda dan diproses dengan cara khusus, sehingga ukuran cluster nyata (dalam sektor) adalah 1 &lt;&lt; - (- 9) = 512. Atau, jika dalam byte, 512 * 512 = 262144 Sekarang terdengar lebih bisa dipercaya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data dimulai di sini pada offset ini (dalam byte): </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2048 * 512 + 20128 * 262144 = 5277483008. Mari kita coba lagi untuk melakukan trik yang sama dengan informasi yang tersimpan di sana ... Sekali lagi, sebuah kegagalan! Apa yang salah? Kami memiliki CTF di sini, itu berarti "tidak begitu" apa pun bisa terjadi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugas yang kita lawan disebut In the Shadows. </font><font style="vertical-align: inherit;">Mungkin ada hubungannya dengan salinan bayangan volume. </font><font style="vertical-align: inherit;">Jadi, kami memiliki file dari sistem file yang sebelumnya ada di volume ini. </font><font style="vertical-align: inherit;">Sayangnya, kami tidak bisa mengambil dan me-mount salinan bayangannya, tetapi kami tahu offset yang tepat di mana data dimulai! </font><font style="vertical-align: inherit;">Ini adalah 5277483008, atau, dalam bagian tersebut, 5277483008 - 2048 * 512 = 5276434432. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut spesifikasi format VSS [6], blok data yang dialihkan dijelaskan dalam struktur deskriptor Blok yang berisi bidang 64-bit di mana offset asli (di dalam volume) disimpan, dan juga bidang 64-bit yang menguraikan offset blok target (di dalam volume). </font><font style="vertical-align: inherit;">Mari kita mencari 5276434432 sebagai nomor endian 64-bit kecil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya ada dua hasil dalam hasil, dan hanya satu dari mereka yang terletak pada offset genap.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y6/bo/dm/y6bodmvczyemr2uu-2m7giaukqw.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskriptor blok yang ditemukan</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Target offset </font><i><font style="vertical-align: inherit;">blok</font></i><font style="vertical-align: inherit;"> : 00 00 9B 03 00 00 00 00, atau hanya 60489728. Final offset: 60489728 + 2048 * 512 = 61538304. Dari sini, ekspor sejumlah data ke file baru bernama key.bin, dan ...</font></font><br>
<br>
<pre><code class="plaintext hljs">$ ./decrypt_flag.py<font></font>
ctfzone{my_c0ngr4t5_t0_u,w311_d0n3_31337}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selesai!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referensi</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://flatcap.org/linux-ntfs/ntfs/concepts/file_record.html</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://flatcap.org/linux-ntfs/ntfs/attributes/data.html</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://flatcap.org/linux-ntfs/ntfs/concepts/data_runs.html</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://flatcap.org/linux-ntfs/ntfs/files/boot.html</font></font></a></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/msuhanov/dfir_ntfs/blob/94bb46d6600153071b0c3c507ef37c42ad62110d/dfir_ntfs/BootSector.py#L58</font></font></a></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/libyal/libvshadow/blob/master/documentation/Volume%20Shadow%20Snapshot%20(VSS)%20format.asciidoc#431-block-descriptortor</font></font></a></li>
</ol></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486376/index.html">Bagaimana desainer level menggunakan teori arsitektur untuk membuat level game</a></li>
<li><a href="../id486378/index.html">Server rumah bertenaga surya bekerja selama 15 bulan: waktu aktif 95,26%</a></li>
<li><a href="../id486380/index.html">Apa yang Harus Dilakukan Manajer Produk</a></li>
<li><a href="../id486382/index.html">Segel dan Scrum</a></li>
<li><a href="../id486388/index.html">Tinjauan Proyek Open Source Nirlaba MyVPN</a></li>
<li><a href="../id486392/index.html">Perbandingan singkat arsitektur SDS atau menemukan platform penyimpanan yang sesuai (GlusterVsCephVsVirtuozzoStorage)</a></li>
<li><a href="../id486394/index.html">Bookmark - apakah ada batasan?</a></li>
<li><a href="../id486396/index.html">Bereaksi Asli: Tonggak Baru dalam Pengembangan Mobile Shopify</a></li>
<li><a href="../id486400/index.html">Untuk mendapatkan data pribadi Anda, Anda perlu memberikan lebih banyak data pribadi</a></li>
<li><a href="../id486402/index.html">Death Backup: Ancaman Baru dan Perlindungan Baru untuk Global Cyber ​​Summit 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>