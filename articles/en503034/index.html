<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìß üë®üèº‚Äçüç≥ üìù We extract constants from the crystal of the mathematical coprocessor 8087 üôéüèæ üë©üèº‚Äçüîß üìã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 1980, Intel introduced the 8087 chip to accelerate the processing of floating point numbers on 8086 processors, and it was used in the original IBM...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>We extract constants from the crystal of the mathematical coprocessor 8087</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503034/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In 1980, Intel introduced the 8087 chip to accelerate the processing of floating point numbers on 8086 processors, and it was used in the original IBM PC. Since the first microprocessors only worked with integers, arithmetic with floating point numbers was slow, and with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transcendental functions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> like arctangent or logarithms, things were even worse. Adding the 8087 coprocessor chip to the system was able to speed up operations with floating point numbers up to a hundred times.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I opened the 8087 chip and took a few photos of it under a microscope. The photo below shows a tiny silicon chip crystal. On its sides, tiny conductors connect it with 40 external legs. The markup of the main functional blocks in the picture was made by me thanks to reverse engineering. If you carefully study the chip, you can extract various constants from its ROM - numbers such as œÄ used by the chip in the calculations. </font><i><font style="vertical-align: inherit;">Intel 8087 chip chip for floating point operation with marked main function blocks. ROM with constants is marked in green. Clickable.</font></i></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/1o/ee/_a/1oee_auvu5lyuaxcrdoxcrm0vv4.jpeg"></a><br>
<i><font style="vertical-align: inherit;"></font></i><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the upper half of the chip are control circuits. Up to 1000 steps may be required to execute a floating point instruction; 8087 used microcode to describe these steps. In the photo of the crystal you can see the "mechanism" that launched the program from microcode; in fact, it is a simple CPU. Next to it is a large ROM, where the microcode is stored. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the bottom of the chip are circuits that process floating point numbers. A floating point number consists of a fractional part (also known as a significant part of a number or mantissa), an exponent, and a sign bit. In decimal notation, the number 6.02 √ó 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.02 will be the mantissa and 23 will be the exponent. Separate chip circuits simultaneously process the mantissa and exponent. The mantissa processing scheme supports 67-bit values ‚Äã‚Äã- a 64-bit mantissa and three additional bits for accuracy. From left to right, the mantissa operation schemes consist of ROMs with constants, a shift register, an adder / subtracter, and a register stack. The topic of this article is ROM with constants; in the photo it is highlighted in green.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8087 worked as a coprocessor to the 8086 processor. When the 8086 processor came across a special instruction related to floating point numbers, it ignored it and gave the 8087 the opportunity to execute it in parallel. The interaction of 8086 and 8087 was arranged in a rather cunning way. To simplify, then 8087 looks at the stream of instructions 8086, and executes any instructions related to 8087. The difficulty is that 8086 has a buffer of prefetching instructions, so the instruction that 8086 is currently receiving does not match the instruction he performs. Therefore, 8087 duplicated the 8086 instruction preemptive fetch buffer (or a smaller large 8088 instruction preemptive fetch buffer) to know what the 8086 was doing ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">described in more detail here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Another difficulty is associated with complex 8086 addressing modes that use registers inside 8086. 8087 cannot execute these addressing modes because it does not have access to 8086 registers. Instead, when 8086 sees the instruction for 8087, it requests data from a specified location in memory and ignores the result. Meanwhile, 8087 takes the address from the bus, in case he needs it. It may seem to you that a trap will form in this place if 8087 is not installed - but this will not happen. On a system without 8087, the linker rewrites the 8087 instructions, replacing them with subroutine calls from the emulation library.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not tell in detail the internal workings of 8087, but in general, floating point operations are implemented through additions, subtractions, and shifts of integers. </font><font style="vertical-align: inherit;">To add or subtract two floating point numbers, 8087 shifts the numbers until the binary commas are aligned (like decimal points, only in the binary system), and then adds or subtracts the mantissa. </font><font style="vertical-align: inherit;">Multiplication, division and taking the square root are performed by successive shifts and additions / subtractions. </font><font style="vertical-align: inherit;">Transcendental functions (tangent, arctangent, logarithm, degree) use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORDIC algorithms</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which use shifts and additions of special constants to increase the efficiency of calculations.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROM implementation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article describes the ROM where the constants are stored. Do not confuse it with a larger four-level ROM where the microcode is stored - this last one is implemented using an unusual technology that stores two bits per transistor. This is done using transistors of three different sizes or the absence of a transistor at each position. These four options indicate two bits. This </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sophisticated technology</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was needed in order to fit a large ROM onto an 8087 chip.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ROM for constants uses standard technologies for storing constants (such as œÄ, ln (2) and ‚àö2) required by 8087 for calculations. The photo below shows part of the ROM with constants. To see the crystal itself, a metal layer has been removed from it. Pinkish areas are silicon with impurities giving it different properties, and reddish and greenish lines are </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polysilicon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a special type of silicon wiring lying on top. Pay attention to the structure of the ROM, similar to the correct lattice. ROM consists of two columns of transistors storing bits. To explain the scheme of its operation, I will begin with the scheme of operation of the transistor. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/10e/594/914/10e594914b3b11d2fa9fa57e2fed653f.jpg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part of ROM with constants, with a removed metal layer. Three columns of larger transistors are used to select rows.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
High Density Integrated Circuits (ICs) in the 1970s were usually made from </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">N-MOS</font></a><font style="vertical-align: inherit;"> transistors</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Modern computers are made of CMOS, consisting of N-MOS and P-MOS reverse polarity to them). </font><font style="vertical-align: inherit;">The diagram below shows the structure of an N-MOS transistor. </font><font style="vertical-align: inherit;">The IC is assembled from a silicon substrate on which transistors are created. </font><font style="vertical-align: inherit;">Impurities are added to the silicon sites, creating "diffuse" regions with the desired electrical properties. </font><font style="vertical-align: inherit;">A transistor can be thought of as a switch that allows current to flow between two sections of diffusion, which are called the source and drain. </font><font style="vertical-align: inherit;">The transistor is controlled by a gate made of a special type of silicon - polysilicon. </font><font style="vertical-align: inherit;">Applying voltage to the gate allows current to flow between the source and drain; </font><font style="vertical-align: inherit;">otherwise, no current flows. </font><font style="vertical-align: inherit;">The 8087 is quite complex, with about 40,000 transistors on it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Different sources give a different number of transistors for 8087: Intel says about 40,000, Wikipedia says about 45,000. Perhaps the whole thing is in different calculation methods. Since the number of transistors in a ROM, PLA, or other similar structure depends on the data stored, sources often indicate the number of ‚Äúpotential‚Äù transistors instead of real ones. You can also consider or not consider pull-up transistors, or consider high-current drivers as one transistor or several parallel ones. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a8d/708/2ad/a8d7082ad4689514eafa3beb87976a76.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOS structure implemented in IP</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By zooming in, individual ROM transistors can be considered. Pinkish areas are silicon with impurities that form sources and drains. Polysilicon vertical select bus lines form transistor gates. The marked areas of silicon are connected to the ground, and pull down one side of each transistor. The circles are </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an interlayer vias between silicon and metal tires above. For photos, metal tires are removed; the location of one of them is shown by the orange line. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b64/c66/060/b64c66060496c9b3b31ffe4e4223da59.jpg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part of ROM with constants. Each sampling bus selects a specific constant. Transistors are shown in yellow. X marks the missing transistor corresponding to bit 0. The orange line indicates the location of the metal conductor.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An important feature of the ROM is the absence of some transistors - there is no first in the upper row, and two marked with X in the lower row. </font><font style="vertical-align: inherit;">Bits are programmed in ROM by changing the circuit for adding impurities to silicon, which create transistors or leave insulating areas. </font><font style="vertical-align: inherit;">Each available or missing transistor represents one bit. </font><font style="vertical-align: inherit;">When the sampling bus is activated, all transistors in this column open, pulling down the corresponding output buses. </font><font style="vertical-align: inherit;">But if there is no transistor in the selected position, the corresponding output will remain high. </font><font style="vertical-align: inherit;">Thus, the value is read from the ROM by activating the sample bus, which outputs this value from the ROM to the output buses.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROM contents</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ROM with constants consists of 143 rows and 21 columns. It contains 134 rows of 21 bits, except for one piece of 6 √ó 6 transistors in the upper left. Therefore, the physical size of the ROM with constants is 2946 bits. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9e4/07f/179/9e407f179428233808d1a084487ce41e.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the ROM scheme, the missing section means that the first 12 constants are 64-bit, not 67-bit. These are constants not related to CORDIC, and they apparently do not require additional precision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the microscope, the ROM bit pattern is visible, so it can be removed from there. However, it is not at all obvious how to interpret these bits later. The first question is whether the presence of a transistor indicates 0 or 1 (later it turned out that the presence of a transistor is 1). The second problem is how to translate the 134 √ó 21 bit grid into values.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bit encoding can be defined in two ways. The first is to track the circuit reading the data from the ROM and see how it is used. The second is to look for patterns in raw data and try to comprehend them. Since 8087 is very complex, I wanted to avoid full reverse engineering when studying constants, so I used the second approach. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The data path of the chip consists of 67 horizontal rows, so it was clear that the 134 rows in the ROM correspond to two sets of 67-bit constants. I extracted one set of constants from the odd series, and the other from the even series, however the obtained values ‚Äã‚Äãdid not make sense. Thinking a little more, I realized that the rows did not alternate, but walked in repeating ABBA order.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The rows went in the order ABBAABBAABBA ..., where rows A contained bits for one set of constants, and rows B contained bits for another. Such a circuit was used instead of simply alternating ABAW, possibly because one contact can control two adjacent transistors. That is, one conductor can select each of the groups AA and BB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When I took into account the ABBA order, I got a bunch of familiar constants, including œÄ and 1. The diagram below shows the bits from these constants. In the photo, bit 1 is a green strip, bit 0 is red. In the binary system, œÄ is 11.001001 ..., and it is this value that is visible in the upper row of marked bits. The lower value is constant 1. The </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ed4/8f7/4d6/ed48f74d62beb0e29a0700831a82ef3d.jpg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">upper row of bits is the number œÄ, the lower one is 1. This diagram is rotated 90 ¬∞ compared to the others.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next difficulty with interpretation is that only the mantissa are stored in the ROM, but not the exponent (so far I have not found a separate ROM with the exponents). And I experimented with various exhibitors until I got meaningful values. Some were immediately clear: for example, the constant 1.204120 gives log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2) using the exponent 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Others were more difficult to understand, for example, 1,734723. In the end, I realized that 1.734723 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Why is there such a constant in 8087? Perhaps because the 8087 supports </font><font style="vertical-align: inherit;">18-character </font><font style="vertical-align: inherit;">packed </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">binary decimal code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some exponents were very difficult to find, and I used the brute force method to see if the result would yield any logarithm or degree of some number. </font><font style="vertical-align: inherit;">The hardest thing was to determine the constant for ln (2) / 3. </font><font style="vertical-align: inherit;">The importance of this number is not clear to me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is the complete list of constants from ROM. </font><font style="vertical-align: inherit;">The ‚Äúmeaning‚Äù column is my description of the meaning.</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Constants</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decimal value</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meaning</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.204120 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-2</font></font></sup></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3010300</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.386294 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1</font></font></sup></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.6931472</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ln (2)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.442695 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sup> </td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.426950 </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (e)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.570796 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup> </td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1415927</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œÄ</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.000000 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sup> </td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.000000 </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.660964 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup> </td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.219281 </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (10)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.734723 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59</font></font></sup> </td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.00e + 18</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18</font></font></sup></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.734723 √ó 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59</font></font></sup> </td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.00e + 18</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18</font></font></sup></td>
</tr>
<tr>
<td>1.848392√ó2<sup>-3</sup></td>
<td>0.2310491</td>
<td>ln(2)/3</td>
</tr>
<tr>
<td>1.082021√ó2<sup>2</sup> </td>
<td>4.280851 </td>
<td>3*log<sub>2</sub>(e)</td>
</tr>
<tr>
<td>1.442695√ó2<sup>0</sup> </td>
<td>1.426950 </td>
<td>log<sub>2</sub> (e)</td>
</tr>
<tr>
<td>1.414214√ó2<sup>0</sup> </td>
<td>1.4142136</td>
<td>‚àö2</td>
</tr>
<tr>
<td>1.570796√ó2<sup>-1</sup></td>
<td>0.7853982</td>
<td>atan(2<sup>0</sup>)</td>
</tr>
<tr>
<td>1.854590√ó2<sup>-2</sup></td>
<td>0.4636476</td>
<td>atan(2<sup>-1</sup>)</td>
</tr>
<tr>
<td>2.000000√ó2<sup>-15</sup></td>
<td>0.0000610</td>
<td>atan(2<sup>-14</sup>)</td>
</tr>
<tr>
<td>2.000000√ó2<sup>-16</sup></td>
<td>0.0000305</td>
<td>atan(2<sup>-15</sup>)</td>
</tr>
<tr>
<td>1.959829√ó2<sup>-3</sup></td>
<td>0.2449787</td>
<td>atan(2<sup>-2</sup>)</td>
</tr>
<tr>
<td>1.989680√ó2<sup>-4</sup></td>
<td>0.1243550</td>
<td>atan(2<sup>-3</sup>)</td>
</tr>
<tr>
<td>2.000000√ó2<sup>-13</sup></td>
<td>0.0002441</td>
<td>atan(2<sup>-12</sup>)</td>
</tr>
<tr>
<td>2.000000√ó2<sup>-14</sup></td>
<td>0.0001221</td>
<td>atan(2<sup>-13</sup>)</td>
</tr>
<tr>
<td>1.997402√ó2<sup>-5</sup></td>
<td>0.0624188</td>
<td>atan(2<sup>-4</sup>)</td>
</tr>
<tr>
<td>1.999349√ó2<sup>-6</sup></td>
<td>0.0312398</td>
<td>atan(2<sup>-5</sup>)</td>
</tr>
<tr>
<td>1.999999√ó2<sup>-11</sup></td>
<td>0.0009766</td>
<td>atan(2<sup>-10</sup>)</td>
</tr>
<tr>
<td>2.000000√ó2<sup>-12</sup></td>
<td>0.0004883</td>
<td>atan(2<sup>-11</sup>)</td>
</tr>
<tr>
<td>1.999837√ó2<sup>-7</sup></td>
<td>0.0156237</td>
<td>atan(2<sup>-6</sup>)</td>
</tr>
<tr>
<td>1.999959√ó2<sup>-8</sup></td>
<td>0.0078123</td>
<td>atan(2<sup>-7</sup>)</td>
</tr>
<tr>
<td>1.999990√ó2<sup>-9</sup></td>
<td>0.0039062</td>
<td>atan(2<sup>-8</sup>)</td>
</tr>
<tr>
<td>1.999997√ó2<sup>-10</sup></td>
<td>0.0019531</td>
<td>atan(2<sup>-9</sup>)</td>
</tr>
<tr>
<td>1.441288√ó2<sup>-9</sup></td>
<td>0.0028150</td>
<td>log<sub>2</sub>(1+2<sup>-9</sup>)</td>
</tr>
<tr>
<td>1.439885√ó2<sup>-8</sup></td>
<td>0.0056245</td>
<td>log<sub>2</sub>(1+2<sup>-8</sup>)</td>
</tr>
<tr>
<td>1.437089√ó2<sup>-7</sup></td>
<td>0.0112273</td>
<td>log<sub>2</sub>(1+2<sup>-7</sup>)</td>
</tr>
<tr>
<td>1.431540√ó2<sup>-6</sup></td>
<td>0.0223678</td>
<td>log<sub>2</sub>(1+2<sup>-6</sup>)</td>
</tr>
<tr>
<td>1.442343√ó2<sup>-11</sup></td>
<td>0.0007043</td>
<td>log<sub>2</sub>(1+2<sup>-11</sup>)</td>
</tr>
<tr>
<td>1.441991√ó2<sup>-10</sup></td>
<td>0.0014082</td>
<td>log<sub>2</sub>(1+2<sup>-10</sup>)</td>
</tr>
<tr>
<td>1.420612√ó2<sup>-5</sup></td>
<td>0.0443941</td>
<td>log<sub>2</sub>(1+2<sup>-5</sup>)</td>
</tr>
<tr>
<td>1.399405√ó2<sup>-4</sup></td>
<td>0.0874628</td>
<td>log<sub>2</sub>(1+2<sup>-4</sup>)</td>
</tr>
<tr>
<td>1.442607√ó2<sup>-13</sup></td>
<td>0.0001761</td>
<td>log<sub>2</sub>(1+2<sup>-13</sup>)</td>
</tr>
<tr>
<td>1.442519√ó2<sup>-12</sup></td>
<td>0.0003522</td>
<td>log<sub>2</sub>(1+2<sup>-12</sup>)</td>
</tr>
<tr>
<td>1.359400√ó2<sup>-3</sup></td>
<td>0.1699250</td>
<td>log<sub>2</sub>(1+2<sup>-3</sup>)</td>
</tr>
<tr>
<td>1.287712√ó2<sup>-2</sup></td>
<td>0.3219281</td>
<td>log<sub>2</sub>(1+2<sup>-2</sup>)</td>
</tr>
<tr>
<td>1.442673√ó2<sup>-15</sup></td>
<td>0.0000440</td>
<td>log<sub>2</sub>(1+2<sup>-15</sup>)</td>
</tr>
<tr>
<td>1.442651√ó2<sup>-14</sup></td>
<td>0.0000881</td>
<td>log<sub>2</sub>(1+2<sup>-14</sup>)</td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not sure why 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18 is</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> repeated - perhaps the difference is exponential. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Physically, the constants are located in three groups. The first group is the values ‚Äã‚Äãthat the user can load (1, œÄ, log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10, log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2, and ln), as well as values ‚Äã‚Äãfor internal use (10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ln (2) / 3, 3 * log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (e), log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (e) and ‚àö2). The second group consists of 16 arctangent constants, and the third consists of 14 log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constants </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 8087, there are seven instructions for loading constants directly. The instructions FDLZ, FLD1, FLDPI, FLD2T, FLD2E, FLDLG2 and FLDLN2 load the constants 0, 1, œÄ, log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10, log </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> onto the stack</font></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2 and ln 2, respectively. </font><font style="vertical-align: inherit;">All these constants except 0 are stored in ROM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last two groups of constants are used to calculate transcendental functions using CORDIC algorithms.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORDIC Algorithms</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the constants from the ROM, you can find out some details of the operation of the 8087 algorithms. The ROM contains 16 values ‚Äã‚Äãfor the arctangent, arctangents from 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Also there are stored 14 logarithms on the base 2 of (1 + 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Such values ‚Äã‚Äãmay seem unusual, but they are used in the efficient CORDIC algorithm, invented in 1958. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The idea behind CORDIC is that tangent and arctangent can be calculated by breaking the angle into smaller ones with the rotation of the vector by these angles. The trick is that if you choose the right smaller angles, then each rotation can be calculated through the effective shifts and additions instead of trigonometric functions. Suppose we need to find tan (z). We can divide z into the sum of small angles: z ‚âà {atan (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) or 0} + {atan (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) or 0} + {atan (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-3</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) or 0} + ... + {atan (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-16</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or 0}. You can rotate the vector by, say, atan (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) by multiplying by 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and adding. The bottom line is that multiplying by 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-2 is</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> carried out through a fast bitwise shift.Taking all this into account, you can calculate tan (z) by comparing z with atan constants, and then after going through 16 cycles of additions and shifts, which is done quickly on iron. for atan are pre-calculated and stored in ROM. The arc tangent is calculated in a similar way, but vice versa - during rotation, the angles (from the ROM with constants) are summed up and give the final one.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When calculating the logarithm and exponent, CORDIC algorithms and their corresponding logarithmic constants are also used. The main thing here is that multiplication by (1 + 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) can be done quickly with the help of shifts and additions. The logarithm and exponent can be calculated by multiplying one side of the equation by a sequence of values ‚Äã‚Äãand adding the corresponding logarithmic constants to the other. According to the algorithms for calculating the logarithm and exponent of the documentation for 8087, I did not find it. I think that they are similar to those described in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , only 8087 uses base 2 instead of e. I do not understand why 8087 does not have the log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constant </font><font style="vertical-align: inherit;">(1 + 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) needed for that algorithm.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Support for transcendental functions in 8087 is not as extensive as you might expect. </font><font style="vertical-align: inherit;">It supports only tangent and arc tangent, without sines and cosines. </font><font style="vertical-align: inherit;">To calculate the latter, it is necessary to apply trigonometric identities. </font><font style="vertical-align: inherit;">Logarithms and exponents only support base 2 - for bases 10 or e the user will have to apply a scale factor. </font><font style="vertical-align: inherit;">At one time, 8087 expanded the limits of the capacity of the chips, so the number of instructions was minimized.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The 8087 is a complex chip, and at first glance it looks like a hopelessly tangled maze. However, for the most part, it can be understood after careful study. In its ROM, 42 constants are stored, and their values ‚Äã‚Äãcan be extracted using a microscope. Some constants (e.g. œÄ) were expected, while others (e.g. ln (2) / 3) raise more questions. Many of the constants are used to calculate tangents, arctangents, logarithms, and degrees using CORDIC algorithms. </font><i><font style="vertical-align: inherit;">Photo of a crystal 8087 without a metal layer. Clickable.</font></i></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/er/8g/3t/er8g3tlcli1uc7ag_qe-todazvy.jpeg"></a><br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although Intel 8087 for floating point operation was introduced 40 years ago, its impact is still felt. </font><font style="vertical-align: inherit;">He spawned the IEEE 754 standard for floating point numbers, used in most arithmetic calculations, and the 8087 instructions remain part of the x86 processors used on most computers.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en503014/index.html">A few straws for procrastinator</a></li>
<li><a href="../en503024/index.html">Brand protection: EU and scaling in 2020</a></li>
<li><a href="../en503026/index.html">Upgrade your CSS animations</a></li>
<li><a href="../en503028/index.html">Loading and processing images in .NET Core</a></li>
<li><a href="../en503032/index.html">Long DNS resolve in Kubernetes</a></li>
<li><a href="../en503040/index.html">Can the ‚ÄúSpaniard‚Äù like a zombie virus survive in permafrost?</a></li>
<li><a href="../en503042/index.html">5 Myths about Red Teaming</a></li>
<li><a href="../en503052/index.html">Automation of microfronts, or how component libraries are tested in Tinkoff</a></li>
<li><a href="../en503054/index.html">What is common between drops in a cup of coffee and quantum mechanics?</a></li>
<li><a href="../en503056/index.html">May 23 online pub: holivarim about clouds, JS and cell phones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>