<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛷 💅🏿 👨🏻‍⚕️ Antipatterns für die Arbeit mit Datenbanken 👨‍👩‍👧‍👦 🚵🏿 🙅🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Ich präsentiere Ihnen die Übersetzung meines Artikels „Datenbank: Anti-Patterns“ . 
 
 Wenn Sie Daten speichern, ist dies ein wichtiger Te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Antipatterns für die Arbeit mit Datenbanken</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487622/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! </font><font style="vertical-align: inherit;">Ich präsentiere Ihnen die Übersetzung meines Artikels </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Datenbank: Anti-Patterns“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Daten speichern, ist dies ein wichtiger Teil Ihrer Anwendung. </font><font style="vertical-align: inherit;">Sie können einfach und schnell eine Fehlerbehebung auf einer neuen Dating-Site beheben, sodass Bauer Joe aus Nordtexas endlich die letzte Nachricht von seinem Brieffreundliebhaber lesen und herausfinden kann, dass sie kahle Männer mag. </font><font style="vertical-align: inherit;">Aber Gott bewahre, dass Sie Benutzerdaten verlieren oder ruinieren. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e2d/e07/3a3/e2de073a3ff6c38cf29617834cd2cd42.png" alt="Bild"><br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Silicon Valley, Staffel 2, Folge 8</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viele Entwickler verstehen diese einfache Wahrheit jedoch nicht vollständig. </font><font style="vertical-align: inherit;">Ich bin seit vielen Jahren kein professioneller Programmierer mehr, aber ich habe bereits viele, viele Fehler gesehen, die von Leuten gemacht wurden, die mit der Datenbank arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind nur diejenigen, die sofort in den Sinn kommen.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehlende Backups</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/727/d48/742/727d487423bf0fb28b5a497d58cb2169.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Backups erstellen" ist eine dieser Regeln (wie "Nicht unter der Wurzel arbeiten" oder "Sicherheitsgurte anlegen"), denen viele von uns zustimmen, die sie jedoch nicht befolgen, in der Hoffnung, dass anderen und nicht uns schlimme Dinge passieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Übrigens, wenn Sie die Wiederherstellung von Sicherungen nicht testen, können Sie davon ausgehen, dass Sie überhaupt keine Sicherungen haben. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lerne aus den Fehlern anderer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit anderen Worten, von den fünf Sicherungstechnologien arbeitet niemand zuverlässig oder ist nicht konfiguriert. </font><font style="vertical-align: inherit;">Am Ende haben wir die Daten aus dem vor 6 Stunden erstellten Backup wiederhergestellt.</font></font></blockquote><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben die Datenbankdaten innerhalb von 6 Stunden (Probleme, Zusammenführungsanforderungen, Benutzer, Kommentare, Snippets usw.) mit GitLab.com verloren.</font></font></blockquote><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoSQL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es kommt vor, dass </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ihre Benutzer zu viele Inhalte für Erwachsene haben und diese zu oft ansehen. Die</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datenmenge ist zu groß oder die Last ist zu hoch, als dass die relationale Datenbank sie verarbeiten könnte. </font><font style="vertical-align: inherit;">Dies ist der Fall, wenn NoSQL-Technologien ins Spiel kommen. </font><font style="vertical-align: inherit;">Software-Giganten wie Google kennen dies aus erster Hand. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du bist nicht Google</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ein paar hundert Gigabyte sind keine „Big Data“, aber 1000 Kommentare pro Tag sind keine „hohe Last“. </font><font style="vertical-align: inherit;">Höchstwahrscheinlich reicht PostgreSQL für Ihre Daten. </font><font style="vertical-align: inherit;">Siehe: Es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unterstützt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sogar </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">JSON und kann es indizieren</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Komm schon, möchten Sie ernsthaft eine zuverlässige Struktur für Funktionen opfern, die Sie nicht benötigen und - ehrlich gesagt - niemals benötigt werden? </font><font style="vertical-align: inherit;">Sie werden nicht zum neuen Google - Sie haben nur ein Durcheinander in der Datenbank.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zu lockeres Schema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist für NoSQL relevanter, aber Benutzer relationaler DBMS vergessen häufig oder sind zu faul, um alle erforderlichen Einschränkungen zu erstellen. </font><font style="vertical-align: inherit;">Aufgrund eines Fehlers im Anwendungscode </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann dieser dort gespeichert werden, wo ein aussagekräftiger Wert erwartet wird, oder es kann ein Link zu einem fehlenden Eintrag erstellt werden. </font><font style="vertical-align: inherit;">Anschließend bemerken Sie dies und korrigieren den Code, haben aber keine Ahnung, wie Sie die Daten reparieren sollen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Natürliche Primärschlüssel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sich vor, wir möchten Benutzer speichern, von denen jeder eine eindeutige E-Mail-Adresse haben muss. </font><font style="vertical-align: inherit;">Die naheliegendste Lösung besteht darin, eine Tabelle </font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit einer Spalte </font><font style="vertical-align: inherit;">zu erstellen </font></font><code>email</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die auch der Primärschlüssel ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider kann der natürliche Schlüssel als primärer Schlüssel inakzeptabel werden, wenn sich die Anforderungen ändern (und sie sich ständig ändern). </font><font style="vertical-align: inherit;">Heute </font></font><code>PRIMARY KEY(email)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funktioniert es und morgen beschließen wir, die Registrierung über Facebook hinzuzufügen und die E-Mail optional zu machen. </font><font style="vertical-align: inherit;">Was ist besser: Generieren Sie eindeutige Adressen und fügen Sie ein Flag hinzu, das eine fiktive E-Mail kennzeichnet, oder ändern Sie den Primärschlüssel, alle Fremdschlüssel, auf die verwiesen </font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird usw. usw.? </font><font style="vertical-align: inherit;">Wir müssten uns nicht für das kleinere Übel entscheiden, wenn wir einfach einen Ersatzprimärschlüssel verwenden würden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logik im Speicher</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mag das aus zwei Gründen nicht:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendungscode ist normalerweise viel einfacher zu aktualisieren als ein Datenbankschema.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle diese SQL-PLs erinnern mich an Pascal und sind genauso hässlich.</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umgebungsspezifische Migrationsskripte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich weiß, dass es manchmal keine Wahl gibt, aber im Allgemeinen ist es besser sicherzustellen, dass alle Umgebungen (Entwickler, Test, Produkt usw.) so ähnlich wie möglich sind. </font><font style="vertical-align: inherit;">Je größer der Unterschied zwischen den Umgebungen ist, desto wahrscheinlicher ist es, dass ein Fehler gemacht wird und nur auf dem Produkt gefunden wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalerweise können sogar DML-Skripte universell sein. </font><font style="vertical-align: inherit;">Meistens sind verschiedene Pläne rein böse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ich daher umgebungsspezifische Labels in Liquibase-Skripten sehe, möchte ich töten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tolerante Migrationsskripte</font></font></h2><br>
<code>IF NOT EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und ähnliche Dinge in DDL sind nicht erforderlich, wenn in allen Umgebungen identische Schemata vorhanden sind, können jedoch Fehler maskieren. </font><font style="vertical-align: inherit;">Wenn während des Datenbank-Updates etwas Unerwartetes passiert, möchte ich es lieber herausfinden und so schnell wie möglich beheben, anstatt mir eine Woche später den Kopf zu zerbrechen, wie das Problem behoben werden kann.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nichtatomare Updates</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, Sie führen das Änderungsset auf Produktionsbasis aus und die Migration war nicht erfolgreich. Sie reparieren etwas und möchten es erneut versuchen. Wird es funktionieren? Was ist, wenn einige Änderungssatzvorgänge festgeschrieben werden, andere nicht? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Möglicherweise stellen Sie fest, dass dies tatsächlich eine Geschichte ist, bei der das Änderungsset </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idempotent sein sollte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und Sie werden Recht haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider verwenden viele Entwickler, die über Idempotenz nachdenken, </font></font><code>IF NOT EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder ähnliches. Im vorherigen Abschnitt habe ich erklärt, warum dies böse ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Machen Sie stattdessen den Änderungssatz </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atomar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Im Fehlerfall werden die vorgenommenen Änderungen dann rückgängig gemacht, und Sie haben keine Probleme mit der nachfolgenden Anwendung dieses Änderungssatzes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber seien Sie vorsichtig, wenn Sie mit Transaktionen rechnen. Zum Beispiel,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Unterstützung für DDL-Ausdrücke in MySQL-Transaktionen ist dunkel und voller</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Horror. Daher erstelle ich beim Schreiben von Liquibase-Skripten für MySQL immer einen separaten Änderungssatz für jeden DDL-Ausdruck. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche Antimuster haben Sie gesehen?</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487606/index.html">Visualisierung von Spannungslinien und Bewegungen elektrostatischer Ladungen, Simulation der Planetenbewegung des Sonnensystems</a></li>
<li><a href="../de487610/index.html">RealWorld: aiohttp, Tortoise ORM</a></li>
<li><a href="../de487612/index.html">Einfaches Hinzufügen, Löschen und Umbenennen von Dateien und Zielen in CMake-Projekten</a></li>
<li><a href="../de487616/index.html">Erstellen eines benutzerdefinierten Elements mithilfe einer C # -Tabelle für Windows Form</a></li>
<li><a href="../de487620/index.html">Problemlösung mit pwnable.kr 27 - tiny_easy. Grundlegendes zum Stapelspritzen</a></li>
<li><a href="../de487626/index.html">Wie Parksensoren funktionieren und wie man ihn austrickst</a></li>
<li><a href="../de487628/index.html">Diagnose des Alterns anhand von 9 Kennzeichen der Alterungserscheinungen</a></li>
<li><a href="../de487630/index.html">Der einfachste Algorithmus zum Erstellen eines Feldpuzzles (Teil 1)</a></li>
<li><a href="../de487632/index.html">„Kollegen, atmen Sie leiser“: Warum uns Bürolärm verrückt macht - wir diskutieren über Forschung</a></li>
<li><a href="../de487636/index.html">APIs, für die es sich endlich lohnt, ein Upgrade von Java 8 durchzuführen. Teil 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>