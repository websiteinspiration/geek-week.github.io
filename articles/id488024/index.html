<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ğŸ» ğŸ¯ ğŸš´ğŸ» Kunci penasehat yang fantastis dan di mana mereka tinggal ğŸ‰ â™¥ï¸ ğŸ›€ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PostgreSQL memiliki mekanisme yang sangat nyaman untuk kunci penasehat , mereka juga kunci penasehat . Kami di Tensor menggunakannya di banyak tempat ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kunci penasehat yang fantastis dan di mana mereka tinggal</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tensor/blog/488024/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL memiliki </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mekanisme yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sangat nyaman </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">untuk kunci penasehat</font></a><font style="vertical-align: inherit;"> , mereka juga </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kunci penasehat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kami di Tensor menggunakannya di banyak tempat dalam sistem, tetapi hanya sedikit orang yang memahami secara detail bagaimana tepatnya mereka bekerja, dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masalah apa yang dapat diperoleh jika diperlakukan dengan buruk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zi/sc/ak/ziscak3l-89wfdsjqhytpmkjalg.png"><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baca lebih lanjut tentang kunci</font></font></b><div class="spoiler_text">   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    PostgreSQL</a>.</div></div><br>
<h2><font color="#004080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keuntungan dari kunci rekomendasi</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perbedaan mendasar antara mekanisme ini dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kunci</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tingkat tabel / halaman / catatan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">"biasa"</font></a><font style="vertical-align: inherit;"> adalah bahwa ada beberapa fitur utama.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kunci ID Kustom</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci "normal" dalam PG selalu terikat ke objek database tertentu (tabel, catatan, halaman data) dan proses melayani koneksi. </font><font style="vertical-align: inherit;">Kunci penasihat juga merupakan proses, tetapi alih-alih objek nyata, pengidentifikasi abstrak dapat ditetapkan sebagai </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bigint)</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau sebagai </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(integer, integer)</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ngomong-ngomong, melampirkan setiap kunci ke suatu proses berarti bahwa dengan memberi nama melalui </font></font><code>pg_terminate_backend(pid)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau menyelesaikan koneksi dengan benar dari sisi klien, Anda dapat menyingkirkan semua kunci yang dikenakan olehnya.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAS Periksa Penguncian Kunci</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CAS adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compare-and-Set</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yaitu verifikasi kemampuan menangkap dan penangkapan kunci itu sendiri terjadi sebagai satu operasi atom, dan jelas tidak ada yang bisa "mengganjal" di antara mereka. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, jika Anda pertama kali membuat permintaan verifikasi ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_locks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lihat hasilnya, lalu putuskan apakah akan dikunci atau tidak, maka tidak ada yang menjamin bahwa di antara operasi ini tidak ada yang akan berhasil mengambil objek yang Anda butuhkan. </font><font style="vertical-align: inherit;">Tetapi jika Anda menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pg_try_advisory_lock</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka Anda akan segera menerima kunci ini, atau fungsinya hanya akan kembali </font></font><code>FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tanpa penangkapan tanpa pengecualian dan harapan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci "normal" ada dalam model </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Jika Anda sudah meminta kunci, maka tunggu. Jika Anda tidak ingin menunggu ( </font></font><code>NOWAIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>statement_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>lock_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) - inilah pengecualian "</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pendekatan ini sangat mengganggu dalam transaksi, karena Anda harus mengimplementasikan blok </font></font><code>BEGIN-EXCEPTION-END</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk memproses atau memutar kembali ( </font></font><code>ROLLBACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) transaksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu-satunya cara untuk menghindari perilaku ini adalah dengan menggunakan desain </font></font><code>SELECT ... SKIP LOCKED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang datang dengan versi 9.5. Sayangnya, dengan metode ini, opsi "tidak memiliki apa yang harus diblokir" dan "tadinya, tetapi sudah diblokir" menjadi tidak bisa dibedakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci yang disarankan karena </font><font style="vertical-align: inherit;">fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coba</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cukup kembali </font></font><code>TRUE/FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan bingung </font></font><code>pg_advisory_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font><font style="vertical-align: inherit;">- fungsi pertama </font><b><font style="vertical-align: inherit;">akan menunggu</font></b><font style="vertical-align: inherit;"> sampai menerima kunci, dan yang kedua hanya akan segera kembali </font><font style="vertical-align: inherit;">jika tidak mungkin untuk menangkapnya "sekarang."</font></font><code>pg_<i><b>try</b></i>_advisory_lock</code><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><code>FALSE</code><font style="vertical-align: inherit;"></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengunci di dalam dan setelah transaksi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang saya sebutkan di atas, kunci objek "dilampirkan" ke proses dan hanya ada sebagai bagian dari transaksi saat ini di dalamnya. </font><font style="vertical-align: inherit;">Bahkan hanya untuk memaksakan - tidak akan berhasil:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">LOCK</span> <span class="hljs-keyword">TABLE</span> tbl;
<span class="hljs-comment">-- ERROR:  LOCK TABLE can only be used in transaction blocks</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, pada akhir transaksi, semua kunci yang dikenakan padanya dihapus. </font><font style="vertical-align: inherit;">Sebaliknya, kunci penasihat pada awalnya dirancang dengan kemampuan untuk </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menahan kunci dan di luar ruang lingkup transaksi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> pg_advisory_lock(<span class="hljs-number">1</span>);
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> pg_locks <span class="hljs-keyword">WHERE</span> pid = pg_backend_pid() <span class="hljs-keyword">AND</span> locktype = <span class="hljs-string">'advisory'</span>;</code></pre><br>
<pre><code class="plaintext hljs">-[ RECORD 1 ]------+--------------<font></font>
locktype           | advisory<font></font>
database           | 263911484<font></font>
relation           |<font></font>
page               |<font></font>
tuple              |<font></font>
virtualxid         |<font></font>
transactionid      |<font></font>
classid            | 0 &lt;--  int4 #1    int8<font></font>
objid              | 1 &lt;--  int4 #2    int8<font></font>
objsubid           | 1<font></font>
virtualtransaction | 416/475768<font></font>
pid                | 29264<font></font>
mode               | ExclusiveLock<font></font>
granted            | t<font></font>
fastpath           | f</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi sudah dari versi 9.1, </font><font style="vertical-align: inherit;">versi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xact </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fungsi penasehat telah muncul</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang memungkinkan Anda untuk menerapkan perilaku kunci "biasa" yang secara otomatis dirilis ketika transaksi yang memberlakukannya selesai.</font></font><br>
<br>
<h2><font color="#004080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh penggunaan di VLSI</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, seperti kunci lainnya, penasihat berfungsi untuk memastikan keunikan memproses sumber daya. </font><font style="vertical-align: inherit;">Di negara kita, sumber daya semacam itu biasanya berupa seluruh tabel atau catatan tabel tertentu, yang karena alasan tertentu tidak ingin "dikunci".</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proses monoproses pekerja</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kebutuhan untuk memproses beberapa data dalam basis data dipicu oleh peristiwa eksternal, tetapi multi-pemrosesan berlebihan atau dapat menyebabkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kondisi balapan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , masuk akal untuk membuat hanya </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satu proses yang</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bekerja pada data ini </font><b><font style="vertical-align: inherit;">pada satu waktu</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, kami akan mencoba mengunci dengan pengidentifikasi tabel sebagai parameter pertama dan ID pemrosesan aplikasi spesifik sebagai yang kedua:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> pg_try_advisory_lock(
  <span class="hljs-string">'processed_table'</span>::regclass::<span class="hljs-keyword">oid</span>
, <span class="hljs-number">-1</span> <span class="hljs-comment">--   worker'</span>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kami kembali </font></font><code>FALSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, maka orang lain sudah memegang kunci seperti itu, dan secara khusus proses ini tidak perlu melakukan apa-apa, tetapi yang terbaik adalah hanya mengakhiri dengan tenang. </font><font style="vertical-align: inherit;">Ini adalah bagaimana, misalnya, proses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perhitungan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dinamis </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">dari biaya barang di gudang</font></a><font style="vertical-align: inherit;"> bekerja, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">dalam</font></a><font style="vertical-align: inherit;"> isolasi untuk setiap skema klien individu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemrosesan Antrian Bersamaan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang tugasnya adalah "kebalikannya" - kami ingin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas dalam beberapa tabel antrian</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diproses secepat mungkin, multi-threaded, toleran terhadap kesalahan, dan bahkan dari berbagai logika bisnis (yah, kami tidak memiliki kekuatan satu) - misalnya, seperti yang dilakukan operator kami tentang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transfer pelaporan elektronik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ke lembaga pemerintah atau </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">layanan OFD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena "pemrosesan" BL adalah server yang berbeda, tidak ada mutex yang dapat ditutup lagi. Tidak aman untuk memilih beberapa koordinator proses pendistribusian tugas khusus, "mati" dia - dan semuanya akan naik. Dan ternyata itu yang paling efisien untuk mendistribusikan tugas langsung di tingkat database, dan ada cara seperti itu - di zaman kuno, model itu secara jujur â€‹â€‹dimata-matai oleh </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dmitry Koterov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan kemudian dimodifikasi secara kreatif.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, kami mengenakan kunci pada ID tabel dan PK dari catatan tertentu:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span><font></font>
  *<font></font>
<span class="hljs-keyword">FROM</span><font></font>
  queue_table<font></font>
<span class="hljs-keyword">WHERE</span>
  pg_try_advisory_lock(<span class="hljs-string">'queue_table'</span>::regclass::<span class="hljs-keyword">oid</span>, pk_id)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span><font></font>
  pk_id<font></font>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, proses akan menerima dari tabel catatan pertama yang belum diblokir oleh saudara-saudaranya yang bersaing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, jika PK tidak terdiri dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bilangan bulat)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bilangan bulat, bilangan bulat)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (seperti dalam perhitungan biaya yang sama, misalnya), Anda dapat mengenakan kunci secara langsung pada pasangan ini - tidak mungkin bahwa persimpangan dengan "pesaing" akan terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting! </font><font style="vertical-align: inherit;">Jangan lupa untuk secara teratur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memelihara tabel antrian Anda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemrosesan Dokumen Eksklusif</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini digunakan di mana-mana dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solusi manajemen dokumen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Memang, dalam sistem web terdistribusi, satu dan dokumen yang sama dapat dibuka untuk dilihat oleh pengguna yang berbeda secara bersamaan, tetapi hanya dapat diproses (ubah statusnya, dll.) Kapan saja hanya dengan satu.</font></font><br>
<br>
<h2><font color="#004080"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah tradisional</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di mana tanpa mereka! </font><font style="vertical-align: inherit;">Hampir semua bermuara pada satu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">mereka tidak membuka apa yang mereka kunci</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multi-overlay dari satu kunci penasihat</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTFM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seperti yang mereka katakan:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika beberapa permintaan untuk pemblokiran diterima sekaligus, mereka menumpuk, jadi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika satu sumber daya telah diblokir tiga kali, harus diblokir tiga kali</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agar tersedia di sesi lain.</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Letakkan terlalu banyak kunci sekaligus</font></font></h4><br>
<img src="https://habrastorage.org/webt/c-/q5/19/c-q519tdomjwjhoofqaljskvcxa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ribuan dari mereka! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baca manual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lagi </font><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baik kunci penasihat dan reguler disimpan di area memori bersama, yang ukurannya ditentukan oleh parameter konfigurasi </font></font><code>max_locks_per_transaction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>max_connections</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Penting agar memori ini memadai, karena </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika tidak server tidak akan dapat mengeluarkan </font><font style="vertical-align: inherit;">kunci </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apa pun</font></font></u><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dengan demikian, jumlah kunci yang direkomendasikan yang dapat dikeluarkan oleh server biasanya terbatas pada puluhan atau ratusan ribu, tergantung pada konfigurasi server.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, jika suatu situasi muncul ketika Anda ingin memaksakan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beberapa ribu kunci penasihat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (bahkan jika Anda menghapusnya dengan benar nanti) - pikirkan dengan sangat keras di mana Anda akan menjalankan ketika server bangun.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kebocoran saat menyaring catatan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kami menerima permintaan sebelumnya dan menambahkan kondisi tidak berbahaya seperti ID pemeriksaan paritas - </font></font><code>AND pk_id % 2 = 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kedua kondisi</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk setiap entri </font><font style="vertical-align: inherit;">akan diperiksa </font><font style="vertical-align: inherit;">! </font><font style="vertical-align: inherit;">Akibatnya, </font></font><code>pg_try_advisory_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selesai, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kunci dilapiskan, dan kemudian catatan disaring</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berdasarkan paritas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x1/vo/jc/x1vojcx77r-yh1i_j4ygddkfqrg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atau opsi dari manual:</font></font><br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> pg_advisory_lock(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">FROM</span> foo <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> = <span class="hljs-number">12345</span>; <span class="hljs-comment">-- ok</span>
<span class="hljs-keyword">SELECT</span> pg_advisory_lock(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">FROM</span> foo <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> &gt; <span class="hljs-number">12345</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">100</span>; <span class="hljs-comment">-- !</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemblokiran tetap ada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi kami tidak mengetahui hal ini. </font><font style="vertical-align: inherit;">Diperlakukan dengan permintaan yang benar, dalam kasus terburuk - </font></font><code>pg_advisory_unlock_all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh, bingung!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klasik genre ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bingung </font><font style="vertical-align: inherit;">dan </font><font style="vertical-align: inherit;">, dan bertanya-tanya mengapa itu bekerja untuk waktu yang lama. </font><font style="vertical-align: inherit;">Tetapi karena versi non-coba sedang </font><b><font style="vertical-align: inherit;">menunggu</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Bingung </font><font style="vertical-align: inherit;">dan </font><font style="vertical-align: inherit;">, dan bertanya-tanya ke mana kunci itu pergi - dan itu "berakhir" dengan transaksi. </font><font style="vertical-align: inherit;">Dan transaksi terdiri dari satu permintaan, karena tidak ada tempat yang "secara eksplisit" dinyatakan, ya.</font></font><code>pg_<i><b>try</b></i>_advisory_lock</code><font style="vertical-align: inherit;"></font><code>pg_advisory_lock</code><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>pg_try_advisory_lock</code><font style="vertical-align: inherit;"></font><code>pg_try_advisory_<i><b>xact</b></i>_lock</code><font style="vertical-align: inherit;"></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja melalui pgbouncer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah sumber rasa sakit yang terpisah bagi banyak orang ketika, demi kinerja, bekerja dengan database melewati </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pgbouncer dalam mode transaksi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini berarti bahwa dua transaksi tetangga Anda yang berjalan pada koneksi yang sama ke database (yang sebenarnya melewati pgbouncer) dapat dieksekusi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam koneksi "fisik" yang berbeda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di sisi database. </font><font style="vertical-align: inherit;">Dan mereka memiliki kunci sendiri ... Masing-masing memiliki </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/l6/h0/ecl6h02_l0hbh4kspdrba2g0a5c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
beberapa pilihan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau pergi bekerja melalui koneksi langsung ke database</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau menciptakan suatu algoritma sehingga semua kunci penasehat hanya dalam transaksi (xact)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja untuk saat ini.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488010/index.html">Alat Desain Berbasis Domain</a></li>
<li><a href="../id488012/index.html">Parkir untuk kontra Anda</a></li>
<li><a href="../id488014/index.html">9. Fortinet Memulai v6.0. Pencatatan dan Pelaporan</a></li>
<li><a href="../id488018/index.html">CAPTCHA, kasus khusus: kami merusak jaringan saraf dengan tiga puluh baris kode</a></li>
<li><a href="../id488020/index.html">Vivaldi 2.11 - One Touch Beauty</a></li>
<li><a href="../id488026/index.html">Perhiasan, Printer Formlabs 3D dan Kepedulian Lingkungan</a></li>
<li><a href="../id488028/index.html">Cara mulai membuat game di UE4</a></li>
<li><a href="../id488030/index.html">Cara mengatur kulit di symfony</a></li>
<li><a href="../id488034/index.html">Apa yang bisa dilakukan dalam 48 jam? Wawancara dengan pemenang BioHack 2019 bioinformatika hackathon</a></li>
<li><a href="../id488036/index.html">Domain corp.com dijual. Ini berbahaya bagi ratusan ribu komputer perusahaan yang menjalankan Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>