<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö• üíâ ‚åõÔ∏è Public contracts, how to ensure their consistency ‚ôäÔ∏è ‚ô£Ô∏è ü•á</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Does your system consist of many interconnected services?
- still manually update the service code when changing the public API?
- changes in your s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Public contracts, how to ensure their consistency</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/directum/blog/502652/"><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Does your system consist of many interconnected services?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">still manually update the service code when changing the public API?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changes in your services often undermine the work of others, and other developers hate you for this?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you answered yes at least once, then welcome!</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terms</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Public contracts, specifications</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - public interfaces through which you can interact with the service. </font><font style="vertical-align: inherit;">In the text they mean the same thing.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the article about</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Learn how to reduce time spent developing web services using tools for unified description of contracts and automatic code generation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proper use of the techniques and tools described below will allow you to quickly roll out new features and not break old ones.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does the problem look like</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a system that consists of several services. </font><font style="vertical-align: inherit;">These services are assigned to different teams. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-e/nt/tj/-enttjd6jjg8qoq2c51pw4fha0a.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consumer services depend on the service provider. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The system evolves, and one day the service provider changes its public contracts. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hk/sf/qs/hksfqs6qfhp-ptvnfidpouif2ki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If consumer services are not ready for change, then the system ceases to work fully.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1u/iv/iq/1uiviq4rc31xzihqfa4rc2qzgdy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to solve this problem</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The supplier service team will fix everything</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This can be done if the supplier team owns the subject area of ‚Äã‚Äãother services and has access to their git repositories. </font><font style="vertical-align: inherit;">This will work only in small projects when there are few dependent services. </font><font style="vertical-align: inherit;">This is the cheapest option. </font><font style="vertical-align: inherit;">If possible, you should use it.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update the code of your service to the consumer team</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why are others breaking, but are we repairing? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the main question is how to fix your service, what does the contract look like now? </font><font style="vertical-align: inherit;">You need to learn the new provider service code or contact their team. </font><font style="vertical-align: inherit;">We spend time studying the code and interacting with another team.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Think what to do to prevent the problem from appearing</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most reasonable option in the long run. </font><font style="vertical-align: inherit;">Consider it in the next section.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to prevent the manifestation of a problem </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The life cycle of software development can be represented in three stages: design, implementation and testing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each of the steps needs to be expanded as follows:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at the design stage declaratively define contracts;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">during implementation, we generate server and client code under contracts;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when testing, we check contracts and try to take into account customer needs (CDC).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each of the steps is explained further on as an example of our problem.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How the problem looks with us</font></font></h3><br>
<img src="https://habrastorage.org/webt/ws/qh/3j/wsqh3j_vzqriz0hufhvw5k4j_1i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is what our ecosystem looks like. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Circles are services, and arrows are communication channels between them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frontend is a web-based client application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most arrows lead to the Storage Service. It stores documents. This is the most important service. After all, our product is an electronic document management system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Should this service change its contracts, the system will immediately stop working. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4t/mx/xx/4tmxxxgjb3e888bmekaqofdxhq8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sources of our system are mainly written in c #, but there are also services in Go and Python. In this context, it does not matter what the other services in the figure do. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/qw/pu/rtqwpuk7eea5fyotxyspnctk2iq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each service has its own client implementation for working with the storage service. When changing contracts, you must manually update the code in each project.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I would like to get away from manual updating towards automatic. </font><font style="vertical-align: inherit;">This will help increase the rate at which client code changes and reduce errors. </font><font style="vertical-align: inherit;">Errors are typos in the URL, errors due to carelessness, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, this approach does not fix errors in client business logic. </font><font style="vertical-align: inherit;">You can only adjust it manually.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From problem to task</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our case, it is required to implement </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automatic generation of client code. </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In doing so, the following should be considered:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server side - controllers are already written;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the browser is a client of the service;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Services communicate over HTTP.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generation must be tuned. </font><font style="vertical-align: inherit;">For example, to support JWT.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Questions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the course of solving the problem, questions arose:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which tool to choose;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how to get contracts;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where to place the contracts;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where to place the client code;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at what point to do the generation.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following are answers to these questions.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Which tool to choose</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tools for working with contracts are presented in two directions - RPC and REST. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wy/3e/3k/wy3e3k54sqffxjda4tvynid6rcy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPC can be understood as just a remote call, while REST requires additional conditions for HTTP verbs and URLs.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The differences in RPC and REST call are presented here.</font></font></b>
                        <div class="spoiler_text"><div class="scrollable-table"><table>
<tbody><tr>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC - Remote procedure call</font></font></td>
<td colspan="2">REST Representational State Transfer</td>
</tr>
<tr>
<td colspan="2">  </td>
<td colspan="2">, HTTP-  URL</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Restaurant</a>:8080/Orders/PlaceOrder</td>
<td>POST</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Restaurant</a>:8080/Orders</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Restaurant</a>:8080/Orders/GetOrder?OrderNumber=1</td>
<td>GET</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Restaurant</a>:8080/Orders/1</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Restaurant</a>:8080/Orders/UpdateOrder</td>
<td>PUT</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Restaurant</a>:8080/Orders/1</td>
</tr>
</tbody></table></div><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tools</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The table shows a comparison of tools for working with REST and RPC.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Properties</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapi</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wsdl</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thrift</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gRPC</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A type</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rpc</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Platform</font></font></td>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Does not depend</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tongue</font></font></td>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Does not depend</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Development sequence *</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code first, spec first</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code first, spec first</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spec first</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code first, spec first</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transport protocol</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 1.1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">any (REST requires HTTP)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">own</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 2</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">View</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specification</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">framework </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Low entry threshold, lots of documentation</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML redundancy, SOAP, etc.</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">High entry threshold, little documentation</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Average entry threshold, better documentation</font></font></td>
</tr>
</tbody></table></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code first</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - first we write the server part, and then we get contracts on it. </font><font style="vertical-align: inherit;">It is convenient when the server side is already written. </font><font style="vertical-align: inherit;">No need to manually describe contracts. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spec first</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - first we define the contracts, then we get the client part and the server part from them. </font><font style="vertical-align: inherit;">It is convenient at the beginning of development when there is no code yet. </font><font style="vertical-align: inherit;">
WSDL </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">output is</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> not suitable due to its redundancy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Thrift is too exotic and difficult to learn.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRPC requires net Core 3.0 and net Standard 2.1. </font><font style="vertical-align: inherit;">At the time of analysis, net Core 2.2 and net Standard 2.0 were used. </font><font style="vertical-align: inherit;">There is no GRPC support in the browser out of the box, an additional solution is required. </font><font style="vertical-align: inherit;">GRPC uses Protobuf and HTTP / 2 binary serialization. </font><font style="vertical-align: inherit;">Because of this, the range of utilities for testing APIs such as Postman, etc., is narrowing. </font><font style="vertical-align: inherit;">Load testing through some JMeter may require additional effort. </font><font style="vertical-align: inherit;">Not suitable, switching to GRPC requires a lot of resources. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAPI does not require additional updates. </font><font style="vertical-align: inherit;">It captivates an abundance of tools that support working with REST and this specification. </font><font style="vertical-align: inherit;">We select it.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tools for working with OpenAPI</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The table shows a comparison of tools for working with OpenAPI.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tools</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swashbuckle</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapitools</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported Specification Versions</font></font></td>
<td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Can generate specifications in OpenApi v2, v3 format</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code first support</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported Server Languages</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C #</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A lot of</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported customer languages</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C #, TypeScript, AngularJS, Angular (v2 +), window.fetch API</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A lot of</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generation Settings</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there is</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">View</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuget package</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuget package + separate utility</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Separate utility</font></font></td>
</tr>
</tbody></table></div><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The conclusion of</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Swashbuckle is not suitable, because </font><font style="vertical-align: inherit;">allows you to get only the specification. </font><font style="vertical-align: inherit;">To generate client code, you need to use an additional solution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenApiTools is an interesting tool with a bunch of settings, but it does not support code first. </font><font style="vertical-align: inherit;">Its advantage is the ability to generate server code in many languages. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag is convenient in that it is a Nuget package. </font><font style="vertical-align: inherit;">It is easy to connect when building a project. </font><font style="vertical-align: inherit;">Supports everything we need: code first approach and generation of client code in c #. </font><font style="vertical-align: inherit;">We select it.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where to arrange contracts. </font><font style="vertical-align: inherit;">How to access services to contracts</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are solutions for organizing contract storage. </font><font style="vertical-align: inherit;">The solutions are listed in order of increasing complexity.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Provider service project folder is the easiest option. </font><font style="vertical-align: inherit;">If you need to run in the approach, then choose it.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a shared folder is a valid option if the desired projects are in the same repository. </font><font style="vertical-align: inherit;">In the long run, it will be difficult to maintain the integrity of the contracts in the folder. </font><font style="vertical-align: inherit;">This may require an additional tool to account for different versions of contracts, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separate repository for specifications - if the projects are in different repositories, then the contracts should be placed in a public place. </font><font style="vertical-align: inherit;">The disadvantages are the same as the shared folder.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">through the service API (swagger.ui, swaggerhub) - a separate service that deals with specification management.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We decided to use the simplest option - to store contracts in the project folder of the service provider. </font><font style="vertical-align: inherit;">This is enough for us at this stage, so why pay more?</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At what point do you generate</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you need to decide at what point to perform code generation. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the contracts were shared, consumer services could receive the contracts and generate the code themselves if necessary. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We decided to place the contracts in the folder with the service provider project. </font><font style="vertical-align: inherit;">This means that generation can be done after the assembly of the supplier service project itself.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where to place the client code</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Client code will be generated by contract. </font><font style="vertical-align: inherit;">It remains to find out where to place it. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It seems like a good idea to put the client code in a separate StorageServiceClientProxy project. </font><font style="vertical-align: inherit;">Each project will be able to connect this assembly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Benefits of this solution:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client code is close to its service and is constantly up to date;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consumers can use the link to the project within one repository.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disadvantages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will not work if you need to generate a client in another part of the system, for example, a different repository. </font><font style="vertical-align: inherit;">It is solved using at least a shared folder for contracts;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consumers must be written in the same language. </font><font style="vertical-align: inherit;">If you need a client in another language, you need to use OpenApiTools.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We fasten NSwag</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controller Attributes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Need to tell NSwag how to generate the correct specification for our controllers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, you need to arrange the attributes.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.Routing.Route(<span class="hljs-meta-string">"[controller]"</span>)</span>]  <span class="hljs-comment">//  url</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ApiController</span>] <span class="hljs-comment">//     </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DescriptionController</span> : <span class="hljs-title">ControllerBase</span> {<font></font>
[<span class="hljs-meta">NSwag.Annotations.OpenApiOperation(<span class="hljs-meta-string">"GetDescription"</span>)</span>] <span class="hljs-comment">//    </span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(typeof(ConversionDescription), 200)</span>] <span class="hljs-comment">//    200  </span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(401)</span>] <span class="hljs-comment">//    401</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(403)</span>] <span class="hljs-comment">//    403</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.HttpGet(<span class="hljs-meta-string">"{pluginName}/{binaryDataId}"</span>)</span>] <span class="hljs-comment">//  url</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ActionResult&lt;ConversionDescription&gt; <span class="hljs-title">GetDescription</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> pluginName, Guid binaryDataId</span>)</span> { 
 <span class="hljs-comment">// ... </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By default, NSwag cannot generate the correct specification for the MIME type application / octet-stream. </font><font style="vertical-align: inherit;">For example, this can happen when files are transferred. </font><font style="vertical-align: inherit;">To fix this, you need to write your attribute and processor to create the specification.</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.Route(<span class="hljs-meta-string">"[controller]"</span>)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ApiController</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileController</span> : <span class="hljs-title">ControllerBase</span> {<font></font>
[<span class="hljs-meta">NSwag.Annotations.OpenApiOperation(<span class="hljs-meta-string">"SaveFile"</span>)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(401)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(403)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.HttpPost(<span class="hljs-meta-string">"{pluginName}/{binaryDataId}/{fileName}"</span>)</span>]<font></font>
[<span class="hljs-meta">OurNamespace.FileUploadOperation</span>] <span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SaveFile</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">// ... }</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processor for generating specifications for file operations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The idea is that you can write your attribute and processor to handle this attribute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We hang the attribute on the controller, and when NSwag meets it, it will process it using our processor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To implement this, NSwag provides the OpenApiOperationProcessorAttribute and IOperationProcessor classes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our project, we made our heirs:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FileUploadOperationAttribute: OpenApiOperationProcessorAttribute</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FileUploadOperationProcessor: IOperationProcessor</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read more about using processors here.</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag configuration for spec and code generation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the config 3 main sections:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runtime - Specifies .net runtime. </font><font style="vertical-align: inherit;">For example, NetCore22;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentGenerator - describes how to generate a specification;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codeGenerators - defines how to generate code according to the specification.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSwag contains a bunch of settings, which is confusing at first. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For convenience, you can use NSwag Studio. </font><font style="vertical-align: inherit;">Using it, you can see in real time how various settings affect the result of code generation or specifications. </font><font style="vertical-align: inherit;">After that, manually select the selected settings in the configuration file. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read more about config settings here</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We generate the specification and client code when assembling the project of the service provider</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So that after the assembly of the service provider project, the specification and code are generated, do the following:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We created a WebApi project for the client.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We wrote a config for Nswag CLI - Nswag.json (described in the previous section).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We wrote a PostBuild Target inside the csproj service provider project.</font></font></li>
</ol><br>
<code>&lt;Target Name="GenerateWebApiProxyClient‚Äú AfterTargets="PostBuildEvent"&gt;<br>
&lt;Exec Command="$(NSwagExe_Core22) run nswag.json‚Äù/&gt;<br>
</code><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ (NSwagExe_Core22) run nswag.json - run the NSwag utility under .bet runtine netCore 2.2 with the nswag.json configuration </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Target does the following:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag generates a specification from a vendor service assembly.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag generates client code as per specification.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After each assembly of the service provider project, the client project is updated. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The project of the client and the service provider are within the same solution. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assembly takes place as part of the solution. </font><font style="vertical-align: inherit;">The solution is configured that the client project should be assembled after the supplier service project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSwag also allows you to customize specification / code generation imperatively through the software API.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to add support for JWT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to protect our service from unauthorized requests. </font><font style="vertical-align: inherit;">For this, we will use JWT tokens. </font><font style="vertical-align: inherit;">They must be sent in the headers of each HTTP request so that the service provider can check them and decide whether to fulfill the request. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
More information about JWT here </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jwt.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The task boils down to the need to modify the headers of the outgoing HTTP request. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, the NSwag code generator can generate an extension point ‚Äî the CreateHttpRequestMessageAsync method. </font><font style="vertical-align: inherit;">Inside this method there is access to the HTTP request before it is sent.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code example</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> Task&lt;HttpRequestMessage&gt; <span class="hljs-title">CreateHttpRequestMessageAsync</span>(<span class="hljs-params">CancellationToken cancellationToken</span>)</span> {
      <span class="hljs-keyword">var</span> message = <span class="hljs-keyword">new</span> HttpRequestMessage();<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(<span class="hljs-keyword">this</span>.AuthorizationToken)) {<font></font>
        message.Headers.Authorization =<font></font>
          <span class="hljs-keyword">new</span> System.Net.Http.Headers.AuthenticationHeaderValue(BearerScheme, <span class="hljs-keyword">this</span>.AuthorizationToken);<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> Task.FromResult(message);<font></font>
    }<font></font>
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We chose the option with OpenAPI, because </font><font style="vertical-align: inherit;">It‚Äôs easy to implement, and the tools for working with this specification are highly developed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conclusions on OpenAPI and GRPC: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAPI</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the specification is verbose;</font></font></li>
<li>          ,  ;</li>
<li>     ;</li>
<li>    .</li>
</ul><br>
<b>GRPC</b><br>
<br>
<ul>
<li>  ,      URL, HTTP  ..;</li>
<li>      OpenAPI;</li>
<li>    ;</li>
<li>           ;</li>
<li>     HTTP/2.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, we received a specification based on the already written code of the controllers. </font><font style="vertical-align: inherit;">To do this, it was necessary to hang special attributes on the controllers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then, based on the received specification, we implemented the generation of client code. </font><font style="vertical-align: inherit;">Now we do not need to manually update the client code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Studies have been conducted in the area of ‚Äã‚Äãversioning and testing contracts. </font><font style="vertical-align: inherit;">However, it was not possible to test the whole thing in practice due to lack of resources.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versioning Public Contracts</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why versioning public contracts?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After changes in service providers, the entire system must remain in a consistent, operational state. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Breaking changes in the public API must be avoided so as not to break clients.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solution options</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Without versioning public contracts</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The service provider team itself fixes the consumer services. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f0/k3/_6/f0k3_6ed1gt10sz1k5ol2brrj80.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach will not work if the service provider team does not have access to the consumer service repositories or lacks competencies. </font><font style="vertical-align: inherit;">If there are no such problems, then you can do without versioning.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-8/dd/ri/-8ddri4wch4oiugyd2bvz28zvzk.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use versioning of public contracts</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The service provider team leaves the previous version of the contracts. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/xg/e9/-vxge9yyrzws2i3lbm5b6rrvbyq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach does not have the drawbacks of the previous one, but adds other difficulties. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to decide on the following:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which tool to use;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when to introduce a new version;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how long to maintain old versions.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Which tool to use</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The table shows the features of OpeanAPI and GRPC associated with versioning.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gRPC</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapi</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version attribute</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the protobuf level, there is an attribute package [packageName]. [Version]</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the specification level, there are basePath (for URL) and Version attributes</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deprecated attribute for methods</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yes, but not taken into account by the code generator under C #</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yes, it is marked as Obsolete </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. NSwag is not supported with code first, you need to write your processor</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deprecated attribute for parameters</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is marked as Obsolete</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yes, it is marked as Obsolete </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. NSwag is not supported with code first, you need to write your processor</font></font><br>
</td>
</tr>
</tbody></table></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deprecated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> means that this API is no longer worth using. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Both tools support version and Deprecated attributes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you use OpenAPI and the code first approach, again you need to write processors to create the right specification.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When to introduce a new version</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The new version must be introduced when changes to the contracts do not preserve backward compatibility. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to verify that changes violate compatibility between the new and old versions of contracts?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for OpenAPI there is an Azure opeanapi-diff tool for checking compatibility between 2 specifications </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/Azure/openapi-diff;</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no automatic tool was found for gRPC, there are only versioning policies; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">general </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/grpc/grpc/blob/master/doc/versioning.md;</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">under .Net </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/aspnet/core/grpc/versioning?view=aspnetcore-3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How long to maintain versions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is no right answer to this question. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To remove support for the old version, you need to know who uses your service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It will be bad if the version is removed, and someone else uses it. </font><font style="vertical-align: inherit;">It is especially difficult if you do not control your customers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So what can be done in this situation?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notify customers that the old version will no longer be supported. </font><font style="vertical-align: inherit;">In this case, we may lose customer income;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support the entire set of versions. </font><font style="vertical-align: inherit;">The cost of software support is growing;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to answer this question, you need to ask the business - does the income from old customers exceed the cost of supporting older versions of software? </font><font style="vertical-align: inherit;">Could it be more profitable to ask customers to upgrade?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only advice in this situation is to pay more attention to public contracts in order to reduce the frequency of their changes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If public contracts are used in a closed system, you can use the CDC approach. </font><font style="vertical-align: inherit;">So we can find out when customers stopped using older versions of the software. </font><font style="vertical-align: inherit;">After that, you can remove the support of the old version.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use versioning only if you cannot do without it. </font><font style="vertical-align: inherit;">If you decide to use versioning, then when designing contracts, consider version compatibility. </font><font style="vertical-align: inherit;">A balance must be struck between the cost of supporting older versions and the benefits it provides. </font><font style="vertical-align: inherit;">It is also worth deciding when you can stop supporting the old version.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testing Contracts and CDC</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This section is illuminated superficially, as </font><font style="vertical-align: inherit;">There are no serious prerequisites for the implementation of this approach.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consumer driven contracts (CDC)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CDC is the answer to the question of how to ensure that the supplier and the consumer use the same contracts. </font><font style="vertical-align: inherit;">These are some kind of integration tests aimed at checking contracts. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The idea is as follows:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The consumer describes the contract.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The supplier implements this contract at home.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This contract is used in the CI process at the consumer and supplier. </font><font style="vertical-align: inherit;">If the process is violated, then someone has ceased to comply with the contract.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pact</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PACT is a tool that implements this idea.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The consumer writes tests using the PACT library.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These tests are converted to an artifact - pact file. </font><font style="vertical-align: inherit;">It contains information about the contracts.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The provider and consumer use the pact file to run the tests.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During client tests, a provider stub is created, and during supplier tests, a client stub is created. </font><font style="vertical-align: inherit;">Both of these stubs use a pact file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Similar stub creation behavior can be achieved through the Swagger Mock Validator </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitbucket.org/atlassian/swagger-mock-validator/src/master</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Useful links about Pact</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pact broker - pact file management solution </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io/pact_broker</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pact does not yet support GRPC. </font><font style="vertical-align: inherit;">Read more about roadmap Pact </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pact.canny.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More information about PACT on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why you should use PACT </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io/faq/convinceme</font></font></a></li>
</ul><br>
<img src="https://habrastorage.org/webt/0u/qv/-f/0uqv-fhceairtmtcfyv6fy9b-xg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How CDC can be embedded in CI</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deploying Pact + Pact broker yourself;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">purchase a ready-made Pact Flow SaaS solution.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pact is needed to ensure contract compliance. </font><font style="vertical-align: inherit;">It will show when changes in contracts violate the expectations of consumer services. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This tool is suitable when the supplier adapts to the customer - the customer. </font><font style="vertical-align: inherit;">This is only possible inside an isolated system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are making a service for the outside world and don‚Äôt know who your customers are, then Pact is not for you.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502636/index.html">Business and cyberpunk: mix, sustain, use</a></li>
<li><a href="../en502638/index.html">How to develop a blog on Instagram in 2020: analysis of the case of Sasha Mitroshina</a></li>
<li><a href="../en502642/index.html">Putting the game "Snake" on the breadboard. Part 2: ‚Äúvector‚Äù display</a></li>
<li><a href="../en502644/index.html">How Sherpaa Transmitted Unrealistic Venture Capital Expectations</a></li>
<li><a href="../en502648/index.html">Top 10 misconceptions about porting Hadoop to the cloud</a></li>
<li><a href="../en502654/index.html">Jack Ma has a lot of mistakes in English, but his speaking skills are higher than most students. Why is that?</a></li>
<li><a href="../en502656/index.html">Microminiaturization: two-atom magnetic semiconductor</a></li>
<li><a href="../en502660/index.html">How to translate "participation" / "participants" without part / participate</a></li>
<li><a href="../en502662/index.html">Everyday life "alchemist"</a></li>
<li><a href="../en502666/index.html">Assembly 486 - component selection</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>