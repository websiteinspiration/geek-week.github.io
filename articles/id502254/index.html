<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏪ 👨🏾‍🏭 🖖🏻 PostgreSQL: Pemrograman sisi server dalam bahasa manusia (PL / Perl, PL / Python, PL / v8) 👨🏿‍🔬 👩🏼‍🤝‍👨🏽 🚕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Postgres dikenal karena ekstensibilitasnya, yang juga berlaku untuk mendukung bahasa prosedural (PL). Tidak ada yang bisa membanggakan bahasa dengan d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PostgreSQL: Pemrograman sisi server dalam bahasa manusia (PL / Perl, PL / Python, PL / v8)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/502254/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postgres dikenal karena ekstensibilitasnya, yang juga berlaku untuk mendukung bahasa prosedural (PL). Tidak ada yang bisa membanggakan </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bahasa dengan</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> daftar bahasa yang panjangnya seperti ini, dan kemungkinan daftar ini sama sekali tidak terbatas: untuk menghubungkan bahasa ke server, tidak diperlukan usaha ekstra. Anda bahkan dapat membuat bahasa Anda sendiri dan menjadikannya bahasa prosedural server. Perubahan dalam DBMS tidak akan membutuhkan ini. Seperti banyak lagi, ekstensibilitas ini telah dibangun ke dalam arsitektur Postgres sejak awal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adalah mungkin dan terkadang diperlukan untuk menulis bahasa PL untuk tugas-tugas. Lebih baik lagi, jika seseorang menulis kerangka kerja seperti itu untuk menulis bahasa sehingga Anda tidak bisa menulis dalam bahasa C, tetapi memilih bahasa yang lebih nyaman bagi pengembang bahasa. Seperti halnya FDW, yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dapat ditulis dengan Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini ditulis berdasarkan sejumlah laporan dan kelas master pada topik ini yang dibuat oleh penulis di konferensi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PgConf.Russia 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PgConf.Russia 2018</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevConf 2017</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini bukan tentang eksotis, tetapi tentang bahasa prosedural yang paling umum PL / Perl, PL / Python dan PL / V8 (mis. JavaScript) dan membandingkan kemampuan mereka dengan PL / pgSQL.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kapan bahasa-bahasa ini layak digunakan? </font><font style="vertical-align: inherit;">Kapan SQL dan PL / pgSQL hilang?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemudian, ketika Anda perlu bekerja dengan struktur yang kompleks, dengan algoritma: melintasi pohon, misalnya, atau ketika penguraian HTML atau XML diperlukan, terutama ketika mengekstraksi mereka dari arsip;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika Anda perlu secara dinamis menghasilkan SQL kompleks (laporan, ORM). </font><font style="vertical-align: inherit;">Pada PL / pgSQL, ini tidak hanya merepotkan, tetapi juga akan bekerja lebih lambat dalam beberapa kasus;</font></font></li>
<li>         Perl  Python,        C/C++,      Perl  Python    .         . ,    Oracle.     ,    Postgres   .    Perl  Python  .</li>
<li>   —    .   , ,   untrusted- (  — . ),    Perlu  Python(3)u,    PL/V8.   Postgres  ,     ,   FDW,    ,         .       .  !</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan satu hal lagi: jika Anda akan menulis sesuatu dalam bahasa C, maka Anda dapat membuat prototipe dalam bahasa-bahasa ini yang lebih disesuaikan dengan perkembangan yang cepat.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cara menanamkan bahasa di Postgres</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengimplementasikan bahasa yang Anda butuhkan: tulis dalam C dari satu hingga tiga fungsi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HANDLER - penangan panggilan yang akan menjalankan fungsi dalam bahasa (ini adalah bagian yang diperlukan);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INLINE - penangan blok anonim (jika Anda ingin bahasa mendukung blok anonim);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VALIDATOR - fungsi verifikasi kode saat membuat fungsi (jika Anda ingin verifikasi ini dilakukan).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dijelaskan secara rinci dalam dokumentasi di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Bahasa di luar kotak” dan bahasa lainnya</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya ada empat bahasa yang didukung "out of the box": </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / pgSQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Tcl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi gelitiknya lebih merupakan penghormatan kepada sejarah: beberapa orang menggunakannya sekarang, kami tidak akan membicarakannya lagi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / Perl, PL / Python dan, tentu saja, PL / pgSQL didukung oleh komunitas Postgres. Dukungan untuk bahasa non-kotak lain jatuh pada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengelola</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mereka </font><font style="vertical-align: inherit;">- perusahaan, komunitas, atau pengembang tertentu yang tertarik untuk membuat bahasa berfungsi di dalam DBMS. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mempromosikan Google. Tetapi dari waktu ke waktu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ada alasannya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meragukan masa depan tanpa awan dari PL / V8. Pemelihara proyek PL / V8 Google saat ini, Jerry Sievert, sedang mempertimbangkan dukungan JS berbasis server postgres berdasarkan mesin yang berbeda (seperti QuickJS), karena PL / V8 sulit untuk dibangun dan membutuhkan 3-5 GB segala macam hal di Linux saat membangun, dan ini sering menyebabkan masalah pada OS yang berbeda. Tetapi PL / V8 digunakan secara luas dan diuji secara menyeluruh. Ada kemungkinan bahwa PL / JS akan muncul sebagai alternatif untuk mesin JS lain, atau untuk saat ini hanya sebagai nama, yang akan kita gunakan selama periode transisi. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jarang digunakan. Saya pribadi tidak perlu menulis di PL / Java karena di PL / Perl dan di PL / V8 ada cukup fungsionalitas untuk hampir semua tugas. Bahkan Python tidak terlalu menambahkan fitur. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / R</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berguna untuk mereka yang menyukai statistik dan menyukai bahasa ini. Kami juga tidak akan membicarakannya di sini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa populer belum tentu populer dengan penyimpanan penulisan: ada PL / PHP, tetapi sekarang secara praktis tidak didukung oleh siapa pun - ada beberapa yang ingin menulis prosedur server di atasnya. Untuk bahasa PL / Ruby, gambarnya entah bagaimana sama, meskipun bahasanya tampaknya lebih modern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa prosedural berbasis-Go sedang dikembangkan, lihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Go</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan sepertinya, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Lua</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Penting untuk mempelajarinya. Untuk penggemar keras kepala dari shell, bahkan ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Sh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sulit untuk membayangkan untuk apa itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setidaknya ada satu bahasa prosedural khusus domain (DSL) yang khusus dikhususkan untuk tugasnya - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Proxy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang dulunya sangat populer untuk proksi dan menyeimbangkan beban server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, kita akan membahas bahasa utama yang paling umum digunakan. Ini, tentu saja, adalah PL / PgSQL, PL / Perl, PL / Python dan PL / V8, kami akan memanggil mereka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / * di</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bawah ini </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa “out of the box” benar-benar hampir secara harfiah dipasang di luar kotak - biasanya instalasi tidak menyakitkan. Tetapi untuk menginstal PL / V8, jika Anda tidak menemukan paket dengan versi yang diperlukan di repositori OS Anda, ini hampir merupakan suatu prestasi, karena untuk ini Anda harus benar-benar membangun seluruh V8, atau, dengan kata lain, Chromium. Pada saat yang sama, seluruh infrastruktur pengembangan akan diunduh dari google.com bersama dengan V8 itu sendiri - andalkan beberapa gigabyte traffic. Untuk Postgres 11 di Ubuntu, paket PL / V8 belum muncul, hanya V8 untuk PG 10 yang tersedia di repositori sejauh ini. Jika Anda mau, kumpulkan dengan tangan. Penting juga bahwa versi yang akan Anda temukan di repositori kemungkinan besar sudah cukup tua. Pada saat publikasi artikel, versi terbaru adalah 2.3.14.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah bahasa itu sendiri diinstal, Anda juga harus “membuat” bahasa - mendaftarkannya di direktori sistem. </font><font style="vertical-align: inherit;">Ini harus dilakukan oleh tim.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTENSION</span> plperl;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Alih-alih plperl, Anda dapat mengganti nama bahasa lain, ada nuansa tertentu, lihat di bawah). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat apa yang terjadi:</font></font><br>
<br>
<pre><code class="plaintext hljs">test_langs=# \x<font></font>
test_langs=# \dL+<font></font>
List of languages<font></font>
-[ RECORD 1 ]-----+---------------------------------<font></font>
Name              | plperl<font></font>
Owner             | postgres<font></font>
Trusted           | t<font></font>
Internal language | f<font></font>
Call handler      | plperl_call_handler()<font></font>
Validator         | plperl_validator(oid)<font></font>
Inline handler    | plperl_inline_handler(internal)<font></font>
Access privileges |<font></font>
Description       | PL/Perl procedural language<font></font>
-[ RECORD 2 ]-----+---------------------------------<font></font>
Name              | plpgsql<font></font>
Owner             | postgres<font></font>
Trusted           | t<font></font>
Internal language | f<font></font>
Call handler      | plpgsql_call_handler()<font></font>
Validator         | plpgsql_validator(oid)<font></font>
Inline handler    | plpgsql_inline_handler(internal)<font></font>
Access privileges |<font></font>
Description       | PL/pgSQL procedural language<font></font>
[ RECORD 3 ]-----+---------------------------------<font></font>
Name              | plv8<font></font>
Owner             | postgres<font></font>
Trusted           | t<font></font>
Internal language | f<font></font>
Call handler      | plv8_call_handler()<font></font>
Validator         | plv8_call_validator(oid)<font></font>
Inline handler    | plv8_inline_handler(internal)<font></font>
Access privileges |<font></font>
Description       |</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / pgSQL tidak perlu dibuat secara khusus, selalu ada di database. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhatian! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / pgSQL tidak harus bingung dengan SQL. </font><font style="vertical-align: inherit;">Ini bahasa yang berbeda. </font><font style="vertical-align: inherit;">Namun, Postgres juga dapat menulis fungsi dalam SQL biasa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam dunia DBMS, mereka sering berbicara tentang kepatuhan dengan standar SQL. </font><font style="vertical-align: inherit;">Bahasa prosedural juga memiliki standar, meskipun tidak sering dibicarakan. </font><font style="vertical-align: inherit;">Standar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL / PSM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sangat sesuai dengan bahasa prosedural DB2. </font><font style="vertical-align: inherit;">Implementasinya jauh dari PL / pgSQL, meskipun secara konseptual keduanya dekat. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL / JRT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah standar untuk prosedur Java, dan PL / Java adalah pasangan yang baik.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bahasa Tepercaya dan Tidak Dipercaya</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa prosedural Postgres dipercaya (TRUSTED) dan tidak dipercaya (TIDAK DIPERCAYA). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam bahasa TRUSTED, tidak ada kemungkinan bekerja langsung dengan I / O, termasuk jaringan, dan memang dengan sumber daya sistem. Oleh karena itu, fungsi-fungsi tersebut dapat dibuat oleh pengguna basis data apa pun, merusak sesuatu dan ia tidak akan dapat belajar terlalu banyak. Fungsi dalam bahasa UNTRUSTED hanya dapat dibuat oleh penyelia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika penerjemah bahasa mendukung pembatasan tersebut, maka dapat digunakan untuk membuat bahasa TRUSTED dan UNTRUSTED. Jadi dengan Perl, jadi ada berbagai bahasa </font></font><code>plperl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>plperlu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Huruf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada akhirnya itu memberikan karakter bahasa yang tidak dipercaya. </font><font style="vertical-align: inherit;">Python hanya ada dalam versi yang tidak terpercaya. </font><font style="vertical-align: inherit;">PL / v8 - sebaliknya, hanya di tepercaya. </font><font style="vertical-align: inherit;">Akibatnya, PL / v8 tidak dapat memuat modul atau pustaka dari disk, hanya dari database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi dalam bahasa UNTRUSTED dapat melakukan apa saja: mengirim email, ping situs, masuk ke database asing, dan menjalankan permintaan HTTP. </font><font style="vertical-align: inherit;">Bahasa TRUSTED terbatas untuk memproses data dari database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan TRUSTED meliputi: </font></font><code>plpgsql, plperl, plv8, pljava</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan tidak dipercaya meliputi: </font></font><code>plperlu, pljavau, plpython2u, plpython3u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap dicatat: PL / Python tidak ada sebagai TRUSTED (karena Anda tidak dapat menetapkan batasan akses ke sumber daya di sana), dan PLpgSQL dan PL / V8 adalah sebaliknya: mereka tidak UNTRUSTED. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi Perl dan Java tersedia di kedua versi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / pgSQL vs PL / *</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode PL / pgSQL asli bekerja dengan semua tipe data yang Postgres miliki. Bahasa lain tidak memiliki banyak tipe Postgres, dan juru bahasa menangani konversi data menjadi representasi internal bahasa, menggantikan jenis yang tidak jelas dengan teks. Namun, dia dapat dibantu dengan bantuan TRANSFORM, yang akan saya bicarakan lebih dekat dengan akhir artikel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panggilan fungsi dalam PL / pgSQL seringkali lebih mahal. Fungsi dalam bahasa lain dapat mengakses perpustakaan mereka tanpa melihat katalog sistem. PL / pgSQL tidak bisa bekerja seperti itu. Beberapa pertanyaan dalam PL / pgSQL bekerja untuk waktu yang lama karena fakta bahwa banyak jenis yang didukung: untuk menambahkan dua bilangan bulat, penerjemah perlu menyadari bahwa ia berurusan dengan bilangan bulat dan bukan beberapa jenis eksotis lainnya, kemudian memutuskan cara melipatnya, dan hanya setelah itu benar-benar melipatnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena PL / pgSQL TRUSTED, Anda tidak dapat bekerja dengan jaringan dan disk darinya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika datang untuk bekerja dengan struktur data bersarang, PL / pgSQL hanya memiliki alat Postgres untuk bekerja dengan JSON, yang sangat rumit dan tidak produktif, dalam bahasa lain, bekerja dengan struktur bersarang jauh lebih sederhana dan lebih ekonomis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / * memiliki manajemen memori sendiri, dan Anda perlu memonitor memori, atau mungkin membatasinya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda harus memantau penanganan kesalahan dengan hati-hati, yang juga berbeda untuk semua orang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi dalam PL / * ada konteks juru bahasa global, dan itu dapat digunakan, misalnya, untuk menyimpan data, termasuk rencana kueri. </font><font style="vertical-align: inherit;">Jika bahasa ini TIDAK DIPERCAYA, maka jaringan dan drive tersedia. </font><font style="vertical-align: inherit;">Semua bahasa ini bekerja dengan database, sebagai aturan, melalui SPI, tetapi lebih lanjut tentang itu nanti. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat lebih dekat fitur-fitur bahasa PL / *.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interpreter Perl adalah sepotong besar kode dalam memori, tetapi untungnya itu tidak dibuat ketika koneksi dibuka, tetapi hanya ketika prosedur / fungsi pertama yang disimpan PL / Perl diluncurkan. </font><font style="vertical-align: inherit;">Ketika diinisialisasi, kode yang ditentukan dalam parameter konfigurasi Postgres dieksekusi. </font><font style="vertical-align: inherit;">Biasanya, modul dimuat dan perhitungan dilakukan. </font><font style="vertical-align: inherit;">
Jika Anda menambahkan ke file konfigurasi ketika database sedang berjalan, buat Postgres membaca kembali konfigurasi. </font><font style="vertical-align: inherit;">Pada artikel ini, contoh-contoh menggunakan modul </font><font style="vertical-align: inherit;">untuk memvisualisasikan struktur data. </font><font style="vertical-align: inherit;">
Ada beberapa parameter untuk inisialisasi terpisah dari TRUSTED dan UNTRUSTED Perl dan, tentu saja, sebuah parameter </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mereka yang memprogram di Perl tahu bahwa tanpanya </font><font style="vertical-align: inherit;">bukanlah bahasa, tetapi satu kesalahpahaman.</font></font><br>
<br>
<code>plperl.on_init= 'use Data::Dumper;'<br>
plperl.on_plperl_init= ' ... '<br>
plperl.on_plperlu_init= ' ... '<br>
plperl.use_strict= on</code><br>
<br><font style="vertical-align: inherit;"></font><code>Data::Dumper</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>use_strict=on</code><font style="vertical-align: inherit;"></font><code>strict</code><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di dalamnya, interpreter dibuat dengan cara yang sama saat pertama kali diakses. Dan di sini penting untuk segera memutuskan python mana yang Anda inginkan: kedua atau ketiga. Seperti yang Anda ketahui, Python ada dalam dua versi populer (Python 2 dan Python 3), tetapi masalahnya adalah bahwa s-shki mereka tidak rukun dalam satu proses: ada konflik dengan nama. Jika Anda bekerja dengan v2 dalam satu sesi dan kemudian memanggil v3, maka Postgres akan macet, dan untuk proses server (backend) ini akan menjadi kesalahan fatal. Untuk mengakses versi yang berbeda, Anda perlu membuka sesi lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak seperti Perl, python tidak dapat diberitahu apa yang harus dilakukan selama inisialisasi. Ketidaknyamanan lain: single-liner tidak nyaman untuk dilakukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam semua fungsi Python, dua kamus didefinisikan - statis </font></font><code>SD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan global </font></font><code>GD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Global </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memungkinkan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bertukar data dengan semua fungsi dalam satu backend - yang menarik dan berbahaya pada saat bersamaan. </font><font style="vertical-align: inherit;">Setiap fungsi memiliki kamus statis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam PL / Python, Anda dapat membuat subtransaksi, yang akan kita bahas di bawah ini.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu hanya DIPERCAYA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara mudah, data JSON secara otomatis dikonversi ke struktur JS. Di PL / V8, seperti pada PL / Python, Anda dapat melakukan subtransaksi. Ada antarmuka untuk panggilan fungsi yang disederhanakan. Ini adalah satu-satunya bahasa prosedural yang dipertanyakan di mana </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fungsi jendela dapat didefinisikan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mereka menyarankan bahwa mereka </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dapat didefinisikan pada PL / R</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi bahasa ini berada di luar cakupan artikel ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan hanya di PL / V8 apakah ada batas waktu eksekusi. Benar, ini tidak dihidupkan secara default, dan jika Anda membangun PL / V8 dengan tangan, Anda harus mengatakan bahwa itu dihidupkan selama perakitan, dan kemudian Anda dapat mengatur batas waktu untuk panggilan fungsi dengan parameter konfigurasi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inisialisasi dalam PL / V8 terlihat menarik: karena dipercaya, ia tidak dapat membaca perpustakaan dari disk, ia tidak dapat memuat apa pun dari mana saja. </font><font style="vertical-align: inherit;">Dia dapat mengambil semua yang dia butuhkan hanya dari pangkalan. </font><font style="vertical-align: inherit;">Oleh karena itu, fungsi penginisialisasi yang tersimpan didefinisikan yang dipanggil ketika juru bahasa mulai. </font><font style="vertical-align: inherit;">Nama fungsi ditentukan dalam parameter konfigurasi khusus:</font></font><br>
<br>
<pre><code class="pgsql hljs">plv8.start_proc=my_init # ( PL/V8-)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama inisialisasi, variabel dan fungsi global dapat dibuat dengan menetapkan nilainya ke atribut variabel ini. </font><font style="vertical-align: inherit;">Misalnya, seperti ini:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> my_init()
<span class="hljs-keyword">RETURNS</span> <span class="hljs-type">void</span> <span class="hljs-keyword">LANGUAGE</span> plv8 <span class="hljs-keyword">AS</span> $$<span class="php">
     this.get_57 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">57</span>; }; <span class="hljs-comment">//   </span>
     this.pi_square = <span class="hljs-number">9.8696044</span>;  <span class="hljs-comment">//   </span>
$$</span>;
<span class="hljs-keyword">SET</span> plv8.start_proc = <span class="hljs-string">'my_init'</span>;
<span class="hljs-keyword">DO</span> <span class="hljs-keyword">LANGUAGE</span> plv8 $$<span class="pgsql">
     plv8.elog(<span class="hljs-keyword">NOTICE</span>, pi_square, get_57() );
$$</span>;</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbandingan PL / Perl vs PL / Python vs PL / V8 dalam prakteknya</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo Dunia!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lakukan latihan sederhana dengan output frasa ini dalam ketiga bahasa, pertama dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dan biarkan dia melakukan hal lain yang bermanfaat, misalnya, memberi tahu versinya:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     elog(<span class="hljs-keyword">NOTICE</span>,"Hello World! $]");
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  Hello World!<font></font>
DO<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda juga dapat menggunakan fungsi Perl </font></font><code>warn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>die</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Lebih tepatnya pada PL / Python3u (tidak dipercaya) - untuk kepastian.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     <span class="hljs-keyword">import</span> sys
     plpy.<span class="hljs-keyword">notice</span>(<span class="hljs-string">'Hello World! '</span> , hint=" ", detail=sys.version_info)
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;</code></pre><br>
<pre><code class="plaintext hljs"><font></font>
NOTICE:  Hello World! <font></font>
DETAIL:  sys.version_info(major=3, minor=6, micro=9, releaselevel='final', serial=0)<font></font>
HINT:   <font></font>
DO<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bisa menggunakan </font></font><code>throw 'Errmsg'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ada banyak hal yang dapat Anda ekstrak dari pesan Postgres: mereka berisi Petunjuk, Detail, nomor baris, dan banyak parameter lainnya. </font><font style="vertical-align: inherit;">Dalam PL / Python, mereka dapat dilewatkan, tetapi tidak dalam bahasa lain yang sedang dipertimbangkan: cara mereka hanya dapat dikutuk dengan baris teks biasa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam PL / Python, setiap level logging postgres memiliki fungsinya sendiri: PEMBERITAHUAN, PERINGATAN, DEBUG, LOG, INFO, FATAL. </font><font style="vertical-align: inherit;">Jika KESALAHAN, maka transaksi telah jatuh, jika FATAL, seluruh backend telah jatuh. </font><font style="vertical-align: inherit;">Untungnya, masalahnya tidak mencapai PANIC. </font><font style="vertical-align: inherit;">Anda bisa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baca di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dalam bahasa ini, Hello world sangat mirip dengan mutiara. </font><font style="vertical-align: inherit;">Anda bisa berhenti </font></font><code>exception</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan </font></font><code>throw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan ini juga akan menjadi penanganan kesalahan, meskipun alat tidak semaju di Python. </font><font style="vertical-align: inherit;">Jika kamu menulis</font></font><code>plv8.elog(ERROR)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, efeknya akan sama.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     plv8.elog(<span class="hljs-keyword">NOTICE</span>, <span class="hljs-string">'Hello World!'</span>, plv8.<span class="hljs-keyword">version</span>);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plv8;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  Hello World! 2.3.14<font></font>
DO<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja dengan pangkalan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat bagaimana cara bekerja dengan database dari prosedur tersimpan. Postgres memiliki SPI (Server Programming Interface). Ini adalah serangkaian fungsi C yang tersedia untuk semua penulis ekstensi. Hampir semua bahasa PL menyediakan pembungkus untuk SPI, tetapi setiap bahasa melakukannya sedikit berbeda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi yang ditulis dalam C tetapi menggunakan SPI tidak mungkin memberikan keuntungan yang signifikan dibandingkan dengan PL / PgSQL dan bahasa prosedural lainnya. Tetapi fungsi C yang memintas SPI dan bekerja dengan data tanpa perantara (misalnya </font></font><code>table_beginscan/heap_getnext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) akan bekerja dengan urutan yang lebih cepat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / Java juga menggunakan SPI. Tetapi bekerja dengan database masih terjadi dalam gaya JDBC dan standar JDBC. Untuk pembuat kode dalam PL / Java, semuanya terjadi seolah-olah Anda bekerja dari aplikasi klien, tetapi JNI (Java Native Interface) menerjemahkan panggilan ke database ke dalam fungsi SPI yang sama. Sangat mudah, dan tidak ada kendala mendasar untuk menerjemahkan prinsip ini menjadi PL / Perl dan PL / Python, tetapi untuk beberapa alasan ini belum dilakukan, dan sejauh ini tidak terlihat dalam rencana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, jika mau, Anda dapat pergi ke pangkalan asing dengan cara biasa - melalui DBI atau </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psycopg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dimungkinkan untuk database lokal, tetapi mengapa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tidak masuk ke topik holistik "proses dalam basis vs proses pada klien", dan segera melanjutkan dari pemrosesan maksimum lebih dekat ke data (setidaknya agar tidak mendorong sampel raksasa melalui jaringan), maka solusi untuk menggunakan fungsi yang tersimpan di server terlihat tentu saja. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kinerja</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : perlu diingat bahwa SPI memiliki beberapa overhead, dan query SQL dalam fungsi mungkin lebih lambat daripada tanpa fungsi. Postgres ke-13 termasuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tambalan oleh Konstantin Knizhnik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengurangi biaya ini. Tetapi, tentu saja, pemrosesan hasil query dalam fungsi yang disimpan tidak memerlukan transfer hasil ke klien, dan karenanya dapat bermanfaat dalam hal kinerja. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keamanan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: satu set fungsi debugged dan diuji mengisolasi struktur database dari pengguna, melindungi terhadap suntikan SQL dan kerusakan lainnya. </font><font style="vertical-align: inherit;">Kalau tidak, itu akan tetap sakit kepala untuk setiap pengembang aplikasi. </font><font style="vertical-align: inherit;">Penggunaan kembali </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : jika sejumlah besar aplikasi rumit bekerja dengan database, akan lebih mudah untuk menyimpan fungsi yang berguna di server, daripada menulisnya lagi di setiap aplikasi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana dan dalam bentuk apa kita mendapatkan data dari database</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , semuanya sederhana dan jelas. </font><font style="vertical-align: inherit;">Panggilan </font></font><code>spi_exec_query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengembalikan jumlah baris yang diproses, status dan array baris yang dipilih oleh permintaan SQL:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="ruby"> 
     warn Data::Dumper::Dumper(
          spi_exec_query(<span class="hljs-string">'SELECT 57 AS x'</span>)
     )
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;</code></pre><br>
<pre><code class="plaintext hljs">WARNING:  $VAR1 = {<font></font>
          'rows' =&gt; [<font></font>
                    {<font></font>
                      'x' =&gt; '57'<font></font>
                    }<font></font>
                  ],<font></font>
          'processed' =&gt; 1,<font></font>
          'status' =&gt; 'SPI_OK_SELECT'<font></font>
        };<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kueri dan hasilnya terlihat seperti ini, tetapi di sini fungsinya tidak mengembalikan struktur data, tetapi objek khusus yang dapat Anda kerjakan dengan cara yang berbeda. </font><font style="vertical-align: inherit;">Biasanya itu berpura-pura menjadi sebuah array dan, karenanya, Anda dapat mengekstrak string dari itu.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql"> 
     plpy.<span class="hljs-keyword">notice</span>(
          plpy.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT 57 AS x'</span>)
     )
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  &lt;PLyResult status=5 nrows=1 rows=[{'x': 57}]&gt;<font></font>
DO</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang kita ambil baris 1, keluar dari sana X dan dapatkan nilai - jumlahnya.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql"> 
     plpy.<span class="hljs-keyword">notice</span>(
          plpy.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT 57 AS x'</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">'x'</span>]
      )
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  57<font></font>
DO</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql"> 
     plv8.elog(<span class="hljs-keyword">NOTICE</span>, <span class="hljs-type">JSON</span>.stringify(
          plv8.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT 57 as x'</span>))
     );
$$</span> <span class="hljs-keyword">LANGUAGE</span> plv8;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  [{"x":57}]<font></font>
DO</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melihat strukturnya, kami menggunakan fungsi pustaka JSON.stringify, yang tidak perlu dimuat secara khusus, sudah siap untuk digunakan sebagai bagian dari PL / v8 secara default. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perisai</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menghindari suntikan jahat SQL, beberapa karakter dalam kueri harus melarikan diri. Untuk melakukan ini, pertama, ada fungsi SPI dan fungsi terkait (ditulis dalam C) dalam bahasa yang bekerja seperti pembungkus SPI. Sebagai contoh, dalam PL / Perl: </font></font><br>
<br>
<code>quote_literal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- mengambil tanda kutip dan ganda 'dan \. Dirancang untuk menyaring data teks. </font></font><br>
<code>quote_nullable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- sama, tetapi </font></font><code>undef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dikonversi ke NULL. </font></font><br>
<code>quote_ident</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- mengutip nama tabel atau bidang, jika perlu. Berguna dalam kasus ketika Anda membangun kueri SQL dan mengganti nama-nama objek database di dalamnya. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="perl">
     <span class="hljs-keyword">warn</span> <span class="hljs-string">"macy's"</span>;
     <span class="hljs-keyword">warn</span> quote_literal(<span class="hljs-string">"macy's"</span>);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;</code></pre><br>
<pre><code class="plaintext hljs">WARNING:  macy's at line 2.<font></font>
WARNING:  'macy''s' at line 3.<font></font>
DO</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu diingat: nama tabel tidak boleh diloloskan seperti garis teks. </font><font style="vertical-align: inherit;">Itu sebabnya ada fungsi </font></font><code>quote_ident</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi dalam PL / Perl ada fungsi-fungsi lain untuk melindungi data tipe post-gres individu: </font><font style="vertical-align: inherit;">
Suatu fungsi </font><font style="vertical-align: inherit;">harus menerima tipe apa pun dan mengubah karakter ragu atipikal menjadi sesuatu yang jelas aman. </font><font style="vertical-align: inherit;">Ini bekerja dengan sejumlah besar jenis, tetapi, bagaimanapun, tidak dengan semua. </font><font style="vertical-align: inherit;">Dia, misalnya, tidak akan memahami </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">tipe rentang</font></a><font style="vertical-align: inherit;"> dan menganggapnya hanya sebagai string teks.</font></font><br>
<br>
<code>encode_bytea<br>
decode_bytea<br>
encode_array_literal<br>
encode_typed_literal<br>
encode_array_constructor</code><br>
<br><font style="vertical-align: inherit;"></font><code>quote_typed_literal</code><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="perl">
     <span class="hljs-keyword">warn</span> encode_typed_literal(
          [<span class="hljs-string">""</span>, <span class="hljs-string">" "</span>], <span class="hljs-string">"text[]"</span>
     );
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;</code></pre><br>
<pre><code class="plaintext hljs">WARNING:  {," "} at line 2.<font></font>
DO</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada </font><font style="vertical-align: inherit;">tiga fungsi serupa </font><font style="vertical-align: inherit;">di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan mereka bekerja dengan cara yang sama:</font></font><br>
<br>
<code>plpy.quote_literal<br>
plpy.quote_nullable<br>
plpy.quote_ident</code><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql"> plpy.<span class="hljs-keyword">notice</span>(
     plpy.quote_literal("Macy's"));
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;</code></pre><pre><code class="plaintext hljs">NOTICE:  'Macy''s'<font></font>
DO</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apakah fungsi dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sama </font><font style="vertical-align: inherit;">? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja! </font><font style="vertical-align: inherit;">Semuanya sama hingga fitur sintaksis.</font></font><br>
<br>
<code>plv8.quote_literal<br>
plv8.quote_nullable<br>
plv8.quote_ident</code><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
    plv8.elog(<span class="hljs-keyword">NOTICE</span>, plv8.quote_nullable("Macy's"));
$$</span> <span class="hljs-keyword">LANGUAGE</span> plv8;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:  'Macy''s'</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa mana yang paling cepat? Biasanya mereka menjawab: C. Tetapi jawaban yang benar adalah C </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SQL. Mengapa SQL Faktanya adalah bahwa fungsi dalam bahasa ini tidak selalu dilakukan secara eksplisit. Itu bisa menjadi tertanam dalam permintaan (scheduler akan menanamkan fungsi di tubuh permintaan utama), mengoptimalkan dengan baik dengan permintaan, dan hasilnya akan lebih cepat. Tetapi dalam kondisi apa kode dapat disematkan dalam permintaan? Ada beberapa kondisi sederhana yang dapat Anda baca, katakanlah, di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Misalnya, suatu fungsi tidak boleh dieksekusi dengan hak pemilik (untuk menjadi DEFINER KEAMANAN). Sebagian besar fungsi sederhana akan sesuai dengan kondisi ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini kita akan mengukur "pada lutut", tidak serius. Kami membutuhkan perbandingan kasar. Pertama, nyalakan waktu:</font></font><br>
<br>
<pre><code class="plaintext hljs">\timing</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Waktu pelaksanaan perintah di bawah ini adalah nilai rata-rata bulat yang diterima penulis pada PC berusia enam tahun yang dibongkar. Mereka dapat dibandingkan satu sama lain, tetapi mereka tidak mengklaim sebagai ilmiah):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> count(*) <span class="hljs-keyword">FROM</span> pg_class;
<span class="hljs-number">0.5</span> ms
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini bekerja sangat cepat. </font><font style="vertical-align: inherit;">Dalam bahasa lain, fungsi panggilan dari bahasa tersebut terbuang. </font><font style="vertical-align: inherit;">Tentu saja, pertama kali permintaan akan berjalan lebih lambat karena inisialisasi penerjemah. </font><font style="vertical-align: inherit;">Kemudian stabil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / pgSQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     <span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">int</span>;
     <span class="hljs-keyword">BEGIN</span>
          <span class="hljs-keyword">SELECT</span> count(*) <span class="hljs-keyword">INTO</span> a <span class="hljs-keyword">FROM</span> pg_class;
     <span class="hljs-keyword">END</span>;
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpgsql;
<span class="hljs-number">0.7</span> ms</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="perl">
     <span class="hljs-keyword">my</span> $x = spi_exec_query(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;
<span class="hljs-number">0.7</span> ms</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python:</font></font></b><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     x = plpy.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpythonu;
<span class="hljs-number">0.8</span> ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu Python 2. Sekarang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ingat: Python2 dan Python3 tidak hidup damai dalam sesi yang sama, konflik nama mungkin terjadi):</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     x = plpy.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;
<span class="hljs-number">0.9</span>ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan akhirnya, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     var x = plv8.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plv8 ;
<span class="hljs-number">0.9</span> ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi entah kenapa sangat cepat. </font><font style="vertical-align: inherit;">Mari kita coba jalankan query 1000 kali atau 1 juta kali, tiba-tiba perbedaannya akan lebih terlihat: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / pgSQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     <span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">int</span>; i <span class="hljs-type">int</span>;
     <span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">FOR</span> i <span class="hljs-keyword">IN</span> <span class="hljs-number">0.</span><span class="hljs-number">.999999</span> <span class="hljs-keyword">LOOP</span>
          <span class="hljs-keyword">SELECT</span> count(*) <span class="hljs-keyword">INTO</span> a <span class="hljs-keyword">FROM</span> pg_class;
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">LOOP</span>;
<span class="hljs-keyword">END</span>;
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpgsql;
<span class="hljs-number">53</span>s</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="ruby">
     <span class="hljs-keyword">for</span> (<span class="hljs-number">0</span>..<span class="hljs-number">999999</span>) {
          spi_exec_query(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
     }
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;
<span class="hljs-number">102</span>s</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range (<span class="hljs-number">0</span>,<span class="hljs-number">1000000</span>) :
          plpy.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>)
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;
<span class="hljs-number">98</span>s</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     <span class="hljs-keyword">for</span>(var i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">1000</span>;i++)
          plv8.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plv8;
<span class="hljs-number">100</span>ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan bahwa dengan PL / V8, percobaan dilakukan dengan seribu, bukan satu juta iterasi. Dengan sumber daya moderat, PL / V8 dalam siklus 1 juta operasi akan memakan semua memori dan sepenuhnya menggantung mobil. Sudah di seribu iterasi, proses postgres memilih memori 3,5GB dan 100% menulis ke disk. Bahkan, postgres meluncurkan lingkungan V8, dan tentu saja itu memakan memori. Setelah mengeksekusi permintaan, monster turbo ini tidak akan mengembalikan memori. Untuk mengosongkan memori, Anda harus mengakhiri sesi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita melihat bahwa PL / pgSQL sudah 2 kali lebih cepat dari PL / Perl dan PL / Python. PL / V8 masih sedikit di belakang mereka, tetapi menjelang akhir artikel dia sebagian direhabilitasi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, Perl dengan Python dalam percobaan ini menunjukkan hasil yang kira-kira sama. </font><font style="vertical-align: inherit;">Perl dulu sedikit lebih rendah daripada Python, dalam versi modern, ini sedikit lebih cepat. </font><font style="vertical-align: inherit;">Python ketiga sedikit lebih lambat dari yang kedua. </font><font style="vertical-align: inherit;">Seluruh perbedaannya adalah dalam 15%.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performa dengan SIAPKAN</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Orang yang tahu akan mengerti: ada sesuatu yang salah. </font><font style="vertical-align: inherit;">PL / pgSQL dapat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secara otomatis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> me- </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">cache rencana kueri</font></a><font style="vertical-align: inherit;"> , dan dalam PL / *, setiap kali kueri dijadwalkan kembali. </font><font style="vertical-align: inherit;">Dengan cara yang baik, Anda perlu menyiapkan permintaan, membangun rencana permintaan, dan kemudian menurut rencana ini, permintaan tersebut harus dieksekusi sebanyak yang diperlukan. </font><font style="vertical-align: inherit;">Di PL / *, Anda dapat bekerja secara eksplisit dengan paket kueri, yang akan kami coba mulai dengan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="perl">
     <span class="hljs-keyword">my</span> $h = spi_prepare(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
     <span class="hljs-keyword">for</span> (<span class="hljs-number">0</span>..<span class="hljs-number">999999</span>) {
          spi_exec_prepared($h);
     }
     spi_freeplan($h);
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;
<span class="hljs-number">60</span>s</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     h = plpy.<span class="hljs-keyword">prepare</span>(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>)
     <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range (<span class="hljs-number">0</span>,<span class="hljs-number">1000000</span>): plpy.<span class="hljs-keyword">execute</span>(h)
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;
<span class="hljs-number">62</span>s</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     var h=plv8.<span class="hljs-keyword">prepare</span>(<span class="hljs-string">'SELECT count(*) FROM pg_class'</span>);
     <span class="hljs-keyword">for</span>(var i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">1000</span>;i++) h.<span class="hljs-keyword">execute</span>();
$$</span> <span class="hljs-keyword">LANGUAGE</span> plv8;
<span class="hljs-number">53</span>ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan </font></font><code>prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dua bahasa kami, kami hampir terjebak dengan PL / pgSQL, sementara yang ketiga juga ingin, tetapi tidak mencapai garis akhir karena meningkatnya permintaan untuk memori. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi jika Anda tidak memperhitungkan memori akun, maka jelas bahwa semua bahasa hampir saling berhadapan - dan tidak secara kebetulan. </font><font style="vertical-align: inherit;">Kemacetan mereka sekarang umum - bekerja dengan database melalui SPI.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kinerja komputasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat bahwa kinerja bahasa telah beristirahat dalam bekerja dengan database. </font><font style="vertical-align: inherit;">Untuk membandingkan bahasa satu sama lain, mari kita coba menghitung sesuatu tanpa menggunakan database, misalnya, jumlah kuadrat. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / pgSQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
     <span class="hljs-keyword">DECLARE</span> i <span class="hljs-type">bigint</span>; a <span class="hljs-type">bigint</span>;
     <span class="hljs-keyword">BEGIN</span> a=<span class="hljs-number">0</span>;
     <span class="hljs-keyword">FOR</span> i <span class="hljs-keyword">IN</span> <span class="hljs-number">0.</span><span class="hljs-number">.1000000</span> <span class="hljs-keyword">LOOP</span>
          a=a+i*i::<span class="hljs-type">bigint</span>;
     <span class="hljs-keyword">END</span> <span class="hljs-keyword">LOOP</span>;
<span class="hljs-keyword">END</span>;
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpgsql;
<span class="hljs-number">280</span>ms</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="perl">
     <span class="hljs-keyword">my</span> $a=<span class="hljs-number">0</span>;
     <span class="hljs-keyword">for</span> <span class="hljs-keyword">my</span> $i (<span class="hljs-number">0</span>..<span class="hljs-number">1000000</span>) { $a+=$i*$i; };
     <span class="hljs-keyword">warn</span> $a;
$$</span> <span class="hljs-keyword">LANGUAGE</span> plperl;
<span class="hljs-number">63</span>ms</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> $$<span class="pgsql">
a=<span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">1000001</span>): a=a+i*i
$$</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u;
<span class="hljs-number">73</span>ms</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">DO $$<font></font>
     var a=0;<font></font>
     for(var i=0;i&lt;=1000000;i++) a+=i*i;<font></font>
     plv8.elog(NOTICE, a);<font></font>
$$ language plv8;<font></font>
7.5ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita melihat bahwa PL / Perl dan PL / Python menyusul dan menyusul PL / pgSQL, mereka 4 kali lebih cepat. </font><font style="vertical-align: inherit;">Dan delapan merobek semua orang! </font><font style="vertical-align: inherit;">Tetapi apakah ini benar-benar gratis? </font><font style="vertical-align: inherit;">Atau akankah kita mendapatkannya untuk kepala? </font><font style="vertical-align: inherit;">Ya kita akan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angka dalam JavaScript adalah float, dan hasilnya cepat, tetapi tidak akurat: 333333833333127550, bukan 333333833333500000. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah rumus yang digunakan untuk </font><font style="vertical-align: inherit;">menghitung </font><font style="vertical-align: inherit;">hasil pasti:</font></font><br>
<br>
<pre><code class="plaintext hljs">∑ = n*(n+1)*(2n+1)/6
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai latihan, Anda bisa membuktikannya menggunakan induksi matematika. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam urutan tawa</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> <span class="hljs-keyword">LANGUAGE</span> plv8 $$<span class="pgsql">
plv8.elog(<span class="hljs-keyword">NOTICE</span>, parseInt(<span class="hljs-number">33333383333312755033</span>)) $$</span>;</code></pre><br>
<pre><code class="plaintext hljs">NOTICE:<font></font>
33333383333312754000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam Javascript, </font></font><code>parseInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itu masih float, bukan Int. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun demikian, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BigInt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muncul di V8 pada tahun 2018 </font><font style="vertical-align: inherit;">, dan sekarang dapat dihitung dengan pasti, tetapi dengan merugikan kecepatan, karena itu bukan bilangan bulat 64-bit, tetapi bilangan bulat dari kedalaman bit sewenang-wenang. </font><font style="vertical-align: inherit;">Namun, dalam PL / V8 inovasi ini belum mencapai. </font><font style="vertical-align: inherit;">Dalam bahasa prosedural lain, angka bit sewenang-wenang (analog SQL </font></font><code>numeric</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) didukung melalui perpustakaan khusus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Perl, ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modul Math :: BigFloat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk aritmatika dengan ketepatan arbitrer, dan dalam Python paket </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bigfloat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah pembungkus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cython di</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sekitar pustaka </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU MPFR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi kinerja untuk menyortir</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah contoh praktis, yang menunjukkan perbedaan dalam kinerja penyortiran berdasarkan fungsi, jika fungsi ini ditulis dalam bahasa yang berbeda. </font><font style="vertical-align: inherit;">Tugas: untuk mengurutkan bidang teks yang berisi jumlah masalah jurnal, yang mungkin sebagai berikut:</font></font><br>
<br>
<pre><code class="plaintext hljs">1<font></font>
2<font></font>
3<font></font>
4-5<font></font>
6<font></font>
6A<font></font>
6<font></font>
11<font></font>
12<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu </font><font style="vertical-align: inherit;">itu sebenarnya sebuah string, tetapi dimulai dengan angka, dan Anda perlu mengurutkan berdasarkan angka-angka ini. </font><font style="vertical-align: inherit;">Oleh karena itu, untuk mengurutkan dengan benar sebagai string, kami menambah bagian numerik dengan nol di sebelah kiri untuk mendapatkan:</font></font><br>
<br>
<pre><code class="plaintext hljs">0000000001<font></font>
0000000002<font></font>
0000000003<font></font>
0000000004-5<font></font>
0000000006<font></font>
0000000006A<font></font>
0000000006<font></font>
0000000011<font></font>
0000000012<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, saya tahu bahwa ini bukan satu-satunya solusi untuk masalah (dan bahkan tidak benar). </font><font style="vertical-align: inherit;">Tapi misalnya, itu akan dilakukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk meminta suatu tipe, </font></font><code>SELECT ... ORDER BY nsort(n)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kami menulis fungsi dalam PL / Perl, SQL, PL / Python, dan PL / V8 yang mengonversi nomor jurnal menjadi bentuk ini:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> nsort(<span class="hljs-type">text</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">text</span> 
   <span class="hljs-keyword">LANGUAGE</span> PLPERL <span class="hljs-keyword">IMMUTABLE</span> <span class="hljs-keyword">AS</span> $$<span class="perl">
    <span class="hljs-keyword">my</span> $x = <span class="hljs-keyword">shift</span>;
    <span class="hljs-keyword">return</span> ($x =~ <span class="hljs-regexp">/^\s*(\d+)(.*)$/</span>)
        ? <span class="hljs-keyword">sprintf</span>(<span class="hljs-string">"%010d"</span>, $1).$2
        : $x;
$$</span>;</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> _nsort(x <span class="hljs-type">text</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">text</span>
     <span class="hljs-keyword">LANGUAGE</span> <span class="hljs-keyword">SQL</span>  <span class="hljs-keyword">IMMUTABLE</span>  <span class="hljs-keyword">AS</span> $$<span class="pgsql">
 <span class="hljs-keyword">WITH</span> y <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> regexp_match(x,<span class="hljs-string">'^\s*(\d*)(.*)$'</span>) <span class="hljs-keyword">as</span> z
 )
 <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> z[<span class="hljs-number">1</span>] = <span class="hljs-string">''</span> <span class="hljs-keyword">THEN</span> x <span class="hljs-keyword">ELSE</span> lpad(z[<span class="hljs-number">1</span>],<span class="hljs-number">10</span>,<span class="hljs-string">'0'</span>) || z[<span class="hljs-number">2</span>] <span class="hljs-keyword">END</span> <span class="hljs-keyword">FROM</span> y;
$$</span>;</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> py_nsort(x <span class="hljs-type">text</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">text</span> 
   <span class="hljs-keyword">LANGUAGE</span> plpython2u <span class="hljs-keyword">IMMUTABLE</span> <span class="hljs-keyword">AS</span> $$<span class="pgsql">
<span class="hljs-keyword">import</span> re
r = re.match(<span class="hljs-string">'^\s*(\d+)(.*)$'</span>, x)
<span class="hljs-keyword">return</span> x <span class="hljs-keyword">if</span> r == <span class="hljs-keyword">None</span> <span class="hljs-keyword">else</span> (<span class="hljs-string">'%010d'</span> % <span class="hljs-type">int</span>(r.<span class="hljs-keyword">group</span>(<span class="hljs-number">1</span>))) + r.<span class="hljs-keyword">group</span>(<span class="hljs-number">2</span>)
$$</span>;</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> js_nsort(x <span class="hljs-type">text</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">text</span> 
   <span class="hljs-keyword">LANGUAGE</span> plv8 <span class="hljs-keyword">IMMUTABLE</span> <span class="hljs-keyword">AS</span> $$<span class="ruby">
var m = x.match(<span class="hljs-regexp">/^\s*(\d+)(.*)$/</span>);
<span class="hljs-keyword">if</span>(m) { <span class="hljs-keyword">return</span> m[<span class="hljs-number">1</span>].padStart(<span class="hljs-number">10</span>-m[<span class="hljs-number">1</span>].length,<span class="hljs-string">'0'</span>) + m[<span class="hljs-number">2</span>]; }
<span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> x; } 
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di perpustakaan saya yang berisi 15,5 ribu artikel jurnal, kueri yang menggunakan fungsi dalam PL / Perl membutuhkan sekitar 64 ms terhadap 120 ms dalam PL / Python dan 200 ms dalam PL / PgSQL. </font><font style="vertical-align: inherit;">Tetapi yang tercepat - PL / v8: 54ms. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saat bereksperimen dengan penyortiran, berikan jumlah memori kerja yang diperlukan sehingga penyortiran masuk dalam memori (EXPLAIN kemudian akan ditampilkan </font></font><code>Sort Method: quicksort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Jumlah memori diatur oleh parameter </font></font><code>work_mem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">set</span> work_mem = <span class="hljs-string">'20MB'</span>;
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyimpanan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perl tidak suka struktur yang dililitkan, ia tidak tahu cara membersihkannya. </font><font style="vertical-align: inherit;">Jika Anda </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memiliki pointer ke </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pointer ke </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, maka penghitung referensi tidak akan pernah diatur ulang dan memori tidak akan dibebaskan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa pengumpulan sampah memiliki masalah lain. </font><font style="vertical-align: inherit;">Tidak diketahui, misalnya, kapan memori akan dibebaskan atau apakah akan dibebaskan sama sekali. </font><font style="vertical-align: inherit;">Atau - jika Anda tidak sengaja menangani hal ini - pengumpul akan mengumpulkan sampah pada saat yang paling tidak tepat. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi ada juga fitur manajemen memori yang berhubungan langsung dengan Postgres. </font><font style="vertical-align: inherit;">Ada struktur yang mengalokasikan SPI, dan Perl tidak selalu menyadari bahwa mereka perlu dibebaskan. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ini BUKANNYA:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">function</span> cr()
<span class="hljs-keyword">RETURNS</span> <span class="hljs-type">int</span> <span class="hljs-keyword">LANGUAGE</span> plperl <span class="hljs-keyword">AS</span>
$$<span class="perl">
     <span class="hljs-keyword">return</span> spi_exec_query(
           <span class="hljs-string">'SELECT count(*) FROM pg_class'</span>
     )-&gt;{rows}-&gt;[<span class="hljs-number">0</span>]-&gt;{count};
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begitulah yang terjadi:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">function</span> cr()
<span class="hljs-keyword">RETURNS</span> <span class="hljs-type">int</span> <span class="hljs-keyword">LANGUAGE</span> plperl <span class="hljs-keyword">AS</span>
$$<span class="perl">
     <span class="hljs-keyword">my</span> $h = spi_prepare(
          <span class="hljs-string">'SELECT count(*) FROM pg_class'</span>
     );
     <span class="hljs-keyword">return</span> spi_exec_prepared($h)-&gt;{rows}-&gt;[<span class="hljs-number">0</span>]-&gt;{count};
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah eksekusi, pawang </font></font><code>$h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan tetap hidup, terlepas dari kenyataan bahwa tidak ada satu pun link hidup dengannya yang tersisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak apa-apa, Anda hanya perlu mengingat kebutuhan untuk secara eksplisit melepaskan sumber daya dengan </font></font><code>spi_freeplan($h)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">function</span> cr()
<span class="hljs-keyword">RETURNS</span> <span class="hljs-type">int</span> <span class="hljs-keyword">LANGUAGE</span> plperl <span class="hljs-keyword">AS</span>
$$<span class="perl">
     <span class="hljs-keyword">my</span> $h = spi_prepare(
          <span class="hljs-string">'select count(*) from pg_class'</span>
     );
     <span class="hljs-keyword">my</span> $res = spi_exec_prepared($h)-&gt;{rows}-&gt;[<span class="hljs-number">0</span>]-&gt;{count};
     spi_freeplan($h);
     <span class="hljs-keyword">return</span> $res;
$$</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python:</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Python </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak pernah mengalir</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , paket ini secara otomatis dirilis:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">function</span> cr3() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">int</span>
<span class="hljs-keyword">LANGUAGE</span> plpythonu <span class="hljs-keyword">as</span>
$$<span class="pgsql">
     <span class="hljs-keyword">return</span> plpy.<span class="hljs-keyword">execute</span>(
           <span class="hljs-string">'select count(*) from pg_class'</span>
     )[<span class="hljs-number">0</span>][<span class="hljs-string">'count'</span>]
$$</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Kisah yang sama dengan Perl. </font><font style="vertical-align: inherit;">Tidak mengalir seperti ini:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> crq() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">int</span>
<span class="hljs-keyword">LANGUAGE</span> plv8 <span class="hljs-keyword">AS</span>
$$<span class="pgsql">
     <span class="hljs-keyword">return</span> plv8.<span class="hljs-keyword">execute</span>(
          <span class="hljs-string">'select count(*) from pg_class‘
     )[0].count;
$$</span></span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begitulah yang terjadi:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> crq() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">int</span>
<span class="hljs-keyword">LANGUAGE</span> plv8 <span class="hljs-keyword">AS</span>
$$<span class="pgsql">
     var h = plv8.<span class="hljs-keyword">prepare</span>(
          <span class="hljs-string">'select count(*) from pg_class'</span>
     );
     <span class="hljs-keyword">return</span> h.<span class="hljs-keyword">execute</span>()[<span class="hljs-number">0</span>].count;
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekali lagi: jangan lupa tentang membebaskan sumber daya. </font><font style="vertical-align: inherit;">Ini dia. </font></font><code>h.free();</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu tidak mengalir:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> crq() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">int</span>
<span class="hljs-keyword">LANGUAGE</span> plv8 <span class="hljs-keyword">AS</span>
$$<span class="pgsql">
     var h = plv8.<span class="hljs-keyword">prepare</span>(
          <span class="hljs-string">'select count(*) from pg_class'</span>
     );
     var r = h.<span class="hljs-keyword">execute</span>()[<span class="hljs-number">0</span>].count;
     h.free();
     <span class="hljs-keyword">return</span> r;
$$</span>;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saatnya untuk memahami bagaimana argumen dilewatkan ke fungsi. </font><font style="vertical-align: inherit;">Dalam contoh, kita akan melewatkan 4 parameter dengan tipe ke fungsi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seluruh;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebuah array;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytea dan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jsonb</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana </font><font style="vertical-align: inherit;">
mereka masuk ke </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> crq(a <span class="hljs-type">int</span>, b
<span class="hljs-type">bytea</span>, c <span class="hljs-type">int</span>[], d <span class="hljs-type">jsonb</span> ) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">void</span>
<span class="hljs-keyword">LANGUAGE</span> plperl <span class="hljs-keyword">AS</span>
$$<span class="perl">
    <span class="hljs-keyword">warn</span> Dumper(@_);
$$</span>;</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> crq(<span class="hljs-number">1</span>,<span class="hljs-string">'abcd'</span>, <span class="hljs-keyword">ARRAY</span>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],<span class="hljs-string">'{"a":2,"b":3}'</span>);</code></pre><br>
<pre><code class="plaintext hljs"><font></font>
WARNING:  $VAR1 = '1';<font></font>
$VAR2 = '\\x61626364';<font></font>
$VAR3 = bless( {<font></font>
                 'array' =&gt; [<font></font>
                              '1',<font></font>
                              '2',<font></font>
                              '3'<font></font>
                            ],<font></font>
                 'typeoid' =&gt; 1007<font></font>
               }, 'PostgreSQL::InServer::ARRAY' );<font></font>
$VAR4 = '{"a": 2, "b": 3}';<font></font>
 crq <font></font>
-----<font></font>
(1 row)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apakah itu JSON atau JSONB - dalam hal ini, tidak ada bedanya: mereka masih berupa string. Ini adalah biaya untuk keserbagunaan: Postgres memiliki banyak jenis, dengan berbagai tingkat "bawaan". Untuk menuntut dari pengembang bahwa dengan tipe baru ia segera menyediakan dan fungsi konversi untuk semua PL / * akan terlalu banyak. Secara default, banyak tipe dilewatkan sebagai string. Tapi ini tidak selalu nyaman, Anda harus menguraikan persyaratan ini. Tentu saja, saya ingin data Postgres segera berubah menjadi struktur Perl yang sesuai. Secara default, ini tidak terjadi, tetapi mulai dari 9.6, mekanisme TRANSFORM muncul - kemampuan untuk mendefinisikan fungsi konversi tipe: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TRANSFORM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membuat TRANSFORM, Anda perlu menulis dua fungsi dalam C: satu akan mengonversi data dari jenis tertentu ke satu sisi, yang lain kembali. </font><font style="vertical-align: inherit;">Harap dicatat, TRANSFORM bekerja di empat tempat:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat melewatkan parameter ke suatu fungsi;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat mengembalikan nilai fungsi;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat mengirimkan parameter ke panggilan SPI di dalam suatu fungsi;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah menerima hasil panggilan SPI di dalam fungsi.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TRANSFORMASI JSONB untuk Perl dan Python, yang dikembangkan oleh Anton Bykov, muncul dalam versi 11 Postgres. </font><font style="vertical-align: inherit;">Sekarang Anda tidak perlu mengurai JSONB, ia masuk ke Perl segera sebagai struktur yang sesuai. </font><font style="vertical-align: inherit;">Anda harus membuat ekstensi jsonb_plperl, dan kemudian Anda dapat menggunakan TRANSFORM:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTENSION</span> jsonb_plperl;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> crq2(d <span class="hljs-type">jsonb</span>)
<span class="hljs-keyword">RETURNS</span> <span class="hljs-type">void</span> <span class="hljs-keyword">LANGUAGE</span> plperl
<span class="hljs-keyword">TRANSFORM</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-type">jsonb</span> <span class="hljs-keyword">AS</span> $$<span class="perl">
     <span class="hljs-keyword">warn</span> Dumper(@_);
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat memanggil fungsi ini untuk memverifikasi bahwa JSONB telah berubah menjadi hash mutiara:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> crq2( <span class="hljs-string">'{"a":2,"b":3}'</span>);</code></pre><br>
<pre><code class="plaintext hljs"><font></font>
WARNING:  $VAR1 = {<font></font>
          'a' =&gt; '2',<font></font>
          'b' =&gt; '3'<font></font>
        };<font></font>
 crq2 <font></font>
------<font></font>
(1 row)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah yang sama sekali berbeda! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penulis artikel ini juga memiliki andil dalam mengembangkan TRANSFORMs. Ternyata tipe data sederhana seperti itu, seperti </font></font><code>boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diteruskan ke PL / Perl dalam bentuk yang tidak nyaman, seperti string teks </font></font><code>'t'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font></font><code>'f'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Namun dalam pemahaman Perl, string 'f' benar. Untuk menghilangkan ketidaknyamanan, sebuah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diciptakan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">yang mendefinisikan konversi untuk tipe Boolean</font></a><font style="vertical-align: inherit;"> . Patch ini mengenai PostgreSQL 13 dan akan segera tersedia. Karena kesederhanaannya, bool_plperl dapat berfungsi sebagai model awal minimal untuk menulis konversi lainnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harap seseorang akan mengembangkan TRANSFORM untuk tipe data lain (bytea, array, tanggal, numerik). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat bagaimana parameter dilewatkan dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">EXTENSION</span> jsonb_plpython3u;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> pdump(a <span class="hljs-type">int</span>, b <span class="hljs-type">bytea</span>, c <span class="hljs-type">int</span>[], d <span class="hljs-type">jsonb</span> ) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">void</span>
<span class="hljs-keyword">LANGUAGE</span> plpython3u
<span class="hljs-keyword">TRANSFORM</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-type">jsonb</span> <span class="hljs-keyword">AS</span> $$<span class="pgsql">
      plpy.<span class="hljs-built_in">warning</span>(a,b,c,d)
$$</span>;</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> pdump(<span class="hljs-number">1</span>,<span class="hljs-string">'abcd'</span>, <span class="hljs-keyword">ARRAY</span>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],<span class="hljs-string">'{"a":2,"b":3}'</span>);</code></pre><br>
<pre><code class="plaintext hljs"><font></font>
WARNING:  (1, b'abcd', [1, 2, 3], {'a': Decimal('2'), 'b': Decimal('3')})<font></font>
 pdump <font></font>
-------<font></font>
(1 row)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Array dikonversi ke array - ini bagus (dimulai dengan versi PG10, array multidimensi juga ditransfer dengan benar ke python). </font><font style="vertical-align: inherit;">Di Perl, sebuah array dikonversi ke objek kelas khusus. </font><font style="vertical-align: inherit;">Yah, sudah </font></font><code>jsonb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berubah. </font><font style="vertical-align: inherit;">Tanpa TRANSFORM, jsonb akan diteruskan sebagai string. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat dalam bentuk apa parameter masuk ke </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR REPLACE</span> <span class="hljs-keyword">FUNCTION</span> jsdump(a <span class="hljs-type">int</span>, b <span class="hljs-type">bytea</span>, c <span class="hljs-type">int</span>[], d <span class="hljs-type">jsonb</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">void</span>
<span class="hljs-keyword">LANGUAGE</span> plv8 <span class="hljs-keyword">AS</span> $$<span class="pgsql">
     plv8.elog(<span class="hljs-built_in">WARNING</span>,a,b,c,d)
$$</span>;</code></pre><br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">SELECT</span> jsdump(<span class="hljs-number">1</span>,<span class="hljs-string">'abcd'</span>, <span class="hljs-keyword">ARRAY</span>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],<span class="hljs-string">'{"a":2,"b":3}'</span>);</code></pre><br>
<pre><code class="plaintext hljs"><font></font>
WARNING:  1 97,98,99,100 1,2,3 [object Object]<font></font>
jsdump <font></font>
-------<font></font>
(1 row)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JSONB dikonversi ke objek JavaScript tanpa TRANSFORM! </font><font style="vertical-align: inherit;">Jenis Postgres Sementara juga dikonversi ke tipe JS Tanggal. </font><font style="vertical-align: inherit;">Sama halnya dengan boolean. </font><font style="vertical-align: inherit;">Semua transformasi sudah dibangun ke dalam PL / V8.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja dengan tak terhingga</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konstanta INFINITY tidak sering digunakan, tetapi pekerjaan ceroboh dengannya berbahaya. </font><font style="vertical-align: inherit;">Dalam PostgreSQL, Infinity dan -Infinity ada sebagai nilai khusus untuk beberapa tipe sementara dan floating-point. </font><font style="vertical-align: inherit;">Tetapi transfer Infinity ke bahasa prosedural dan sebaliknya harus dibahas secara rinci, karena bekerja dengan mereka tidak hanya bergantung pada bahasa, tetapi juga pada perpustakaan, pada OS dan bahkan pada perangkat keras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python memiliki modul Numpy yang mendefinisikan angka tak terhingga:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> nm<font></font>
a = nm.inf<font></font>
b = -nm.inf<font></font>
print(a, b)</code></pre><br>
<pre><code class="plaintext hljs">inf -inf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perl juga memiliki infinity, menggunakan string </font></font><code>"infinity"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang dapat disingkat </font></font><code>"inf"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Misalnya, Anda bisa mengatakan:</font></font><br>
<br>
<pre><code class="perl hljs">perl -e <span class="hljs-string">'print 1 * "inf"'</span></code></pre><br>
<pre><code class="plaintext hljs">Inf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
atau</font></font><br>
<br>
<pre><code class="perl hljs">perl -e <span class="hljs-string">'print 1/"inf"'</span></code></pre><br>
<pre><code class="plaintext hljs">0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam PL / Perl, PL / Python, PL / v8, angka tak terhingga dari Postgres diteruskan dengan benar, tetapi tanggal tak terbatas tidak tepat. </font><font style="vertical-align: inherit;">Sebaliknya, dalam PL / Perl dan PL / Python tidak ada tipe data bawaan untuk waktu, sebuah string muncul di sana. </font><font style="vertical-align: inherit;">Di PL / V8, ada Date type bawaan, dan tanggal yang biasa dari postgres berubah menjadi Date. </font><font style="vertical-align: inherit;">Tapi V8 tidak tahu tanggal yang tidak ada habisnya, dan ketika ditransfer, itu berubah menjadi </font></font><code>Invalid Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melewati parameter ke permintaan yang disiapkan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kembali ke </font></font><code>prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pertimbangkan bagaimana parameter dilewatkan di sana. </font><font style="vertical-align: inherit;">Bahasa yang berbeda memiliki banyak kesamaan, karena semuanya didasarkan pada SPI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat Anda menyiapkan kueri dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Anda perlu menentukan jenis parameter yang dilewati, dan saat Anda menjalankan kueri, Anda hanya menentukan nilai-nilai parameter ini (parameter dilewatkan ke PL / pgSQL dengan cara yang sama).</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> <span class="hljs-keyword">LANGUAGE</span> plperl $$<span class="perl">
     <span class="hljs-keyword">my</span> $h= spi_prepare(<span class="hljs-string">'SELECT * FROM pg_class WHERE
          relname ~ $1'</span>, <span class="hljs-string">'text'</span> );                     <span class="hljs-comment">#   </span>
     <span class="hljs-keyword">warn</span> Dumper(spi_exec_prepared($h, <span class="hljs-string">'pg_language'</span>)); <span class="hljs-comment">#   </span>
     spi_freeplan($h);
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esensinya sama, tetapi sintaksinya sedikit berbeda:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> <span class="hljs-keyword">LANGUAGE</span> plpython3u $$<span class="pgsql">
     h= plpy.<span class="hljs-keyword">prepare</span>(<span class="hljs-string">'SELECT relname FROM pg_class WHERE relname ~ $1'</span>, [<span class="hljs-string">'text'</span>] )
     plpy.<span class="hljs-keyword">notice</span>(.<span class="hljs-keyword">execute</span> ([<span class="hljs-string">'pg_language'</span>]))
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> perbedaannya minimal:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> <span class="hljs-keyword">LANGUAGE</span> plv8 $$<span class="pgsql">
    var h= plv8.<span class="hljs-keyword">prepare</span>(<span class="hljs-string">'SELECT relname FROM pg_class WHERE relname ~ $1'</span>, [<span class="hljs-string">'text'</span>] );
    plv8.elog(<span class="hljs-keyword">NOTICE</span>, h.<span class="hljs-keyword">execute</span> ([<span class="hljs-string">'pg_language'</span>]));
    h.free();
$$</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Java,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> semuanya berbeda. </font><font style="vertical-align: inherit;">Di sana, SPI jelas tidak digunakan, tetapi koneksi pseudo-JDBC ke database terbentuk. </font><font style="vertical-align: inherit;">Untuk programmer PL / Java, semuanya terjadi seolah-olah dia sedang membuat aplikasi klien. </font><font style="vertical-align: inherit;">Ini nyaman, dan orang juga bisa mendekati desain PL / Perl dan PL / Python, tetapi untuk beberapa alasan ini tidak dilakukan (namun, tidak ada yang melarang membuat beberapa implementasi lebih dari PL / Perl dan PL / Python).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja dengan kursor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua fungsi SPI yang kami gunakan ketika kami pergi ke database - </font></font><code>spi_exec_query()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan yang lain - memiliki parameter yang membatasi jumlah baris yang dikembalikan. </font><font style="vertical-align: inherit;">Jika Anda membutuhkan banyak baris yang dikembalikan, maka Anda tidak dapat melakukannya tanpa kursor untuk menariknya sedikit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kursor bekerja dalam semua bahasa ini. </font><font style="vertical-align: inherit;">Di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl,</font></font></b> <br>
<code>spi_exec_query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan kursor tempat Anda dapat mengekstraksi string satu per satu. </font><font style="vertical-align: inherit;">Tidak perlu menutup kursor, itu akan menutup sendiri. </font><font style="vertical-align: inherit;">Tetapi jika Anda ingin menemukan kembali lagi, Anda dapat secara eksplisit menutupnya dengan perintah </font></font><code>close()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> <span class="hljs-keyword">LANGUAGE</span> plperl $$<span class="perl">
    <span class="hljs-keyword">my</span> $cursor = spi_query(<span class="hljs-string">'SELECT * FROM pg_class'</span>);
    <span class="hljs-keyword">my</span> $row;
    <span class="hljs-keyword">while</span>(<span class="hljs-keyword">defined</span>($row = spi_fetchrow($cursor))) {
         <span class="hljs-keyword">warn</span> $row-&gt;{relname};
    }
$$</span>;</code></pre><br>
<pre><code class="plaintext hljs">WARNING:  pg_statistic at line 5.<font></font>
WARNING:  pg_toast_2604 at line 5.<font></font>
WARNING:  pg_toast_2604_index at line 5.<font></font>
WARNING:  pg_toast_2606 at line 5.<font></font>
WARNING:  pg_toast_2606_index at line 5.<font></font>
WARNING:  pg_toast_2609 at line 5.<font></font>
WARNING:  pg_toast_2609_index at line 5.<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> semuanya sangat mirip, tetapi kursor disajikan sebagai objek yang dapat Anda siklus:</font></font><br>
<br>
<pre><code class="pgsql hljs">h = plpy.<span class="hljs-keyword">prepare</span>(<span class="hljs-string">'SELECT ...'</span>);
<span class="hljs-keyword">cursor</span> = plpy.<span class="hljs-keyword">cursor</span>(h);
<span class="hljs-keyword">for</span> <span class="hljs-keyword">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">cursor</span>:<font></font>
...<font></font>
<span class="hljs-keyword">cursor</span>.<span class="hljs-keyword">close</span>() //  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / v8,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> semuanya juga sangat mirip, tetapi jangan lupa untuk membebaskan paket permintaan yang sudah disiapkan:</font></font><br>
<br>
<pre><code class="pgsql hljs">var h = plv.<span class="hljs-keyword">prepare</span>(<span class="hljs-string">'SELECT ...'</span>);<font></font>
var <span class="hljs-keyword">cursor</span> = h.<span class="hljs-keyword">cursor</span>();<font></font>
var <span class="hljs-keyword">row</span>;
<span class="hljs-keyword">while</span>(<span class="hljs-keyword">row</span> = <span class="hljs-keyword">cursor</span>.<span class="hljs-keyword">fetch</span>()) {<font></font>
...<font></font>
}<font></font>
<span class="hljs-keyword">cursor</span>.<span class="hljs-keyword">close</span>();<font></font>
h.free();</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8: Akses cepat ke fitur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di PL / V8, Anda dapat memanggil fungsi bukan dari SELECT biasa, tetapi temukan namanya dan segera luncurkan dengan </font></font><code>plv8.find_function(name);</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tetapi perlu diingat bahwa dalam JS suatu fungsi tidak bisa polimorfik, seperti pada PostgreSQL, di mana fungsi dengan nama yang sama tetapi dengan parameter yang berbeda dapat hidup berdampingan. </font><font style="vertical-align: inherit;">Dalam PL / v8, tentu saja, kita dapat membuat fungsi polimorfik, tetapi </font></font><code>find_function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan ada kesalahan </font><font style="vertical-align: inherit;">saat mencoba menggunakannya </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">ERROR:  Error: more than one function named "jsdump"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika fungsi dengan nama tidak ambigu, maka itu bisa dipanggil tanpa SPI dan ketik konversi, mis. </font><font style="vertical-align: inherit;">lebih cepat. </font><font style="vertical-align: inherit;">Misalnya, seperti ini:</font></font><br>
<br>
<pre><code class="pgsql hljs"><span class="hljs-keyword">DO</span> <span class="hljs-keyword">LANGUAGE</span> plv8 $$<span class="ruby">
plv8.find_function(<span class="hljs-string">'jsdump'</span>)(<span class="hljs-number">1</span>, <span class="hljs-string">'abc'</span>);
$$</span>;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transaksi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Postgres 11 memiliki banyak kesenangan: </font><font style="vertical-align: inherit;">prosedur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nyata</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> telah muncul </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Postgres dulu hanya memiliki fitur. </font><font style="vertical-align: inherit;">Kegembiraan bukan hanya karena kompatibilitas dan kepatuhan dengan standar SQL, tetapi mengapa: dalam prosedur Anda dapat melakukan dan memutar kembali transaksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / Perl dan PL / Python sudah memiliki fungsi SPI untuk mengelola transaksi, sementara PL / V8 belum. </font><font style="vertical-align: inherit;">Dalam PL / Perl, fungsi-fungsi ini dipanggil </font></font><code>spi_commit()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>spi_rollback()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan contoh penggunaannya ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dalam PL / Python, ini </font></font><code>plpy.commit()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>plpy.rollback()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subtransaksi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Subtransaksi nyaman untuk penanganan kesalahan yang benar dalam logika multi-level yang kompleks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / pgSQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di dalam transaksi, setiap blok dengan kata kunci PENGECUALIAN adalah subtransaksi. Anda dapat membaca tentang beberapa masalah kinerja dan keandalan yang mungkin muncul dalam kasus ini, misalnya, di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak </font><font style="vertical-align: inherit;">ada subtransaksi eksplisit </font><font style="vertical-align: inherit;">dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Perl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi mereka dapat disimulasikan melalui savaepoints. Rupanya, jika Anda mau, mudah untuk menulis modul mutiara yang mengimplementasikan subtransaksi dalam bentuk eksplisit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / Python,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sub-transaksi muncul sejak lama: dari 9,5 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eksplisit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sebelum itu ada yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implisit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Anda dapat mendefinisikan transaksi, membungkusnya</font></font><code>try-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan jalankan. </font><font style="vertical-align: inherit;">Jika subtransaksi jatuh, maka kita jatuh ke dalam blok </font></font><code>except</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, jika tidak jatuh, kemudian ke dalam blok </font></font><code>else</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan melanjutkan.</font></font><br>
<br>
<pre><code class="pgsql hljs">try:
     <span class="hljs-keyword">with</span> plpy.subtransaction():<font></font>
          plpy.<span class="hljs-keyword">execute</span>("...")<font></font>
          plpy.<span class="hljs-keyword">execute</span>("...")
<span class="hljs-keyword">except</span> plpy.SPIError, e:<font></font>
. . .<font></font>
<span class="hljs-keyword">else</span>:<font></font>
. . .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desain serupa ada di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / V8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , hanya dalam sintaks JS.</font></font><br>
<br>
<pre><code class="pgsql hljs">try {<font></font>
plv8.subtransaction(<span class="hljs-keyword">function</span>() {<font></font>
plv8.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'UPDATE...'</span>);<font></font>
plv8.<span class="hljs-keyword">execute</span>(<span class="hljs-string">'UPDATE...'</span>);<font></font>
});<font></font>
}<font></font>
catch(e) {<font></font>
...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Coba, tetapi jangan menyalahgunakan :) Pengetahuan PL / * dapat membawa beberapa manfaat. </font><font style="vertical-align: inherit;">Seperti alat apa pun, alat ini suka digunakan untuk tujuan yang dimaksudkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / v8 sangat menjanjikan, tetapi kadang-kadang berperilaku tak terduga dan memiliki sejumlah masalah. </font><font style="vertical-align: inherit;">Oleh karena itu, lebih baik mengeluarkan bahasa dari kotak jika cocok untuk tugas Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin mengucapkan terima kasih kepada Igor Levshin (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Igor_Le</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), yang banyak membantu saya dengan menyiapkan bahan untuk artikel, dan melemparkan beberapa ide yang berguna, serta Evgeny Sergeev dan Alexey Fadeev untuk koreksi yang mereka usulkan.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id502236/index.html">Pemodelan pesawat anak-anak - pada tingkat yang layak</a></li>
<li><a href="../id502246/index.html">Apa kesamaan jawaban Alice yang berani dengan drone?</a></li>
<li><a href="../id502248/index.html">GOST baru untuk sumber daya digital mulai berlaku: semua platform harus dapat diakses oleh para penyandang cacat</a></li>
<li><a href="../id502250/index.html">Penerbangan Sipil Hari Ini: Aspek dan Tantangan Penting dalam Pelatihan</a></li>
<li><a href="../id502252/index.html">Remote control dan drone</a></li>
<li><a href="../id502256/index.html">Bagaimana cara memvisualisasikan grafik Integrasi Spring menggunakan Neo4j?</a></li>
<li><a href="../id502260/index.html">ESP-NOW adalah protokol komunikasi alternatif untuk ESP8266 dan ESP32. Konsep dasar</a></li>
<li><a href="../id502262/index.html">Mengapa pemantauan AIOps dan payung untuk bank, atau pada apa hubungan pelanggan dibangun</a></li>
<li><a href="../id502264/index.html">Infrastruktur Kunci Publik. Masalah sertifikat dalam kondisi isolasi diri</a></li>
<li><a href="../id502266/index.html">Aurora pada platform Intel. Fajar Era Exaflops</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>