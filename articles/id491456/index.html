<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙌🏽 🧜 🏺 Cadangan ZFS inkremental jarak jauh. Tidak ada tempat yang lebih mudah 🏇🏿 📒 🌗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Amankan saudaramu, amankan ...
 ZFS 0.8 memiliki kemampuan untuk mengirim snapshot inkremental data terenkripsi tanpa mendekripsi. Artinya, memiliki a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cadangan ZFS inkremental jarak jauh. Tidak ada tempat yang lebih mudah</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491456/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amankan saudaramu, amankan ...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZFS 0.8 memiliki kemampuan untuk mengirim snapshot inkremental data terenkripsi tanpa mendekripsi. Artinya, memiliki array terenkripsi, Anda dapat mengatur salinan cermin itu pada mesin jarak jauh, tidak mempercayai pemilik tempat jauh. Data kunci dan dekripsi tidak meninggalkan tempat tepercaya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada satu pun klien saya (mikrokontroler) yang memiliki lebih dari satu ruang server, jika kebakaran datang ke sana, misalnya bintang. Setelah sepakat dengan kolega Anda dalam bisnis admin yang berbahaya, Anda dapat saling melindungi satu sama lain tanpa takut mereka mungkin menggunakan data tersebut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap layanan dalam bentuk mesin virtual diinstal pada Proxmox, di mana data berada di ZFS, dan Anda akan selalu memiliki kesempatan untuk menyimpan salinan jarak jauh dari mesin virtual tersebut. </font><font style="vertical-align: inherit;">Ada kemungkinan bahwa suatu hari, alih-alih jatuh dalam kesedihan, Anda akan pergi ke ruang terpencil, mengambil sepotong besi dan menjalankan semua layanan dengan kesehatan yang baik. </font><font style="vertical-align: inherit;">Saya sudah mentransfer hampir semua layanan saya ke Proxmox sekitar 2 tahun yang lalu dan saya tidak menyesal, semuanya bekerja dengan baik. </font><font style="vertical-align: inherit;">Di ZFS, saya memiliki server terminal untuk 30 orang, yang terkait dengan klien tipis (yaitu, 30 pekerjaan penuh). </font><font style="vertical-align: inherit;">Selain salinan saat ini, Anda juga akan memiliki snapshot selama x hari terakhir baik secara lokal maupun jarak jauh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, Anda akan kehilangan produktivitas karena penggunaan zfs dan enkripsi, tetapi untuk diri saya sendiri sampai pada kesimpulan bahwa saya siap membayar harga ini untuk fungsionalitas tersebut.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Satu sendok tar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat mengatasinya Anda segera terbang dalam salep. Ya, ZFS lebih lambat. Intinya. Tetapi Anda tidak dapat menggunakannya sebagai fs biasa. Ini harus bekerja dalam array disk, di mana peningkatan jumlah disk diterima, disk sebaiknya SAS, controller harus bekerja dalam mode HBA (dan bukan raid0 sebagai disk tunggal), harus ada RAM ECC dan harus banyak, harus ada satu, harus ada satu SSD (PCI-E yang lebih baik) sebagai cache untuk membaca level kedua (kecil, pertunjukan dari 64) dan satu SSD untuk ZIL bisa sangat kecil, tetapi lebih disukai MLC.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengenai SSD, saya memakai rekomendasi ini dan membeli 2 PCI-E SSD 128 dan masing-masing dibagi menjadi 16 pertunjukan dan sisanya. </font><font style="vertical-align: inherit;">Saya meluncurkan dua partisi 16 gigabyte di ZIL sebagai mirror dan meluncurkan bagian yang tersisa di bawah cache level kedua sebagai stripe. </font><font style="vertical-align: inherit;">Pada belas kasihan zfs memberi 16 pertunjukan opera. </font><font style="vertical-align: inherit;">(Satu slot pada seorang ibu yang dibeli dengan ebay ternyata tidak berfungsi; jika berhasil, itu akan memberi 32)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari skrip saya membutuhkan pemberitahuan masalah secara otomatis, memantau jumlah buncis di kedua ujungnya dan kontrol kecepatan. Dari skrip yang jatuh ke tangan saya, tidak ada skrip yang memuaskan saya. Di bawah ini saya akan memberikan beberapa skrip yang saya ulas sebelum melakukan ini. Untuk menerima pemberitahuan melalui email, ganti data saya di fungsi send_error_to_mail () Anda dengan </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bantuan zfskeeper.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anda </font><font style="vertical-align: inherit;">akan menunjukkan kepada Anda contoh penggunaan </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh prep</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan memberi tahu Anda prosedur tindakan persiapan (disarankan) </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bank zfskeeper.sh / terenkripsi / subvol-100-disk-0 10</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan mengambil snapshot saat ini dan meninggalkan 10 snapshot </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terakhir bank zfskeeper.sh / terenkripsi / subvol-100-disk-0 10 Remotehost 22 10m bank replikator / rtl / subvol-100-disk-0 20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kirim data yang tidak terenkripsi ke remotehost: 22 di bawah replikator pengguna dengan kecepatan hingga 10 MB / s dan meninggalkan 10 gambar pada sumber dan 20 pada host remote </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh bank / terenkripsi / subvol-100-disk-0 10 Remotehost 22 bank 10m replikator / rtl / subvol -100-disk-0 20 -w</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hal yang sama, tetapi data akan dienkripsi</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
zpool=<span class="hljs-variable">$1</span>
lsnaps=<span class="hljs-variable">$2</span><font></font>
<font></font>
ip=<span class="hljs-variable">$3</span>
port=<span class="hljs-variable">$4</span>
speedl=<span class="hljs-variable">$5</span>
remoteuser=<span class="hljs-variable">$6</span>
backpool=<span class="hljs-variable">$7</span>
rsnaps=<span class="hljs-variable">$8</span>
sendargs=<span class="hljs-variable">$9</span><font></font>
<font></font>
ZFSLOGDIR=~/zfskeeplogs<font></font>
<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$ZFSLOGDIR</span>"</span> ]; <span class="hljs-keyword">then</span>
    mkdir -p <span class="hljs-variable">$ZFSLOGDIR</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
NAMESNAP=`date <span class="hljs-string">"+%Y_%m_%d_%T"</span>|sed s/:/_/g`<font></font>
logfile=<span class="hljs-variable">$ZFSLOGDIR</span>/<span class="hljs-variable">$NAMESNAP</span>.<span class="hljs-built_in">log</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-title">write_to_log</span></span> ()<font></font>
{<font></font>
<span class="hljs-built_in">echo</span> `date +<span class="hljs-string">"%T"</span>`<span class="hljs-string">" <span class="hljs-variable">$1</span>"</span> &gt;&gt; <span class="hljs-variable">$logfile</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-title">log_last_command</span></span> ()<font></font>
{<font></font>
<span class="hljs-keyword">if</span> [ $? -ne 0 ]; <span class="hljs-keyword">then</span>
	    write_to_log <span class="hljs-string">"<span class="hljs-variable">$1</span> FAILED."</span>
	    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$2</span> = <span class="hljs-literal">true</span> ]; <span class="hljs-keyword">then</span>
		write_to_log <span class="hljs-string">"Script execution stops"</span>
		send_error_to_mail <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"$?"</span> <span class="hljs-string">"$*"</span>
		<span class="hljs-built_in">exit</span> 1
	    <span class="hljs-keyword">fi</span>
	<span class="hljs-keyword">else</span>
	    write_to_log <span class="hljs-string">"<span class="hljs-variable">$1</span> COMPLETED."</span>
	<span class="hljs-keyword">fi</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-title">send_error_to_mail</span></span> ()<font></font>
{<font></font>
<font></font>
Subject=`hostname`<span class="hljs-string">" ZFS backup <span class="hljs-variable">$zpool</span> missing"</span>
swaks --header <span class="hljs-string">"Subject: <span class="hljs-variable">$Subject</span>"</span> --to admin@mydomain.ru --from <span class="hljs-string">"alertbot@mydomain.ru"</span> -a LOGIN -au alertbot@mydomain.ru -ap ailPass --server mail.mydomain.ru -tls --body \
<span class="hljs-string">"<span class="hljs-variable">$Subject</span>
command: zfskeeper.sh <span class="hljs-variable">$3</span>

    <span class="hljs-variable">$1</span>
    <span class="hljs-variable">$2</span>"</span> \<font></font>
    --attach <span class="hljs-variable">$logfile</span>
<span class="hljs-comment">#    --attach-type "$(get_mimetype $logfile)" --attach $logfile</span><font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> <span class="hljs-keyword">in</span><font></font>
    1)<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-keyword">in</span><font></font>
	prepare)<font></font>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"
    Sender mashine:
    apt install swaks mbuffer
    useradd -s /bin/bash replicator
    mkdir -p /home/replicator 
    chown replicator:replicator /home/replicator
    zfs allow -u replicator send,snapshot,destroy,mount bank/encrypted
    su replicator
    ssh-keygen

    Receiver machine:
    ln -s /usr/sbin/zfs /usr/local/bin/zfs
    useradd -s /bin/bash replicator
    mkdir -p /home/replicator 
    chown replicator:replicator /home/replicator
    passwd replicator

    Sender mashine:
    ssh-copy-id -i .ssh/id_rsa.pub Remotehost
    zfs allow -u replicator compression,create,receive,destroy,mount bank/companyname

    "</span><font></font>
    ;;<font></font>
	*)<font></font>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"
    Usage:

    To show the prepare instrutions:
    zfskeeper.sh prepare

    localkeeping:
    keep last 10 snapshots of bank/encrypted/subvol-100-disk-0

    zfskeeper.sh bank/encrypted/subvol-100-disk-0 10

    remotekeeping:

    keep last 10 snapshots bank/encrypted/subvol-100-disk-0 and send it by ssh to Remotehost:22 bank/rtl/subvol-100-disk-0
    and keep last 20 copies by replicator user and limit transferspeed 10Mb/s

    zfskeeper.sh bank/encrypted/subvol-100-disk-0 10 Remotehost 22 10m replicator bank/rtl/subvol-100-disk-0 20

    If you need to send encrypted data, then you need add -w to the end of the line

    zfskeeper bank/encrypted/subvol-100-disk-0 10 Remotehost 22 10m replicator bank/rtl/subvol-100-disk-0 20 -w
    "</span><font></font>
    ;;<font></font>
    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">exit</span> 0<font></font>
    ;;<font></font>
    2)<font></font>
    <span class="hljs-built_in">echo</span> `date +<span class="hljs-string">"%T"</span>`<span class="hljs-string">" Local keeping of <span class="hljs-variable">$NAMESNAP</span> being started"</span> &gt; <span class="hljs-variable">$logfile</span><font></font>
    ;;<font></font>
    8|9)<font></font>
    <span class="hljs-built_in">echo</span> `date +<span class="hljs-string">"%T"</span>`<span class="hljs-string">" Remote keeping of <span class="hljs-variable">$NAMESNAP</span> being started"</span> &gt; <span class="hljs-variable">$logfile</span><font></font>
    ;;<font></font>
    *)<font></font>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"illegal number of parameters"</span> &gt;&amp;2
    <span class="hljs-built_in">exit</span> 1<font></font>
    ;;<font></font>
<span class="hljs-keyword">esac</span><font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-comment">####################################### Local part #######################################################</span><font></font>
<font></font>
<span class="hljs-comment"># Remove waste local snaps</span>
numsnap=`zfs list -H -o name -t snapshot -s creation|grep <span class="hljs-string">"<span class="hljs-variable">${zpool}</span>@"</span>|wc|awk <span class="hljs-string">'{ print $1 }'</span>`
<span class="hljs-built_in">let</span> MAXSNAP=numsnap-lsnaps+1 &gt;/dev/null
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$MAXSNAP</span> -gt 0 ] ; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> `zfs list -H -o name -t snapshot -s creation| grep <span class="hljs-string">"<span class="hljs-variable">${zpool}</span>@"</span>|/usr/bin/head -n<span class="hljs-string">"<span class="hljs-variable">$MAXSNAP</span>"</span>`; <span class="hljs-keyword">do</span>
        zfs destroy <span class="hljs-variable">${d}</span>
        log_last_command <span class="hljs-string">"Remove local snapshot <span class="hljs-variable">$d</span>"</span>
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment"># Create fresh local snap</span>
zfs snapshot <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span>
log_last_command <span class="hljs-string">"Create local <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span>"</span> <span class="hljs-literal">true</span><font></font>
<font></font>
<span class="hljs-comment">####################################### Local part #######################################################</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$backpool</span>"</span> ]; <span class="hljs-keyword">then</span>
    write_to_log <span class="hljs-string">"Local keeping is complete"</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment">####################################### Remote part #######################################################</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment"># Check remote address</span>
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$ip</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> ping -c 1 <span class="hljs-variable">$ip</span> &gt; null ; <span class="hljs-keyword">then</span>
            sship=<span class="hljs-string">"ssh -c aes128-ctr -p"</span><span class="hljs-variable">$port</span><span class="hljs-string">" -l"</span><span class="hljs-variable">$remoteuser</span><span class="hljs-string">" "</span><span class="hljs-variable">$ip</span>
    <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"URL <span class="hljs-variable">$ip</span> is not accesiible, abort"</span>
            send_error_to_mail <span class="hljs-string">"Try to ping remote host"</span> <span class="hljs-string">"URL <span class="hljs-variable">$ip</span> is not accesiible, abort"</span> <span class="hljs-string">"$*"</span>
            <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-comment"># Remote backup is unnecessary</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment"># Remove waste local snaps</span>
numsnap=`<span class="hljs-variable">$sship</span> zfs list -H -o name -t snapshot -s creation|grep <span class="hljs-string">"<span class="hljs-variable">${backpool}</span>@"</span>|wc|awk <span class="hljs-string">'{ print $1 }'</span>`
<span class="hljs-built_in">let</span> MAXSNAP=numsnap-rsnaps+1 &gt;/dev/null
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$MAXSNAP</span> -gt 0 ] ; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> `<span class="hljs-variable">$sship</span> zfs list -H -o name -t snapshot -s creation| grep <span class="hljs-string">"<span class="hljs-variable">${backpool}</span>@"</span>|/usr/bin/head -n<span class="hljs-string">"<span class="hljs-variable">$MAXSNAP</span>"</span>`; <span class="hljs-keyword">do</span>
        <span class="hljs-variable">$sship</span> zfs destroy <span class="hljs-variable">${d}</span>
        log_last_command <span class="hljs-string">"Remove local snapshot <span class="hljs-variable">$d</span>"</span>
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment"># Receive last remote snap</span>
MOST_SLAVE_SNAP_NAME=`<span class="hljs-variable">$sship</span> zfs list -H -o name -t snapshot -s creation|grep <span class="hljs-string">"<span class="hljs-variable">$backpool</span>@backup"</span>|tail -n1|awk -F <span class="hljs-string">"@"</span> <span class="hljs-string">'{print $2}'</span>`<font></font>
<font></font>
<span class="hljs-comment"># If localbackup has same snap then send incremental copy. If has't then send full</span>
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"`zfs list -H -o name -t snapshot -s creation|grep -w "</span><span class="hljs-variable">$zpool</span>@<span class="hljs-variable">$MOST_SLAVE_SNAP_NAME</span><span class="hljs-string">"`"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment">#zfs send $sendargs -i $MOST_SLAVE_SNAP_NAME $zpool@backup_$NAMESNAP | pv -L $speedl | $sship zfs receive -vF $backpool@backup_$NAMESNAP &amp;&gt;&gt; $logfile</span>
    zfs send <span class="hljs-variable">$sendargs</span> -i <span class="hljs-variable">$MOST_SLAVE_SNAP_NAME</span> <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span> | mbuffer -q -v 0 -s 128k -m 1G | pv -L <span class="hljs-variable">$speedl</span> | <span class="hljs-variable">$sship</span> <span class="hljs-string">"mbuffer -q -v 0 -s 128k -m 1G | zfs receive -vF <span class="hljs-variable">$backpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span>"</span> &amp;&gt;&gt; <span class="hljs-variable">$logfile</span>
    log_last_command <span class="hljs-string">"Sending incremental backup to the remote machine"</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-comment">#If backpool exist we remove it. You can rename it</span>
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"`<span class="hljs-variable">$sship</span> zfs list -H -o name -s creation|grep -w "</span><span class="hljs-variable">$backpool</span><span class="hljs-string">"`"</span> ]; <span class="hljs-keyword">then</span>
	<span class="hljs-comment">#$sship zfs rename -p $backpool `$sship zfs list -H -o name|grep -w "$backpool"|awk -F "/" '{print $1}'`/old_$NAMESNAP</span>
	<span class="hljs-variable">$sship</span> zfs destroy -r <span class="hljs-variable">$backpool</span> 2&gt;&gt; <span class="hljs-variable">$logfile</span>
	log_last_command <span class="hljs-string">"Need to destroy remotepool for full sending <span class="hljs-variable">$backpool</span>"</span> <span class="hljs-literal">true</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-comment">#zfs send $sendargs $zpool@backup_$NAMESNAP | pv -L $speedl | $sship zfs receive -vF $backpool &amp;&gt;&gt; $logfile</span>
    zfs send <span class="hljs-variable">$sendargs</span> <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span> | mbuffer -q -v 0 -s 128k -m 1G | pv -L <span class="hljs-variable">$speedl</span> | <span class="hljs-variable">$sship</span> <span class="hljs-string">"mbuffer -q -v 0 -s 128k -m 1G | zfs receive -vF <span class="hljs-variable">$backpool</span>"</span> &amp;&gt;&gt; <span class="hljs-variable">$logfile</span><font></font>
<font></font>
    log_last_command <span class="hljs-string">"Sending full backup to the remote machine"</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">####################################### Remote part #######################################################</span><font></font>
<font></font>
write_to_log <span class="hljs-string">"Remote keeping is complete"</span>
<span class="hljs-built_in">exit</span> 0</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeepall.sh</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menjaga agar beberapa bagian tetap kencang, Anda memerlukan skrip kontrol. </font><font style="vertical-align: inherit;">Semua orang sudah bisa membuatnya sesuai selera dan warna, tergantung pada konfigurasi. </font><font style="vertical-align: inherit;">Tes saya terlihat seperti ini:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span><font></font>
scriptpath=/home/replicator/zfskeeper.sh<font></font>
<span class="hljs-variable">$scriptpath</span> bank/encrypted/subvol-100-disk-0 5 RemoteHost 22 30m replicator bank/rtl/subvol-100-disk-0 5 -w
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi yang ada</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya menemukannya pertama kali, atas dasar itu saya memeriksa keseluruhan operabilitas mekanisme. </font><font style="vertical-align: inherit;">Terima kasih kepada penulis, tetapi gaya penulisan agak kotor, harus ditulis ulang dengan jelas. </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfs-auto-snapshot.sh hanyalah sebuah blok. </font><font style="vertical-align: inherit;">Ada sesuatu untuk dipinjam, indah, rapi, tapi besar dan fungsional </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendah zfsbackup.sh - juga</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PS yang </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">rapi, tapi</font></a><font style="vertical-align: inherit;"> rendah </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">fungsional.</font></a><font style="vertical-align: inherit;"> Saya menggigit zfs dari ketiga kalinya, setiap kali saya menggigiti sekitar sebulan. </font><font style="vertical-align: inherit;">Saya tidak bisa membuatnya bekerja dengan cepat, dan gagal sepenuhnya. </font><font style="vertical-align: inherit;">Secara umum, situasi berubah setelah menginstal disk SAS (setidaknya 7200, setidaknya NL). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damai untuk semua orang! </font><font style="vertical-align: inherit;">Terima kasih telah membaca!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id491442/index.html">Intisari Desain Makanan, Februari 2020</a></li>
<li><a href="../id491444/index.html">Menggunakan variabel dalam pipa Azure DevOps</a></li>
<li><a href="../id491446/index.html">Cara "meretas" RedBull</a></li>
<li><a href="../id491448/index.html">Menggunakan pustaka FuzzyWuzzy untuk perbandingan fuzzy dalam Python. Levenshtein Distance (jarak editorial)</a></li>
<li><a href="../id491454/index.html">Linux NVMe rig</a></li>
<li><a href="../id491458/index.html">Gadis-gadis di tech, Ozon Tech</a></li>
<li><a href="../id491460/index.html">Membalikkan Otak Rekayasa. Penyimpanan</a></li>
<li><a href="../id491462/index.html">Baca Akhir Pekan: 12 podcast, stasiun radio FM era matahari terbenam, dan aplikasi meditasi</a></li>
<li><a href="../id491476/index.html">Accelerometer MEMS, magnetometer, dan sudut orientasi</a></li>
<li><a href="../id491478/index.html">Implan baru untuk tunanetra terhubung langsung ke otak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>