<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍰 🆓 ♣️ Saubere Architektur mit den Augen eines Python-Entwicklers 👩‍🎓 🔠 🐅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Mein Name ist Eugene, ich bin ein Python-Entwickler. In den letzten anderthalb Jahren begann unser Team, die Prinzipien der sauberen Architektu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Saubere Architektur mit den Augen eines Python-Entwicklers</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/exness/blog/494370/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo! Mein Name ist Eugene, ich bin ein Python-Entwickler. In den letzten anderthalb Jahren begann unser Team, die Prinzipien der sauberen Architektur aktiv anzuwenden und sich vom klassischen MVC-Modell zu entfernen. Und heute werde ich darüber sprechen, wie wir dazu gekommen sind, was es uns gibt und warum die direkte Übertragung von Ansätzen von anderen PLs nicht immer eine gute Lösung ist.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t_/hs/tl/t_hstlzmkevavrg4y8tazjdfu4c.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python ist seit über sieben Jahren mein primäres Entwicklungswerkzeug. Wenn sie mich fragen, was mir an ihm am besten gefällt, antworte ich, dass dies seine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hervorragende Lesbarkeit ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Die erste Bekanntschaft begann mit der Lektüre des Buches </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Programming a Collective Mind“</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ich war an den darin beschriebenen Algorithmen interessiert, aber alle Beispiele waren in einer Sprache, die mir damals noch nicht vertraut war. Dies war nicht üblich (Python war im maschinellen Lernen noch kein Mainstream), Auflistungen wurden oft in Pseudocode oder unter Verwendung von Diagrammen geschrieben. Aber nach einer kurzen Einführung in die Sprache schätzte ich ihre Prägnanz: Alles war </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einfach und klar, nichts überflüssig und ablenkend, nur das Wesentliche des beschriebenen Prozesses</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Hauptvorteil davon ist das erstaunliche Design der Sprache, der sehr intuitive syntaktische Zucker. </font><font style="vertical-align: inherit;">Diese Ausdruckskraft wurde in der Community immer geschätzt. </font><font style="vertical-align: inherit;">Was ist " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import this</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", das unbedingt auf den ersten Seiten eines Lehrbuchs vorhanden ist: Es sieht aus wie ein unsichtbarer Aufseher, der Ihre Handlungen ständig bewertet. </font><font style="vertical-align: inherit;">In Foren hat es sich für Anfänger gelohnt, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CamelCase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Variablennamen in der Liste zu verwenden, sodass sich der Diskussionswinkel sofort in Richtung der Redewendung des vorgeschlagenen Codes mit Verweisen auf PEP8 verschob.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Streben nach Eleganz und die kraftvolle Dynamik der Sprache haben viele Bibliotheken mit einer wirklich reizvollen API geschaffen.&nbsp;</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl Python leistungsstark ist, ist es nur ein Tool, mit dem Sie ausdrucksstarken, </font><font style="vertical-align: inherit;">selbstdokumentierenden </font><font style="vertical-align: inherit;">Code schreiben können. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies garantiert jedoch weder dies</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> noch die PEP8-Konformität. </font><font style="vertical-align: inherit;">Wenn unser scheinbar einfacher Online-Shop auf Django anfängt, Geld zu verdienen und infolgedessen Funktionen aufzupumpen, stellen wir irgendwann fest, dass dies nicht so einfach ist und selbst grundlegende Änderungen immer mehr Aufwand erfordern. und vor allem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wächst</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dieser Trend </font><b><font style="vertical-align: inherit;">. </font></b><font style="vertical-align: inherit;">Was ist passiert und wann ist alles schief gelaufen?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlechter Code</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schlechter Code folgt nicht PEP8 oder erfüllt nicht die Anforderungen der zyklomatischen Komplexität. </font><font style="vertical-align: inherit;">Schlechter Code ist in erster </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linie unkontrollierte Abhängigkeiten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die dazu führen, dass eine Änderung an einer Stelle des Programms zu unvorhersehbaren Änderungen an anderen Stellen führt. </font><font style="vertical-align: inherit;">Wir verlieren die Kontrolle über den Code. Die Erweiterung der Funktionalität erfordert eine detaillierte Untersuchung des Projekts. </font><font style="vertical-align: inherit;">Ein solcher Code verliert seine Flexibilität und widersetzt sich sozusagen Änderungen, während das Programm selbst „zerbrechlich“ wird.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saubere Architektur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die gewählte Architektur der Anwendung sollte dieses Problem vermeiden, und wir sind nicht die Ersten, die darauf stoßen: In der Java-Community wurde lange Zeit über die Erstellung eines optimalen Anwendungsdesigns diskutiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bereits im Jahr 2000 brachte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robert Martin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (auch bekannt als Onkel Bob) in seinem Artikel „ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Design and Design Principles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “ fünf Prinzipien für das Design von OOP-Anwendungen unter dem denkwürdigen Akronym </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOLID zusammen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Diese Prinzipien wurden von der Community gut aufgenommen und gingen weit über das Java-Ökosystem hinaus. Trotzdem sind sie sehr abstrakt. Später gab es mehrere Versuche, ein allgemeines Anwendungsdesign zu entwickeln, das auf SOLID-Prinzipien basiert. Dazu gehören: "Sechseckige Architektur", "Ports und Adapter", "Bulbous-Architektur" und alle haben viele Gemeinsamkeiten, wenn auch unterschiedliche Implementierungsdetails. Und 2012 wurde ein Artikel von demselben Robert Martin veröffentlicht, in dem er seine eigene Version mit dem Titel „ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clean Architecture</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “ </font><font style="vertical-align: inherit;">vorschlug </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c32/3a9/769/c323a9769c90f4e28a17e1d5c05ab160.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laut Onkel Bob ist Architektur in erster Linie „ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grenzen und Barrieren</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “. Es ist notwendig, die Anforderungen klar zu verstehen und die Softwareschnittstellen einzuschränken, um die Kontrolle über die Anwendung nicht zu verlieren. Dazu ist das Programm </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in Ebenen unterteilt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Beim Wechsel von einer Schicht zur anderen können </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nur Daten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> übertragen werden </font><font style="vertical-align: inherit;">(einfache Strukturen und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTO-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objekte </font><font style="vertical-align: inherit;">können als Daten fungieren </font><font style="vertical-align: inherit;">) - dies ist die Regel der Grenzen. </font><font style="vertical-align: inherit;">Eine andere am häufigsten zitierte Formulierung, dass „die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendung schreien sollte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “, bedeutet, dass die Hauptsache in der Anwendung nicht das verwendete Framework oder die Datenspeichertechnologie ist, sondern was diese Anwendung tatsächlich tut, welche Funktion sie ausführt - die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geschäftslogik der</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anwendung . </font><font style="vertical-align: inherit;">Daher haben die Schichten keine lineare Struktur, sondern </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine Hierarchie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Daher zwei weitere Regeln:</font></font><br>
 <br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Prioritätsregel für die innere Schicht</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es ist die innere Schicht, die die Schnittstelle bestimmt, über die sie mit der Außenwelt interagiert.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abhängigkeitsregel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Abhängigkeiten sollten von der inneren zur äußeren Schicht gerichtet werden.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die letzte Regel ist in der Python-Welt ziemlich untypisch. </font><font style="vertical-align: inherit;">Um ein kompliziertes Geschäftslogikszenario anzuwenden, müssen Sie immer auf externe Dienste (z. B. eine Datenbank) zugreifen. Um diese Abhängigkeit zu vermeiden, muss die Geschäftslogikschicht </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selbst die Schnittstelle deklarieren,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über die sie mit der Außenwelt interagiert. </font><font style="vertical-align: inherit;">Diese Technik wird als " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abhängigkeitsinversion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " (der Buchstabe D in SOLID) bezeichnet und ist in Sprachen mit statischer Typisierung weit verbreitet. </font><font style="vertical-align: inherit;">Laut Robert Martin ist dies der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hauptvorteil, der mit der OOP einherging</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese drei Regeln sind die Essenz von Clean Architecture:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grenzübergangsregel;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abhängigkeitsregel;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Prioritätsregel der inneren Schicht.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Vorteile dieses Ansatzes umfassen:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einfache Prüfung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die Schichten sind isoliert, sie können ohne Affenflicken getestet werden. Sie können die Beschichtung je nach Grad ihrer Wichtigkeit für verschiedene Schichten granular einstellen.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einfache Änderung der Geschäftsregeln</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , da alle an einem Ort gesammelt werden, nicht über das Projekt verteilt sind und nicht mit Code auf niedriger Ebene gemischt werden.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unabhängigkeit von externen Agenten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Das Vorhandensein von Abstraktionen zwischen Geschäftslogik und Außenwelt ermöglicht es Ihnen in bestimmten Fällen, externe Quellen zu ändern, ohne die internen Ebenen zu beeinflussen. </font><font style="vertical-align: inherit;">Dies funktioniert, wenn Sie die Geschäftslogik nicht an die spezifischen Funktionen externer Agenten gebunden haben, z. B. Datenbanktransaktionen.</font></font></li>
<li><b> </b>,   ,     ,      .</li>
</ul><br>
<blockquote>     ,    .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>.     «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Clean Architecture</a>».<br>
</blockquote><br>
<h2>  Python</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine Theorie, Beispiele für die praktische Anwendung finden sich im Originalartikel, in den Berichten und im Buch von Robert Martin. Sie basieren auf mehreren gängigen Entwurfsmustern aus der Java-Welt: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adapter, Gateway, Interactor, Fasade, Repository, DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usw. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist mit Python? Wie gesagt, Laconicism wird in der Python-Community geschätzt. Was in anderen Wurzeln geschlagen hat, ist weit davon entfernt, dass es bei uns Wurzeln schlagen wird. Als ich mich vor drei Jahren zum ersten Mal diesem Thema zuwandte, gab es nicht viele Materialien zum Thema "Saubere Architektur in Python", aber der erste Link in Google war </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leonardo Giordani- </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Projekt</font></a><font style="vertical-align: inherit;"> : Der Autor beschreibt ausführlich den Prozess der Erstellung einer API für eine Immobiliensuchwebsite mithilfe der TDD-Methode. Anwendung von Clean Architecture.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider ist dieses Beispiel trotz der gewissenhaften Erklärung und der Befolgung aller Kanons von Onkel Bob ziemlich </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beängstigend</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Projekt-API besteht aus einer Methode: Abrufen einer Liste mit einem verfügbaren Filter. Ich denke, dass selbst für einen unerfahrenen Entwickler der Code für ein solches Projekt nicht mehr als 15 Zeilen umfassen wird. In diesem Fall nahm er sechs Päckchen. Sie können sich auf ein nicht ganz erfolgreiches Layout beziehen, und dies ist wahr, aber in jedem Fall ist </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es für jemanden schwierig, die Wirksamkeit dieses Ansatzes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anhand dieses Projekts </font><b><font style="vertical-align: inherit;">zu erklären</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt ein ernsthafteres Problem. Wenn Sie den Artikel nicht lesen und sofort mit dem Studium des Projekts beginnen, ist es ziemlich schwer zu verstehen. Betrachten Sie die Implementierung der Geschäftslogik:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> rentomatic.response_objects <span class="hljs-keyword">import</span> response_objects <span class="hljs-keyword">as</span> res<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>(<span class="hljs-params">object</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self, request_object</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_object:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_from_invalid_request_object(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request_object)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.list(filters=request_object.filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseSuccess(rooms)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_system_error(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"{}: {}"</span>.format(exc.__class__.__name__, <span class="hljs-string">"{}"</span>.format(exc)))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die RoomListUseCase-Klasse, die die Geschäftslogik implementiert (der Geschäftslogik nicht sehr ähnlich, oder?) Des Projekts, wird vom </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repo-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objekt initialisiert </font><font style="vertical-align: inherit;">. Aber was ist ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Aus dem Kontext können wir natürlich verstehen, dass </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Repository-Vorlage für den Zugriff auf Daten implementiert. Wenn wir uns den Hauptteil von RoomListUseCase ansehen, verstehen wir, dass es eine Listenmethode geben muss, deren Eingabe eine Liste von Filtern ist, die bei der Ausgabe nicht klar ist in ResponseSuccess. Und wenn das Szenario komplexer ist, mit mehrfachem Zugriff auf die Datenquelle? Es stellt sich heraus, zu verstehen, was Repo ist, man kann sich </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nur auf die Implementierung beziehen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Aber wo befindet sie sich? Es liegt in einem separaten Modul, das in keiner Weise mit RoomListUseCase verknüpft ist. Um zu verstehen, was passiert, müssen Sie zur oberen Ebene (der Ebene des Frameworks) aufsteigen und sehen, was beim Erstellen des Objekts der Eingabe der Klasse zugeführt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie könnten denken, dass ich die Nachteile der dynamischen Typisierung aufführe, aber das ist nicht ganz richtig. Es ist eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamische Eingabe, mit der Sie ausdrucksstarken und kompakten Code schreiben können</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Die Analogie zu Microservices kommt in den Sinn, wenn wir einen Monolithen in Microservices schneiden, nimmt das Design zusätzliche Steifigkeit an, da innerhalb des Microservices alles möglich ist (PL, Frameworks, Architektur), aber es muss der deklarierten Schnittstelle entsprechen. Also hier: als wir unser Projekt in Ebenen unterteilt haben,</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Beziehungen zwischen den Ebenen müssen mit dem Vertrag übereinstimmen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , während </font><b><font style="vertical-align: inherit;">der Vertrag</font></b><font style="vertical-align: inherit;"> innerhalb der Ebene optional ist. Andernfalls müssen Sie einen ziemlich großen Kontext in Ihrem Kopf behalten. Denken Sie daran, ich sagte, dass das Problem mit schlechtem Code Abhängigkeiten sind, und so rutschen wir ohne explizite Schnittstelle wieder dorthin zurück, wo wir weg wollten - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ohne offensichtliche Ursache-Wirkungs-Beziehungen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote>    <i>repo</i>     RoomListUseCase,    execute — <b>   </b>.       -    ,   ,     .     -        . ,   ,    ,  <i>repo</i>   .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen habe ich damals Clean Architecture in einem neuen Projekt aufgegeben und erneut die klassische MVC angewendet. Nachdem er die nächsten Kegel gefüllt hatte, kehrte er ein Jahr später zu dieser Idee zurück, als wir endlich begannen, Dienste in Python 3.5+ zu starten. Wie Sie wissen, brachte er </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typanmerkungen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenklassen mit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Zwei leistungsstarke Tools zur Beschreibung der Benutzeroberfläche. Basierend auf ihnen habe ich einen Prototyp des Dienstes entworfen, und das Ergebnis war bereits viel besser: Die Ebenen bröckelten nicht mehr, obwohl immer noch viel Code vorhanden war, insbesondere bei der Integration in das Framework. Dies reichte jedoch aus, um diesen Ansatz in kleinen Projekten anzuwenden. Allmählich tauchten Frameworks auf, die sich auf die maximale Verwendung von Typanmerkungen konzentrierten: Apistar (jetzt Starlette), geschmolzenes Framework. Das pydantic / FastAPI-Bundle ist mittlerweile weit verbreitet, und die Integration in solche Frameworks ist viel einfacher geworden. So würde das obige Beispiel von restomatic / services.py aussehen:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional, List
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span>(<span class="hljs-params">BaseModel</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;code: str<font></font>
&nbsp;&nbsp;&nbsp;size: int<font></font>
&nbsp;&nbsp;&nbsp;price: int<font></font>
&nbsp;&nbsp;&nbsp;latitude: float<font></font>
&nbsp;&nbsp;&nbsp;longitude: float<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomFilter</span>(<span class="hljs-params">BaseModel</span>):</span>
&nbsp;&nbsp;&nbsp;code: Optional[str] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_min: Optional[int] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_max: Optional[int] = <span class="hljs-literal">None</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomStorage</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span> ...<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo: RoomStorage</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RoomListUseCase - eine Klasse, die die Geschäftslogik des Projekts implementiert. Sie sollten nicht darauf achten, dass die Methode show_rooms lediglich RoomStorage aufruft (dieses Beispiel habe ich nicht erstellt). Im wirklichen Leben kann es auch eine Rabattberechnung geben, bei der eine Liste basierend auf Werbung usw. eingestuft wird. Das Modul ist jedoch autark. Wenn wir dieses Szenario in einem anderen Projekt verwenden möchten, müssen wir RoomStorage implementieren. Und was dafür benötigt wird, ist direkt vom Modul aus gut sichtbar. Im Gegensatz zum vorherigen Beispiel ist eine solche Ebene </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autark</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und beim Ändern muss nicht der gesamte Kontext berücksichtigt werden. Von nicht-systemischen Abhängigkeiten nur pydantisch, warum, wird es im Plug-In des Frameworks deutlich. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keine Abhängigkeiten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine weitere Möglichkeit, die Lesbarkeit von Code zu verbessern, und nicht der zusätzliche Kontext. Selbst ein unerfahrener Entwickler kann verstehen, was dieses Modul tut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Geschäftslogikszenario muss keine Klasse sein. Nachfolgend finden Sie ein Beispiel für ein ähnliches Szenario in Form einer Funktion:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rool_list_use_case</span>(<span class="hljs-params">filters: RoomFilter, repo: RoomStorage</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;rooms = repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier ist die Verbindung zum Framework:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> rentomatic <span class="hljs-keyword">import</span> services, adapters<font></font>
app = FastAPI()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_use_case</span>() -&gt; services.RoomListUseCase:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> services.RoomListUseCase(adapters.MemoryStorage())<font></font>
<font></font>
<span class="hljs-meta">@app.post("/rooms", response_model=List[services.Room])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rooms</span>(<span class="hljs-params">filters: services.RoomFilter, use_case=Depends(<span class="hljs-params">get_use_case</span>)</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> use_case.show_rooms(filters)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der Funktion get_use_case implementiert FastAPI das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abhängigkeitsinjektionsmuster</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wir müssen uns nicht um die Serialisierung von Daten kümmern, die gesamte Arbeit wird von FastAPI in Verbindung mit pydantic erledigt. Leider sind die </font><font style="vertical-align: inherit;">Daten nicht immer Format Business - </font><font style="vertical-align: inherit;">Logik geeignet für Live - </font><font style="vertical-align: inherit;">Übertragung im Restaurant &lt;und, im Gegenteil, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Business - </font><font style="vertical-align: inherit;">Logik nicht weiß , </font><font style="vertical-align: inherit;">wo die Daten kamen - mit Schrägstrichen, Anfrage Körper, Cookies, etc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In diesem Fall hat der Hauptteil der Raumfunktion eine bestimmte Konvertierung von Eingabe- und Ausgabedaten. In den meisten Fällen reicht jedoch eine solche einfache Proxy-Funktion aus, wenn wir mit der API arbeiten.&nbsp;</font></font><br>
<br>
<blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>   , ,    ,    RoomStorage.  ,     15 ,     ,      ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die Ebene der Geschäftslogik absichtlich nicht getrennt, wie das kanonische Modell der sauberen Architektur nahe legt. </font><font style="vertical-align: inherit;">Die Room-Klasse sollte sich in der Ebene der Entity-Domänenregion befinden, die die Domänenregion darstellt. In diesem Beispiel ist dies jedoch nicht erforderlich. </font><font style="vertical-align: inherit;">Durch die Kombination von Entity- und UseCase-Ebenen hört das Projekt nicht auf, eine Clean Architecture-Implementierung zu sein. </font><font style="vertical-align: inherit;">Robert Martin selbst hat wiederholt gesagt, dass die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anzahl der Schichten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sowohl nach oben als auch nach unten </font><b><font style="vertical-align: inherit;">variieren kann</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Gleichzeitig erfüllt das Projekt die Hauptkriterien von Clean Architecture:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grenzüberschreitungsregel: pydantische Modelle, bei denen es sich im Wesentlichen um DTOs handelt, </font><b><font style="vertical-align: inherit;">überschreiten Grenzen</font></b><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abhängigkeitsregel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Die Geschäftslogikschicht ist unabhängig von anderen Schichten.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Prioritätsregel der inneren Schicht</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Es ist die Geschäftslogikschicht, die die Schnittstelle (RoomStorage) definiert, über die die Geschäftslogik mit der Außenwelt interagiert.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute arbeiten mehrere Projekte unseres Teams, die mit dem beschriebenen Ansatz umgesetzt wurden, an dem Produkt. </font><font style="vertical-align: inherit;">Ich versuche auf diese Weise auch die kleinsten Dienstleistungen zu organisieren. </font><font style="vertical-align: inherit;">Es trainiert gut - Fragen, über die ich vorher nicht nachgedacht hatte, tauchen auf. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist hier beispielsweise Geschäftslogik? </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist beispielsweise bei weitem nicht immer offensichtlich, wenn Sie eine Art Proxy schreiben. </font><font style="vertical-align: inherit;">Ein weiterer wichtiger Punkt ist zu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lernen, anders zu denken.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wenn wir eine Aufgabe erhalten, denken wir normalerweise über die Frameworks und die verwendeten Dienste nach und darüber, ob eine Warteschlange erforderlich ist, in der es besser ist, diese Daten zu speichern, die zwischengespeichert werden können. Bei dem Ansatz, der eine saubere Architektur vorschreibt, müssen wir zuerst die Geschäftslogik implementieren und erst dann die Interaktion mit der Infrastruktur implementieren, da laut Robert Martin die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hauptaufgabe der Architektur darin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> besteht, den Moment zu verzögern, in dem die Verbindung mit einer solchen hergestellt wird Die Infrastrukturschicht ist ein wesentlicher Bestandteil Ihrer Anwendung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen sehe ich eine günstige Perspektive für die Verwendung von Clean Architecture in Python. </font><font style="vertical-align: inherit;">Die Form unterscheidet sich jedoch höchstwahrscheinlich erheblich von der Art und Weise, wie sie in anderen PLs akzeptiert wird. </font><font style="vertical-align: inherit;">In den letzten Jahren hat das Interesse am Thema Architektur in der Gemeinde deutlich zugenommen. </font><font style="vertical-align: inherit;">Bei der letzten PyCon gab es also mehrere Berichte über die Verwendung von DDD, und die Leute aus den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trockenlabors</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sollten separat notiert werden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In unserem Unternehmen setzen viele Teams den beschriebenen Ansatz bereits in gewissem Maße um. </font><font style="vertical-align: inherit;">Wir alle machen das Gleiche, wir sind gewachsen, unsere Projekte sind gewachsen, die Python-Community muss damit arbeiten, den gemeinsamen Stil und die gemeinsame Sprache definieren, die zum Beispiel einst für alle Django wurden.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de494350/index.html">März und April Online Events Digest</a></li>
<li><a href="../de494354/index.html">Wissen und Zustand</a></li>
<li><a href="../de494356/index.html">Linux Newbie Aircrack-ng Tutorial</a></li>
<li><a href="../de494364/index.html">DSGVO: Zustimmung zur Verarbeitung personenbezogener Daten</a></li>
<li><a href="../de494366/index.html">Online-Mitaps für die ganze Woche ab dem 27. März (für Back, Mobile, QA, PM und alle)</a></li>
<li><a href="../de494372/index.html">Allrussische Verifizierungssoftware - Eine Innenansicht</a></li>
<li><a href="../de494374/index.html">Elektrobusse und ihre Batterien: Was ist Lithiumtitanat? (Teil 1)</a></li>
<li><a href="../de494376/index.html">Hierarchischer Tiefenpuffer</a></li>
<li><a href="../de494380/index.html">Einführung in das strategische Produktmanagement</a></li>
<li><a href="../de494384/index.html">Funktionserhebung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>