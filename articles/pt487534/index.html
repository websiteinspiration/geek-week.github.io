<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻 🗽 🤚🏽 etcd 3.4.3: confiabilidade de armazenamento e pesquisa de segurança 💤 🔵 👩‍❤️‍💋‍👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : O conteúdo deste artigo não é totalmente típico do nosso blog. No entanto, como muitas pessoas sabem, o etcd está localizado no coração ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>etcd 3.4.3: confiabilidade de armazenamento e pesquisa de segurança</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/487534/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota perev.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : O conteúdo deste artigo não é totalmente típico do nosso blog. No entanto, como muitas pessoas sabem, o etcd está localizado no coração de Kubernetes, motivo pelo qual este estudo, conduzido por um consultor independente no campo da confiabilidade, mostrou-se interessante entre os engenheiros que operam este sistema. Além disso, é interessante no contexto de como os projetos de código aberto que já se comprovaram na produção estão sendo aprimorados, mesmo em um nível tão "baixo".</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/xd/av/d3/xdavd35rjqklgnrnd-0wulkpayo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cofre de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor-chave (KV)</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"> etc</font></a><font style="vertical-align: inherit;"> é um banco de dados distribuído baseado no algoritmo de consenso Raft. Em uma análise</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realizada em 2014</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , descobrimos que o etcd 0.4.1 foi afetado pelas chamadas leituras obsoletas por padrão</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(leia operações que retornam um valor antigo e irrelevante devido a um atraso na sincronização - aprox. transl.)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Decidimos retornar ao etcd (desta vez - para a versão 3.4.3) para avaliar novamente em detalhes seu potencial no campo da confiabilidade e segurança.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descobrimos que a operação com pares de "valor-chave" é estritamente serializável e que os processos do observador </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(relógios)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entregam todas as alterações na chave de ordem. </font><font style="vertical-align: inherit;">No entanto, os </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueios</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no etcd são fundamentalmente inseguros e os riscos associados a eles são exacerbados por um bug, como resultado da qual a relevância da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concessão</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não é verificada </font><font style="vertical-align: inherit;">após a espera do bloqueio. </font><font style="vertical-align: inherit;">Você pode ler o comentário dos desenvolvedores etcd em nosso relatório </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no blog do projeto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O estudo foi patrocinado pela </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud Native Computing Foundation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (CNCF), parte da Linux Foundation. </font><font style="vertical-align: inherit;">Foi realizado em total conformidade com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as políticas éticas da Jepsen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Fundo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O repositório Etc KV é um sistema distribuído projetado para ser usado como base de coordenação. Como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zookeeper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consul</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o etcd armazena pequenas quantidades de estados raramente atualizados ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por padrão, até 8 GB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) na forma de um mapa de valores-chave e fornece </font><font style="vertical-align: inherit;">leitura, gravação e microtransações </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estritamente serializáveis ​​em</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todo o data warehouse, além de primitivas de coordenação como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueios</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , rastreamento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(relógios)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e seleção de líder. Muitos sistemas distribuídos, como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenStack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , usam o etcd para armazenar metadados de cluster, coordenar visualizações coordenadas de dados, escolher um líder etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2014, já realizamos uma avaliação do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etcd 0.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em seguida, descobrimos que, por padrão, é propenso a leituras obsoletas devido à otimização. Enquanto o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabalho sobre os princípios do Raft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> discute a necessidade de dividir as operações de leitura em threads e passá-las por um sistema de consenso para garantir a viabilidade, o etcd lê qualquer líder localmente, sem verificar se há um estado mais atual no líder mais novo. A equipe de desenvolvimento do etcd implementou o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinalizador de quorum opcional</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, na API da versão 3.0 do etcd </font><font style="vertical-align: inherit;">, a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">linearização</font></a><font style="vertical-align: inherit;"> de todas as operações, exceto as operações de rastreamento, </font><font style="vertical-align: inherit;">apareceu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por padrão</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
A API etcd 3.0 concentra-se em um mapa plano KV, onde as chaves e os valores são opacos</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matrizes de bytes </font><i><font style="vertical-align: inherit;">( </font></i><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">opacos</font></a></i><i><font style="vertical-align: inherit;"> )</font></i><font style="vertical-align: inherit;"> . Usando consultas de intervalo, você pode simular chaves hierárquicas. Os usuários podem ler, escrever e excluir chaves, bem como monitorar o fluxo de atualizações para uma única chave ou intervalo de chaves. O kit de ferramentas etcd é complementado por concessões (objetos variáveis ​​com vida útil limitada, que são mantidas no estado ativo por solicitações de pulsação do cliente), bloqueios (objetos nomeados dedicados vinculados a concessões) e a escolha de líderes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na versão 3.0, o etcd oferece uma </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">API transacional</font></a><font style="vertical-align: inherit;"> limitada</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para operações atômicas com muitas chaves. </font><font style="vertical-align: inherit;">Nesse modelo, uma transação é uma expressão condicional com um predicado, uma ramificação verdadeira e uma ramificação falsa. </font><font style="vertical-align: inherit;">Um predicado pode ser uma conjunção de várias comparações de chaves: igualdade ou várias desigualdades, de acordo com versões de uma chave, revisão global etcd ou o valor atual da chave. </font><font style="vertical-align: inherit;">Ramos verdadeiros e falsos podem incluir várias operações de leitura e gravação; </font><font style="vertical-align: inherit;">todos eles são aplicados atomicamente, dependendo do resultado da estimativa do predicado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 Garantias de consistência na documentação</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em outubro de 2019, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> etcd </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">da API</font></a><font style="vertical-align: inherit;"> afirma que "todas as chamadas da API demonstram consistência consistente - a forma mais forte de garantia de consistência disponível em sistemas distribuídos". Não é assim: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consistência consistente é</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estritamente mais fraca que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linearidade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e a linearizabilidade é definitivamente possível em sistemas distribuídos. Além disso, a documentação afirma que "durante a operação de leitura, etcd não garante a transferência do valor [mais recente (medido pelo relógio externo após a conclusão da consulta)] disponível em qualquer membro do cluster". Essa também é uma declaração muito conservadora: se o etcd fornecer linearizabilidade, as operações de leitura sempre serão associadas ao estado confirmado mais recente na ordem de linearização. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A documentação também afirma que o etcd garante </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isolamento serializável</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: todas as operações (mesmo aquelas que afetam várias teclas) são executadas em alguma ordem geral. Os autores descrevem o isolamento serializável como "o nível de isolamento mais forte disponível em sistemas distribuídos". Isso (dependendo do que você quer dizer com "nível de isolamento") também não é verdadeiro; a serialização estrita é mais forte que a serialização simples, enquanto a primeira também é possível em sistemas distribuídos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A documentação diz que todas as operações (exceto rastreamento) no etcd são linearizáveis ​​por padrão. Nesse caso, linearizabilidade é definida como consistência com relógios globais fracamente sincronizados. Note-se que essa definição não é apenas incompatível com a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definição de linearizabilidade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herlihy &amp; Wing, mas também implica uma violação da causalidade: os nós com horário de expediente tentarão ler os resultados das operações que nem sequer começaram. Assumimos que o etcd ainda não é uma máquina do tempo e, como é baseado no algoritmo Raft, a definição geralmente aceita de linearizabilidade deve ser aplicada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como as operações KV no etcd são serializáveis ​​e linearizáveis, acreditamos que o etcd fornece </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serialização estrita</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por padrão </font><font style="vertical-align: inherit;">. Isso faz sentido, uma vez que todas as chaves etcd estão em uma única máquina de estado, e o Raft fornece a ordem completa de todas as operações nessa máquina de estado. De fato, todo o conjunto de dados etcd é um único objeto linearizável. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinalizador opcional </font></font><code>serializable</code> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diminui</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nível de operações de leitura da consistência serializável estrita para regular, permitindo a leitura de um estado confirmado desatualizado. </font><font style="vertical-align: inherit;">Observe que a bandeira </font></font><code>serializable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não afeta a serialização da história; </font><font style="vertical-align: inherit;">As operações KV etcd são serializáveis ​​em todos os casos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Desenvolvimento de Teste</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para criar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um conjunto de testes,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usamos a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">biblioteca Jepsen</font></a><font style="vertical-align: inherit;"> apropriada</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A versão etcd 3.4.3 (a mais recente em outubro de 19) foi analisada, trabalhando em clusters Debian Stretch que consistem em 5 nós. Implementamos várias falhas nesses clusters, incluindo partições de rede, isolando nós individuais, particionando o cluster em maioria e minoria, além de partições não transitivas com maioria sobreposta. Eles “derrubaram” e suspenderam subconjuntos aleatórios de nós, e também deliberadamente desabilitaram líderes. Foram introduzidas distorções temporais de várias centenas de segundos, tanto em intervalos de multissegundos quanto em milissegundos ("flicker" rápido). Como o etcd suporta a alteração dinâmica do número de componentes, adicionamos e removemos aleatoriamente nós durante o teste.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As cargas de teste incluíam registros, conjuntos e testes transacionais para operações de verificação em KV, bem como cargas especializadas para bloqueios e relógios.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 Registros</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para avaliar a confiabilidade do etcd durante as operações de KV, foi desenvolvido um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teste de registro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durante o qual as </font><font style="vertical-align: inherit;">operações </font><font style="vertical-align: inherit;">aleatórias de leitura, gravação, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparação e configuração</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foram realizadas </font><font style="vertical-align: inherit;">nas teclas da unidade. </font><font style="vertical-align: inherit;">Os resultados foram </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avaliados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando a </font><font style="vertical-align: inherit;">ferramenta de linearização </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Knossos</font></a><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">usando o modelo de registro de comparação / instalação e informações sobre a versão.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 Conjuntos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para quantificar leituras obsoletas, foi desenvolvido um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que usou uma transação de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparar e definir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ler um conjunto de números inteiros de uma única chave e, em seguida, adicionar um valor a esse conjunto. </font><font style="vertical-align: inherit;">Durante o teste, também fizemos uma leitura paralela de todo o conjunto. </font><font style="vertical-align: inherit;">Após a conclusão do teste, os resultados foram analisados ​​para a ocorrência de casos em que o elemento, que se sabia </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> presente no conjunto, estava ausente nos resultados da leitura. </font><font style="vertical-align: inherit;">Esses casos foram usados ​​para quantificar leituras obsoletas e atualizações perdidas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 Anexar teste</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar a serialização estrita, um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teste de acréscimo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi desenvolvido </font><font style="vertical-align: inherit;">durante o qual as transações eram lidas em paralelo e adicionavam valores a listas que consistiam em conjuntos únicos de números inteiros. Cada lista foi armazenada em uma chave etcd, e foram feitas adições em cada transação, lendo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cada chave que precisava ser alterada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em uma transação e, em seguida, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essas chaves foram gravadas e as leituras foram executadas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na segunda transação, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protegida</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para garantir que nenhuma chave gravada tenha sido alterada desde a primeira leitura. </font><font style="vertical-align: inherit;">No final do teste, plotamos o relacionamento entre transações com base na prioridade em tempo real e o relacionamento das operações de leitura e adição. </font><font style="vertical-align: inherit;">A verificação deste gráfico em busca de loops tornou possível determinar se as operações eram estritamente serializáveis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto o etcd impede que as transações gravem a mesma chave várias vezes, você pode criar transações com até um registro por chave. </font><font style="vertical-align: inherit;">Também garantimos que as operações de leitura dentro da mesma transação refletissem operações de gravação anteriores da mesma transação.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4 Fechaduras</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como um serviço de coordenação, o etcd promete </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suporte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interno </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">para bloqueio distribuído</font></a><font style="vertical-align: inherit;"> . Investigamos esses bloqueios de duas maneiras. Inicialmente, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geradas </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">solicitações aleatórias de bloqueio e desbloqueio</font></a><font style="vertical-align: inherit;"> , recebendo uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concessão para cada bloqueio e deixando-o aberto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando o cliente </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">etc</font></a><font style="vertical-align: inherit;"> embutido no cliente Java </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code> keepalive</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">até o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lançamento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Testamos os resultados com o Knossos para verificar se eles formam uma implementação linearizada do serviço de bloqueio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para um teste mais prático (e para quantificar a frequência de falhas de bloqueio), usamos bloqueios e etcd para organizar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a exclusão mútua ao fazer atualizações para o conjunto na memória</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e procurou por atualizações perdidas neste conjunto. </font><font style="vertical-align: inherit;">Este teste nos permitiu confirmar diretamente se os sistemas que usam o etcd como mutex podem atualizar com segurança o estado interno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A terceira versão do teste de bloqueio envolvia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proteções na chave de concessão</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para modificar o conjunto armazenado no etcd.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5 Rastreamento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar se os relógios fornecem informações sobre cada atualização de chave, uma chave foi criada como parte do teste e </font><font style="vertical-align: inherit;">valores inteiros exclusivos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atribuídos às cegas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Enquanto isso, os clientes compartilhavam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essa chave</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por vários segundos por vez. </font><font style="vertical-align: inherit;">Cada vez após o início do relógio, o cliente começou com a revisão em que havia parado da última vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final deste processo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">garantimos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que cada cliente observasse a mesma sequência de alterações importantes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Resultados</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 Rastreamento a partir da 0ª revisão</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao rastrear uma chave, os clientes podem especificar uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revisão inicial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que é "uma revisão opcional com a qual o rastreamento inicia (inclusive)". Se o usuário quiser ver cada operação com uma determinada chave, ele poderá especificar a primeira revisão do etcd. O que é essa auditoria? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O modelo de dados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">glossário</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não fornecem uma resposta para esta pergunta; as revisões são descritas como monotonicamente aumentando os contadores de 64 bits, mas não está claro se o etcd inicia de 0 ou 1. É razoável supor que a contagem regressiva é do zero (apenas no caso). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, isso está errado. Solicitar a 0ª revisão faz com que o etcd comece a transmitir atualizações, começando com a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revisão atual no servidor mais uma</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas não com o primeiro. </font><font style="vertical-align: inherit;">A solicitação para a 1ª revisão fornece todas as alterações. </font><font style="vertical-align: inherit;">Esse comportamento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> está </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">documentado em nenhum lugar</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acreditamos que, na prática, é improvável que essa sutileza leve a problemas na produção, uma vez que a maioria dos clusters não permanece na primeira revisão. </font><font style="vertical-align: inherit;">Além disso, o etcd comprime a história de qualquer maneira ao longo do tempo, portanto, em aplicativos do mundo real, provavelmente, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em qualquer caso,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não é necessário ler todas as versões, começando com a 1ª revisão. </font><font style="vertical-align: inherit;">Esse comportamento é justificado, mas não prejudicaria a descrição correspondente na documentação.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 Fechaduras míticas</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A documentação da API para bloqueios</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> afirma que uma chave bloqueada "pode ​​ser usada em conjunto com transações para garantir que as atualizações no etcd ocorram somente quando o bloqueio for de propriedade". Estranho, mas não fornece nenhuma garantia para os bloqueios e seu objetivo não é explicado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, em outros materiais, os mantenedores etcd ainda compartilham informações sobre o uso de bloqueios. Por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o comunicado de lançamento do etcd 3.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descreve um aplicativo </font></font><code>etcdctl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para bloquear alterações no compartilhamento de arquivos em um disco. Além disso, em um problema no GitHub com uma pergunta sobre a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finalidade específica dos bloqueios,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um dos desenvolvedores do etcd respondeu ao seguinte:</font></font><br>
<br>
<blockquote>     etcd  ,   (  )        ,     (        etcd), - :<br>
<br>
<ol>
<li>    etcd;</li>
<li>  - ( ,     etcd);</li>
<li>    .</li>
</ol></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apenas um exemplo é dado em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>  etcdctl</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: um bloqueio foi usado para proteger a equipe </font></font><code>put</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas não vinculou a chave de bloqueio à atualização. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, isso não é seguro, pois permite que vários clientes mantenham o mesmo bloqueio simultaneamente. O problema é agravado pela suspensão de processos, falhas de rede ou partições, no entanto, também pode ocorrer em clusters completamente íntegros, sem falhas externas. Por exemplo, nesta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">execução de teste, o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> processo número 3 define com êxito o bloqueio e o processo 1 obtém o mesmo bloqueio em paralelo, mesmo antes que o processo 3 tenha a oportunidade de removê-lo:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/hy/lz/kohylznbfb8bh5a2m1l88kysrg4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A violação do mutex foi mais perceptível em concessões com TTLs curtos: TTLs de 1, 2 e 3 segundos não foram capazes de fornecer exclusão mútua após apenas alguns minutos de teste (mesmo em clusters saudáveis). Suspensões de processo e partições de rede levaram a problemas ainda mais rapidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em uma de nossas variantes de teste de bloqueio, mutexes etcd foram usados ​​para proteger atualizações conjuntas de um conjunto de números inteiros (como sugere a documentação etcd). Cada atualização lê o valor atual da amostra na memória e, após cerca de um segundo, grava essa coleção novamente com a adição de um elemento exclusivo. Com concessões com TTL de dois segundos, cinco processos paralelos e uma pausa de processo a cada cinco segundos, conseguimos causar uma perda constante de cerca de 18% das atualizações confirmadas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse problema foi agravado pelo mecanismo de travamento interno no etcd. Se o cliente aguardou o outro cliente desbloqueá-lo, perdeu a concessão e depois que o bloqueio foi liberado, o servidor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não verificou novamente o contrato</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para garantir que ele ainda é válido antes de informar ao cliente que o bloqueio está por trás dele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A inclusão de uma verificação adicional de concessão, bem como a seleção de TTLs mais longos e a definição cuidadosa dos </font><font style="vertical-align: inherit;">tempos limite </font><font style="vertical-align: inherit;">das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eleições</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reduzirão a frequência desse problema. No entanto, as violações de mutex não podem ser completamente eliminadas, pois os bloqueios distribuídos são fundamentalmente inseguros em sistemas assíncronos. O Dr. Martin Kleppmann descreve isso de maneira convincente em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seu artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre bloqueios distribuídos. Segundo ele, os serviços de bloqueio devem sacrificar a correção para manter a viabilidade em sistemas assíncronos: se o processo travar ao controlar o bloqueio, o serviço de bloqueio precisará de alguma maneira para forçar o desbloqueio. No entanto, se o processo realmente não cair, mas simplesmente executar lentamente ou estiver temporariamente indisponível, desbloqueá-lo pode causar a retenção em vários locais ao mesmo tempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas mesmo que o serviço de bloqueio distribuído use, digamos, algum tipo de detector de falha mágica e possa realmente garantir exclusão mútua, no caso de algum recurso não local, seu uso ainda será inseguro. Suponha que o processo A envie uma mensagem para o banco de dados D enquanto mantém um cadeado. Depois disso, o processo A trava e o processo B recebe um bloqueio e também envia uma mensagem para a base D. O problema é que uma mensagem do processo A (devido à assincronia) pode vir após uma mensagem do processo B, violando a exceção mútua que o bloqueio deveria fornecer. . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar esse problema, é necessário confiar no fato de que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o próprio sistema de armazenamento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oferecerá suporte à correção das transações ou, se o serviço de bloqueio fornecer esse mecanismo, use</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font><font style="vertical-align: inherit;">token </font><font style="vertical-align: inherit;">" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esgrima"</font></font></i><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que será incluído em todas as operações realizadas pelo detentor da trava. Isso garantirá que nenhuma operação do suporte anterior da trava ocorra repentinamente entre as operações do atual proprietário da trava. Por exemplo, no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serviço de bloqueio gordinho</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do Google </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">,</font></a><font style="vertical-align: inherit;"> esses tokens são chamados </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sequenciadores</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No etcd, você pode usar a revisão da chave de bloqueio como um token de bloqueio ordenado globalmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, as chaves de bloqueio no etcd podem ser usadas para proteger atualizações transacionais no próprio etcd. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificando a versão da chave de bloqueio como parte da transação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, os usuários podem impedir uma transação se o bloqueio não for mais retido (ou seja, a versão da chave de bloqueio for maior que zero). </font><font style="vertical-align: inherit;">Em nossos testes, essa abordagem nos permitiu isolar com êxito as operações de leitura, modificação e gravação nas quais a gravação era a única transação protegida pelo bloqueio. </font><font style="vertical-align: inherit;">Essa abordagem fornece isolamento semelhante aos tokens de barragem, mas (como tokens de barragem) não garante atomicidade: um processo pode travar ou perder um mutex durante uma atualização que consiste em muitas operações, deixando o etcd em um estado logicamente inconsistente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os resultados do trabalho nas questões do projeto:</font></font><br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os relógios que começam na revisão 0 começam mais tarde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - não decididos;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os bloqueios retornam após o bloqueio sem verificar a propriedade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - no mestre;</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os bloqueios não são documentados como inseguros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - não resolvidos.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Discussão</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em nossos testes, o etcd 3.4.3 atendeu às expectativas em relação às operações KV: observamos consistência estritamente serializável de leitura, gravação e até transações com várias chaves, apesar da suspensão de processos, falhas, manipulação do relógio e da rede, além de uma alteração no número de membros do cluster . </font><font style="vertical-align: inherit;">O comportamento estritamente serializável foi implementado por padrão nas operações KV; </font><font style="vertical-align: inherit;">o desempenho das leituras com o </font></font><code>serializable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conjunto de </font><font style="vertical-align: inherit;">sinalizadores </font><font style="vertical-align: inherit;">levou ao aparecimento de leituras obsoletas (conforme descrito na documentação). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Monitore </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(relógios)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para funcionar corretamente - pelo menos nas teclas individuais. </font><font style="vertical-align: inherit;">Até a compactação do histórico destruir os dados antigos, o relógio emitiu com êxito cada atualização de chave.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, os bloqueios no etcd (como todos os bloqueios distribuídos) não fornecem exclusão mútua. Diferentes processos podem manter a trava ao mesmo tempo - mesmo em clusters saudáveis ​​com relógios perfeitamente sincronizados. A documentação com a API de bloqueio não disse nada sobre isso, e os exemplos de bloqueios apresentados não eram seguros. No entanto, alguns dos problemas com os bloqueios tiveram que ocorrer após o lançamento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deste patch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado de nossa colaboração, a equipe etcd fez uma série de alterações na documentação (elas já apareceram no GitHub e serão publicadas em versões futuras do site do projeto). A página da API GitHub Warranties agora declara que, por padrão, o etcd é </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estritamente serializável</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a alegação de que serial e serializável são os níveis mais fortes de consistência disponíveis em sistemas distribuídos foi removida. Com relação às revisões, agora é indicado que o início deve ser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da unidade (1)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , embora a documentação da API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ainda não diga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que uma tentativa de iniciar a partir da 0ª revisão resultará em "eventos de saída que ocorreram após a revisão atual mais 1" em vez do esperado "envio de todos os eventos". A documentação dos problemas de segurança de bloqueio está </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em desenvolvimento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas alterações na documentação, como a descrição do comportamento especial do etcd ao tentar ler, iniciando com uma revisão zero, ainda requerem atenção.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como sempre, enfatizamos que Jepsen prefere uma abordagem experimental à verificação de segurança: podemos confirmar a presença de bugs, mas não a ausência deles. </font><font style="vertical-align: inherit;">Esforços consideráveis ​​estão sendo feitos para encontrar problemas, mas não podemos provar a correção geral do etcd.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1 Recomendações</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você usar bloqueios no etcd, pense se você precisa deles para segurança ou para simplesmente aumentar o desempenho limitando probabilisticamente a simultaneidade. Os bloqueios Etcd podem ser usados ​​para aumentar o desempenho, mas usá-los para fins de segurança pode ser arriscado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em particular, se você usar o bloqueio etcd para proteger um recurso compartilhado, como um arquivo, banco de dados ou serviço, esse recurso deverá garantir a segurança </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bloquear. Uma maneira de conseguir isso é usar um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">token de barragem monótono</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pode ser, por exemplo, uma revisão etcd associada à chave de bloqueio atual. O recurso compartilhado deve garantir que, uma vez que o cliente tenha usado o token</font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para executar alguma operação, qualquer operação com um token </font></font><code>x &lt; y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">será rejeitada. Essa abordagem não garante a atomicidade, mas garante que as operações dentro da estrutura do bloqueio sejam executadas em ordem e não de forma intermitente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suspeitamos que é improvável que usuários comuns encontrem esse problema. Mas se você ainda </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">confiar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na leitura de todas as mudanças de ETCD, começando com a primeira revisão, lembre-se que você precisa para passar 1, não 0 como parâmetro. Nossos experimentos mostram que uma revisão zero neste meio de caso "revisão atual", não "Mais cedo".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, bloqueios e etcd (como todos os bloqueios distribuídos) enganam os usuários: eles podem querer usá-los como bloqueios regulares, mas ficarão muito surpresos quando perceberem que esses bloqueios não fornecem exclusão mútua. </font><font style="vertical-align: inherit;">A documentação da API, as postagens no blog, os problemas no GitHub não dizem nada sobre esse risco. </font><font style="vertical-align: inherit;">Recomendamos que você inclua informações na documentação etcd de que os bloqueios não fornecem exclusão mútua e fornece exemplos de uso de tokens de barrage para atualizar o status de recursos compartilhados em vez de exemplos que podem levar à perda de atualizações.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2 Planos adicionais</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O projeto etcd é considerado estável há vários anos: o algoritmo Raft baseado nele funcionou bem, a API para operações KV é simples e direta. Embora alguns recursos adicionais tenham recebido recentemente uma nova API, sua semântica é relativamente simples. Acreditamos que já estudamos comandos básicos suficientes como </font></font><code>get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>put</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, transações, bloqueio e rastreamento. No entanto, existem outros testes que devem ser realizados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No momento, não realizamos uma avaliação suficientemente detalhada das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclusões.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Pode haver casos de limite associados a versões e revisões, quando objetos são criados e excluídos constantemente. Em testes futuros, pretendemos submeter as operações de remoção a um estudo mais cuidadoso. Também não testamos consultas de intervalo ou operações de rastreamento com várias chaves, embora suspeitemos que suas semânticas sejam semelhantes às operações com chaves únicas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos testes, utilizamos a suspensão de processos, falhas, manipulações com o relógio, a rede foi dividida e a composição do cluster alterada; nos bastidores, havia problemas como danos ao disco e outras </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falhas bizantinas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no nível de um nó. Essas oportunidades podem ser exploradas em pesquisas futuras. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O trabalho foi apoiado pela </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud Native Computing Foundation.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, parte da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux Foundation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e está em conformidade com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as políticas éticas da Jepsen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Queremos agradecer à equipe etcd por sua ajuda, e aos seguintes representantes em particular: Chris Aniszczyk, Gyuho Lee, Xiang Li, Hitoshi Mitake, Jingyi Hu e Brandon Philips.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS do tradutor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leia também no nosso blog:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TiKV - banco de dados de valor-chave distribuído para nuvem nativa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zetcd do CoreOS: substituindo o ZooKeeper por ... storage etcd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KeyDB como um substituto [potencial] para Redis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bancos de dados e Kubernetes (revisão e relatório de vídeo)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt487534/">https://habr.com/ru/post/pt487534/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt487516/index.html">Técnicas e táticas de caça de atacantes usando arquivos de pré-busca</a></li>
<li><a href="../pt487518/index.html">Produtos radioativos. Espectrômetro gama. Parte 2</a></li>
<li><a href="../pt487522/index.html">Nós fazemos o terminal voar (parte 1)</a></li>
<li><a href="../pt487524/index.html">Por que um hackathon de inicialização de hardware precisa</a></li>
<li><a href="../pt487528/index.html">Изменения в пользовательском соглашении и политике конфиденциальности на сервисах Хабра</a></li>
<li><a href="../pt487538/index.html">A .NET Interactive está aqui! | Pré-visualização do .NET Notebooks 2</a></li>
<li><a href="../pt487540/index.html">HighLoad ++, Anastasia Tsymbalyuk, Stanislav Tselovalnikov (Sberbank): como nos tornamos MDA</a></li>
<li><a href="../pt487542/index.html">PRESENT - Criptografia de bloco ultraleve (tradução do PRESENT original: uma cifra de bloco ultraleve)</a></li>
<li><a href="../pt487544/index.html">Documentação do .NET: Novidades de janeiro</a></li>
<li><a href="../pt487548/index.html">Nova experiência: Chamando serviços .NET gRPC de um navegador com gRPC-Web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>