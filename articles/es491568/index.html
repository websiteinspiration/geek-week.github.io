<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèæ‚Äçü§ù‚Äçüßëüèª üê∏ üññüèº Construir un enrutador en SOCKS en una computadora port√°til con Debian 10 üòä üë®‚ÄçüöÄ ü§òüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Durante todo un a√±o (o dos) pospuse la publicaci√≥n de este art√≠culo por la raz√≥n principal: ya he publicado dos art√≠culos en los que describ√≠ el proce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Construir un enrutador en SOCKS en una computadora port√°til con Debian 10</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491568/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante todo un a√±o (o dos) pospuse la publicaci√≥n de este art√≠culo por la raz√≥n principal: ya he publicado dos art√≠culos en los que describ√≠ el proceso de creaci√≥n de un enrutador en SOCKS desde una computadora port√°til normal con Debian.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, desde entonces la versi√≥n estable de Debian se ha actualizado a Buster, un n√∫mero suficiente de personas me ha enviado una solicitud personal para ayudar con la configuraci√≥n, lo que significa que mis art√≠culos anteriores no son exhaustivos. Bueno, yo mismo supuse que los m√©todos descritos en ellos no revelaban completamente todas las complejidades de la configuraci√≥n de Linux para el enrutamiento en SOSKS. Adem√°s, est√°n escritos para Debian Stretch, y despu√©s de actualizar a Buster, en el sistema de inicializaci√≥n systemd, not√© peque√±os cambios en la interacci√≥n de los servicios. S√≠, y en los art√≠culos mismos, no utilic√© systemd-networkd, aunque es el m√°s adecuado para configuraciones de red complejas.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de los cambios anteriores, se agregaron servicios como </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a mi configuraci√≥n </font><font style="vertical-align: inherit;">: un servicio para la virtualizaci√≥n del punto de acceso, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para sincronizar la hora de los clientes de la red local, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para encriptar las conexiones DNS y deshabilitar la publicidad en los clientes de la red local, as√≠ como, como mencion√© anteriormente, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para configurar interfaces de red. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√° el diagrama de bloques m√°s simple de la estructura interna de dicho enrutador. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/eq/_f/gyeq_fcjwxnobupmbqn9b-hwqqk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, les recuerdo cu√°les son los objetivos del ciclo de estos art√≠culos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enrute todas las conexiones del sistema operativo a SOCKS, as√≠ como las conexiones de todos los dispositivos que est√°n en la misma red que la computadora port√°til. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La computadora port√°til en mi caso debe permanecer completamente m√≥vil. </font><font style="vertical-align: inherit;">Es decir, para dar la oportunidad de usar el entorno de escritorio y no estar atado a una ubicaci√≥n f√≠sica.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El √∫ltimo punto implica la conexi√≥n y el enrutamiento solo a trav√©s de la interfaz inal√°mbrica incorporada.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, por supuesto, la creaci√≥n de una gu√≠a exhaustiva, as√≠ como el an√°lisis de tecnolog√≠as apropiadas a lo mejor de mi modesto conocimiento.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que se considerar√° en este art√≠culo:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">git</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : descargue los </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorios de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proyectos tun2socks </font><font style="vertical-align: inherit;">necesarios para enrutar el tr√°fico TCP a SOCKS, y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un script para automatizar la configuraci√≥n de un punto de acceso virtual usando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : crea e instala el servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el sistema </font><font style="vertical-align: inherit;">.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : configura interfaces inal√°mbricas y virtuales, tablas de enrutamiento est√°tico y reenv√≠o de paquetes.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : instala el servicio systemd en el sistema, configura e inicia el punto de acceso virtual.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pasos opcionales:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : instala y configura el servidor para sincronizar la hora en los clientes del punto de acceso virtual.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : encripta las consultas DNS, las </font><b><font style="vertical-align: inherit;">enruta</font></b><font style="vertical-align: inherit;"> a SOCKS y deshabilita los dominios publicitarios para la red local.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© todo esto?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una forma de proteger las conexiones TCP en una red local. La principal ventaja es que todas las conexiones van a SOCKS si no se crea una ruta est√°tica a trav√©s de la puerta de enlace original. Esto significa que no es necesario prescribir la configuraci√≥n del servidor SOCKS a programas individuales o clientes en la red local; todos van a SOCKS de forma predeterminada, ya que es la puerta de enlace predeterminada hasta que especifiquemos lo contrario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, agregamos el segundo enrutador de encriptaci√≥n como una computadora port√°til frente al enrutador original y usamos la conexi√≥n a Internet del enrutador original para las solicitudes SOCKS ya encriptadas de la computadora port√°til, que, a su vez, enruta y encripta las solicitudes de los clientes de la red local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el punto de vista del proveedor, estamos constantemente conectados al mismo servidor con tr√°fico encriptado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consecuencia, todos los dispositivos se conectan al punto de acceso virtual de una computadora port√°til.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de que empieces</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Casi todas las configuraciones est√°n disponibles en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale tun2socks en el sistema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siempre que tenga Internet en su m√°quina, descargue todas las herramientas necesarias.</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br>
<pre><code class="bash hljs">apt install git make cmake</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargue el paquete badvpn</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/ambrop72/badvpn
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carpeta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aparecer√° en su sistema </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Crear una carpeta de compilaci√≥n separada</font></font><br>
<br>
<pre><code class="bash hljs">mkdir badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ve a ella</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Construir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><br>
<br>
<pre><code class="bash hljs">cmake ../badvpn -DBUILD_NOTHING_BY_DEFAULT=1 -DBUILD_TUN2SOCKS=1
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalar en el sistema</font></font><br>
<br>
<pre><code class="bash hljs">make install
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El par√°metro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-DBUILD_NOTHING_BY_DEFAULT =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 deshabilita el ensamblaje de todos los componentes del repositorio de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBUILD_TUN2SOCKS = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> incluye componentes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el ensamblaje </font><font style="vertical-align: inherit;">.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make install</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : instala el binario </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en su sistema en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / local / bin / badvpn-tun2socks.</font></font></i></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar el servicio tun2socks en systemd</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree el archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/tun2socks.service</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el siguiente contenido:</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=SOCKS TCP Relay<font></font>
<font></font>
[Service]<font></font>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/badvpn-tun2socks --tundev tun2socks --netif-ipaddr 172.16.1.1 --netif-netmask 255.255.255.0 --socks-server-addr 127.0.0.1:9050<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--tundev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : acepta el nombre de la interfaz virtual que inicializamos con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--netif-ipaddr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : direcci√≥n de red de los </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "enrutadores" </font><font style="vertical-align: inherit;">a los que est√° conectada la interfaz virtual. </font><font style="vertical-align: inherit;">Es mejor hacer una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subred reservada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> separada </font><font style="vertical-align: inherit;">.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--socks-server-addr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - acepta un socket ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direcci√≥n: puerto del</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> servidor SOCKS).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si su servidor SOCKS requiere autenticaci√≥n, puede especificar los </font><b><font style="vertical-align: inherit;">par√°metros </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--username</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--password</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, registre el servicio</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y enciende</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> tun2socks</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comenzar el servicio, le proporcionaremos una interfaz de red virtual.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir a systemd-networkd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encienda </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deshabilitar los servicios de red actuales.</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">disable</span> networking NetworkManager NetworkManager-wait-online</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkManager-wait-online</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un servicio que espera una conexi√≥n de red en funcionamiento antes de que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contin√∫e iniciando otros servicios dependiendo de la disponibilidad de la red. </font><font style="vertical-align: inherit;">Lo deshabilitamos, ya que cambiamos al sistema anal√≥gico </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos a encenderlo de inmediato:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd-wait-online</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar una interfaz de red inal√°mbrica</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree un archivo de configuraci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para la interfaz de red inal√°mbrica </font></font><code>/etc/systemd/network/25-wlp6s0.network</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=wlp6s0<font></font>
<font></font>
[Network]<font></font>
Address=192.168.1.2/24<font></font>
IPMasquerade=yes<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nombre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el nombre de su interfaz inal√°mbrica. </font><font style="vertical-align: inherit;">Identif√≠quelo con el comando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPMasquerade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una directiva que incluye </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enmascaramiento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y reenv√≠o de paquetes en una interfaz de red.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La direcci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es responsable de asignar una direcci√≥n IP a la interfaz inal√°mbrica. </font><font style="vertical-align: inherit;">Lo especificamos est√°ticamente porque con la directiva equivalente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCP = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crea una puerta de enlace predeterminada en el sistema. </font><font style="vertical-align: inherit;">Luego, todo el tr√°fico pasar√° por la puerta de enlace original, y no a trav√©s de la interfaz virtual futura en una subred excelente. </font><font style="vertical-align: inherit;">Puede verificar la puerta de enlace predeterminada actual con el comando</font></font><pre><code class="bash hljs">ip r</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cree una ruta est√°tica para el servidor remoto SOCKS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si su servidor SOCKS no es local, sino remoto, entonces necesita crear una ruta est√°tica para √©l. </font><font style="vertical-align: inherit;">Para hacer esto, agregue la secci√≥n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruta</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al final del archivo de configuraci√≥n inal√°mbrica que cre√≥ con los siguientes contenidos:</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=0.0.0.0<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gateway</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la puerta de enlace o direcci√≥n predeterminada de su punto de acceso original.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destino</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : direcci√≥n del servidor SOCKS.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure wpa_supplicant para systemd-networkd</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para conectarse a un punto de acceso seguro. </font><font style="vertical-align: inherit;">Cuando intenta "elevar" la interfaz inal√°mbrica, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inicia el servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donde </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombre</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el nombre de la interfaz inal√°mbrica. </font><font style="vertical-align: inherit;">Si no ha utilizado </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> antes de este punto, entonces con seguridad este servicio no est√° disponible en su sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, cr√©elo con el comando:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> wpa_supplicant@wlp6s0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sol√≠a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como el nombre de mi interfaz inal√°mbrica. </font><font style="vertical-align: inherit;">Tu nombre puede ser diferente. </font><font style="vertical-align: inherit;">Puedes averiguarlo por su equipo</font></font><pre><code class="bash hljs">ip l</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, el servicio creado </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se iniciar√° cuando la interfaz inal√°mbrica se "levante", sin embargo, a su vez, buscar√° la configuraci√≥n de SSID y contrase√±a del punto de acceso en el archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / wpa_supplicant / wpa_supplicant-wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por lo tanto, debe crearlo utilizando la utilidad </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_passphrase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, ejecute el comando:</font></font><br>
<br>
<pre><code class="bash hljs">wpa_passphrase SSID password&gt;/etc/wpa_supplicant/wpa_supplicant-wlp6s0.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donde </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el nombre de su punto de acceso, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contrase√±a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la contrase√±a y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el nombre de su interfaz inal√°mbrica.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicializar interfaz virtual para tun2socks</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree un archivo para inicializar una nueva interfaz virtual en el sistema </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.netdev</font></font></i><br>
<br>
<pre><code class="bash hljs">[NetDev]<font></font>
Name=tun2socks<font></font>
Kind=tun<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nombre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el nombre que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> asignar√° a la futura interfaz virtual cuando se inicialice.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tipo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un tipo de interfaz virtual. </font><font style="vertical-align: inherit;">Seg√∫n el nombre del servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puede adivinar que usa una interfaz como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la extensi√≥n de archivo que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usa para inicializar las interfaces de red virtuales. </font><font style="vertical-align: inherit;">La direcci√≥n y otras configuraciones de red para estas interfaces se especifican en </font><font style="vertical-align: inherit;">archivos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree un archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el siguiente contenido:</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=tun2socks<font></font>
<font></font>
[Network]<font></font>
Address=172.16.1.2/24<font></font>
Gateway=172.16.1.1<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nombre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : el nombre de la interfaz virtual que especific√≥ en el </font><font style="vertical-align: inherit;">archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direcci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : direcci√≥n IP que se asignar√° a la interfaz virtual. </font><font style="vertical-align: inherit;">Debe estar en la misma red que la direcci√≥n que especific√≥ en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gateway</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : la direcci√≥n IP de los </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "enrutadores" </font><font style="vertical-align: inherit;">que especific√≥ al crear el servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, la interfaz </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene la direcci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y el servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , es decir, es la puerta de enlace para todas las conexiones desde la interfaz virtual.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar un punto de acceso virtual</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalar las dependencias:</font></font><br>
<br>
<pre><code class="bash hljs">apt install util-linux procps hostapd iw haveged</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargue el repositorio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en su m√°quina:</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/oblique/create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vaya a la carpeta del repositorio en su m√°quina:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalar en el sistema:</font></font><br>
<br>
<pre><code class="bash hljs">make install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuraci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/create_ap.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aparecer√° en su sistema </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Estas son las principales opciones para editar:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GATEWAY = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : es mejor hacer una subred reservada separada.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNS = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - apague, ya que este par√°metro ser√° controlado por la interfaz virtual systemd-networkd.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNSMASQ = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - apague por la misma raz√≥n.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WIFI_IFACE = wlp6s0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : interfaz inal√°mbrica de la computadora port√°til.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERNET_IFACE = tun2socks&gt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : interfaz virtual creada para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID = hostapd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nombre del punto de acceso virtual.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONTRASE√ëA = 12345678</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - contrase√±a.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerde habilitar el servicio:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> create_ap</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habilitar el servidor DHCP en systemd-networkd</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inicializa la interfaz virtual </font><i><font style="vertical-align: inherit;">ap0</font></i><font style="vertical-align: inherit;"> en el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En teor√≠a, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnsmasq se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuelga de esta interfaz </font><font style="vertical-align: inherit;">, pero ¬øpor qu√© instalar servicios adicionales si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contiene un servidor DHCP incorporado? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para habilitarlo, defina la configuraci√≥n de red para el punto virtual. Para hacer esto, cree el archivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-ap0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con los siguientes contenidos:</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=ap0<font></font>
<font></font>
[Network]<font></font>
Address=10.0.0.1/24<font></font>
DHCPServer=yes<font></font>
<font></font>
[DHCPServer]<font></font>
EmitDNS=yes<font></font>
DNS=10.0.0.1<font></font>
EmitNTP=yes<font></font>
NTP=10.0.0.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que el servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sreate_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inicialice la interfaz virtual </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-NetworkD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> asigna autom√°ticamente una direcci√≥n IP y habilita el servidor DHCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las l√≠neas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitDNS = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pasan la configuraci√≥n del servidor DNS a los dispositivos conectados al punto de acceso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si no planea usar un servidor DNS local, en mi caso es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puede configurar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donde </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es la direcci√≥n de su puerta de enlace original. Luego, las consultas DNS de su host y red local no se cifrar√°n a trav√©s de los servidores del proveedor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitNTP = s√≠</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transmiten la configuraci√≥n de NTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo mismo ocurre con la l√≠nea </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar y configurar el servidor NTP</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalar en el sistema:</font></font><br>
<br>
<pre><code class="bash hljs">apt install ntp
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Edite la configuraci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/ntp.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Comente las direcciones de los grupos est√°ndar:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#pool 0.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 1.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 2.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 3.debian.pool.ntp.org iburst</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue las direcciones de servidores p√∫blicos, por ejemplo, Google Public NTP:</font></font><br>
<br>
<pre><code class="bash hljs">server time1.google.com ibrust<font></font>
server time2.google.com ibrust<font></font>
server time3.google.com ibrust<font></font>
server time4.google.com ibrust<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otorgue acceso al servidor a los clientes de su red:</font></font><br>
<br>
<pre><code class="bash hljs">restrict 10.0.0.0 mask 255.255.255.0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Convierta la transmisi√≥n en su red:</font></font><br>
<br>
<pre><code class="bash hljs">broadcast 10.0.0.255
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, agregue las direcciones de estos servidores a la tabla de enrutamiento est√°tico. </font><font style="vertical-align: inherit;">Para hacer esto, abra el archivo de configuraci√≥n inal√°mbrica </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-wlp6s0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y agregue la secci√≥n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruta</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al final </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.0<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.4<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.8<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.12</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede encontrar las direcciones de sus servidores NTP utilizando la utilidad </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">host de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la </font><font style="vertical-align: inherit;">siguiente manera:</font></font><br>
<br>
<pre><code class="bash hljs">host time1.google.com</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , elimine anuncios y oculte el tr√°fico DNS del proveedor</font></font></h2><br>
<pre><code class="bash hljs">apt install dnscrypt-proxy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para atender las consultas DNS del host y la red local, edite el socket </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/lib/systemd/system/dnscrypt-proxy.socket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cambia las siguientes l√≠neas:</font></font><br>
<br>
<pre><code class="bash hljs">ListenStream=0.0.0.0:53<font></font>
ListenDatagram=0.0.0.0:53</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reiniciar </font></font><code>systemd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Edite la configuraci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/dnscrypt-proxy/dnscrypt-proxy.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">server_names = [<span class="hljs-string">'adguard-dns'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para enrutar conexiones dnscrypt-proxy a trav√©s de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , agregue a continuaci√≥n:</font></font><br>
<br>
<pre><code class="bash hljs">force_tcp = <span class="hljs-literal">true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Edite la configuraci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/resolv.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le dice al servidor DNS al host.</font></font><br>
<br>
<pre><code class="bash hljs">nameserver 127.0.0.1<font></font>
nameserver 192.168.1.1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera l√≠nea incluye el uso de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la segunda usa la puerta de enlace original, en caso de que el servidor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font><font style="vertical-align: inherit;">est√© </font><font style="vertical-align: inherit;">disponible.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Hecho!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reinicie o detenga los servicios de red existentes:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl stop networking NetworkManager NetworkManager-wait-online</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y reinicie todos los necesarios:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart systemd-networkd tun2socks create_ap dnscrypt-proxy ntp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de reiniciar o reiniciar, tendr√° un segundo punto de acceso que enruta el host y los dispositivos LAN a SOCKS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve la salida.</font></font><pre><code class="bash hljs">ip a</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> port√°til normal:</font></font><br>
<br>
<pre><code class="bash hljs">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<font></font>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<font></font>
    inet 127.0.0.1/8 scope host lo<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 ::1/128 scope host <font></font>
       valid_lft forever preferred_lft forever<font></font>
2: tun2socks: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 500<font></font>
    link/none <font></font>
    inet 172.16.1.2/24 brd 172.16.1.255 scope global tun2socks<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::122b:260:6590:1b0e/64 scope link stable-privacy <font></font>
       valid_lft forever preferred_lft forever<font></font>
3: enp4s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000<font></font>
    link/ether e8:11:32:0e:01:50 brd ff:ff:ff:ff:ff:ff<font></font>
4: wlp6s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:85 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 192.168.1.2/24 brd 192.168.1.255 scope global wlp6s0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf85/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
5: ap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:86 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 10.0.0.1/24 brd 10.0.0.255 scope global ap0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf86/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalmente</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proveedor solo ve la conexi√≥n cifrada a su servidor SOCKS, lo que significa que no ve nada.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y, sin embargo, ve sus solicitudes NTP, para evitar esto, elimine las rutas est√°ticas para los servidores NTP. </font><font style="vertical-align: inherit;">Sin embargo, no es un hecho que su servidor SOCKS permita NTP.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muleta vista en Debain 10</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si intenta reiniciar el servicio de red desde la consola, fallar√° con un error. </font><font style="vertical-align: inherit;">Esto se debe al hecho de que parte de ella en forma de interfaz virtual est√° vinculada al servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que significa que se utiliza. </font><font style="vertical-align: inherit;">Para reiniciar el servicio de red, primero debe detener el servicio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pero, creo, si lees hasta el final, ¬°para ti definitivamente no es un problema!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referencias</font></font></h4><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enrutamiento est√°tico en Linux - IBM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd.service - Freedesktop.org</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tun2socks ambrop72 / badvpn wiki github</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oblicuo / create_ap: este script crea un punto de acceso WiFi NATed o Bridged.</font></font></a><br>
 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy 2: un proxy DNS flexible, compatible con protocolos DNS cifrados.</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es491558/index.html">Encuentra m√°s huevos de Pascua: desde mensajes misteriosos hasta llamadas para lavarte las manos y hacer tu tarea</a></li>
<li><a href="../es491560/index.html">¬øC√≥mo hacer que la terminal sea tu asistente, no un enemigo?</a></li>
<li><a href="../es491562/index.html">FOSS News No. 6 - revisi√≥n de noticias gratuitas y de c√≥digo abierto del 2 al 8 de marzo de 2020</a></li>
<li><a href="../es491564/index.html">Java 14: Record, una instancia m√°s concisa de, jpackage wrapper, switch lambdas y bloques de texto</a></li>
<li><a href="../es491566/index.html">Aprendizaje autom√°tico en lenguaje R usando el paquete mlr3</a></li>
<li><a href="../es491572/index.html">El resumen de materiales frescos del mundo de la interfaz para la √∫ltima semana No. 405 (2 al 8 de marzo de 2020)</a></li>
<li><a href="../es491574/index.html">Un truco simple para manejar la procrastinaci√≥n</a></li>
<li><a href="../es491576/index.html">Transformadores como redes neuronales gr√°ficas</a></li>
<li><a href="../es491584/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 336 (del 2 al 9 de marzo)</a></li>
<li><a href="../es491586/index.html">Hack The Box. Tutorial Bankrobber. XSS, inyecci√≥n SQL, CSRF, reenv√≠o de puertos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>