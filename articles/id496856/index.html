<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚰️ 🛐 💕 Rumah pintar tanpa remote, tetapi dengan kubus 🔗 ♥️ 🌹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Masalah
 
 

Selama perbaikan apartemen baru, saya kembali ke apartemen di mana saya tidak tinggal selama 10 tahun dan memutuskan untuk mempraktikkan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rumah pintar tanpa remote, tetapi dengan kubus</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496856/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah</font></font></h3><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f01/d76/558/f01d76558d836eb09b9838514b61dc61.jpg"></div><br>
 <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selama perbaikan apartemen baru, saya kembali ke apartemen di mana saya tidak tinggal selama 10 tahun dan memutuskan untuk mempraktikkan disiplin "Rumah Pintar" untuk melengkapi apartemen baru dengan pengetahuan tentang masalah tersebut. Peralatan di apartemen ini juga bukan yang paling cerdas dan bukan yang terbaru, karena diproduksi ~ 10 tahun yang lalu. Terutama di apartemen saya terganggu oleh banyaknya remote inframerah, mereka hilang dan mengisi otak dengan pilihan yang tepat. Sampai baru-baru ini, diputuskan untuk membuat sejumlah besar tombol yang tidak digunakan pada kendali jarak jauh. Dan konsol tidak estetika atau higienis, beberapa sudut, yang lain dengan tepi bulat, tombol menguning, dan sisa-sisa kehidupan penduduk di mana "biocenosis sub-tombol" terbentuk menumpuk di dalamnya. Akibatnya, selusin remote tersebar di sekitar rumah dengan banyak tombol yang tidak perlu, untuk operasi sederhana saya harus mencari dua atau tiga bagian, tampilan mereka menggaruk mata saya,Saya menginginkan sentuhan suara yang nyaman dan modis.</font></font></p><a name="habracut"></a><br>
<h3></h3><br>
 <p>          ,         .             .     xiaomi          Xiaomi universal IR remotecontroller  Xiaomi Mi Smart Home Magic Cube,         Xiaomi smart home gateway 2</p><br>
<img src="https://habrastorage.org/getpro/habr/post_images/99d/4d4/062/99d4d4062e0b4e751d8cbd5daee9c4e7.jpg" width="300"><br>
<br>
<h3></h3><br>
 <p>    ,  ,   IR ,    — ZigBee .  ,  , .</p> <br>
 <p>      ,      ,       xiaomi,  ,              Mi Home    “”.   ,           ,   .   ,                   .   ,                  ,    ( )      Mi Home 10        5    ,    30     10 ,       ,  ,    1      ,   .   ,   ...</p><br>
 <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah dari Cina tidak datang sendiri, kecuali untuk menggosok rem telah menjadi ketidakmampuan untuk memasang smart cube ke kontrol suara.</font></font></p> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubus dikendalikan oleh gerakan: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengguncang</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pindah di pesawat</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Putar 90/180 derajat di sekitar sumbu horizontal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Putar di sekitar sumbu vertikal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan sebagainya...</font></font></li>
</ul><br>
<img src="https://habrastorage.org/getpro/habr/post_images/04c/7f1/589/04c7f1589de5ab65448e3a5851900c42.png" width="500"><br>
<br>
<p>   —    ,    ,   ,             ,        ,   90     —    10 ,   45    —    5 .             ,      —       ZigBee,  -   ,     3     .</p><br>
<p>             Home Assistant,   ,   ,   Xiaomi    ,               ZigBee . Security token    IR            ,      Mi Home       .  xiaomi gateway   ,     UART RX/TX             Home Assistant.</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Home Assistant sendiri perlu diluncurkan di suatu tempat, Synology DS718 + muncul di bawah tugas ini, yang digunakan sebagai pusat media DLNA dan unduhan torrent. </font><font style="vertical-align: inherit;">Perangkat ini dapat menjalankan wadah Docker, dan sebuah wadah dengan Home Assistant dengan mudah berakhir di dalamnya. </font><font style="vertical-align: inherit;">Home Assistant itu keren, tapi tidak seperti Mi Home, Anda harus menulis semua kecerdasan sebuah rumah di dalamnya dengan pena di yaml. </font><font style="vertical-align: inherit;">Setelah menguasai DSL, Asisten Rumah mengerti dan meludah dari alat pemrograman lain yang tidak memerlukan pengetahuan tentang PL, saya berhasil memasak kruk dari bentuk yang diinginkan.</font></font></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode Otomatisasi:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- id: volume_up</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  alias: Volume naik</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  pelatuk:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - event_data:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      action_type: rotate</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      entitas_id: binary_sensor.cube_0000000103ec74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    event_type: xiaomi_aqara.cube_action</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    platform: acara</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  kondisi:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    kondisi: template</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    value_template: "{{trigger.event.data.action_value&gt; 0}}"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  tindakan:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - service_template: "script.bbk_vol_up _ {{(trigger.event.data.action_value / 3) | int}}"</font></font></pre></blockquote><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otomatisasi ini menangkap peristiwa rotasi searah jarum jam dan memanggil skrip yang namanya jumlah sinyal peningkatan suara yang harus dikirim oleh pemancar inframerah diganti. </font><font style="vertical-align: inherit;">Seperti yang mungkin Anda tebak, setiap sudut rotasi memerlukan skrip sendiri, salin-tempel dipanggil untuk membuatnya, dan memberi saya 20 skrip seperti ini:</font></font></p><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bbk_vol_up_10:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  urutan:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - data:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      perintah:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      - bbk_vol_up</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      delay_secs: 0,04</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      num_repeats: 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    entitas_id: remote.xiaomi_miio_192_168_2_62</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    layanan: remote.send_command</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi emitor dengan sinyal yang dicegat dari panel speaker terlihat seperti ini:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terpencil:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - platform: xiaomi_miio</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    host: 192.168.2.62</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    token: 392cbed325e862ffff983c4575b7a6f2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    perintah:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      bbk_power:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        perintah: mentah: nE5m0wlk0msxmEsmszmEsm0wAHKaABkAoQAcAL1MZtOQEFmM3ARMCHwCymM2m4ENgXEAioHlgy + AwoL3gvYAh4L0gGGEBYLCAL0BR4CHhU4A + ww</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      bbk_vol_up:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        perintah: mentah: nMwmUwlk0mk1mEsms3ADKbABlM5hLJtMAD2ALKazkAdgAymM3AYMBApjNgKTmgGLABuBD4IaAEKA1YJrgyuBDwJvgZeEx4C / geHMZxxxx</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      bbk_vol_down:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        perintah: mentah: nE5m0wlk0msxmEsmszmEsm0wAHKaABkAoQAcAL1MZtOQEFmM3ARMCHwIfAdQBFZuAQYFfAfuBCoHngveEx4C / gL + Cj4R2ANfLJqAYU</font></font></pre><br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hore! </font><font style="vertical-align: inherit;">Suara mengontrol putaran kubus di sekitar sumbu vertikal, dan TV dan speaker dihidupkan dengan memutar kubus 90 derajat di sekitar sumbu horizontal.</font></font><br>
<br>
<p> Home Assistant  ,        , Google Assistant   Home Assistant,     . GA     ,   .       ,           .        Ethernet ,        ,      IP       ,  IP     —  ,   .        custom_component  Home Assistant:</p><br>
<blockquote><pre>import logging<font></font>
from homeassistant.helpers.entity import Entity<font></font>
from pythonping import ping<font></font>
<font></font>
logger = logging.getLogger(__name__)<font></font>
<font></font>
def setup_platform(hass, config, add_entities, discovery_info=None):<font></font>
    entities = []<font></font>
    for name, ip in config['hosts'].items():<font></font>
        entities.append(IPSensor(name, ip))<font></font>
<font></font>
    add_entities(entities)<font></font>
<font></font>
class IPSensor(Entity):<font></font>
    def __init__(self, name, ip):<font></font>
        self._name = name<font></font>
        self._ip = ip<font></font>
        self._state = None<font></font>
        self._is_on = None<font></font>
<font></font>
    @property<font></font>
    def name(self):<font></font>
        return self._name<font></font>
<font></font>
    @property<font></font>
    def state(self):<font></font>
        return self._state<font></font>
<font></font>
    @property<font></font>
    def state_attributes(self):<font></font>
        return {'ip_address': self._ip}<font></font>
<font></font>
    @property<font></font>
    def device_class(self):<font></font>
        return 'connectivity'<font></font>
<font></font>
    @property<font></font>
    def is_on(self):<font></font>
        return self._is_on<font></font>
<font></font>
    def update(self):<font></font>
        result = ping(self._ip, count=1, timeout=0.1)<font></font>
        self._is_on = result.success()<font></font>
        self._state = 'on' if result.success() else ‘off'</pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian hubungkan pemancar inframerah dengan sensor ke sakelar seperti ini:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beralih:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  - platform: template</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    sakelar:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      toshiba_tv:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        value_template: "{{is_state ('binary_sensor.toshiba_tv', 'on')}}"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        nyalakan:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          layanan: script.toshiba_power</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        matikan:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          layanan: script.toshiba_power</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan saklar semacam itu mulai ditampilkan di Google Home dan dikendalikan dari suara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Latihan PS dengan rumah pintar berhasil, pergi untuk membeli perangkat baru! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPS A ZigBee hub sekarang karena alasan tertentu menerangi lorong ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dulu</font></font></h4><br>
<img src="https://habrastorage.org/webt/da/tl/lf/datllfwsuxaymb2ambzwp-20faq.jpeg" width="300"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telah menjadi</font></font></h4><br>
<img src="https://habrastorage.org/webt/co/bo/ly/cobolyyfof7zpaqji3wfgx0dkfw.jpeg" width="300"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id496842/index.html">Model epidemi sederhana dengan alat Python dasar</a></li>
<li><a href="../id496846/index.html">Mekanika bahasa tumpukan dan pointer</a></li>
<li><a href="../id496848/index.html">Intisari materi menarik untuk pengembang seluler # 340 (pada 6 - 12 April)</a></li>
<li><a href="../id496850/index.html">Plugin Maven untuk JPackage dari Java 14</a></li>
<li><a href="../id496852/index.html">Penyortiran halus</a></li>
<li><a href="../id496858/index.html">Berita FOSS No. 11 - ulasan perangkat lunak bebas dan sumber terbuka untuk 6-12 April 2020</a></li>
<li><a href="../id496860/index.html">DI Pertama: DI Pertama di Antarmuka untuk Aplikasi Script</a></li>
<li><a href="../id496862/index.html">Tampilan Gelembung Arduino</a></li>
<li><a href="../id496868/index.html">Simfoni Ruang Kecil</a></li>
<li><a href="../id496870/index.html">Pemrograman deklaratif Android dari aplikasi client-server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>