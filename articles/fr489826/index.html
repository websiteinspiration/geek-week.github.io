<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍴 🥑 👩‍👩‍👧‍👦 À propos des méthodes mutables d'un objet Math en JavaScript 🏺 👨🏾‍⚕️ 🙎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous publions la traduction d'un article sur les calculs mathématiques en JavaScript, qui est une version écrite de la présentation de so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>À propos des méthodes mutables d'un objet Math en JavaScript</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/489826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aujourd'hui, nous publions la traduction d'un article sur les calculs mathématiques en JavaScript, qui est une version écrite de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">présentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de son auteur sur </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">WaffleJS</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et cette déclaration elle-même était un peu la continuation de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conversation sur Twitter.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c50/bea/705/c50bea705dc18becfec75951a06de4df.jpg"></div></a><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enseignement des mathématiques</font></font></font></i><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intérêt pour les mathématiques</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a commencé avec mon éducation mathématique, dont la réception a été quelque peu retardée. Quand j'ai étudié l'informatique, je pouvais communiquer avec des professeurs de mathématiques de classe mondiale, mais j'ai raté cette occasion. Je n'aimais pas les mathématiques: les sujets étudiés étaient très loin de la pratique. De plus, j'étais déjà déséquilibré par un programme de formation informatique profondément théorique. J'ai alors cru qu'elle était divorcée de la vie et, pour la plupart, je continue de le penser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais maintenant, quelques années après avoir terminé mes études, une soif d'apprendre les mathématiques s'est réveillée en moi. J'ai été inspiré par l'effet que même une petite application des connaissances mathématiques peut avoir sur mon travail et sur mon hobby. Mais je n'avais pas de plan d'étude clair.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puis, en 2012, j'ai trouvé un moyen d'étudier les mathématiques en commençant à travailler sur le projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple Statistics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Depuis lors, j'ai développé et soutenu ce projet. Maintenant, il inclut des implémentations de nombreux algorithmes, il s'est avéré être l'une des </font><font style="vertical-align: inherit;">bibliothèques mathématiques mathématiques </font><font style="vertical-align: inherit;">les plus « </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">étoilées</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ». Et, apparemment, les gens utilisent vraiment cette bibliothèque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais j'ai commencé à travailler en 2012. Si nous parlons de l'évolution de la technologie au cours de cette période, c'était il y a très, très longtemps. Depuis lors, 8 versions LTS de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont été publiées </font><font style="vertical-align: inherit;">. Depuis lors, JavaSript lui-même et les environnements dans lesquels les programmes écrits dans ce langage fonctionnent ont beaucoup changé. En 2012, la bibliothèque React n'existait pas encore, alors le premier commit sur le projet Babel n'était pas encore fait.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d8/832/415/5d8832415ee3bf56c1f3a18e294f39fb.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le passage du temps</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Au fil des ans, j'ai remarqué que mes tests se sont écrasés lors de la mise à jour de Node.js. </font><font style="vertical-align: inherit;">Par exemple, je pourrais avoir quelque chose comme ce test:</font></font><br>
<br>
<pre><code class="javascript hljs">t.equal(ss.gamma(<span class="hljs-number">11.54</span>), <span class="hljs-number">13098426.039156161</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce test fonctionne correctement dans Node.js v10, mais se casse dans Node.js v12. </font><font style="vertical-align: inherit;">Et ici, ce n'est pas une méthode super compliquée qui est testée: la fonction est </font></font><code>gamma</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implémentée à l'aide de fonctions JavaScript standard - </font></font><code>Math.pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.sqrt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Math.sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arithmétique</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je sais à quoi vous pouvez penser ici: l'arithmétique. </font><font style="vertical-align: inherit;">Sur Twitter, des discussions animées éclatent périodiquement en raison des résultats du calcul de l'expression suivante:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span> = <span class="hljs-number">0.30000000000000004</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, comme je l'ai déjà </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">écrit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tous les langages de programmation populaires se comportent de cette façon, même les plus démodés et pédants comme Haskell. </font><font style="vertical-align: inherit;">L'arithmétique en virgule flottante peut sembler étrange, mais ils se comportent de la même manière, leur comportement est bien documenté. </font><font style="vertical-align: inherit;">A savoir, nous parlons de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">norme IEEE 754</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont les exigences sont strictement implémentées dans les langages de programmation. </font><font style="vertical-align: inherit;">Le problème n'est donc pas arithmétique: la mise en œuvre de l'addition, de la soustraction, de la division et de la multiplication dans les langages, la programmation peut être dite «gravée dans la pierre».</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objet mathématique</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mon problème était dans l'objet JavaScript standard </font></font><code>Math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En particulier, dans toutes les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthodes de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cet objet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des techniques telles que </font></font><code>Math.sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.cos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.tan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- sont les ingrédients de </font><font style="vertical-align: inherit;">base pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">géométriques</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> calculs et autres. </font><font style="vertical-align: inherit;">Quand j'ai compris cela, j'ai commencé à étudier séparément les changements dans le comportement des méthodes de base de l'objet </font></font><code>Math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans différentes versions de Node.js. </font><font style="vertical-align: inherit;">Voici quelques exemples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calcul </font></font><code>Math.tanh(0.1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Node 4</span>
<span class="hljs-number">0.09966799462495590234</span>
<span class="hljs-comment">// Node 6</span>
<span class="hljs-number">0.09966799462495581907</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calcul </font></font><code>Math.pow(1/3, 3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Node 10</span>
<span class="hljs-number">0.03703703703703703498</span>
<span class="hljs-comment">// Node 12</span>
<span class="hljs-number">0.03703703703703702804</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pire encore, ce problème n'est pas seulement apparent dans Node.js. </font><font style="vertical-align: inherit;">La même chose se produit dans les navigateurs et dans d'autres environnements qui prennent en charge JavaScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela nous amène à la question suivante: qu'est-ce que le calcul mathématique?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a45/45e/f7c/a4545ef7cf6e282546aee3ea506d762f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Représentation graphique des calculs</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les méthodes trigonométriques sont faciles à visualiser. Si vous avez un seul cercle et plusieurs mois de lycée à votre disposition, alors vous savez que le cosinus et le sinus sont les coordonnées d'un certain point sur le bord du cercle, et que les graphiques des fonctions sin et cos ressemblent à des vagues. En fait, au lycée, ils étudient la dérivation de ces valeurs, mais la méthode utilisée pour cela - la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> série Taylor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - repose sur une série infinie, et il n'est pas facile pour un ordinateur de résoudre de tels problèmes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici ce que vous pouvez apprendre de</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wikipedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concernant l'algorithme de calcul du sinus: «Il n'y a pas d'algorithme standard pour calculer le sinus. IEEE 754-2008, la norme la plus utilisée pour les calculs en virgule flottante, n'affecte pas le calcul des fonctions trigonométriques comme un sinus. " </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les ordinateurs utilisent de nombreuses approximations et algorithmes différents pour effectuer des calculs, quelque chose comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORDIC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , toutes sortes de trucs délicats et de tables de recherche. Toute cette hétérogénéité explique la présence de nombreuses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliothèques fastmath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur GitHub </font><font style="vertical-align: inherit;">. Le fait est qu'il existe de nombreuses façons de mettre en œuvre la méthode </font></font><code>Math.sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Et d'autres fonctions aussi. Par exemple, comme vous le </font><font style="vertical-align: inherit;">savez, Quake III Arena utilisé un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plus rapide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remplacement de la méthode standard de calcul de la racine carrée inverse pour accélérer le rendu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, les calculs mathématiques sont le résultat de la mise en œuvre de certains algorithmes. En pratique, de nombreux algorithmes courants et leurs variantes sont utilisés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La spécification JavaScript, au lieu de spécifier l'algorithme particulier à utiliser dans les implémentations de langage, donne aux implémentations une grande marge de manœuvre en termes de fonctions utilisées dans les calculs mathématiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici ce que dit la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">norme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à ce sujet </font><font style="vertical-align: inherit;">(ECMA-262, 10 édition, section 20.2.2):</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Le comportement des fonctions acos, acosh, asin, asinh, atan, atanh, atan2, cbrt, cos, cosh, exp, expm1, hypot, log, log1p, log2, log10, pow, random, sin, sinh, sqrt, tan et tanh il n'est pas entièrement décrit ici, à l'exception des exigences concernant le retour de certains résultats pour des valeurs spécifiques des arguments, qui sont des cas limites notables. " </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne sais pas comment fonctionnent les activités internes des membres du comité responsable de la norme ECMA-262, mais je pense qu'ils ont élaboré la norme afin qu'il n'y ait pas de crise de compatibilité dans JavaScript si Intel ou AMD émettaient de nouvelles instructions mathématiques ultrarapides dans leurs nouveaux processeurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison du fait qu'il existe de nombreux interpréteurs JavaScript largement utilisés, du fait que JavaScript est souvent utilisé dans les navigateurs, et entre les navigateurs, il y a toujours quelque chose comme la concurrence, et du fait que même les implémentations JavaScript populaires sont sous pression constante et forcé d'évoluer rapidement, offrant les meilleures performances ... à cause de tout cela, nous avons ce que nous avons. </font><font style="vertical-align: inherit;">Quiconque utilise JavaScript rencontrera régulièrement le fait que dans différentes implémentations les résultats des calculs mathématiques effectués au moyen de l'objet </font></font><code>Math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont différents. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas aussi significatif dans d'autres langages interprétés, car ils ont généralement des implémentations «canoniques». </font><font style="vertical-align: inherit;">Par exemple, cela est vrai pour l'interpréteur Python.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Où sont effectués les calculs?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons maintenant de plus près où les calculs sont effectués. </font><font style="vertical-align: inherit;">Dans le cas de JavaScript, il existe trois domaines dans lesquels les calculs mathématiques de base sont effectués:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interpréteur de langage (code C ++ et C d'une implémentation JavaScript spécifique).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code JavaScript, par exemple, code pour les bibliothèques spécialisées.</font></font></li>
</ol><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍1. </font><font style="vertical-align: inherit;">CPU</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première idée qui m'est venue à l'esprit lorsque j'ai pensé aux endroits où les calculs sont effectués était que les calculs sont effectués dans le processeur. J'ai suggéré que puisque les processeurs implémentent des calculs arithmétiques, ils peuvent également implémenter des calculs plus complexes. Il s'est avéré que les processeurs ont des instructions pour effectuer des calculs trigonométriques et autres, mais ces instructions sont rarement utilisées. Par exemple, l'implémentation du calcul du sinus dans les processeurs avec une architecture x86 n'était pas très populaire, car cette implémentation ne s'avère pas nécessairement plus rapide que les implémentations logicielles (celles qui utilisent des opérations arithmétiques de processeur). De plus, il n'est pas nécessairement plus précis que les implémentations logicielles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intel a également subi une honte en raison de la très forte</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">surestimation de la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> précision des opérations trigonométriques dans la documentation. </font><font style="vertical-align: inherit;">De telles erreurs sont particulièrement tragiques du fait qu'une puce, contrairement à un programme, ne peut pas être corrigée.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍2. </font><font style="vertical-align: inherit;">Interprète de langue</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ainsi que les sous-systèmes informatiques fonctionnent dans la plupart des implémentations JavaScript. </font><font style="vertical-align: inherit;">Ils implémentent ces sous-systèmes de différentes manières.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les moteurs V8 et SpiderMonkey utilisent des ports de bibliothèque </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fdlibm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les calculs </font><font style="vertical-align: inherit;">, qui sont légèrement différents. </font><font style="vertical-align: inherit;">Cette bibliothèque, écrite à l'origine chez Sun Microsystems, a été transmise de génération en génération.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScriptCore (Safari) utilise la bibliothèque cmath pour effectuer la plupart des opérations.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer utilise à la fois cmath et certains blocs de code écrits en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assembleur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ici, même des méthodes trigonométriques de processeurs ont été utilisées - dans le cas où le navigateur était compilé pour des processeurs ayant des instructions similaires.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour des raisons historiques, les outils utilisés pour effectuer des calculs dans différents moteurs JS ont changé. </font><font style="vertical-align: inherit;">Ainsi, V8 a utilisé sa propre solution pour les calculs, puis a utilisé le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port JavaScript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fdlibm, puis seulement la version C de fdlibm.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Pourquoi est-ce un problème?</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point ici est que tout cela réduit la capacité de JavaScript à produire des résultats uniformes pour résoudre tous les problèmes impliquant des calculs mathématiques. </font><font style="vertical-align: inherit;">Cela est particulièrement difficile pour la science des données. </font><font style="vertical-align: inherit;">J'aimerais que JavaScript soit mieux adapté pour effectuer des calculs de science des données dans un navigateur. </font><font style="vertical-align: inherit;">De plus, l'incapacité à produire des résultats uniformes entraîne l'aggravation de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la crise de reproductibilité</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , caractéristique de toutes les sciences. </font><font style="vertical-align: inherit;">Cela ne veut pas mentionner certains autres problèmes JavaScript, tels que les fonctionnalités de saisie de nombres et le manque d'une bibliothèque largement utilisée pour travailler avec des trames de données.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍3. </font><font style="vertical-align: inherit;">Utilisation de bibliothèques spécialisées</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un moyen fiable pour nous de faire les calculs en JavaScript. Elle consiste à utiliser des bibliothèques spécialisées. Ainsi, la bibliothèque </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stdlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implémente des calculs de haut niveau en utilisant uniquement des opérations arithmétiques. Les calculs arithmétiques sont entièrement décrits dans les spécifications, ils sont standard, donc les résultats retournés par stdlib nous donnent, quelle que soit la plateforme sur laquelle le code est exécuté, des résultats complètement uniformes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceci est réalisé au prix de la complexité et de la rapidité des décisions. Les méthodes stdlib ne sont pas aussi rapides que les méthodes intégrées. De plus, afin de "simplement compter le sinus", vous devez connecter une bibliothèque entière au projet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, si vous pensez plus largement, c'est tout à fait normal. La plate-forme WebAssembly, par exemple, ne donne au programmeur aucun moyen d'effectuer des calculs mathématiques de haut niveau. Dans la documentation correspondante, il est recommandé d'inclure indépendamment les implémentations des mécanismes correspondants dans vos propres modules: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
«WebAssembly n'inclut pas ses propres implémentations de fonctions mathématiques - comme sin, cos, exp, pow, etc. La stratégie de WebAssembly pour ces fonctions est de permettre aux développeurs de les implémenter en tant qu'outils de bibliothèque dans la plate-forme WebAssembly elle-même (notez que les instructions sin et cos de la plate-forme x86 sont lentes et inexactes, et de nos jours, en tout cas, essayez de ne pas utiliser). "</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ainsi que les langages compilés fonctionnaient toujours: lorsqu'un programme écrit en C est compilé, les méthodes importées de </font></font><code>math.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont incluses dans le programme compilé.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de la valeur epsilon</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si quelqu'un ne souhaite pas inclure la bibliothèque stdlib dans son projet JavaScript pour effectuer des calculs, mais doit tester le code qui effectue des calculs complexes, il devrait probablement recourir à la méthode déjà utilisée dans la bibliothèque de statistiques simples. Il s'agit d'utiliser une valeur </font></font><code>epsilon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui définit les limites dans lesquelles les différences de nombres ne sont pas prises en compte. Si nous considérons les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisation du symbole epsilon en mathématiques, nous pouvons dire que j'en parle comme d'une «petite valeur positive arbitraire». Simple-statistics </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la valeur epsilon d'égale </font></font><code>0.0001</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez besoin de savoir si deux nombres sont égaux, une condition du formulaire est vérifiée</font></font><code>Math.abs(result — expected) &lt; epsilon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si cette condition s'avère être vraie, alors nous pouvons dire que la différence entre les nombres se situe dans la plage donnée et les considérer comme égaux.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouts</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Précision</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les commentateurs sur Twitter ont indiqué que les variations des résultats obtenus dans l'exemple sont en dehors de la plage de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chiffres significatifs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du nombre à virgule flottante. </font><font style="vertical-align: inherit;">D'un point de vue technique, c'est correct, et cela signifie que vous pouvez trouver un moyen plus précis de comparer les nombres que celui qui utilise la valeur </font></font><code>epsilon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais en pratique, la même histoire ici - les chiffres à la fin du nombre affectent le résultat et introduisent des inexactitudes dans le résultat final. </font><font style="vertical-align: inherit;">De plus, les exemples donnés ici ne sont pas exhaustifs. </font><font style="vertical-align: inherit;">Le fait est que les fonctionnalités d'implémentation des interpréteurs JavaScript peuvent, sans s'écarter de la spécification, conduire à l'apparition de différences dans la plupart des résultats numériques.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍JavaScript</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne veux pas critiquer JavaScript. </font><font style="vertical-align: inherit;">Je crois que JavaScript a fait un compromis justifiable, compte tenu de l'incertitude de l'avenir et du nombre de plates-formes sur lesquelles les implémentations de langage sont créées. </font><font style="vertical-align: inherit;">Je dois dire qu'il est très difficile de comparer directement JavaScript et d'autres langages. </font><font style="vertical-align: inherit;">Le point est l'écosystème JavaScript. </font><font style="vertical-align: inherit;">Le fait qu'il existe en même temps de nombreux interprètes de la même langue est totalement atypique pour les autres langues. </font><font style="vertical-align: inherit;">Et cela, en plus, est l'une des principales forces de JavaScript. </font><font style="vertical-align: inherit;">De plus, on ne peut manquer de dire que ce sont des phénomènes d'un plan complètement différent de ceux qui se produisent dans la langue elle-même. </font><font style="vertical-align: inherit;">Et JavaScript change au fil du temps et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beaucoup de bonnes choses y</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apparaissent </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TdStdlib ou epsilon?</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense qu'en pratique, dans la plupart des cas, il vaut la peine d'utiliser l'approche qui implique l'utilisation de la valeur epsilon. </font><font style="vertical-align: inherit;">La bibliothèque stdlib est un merveilleux outil puissant, mais le prix d'inclure une bibliothèque supplémentaire pour les calculs mathématiques dans le projet peut être assez élevé. </font><font style="vertical-align: inherit;">Et dans la plupart des cas, les petites différences dans les résultats des calculs n'ont pas d'importance pour les applications.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je voudrais ici tirer des conclusions de ce qui précède et partager quelques réflexions.</font></font><br>
<br>
<ol>
<li>,     ,   ,    .         .     —    « ». ,   ,   ,   <code>Math.sin</code>   ,   ,      ,      .      ,   ,      ,   ,   ,   .    ,       ,   ,       .</li>
<li>      . ,   ,       Node.js,         ,    ,     simply-statistics.    ,    , ,     ,      .  —    .</li>
<li>  ,    .    V8,      ,   .    ,    .    , ,         ,     .</li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avez-vous rencontré des problèmes concernant les modifications des résultats de calcul lors de la mise à niveau vers de nouvelles versions de Node.js?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489812/index.html">Configurer LDAP dans Oracle BI</a></li>
<li><a href="../fr489818/index.html">JavaScript et plus: 4 approches créatives pour mesurer le temps dans les navigateurs</a></li>
<li><a href="../fr489820/index.html">Styliser le bon vieux bouton</a></li>
<li><a href="../fr489822/index.html">Génération de nombres pseudo-aléatoires à l'aide d'un automate cellulaire: règle 30</a></li>
<li><a href="../fr489824/index.html">7 outils de surveillance de la sécurité du cloud open source à connaître</a></li>
<li><a href="../fr489828/index.html">Travailler avec GeoJSON dans Node.js: une introduction pratique</a></li>
<li><a href="../fr489832/index.html">Perles atomiques artificielles: manipulations avec des macrocycles</a></li>
<li><a href="../fr489834/index.html">Intégrez votre appareil Smart Home dans l'écosystème SmartThings</a></li>
<li><a href="../fr489836/index.html">Lidars du futur: 11 000 lasers au lieu de 128</a></li>
<li><a href="../fr489838/index.html">Fuite de mémoire côté serveur Nuxt à l'aide de SSR (rendu côté serveur)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>