<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♒️ 🎑 😇 Kubernetesの視覚的なトラブルシューティングガイド 💡 🧜🏿 🐭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="注意 ペレフ。：この記事はlearnk8sプロジェクトから無料で入手できる資料の一部であり、Kubernetes企業および個々の管理者との連携方法について説明しています。その中で、プロジェクトマネージャーであるDaniele Polencicは、K8sクラスターで実行されているアプリケーションの一般...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kubernetesの視覚的なトラブルシューティングガイド</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/484954/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意 </font><font style="vertical-align: inherit;">ペレフ。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：この記事は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">learnk8s</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトから無料で入手できる資料の一部であり、</font><font style="vertical-align: inherit;">Kubernetes企業および個々の管理者との連携方法について説明しています。</font><font style="vertical-align: inherit;">その中で、プロジェクトマネージャーであるDaniele Polencicは、K8sクラスターで実行されているアプリケーションの一般的な問題が発生した場合に実行する必要がある手順について視覚的に説明しています。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/ch/5u/xa/ch5uxanj-3ivwqu88swqyoi6bsu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TL、DR：以下は、Kubernetesでのデプロイメントのデバッグに役立つ図です。</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/4r/qp/si/4rqpsie8dnplkqxahaqntpi2ssw.png"></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスター内のエラーを見つけて修正するためのフローチャート。</font><font style="vertical-align: inherit;">オリジナル（英語）では、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PDF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入手できます</font><font style="vertical-align: inherit;">。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションをKubernetesにデプロイする場合、通常は次の3つのコンポーネントを定義する必要があります。</font></font><br>
<br>
<ul>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ポッドと呼ばれるアプリケーションのコピーを作成するためのレシピです。</font></font></li>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ポッド間でトラフィックを分散する内部ロードバランサー。</font></font></li>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingress-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外界からサービスへのトラフィックの流れの説明。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は簡単なグラフィカルな要約です</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。1）Kubernetesでは、アプリケーションは外部と内部の2つのロードバランサーレイヤーを介してトラフィックを受信します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3v/cy/z9/3vcyz9a-2ciiqbh9he7idgvo7uy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2）内部バランサーはサービス、外部-入力と呼ばれます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/23/mn/zc/23mnzcfo_b3niccdivn4bc4vzei.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3）デプロイによりポッドが作成され、監視されます（手動で作成されません）。</font><i><font style="vertical-align: inherit;">Hello Worldのよう</font></i></font><br>
<br>
<img src="https://habrastorage.org/webt/4j/c2/h9/4jc2h9pgzbxmkon4ewkbeuf0vhc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
な単純なアプリケーションをデプロイしたいとします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">YAML構成は次のようになります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment # &lt;&lt;&lt;<font></font>
metadata:<font></font>
  name: my-deployment<font></font>
  labels:<font></font>
    track: canary<font></font>
spec:<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      any-name: my-app<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        any-name: my-app<font></font>
    spec:<font></font>
      containers:<font></font>
      - name: cont1<font></font>
        image: learnk8s/app:1.0.0<font></font>
        ports:<font></font>
        - containerPort: 8080<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: Service # &lt;&lt;&lt;<font></font>
metadata:<font></font>
  name: my-service<font></font>
spec:<font></font>
  ports:<font></font>
  - port: 80<font></font>
    targetPort: 8080<font></font>
  selector:<font></font>
    name: app<font></font>
---<font></font>
apiVersion: networking.k8s.io/v1beta1<font></font>
kind: Ingress # &lt;&lt;&lt;<font></font>
metadata:<font></font>
  name: my-ingress<font></font>
spec:<font></font>
  rules:<font></font>
  - http:<font></font>
    paths:<font></font>
    - backend:<font></font>
        serviceName: app<font></font>
        servicePort: 80<font></font>
      path: /</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
定義は非常に長く、コンポーネントが互いにどのように関連しているかについて混乱するのは簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例えば：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> いつポート80を使用する必要があり、いつ-8080を使用しますか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービスが競合しないように、サービスごとに新しいポートを作成する必要がありますか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラベル名は重要ですか？</font><font style="vertical-align: inherit;">それらはどこでも同じであるべきですか？</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバッグに集中する前に、3つのコンポーネントが互いにどのように関連しているかを思い出してみましょう。</font><font style="vertical-align: inherit;">展開とサービスから始めましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続の配置 'aとサービス' a</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驚かれることでしょうが、デプロイメントとサービスはまったく関係がありません。</font><font style="vertical-align: inherit;">代わりに、サービスはデプロイをバイパスするポッドを直接指します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ポッドとサービスの相互関係に関心があります。</font><font style="vertical-align: inherit;">覚えておくべき3つのこと：</font></font><br>
<br>
<ol>
<li>  (<code>selector</code>)  Service'       Pod'.</li>
<li> <code>targetPort</code>    <code>containerPort</code>   Pod'.</li>
<li> <code>port</code> Service'   .         ,     IP-.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の図は、上記のすべてをグラフィック形式で表しています</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。1）サービスがトラフィックを特定のポッドに転送することを想像してください</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2a/e5/8f/2ae58fcgoi7aifmcr5rl_0bseym.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。2）</font><font style="vertical-align: inherit;">ポッドを</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">ときは</font><font style="vertical-align: inherit;">、ポッド</font></font><code>containerPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内の各コンテナー</font><font style="vertical-align: inherit;">を指定する必要があります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/fa/ow/xcfaowomhbtqhebhodgzhzrkupc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。3）サービスを作成するときは、</font></font><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびを</font><font style="vertical-align: inherit;">指定する必要があります</font></font><code>targetPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、どちらがコンテナに接続していますか？</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/vg/wj/nd/vgwjnde0xyzdblwamomfxjaxb40.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
4）から</font></font><code>targetPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。と一致する必要があり</font></font><code>containerPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q4/yx/qn/q4yxqnkxxilupalikahmqqp09x8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5）コンテナでポート3000が開いている</font></font><code>targetPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とすると</font><font style="vertical-align: inherit;">、値</font><font style="vertical-align: inherit;">は同じになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/tj/-s/cqtj-srznih70qh7bxs3w_l7bis.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
YAMLファイルでは、ラベルと</font></font><code>ports</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>targetPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は一致する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: my-deployment<font></font>
  labels:<font></font>
    track: canary<font></font>
spec:<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      any-name: my-app<font></font>
  template:<font></font>
    metadata:<font></font>
     labels:  # &lt;&lt;&lt;<font></font>
        any-name: my-app  # &lt;&lt;&lt;<font></font>
   spec:<font></font>
      containers:<font></font>
      - name: cont1<font></font>
        image: learnk8s/app:1.0.0<font></font>
        ports:<font></font>
       - containerPort: 8080  # &lt;&lt;&lt;<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  name: my-service<font></font>
spec:<font></font>
  ports:<font></font>
  - port: 80<font></font>
   targetPort: 8080  # &lt;&lt;&lt;<font></font>
 selector:  # &lt;&lt;&lt;<font></font>
    any-name: my-app  # &lt;&lt;&lt;</code></pre><br>
<i><font style="vertical-align: inherit;"></font><code>track: canary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">導入セクションの上部に</font><font style="vertical-align: inherit;">あるラベル</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">どう</font><font style="vertical-align: inherit;">ですか？</font><font style="vertical-align: inherit;">一致する必要がありますか？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このラベルはデプロイメントを示しており、トラフィックをルーティングするサービスでは使用されません。</font><font style="vertical-align: inherit;">つまり、削除するか、別の値を割り当てることができます。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セレクターは</font></font><code>matchLabels</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どうですか？</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドを追跡するためにDeploymentで使用されるため、</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常にポッドのラベルと一致する必要があり</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正しい編集を行ったとします。</font><font style="vertical-align: inherit;">それらを確認するには？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドでポッドのラベルを確認できます。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get pods --show-labels</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または、ポッドが複数のアプリケーションに属している場合：</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get pods --selector any-name=my-app --show-labels</code></pre><br><font style="vertical-align: inherit;"></font><code>any-name=my-app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラベルは</font><font style="vertical-align: inherit;">
どこ</font><font style="vertical-align: inherit;">です</font></font><code>any-name: my-app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題はありますか？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポッドに接続できます！</font><font style="vertical-align: inherit;">これを行うには</font></font><code>port-forward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、kubectlで</font><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">サービスに接続し、接続を確認できます。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl port-forward service/&lt;service name&gt; 3000:80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに：</font></font><br>
<br>
<ul>
<li> <code>service/&lt;service name&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- サービス名; </font><font style="vertical-align: inherit;">私たちの場合はそれ</font></font><code>my-service</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3000-コンピューターで開くポート。</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス</font><font style="vertical-align: inherit;">フィールドで指定された80ポート</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続を確立できた場合、設定は正しいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続を確立できなかった場合は、ラベルに問題があるか、ポートが一致していません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスとイングレスの接続</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションへのアクセスを提供する次のステップは、Ingressの構成に関連しています。</font><font style="vertical-align: inherit;">Ingressはサービスを見つける方法を知っている必要があり、次にポッドを見つけてトラフィックをそれらに転送します。</font><font style="vertical-align: inherit;">Ingressは、名前と開いているポートから目的のサービスを見つけます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IngressとServiceの説明では、2つのパラメーターが一致している必要があります。</font></font><br>
<br>
<ol>
<li> <code>servicePort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingress </font></font><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はService </font><font style="vertical-align: inherit;">のパラメーター</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">一致する必要があります</font><font style="vertical-align: inherit;">。</font></font></li>
<li> <code>serviceName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingressは</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service </font><font style="vertical-align: inherit;">のフィールド</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">一致する必要</font><font style="vertical-align: inherit;">があります。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の図は、ポートの接続を要約したもの：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1）あなたはすでに知っているように、サービスは、特定の1を聴いている</font></font><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9q/t0/fz/9qt0fzsyme9mnrd4ki07ezamnkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）2イングレスと呼ばれるパラメータがある</font></font><code>servicePort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rn/du/yw/rnduyw4xvfmpjmhup8fy9ao2d1a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3）このパラメータ（</font></font><code>servicePort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は常に一致している必要があります</font></font><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスの定義：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1d/ap/ty/1daptyulxphnbb2dt6uben-lnzk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスが指定されている場合）4をポート80の</font></font><code>servicePort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、80に等しいことも</font><font style="vertical-align: inherit;">必要</font><font style="vertical-align: inherit;">です</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nc/mi/dl/ncmidlxiegmtmhtozaxxqhznaya.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。実際には、次の行に注意する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
 name: my-service  # &lt;&lt;&lt;<font></font>
spec:<font></font>
  ports:<font></font>
 - port: 80  # &lt;&lt;&lt;<font></font>
   targetPort: 8080<font></font>
  selector:<font></font>
    any-name: my-app<font></font>
---<font></font>
apiVersion: networking.k8s.io/v1beta1<font></font>
kind: Ingress<font></font>
metadata:<font></font>
  name: my-ingress<font></font>
spec:<font></font>
  rules:<font></font>
  - http:<font></font>
    paths:<font></font>
    - backend:<font></font>
       serviceName: my-service  # &lt;&lt;&lt;<font></font>
       servicePort: 80  # &lt;&lt;&lt;<font></font>
     path: /</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingressが機能しているかどうかを確認するにはどうすればよいですか？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドcを使用できます</font></font><code>kubectl port-forward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、サービスの代わりにIngressコントローラーに接続する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Ingressコントローラーでポッドの名前を見つける必要があります。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get pods --all-namespaces<font></font>
NAMESPACE   NAME                              READY STATUS<font></font>
kube-system coredns-5644d7b6d9-jn7cq          1/1   Running<font></font>
kube-system etcd-minikube                     1/1   Running<font></font>
kube-system kube-apiserver-minikube           1/1   Running<font></font>
kube-system kube-controller-manager-minikube  1/1   Running<font></font>
kube-system kube-proxy-zvf2h                  1/1   Running<font></font>
kube-system kube-scheduler-minikube           1/1   Running<font></font>
kube-system nginx-ingress-controller-6fc5bcc  1/1   Running</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingressポッド（別の名前空間を参照している場合があります）</font></font><code>describe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を見つけて、ポート番号を確認する</font><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実行し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl describe pod nginx-ingress-controller-6fc5bcc \<font></font>
--namespace kube-system \<font></font>
 | grep Ports<font></font>
Ports:         80/TCP, 443/TCP, 18080/TCP</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、ポッドに接続します。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl port-forward nginx-ingress-controller-6fc5bcc 3000:80 --namespace kube-system</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、コンピューターのポート3000にリクエストを送信するたびに、Ingressコントローラーを使用してポッドのポート80にリダイレクトされます。</font><font style="vertical-align: inherit;">行く</font><font style="vertical-align: inherit;">に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// localhostを：：HTTP 3000</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、アプリケーションによって作成されたページが表示されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポートの概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのポートとラベルが一致するかをもう一度思い出してみましょう：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービス定義のセレクターは、ポッドのラベルと一致する必要があります。</font></font></li>
<li> <code>targetPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定義では、サービス</font></font><code>containerPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はポッド内のコンテナと</font><font style="vertical-align: inherit;">一致する必要があり</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li> <code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスの定義では、何でもかまいません。</font><font style="vertical-align: inherit;">異なるサービスは異なるIPアドレスを持っているため、同じポートを使用できます。</font></font></li>
<li> <code>servicePort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力は</font></font><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス定義と</font><font style="vertical-align: inherit;">一致する必要があり</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスの名前は</font></font><code>serviceName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingress </font><font style="vertical-align: inherit;">のフィールド</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">一致する必要があり</font><font style="vertical-align: inherit;">ます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、YAML構成を適切に構成する方法を知るだけでは不十分です。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題が発生するとどうなりますか？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、ポッドが起動しないか、クラッシュします。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesでアプリケーション障害をトラブルシューティングする3つのステップ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デプロイをデバッグする前に、Kubernetesがどのように機能するかを十分に理解する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
K8のポンプアウトされた各アプリケーションには3つのコンポーネントがあるため、最下部から特定の順序でデバッグする必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 最初にポッドが機能していることを確認する必要があります。次に...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービスがトラフィックをポッドに配信するかどうかを確認してから、...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ingressが正しく設定されているか確認してください。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
視覚的プレゼンテーション：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1）問題の検索は下から行う必要があります。</font><font style="vertical-align: inherit;">まず、ポッドがステータス持っていることを確認</font></font><code>Ready</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f-/lc/iz/f-lcizmfav5sb1sc7hvu8samwes.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2）をポッド（準備ができている場合</font></font><code>Ready</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）サービスがポッド間のトラフィック分散している場合、あなたは見つける必要があります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yg/we/bu/ygwebumu8ga9lmd7krineuw38mq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3）最後に、あなたはサービスと入力との間の接続を分析する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y7/ze/uz/y7zeuzkhzgsdzcjmng2ei4fjrxg.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ポッドの診断</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどの場合、問題はポッドにあります。</font><font style="vertical-align: inherit;">ポッドが</font></font><code>Ready</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">としてリストされていることを確認し</font></font><code>Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">次のコマンドを使用してこれを確認できます。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get pods<font></font>
NAME                    READY STATUS            RESTARTS  AGE<font></font>
app1                    0/1   ImagePullBackOff  0         47h<font></font>
app2                    0/1   Error             0         47h<font></font>
app3-76f9fcd46b-xbv4k   1/1   Running           1         47h</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコマンドの出力では、最後のポッドは</font></font><code>Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">としてリストされて</font></font><code>Ready</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いますが、他の2つの</font><font style="vertical-align: inherit;">ポッドは</font><font style="vertical-align: inherit;">そうではありません。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何がうまくいかなかったかを理解するには？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポッドの診断に役立つ4つのコマンドがあります。</font></font><br>
<br>
<ol>
<li> <code>kubectl logs &lt; pod'&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ポッド内のコンテナーからログを抽出できます。</font></font></li>
<li> <code>kubectl describe pod &lt; pod'&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pod'omに関連するイベントのリストを表示できます。</font></font></li>
<li> <code>kubectl get pod &lt; pod'&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kubernetesに保存されているポッドのYAML構成を取得できます。</font></font></li>
<li> <code>kubectl exec -ti &lt; pod'&gt; bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ポッドコンテナーの1つでインタラクティブコマンドシェルを実行できます</font></font></li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どれを選ぶ？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、普遍的なチームは存在しません。</font><font style="vertical-align: inherit;">これらの組み合わせを使用する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドの一般的な問題</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポッドエラーには、主に2つのタイプがあります。起動時のエラー（スタートアップ）と実行時のエラーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
起動エラー：</font></font><br>
<br>
<ul>
<li> <code>ImagePullBackoff</code></li>
<li> <code>ImageInspectError</code></li>
<li> <code>ErrImagePull</code></li>
<li> <code>ErrImageNeverPull</code></li>
<li> <code>RegistryUnavailable</code></li>
<li> <code>InvalidImageName</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ランタイムエラー：</font></font><br>
<br>
<ul>
<li> <code>CrashLoopBackOff</code></li>
<li> <code>RunContainerError</code></li>
<li> <code>KillContainerError</code></li>
<li> <code>VerifyNonRootError</code></li>
<li> <code>RunInitContainerError</code></li>
<li> <code>CreatePodSandboxError</code></li>
<li> <code>ConfigPodSandboxError</code></li>
<li> <code>KillPodSandboxError</code></li>
<li> <code>SetupNetworkError</code></li>
<li> <code>TeardownNetworkError</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のエラーは他のエラーよりも一般的です。</font><font style="vertical-align: inherit;">最も一般的な間違いのいくつかと、それらを修正する方法を次に示します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImagePullBackOff</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このエラーは、Kubernetesがいずれかのポッドコンテナのイメージを取得できない場合に表示されます。</font><font style="vertical-align: inherit;">この最も一般的な3つの理由は次のとおりです。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 画像名が正しく指定されていない-たとえば、画像名を間違えたか、画像が存在しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 画像に存在しないタグが指定されています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 画像はプライベートレジストリに保存されており、Kubernetesにはアクセスする権限がありません。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の2つの理由は簡単に排除できます。イメージ名とタグを修正するだけです。</font><font style="vertical-align: inherit;">後者の場合、シークレットのプライベートレジストリに認証情報を追加し、ポッドにそれへのリンクを追加する必要があります。</font><font style="vertical-align: inherit;">Kubernetesのドキュメントに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これを行う方法の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">例</font></a><font style="vertical-align: inherit;">が含まれています。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrashLoopBackOff</font></font></h4><br><font style="vertical-align: inherit;"></font><code>CrashLoopBackOff</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナーを開始できない場合、</font><font style="vertical-align: inherit;">
Kubenetesはエラーを表示します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは通常、次の場合に発生します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> アプリケーションにエラーがあり、起動できません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正しく構成されていません</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 活性テストが何度も失敗しました。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失敗の理由を見つけるために、コンテナーからログを取得する必要があります。</font><font style="vertical-align: inherit;">コンテナーの再起動が速すぎるためにログへのアクセスが困難な場合は、次のコマンドを使用できます。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl logs &lt;pod-name&gt; --previous</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のコンテナの生まれ変わりからのエラーメッセージを表示します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunContainerError</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このエラーは、コンテナの起動に失敗した場合に発生します。</font><font style="vertical-align: inherit;">アプリ起動前の瞬間に相当します。</font><font style="vertical-align: inherit;">通常、その原因は正しくない構成です。次に例を示します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ConfigMapやSecretsなどの存在しないボリュームをマウントしようとしています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 読み取り専用ボリュームを読み取り/書き込みとしてマウントしようとしました。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなエラーの分析には、チームが適してい</font></font><code>kubectl describe pod &lt;pod-name&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留中のポッド</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポッドは作成されると、状態のままになります</font></font><code>Pending</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なんでこんなことが起こっているの？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考えられる理由は次のとおりです（スケジューラは正常に動作していると思います）。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> クラスターには、ポッドを実行するための十分な処理能力やメモリなどのリソースがありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトが対応する名前空間にインストールされ、</font></font><code>ResourceQuota</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドを作成すると、名前空間が割り当てを超えます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドはPendingに接続されてい</font></font><code>PersistentVolumeClaim</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、コマンドを使用し</font></font><code>kubectl describe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">てセクションを確認</font><font style="vertical-align: inherit;">することをお勧めします</font></font><code>Events</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl describe pod &lt;pod name&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
に関連するエラーが発生した場合は</font></font><code>ResourceQuotas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のコマンドを使用してクラスターログを表示することをお勧めします</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get events --sort-by=.metadata.creationTimestamp</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドの準備ができていません</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポッドがと表示されている</font></font><code>Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、状態</font></font><code>Ready</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">はない</font><font style="vertical-align: inherit;">場合、準備</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プローブ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は失敗しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが発生すると、ポッドはサービスに接続せず、トラフィックはそこに流れません。</font><font style="vertical-align: inherit;">アプリケーションの問題のため、準備テストが失敗しました。</font><font style="vertical-align: inherit;">この場合、エラーを見つけるに</font></font><code>Events</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、コマンドの出力の</font><font style="vertical-align: inherit;">セクションを分析する必要があります</font></font><code>kubectl describe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.サービスの診断</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポッドが</font></font><code>Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">としてリストされて</font></font><code>Ready</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いるにもかかわらず、アプリケーションからの応答がない場合は、サービス設定を確認する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスは、ラベルに応じてポッドへのトラフィックのルーティングに関与しています。</font><font style="vertical-align: inherit;">したがって、最初に行うことは、サービスで動作するポッドの数を確認することです。</font><font style="vertical-align: inherit;">これを行うには、サービスのエンドポイントを確認できます。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl describe service &lt;service-name&gt; | grep Endpoints</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンドポイントはフォームの値のペアであり、</font></font><code>&lt;IP-:&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのようなペアの少なくとも1つが出力に存在する必要があります（つまり、少なくとも1つのポッドがサービスで機能します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セクションが</font></font><code>Endpoins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空の</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、2つのオプションが可能です。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 正しいラベルのポッドはありません（ヒント：名前空間が正しく選択されているかどうかを確認してください）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> セレクターのサービスラベルにエラーがあります。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンドポイントのリストが表示されているにもかかわらず、アプリケーションにアクセスできない場合</font></font><code>targetPort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、サービスの説明に</font><font style="vertical-align: inherit;">エラーがある可能性があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスの保守性を確認する方法は？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスのタイプに関係なく、次のコマンド</font></font><code>kubectl port-forward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用してサービス</font><font style="vertical-align: inherit;">に接続</font><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl port-forward service/&lt;service-name&gt; 3000:80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに：</font></font><br>
<br>
<ul>
<li> <code>&lt;service-name&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - サービス名;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3000-コンピュータで開くポート。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 80-サービス側のポート。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.イングレス診断</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場所まで読んだ場合：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下のように表示されpod'y </font></font><code>Running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>Ready</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービスはポッド間でトラフィックを正常に分散します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、それでもアプリケーションにアクセスすることはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、おそらく、Ingressコントローラーが正しく構成されていないことを意味します。</font><font style="vertical-align: inherit;">Ingressコントローラーはクラスター内のサードパーティコンポーネントであるため、その種類に応じてさまざまなデバッグ方法があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、Ingressを構成するために特別なツールに頼る前に、非常に簡単なことができます。</font><font style="vertical-align: inherit;">イングレスは、使用</font></font><code>serviceName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>servicePort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスに接続します。</font><font style="vertical-align: inherit;">それらが正しく構成されていることを確認する必要があります。</font><font style="vertical-align: inherit;">これを行うには、次のコマンドを使用します。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl describe ingress &lt;ingress-name&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
列が</font></font><code>Backend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空の</font><font style="vertical-align: inherit;">場合、</font><font style="vertical-align: inherit;">構成エラーの可能性が高いです。</font><font style="vertical-align: inherit;">バックエンドは配置されているが、アプリケーションへのアクセスがまだない場合、問題は以下に関連している可能性があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 公衆インターネットからのIngressアクセシビリティ設定。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> パブリックインターネットからのクラスタアクセシビリティ設定。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingressポッドに直接接続することで、インフラストラクチャの問題を特定できます。</font><font style="vertical-align: inherit;">これを行うには、まずIngressコントローラーのポッドを見つけます（別の名前空間にある可能性があります）。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get pods --all-namespaces<font></font>
NAMESPACE   NAME                              READY STATUS<font></font>
kube-system coredns-5644d7b6d9-jn7cq          1/1   Running<font></font>
kube-system etcd-minikube                     1/1   Running<font></font>
kube-system kube-apiserver-minikube           1/1   Running<font></font>
kube-system kube-controller-manager-minikube  1/1   Running<font></font>
kube-system kube-proxy-zvf2h                  1/1   Running<font></font>
kube-system kube-scheduler-minikube           1/1   Running<font></font>
kube-system nginx-ingress-controller-6fc5bcc  1/1   Running</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンド</font></font><code>describe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">てポートを設定します。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl describe pod nginx-ingress-controller-6fc5bcc<font></font>
--namespace kube-system \<font></font>
 | grep Ports</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、ポッドに接続します。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl port-forward nginx-ingress-controller-6fc5bcc 3000:80 --namespace kube-system</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、コンピューターのポート3000へのすべての要求がポート80ポッドにリダイレクトされます。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今は機能しますか？</font></font></i><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もしそうなら、問題はインフラストラクチャにあります。</font><font style="vertical-align: inherit;">トラフィックがクラスターにルーティングされる方法を正確に調べる必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> そうでない場合、問題はIngressコントローラーにあります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingressコントローラーを機能させることができない場合は、デバッグする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingressコントローラーには多くの種類があります。</font><font style="vertical-align: inherit;">最も一般的なのは、Nginx、HAProxy、Traefikなどです</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（既存のソリューションの詳細については</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、レビュー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -約Translを</font><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。対応するコントローラーのドキュメントのトラブルシューティングガイドを使用</font><i><font style="vertical-align: inherit;">する</font></i><font style="vertical-align: inherit;">必要があります。</font><font style="vertical-align: inherit;">以来</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イングレスnginxのは、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も人気のIngressコントローラで、我々はこの記事に関連する問題を解決する上でいくつかのヒントを用意しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingress Nginxコントローラーのデバッグ</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingress-nginxプロジェクトには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kubectlの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">プラグインがあり</font></a><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このコマンド</font></font><code>kubectl ingress-nginx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は次の目的で使用できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ログ、バックエンド、証明書などの分析;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ingressへの接続。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 現在の構成の調査。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の3つのチームがこれを支援します。</font></font><br>
<br>
<ul>
<li> <code>kubectl ingress-nginx lint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-チェック</font></font><code>nginx.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li> <code>kubectl ingress-nginx backend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-バックエンドを探索します（と同様</font></font><code>kubectl describe ingress &lt;ingress-name&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
<li> <code>kubectl ingress-nginx logs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ログを確認します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
場合によっては、フラグを使用してIngressコントローラの正しい名前空間を指定する必要があることに注意してください</font></font><code>--namespace &lt;name&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どこから始めればよいかわからない場合、Kubernetesの診断は困難な作業になる可能性があります。</font><font style="vertical-align: inherit;">問題は常にボトムアップの原則に従ってアプローチする必要があります。ポッドから始めて、サービスとIngressに進みます。</font><font style="vertical-align: inherit;">この記事で説明するデバッグ方法は、次のような他のオブジェクトに適用できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> アイドルジョブとCronJobs。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> StatefulSetsとDaemonSets。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おかげ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gergely Risko</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダニエルヴァイベル、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャールズChristyraj</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">貴重なコメントや追加のため。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳者からのPS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのブログも読んでください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesポッドでデバッグするためのKubectl-debugプラグイン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes [およびその解決策]の運用における6つの面白いシステムバグ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesで実行されているアプリケーションの開発者向けのツール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのSRE-日常生活からの6つの実用的な物語</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。」</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja484938/index.html">柔軟なデータサイエンス製品管理</a></li>
<li><a href="../ja484944/index.html">Что такое I в ACID или вы нам не подходите</a></li>
<li><a href="../ja484946/index.html">GPRモデリング</a></li>
<li><a href="../ja484948/index.html">NEC、20ペアの光ファイバーを記録した海底ケーブルを発売</a></li>
<li><a href="../ja484952/index.html">ReduxをObservablesとReactフックで置き換える</a></li>
<li><a href="../ja484958/index.html">フィボナッチサラダ：seccompとforkサーバーを使用したソースの最小化の高速化</a></li>
<li><a href="../ja484960/index.html">SageMathとCoCalc：すべての始まり。二部</a></li>
<li><a href="../ja484964/index.html">InfoWatch Traffic Monitorでの負荷分散の構成</a></li>
<li><a href="../ja484966/index.html">Springを使用してテストするための既製のテンプレート</a></li>
<li><a href="../ja484968/index.html">WPF DataGrid。テンプレートのために戦う</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>