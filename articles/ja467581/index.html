<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛴️ 👨🏽‍⚖️ 👩🏿‍🎤 エミュレーターのレトロコンソールの正しいカラーレンダリング 🤱 👩‍👩‍👦 🍆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ほとんどすべてのゲーム用レトロコンソールは、RGBコーディングオプションのいくつかで色を生成します。
 
 ただし、これらのピクセルカラーは、エミュレータが通常動作する画面とはまったく異なる画面用に設計されていることがよくあります。この記事では、カラーエミュレーションの重要性について説明し、コード例...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>エミュレーターのレトロコンソールの正しいカラーレンダリング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467581/"><img src="https://habrastorage.org/getpro/habr/post_images/a50/ed8/a83/a50ed8a83a28c98d8625247f217ed292.png"> <img src="https://habrastorage.org/getpro/habr/post_images/e1c/933/712/e1c933712fe6735b68512ecf77081982.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどすべてのゲーム用レトロコンソールは、RGBコーディングオプションのいくつかで色を生成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これらのピクセルカラーは、エミュレータが通常動作する画面とはまったく異なる画面用に設計されていることがよくあります。</font><font style="vertical-align: inherit;">この記事では、カラーエミュレーションの重要性について説明し、コード例とスクリーンショットをいくつか示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日最も一般的なタイプのディスプレイはLCDパネルです。</font><font style="vertical-align: inherit;">彼らは非常に悪い黒レベルを持っていることで知られています。</font><font style="vertical-align: inherit;">TN、PVA、IPSの違いは、これにあまり影響しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のファンはCRTモニターで遊んでおり、OLEDスクリーンは、特に電話やタブレットで人気が高まっています。</font><font style="vertical-align: inherit;">ただし、この記事では主にLCD画面について検討しますが、この手法はあらゆるタイプのディスプレイにとって重要です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">色精度</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の重要な詳細：ほとんどのコンピューターは24ビットカラーモードで動作し、赤、緑、青のチャネルに8ビットカラーの詳細を提供します。</font><font style="vertical-align: inherit;">しかし、ほとんどの古いゲームシステムでは、色はそのような精度で設定されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、Sega Genesisは9ビットカラーをエンコードし、チャネルごとに3ビットを提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純な解決策は、出力の上位3ビットに3ビットを入れ、下位5ビットを空白のままにすることですが、白色は少し灰色になります。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000 000 000-&gt; 000'00000 000'00000 000'00000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
111 111 111-&gt; 111'00000 111'00000 111'00000</font></font></pre><br>
<img src="https://habrastorage.org/webt/5n/9t/nz/5n9tnzpukvkthsfmonioxjbdgpo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらを単位で埋めると、黒が薄くなりすぎます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000 000 000-&gt; 000'11111 000'11111 000'11111</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
111 111 111-&gt; 111'11111 111'11111 111'11111</font></font></pre><br>
<img src="https://habrastorage.org/webt/5i/wi/a-/5iwia-xuz4urlefzodwa7ynboc8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解決策は、元のビットを繰り返して、すべての出力ビットを埋めることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000-&gt; 000 000 00 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
010-&gt; 010 010 01 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
011-&gt; 011 011 01 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
111-&gt; 111 111 11 ...</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードの形で：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8赤= r &lt;&lt; 5 | </font><font style="vertical-align: inherit;">r &lt;&lt; 2 | </font><font style="vertical-align: inherit;">r &gt;&gt; 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
// rrr00000 | </font><font style="vertical-align: inherit;">000rrr00 | </font><font style="vertical-align: inherit;">000000rr-&gt; rrrrrrrr</font></font></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面エミュレーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームレトロシステムは、最新のLCDコンピューターモニターで動作するように設計されていません。</font><font style="vertical-align: inherit;">通常、ホームコンソールはCRT画面用に設計されており、ポータブルコンソールははるかに古く、精度の低いLCDパネルを使用していました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、画面の湾曲、走査線、色収差、フレーム間ブレンディング、アパーチャグリッドなどの画面アーチファクトについては考慮しません。ここでは、個々のピクセルの色のみに焦点を当てます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCモニター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SRGBなどの標準に合わせて専門的に調整されているのはモニターの一部だけなので、モニターにはかなり広い範囲の色がありますが、一般的に、できる限り最善の方法は、正しく調整されたSRGBモニターを使用しているかのように色をエミュレートすることです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRTエミュレーション：Super Nintendo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンピューターのCRT画面とLCDモニターの主な違いは、大幅に削減された黒レベルです。これは、ガンマ補正曲線を使用してわずかにしか補正できません。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// SNESの色はRGB555形式であるため、各チャネルに32のレベルがあります</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
static const uint8 gammaRamp [32] = {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x00、0x01、0x03、0x06、0x0a、0x0f、0x15、0x1c、</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x24、0x2d、0x37、0x42、0x4e、0x5b、0x69、0x78、</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x88,0x90,0x98,0xa0,0xa8,0xb0,0xb8,0xc0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0xc8,0xd0,0xd8,0xe0,0xe8,0xf0,0xf8,0xff</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
};</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテーブルは、Super Sleuth / Kindredのオーバーロードから借用したものです。</font><font style="vertical-align: inherit;">カラーパレットの下半分を覆い隠し、上部は変更しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、エミュレーション中の画像に驚くべき効果をもたらします。オリジナルは左側に表示され、ガンマ補正が適用された画像は右側に表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fe8/0f2/ebb/fe80f2ebb4748595bee64fb8b7c1c3e1.png"> <img src="https://habrastorage.org/getpro/habr/post_images/224/ce9/07d/224ce907d78c7dc7f2d0dc309950ecd1.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a50/ed8/a83/a50ed8a83a28c98d8625247f217ed292.png"> <img src="https://habrastorage.org/getpro/habr/post_images/e1c/933/712/e1c933712fe6735b68512ecf77081982.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LCDエミュレーション：ゲームボーイアドバンス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Game Boy Advanceは、完全に色あせた最悪の液晶画面の1つを備えていました。</font><font style="vertical-align: inherit;">狡猾な開発者は、色を大幅に誇張することで、実際の機器でより快適な結果を得ることができることに気付きました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、これらの色を標準のLCDモニターで使用すると、カラフルな悪夢になります。</font><font style="vertical-align: inherit;">幸いなことに、かなり自然な色を作成することでこれを補正できます。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">double lcdGamma = 4.0、outGamma = 2.2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
double lb = pow（B / 31.0、lcdGamma）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
double lg = pow（G / 31.0、lcdGamma）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
double lr = pow（R / 31.0、lcdGamma）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
r = pow（（0 * lb + 50 * log + 255 * lr）/ 255、1 / outGamma）*（0xffff * 255/280）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
g = pow（（30 * lb + 230 * lg + 10 * lr）/ 255、1 / outGamma）*（0xffff * 255/280）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
b = pow（（220 * lb + 10 * log + 50 * lr）/ 255、1 / outGamma）*（0xffff * 255/280）;</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは、Talarubiが作成したものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CRTに比べてはるかに印象的なコントラストは、一番上のオリジナル、下の色補正バージョンです。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a63/6e8/f86/a636e8f865a184f2e7fc3cf8c2fc78c7.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ac7/ebb/795/ac7ebb795888106b5fb6025b1dc98db5.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LCDエミュレーション：ゲームボーイカラー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Game Boy Color画面は、色を再現するのが驚くほど優れており、最終的な画像に表示できるのはわずかな色のにじみだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のアルゴリズムは、Game Boy Colorエミュレーターで非常に人気があります。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R =（r * 26 + g * 4 + b * 2）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
G =（g * 24 + b * 8）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B =（r * 6 + g * 4 + b * 22）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R = min（960、R）&gt;&gt; 2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
G =最小（960、G）&gt;&gt; 2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B = min（960、B）&gt;&gt; 2;</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、私はアルゴリズムを誰が書いたかわかりません。</font><font style="vertical-align: inherit;">知っている場合は、著者情報を表示できるようにお知らせください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前と同じように、オリジナルは左側にあり、色補正付きのバージョンは右側にあります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9ab/f8b/5dc/9abf8b5dceab6103fed68d73ab410aa6.png"> <img src="https://habrastorage.org/getpro/habr/post_images/8a9/4ca/896/8a94ca896d3a10ea1b700e29033104a1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例は具体的に選択されました：オリジナルはより生き生きとして好ましいように見えますが、よく見ると、背景よりも明るいキャラクターの周りのチェスパターンに気づくでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、これは開発者側の見落としでした。本当の</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームボーイカラーでは、白の色合いがぼやけており、2つの異なる色合いがほぼ完璧に融合しているためです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終的に</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まだ良い色エミュレーションフィルターが不足している多くのシステムがあります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらは構成が非常に困難です。最も重要な例のうち、WonderSwanとNeo Geo Pocketを指摘できます。これらは、執筆時点では色を近似するための適切なフィルターがありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポータブルコンソールはバックライトが欠けていることが多いため（そしてフロントライトが時々あるため）、さらに複雑です。コントラストを変更する方法があり、特定のRGB値に対応する実際のカラー値はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特に興味深い境界線のケースはWonderSwan Colorで、表示される画像のコントラストを上げるためのプログラム可能なフラグがあります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような振る舞いを確実にエミュレートする方法はまだわかっていません。それを実行できるかどうかは不明です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
色エミュレーションはもっと注意が必要な領域なので、数学と色分析の専門家であれば、エミュレーションシーンにあなたの助けが非常に役立つでしょう。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja467559/index.html">9月16日から22日までのモスクワでのデジタルイベント</a></li>
<li><a href="../ja467563/index.html">PVS-Studioユーザーサポートから1日</a></li>
<li><a href="../ja467567/index.html">一連のssh + tmux + neovimのターミナルでの24ビットカラーのサポート</a></li>
<li><a href="../ja467573/index.html">上位8つの有用な分析フィルター</a></li>
<li><a href="../ja467575/index.html">PostgreSQLでワークロードプロファイルと待機履歴を取得する1つの方法</a></li>
<li><a href="../ja467583/index.html">LMTOOLSライセンスマネージャー。オートデスク製品ユーザーのライセンスを一覧表示する</a></li>
<li><a href="../ja467587/index.html">すべての便利なWi-Fiコンテンツを1か所に</a></li>
<li><a href="../ja467589/index.html">2019年にGDPRについて知っておくべきこと</a></li>
<li><a href="../ja467591/index.html">新しい証明は、piなどの数値の近似を解決します</a></li>
<li><a href="../ja467593/index.html">（関連なし、修理済み）注。Tele2が新規加入者の個人アカウントへのアクセスを共有する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>