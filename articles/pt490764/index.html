<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö±Ô∏è üë©‚Äçüîß üìå Grafana, InfluxDB, duas tags e uma quantidade. Ou como calcular a soma dos subgrupos? ‚óªÔ∏è üëçüèæ ‚ôàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° a todos! 
 
 Envolvido em testes de desempenho. E eu realmente gosto de configurar o monitoramento e aproveitar as m√©tricas no Grafana . E o padr√£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Grafana, InfluxDB, duas tags e uma quantidade. Ou como calcular a soma dos subgrupos?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/490764/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ol/b6/9a/olb69a8cdqhqtmjf-ic8x8qjevi.png"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√° a todos! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envolvido em testes de desempenho. </font><font style="vertical-align: inherit;">E eu realmente gosto de configurar o monitoramento e aproveitar as m√©tricas no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E o padr√£o para armazenar m√©tricas em ferramentas de carregamento √© o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voc√™ pode salvar m√©tricas de ferramentas populares como:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="  Apache.JMeter
Real-time results

In this document we will present the configuration setup to graph and historize the data in different backends:

 ‚Ä¢ InfluxDB setup for InfluxDBBackendListenerClient
 ‚Ä¢ InfluxDB setup for GraphiteBackendListenerClient
 ‚Ä¢ Grafana
 ‚Ä¢ Graphite"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache.JMeter</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="  Gatling
Realtime monitoring

The sections below describe how to configure Gatling with InfluxDB and Graphite, and use Grafana as a graphing library"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gatling</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="  LoadRunner Enterprise
Manage analysis servers

This section describes how to configure external analysis database servers to be used with LoadRunner Enterprise"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empresa Loadrunner</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="  Yandex.Tank
Modules / Artifact uploaders / InfluxDB

      Yandex.Tank  InfluxDB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabalhando com ferramentas de teste de desempenho e suas m√©tricas, acumulei uma sele√ß√£o de receitas de programa√ß√£o para o pacote do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Proponho considerar um problema interessante que surge quando existe uma m√©trica com duas ou mais tags. </font><font style="vertical-align: inherit;">Eu acho que isso n√£o √© incomum. </font><font style="vertical-align: inherit;">E, no caso geral, a tarefa √© a seguinte: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calcular a m√©trica total para um grupo, que √© dividido em subgrupos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem tr√™s op√ß√µes: </font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apenas o valor agrupado pela tag Tipo</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana-way. </font><font style="vertical-align: inherit;">N√≥s usamos uma pilha de valores</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soma de eleva√ß√µes com subconsulta</font></font></a></li>
</ol> <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como tudo come√ßou</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configurou o monitoramento JVM MBean usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jolokia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegraf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . E ele visualizou m√©tricas em conjuntos de mem√≥rias - quanta mem√≥ria √© alocada por cada conjunto de mem√≥rias no HEAP e al√©m. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√°ficos em conjuntos de mem√≥rias JVM e atividade do coletor de lixo das 13:00 do dia anterior √†s 01:00 da noite do dia atual (per√≠odo de 12 horas). Aqui voc√™ pode ver que os conjuntos de mem√≥rias s√£o divididos em dois grupos: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . E que cerca de 17:00 n√£o havia coleta de lixo, depois do que o tamanho dos pools de mem√≥ria diminuiu: </font><font style="vertical-align: inherit;">
Para m√©tricas coletar em pools de mem√≥ria, I especificado as </font><font style="vertical-align: inherit;">seguintes configura√ß√µes </font><font style="vertical-align: inherit;">no </font><b><font style="vertical-align: inherit;">Telegraf</font></b><font style="vertical-align: inherit;"> arquivo de configura√ß√£o </font><font style="vertical-align: inherit;">: </font><b><font style="vertical-align: inherit;">telegraf.conf</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ow/ow/os/owowosl0e-neglcsbew-0u7bjjq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<pre><code class="apache hljs">[<span class="hljs-attribute">outputs</span>.influxdb]
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://influxdb_server:8086"]</span>
  <span class="hljs-attribute">database</span> = <span class="hljs-string">"telegraf"</span>
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-InfluxDb"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">retention_policy</span> = <span class="hljs-string">"month"</span>
  <span class="hljs-attribute">influx_uint_support</span> = false<font></font>
<font></font>
[<span class="hljs-attribute">agent</span>]
  <span class="hljs-attribute">collection_jitter</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">interval</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">precision</span> = <span class="hljs-string">"s"</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent]]
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-Jolokia"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://127.0.0.1:7777/jvm-service"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent.metric]]
  <span class="hljs-attribute">paths</span> =<span class="hljs-meta"> ["Usage","PeakUsage","CollectionUsage","Type"]</span>
  <span class="hljs-attribute">name</span> = <span class="hljs-string">"java_memory_pool"</span>
  <span class="hljs-attribute">mbean</span> = <span class="hljs-string">"java.lang:name=*,type=MemoryPool"</span>
  <span class="hljs-attribute">tag_keys</span> =<span class="hljs-meta"> ["name"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">processors</span>.converter]]<font></font>
  [<span class="hljs-attribute">processors</span>.converter.fields]
    <span class="hljs-attribute">integer</span> =<span class="hljs-meta"> ["CollectionUsage.*", "PeakUsage.*", "Usage.*"]</span>
    <span class="hljs-attribute">tag</span> =<span class="hljs-meta"> ["Type"]</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constru√≠ uma consulta ao </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para exibir nos gr√°ficos o valor m√©trico m√°ximo </font></font><b><code>Usage.Committed</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por um per√≠odo de tempo com uma etapa </font></font><b><code>$granularity</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1m) e agrupada por duas tags </font></font><b><code>Type</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(HEAP ou NON_HEAP) e </font></font><b><code>name</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Metaspace, G1 Old Gen, ...): </font><font style="vertical-align: inherit;">
A mesma consulta em forma de texto, levando em considera√ß√£o todas </font><b><font style="vertical-align: inherit;">as</font></b><font style="vertical-align: inherit;"> vari√°veis ‚Äã‚Äãdo </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> (preste aten√ß√£o ao escape de valores de vari√°veis ‚Äã‚Äãcom </font><font style="vertical-align: inherit;">- isso √© importante para a consulta funcionar corretamente):</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/qx/2z/-2/qx2z-2mblgxyi-u6g4mrbyvybf8.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><code>:regex</code></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mesma consulta em forma de texto, levando em considera√ß√£o os valores espec√≠ficos das vari√°veis </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^serverName$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^<span class="hljs-keyword">http</span>:\/\/<span class="hljs-number">127</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.1</span>:<span class="hljs-number">7777</span>\/jvm-service$/ <span class="hljs-keyword">AND</span>
    <span class="hljs-built_in">time</span> &gt;= <span class="hljs-number">1583834400000</span>ms <span class="hljs-keyword">and</span> <span class="hljs-built_in">time</span> &lt;= <span class="hljs-number">1583877600000</span>ms
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>m)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agrupar por tempo </font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou √© </font></font><b><code>GROUP BY time(1m)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado para reduzir o n√∫mero de pontos no gr√°fico. </font><font style="vertical-align: inherit;">Por um per√≠odo de 12 horas e uma etapa de agrupamento de 1 minuto, obtemos: 12 x 60 = 720 vezes ou 721 pontos (o √∫ltimo ponto com valor nulo).</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se de que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">721</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o n√∫mero esperado de pontos em resposta a solicita√ß√µes ao </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nas configura√ß√µes atuais para o intervalo de tempo (12 horas) e a etapa de agrupamento (1 minuto).</font></font></blockquote> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conjunto de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
mem√≥rias </font><b><font style="vertical-align: inherit;">NON_HEAP: Metaspace</font></b><font style="vertical-align: inherit;"> (azul) lidera o consumo de mem√≥ria √†s 20:00. </font><font style="vertical-align: inherit;">E de acordo com o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP: G1 Old Gen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (amarelo), houve um pequeno aumento local √†s 17:03. </font><font style="vertical-align: inherit;">E, no hor√°rio das 20:00, no total, todos os </font><font style="vertical-align: inherit;">pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deixaram </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172,5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (113,2 + 45,9 + 13,4) e os </font><font style="vertical-align: inherit;">pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (67 + 57 + 4).</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ku/mo/wf/kumowfdo6gkw3wx_b8mugtsp8l4.png"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se os valores para 20:00: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> piscinas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172,5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> piscinas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vamos nos concentrar nesses valores no futuro.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No contexto de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , obtivemos o valor da m√©trica facilmente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No contexto apenas da tag </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tamb√©m √© f√°cil obter o valor da m√©trica, pois todos os nomes dos conjuntos de mem√≥rias s√£o exclusivos e basta deixar o agrupamento dos resultados apenas por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nome</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A quest√£o permanece: como obter qual tamanho √© alocado para todos os conjuntos HEAP e todos os conjuntos NON_HEAP no total?</font></font></blockquote><br>
<a name="1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Apenas o valor agrupado pela tag Type</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 </font><font style="vertical-align: inherit;">Soma agrupada por tag</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira solu√ß√£o que pode surgir √© agrupar os valores pela tag </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e calcular a soma dos valores em cada grupo. </font><font style="vertical-align: inherit;">Essa consulta ter√° a seguinte apar√™ncia: Uma </font><font style="vertical-align: inherit;">
representa√ß√£o textual de uma solicita√ß√£o de c√°lculo de soma agrupada pela tag </font><b><font style="vertical-align: inherit;">Type</font></b><font style="vertical-align: inherit;"> com todas </font><b><font style="vertical-align: inherit;">as</font></b><font style="vertical-align: inherit;"> vari√°veis </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/xz/w_/4a/xzw_4aonrgekrw4onxv9fwcctlg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma consulta v√°lida, mas retornar√° apenas dois pontos: a soma ser√° calculada com o agrupamento apenas pela tag </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com dois valores (HEAP e NON_HEAP). </font><font style="vertical-align: inherit;">Nem veremos a programa√ß√£o. </font><font style="vertical-align: inherit;">Haver√° dois pontos aut√¥nomos com uma soma enorme em valores (mais de 3 TiB): </font><font style="vertical-align: inherit;">
Essa soma n√£o √© adequada, √© necess√°ria uma divis√£o em intervalos de tempo.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/sz/lx/bo/szlxboh0o4r3-jsq7jg9d49wnic.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 </font><font style="vertical-align: inherit;">Quantidade agrupada por tag por minuto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na consulta original, agrupamos as m√©tricas por um intervalo personalizado de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ granularidade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vamos fazer o agrupamento agora por um intervalo personalizado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa consulta resultar√°, acrescentou </font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
obtemos valores inflados, em vez de 172,5 MiB por </font><b><font style="vertical-align: inherit;">NON_HEAP</font></b><font style="vertical-align: inherit;"> , vemos 4,88 GiB: </font><font style="vertical-align: inherit;">
Como as m√©tricas s√£o enviadas ao InfluxDB a cada 2 segundos (veja </font><b><font style="vertical-align: inherit;">telegraf.conf</font></b><font style="vertical-align: inherit;"> acima), a soma das leituras em um minuto n√£o fornecer√° o valor no momento, e a soma de trinta desses valores. </font><font style="vertical-align: inherit;">Tamb√©m n√£o podemos </font><font style="vertical-align: inherit;">
dividir o resultado por </font><b><font style="vertical-align: inherit;">30</font></b><font style="vertical-align: inherit;"> constantes </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como </font><b><font style="vertical-align: inherit;">$ granularity</font></b><font style="vertical-align: inherit;"> √© um par√¢metro, ele pode ser definido para 1 e 10 minutos. </font><font style="vertical-align: inherit;">E o valor da quantia mudar√°.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/yb/xp/tw/ybxptwbmibq2xlujuuwbkwb83nq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/9l/lo/hn/9llohn9ncpoztbtcsrfqzfzoqya.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 </font><font style="vertical-align: inherit;">Etiqueta agrupada por segundo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obter corretamente o valor da m√©trica da intensidade atual da cole√ß√£o de m√©tricas (2 segundos), √© necess√°rio calcular a quantidade para um intervalo fixo que n√£o exceda a intensidade da cole√ß√£o de m√©tricas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar exibir estat√≠sticas com um agrupamento em segundos. Adicione ao </font></font><b><code>GROUP BY</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agrupamento </font></font><b><code>time(1s)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
com uma granularidade t√£o pequena, obtemos um grande n√∫mero de pontos por nosso intervalo de 12 horas (12 horas * 60 minutos * 60 segundos = 43.200 intervalos, 43.201 pontos por linha, o √∫ltimo dos quais √© nulo): </font><font style="vertical-align: inherit;">
43.201 pontos em cada linha do gr√°fico. H√° tantos </font><b><font style="vertical-align: inherit;">pontos</font></b><font style="vertical-align: inherit;"> que o </font><b><font style="vertical-align: inherit;">InfluxDB</font></b><font style="vertical-align: inherit;"> forma uma resposta por um longo tempo, o </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> leva uma resposta por mais tempo e, em seguida, o navegador atrai um n√∫mero t√£o grande de pontos por um longo tempo.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/vn/sl/q_/vnslq_lq48mzzh9hgmjwiuvcy2i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/_2/mw/4k/_2mw4ki9rcnf140m2doyqsn-zxy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E a cada segundo n√£o h√° pontos: as m√©tricas foram coletadas a cada 2 segundos e agrupadas a cada segundo, o que significa que cada segundo ponto ser√° nulo. Para ver uma linha suave, configure a conex√£o de valores n√£o vazios. Caso contr√°rio, n√£o veremos os gr√°ficos: </font><font style="vertical-align: inherit;">
Anteriormente, o </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> era tal que o navegador </font><b><font style="vertical-align: inherit;">travava</font></b><font style="vertical-align: inherit;"> durante o desenho de um grande n√∫mero de pontos. Agora a vers√£o do </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> tem a capacidade de desenhar v√°rias dezenas de milhares de pontos: o navegador simplesmente pula alguns deles, desenha um gr√°fico usando os dados simplificados. Mas o gr√°fico √© suavizado. Os altos s√£o exibidos como altos m√©dios.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/xx/ya/hf/xxyahfkl3xzk6ezsakvgsbi8lp4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, h√° um gr√°fico, √© exibido com precis√£o, as m√©tricas √†s 20:00 s√£o calculadas corretamente, as m√©tricas na legenda do gr√°fico s√£o calculadas corretamente. </font><font style="vertical-align: inherit;">Mas o gr√°fico √© suavizado: as rajadas n√£o s√£o vis√≠veis com precis√£o de 1 segundo. </font><font style="vertical-align: inherit;">Em particular, o aumento do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √†s 17:03 desapareceu do gr√°fico, o gr√°fico </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><font style="vertical-align: inherit;">muito suave: o </font><font style="vertical-align: inherit;">
desempenho negativo se manifestar√° claramente por um intervalo de tempo mais longo. </font><font style="vertical-align: inherit;">Se voc√™ tentar criar um gr√°fico em um m√™s (720 horas) e n√£o em 12 horas, tudo congelar√° com uma granularidade t√£o pequena (1 segundo), haver√° muitos pontos. </font><font style="vertical-align: inherit;">E h√° um sinal de menos na aus√™ncia de picos, um paradoxo - </font><b><font style="vertical-align: inherit;">devido √† alta precis√£o de obter m√©tricas, obtemos uma baixa precis√£o de sua exibi√ß√£o</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/1g/vs/m8/1gvsm8owfg-ifjjcqwf-w1q2lbk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Grafana-way. </font><font style="vertical-align: inherit;">N√≥s usamos uma pilha de valores</font></font></h2><br><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">N√£o foi</font></b><font style="vertical-align: inherit;"> poss√≠vel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criar uma</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
solu√ß√£o simples e produtiva com o </font><b><font style="vertical-align: inherit;">InfluxDB</font></b><font style="vertical-align: inherit;"> e o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">designer de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consultas </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Apenas tentaremos usar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ferramentas </font><b><font style="vertical-align: inherit;">Grafana para</font></b><font style="vertical-align: inherit;"> resumir as m√©tricas </font><b><font style="vertical-align: inherit;">exibidas</font></b><font style="vertical-align: inherit;"> no gr√°fico original. </font><font style="vertical-align: inherit;">E sim, isso √© poss√≠vel!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 </font><font style="vertical-align: inherit;">Basta fazer a dica de ferramenta Passe o mouse / Valor empilhado: cumulativo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixaremos a solicita√ß√£o de escolha de m√©tricas inalterada, da mesma forma que na se√ß√£o "Como tudo come√ßou": as </font><font style="vertical-align: inherit;">
m√©tricas ser√£o agrupadas por </font><b><font style="vertical-align: inherit;">Tipo</font></b><font style="vertical-align: inherit;"> e </font><b><font style="vertical-align: inherit;">nome</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mas apenas exibiremos a tag </font><b><font style="vertical-align: inherit;">Type</font></b><font style="vertical-align: inherit;"> nos nomes dos gr√°ficos </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
e nas configura√ß√µes de visualiza√ß√£o, </font><b><font style="vertical-align: inherit;">agruparemos</font></b><font style="vertical-align: inherit;"> as m√©tricas por pilhas </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">
primeiro, adicione a separa√ß√£o de duas tags em duas pilhas diferentes A e B, para que seus valores n√£o se cruzem:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/s5/an/3e/s5an3errkt29lgc8byme6tnowz4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ls/vg/to/lsvgtohynssezzeiy04px0qwq3c.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/no/py/5g/nopy5ggb9ittxbz2phdei1egphg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar substitui√ß√£o de s√©rie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilha</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : A</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar substitui√ß√£o de s√©rie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / NON_HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilha</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : B</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, configure a visualiza√ß√£o de m√©tricas para exibir os valores totais em uma dica de ferramenta com gr√°ficos:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empilhamento e valor nulo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empilhamento</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Ativado</font></font></li>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica da </font><b><font style="vertical-align: inherit;">ferramenta Passe o mouse</font></b><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor empilhado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : cumulativo</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modo de </font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">ferramenta ao passar o mouse</font></b><font style="vertical-align: inherit;"> : √∫nico</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devido aos diferentes recursos do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voc√™ precisa executar a√ß√µes nessa ordem. </font><font style="vertical-align: inherit;">Se voc√™ alterar a ordem das a√ß√µes ou deixar alguns campos com as configura√ß√µes padr√£o, algo n√£o funcionar√°:</font></font><br>
<br>
<ul>
<li>    Stack <b>A</b>  <b>B</b>    <b>Stacking &amp; Null value</b> / <b>Stack</b>: On,    ;</li>
<li>  <b>Hover tooltip / Mode</b>    ,    <b>Single</b>,  <b>Hover tooltip</b>    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora, vemos muitas linhas, como para n√≥s mesmos. </font><font style="vertical-align: inherit;">Mas! </font><font style="vertical-align: inherit;">Se voc√™ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font><b><font style="vertical-align: inherit;">mouse</font></b><font style="vertical-align: inherit;"> sobre o </font><b><font style="vertical-align: inherit;">NON_HEAP</font></b><font style="vertical-align: inherit;"> mais </font><b><font style="vertical-align: inherit;">alto</font></b><font style="vertical-align: inherit;"> , a dica de ferramenta mostrar√° a soma dos valores de todos os </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAPs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A quantia √© considerada verdadeira, j√° que a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> significa </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
E se voc√™ passar o mouse sobre o gr√°fico mais alto com o nome </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> , veremos a quantia por </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O gr√°fico √© exibido corretamente. </font><font style="vertical-align: inherit;">At√© o aumento do </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> √†s 17:03 √© vis√≠vel: </font><font style="vertical-align: inherit;">
formalmente, a tarefa est√° conclu√≠da. </font><font style="vertical-align: inherit;">
Mas h√° contras - muitos gr√°ficos extras s√£o exibidos. </font><font style="vertical-align: inherit;">Voc√™ precisa colocar o cursor no topo deles. </font><font style="vertical-align: inherit;">E na legenda do gr√°fico, n√£o cumulativa, mas valores individuais s√£o exibidos; portanto, a legenda se tornou in√∫til.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/p9/tx/tw/p9txtwio9i4uozvliutk5_dg13o.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/g5/78/bo/g578boco1u0sncwf0jmh8ejsyow.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 </font><font style="vertical-align: inherit;">Valor empilhado: cumulativo com oculta√ß√£o de linhas intermedi√°rias</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos corrigir o primeiro ponto negativo da solu√ß√£o anterior: verifique se gr√°ficos extras n√£o s√£o exibidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por esta:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione novas m√©tricas com um nome diferente e valor 0 aos resultados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione novas m√©tricas √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilha A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilha B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , na parte superior da pilha.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocultar da tela - as linhas originais de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicionamos dois novos ap√≥s a solicita√ß√£o principal: solicita√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para receber uma s√©rie com valores 0 e nome </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e solicita√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para receber uma s√©rie com valores 0 e nome </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Para obter 0, pegamos o primeiro valor do campo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Usage.committed"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em cada grupo de tempo </font><font style="vertical-align: inherit;">e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subtra√≠mos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">primeiro ("Usage.committed") - primeiro ("Usage.committed")</font></b><font style="vertical-align: inherit;"> - obtemos um 0. est√°vel. Os nomes dos gr√°ficos s√£o alterados sem perder o significado devido aos colchetes: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;"> e </font><b><font style="vertical-align: inherit;">HEAP s√£o</font></b><font style="vertical-align: inherit;"> combinados na </font><b><font style="vertical-align: inherit;">pilha A</font></b><font style="vertical-align: inherit;"> e tamb√©m ocultam todos os </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">[NON_HEAP]</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/no/kh/0f/nokh0fb2fp1t_ictdthli2etylg.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">combine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pilha B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oculte NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">obtenha a</font></b><font style="vertical-align: inherit;"> 
quantidade correta em </font><b><font style="vertical-align: inherit;">[NON_HEAP]</font></b><font style="vertical-align: inherit;"> na dica de </font><b><font style="vertical-align: inherit;">ferramenta</font></b><font style="vertical-align: inherit;"> ao passar o mouse sobre o gr√°fico: </font><font style="vertical-align: inherit;">
Obtenha a quantidade correta em </font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;"> na dica de ferramenta ao passar o mouse sobre o gr√°fico. </font><font style="vertical-align: inherit;">E at√© todas as explos√µes s√£o vis√≠veis: </font><font style="vertical-align: inherit;">
e a programa√ß√£o √© formada rapidamente. </font><font style="vertical-align: inherit;">Mas a legenda sempre exibe 0, a legenda se tornou in√∫til. </font><font style="vertical-align: inherit;">
Tudo deu certo! </font><font style="vertical-align: inherit;">O verdadeiro desvio √© atrav√©s das pilhas </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√â por isso que o artigo foi adicionado √† categoria </font><b><font style="vertical-align: inherit;">Programa√ß√£o Anormal</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/uf/zw/7s/ufzw7sw-oxjflnzkglbilrdgmw4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ga/mh/nz/gamhnzyw1thhnbi5mflkwrlvr_i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/p_/tp/ev/p_tpevfzm7rwkc1534vyhe92ozg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. A soma dos m√°ximos com a subconsulta</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° iniciamos o caminho da programa√ß√£o anormal com um monte de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vamos continuar. </font><font style="vertical-align: inherit;">Vamos fazer com que o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retorne um pequeno n√∫mero de pontos e fa√ßa a legenda aparecer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 Soma dos incrementos da soma acumulada dos m√°ximos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos nos aprofundar nas possibilidades do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Anteriormente, eu frequentemente ajudava usando a derivada do valor acumulado, ent√£o tentaremos aplicar essa abordagem agora. </font><font style="vertical-align: inherit;">Vamos mudar para o modo de edi√ß√£o manual de solicita√ß√µes: </font><font style="vertical-align: inherit;">
Vamos fazer uma solicita√ß√£o:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/om/-b/yt/om-bytkvhp5zisny6gw5io_g2ba.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"U"</span>) <span class="hljs-keyword">FROM</span> (
        <span class="hljs-keyword">SELECT</span> non_negative_difference(cumulative_sum(<span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>))) <span class="hljs-keyword">AS</span> <span class="hljs-string">"U"</span> 
        <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
        <span class="hljs-keyword">WHERE</span> <font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter <font></font>
        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">"Type"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, o valor m√°ximo da m√©trica no grupo por tempo √© obtido e a soma desses valores a partir do momento em que a refer√™ncia come√ßa, agrupados pelas tags </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nome</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Como resultado, a cada momento haver√° uma soma de todas as indica√ß√µes por tipo ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) com separa√ß√£o pelo nome do conjunto, mas n√£o ser√£o somados 30 valores, como foi o caso na vers√£o 1.2, mas apenas um √© o m√°ximo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se fizermos o incremento </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non_negative_difference</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><font style="vertical-align: inherit;">uma soma acumulada para a √∫ltima etapa, obteremos o valor da soma de todos os conjuntos de dados agrupados por tags </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no in√≠cio do intervalo de tempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, para obter o valor somente por tag</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digite</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sem agrupar por tag de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nome</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , voc√™ precisar√° fazer uma solicita√ß√£o de n√≠vel superior com par√¢metros de agrupamento semelhantes, mas sem agrupar por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nome</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado de uma consulta t√£o complexa, obtemos a soma de todos os tipos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hor√°rio perfeito. </font><font style="vertical-align: inherit;">A soma dos m√°ximos √© calculada corretamente. </font><font style="vertical-align: inherit;">H√° uma legenda com os valores corretos, diferentes de zero. </font><font style="vertical-align: inherit;">Na dica de ferramenta, voc√™ pode exibir todas as m√©tricas, n√£o apenas √önica. </font><font style="vertical-align: inherit;">At√© as explos√µes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o exibidas </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Uma coisa, mas - a solicita√ß√£o acabou sendo dif√≠cil: a soma do incremento da soma acumulada dos m√°ximos com uma altera√ß√£o no n√≠vel de agrupamento.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 Soma dos m√°ximos com uma altera√ß√£o no n√≠vel de agrupamento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode fazer algo mais simples do que na vers√£o 3.1? A caixa de Pandora j√° est√° aberta, mudamos para o modo de edi√ß√£o manual de consultas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suspeita-se que o recebimento de um incremento do valor acumulado leve a um efeito zero - um extingue o outro. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre-se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da </font><b><font style="vertical-align: inherit;">diferen√ßa n√£o_negativa (soma cumulativa (...))</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplifique a solicita√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplesmente deixamos a soma dos m√°ximos, com uma diminui√ß√£o no n√≠vel de agrupamento:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"A"</span>)
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">"A"</span>
    <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
    <span class="hljs-keyword">WHERE</span><font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter<font></font>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">WHERE</span> $timeFilter
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma consulta simples e r√°pida que retorna apenas 721 pontos por s√©rie em 12 horas, quando agrupada por minutos: 12 (horas) * 60 (minutos) = 720 intervalos, 721 pontos (√∫ltimo vazio). Observe que o filtro de tempo est√° duplicado. Est√° na subconsulta e na solicita√ß√£o de agrupamento: </font><font style="vertical-align: inherit;">
sem </font><b><font style="vertical-align: inherit;">$ timeFilter,</font></b><font style="vertical-align: inherit;"> na solicita√ß√£o de agrupamento externo, o n√∫mero de pontos retornados n√£o ser√° 721 em 12 horas, mas mais. Como a subconsulta √© agrupada para o intervalo </font><b><font style="vertical-align: inherit;">de</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">a</font></b><font style="vertical-align: inherit;"> e o agrupamento de uma solicita√ß√£o externa sem filtro ser√° para o intervalo </font><b><font style="vertical-align: inherit;">de</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">agora</font></b><font style="vertical-align: inherit;"> . E se em </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> um intervalo de tempo n√£o for passado X-horas (n√£o √© tal que </font><b><font style="vertical-align: inherit;">to</font></b><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">now</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/8s/ab/tg/8sabtg9rebcu-tonmirjck2jdmk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), mas para o intervalo do passado ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agora</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ser√£o exibidos pontos vazios com um valor nulo no final da sele√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gr√°fico resultante acabou sendo simples, r√°pido, correto. </font><font style="vertical-align: inherit;">Com uma legenda que exibe m√©tricas de resumo. </font><font style="vertical-align: inherit;">Com dica de ferramenta para v√°rias linhas ao mesmo tempo. </font><font style="vertical-align: inherit;">E tamb√©m com a exibi√ß√£o de todas as explos√µes de valores: </font><font style="vertical-align: inherit;">
o resultado √© alcan√ßado!</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refer√™ncias (em vez de refer√™ncias)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Distribui√ß√µes das ferramentas usadas no artigo:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grafana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (6.5.0)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">influxdb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.7.9)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telegraf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.13.3)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jolokia-jvm-1.6.2-agent.jar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.6.2)</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Documenta√ß√£o sobre os recursos das ferramentas usadas no artigo:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ess√™ncia</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o</font></font></th>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pol√≠tica de reten√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reten√ß√£o de dados do InfluxDB</font></font></a></td>
<td>Retention policy <b>montn</b>   30  ,     JVM    .       <b>auto</b>,     .   ¬´  ¬ª   <b>telegraf.conf</b>      <b>InfluxDB</b>  ,      <b>Grafana</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">InfluxDB v1.x Output Plugin</a></td>
<td>    <b>Telegraf</b>  <b>InfluxDB</b>.     <b>telegraf.conf</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">agent / interval</a></td>
<td>   ,     2 .   ¬´  ¬ª   <b>telegraf.conf</b>.   ¬´1.2.       ¬ª  ¬´1.3.       ¬ª</td>
</tr>
<tr>
<td>Java 8 / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Interface MemoryPoolMXBean</a></td>
<td>  MemoryPool,  ,     bool,  long.     <b>telegraf.conf</b>    int</td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jolokia2 Input Plugins</a></td>
<td>  <b>telegraf.conf</b>   MBean-,     <b>InfluxDB</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Converter Processor</a></td>
<td>  <b>telegraf.conf</b>,      <b>float</b>   <b>int</b>    <b>InfluxDB</b>.      <b>Type</b>   <b>Type</b>,        </td>
</tr>
<tr>
<td>Grafana / Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Advanced Formatting Options / Regex</a></td>
<td> Grafana,    Multiselect    ,    ,     ,    <b><code>~ /^<u>${}</u>$/</code></b> ‚Äî ,  <b><code>~ /^${<u>:regex</u>}$/</code></b></td>
</tr>
<tr>
<td>Grafana / Variables / Global Built-in Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">The $timeFilter or $__timeFilter Variable</a></td>
<td> Grafana- <b>$timeFilter</b>,     </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MAX()</a></td>
<td>  <b>MAX()</b>  <b>InfluxDB</b> 1.7,       </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SUM()</a></td>
<td>    <b>SUM()</b>  <b>InfluxDB</b> 1.7</td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Subqueries</a></td>
<td>    <b>InfluxDB</b> 1.7,     3 </td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CUMULATIVE_SUM()</a></td>
<td>  <b>CUMULATIVE_SUM()</b>,        <b>InfluxDB</b>,    <b>NON_NEGATIVE_DERIVATIVE()</b></td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NON_NEGATIVE_DERIVATIVE()</a></td>
<td>  <b>NON_NEGATIVE_DERIVATIVE()</b>,     3 .     <b>CUMULATIVE_SUM()</b> ‚Äî          3</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Using Grafana‚Äôs Query Inspector to troubleshoot issues</a></td>
<td> <b>Query Inspector</b>,         ,        Grafana-</td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Draw Options</a></td>
<td>  Stack, Tooltip,‚Ä¶              ¬´2. Grafana-way.   ¬ª </td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Series overrides</a></td>
<td>       (     )  <b>Grafana</b></td>
</tr>
</tbody></table></div><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combina√ß√£o de Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> precisa ser bem conhecida pelos engenheiros de teste de desempenho. E neste pacote, muitas tarefas simples s√£o muito interessantes e nem sempre podem ser resolvidas pelos m√©todos de programa√ß√£o normais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes habilidades de programa√ß√£o anormais podem ser necess√°rios com as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caracter√≠sticas </font><font style="vertical-align: inherit;">e sutilezas do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consulta </font><b><font style="vertical-align: inherit;">idioma</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No artigo, quatro etapas foram levadas em considera√ß√£o na implementa√ß√£o do resumo de uma m√©trica com um agrupamento por uma tag, mas que possui v√°rias tags. A tarefa foi interessante. E existem muitas dessas tarefas. </font><b><font style="vertical-align: inherit;">Estou</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
preparando um relat√≥rio sobre as sutilezas da programa√ß√£o com </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Publicarei periodicamente materiais sobre esse t√≥pico. </font><font style="vertical-align: inherit;">Enquanto isso, ficarei feliz com suas perguntas no artigo atual.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490754/index.html">Editor de c√≥digo de c√≥digo do Visual Studio. O guia mais detalhado para configurar e instalar plugins para iniciantes</a></li>
<li><a href="../pt490756/index.html">Implantar Jenkins como c√≥digo</a></li>
<li><a href="../pt490758/index.html">Os matem√°ticos provaram a lei universal da turbul√™ncia</a></li>
<li><a href="../pt490760/index.html">Pesquisa visual de proje√ß√£o de raios (RCVS). Algoritmo simples e r√°pido para encontrar modelos 3D semelhantes em geometria</a></li>
<li><a href="../pt490762/index.html">Como prever passagem a√©rea?</a></li>
<li><a href="../pt490766/index.html">Como entender um iniciante, qual idioma escolher para a profiss√£o desejada?</a></li>
<li><a href="../pt490768/index.html">Quando os jogos de computador s√£o o seu trabalho: o dispositivo interno dos jogos na nuvem</a></li>
<li><a href="../pt490770/index.html">Abaixo a d√≠vida t√©cnica! No TechLead Conf 2020, mostraremos como</a></li>
<li><a href="../pt490772/index.html">Como escrever e publicar um contrato inteligente no Telegram Open Network (TON)</a></li>
<li><a href="../pt490774/index.html">Responsivo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>