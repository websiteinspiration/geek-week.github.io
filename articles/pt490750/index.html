<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéá üë©üèº‚Äçüé§ üßû Mikhail Salosin. Golang Meetup. Usando Go no back-end do aplicativo Watch + üï∂Ô∏è üõÄ üë©üèΩ‚Äçü§ù‚Äçüë®üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mikhail Salosin (daqui em diante - MS): - Ol√° pessoal! Meu nome √© Michael. Trabalho como desenvolvedor de back-end na MC2 Software e falarei sobre o u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mikhail Salosin. Golang Meetup. Usando Go no back-end do aplicativo Watch +</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/490750/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Salosin (daqui em diante - MS):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ol√° pessoal! </font><font style="vertical-align: inherit;">Meu nome √© Michael. </font><font style="vertical-align: inherit;">Trabalho como desenvolvedor de back-end na MC2 Software e falarei sobre o uso do Go no back-end do aplicativo m√≥vel Watch +. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/pc/yj/tfpcyjrufa8t1o-_ilgh2iqqb1w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algu√©m presente gosta de h√≥quei? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/g7/l_/tdg7l_zyrrg7vw1shoc3fdxywda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o este aplicativo √© para voc√™. </font><font style="vertical-align: inherit;">√â para Android e iOS, usado para assistir a transmiss√µes de v√°rios eventos esportivos on-line e em grava√ß√µes. </font><font style="vertical-align: inherit;">Tamb√©m no aplicativo, existem v√°rias estat√≠sticas, transmiss√µes de texto, tabelas para confer√™ncias, torneios e outras informa√ß√µes √∫teis para os f√£s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/cn/fa/pscnfash29d-yqq6ldluvigihoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m no aplicativo existem momentos em v√≠deo, ou seja, √© poss√≠vel ver os momentos agudos das partidas (gols, lutas, tiroteios, etc.). </font><font style="vertical-align: inherit;">Se voc√™ n√£o quiser assistir a transmiss√£o inteira, poder√° assistir apenas os mais interessantes.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que foi usado no desenvolvimento?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O corpo principal foi escrito em Go. A API com a qual os clientes m√≥veis se comunicaram foi escrita em Go. Al√©m disso, um servi√ßo foi gravado no Go para enviar notifica√ß√µes push para dispositivos m√≥veis. Tamb√©m tivemos que escrever nosso pr√≥prio ORM, sobre o qual algum dia falaremos. Bem, alguns pequenos servi√ßos est√£o escritos no Go: redimensionamento e upload de imagens para os editores ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos o Postgres (PostgreSQL) como um banco de dados. A interface para editores foi escrita em Ruby on Rails usando a gema ActiveAdmin. A importa√ß√£o de estat√≠sticas do provedor de estat√≠sticas tamb√©m √© gravada no Ruby.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para testes de API do sistema, usamos o Python unittest (Python). </font><font style="vertical-align: inherit;">O Memcached √© usado para controlar solicita√ß√µes de pagamento da API, Chef para controlar a configura√ß√£o, Zabbix para coletar e monitorar estat√≠sticas internas do sistema. </font><font style="vertical-align: inherit;">Graylog2 - para coletar logs, o Slate √© uma documenta√ß√£o da API para clientes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n5/v_/tc/n5v_tcwffefrpa-fxomv5jc_moc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sele√ß√£o de protocolo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro problema que encontramos: tivemos que escolher um protocolo para a intera√ß√£o do back-end com clientes m√≥veis, com base nos seguintes pontos ...</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O requisito mais importante: os dados dos clientes devem ser atualizados em tempo real. </font><font style="vertical-align: inherit;">Ou seja, todos os que est√£o assistindo √† transmiss√£o no momento devem receber atualiza√ß√µes quase que instantaneamente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por simplicidade, aceitamos que os dados sincronizados com os clientes n√£o sejam exclu√≠dos, mas ocultos usando sinalizadores especiais.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os tipos de solicita√ß√µes raras (como estat√≠sticas, escala√ß√µes, estat√≠sticas da equipe) s√£o recebidas por solicita√ß√µes GET comuns.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, o sistema deveria suportar calmamente 100 mil usu√°rios ao mesmo tempo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com base nisso, tivemos duas op√ß√µes de protocolo:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websockets. </font><font style="vertical-align: inherit;">Mas n√£o precisamos de canais do cliente para o servidor. </font><font style="vertical-align: inherit;">N√≥s s√≥ precisamos enviar atualiza√ß√µes do servidor para o cliente, portanto, um soquete da Web √© uma op√ß√£o redundante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos enviados pelo servidor (SSE) surgiram da maneira certa! </font><font style="vertical-align: inherit;">√â bastante simples e basicamente satisfaz tudo o que precisamos.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos Enviados pelo Servidor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas palavras sobre como isso </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
funciona </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">Ele funciona em cima da conex√£o http. </font><font style="vertical-align: inherit;">O cliente envia uma solicita√ß√£o, o servidor responde com Tipo de conte√∫do: texto / fluxo de eventos e n√£o fecha a conex√£o com o cliente, mas continua a gravar dados na conex√£o: Os </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0s/qp/5j/0sqp5jdkevts9970rrbpwa0bm9i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dados podem ser enviados em um formato acordado com os clientes. </font><font style="vertical-align: inherit;">No nosso caso, enviamos da seguinte forma: no campo de evento, o nome da estrutura alterada (pessoa, jogador) foi enviado e no campo de dados - JSON com novos campos alterados para o jogador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, sobre como a pr√≥pria intera√ß√£o funciona.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, o cliente determina quando a √∫ltima sincroniza√ß√£o foi feita com o servi√ßo: ele analisa seu banco de dados local e determina a data da √∫ltima altera√ß√£o registrada a partir dele.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele envia uma solicita√ß√£o com esta data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em resposta, enviamos a ele todas as atualiza√ß√µes que ocorreram nesta data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois disso, ele faz uma conex√£o com o canal ao vivo e n√£o fecha at√© precisar das atualiza√ß√µes:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/_v/t9/t1/_vt9t1r7nq_--sskm6vc_-0qydw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enviamos a ele uma lista de mudan√ßas: se algu√©m marcou um gol - mudamos o placar da partida, se machucou - tamb√©m foi enviado em tempo real. </font><font style="vertical-align: inherit;">Assim, no fluxo de eventos da partida, os clientes recebem instantaneamente dados relevantes. </font><font style="vertical-align: inherit;">Periodicamente, para que o cliente entenda que o servidor n√£o morreu, que nada aconteceu, enviamos um carimbo de data / hora a cada 15 segundos - para que ele saiba que tudo est√° em ordem e que n√£o h√° necessidade de se reconectar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como a conex√£o ao vivo √© servida?</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro de tudo, criamos um canal no qual as atualiza√ß√µes com um buffer vir√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois disso, assinamos este canal para receber atualiza√ß√µes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defina o cabe√ßalho correto para que o cliente saiba que est√° tudo bem.</font></font></li>
<li>  ping.    timestamp .</li>
<li>         ,     .       timestamp,  ,       .</li>
</ul><br>
<img src="https://habrastorage.org/webt/rf/hl/s9/rfhls98e0zi4dogfbjpptkb-feg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro problema que encontramos foi o seguinte: para cada conex√£o aberta com o cliente, criamos um timer que funcionava uma vez a cada 15 segundos - acontece que se tiv√©ssemos 6 mil conex√µes com uma m√°quina (com um servidor API), 6 mil temporizadores foram criados. </font><font style="vertical-align: inherit;">Isso levou ao fato de a m√°quina n√£o conter a carga necess√°ria. </font><font style="vertical-align: inherit;">O problema n√£o era t√£o √≥bvio para n√≥s, mas eles nos ajudaram um pouco e n√≥s o eliminamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, agora temos ping vindo do mesmo canal do qual a atualiza√ß√£o vem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conseguinte, existe apenas um temporizador que marca uma vez a cada 15 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o algumas fun√ß√µes auxiliares - enviando o cabe√ßalho, ping e a pr√≥pria estrutura. </font><font style="vertical-align: inherit;">Ou seja, o nome da tabela (pessoa, partida, temporada) e as informa√ß√µes sobre esse registro s√£o transmitidas aqui:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/g2/rh/qug2rhecowmxbnqmqz7zk5p-_7g.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mecanismo para envio de atualiza√ß√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, um pouco sobre de onde v√™m as mudan√ßas. </font><font style="vertical-align: inherit;">Temos v√°rias pessoas, editores, que assistem √† transmiss√£o em tempo real. </font><font style="vertical-align: inherit;">Eles criam todos os eventos: algu√©m foi removido, algu√©m foi ferido, algum tipo de substitui√ß√£o ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a ajuda do CMS, os dados entram no banco de dados. </font><font style="vertical-align: inherit;">Depois disso, o banco de dados usando o mecanismo Listen / Notify notifica os servidores da API sobre isso. </font><font style="vertical-align: inherit;">Os servidores de API j√° est√£o enviando essas informa√ß√µes aos clientes. </font><font style="vertical-align: inherit;">Portanto, de fato, temos apenas alguns servidores conectados ao banco de dados e n√£o h√° carga especial no banco de dados, porque o cliente n√£o interage diretamente com o banco de dados de nenhuma maneira:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/az/wp/ei/azwpei0ysoe2uspec2ybfe9mdag.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL: Ouvir / Notificar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mecanismo Listen / Notify no Postgres permite notificar os assinantes de eventos que algum evento foi alterado - algum tipo de registro foi criado no banco de dados. Para fazer isso, escrevemos um gatilho e uma fun√ß√£o simples: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/i_/ms/hji_msz1f-kwrtijbes4flcctr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ao inserir ou alterar um registro, chamamos a fun√ß√£o de notifica√ß√£o no canal data_updates, transferimos o nome da tabela e o identificador do registro que foi alterado ou inserido l√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para todas as tabelas que devem ser sincronizadas com o cliente, definimos um gatilho que, ap√≥s alterar / atualizar o registro, chama a fun√ß√£o indicada no slide abaixo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a API se inscreve nessas mudan√ßas? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mecanismo Fanout √© criado - ele envia mensagens para o cliente. Ele coleta todos os canais do cliente e envia as atualiza√ß√µes que recebeu atrav√©s desses canais:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kx/op/vl/kxopvlizual_4yyz48t79flo8w8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, a biblioteca pq padr√£o, que se conecta ao banco de dados e diz que deseja ouvir o canal (data_updates), verifica se a conex√£o est√° aberta e est√° tudo bem. </font><font style="vertical-align: inherit;">Eu omito a verifica√ß√£o de erros para economizar espa√ßo (n√£o marque sobrecarregado). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, configuramos o Ticker de forma ass√≠ncrona, que enviar√° o ping a cada 15 segundos e come√ßaremos a ouvir o canal no qual assinamos. </font><font style="vertical-align: inherit;">Se obtivemos um ping, publicamos esse ping. </font><font style="vertical-align: inherit;">Se recebemos um registro, publicamos esse registro para todos os assinantes deste Fanout.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona o fan-out?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em russo, isso se traduz como um "divisor". Temos um objeto que registra assinantes que desejam receber atualiza√ß√µes. E assim que chega uma atualiza√ß√£o para esse objeto, ela se espalha a todos os assinantes que possui. Simples: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/tw/76/jetw76q3dzqifpq22yo9dc3j4ha.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como √© implementado no Go: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/gl/o8/nzglo8wnz5iwzrtjfc39zlqqxa8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe uma estrutura, √© sincronizada usando Mutexes. Possui um campo que salva o status da conex√£o Fanout no banco de dados, ou seja, no momento em que escuta e receber√° atualiza√ß√µes, al√©m de uma lista de todos os canais dispon√≠veis - mapa, cuja chave √© o canal e a estrutura na forma de valores (na verdade, ele n√£o utilizado de forma alguma).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dois m√©todos - Conectado e Desconectado - permitem que voc√™ diga ao Fanout que temos uma conex√£o com a base, ela apareceu e que a conex√£o com a base est√° desconectada. No segundo caso, voc√™ precisa desconectar todos os clientes e dizer a eles que eles n√£o podem mais ouvir nada e que se reconectam, pois a conex√£o com eles foi encerrada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tamb√©m um m√©todo de inscri√ß√£o que adiciona um canal aos ouvintes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/hu/rh/i1hurht2d0x5mmdikeem_gpmm3i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
existe um m√©todo de cancelamento de inscri√ß√£o que remove um canal dos ouvintes se o cliente for desconectado, bem como um m√©todo de publica√ß√£o que permite enviar uma mensagem a todos os assinantes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pergunta:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - O que √© transmitido atrav√©s deste canal? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √â transmitido um modelo que foi alterado ou efetuado ping (essencialmente apenas um n√∫mero, n√∫mero inteiro). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Voc√™ pode enviar qualquer coisa, publicar qualquer estrutura, ela se transforma em JSON e √© isso. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Recebemos uma notifica√ß√£o do Postgres - ele cont√©m o nome e o identificador da tabela. </font><font style="vertical-align: inherit;">Pelo nome da tabela que obtemos e pelo identificador, obtemos o registro que precisamos, e essa estrutura j√° √© enviada para publica√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A infraestrutura</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como √© a apar√™ncia em termos de infraestrutura? Temos 7 servidores de ferro: um deles √© completamente dedicado √† base, os computadores virtuais est√£o girando nos seis restantes. Existem 6 c√≥pias da API: cada m√°quina virtual com a API √© executada em um servidor iron separado - isso √© confi√°vel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/2_/4e/hu2_4eyv8ko_you4ygxuowle6m4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos dois frontends nos quais o Keepalived est√° instalado para melhorar a acessibilidade, para que, no caso, um frontend possa substituir o outro. Mais duas c√≥pias do CMS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tamb√©m um importador de estat√≠sticas. Existe um DB Slave a partir do qual os backups s√£o feitos periodicamente. Existe o Pigeon Pusher - o aplicativo que envia pushies aos clientes, al√©m de itens de infraestrutura: Zabbix, Graylog2 e Chef.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, essa infraestrutura √© redundante, porque 100 mil podem ser atendidos com menos servidores. </font><font style="vertical-align: inherit;">Mas havia ferro - n√≥s o usamos (nos disseram que √© poss√≠vel - por que n√£o).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profissionais de Go</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de trabalharmos nesse aplicativo, essas vantagens √≥bvias do Go foram reveladas.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioteca http legal. </font><font style="vertical-align: inherit;">Usando-o, voc√™ pode criar bastante j√° pronto para uso.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, os canais que nos permitiram implementar com facilidade o mecanismo de envio de notifica√ß√µes aos clientes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O maravilhoso detector de corrida nos permitiu eliminar v√°rios bugs cr√≠ticos (infraestrutura de teste). </font><font style="vertical-align: inherit;">Tudo o que funciona na prepara√ß√£o est√° em execu√ß√£o, compilado com a tecla Race; </font><font style="vertical-align: inherit;">e, consequentemente, podemos ver quais problemas potenciais temos na infraestrutura de prepara√ß√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimalismo e simplicidade da linguagem.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/eb/lc/mo/eblcmow1odoou6z22y2rady3n6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos √† procura de desenvolvedores! </font><font style="vertical-align: inherit;">Se algu√©m quiser - por favor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quest√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pergunta da plat√©ia (doravante - B): - Parece-me que voc√™ perdeu um ponto importante em rela√ß√£o ao Fan-out. Entendo corretamente que, quando voc√™ envia uma resposta a um cliente, voc√™ √© bloqueado se o cliente n√£o quiser ler? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o, n√£o estamos bloqueando. Primeiro, temos tudo por tr√°s do nginx, ou seja, n√£o h√° problemas com clientes lentos. Em segundo lugar, o cliente possui um canal com um buffer - na verdade, podemos colocar at√© cem atualiza√ß√µes l√° ... Se n√£o podemos gravar no canal, ele o exclui. Se percebermos que o canal est√° bloqueado, fechamos o canal e √© isso: o cliente se reconectar√° se houver algum problema. Portanto, em princ√≠pio, o bloqueio n√£o ocorre aqui. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Voc√™ poderia enviar imediatamente para ouvir / notificar um registro, n√£o uma tabela de identificadores? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ouvir / Notificar tem um limite de 8 mil bytes por pr√©-carregamento, que ele envia. Em princ√≠pio, seria poss√≠vel enviar se estiv√©ssemos lidando com uma pequena quantidade de dados, mas me parece que a maneira [como fazemos] √© simplesmente mais confi√°vel. As limita√ß√µes est√£o no pr√≥prio Postgres. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Os clientes recebem atualiza√ß√µes nas correspond√™ncias nas quais n√£o est√£o interessados? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- em geral sim. Por via de regra, h√° 2-3 partidas em paralelo e, em seguida, muito raramente. Se o cliente est√° assistindo alguma coisa, geralmente ele est√° assistindo a partida que est√° acontecendo. Em seguida, no cliente, h√° um banco de dados local no qual todas essas atualiza√ß√µes s√£o adicionadas e, mesmo sem uma conex√£o com a Internet, o cliente pode ver todas as correspond√™ncias anteriores para as quais ele possui atualiza√ß√µes. De fato, sincronizamos nosso banco de dados no servidor com o banco de dados local do cliente para que ele possa trabalhar offline. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Por que voc√™ fez seu ORM? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexey (um dos desenvolvedores do "Watch +"):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Naquela √©poca (foi h√° um ano), o ORM era menor do que agora, quando existem muitos deles. Da maioria dos ORMs existentes, o que eu mais n√£o gosto √© que a maioria deles trabalha em interfaces vazias. Ou seja, os m√©todos que esses ORMs est√£o prontos para enfrentar qualquer coisa: estrutura, ponteiro de estrutura, n√∫mero, algo irrelevante ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosso ORM gera estruturas com base no modelo de dados. Pr√≥pria. E, portanto, todos os m√©todos s√£o concretos, n√£o usam reflex√£o etc. Eles aceitam estruturas e esperam usar as estruturas que v√™m. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quantas pessoas participaram? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Na fase inicial, duas pessoas participaram. Em algum lugar de junho, come√ßamos, em agosto a parte principal estava pronta (primeira vers√£o). Em setembro houve um lan√ßamento. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Onde voc√™ descreve o SSE, voc√™ n√£o usa o tempo limite. Por que √© que? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Para ser sincero, o SSE ainda √© um protocolo html5: o padr√£o SSE foi projetado para se comunicar com os navegadores, pelo que entendi. Possui recursos adicionais para que os navegadores possam se reconectar (e assim por diante), mas n√£o precisamos deles, porque t√≠nhamos clientes que poderiam implementar qualquer l√≥gica para conectar e receber informa√ß√µes. Provavelmente n√£o fizemos o SSE, mas algo semelhante ao SSE. Este n√£o √© o protocolo em si. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o havia necessidade. Tanto quanto eu entendo, os clientes implementaram o mecanismo de conex√£o do zero. Em princ√≠pio, eles n√£o se importaram. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quais utilit√°rios adicionais voc√™ usou? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Os mais ativos que usamos govet e golint, para que o estilo fosse unificado, assim como o gofmt. Eles n√£o usaram mais nada. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Com o que voc√™ depurou? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em geral, a depura√ß√£o foi realizada usando testes. Sem depurador, GOP n√£o usamos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Voc√™ pode retornar o slide em que a fun√ß√£o Publicar est√° implementada? Nomes de vari√°veis ‚Äã‚Äãde uma letra n√£o incomodam? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o. Eles t√™m um escopo bastante "estreito". Eles n√£o s√£o usados ‚Äã‚Äãem nenhum outro lugar (exceto aqui) (exceto no interior desta classe) e √© muito compacto - s√£o necess√°rias apenas 7 linhas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - De alguma forma, ainda n√£o √© intuitivo ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- N√£o, n√£o, este √© um c√≥digo real! N√£o √© sobre estilo. √â apenas uma classe utilit√°ria e muito pequena - existem apenas tr√™s campos dentro da classe ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/vb/a8/yxvba8lbupf_3aw2halepbbmlce.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Em geral, todos os dados sincronizados com os clientes (partidas sazonais, jogadores) n√£o s√£o alterados. Grosso modo, se formos fazer outro tipo de esporte no qual ser√° necess√°rio mudar a partida, consideraremos tudo na nova vers√£o do cliente e as vers√µes antigas do cliente ser√£o banidas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Existem pacotes de terceiros para gerenciamento de depend√™ncias? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√≥s usamos go dep. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Havia algo sobre o v√≠deo no assunto do relat√≥rio, mas n√£o sobre o v√≠deo no relat√≥rio. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o, n√£o tenho nada no t√≥pico sobre o v√≠deo. √â chamado de "Look +" - este √© o nome do aplicativo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Voc√™ disse que est√° transmitindo para os clientes? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - N√£o realizamos streaming de v√≠deo. </font><font style="vertical-align: inherit;">Isso foi completamente feito pelo Megaphone. </font><font style="vertical-align: inherit;">Sim, eu n√£o disse que o aplicativo √© megafone. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - V√° - para enviar todos os dados - por pontua√ß√£o, por eventos de jogos, estat√≠sticas ... Go - este √© o back-end inteiro do aplicativo. </font><font style="vertical-align: inherit;">O cliente deve descobrir em algum lugar qual link usar para o jogador, para que o usu√°rio possa assistir √† partida. </font><font style="vertical-align: inherit;">Temos links para v√≠deos e transmiss√µes que s√£o preparados.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Kq0cWRBd1MU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Voc√™ gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS na nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anal√≥gico exclusivo de servidores de n√≠vel b√°sico que foi inventado por n√≥s para voc√™: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10 GB DDR4 480 GB SSD 1 Gbps de US $ 19 ou como dividir o servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente n√≥s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como criar um pr√©dio de infraestrutura. </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490738/index.html">Princ√≠pio de substitui√ß√£o de Lisk</a></li>
<li><a href="../pt490740/index.html">Deserte *** *** n√£o √© apenas randomiza√ß√£o</a></li>
<li><a href="../pt490742/index.html">Uma nova era na rob√≥tica come√ßou</a></li>
<li><a href="../pt490746/index.html">Classifica√ß√£o no Yandex.Taxi: um pequeno post sobre um t√≥pico s√©rio</a></li>
<li><a href="../pt490748/index.html">A tarefa do desenvolvedor ou como digitalizamos os scanners manuais sem um fornecedor</a></li>
<li><a href="../pt490754/index.html">Editor de c√≥digo de c√≥digo do Visual Studio. O guia mais detalhado para configurar e instalar plugins para iniciantes</a></li>
<li><a href="../pt490756/index.html">Implantar Jenkins como c√≥digo</a></li>
<li><a href="../pt490758/index.html">Os matem√°ticos provaram a lei universal da turbul√™ncia</a></li>
<li><a href="../pt490760/index.html">Pesquisa visual de proje√ß√£o de raios (RCVS). Algoritmo simples e r√°pido para encontrar modelos 3D semelhantes em geometria</a></li>
<li><a href="../pt490762/index.html">Como prever passagem a√©rea?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>