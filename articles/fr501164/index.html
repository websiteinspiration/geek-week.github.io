<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåí üöü üë®üèª‚Äçüé® Visualisation des topologies de r√©seau, ou pourquoi d'autre ing√©nieur r√©seau Python # 2 ü•™ üôÜüèΩ üìπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Cet article est √©crit sur la base de la solution de la t√¢che lors du r√©cent marathon en ligne DevNet de Cisco. Les participants ont √©t√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Visualisation des topologies de r√©seau, ou pourquoi d'autre ing√©nieur r√©seau Python # 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501164/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr! </font><font style="vertical-align: inherit;">Cet article est √©crit sur la base de la solution de la t√¢che lors du r√©cent </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marathon en ligne DevNet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de Cisco. </font><font style="vertical-align: inherit;">Les participants ont √©t√© invit√©s √† automatiser l'analyse et la visualisation d'une topologie de r√©seau arbitraire et, √©ventuellement, les changements qui s'y produisent.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La t√¢che n'est pas la plus triviale, et dans la blogosph√®re il y a assez peu d'articles sur ce sujet. </font><font style="vertical-align: inherit;">Ci-dessous, je pr√©sente une discussion sur notre propre impl√©mentation, ainsi qu'une description des outils et approches utilis√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bienvenue √† chat!</font></font></p><br>
<p><img src="https://habrastorage.org/webt/5h/zi/p1/5hzip10y5vl8l71jpwwfmqp-xes.png"></p><a name="habracut"></a><br>
<hr><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Et </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beaucoup de Javascript.</font></font></blockquote><br>
<h3 id="diskleymer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement</font></font></h3><br>
<blockquote>           ,         .<br>
        ,    .<br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">MIT</a>      .<br>
<br>
     .<br>
<br>
   , ,   Ctrl+Enter  ‚åò+Enter    .</blockquote><br>
<h1 id="postanovka-zadachi"> </h1><br>
<p>      :</p><br>
<blockquote> ,    L2/L3     IOS/IOSXE.   IP-    ,     IP,        show-.       ,  ,     SNMP.        . <br>
<br>
 :       LLDP          (,     ).             (,    ).<br>
<br>
  c    :<br>
‚Ä¢    (        ).<br>
‚Ä¢ Hostname .<br>
‚Ä¢    (   , ,  GigabitEthernet0/0 ‚Äî G0/0).<br>
<br>
  ,  () .<br>
 :     (    )         . </blockquote><p>  ‚Äî IP-       ,   ‚Äî  .       - .<br>
<br>
         :</p><br>
<ul>
<li> vs .<br>
         .         .</li>
<li>      .<br>
    ,         .        ,    -    .</li>
<li>  .<br>
     ,   .</li>
<li>. <br>
        .</li>
<li>       .<br>
     .</li>
</ul><br>
<h1 id="gotovye-produkty"> </h1><br>
<p>     ,      .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a>         . ,   ,           ,        .</p><br>
<h1 id="dekompoziciya-zadachi-i-vybor-instrumentov">    </h1><br>
<p>              :<br>
<img src="https://habrastorage.org/webt/aw/2a/ze/aw2azeunzwyyrjncffz3j9zrf6o.png" alt="haut niveau"></p><br>
<p>         :</p><br>
<ol>
<li><b> .</b><br>
     IOS  IOS-XE.<br>
     <s></s>    .   . <br>
</li>
<li><b>   .</b><br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">LLDP</a> (Link Layer Discovery Protocol), ,    ,    (L2)   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">OSI</a>.   ,   IEEE 802.1AB.         Linux  Windows,   .<br>
               , ,    ..    .<br>
</li>
<li><b>   .</b><br>
         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">NETCONF</a>, REST API,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">RESTCONF</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">YANG</a>    .       SSH, Telnet   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">CLI</a>.</li>
<li><b>-  - /.</b><br>
    ,       Python, ..          ,        . <br>
   API      <b>requests</b>    .<br>
     SSH/Telnet     <b>netmiko</b>, <b>scrapli</b>, <b>paramiko</b>.    CLI  Python ‚Äî ..          ,  ,         .<br>
       ,       .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">NAPALM</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Nornir</a>. NAPALM  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">GETTER</a>'       ,  LLDP. Nornir          . <br>
SNMP       .</li>
<li><b>  -&gt;    -&gt;  .</b><br>
  API      ,    ,   CLI        .         <b>re</b>   .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">TextFSM</a>  Google      .<br>
   NAPALM   GETTER'             ,    .</li>
<li><b>      . </b><br>
      ,      ,     .</li>
<li><b>     .</b><br>
               ,    .</li>
<li><b> </b><br>
    ,       .           Python (pygraphviz, matplotlib, networkx)    JS D3.js, vis.js.        JS+HTML5 Toolkit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">NeXt UI</a>,      Cisco DevNet    .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a>,         .</li>
<li><b> </b><br>
  .         HTML-,   -    .</li>
</ol><br>
<p>,     :<br>
<img src="https://habrastorage.org/webt/jk/v7/a1/jkv7a1wlcznhgvjvc0u43fpzora.png" alt="d√©taill√©"></p><br>
<p>      :</p><br>
<ul>
<li>LLDP     .</li>
<li>SSH    .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Nornir</a>  ,          inventory.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">NAPALM</a>       CLI.</li>
<li>Python3    .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">NeXt UI</a> (JS+HTML5)     Python .</li>
</ul><br>
<p>NAPALM  Nornir                  . NAPALM     LLDP  Cisco IOS/IOSXE, IOS-XR, NX-OS, Juniper JunOS  Arista EOS.<br>
  ,      ,                   .<br>
 Next UI     ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a>.</p><br>
<h1 id="predvaritelnaya-podgotovka"> </h1><br>
<h3 id="testovyy-stend-s-oborudovaniem">   </h3><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Cisco Modeling Labs</a>.     VIRL.  Cisco DevNet Sandbox        ,    (  )   VPN- ( AnyConnect).  -       <s></s>   GNS3. :)<br>
<br>
     CML,     - :</p><br>
<p><img src="https://habrastorage.org/webt/x5/ib/hu/x5ibhuvg2oem-vjb-x3q0aq_66w.png"></p><br>
<p>   IOS (edge-sw01), IOSXE (internet-rtr01, distr-rtr01, distr-rtr02), NXOS (dist-sw01, dist-sw02), IOSXR (core-rtr01, core-rtr02)  ASA (edge-firewall01).       LLDP.   SSH   IOS, IOSXE  NXOS .</p><br>
<h3 id="ustanovka-i-inicializaciya-nornir">   Nornir</h3><br>
<p>Nornir   Python-.   PyPI,  Python  3.6.2  .     ,  NAPALM  netmiko.           Python (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">venv</a>)   .      MacOS,  Linux-  Windows   .</p><br>
<pre><code class="bash hljs">$ mkdir ~/testenv<font></font>
$ python3.7 -m venv ~/testenv/<font></font>
$ <span class="hljs-built_in">source</span> ~/testenv/bin/activate<font></font>
(testenv)$ pip install nornir</code></pre><br>
<p>Nornir   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a>  inventory          .<br>
        SimpleInventory.<br>
  Nornir   yaml ,    ,          Python-.<br>
<b>nornir_config.yaml:</b></p><br>
<pre><code class="plaintext hljs">---<font></font>
core:<font></font>
    num_workers: 20<font></font>
inventory:<font></font>
    plugin: nornir.plugins.inventory.simple.SimpleInventory<font></font>
    options:<font></font>
        host_file: "inventory/hosts_devnet_sb_cml.yml"<font></font>
        group_file: "inventory/groups.yml"</code></pre><br>
<p>    ,      yaml-:    .          .   ‚Äî     .              ,    .     ,          .<br>
 num_workers  Nornir  ,        .   20.<br>
<br>
<b>inventory/hosts_devnet_sb_cml.yml</b>   :</p><br>
<pre><code class="plaintext hljs">---<font></font>
<font></font>
internet-rtr01:<font></font>
    hostname: 10.10.20.181<font></font>
    platform: ios<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
dist-sw01:<font></font>
    hostname: 10.10.20.177<font></font>
    platform: nxos_ssh<font></font>
    transport: ssh<font></font>
    groups:<font></font>
        - devnet-cml-lab</code></pre><br>
<p>    .    IP-   ,      ( IOS   SSH)          .      'devnet-cml-lab'.<br>
<br>
 <b>groups.yml</b>     :</p><br>
<pre><code class="plaintext hljs">---<font></font>
<font></font>
devnet-cml-lab:<font></font>
    username: cisco<font></font>
    password: cisco<font></font>
    connection_options:<font></font>
        napalm:<font></font>
            extras:<font></font>
                optional_args:<font></font>
                    secret: cisco</code></pre><br>
<p>   ,     enable    Cisco.      .<br>
<strong>!</strong>               ,    .<br>
  ,    Nornir  Python-     .</p><br>
<h3 id="skachivanie-next-ui"> NeXt UI</h3><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">GitHub</a>,    .      ./next_sources.</p><br>
<hr><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">$ tree . -L 2<font></font>
.<font></font>
‚îú‚îÄ‚îÄ inventory<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ groups.yml<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ hosts_devnet_sb_cml.yml<font></font>
‚îú‚îÄ‚îÄ next_sources<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ css<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ doc<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ fonts<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ js<font></font>
‚îú‚îÄ‚îÄ nornir_config.yml</code></pre><br>
<h1 id="ot-sbora-dannyh-do-vizualizacii-ne-za-80-dney">       80 </h1><br>
<p>     <b>generate_topology.py</b>.<br>
</p><br>
<h3 id="finalnyy-shtrih-dlya-inicializacii-nornir">    Nornir</h3><br>
<p> Nornir  Python:</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> nornir <span class="hljs-keyword">import</span> InitNornir
<span class="hljs-keyword">from</span> nornir.plugins.tasks.networking <span class="hljs-keyword">import</span> napalm_get<font></font>
<font></font>
NORNIR_CONFIG_FILE = <span class="hljs-string">"nornir_config.yml"</span><font></font>
<font></font>
nr = InitNornir(config_file=NORNIR_CONFIG_FILE)</code></pre><br>
<p>     .<br>
 napalm_get    NAPALM  Nornir.<br>
</p><br>
<h3 id="minutka-lldp"> LLDP</h3><br>
<p> LLDP      ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">TLV</a> . LLDP-  .<br>
 TLV: Chassis ID, Port ID  Time-to-Live<br>
: System name and description; Port name and description; VLAN name; IP management address; System capabilities (switching, routing, etc.)  .<br>
..     ,  System name  Port name     TLV.<br>
     ,     -    control plane (, )    .<br>
<br>
                           (..     ).<br>
<i>  , , OSPF      LSA.       ‚Äî    .     LLDP.</i><br>
<br>
    edge, core  distribution     . internet-rtr01        LLDP-. <br>
 ,     dist-rtr01:</p><br>
<pre><code class="plaintext hljs">dist-rtr01#sh lldp nei<font></font>
Capability codes:<font></font>
    (R) Router, (B) Bridge, (T) Telephone, (C) DOCSIS Cable Device<font></font>
    (W) WLAN Access Point, (P) Repeater, (S) Station, (O) Other<font></font>
<font></font>
Device ID           Local Intf     Hold-time  Capability      Port ID<font></font>
dist-rtr02.devnet.laGi6            120        R               Gi6<font></font>
dist-sw01.devnet.labGi4            120        B,R             Ethernet1/3<font></font>
dist-sw02.devnet.labGi5            120        B,R             Ethernet1/3<font></font>
core-rtr02.devnet.laGi3            120        R               Gi0/0/0/2<font></font>
core-rtr01.devnet.laGi2            120        R               Gi0/0/0/2<font></font>
<font></font>
Total entries displayed: 5</code></pre><br>
<p> ,  .<br>
  core-rtr02:</p><br>
<pre><code class="plaintext hljs">RP/0/0/CPU0:core-rtr02#sh lldp nei<font></font>
Sun May 10 22:07:05.776 UTC<font></font>
Capability codes:<font></font>
        (R) Router, (B) Bridge, (T) Telephone, (C) DOCSIS Cable Device<font></font>
        (W) WLAN Access Point, (P) Repeater, (S) Station, (O) Other<font></font>
<font></font>
Device ID       Local Intf          Hold-time  Capability     Port ID<font></font>
core-rtr01.devnet.la Gi0/0/0/0           120        R               Gi0/0/0/0<font></font>
edge-sw01.devnet.lab Gi0/0/0/1           120        R               Gi0/3<font></font>
dist-rtr01.devnet.la Gi0/0/0/2           120        R               Gi3<font></font>
dist-rtr02.devnet.la Gi0/0/0/3           120        R               Gi3<font></font>
<font></font>
Total entries displayed: 4</code></pre><br>
<p>4 ,  .<br>
 ,           Device ID.<br>
  ‚Äî   CLI-.<br>
            .<br>
 :</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">'show lldp neighbors detail'  dist-rtr01  IOSXE</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">dist-rtr01#sh lldp nei det<font></font>
------------------------------------------------<font></font>
Local Intf: Gi6<font></font>
Chassis id: 001e.e57c.cf00<font></font>
Port id: Gi6<font></font>
Port Description: L3 Link to dist-rtr01<font></font>
System Name: dist-rtr02.devnet.lab<font></font>
<font></font>
System Description: <font></font>
Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)<font></font>
Technical Support: http://www.cisco.com/techsupport<font></font>
Copyright (c) 1986-2019 by Cisco Systems, Inc.<font></font>
Compiled Tue 28-May-19 12:45<font></font>
<font></font>
Time remaining: 91 seconds<font></font>
System Capabilities: B,R<font></font>
Enabled Capabilities: R<font></font>
Management Addresses:<font></font>
    IP: 172.16.252.18<font></font>
Auto Negotiation - not supported<font></font>
Physical media capabilities - not advertised<font></font>
Media Attachment Unit type - not advertised<font></font>
Vlan ID: - not advertised<font></font>
<font></font>
------------------------------------------------<font></font>
Local Intf: Gi4<font></font>
Chassis id: 5254.0007.5d59<font></font>
Port id: Ethernet1/3<font></font>
Port Description: L3 link to dist-rtr01<font></font>
System Name: dist-sw01.devnet.lab<font></font>
<font></font>
System Description: <font></font>
Cisco Nexus Operating System (NX-OS) Software 9.2(3)<font></font>
TAC support: http://www.cisco.com/tac<font></font>
Copyright (c) 2002-2019, Cisco Systems, Inc. All rights reserved.<font></font>
<font></font>
Time remaining: 108 seconds<font></font>
System Capabilities: B,R<font></font>
Enabled Capabilities: B,R<font></font>
Management Addresses:<font></font>
    IP: 10.10.20.177<font></font>
    Other: 52 54 00 07 5D 59 00<font></font>
Auto Negotiation - not supported<font></font>
Physical media capabilities - not advertised<font></font>
Media Attachment Unit type - not advertised<font></font>
Vlan ID: - not advertised<font></font>
<font></font>
------------------------------------------------<font></font>
Local Intf: Gi5<font></font>
Chassis id: 5254.0007.b7e6<font></font>
Port id: Ethernet1/3<font></font>
Port Description: L3 link to dist-rtr01<font></font>
System Name: dist-sw02.devnet.lab<font></font>
<font></font>
System Description: <font></font>
Cisco Nexus Operating System (NX-OS) Software 9.2(3)<font></font>
TAC support: http://www.cisco.com/tac<font></font>
Copyright (c) 2002-2019, Cisco Systems, Inc. All rights reserved.<font></font>
<font></font>
Time remaining: 97 seconds<font></font>
System Capabilities: B,R<font></font>
Enabled Capabilities: B,R<font></font>
Management Addresses:<font></font>
    IP: 10.10.20.178<font></font>
    Other: 52 54 00 07 FF FF 00<font></font>
Auto Negotiation - not supported<font></font>
Physical media capabilities - not advertised<font></font>
Media Attachment Unit type - not advertised<font></font>
Vlan ID: - not advertised<font></font>
<font></font>
------------------------------------------------<font></font>
Local Intf: Gi3<font></font>
Chassis id: 02c7.9dc0.0c06<font></font>
Port id: Gi0/0/0/2<font></font>
Port Description: L3 Link to dist-rtr01<font></font>
System Name: core-rtr02.devnet.lab<font></font>
<font></font>
System Description: <font></font>
Cisco IOS XR Software, Version 6.3.1[Default]<font></font>
Copyright (c) 2017 by Cisco Systems, Inc., IOS XRv Series<font></font>
<font></font>
Time remaining: 94 seconds<font></font>
System Capabilities: R<font></font>
Enabled Capabilities: R<font></font>
Management Addresses:<font></font>
    IP: 172.16.252.26<font></font>
Auto Negotiation - not supported<font></font>
Physical media capabilities - not advertised<font></font>
Media Attachment Unit type - not advertised<font></font>
Vlan ID: - not advertised<font></font>
<font></font>
------------------------------------------------<font></font>
Local Intf: Gi2<font></font>
Chassis id: 0288.15c0.0c06<font></font>
Port id: Gi0/0/0/2<font></font>
Port Description: L3 Link to dist-rtr01<font></font>
System Name: core-rtr01.devnet.lab<font></font>
<font></font>
System Description: <font></font>
Cisco IOS XR Software, Version 6.3.1[Default]<font></font>
Copyright (c) 2017 by Cisco Systems, Inc., IOS XRv Series<font></font>
<font></font>
Time remaining: 110 seconds<font></font>
System Capabilities: R<font></font>
Enabled Capabilities: R<font></font>
Management Addresses:<font></font>
    IP: 172.16.252.22<font></font>
Auto Negotiation - not supported<font></font>
Physical media capabilities - not advertised<font></font>
Media Attachment Unit type - not advertised<font></font>
Vlan ID: - not advertised<font></font>
<font></font>
Total entries displayed: 5</code></pre></div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">show lldp neighbors detail c dist-sw01  NXOS</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">dist-sw01# sh lldp nei det<font></font>
Capability codes:<font></font>
  (R) Router, (B) Bridge, (T) Telephone, (C) DOCSIS Cable Device<font></font>
  (W) WLAN Access Point, (P) Repeater, (S) Station, (O) Other<font></font>
Device ID            Local Intf      Hold-time  Capability  Port ID  <font></font>
<font></font>
Chassis id: 5254.0007.b7e4<font></font>
Port id: Ethernet1/1<font></font>
Local Port id: Eth1/1<font></font>
Port Description: VPC Peer Link<font></font>
System Name: dist-sw02.devnet.lab<font></font>
System Description: Cisco Nexus Operating System (NX-OS) Software 9.2(3)<font></font>
TAC support: http://www.cisco.com/tac<font></font>
Copyright (c) 2002-2019, Cisco Systems, Inc. All rights reserved.<font></font>
Time remaining: 112 seconds<font></font>
System Capabilities: B, R<font></font>
Enabled Capabilities: B, R<font></font>
Management Address: 10.10.20.178<font></font>
Management Address IPV6: not advertised<font></font>
Vlan ID: 1<font></font>
<font></font>
Chassis id: 5254.0007.b7e5<font></font>
Port id: Ethernet1/2<font></font>
Local Port id: Eth1/2<font></font>
Port Description: VPC Peer Link<font></font>
System Name: dist-sw02.devnet.lab<font></font>
System Description: Cisco Nexus Operating System (NX-OS) Software 9.2(3)<font></font>
TAC support: http://www.cisco.com/tac<font></font>
Copyright (c) 2002-2019, Cisco Systems, Inc. All rights reserved.<font></font>
Time remaining: 112 seconds<font></font>
System Capabilities: B, R<font></font>
Enabled Capabilities: B, R<font></font>
Management Address: 10.10.20.178<font></font>
Management Address IPV6: not advertised<font></font>
Vlan ID: 1<font></font>
<font></font>
Chassis id: 001e.7a2a.3900<font></font>
Port id: Gi4<font></font>
Local Port id: Eth1/3<font></font>
Port Description: L3 Link to dist-sw01<font></font>
System Name: dist-rtr01.devnet.lab<font></font>
System Description: Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)<font></font>
Technical Support: http://www.cisco.com/techsupport<font></font>
Copyright (c) 1986-2019 by Cisco Systems, Inc.<font></font>
Compiled Tue 28-May-19 12:45<font></font>
Time remaining: 109 seconds<font></font>
System Capabilities: B, R<font></font>
Enabled Capabilities: R<font></font>
Management Address: 172.16.252.2<font></font>
Management Address IPV6: not advertised<font></font>
Vlan ID: not advertised<font></font>
<font></font>
Chassis id: 001e.e57c.cf00<font></font>
Port id: Gi4<font></font>
Local Port id: Eth1/4<font></font>
Port Description: L3 Link to dist-sw01<font></font>
System Name: dist-rtr02.devnet.lab<font></font>
System Description: Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)<font></font>
Technical Support: http://www.cisco.com/techsupport<font></font>
Copyright (c) 1986-2019 by Cisco Systems, Inc.<font></font>
Compiled Tue 28-May-19 12:45<font></font>
Time remaining: 108 seconds<font></font>
System Capabilities: B, R<font></font>
Enabled Capabilities: R<font></font>
Management Address: 172.16.252.6<font></font>
Management Address IPV6: not advertised<font></font>
Vlan ID: not advertised<font></font>
<font></font>
Total entries displayed: 4</code></pre></div>
                    </div><br>
<h3 id="poluchenie-dannyh-s-oborudovaniya">   </h3><br>
<p>      IOS (edge-sw01), IOSXE (internet-rtr01, distr-rtr01, distr-rtr02)  NXOS (dist-sw01, dist-sw02).<br>
   IOSXR (core-rtr01, core-rtr02)   .<br>
    :</p><br>
<ol>
<li>    distribution .<br>
      .</li>
<li>      core-rtr01  core-rtr02.<br>
         .</li>
<li>       .<br>
 edge-sw01,  distr-rtr01  distr-sw02  core-rtr01  core-rtr02     LLDP.<br>
        .</li>
</ol><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  inventory/hosts_devnet_sb_cml.yml</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">---<font></font>
<font></font>
internet-rtr01:<font></font>
    hostname: 10.10.20.181<font></font>
    platform: ios<font></font>
    site: devnet_sandbox<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
edge-sw01:<font></font>
    hostname: 10.10.20.172<font></font>
    platform: ios<font></font>
    site: devnet_sandbox<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
core-rtr01:<font></font>
    #      <font></font>
    hostname: 10.10.20.173<font></font>
    platform: iosxr<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
core-rtr02:<font></font>
    #      <font></font>
    hostname: 10.10.20.174<font></font>
    platform: iosxr<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
dist-rtr01:<font></font>
    hostname: 10.10.20.175<font></font>
    platform: ios<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
dist-rtr02:<font></font>
    hostname: 10.10.20.176<font></font>
    platform: ios<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
dist-sw01:<font></font>
    hostname: 10.10.20.177<font></font>
    platform: nxos_ssh<font></font>
    transport: ssh<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
<font></font>
dist-sw02:<font></font>
    hostname: 10.10.20.178<font></font>
    platform: nxos_ssh<font></font>
    transport: ssh<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
</code></pre></div>
                    </div><br>
<p>   NAPALM:</p><br>
<ul>
<li>GET_LLDP_NEIGHBORS_DETAILS ( LLDP-).<br>
  , ..  CLI-     .</li>
<li>GET_FACTS (   ).<br>
       FQDN,  .<br>
 ,         .    .<br>
</li>
</ul><br>
<p>    -Task  Nornir.<br>
          .<br>
        <i>num_workers</i> .</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_host_data</span>(<span class="hljs-params">task</span>):</span>
    <span class="hljs-string">"""Nornir Task      ."""</span><font></font>
    task.run(<font></font>
        task=napalm_get,<font></font>
        getters=[<span class="hljs-string">'facts'</span>, <span class="hljs-string">'lldp_neighbors_detail'</span>]<font></font>
    )<font></font>
<font></font>
<span class="hljs-comment">#       .</span>
<span class="hljs-comment">#       .</span>
get_host_data_result = nr.run(get_host_data)</code></pre><br>
<p>        , Nornir   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a>   .</p><br>
<h3 id="razbor-poluchennyh-ot-ustroystv-dannyh">    </h3><br>
<p>  get_host_data_result     get_host_data    .</p><br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span>get_host_data_result<font></font>
AggregatedResult (get_host_data): {<span class="hljs-string">'internet-rtr01'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>], <span class="hljs-string">'edge-sw01'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>], <span class="hljs-string">'core-rtr01'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>], <span class="hljs-string">'core-rtr02'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>], <span class="hljs-string">'dist-rtr01'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>], <span class="hljs-string">'dist-rtr02'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>], <span class="hljs-string">'dist-sw01'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>], <span class="hljs-string">'dist-sw02'</span>: MultiResult: [Result: <span class="hljs-string">"get_host_data"</span>, Result: <span class="hljs-string">"napalm_get"</span>]}</code></pre><br>
<p>    failed,   ,    ,    .<br>
    :</p><br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> device, result <span class="hljs-keyword">in</span> get_host_data_result.items():
<span class="hljs-meta">... </span>    print(<span class="hljs-string">f'<span class="hljs-subst">{device}</span> failed: <span class="hljs-subst">{result.failed}</span>'</span>)
<span class="hljs-meta">... </span>
internet-rtr01 failed: <span class="hljs-literal">False</span>
edge-sw01 failed: <span class="hljs-literal">False</span>
core-rtr01 failed: <span class="hljs-literal">True</span>
core-rtr02 failed: <span class="hljs-literal">True</span>
dist-rtr01 failed: <span class="hljs-literal">False</span>
dist-rtr02 failed: <span class="hljs-literal">False</span>
dist-sw01 failed: <span class="hljs-literal">False</span>
dist-sw02 failed: <span class="hljs-literal">False</span></code></pre><br>
<p> .<br>
</p><br>
<p>    :</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    dist-rtr01</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span>get_host_data_result[<span class="hljs-string">'dist-rtr01'</span>][<span class="hljs-number">1</span>].result<font></font>
{<span class="hljs-string">'facts'</span>: {<span class="hljs-string">'uptime'</span>: <span class="hljs-number">6120</span>, <span class="hljs-string">'vendor'</span>: <span class="hljs-string">'Cisco'</span>, <span class="hljs-string">'os_version'</span>: <span class="hljs-string">'Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)'</span>, <span class="hljs-string">'serial_number'</span>: <span class="hljs-string">'9JDCOVUDSWN'</span>, <span class="hljs-string">'model'</span>: <span class="hljs-string">'CSR1000V'</span>, <span class="hljs-string">'hostname'</span>: <span class="hljs-string">'dist-rtr01'</span>, <span class="hljs-string">'fqdn'</span>: <span class="hljs-string">'dist-rtr01.devnet.lab'</span>, <span class="hljs-string">'interface_list'</span>: [<span class="hljs-string">'GigabitEthernet1'</span>, <span class="hljs-string">'GigabitEthernet2'</span>, <span class="hljs-string">'GigabitEthernet3'</span>, <span class="hljs-string">'GigabitEthernet4'</span>, <span class="hljs-string">'GigabitEthernet5'</span>, <span class="hljs-string">'GigabitEthernet6'</span>, <span class="hljs-string">'Loopback0'</span>]}, <span class="hljs-string">'lldp_neighbors_detail'</span>: {<span class="hljs-string">'GigabitEthernet6'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'001e.e57c.cf00'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi6'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-rtr02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}], <span class="hljs-string">'GigabitEthernet4'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.5d59'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/3'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw01.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}], <span class="hljs-string">'GigabitEthernet5'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.b7e6'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/3'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}], <span class="hljs-string">'GigabitEthernet3'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'02c7.9dc0.0c06'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi0/0/0/2'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'core-rtr02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS XR Software, Version 6.3.1[Default]'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}], <span class="hljs-string">'GigabitEthernet2'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'0288.15c0.0c06'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi0/0/0/2'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'core-rtr01.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS XR Software, Version 6.3.1[Default]'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}]}}</code></pre></div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    dist-sw01</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span>get_host_data_result[<span class="hljs-string">'dist-sw01'</span>][<span class="hljs-number">1</span>].result<font></font>
{<span class="hljs-string">'facts'</span>: {<span class="hljs-string">'uptime'</span>: <span class="hljs-number">6090</span>, <span class="hljs-string">'vendor'</span>: <span class="hljs-string">'Cisco'</span>, <span class="hljs-string">'os_version'</span>: <span class="hljs-string">'9.2(3)'</span>, <span class="hljs-string">'serial_number'</span>: <span class="hljs-string">'9P5OMCCMSQ4'</span>, <span class="hljs-string">'model'</span>: <span class="hljs-string">'Nexus9000 9000v Chassis'</span>, <span class="hljs-string">'hostname'</span>: <span class="hljs-string">'dist-sw01'</span>, <span class="hljs-string">'fqdn'</span>: <span class="hljs-string">'dist-sw01.devnet.lab'</span>, <span class="hljs-string">'interface_list'</span>: [<span class="hljs-string">'mgmt0'</span>, <span class="hljs-string">'Ethernet1/1'</span>, <span class="hljs-string">'Ethernet1/2'</span>, <span class="hljs-string">'Ethernet1/3'</span>, <span class="hljs-string">'Ethernet1/4'</span>, <span class="hljs-string">'Ethernet1/5'</span>, <span class="hljs-string">'Ethernet1/6'</span>, <span class="hljs-string">'Ethernet1/7'</span>, <span class="hljs-string">'Ethernet1/8'</span>, <span class="hljs-string">'Ethernet1/9'</span>, <span class="hljs-string">'Ethernet1/10'</span>, <span class="hljs-string">'Ethernet1/11'</span>, <span class="hljs-string">'Ethernet1/12'</span>, <span class="hljs-string">'Ethernet1/13'</span>, <span class="hljs-string">'Ethernet1/14'</span>, <span class="hljs-string">'Ethernet1/15'</span>, <span class="hljs-string">'Ethernet1/16'</span>, <span class="hljs-string">'Ethernet1/17'</span>, <span class="hljs-string">'Ethernet1/18'</span>, <span class="hljs-string">'Ethernet1/19'</span>, <span class="hljs-string">'Ethernet1/20'</span>, <span class="hljs-string">'Ethernet1/21'</span>, <span class="hljs-string">'Ethernet1/22'</span>, <span class="hljs-string">'Ethernet1/23'</span>, <span class="hljs-string">'Ethernet1/24'</span>, <span class="hljs-string">'Ethernet1/25'</span>, <span class="hljs-string">'Ethernet1/26'</span>, <span class="hljs-string">'Ethernet1/27'</span>, <span class="hljs-string">'Ethernet1/28'</span>, <span class="hljs-string">'Ethernet1/29'</span>, <span class="hljs-string">'Ethernet1/30'</span>, <span class="hljs-string">'Ethernet1/31'</span>, <span class="hljs-string">'Ethernet1/32'</span>, <span class="hljs-string">'Ethernet1/33'</span>, <span class="hljs-string">'Ethernet1/34'</span>, <span class="hljs-string">'Ethernet1/35'</span>, <span class="hljs-string">'Ethernet1/36'</span>, <span class="hljs-string">'Ethernet1/37'</span>, <span class="hljs-string">'Ethernet1/38'</span>, <span class="hljs-string">'Ethernet1/39'</span>, <span class="hljs-string">'Ethernet1/40'</span>, <span class="hljs-string">'Ethernet1/41'</span>, <span class="hljs-string">'Ethernet1/42'</span>, <span class="hljs-string">'Ethernet1/43'</span>, <span class="hljs-string">'Ethernet1/44'</span>, <span class="hljs-string">'Ethernet1/45'</span>, <span class="hljs-string">'Ethernet1/46'</span>, <span class="hljs-string">'Ethernet1/47'</span>, <span class="hljs-string">'Ethernet1/48'</span>, <span class="hljs-string">'Ethernet1/49'</span>, <span class="hljs-string">'Ethernet1/50'</span>, <span class="hljs-string">'Ethernet1/51'</span>, <span class="hljs-string">'Ethernet1/52'</span>, <span class="hljs-string">'Ethernet1/53'</span>, <span class="hljs-string">'Ethernet1/54'</span>, <span class="hljs-string">'Ethernet1/55'</span>, <span class="hljs-string">'Ethernet1/56'</span>, <span class="hljs-string">'Ethernet1/57'</span>, <span class="hljs-string">'Ethernet1/58'</span>, <span class="hljs-string">'Ethernet1/59'</span>, <span class="hljs-string">'Ethernet1/60'</span>, <span class="hljs-string">'Ethernet1/61'</span>, <span class="hljs-string">'Ethernet1/62'</span>, <span class="hljs-string">'Ethernet1/63'</span>, <span class="hljs-string">'Ethernet1/64'</span>, <span class="hljs-string">'Ethernet1/65'</span>, <span class="hljs-string">'Ethernet1/66'</span>, <span class="hljs-string">'Ethernet1/67'</span>, <span class="hljs-string">'Ethernet1/68'</span>, <span class="hljs-string">'Ethernet1/69'</span>, <span class="hljs-string">'Ethernet1/70'</span>, <span class="hljs-string">'Ethernet1/71'</span>, <span class="hljs-string">'Ethernet1/72'</span>, <span class="hljs-string">'Ethernet1/73'</span>, <span class="hljs-string">'Ethernet1/74'</span>, <span class="hljs-string">'Ethernet1/75'</span>, <span class="hljs-string">'Ethernet1/76'</span>, <span class="hljs-string">'Ethernet1/77'</span>, <span class="hljs-string">'Ethernet1/78'</span>, <span class="hljs-string">'Ethernet1/79'</span>, <span class="hljs-string">'Ethernet1/80'</span>, <span class="hljs-string">'Ethernet1/81'</span>, <span class="hljs-string">'Ethernet1/82'</span>, <span class="hljs-string">'Ethernet1/83'</span>, <span class="hljs-string">'Ethernet1/84'</span>, <span class="hljs-string">'Ethernet1/85'</span>, <span class="hljs-string">'Ethernet1/86'</span>, <span class="hljs-string">'Ethernet1/87'</span>, <span class="hljs-string">'Ethernet1/88'</span>, <span class="hljs-string">'Ethernet1/89'</span>, <span class="hljs-string">'Ethernet1/90'</span>, <span class="hljs-string">'Ethernet1/91'</span>, <span class="hljs-string">'Ethernet1/92'</span>, <span class="hljs-string">'Ethernet1/93'</span>, <span class="hljs-string">'Ethernet1/94'</span>, <span class="hljs-string">'Ethernet1/95'</span>, <span class="hljs-string">'Ethernet1/96'</span>, <span class="hljs-string">'Ethernet1/97'</span>, <span class="hljs-string">'Ethernet1/98'</span>, <span class="hljs-string">'Ethernet1/99'</span>, <span class="hljs-string">'Ethernet1/100'</span>, <span class="hljs-string">'Ethernet1/101'</span>, <span class="hljs-string">'Ethernet1/102'</span>, <span class="hljs-string">'Ethernet1/103'</span>, <span class="hljs-string">'Ethernet1/104'</span>, <span class="hljs-string">'Ethernet1/105'</span>, <span class="hljs-string">'Ethernet1/106'</span>, <span class="hljs-string">'Ethernet1/107'</span>, <span class="hljs-string">'Ethernet1/108'</span>, <span class="hljs-string">'Ethernet1/109'</span>, <span class="hljs-string">'Ethernet1/110'</span>, <span class="hljs-string">'Ethernet1/111'</span>, <span class="hljs-string">'Ethernet1/112'</span>, <span class="hljs-string">'Ethernet1/113'</span>, <span class="hljs-string">'Ethernet1/114'</span>, <span class="hljs-string">'Ethernet1/115'</span>, <span class="hljs-string">'Ethernet1/116'</span>, <span class="hljs-string">'Ethernet1/117'</span>, <span class="hljs-string">'Ethernet1/118'</span>, <span class="hljs-string">'Ethernet1/119'</span>, <span class="hljs-string">'Ethernet1/120'</span>, <span class="hljs-string">'Ethernet1/121'</span>, <span class="hljs-string">'Ethernet1/122'</span>, <span class="hljs-string">'Ethernet1/123'</span>, <span class="hljs-string">'Ethernet1/124'</span>, <span class="hljs-string">'Ethernet1/125'</span>, <span class="hljs-string">'Ethernet1/126'</span>, <span class="hljs-string">'Ethernet1/127'</span>, <span class="hljs-string">'Ethernet1/128'</span>, <span class="hljs-string">'Port-channel1'</span>, <span class="hljs-string">'Loopback0'</span>, <span class="hljs-string">'Vlan1'</span>, <span class="hljs-string">'Vlan101'</span>, <span class="hljs-string">'Vlan102'</span>, <span class="hljs-string">'Vlan103'</span>, <span class="hljs-string">'Vlan104'</span>, <span class="hljs-string">'Vlan105'</span>]}, <span class="hljs-string">'lldp_neighbors_detail'</span>: {<span class="hljs-string">'Ethernet1/1'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.b7e4'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/1'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'VPC Peer Link'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}], <span class="hljs-string">'Ethernet1/2'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.b7e5'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/2'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'VPC Peer Link'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}], <span class="hljs-string">'Ethernet1/3'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'001e.7a2a.3900'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi4'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-sw01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-rtr01.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}], <span class="hljs-string">'Ethernet1/4'</span>: [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'001e.e57c.cf00'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi4'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-sw01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-rtr02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}]}}</code></pre></div>
                    </div><br>
<p>       'facts' 'lldp_neighbors_detail'    .<br>
    NAPALM'   .<br>
 :</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> dist-rtr01</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> get_host_data_result[<span class="hljs-string">'dist-rtr01'</span>][<span class="hljs-number">1</span>].result[<span class="hljs-string">'lldp_neighbors_detail'</span>].items():
<span class="hljs-meta">... </span>    print(neighbor)
<span class="hljs-meta">... </span>    print(<span class="hljs-string">'\n'</span>)
<span class="hljs-meta">... </span>
(<span class="hljs-string">'GigabitEthernet6'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'001e.e57c.cf00'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi6'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-rtr02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])<font></font>
<font></font>
(<span class="hljs-string">'GigabitEthernet4'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.5d59'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/3'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw01.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])<font></font>
<font></font>
(<span class="hljs-string">'GigabitEthernet5'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.b7e6'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/3'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])<font></font>
<font></font>
(<span class="hljs-string">'GigabitEthernet3'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'02c7.9dc0.0c06'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi0/0/0/2'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'core-rtr02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS XR Software, Version 6.3.1[Default]'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])<font></font>
<font></font>
(<span class="hljs-string">'GigabitEthernet2'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'0288.15c0.0c06'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi0/0/0/2'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-rtr01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'core-rtr01.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS XR Software, Version 6.3.1[Default]'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])</code></pre></div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> dist-sw01</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> get_host_data_result[<span class="hljs-string">'dist-sw01'</span>][<span class="hljs-number">1</span>].result[<span class="hljs-string">'lldp_neighbors_detail'</span>].items():
<span class="hljs-meta">... </span>    print(neighbor)
<span class="hljs-meta">... </span>    print(<span class="hljs-string">'\n'</span>)
<span class="hljs-meta">... </span>
(<span class="hljs-string">'Ethernet1/1'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.b7e4'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/1'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'VPC Peer Link'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])<font></font>
<font></font>
(<span class="hljs-string">'Ethernet1/2'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'5254.0007.b7e5'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Ethernet1/2'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'VPC Peer Link'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-sw02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco Nexus Operating System (NX-OS) Software 9.2(3)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])<font></font>
<font></font>
(<span class="hljs-string">'Ethernet1/3'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'001e.7a2a.3900'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi4'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-sw01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-rtr01.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])<font></font>
<font></font>
(<span class="hljs-string">'Ethernet1/4'</span>, [{<span class="hljs-string">'remote_chassis_id'</span>: <span class="hljs-string">'001e.e57c.cf00'</span>, <span class="hljs-string">'remote_port'</span>: <span class="hljs-string">'Gi4'</span>, <span class="hljs-string">'remote_port_description'</span>: <span class="hljs-string">'L3 Link to dist-sw01'</span>, <span class="hljs-string">'remote_system_name'</span>: <span class="hljs-string">'dist-rtr02.devnet.lab'</span>, <span class="hljs-string">'remote_system_description'</span>: <span class="hljs-string">'Cisco IOS Software [Gibraltar], Virtual XE Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 16.11.1b, RELEASE SOFTWARE (fc2)'</span>, <span class="hljs-string">'remote_system_capab'</span>: [<span class="hljs-string">'bridge'</span>, <span class="hljs-string">'router'</span>], <span class="hljs-string">'remote_system_enable_capab'</span>: [<span class="hljs-string">'router'</span>], <span class="hljs-string">'parent_interface'</span>: <span class="hljs-string">''</span>}])</code></pre></div>
                    </div><br>
<p>5   dist-rtr01,     CLI .<br>
4   dist-sw01,   .<br>
     .<br>
</p><br>
<p>          LLDP  .<br>
            :</p><br>
<ul>
<li> FQDN,   (       ).</li>
<li> hostname,  .</li>
<li>   - inventory Nornir.<br>
     LLDP.<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">normalize_result</span>(<span class="hljs-params">nornir_job_result</span>):</span>
<span class="hljs-string">"""
    get_host_data.
    LLDP  FACTS  
      .
"""</span><font></font>
global_lldp_data = {}<font></font>
global_facts = {}<font></font>
<span class="hljs-keyword">for</span> device, output <span class="hljs-keyword">in</span> nornir_job_result.items():
    <span class="hljs-keyword">if</span> output[<span class="hljs-number">0</span>].failed:
        <span class="hljs-comment">#       ,</span>
        <span class="hljs-comment">#       .</span>
        <span class="hljs-comment">#      host-  .</span><font></font>
        global_lldp_data[device] = {}<font></font>
        global_facts[device] = {<font></font>
            <span class="hljs-string">'nr_ip'</span>: nr.inventory.hosts[device].get(<span class="hljs-string">'hostname'</span>, <span class="hljs-string">'n/a'</span>),<font></font>
        }<font></font>
        <span class="hljs-keyword">continue</span>
    <span class="hljs-comment">#        </span>
    <span class="hljs-comment">#    FQDN ,    LLDP TLV.</span>
    device_fqdn = output[<span class="hljs-number">1</span>].result[<span class="hljs-string">'facts'</span>][<span class="hljs-string">'fqdn'</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> device_fqdn:
        <span class="hljs-comment">#  FQDN  ,  .</span>
        device_fqdn = output[<span class="hljs-number">1</span>].result[<span class="hljs-string">'facts'</span>][<span class="hljs-string">'hostname'</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> device_fqdn:
        <span class="hljs-comment">#     ,</span>
        <span class="hljs-comment">#   host-  .</span><font></font>
        device_fqdn = device<font></font>
    global_facts[device_fqdn] = output[<span class="hljs-number">1</span>].result[<span class="hljs-string">'facts'</span>]
    <span class="hljs-comment">#   facts IP- </span>
    global_facts[device_fqdn][<span class="hljs-string">'nr_ip'</span>] = nr.inventory.hosts[device].get(<span class="hljs-string">'hostname'</span>, <span class="hljs-string">'n/a'</span>)<font></font>
    global_lldp_data[device_fqdn] = output[<span class="hljs-number">1</span>].result[<span class="hljs-string">'lldp_neighbors_detail'</span>]
<span class="hljs-keyword">return</span> global_lldp_data, global_facts</code></pre></li>
</ul><br>
<p>   LLDP              :</p><br>
<ul>
<li>  .</li>
<li>    .</li>
</ul><br>
<p>        :<br>
((source_device_id, source_port_name), (destination_device_id, destination_port_name))<br>
</p><br>
<p>  , :</p><br>
<ul>
<li>             ,     .<br>
         .</li>
<li>      LLDP    . , GigabitEthernet4 ,  Gi4  .<br>
<br>
</li>
</ul><br>
<p>        .            .<br>
           capabilities,   LLDP.       .<br>
:</p><br>
<pre><code class="python hljs">interface_full_name_map = {
    <span class="hljs-string">'Eth'</span>: <span class="hljs-string">'Ethernet'</span>,
    <span class="hljs-string">'Fa'</span>: <span class="hljs-string">'FastEthernet'</span>,
    <span class="hljs-string">'Gi'</span>: <span class="hljs-string">'GigabitEthernet'</span>,
    <span class="hljs-string">'Te'</span>: <span class="hljs-string">'TenGigabitEthernet'</span>,<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">if_fullname</span>(<span class="hljs-params">ifname</span>):</span>
    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> interface_full_name_map.items():
        <span class="hljs-keyword">if</span> ifname.startswith(v):
            <span class="hljs-keyword">return</span> ifname
        <span class="hljs-keyword">if</span> ifname.startswith(k):
            <span class="hljs-keyword">return</span> ifname.replace(k, v)
    <span class="hljs-keyword">return</span> ifname<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">if_shortname</span>(<span class="hljs-params">ifname</span>):</span>
    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> interface_full_name_map.items():
        <span class="hljs-keyword">if</span> ifname.startswith(v):
            <span class="hljs-keyword">return</span> ifname.replace(v, k)
    <span class="hljs-keyword">return</span> ifname<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_lldp_details</span>(<span class="hljs-params">lldp_data_dict</span>):</span>
    <span class="hljs-string">"""
        LLDP-.
           ,
      LLDP capabilities    
          .
    """</span><font></font>
    discovered_hosts = set()<font></font>
    lldp_capabilities_dict = {}<font></font>
    global_interconnections = []<font></font>
    <span class="hljs-keyword">for</span> host, lldp_data <span class="hljs-keyword">in</span> lldp_data_dict.items():
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> host:
            <span class="hljs-keyword">continue</span><font></font>
        discovered_hosts.add(host)<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> lldp_data:
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">for</span> interface, neighbors <span class="hljs-keyword">in</span> lldp_data.items():
            <span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> neighbors:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> neighbor[<span class="hljs-string">'remote_system_name'</span>]:
                    <span class="hljs-keyword">continue</span>
                discovered_hosts.add(neighbor[<span class="hljs-string">'remote_system_name'</span>])
                <span class="hljs-keyword">if</span> neighbor[<span class="hljs-string">'remote_system_enable_capab'</span>]:
                    <span class="hljs-comment">#     enable capabilities</span>
                    <span class="hljs-comment">#      </span>
                    lldp_capabilities_dict[neighbor[<span class="hljs-string">'remote_system_name'</span>]] = (<font></font>
                        neighbor[<span class="hljs-string">'remote_system_enable_capab'</span>][<span class="hljs-number">0</span>]<font></font>
                    )<font></font>
                <span class="hljs-keyword">else</span>:<font></font>
                    lldp_capabilities_dict[neighbor[<span class="hljs-string">'remote_system_name'</span>]] = <span class="hljs-string">''</span>
                <span class="hljs-comment">#       :</span>
                <span class="hljs-comment"># ((_,  ), ( , _))</span>
                <span class="hljs-comment">#     .</span><font></font>
                local_end = (host, interface)<font></font>
                remote_end = (<font></font>
                    neighbor[<span class="hljs-string">'remote_system_name'</span>],<font></font>
                    if_fullname(neighbor[<span class="hljs-string">'remote_port'</span>])<font></font>
                )<font></font>
                <span class="hljs-comment">#   ,     </span>
                <span class="hljs-comment">#     .</span><font></font>
                link_is_already_there = (<font></font>
                    (local_end, remote_end) <span class="hljs-keyword">in</span> global_interconnections
                    <span class="hljs-keyword">or</span> (remote_end, local_end) <span class="hljs-keyword">in</span> global_interconnections<font></font>
                )<font></font>
                <span class="hljs-keyword">if</span> link_is_already_there:
                    <span class="hljs-keyword">continue</span><font></font>
                global_interconnections.append((<font></font>
                    (host, interface),<font></font>
                    (neighbor[<span class="hljs-string">'remote_system_name'</span>], if_fullname(neighbor[<span class="hljs-string">'remote_port'</span>]))<font></font>
                ))<font></font>
    <span class="hljs-keyword">return</span> [discovered_hosts, global_interconnections, lldp_capabilities_dict]</code></pre><br>
<h3 id="inicializaciya-prilozheniya-next-ui">  NeXt UI</h3><br>
<p>        <b>next_app.js</b>   NeXt UI.<br>
   :</p><br>
<pre><code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nx</span>) </span>{
    <span class="hljs-comment">/**
     *   NeXt UI
     */</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> topo = <span class="hljs-keyword">new</span> nx.graphic.Topology({
        <span class="hljs-comment">//    view </span>
        <span class="hljs-attr">width</span>: <span class="hljs-number">1200</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-number">700</span>,
        <span class="hljs-comment">//  ,    .</span>
        <span class="hljs-comment">// 'force'      </span>
        <span class="hljs-comment">//    . 'quick'  </span>
        <span class="hljs-comment">//   </span>
        <span class="hljs-attr">dataProcessor</span>: <span class="hljs-string">'force'</span>,
        <span class="hljs-comment">//     </span>
        <span class="hljs-attr">identityKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-comment">//  </span>
        <span class="hljs-attr">nodeConfig</span>: {
            <span class="hljs-attr">label</span>: <span class="hljs-string">'model.name'</span>,
            <span class="hljs-attr">iconType</span>:<span class="hljs-string">'model.icon'</span>,<font></font>
        },<font></font>
        <span class="hljs-comment">//  </span>
        <span class="hljs-attr">linkConfig</span>: {
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//    'parallel'</span>
            <span class="hljs-attr">linkType</span>: <span class="hljs-string">'curve'</span>,<font></font>
        },<font></font>
        <span class="hljs-comment">//   ,  false  </span>
        <span class="hljs-attr">showIcon</span>: <span class="hljs-literal">true</span>,<font></font>
    });<font></font>
<font></font>
    <span class="hljs-keyword">var</span> Shell = nx.define(nx.ui.Application, {
        <span class="hljs-attr">methods</span>: {
            <span class="hljs-attr">start</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-comment">//     </span><font></font>
                topo.data(topologyData);<font></font>
                <span class="hljs-comment">//     </span>
                topo.attach(<span class="hljs-keyword">this</span>);<font></font>
            }<font></font>
        }<font></font>
    });<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> shell = <span class="hljs-keyword">new</span> Shell();
    <span class="hljs-comment">//  </span><font></font>
    shell.start();<font></font>
})(nx);</code></pre><br>
<p>    <b>topologyData</b>,      <b>topology.js</b>.     .<br>
</p><br>
<p>      HTML ,     :</p><br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"next_sources/css/next.css"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"styles_main_page.css"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"next_sources/js/next.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"topology.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"next_app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br>
<h3 id="formirovanie-topologii-dlya-next-ui-v-python">   NeXT UI  Python</h3><br>
<p>               Python.<br>
   :</p><br>
<pre><code class="python hljs">GLOBAL_LLDP_DATA, GLOBAL_FACTS = normalize_result(get_host_data_result)<font></font>
TOPOLOGY_DETAILS = extract_lldp_details(GLOBAL_LLDP_DATA)</code></pre><br>
<p>    NeXt UI  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-comment">//       </span>
<span class="hljs-keyword">var</span> topologyData = {
    <span class="hljs-string">"links"</span>: [<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">1</span>,<font></font>
        }, {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">1</span>,<font></font>
        }<font></font>
    ],<font></font>
    <span class="hljs-string">"nodes"</span>: [<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"router"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">0</span>,<font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"router"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,<font></font>
        }<font></font>
    ]</code></pre><br>
<p> ,  JSON ,       :<br>
{'nodes': [], 'links': []}  Python.<br>
     . <br>
         ,  capabilities  LLDP     ,    . <br>
       FACTS  (,    ),      .</p><br>
<pre><code class="python hljs">icon_capability_map = {
    <span class="hljs-string">'router'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'switch'</span>: <span class="hljs-string">'switch'</span>,
    <span class="hljs-string">'bridge'</span>: <span class="hljs-string">'switch'</span>,
    <span class="hljs-string">'station'</span>: <span class="hljs-string">'host'</span><font></font>
}<font></font>
<font></font>
icon_model_map = {<font></font>
    <span class="hljs-string">'CSR1000V'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'Nexus'</span>: <span class="hljs-string">'switch'</span>,
    <span class="hljs-string">'IOSXRv'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'IOSv'</span>: <span class="hljs-string">'switch'</span>,
    <span class="hljs-string">'2901'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'2911'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'2921'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'2951'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'4321'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'4331'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'4351'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'4421'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'4431'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'4451'</span>: <span class="hljs-string">'router'</span>,
    <span class="hljs-string">'2960'</span>: <span class="hljs-string">'switch'</span>,
    <span class="hljs-string">'3750'</span>: <span class="hljs-string">'switch'</span>,
    <span class="hljs-string">'3850'</span>: <span class="hljs-string">'switch'</span>,<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_icon_type</span>(<span class="hljs-params">device_cap_name, device_model=<span class="hljs-string">''</span></span>):</span>
    <span class="hljs-string">"""
         .
       LLDP capabilities.
           ,
        .
           'unknown'.
    """</span>
    <span class="hljs-keyword">if</span> device_cap_name:<font></font>
        icon_type = icon_capability_map.get(device_cap_name)<font></font>
        <span class="hljs-keyword">if</span> icon_type:
            <span class="hljs-keyword">return</span> icon_type
    <span class="hljs-keyword">if</span> device_model:
        <span class="hljs-comment">#      icon_model_map</span>
        <span class="hljs-comment">#       </span>
        <span class="hljs-keyword">for</span> model_shortname, icon_type <span class="hljs-keyword">in</span> icon_model_map.items():
            <span class="hljs-keyword">if</span> model_shortname <span class="hljs-keyword">in</span> device_model:
                <span class="hljs-keyword">return</span> icon_type
    <span class="hljs-keyword">return</span> <span class="hljs-string">'unknown'</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_topology_json</span>(<span class="hljs-params">*args</span>):</span>
    <span class="hljs-string">"""
     JSON- .
             ,
      LLDP capabilities    
    ,       
             .
    """</span><font></font>
    discovered_hosts, interconnections, lldp_capabilities_dict, facts = args<font></font>
    host_id = <span class="hljs-number">0</span><font></font>
    host_id_map = {}<font></font>
    topology_dict = {<span class="hljs-string">'nodes'</span>: [], <span class="hljs-string">'links'</span>: []}
    <span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> discovered_hosts:<font></font>
        device_model = <span class="hljs-string">'n/a'</span>
        device_serial = <span class="hljs-string">'n/a'</span>
        device_ip = <span class="hljs-string">'n/a'</span>
        <span class="hljs-keyword">if</span> facts.get(host):<font></font>
            device_model = facts[host].get(<span class="hljs-string">'model'</span>, <span class="hljs-string">'n/a'</span>)<font></font>
            device_serial = facts[host].get(<span class="hljs-string">'serial_number'</span>, <span class="hljs-string">'n/a'</span>)<font></font>
            device_ip = facts[host].get(<span class="hljs-string">'nr_ip'</span>, <span class="hljs-string">'n/a'</span>)<font></font>
        host_id_map[host] = host_id<font></font>
        topology_dict[<span class="hljs-string">'nodes'</span>].append({
            <span class="hljs-string">'id'</span>: host_id,
            <span class="hljs-string">'name'</span>: host,
            <span class="hljs-string">'primaryIP'</span>: device_ip,
            <span class="hljs-string">'model'</span>: device_model,
            <span class="hljs-string">'serial_number'</span>: device_serial,
            <span class="hljs-string">'icon'</span>: get_icon_type(<font></font>
                lldp_capabilities_dict.get(host, <span class="hljs-string">''</span>),<font></font>
                device_model<font></font>
            )<font></font>
        })<font></font>
        host_id += <span class="hljs-number">1</span>
    link_id = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> interconnections:<font></font>
        topology_dict[<span class="hljs-string">'links'</span>].append({
            <span class="hljs-string">'id'</span>: link_id,
            <span class="hljs-string">'source'</span>: host_id_map[link[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]],
            <span class="hljs-string">'target'</span>: host_id_map[link[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]],
            <span class="hljs-string">'srcIfName'</span>: if_shortname(link[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]),
            <span class="hljs-string">'srcDevice'</span>: link[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>],
            <span class="hljs-string">'tgtIfName'</span>: if_shortname(link[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]),
            <span class="hljs-string">'tgtDevice'</span>: link[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>],<font></font>
        })<font></font>
        link_id += <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> topology_dict</code></pre><br>
<p>   ,      <b>topology.js</b>,    <b>json</b>      :</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> json<font></font>
<font></font>
OUTPUT_TOPOLOGY_FILENAME = <span class="hljs-string">'topology.js'</span>
TOPOLOGY_FILE_HEAD = <span class="hljs-string">"\n\nvar topologyData = "</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_topology_file</span>(<span class="hljs-params">topology_json, header=TOPOLOGY_FILE_HEAD, dst=OUTPUT_TOPOLOGY_FILENAME</span>):</span>
    <span class="hljs-keyword">with</span> open(dst, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> topology_file:<font></font>
        topology_file.write(header)<font></font>
        topology_file.write(json.dumps(topology_json, indent=<span class="hljs-number">4</span>, sort_keys=<span class="hljs-literal">True</span>))<font></font>
        topology_file.write(<span class="hljs-string">';'</span>)<font></font>
<font></font>
TOPOLOGY_DICT = generate_topology_json(*TOPOLOGY_DETAILS)<font></font>
write_topology_file(TOPOLOGY_DICT)</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">   topology.js</b>
                        <div class="spoiler_text"><pre><code class="javascript hljs">
<span class="hljs-keyword">var</span> topologyData = {
    <span class="hljs-string">"links"</span>: [<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"edge-sw01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi0/2"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">5</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"core-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Gi0/0/0/1"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"edge-sw01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi0/3"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"core-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Gi0/0/0/1"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi3"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"core-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Gi0/0/0/2"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi4"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"dist-sw01.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Eth1/3"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi6"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"dist-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Gi6"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">5</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi5"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"dist-sw02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Eth1/3"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">6</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi2"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">5</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"core-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Gi0/0/0/2"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi3"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"core-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Gi0/0/0/3"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">8</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi4"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"dist-sw01.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Eth1/4"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">9</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi5"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"dist-sw02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Eth1/4"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">10</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Gi2"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">5</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"core-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Gi0/0/0/3"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">11</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-sw01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Eth1/1"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"dist-sw02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Eth1/1"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"id"</span>: <span class="hljs-number">12</span>,
            <span class="hljs-string">"source"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"srcDevice"</span>: <span class="hljs-string">"dist-sw01.devnet.lab"</span>,
            <span class="hljs-string">"srcIfName"</span>: <span class="hljs-string">"Eth1/2"</span>,
            <span class="hljs-string">"target"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"tgtDevice"</span>: <span class="hljs-string">"dist-sw02.devnet.lab"</span>,
            <span class="hljs-string">"tgtIfName"</span>: <span class="hljs-string">"Eth1/2"</span><font></font>
        }<font></font>
    ],<font></font>
    <span class="hljs-string">"nodes"</span>: [<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"router"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"CSR1000V"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"dist-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"9YZKNQKQ566"</span>,
            <span class="hljs-string">"layerSortPreference"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-string">"primaryIP"</span>: <span class="hljs-string">"10.10.20.176"</span>,
            <span class="hljs-string">"dcimDeviceLink"</span>: <span class="hljs-string">"http://localhost:32768/dcim/devices/?q=dist-rtr02.devnet.lab"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"switch"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"Nexus9000 9000v Chassis"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"dist-sw01.devnet.lab"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"9MZLNM0ZC9Z"</span>,<font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"switch"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"Nexus9000 9000v Chassis"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"dist-sw02.devnet.lab"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"93LCGCRUJA5"</span>,<font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"router"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"n/a"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"core-rtr02.devnet.lab"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"n/a"</span>,<font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"router"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"CSR1000V"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"dist-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"9S78ZRF2V2B"</span>,<font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"router"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">5</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"n/a"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"core-rtr01.devnet.lab"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"n/a"</span>,<font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"router"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">6</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"CSR1000V"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"internet-rtr01.virl.info"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"9LGWPM8GTV6"</span>,<font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"switch"</span>,
            <span class="hljs-string">"id"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"IOSv"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"edge-sw01.devnet.lab"</span>,
            <span class="hljs-string">"serial_number"</span>: <span class="hljs-string">"927A4RELIGI"</span>,<font></font>
        }<font></font>
    ]<font></font>
};</code></pre></div>
                    </div><br>
<p> main.html     Hello World:</p><br>
<p><img src="https://habrastorage.org/webt/h_/bo/k-/h_bok-ejmfmzhxj9ppjhrjub2hk.png"></p><br>
<p>  .      .<br>
        ,          NeXt UI   ,        :</p><br>
<p><img src="https://habrastorage.org/webt/d8/hn/j1/d8hnj1fe0u5xduawmcw5ce2t720.png"></p><br>
<p> ,   .    ,      .</p><br>
<h1 id="poisk-i-vizualizaciya-izmeneniy-v-topologii">     </h1><br>
<p>         .<br>
  . ,   :</p><br>
<ul>
<li> <b>cached_topology.json</b>     .<br>
      <strong>generate_topology.py</strong>       .</li>
<li> <strong>diff_topology.js</strong>     .</li>
<li> <strong>diff_page.html</strong>    .</li>
</ul><br>
<p>HTML-  :</p><br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"next_sources/css/next.css"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"styles_main_page.css"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"next_sources/js/next.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"diff_topology.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"next_app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"main.html"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br>
<p>       :</p><br>
<pre><code class="python hljs">CACHED_TOPOLOGY_FILENAME = <span class="hljs-string">'cached_topology.json'</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_topology_cache</span>(<span class="hljs-params">topology_json, dst=CACHED_TOPOLOGY_FILENAME</span>):</span>
    <span class="hljs-keyword">with</span> open(dst, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> cached_file:<font></font>
        cached_file.write(json.dumps(topology_json, indent=<span class="hljs-number">4</span>, sort_keys=<span class="hljs-literal">True</span>))<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_cached_topology</span>(<span class="hljs-params">filename=CACHED_TOPOLOGY_FILENAME</span>):</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(filename):
        <span class="hljs-keyword">return</span> {}
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(filename):
        <span class="hljs-keyword">return</span> {}<font></font>
    cached_topology = {}<font></font>
    <span class="hljs-keyword">with</span> open(filename, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> file:
        <span class="hljs-keyword">try</span>:<font></font>
            cached_topology = json.loads(file.read())<font></font>
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">return</span> {}
    <span class="hljs-keyword">return</span> cached_topology</code></pre><br>
<p>      :</p><br>
<ol>
<li>             .<br>
  :<br>
(      , (,))<br>
  :<br>
(      , (_,  ), ( , _))<br>
            .</li>
<li>          (   -).<br>
        :<br>
<ul>
<li>diff_nodes = {'added': [], 'deleted': []}</li>
<li>diff_links = {'added': [], 'deleted': []}</li>
</ul></li>
<li>         .<br>
      diff_merged_topology.<br>
                    is_new  is_dead.<br>
          'dead_node' ( NeXt UI   ).<br>
</li>
</ol><br>
<p>    :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_topology_diff</span>(<span class="hljs-params">cached, current</span>):</span>
    <span class="hljs-string">"""
        .
            
    .       
       ,      
        
      .
    """</span>
    diff_nodes = {<span class="hljs-string">'added'</span>: [], <span class="hljs-string">'deleted'</span>: []}<font></font>
    diff_links = {<span class="hljs-string">'added'</span>: [], <span class="hljs-string">'deleted'</span>: []}<font></font>
    diff_merged_topology = {<span class="hljs-string">'nodes'</span>: [], <span class="hljs-string">'links'</span>: []}
    <span class="hljs-comment">#       :</span>
    <span class="hljs-comment"># (, (_,  ), ( , _))</span>
    cached_links = [(x, ((x[<span class="hljs-string">'srcDevice'</span>], x[<span class="hljs-string">'srcIfName'</span>]), (x[<span class="hljs-string">'tgtDevice'</span>], x[<span class="hljs-string">'tgtIfName'</span>]))) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cached[<span class="hljs-string">'links'</span>]]<font></font>
    links = [(x, ((x[<span class="hljs-string">'srcDevice'</span>], x[<span class="hljs-string">'srcIfName'</span>]), (x[<span class="hljs-string">'tgtDevice'</span>], x[<span class="hljs-string">'tgtIfName'</span>]))) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> current[<span class="hljs-string">'links'</span>]]
    <span class="hljs-comment">#       :</span>
    <span class="hljs-comment"># ( , (,))</span>
    <span class="hljs-comment">#           .</span>
    cached_nodes = [(x, (x[<span class="hljs-string">'name'</span>],)) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cached[<span class="hljs-string">'nodes'</span>]]<font></font>
    nodes = [(x, (x[<span class="hljs-string">'name'</span>],)) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> current[<span class="hljs-string">'nodes'</span>]]
    <span class="hljs-comment">#        .</span>
    node_id = <span class="hljs-number">0</span><font></font>
    host_id_map = {}<font></font>
    <span class="hljs-keyword">for</span> raw_data, node <span class="hljs-keyword">in</span> nodes:
        <span class="hljs-keyword">if</span> node <span class="hljs-keyword">in</span> [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cached_nodes]:<font></font>
            raw_data[<span class="hljs-string">'id'</span>] = node_id<font></font>
            host_id_map[raw_data[<span class="hljs-string">'name'</span>]] = node_id<font></font>
            raw_data[<span class="hljs-string">'is_new'</span>] = <span class="hljs-string">'no'</span>
            raw_data[<span class="hljs-string">'is_dead'</span>] = <span class="hljs-string">'no'</span>
            diff_merged_topology[<span class="hljs-string">'nodes'</span>].append(raw_data)<font></font>
            node_id += <span class="hljs-number">1</span>
            <span class="hljs-keyword">continue</span>
        diff_nodes[<span class="hljs-string">'added'</span>].append(node)<font></font>
        raw_data[<span class="hljs-string">'id'</span>] = node_id<font></font>
        host_id_map[raw_data[<span class="hljs-string">'name'</span>]] = node_id<font></font>
        raw_data[<span class="hljs-string">'is_new'</span>] = <span class="hljs-string">'yes'</span>
        raw_data[<span class="hljs-string">'is_dead'</span>] = <span class="hljs-string">'no'</span>
        diff_merged_topology[<span class="hljs-string">'nodes'</span>].append(raw_data)<font></font>
        node_id += <span class="hljs-number">1</span>
    <span class="hljs-keyword">for</span> raw_data, cached_node <span class="hljs-keyword">in</span> cached_nodes:
        <span class="hljs-keyword">if</span> cached_node <span class="hljs-keyword">in</span> [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> nodes]:
            <span class="hljs-keyword">continue</span>
        diff_nodes[<span class="hljs-string">'deleted'</span>].append(cached_node)<font></font>
        raw_data[<span class="hljs-string">'id'</span>] = node_id<font></font>
        host_id_map[raw_data[<span class="hljs-string">'name'</span>]] = node_id<font></font>
        raw_data[<span class="hljs-string">'is_new'</span>] = <span class="hljs-string">'no'</span>
        raw_data[<span class="hljs-string">'is_dead'</span>] = <span class="hljs-string">'yes'</span>
        raw_data[<span class="hljs-string">'icon'</span>] = <span class="hljs-string">'dead_node'</span>
        diff_merged_topology[<span class="hljs-string">'nodes'</span>].append(raw_data)<font></font>
        node_id += <span class="hljs-number">1</span>
    <span class="hljs-comment">#        .</span>
    <span class="hljs-comment">#      </span>
    <span class="hljs-comment">#       .</span>
    <span class="hljs-comment">#      </span>
    <span class="hljs-comment">#       :</span>
    <span class="hljs-comment"># ((h1, Gi1), (h2, Gi2))  ((h2, Gi2), (h1, Gi1)) -   .</span>
    link_id = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> raw_data, link <span class="hljs-keyword">in</span> links:<font></font>
        src, dst = link<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (src, dst) <span class="hljs-keyword">in</span> [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cached_links] <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> (dst, src) <span class="hljs-keyword">in</span> [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cached_links]:<font></font>
            diff_links[<span class="hljs-string">'added'</span>].append((src, dst))<font></font>
            raw_data[<span class="hljs-string">'id'</span>] = link_id<font></font>
            link_id += <span class="hljs-number">1</span>
            raw_data[<span class="hljs-string">'source'</span>] = host_id_map[src[<span class="hljs-number">0</span>]]<font></font>
            raw_data[<span class="hljs-string">'target'</span>] = host_id_map[dst[<span class="hljs-number">0</span>]]<font></font>
            raw_data[<span class="hljs-string">'is_new'</span>] = <span class="hljs-string">'yes'</span>
            raw_data[<span class="hljs-string">'is_dead'</span>] = <span class="hljs-string">'no'</span>
            diff_merged_topology[<span class="hljs-string">'links'</span>].append(raw_data)
            <span class="hljs-keyword">continue</span>
        raw_data[<span class="hljs-string">'id'</span>] = link_id<font></font>
        link_id += <span class="hljs-number">1</span>
        raw_data[<span class="hljs-string">'source'</span>] = host_id_map[src[<span class="hljs-number">0</span>]]<font></font>
        raw_data[<span class="hljs-string">'target'</span>] = host_id_map[dst[<span class="hljs-number">0</span>]]<font></font>
        raw_data[<span class="hljs-string">'is_new'</span>] = <span class="hljs-string">'no'</span>
        raw_data[<span class="hljs-string">'is_dead'</span>] = <span class="hljs-string">'no'</span>
        diff_merged_topology[<span class="hljs-string">'links'</span>].append(raw_data)
    <span class="hljs-keyword">for</span> raw_data, link <span class="hljs-keyword">in</span> cached_links:<font></font>
        src, dst = link<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (src, dst) <span class="hljs-keyword">in</span> [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> links] <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> (dst, src) <span class="hljs-keyword">in</span> [x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> links]:<font></font>
            diff_links[<span class="hljs-string">'deleted'</span>].append((src, dst))<font></font>
            raw_data[<span class="hljs-string">'id'</span>] = link_id<font></font>
            link_id += <span class="hljs-number">1</span>
            raw_data[<span class="hljs-string">'source'</span>] = host_id_map[src[<span class="hljs-number">0</span>]]<font></font>
            raw_data[<span class="hljs-string">'target'</span>] = host_id_map[dst[<span class="hljs-number">0</span>]]<font></font>
            raw_data[<span class="hljs-string">'is_new'</span>] = <span class="hljs-string">'no'</span>
            raw_data[<span class="hljs-string">'is_dead'</span>] = <span class="hljs-string">'yes'</span>
            diff_merged_topology[<span class="hljs-string">'links'</span>].append(raw_data)
    <span class="hljs-keyword">return</span> diff_nodes, diff_links, diff_merged_topology</code></pre><br>
<p>get_topology_diff         .<br>
           .<br>
        :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_diff</span>(<span class="hljs-params">diff_result</span>):</span>
    <span class="hljs-string">"""
       
     get_topology_diff  .
    """</span><font></font>
    diff_nodes, diff_links, *ignore = diff_result<font></font>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (diff_nodes[<span class="hljs-string">'added'</span>] <span class="hljs-keyword">or</span> diff_nodes[<span class="hljs-string">'deleted'</span>] <span class="hljs-keyword">or</span> diff_links[<span class="hljs-string">'added'</span>] <span class="hljs-keyword">or</span> diff_links[<span class="hljs-string">'deleted'</span>]):<font></font>
        print(<span class="hljs-string">'    .'</span>)
        <span class="hljs-keyword">return</span>
    print(<span class="hljs-string">'   :'</span>)
    <span class="hljs-keyword">if</span> diff_nodes[<span class="hljs-string">'added'</span>]:<font></font>
        print(<span class="hljs-string">''</span>)<font></font>
        print(<span class="hljs-string">'^^^^^^^^^^^^^^^^^^^^^^^^^^^^^'</span>)<font></font>
        print(<span class="hljs-string">'  :'</span>)<font></font>
        print(<span class="hljs-string">'vvvvvvvvvvvvvvvvvvvvvvvvvvvvv'</span>)
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> diff_nodes[<span class="hljs-string">'added'</span>]:<font></font>
            print(<span class="hljs-string">f' : <span class="hljs-subst">{node[<span class="hljs-number">0</span>]}</span>'</span>)
    <span class="hljs-keyword">if</span> diff_nodes[<span class="hljs-string">'deleted'</span>]:<font></font>
        print(<span class="hljs-string">''</span>)<font></font>
        print(<span class="hljs-string">'^^^^^^^^^^^^^^^^^^^^^^^^^^^^^'</span>)<font></font>
        print(<span class="hljs-string">'  :'</span>)<font></font>
        print(<span class="hljs-string">'vvvvvvvvvvvvvvvvvvvvvvvvvvvvv'</span>)
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> diff_nodes[<span class="hljs-string">'deleted'</span>]:<font></font>
            print(<span class="hljs-string">f' : <span class="hljs-subst">{node[<span class="hljs-number">0</span>]}</span>'</span>)
    <span class="hljs-keyword">if</span> diff_links[<span class="hljs-string">'added'</span>]:<font></font>
        print(<span class="hljs-string">''</span>)<font></font>
        print(<span class="hljs-string">'^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^'</span>)<font></font>
        print(<span class="hljs-string">'   :'</span>)<font></font>
        print(<span class="hljs-string">'vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv'</span>)
        <span class="hljs-keyword">for</span> src, dst <span class="hljs-keyword">in</span> diff_links[<span class="hljs-string">'added'</span>]:<font></font>
            print(<span class="hljs-string">f' <span class="hljs-subst">{src[<span class="hljs-number">0</span>]}</span>(<span class="hljs-subst">{src[<span class="hljs-number">1</span>]}</span>)  <span class="hljs-subst">{dst[<span class="hljs-number">0</span>]}</span>(<span class="hljs-subst">{dst[<span class="hljs-number">1</span>]}</span>)'</span>)
    <span class="hljs-keyword">if</span> diff_links[<span class="hljs-string">'deleted'</span>]:<font></font>
        print(<span class="hljs-string">''</span>)<font></font>
        print(<span class="hljs-string">'^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^'</span>)<font></font>
        print(<span class="hljs-string">'   :'</span>)<font></font>
        print(<span class="hljs-string">'vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv'</span>)
        <span class="hljs-keyword">for</span> src, dst <span class="hljs-keyword">in</span> diff_links[<span class="hljs-string">'deleted'</span>]:<font></font>
            print(<span class="hljs-string">f' <span class="hljs-subst">{src[<span class="hljs-number">0</span>]}</span>(<span class="hljs-subst">{src[<span class="hljs-number">1</span>]}</span>)  <span class="hljs-subst">{dst[<span class="hljs-number">0</span>]}</span>(<span class="hljs-subst">{dst[<span class="hljs-number">1</span>]}</span>)'</span>)<font></font>
    print(<span class="hljs-string">''</span>)</code></pre><br>
<p>        main()      :</p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">good_luck_have_fun</span>():</span>
    <span class="hljs-string">""",   ."""</span><font></font>
    get_host_data_result = nr.run(get_host_data)<font></font>
    GLOBAL_LLDP_DATA, GLOBAL_FACTS = normalize_result(get_host_data_result)<font></font>
    TOPOLOGY_DETAILS = extract_lldp_details(GLOBAL_LLDP_DATA)<font></font>
    TOPOLOGY_DETAILS.append(GLOBAL_FACTS)<font></font>
    TOPOLOGY_DICT = generate_topology_json(*TOPOLOGY_DETAILS)<font></font>
    CACHED_TOPOLOGY = read_cached_topology()<font></font>
    write_topology_file(TOPOLOGY_DICT)<font></font>
    write_topology_cache(TOPOLOGY_DICT)<font></font>
    print(<span class="hljs-string">f'     main.html'</span>)
    <span class="hljs-keyword">if</span> CACHED_TOPOLOGY:<font></font>
        DIFF_DATA = get_topology_diff(CACHED_TOPOLOGY, TOPOLOGY_DICT)<font></font>
        print_diff(DIFF_DATA)<font></font>
        write_topology_file(DIFF_DATA[<span class="hljs-number">2</span>], dst=<span class="hljs-string">'diff_topology.js'</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment">#    ,     </span>
        write_topology_file(TOPOLOGY_DICT, dst=<span class="hljs-string">'diff_topology.js'</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    good_luck_have_fun()</code></pre><br>
<h3 id="testirovanie"></h3><br>
<p>     dist-rtr01     :</p><br>
<p><img src="https://habrastorage.org/webt/en/o9/n_/eno9n_hfmleczhlhik2oye3l0ew.png"></p><br>
<p>     dist-rtr02,    edge-sw01.</p><br>
<p>   ,    :</p><br>
<p><img src="https://habrastorage.org/webt/wl/7e/pe/wl7epeuciuox-6deptnauipayzo.png"></p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> diff_topology.js    .</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">var topologyData = {<font></font>
    "links": [<font></font>
        {<font></font>
            "id": 0,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "yes",<font></font>
            "source": 4,<font></font>
            "srcDevice": "dist-rtr01.devnet.lab",<font></font>
            "srcIfName": "Gi3",<font></font>
            "target": 3,<font></font>
            "tgtDevice": "core-rtr02.devnet.lab",<font></font>
            "tgtIfName": "Gi0/0/0/2"<font></font>
        },<font></font>
        {<font></font>
            "id": 1,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "yes",<font></font>
            "source": 4,<font></font>
            "srcDevice": "dist-rtr01.devnet.lab",<font></font>
            "srcIfName": "Gi4",<font></font>
            "target": 1,<font></font>
            "tgtDevice": "dist-sw01.devnet.lab",<font></font>
            "tgtIfName": "Eth1/3"<font></font>
        },<font></font>
        {<font></font>
            "id": 2,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "yes",<font></font>
            "source": 4,<font></font>
            "srcDevice": "dist-rtr01.devnet.lab",<font></font>
            "srcIfName": "Gi6",<font></font>
            "target": 0,<font></font>
            "tgtDevice": "dist-rtr02.devnet.lab",<font></font>
            "tgtIfName": "Gi6"<font></font>
        },<font></font>
        {<font></font>
            "id": 3,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "yes",<font></font>
            "source": 4,<font></font>
            "srcDevice": "dist-rtr01.devnet.lab",<font></font>
            "srcIfName": "Gi5",<font></font>
            "target": 2,<font></font>
            "tgtDevice": "dist-sw02.devnet.lab",<font></font>
            "tgtIfName": "Eth1/3"<font></font>
        },<font></font>
        {<font></font>
            "id": 4,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "yes",<font></font>
            "source": 4,<font></font>
            "srcDevice": "dist-rtr01.devnet.lab",<font></font>
            "srcIfName": "Gi2",<font></font>
            "target": 5,<font></font>
            "tgtDevice": "core-rtr01.devnet.lab",<font></font>
            "tgtIfName": "Gi0/0/0/2"<font></font>
        },<font></font>
        {<font></font>
            "id": 5,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "source": 0,<font></font>
            "srcDevice": "dist-rtr02.devnet.lab",<font></font>
            "srcIfName": "Gi3",<font></font>
            "target": 3,<font></font>
            "tgtDevice": "core-rtr02.devnet.lab",<font></font>
            "tgtIfName": "Gi0/0/0/3"<font></font>
        },<font></font>
        {<font></font>
            "id": 6,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "source": 0,<font></font>
            "srcDevice": "dist-rtr02.devnet.lab",<font></font>
            "srcIfName": "Gi4",<font></font>
            "target": 1,<font></font>
            "tgtDevice": "dist-sw01.devnet.lab",<font></font>
            "tgtIfName": "Eth1/4"<font></font>
        },<font></font>
        {<font></font>
            "id": 7,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "source": 0,<font></font>
            "srcDevice": "dist-rtr02.devnet.lab",<font></font>
            "srcIfName": "Gi5",<font></font>
            "target": 2,<font></font>
            "tgtDevice": "dist-sw02.devnet.lab",<font></font>
            "tgtIfName": "Eth1/4"<font></font>
        },<font></font>
        {<font></font>
            "id": 8,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "source": 0,<font></font>
            "srcDevice": "dist-rtr02.devnet.lab",<font></font>
            "srcIfName": "Gi2",<font></font>
            "target": 5,<font></font>
            "tgtDevice": "core-rtr01.devnet.lab",<font></font>
            "tgtIfName": "Gi0/0/0/3"<font></font>
        },<font></font>
        {<font></font>
            "id": 9,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "source": 1,<font></font>
            "srcDevice": "dist-sw01.devnet.lab",<font></font>
            "srcIfName": "Eth1/1",<font></font>
            "target": 2,<font></font>
            "tgtDevice": "dist-sw02.devnet.lab",<font></font>
            "tgtIfName": "Eth1/1"<font></font>
        },<font></font>
        {<font></font>
            "id": 10,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "source": 1,<font></font>
            "srcDevice": "dist-sw01.devnet.lab",<font></font>
            "srcIfName": "Eth1/2",<font></font>
            "target": 2,<font></font>
            "tgtDevice": "dist-sw02.devnet.lab",<font></font>
            "tgtIfName": "Eth1/2"<font></font>
        },<font></font>
        {<font></font>
            "id": 11,<font></font>
            "is_dead": "yes",<font></font>
            "is_new": "no",<font></font>
            "source": 7,<font></font>
            "srcDevice": "edge-sw01.devnet.lab",<font></font>
            "srcIfName": "Gi0/2",<font></font>
            "target": 5,<font></font>
            "tgtDevice": "core-rtr01.devnet.lab",<font></font>
            "tgtIfName": "Gi0/0/0/1"<font></font>
        },<font></font>
        {<font></font>
            "id": 12,<font></font>
            "is_dead": "yes",<font></font>
            "is_new": "no",<font></font>
            "source": 7,<font></font>
            "srcDevice": "edge-sw01.devnet.lab",<font></font>
            "srcIfName": "Gi0/3",<font></font>
            "target": 3,<font></font>
            "tgtDevice": "core-rtr02.devnet.lab",<font></font>
            "tgtIfName": "Gi0/0/0/1"<font></font>
        }<font></font>
    ],<font></font>
    "nodes": [<font></font>
        {<font></font>
            "icon": "router",<font></font>
            "id": 0,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "model": "CSR1000V",<font></font>
            "name": "dist-rtr02.devnet.lab",<font></font>
            "serial_number": "9YZKNQKQ566",<font></font>
        },<font></font>
        {<font></font>
            "icon": "switch",<font></font>
            "id": 1,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "model": "Nexus9000 9000v Chassis",<font></font>
            "name": "dist-sw01.devnet.lab",<font></font>
            "serial_number": "9MZLNM0ZC9Z",<font></font>
        },<font></font>
        {<font></font>
            "icon": "switch",<font></font>
            "id": 2,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "model": "Nexus9000 9000v Chassis",<font></font>
            "name": "dist-sw02.devnet.lab",<font></font>
            "serial_number": "93LCGCRUJA5",<font></font>
        },<font></font>
        {<font></font>
            "icon": "router",<font></font>
            "id": 3,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "model": "n/a",<font></font>
            "name": "core-rtr02.devnet.lab",<font></font>
            "serial_number": "n/a",<font></font>
        },<font></font>
        {<font></font>
            "icon": "router",<font></font>
            "id": 4,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "yes",<font></font>
            "model": "CSR1000V",<font></font>
            "name": "dist-rtr01.devnet.lab",<font></font>
            "serial_number": "9S78ZRF2V2B",<font></font>
        },<font></font>
        {<font></font>
            "icon": "router",<font></font>
            "id": 5,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "model": "n/a",<font></font>
            "name": "core-rtr01.devnet.lab",<font></font>
            "serial_number": "n/a",<font></font>
        },<font></font>
        {<font></font>
            "icon": "unknown",<font></font>
            "id": 6,<font></font>
            "is_dead": "no",<font></font>
            "is_new": "no",<font></font>
            "model": "CSR1000V",<font></font>
            "name": "internet-rtr01.virl.info",<font></font>
            "serial_number": "9LGWPM8GTV6",<font></font>
        },<font></font>
        {<font></font>
            "icon": "dead_node",<font></font>
            "id": 7,<font></font>
            "is_dead": "yes",<font></font>
            "is_new": "no",<font></font>
            "model": "IOSv",<font></font>
            "name": "edge-sw01.devnet.lab",<font></font>
            "serial_number": "927A4RELIGI",<font></font>
        }<font></font>
    ]<font></font>
};</code></pre></div>
                    </div><br>
<p>          NeXt UI  next_app.js.<br>
   :</p><br>
<pre><code class="plaintext hljs">$ python3.7 generate_topology.py <font></font>
     main.html<font></font>
<font></font>
   :<font></font>
<font></font>
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<font></font>
  :<font></font>
vvvvvvvvvvvvvvvvvvvvvvvvvvvvv<font></font>
 : dist-rtr01.devnet.lab<font></font>
<font></font>
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<font></font>
  :<font></font>
vvvvvvvvvvvvvvvvvvvvvvvvvvvvv<font></font>
 : edge-sw01.devnet.lab<font></font>
<font></font>
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<font></font>
   :<font></font>
vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv<font></font>
 dist-rtr01.devnet.lab(Gi3)  core-rtr02.devnet.lab(Gi0/0/0/2)<font></font>
 dist-rtr01.devnet.lab(Gi4)  dist-sw01.devnet.lab(Eth1/3)<font></font>
 dist-rtr01.devnet.lab(Gi6)  dist-rtr02.devnet.lab(Gi6)<font></font>
 dist-rtr01.devnet.lab(Gi5)  dist-sw02.devnet.lab(Eth1/3)<font></font>
 dist-rtr01.devnet.lab(Gi2)  core-rtr01.devnet.lab(Gi0/0/0/2)<font></font>
<font></font>
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<font></font>
   :<font></font>
vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv<font></font>
 edge-sw01.devnet.lab(Gi0/2)  core-rtr01.devnet.lab(Gi0/0/0/1)<font></font>
 edge-sw01.devnet.lab(Gi0/3)  core-rtr02.devnet.lab(Gi0/0/0/1)<font></font>
<font></font>
        diff_page.html<font></font>
   main.html    '  </code></pre><br>
<p>   .</p><br>
<h1 id="dorabotka-prilozheniya-na-next-ui">   NeXt UI</h1><br>
<p>            NeXt UI.</p><br>
<h3 id="otobrazhenie-linkov"> </h3><br>
<p>        nx.graphic.Topology.Link:</p><br>
<pre><code class="javascript hljs">    nx.define(<span class="hljs-string">'CustomLinkClass'</span>, nx.graphic.Topology.Link, {
        <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">sourcelabel</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">targetlabel</span>: <span class="hljs-literal">null</span><font></font>
        },<font></font>
        <span class="hljs-attr">view</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>) </span>{<font></font>
            view.content.push({<font></font>
                <span class="hljs-attr">name</span>: <span class="hljs-string">'source'</span>,
                <span class="hljs-attr">type</span>: <span class="hljs-string">'nx.graphic.Text'</span>,
                <span class="hljs-attr">props</span>: {
                    <span class="hljs-string">'class'</span>: <span class="hljs-string">'sourcelabel'</span>,
                    <span class="hljs-string">'alignment-baseline'</span>: <span class="hljs-string">'text-after-edge'</span>,
                    <span class="hljs-string">'text-anchor'</span>: <span class="hljs-string">'start'</span><font></font>
                }<font></font>
            }, {<font></font>
                <span class="hljs-attr">name</span>: <span class="hljs-string">'target'</span>,
                <span class="hljs-attr">type</span>: <span class="hljs-string">'nx.graphic.Text'</span>,
                <span class="hljs-attr">props</span>: {
                    <span class="hljs-string">'class'</span>: <span class="hljs-string">'targetlabel'</span>,
                    <span class="hljs-string">'alignment-baseline'</span>: <span class="hljs-string">'text-after-edge'</span>,
                    <span class="hljs-string">'text-anchor'</span>: <span class="hljs-string">'end'</span><font></font>
                }<font></font>
            });<font></font>
            <span class="hljs-keyword">return</span> view;<font></font>
        },<font></font>
        <span class="hljs-attr">methods</span>: {
            <span class="hljs-attr">update</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.inherited();
                <span class="hljs-keyword">var</span> el, point;
                <span class="hljs-keyword">var</span> line = <span class="hljs-keyword">this</span>.line();
                <span class="hljs-keyword">var</span> angle = line.angle();
                <span class="hljs-keyword">var</span> stageScale = <span class="hljs-keyword">this</span>.stageScale();<font></font>
                line = line.pad(<span class="hljs-number">18</span> * stageScale, <span class="hljs-number">18</span> * stageScale);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.sourcelabel()) {<font></font>
                    el = <span class="hljs-keyword">this</span>.view(<span class="hljs-string">'source'</span>);<font></font>
                    point = line.start;<font></font>
                    el.set(<span class="hljs-string">'x'</span>, point.x);<font></font>
                    el.set(<span class="hljs-string">'y'</span>, point.y);<font></font>
                    el.set(<span class="hljs-string">'text'</span>, <span class="hljs-keyword">this</span>.sourcelabel());<font></font>
                    el.set(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate('</span> + angle + <span class="hljs-string">' '</span> + point.x + <span class="hljs-string">','</span> + point.y + <span class="hljs-string">')'</span>);<font></font>
                    el.setStyle(<span class="hljs-string">'font-size'</span>, <span class="hljs-number">12</span> * stageScale);<font></font>
                }<font></font>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.targetlabel()) {<font></font>
                    el = <span class="hljs-keyword">this</span>.view(<span class="hljs-string">'target'</span>);<font></font>
                    point = line.end;<font></font>
                    el.set(<span class="hljs-string">'x'</span>, point.x);<font></font>
                    el.set(<span class="hljs-string">'y'</span>, point.y);<font></font>
                    el.set(<span class="hljs-string">'text'</span>, <span class="hljs-keyword">this</span>.targetlabel());<font></font>
                    el.set(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate('</span> + angle + <span class="hljs-string">' '</span> + point.x + <span class="hljs-string">','</span> + point.y + <span class="hljs-string">')'</span>);<font></font>
                    el.setStyle(<span class="hljs-string">'font-size'</span>, <span class="hljs-number">12</span> * stageScale);<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    });</code></pre><br>
<p>         <strong>topo</strong>.<br>
 ,      ,     .</p><br>
<pre><code class="javascript hljs">linkConfig: {
    <span class="hljs-comment">//    ,</span>
    <span class="hljs-comment">//    'parallel'</span>
    <span class="hljs-attr">linkType</span>: <span class="hljs-string">'curve'</span>,
    <span class="hljs-attr">sourcelabel</span>: <span class="hljs-string">'model.srcIfName'</span>,
    <span class="hljs-attr">targetlabel</span>: <span class="hljs-string">'model.tgtIfName'</span>,
    <span class="hljs-attr">style</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
        <span class="hljs-keyword">if</span> (model._data.is_dead === <span class="hljs-string">'yes'</span>) {
            <span class="hljs-keyword">return</span> { <span class="hljs-string">'stroke-dasharray'</span>: <span class="hljs-string">'5'</span> }<font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-attr">color</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
        <span class="hljs-keyword">if</span> (model._data.is_dead === <span class="hljs-string">'yes'</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'#E40039'</span><font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (model._data.is_new === <span class="hljs-string">'yes'</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'#148D09'</span><font></font>
        }<font></font>
    },<font></font>
},</code></pre><br>
<h3 id="dobavlenie-kastomnyh-piktogramm">  </h3><br>
<p>   NeXt       .<br>
    .     .<br>
         :</p><br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     ./img/dead_node.png</span>
topo.registerIcon(<span class="hljs-string">"dead_node"</span>, <span class="hljs-string">"img/dead_node.png"</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>);</code></pre><br>
<h3 id="minutka-vizualizacii-izmeneniy">  </h3><br>
<p>       <strong>diff_page.html</strong>       :</p><br>
<p><img src="https://habrastorage.org/webt/yw/v6/zk/ywv6zkwkzsfn8euzb_rmlqmabq4.png"></p><br>
<p>.  ?</p><br>
<h3 id="izmenenie-otobrazheniya-vypadayuschih-menyu">   </h3><br>
<p>       .<br>
      NeXt UI.<br>
   :</p><br>
<ul>
<li>  .</li>
<li>    (,    NetBox)      .<br>
      dcimDeviceLink.<br>
      .      .</li>
<li> IP-,     .</li>
</ul><br>
<p>     nx.ui.Component     :</p><br>
<pre><code class="javascript hljs">    nx.define(<span class="hljs-string">'CustomNodeTooltip'</span>, nx.ui.Component, {
        <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">node</span>: {},
            <span class="hljs-attr">topology</span>: {}<font></font>
        },<font></font>
        <span class="hljs-attr">view</span>: {
            <span class="hljs-attr">content</span>: [{
                <span class="hljs-attr">tag</span>: <span class="hljs-string">'div'</span>,
                <span class="hljs-attr">content</span>: [{
                    <span class="hljs-attr">tag</span>: <span class="hljs-string">'h5'</span>,
                    <span class="hljs-attr">content</span>: [{
                        <span class="hljs-attr">tag</span>: <span class="hljs-string">'a'</span>,
                        <span class="hljs-attr">content</span>: <span class="hljs-string">'{#node.model.name}'</span>,
                        <span class="hljs-attr">props</span>: {<span class="hljs-string">"href"</span>: <span class="hljs-string">"{#node.model.dcimDeviceLink}"</span>}<font></font>
                    }],<font></font>
                    <span class="hljs-attr">props</span>: {
                        <span class="hljs-string">"style"</span>: <span class="hljs-string">"border-bottom: dotted 1px; font-size:90%; word-wrap:normal; color:#003688"</span><font></font>
                    }<font></font>
                }, {<font></font>
                    <span class="hljs-attr">tag</span>: <span class="hljs-string">'p'</span>,
                    <span class="hljs-attr">content</span>: [<font></font>
                        {<font></font>
                        <span class="hljs-attr">tag</span>: <span class="hljs-string">'label'</span>,
                        <span class="hljs-attr">content</span>: <span class="hljs-string">'IP: '</span>,<font></font>
                    }, {<font></font>
                        <span class="hljs-attr">tag</span>: <span class="hljs-string">'label'</span>,
                        <span class="hljs-attr">content</span>: <span class="hljs-string">'{#node.model.primaryIP}'</span>,<font></font>
                    }<font></font>
                    ],<font></font>
                    <span class="hljs-attr">props</span>: {
                        <span class="hljs-string">"style"</span>: <span class="hljs-string">"font-size:80%;"</span><font></font>
                    }<font></font>
                },{<font></font>
                    <span class="hljs-attr">tag</span>: <span class="hljs-string">'p'</span>,
                    <span class="hljs-attr">content</span>: [<font></font>
                        {<font></font>
                        <span class="hljs-attr">tag</span>: <span class="hljs-string">'label'</span>,
                        <span class="hljs-attr">content</span>: <span class="hljs-string">'Model: '</span>,<font></font>
                    }, {<font></font>
                        <span class="hljs-attr">tag</span>: <span class="hljs-string">'label'</span>,
                        <span class="hljs-attr">content</span>: <span class="hljs-string">'{#node.model.model}'</span>,<font></font>
                    }<font></font>
                    ],<font></font>
                    <span class="hljs-attr">props</span>: {
                        <span class="hljs-string">"style"</span>: <span class="hljs-string">"font-size:80%;"</span><font></font>
                    }<font></font>
                }, {<font></font>
                    <span class="hljs-attr">tag</span>: <span class="hljs-string">'p'</span>,
                    <span class="hljs-attr">content</span>: [{
                        <span class="hljs-attr">tag</span>: <span class="hljs-string">'label'</span>,
                        <span class="hljs-attr">content</span>: <span class="hljs-string">'S/N: '</span>,<font></font>
                    }, {<font></font>
                        <span class="hljs-attr">tag</span>: <span class="hljs-string">'label'</span>,
                        <span class="hljs-attr">content</span>: <span class="hljs-string">'{#node.model.serial_number}'</span>,<font></font>
                    }],<font></font>
                    <span class="hljs-attr">props</span>: {
                        <span class="hljs-string">"style"</span>: <span class="hljs-string">"font-size:80%; padding:0"</span><font></font>
                    }<font></font>
                },<font></font>
            ],<font></font>
            <span class="hljs-attr">props</span>: {
                <span class="hljs-string">"style"</span>: <span class="hljs-string">"width: 150px;"</span><font></font>
            }<font></font>
        }]<font></font>
        }<font></font>
    });<font></font>
<font></font>
    nx.define(<span class="hljs-string">'Tooltip.Node'</span>, nx.ui.Component, {
        <span class="hljs-attr">view</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>)</span>{<font></font>
            view.content.push({<font></font>
            });<font></font>
            <span class="hljs-keyword">return</span> view;<font></font>
        },<font></font>
        <span class="hljs-attr">methods</span>: {
            <span class="hljs-attr">attach</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>{
                <span class="hljs-keyword">this</span>.inherited(args);
                <span class="hljs-keyword">this</span>.model();<font></font>
            }<font></font>
        }<font></font>
    });</code></pre><br>
<p>       <strong>topo</strong>:</p><br>
<pre><code class="javascript hljs">tooltipManagerConfig: {
    <span class="hljs-comment">//  tooltip content (    )</span>
    <span class="hljs-attr">nodeTooltipContentClass</span>: <span class="hljs-string">'CustomNodeTooltip'</span>
},</code></pre><br>
<p>      :</p><br>
<p><img src="https://habrastorage.org/webt/hx/he/kl/hxheklf6kvjmz29kq48g38lu6qu.png"></p><br>
<h3 id="izmenenie-orientacii-nod-v-prostranstve">    </h3><br>
<p>   ,     'force'    NeXt UI.        ,       .</p><br>
<p>                     . , ,   ,     .</p><br>
<p> NeXt UI      .</p><br>
<p>          <strong>layerSortPreference</strong>.</p><br>
<p>            ,         ,   .</p><br>
<p>      :</p><br>
<pre><code class="javascript hljs">    <span class="hljs-keyword">var</span> currentLayout = <span class="hljs-string">'auto'</span>
    horizontal = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (currentLayout === <span class="hljs-string">'horizontal'</span>) {
            <span class="hljs-keyword">return</span>;<font></font>
        };<font></font>
        currentLayout = <span class="hljs-string">'horizontal'</span>;
        <span class="hljs-keyword">var</span> layout = topo.getLayout(<span class="hljs-string">'hierarchicalLayout'</span>);<font></font>
        layout.direction(<span class="hljs-string">'horizontal'</span>);<font></font>
        layout.levelBy(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node, model</span>) </span>{
            <span class="hljs-keyword">return</span> model.get(<span class="hljs-string">'layerSortPreference'</span>);<font></font>
        });<font></font>
        topo.activateLayout(<span class="hljs-string">'hierarchicalLayout'</span>);<font></font>
    };<font></font>
    vertical = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (currentLayout === <span class="hljs-string">'vertical'</span>) {
            <span class="hljs-keyword">return</span>;<font></font>
        };<font></font>
        currentLayout = <span class="hljs-string">'vertical'</span>;
        <span class="hljs-keyword">var</span> layout = topo.getLayout(<span class="hljs-string">'hierarchicalLayout'</span>);<font></font>
        layout.direction(<span class="hljs-string">'vertical'</span>);<font></font>
        layout.levelBy(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node, model</span>) </span>{
          <span class="hljs-keyword">return</span> model.get(<span class="hljs-string">'layerSortPreference'</span>);<font></font>
        });<font></font>
        topo.activateLayout(<span class="hljs-string">'hierarchicalLayout'</span>);<font></font>
    };</code></pre><br>
<p>       main.html  diff_page.html:</p><br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">'horizontal()'</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"vertical()"</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></code></pre><br>
<p>  <strong>generate_topology.py</strong>            :</p><br>
<pre><code class="python hljs">NX_LAYER_SORT_ORDER = (
    <span class="hljs-string">'undefined'</span>,
    <span class="hljs-string">'outside'</span>,
    <span class="hljs-string">'edge-switch'</span>,
    <span class="hljs-string">'edge-router'</span>,
    <span class="hljs-string">'core-router'</span>,
    <span class="hljs-string">'core-switch'</span>,
    <span class="hljs-string">'distribution-router'</span>,
    <span class="hljs-string">'distribution-switch'</span>,
    <span class="hljs-string">'leaf'</span>,
    <span class="hljs-string">'spine'</span>,
    <span class="hljs-string">'access-switch'</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_node_layer_sort_preference</span>(<span class="hljs-params">device_role</span>):</span>
    <span class="hljs-keyword">for</span> i, role <span class="hljs-keyword">in</span> enumerate(NX_LAYER_SORT_ORDER, start=<span class="hljs-number">1</span>):
        <span class="hljs-keyword">if</span> device_role == role:
            <span class="hljs-keyword">return</span> i
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span></code></pre><br>
<p>           NX_LAYER_SORT_ORDER  .<br>
<strong> </strong>: 0() NeXt UI, ,   undefined      ,    .     . <br>
</p><br>
<p>  ()        Nornir  .<br>
     <strong>data</strong> :</p><br>
<pre><code class="plaintext hljs">dist-rtr01:<font></font>
    hostname: 10.10.20.175<font></font>
    platform: ios<font></font>
    groups:<font></font>
        - devnet-cml-lab<font></font>
    data:<font></font>
        role: distribution-router</code></pre><br>
<p>   nr_role,      global_facts  normalize_result:</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#    </span>
global_facts[device_fqdn][<span class="hljs-string">'nr_role'</span>] = nr.inventory.hosts[device].get(<span class="hljs-string">'role'</span>, <span class="hljs-string">'undefined'</span>)</code></pre><br>
<p>   generate_topology_json    :</p><br>
<pre><code class="python hljs"><span class="hljs-comment">#    </span>
device_role = facts[host].get(<span class="hljs-string">'nr_role'</span>, <span class="hljs-string">'undefined'</span>)<font></font>
topology_dict[<span class="hljs-string">'nodes'</span>].append({
    <span class="hljs-string">'id'</span>: host_id,
    <span class="hljs-string">'name'</span>: host,
    <span class="hljs-string">'primaryIP'</span>: device_ip,
    <span class="hljs-string">'model'</span>: device_model,
    <span class="hljs-string">'serial_number'</span>: device_serial,
    <span class="hljs-string">'layerSortPreference'</span>: get_node_layer_sort_preference(<font></font>
        device_role<font></font>
    ),<font></font>
    <span class="hljs-string">'icon'</span>: get_icon_type(<font></font>
        lldp_capabilities_dict.get(host, <span class="hljs-string">''</span>),<font></font>
        device_model<font></font>
    )<font></font>
})</code></pre><br>
<p>              .         :</p><br>
<p><img src="https://habrastorage.org/webt/my/k6/0e/myk60ehtgegonmev55v1qg5evd8.gif"></p><br>
<h1 id="itogovaya-struktura-proekta">  </h1><br>
<p>   -        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">GitHub</a>.<br>
    :</p><br>
<pre><code class="plaintext hljs">$ tree . -L 2<font></font>
.<font></font>
‚îú‚îÄ‚îÄ LICENSE<font></font>
‚îú‚îÄ‚îÄ README.md<font></font>
‚îú‚îÄ‚îÄ diff_page.html<font></font>
‚îú‚îÄ‚îÄ diff_topology.js<font></font>
‚îú‚îÄ‚îÄ generate_topology.py<font></font>
‚îú‚îÄ‚îÄ img<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ dead_node.png<font></font>
‚îú‚îÄ‚îÄ inventory<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ groups.yml<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ hosts_devnet_sb_cml.yml<font></font>
‚îú‚îÄ‚îÄ main.html<font></font>
‚îú‚îÄ‚îÄ next_app.js<font></font>
‚îú‚îÄ‚îÄ next_sources<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ css<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ doc<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ fonts<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ js<font></font>
‚îú‚îÄ‚îÄ nornir_config.yml<font></font>
‚îú‚îÄ‚îÄ requirements.txt<font></font>
‚îú‚îÄ‚îÄ samples<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ sample_diff.png<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ sample_layout_horizontal.png<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ sample_link_details.png<font></font>
‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ sample_node_details.png<font></font>
‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ sample_topology.png<font></font>
‚îú‚îÄ‚îÄ styles_main_page.css<font></font>
‚îî‚îÄ‚îÄ topology.js</code></pre><br>
<h1 id="vyvody"></h1><br>
<p>  ,  ,    .<br>
</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'article tentait d'√©noncer et de commenter les principales √©tapes du d√©veloppement de la version finale, ainsi que de passer en revue les outils utilis√©s. </font><font style="vertical-align: inherit;">La solution lors du marathon a pris la premi√®re place et, plus important encore, est multiplateforme et a le potentiel pour une expansion et une int√©gration suppl√©mentaires, non seulement dans le laboratoire.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'esp√®re que cela peut √™tre utile √† quelqu'un.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je serai heureux de recevoir des commentaires et des critiques constructives. </font><font style="vertical-align: inherit;">Qu'est-ce qui pourrait √™tre chang√© ou am√©lior√©?</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment aborderiez-vous la solution d'un probl√®me, ou comment l'avez-vous d√©j√† r√©solu?</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501148/index.html">Temple de la renomm√©e du milieu de travail JavaScript</a></li>
<li><a href="../fr501154/index.html">Nous mesurons la temp√©rature sans ADC</a></li>
<li><a href="../fr501156/index.html">HackTheBox. Passage d'obscurit√©. Injection de commande du syst√®me d'exploitation et condition de concurrence</a></li>
<li><a href="../fr501158/index.html">Rendre Android View Binding pratique avec Kotlin</a></li>
<li><a href="../fr501162/index.html">Comparaison de sc√®nes de rap russe en utilisant les techniques de R et de Text Mining. Noize Mc et Kasta contre Pharaon et Morgenshtern</a></li>
<li><a href="../fr501166/index.html">oVirt en 2 heures. Partie 1. Plateforme de virtualisation de basculement ouverte</a></li>
<li><a href="../fr501168/index.html">Les aides-soignants se sauvent - sauvegardent-ils, sauvegardent-ils, s'√©puisent-ils?</a></li>
<li><a href="../fr501172/index.html">Mon ordinateur Mikrosh: continuez la semaine de la nostalgie</a></li>
<li><a href="../fr501178/index.html">Comment regarder du porno affecte la productivit√© du travail et des √©tudes</a></li>
<li><a href="../fr501180/index.html">[Post-Question] Avez-vous besoin d'un mouvement informatique pour FAITS sur le coronavirus et les ¬´effets secondaires¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>