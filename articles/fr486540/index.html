<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò° ü§¶üèº ‚òπÔ∏è HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100kNVPS sur un serveur üë∞üèª üì± ‚ÜñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La prochaine conf√©rence HighLoad ++ se tiendra les 6 et 7 avril 2020 √† Saint-P√©tersbourg, d√©tails et billets ici . HighLoad ++ Moscou 2018. Salle de M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100kNVPS sur un serveur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/486540/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prochaine conf√©rence HighLoad ++ se tiendra les 6 et 7 avril 2020 √† Saint-P√©tersbourg, d√©tails et billets </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . HighLoad ++ Moscou 2018. Salle de Moscou. 9 novembre, 15 h R√©sum√©s et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©sentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/dm/mu/sadmmupp8vt5l5vl5obukgut36a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Surveillance - en ligne et analytique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Les principales limitations de la plateforme ZABBIX. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Solution pour faire √©voluer le stockage analytique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Optimisation du serveur ZABBIX. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Optimisation de l'interface utilisateur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Exp√©rience dans le fonctionnement du syst√®me avec des charges de plus de 40 000 NVPS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Bri√®vement conclusions.</font></font><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Makurov (ci-apr√®s - MM):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bonjour √† tous! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxim Chernetsov (ci-apr√®s - MCH):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bonjour! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Permettez-moi de vous pr√©senter Maxim. Max est un ing√©nieur talentueux, le meilleur r√©seauteur que je connaisse. Maxim s'occupe des r√©seaux et des services, de leur d√©veloppement et de leur fonctionnement. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/pn/q6/ujpnq61idhrrwq2dszdhb3hxjza.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et je voudrais parler de Michael. Michael est un d√©veloppeur C. Il a √©crit des solutions de traitement du trafic tr√®s charg√©es pour notre entreprise. Nous vivons et travaillons dans l'Oural, dans la ville des paysans s√©v√®res de Tcheliabinsk, dans la soci√©t√© Intersvyaz. Notre entreprise est un fournisseur de services Internet et de t√©l√©vision par c√¢ble pour un million de personnes dans 16 villes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Et il vaut la peine de dire qu'Intersvyaz est bien plus qu'un simple fournisseur, c'est une entreprise informatique. </font><font style="vertical-align: inherit;">La plupart de nos d√©cisions sont prises par notre service informatique. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des serveurs qui traitent le trafic au centre d'appels et √† l'application mobile. </font><font style="vertical-align: inherit;">Le service informatique compte environ 80 personnes aux comp√©tences tr√®s, tr√®s diverses.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä propos de Zabbix et de son architecture</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et maintenant, je vais essayer d'√©tablir un record personnel et dire en une minute ce qu'est Zabbix (ci-apr√®s - "Zabbiks"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix se positionne comme un syst√®me de surveillance ¬´pr√™t √† l'emploi¬ª au niveau de l'entreprise. </font><font style="vertical-align: inherit;">Il poss√®de de nombreuses fonctionnalit√©s simplifiant la vie: r√®gles avanc√©es d'escalade, API pour l'int√©gration, le regroupement et la d√©tection automatique des h√¥tes et des m√©triques. </font><font style="vertical-align: inherit;">Dans Zabbix, il existe ce que l'on appelle des outils de mise √† l'√©chelle - des proxys. </font><font style="vertical-align: inherit;">Zabbix est un syst√®me open source. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bri√®vement sur l'architecture. </font><font style="vertical-align: inherit;">On peut dire qu'il se compose de trois √©l√©ments:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/fn/xv/ocfnxvdx0gy8qi4055lipyifl1q.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serveur. </font><font style="vertical-align: inherit;">Il est √©crit en C. </font><font style="vertical-align: inherit;">Avec un traitement et une transmission des informations assez compliqu√©s entre les flux. </font><font style="vertical-align: inherit;">Tout le traitement y a lieu: de la r√©ception √† l'enregistrement dans la base de donn√©es.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les donn√©es sont stock√©es dans la base de donn√©es. </font><font style="vertical-align: inherit;">Zabbix prend en charge MySQL, PostreSQL et Oracle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'interface Web est √©crite en PHP. </font><font style="vertical-align: inherit;">Sur la plupart des syst√®mes, il est livr√© avec un serveur Apache, mais fonctionne plus efficacement dans le bundle nginx + php.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, nous aimerions raconter de la vie de notre entreprise une histoire li√©e √† Zabbix ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Histoire de vie de la soci√©t√© Intersvyaz. </font><font style="vertical-align: inherit;">De quoi disposons-nous et de quoi avons-nous besoin?</font></font></h3><br>
<img src="https://habrastorage.org/webt/d2/cr/rk/d2crrkodjpn2arv0aojibu6vsq4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a 5 ou 6 mois. Une fois apr√®s le travail ... </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, bonjour! Heureux d'avoir r√©ussi √† vous attraper - il y a une conversation. Nous avons de nouveau eu des probl√®mes de surveillance. Lors d'un accident majeur, tout a ralenti et il n'y avait aucune information sur l'√©tat du r√©seau. Malheureusement, ce n'est pas la premi√®re fois r√©p√©t√©. J'ai besoin de ton aide. Faisons en sorte que notre surveillance fonctionne en toutes circonstances! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mais synchronisons d'abord. Je n'y ai pas cherch√© depuis quelques ann√©es. Pour autant que je m'en souvienne, nous avons refus√© Nagios et sommes pass√©s √† Zabbix il y a 8 ans. Et maintenant, il semble que nous ayons 6 serveurs puissants et une douzaine de serveurs proxy. Suis-je confus? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Presque. 15 serveurs, dont certains sont des machines virtuelles. Plus important encore, cela ne nous sauve pas au moment o√π nous en avons le plus besoin. Comme un accident - les serveurs ralentissent et rien n'est visible. Nous avons essay√© d'optimiser la configuration, mais cela ne donne pas le gain de performances optimal. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je vois. Avez-vous regard√© quelque chose, avez-vous trouv√© quelque chose dans le diagnostic? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- La premi√®re chose √† laquelle vous devez faire face est simplement la base de donn√©es. </font><font style="vertical-align: inherit;">MySQL est donc constamment charg√©, pr√©servant de nouvelles m√©triques, et lorsque Zabbix commence √† g√©n√©rer un tas d'√©v√©nements, la base de donn√©es entre litt√©ralement pendant plusieurs heures. </font><font style="vertical-align: inherit;">Je vous ai d√©j√† parl√© de l'optimisation de la configuration, mais litt√©ralement cette ann√©e, nous avons mis √† jour le mat√©riel: il y a plus d'une centaine de gigaoctets de m√©moire sur les serveurs et les baies de disques sur SSD RAID-ahs - cela n'a pas de sens de le d√©velopper de mani√®re lin√©aire. </font><font style="vertical-align: inherit;">Qu'est-ce qu'on fait? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je vois. </font><font style="vertical-align: inherit;">En g√©n√©ral, MySQL est une base de donn√©es LTP. </font><font style="vertical-align: inherit;">Apparemment, il ne convient plus pour stocker une archive de m√©triques de notre taille. </font><font style="vertical-align: inherit;">Voyons cela. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Allez!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int√©gration de Zabbix et Clickhouse √† la suite d'un hackathon</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s un certain temps, nous avons re√ßu des donn√©es int√©ressantes: la </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2r/vp/of/2rvpofn2alwwhizhv4e7qrwhpsm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
majeure partie de l'espace dans notre base de donn√©es √©tait occup√©e par l'archive des m√©triques et moins de 1% √©tait utilis√© pour la configuration, les mod√®les et les param√®tres. </font><font style="vertical-align: inherit;">√Ä ce moment-l√†, nous exploitions depuis plus d'un an la solution Big data bas√©e sur Clickhouse. </font><font style="vertical-align: inherit;">La direction du mouvement √©tait √©vidente pour nous. </font><font style="vertical-align: inherit;">Lors de notre Hackathon de printemps, il a √©crit l'int√©gration de Zabbix avec Clickhouse pour le serveur et le frontend. </font><font style="vertical-align: inherit;">√Ä cette √©poque, Zabbix avait d√©j√† un support pour ElasticSearch, et nous avons d√©cid√© de les comparer.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/jv/hq/bgjvhq9lwget5l-hy1xt9zz2mvo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparez Clickhouse et Elasticsearch</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - A titre de comparaison, nous avons g√©n√©r√© la m√™me charge que le serveur Zabbix fournit et regard√© comment les syst√®mes se comporteraient. Nous avons √©crit des donn√©es par lots de 1 000 lignes, en utilisant CURL. Nous avions pr√©c√©demment sugg√©r√© que le Clickhouse serait plus efficace pour le profil de charge que fait Zabbix. Les r√©sultats ont m√™me d√©pass√© nos attentes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans les m√™mes conditions de test, le Clickhouse a √©crit trois fois plus de donn√©es. Dans le m√™me temps, les deux syst√®mes ont consomm√© tr√®s efficacement (une petite quantit√© de ressources) lors de la lecture des donn√©es. Mais ¬´Elastix¬ª n√©cessitait une grande quantit√© de processeur lors de l'enregistrement:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au total, Clickhouse a largement d√©pass√© Elastix en termes de consommation et de vitesse du processeur. En m√™me temps, en raison de la compression des donn√©es, ¬´Clickhouse¬ª utilise 11 fois moins sur le disque dur et fait environ 30 fois moins d'op√©rations sur le disque: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/0u/ce/yf0uceb3lvfa4e3mdwz1fsgufkw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui, travailler avec le sous-syst√®me de disque √† ¬´Clickhouse¬ª est tr√®s efficace. Sous les bases, vous pouvez utiliser d'√©normes disques SATA et obtenir une vitesse d'√©criture de centaines de milliers de lignes par seconde. Le syst√®me "pr√™t √† l'emploi" prend en charge le sharding, la r√©plication, il est tr√®s facile √† configurer. Nous sommes plus que satisfaits de son fonctionnement depuis un an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour optimiser les ressources, vous pouvez installer "Clickhouse" √† c√¥t√© de la base principale existante et ainsi √©conomiser beaucoup de temps processeur et d'op√©rations sur le disque. Nous avons retir√© l'archive des m√©triques des clusters ¬´Clickhouse¬ª existants:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/xr/p9/quxrp9ah4u-nhwlbkkcgynf2to0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons tellement d√©charg√© la base de donn√©es MySQL principale que nous avons pu la combiner sur la m√™me machine avec le serveur Zabbix et abandonner le serveur d√©di√© pour MySQL.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment fonctionne le sondage dans Zabbix?</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a 4 mois </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Eh bien, vous pouvez oublier les probl√®mes avec la base? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - C'est s√ªr! Un autre probl√®me que nous devons r√©soudre est la collecte lente des donn√©es. D√©sormais, nos 15 procurations sont surcharg√©es de processus SNMP et d'interrogation. Et il n'y a rien d'autre que la mise en place de nouveaux et nouveaux serveurs. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - G√©nial. Mais d'abord, dites-moi comment fonctionne le sondage dans Zabbix. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En bref, il existe 20 types de m√©triques et une douzaine de fa√ßons de les obtenir. Zabbix peut collecter des donn√©es soit en mode "demande-r√©ponse", soit attendre de nouvelles donn√©es via "l'interface de trappeur". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/dd/jc/f1ddjcw--iidqz7psmv82znkwk0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que dans le Zabbix d'origine, cette m√©thode (Trapper) est la plus rapide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des proxys pour l'√©quilibrage de charge:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/n3/2v/qln32vd8mjkz2xbe0bowbswrpsu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les proxys peuvent ex√©cuter les m√™mes fonctions de collecte que le serveur Zabbix, en recevant des t√¢ches de celui-ci et en envoyant des m√©triques collect√©es via l'interface Trapper. </font><font style="vertical-align: inherit;">Il s'agit de la m√©thode d'√©quilibrage de charge officiellement recommand√©e. </font><font style="vertical-align: inherit;">De plus, les proxys sont utiles pour surveiller une infrastructure distante qui fonctionne via NAT ou un canal lent: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/uv/mh/bauvmh-9-mcmokuu7ldhtx59--0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Tout est clair avec l'architecture. </font><font style="vertical-align: inherit;">Il faut regarder la source ... </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques jours plus tard</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©cit de la victoire de nmap fping</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Il semble que j'ai d√©terr√© quelque chose. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dis-moi! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - J'ai trouv√© que lors des v√©rifications de disponibilit√©, Zabbix v√©rifie jusqu'√† 128 h√¥tes √† la fois. J'ai essay√© d'augmenter ce chiffre √† 500 et j'ai supprim√© l'intervalle entre les paquets dans leur ping (ping) - cela a augment√© les performances d'un facteur deux. Mais je voudrais de gros chiffres. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dans ma pratique, je dois parfois v√©rifier la disponibilit√© de milliers d'h√¥tes, et je n'ai rien vu de plus rapide que nmap. Je suis s√ªr que c'est le moyen le plus rapide. Essayons! Vous devez augmenter consid√©rablement le nombre d'h√¥tes en une seule it√©ration. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - V√©rifiez plus de cinq cents? 600? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Au moins quelques milliers. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- D'accord. La chose la plus importante que je voulais dire: j'ai trouv√© que la plupart des sondages dans Zabbix se faisaient de mani√®re synchrone. Nous devons le refaire de mani√®re asynchrone. Ensuite, nous pouvons augmenter consid√©rablement le nombre de m√©triques collect√©es par les sondeurs, surtout si nous augmentons le nombre de m√©triques en une seule it√©ration. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - G√©nial! Et quand? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Comme d'habitude, hier. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous avons compar√© les deux versions de fping et nmap:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/du/ii/qoduiid8hzk_wy8sxvgityvungo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur un grand nombre d'h√¥tes, nmap devait √™tre jusqu'√† cinq fois plus efficace. </font><font style="vertical-align: inherit;">√âtant donn√© que nmap v√©rifie uniquement le fait de la disponibilit√© et du temps de r√©ponse, nous avons transf√©r√© le calcul de la perte aux d√©clencheurs et r√©duit consid√©rablement les intervalles de contr√¥le de disponibilit√©. </font><font style="vertical-align: inherit;">Nous avons trouv√© le nombre optimal d'h√¥tes pour nmap dans la r√©gion de 4 000 par it√©ration. </font><font style="vertical-align: inherit;">Nmap nous a permis de r√©duire les co√ªts du processeur pour les contr√¥les de disponibilit√© de trois fois et de r√©duire l'intervalle de 120 secondes √† 10.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimisation de l'interrogation</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ensuite, nous sommes all√©s chercher des sondeurs. Nous √©tions principalement int√©ress√©s par l'√©limination et les agents SNMP. √Ä Zabbix, l'interrogation a √©t√© effectu√©e de mani√®re synchrone et des mesures sp√©ciales ont √©t√© prises afin d'augmenter l'efficacit√© du syst√®me. En mode synchrone, l'indisponibilit√© de l'h√¥te entra√Æne une d√©gradation importante de l'interrogation. Il y a tout un syst√®me d'√©tats, il y a des processus sp√©ciaux - les pollers dits inaccessibles, qui ne fonctionnent qu'avec des h√¥tes inaccessibles: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/h1/fm/3gh1fmfnq3nqxkpwsow7j4h80ra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c'est un commentaire qui montre la matrice d'√©tat, la complexit√© du syst√®me de transition qui est n√©cessaire pour que le syst√®me reste efficace. De plus, l'interrogation synchrone elle-m√™me est plut√¥t lente:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/0r/tm/h70rtmvjonmj3itlmq4wk44vpr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est pourquoi des milliers de fils d'interrogation sur une douzaine de procurations n'ont pas pu collecter la quantit√© de donn√©es n√©cessaire pour nous. L'impl√©mentation asynchrone a r√©solu non seulement les probl√®mes avec le nombre de threads, mais a √©galement consid√©rablement simplifi√© le syst√®me d'√©tat des h√¥tes inaccessibles, car pour tout nombre v√©rifi√© dans une it√©ration d'interrogation, le temps d'attente maximal √©tait de 1 timeout: En </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/te/bj/retebjsm9vthvrjy7rmpobeiwqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
outre, nous avons modifi√© et am√©lior√© le syst√®me d'interrogation pour SNMP- requ√™tes. Le fait est que la plupart ne peuvent pas r√©pondre √† plusieurs demandes SNMP en m√™me temps. Par cons√©quent, nous avons cr√©√© un mode hybride lorsque l'interrogation SNMP du m√™me h√¥te se fait de mani√®re asynchrone: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/9a/sj/mj9asjfzaisviljstpkdjpvmnya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cela se fait pour l'ensemble du groupe d'h√¥tes. Ce mode n'est finalement pas plus lent que compl√®tement asynchrone, car l'interrogation d'une centaine et demi de valeurs SNMP est encore beaucoup plus rapide qu'un d√©lai d'expiration.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos exp√©riences ont montr√© que le nombre optimal de demandes en une it√©ration est d'environ 8 000 avec l'interrogation SNMP. </font><font style="vertical-align: inherit;">Au total, le passage en mode asynchrone a permis d'acc√©l√©rer les performances d'interrogation de 200 fois, plusieurs centaines de fois. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Les optimisations d'interrogation obtenues ont montr√© que nous pouvons non seulement nous d√©barrasser de tous les mandataires, mais √©galement r√©duire les intervalles pour de nombreux contr√¥les, et les mandataires ne seront pas n√©cessaires pour partager la charge. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a environ trois mois</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changez l'architecture - augmentez la charge!</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Eh bien, Max, est-il temps d'√™tre productif? J'ai besoin d'un serveur puissant et d'un bon ing√©nieur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Eh bien, nous planifions. Il est temps de d√©coller √† 5 000 m√©triques par seconde. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le matin apr√®s la mise √† niveau de </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, nous avons mis √† jour, mais avons recul√© le matin ... Devinez quelle vitesse vous avez atteint? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mille 20 maximum. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ouais, 25 ans! Malheureusement, nous sommes l√† o√π nous avons commenc√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et alors? Avez-vous re√ßu des diagnostics? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui, bien s√ªr! Voici, par exemple, un top int√©ressant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6c/zv/6s/6czv6sdkoykmdkm0vn-sddnbbpw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Voyons voir. Je vois que nous avons essay√© un grand nombre de fils d'interrogation: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/a0/cl/qba0clfwpherpsufnk_7fbn5ioy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mais en m√™me temps, nous n'avons pas pu utiliser le syst√®me m√™me √† mi-chemin:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/wv/8b/spwv8blrzyggfwo5ps-objpypak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et les performances globales sont assez faibles, environ 4 000 m√©triques par seconde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/6o/zr/tt6ozrt2ortiof4kckeghltzrnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y a-t-il autre chose? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui, strace d'un des scrutateurs: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p8/ny/y3/p8nyy3kb_ffjhsjynlpz4wjfh8w.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - On voit clairement ici que le processus de sondage attend des ¬´s√©maphores¬ª. Ce sont des serrures: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z7/ks/mh/z7ksmh8kes9yc23tm0vuyu5g8r8.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ce n'est pas clair. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Regardez, c'est comme une situation o√π un tas de threads essaient de travailler avec des ressources avec lesquelles un seul peut travailler √† la fois. Ensuite, tout ce qu'ils peuvent faire, c'est partager cette ressource dans le temps: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/in/ce/mo/incemofethgxpp3fwyabr8kstd4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et la productivit√© totale de travailler avec une telle ressource est limit√©e par la vitesse d'un c≈ìur: Il </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/oh/9f/oqoh9fqs9ppftn5mab3aivoo2nq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
existe deux fa√ßons de r√©soudre ce probl√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mettez √† niveau le fer de la machine, passez √† des noyaux plus rapides:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/bd/zi/iobdziopu3g_vkfoengg2zhhcro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou changez l'architecture et </font><font style="vertical-align: inherit;">, en m√™me temps </font><font style="vertical-align: inherit;">, la charge: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/sl/wt/nuslwtjkx-poqob5ciqyyfifq48.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Soit dit en passant, nous utiliserons moins de c≈ìurs sur une machine de test que sur une machine de combat, mais ils seront 1,5 fois plus rapides en fr√©quence par c≈ìur! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - C'est clair? </font><font style="vertical-align: inherit;">Il est n√©cessaire de regarder le code du serveur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chemin de donn√©es dans le serveur Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pour comprendre, nous avons commenc√© √† analyser comment les donn√©es sont transmises √† l'int√©rieur du serveur Zabbix: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v9/iu/a2/v9iua26a6om3flgzj_vb3te0hak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Image sympa, non? Passons en revue pas √† pas pour clarifier plus ou moins. Il existe des flux et des services charg√©s de collecter les donn√©es: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h3/m9/kt/h3m9ktuwhpgwe1g4mbqjiw8l_zs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ils transf√®rent les m√©triques collect√©es via le socket au gestionnaire de pr√©processeur, o√π ils sont mis en file d'attente: le </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/ct/fv/9dctfvdiw2zaves1vn34gliuvmu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gestionnaire de pr√©processeur ¬ªtransf√®re les donn√©es √† ses employ√©s qui ex√©cutent les instructions de pr√©traitement et les renvoient via le m√™me socket: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ma/qd/ss/maqdssje-vzlzzpfzl0x2cuthwo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apr√®s cela, le pr√©processeur -manager les enregistre dans le cache historique:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/9q/vw/5r9qvwyriydt0pcroma7n-14fsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä partir de l√†, ils sont pris par des synchroniseurs historiques qui remplissent de nombreuses fonctions: par exemple, calculer des d√©clencheurs, remplir le cache de valeurs et, surtout, enregistrer des m√©triques dans le magasin d'historique. </font><font style="vertical-align: inherit;">En g√©n√©ral, le processus est complexe et tr√®s d√©routant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/o8/ih/f7o8ihzf_g5_2ecganu1t0zoss0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - La premi√®re chose que nous avons vue est que la plupart des threads rivalisent pour le soi-disant ¬´cache de configuration¬ª (une zone de m√©moire o√π toutes les configurations de serveur sont stock√©es). </font><font style="vertical-align: inherit;">En particulier, de nombreux verrous sont effectu√©s par les flux responsables de la collecte de donn√©es: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/oo/48/baoo48qthdg_pcp0ojgqh0de5us.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... car la configuration stocke non seulement des m√©triques avec leurs param√®tres, mais √©galement des files d'attente, √† partir desquelles les sondeurs prennent des informations sur ce qu'il faut faire ensuite. </font><font style="vertical-align: inherit;">Lorsqu'il y a beaucoup de pollers, et que l'un bloque la configuration, les autres attendent des requ√™tes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y5/zb/np/y5zbnpqumrszencyhaasflytwvm.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les scrutateurs ne doivent pas entrer en conflit</font></font></h3><br>
<img src="https://habrastorage.org/webt/kw/11/4f/kw114ff5k91eqlycs-yg8p8bmem.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, la premi√®re chose que nous avons faite a √©t√© de diviser la file d'attente en 4 parties et de permettre aux scrutateurs de bloquer en toute s√©curit√© ces files d'attente, ces parties en m√™me temps: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/gi/xu/lagixuseh1aghovklgd6m3blkxu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cela a supprim√© la concurrence pour le cache de configuration et la vitesse des pollers a augment√© de mani√®re significative. </font><font style="vertical-align: inherit;">Mais ensuite, nous avons √©t√© confront√©s au fait que le gestionnaire de pr√©processeur a commenc√© √† accumuler une file d'attente de travaux:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/0c/4i/ui0c4i7aae8kqdvkdtorchzft-y.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le gestionnaire de pr√©processeur doit √™tre capable de prioriser</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela s'est produit lorsqu'il manquait de productivit√©. </font><font style="vertical-align: inherit;">Ensuite, tout ce qu'il pouvait faire √©tait d'accumuler les demandes des processus de collecte de donn√©es et d'ajouter leur tampon jusqu'√† ce qu'il mange toute la m√©moire et se bloque: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/iy/oz/9yiyozxavyibcw8pog3tidwy-xc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©soudre ce probl√®me, nous avons ajout√© un deuxi√®me socket, qui a √©t√© allou√© sp√©cifiquement pour les travailleurs: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/sz/25/rbsz25axpkn6a832h9k7otp9je4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi , le gestionnaire du pr√©processeur a eu l'occasion de prioriser son travail et dans le cas o√π le tampon augmente, la t√¢che est de ralentir la consommation, donnant aux travailleurs la possibilit√© de r√©cup√©rer ce tampon: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/og/cg/qiogcgztt1an1ewlrear7oqxt7g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous avons constat√© que l'une des raisons du ralentissement √©tait parce que les travailleurs eux-m√™mes √©taient en concurrence pour </font><font style="vertical-align: inherit;">ressource vitale pour leur travail. </font><font style="vertical-align: inherit;">Nous avons enregistr√© ce probl√®me avec un bug-fix, et dans les nouvelles versions de Zabbix il a d√©j√† √©t√© r√©solu:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/6q/lr/yd6qlrqamuxreroffkeracyrnim.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous augmentons le nombre de prises - nous obtenons le r√©sultat</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En outre, le gestionnaire de pr√©processeur lui-m√™me est devenu un lien √©troit, car il s'agit d'un seul thread. </font><font style="vertical-align: inherit;">Elle reposait sur la vitesse du noyau, donnant une vitesse maximale d'environ 70 000 m√©triques par seconde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/s1/2_/uks12_i65kx3ohfqdfmvedyqdqw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, nous en avons fait quatre, avec quatre ensembles de sockets, des travailleurs: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/-u/ws/qt-uwsmlriplii491ao0we3jhg4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et cela nous a permis d'augmenter la vitesse √† environ 130 000 m√©triques: La </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/vp/cf/qlvpcfggoinhdxc4dfkniaz9po8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
non-lin√©arit√© de la croissance s'explique par le fait qu'il y avait une concurrence pour le cache histoires. </font><font style="vertical-align: inherit;">Pour lui, 4 gestionnaires de pr√©processeurs et synkers historiques ont concouru. </font><font style="vertical-align: inherit;">√Ä ce stade, nous avons re√ßu environ 130 000 m√©triques par seconde sur une machine de test, en l'utilisant √† environ 95% sur le processeur: il y a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/7l/mh/yo7lmhcfcdbhek5blp5xdz0osfy.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">environ 2,5 mois</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le refus de la communaut√© snmp a augment√© les NVP d'une fois et demie</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Max, j'ai besoin d'une nouvelle machine de test! Nous ne rentrons plus dans l'actuel. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et maintenant? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Maintenant - 130 000 NVP et un processeur ¬´plateau¬ª. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wow! Cool! Attendez, j'ai deux questions. Selon mes calculs, notre besoin est de l'ordre de 15 √† 20 000 m√©triques par seconde. Pourquoi en avons-nous besoin de plus? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je veux terminer le travail jusqu'√† la fin. Je veux voir combien nous pouvons tirer de ce syst√®me. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mais ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mais c'est inutile pour les affaires. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je vois. Et la deuxi√®me question: qu'est-ce que nous avons maintenant, pouvons-nous nous soutenir, sans l'aide d'un d√©veloppeur? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Je ne pense pas. La modification du cache de configuration est un probl√®me. Il traite des changements dans la plupart des threads et est difficile √† maintenir. Tr√®s probablement, la soutenir sera tr√®s difficile. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Alors vous avez besoin d'une sorte d'alternative. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Il existe une telle option. On peut passer √† des c≈ìurs rapides, tout en abandonnant le nouveau syst√®me de verrouillage. Nous obtenons toujours les performances de 60 √† 80 000 m√©triques. Dans ce cas, nous pouvons laisser le reste du code. Clickhouse, l'interrogation asynchrone fonctionnera. Et ce sera facile √† entretenir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - G√©nial! Je propose de m'attarder l√†-dessus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir optimis√© le c√¥t√© serveur, nous avons finalement pu ex√©cuter le nouveau code dans le productif. </font><font style="vertical-align: inherit;">Nous avons abandonn√© une partie des changements en faveur du passage √† une machine √† noyaux rapides et √† la minimisation du nombre de changements dans le code. </font><font style="vertical-align: inherit;">Nous avons √©galement simplifi√© la configuration et, si possible, abandonn√© les macros dans les √©l√©ments de donn√©es, car elles sont √† l'origine de verrous suppl√©mentaires. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/v7/tp/bkv7tps-i9usalann4sbqpdbkqm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, le rejet de la macro snmp-community, qui se trouve souvent dans la documentation et les exemples, dans notre cas nous a permis d'acc√©l√©rer en outre les NVP d'environ 1,5 fois. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s deux jours de production</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supprimer les fen√™tres contextuelles d'historique des incidents</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, nous utilisons le syst√®me pendant deux jours, et tout fonctionne. Mais seulement quand tout fonctionne! Nous avions pr√©vu de travailler avec le transfert d'un segment suffisamment important du r√©seau, et encore une fois avec nos mains nous avons v√©rifi√© qu'il avait augment√©, qu'il ne l'avait pas fait. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √áa ne peut pas √™tre! Nous avons tout v√©rifi√© 10 fois. Le serveur traite instantan√©ment l'inaccessibilit√© compl√®te du r√©seau. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui, je comprends tout: serveur, base de donn√©es, top, austat, logs - tout est rapide ... Mais on regarde l'interface web, et l√† on a le processeur "en rayon" sur le serveur et √ßa: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/un/p2/vjunp2evh3whasvpw4hwsipeshk.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je vois. Regardons le Web. Nous avons constat√© que dans une situation o√π il y avait un grand nombre d'incidents actifs, la plupart des widgets op√©rationnels ont commenc√© √† fonctionner tr√®s lentement:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/vw/kz/nzvwkzfbeg-4r1iue0y4178eg2q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La raison en √©tait la g√©n√©ration de fen√™tres contextuelles avec un historique des incidents g√©n√©r√©s pour chaque √©l√©ment de la liste. </font><font style="vertical-align: inherit;">Par cons√©quent, nous avons refus√© de g√©n√©rer ces fen√™tres (comment√© 5 lignes dans le code), et cela a r√©solu nos probl√®mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le temps de chargement du widget, m√™me lorsqu'il est compl√®tement inaccessible, a √©t√© r√©duit de quelques minutes √† 10 √† 15 secondes pour nous, et l'historique peut toujours √™tre consult√© en cliquant sur l'heure: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/dc/4l/hudc4lsz_skbshg7jphleuprc4a.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s le travail. </font><font style="vertical-align: inherit;">Il y a 2 mois </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Misha, tu pars? </font><font style="vertical-align: inherit;">Il faut qu'on parle. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je ne vais pas. </font><font style="vertical-align: inherit;">Encore une fois quelque chose avec Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oh non, d√©tends-toi! </font><font style="vertical-align: inherit;">Je voulais juste dire: tout fonctionne, merci! </font><font style="vertical-align: inherit;">Bi√®re avec moi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbix est efficace</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix est un syst√®me et une fonction assez polyvalents et riches. </font><font style="vertical-align: inherit;">Il peut √™tre utilis√© pour de petites installations hors de la bo√Æte, mais avec la croissance des besoins, il doit √™tre optimis√©. </font><font style="vertical-align: inherit;">Pour stocker une grande archive de m√©triques, utilisez le stockage appropri√©:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser les outils int√©gr√©s sous forme d'int√©gration avec Elastixerch ou de t√©l√©chargement de l'historique dans des fichiers texte (disponible √† partir de la quatri√®me version);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez profiter de notre exp√©rience et de notre int√©gration avec Clickhouse.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour augmenter consid√©rablement la vitesse de collecte des m√©triques, collectez-les de mani√®re asynchrone et transf√©rez-les via l'interface de trappeur vers le serveur Zabbix; </font><font style="vertical-align: inherit;">ou vous pouvez utiliser le correctif pour les sondeurs asynchrones de Zabbix lui-m√™me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix est √©crit en C et est assez efficace. </font><font style="vertical-align: inherit;">La solution de plusieurs endroits architecturaux √©troits permet d'augmenter encore sa productivit√© et, selon notre exp√©rience, de recevoir plus de 100 000 m√©triques sur une machine √† processeur unique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/db/d2/5rdbd2jcvr75sosfvfa6ziniwps.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le m√™me patch Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je veux ajouter quelques points. </font><font style="vertical-align: inherit;">L'ensemble du rapport actuel, tous les tests, les num√©ros sont donn√©s pour la configuration qui est utilis√©e avec nous. </font><font style="vertical-align: inherit;">Nous en tirons maintenant environ 20 000 mesures par seconde. </font><font style="vertical-align: inherit;">Si vous essayez de comprendre si cela fonctionnera pour vous - vous pouvez comparer. </font><font style="vertical-align: inherit;">Ce dont ils ont parl√© aujourd'hui est publi√© sur GitHub sous forme de correctif: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/miklert/zabbix</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xb/wd/y1/xbwdy18hq9dolceyxku_2wxsj4a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le correctif comprend:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int√©gration compl√®te avec Clickhouse (serveur Zabbix et frontend);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©soudre les probl√®mes avec le gestionnaire de pr√©processeur;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interrogation asynchrone.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le patch est compatible avec toutes les versions 4, y compris les lts. </font><font style="vertical-align: inherit;">Tr√®s probablement, avec des changements minimes, cela fonctionnera sur la version 3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci pour l'attention.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des questions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Question du public (ci-apr√®s - A): - Bonjour! Dites-moi s'il vous pla√Æt, avez-vous des plans pour une interaction intensive avec l'√©quipe Zabbix, ou ont-ils avec vous pour que ce ne soit pas un patch, mais le comportement normal de Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui, nous allons certainement engager une partie des changements. Quelque chose sera, quelque chose restera dans le patch. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Merci beaucoup pour l'excellent rapport! Dites-moi, s'il vous pla√Æt, apr√®s avoir appliqu√© le patch, le support du c√¥t√© de Zabbix restera et comment continuer la mise √† niveau vers des versions sup√©rieures? Sera-t-il possible de mettre √† jour Zabbix apr√®s votre patch en 4.2, 5.0? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Je ne peux pas parler de support. Si j'√©tais le support technique de Zabbix, je dirais probablement non, car c'est le code de quelqu'un d'autre. Quant √† la base de code 4.2, notre position est la suivante: "Nous irons avec le temps, et nous serons mis √† jour sur la prochaine version." Par cons√©quent, pendant un certain temps, nous t√©l√©chargerons le correctif dans des versions mises √† jour. Je l'ai d√©j√† dit dans le rapport: le nombre de changements avec les versions est encore assez faible. Je pense que le passage de la 3.4 √† la 4. nous a pris, semble-t-il, environ 15 minutes. Quelque chose a chang√©, mais pas tr√®s important. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vous pr√©voyez donc de maintenir votre correctif et vous pouvez le mettre en production en toute s√©curit√©, √† l'avenir, obtenir des mises √† jour d'une mani√®re ou d'une autre? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous le recommandons fortement. Cela r√©sout beaucoup de probl√®mes pour nous. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Encore une fois, je voudrais souligner que les changements qui ne concernent pas l'architecture et ne concernent pas les verrous, les files d'attente - ils sont modulaires, ils sont dans des modules s√©par√©s. M√™me seuls avec des changements mineurs, ils peuvent √™tre maintenus assez facilement. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Si les d√©tails sont int√©ressants, alors ¬´Clickhouse¬ª utilise la soi-disant biblioth√®que historique. Il n'est pas li√© - il s'agit d'une copie du support d'Elastic, c'est-√†-dire qu'il est configurable. L'interrogation modifie uniquement les interrogateurs. Nous pensons que cela fonctionnera longtemps. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Merci beaucoup. Mais dites-moi, existe-t-il une documentation des modifications apport√©es? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/vv/h3/r7vvh3optatasclqsm9tjftkmja.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- La documentation est un patch. </font><font style="vertical-align: inherit;">De toute √©vidence, avec l'introduction de ¬´Clickhouse¬ª, avec l'introduction de nouveaux types de sondeurs, de nouvelles options de configuration apparaissent. </font><font style="vertical-align: inherit;">Le lien de la derni√®re diapositive contient une br√®ve description de son utilisation.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä propos du remplacement de fping par nmap</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Comment avez-vous finalement mis cela en ≈ìuvre? </font><font style="vertical-align: inherit;">Pouvez-vous donner des exemples sp√©cifiques: s'agit-il de vos strappers et d'un script externe? </font><font style="vertical-align: inherit;">Qu'est-ce qui permet de v√©rifier si rapidement tant d'h√¥tes? </font><font style="vertical-align: inherit;">Comment obtenez-vous ces h√¥tes? </font><font style="vertical-align: inherit;">Nmap a-t-il besoin de les nourrir, de les r√©cup√©rer quelque part, de les mettre, de commencer quelque chose? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Cool. Question tr√®s correcte! Le point est le suivant. Nous avons modifi√© la biblioth√®que (ping ICMP, partie de Zabbix) pour les v√©rifications ICMP, qui indiquent le nombre de paquets - unit√© (1), et le code essaie d'utiliser nmap. Autrement dit, c'est le travail interne de Zabbix, il est devenu le travail interne du pinger. En cons√©quence, aucune synchronisation ou utilisation d'un trappeur n'est requise. Cela a √©t√© fait d√©lib√©r√©ment afin de laisser le syst√®me coh√©rent et de ne pas s'engager dans la synchronisation de deux syst√®mes de base: que v√©rifier, remplir via le poller, et si le remplissage s'est cass√© en nous? .. C'est beaucoup plus simple. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">√áa</font></b><font style="vertical-align: inherit;"> marche aussi pour un proxy? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui, mais nous n'avons pas v√©rifi√©. Le code d'interrogation est le m√™me dans Zabbix et sur le serveur. Devrait marcher. J'insiste √† nouveau: les performances du syst√®me sont telles que nous n'avons pas besoin de proxy.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - La bonne r√©ponse √† la question est: "Pourquoi avez-vous besoin d'un proxy avec un tel syst√®me?" </font><font style="vertical-align: inherit;">Uniquement √† cause de NAT'a ou pour surveiller via un canal lent certains ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et vous utilisez Zabbix comme allerg√®ne, si je comprends bien. </font><font style="vertical-align: inherit;">Ou les graphiques (o√π est la couche d'archives) que vous avez laiss√©s pour un autre syst√®me, tel que Grafana? </font><font style="vertical-align: inherit;">Ou n'utilisez-vous pas cette fonctionnalit√©? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je soulignerai encore une fois: nous avons fait une int√©gration compl√®te. </font><font style="vertical-align: inherit;">Nous versons l'histoire dans ¬´Clickhouse¬ª, mais en m√™me temps nous avons chang√© le frontend php. </font><font style="vertical-align: inherit;">Php-frontend va √† ¬´Clickhouse¬ª et fait tous les graphiques √† partir de l√†. </font><font style="vertical-align: inherit;">Dans le m√™me temps, pour √™tre honn√™te, nous avons une partie qui se construit √† partir du m√™me ¬´Clickhouse¬ª, √† partir des m√™mes donn√©es Zabbix, des donn√©es dans d'autres syst√®mes d'affichage graphique. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dans "Grafan" √©galement.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment la d√©cision d'allouer des ressources a-t-elle √©t√© prise?</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Partagez une petite cuisine int√©rieure. </font><font style="vertical-align: inherit;">Comment a-t-on d√©cid√© que les ressources devraient √™tre allou√©es √† une transformation s√©rieuse des produits? </font><font style="vertical-align: inherit;">Ce sont, en g√©n√©ral, certains risques. </font><font style="vertical-align: inherit;">Et dites-moi, dans le contexte du fait que vous allez soutenir de nouvelles versions: comment cette d√©cision est-elle justifi√©e d'un point de vue manag√©rial? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Apparemment, nous n'avons pas tr√®s bien racont√© le drame de l'histoire. </font><font style="vertical-align: inherit;">Nous nous sommes retrouv√©s dans une situation o√π quelque chose devait √™tre fait, et sommes all√©s essentiellement deux commandes parall√®les:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'une √©tait engag√©e dans le lancement d'un syst√®me de surveillance utilisant de nouvelles m√©thodes: la surveillance en tant que service, un ensemble standard de solutions open source que nous combinons et essayons ensuite de changer le processus m√©tier afin de travailler avec le nouveau syst√®me de surveillance.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En parall√®le, nous avions un programmeur enthousiaste qui faisait √ßa (√† propos de lui). </font><font style="vertical-align: inherit;">Il se trouve qu'il a gagn√©.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et quelle est la taille de l'√©quipe? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Elle est devant vous. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - C'est, comme toujours, un passionn√© est n√©cessaire? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je ne sais pas ce qu'est un passionn√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dans ce cas, apparemment, vous. </font><font style="vertical-align: inherit;">Merci beaucoup, vous √™tes cool. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Merci.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä propos des correctifs pour Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pour un syst√®me qui utilise des proxys (par exemple, dans certains syst√®mes distribu√©s), est-il possible pour votre d√©cision d'adapter et de patcher, disons, des pollers, des proxys et partiellement le pr√©processeur de Zabbix lui-m√™me; et leur interaction? Est-il possible d'optimiser les d√©veloppements existants pour un syst√®me √† plusieurs mandataires? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je sais que le serveur Zabbix est assembl√© √† l'aide d'un proxy (il compile et le code est obtenu). Nous n'avons pas test√© cela dans le produit. Je ne suis pas s√ªr de cela, mais, √† mon avis, le gestionnaire de pr√©processeur n'est pas utilis√© dans le proxy. La t√¢che du proxy est de prendre un ensemble de m√©triques de Zabbix, de les remplir (il √©crit √©galement la configuration, la base de donn√©es locale) et de le renvoyer au serveur Zabbix. Ensuite, le serveur lui-m√™me effectuera le pr√©traitement lorsqu'il le recevra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'int√©r√™t pour les procurations est compr√©hensible. </font><font style="vertical-align: inherit;">Nous allons v√©rifier cela. </font><font style="vertical-align: inherit;">C'est un sujet int√©ressant. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - L'id√©e √©tait la suivante: si vous pouvez patcher des pollers, ils peuvent √™tre patch√©s sur des proxys et patcher l'interaction avec le serveur, et le pr√©processeur ne peut √™tre adapt√© √† ces fins que sur le serveur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je pense que tout est encore plus simple. </font><font style="vertical-align: inherit;">Vous prenez le code, appliquez le correctif, puis configurez-le selon vos besoins - collectez les serveurs proxy (par exemple, avec ODBC) et distribuez le code corrig√© aux syst√®mes. </font><font style="vertical-align: inherit;">Si n√©cessaire - collectez des procurations, si n√©cessaire - serveur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - De plus, vous n'aurez pas √† patcher la transmission proxy au serveur, tr√®s probablement? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Non, c'est standard. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En fait, une des id√©es ne sonnait pas. </font><font style="vertical-align: inherit;">Nous avons toujours maintenu un √©quilibre entre une explosion d'id√©es et le nombre de changements, la facilit√© d'accompagnement.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3yRt9jSwrlg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des VPS bas√©s sur le cloud pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√©s pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur les VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486518/index.html">Il y a 20 ans</a></li>
<li><a href="../fr486528/index.html">C'est la norme - 3: types de cartes normaux</a></li>
<li><a href="../fr486530/index.html">Courant dominant. Travailleurs honoraires. Roman biographique</a></li>
<li><a href="../fr486532/index.html">Sauvegarde des donn√©es √† l'aide d'un tas de FreeFileSync et 7-zip</a></li>
<li><a href="../fr486538/index.html">Comment j'ai t√©l√©charg√© des comp√©tences g√©n√©rales en ligne et ce que cela m'a apport√©</a></li>
<li><a href="../fr486542/index.html">Analyser le son d'un modem d'acc√®s √† distance</a></li>
<li><a href="../fr486544/index.html">Deux heures et 3,5 dollars. Comment j'ai fait un site simple avec visualisation de la distribution des coronavirus</a></li>
<li><a href="../fr486552/index.html">¬´Code culturel: les secrets de groupes et d'organisations extr√™mement performants¬ª - notes du livre</a></li>
<li><a href="../fr486554/index.html">Slurm DevOps. Trois jours d'immersion dans DevOps. Et une conf√©rence d'Anatoly Wasserman "Le probl√®me informatique du socialisme"</a></li>
<li><a href="../fr486556/index.html">Cr√©ation d'un objet d'art pour Burning Man</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>