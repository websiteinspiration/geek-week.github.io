<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßì üïü ü§≤üèø AWS Lambda en action dans Java 11. Passer √† la production sans serveur üëàüèø üíÆ ‚åõÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est un guide sur la fa√ßon de commencer rapidement et sans douleur √† utiliser AWS Lambda avec un exemple simple. Convient √† la fois √† un d√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda en action dans Java 11. Passer √† la production sans serveur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/486648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article est un guide sur la fa√ßon de commencer rapidement et sans douleur √† utiliser AWS Lambda avec un exemple simple. </font><font style="vertical-align: inherit;">Convient √† la fois √† un d√©veloppeur qui n'a pas du tout travaill√© avec Lambda et qui connaissait le Cloud pour √©valuer une autre vision du d√©veloppement d'applications sans serveur.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/y8/lu/bdy8luzeox9qq09msokx8yzoba4.jpeg" alt="image"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour √† tous. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'appelle Alexander Gruzdev, je suis chef d'√©quipe Java chez DINS. Depuis plus de deux ans, je travaille en √©troite collaboration avec l'infrastructure AWS et j'ai de l'exp√©rience √† la fois dans l'√©criture d'applications pour AWS et dans le d√©ploiement de ces m√™mes applications. Dans mon travail, j'ai d√ª utiliser ElasticBeanstalk, ECS, Fargate, EKS et, bien s√ªr, AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chacun de ces services est bon √† sa mani√®re, et dans le cadre de cet article, je ne recommanderai pas d'utiliser uniquement AWS Lambda en remplacement de toutes les autres options. Je veux juste montrer √† quel point il est facile de commencer √† utiliser Lambda, et dans quels cas vous en tirerez les avantages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout le monde, des d√©veloppeurs aux gestionnaires, veut un processus clair pour apporter des changements aux clients. </font><font style="vertical-align: inherit;">Plus cette voie est transparente et moins d'efforts sont n√©cessaires, plus elle est rentable. </font><font style="vertical-align: inherit;">Le plus souvent, les d√©veloppeurs et les testeurs ne veulent pas savoir o√π l'application sera d√©ploy√©e, quel mat√©riel choisir, dans quelle r√©gion vous souhaitez placer les r√©pliques, etc. </font><font style="vertical-align: inherit;">Dans le diagramme suivant, vous pouvez voir la classe de services ¬´aaS¬ª (en tant que service), o√π AWS Lambda repr√©sente la cat√©gorie FaaS.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z8/nj/wl/z8njwlqjrgatljwptthtqe9ealu.png" alt="image"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FaaS en bref</font></font></b>
                        <div class="spoiler_text">FaaS ,            .     ,  , CRUD   C, R, U, D     Create   Read.      ,   ‚Äî  .<br>
</div>
                    </div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Id√©e</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour d√©montrer ce qu'est le d√©veloppement d'une solution sans serveur, j'ai d√©cid√© de prendre un exemple assez banal. </font><font style="vertical-align: inherit;">Je pense que vous avez vu le formulaire de commentaires Contactez-nous sur de nombreux sites, o√π vous pouvez laisser votre courrier ou votre t√©l√©phone et poser une question √† laquelle il sera r√©pondu plus tard. </font><font style="vertical-align: inherit;">L'√©cran ci-dessous, le formulaire n'est pas super, mais le sujet de cet article n'est pas la conception mat√©rielle. </font></font><br>
<img src="https://habrastorage.org/webt/gv/5g/iv/gv5givju7glj8vftkb1cdhupdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En remplissant ce formulaire, un client potentiel attendra un appel ou une lettre de votre part. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue technique, vous avez besoin de:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistrer les donn√©es du formulaire dans la base de donn√©es;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoyer une lettre √† un agent qui r√©pondra √† la question;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut-√™tre √©crire un autre service o√π l'agent marquera le travail effectu√© sur la base de la m√™me base de donn√©es (non incluse dans la port√©e de l'article).</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'impl√©mentation de l'id√©e est disponible sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose qui vient √† l'esprit lors de la mise en ≈ìuvre est ce dont nous avons besoin:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">machine sous le dos, le devant, les images, etc.,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voiture avec base</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">machine avec service de messagerie.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/9a/7h/83/9a7h83iyieeicpht4-bcwy8l-ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dos et la base, dans le bon sens, doivent √™tre r√©pliqu√©s, mais supposons que nous le fassions pour notre mini-magasin et que la charge sur ce formulaire soit minime. </font><font style="vertical-align: inherit;">Par cons√©quent, toutes ces machines peuvent √™tre combin√©es en une seule et d√©ploy√©es en un seul ensemble. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais puisque nous envisageons Serverless, construisons l'architecture enti√®rement sur des composants sans serveur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peu importe √† quel point Serverless peut sembler prometteur, nous comprenons tous que les serveurs sont toujours l√†, ils ont juste disparu de votre champ de vision. </font><font style="vertical-align: inherit;">Et maintenant que le cloud fonctionne, vous pouvez faire les t√¢ches que vous pouvez faire vous-m√™me. </font><font style="vertical-align: inherit;">Mais essayons d'utiliser uniquement ces composants sans serveur: </font></font><br>
<img src="https://habrastorage.org/webt/mf/iw/6i/mfiw6if-6nlss4pl-brkgxenxuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
le diagramme montre une s√©paration tr√®s claire de la fonctionnalit√© de chaque composant.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda est le composant principal qui contient du code / de la logique,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3 est responsable du stockage des ressources statiques et des scripts JS,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFront - pour les m√©canismes de mise en cache et le support multi-r√©gional,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SES - service de messagerie,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamoDB - la base de stockage des donn√©es du formulaire (de qui, quelle question, o√π envoyer la r√©ponse),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de passerelle - API HTTP pour notre lambda,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route53 - n√©cessaire si vous souhaitez ajouter un beau nom de domaine.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous ces composants ne seront pas utilis√©s dans notre prochain guide, juste pour ne pas √©tirer l'article. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Route53 et CloudFront sont des composants assez simples que vous pouvez lire s√©par√©ment. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un petit spoilers qui nous donnera une telle solution:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nous √©loignons de la prise en charge des machines EC2, pas de d√©bogage via ssh,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration facile: configurez la limitation / la mise en cache / les acc√®s en un seul clic,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge des politiques d'acc√®s: restreindre les droits et donner acc√®s,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Journalisation / surveillance hors de la bo√Æte,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Payez uniquement pour les ressources / demandes utilis√©es.</font></font></li>
</ul><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©mo</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entra√Ænement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer √† d√©velopper notre solution sans serveur, vous devez r√©pondre aux exigences suivantes:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compte AWS actif</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-cli</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam-cli</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jdk 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir install√© tous les outils ci-dessus, vous devez configurer votre aws-cli pour un acc√®s √† distance √† AWS. </font><font style="vertical-align: inherit;">Suivez les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela n√©cessitera la cr√©ation d'un nouvel utilisateur et le d√©chargement de sa cl√© d'acc√®s et de sa cl√© secr√®te.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montage du projet</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Cr√©ez un projet √† partir d'un mod√®le</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez le r√©pertoire du futur projet et lancez-le SAM CLI. </font><font style="vertical-align: inherit;">Suivez les instructions: </font></font><br>
<img src="https://habrastorage.org/webt/kn/gu/7f/kngu7fr3q_h_7t7bq-ygr7baccs.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque: Selon la version de SAM-CLI, les commandes peuvent √™tre l√©g√®rement diff√©rentes, mais elles restent toutes intuitives. </font><font style="vertical-align: inherit;">Choisissez simplement les plus similaires √† ceux qui ont √©t√© utilis√©s ci-dessus. </font><font style="vertical-align: inherit;">Vous pouvez √©galement choisir un outil de construction diff√©rent si Gradle ne vous convient pas. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet "Hello, World!" </font><font style="vertical-align: inherit;">pr√™t. </font><font style="vertical-align: inherit;">Vous pouvez maintenant travailler sur le nom du projet et des packages, les d√©pendances et le code source.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Traitons les d√©pendances</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez les d√©pendances suivantes √† build.gradle:</font></font><br>
<pre><code class="javascript hljs">dependencies {
    <span class="hljs-comment">// AWS</span>
    implementation group: <span class="hljs-string">'com.amazonaws.serverless'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-serverless-java-container-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.4'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.2.0'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-ses'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-dynamodb'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-log4j2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.1.0'</span><font></font>
<font></font>
    <span class="hljs-comment">// Utils</span>
    implementation group: <span class="hljs-string">'com.fasterxml.jackson.core'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'jackson-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.10.0'</span>
    implementation group: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.6'</span><font></font>
<font></font>
    <span class="hljs-comment">// Test</span>
    testImplementation group: <span class="hljs-string">'org.mockito'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'mockito-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'3.1.0'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-api-mockito2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-module-junit4'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'4.12'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les principaux sont le kit SDK AWS. </font><font style="vertical-align: inherit;">Ils vous permettront de travailler avec des services sp√©cifiques, tels que SES, DynamoDB, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Nous √©crivons un lambda</font></font></h3><br>
<ul>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous modifions les classes de demande et de r√©ponse de mod√®le pour RequestHandler en AwsProxyRequest et ContactUsProxyResponse.</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span>&lt;<span class="hljs-title">AwsProxyRequest</span>, <span class="hljs-title">ContactUsProxyResponse</span>&gt;
...
<span class="hljs-title">public</span> <span class="hljs-title">ContactUsProxyResponse</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-title">AwsProxyRequest</span> <span class="hljs-title">request</span>, <span class="hljs-title">Context</span> <span class="hljs-title">context</span>) </span></code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  AwsClientFactory   AWS SDK-.</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/**
 * Just an util class for an eager initialization of sdk clients.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsClientFactory</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LogManager.getLogger(AwsClientFactory.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonSimpleEmailService sesClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DynamoDB dynamoDB;<font></font>
<font></font>
    /**<font></font>
     * AWS regions should be env variables <span class="hljs-keyword">if</span> you want to generalize the solution.<font></font>
     */<font></font>
    AwsClientFactory() {<font></font>
        LOG.debug("AWS clients factory initialization.");<font></font>
        sesClient = AmazonSimpleEmailServiceClient.builder().withRegion(Regions.EU_WEST_1).build();<font></font>
        AmazonDynamoDB dynamoDBClient = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();<font></font>
        dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(dynamoDBClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">DynamoDB <span class="hljs-title">getDynamoDB</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> dynamoDB;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">AmazonSimpleEmailService <span class="hljs-title">getSesClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sesClient;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    ObjectMapper   .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ObjectMapper OBJECT_MAPPER = <span class="hljs-keyword">new</span> ObjectMapper();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AwsClientFactory AWS_CLIENT_FACTORY = <span class="hljs-keyword">new</span> AwsClientFactory();
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">private</span> SendEmailResult <span class="hljs-title">sendEmail</span><span class="hljs-params">(ContactUsRequest contactUsRequest)</span> </span>{<font></font>
        String emailTemplate = getEmailTemplate();<font></font>
        String email = fillTemplate(emailTemplate, contactUsRequest);<font></font>
<font></font>
        SendEmailRequest sendEmailRequest =<font></font>
                <span class="hljs-keyword">new</span> SendEmailRequest(<font></font>
                        System.getenv(<span class="hljs-string">"SENDER_EMAIL"</span>),
                        <span class="hljs-keyword">new</span> Destination(List.of(System.getenv(<span class="hljs-string">"RECIPIENT_EMAIL"</span>))),
                        <span class="hljs-keyword">new</span> Message()<font></font>
                                .withSubject(<font></font>
                                        <span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(contactUsRequest.getSubject()))<font></font>
                                .withBody(<span class="hljs-keyword">new</span> Body()<font></font>
                                        .withHtml(<span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(email))));<font></font>
        LOG.info(<span class="hljs-string">"Email template is ready"</span>);
        <span class="hljs-keyword">return</span> AWS_CLIENT_FACTORY.getSesClient().sendEmail(sendEmailRequest);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fillTemplate</span><span class="hljs-params">(String emailTemplate, ContactUsRequest contactUsRequest)</span> </span>{
        <span class="hljs-keyword">return</span> String.format(<font></font>
                emailTemplate,<font></font>
                contactUsRequest.getUsername(),<font></font>
                contactUsRequest.getEmail(),<font></font>
                contactUsRequest.getPhone(),<font></font>
                contactUsRequest.getQuestion());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getEmailTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> IOUtils.toString(<font></font>
                    Objects.requireNonNull(<span class="hljs-keyword">this</span>.getClass().getClassLoader()<font></font>
                                               .getResourceAsStream(<span class="hljs-string">"email_template.html"</span>)),<font></font>
                    UTF_8);<font></font>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Loading an email template failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmailDetailsToDb</span><span class="hljs-params">(ContactUsRequest contactUsRequest, SendEmailResult sendEmailResult)</span> </span>{<font></font>
        AWS_CLIENT_FACTORY.getDynamoDB().getTable(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                          .putItem(<span class="hljs-keyword">new</span> Item()<font></font>
                                  .withPrimaryKey(<span class="hljs-string">"Id"</span>, sendEmailResult.getMessageId())<font></font>
                                  .withString(<span class="hljs-string">"Subject"</span>, contactUsRequest.getSubject())<font></font>
                                  .withString(<span class="hljs-string">"Username"</span>, contactUsRequest.getUsername())<font></font>
                                  .withString(<span class="hljs-string">"Phone"</span>, contactUsRequest.getPhone())<font></font>
                                  .withString(<span class="hljs-string">"Email"</span>, contactUsRequest.getEmail())<font></font>
                                  .withString(<span class="hljs-string">"Question"</span>, contactUsRequest.getQuestion()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> ContactUsProxyResponse <span class="hljs-title">buildResponse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String body)</span> </span>{<font></font>
        ContactUsProxyResponse awsProxyResponse =<font></font>
                <span class="hljs-keyword">new</span> ContactUsProxyResponse();<font></font>
        awsProxyResponse.setStatusCode(statusCode);<font></font>
        awsProxyResponse.setBody(getBodyAsString(body));<font></font>
        awsProxyResponse.addHeader(CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());<font></font>
        awsProxyResponse.addHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
        <span class="hljs-keyword">return</span> awsProxyResponse;<font></font>
}<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getBodyAsString</span><span class="hljs-params">(String body)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OBJECT_MAPPER.writeValueAsString(<span class="hljs-keyword">new</span> ContactUsResponseBody(body));<font></font>
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Writing ContactUsResponseBody as string failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    .      ¬´// WARMING UP¬ª.</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         handleRequest()</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ContactUsProxyResponse <span class="hljs-title">handleRequest</span><span class="hljs-params">(AwsProxyRequest request, Context context)</span> </span>{<font></font>
        LOG.info(<span class="hljs-string">"Request was received"</span>);<font></font>
        LOG.debug(getAsPrettyString(request));<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
        }<font></font>
<font></font>
        ContactUsRequest contactUsRequest = getContactUsRequest(request);<font></font>
<font></font>
        SendEmailResult sendEmailResult = sendEmail(contactUsRequest);<font></font>
        LOG.info(<span class="hljs-string">"Email was sent"</span>);<font></font>
<font></font>
        addEmailDetailsToDb(contactUsRequest, sendEmailResult);<font></font>
        LOG.info(<span class="hljs-string">"DB is updated"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">200</span>,<font></font>
                String.format(<span class="hljs-string">"Message %s has been sent successfully."</span>, sendEmailResult.getMessageId()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La logique de base est assez simple, donc je ne pense pas qu'il soit utile de la d√©crire en d√©tail. Il y a plusieurs points auxquels il faut pr√™ter attention. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier est la journalisation. L'un des arguments de la m√©thode lambda Context contient de nombreuses informations auxiliaires, ainsi qu'un enregistreur. Par cons√©quent, vous ne pouvez pas cr√©er un enregistreur distinct, mais utiliser le contexte lambda fourni. Pour ce faire, il suffit d'appeler avant utilisation:</font></font><br>
<blockquote><code>LambdaLogger logger = context.getLogger(); </code></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me point se r√©chauffe. √âtant donn√© que la cr√©ation d'un environnement ex√©cutable pour un lambda est paresseuse, le d√©marrage de la JVM, le chargement du chemin de classe et l'ex√©cution du code prennent un certain temps. Le premier appel peut prendre plusieurs secondes, ce qui n'est pas bon si vous √©crivez diff√©rentes API synchrones. Dans de tels cas, vous pouvez dire √† AWS que vous devez garder plusieurs instances lambda en alerte. Mais cela n√©cessite que quelqu'un appelle un lambda. Si nous le faisons avec la version de base du code, alors, en fait, nous enverrons une lettre et √©crirons des donn√©es inexactes dans la base de donn√©es.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour √©viter cela, nous pouvons ajouter une sorte de traitement de demande pour distinguer la demande r√©elle de la demande d'√©chauffement. Par exemple, nous pouvons ajouter un en-t√™te sp√©cial √† la demande. Dans notre cas, l'en-t√™te ¬´X-WARM-UP¬ª sera utilis√© avec n'importe quelle valeur - pour comprendre qu'il s'agit d'une demande de pr√©chauffage et que nous devons uniquement renvoyer une sorte de r√©ponse sans ex√©cuter la logique m√©tier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La derni√®re chose sur laquelle je voudrais attirer l'attention est l'utilisation de variables statiques. </font><font style="vertical-align: inherit;">Cela ne rend pas l'instance lambda avec √©tat dans notre cas, cela permet simplement de r√©utiliser des objets existants et initialis√©s. </font><font style="vertical-align: inherit;">Si les objets que vous souhaitez initialiser changent statiquement lors de l'ex√©cution du code, essayez de r√©fl√©chir √† nouveau si cela va interf√©rer avec le fonctionnement des appels suivants au lambda. </font><font style="vertical-align: inherit;">De plus, si ces objets utilisent des variables d'environnement lors de l'initialisation, vous ne devez pas les rendre statiques.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Nous √©crivons des tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code lambda peut √™tre couvert par les m√™mes types de tests que vous utilisez dans la plupart des cas. </font><font style="vertical-align: inherit;">Mais pour √©viter que l'article ne se d√©veloppe encore plus, je couvrirai le test des applications sans serveur dans le prochain article sur les tests AWS Lambda et le d√©veloppement sur site. </font><font style="vertical-align: inherit;">Bien que les tests unitaires soient d√©j√† disponibles dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©f√©rentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Nous √©crivons un mod√®le de ressources SAM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir √©crit et test√© notre lambda localement, nous devons √©crire un mod√®le SAM pour d√©ployer toutes ces ressources dans AWS.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu sur SAM</font></font></b>
                        <div class="spoiler_text">Serverless Application Model ‚Äì     serverless .  ,      CloudFormation DSL,     ‚Äì   Lambda, Gateway, DynamoDB  . . <br>
SAM, CloudFormation, Terraform ‚Äì   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IaC-</a>. SAM     Serverless-,   Terraform        . <br>
 Terraform   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    DINS</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, regardons quelles ressources nous devons d√©clarer dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mod√®le SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: Function</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les principales fonctionnalit√©s sont d√©j√† remplies pour nous si nous avons utilis√© SAM init pour cr√©er le projet. </font><font style="vertical-align: inherit;">Mais voici √† quoi ils ressemblent dans mon exemple:</font></font><br>
<pre><code class="plaintext hljs">CodeUri: contact-us-function<font></font>
Handler: com.gralll.sam.App::handleRequest<font></font>
Runtime: java8<font></font>
MemorySize: 256<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, je pense que tout est assez clair. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeUri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le r√©pertoire de notre </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestionnaire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lambda </font><font style="vertical-align: inherit;">- le chemin d'acc√®s complet √† la m√©thode </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sur quoi le lambda </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est √©crit </font><font style="vertical-align: inherit;">- parle de lui-m√™me </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En parlant de m√©moire</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : jusqu'√† 3 Go de RAM sont disponibles dans le lambda, ce qui correspond √† une ressource de 2 CPU. Autrement dit, vous ne pouvez pas r√©gler le processeur s√©par√©ment, augmentant / diminuant uniquement la quantit√© de m√©moire.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le bloc suivant est n√©cessaire pour s√©lectionner la m√©thode de d√©ploiement.</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoPublishAlias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - vous permet d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajouter un alias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† chaque nouvelle version d√©ploy√©e </font><font style="vertical-align: inherit;">. Cela est n√©cessaire pour mettre en ≈ìuvre le d√©ploiement des canaris. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canary10Percent10Minutes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un type de d√©ploiement qui vous permettra de tenir simultan√©ment deux versions du lambda: l'ancienne et la nouvelle, mais ne redirigera que 10% du trafic vers la nouvelle. Si dans dix minutes il n'y a pas de probl√®me, le reste du trafic sera √©galement redirig√© vers la nouvelle version. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez en savoir plus sur l'utilisation des fonctionnalit√©s avanc√©es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la page SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viennent ensuite les variables d'environnement qui seront utilis√©es √† partir du code. Apr√®s cela, un autre bloc pour lambda:</font></font><br>
<pre><code class="plaintext hljs">Events:<font></font>
  ContactUs:<font></font>
    Type: Api<font></font>
    Properties:<font></font>
      Path: /contact<font></font>
      Method: post<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce document, nous devons d√©crire les d√©clencheurs pour appeler un lambda. Dans notre cas, il s'agira de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requ√™tes API Gateway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une forme plut√¥t simplifi√©e de description de l'API, mais il suffit que l'API de passerelle nouvellement cr√©√©e redirige toutes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> demandes </font><b><font style="vertical-align: inherit;">POST / contact</font></b><font style="vertical-align: inherit;"> vers notre lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, nous devons d√©crire les aspects de s√©curit√©. Hors de la bo√Æte, le lambda cr√©√© n'aura acc√®s ni √† la base de donn√©es ni au service de messagerie. Nous devons donc explicitement prescrire ce qui sera autoris√©. Il existe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs fa√ßons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de donner acc√®s √† l'int√©rieur d'AWS. Nous utiliserons des politiques bas√©es sur les ressources:</font></font><br>
<pre><code class="plaintext hljs">Policies:<font></font>
  - AWSLambdaExecute<font></font>
  - Version: '2012-10-17'<font></font>
    Statement:<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - ses:SendEmail<font></font>
          - ses:SendRawEmail<font></font>
        Resource: 'arn:aws:ses:eu-west-1:548476639829:identity/aleksandrgruzdev11@gmail.com'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:List*<font></font>
        Resource: '*'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:Get*<font></font>
          - dynamodb:PutItem<font></font>
          - dynamodb:DescribeTable<font></font>
        Resource: 'arn:aws:dynamodb:*:*:table/ContactUsTable'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que pour la table de base de donn√©es, nous avons sp√©cifi√© un nom sp√©cifique, par cons√©quent, nous devrons cr√©er une table avec le m√™me nom. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Concernant SES: vous voyez mon adresse e-mail. Dans votre cas, il doit s'agir de votre propre adresse confirm√©e. Comment faire cela, voir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juste apr√®s cela, vous pouvez trouver l'ARN d'identit√© de cette ressource en cliquant sur l'adresse cr√©√©e et la remplacer par l'e-mail dans l'exemple ci-dessus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils ont en quelque sorte compris la lambda. Passons maintenant √† la base de donn√©es. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: SimpleTable</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour nos t√¢ches, nous ne cr√©erons qu'une seule table </font><b><i><font style="vertical-align: inherit;">ContactUsTable</font></i></b><font style="vertical-align: inherit;"> :</font></font><br>
<pre><code class="plaintext hljs">ContactUsTable:<font></font>
  Type: AWS::Serverless::SimpleTable<font></font>
  Properties:<font></font>
    PrimaryKey:<font></font>
      Name: Id<font></font>
      Type: String<font></font>
    TableName: ContactUsTable<font></font>
    ProvisionedThroughput:<font></font>
      ReadCapacityUnits: 2<font></font>
      WriteCapacityUnits: 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les champs obligatoires - uniquement l'ID, et indiquent √©galement ReadCapacityUnits et WriteCapacityUnits. </font><font style="vertical-align: inherit;">Nous ne nous attarderons pas en d√©tail sur les valeurs √† choisir, car il s'agit √©galement d'un sujet assez vaste. </font><font style="vertical-align: inherit;">Vous pouvez le lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pour une application de test, de petites valeurs de l'ordre de 1-2 sont √©galement suffisantes. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Globals</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les param√®tres g√©n√©raux peuvent √™tre supprim√©s dans ce bloc si, par exemple, vous d√©clarez plusieurs ressources de type Function ou API.</font></font><br>
<pre><code class="plaintext hljs">Globals:<font></font>
  Function:<font></font>
    Timeout: 15<font></font>
  Api:<font></font>
    Cors:<font></font>
      AllowOrigin: "'*'"<font></font>
      AllowHeaders: "'Content-Type,X-WARM-UP,X-Amz-Date,Authorization,X-Api-Key'"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je l'ai utilis√© pour d√©finir un d√©lai d'expiration pour la fonction et certains param√®tres Cors pour appeler l'API de passerelle plus tard √† partir de ma page statique avec le formulaire ContactUs. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sorties</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ce bloc vous permet de d√©finir dynamiquement certaines variables dans le contexte global AWS CloudFormation.</font></font><br>
<pre><code class="plaintext hljs">Outputs:<font></font>
  ContactUsApi:<font></font>
    Description: "API Gateway endpoint URL for Prod stage for ContactUs function"<font></font>
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/contact/"<font></font>
  ContactUsFunction:<font></font>
    Description: "ContactUs Lambda Function ARN"<font></font>
    Value: !GetAtt ContactUsFunction.Arn<font></font>
  ContactUsFunctionIamRole:<font></font>
    Description: "Implicit IAM Role created for ContactUs function"<font></font>
    Value: !GetAtt ContactUsFunctionRole.Arn<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, nous avons d√©clar√© une variable ContactUsApi, qui sera d√©finie sur une valeur, comme adresse publique de notre point de terminaison API cr√©√©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque nous utilisons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ {ServerlessRestApi}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , AWS ins√©rera l'identifiant unique de notre nouvelle API de passerelle dans la cha√Æne. Par cons√©quent, toute application ayant acc√®s √† CloudFormation pourra obtenir cette adresse - vous ne pourrez donc pas coder en dur l'URL de vos services. Eh bien, un autre avantage est qu'il est tr√®s pratique de voir la liste des sorties - quelques m√©ta-informations sur votre pile. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une liste compl√®te des fonctions et des param√®tres que vous pouvez utiliser peut √™tre trouv√©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En plus de tout ce qui pr√©c√®de, vous pouvez ajouter un bloc </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ces options aideront √† rendre le mod√®le plus polyvalent. </font><font style="vertical-align: inherit;">Dans tout autre bloc du mod√®le, vous pouvez faire r√©f√©rence √† ces param√®tres, et donc ne pas coder en dur certaines valeurs. </font><font style="vertical-align: inherit;">Par exemple, dans mon mod√®le, il peut s'agir d'e-mails, d'ARN SES, de la quantit√© de m√©moire, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout le mod√®le. </font><font style="vertical-align: inherit;">Personne n'interdit d'ajouter quelques ressources suppl√©mentaires √† proximit√©, par exemple, un compartiment S3, toute autre ressource CloudFormation ou une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ressource personnalis√©e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en g√©n√©ral </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Nous proc√©dons au d√©ploiement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'assembler notre projet, nous n'utiliserons pas Gradle, mais SAM.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assembl√©e</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam build<font></font>
Building resource <span class="hljs-string">'ContactUsFunction'</span><font></font>
Running JavaGradleWorkflow:GradleBuild<font></font>
Running JavaGradleWorkflow:CopyArtifacts<font></font>
<font></font>
Build Succeeded<font></font>
<font></font>
Built Artifacts  : .aws-sam\build<font></font>
Built Template   : .aws-sam\build\template.yaml<font></font>
<font></font>
Commands you can use next<font></font>
=========================<font></font>
[*] Invoke Function: sam <span class="hljs-built_in">local</span> invoke<font></font>
[*] Deploy: sam deploy ‚Äìguided<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ex√©cution de la </font><font style="vertical-align: inherit;">commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam build √†</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir de la racine du projet collectera automatiquement </font><font style="vertical-align: inherit;">tous les fichiers n√©cessaires </font><font style="vertical-align: inherit;">dans le </font><font style="vertical-align: inherit;">dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.aws-sam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : classes, d√©pendances, mod√®le SAM. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez cr√©er un compartiment S3, o√π SAM t√©l√©charge ensuite tous les artefacts collect√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut √™tre fait soit via la console AWS bas√©e sur un navigateur, soit avec la commande</font></font><br>
<blockquote><code>aws s3 mb s3://bucket-name</code></blockquote><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque: tous les compartiments sont cr√©√©s dans un contexte global et ils sont fouill√©s entre tous les comptes. </font><font style="vertical-align: inherit;">Vous ne pouvez donc pas cr√©er de compartiment si quelqu'un l'a d√©j√† cr√©√© dans votre compte. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le compartiment est pr√™t, ex√©cutez la commande:</font></font><br>
<blockquote><code>sam package --output-template-file packaged.yaml --s3-bucket &lt;YOUR_BACKET&gt;</code></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sultat du package</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam package --output-template-file packaged.yaml --s3-bucket contact-us-sam-app<font></font>
Uploading to ea0c122c06a50d9676fbf9000a80a3bf  9212768 / 9212768.0  (100.00%)<font></font>
<font></font>
Successfully packaged artifacts and wrote output template to file packaged.yaml.<font></font>
Execute the following <span class="hljs-built_in">command</span> to deploy the packaged template<font></font>
sam deploy --template-file F:\aws\projects\contact-us-sam-app\packaged.yaml --stack-name &lt;YOUR STACK NAME&gt;<font></font>
</code></pre></div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai point√© mon compartiment contact-us-sam-app et SAM a t√©l√©charg√© toutes les ressources √† l'emplacement sp√©cifi√©. </font><font style="vertical-align: inherit;">Ensuite, SAM vous indique d√©j√† une commande pour cr√©er une pile avec des ressources et ainsi int√©grer votre d√©cision. </font><font style="vertical-align: inherit;">Nous ex√©cutons la commande, ayant un peu finalis√©:</font></font><br>
<blockquote><code>sam deploy --template-file packaged.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name contact-us-sam-app </code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, j'ai ajout√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--capabilities CAPABILITY_IAM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela permettra √† CloudFormation de cr√©er des ressources IAM. </font><font style="vertical-align: inherit;">Sinon, vous recevrez une erreur InsufficientCapabilities lors de la cr√©ation. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le journal des travaux de cette commande (l'image est cliquable). </font><font style="vertical-align: inherit;">Des d√©tails tels que l'√©tat de chaque ressource et les valeurs des sorties sont devenus disponibles uniquement dans l'une des derni√®res versions de SAM CLI.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/nv/7p/4z/nv7p4zreqati1wd8c8vy3ubuzcm.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. V√©rifiez l'√©tat de CloudFormation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons attendre la fin du d√©ploiement dans la console jusqu'√† ce qu'un message apparaisse indiquant que la pile a √©t√© d√©ploy√©e (la commande deploy se connecte dans le paragraphe pr√©c√©dent):</font></font><br>
<blockquote><code>Successfully created/updated stack - contact-us-sam-app in eu-west-1</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais dans notre cas, vous ne verrez ce message qu'apr√®s dix minutes en raison du mode de d√©ploiement canari. Par cons√©quent, il est plus facile d'ouvrir une console de navigateur et de regarder la pile l√†-bas. </font></font><br>
<img src="https://habrastorage.org/webt/97/ki/k8/97kik8apukwxsvqwyvsd_wtmaqo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s un certain temps, le statut passera √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE_COMPLETE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui signifiera l'ach√®vement r√©ussi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âv√©nements</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">vous pouvez voir l'√©tat de toutes les ressources. Si votre pile s'effondre, c'est ici que vous pouvez trouver des messages d'erreur d√©taill√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, ceci: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE_FAILED</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - si vous configurez incorrectement l'API de passerelle dans le mod√®le.</font></font><br>
<img src="https://habrastorage.org/webt/ce/mh/aq/cemhaqtl6uvdmlvnr0bsvrbokok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'onglet Ressources, vous pouvez trouver toutes les ressources cr√©√©es. </font><font style="vertical-align: inherit;">Ne soyez pas surpris de leur quantit√©. </font><font style="vertical-align: inherit;">Bien que nous ayons uniquement d√©clar√© une fonction et une table de base de donn√©es dans le mod√®le SAM, CloudFormation a cr√©√© de nombreuses autres ressources pour nous. </font><font style="vertical-align: inherit;">Si vous regardez leur type, vous pouvez comprendre √† quel service ils appartiennent. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour Api Gateway, il a √©t√© implicitement cr√©√©:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiDeployment</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiProdStage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aussi pour lambda, plusieurs objets suppl√©mentaires ont √©t√© cr√©√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez maintenant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outputs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et trouvez l'URL de notre API. </font><font style="vertical-align: inherit;">Copiez-le, il vous sera bient√¥t utile.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Formulaire HTML ContactUs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous vous en souvenez, j'ai d√©cid√© de cr√©er un formulaire ContactUs, et maintenant nous devons en quelque sorte le rendre disponible non seulement sur la machine locale. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En ce qui concerne le formulaire lui-m√™me, par exemple, j'ai d√©cid√© de prendre le formulaire HTML le plus simple et d'ajouter des appels d'API de passerelle via ajax. </font></font><br>
<img src="https://habrastorage.org/webt/ps/e-/4h/pse-4hta3mojfuamij0dhj3bmyg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du formulaire lui-m√™me, j'ai ajout√© quelques boutons pour d√©boguer et simplifier le remplissage: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finir par d√©faut</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - remplace, comme pr√©vu, les param√®tres par d√©faut sp√©cifi√©s dans HTML.</font></font><br>
<pre><code class="javascript hljs">$(<span class="hljs-string">"#url-input"</span>).val(<span class="hljs-string">"https://4ykskscuq0.execute-api.eu-west-1.amazonaws.com/Prod/contact"</span>);<font></font>
$(<span class="hljs-string">"#name-input"</span>).val(<span class="hljs-string">"Mike"</span>);<font></font>
$(<span class="hljs-string">"#email-input"</span>).val(<span class="hljs-string">"Mike@somemail.com"</span>);<font></font>
$(<span class="hljs-string">"#phone-input"</span>).val(<span class="hljs-string">"+79999999999"</span>);<font></font>
$(<span class="hljs-string">"#description-input"</span>).val(<span class="hljs-string">"How much does it cost?"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez l'intention d'utiliser cette fonctionnalit√©, remplacez url-input par le chemin d'acc√®s √† votre API de passerelle, que vous avez copi√© √† partir des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sorties</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√©bergement</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez un nouveau compartiment S3.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous chargeons le fichier HTML dans le compartiment en choisissant l'option pour rendre le fichier public.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons dans le seau o√π nous avons t√©l√©charg√© le fichier.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√©dez √† Propri√©t√©s, puis activez l'h√©bergement de sites Web statiques et voyez votre nouveau point de terminaison accessible au public.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Bilan de sant√©</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande standard</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous pouvez maintenant suivre le lien vers votre formulaire, cliquez sur D√©finir par d√©faut et Envoyer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette fa√ßon, vous ferez une demande qui passera par l'API de passerelle √† AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez tout configur√© correctement apr√®s un certain temps, vous recevrez un message comme:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©ussi: le message 0102016f28b06243-ae897a1e-b805-406b-9987-019f21547682-000000 a √©t√© envoy√© avec succ√®s.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela signifie que le message a √©t√© remis avec succ√®s. V√©rifiez votre bo√Æte aux lettres que vous avez sp√©cifi√©e dans le mod√®le SAM. Si vous n'avez pas modifi√© le mod√®le, la lettre sera dans ce format: </font></font><br>
<img src="https://habrastorage.org/webt/0z/wy/sv/0zwysv5ytv3uzn9fb9az7bsa6lg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vous pouvez √©galement ouvrir DynamoDB et vous assurer qu'une nouvelle entr√©e est apparue. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caract√©ristiques d'un d√©marrage √† froid</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je pense que vous avez remarqu√© que le message concernant l'envoi r√©ussi est venu apr√®s un temps assez long. Cela est d√ª au fait que le service AWS Lambda, apr√®s avoir re√ßu une demande de traitement, a commenc√© √† augmenter l'instance de votre application Java, ce qui comprend le levage du conteneur avec le syst√®me d'exploitation et JRE, le chargement du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chemin de classe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l'initialisation de toutes les variables, et ce n'est qu'apr√®s que le d√©but de la </font><i><font style="vertical-align: inherit;">demande de poign√©e ( )</font></i><font style="vertical-align: inherit;"> . C'est ce qu'on appelle un d√©marrage √† froid.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayez de remplir et d'envoyer √† nouveau le formulaire. Cette fois, la r√©ponse est venue presque instantan√©ment, non? Si plus de 20 √† 30 minutes se sont √©coul√©es entre la premi√®re et la deuxi√®me demande, le r√©sultat peut varier. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle est la raison pour √ßa? Et avec le fait que les caches AWS Lambda utilisaient d√©j√† des conteneurs contenant des lambdas pour leur r√©utilisation. Cela r√©duit le temps d'initialisation de l'ensemble du contexte pour d√©marrer la m√©thode. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de corr√©lation claire pour combien de temps les lambdas sont mis en cache selon quoi que ce soit, mais certaines personnes ont exp√©rimentalement constat√© que cela </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©pend directement de la valeur choisie de RAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Autrement dit, un lambda avec 128 Mo de m√©moire sera disponible plus longtemps qu'avec 3 Go. Il y a peut-√™tre d'autres param√®tres, par exemple, la charge moyenne sur la r√©gion dans laquelle vos lambdas sont ex√©cut√©s, mais cela est inexact. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, testez-vous et planifiez le temps de mise en cache si vous utilisez des demandes synchrones. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âchauffement</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En option, vous pouvez utiliser le chauffage lambda. Dans le code, j'ai ajout√© une v√©rification d'en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t√™te X-WAMP-UP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . S'il y en a une, le lambda renvoie simplement une r√©ponse sans ex√©cuter de logique m√©tier, mais le conteneur sera pr√™t pour les appels suivants. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez appeler votre lambda vous-m√™me, par exemple, avec la minuterie de la couronne, √† l'aide de CloudWatch. Cela vous sera utile si vous ne souhaitez pas que vos clients rejoignent Cold Start.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le formulaire HTML, vous pouvez trouver le bouton du mode WarmUp, qui ajoute cet en-t√™te sp√©cial √† la demande. </font><font style="vertical-align: inherit;">Vous pouvez v√©rifier que ni l'envoi d'une lettre ni l'√©criture dans la base de donn√©es n'ont lieu, mais la r√©ponse du lambda arrive, et l'appel suivant √† la demande r√©elle ne prendra pas beaucoup de temps.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sumer</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de l'article, nous sommes pass√©s par toutes les √©tapes principales de la conception de l'application √† sa sortie dans la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soi-disant production</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'esp√®re que les personnes qui ont d√©j√† entendu parler de Serverless et d'AWS Lambda, mais qui n'ont pas d'exp√©rience pratique, pourront utiliser ce guide et sentir que cela offre des avantages significatifs dans la vitesse de d√©ploiement de certaines solutions logicielles et pas seulement. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avantages</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour moi, j'ai identifi√© les avantages les plus pr√©cieux:</font></font><br>
<ul>
<li>     Free Tier      ,     ,       .</li>
<li>           1-2 .        /.</li>
<li>  ,          ,         .</li>
<li>  Serverless      .   ,  ‚Äî  .   SAM          AWS. AWS    ,         ,   .</li>
<li>      Lambda ,     .</li>
<li>   Serverless    , , .          ELK/Promethes/Grafana      .</li>
<li>   ,             API.          API Key,   IAM ,                      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, la chose la plus fondamentale est probablement sans serveur. </font><font style="vertical-align: inherit;">Il n'est pas n√©cessaire de penser √† l'instance EC2 pour laquelle vous devez payer, comment configurer l'acc√®s √† celle-ci, comment configurer les alertes en cas de panne d'une application, configurer la mise √† l'√©chelle automatique, etc.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inconv√©nients</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Malheureusement, cela ne signifie pas que vous pouvez maintenant prendre cette solution et l'utiliser dans le cadre d'un syst√®me d'entreprise au lieu de vos microservices pr√©f√©r√©s dans le cuber. </font><font style="vertical-align: inherit;">Tr√®s souvent, vous devez creuser plus profond√©ment pour d√©terminer une solution plus appropri√©e dans un cas particulier. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et j'ai √©galement des commentaires auxquels vous devez faire attention lors du choix de Lambda:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©marrage √† froid. </font><font style="vertical-align: inherit;">Particuli√®rement important lors de l'utilisation de requ√™tes synchrones et de langages tels que Java ou C #. </font><font style="vertical-align: inherit;">Le probl√®me est mod√©r√©ment r√©solu par l'√©chauffement, mais il vaut mieux r√©fl√©chir √† une telle solution √† l'avance et comparer le co√ªt et les avantages possibles</font></font></li>
<li>    .       3GB  ,    2   ,    ,     - Fargate,       ,     .</li>
<li>          API,       ,           .</li>
<li>    /   1-2     Serverless,                .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous disposez d√©j√† de l'infrastructure pour d√©velopper des microservices et CI / CD dans Coober, il sera √† nouveau probl√©matique de discuter (en particulier pour les gestionnaires) de la n√©cessit√© de prendre en charge un autre processus CI / CD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, o√π sans tests. </font><font style="vertical-align: inherit;">Et pour tester le lambda pour le d√©bit est assez difficile, car il est toujours diff√©rent des tests de perfarmance habituels, et de nombreux facteurs doivent √™tre pris en compte.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En g√©n√©ral, l'utilisation d'AWS Lambda et d'autres services sans serveur correspond tr√®s bien aux principes de d√©veloppement asynchrone et √©v√©nementiel. </font><font style="vertical-align: inherit;">Et c'est en utilisant un traitement asynchrone que des r√©sultats optimaux peuvent √™tre obtenus √† la fois en termes de performances et de co√ªt. </font><font style="vertical-align: inherit;">Voici une liste de solutions dans lesquelles les solutions Serveress joueront un r√¥le important:</font></font><br>
<img src="https://habrastorage.org/webt/i6/ov/y6/i6ovy6ha2pszsiui5jvyewbf-dk.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que l'article s'est av√©r√© assez √©tendu et que je ne veux pas le gonfler encore plus, je pr√©parerai tr√®s probablement une suite dans laquelle je montrerai comment mener le d√©veloppement plus efficacement en utilisant toutes les fonctionnalit√©s de la console AWS, du framework SAM et m√™me d'IntelljIDEA. </font><font style="vertical-align: inherit;">Eh bien, puisque j'ai omis la partie test, je vais essayer de d√©crire cet aspect du d√©veloppement plus en d√©tail. </font><font style="vertical-align: inherit;">De plus, si vous avez des souhaits √† ajouter au prochain article ou des questions, n'h√©sitez pas √† √©crire dans les commentaires ou dans des messages priv√©s. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout√©: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda en action. </font><font style="vertical-align: inherit;">Partie 2</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quelques liens importants et utiles de l'article:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projet GitHub</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©charger AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©charger SAM-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'infrastructure comme code</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exp√©rience avec Terraform</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description des ressources SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alias ‚Äã‚Äãde fonction AWS Lambda</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©ploiement lambda avanc√©</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration des ressources SAM Api</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS IAM   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">       SES</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Read/Write capacity  DynamoDB </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SAM/CloudFormation  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Parameters   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  CloudFormation </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">      </a></li>
</ul></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486634/index.html">Mises √† jour du backend MSVC dans Visual Studio 2019 version 16.3 et 16.4</a></li>
<li><a href="../fr486638/index.html">Blazor WebAssembly 3.2.0 Preview 1 est maintenant disponible</a></li>
<li><a href="../fr486640/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 331 (27 janvier - 2 f√©vrier)</a></li>
<li><a href="../fr486644/index.html">Antenne DIY en 5 minutes</a></li>
<li><a href="../fr486646/index.html">√âloignez-vous de jQuery √† Svelte, pas de douleur</a></li>
<li><a href="../fr486650/index.html">M√©moire dynamique dans les syst√®mes durs en temps r√©el</a></li>
<li><a href="../fr486652/index.html">¬´Critique de la raison pure¬ª pour les programmeurs</a></li>
<li><a href="../fr486654/index.html">Connexion du capteur de mouvement et de l'alarme et de l'enregistrement vid√©o dans Home Assistant sur Raspberry Pi</a></li>
<li><a href="../fr486656/index.html">Comment ajouter de nouveaux personnages √† Unicode: l'exp√©rience du profane</a></li>
<li><a href="../fr486658/index.html">Plugin de strat√©gie Moxy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>