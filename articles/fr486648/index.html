<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧓 🕟 🤲🏿 AWS Lambda en action dans Java 11. Passer à la production sans serveur 👈🏿 💮 ⌛️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est un guide sur la façon de commencer rapidement et sans douleur à utiliser AWS Lambda avec un exemple simple. Convient à la fois à un dé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda en action dans Java 11. Passer à la production sans serveur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/486648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article est un guide sur la façon de commencer rapidement et sans douleur à utiliser AWS Lambda avec un exemple simple. </font><font style="vertical-align: inherit;">Convient à la fois à un développeur qui n'a pas du tout travaillé avec Lambda et qui connaissait le Cloud pour évaluer une autre vision du développement d'applications sans serveur.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/y8/lu/bdy8luzeox9qq09msokx8yzoba4.jpeg" alt="image"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour à tous. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'appelle Alexander Gruzdev, je suis chef d'équipe Java chez DINS. Depuis plus de deux ans, je travaille en étroite collaboration avec l'infrastructure AWS et j'ai de l'expérience à la fois dans l'écriture d'applications pour AWS et dans le déploiement de ces mêmes applications. Dans mon travail, j'ai dû utiliser ElasticBeanstalk, ECS, Fargate, EKS et, bien sûr, AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chacun de ces services est bon à sa manière, et dans le cadre de cet article, je ne recommanderai pas d'utiliser uniquement AWS Lambda en remplacement de toutes les autres options. Je veux juste montrer à quel point il est facile de commencer à utiliser Lambda, et dans quels cas vous en tirerez les avantages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout le monde, des développeurs aux gestionnaires, veut un processus clair pour apporter des changements aux clients. </font><font style="vertical-align: inherit;">Plus cette voie est transparente et moins d'efforts sont nécessaires, plus elle est rentable. </font><font style="vertical-align: inherit;">Le plus souvent, les développeurs et les testeurs ne veulent pas savoir où l'application sera déployée, quel matériel choisir, dans quelle région vous souhaitez placer les répliques, etc. </font><font style="vertical-align: inherit;">Dans le diagramme suivant, vous pouvez voir la classe de services «aaS» (en tant que service), où AWS Lambda représente la catégorie FaaS.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z8/nj/wl/z8njwlqjrgatljwptthtqe9ealu.png" alt="image"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FaaS en bref</font></font></b>
                        <div class="spoiler_text">FaaS ,            .     ,  , CRUD   C, R, U, D     Create   Read.      ,   —  .<br>
</div>
                    </div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Idée</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour démontrer ce qu'est le développement d'une solution sans serveur, j'ai décidé de prendre un exemple assez banal. </font><font style="vertical-align: inherit;">Je pense que vous avez vu le formulaire de commentaires Contactez-nous sur de nombreux sites, où vous pouvez laisser votre courrier ou votre téléphone et poser une question à laquelle il sera répondu plus tard. </font><font style="vertical-align: inherit;">L'écran ci-dessous, le formulaire n'est pas super, mais le sujet de cet article n'est pas la conception matérielle. </font></font><br>
<img src="https://habrastorage.org/webt/gv/5g/iv/gv5givju7glj8vftkb1cdhupdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En remplissant ce formulaire, un client potentiel attendra un appel ou une lettre de votre part. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue technique, vous avez besoin de:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistrer les données du formulaire dans la base de données;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envoyer une lettre à un agent qui répondra à la question;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut-être écrire un autre service où l'agent marquera le travail effectué sur la base de la même base de données (non incluse dans la portée de l'article).</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'implémentation de l'idée est disponible sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose qui vient à l'esprit lors de la mise en œuvre est ce dont nous avons besoin:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">machine sous le dos, le devant, les images, etc.,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voiture avec base</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">machine avec service de messagerie.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/9a/7h/83/9a7h83iyieeicpht4-bcwy8l-ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dos et la base, dans le bon sens, doivent être répliqués, mais supposons que nous le fassions pour notre mini-magasin et que la charge sur ce formulaire soit minime. </font><font style="vertical-align: inherit;">Par conséquent, toutes ces machines peuvent être combinées en une seule et déployées en un seul ensemble. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais puisque nous envisageons Serverless, construisons l'architecture entièrement sur des composants sans serveur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peu importe à quel point Serverless peut sembler prometteur, nous comprenons tous que les serveurs sont toujours là, ils ont juste disparu de votre champ de vision. </font><font style="vertical-align: inherit;">Et maintenant que le cloud fonctionne, vous pouvez faire les tâches que vous pouvez faire vous-même. </font><font style="vertical-align: inherit;">Mais essayons d'utiliser uniquement ces composants sans serveur: </font></font><br>
<img src="https://habrastorage.org/webt/mf/iw/6i/mfiw6if-6nlss4pl-brkgxenxuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
le diagramme montre une séparation très claire de la fonctionnalité de chaque composant.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda est le composant principal qui contient du code / de la logique,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3 est responsable du stockage des ressources statiques et des scripts JS,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFront - pour les mécanismes de mise en cache et le support multi-régional,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SES - service de messagerie,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamoDB - la base de stockage des données du formulaire (de qui, quelle question, où envoyer la réponse),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de passerelle - API HTTP pour notre lambda,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route53 - nécessaire si vous souhaitez ajouter un beau nom de domaine.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous ces composants ne seront pas utilisés dans notre prochain guide, juste pour ne pas étirer l'article. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Route53 et CloudFront sont des composants assez simples que vous pouvez lire séparément. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un petit spoilers qui nous donnera une telle solution:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nous éloignons de la prise en charge des machines EC2, pas de débogage via ssh,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration facile: configurez la limitation / la mise en cache / les accès en un seul clic,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge des politiques d'accès: restreindre les droits et donner accès,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Journalisation / surveillance hors de la boîte,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Payez uniquement pour les ressources / demandes utilisées.</font></font></li>
</ul><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Démo</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entraînement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer à développer notre solution sans serveur, vous devez répondre aux exigences suivantes:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compte AWS actif</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-cli</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam-cli</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jdk 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir installé tous les outils ci-dessus, vous devez configurer votre aws-cli pour un accès à distance à AWS. </font><font style="vertical-align: inherit;">Suivez les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela nécessitera la création d'un nouvel utilisateur et le déchargement de sa clé d'accès et de sa clé secrète.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montage du projet</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Créez un projet à partir d'un modèle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez le répertoire du futur projet et lancez-le SAM CLI. </font><font style="vertical-align: inherit;">Suivez les instructions: </font></font><br>
<img src="https://habrastorage.org/webt/kn/gu/7f/kngu7fr3q_h_7t7bq-ygr7baccs.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque: Selon la version de SAM-CLI, les commandes peuvent être légèrement différentes, mais elles restent toutes intuitives. </font><font style="vertical-align: inherit;">Choisissez simplement les plus similaires à ceux qui ont été utilisés ci-dessus. </font><font style="vertical-align: inherit;">Vous pouvez également choisir un outil de construction différent si Gradle ne vous convient pas. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet "Hello, World!" </font><font style="vertical-align: inherit;">prêt. </font><font style="vertical-align: inherit;">Vous pouvez maintenant travailler sur le nom du projet et des packages, les dépendances et le code source.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Traitons les dépendances</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez les dépendances suivantes à build.gradle:</font></font><br>
<pre><code class="javascript hljs">dependencies {
    <span class="hljs-comment">// AWS</span>
    implementation group: <span class="hljs-string">'com.amazonaws.serverless'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-serverless-java-container-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.4'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.2.0'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-ses'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-dynamodb'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-log4j2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.1.0'</span><font></font>
<font></font>
    <span class="hljs-comment">// Utils</span>
    implementation group: <span class="hljs-string">'com.fasterxml.jackson.core'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'jackson-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.10.0'</span>
    implementation group: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.6'</span><font></font>
<font></font>
    <span class="hljs-comment">// Test</span>
    testImplementation group: <span class="hljs-string">'org.mockito'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'mockito-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'3.1.0'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-api-mockito2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-module-junit4'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'4.12'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les principaux sont le kit SDK AWS. </font><font style="vertical-align: inherit;">Ils vous permettront de travailler avec des services spécifiques, tels que SES, DynamoDB, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Nous écrivons un lambda</font></font></h3><br>
<ul>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous modifions les classes de demande et de réponse de modèle pour RequestHandler en AwsProxyRequest et ContactUsProxyResponse.</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span>&lt;<span class="hljs-title">AwsProxyRequest</span>, <span class="hljs-title">ContactUsProxyResponse</span>&gt;
...
<span class="hljs-title">public</span> <span class="hljs-title">ContactUsProxyResponse</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-title">AwsProxyRequest</span> <span class="hljs-title">request</span>, <span class="hljs-title">Context</span> <span class="hljs-title">context</span>) </span></code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  AwsClientFactory   AWS SDK-.</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/**
 * Just an util class for an eager initialization of sdk clients.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsClientFactory</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LogManager.getLogger(AwsClientFactory.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonSimpleEmailService sesClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DynamoDB dynamoDB;<font></font>
<font></font>
    /**<font></font>
     * AWS regions should be env variables <span class="hljs-keyword">if</span> you want to generalize the solution.<font></font>
     */<font></font>
    AwsClientFactory() {<font></font>
        LOG.debug("AWS clients factory initialization.");<font></font>
        sesClient = AmazonSimpleEmailServiceClient.builder().withRegion(Regions.EU_WEST_1).build();<font></font>
        AmazonDynamoDB dynamoDBClient = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();<font></font>
        dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(dynamoDBClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">DynamoDB <span class="hljs-title">getDynamoDB</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> dynamoDB;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">AmazonSimpleEmailService <span class="hljs-title">getSesClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sesClient;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    ObjectMapper   .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ObjectMapper OBJECT_MAPPER = <span class="hljs-keyword">new</span> ObjectMapper();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AwsClientFactory AWS_CLIENT_FACTORY = <span class="hljs-keyword">new</span> AwsClientFactory();
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">private</span> SendEmailResult <span class="hljs-title">sendEmail</span><span class="hljs-params">(ContactUsRequest contactUsRequest)</span> </span>{<font></font>
        String emailTemplate = getEmailTemplate();<font></font>
        String email = fillTemplate(emailTemplate, contactUsRequest);<font></font>
<font></font>
        SendEmailRequest sendEmailRequest =<font></font>
                <span class="hljs-keyword">new</span> SendEmailRequest(<font></font>
                        System.getenv(<span class="hljs-string">"SENDER_EMAIL"</span>),
                        <span class="hljs-keyword">new</span> Destination(List.of(System.getenv(<span class="hljs-string">"RECIPIENT_EMAIL"</span>))),
                        <span class="hljs-keyword">new</span> Message()<font></font>
                                .withSubject(<font></font>
                                        <span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(contactUsRequest.getSubject()))<font></font>
                                .withBody(<span class="hljs-keyword">new</span> Body()<font></font>
                                        .withHtml(<span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(email))));<font></font>
        LOG.info(<span class="hljs-string">"Email template is ready"</span>);
        <span class="hljs-keyword">return</span> AWS_CLIENT_FACTORY.getSesClient().sendEmail(sendEmailRequest);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fillTemplate</span><span class="hljs-params">(String emailTemplate, ContactUsRequest contactUsRequest)</span> </span>{
        <span class="hljs-keyword">return</span> String.format(<font></font>
                emailTemplate,<font></font>
                contactUsRequest.getUsername(),<font></font>
                contactUsRequest.getEmail(),<font></font>
                contactUsRequest.getPhone(),<font></font>
                contactUsRequest.getQuestion());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getEmailTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> IOUtils.toString(<font></font>
                    Objects.requireNonNull(<span class="hljs-keyword">this</span>.getClass().getClassLoader()<font></font>
                                               .getResourceAsStream(<span class="hljs-string">"email_template.html"</span>)),<font></font>
                    UTF_8);<font></font>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Loading an email template failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmailDetailsToDb</span><span class="hljs-params">(ContactUsRequest contactUsRequest, SendEmailResult sendEmailResult)</span> </span>{<font></font>
        AWS_CLIENT_FACTORY.getDynamoDB().getTable(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                          .putItem(<span class="hljs-keyword">new</span> Item()<font></font>
                                  .withPrimaryKey(<span class="hljs-string">"Id"</span>, sendEmailResult.getMessageId())<font></font>
                                  .withString(<span class="hljs-string">"Subject"</span>, contactUsRequest.getSubject())<font></font>
                                  .withString(<span class="hljs-string">"Username"</span>, contactUsRequest.getUsername())<font></font>
                                  .withString(<span class="hljs-string">"Phone"</span>, contactUsRequest.getPhone())<font></font>
                                  .withString(<span class="hljs-string">"Email"</span>, contactUsRequest.getEmail())<font></font>
                                  .withString(<span class="hljs-string">"Question"</span>, contactUsRequest.getQuestion()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> ContactUsProxyResponse <span class="hljs-title">buildResponse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String body)</span> </span>{<font></font>
        ContactUsProxyResponse awsProxyResponse =<font></font>
                <span class="hljs-keyword">new</span> ContactUsProxyResponse();<font></font>
        awsProxyResponse.setStatusCode(statusCode);<font></font>
        awsProxyResponse.setBody(getBodyAsString(body));<font></font>
        awsProxyResponse.addHeader(CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());<font></font>
        awsProxyResponse.addHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
        <span class="hljs-keyword">return</span> awsProxyResponse;<font></font>
}<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getBodyAsString</span><span class="hljs-params">(String body)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OBJECT_MAPPER.writeValueAsString(<span class="hljs-keyword">new</span> ContactUsResponseBody(body));<font></font>
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Writing ContactUsResponseBody as string failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    .      «// WARMING UP».</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         handleRequest()</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ContactUsProxyResponse <span class="hljs-title">handleRequest</span><span class="hljs-params">(AwsProxyRequest request, Context context)</span> </span>{<font></font>
        LOG.info(<span class="hljs-string">"Request was received"</span>);<font></font>
        LOG.debug(getAsPrettyString(request));<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
        }<font></font>
<font></font>
        ContactUsRequest contactUsRequest = getContactUsRequest(request);<font></font>
<font></font>
        SendEmailResult sendEmailResult = sendEmail(contactUsRequest);<font></font>
        LOG.info(<span class="hljs-string">"Email was sent"</span>);<font></font>
<font></font>
        addEmailDetailsToDb(contactUsRequest, sendEmailResult);<font></font>
        LOG.info(<span class="hljs-string">"DB is updated"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">200</span>,<font></font>
                String.format(<span class="hljs-string">"Message %s has been sent successfully."</span>, sendEmailResult.getMessageId()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La logique de base est assez simple, donc je ne pense pas qu'il soit utile de la décrire en détail. Il y a plusieurs points auxquels il faut prêter attention. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier est la journalisation. L'un des arguments de la méthode lambda Context contient de nombreuses informations auxiliaires, ainsi qu'un enregistreur. Par conséquent, vous ne pouvez pas créer un enregistreur distinct, mais utiliser le contexte lambda fourni. Pour ce faire, il suffit d'appeler avant utilisation:</font></font><br>
<blockquote><code>LambdaLogger logger = context.getLogger(); </code></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième point se réchauffe. Étant donné que la création d'un environnement exécutable pour un lambda est paresseuse, le démarrage de la JVM, le chargement du chemin de classe et l'exécution du code prennent un certain temps. Le premier appel peut prendre plusieurs secondes, ce qui n'est pas bon si vous écrivez différentes API synchrones. Dans de tels cas, vous pouvez dire à AWS que vous devez garder plusieurs instances lambda en alerte. Mais cela nécessite que quelqu'un appelle un lambda. Si nous le faisons avec la version de base du code, alors, en fait, nous enverrons une lettre et écrirons des données inexactes dans la base de données.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour éviter cela, nous pouvons ajouter une sorte de traitement de demande pour distinguer la demande réelle de la demande d'échauffement. Par exemple, nous pouvons ajouter un en-tête spécial à la demande. Dans notre cas, l'en-tête «X-WARM-UP» sera utilisé avec n'importe quelle valeur - pour comprendre qu'il s'agit d'une demande de préchauffage et que nous devons uniquement renvoyer une sorte de réponse sans exécuter la logique métier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La dernière chose sur laquelle je voudrais attirer l'attention est l'utilisation de variables statiques. </font><font style="vertical-align: inherit;">Cela ne rend pas l'instance lambda avec état dans notre cas, cela permet simplement de réutiliser des objets existants et initialisés. </font><font style="vertical-align: inherit;">Si les objets que vous souhaitez initialiser changent statiquement lors de l'exécution du code, essayez de réfléchir à nouveau si cela va interférer avec le fonctionnement des appels suivants au lambda. </font><font style="vertical-align: inherit;">De plus, si ces objets utilisent des variables d'environnement lors de l'initialisation, vous ne devez pas les rendre statiques.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Nous écrivons des tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code lambda peut être couvert par les mêmes types de tests que vous utilisez dans la plupart des cas. </font><font style="vertical-align: inherit;">Mais pour éviter que l'article ne se développe encore plus, je couvrirai le test des applications sans serveur dans le prochain article sur les tests AWS Lambda et le développement sur site. </font><font style="vertical-align: inherit;">Bien que les tests unitaires soient déjà disponibles dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Nous écrivons un modèle de ressources SAM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir écrit et testé notre lambda localement, nous devons écrire un modèle SAM pour déployer toutes ces ressources dans AWS.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu sur SAM</font></font></b>
                        <div class="spoiler_text">Serverless Application Model –     serverless .  ,      CloudFormation DSL,     –   Lambda, Gateway, DynamoDB  . . <br>
SAM, CloudFormation, Terraform –   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IaC-</a>. SAM     Serverless-,   Terraform        . <br>
 Terraform   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    DINS</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, regardons quelles ressources nous devons déclarer dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modèle SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: Function</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les principales fonctionnalités sont déjà remplies pour nous si nous avons utilisé SAM init pour créer le projet. </font><font style="vertical-align: inherit;">Mais voici à quoi ils ressemblent dans mon exemple:</font></font><br>
<pre><code class="plaintext hljs">CodeUri: contact-us-function<font></font>
Handler: com.gralll.sam.App::handleRequest<font></font>
Runtime: java8<font></font>
MemorySize: 256<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, je pense que tout est assez clair. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeUri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le répertoire de notre </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestionnaire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lambda </font><font style="vertical-align: inherit;">- le chemin d'accès complet à la méthode </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Runtime</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sur quoi le lambda </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est écrit </font><font style="vertical-align: inherit;">- parle de lui-même </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En parlant de mémoire</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : jusqu'à 3 Go de RAM sont disponibles dans le lambda, ce qui correspond à une ressource de 2 CPU. Autrement dit, vous ne pouvez pas régler le processeur séparément, augmentant / diminuant uniquement la quantité de mémoire.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le bloc suivant est nécessaire pour sélectionner la méthode de déploiement.</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoPublishAlias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - vous permet d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajouter un alias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à chaque nouvelle version déployée </font><font style="vertical-align: inherit;">. Cela est nécessaire pour mettre en œuvre le déploiement des canaris. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canary10Percent10Minutes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un type de déploiement qui vous permettra de tenir simultanément deux versions du lambda: l'ancienne et la nouvelle, mais ne redirigera que 10% du trafic vers la nouvelle. Si dans dix minutes il n'y a pas de problème, le reste du trafic sera également redirigé vers la nouvelle version. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez en savoir plus sur l'utilisation des fonctionnalités avancées </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la page SAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viennent ensuite les variables d'environnement qui seront utilisées à partir du code. Après cela, un autre bloc pour lambda:</font></font><br>
<pre><code class="plaintext hljs">Events:<font></font>
  ContactUs:<font></font>
    Type: Api<font></font>
    Properties:<font></font>
      Path: /contact<font></font>
      Method: post<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce document, nous devons décrire les déclencheurs pour appeler un lambda. Dans notre cas, il s'agira de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requêtes API Gateway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une forme plutôt simplifiée de description de l'API, mais il suffit que l'API de passerelle nouvellement créée redirige toutes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> demandes </font><b><font style="vertical-align: inherit;">POST / contact</font></b><font style="vertical-align: inherit;"> vers notre lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, nous devons décrire les aspects de sécurité. Hors de la boîte, le lambda créé n'aura accès ni à la base de données ni au service de messagerie. Nous devons donc explicitement prescrire ce qui sera autorisé. Il existe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs façons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de donner accès à l'intérieur d'AWS. Nous utiliserons des politiques basées sur les ressources:</font></font><br>
<pre><code class="plaintext hljs">Policies:<font></font>
  - AWSLambdaExecute<font></font>
  - Version: '2012-10-17'<font></font>
    Statement:<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - ses:SendEmail<font></font>
          - ses:SendRawEmail<font></font>
        Resource: 'arn:aws:ses:eu-west-1:548476639829:identity/aleksandrgruzdev11@gmail.com'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:List*<font></font>
        Resource: '*'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:Get*<font></font>
          - dynamodb:PutItem<font></font>
          - dynamodb:DescribeTable<font></font>
        Resource: 'arn:aws:dynamodb:*:*:table/ContactUsTable'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que pour la table de base de données, nous avons spécifié un nom spécifique, par conséquent, nous devrons créer une table avec le même nom. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Concernant SES: vous voyez mon adresse e-mail. Dans votre cas, il doit s'agir de votre propre adresse confirmée. Comment faire cela, voir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juste après cela, vous pouvez trouver l'ARN d'identité de cette ressource en cliquant sur l'adresse créée et la remplacer par l'e-mail dans l'exemple ci-dessus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils ont en quelque sorte compris la lambda. Passons maintenant à la base de données. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS :: Serverless :: SimpleTable</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour nos tâches, nous ne créerons qu'une seule table </font><b><i><font style="vertical-align: inherit;">ContactUsTable</font></i></b><font style="vertical-align: inherit;"> :</font></font><br>
<pre><code class="plaintext hljs">ContactUsTable:<font></font>
  Type: AWS::Serverless::SimpleTable<font></font>
  Properties:<font></font>
    PrimaryKey:<font></font>
      Name: Id<font></font>
      Type: String<font></font>
    TableName: ContactUsTable<font></font>
    ProvisionedThroughput:<font></font>
      ReadCapacityUnits: 2<font></font>
      WriteCapacityUnits: 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les champs obligatoires - uniquement l'ID, et indiquent également ReadCapacityUnits et WriteCapacityUnits. </font><font style="vertical-align: inherit;">Nous ne nous attarderons pas en détail sur les valeurs à choisir, car il s'agit également d'un sujet assez vaste. </font><font style="vertical-align: inherit;">Vous pouvez le lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pour une application de test, de petites valeurs de l'ordre de 1-2 sont également suffisantes. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Globals</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Les paramètres généraux peuvent être supprimés dans ce bloc si, par exemple, vous déclarez plusieurs ressources de type Function ou API.</font></font><br>
<pre><code class="plaintext hljs">Globals:<font></font>
  Function:<font></font>
    Timeout: 15<font></font>
  Api:<font></font>
    Cors:<font></font>
      AllowOrigin: "'*'"<font></font>
      AllowHeaders: "'Content-Type,X-WARM-UP,X-Amz-Date,Authorization,X-Api-Key'"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je l'ai utilisé pour définir un délai d'expiration pour la fonction et certains paramètres Cors pour appeler l'API de passerelle plus tard à partir de ma page statique avec le formulaire ContactUs. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sorties</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ce bloc vous permet de définir dynamiquement certaines variables dans le contexte global AWS CloudFormation.</font></font><br>
<pre><code class="plaintext hljs">Outputs:<font></font>
  ContactUsApi:<font></font>
    Description: "API Gateway endpoint URL for Prod stage for ContactUs function"<font></font>
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/contact/"<font></font>
  ContactUsFunction:<font></font>
    Description: "ContactUs Lambda Function ARN"<font></font>
    Value: !GetAtt ContactUsFunction.Arn<font></font>
  ContactUsFunctionIamRole:<font></font>
    Description: "Implicit IAM Role created for ContactUs function"<font></font>
    Value: !GetAtt ContactUsFunctionRole.Arn<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, nous avons déclaré une variable ContactUsApi, qui sera définie sur une valeur, comme adresse publique de notre point de terminaison API créé. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque nous utilisons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ {ServerlessRestApi}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , AWS insérera l'identifiant unique de notre nouvelle API de passerelle dans la chaîne. Par conséquent, toute application ayant accès à CloudFormation pourra obtenir cette adresse - vous ne pourrez donc pas coder en dur l'URL de vos services. Eh bien, un autre avantage est qu'il est très pratique de voir la liste des sorties - quelques méta-informations sur votre pile. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une liste complète des fonctions et des paramètres que vous pouvez utiliser peut être trouvée </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paramètres</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En plus de tout ce qui précède, vous pouvez ajouter un bloc </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paramètres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ces options aideront à rendre le modèle plus polyvalent. </font><font style="vertical-align: inherit;">Dans tout autre bloc du modèle, vous pouvez faire référence à ces paramètres, et donc ne pas coder en dur certaines valeurs. </font><font style="vertical-align: inherit;">Par exemple, dans mon modèle, il peut s'agir d'e-mails, d'ARN SES, de la quantité de mémoire, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout le modèle. </font><font style="vertical-align: inherit;">Personne n'interdit d'ajouter quelques ressources supplémentaires à proximité, par exemple, un compartiment S3, toute autre ressource CloudFormation ou une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ressource personnalisée</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en général </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Nous procédons au déploiement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'assembler notre projet, nous n'utiliserons pas Gradle, mais SAM.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assemblée</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam build<font></font>
Building resource <span class="hljs-string">'ContactUsFunction'</span><font></font>
Running JavaGradleWorkflow:GradleBuild<font></font>
Running JavaGradleWorkflow:CopyArtifacts<font></font>
<font></font>
Build Succeeded<font></font>
<font></font>
Built Artifacts  : .aws-sam\build<font></font>
Built Template   : .aws-sam\build\template.yaml<font></font>
<font></font>
Commands you can use next<font></font>
=========================<font></font>
[*] Invoke Function: sam <span class="hljs-built_in">local</span> invoke<font></font>
[*] Deploy: sam deploy –guided<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exécution de la </font><font style="vertical-align: inherit;">commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam build à</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir de la racine du projet collectera automatiquement </font><font style="vertical-align: inherit;">tous les fichiers nécessaires </font><font style="vertical-align: inherit;">dans le </font><font style="vertical-align: inherit;">dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.aws-sam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : classes, dépendances, modèle SAM. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez créer un compartiment S3, où SAM télécharge ensuite tous les artefacts collectés. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut être fait soit via la console AWS basée sur un navigateur, soit avec la commande</font></font><br>
<blockquote><code>aws s3 mb s3://bucket-name</code></blockquote><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque: tous les compartiments sont créés dans un contexte global et ils sont fouillés entre tous les comptes. </font><font style="vertical-align: inherit;">Vous ne pouvez donc pas créer de compartiment si quelqu'un l'a déjà créé dans votre compte. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le compartiment est prêt, exécutez la commande:</font></font><br>
<blockquote><code>sam package --output-template-file packaged.yaml --s3-bucket &lt;YOUR_BACKET&gt;</code></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résultat du package</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam package --output-template-file packaged.yaml --s3-bucket contact-us-sam-app<font></font>
Uploading to ea0c122c06a50d9676fbf9000a80a3bf  9212768 / 9212768.0  (100.00%)<font></font>
<font></font>
Successfully packaged artifacts and wrote output template to file packaged.yaml.<font></font>
Execute the following <span class="hljs-built_in">command</span> to deploy the packaged template<font></font>
sam deploy --template-file F:\aws\projects\contact-us-sam-app\packaged.yaml --stack-name &lt;YOUR STACK NAME&gt;<font></font>
</code></pre></div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai pointé mon compartiment contact-us-sam-app et SAM a téléchargé toutes les ressources à l'emplacement spécifié. </font><font style="vertical-align: inherit;">Ensuite, SAM vous indique déjà une commande pour créer une pile avec des ressources et ainsi intégrer votre décision. </font><font style="vertical-align: inherit;">Nous exécutons la commande, ayant un peu finalisé:</font></font><br>
<blockquote><code>sam deploy --template-file packaged.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name contact-us-sam-app </code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, j'ai ajouté </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--capabilities CAPABILITY_IAM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela permettra à CloudFormation de créer des ressources IAM. </font><font style="vertical-align: inherit;">Sinon, vous recevrez une erreur InsufficientCapabilities lors de la création. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le journal des travaux de cette commande (l'image est cliquable). </font><font style="vertical-align: inherit;">Des détails tels que l'état de chaque ressource et les valeurs des sorties sont devenus disponibles uniquement dans l'une des dernières versions de SAM CLI.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/nv/7p/4z/nv7p4zreqati1wd8c8vy3ubuzcm.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Vérifiez l'état de CloudFormation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons attendre la fin du déploiement dans la console jusqu'à ce qu'un message apparaisse indiquant que la pile a été déployée (la commande deploy se connecte dans le paragraphe précédent):</font></font><br>
<blockquote><code>Successfully created/updated stack - contact-us-sam-app in eu-west-1</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais dans notre cas, vous ne verrez ce message qu'après dix minutes en raison du mode de déploiement canari. Par conséquent, il est plus facile d'ouvrir une console de navigateur et de regarder la pile là-bas. </font></font><br>
<img src="https://habrastorage.org/webt/97/ki/k8/97kik8apukwxsvqwyvsd_wtmaqo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après un certain temps, le statut passera à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE_COMPLETE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui signifiera l'achèvement réussi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Événements</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">vous pouvez voir l'état de toutes les ressources. Si votre pile s'effondre, c'est ici que vous pouvez trouver des messages d'erreur détaillés. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, ceci: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE_FAILED</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - si vous configurez incorrectement l'API de passerelle dans le modèle.</font></font><br>
<img src="https://habrastorage.org/webt/ce/mh/aq/cemhaqtl6uvdmlvnr0bsvrbokok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'onglet Ressources, vous pouvez trouver toutes les ressources créées. </font><font style="vertical-align: inherit;">Ne soyez pas surpris de leur quantité. </font><font style="vertical-align: inherit;">Bien que nous ayons uniquement déclaré une fonction et une table de base de données dans le modèle SAM, CloudFormation a créé de nombreuses autres ressources pour nous. </font><font style="vertical-align: inherit;">Si vous regardez leur type, vous pouvez comprendre à quel service ils appartiennent. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour Api Gateway, il a été implicitement créé:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiDeployment</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiProdStage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aussi pour lambda, plusieurs objets supplémentaires ont été créés. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez maintenant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outputs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et trouvez l'URL de notre API. </font><font style="vertical-align: inherit;">Copiez-le, il vous sera bientôt utile.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Formulaire HTML ContactUs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous vous en souvenez, j'ai décidé de créer un formulaire ContactUs, et maintenant nous devons en quelque sorte le rendre disponible non seulement sur la machine locale. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En ce qui concerne le formulaire lui-même, par exemple, j'ai décidé de prendre le formulaire HTML le plus simple et d'ajouter des appels d'API de passerelle via ajax. </font></font><br>
<img src="https://habrastorage.org/webt/ps/e-/4h/pse-4hta3mojfuamij0dhj3bmyg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du formulaire lui-même, j'ai ajouté quelques boutons pour déboguer et simplifier le remplissage: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Définir par défaut</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - remplace, comme prévu, les paramètres par défaut spécifiés dans HTML.</font></font><br>
<pre><code class="javascript hljs">$(<span class="hljs-string">"#url-input"</span>).val(<span class="hljs-string">"https://4ykskscuq0.execute-api.eu-west-1.amazonaws.com/Prod/contact"</span>);<font></font>
$(<span class="hljs-string">"#name-input"</span>).val(<span class="hljs-string">"Mike"</span>);<font></font>
$(<span class="hljs-string">"#email-input"</span>).val(<span class="hljs-string">"Mike@somemail.com"</span>);<font></font>
$(<span class="hljs-string">"#phone-input"</span>).val(<span class="hljs-string">"+79999999999"</span>);<font></font>
$(<span class="hljs-string">"#description-input"</span>).val(<span class="hljs-string">"How much does it cost?"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez l'intention d'utiliser cette fonctionnalité, remplacez url-input par le chemin d'accès à votre API de passerelle, que vous avez copié à partir des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sorties</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hébergement</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez un nouveau compartiment S3.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous chargeons le fichier HTML dans le compartiment en choisissant l'option pour rendre le fichier public.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons dans le seau où nous avons téléchargé le fichier.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accédez à Propriétés, puis activez l'hébergement de sites Web statiques et voyez votre nouveau point de terminaison accessible au public.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Bilan de santé</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande standard</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous pouvez maintenant suivre le lien vers votre formulaire, cliquez sur Définir par défaut et Envoyer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette façon, vous ferez une demande qui passera par l'API de passerelle à AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez tout configuré correctement après un certain temps, vous recevrez un message comme:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réussi: le message 0102016f28b06243-ae897a1e-b805-406b-9987-019f21547682-000000 a été envoyé avec succès.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela signifie que le message a été remis avec succès. Vérifiez votre boîte aux lettres que vous avez spécifiée dans le modèle SAM. Si vous n'avez pas modifié le modèle, la lettre sera dans ce format: </font></font><br>
<img src="https://habrastorage.org/webt/0z/wy/sv/0zwysv5ytv3uzn9fb9az7bsa6lg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vous pouvez également ouvrir DynamoDB et vous assurer qu'une nouvelle entrée est apparue. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caractéristiques d'un démarrage à froid</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je pense que vous avez remarqué que le message concernant l'envoi réussi est venu après un temps assez long. Cela est dû au fait que le service AWS Lambda, après avoir reçu une demande de traitement, a commencé à augmenter l'instance de votre application Java, ce qui comprend le levage du conteneur avec le système d'exploitation et JRE, le chargement du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chemin de classe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l'initialisation de toutes les variables, et ce n'est qu'après que le début de la </font><i><font style="vertical-align: inherit;">demande de poignée ( )</font></i><font style="vertical-align: inherit;"> . C'est ce qu'on appelle un démarrage à froid.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayez de remplir et d'envoyer à nouveau le formulaire. Cette fois, la réponse est venue presque instantanément, non? Si plus de 20 à 30 minutes se sont écoulées entre la première et la deuxième demande, le résultat peut varier. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle est la raison pour ça? Et avec le fait que les caches AWS Lambda utilisaient déjà des conteneurs contenant des lambdas pour leur réutilisation. Cela réduit le temps d'initialisation de l'ensemble du contexte pour démarrer la méthode. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de corrélation claire pour combien de temps les lambdas sont mis en cache selon quoi que ce soit, mais certaines personnes ont expérimentalement constaté que cela </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dépend directement de la valeur choisie de RAM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Autrement dit, un lambda avec 128 Mo de mémoire sera disponible plus longtemps qu'avec 3 Go. Il y a peut-être d'autres paramètres, par exemple, la charge moyenne sur la région dans laquelle vos lambdas sont exécutés, mais cela est inexact. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, testez-vous et planifiez le temps de mise en cache si vous utilisez des demandes synchrones. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Échauffement</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En option, vous pouvez utiliser le chauffage lambda. Dans le code, j'ai ajouté une vérification d'en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-tête X-WAMP-UP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . S'il y en a une, le lambda renvoie simplement une réponse sans exécuter de logique métier, mais le conteneur sera prêt pour les appels suivants. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez appeler votre lambda vous-même, par exemple, avec la minuterie de la couronne, à l'aide de CloudWatch. Cela vous sera utile si vous ne souhaitez pas que vos clients rejoignent Cold Start.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le formulaire HTML, vous pouvez trouver le bouton du mode WarmUp, qui ajoute cet en-tête spécial à la demande. </font><font style="vertical-align: inherit;">Vous pouvez vérifier que ni l'envoi d'une lettre ni l'écriture dans la base de données n'ont lieu, mais la réponse du lambda arrive, et l'appel suivant à la demande réelle ne prendra pas beaucoup de temps.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résumer</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de l'article, nous sommes passés par toutes les étapes principales de la conception de l'application à sa sortie dans la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soi-disant production</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espère que les personnes qui ont déjà entendu parler de Serverless et d'AWS Lambda, mais qui n'ont pas d'expérience pratique, pourront utiliser ce guide et sentir que cela offre des avantages significatifs dans la vitesse de déploiement de certaines solutions logicielles et pas seulement. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avantages</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour moi, j'ai identifié les avantages les plus précieux:</font></font><br>
<ul>
<li>     Free Tier      ,     ,       .</li>
<li>           1-2 .        /.</li>
<li>  ,          ,         .</li>
<li>  Serverless      .   ,  —  .   SAM          AWS. AWS    ,         ,   .</li>
<li>      Lambda ,     .</li>
<li>   Serverless    , , .          ELK/Promethes/Grafana      .</li>
<li>   ,             API.          API Key,   IAM ,                      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, la chose la plus fondamentale est probablement sans serveur. </font><font style="vertical-align: inherit;">Il n'est pas nécessaire de penser à l'instance EC2 pour laquelle vous devez payer, comment configurer l'accès à celle-ci, comment configurer les alertes en cas de panne d'une application, configurer la mise à l'échelle automatique, etc.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inconvénients</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Malheureusement, cela ne signifie pas que vous pouvez maintenant prendre cette solution et l'utiliser dans le cadre d'un système d'entreprise au lieu de vos microservices préférés dans le cuber. </font><font style="vertical-align: inherit;">Très souvent, vous devez creuser plus profondément pour déterminer une solution plus appropriée dans un cas particulier. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et j'ai également des commentaires auxquels vous devez faire attention lors du choix de Lambda:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Démarrage à froid. </font><font style="vertical-align: inherit;">Particulièrement important lors de l'utilisation de requêtes synchrones et de langages tels que Java ou C #. </font><font style="vertical-align: inherit;">Le problème est modérément résolu par l'échauffement, mais il vaut mieux réfléchir à une telle solution à l'avance et comparer le coût et les avantages possibles</font></font></li>
<li>    .       3GB  ,    2   ,    ,     - Fargate,       ,     .</li>
<li>          API,       ,           .</li>
<li>    /   1-2     Serverless,                .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous disposez déjà de l'infrastructure pour développer des microservices et CI / CD dans Coober, il sera à nouveau problématique de discuter (en particulier pour les gestionnaires) de la nécessité de prendre en charge un autre processus CI / CD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, où sans tests. </font><font style="vertical-align: inherit;">Et pour tester le lambda pour le débit est assez difficile, car il est toujours différent des tests de perfarmance habituels, et de nombreux facteurs doivent être pris en compte.</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En général, l'utilisation d'AWS Lambda et d'autres services sans serveur correspond très bien aux principes de développement asynchrone et événementiel. </font><font style="vertical-align: inherit;">Et c'est en utilisant un traitement asynchrone que des résultats optimaux peuvent être obtenus à la fois en termes de performances et de coût. </font><font style="vertical-align: inherit;">Voici une liste de solutions dans lesquelles les solutions Serveress joueront un rôle important:</font></font><br>
<img src="https://habrastorage.org/webt/i6/ov/y6/i6ovy6ha2pszsiui5jvyewbf-dk.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que l'article s'est avéré assez étendu et que je ne veux pas le gonfler encore plus, je préparerai très probablement une suite dans laquelle je montrerai comment mener le développement plus efficacement en utilisant toutes les fonctionnalités de la console AWS, du framework SAM et même d'IntelljIDEA. </font><font style="vertical-align: inherit;">Eh bien, puisque j'ai omis la partie test, je vais essayer de décrire cet aspect du développement plus en détail. </font><font style="vertical-align: inherit;">De plus, si vous avez des souhaits à ajouter au prochain article ou des questions, n'hésitez pas à écrire dans les commentaires ou dans des messages privés. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouté: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda en action. </font><font style="vertical-align: inherit;">Partie 2</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quelques liens importants et utiles de l'article:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projet GitHub</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Télécharger AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Télécharger SAM-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration AWS-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'infrastructure comme code</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expérience avec Terraform</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description des ressources SAM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alias ​​de fonction AWS Lambda</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Déploiement lambda avancé</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration des ressources SAM Api</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS IAM   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">       SES</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Read/Write capacity  DynamoDB </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SAM/CloudFormation  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Parameters   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  CloudFormation </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">      </a></li>
</ul></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486634/index.html">Mises à jour du backend MSVC dans Visual Studio 2019 version 16.3 et 16.4</a></li>
<li><a href="../fr486638/index.html">Blazor WebAssembly 3.2.0 Preview 1 est maintenant disponible</a></li>
<li><a href="../fr486640/index.html">Le condensé de matériaux intéressants pour le développeur mobile # 331 (27 janvier - 2 février)</a></li>
<li><a href="../fr486644/index.html">Antenne DIY en 5 minutes</a></li>
<li><a href="../fr486646/index.html">Éloignez-vous de jQuery à Svelte, pas de douleur</a></li>
<li><a href="../fr486650/index.html">Mémoire dynamique dans les systèmes durs en temps réel</a></li>
<li><a href="../fr486652/index.html">«Critique de la raison pure» pour les programmeurs</a></li>
<li><a href="../fr486654/index.html">Connexion du capteur de mouvement et de l'alarme et de l'enregistrement vidéo dans Home Assistant sur Raspberry Pi</a></li>
<li><a href="../fr486656/index.html">Comment ajouter de nouveaux personnages à Unicode: l'expérience du profane</a></li>
<li><a href="../fr486658/index.html">Plugin de stratégie Moxy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>