<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌰 🧑🏿 👩🏼‍🚒 暗号化、XOR、暗号化されていないZIPおよびPRSPのハッキング。r0ot-mi Cryptoによる問題解決。パート2 💴 👨🏾‍🍳 👔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、crypt関数について学び、暗号化されていないファイル名を含むZIPアーカイブのパスワードを選択する方法を学び、xortoolユーティリティを理解し、疑似乱数ジェネレーターを扱います。このトピックに関する以前の記事：
 
 パート1- PIL pythonを使用したエンコード、シフト暗...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>暗号化、XOR、暗号化されていないZIPおよびPRSPのハッキング。r0ot-mi Cryptoによる問題解決。パート2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482680/"><img src="https://habrastorage.org/webt/ux/pz/a0/uxpza0t6_t38ztc07yhtciypf8g.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、crypt関数について学び、暗号化されていないファイル名を含むZIPアーカイブのパスワードを選択する方法を学び、xortoolユーティリティを理解し、疑似乱数ジェネレーターを扱います。</font><font style="vertical-align: inherit;">このトピックに関する以前の記事：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パート1- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PIL pythonを使用したエンコード、シフト暗号、ブルートハッシュ、画像の作成。</font></font></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組織情報</font></font></b><div class="spoiler_text">  ,    -           ,        :<br>
<br>
<ul>
<li>PWN;</li>
<li> (Crypto);</li>
<li>c  (Network);</li>
<li> (Reverse Engineering);</li>
<li> (Stegano);</li>
<li>   WEB-.</li>
</ul><br>
         ,    ,        ,     .<br>
<a name="habracut"></a><br>
      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">    </a>.<br>
<br>
      .          ,  -      ,      .<br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ELF64-PID暗号化</font></font></h2><br>
<img src="https://habrastorage.org/webt/zp/9w/da/zp9wdanzxvhz4uiuusjcfd5coe8.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースコードを見ます。プログラムは文字列を引数として取り、それをcryt関数がプログラムのPIDから返すものおよび文字列 "$ 1 $ awesome"と比較します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cryt関数は、パスワードハッシュの計算に使用されるライブラリ関数です。関数の出力は、単なるハッシュではなく、salt、使用されたハッシュアルゴリズム、およびハッシュの受信に使用されたパラメーター（ラウンド数やその他のオプションなど）も含むテキスト行です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jq/3f/3y/jq3f3y-d2srjnkudzwbrhxwsfsk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この機能は、Perl、PHP、Pike、Python、Rubyのプログラミング言語に含まれています。したがって、プログラムの起動に使用するPIDを推測する必要があります。 SSH経由で接続すると、プログラム、そのソース、およびパスワード付きのファイルが提供されることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9m/8i/k7/9m8ik71wa-fei5gcp-hbcm01mpk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linuxでは、実行中のすべての新しいアプリケーションが、最も近い増分無料PID値を受け取ります。</font><font style="vertical-align: inherit;">たとえば、psを続けて数回実行します。</font><font style="vertical-align: inherit;">PIDは毎回インクリメントされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/sr/db/iusrdb1rfj_k3rh116obbcee_ds.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、任意の空きPIDからハッシュを計算し、この値を引数として、プログラムを無限に実行できます。</font><font style="vertical-align: inherit;">PID、たとえば30000を取り、crypt関数を実行してみましょう。</font><font style="vertical-align: inherit;">私はそれをpythonで行います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/im/yh/pr/imyhpredd7_yoo0jvvlcjlz9zbg.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、無限のプログラム実行ループを実行します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vx/y6/mr/vxy6mrtke5wyblw7fmzaz0_92nw.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして1分後、パスワードを読み取る場所からシェルを取得します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m1/zu/u7/m1zuu7o4dytba97nopsqm0a-qck.png" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル-PKZIP</font></font></h2><br>
<img src="https://habrastorage.org/webt/8h/fh/n8/8hfhn8x1q1c6mng5btrn9n3tpxm.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らが提供するファイルをダウンロードしてください。</font><font style="vertical-align: inherit;">これはパスワードで保護されたZIPアーカイブです。</font><font style="vertical-align: inherit;">パスワードを確認してみましょう。</font><font style="vertical-align: inherit;">ファイル名は暗号化されていないため、fcrackzipユーティリティにし、rockyou.txtを辞書として使用します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/mi/qt/sdmiqt3lilxfpbaxz8chexwtlrk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解凍すると、答えはアーカイブのパスワードであることが記載されたテキストファイルが作成されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/m5/uq/lpm5uqukykoth4k-y_gjf8t2qqi.png" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既知の平文-XOR</font></font></h2><br>
<img src="https://habrastorage.org/webt/eg/it/va/egitvahzvebbcqatvgwcqfclo-g.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XOR BMPを使用して暗号化された画像が提供されます。</font><font style="vertical-align: inherit;">XORを使用し（短いキーで想定）、暗号文が大きいため、xortoolを使用できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/uo/_r/feuo_rxvnihxkyvnz92balmp0ka.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、xortoolは、最も可能性の高いキーの長さは6であると考えています。キーを決定するように依頼してみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2j/tb/ol/2jtbol6v5yhbd0swhdy8cnbpn7g.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいよ </font><font style="vertical-align: inherit;">キーは定義されていますが、xortool自体がファイルを復号化し、xortool_outディレクトリに保存しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ul/wr/u4/ulwru45g91prmp9990nawqeu98c.png" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード-疑似乱数ジェネレータ</font></font></h2><br>
<img src="https://habrastorage.org/webt/pd/pr/ns/pdprnsnnnqtgmthwxzpzzbgtg0e.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルを暗号化するプログラムとファイル自体が提供されます。さらに、彼らは暗号化が2012年12月に行われたと言います。コードをクリーンアップしましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムの最初に、現在の時刻が記憶されます（正確には、1970年1月1日から経過した時刻）。次に、プログラムパラメータの存在がチェックされます-ファイルへのパス。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/ve/w6/tevew6jfzkm_160_8kit7_8ue-i.png" alt="画像"><br>
<br>
<img src="https://habrastorage.org/webt/cf/bc/lo/cfbclozjtg9e6itqoj7t6rznmg4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、このファイルを読み取り用に開き、書き込み用に新しいファイルを作成します。両方のファイルの記述子がcrypt_file関数に渡されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2h/ri/ya/2hriyayc7ulxizar3dhk_6ndj7m.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
crypt_fileでは、genere_key（）関数は、ファイルのXOR暗号化に使用される32バイトのキーを反転します。暗号化の結果は、新しく作成されたファイルに書き込まれます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/ed/s1/tfeds1s1m5txk8llicyfh6hmrbc.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キーは疑似ランダムな方法でコンパイルされます。</font><font style="vertical-align: inherit;">各ステップで提示されたアルファベットから、各ステップで変化するholdrandの値に応じて値が選択され、最初は現在の時刻に等しくなります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c3/hm/mp/c3hmmpadb0yoqdaor0er7q_xtes.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、可能なキーを生成する必要があります。</font><font style="vertical-align: inherit;">Pythonのソースコードは次のようになります。</font></font><br>
<pre><code class="python hljs">keys = []<font></font>
charset = <span class="hljs-string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789"</span><font></font>
l = len(charset)<font></font>
holdrand = <span class="hljs-literal">None</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Rand</span>():</span>
	<span class="hljs-keyword">global</span> holdrand<font></font>
	holdrand = holdrand * <span class="hljs-number">214013</span> + <span class="hljs-number">2531011</span>
	<span class="hljs-keyword">return</span> ((holdrand &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0x7fff</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genere_key</span>():</span>
	key = <span class="hljs-string">""</span>.join( [ charset[Rand()%l] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>) ] )  <font></font>
	keys.append(key)<font></font>
<font></font>
start = ?<font></font>
fin = ?<font></font>
<font></font>
<span class="hljs-keyword">for</span> ts <span class="hljs-keyword">in</span> range(start, fin):<font></font>
	holdrand = ts<font></font>
	genere_key()</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、時間の境界を扱いましょう。</font><font style="vertical-align: inherit;">暗号化は2012年12月に実行されたため、12月1日から12月31日までのすべての可能な値をソートする必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/vj/i-/_pvji-osfxwv0e941u66gdemhmu.png" alt="画像"><br>
<br>
<pre><code class="python hljs">start = <span class="hljs-number">1354320000</span>
fin = <span class="hljs-number">1356998400</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
国境については決めましたが、まだたくさんの鍵があります。</font><font style="vertical-align: inherit;">幸い、ファイルには拡張子があります-これはbz2です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3m/ue/tq/3muetqnmr68aqqxdhurwzs-vae4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、ファイルの最初の3バイトは「BZh」でなければならず、4番目は「1」から「9」までの文字の1つでなければならず、次の6バイトは0x314159265359でなければなりません。</font><font style="vertical-align: inherit;">キーのフィルターを追加しましょう。</font><font style="vertical-align: inherit;">これを行うには、暗号文の最初のバイトが必要です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/dw/wf/vqdwwfaeqhc31rflnns7gr2wuiu.png" alt="画像"><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">key_filter</span>(<span class="hljs-params">key</span>):</span>
	ctext = <span class="hljs-string">"\x23\x17\x5d\x70\x5a\x11\x6d\x67\x37\x08"</span>
	BZh = <span class="hljs-string">"BZh"</span>
	sign = <span class="hljs-string">""</span>.join( [ chr(ord(ctext[i])^ord(BZh[i])) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>) ] )<font></font>
	byte4 = <span class="hljs-string">""</span>.join( [ chr(ord(ctext[<span class="hljs-number">3</span>])^ord(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">"123456789"</span> ] )<font></font>
	bytePI = chr(ord(ctext[<span class="hljs-number">4</span>])^<span class="hljs-number">0x31</span>)
	<span class="hljs-keyword">if</span> sign <span class="hljs-keyword">in</span> key[:<span class="hljs-number">3</span>] <span class="hljs-keyword">and</span> key[<span class="hljs-number">3</span>] <span class="hljs-keyword">in</span> byte4 <span class="hljs-keyword">and</span> key[<span class="hljs-number">4</span>] <span class="hljs-keyword">in</span> bytePI:<font></font>
		print(key)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、キーは1つだけです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/yp/4i/zvyp4iyuuxu-m2daciww8howgbe.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じxortoolを使用して、キーを使用してファイルをプロキシできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b6/8t/ly/b68tlygv2_abbqakbsmc1bucywi.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、アーカイブを復号化しました。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Telegramで</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
参加でき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ITの多くの分野に精通している人々が集まるコミュニティをまとめましょう。そうすれば、ITと情報セキュリティの問題について常に互いに助け合うことができます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482670/index.html">MacBookでハイブリッドハードドライブを使用し、Windowsをインストールする</a></li>
<li><a href="../ja482672/index.html">年次報告Habrapost-2019</a></li>
<li><a href="../ja482674/index.html">「休暇の直後」：ITMO大学でのセミナー、マスタークラス、技術コンテスト</a></li>
<li><a href="../ja482676/index.html">Structタイプのデータの効果的なソート</a></li>
<li><a href="../ja482678/index.html">iOSのテキストクエストを行うことに決めた方法とその理由</a></li>
<li><a href="../ja482682/index.html">Qtツールの自動化</a></li>
<li><a href="../ja482684/index.html">私は2週間で自分のdipfakeと$ 552を作成しました</a></li>
<li><a href="../ja482686/index.html">科学者は動物の行動研究を自動化して脳機能を解読する</a></li>
<li><a href="../ja482690/index.html">Combineでパブリッシャーを作成する</a></li>
<li><a href="../ja482696/index.html">Windows Linuxインストール済みシステムの完全ディスク暗号化。暗号化されたマルチブート</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>