<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍✈️ 🧑🏽‍🤝‍🧑🏻 🌠 Rationalisation de l'API Check Point avec le SDK Python ⛳️ 🌨️ 🧑🏿‍🤝‍🧑🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Toute la puissance d'interagir avec l'API est révélée lorsqu'elle est utilisée conjointement avec le code du programme, lorsqu'il devient possible de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rationalisation de l'API Check Point avec le SDK Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505510/"><img src="https://habrastorage.org/webt/xf/kx/d6/xfkxd68ynnabb65k6ygvksmoyzw.png" alt="image"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la puissance d'interagir avec l'API est révélée lorsqu'elle est utilisée conjointement avec le code du programme, lorsqu'il devient possible de générer dynamiquement des demandes d'API et des outils pour analyser les réponses d'API. Cependant, le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kit de développement logiciel Python</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ci-après dénommé le SDK Python) pour l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de gestion des points de contrôle</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais en vain </font><font style="vertical-align: inherit;">, reste invisible </font><font style="vertical-align: inherit;">. Il simplifie considérablement la vie des développeurs et des amateurs d'automatisation. Python a acquis une immense popularité ces derniers temps et j'ai décidé de combler le fossé et de donner un aperçu des principales caractéristiques du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kit de développement Python API Check Point</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cet article est un excellent complément à un autre article sur l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">API</font></a><font style="vertical-align: inherit;"> Habré </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point R80.10. Gestion via CLI, scripts et plus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous verrons comment écrire des scripts à l'aide du SDK Python et nous attarderons plus en détail sur la nouvelle fonctionnalité de l'API de gestion dans la version 1.6 (prise en charge depuis R80.40). </font><font style="vertical-align: inherit;">Pour comprendre l'article, vous aurez besoin de connaissances de base sur l'utilisation des API et de Python.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Check Point développe activement l'API et il existe actuellement:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check Point Management API (version actuelle 1.6)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fonctionne avec le serveur de gestion via l'API (et la possibilité d'exécuter des scripts sur des passerelles sous le contrôle du serveur de gestion)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Check Point GAIA (version actuelle 1.4)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fonctionne avec les passerelles de sécurité</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threat Prevention API 1.0</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sandboxing dans Check Point Cloud</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Identity Awareness</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - utilisation de la lame Identity Awareness sur les passerelles</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API du portail de gestion de la sécurité</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - utilisation du portail de gestion de passerelle SMB ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur les passerelles SMB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API IoT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - interaction avec les contrôleurs IoT</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API CloudGuard Connect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - utilisation de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudGuard Connect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (solution de sécurité SD-WAN)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Dome9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - travailler avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dome9</font></font></a> </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le SDK Python ne prend actuellement en charge que l'interaction avec l'API de gestion et l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Gaia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous couvrirons les classes, méthodes et variables les plus importantes de ce module.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/vt/1x/7vvt1xvikrzesgwntw5mrx8tqlu.jpeg" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation du module</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s'installe rapidement et facilement à partir du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiel officiel Check Point sur github à l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les instructions d'installation détaillées se trouvent dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">README.md</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ce module est adapté pour fonctionner avec les versions de Python 2.7 et 3.7. </font><font style="vertical-align: inherit;">Dans cet article, des exemples seront donnés en utilisant Python 3.7. </font><font style="vertical-align: inherit;">Cependant, le SDK Python peut être exécuté directement à partir du serveur de gestion Check Point (Smart Management), mais ils ne prennent en charge que Python 2.7, donc la dernière section fournira le code de la version 2.7. </font><font style="vertical-align: inherit;">Immédiatement après l'installation du module, je recommande de regarder les exemples dans les répertoires </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples_python2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples_python3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Début des travaux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que nous puissions travailler avec les composants du module cpapi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au moins deux classes nécessaires </font><font style="vertical-align: inherit;">doivent être importées du module </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">APIClient</font></b><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> responsable de la connexion au serveur API et la classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> responsable de l'interaction avec l'API.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous déterminons les paramètres de connexion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour définir divers paramètres de connexion à l'API, vous devez créer une instance de la classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClientArgs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En principe, ses paramètres sont prédéfinis et vous pouvez les omettre lors de l'exécution du script sur le serveur de gestion.</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais lorsque vous démarrez sur un hôte tiers, vous devez spécifier au moins l'adresse IP ou le nom d'hôte du serveur API (il s'agit également d'un serveur de gestion). </font><font style="vertical-align: inherit;">Dans l'exemple ci-dessous, nous définissons le paramètre de connexion au serveur et lui attribuons l'adresse IP du serveur de gestion sous forme de chaîne.</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs(server=<span class="hljs-string">'192.168.47.241'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons tous les paramètres et leurs valeurs par défaut qui peuvent être utilisés lors de la connexion au serveur API:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arguments de la méthode __init__ de la classe APIClientArgs</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">APIClientArgs</span>:</span>
    <span class="hljs-string">"""
    This class provides arguments for APIClient configuration.
    All the arguments are configured with their default values.
    """</span><font></font>
<font></font>
    <span class="hljs-comment"># port is set to None by default, but it gets replaced with 443 if not specified</span>
    <span class="hljs-comment"># context possible values - web_api (default) or gaia_api</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, port=None, fingerprint=None, sid=None, server=<span class="hljs-string">"127.0.0.1"</span>, http_debug_level=<span class="hljs-number">0</span>,
                 api_calls=None, debug_file=<span class="hljs-string">""</span>, proxy_host=None, proxy_port=<span class="hljs-number">8080</span>,
                 api_version=None, unsafe=False, unsafe_auto_accept=False, context=<span class="hljs-string">"web_api"</span></span>):</span><font></font>
        self.port = port<font></font>
        <span class="hljs-comment"># management server fingerprint</span><font></font>
        self.fingerprint = fingerprint<font></font>
        <span class="hljs-comment"># session-id.</span><font></font>
        self.sid = sid<font></font>
        <span class="hljs-comment"># management server name or IP-address</span><font></font>
        self.server = server<font></font>
        <span class="hljs-comment"># debug level</span><font></font>
        self.http_debug_level = http_debug_level<font></font>
        <span class="hljs-comment"># an array with all the api calls (for debug purposes)</span>
        self.api_calls = api_calls <span class="hljs-keyword">if</span> api_calls <span class="hljs-keyword">else</span> []
        <span class="hljs-comment"># name of debug file. If left empty, debug data will not be saved to disk.</span><font></font>
        self.debug_file = debug_file<font></font>
        <span class="hljs-comment"># HTTP proxy server address (without "http://")</span><font></font>
        self.proxy_host = proxy_host<font></font>
        <span class="hljs-comment"># HTTP proxy port</span><font></font>
        self.proxy_port = proxy_port<font></font>
        <span class="hljs-comment"># Management server's API version</span><font></font>
        self.api_version = api_version<font></font>
        <span class="hljs-comment"># Indicates that the client should not check the server's certificate</span><font></font>
        self.unsafe = unsafe<font></font>
        <span class="hljs-comment"># Indicates that the client should automatically accept and save the server's certificate</span><font></font>
        self.unsafe_auto_accept = unsafe_auto_accept<font></font>
        <span class="hljs-comment"># The context of using the client - defaults to web_api</span>
        self.context = context</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que les arguments qui peuvent être utilisés dans les instances de la classe APIClientArgs sont intuitifs pour les administrateurs Check Point et n'ont pas besoin de commentaires supplémentaires.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez-vous via APIClient et le gestionnaire de contexte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><b><font style="vertical-align: inherit;">plus</font></b><font style="vertical-align: inherit;"> commodément utilisée via le gestionnaire de contexte. </font><font style="vertical-align: inherit;">Tout ce dont vous avez besoin pour passer à une instance de la classe APIClient est les paramètres de connexion qui ont été définis à la dernière étape.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client:
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le gestionnaire de contexte ne fera pas automatiquement un appel de connexion au serveur API, mais il fera un appel de déconnexion à sa sortie. </font><font style="vertical-align: inherit;">Si pour une raison quelconque, une déconnexion n'est pas requise à la fin du travail avec les appels d'API, vous devez commencer le travail sans utiliser le gestionnaire de contexte:</font></font><br>
<br>
<pre><code class="python hljs">client = APIClient(clieng_args)</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vérification de la connexion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La façon la plus simple de vérifier si une connexion passe par les paramètres donnés est d'utiliser la méthode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check_fingerprint</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si la vérification du hachage sha1 pour l'empreinte digitale du certificat API du serveur n'a pas réussi (la méthode a renvoyé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), cela est généralement dû à des problèmes de connexion et nous pouvons arrêter le programme (ou permettre à l'utilisateur de corriger les données de connexion):</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-keyword">if</span> client.check_fingerprint() <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<font></font>
        print(<span class="hljs-string">"Could not get the server's fingerprint - Check connectivity with the server."</span>)<font></font>
        exit(<span class="hljs-number">1</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez qu'à l'avenir, la classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vérifiera avec chaque appel d'API ( </font><b><font style="vertical-align: inherit;">méthodes </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous en parlerons un peu plus loin) le certificat d'empreinte digitale sha1 sur le serveur API. </font><font style="vertical-align: inherit;">Mais si une erreur est détectée lors de la vérification de l'empreinte digitale sha1 du certificat API du serveur (le certificat est inconnu ou a été modifié), la méthode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check_fingerprint</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournira la possibilité d'ajouter / modifier des informations à ce sujet sur la machine locale en mode automatique. </font><font style="vertical-align: inherit;">Cette vérification peut être complètement désactivée (mais cela peut être recommandé uniquement si les scripts sont exécutés sur le serveur API lui-même, lorsqu'il est connecté à 127.0.0.1) à l'aide de l'argument </font><b><font style="vertical-align: inherit;">APIClientArgs</font></b><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsafe_auto_accept</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (voir les détails sur APIClientArgs plus haut dans «Définition des paramètres de connexion»).</font></font><br>
<br>
<pre><code class="python hljs">client_args = APIClientArgs(unsafe_auto_accept=<span class="hljs-literal">True</span>)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez-vous au serveur API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jusqu'à 3 méthodes de connexion sur le serveur API, et chacune d'elles zaponimaet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (l'ID de session), qui est utilisée automatiquement dans chaque appel d'API suivant dans l'en-tête (le nom du titre dans ce paramètre - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le X-CHKP-sid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), donc que vous n'avez pas besoin de poursuivre le traitement de ce paramètre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode de connexion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option utilisant le nom d'utilisateur et le mot de passe (dans l'exemple, le nom d'utilisateur admin et le mot de passe 1q2w3e sont passés comme arguments positionnels):</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login(<span class="hljs-string">'admin'</span>, <span class="hljs-string">'1q2w3e'</span>)  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les paramètres optionnels optionnels sont également disponibles dans la méthode de connexion. Je liste leurs noms et valeurs par défaut: </font></font><br>
<br>
<pre><code class="python hljs">continue_last_session=<span class="hljs-literal">False</span>, domain=<span class="hljs-literal">None</span>, read_only=<span class="hljs-literal">False</span>, payload=<span class="hljs-literal">None</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode Login_with_api_key</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une variante utilisant la clé API (prise en charge depuis la version de gestion R80.40 / API de gestion v1.6, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«3TsbPJ8ZKjaJGvFyoFqHFA ==»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la valeur de la clé API pour l'un des utilisateurs du serveur de gestion avec la méthode d'autorisation de clé API):</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la méthode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login_with_api_key</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les mêmes paramètres facultatifs sont disponibles que dans la méthode de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connexion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode Login_as_root</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'option de connexion à la machine locale avec le serveur API:</font></font><br>
<br>
<pre><code class="python hljs">     login = client.login_as_root()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seuls deux paramètres facultatifs sont disponibles pour cette méthode:</font></font><br>
<br>
<pre><code class="python hljs">domain=<span class="hljs-literal">None</span>, payload=<span class="hljs-literal">None</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, l'API s'appelle</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons deux options pour effectuer des appels API via les </font><b><font style="vertical-align: inherit;">méthodes </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voyons quelle est la différence entre eux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_call</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette méthode est applicable pour tous les appels. </font><font style="vertical-align: inherit;">Nous devons passer la dernière partie pour l'appel API et la charge utile dans le corps de la demande si nécessaire. </font><font style="vertical-align: inherit;">Si la charge utile est vide, vous ne pouvez pas la transférer du tout:</font></font><br>
<br>
<pre><code class="python hljs">api_versions = client.api_call(<span class="hljs-string">'show-api-versions'</span>) </code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sortie de cette demande sous cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">23</span>]: api_versions                                                           <font></font>
Out[<span class="hljs-number">23</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: {
        <span class="hljs-string">"current-version"</span>: <span class="hljs-string">"1.6"</span>,
        <span class="hljs-string">"supported-versions"</span>: [
            <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"1.1"</span>,
            <span class="hljs-string">"1.2"</span>,
            <span class="hljs-string">"1.3"</span>,
            <span class="hljs-string">"1.4"</span>,
            <span class="hljs-string">"1.5"</span>,
            <span class="hljs-string">"1.6"</span><font></font>
        ]<font></font>
    },<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"current-version"</span>: <span class="hljs-string">"1.6"</span>,
            <span class="hljs-string">"supported-versions"</span>: [
                <span class="hljs-string">"1"</span>,
                <span class="hljs-string">"1.1"</span>,
                <span class="hljs-string">"1.2"</span>,
                <span class="hljs-string">"1.3"</span>,
                <span class="hljs-string">"1.4"</span>,
                <span class="hljs-string">"1.5"</span>,
                <span class="hljs-string">"1.6"</span><font></font>
            ]<font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<pre><code class="python hljs">show_host = client.api_call(<span class="hljs-string">'show-host'</span>, {<span class="hljs-string">'name'</span> : <span class="hljs-string">'h_8.8.8.8'</span>})</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sortie de cette demande sous cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">25</span>]: show_host                                                              <font></font>
Out[<span class="hljs-number">25</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: {
        <span class="hljs-string">"color"</span>: <span class="hljs-string">"black"</span>,
        <span class="hljs-string">"comments"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-string">"domain"</span>: {
            <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
        },<font></font>
        <span class="hljs-string">"groups"</span>: [],
        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"Objects/host"</span>,
        <span class="hljs-string">"interfaces"</span>: [],
        <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
        <span class="hljs-string">"meta-info"</span>: {
            <span class="hljs-string">"creation-time"</span>: {
                <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
            },<font></font>
            <span class="hljs-string">"creator"</span>: <span class="hljs-string">"admin"</span>,
            <span class="hljs-string">"last-modifier"</span>: <span class="hljs-string">"admin"</span>,
            <span class="hljs-string">"last-modify-time"</span>: {
                <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
            },<font></font>
            <span class="hljs-string">"lock"</span>: <span class="hljs-string">"unlocked"</span>,
            <span class="hljs-string">"validation-state"</span>: <span class="hljs-string">"ok"</span><font></font>
        },<font></font>
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
        <span class="hljs-string">"nat-settings"</span>: {
            <span class="hljs-string">"auto-rule"</span>: false<font></font>
        },<font></font>
        <span class="hljs-string">"read-only"</span>: false,
        <span class="hljs-string">"tags"</span>: [],
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
    },<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"color"</span>: <span class="hljs-string">"black"</span>,
            <span class="hljs-string">"comments"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"groups"</span>: [],
            <span class="hljs-string">"icon"</span>: <span class="hljs-string">"Objects/host"</span>,
            <span class="hljs-string">"interfaces"</span>: [],
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
            <span class="hljs-string">"meta-info"</span>: {
                <span class="hljs-string">"creation-time"</span>: {
                    <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                    <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
                },<font></font>
                <span class="hljs-string">"creator"</span>: <span class="hljs-string">"admin"</span>,
                <span class="hljs-string">"last-modifier"</span>: <span class="hljs-string">"admin"</span>,
                <span class="hljs-string">"last-modify-time"</span>: {
                    <span class="hljs-string">"iso-8601"</span>: <span class="hljs-string">"2020-05-01T21:49+0300"</span>,
                    <span class="hljs-string">"posix"</span>: <span class="hljs-number">1588358973517</span><font></font>
                },<font></font>
                <span class="hljs-string">"lock"</span>: <span class="hljs-string">"unlocked"</span>,
                <span class="hljs-string">"validation-state"</span>: <span class="hljs-string">"ok"</span><font></font>
            },<font></font>
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
            <span class="hljs-string">"nat-settings"</span>: {
                <span class="hljs-string">"auto-rule"</span>: false<font></font>
            },<font></font>
            <span class="hljs-string">"read-only"</span>: false,
            <span class="hljs-string">"tags"</span>: [],
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faites immédiatement une réservation que cette méthode n'est applicable qu'aux appels dont la sortie implique un décalage (décalage). Cette conclusion se produit lorsqu'elle contient ou peut contenir une grande quantité d'informations. Par exemple, il peut s'agir d'une demande de liste de tous les objets créés du type d'hôte sur le serveur de gestion. Pour de telles demandes, l'API renvoie une liste de 50 objets par défaut (vous pouvez augmenter la limite à 500 objets dans la réponse). Et pour ne pas extraire les informations plusieurs fois, en changeant le paramètre de décalage dans la demande d'API, il existe une méthode api_query qui fait cela automatiquement. Exemples d'appels où cette méthode est nécessaire: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show-sessions, show-hosts, show-networks, show-wildcards, show-groups, show-address-ranges, show-simple-gateways, show-simple-clusters, show-access- rôles, show-trust-clients, show-packages</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En fait, au nom de ces appels API, nous voyons plusieurs mots, donc ces appels seront plus faciles à gérer via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api_query</font></font></b><br>
<br>
<pre><code class="python hljs">show_hosts = client.api_query(<span class="hljs-string">'show-hosts'</span>) </code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sortie de cette demande sous cat:</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">In [<span class="hljs-number">21</span>]: show_hosts                                                             <font></font>
Out[<span class="hljs-number">21</span>]: <font></font>
APIResponse({<font></font>
    <span class="hljs-string">"data"</span>: [<font></font>
        {<font></font>
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"192.168.47.1"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_192.168.47.1"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"5d7d7086-d70b-4995-971a-0583b15a2bfc"</span><font></font>
        },<font></font>
        {<font></font>
            <span class="hljs-string">"domain"</span>: {
                <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
            },<font></font>
            <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
            <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
        }<font></font>
    ],<font></font>
    <span class="hljs-string">"res_obj"</span>: {
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"from"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"objects"</span>: [<font></font>
                {<font></font>
                    <span class="hljs-string">"domain"</span>: {
                        <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
                    },<font></font>
                    <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"192.168.47.1"</span>,
                    <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_192.168.47.1"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
                    <span class="hljs-string">"uid"</span>: <span class="hljs-string">"5d7d7086-d70b-4995-971a-0583b15a2bfc"</span><font></font>
                },<font></font>
                {<font></font>
                    <span class="hljs-string">"domain"</span>: {
                        <span class="hljs-string">"domain-type"</span>: <span class="hljs-string">"domain"</span>,
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"SMC User"</span>,
                        <span class="hljs-string">"uid"</span>: <span class="hljs-string">"41e821a0-3720-11e3-aa6e-0800200c9fde"</span><font></font>
                    },<font></font>
                    <span class="hljs-string">"ipv4-address"</span>: <span class="hljs-string">"8.8.8.8"</span>,
                    <span class="hljs-string">"name"</span>: <span class="hljs-string">"h_8.8.8.8"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"host"</span>,
                    <span class="hljs-string">"uid"</span>: <span class="hljs-string">"c210af07-1939-49d3-a351-953a9c471d9e"</span><font></font>
                }<font></font>
            ],<font></font>
            <span class="hljs-string">"to"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"total"</span>: <span class="hljs-number">2</span><font></font>
        },<font></font>
        <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span><font></font>
    },<font></font>
    <span class="hljs-string">"status_code"</span>: <span class="hljs-number">200</span>,
    <span class="hljs-string">"success"</span>: true<font></font>
})<font></font>
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traitement des résultats des appels d'API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, vous pouvez utiliser les variables et méthodes de la classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIResponse</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (à la fois à l'intérieur du gestionnaire de contexte et à l'extérieur). </font><font style="vertical-align: inherit;">La classe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIResponse a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 méthodes et 5 variables prédéfinies; nous nous attarderons sur les plus importantes plus en détail.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/1q/av/yb1qavksjibe6qizmrjxsaprdp4.jpeg" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Succès</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, il serait bon de s'assurer que l'appel API a réussi et renvoyé le résultat. </font><font style="vertical-align: inherit;">Il existe une méthode de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réussite</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour cela </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">49</span>]: api_versions.success                                                   <font></font>
Out[<span class="hljs-number">49</span>]: <span class="hljs-literal">True</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Renvoie True si l'appel d'API a réussi (le code de réponse est 200) et False s'il n'a pas réussi (tout autre code de réponse). </font><font style="vertical-align: inherit;">Il est pratique d'utiliser immédiatement après l'appel de l'API, de sorte qu'en fonction du code de réponse, vous pouvez afficher différentes informations.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> api_ver.success: <font></font>
    print(api_versions.data) <font></font>
<span class="hljs-keyword">else</span>: <font></font>
    print(api_versions.err_message) </code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code d'état</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Renvoie le code de réponse après avoir effectué un appel API.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">62</span>]: api_versions.status_code                                               <font></font>
Out[<span class="hljs-number">62</span>]: <span class="hljs-number">400</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codes de réponse possibles: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200,400,401,403,404,409,500,501</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set_success_status</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut être nécessaire de modifier la valeur du statut de réussite. </font><font style="vertical-align: inherit;">Techniquement, vous pouvez y mettre n'importe quoi, même une chaîne ordinaire. </font><font style="vertical-align: inherit;">Mais un véritable exemple serait de réinitialiser ce paramètre à False dans certaines conditions concomitantes. </font><font style="vertical-align: inherit;">Ci-dessous, faites attention à un exemple lorsqu'il y a des tâches effectuées sur le serveur de gestion, mais nous considérerons que cette demande a échoué (définissez la variable de succès sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , malgré le fait que l'appel d'API a réussi et renvoyé le code 200).</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> task_result.data[<span class="hljs-string">"tasks"</span>]:
    <span class="hljs-keyword">if</span> task[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"failed"</span> <span class="hljs-keyword">or</span> task[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"partially succeeded"</span>:<font></font>
        task_result.set_success_status(<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">break</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réponse ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La méthode de réponse vous permet de visualiser le dictionnaire avec le code de réponse (code_état) et avec le corps de réponse (corps).</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">94</span>]: api_versions.response()                                                <font></font>
Out[<span class="hljs-number">94</span>]: <font></font>
{<span class="hljs-string">'status_code'</span>: <span class="hljs-number">200</span>,
 <span class="hljs-string">'data'</span>: {<span class="hljs-string">'current-version'</span>: <span class="hljs-string">'1.6'</span>,
  <span class="hljs-string">'supported-versions'</span>: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'1.1'</span>, <span class="hljs-string">'1.2'</span>, <span class="hljs-string">'1.3'</span>, <span class="hljs-string">'1.4'</span>, <span class="hljs-string">'1.5'</span>, <span class="hljs-string">'1.6'</span>]}}
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les données</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous permet de voir uniquement le corps de la réponse (corps) sans informations inutiles.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">93</span>]: api_versions.data                                                      <font></font>
Out[<span class="hljs-number">93</span>]: <font></font>
{<span class="hljs-string">'current-version'</span>: <span class="hljs-string">'1.6'</span>,
 <span class="hljs-string">'supported-versions'</span>: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'1.1'</span>, <span class="hljs-string">'1.2'</span>, <span class="hljs-string">'1.3'</span>, <span class="hljs-string">'1.4'</span>, <span class="hljs-string">'1.5'</span>, <span class="hljs-string">'1.6'</span>]}
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Message d'erreur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces informations sont disponibles uniquement lorsqu'une erreur s'est produite lors du traitement de l'API de demande (le code de réponse n'est </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 200). </font><font style="vertical-align: inherit;">Exemple de sortie</font></font><br>
<pre><code class="python hljs">In [<span class="hljs-number">107</span>]: api_versions.error_message                                            <font></font>
Out[<span class="hljs-number">107</span>]: <span class="hljs-string">'code: generic_err_invalid_parameter_name\nmessage: Unrecognized parameter [1]\n'</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples utiles</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les exemples suivants utilisent des appels d'API ajoutés à Management API 1.6. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, envisagez le fonctionnement des appels </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-host</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-address-range</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Supposons que nous devons créer toutes les adresses IP du sous-réseau 192.168.0.0/24 en tant qu'objets du type d'hôte, dont le dernier octet est 5, et écrire toutes les autres adresses IP en tant qu'objets de plage d'adresses. Dans ce cas, l'adresse de sous-réseau et l'adresse de diffusion doivent être exclues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, ci-dessous est un script qui résout ce problème et crée 50 objets du type hôte et 51 objets de la plage d'adresses de type. Pour résoudre le problème, 101 appels API sont requis (sans compter l'appel de publication final). De plus, en utilisant le module timeit, nous calculons le temps nécessaire pour exécuter le script jusqu'à ce que les modifications soient publiées.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script utilisant add-host et add-address-range</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> timeit
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
start = timeit.default_timer()<font></font>
<font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span><font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)
     <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
         add_host = client.api_call(<span class="hljs-string">"add-host"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">f"h_192.168.0.<span class="hljs-subst">{ip}</span>"</span>, <span class="hljs-string">"ip-address"</span>: <span class="hljs-string">f'192.168.0.<span class="hljs-subst">{ip}</span>'</span>})
     <span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
         add_range = client.api_call(<span class="hljs-string">"add-address-range"</span>, {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"ip-address-first"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{first_ip}</span>"</span>, <span class="hljs-string">"ip-address-last"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{last_ip}</span>"</span>})<font></font>
         first_ip+=<span class="hljs-number">5</span>
         last_ip+=<span class="hljs-number">5</span><font></font>
     stop = timeit.default_timer() <font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
     <font></font>
print(<span class="hljs-string">f'Time to execute batch request: <span class="hljs-subst">{stop - start}</span> seconds'</span>)<font></font>
<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon environnement de laboratoire, il faut 30 à 50 secondes pour exécuter ce script, en fonction de la charge sur le serveur de gestion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant comment résoudre le même problème à l'aide de l'API d'appel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont la prise en charge a été ajoutée à l'API version 1.6. </font><font style="vertical-align: inherit;">Cet appel vous permet de créer plusieurs objets à la fois en une seule demande d'API. </font><font style="vertical-align: inherit;">De plus, il peut s'agir d'objets de différents types (par exemple, hôtes, sous-réseaux et plages d'adresses). </font><font style="vertical-align: inherit;">Ainsi, notre tâche peut être résolue dans le cadre d'un seul appel API.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script utilisant add-objects-batch</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> timeit
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
start = timeit.default_timer()<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip = []<font></font>
objects_list_range = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"ip-address"</span>: <span class="hljs-string">f'192.168.0.<span class="hljs-subst">{ip}</span>'</span>}<font></font>
    objects_list_ip.append(data)<font></font>
    <font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"ip-address-first"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{first_ip}</span>"</span>, <span class="hljs-string">"ip-address-last"</span>: <span class="hljs-string">f"192.168.0.<span class="hljs-subst">{last_ip}</span>"</span>}<font></font>
    objects_list_range.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range<font></font>
  }]<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     add_objects_batch = client.api_call(<span class="hljs-string">"add-objects-batch"</span>, data_for_batch)<font></font>
     stop = timeit.default_timer() <font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
     <font></font>
print(<span class="hljs-string">f'Time to execute batch request: <span class="hljs-subst">{stop - start}</span> seconds'</span>)
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et cela prend 3 à 7 secondes pour exécuter ce script dans mon environnement de laboratoire, en fonction de la charge sur le serveur de gestion. </font><font style="vertical-align: inherit;">C'est-à-dire qu'en moyenne sur un objet API 101, un appel de type batch est 10 fois plus rapide. </font><font style="vertical-align: inherit;">Sur plus d'objets, la différence sera encore plus impressionnante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant comment travailler avec </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En utilisant cet appel d'API, nous pouvons modifier massivement n'importe quel paramètre. </font><font style="vertical-align: inherit;">Définissons la première moitié des adresses de l'exemple précédent (jusqu'à 0,124 hôtes et plages également) la couleur terre de Sienne, et la seconde moitié des adresses nous assignerons la couleur kaki.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changer la couleur des objets créés dans l'exemple précédent</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip_first = []<font></font>
objects_list_range_first = []<font></font>
objects_list_ip_second = []<font></font>
objects_list_range_second = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">125</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"sienna"</span>}<font></font>
    objects_list_ip_first.append(data)<font></font>
    <font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">125</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"khaki"</span>}<font></font>
    objects_list_ip_second.append(data)<font></font>
    <font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">125</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"sienna"</span>}<font></font>
    objects_list_range_first.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
    <font></font>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"khaki"</span>}<font></font>
    objects_list_range_second.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch_first  = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip_first<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range_first<font></font>
  }]<font></font>
}<font></font>
<font></font>
data_for_batch_second  = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip_second<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range_second<font></font>
  }]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>) <font></font>
     set_objects_batch_first = client.api_call(<span class="hljs-string">"set-objects-batch"</span>, data_for_batch_first)<font></font>
     set_objects_batch_second = client.api_call(<span class="hljs-string">"set-objects-batch"</span>, data_for_batch_second)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez supprimer de nombreux objets en un seul appel d'API à l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voyons maintenant un exemple de code qui supprime tous les hôtes créés précédemment via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-objects-batch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppression d'objets à l'aide de delete-objects-batch</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
objects_list_ip = []<font></font>
objects_list_range = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>,<span class="hljs-number">255</span>,<span class="hljs-number">5</span>):<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f'h_192.168.0.<span class="hljs-subst">{ip}</span>'</span>}<font></font>
    objects_list_ip.append(data)<font></font>
<font></font>
first_ip = <span class="hljs-number">1</span>
last_ip = <span class="hljs-number">4</span>
<span class="hljs-keyword">while</span> last_ip &lt; <span class="hljs-number">255</span>:<font></font>
    data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">f"r_192.168.0.<span class="hljs-subst">{first_ip}</span>-<span class="hljs-subst">{last_ip}</span>"</span>}<font></font>
    objects_list_range.append(data)<font></font>
    first_ip+=<span class="hljs-number">5</span>
    last_ip+=<span class="hljs-number">5</span><font></font>
<font></font>
data_for_batch = {<font></font>
  <span class="hljs-string">"objects"</span> : [ {
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"host"</span>,
    <span class="hljs-string">"list"</span> : objects_list_ip<font></font>
}, {<font></font>
    <span class="hljs-string">"type"</span> : <span class="hljs-string">"address-range"</span>,
    <span class="hljs-string">"list"</span> : objects_list_range<font></font>
  }]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     delete_objects_batch = client.api_call(<span class="hljs-string">"delete-objects-batch"</span>, data_for_batch)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)<font></font>
<font></font>
print(delete_objects_batch.data)<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les fonctionnalités qui apparaissent dans les nouvelles versions du logiciel Check Point reçoivent immédiatement des appels d'API. </font><font style="vertical-align: inherit;">Ainsi, dans R80.40 est apparu des "fonctionnalités" telles que Revert to revision et Smart Task, et pour eux, a immédiatement préparé les appels API appropriés. </font><font style="vertical-align: inherit;">De plus, toutes les fonctionnalités lors du passage des consoles héritées au mode Stratégie unifiée acquièrent également la prise en charge de l'API. </font><font style="vertical-align: inherit;">Par exemple, la mise à jour tant attendue de la version du logiciel R80.40 était le transfert de la politique d'inspection HTTPS du mode hérité au mode politique unifiée, et cette fonctionnalité a immédiatement reçu des appels d'API. </font><font style="vertical-align: inherit;">Voici un exemple de code qui ajoute à la première position de la politique d'inspection HTTPS une règle qui exclut des 3 catégories d'inspection (santé, finances, services publics) qui sont interdites d'être inspectées conformément à la loi dans un certain nombre de pays.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter une règle à la stratégie d'inspection HTTPS</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
client_args = APIClientArgs(server=<span class="hljs-string">"192.168.47.240"</span>)<font></font>
<font></font>
data = {<font></font>
  <span class="hljs-string">"layer"</span> : <span class="hljs-string">"Default Layer"</span>,
  <span class="hljs-string">"position"</span> : <span class="hljs-string">"top"</span>,
  <span class="hljs-string">"name"</span> : <span class="hljs-string">"Legal Requirements"</span>,
  <span class="hljs-string">"action"</span>: <span class="hljs-string">"bypass"</span>,
  <span class="hljs-string">"site-category"</span>: [<span class="hljs-string">"Health"</span>, <span class="hljs-string">"Government / Military"</span>, <span class="hljs-string">"Financial Services"</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">with</span> APIClient(client_args) <span class="hljs-keyword">as</span> client: <font></font>
     login = client.login_with_api_key(<span class="hljs-string">'3TsbPJ8ZKjaJGvFyoFqHFA=='</span>)<font></font>
     add_https_rule = client.api_call(<span class="hljs-string">"add-https-rule"</span>, data)<font></font>
     publish = client.api_call(<span class="hljs-string">"publish"</span>)
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécution de scripts Python sur un serveur de gestion Check Point</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout dans le même </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier README.md</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient des informations sur la façon d'exécuter des scripts Python directement à partir du serveur de gestion. </font><font style="vertical-align: inherit;">Cela peut être pratique lorsque vous ne pouvez pas vous connecter au serveur API à partir d'une autre machine. </font><font style="vertical-align: inherit;">J'ai enregistré une vidéo de six minutes dans laquelle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j'envisage d'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> installer le module </font><b><font style="vertical-align: inherit;">cpapi</font></b><font style="vertical-align: inherit;"> et les fonctionnalités de l'exécution de scripts Python sur le serveur de gestion. </font><font style="vertical-align: inherit;">Par exemple, un script est exécuté qui automatise la configuration d'une nouvelle passerelle pour une tâche telle que l'audit du réseau </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security CheckUp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Parmi les fonctionnalités auxquelles j'ai dû faire face: en Python 2.7, la fonction d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entrée</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est pas encore apparue </font><font style="vertical-align: inherit;">, donc la fonction </font><b><font style="vertical-align: inherit;">raw_input</font></b><font style="vertical-align: inherit;"> est utilisée pour traiter les informations que l'utilisateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sinon, le code est le même que pour démarrer à partir d'autres machines, mais il est plus pratique d'utiliser la fonction </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login_as_root</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour ne pas spécifier à nouveau votre nom d'utilisateur, mot de passe et adresse IP du serveur de gestion.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8B6pgCLT8Pg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script pour une configuration rapide Security CheckUp</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">import</span> getpass
<span class="hljs-keyword">import</span> sys, os<font></font>
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="hljs-string">'..'</span>)))
<span class="hljs-keyword">from</span> cpapi <span class="hljs-keyword">import</span> APIClient, APIClientArgs<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-keyword">with</span> APIClient() <span class="hljs-keyword">as</span> client:
       <span class="hljs-comment"># if client.check_fingerprint() is False:</span>
       <span class="hljs-comment">#     print("Could not get the server's fingerprint - Check connectivity with the server.")</span>
       <span class="hljs-comment">#     exit(1)</span><font></font>
        login_res = client.login_as_root()<font></font>
<font></font>
        <span class="hljs-keyword">if</span> login_res.success <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<font></font>
            print(<span class="hljs-string">"Login failed:\n{}"</span>.format(login_res.error_message))<font></font>
            exit(<span class="hljs-number">1</span>)<font></font>
<font></font>
        gw_name = raw_input(<span class="hljs-string">"Enter the gateway name:"</span>)<font></font>
        gw_ip = raw_input(<span class="hljs-string">"Enter the gateway IP address:"</span>)
        <span class="hljs-keyword">if</span> sys.stdin.isatty():<font></font>
            sic = getpass.getpass(<span class="hljs-string">"Enter one-time password for the gateway(SIC): "</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Attention! Your password will be shown on the screen!"</span>)<font></font>
            sic = raw_input(<span class="hljs-string">"Enter one-time password for the gateway(SIC): "</span>)<font></font>
        version = raw_input(<span class="hljs-string">"Enter the gateway version(like RXX.YY):"</span>)<font></font>
        add_gw = client.api_call(<span class="hljs-string">"add-simple-gateway"</span>, {<span class="hljs-string">'name'</span> : gw_name, <span class="hljs-string">'ipv4-address'</span> : gw_ip, <span class="hljs-string">'one-time-password'</span> : sic, <span class="hljs-string">'version'</span>: version.capitalize(), <span class="hljs-string">'application-control'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'url-filtering'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'ips'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'anti-bot'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'anti-virus'</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">'threat-emulation'</span> : <span class="hljs-string">'true'</span>})
        <span class="hljs-keyword">if</span> add_gw.success <span class="hljs-keyword">and</span> add_gw.data[<span class="hljs-string">'sic-state'</span>] != <span class="hljs-string">"communicating"</span>:<font></font>
            print(<span class="hljs-string">"Secure connection with the gateway hasn't established!"</span>)<font></font>
            exit(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">elif</span> add_gw.success:<font></font>
            print(<span class="hljs-string">"The gateway was added successfully."</span>)<font></font>
            gw_uid = add_gw.data[<span class="hljs-string">'uid'</span>]<font></font>
            gw_name = add_gw.data[<span class="hljs-string">'name'</span>]
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to add the gateway - {}"</span>.format(add_gw.error_message))<font></font>
            exit(<span class="hljs-number">1</span>)<font></font>
<font></font>
        change_policy = client.api_call(<span class="hljs-string">"set-access-layer"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">"Network"</span>, <span class="hljs-string">"applications-and-url-filtering"</span>: <span class="hljs-string">"true"</span>, <span class="hljs-string">"content-awareness"</span>: <span class="hljs-string">"true"</span>})
        <span class="hljs-keyword">if</span> change_policy.success:<font></font>
            print(<span class="hljs-string">"The policy has been changed successfully"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to change the policy- {}"</span>.format(change_policy.error_message))<font></font>
        change_rule = client.api_call(<span class="hljs-string">"set-access-rule"</span>, {<span class="hljs-string">"name"</span> : <span class="hljs-string">"Cleanup rule"</span>, <span class="hljs-string">"layer"</span> : <span class="hljs-string">"Network"</span>, <span class="hljs-string">"action"</span>: <span class="hljs-string">"Accept"</span>, <span class="hljs-string">"track"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"Detailed Log"</span>, <span class="hljs-string">"accounting"</span>: <span class="hljs-string">"true"</span>}})
        <span class="hljs-keyword">if</span> change_rule.success:<font></font>
            print(<span class="hljs-string">"The cleanup rule has been changed successfully"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to change the cleanup rule- {}"</span>.format(change_rule.error_message))<font></font>
<font></font>
        <span class="hljs-comment"># publish the result</span>
        publish_res = client.api_call(<span class="hljs-string">"publish"</span>, {})
        <span class="hljs-keyword">if</span> publish_res.success:<font></font>
            print(<span class="hljs-string">"The changes were published successfully."</span>)
        <span class="hljs-keyword">else</span>:<font></font>
                print(<span class="hljs-string">"Failed to publish the changes - {}"</span>.format(install_tp_policy.error_message))<font></font>
<font></font>
        install_access_policy = client.api_call(<span class="hljs-string">"install-policy"</span>, {<span class="hljs-string">"policy-package"</span> : <span class="hljs-string">"Standard"</span>, <span class="hljs-string">"access"</span> : <span class="hljs-string">'true'</span>,  <span class="hljs-string">"threat-prevention"</span> : <span class="hljs-string">'false'</span>, <span class="hljs-string">"targets"</span> : gw_uid})
        <span class="hljs-keyword">if</span> install_access_policy.success:<font></font>
            print(<span class="hljs-string">"The access policy has been installed"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
                print(<span class="hljs-string">"Failed to install access policy - {}"</span>.format(install_tp_policy.error_message))<font></font>
<font></font>
        install_tp_policy = client.api_call(<span class="hljs-string">"install-policy"</span>, {<span class="hljs-string">"policy-package"</span> : <span class="hljs-string">"Standard"</span>, <span class="hljs-string">"access"</span> : <span class="hljs-string">'false'</span>,  <span class="hljs-string">"threat-prevention"</span> : <span class="hljs-string">'true'</span>, <span class="hljs-string">"targets"</span> : gw_uid})
        <span class="hljs-keyword">if</span> install_tp_policy.success:<font></font>
            print(<span class="hljs-string">"The threat prevention policy has been installed"</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Failed to install threat prevention policy - {}"</span>.format(install_tp_policy.error_message))<font></font>
        <font></font>
        <span class="hljs-comment"># add passwords and passphrases to dictionary</span>
        <span class="hljs-keyword">with</span> open(<span class="hljs-string">'additional_pass.conf'</span>) <span class="hljs-keyword">as</span> f:<font></font>
            line_num = <span class="hljs-number">0</span>
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<font></font>
                line_num += <span class="hljs-number">1</span>
                add_password_dictionary = client.api_call(<span class="hljs-string">"run-script"</span>, {<span class="hljs-string">"script-name"</span> : <span class="hljs-string">"Add passwords and passphrases"</span>, <span class="hljs-string">"script"</span> : <span class="hljs-string">"printf \"{}\" &gt;&gt; $FWDIR/conf/additional_pass.conf"</span>.format(line), <span class="hljs-string">"targets"</span> : gw_name})
                <span class="hljs-keyword">if</span> add_password_dictionary.success:<font></font>
                    print(<span class="hljs-string">"The password dictionary line {} was added successfully"</span>.format(line_num))
                <span class="hljs-keyword">else</span>:<font></font>
                    print(<span class="hljs-string">"Failed to add the dictionary - {}"</span>.format(add_password_dictionary.error_message))<font></font>
<font></font>
main()</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de fichier de dictionnaire de mots de passe additional_pass.conf</font></font></b>
                        <div class="spoiler_text"><code>{<br>
"passwords" : ["malware","malicious","infected","Infected"],<br>
"phrases" : ["password","Password","Pass","pass","codigo","key","pwd","","","","","",""]<br>
}</code><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article ne considère que les fonctionnalités de base du </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDK Python</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et du module </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpapi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (comme vous l'avez peut-être deviné, ce sont en fait des synonymes), et en étudiant le code de ce module, vous découvrirez encore plus de possibilités de travailler avec lui. </font><font style="vertical-align: inherit;">Il est possible que vous souhaitiez le compléter avec vos classes, fonctions, méthodes et variables. </font><font style="vertical-align: inherit;">Vous pouvez toujours partager leur expérience et afficher d'autres scripts pour la section Check Point </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Community </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CheckMates</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui combine et les développeurs de produits et les utilisateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Profitez du codage et merci d'avoir lu jusqu'au bout!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr505496/index.html">Flutter Dev Podcast avec CTO Meduza Boris Goryachev: l'essentiel de l'application Meduz et du développement des médias</a></li>
<li><a href="../fr505498/index.html">Comment nous résolvons le problème de la mémoire de pile non initialisée dans Windows</a></li>
<li><a href="../fr505502/index.html">Omnicanal dans le service client: que rechercher et comment tout faire correctement?</a></li>
<li><a href="../fr505506/index.html">Il ne mord pas: comment rendre les robots industriels sûrs pour les travailleurs</a></li>
<li><a href="../fr505508/index.html">Non seulement la technologie sans pilote: l'avenir de l'industrie automobile</a></li>
<li><a href="../fr505516/index.html">Apprentissage automatique: par où commencer ou comment construire le premier modèle</a></li>
<li><a href="../fr505522/index.html">Monétisation dans les jeux en ligne: comment utiliser l'expérience de quelqu'un d'autre pour vos propres besoins</a></li>
<li><a href="../fr505528/index.html">La chose la plus importante dans le Wi-Fi 6. Non, sérieusement</a></li>
<li><a href="../fr505530/index.html">Google fabrique son processeur et AMD s'apprête à détruire Qualcomm</a></li>
<li><a href="../fr505532/index.html">Chaînes de télégramme sur le développement de jeux: partie 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>