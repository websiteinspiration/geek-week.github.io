<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëéüèΩ üï≥Ô∏è ‚ô•Ô∏è We reveal ProLock: analysis of the actions of the new ransomware operators using the MITER ATT & CK matrix ‚úñÔ∏è üìá üçä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The success of ransomware attacks on organizations around the world is prompting more and more new attackers to "enter the game." One of these new pla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>We reveal ProLock: analysis of the actions of the new ransomware operators using the MITER ATT & CK matrix</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/502770/"><img src="https://habrastorage.org/webt/2v/x3/wu/2vx3wup9kekic0ksa8kl1rwfvlw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The success of ransomware attacks on organizations around the world is prompting more and more new attackers to "enter the game." One of these new players is the ProLock ransomware group. It appeared in March 2020 as a successor to the PwndLocker program, which began operating in late 2019. ProLock ransomware attacks are primarily aimed at financial and medical organizations, government agencies and the retail sector. Recently, ProLock operators successfully attacked one of the largest ATM manufacturers, Diebold Nixdorf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this post, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oleg Skulkin, Leading Specialist, Laboratory of Computer Forensics Group-IB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, talks about the basic tactics, techniques, and procedures (TTPs) used by ProLock operators. </font><font style="vertical-align: inherit;">At the end of the article is a comparison with the matrix MITER ATT &amp; CK, a public database that contains tactics of targeted attacks used by various cybercriminal groups.</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Getting initial access</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProLock operators use two main vectors of primary compromise: the QakBot Trojan (Qbot) and unprotected RDP servers with weak passwords. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compromise through an externally accessible RDP server is extremely popular with ransomware operators. Typically, attackers buy access to a compromised server from third parties, but it can also be obtained by members of the group on their own. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A more interesting primary compromise vector is QakBot malware. Previously, this trojan was associated with another family of encryptors - MegaCortex. However, it is now used by ProLock operators.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typically, QakBot is distributed through phishing campaigns. </font><font style="vertical-align: inherit;">A phishing email may contain an attached Microsoft Office document or a link to such a file located in the cloud storage - for example, Microsoft OneDrive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are also cases of loading QakBot with another trojan - Emotet, which is widely known for participating in campaigns that distributed the Ryuk ransomware.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After downloading and opening the infected document, the user is prompted to allow the execution of macros. </font><font style="vertical-align: inherit;">If successful, PowerShell is launched to load and run the QakBot payload from the command server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is important to note that the same applies to ProLock: the payload is extracted from a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BMP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">and loaded into memory using PowerShell. </font><font style="vertical-align: inherit;">In some cases, a scheduled task is used to start PowerShell. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batch script that launches ProLock through the task scheduler:</font></font><br>
</b></i><br>
<pre><code class="plaintext hljs">schtasks.exe /CREATE /XML C:\Programdata\WinMgr.xml /tn WinMgr<font></font>
schtasks.exe /RUN /tn WinMgr<font></font>
del C:\Programdata\WinMgr.xml<font></font>
del C:\Programdata\run.bat</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System pin</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If it was possible to compromise the RDP server and gain access, then existing accounts are used to secure the network. </font><font style="vertical-align: inherit;">QakBot is characterized by a variety of pinning mechanisms. </font><font style="vertical-align: inherit;">Most often, this trojan uses the Run registry key and creates tasks in the scheduler:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/a7/98/fxa7987wbtmmynowms_9eo6xiye.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Securing Qakbot to the system using the Run registry key</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In some cases, startup folders are also used: a shortcut is placed there that points to the bootloader.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection bypass</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Through communication with the command server, QakBot periodically tries to update itself, therefore, to avoid detection, the malware can replace its current version with a new one. </font><font style="vertical-align: inherit;">Executable files are signed with a compromised or fake signature. </font><font style="vertical-align: inherit;">The initial payload loaded by PowerShell is stored on a command server with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PNG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> extension </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In addition, after execution, it is replaced by the legitimate </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calc.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, to hide malicious activity, QakBot uses the technique of embedding code in processes using </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for this </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As already mentioned, the ProLock payload is hidden inside a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BMP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font><b><font style="vertical-align: inherit;">JPG</font></b><font style="vertical-align: inherit;"> file</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It can also be considered as a method of circumvention of protection.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retrieve Credentials</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QakBot has the functionality of a keylogger. </font><font style="vertical-align: inherit;">In addition, it can load and run additional scripts, for example, Invoke-Mimikatz - PowerShell-version of the famous utility Mimikatz. </font><font style="vertical-align: inherit;">Such scripts can be used by cybercriminals to dump credentials.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Network intelligence</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After gaining access to privileged accounts, ProLock operators conduct network intelligence, which in particular may include port scanning and analysis of the Active Directory environment. </font><font style="vertical-align: inherit;">In addition to various scripts, attackers use AdFind, another tool popular among groups that use ransomware, to collect information about Active Directory.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web promotion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Traditionally, one of the most popular ways to surf the net is the Remote Desktop Protocol. </font><font style="vertical-align: inherit;">ProLock was no exception. </font><font style="vertical-align: inherit;">Attackers even have scripts in their arsenal to gain remote access via RDP to target hosts. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BAT-script for access via RDP:</font></font><br>
</b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
For remote script execution, ProLock operators use another popular tool - the PsExec utility from the Sysinternals Suite package. </font><font style="vertical-align: inherit;">
ProLock on hosts is launched using WMIC, which is a command-line interface for working with the Windows Management Instrumentation subsystem. </font><font style="vertical-align: inherit;">This tool is also gaining popularity among ransomware operators.</font></font><br>
<code>reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v "fDenyTSConnections" /t REG_DWORD /d 0 /f<br>
netsh advfirewall firewall set rule group="Remote Desktop" new enable=yes<br>
reg add "HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v "UserAuthentication" /t REG_DWORD /d 0 /f</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data collection</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Like many other ransomware operators, a group using ProLock collects data from a compromised network to increase their chances of a ransom. </font><font style="vertical-align: inherit;">Before exfiltration, the collected data is archived using the 7Zip utility.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exfiltration</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To upload data, ProLock operators use Rclone, a command-line tool designed to synchronize files with various cloud storage services, such as OneDrive, Google Drive, Mega, etc. Attackers always rename the executable file to look like legitimate system files. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unlike their ‚Äúcolleagues‚Äù, ProLock operators still do not have their own website for publishing stolen data owned by companies that refused to pay the ransom.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achieving the ultimate goal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After exfiltrating the data, the team deploys ProLock throughout the enterprise network. The binary file is extracted from a file with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PNG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> extension </font><font style="vertical-align: inherit;">using PowerShell and embedded into memory: </font></font><br>
<br>
<img align="left" src="https://habrastorage.org/webt/zg/od/n3/zgodn3lbvcxmijfv0cx5dk-to2g.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, ProLock terminates the processes indicated in the built-in list (it is interesting that it uses only six letters from the process name, for example, ‚Äúwinwor‚Äù), and terminates services, including those related to security, such as CSFalconService (CrowdStrike Falcon), using the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net stop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then, as in the case of many other ransomware families, attackers use </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vssadmin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to remove shadow copies of Windows and limit their size, so new copies will not be created:</font></font><br>
<br>
<pre><code class="plaintext hljs">vssadmin.exe delete shadows /all /quiet<font></font>
vssadmin.exe resize shadowstorage /for=C: /on=C: /maxsize=401MB<font></font>
vssadmin.exe resize shadowstorage /for=C: /on=C: /maxsize=unbounded</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProLock adds the extension </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.proLock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.pr0Lock,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.proL0ck</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to each encrypted file and places the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HOW TO RECOVER FILES] .TXT file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in each folder. </font><font style="vertical-align: inherit;">This file contains instructions on how to decrypt the files, including a link to the site where the victim must enter a unique identifier and receive payment information:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/m3/aq/u4/m3aqu4ojguelkq7264o69gme2cy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each instance of ProLock contains information about the amount of the buyback - in this case, it‚Äôs 35 bitcoins, which is about 312,000 dollars.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many ransomware operators use similar methods to achieve their goals. </font><font style="vertical-align: inherit;">At the same time, some techniques are unique to each group. </font><font style="vertical-align: inherit;">There is an increasing number of cybercriminal groups using encryptors in their campaigns. </font><font style="vertical-align: inherit;">In some cases, the same operators can participate in attacks using different families of ransomware, so we will increasingly observe intersections in the tactics, techniques and procedures used.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapping with MITER ATT &amp; CK Mapping</font></font></b>
                        <div class="spoiler_text"><div class="scrollable-table"><table>
<tbody><tr>
<th width="330" align="left">Tactic</th>
<th align="left">Technique</th>
</tr>
<tr>
<td>Initial Access (TA0001)</td>
<td>External Remote Services (T1133), Spearphishing Attachment (T1193), Spearphishing Link (T1192)</td>
</tr>
<tr>
<td>Execution (TA0002)</td>
<td>Powershell (T1086), Scripting (T1064), User Execution (T1204), Windows Management Instrumentation (T1047)</td>
</tr>
<tr>
<td>Persistence (TA0003)</td>
<td>Registry Run Keys / Startup Folder (T1060), Scheduled Task (T1053), Valid Accounts (T1078)</td>
</tr>
<tr>
<td>Defense Evasion (TA0005)</td>
<td>Code Signing (T1116), Deobfuscate/Decode Files or Information (T1140), Disabling Security Tools (T1089), File Deletion (T1107), Masquerading (T1036), Process Injection (T1055)</td>
</tr>
<tr>
<td>Credential Access (TA0006)</td>
<td>Credential Dumping (T1003), Brute Force (T1110), Input Capture (T1056)</td>
</tr>
<tr>
<td>Discovery (TA0007)</td>
<td>Account Discovery (T1087), Domain Trust Discovery (T1482), File and Directory Discovery (T1083), Network Service Scanning (T1046), Network Share Discovery (T1135), Remote System Discovery (T1018)</td>
</tr>
<tr>
<td>Lateral Movement (TA0008)</td>
<td>Remote Desktop Protocol (T1076), Remote File Copy (T1105), Windows Admin Shares (T1077)</td>
</tr>
<tr>
<td>Collection (TA0009)</td>
<td>Data from Local System (T1005), Data from Network Shared Drive (T1039), Data Staged (T1074)<br>
</td>
</tr>
<tr>
<td>Command and Control (TA0011)</td>
<td>Commonly Used Port (T1043), Web Service (T1102)<br>
</td>
</tr>
<tr>
<td>Exfiltration (TA0010)</td>
<td>Data Compressed (T1002), Transfer Data to Cloud Account (T1537)<br>
</td>
</tr>
<tr>
<td>Impact (TA0040)</td>
<td>Data Encrypted for Impact (T1486), Inhibit System Recovery (T1490)<br>
</td>
</tr>
</tbody></table></div></div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502746/index.html">Productivity and motivation at a distance: Russian IT companies share 2 months of experience in isolation</a></li>
<li><a href="../en502752/index.html">3 traps that beginners Data Scientists fall into</a></li>
<li><a href="../en502760/index.html">What is MagicString and are these lines so magical?</a></li>
<li><a href="../en502762/index.html">Different ways to pass data to Angular components</a></li>
<li><a href="../en502768/index.html">The title of this article was invented by a computer.</a></li>
<li><a href="../en502772/index.html">How to create a PostgreSQL server on Google Cloud Platform SQL</a></li>
<li><a href="../en502782/index.html">Joel Spolsky: Abstraction Level for Developers</a></li>
<li><a href="../en502786/index.html">The heading "Read articles for you." April 2020. Part 1</a></li>
<li><a href="../en502788/index.html">Hackathon in one or life after Dude</a></li>
<li><a href="../en502794/index.html">CopyPaste DIY keyboard or the perfect keyboard in a world where every line of code is already written</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>