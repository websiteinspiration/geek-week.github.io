<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🍳 ↗️ 👩🏿‍⚖️ WebRTC di Android: cara mengaktifkan penyandian perangkat keras pada banyak perangkat 👌🏿 👨🏼‍🎓 💥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk panggilan video di Badoo, kami menggunakan standar WebRTC dan codec H.264. Jika Anda meyakini dokumentasinya, codec ini akan berfungsi tanpa mas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>WebRTC di Android: cara mengaktifkan penyandian perangkat keras pada banyak perangkat</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/500654/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk panggilan video di Badoo, kami menggunakan standar WebRTC dan codec H.264. </font><font style="vertical-align: inherit;">Jika Anda meyakini dokumentasinya, codec ini akan berfungsi tanpa masalah pada perangkat Android apa pun sejak Android 5.0. </font><font style="vertical-align: inherit;">Namun dalam praktiknya, semuanya ternyata tidak begitu. </font><font style="vertical-align: inherit;">Pada artikel ini, saya akan berbicara tentang fitur menerapkan pengkodean perangkat keras untuk codec H.264 di WebRTC dan bagaimana membuatnya bekerja pada lebih banyak perangkat.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tu/lt/w1/tultw1tnly1q-hovglpxdkzaax8.jpeg"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kenapa H.264?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika terhubung melalui WebRTC, semua perangkat yang berpartisipasi dalam sesi mengirimkan berbagai parameter komunikasi, termasuk video dan audio codec. Jika perangkat mendukung banyak codec (misalnya, VP8 dan H.264), codec prioritas untuk platform terdaftar terlebih dahulu. Data ini digunakan selama tahap </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rekonsiliasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di WebRTC, setelah itu hanya codec yang didukung oleh semua perangkat yang tersisa. Contoh data tersebut dengan dekripsi dapat dilihat dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dokumen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ini </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal panggilan video, jika salah satu perangkat tidak mendukung codec H.264, kedua perangkat dapat beralih, misalnya, ke codec VP8, yang tidak bergantung pada implementasi perangkat keras pada perangkat. </font><font style="vertical-align: inherit;">Tetapi aplikasi kami tersedia di berbagai gadget, termasuk smartphone dari generasi sebelumnya. </font><font style="vertical-align: inherit;">Oleh karena itu, untuk komunikasi video, kami ingin menggunakan penyandian perangkat keras kapan pun memungkinkan: itu mengurangi beban prosesor dan tidak memakan baterai terlalu banyak, yang sangat penting untuk gadget yang sudah ketinggalan zaman. </font><font style="vertical-align: inherit;">Dukungan encoding perangkat keras H.264 diimplementasikan pada sejumlah besar perangkat, tidak seperti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VP8 yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sama </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan H.264 di Android</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda yakin deskripsi dukungan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk format multimedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pengodean ulang Profil Dasar H.264 akan berfungsi pada semua perangkat Android, dan pengodean - dimulai dengan Android 3.0. Di Badoo, kami mendukung perangkat yang dimulai dengan Android 5.0, jadi kami seharusnya tidak memiliki masalah. Tapi itu tidak begitu sederhana: bahkan di gadget dengan versi kelima, kami menemukan sejumlah besar fitur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan apa itu bisa terkoneksi? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda ketahui, saat mengembangkan perangkat baru di Android, produsen mana pun harus lulus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suite Tes Kompatibilitas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ini berjalan pada PC yang terhubung ke perangkat, dan hasilnya harus dikirim ke Google untuk mengkonfirmasi bahwa perangkat tersebut memenuhi persyaratan OS Android dari versi yang ditentukan. Baru setelah itu gadget bisa dirilis ke pasaran. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tertarik pada tes multimedia dalam rangkaian tes ini, dan lebih khusus lagi, video encoding dan decoding. Saya memutuskan untuk memikirkan tes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EncodeDecodeTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaCodecTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DecoderTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EncoderTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena semuanya ada di semua versi Android sejak 4.3. Grafik jumlah baris kode dalam tes ini terlihat seperti ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/g_/4p/tdg_4prrdcocytay8z7df_igw0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum versi 4.3, sebagian besar tes ini sama sekali tidak ada, dan peningkatan yang signifikan jatuh pada versi 5 dan 7. Oleh karena itu, kita dapat mengatakan bahwa sebelum versi Android 4.3 Google tidak memeriksa kepatuhan perangkat dengan spesifikasi untuk encoding dan decoding video, tetapi dalam versi 5.0 meningkatkan pemeriksaan ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya ini menunjukkan bahwa mulai dari versi 5.0 dengan pengkodean semuanya harus berurutan. Tapi, mengingat pengalaman saya sebelumnya dengan decoding video streaming di Android, saya yakin itu tidak. Sudah cukup untuk melihat sejumlah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">topik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang pengkodean dalam grup Google </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-webrtc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File sumber WebRTC, yang berada dalam domain publik, membantu kami mencari jebakan. Mari kita pertimbangkan secara lebih detail.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan H.264 di WebRTC</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HardwareVideoEncoderFactory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada metode dengan nama berbicara isHardwareSupportedInCurrentSdkH264:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isHardwareSupportedInCurrentSdkH264</span><span class="hljs-params">(MediaCodecInfo info)</span> </span>{
  <span class="hljs-comment">// First, H264 hardware might perform poorly on this model.</span>
  <span class="hljs-keyword">if</span> (H264_HW_EXCEPTION_MODELS.contains(Build.MODEL)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
  }<font></font>
  String name = info.getName();<font></font>
  <span class="hljs-comment">// QCOM H264 encoder is supported in KITKAT or later.</span>
  <span class="hljs-keyword">return</span> (name.startsWith(QCOM_PREFIX) &amp;&amp; Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT)
      <span class="hljs-comment">// Exynos H264 encoder is supported in LOLLIPOP or later.</span><font></font>
      || (name.startsWith(EXYNOS_PREFIX)<font></font>
             &amp;&amp; Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dapat kita lihat, dukungan untuk pengkodean perangkat keras pada Android hanya diterapkan untuk chipset Qualcomm dan Exynos. Mengapa tidak ada dukungan untuk chipset lain dalam implementasi WebRTC standar? Kemungkinan besar, ini disebabkan oleh kekhasan implementasi produsen perangkat keras codec. Dan seringkali dimungkinkan untuk mengidentifikasi fitur-fitur ini hanya pada produksi, karena tidak selalu mungkin untuk menemukan perangkat tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua deskripsi codec pada perangkat disimpan dalam file media_codecs.xml. Di sini, misalnya, adalah file ini untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pixel XL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HUAWEI P8 lite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ketika Anda menerima daftar codec menggunakan metode getCodecInfos () dari objek MediaCodecList, file ini diuraikan - dan codec yang disimpan di dalamnya dikembalikan. Operasi ini dan pengisian yang benar dari file ini oleh pabrikan tercakup dalam uji CTS.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaCodecListTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang juga meningkat dari 160 baris kode di Android 4.3 menjadi 740 baris di Android 10. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Badoo, kami mengubah kode metode isHardwareSupportedInCurrentSdkH264, menolak daftar codec "putih" dan menggantinya dengan daftar kode program "hitam" yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tercantum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam WebRTC:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] SOFTWARE_IMPLEMENTATION_PREFIXES = {<span class="hljs-string">"OMX.google."</span>, <span class="hljs-string">"OMX.SEC."</span>};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi Anda tidak bisa hanya mengambil dan menerapkan dukungan untuk semua codec tanpa memperhatikan fitur pabrikan. </font><font style="vertical-align: inherit;">Dari nama-nama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">topik yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dikhususkan untuk pengkodean perangkat keras pada Android dalam grup </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diskusi-webrtc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kita dapat memahami bahwa dalam hal ini kita pasti akan menemukan kesalahan. </font><font style="vertical-align: inherit;">Pada dasarnya, mereka muncul pada tahap konfigurasi codec.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi konfigurasi codec</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inisialisasi codec untuk encoding adalah sebagai berikut:</font></font><br>
<br>
<pre><code class="java hljs">MediaCodec mediaCodec = createByCodecName(codecName);<font></font>
MediaFormat format = MediaFormat.createVideoFormat(mime, width, height);<font></font>
format.setInteger(MediaFormat.KEY_BIT_RATE, targetBitrateBps);<font></font>
format.setInteger(MediaFormat.KEY_BITRATE_MODE, VIDEO_ControlRateConstant);<font></font>
format.setInteger(MediaFormat.KEY_COLOR_FORMAT, colorFormat);<font></font>
format.setInteger(MediaFormat.KEY_FRAME_RATE, targetFps);<font></font>
format.setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, keyFrameIntervalSec);<font></font>
mediaCodec.configure(format, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, MediaCodec.CONFIGURE_FLAG_ENCODE);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat mudah untuk membuat kesalahan dalam beberapa parameter ini, yang akan membuat pengecualian ketika mengkonfigurasi codec dan mengganggu aplikasi. </font><font style="vertical-align: inherit;">Juga, ketika bekerja dengan codec, Anda mungkin perlu menyesuaikan bitrate-nya tergantung pada berbagai faktor, karena codec itu sendiri salah. </font><font style="vertical-align: inherit;">Untuk ini, di WebRTC, kelas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseBitrateAdjuster bertanggung jawab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang memiliki dua keturunan:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamicBitrateAdjuster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - menyesuaikan bitrate tergantung pada jumlah data</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FramerateBitrateAdjuster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - menyesuaikan bitrate tergantung pada frame rate.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, untuk setiap codec, Anda harus memilih mekanisme penyesuaian bitrate Anda sendiri. </font><font style="vertical-align: inherit;">Mari kita pertimbangkan secara lebih rinci fitur pengaturan parameter inisialisasi untuk codec perangkat keras.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resolusi aliran</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menerima objek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaCodecInfo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk codec, </font><font style="vertical-align: inherit;">Anda dapat memeriksa codec lebih detail dengan mendapatkan kemampuannya di kelas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodecCapabilities</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dari mereka, Anda dapat mengetahui apakah codec mendukung resolusi dan frame rate yang dipilih. </font><font style="vertical-align: inherit;">Jika mendukung parameter ini, mereka dapat diatur dengan aman. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, terkadang aturan ini tidak berfungsi. </font><font style="vertical-align: inherit;">Kita dihadapkan dengan fakta bahwa codec dengan awalan "OMX.MARVELL." </font><font style="vertical-align: inherit;">disandikan salah, menunjukkan garis-garis hijau di tepi layar jika resolusi aliran berbeda dari 4: 3. </font><font style="vertical-align: inherit;">Pada saat yang sama, codec itu sendiri mengklaim bahwa resolusi dan frame rate yang dipilih didukung.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode kecepatan bit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mode standar untuk semua codec video adalah bitrate konstan. </font><font style="vertical-align: inherit;">Namun, begitu kami harus menggunakan bitrate variabel:</font></font><br>
<br>
<pre><code class="java hljs">format.setInteger(MediaFormat.KEY_BITRATE_MODE, VIDEO_ControlRateVariable);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini terjadi pada perangkat Lenovo A1000 dengan chipset Spreadtrum (sekarang Unisoc) dimulai dengan awalan "OMX.sprd.". </font><font style="vertical-align: inherit;">Pencarian di Internet membawa kami ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berusia enam tahun di Firefox OS yang menjelaskan masalah ini dan bagaimana menyelesaikannya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format warna</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menggunakan codec dalam mode byte-buffer, Anda harus memilih format yang benar. </font><font style="vertical-align: inherit;">Ini biasanya dilakukan menggunakan fungsi dari bentuk berikut:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Nullable</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> Integer <span class="hljs-title">selectColorFormat</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] supportedColorFormats, CodecCapabilities capabilities)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> supportedColorFormat : supportedColorFormats) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> codecColorFormat : capabilities.colorFormats) {
      <span class="hljs-keyword">if</span> (codecColorFormat == supportedColorFormat) {
        <span class="hljs-keyword">return</span> codecColorFormat;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara kasar, format warna pertama yang didukung selalu dipilih. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, dalam kasus codec HUAWEI dimulai dengan awalan "OMX.IMG.TOPAZ.", "OMX.hisi." </font><font style="vertical-align: inherit;">dan “OMX.k3.”, itu tidak berhasil, dan setelah pencarian yang panjang kami menemukan solusinya: tidak peduli format apa yang dikembalikan oleh codec ini, Anda perlu menggunakan format </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLOR_FormatYUV420SemiPlanar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://translate.google.com/translate%3Fhl%3D%26sl%3Dzh-CN%26tl%3Den%26u%3D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> membantu kami untuk </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://translate.google.com/translate%3Fhl%3D%26sl%3Dzh-CN%26tl%3Den%26u%3D"><font style="vertical-align: inherit;">mencari tahu ini</font></a><font style="vertical-align: inherit;"> di satu forum Cina.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyesuaian Bitrate</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode WebRTC standar berisi yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berikut ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> BitrateAdjuster <span class="hljs-title">createBitrateAdjuster</span><span class="hljs-params">(VideoCodecMimeType type, String codecName)</span> </span>{
  <span class="hljs-keyword">if</span> (codecName.startsWith(EXYNOS_PREFIX)) {
    <span class="hljs-keyword">if</span> (type == VideoCodecMimeType.VP8) {
        <span class="hljs-comment">// Exynos VP8 encoders need dynamic bitrate adjustment.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DynamicBitrateAdjuster();<font></font>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Exynos VP9 and H264 encoders need framerate-based bitrate adjustment.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FramerateBitrateAdjuster();<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment">// Other codecs don't need bitrate adjustment.</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BaseBitrateAdjuster();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat dari kode ini, untuk semua chipset kecuali Exynos, penyesuaian bitrate dimatikan. Tetapi ini hanya berlaku untuk Qualcomm, karena hanya Exynos dan Qualcomm yang didukung dalam kode standar. Setelah bereksperimen dengan berbagai nilai pengaturan ini, dan juga mencari di Internet, kami menemukan bahwa untuk codec dengan awalan "OMX.MTK." itu juga perlu dihidupkan. Hal ini juga diperlukan untuk melakukan ini untuk codec HUAWEI dimulai dengan awalan "OMX.IMG.TOPAZ.", "OMX.hisi." atau "OMX.k3.". Hal ini disebabkan oleh fakta bahwa codec ini tidak menggunakan cap waktu frame untuk mengatur bitrate, dengan asumsi bahwa semua frame datang dengan frekuensi yang sama yang ditetapkan ketika mengkonfigurasi codec.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai kesimpulan, saya akan memberikan daftar codec yang kami terima untuk perangkat di Android 5.0 dan 5.1. </font><font style="vertical-align: inherit;">Kami tertarik pada mereka terutama karena pada versi Android yang lebih baru situasinya membaik dan codec non-standar menjadi lebih kecil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini bisa dilihat pada grafik di bawah ini. </font><font style="vertical-align: inherit;">Skala logaritmik lebih baik untuk menunjukkan kasus langka. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/le/ng/ws/lengwsark1w8mgc0jmg95pptv_k.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dapat kita lihat, sebagian besar perangkat memiliki chipset Spreadtrum, MediaTek, HUAWEI dan MARVELL - sehingga perubahan kami membantu menghidupkan penyandian perangkat keras pada gadget ini.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun kami berasumsi bahwa beberapa perangkat akan mengalami masalah saat bekerja dengan H.264, Android kembali dapat mengejutkan kami. Seperti yang dapat kita lihat dari statistik pengguna Badoo, masih ada banyak perangkat di tangan pengguna pada 2014-2016, yang tidak mereka inginkan atau tidak dapat perbarui. Dan meskipun situasi dengan rilis pembaruan Android untuk perangkat baru sudah jauh lebih baik daripada beberapa tahun yang lalu, pangsa gadget generasi sebelumnya menurun cukup lambat dan harus dipertahankan untuk beberapa waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang WebRTC sedang dikembangkan secara aktif oleh Google karena penggunaannya dalam proyek Stadia (inilah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">videonya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan perincian tentang topik ini), sehingga akan menjadi lebih baik dan lebih baik dan, kemungkinan besar, akan menjadi standar untuk menerapkan komunikasi video. </font><font style="vertical-align: inherit;">Saya harap artikel ini akan membantu Anda memahami fitur bekerja dengan H.264 di WebRTC dan menggunakannya dalam proyek Anda.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id500640/index.html">Cara membuat perusahaan outsourcing yang sukses</a></li>
<li><a href="../id500642/index.html">Igrostroy: ambang batas untuk memasuki industri, spesialisasi dan kemungkinan pendapatan</a></li>
<li><a href="../id500644/index.html">Random Coffee Habr Edition - jaringan untuk komunitas IT</a></li>
<li><a href="../id500646/index.html">Memasak bytecode di dapur JVM</a></li>
<li><a href="../id500648/index.html">Apa model arsitektur kematangan perusahaan?</a></li>
<li><a href="../id500656/index.html">Pencatatan hierarki aplikasi ke basis data</a></li>
<li><a href="../id500660/index.html">Sejarah pengembangan "awan" yang disederhanakan dan sangat singkat</a></li>
<li><a href="../id500666/index.html">Sertifikasi online Microsoft - Anda, ruang Anda, dan komputer Anda</a></li>
<li><a href="../id500668/index.html">Kontrol motor nirkabel dari Lego menggunakan Steam Controller</a></li>
<li><a href="../id500670/index.html">Bagaimana kami menciptakan produk kami. Bagian Satu, Penelitian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>