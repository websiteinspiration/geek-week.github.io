<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🔧 👨‍✈️ 🍥 Dari kesalahan hingga peringatan dengan tindakan 📭 ◼️ 🥥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Untuk pengguna, pesan kesalahan sering terlihat seperti "Ada yang salah, AAAA!". Tentu saja, dia ingin bukannya kesalahan untuk melihat ke...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Dari kesalahan hingga peringatan dengan tindakan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/manychat/blog/495346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! </font><font style="vertical-align: inherit;">Untuk pengguna, pesan kesalahan sering terlihat seperti "Ada yang salah, AAAA!". </font><font style="vertical-align: inherit;">Tentu saja, dia ingin bukannya kesalahan untuk melihat kesalahan ajaib "Perbaiki semuanya". </font><font style="vertical-align: inherit;">Nah, atau opsi lainnya. </font><font style="vertical-align: inherit;">Kami mulai secara aktif menambahkan ini ke diri kami sendiri, dan saya ingin berbicara tentang bagaimana Anda bisa melakukan ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6q/cf/s3/6qcfs3uiu0o9ajdlcfi8frjb5pg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, perkenalkan diri saya - nama saya Alexander, enam tahun terakhir saya telah mencurahkan pengembangan iOS. </font><font style="vertical-align: inherit;">Sekarang saya bertanggung jawab untuk aplikasi seluler ManyChat dan saya akan memecahkan masalah menggunakan contohnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari segera merumuskan apa yang akan kita lakukan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambahkan Fungsi ke Jenis Kesalahan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubah kesalahan menjadi peringatan ramah pengguna</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menampilkan tindakan lebih lanjut yang mungkin dalam antarmuka dan memproses klik mereka</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan semua ini ada di Swift :)</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan memecahkan masalah dengan sebuah contoh. </font><font style="vertical-align: inherit;">Server mengembalikan kesalahan dengan kode 500 bukannya 200 yang diharapkan. Apa yang harus dilakukan pengembang? </font><font style="vertical-align: inherit;">Paling tidak, dengan sedih memberi tahu pengguna - pos yang diharapkan dengan segel tidak dapat diunduh. </font><font style="vertical-align: inherit;">Di Apple, pola standar adalah peringatan, jadi mari kita menulis fungsi sederhana:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeedViewController</span>: <span class="hljs-title">UIViewController</span> </span>{
  <span class="hljs-comment">// -   </span><font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleFeedResponse</span><span class="hljs-params">(...)</span></span> {
	<span class="hljs-comment">/// -    </span>
	<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
		<span class="hljs-keyword">let</span> alertVC = <span class="hljs-type">UIAlertController</span>(<font></font>
			title: <span class="hljs-string">"Error"</span>,<font></font>
			message: <span class="hljs-string">"Error connecting to the server"</span>,<font></font>
			preferredStyle: .alert)<font></font>
		<span class="hljs-keyword">let</span> action = <span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"OK"</span>, style: .<span class="hljs-keyword">default</span>, handler: <span class="hljs-literal">nil</span>)<font></font>
		alertVC.addAction(action)<font></font>
		<span class="hljs-keyword">self</span>.present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
	}<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Untuk kesederhanaan, sebagian besar kode akan berada di controller. </font><font style="vertical-align: inherit;">Anda bebas menggunakan pendekatan yang sama dalam arsitektur Anda. </font><font style="vertical-align: inherit;">Kode artikel akan tersedia di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositori</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di akhir artikel tautan ini juga akan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapatkan gambar berikut: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9o/ra/ee/9oraeel1k7noyxjplcumz1b56jy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara teoritis, kami menyelesaikan tugas. </font><font style="vertical-align: inherit;">Tetapi beberapa hal segera terbukti:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami tidak memberikan kesempatan untuk beralih dari skenario yang salah ke skenario yang sukses. </font><font style="vertical-align: inherit;">OK dalam kasus saat ini, itu hanya menyembunyikan peringatan - dan ini bukan solusi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dari sudut pandang pengalaman pengguna, teks perlu dibuat lebih jelas, netral. </font><font style="vertical-align: inherit;">Agar pengguna tidak takut dan tidak lari untuk menempatkan satu bintang di AppStore ke aplikasi Anda. </font><font style="vertical-align: inherit;">Dalam hal ini, teks terperinci akan bermanfaat bagi kami saat melakukan debugging</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan, sejujurnya - peringatan agak ketinggalan jaman sebagai solusi (semakin, layar tiruan atau bersulang muncul di aplikasi). </font><font style="vertical-align: inherit;">Tetapi ini sudah merupakan pertanyaan yang harus dibahas secara terpisah dengan tim</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setuju, opsi yang disajikan di bawah ini terlihat jauh lebih simpatik. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jv/0z/oz/jv0zozzv3foowtocsqkk_pjdifo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi mana pun yang Anda pilih, untuk siapa pun di antara Anda yang perlu memikirkan mekanisme untuk menampilkan pesan yang akan tampak hebat ketika kesalahan sewenang-wenang terjadi, akan menawarkan pengguna skrip yang jelas untuk pekerjaan lebih lanjut dalam aplikasi dan memberikan serangkaian tindakan. </font><font style="vertical-align: inherit;">Solusinya adalah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Harus bisa diperluas. </font><font style="vertical-align: inherit;">Kita semua tahu tentang variabilitas desain yang melekat. </font><font style="vertical-align: inherit;">Mekanisme kami harus siap untuk apa pun</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itu ditambahkan ke objek (dan dihapus) dalam beberapa baris kode</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teruji dengan baik</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi sebelum itu, mari kita terjun ke minimum teoritis untuk kesalahan di Swift. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesalahan dalam Swift</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paragraf ini adalah gambaran umum tingkat atas dari kesalahan secara umum. </font><font style="vertical-align: inherit;">Jika Anda sudah aktif menggunakan kesalahan dalam aplikasi, Anda dapat melanjutkan ke paragraf berikutnya dengan aman. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa itu kesalahan? </font><font style="vertical-align: inherit;">Semacam tindakan salah atau hasil salah. </font><font style="vertical-align: inherit;">Seringkali kita dapat mengasumsikan kesalahan yang mungkin terjadi dan menjelaskannya terlebih dahulu dalam kode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk kasus ini, Apple memberi kita tipe Kesalahan. </font><font style="vertical-align: inherit;">Jika kita membuka dokumentasi Apple, maka Error akan terlihat seperti ini (relevan untuk Swift 5.1):</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">Error</span> </span>{<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya protokol tanpa persyaratan tambahan. </font><font style="vertical-align: inherit;">Dokumentasi menjelaskan dengan baik - kurangnya parameter yang diperlukan memungkinkan jenis apa pun untuk digunakan dalam sistem penanganan kesalahan Swift. </font><font style="vertical-align: inherit;">Dengan protokol yang begitu lembut, kami hanya akan bekerja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gagasan untuk menggunakan enum langsung muncul di benak saya: ada sejumlah kesalahan yang diketahui, mereka mungkin memiliki beberapa jenis parameter. </font><font style="vertical-align: inherit;">Itulah yang dilakukan Apple. </font><font style="vertical-align: inherit;">Misalnya, Anda dapat mempertimbangkan menerapkan DecodingError:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">DecodingError</span> : <span class="hljs-title">Error</span> </span>{<font></font>
    <font></font>
        <span class="hljs-comment">/// ,     . </span>
    	<span class="hljs-comment">///  ,    </span>
        <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Context</span> </span>{<font></font>
    <font></font>
    	    <span class="hljs-comment">///      </span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> codingPath: [<span class="hljs-type">CodingKey</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> debugDescription: <span class="hljs-type">String</span><font></font>
    <font></font>
    	    <span class="hljs-comment">/// ,    . </span>
            <span class="hljs-comment">///      .   </span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> underlyingError: <span class="hljs-type">Error?</span><font></font>
    <font></font>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>(codingPath: [<span class="hljs-type">CodingKey</span>], debugDescription: <span class="hljs-type">String</span>, underlyingError: <span class="hljs-type">Error?</span> = <span class="hljs-literal">nil</span>)<font></font>
        }<font></font>
    <font></font>
    	<span class="hljs-comment">/// N    </span>
        <span class="hljs-keyword">case</span> typeMismatch(<span class="hljs-type">Any</span>.<span class="hljs-type">Type</span>, <span class="hljs-type">DecodingError</span>.<span class="hljs-type">Context</span>)
        <span class="hljs-keyword">case</span> valueNotFound(<span class="hljs-type">Any</span>.<span class="hljs-type">Type</span>, <span class="hljs-type">DecodingError</span>.<span class="hljs-type">Context</span>)<font></font>
    <font></font>
    ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manfaatkan praktik terbaik Apple. </font><font style="vertical-align: inherit;">Bayangkan sekelompok kemungkinan kesalahan jaringan dalam bentuk yang disederhanakan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">NetworkError</span>: <span class="hljs-title">Error</span> </span>{
       <span class="hljs-comment">//  500 </span>
	<span class="hljs-keyword">case</span> serverError
        <span class="hljs-comment">//   ,   </span>
	<span class="hljs-keyword">case</span> responseError
        <span class="hljs-comment">//  ,   ,  </span>
	<span class="hljs-keyword">case</span> internetError<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, di mana saja di aplikasi kita di mana kesalahan terjadi, kita dapat menggunakan Network.Error kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana cara mengatasi bug? Ada mekanisme do catch. Jika suatu fungsi dapat melempar kesalahan, maka itu ditandai dengan kata kunci lemparan. Sekarang setiap penggunanya diharuskan untuk mengaksesnya melalui konstruk do catch. Jika tidak ada kesalahan, kita akan jatuh ke blok do, dengan kesalahan, ke blok catch. Fungsi yang mengarah ke kesalahan bisa berupa angka apa saja di blok do. Satu-satunya negatif adalah bahwa dalam tangkapan kita mendapatkan kesalahan ketik Kesalahan. Anda harus memasukkan kesalahan ke dalam tipe yang diinginkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai alternatif, kita dapat menggunakan opsional, yaitu, mendapatkan nihil jika terjadi kesalahan dan menyingkirkan desain besar. Kadang-kadang lebih nyaman: katakanlah ketika kita mendapatkan variabel opsional, dan kemudian menerapkan fungsi melempar ke sana. Kode dapat dimasukkan ke dalam blok if / guard, dan akan tetap singkat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah contoh bekerja dengan fungsi lemparan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">blah</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">String</span> <span class="hljs-keyword">throws</span> {
    	<span class="hljs-keyword">throw</span> <span class="hljs-type">NetworkError</span>.serverError<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">do</span> {
    	<span class="hljs-keyword">let</span> string = <span class="hljs-keyword">try</span> blah()
    	<span class="hljs-comment">//     ,      </span>
    	<span class="hljs-keyword">let</span> anotherString = <span class="hljs-keyword">try</span> blah()<font></font>
    } <span class="hljs-keyword">catch</span> {
    	<span class="hljs-comment">//  NetworkError.serverError</span>
    	<span class="hljs-built_in">print</span>(error)<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//  string = nil</span>
    <span class="hljs-keyword">let</span> string = <span class="hljs-keyword">try</span>? blah()</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jangan bingung dengan do catch dalam bahasa lain. Swift tidak melempar pengecualian, tetapi menulis nilai kesalahan (jika itu terjadi) dalam register khusus. Jika ada nilai, ia pergi ke blok kesalahan, jika tidak, blok do berlanjut. Sumber untuk yang paling ingin tahu: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.mikeash.com/pyblog/friday-qa-2017-08-25-swift-error-handling-implementation.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Metode ini baik untuk menangani acara sinkron dan tidak nyaman untuk operasi yang panjang (misalnya, meminta data melalui jaringan), yang berpotensi memakan waktu. Kemudian Anda bisa menggunakan penyelesaian sederhana.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai alternatif dari Swift 5, Result diperkenalkan - enum siap yang berisi dua opsi - sukses dan gagal. </font><font style="vertical-align: inherit;">Dengan sendirinya, itu tidak memerlukan penggunaan Kesalahan. </font><font style="vertical-align: inherit;">Dan itu tidak memiliki hubungan langsung dengan asynchrony. </font><font style="vertical-align: inherit;">Tetapi mengembalikan tipe ini secara tepat ke penyelesaian lebih nyaman untuk peristiwa asinkron (jika tidak, Anda harus melakukan dua penyelesaian, sukses dan gagal, atau mengembalikan dua parameter). </font><font style="vertical-align: inherit;">Mari kita tulis sebuah contoh:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">blah</span>&lt;ResultType&gt;<span class="hljs-params">(handler: @escaping <span class="hljs-params">(Swift.Result&lt;ResultType, Error&gt;)</span></span></span> -&gt; <span class="hljs-type">Void</span>) {<font></font>
	handler(.failure(<span class="hljs-type">NetworkError</span>.serverError)<font></font>
}<font></font>
<font></font>
blah&lt;<span class="hljs-type">String</span>&gt;(handler { result <span class="hljs-keyword">in</span> 
	<span class="hljs-keyword">switch</span> result {
		<span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> value):
			<span class="hljs-built_in">print</span>(value)
		<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
			<span class="hljs-built_in">print</span>(error)<font></font>
	}<font></font>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi ini cukup bagi kami untuk bekerja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekali lagi, secara singkat:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesalahan dalam Swift adalah protokol</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebih mudah untuk menyajikan kesalahan sebagai enum</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada dua cara untuk mengatasi kesalahan - sinkron (lakukan tangkapan) dan asinkron (persaingan atau Hasil Anda sendiri)</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teks salah</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita kembali ke topik artikel. </font><font style="vertical-align: inherit;">Dalam paragraf di atas, kami membuat jenis kesalahan kami sendiri. </font><font style="vertical-align: inherit;">Itu dia:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">NetworkError</span>: <span class="hljs-title">Error</span> </span>{
        <span class="hljs-comment">//  500 </span>
	<span class="hljs-keyword">case</span> serverError
        <span class="hljs-comment">//   ,   </span>
	<span class="hljs-keyword">case</span> responseError
        <span class="hljs-comment">//  ,   ,  </span>
	<span class="hljs-keyword">case</span> internetError<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita harus mencocokkan setiap kesalahan dengan teks yang dapat dimengerti oleh pengguna. </font><font style="vertical-align: inherit;">Kami akan menampilkannya di antarmuka jika ada kesalahan. </font><font style="vertical-align: inherit;">Protokol Lokalisasi bergegas untuk membantu kami. </font><font style="vertical-align: inherit;">Ini mewarisi kesalahan protokol dan menambahnya dengan 4 properti:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">LocalizedError</span> : <span class="hljs-title">Error</span> </span>{
    <span class="hljs-keyword">var</span> errorDescription: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> failureReason: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> recoverySuggestion: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> helpAnchor: <span class="hljs-type">String?</span> { <span class="hljs-keyword">get</span> }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menerapkan protokol:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">NetworkError</span>: <span class="hljs-title">LocalizedError</span> </span>{
    	<span class="hljs-keyword">var</span> errorDescription: <span class="hljs-type">String?</span> {
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .serverError, .responseError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Error"</span>
    	    <span class="hljs-keyword">case</span> .internetError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"No Internet Connection"</span><font></font>
            }<font></font>
        }<font></font>
    <font></font>
        <span class="hljs-keyword">var</span> failureReason: <span class="hljs-type">String?</span> {
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .serverError, .responseError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Something went wrong"</span>
    	    <span class="hljs-keyword">case</span> .internetError:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
            }<font></font>
        }<font></font>
    <font></font>
        <span class="hljs-keyword">var</span> recoverySuggestion: <span class="hljs-type">String?</span> {
            <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-keyword">case</span> .serverError, .responseError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Please, try again"</span>
    	    <span class="hljs-keyword">case</span> .internetError:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Please check your internet connection and try again"</span><font></font>
            }<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampilan kesalahan tidak akan berubah:</font></font><br>
<br>
<pre><code class="swift hljs">	<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
		<span class="hljs-keyword">let</span> errorMessage = [error.failureReason, error.recoverySuggestion].<span class="hljs-built_in">compactMap</span>({ $<span class="hljs-number">0</span> }).joined(separator: <span class="hljs-string">". "</span>)
		<span class="hljs-keyword">let</span> alertVC = <span class="hljs-type">UIAlertController</span>(<font></font>
			title: error.errorDescription,<font></font>
			message: errorMessage,<font></font>
			preferredStyle: .alert)<font></font>
		<span class="hljs-keyword">let</span> action = <span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"OK"</span>, style: .<span class="hljs-keyword">default</span>) { (<span class="hljs-number">_</span>) -&gt; <span class="hljs-type">Void</span> <span class="hljs-keyword">in</span> }<font></font>
		alertVC.addAction(action)<font></font>
		<span class="hljs-keyword">self</span>.present(alertVC, animated: <span class="hljs-literal">true</span>, competion: <span class="hljs-literal">nil</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hebat, semuanya mudah dengan teks. </font><font style="vertical-align: inherit;">Mari beralih ke tombol.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesalahan pemulihan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari sajikan algoritma penanganan kesalahan dalam diagram sederhana. </font><font style="vertical-align: inherit;">Untuk situasi di mana, sebagai akibat dari kesalahan, kami menampilkan kotak dialog dengan Coba Lagi, opsi Batalkan dan, mungkin, beberapa yang spesifik, kami mendapatkan skema: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a9/te/n3/a9ten3zbrffm7sz8kkupfo8xsuy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai memecahkan masalah dari akhir. </font><font style="vertical-align: inherit;">Kami membutuhkan fungsi yang menunjukkan peringatan dengan opsi n +1. </font><font style="vertical-align: inherit;">Kami melempar, karena kami ingin menunjukkan kesalahan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecovableAction</span> </span>{
    	<span class="hljs-keyword">let</span> title: <span class="hljs-type">String</span>
    	<span class="hljs-keyword">let</span> action: () -&gt; <span class="hljs-type">Void</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">showRecovableOptions</span><span class="hljs-params">(actions: [RecovableAction], from viewController: UIViewController)</span></span> {
    	<span class="hljs-keyword">let</span> alertActions = actions.<span class="hljs-built_in">map</span> { <span class="hljs-type">UIAlertAction</span>(name: $<span class="hljs-number">0</span>.title, action: $<span class="hljs-number">0</span>.action) }
    	<span class="hljs-keyword">let</span> cancelAction = <span class="hljs-type">UIAlertAction</span>(name: <span class="hljs-string">"Cancel"</span>, action: <span class="hljs-literal">nil</span>)
    	<span class="hljs-keyword">let</span> alertController = <span class="hljs-type">UIAlertController</span>(actions: alertActions)<font></font>
    	viewController.present(alertController, complition: <span class="hljs-literal">nil</span>)<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi yang menentukan jenis kesalahan dan mentransmisikan sinyal untuk menampilkan peringatan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleError</span><span class="hljs-params">(error: Error)</span></span> {
	<span class="hljs-keyword">if</span> error <span class="hljs-keyword">is</span> <span class="hljs-type">RecovableError</span> {<font></font>
		showRecovableOptions(actions: error.actions, from: viewController)<font></font>
		<span class="hljs-keyword">return</span><font></font>
	}<font></font>
	showErrorAlert(...)<font></font>
} </code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan jenis kesalahan yang diperluas, yang memiliki konteks dan pemahaman tentang apa yang harus dilakukan dengan opsi ini atau itu.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecovableError</span>: <span class="hljs-title">Error</span> </span>{
	<span class="hljs-keyword">let</span> recovableACtions: [<span class="hljs-type">RecovableAction</span>]
	<span class="hljs-keyword">let</span> context: <span class="hljs-type">Context</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kepala segera menggambar diagram sepeda Anda. </font><font style="vertical-align: inherit;">Tapi pertama-tama, mari kita periksa dermaga Apple. </font><font style="vertical-align: inherit;">Mungkin sebagian dari mekanisme sudah ada di tangan kita.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementasi asli?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sedikit pencarian di internet akan menghasilkan protokol </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RecoverableError</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">// A specialized error that may be recoverable by presenting several potential recovery options to the user.</span>
<span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">RecoverableError</span> : <span class="hljs-title">Error</span> </span>{
    <span class="hljs-keyword">var</span> recoveryOptions: [<span class="hljs-type">String</span>] { <span class="hljs-keyword">get</span> }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex recoveryOptionIndex: Int, resultHandler handler: @escaping <span class="hljs-params">(Bool)</span></span></span> -&gt; <span class="hljs-type">Void</span>)
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex recoveryOptionIndex: Int)</span></span> -&gt; <span class="hljs-type">Bool</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepertinya kami sedang mencari:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recoveryOptions: [String] - properti yang menyimpan opsi pemulihan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">func effortRecovery (optionIndex: Int) -&gt; Bool - mengembalikan dari kesalahan, secara sinkron. </font><font style="vertical-align: inherit;">Benar - Sukses</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">func effortRecovery (optionIndex: Int, resultHandler: (Bool) -&gt; Void) - Opsi asinkron, idenya sama</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan panduan penggunaan, semuanya lebih sederhana. </font><font style="vertical-align: inherit;">Sebuah pencarian kecil di situs Apple dan area sekitarnya mengarah ke sebuah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel tentang penanganan kesalahan yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditulis sebelum pengumuman publik Swift. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara singkat:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mekanisme ini dipikirkan untuk aplikasi MacO dan memperlihatkan kotak dialog</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awalnya dibangun di sekitar NSError.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objek RecoveryAttempter diringkas di dalam kesalahan dalam userInfo, yang tahu tentang kondisi kesalahan dan dapat memilih solusi terbaik untuk masalah tersebut. </font><font style="vertical-align: inherit;">Objek tidak boleh nol</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RecoveryAttempter harus mendukung protokol informal NSErrorRecoveryAttempting</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juga di userInfo harus menjadi opsi pemulihan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan semuanya terkait dengan memanggil metode presentError, yang hanya ada di macOS SDK. </font><font style="vertical-align: inherit;">Dia menunjukkan peringatan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika peringatan ditampilkan melalui presentError, maka ketika Anda memilih opsi di jendela pop-up di AppDelegate, fungsi yang menarik berkedut:</font></font></li>
</ul><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(fromError error: Error, optionIndex recoveryOptionIndex: Int, delegate: <span class="hljs-keyword">Any</span>?, didRecoverSelector: Selector?, contextInfo: UnsafeMutableRawPointer?)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi karena kita tidak memiliki Korupsi saat ini, kita tidak dapat menariknya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/xo/cj/vpxocjapqc5ywmiq8hhq3djow6o.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada titik ini, rasanya seperti kita menggali mayat daripada harta. </font><font style="vertical-align: inherit;">Kita harus mengubah Kesalahan menjadi NSError dan menulis fungsi kita sendiri untuk menampilkan peringatan oleh aplikasi. </font><font style="vertical-align: inherit;">Banyak koneksi implisit. </font><font style="vertical-align: inherit;">Itu mungkin, sulit dan tidak sepenuhnya jelas - "Mengapa?". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sementara secangkir teh berikutnya sedang diseduh, orang mungkin bertanya-tanya mengapa fungsi di atas menggunakan delegasi sebagai Any dan melewati pemilih. </font><font style="vertical-align: inherit;">Jawabannya di bawah:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menjawab</font></font></b><div class="spoiler_text">      iOS 2.          !         ( ,   ).  :)<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membangun sepeda </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita implementasikan protokolnya, itu tidak akan merugikan kita:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoverableError</span>: <span class="hljs-title">Foundation</span>.<span class="hljs-title">RecoverableError</span> </span>{
	<span class="hljs-keyword">let</span> error: <span class="hljs-type">Error</span>
	<span class="hljs-keyword">var</span> recoveryOptions: [<span class="hljs-type">String</span>] {
		<span class="hljs-keyword">return</span> [<span class="hljs-string">"Try again"</span>]s<font></font>
	}<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex recoveryOptionIndex: Int)</span></span> -&gt; <span class="hljs-type">Bool</span> {
		<span class="hljs-comment">//  ,    </span>
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><font></font>
	}<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(optionIndex: Int, resultHandler: <span class="hljs-params">(Bool)</span></span></span> -&gt; <span class="hljs-type">Void</span>) {
		<span class="hljs-comment">//      . </span>
               <span class="hljs-comment">//      </span>
		<span class="hljs-keyword">switch</span> optionIndex {
			<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
				resultHandler(<span class="hljs-literal">true</span>)
			<span class="hljs-keyword">default</span>: <font></font>
				resultHandler(<span class="hljs-literal">false</span>)<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketergantungan indeks bukan solusi yang paling nyaman (kita dapat dengan mudah melampaui array dan merusak aplikasi). </font><font style="vertical-align: inherit;">Tetapi untuk MVP akan dilakukan. </font><font style="vertical-align: inherit;">Ambil ide Apple, baru saja memodernkannya. </font><font style="vertical-align: inherit;">Kami membutuhkan objek Attempter dan opsi tombol terpisah yang akan kami berikan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoveryAttemper</span> </span>{
    	<span class="hljs-comment">//   </span>
    	<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> _recoveryOptions: [<span class="hljs-type">RecoveryOptions</span>]<font></font>
    <font></font>
    	<span class="hljs-keyword">var</span> recoveryOptionsText: [<span class="hljs-type">String</span>] {
    		<span class="hljs-keyword">return</span> _recoveryOptions.<span class="hljs-built_in">map</span>({ $<span class="hljs-number">0</span>.title })<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">init</span>(options: [<span class="hljs-type">RecoveryOptions</span>] {<font></font>
    		_recoveryOptions = recoveryOptions<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-comment">//    </span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">attemptRecovery</span><span class="hljs-params">(fromError error: Error, optionIndex: Int)</span></span> -&gt; <span class="hljs-type">Bool</span> {
    		<span class="hljs-keyword">let</span> option = _recoveryOptions[optionIndex]
    				<span class="hljs-keyword">switch</span> option {
    				<span class="hljs-keyword">case</span> .tryAgain(<span class="hljs-keyword">let</span> action)<font></font>
    					action()<font></font>
    					<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    				<span class="hljs-keyword">case</span> .cancel:
    					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><font></font>
    				}<font></font>
    		}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//  enum,       </span>
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">RecoveryOptions</span> </span>{
    	<span class="hljs-comment">//      (,     )</span>
    	<span class="hljs-keyword">case</span> tryAgain(action: (() -&gt; <span class="hljs-type">Void</span>))
    	<span class="hljs-keyword">case</span> cancel<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda harus menunjukkan kesalahan. </font><font style="vertical-align: inherit;">Saya sangat suka protokol, jadi saya akan memecahkan masalah melalui mereka. </font><font style="vertical-align: inherit;">Mari kita membuat protokol universal untuk membuat UIAlertController dari kesalahan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertCreatable</span>: <span class="hljs-title">class</span>, <span class="hljs-title">ErrorReasonExtractable</span> </span>{
    	<span class="hljs-comment">//     </span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">UIAlertController</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertCreatable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">UIViewController</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-comment">//      </span>
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> recoverableError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">RecoverableError</span> {
    			<span class="hljs-keyword">return</span> createRecoverableAlert(<span class="hljs-keyword">for</span>: recoverableError)<font></font>
    		}<font></font>
    		<span class="hljs-keyword">let</span> defaultTitle = <span class="hljs-string">"Error"</span>
    		<span class="hljs-keyword">let</span> description = errorReason(from: error)<font></font>
    <font></font>
    		<span class="hljs-comment">//          </span>
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> localizedError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">LocalizedError</span> {
    			<span class="hljs-keyword">return</span> createAlert(<font></font>
    				title: localizedError.errorDescription ?? defaultTitle,<font></font>
    				message: description,<font></font>
    				actions: [.okAction],<font></font>
    				aboveAll: aboveAll)<font></font>
    		}<font></font>
    <font></font>
    		<span class="hljs-keyword">return</span> createAlert(title: defaultTitle, message: description, actions: [.okAction])<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(title: String?, message: String?, actions: [UIAlertAction])</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">let</span> alertViewController = <span class="hljs-type">UIAlertController</span>(title: title, message: message, preferredStyle: .alert)<font></font>
    		actions.forEach({ alertViewController.addAction($<span class="hljs-number">0</span>) })
    		<span class="hljs-keyword">return</span> alertViewController<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createRecoverableAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> recoverableError: RecoverableError)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">let</span> title = recoverableError.errorDescription
    		<span class="hljs-keyword">let</span> message = recoverableError.recoverySuggestion
    		<span class="hljs-comment">//     . </span>
    		<span class="hljs-keyword">let</span> actions = recoverableError.recoveryOptions.enumerated().<span class="hljs-built_in">map</span> { (element) -&gt; <span class="hljs-type">UIAlertAction</span> <span class="hljs-keyword">in</span>
    		<span class="hljs-keyword">let</span> style: <span class="hljs-type">UIAlertAction</span>.<span class="hljs-type">Style</span> = element.offset == <span class="hljs-number">0</span> ? .cancel : .<span class="hljs-keyword">default</span>
    		<span class="hljs-keyword">return</span> <span class="hljs-type">UIAlertAction</span>(title: element.element, style: style) { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span><font></font>
    			recoverableError.attemptRecovery(optionIndex: element.offset)<font></font>
    		      }<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> createAlert(title: title, message: message, actions: actions)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createOKAlert</span><span class="hljs-params">(with text: String)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">return</span> createAlert(title: text, message: <span class="hljs-literal">nil</span>, actions: [.okAction])<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ERror</span>
    
    //     <span class="hljs-title">ok</span>
    <span class="hljs-title">extension</span> <span class="hljs-title">UIAlertAction</span> </span>{
    	<span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> okAction = <span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"OK"</span>, style: .cancel) { (<span class="hljs-number">_</span>) -&gt; <span class="hljs-type">Void</span> <span class="hljs-keyword">in</span> }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorReasonExtractable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">errorReason</span><span class="hljs-params">(from error: Error)</span></span> -&gt; <span class="hljs-type">String?</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorReasonExtractable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">errorReason</span><span class="hljs-params">(from error: Error)</span></span> -&gt; <span class="hljs-type">String?</span> {
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> localizedError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">LocalizedError</span> {
    			<span class="hljs-keyword">return</span> localizedError.recoverySuggestion<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> <span class="hljs-string">"Something bad happened. Please try again"</span><font></font>
    	}<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan protokol untuk menampilkan peringatan yang dibuat:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertPresentable</span>: <span class="hljs-title">class</span> </span>{
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// MARK: - Default implementation</span>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertPresentable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">ErrorAlertCreatable</span> &amp; <span class="hljs-title">UIViewController</span> </span>{
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span> {
		<span class="hljs-keyword">let</span> alertVC = createAlert(<span class="hljs-keyword">for</span>: error)<font></font>
		present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ternyata menjadi rumit, tetapi dapat dikelola. </font><font style="vertical-align: inherit;">Kami dapat membuat cara baru untuk menampilkan kesalahan (misalnya, bersulang atau menampilkan tampilan khusus) dan mendaftarkan implementasi default tanpa mengubah apa pun dalam metode yang disebut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan jika pandangan kita dilindungi oleh protokol:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ViewControllerInput</span>: <span class="hljs-title">class</span> </span>{
     <span class="hljs-comment">//  </span><font></font>
    }<font></font>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewControllerInput</span>: <span class="hljs-title">ErrorAlertPresentable</span> </span>{ }<font></font>
    <font></font>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorAlertCreatable</span> </span>{ }
    <span class="hljs-comment">//  ,         ,    </span>
    <span class="hljs-comment">//    </span><font></font>
    <font></font>
    <span class="hljs-comment">//       "",    ErrorAlertPresentable      . </span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorToastCreatable</span> </span>{ }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi contoh kami jauh lebih sederhana, jadi kami mendukung kedua protokol dan menjalankan aplikasi:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestFeed</span><span class="hljs-params">(...)</span></span> {<font></font>
    		service.requestObject { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
    			<span class="hljs-keyword">switch</span> result {
    			<span class="hljs-keyword">case</span> .success:
    				<span class="hljs-keyword">break</span>
    			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
    				<span class="hljs-comment">//           </span>
    				<span class="hljs-comment">// -     (   viewController)  ,</span>
    				<span class="hljs-comment">//    .     tryAgainOption </span>
    				<span class="hljs-keyword">let</span> tryAgainOption = <span class="hljs-type">RecoveryOptions</span>.tryAgain {
    					<span class="hljs-keyword">self</span>.requestFeed(...)<font></font>
    				}<font></font>
    				<span class="hljs-keyword">let</span> recoveryOptions = [tryAgainOption]
    				<span class="hljs-keyword">let</span> attempter = <span class="hljs-type">RecoveryAttemper</span>(recoveryOptions: recoveryOptions)
    				<span class="hljs-keyword">let</span> recovableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: attempter)
    				<span class="hljs-keyword">self</span>.presentAlert(from: recovableError)<font></font>
    			}<font></font>
    		}<font></font>
    	}<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertCreatable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorAlertCreatable</span> </span>{ }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertPresentable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorAlertPresentable</span> </span>{ }</code></pre><br>
<img src="https://habrastorage.org/webt/3h/fl/vh/3hflvhmxpfkuzgskzcpe9hodl2k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya semuanya berhasil. </font><font style="vertical-align: inherit;">Salah satu kondisi awal adalah dalam 2-3 baris. </font><font style="vertical-align: inherit;">Kami akan memperluas usaha kami dengan konstruktor yang nyaman:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoveryAttemper</span> </span>{
    	<span class="hljs-comment">//</span><font></font>
    	...<font></font>
    	<span class="hljs-comment">//</span>
    	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">tryAgainAttempter</span><span class="hljs-params">(block: @escaping <span class="hljs-params">(<span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type">Void</span>)) -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">RecoveryAttemper</span>(recoveryOptions: [.cancel, .tryAgain(action: block)])<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestFeed</span><span class="hljs-params">()</span></span> {<font></font>
    		service.requestObject { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
    			<span class="hljs-keyword">switch</span> result {
    			<span class="hljs-keyword">case</span> .success:
    				<span class="hljs-keyword">break</span>
    			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
    				<span class="hljs-comment">//    </span>
    				<span class="hljs-keyword">let</span> recovableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: .tryAgainAttempter(block: {
    					<span class="hljs-keyword">self</span>.requestFeed()<font></font>
    				}))<font></font>
    				<span class="hljs-keyword">self</span>.presentAlert(from: recovableError)<font></font>
    			}<font></font>
    		}<font></font>
    	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapat solusi MVP, dan tidak akan sulit bagi kami untuk terhubung dan menyebutnya di mana saja dalam aplikasi kami. </font><font style="vertical-align: inherit;">Mari kita mulai memeriksa kasus tepi dan skalabilitas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana jika kita memiliki beberapa skenario keluar?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan seorang pengguna memiliki repositori di aplikasi kami. </font><font style="vertical-align: inherit;">Gudang memiliki batas tempat. </font><font style="vertical-align: inherit;">Dalam hal ini, pengguna memiliki dua skenario untuk keluar dari kesalahan: pengguna dapat membebaskan ruang atau membeli lebih banyak. </font><font style="vertical-align: inherit;">Kami akan menulis kode berikut:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//  </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">runOutOfSpace</span><span class="hljs-params">()</span></span> {<font></font>
    		service.runOfSpace { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
    			<span class="hljs-keyword">switch</span> result {
    			<span class="hljs-keyword">case</span> .success:
    				<span class="hljs-keyword">break</span>
    			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
    				<span class="hljs-keyword">let</span> notEnoughSpace = <span class="hljs-type">RecoveryOptions</span>.freeSpace {
    					<span class="hljs-keyword">self</span>.freeSpace()<font></font>
    				}<font></font>
    <font></font>
    				<span class="hljs-keyword">let</span> buyMoreSpace = <span class="hljs-type">RecoveryOptions</span>.buyMoreSpace {
    					<span class="hljs-keyword">self</span>.buyMoreSpace()<font></font>
    				}<font></font>
    				<span class="hljs-keyword">let</span> options = [notEnoughSpace, buyMoreSpace]
    				<span class="hljs-keyword">let</span> recovableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: .cancalableAttemter(options: options))
    				<span class="hljs-keyword">self</span>.presentAlert(from: recovableError)<font></font>
    			}<font></font>
    		}<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">freeSpace</span><span class="hljs-params">()</span></span> {
    		<span class="hljs-keyword">let</span> alertViewController = createOKAlert(with: <span class="hljs-string">"Free space selected"</span>)<font></font>
    		present(alertViewController, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buyMoreSpace</span><span class="hljs-params">()</span></span> {
    		<span class="hljs-keyword">let</span> alertViewController = createOKAlert(with: <span class="hljs-string">"Buy more space selected"</span>)<font></font>
    		present(alertViewController, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    <font></font>
    <font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RecoveryAttemper</span> </span>{
    	<span class="hljs-comment">//</span><font></font>
    	...<font></font>
    	<span class="hljs-comment">//</span>
    	<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cancalableAttemter</span><span class="hljs-params">(options: [RecoveryOptions])</span></span> -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">RecoveryAttemper</span>(recoveryOptions: [.cancel] + options)<font></font>
    	}<font></font>
    }<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/d5/eg/zq/d5egzquyykwxtjorhevcq2pe1mg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini mudah ditangani. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika kita ingin menunjukkan bukan peringatan, tetapi tampilan informasi di tengah layar?</font></font></h3><br>
<img src="https://habrastorage.org/webt/fg/xr/pq/fgxrpqsgg_yqmy4txescavcvdvc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa protokol baru dengan analogi akan menyelesaikan masalah kita:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorViewCreatable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createErrorView</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">ErrorView</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorViewCreatable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createErrorView</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error)</span></span> -&gt; <span class="hljs-type">ErrorView</span> {
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> recoverableError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">RecoverableError</span> {
    			<span class="hljs-keyword">return</span> createRecoverableAlert(<span class="hljs-keyword">for</span>: recoverableError)<font></font>
    		}<font></font>
    <font></font>
    		<span class="hljs-keyword">let</span> defaultTitle = <span class="hljs-string">"Error"</span>
    		<span class="hljs-keyword">let</span> description = errorReason(from: error)
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> localizedError = error <span class="hljs-keyword">as</span>? <span class="hljs-type">LocalizedError</span> {
    			<span class="hljs-keyword">return</span> createErrorView(<font></font>
    				title: localizedError.errorDescription ?? defaultTitle,<font></font>
    				message: description)<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> createErrorView(title: defaultTitle, message: description)<font></font>
    		}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createErrorView</span><span class="hljs-params">(title: String?, message: String?, actions: [ErrorView.Action] = [])</span></span> -&gt; <span class="hljs-type">ErrorView</span> {
    		<span class="hljs-comment">//  ErrorView        . </span>
                <span class="hljs-comment">//     github</span>
    		<span class="hljs-keyword">return</span> <span class="hljs-type">ErrorView</span>(title: title, description: message, actions: actions)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createRecoverableAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> recoverableError: RecoverableError)</span></span> -&gt; <span class="hljs-type">ErrorView</span> {
    		<span class="hljs-keyword">let</span> title = recoverableError.errorDescription
    		<span class="hljs-keyword">let</span> message = errorReason(from: recoverableError)
    		<span class="hljs-keyword">let</span> actions = recoverableError.recoveryOptions.enumerated().<span class="hljs-built_in">map</span> { (element) -&gt; <span class="hljs-type">ErrorView</span>.<span class="hljs-type">Action</span> <span class="hljs-keyword">in</span>
    			<span class="hljs-keyword">return</span> <span class="hljs-type">ErrorView</span>.<span class="hljs-type">Action</span>(title: element.element) {<font></font>
    				recoverableError.attemptRecovery(optionIndex: element.offset)<font></font>
    			}<font></font>
    		}<font></font>
    		<span class="hljs-keyword">return</span> createErrorView(title: title, message: message, actions: actions)<font></font>
    	}<font></font>
    }</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorViewAddable</span>: <span class="hljs-title">class</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentErrorView</span><span class="hljs-params">(from error: Error)</span></span><font></font>
    <font></font>
    	<span class="hljs-keyword">var</span> errorViewSuperview: <span class="hljs-type">UIView</span> { <span class="hljs-keyword">get</span> }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorViewAddable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">ErrorViewCreatable</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentErrorView</span><span class="hljs-params">(from error: Error)</span></span> {
    		<span class="hljs-keyword">let</span> errorView = createErrorView(<span class="hljs-keyword">for</span>: error)<font></font>
    		errorViewSuperview.addSubview(errorView)<font></font>
    		errorView.center = errorViewSuperview.center<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <font></font>
    <span class="hljs-comment">//    </span><font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertCreatable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorViewCreatable</span> </span>{ }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - ErrorAlertPresentable</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">ErrorViewAddable</span> </span>{
    	<span class="hljs-keyword">var</span> errorViewSuperview: <span class="hljs-type">UIView</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><font></font>
    	}<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita dapat menampilkan kesalahan dalam bentuk tampilan informasi. </font><font style="vertical-align: inherit;">Terlebih lagi, kita dapat memutuskan bagaimana menunjukkannya. </font><font style="vertical-align: inherit;">Misalnya, pertama kali Anda memasuki layar dan tampilan informasi kesalahan - tampilkan. </font><font style="vertical-align: inherit;">Dan jika layar berhasil dimuat, tetapi tindakan di layar mengembalikan kesalahan - tampilkan peringatan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika tidak ada akses ke tampilan?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terkadang Anda perlu melempar kesalahan, tetapi tidak ada akses ke tampilan. </font><font style="vertical-align: inherit;">Atau kami tidak tahu tampilan mana yang sedang aktif, dan kami ingin menampilkan lansiran di atas segalanya. </font><font style="vertical-align: inherit;">Bagaimana cara mengatasi masalah ini? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu cara termudah (menurut saya) untuk melakukan hal yang sama seperti Apple dengan keyboard. </font><font style="vertical-align: inherit;">Buat Jendela baru di atas layar saat ini. </font><font style="vertical-align: inherit;">Ayo lakukan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@UIApplicationMain</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDelegate</span>: <span class="hljs-title">UIResponder</span>, <span class="hljs-title">UIApplicationDelegate</span> </span>{<font></font>
<font></font>
	<span class="hljs-comment">//   –   . </span>
	<span class="hljs-comment">//              DI</span>
	<span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> errorWindow: <span class="hljs-type">UIWindow</span> = {
		<span class="hljs-keyword">let</span> alertWindow = <span class="hljs-type">UIWindow</span>.<span class="hljs-keyword">init</span>(frame: <span class="hljs-type">UIScreen</span>.main.bounds)<font></font>
		alertWindow.backgroundColor = .clear<font></font>
<font></font>
		<span class="hljs-comment">//  rootViewController,    present   viewController</span>
		<span class="hljs-keyword">let</span> viewController = <span class="hljs-type">UIViewController</span>()<font></font>
		viewController.view.backgroundColor = .clear<font></font>
		alertWindow.rootViewController = viewController<font></font>
<font></font>
		<span class="hljs-keyword">return</span> alertWindow<font></font>
	}()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buat lansiran baru yang dapat ditampilkan di atas segalanya:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AboveAllAlertController</span>: <span class="hljs-title">UIAlertController</span> </span>{
	<span class="hljs-keyword">var</span> alertWindow: <span class="hljs-type">UIWindow</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-type">AppDelegate</span>.alertWindow<font></font>
	}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">show</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">let</span> topWindow = <span class="hljs-type">UIApplication</span>.shared.windows.last
		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> topWindow = topWindow {<font></font>
			alertWindow.windowLevel = topWindow.windowLevel + <span class="hljs-number">1</span><font></font>
		}<font></font>
<font></font>
		alertWindow.makeKeyAndVisible()<font></font>
		alertWindow.rootViewController?.present(<span class="hljs-keyword">self</span>, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewWillDisappear</span><span class="hljs-params">(<span class="hljs-number">_</span> animated: Bool)</span></span> {
		<span class="hljs-keyword">super</span>.viewWillDisappear(animated)<font></font>
<font></font>
		alertWindow.isHidden = <span class="hljs-literal">true</span><font></font>
	}<font></font>
}</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertCreatable</span>: <span class="hljs-title">class</span> </span>{
    	<span class="hljs-comment">//      </span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(<span class="hljs-keyword">for</span> error: Error, aboveAll: Bool)</span></span> -&gt; <span class="hljs-type">UIAlertController</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertCreatable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">UIViewController</span> </span>{<font></font>
    	...<font></font>
    	<span class="hljs-comment">//     </span>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAlert</span><span class="hljs-params">(title: String?, message: String?, actions: [UIAlertAction], aboveAll: Bool)</span></span> -&gt; <span class="hljs-type">UIAlertController</span> {
    		<span class="hljs-keyword">let</span> alertViewController = aboveAll ?
    			<span class="hljs-type">AboveAllAlertController</span>(title: title, message: message, preferredStyle: .alert) :
    			<span class="hljs-type">UIAlertController</span>(title: title, message: message, preferredStyle: .alert)<font></font>
    		actions.forEach({ alertViewController.addAction($<span class="hljs-number">0</span>) })
    		<span class="hljs-keyword">return</span> alertViewController<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ErrorAlertPresentable</span>: <span class="hljs-title">class</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlertAboveAll</span><span class="hljs-params">(from error: Error)</span></span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// MARK: - Default implementation</span>
    <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ErrorAlertPresentable</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">ErrorAlertCreatable</span> &amp; <span class="hljs-title">UIViewController</span> </span>{
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlert</span><span class="hljs-params">(from error: Error)</span></span> {
    		<span class="hljs-keyword">let</span> alertVC = createAlert(<span class="hljs-keyword">for</span>: error, aboveAll: <span class="hljs-literal">false</span>)<font></font>
    		present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">presentAlertAboveAll</span><span class="hljs-params">(from error: Error)</span></span> {
    		<span class="hljs-keyword">let</span> alertVC = createAlert(<span class="hljs-keyword">for</span>: error, aboveAll: <span class="hljs-literal">true</span>)
    		<span class="hljs-comment">//         </span>
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> alertVC = alertVC <span class="hljs-keyword">as</span>? <span class="hljs-type">AboveAllAlertController</span> {<font></font>
    			alertVC.show()<font></font>
    			<span class="hljs-keyword">return</span><font></font>
    		}<font></font>
    		<span class="hljs-comment">//    ,  - </span>
    		<span class="hljs-built_in">assert</span>(<span class="hljs-literal">false</span>, <span class="hljs-string">"Should create AboveAllAlertController"</span>)<font></font>
    		present(alertVC, animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)<font></font>
    	}<font></font>
    }</code></pre><br>
<img src="https://habrastorage.org/webt/qr/es/uo/qresuobexdwaxevl3gnmsfjsc6i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara tampilan, tidak ada yang berubah, tetapi sekarang kami telah menyingkirkan hierarki pengontrol tampilan. </font><font style="vertical-align: inherit;">Saya sangat merekomendasikan untuk tidak terbawa oleh kesempatan ini. </font><font style="vertical-align: inherit;">Lebih baik memanggil kode tampilan di router atau entitas dengan hak yang sama. </font><font style="vertical-align: inherit;">Atas nama transparansi dan kejelasan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memberi pengguna alat yang hebat untuk mengirim spam ke server selama kegagalan fungsi, pemeliharaan, dll. </font><font style="vertical-align: inherit;">Apa yang bisa kita tingkatkan?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Waktu permintaan minimum</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan kita mematikan Internet dan coba lagi. </font><font style="vertical-align: inherit;">Jalankan loader. </font><font style="vertical-align: inherit;">Jawabannya akan datang secara instan dan mendapatkan mini-game "Clicker". </font><font style="vertical-align: inherit;">Dengan animasi yang berkedip. </font><font style="vertical-align: inherit;">Tidak terlalu baik. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/3n/mu/uz3nmu7_ag_k4swmsiy8gw2y1z0.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita ubah kesalahan instan menjadi sebuah proses. </font><font style="vertical-align: inherit;">Idenya sederhana - kami akan membuat waktu permintaan minimum. </font><font style="vertical-align: inherit;">Di sini implementasinya tergantung pada pendekatan Anda terhadap jaringan. </font><font style="vertical-align: inherit;">Misalkan saya menggunakan Operasi, dan bagi saya tampilannya seperti ini:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DelayOperation</span>: <span class="hljs-title">AsyncOperation</span> </span>{
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> _delayTime: <span class="hljs-type">Double</span><font></font>
<font></font>
	<span class="hljs-keyword">init</span>(delayTime: <span class="hljs-type">Double</span> = <span class="hljs-number">0.3</span>) {<font></font>
		_delayTime = delayTime<font></font>
	}<font></font>
	<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">super</span>.main()<font></font>
<font></font>
		<span class="hljs-type">DispatchQueue</span>.global().asyncAfter(deadline: .now() + _delayTime) {
			<span class="hljs-keyword">self</span>.state = .finished<font></font>
		}<font></font>
	}<font></font>
}<font></font>
		<font></font>
<span class="hljs-comment">// -  </span>
<span class="hljs-keyword">let</span> flowListOperation = flowService.list(<span class="hljs-keyword">for</span>: pageID, path: path, limiter: limiter)
<span class="hljs-keyword">let</span> handler = createHandler(<span class="hljs-keyword">for</span>: flowListOperation)
<span class="hljs-keyword">let</span> delayOperation = <span class="hljs-type">DelayOperation</span>(delayTime: <span class="hljs-number">0.5</span>)
<span class="hljs-comment">///  &gt;&gt;&gt;  addDependency. </span><font></font>
[flowListOperation, delayOperation] &gt;&gt;&gt; handler<font></font>
operationQueue.addOperations([flowListOperation, delayOperation, handler])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk kasus umum, saya dapat menawarkan desain ini:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//  global      </span>
<span class="hljs-type">DispatchQueue</span>.global().asyncAfter(deadline: .now() + <span class="hljs-number">0.15</span>) {
    <span class="hljs-comment">// your code here</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atau kita dapat membuat abstraksi atas tindakan asinkron kami dan menambahkan pengelolaan ke dalamnya:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Task</span> </span>{
    	<span class="hljs-keyword">let</span> closure: () -&gt; <span class="hljs-type">Void</span><font></font>
    <font></font>
    	<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _delayTime: <span class="hljs-type">Double?</span><font></font>
    <font></font>
    	<span class="hljs-keyword">init</span>(closure: @escaping () -&gt; <span class="hljs-type">Void</span>) {
    		<span class="hljs-keyword">self</span>.closure = closure<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-keyword">fileprivate</span> <span class="hljs-keyword">init</span>(closure: @escaping () -&gt; <span class="hljs-type">Void</span>, time: <span class="hljs-type">Double</span>) {
    		<span class="hljs-keyword">self</span>.closure = closure<font></font>
    		_delayTime = time<font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-meta">@discardableResult</span>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> delayTime = _delayTime {
    			<span class="hljs-type">DispatchQueue</span>.global().asyncAfter(deadline: .now() + delayTime) {
    				<span class="hljs-keyword">self</span>.closure()<font></font>
    			}<font></font>
    			<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><font></font>
    		}<font></font>
    		closure()<font></font>
    		<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><font></font>
    	}<font></font>
    <font></font>
    	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">delayedTask</span><span class="hljs-params">(time: Double)</span></span> -&gt; <span class="hljs-type">Self</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">Task</span>(closure: closure, time: time)<font></font>
    	}<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestObject</span><span class="hljs-params">(completionHandler: @escaping <span class="hljs-params">(<span class="hljs-params">(Result&lt;Bool, Error&gt;)</span></span></span></span> -&gt; <span class="hljs-type">Void</span>)) -&gt; <span class="hljs-type">Task</span> {
    		<span class="hljs-keyword">return</span> <span class="hljs-type">Task</span> {<font></font>
    			completionHandler(.failure(<span class="hljs-type">NetworkError</span>.internetError))<font></font>
    		}<font></font>
    			.delayedTask(time: <span class="hljs-number">0.5</span>)<font></font>
    		.run()<font></font>
    	}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang animasi kita tidak akan tampak begitu tajam, bahkan ketika sedang offline. </font><font style="vertical-align: inherit;">Saya sarankan menggunakan pendekatan ini di sebagian besar tempat dengan animasi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9k/oq/46/9koq46qq0wffoivy0ucs18om1cm.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mode pesawat, ada baiknya menampilkan prompt peringatan (pengguna bisa lupa mematikan mode untuk mulai bekerja dengan aplikasi). </font><font style="vertical-align: inherit;">Seperti, katakanlah, membuat telegram. </font><font style="vertical-align: inherit;">Dan untuk pertanyaan penting, ada baiknya mengulang beberapa kali di bawah tenda sebelum menunjukkan peringatan ... Tapi lebih banyak tentang itu lain kali :)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testabilitas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika semua logika dibuang di viewController (seperti yang kita miliki sekarang), sulit untuk menguji. </font><font style="vertical-align: inherit;">Namun, jika viewController Anda dibagikan dengan logika bisnis, pengujian menjadi tugas yang sepele. </font><font style="vertical-align: inherit;">Dengan jentikan </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">celana</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lengan </font><s><font style="vertical-align: inherit;">,</font></s><font style="vertical-align: inherit;"> logika bisnis berubah menjadi:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestFeed</span><span class="hljs-params">()</span></span> {<font></font>
		service.requestObject { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (result) <span class="hljs-keyword">in</span>
			<span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> `<span class="hljs-keyword">self</span>` = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
			<span class="hljs-keyword">switch</span> result {
			<span class="hljs-keyword">case</span> .success:
				<span class="hljs-keyword">break</span>
			<span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):
				<span class="hljs-type">DispatchQueue</span>.main.async {
					<span class="hljs-keyword">let</span> recoverableError = <span class="hljs-type">RecoverableError</span>(error: error, attempter: .tryAgainAttempter(block: {
						<span class="hljs-keyword">self</span>.requestFeed()<font></font>
					}))<font></font>
					<span class="hljs-comment">//     </span>
					<span class="hljs-keyword">self</span>.viewInput?.presentAlert(from: recoverableError)<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	}</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-comment">// -  </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testRequestFeedFailed</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// Put out mock that conform to AlertPresntable protocol</span>
	controller.viewInput = <span class="hljs-type">ViewInputMock</span>()<font></font>
<font></font>
	<span class="hljs-comment">//  .    ,    </span>
	<span class="hljs-comment">//    expectation</span><font></font>
	controller.requestFeed()<font></font>
<font></font>
	<span class="hljs-comment">// Our mocked object should save to true to bool variable when method called</span>
	<span class="hljs-type">XCTAssert</span>(controller.viewInput.presentAlertCalled)
	<span class="hljs-comment">// Next we could compare recoverable error attempter to expected attempter</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bersama dengan artikel ini kita:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat mekanisme yang nyaman untuk menampilkan peringatan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memberi pengguna opsi untuk mencoba kembali operasi yang gagal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan mencoba meningkatkan pengalaman pengguna dengan aplikasi kami</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan ke kode</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Terima kasih atas waktu Anda, dengan senang hati saya akan menjawab pertanyaan Anda di komentar.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495336/index.html">Perselisihan sebagai messenger perusahaan dan bukan hanya</a></li>
<li><a href="../id495338/index.html">Praktik dan pedoman terbaik untuk meluncurkan kontainer dan Kubernet di lingkungan produksi</a></li>
<li><a href="../id495340/index.html">Cara mengubah pekerjaan administrator di restoran untuk pekerjaan yang baik di bidang TI</a></li>
<li><a href="../id495342/index.html">Penyelesaian kartu bank dalam perdagangan - membuat dataset terbuka dan infografis di Google Data Studio</a></li>
<li><a href="../id495344/index.html">Menyatukannya: bagaimana Lamoda membuat layanan Go-nya konsisten</a></li>
<li><a href="../id499818/index.html">Pemasaran Telegram Uzbek</a></li>
<li><a href="../id499820/index.html">Mengapa kami memilih Kotlin sebagai salah satu bahasa target kami. Bagian 2: Kotlin Multiplatform</a></li>
<li><a href="../id499822/index.html">Titik akses nirkabel vs router: apa perbedaannya?</a></li>
<li><a href="../id499824/index.html">Intisari acara untuk perekrut SDM dan TI pada Mei 2020</a></li>
<li><a href="../id499826/index.html">Tekanan darah terdistribusi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>