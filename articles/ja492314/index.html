<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛰️ 🛅 👩‍👧‍👧 スマートホーム：Home Assistantで水道と電気のグラフを作成する 🤲🏽 👨🏾‍🏭 🤰🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="電気と水道の請求書を受け取るたびに、家族は本当にそんなに多くを消費しているのでしょうか。ええ、そうです。バスルームには床暖房とボイラーがありますが、それらは常に動きません。私たちは水を節約するようにも見えます（浴室での水しぶきも大好きですが）。数年前、私はすでに水道メーターと電気メーターをスマートホ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>スマートホーム：Home Assistantで水道と電気のグラフを作成する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/lf/i3/wjlfi38qar57vvhqgpwuzdalerw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
電気と水道の請求書を受け取るたびに、家族は本当にそんなに多くを消費しているのでしょうか。ええ、そうです。バスルームには床暖房とボイラーがありますが、それらは常に動きません。私たちは水を節約するようにも見えます（浴室での水しぶきも大好きですが）。数年前、私はすでに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水道メーター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電気</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">メーター</font></a><font style="vertical-align: inherit;">をスマートホームに接続していましたが、これにこだわっていました。手が消費の分析にたどり着いたのはたった今であり、それについて、実際、この記事についてです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、スマートホームシステムとしてHome Assistantに切り替えました。その理由の1つは、さまざまな種類のグラフを簡単に作成できる可能性がある大量のデータの収集を整理する機会にすぎませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で説明する情報は新しいものではなく、さまざまなソースを使用したこれらすべてのものがインターネットですでに説明されています。</font><font style="vertical-align: inherit;">しかし、各記事は、原則として、1つのアプローチまたは側面のみを説明しています。</font><font style="vertical-align: inherit;">私はこれらすべてのアプローチを比較し、自分で最も適切なものを選択する必要がありました。</font><font style="vertical-align: inherit;">この記事はまだデータ収集に関する包括的な情報を提供していませんが、それは私が行った方法の概要の一種です。</font><font style="vertical-align: inherit;">建設的な批判と改善のための提案を歓迎します。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題の定式化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、今日の演習の目標は、水と電力消費の美しいグラフを取得することです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">毎時2日間</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2週間毎日</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（オプション）毎週および毎月</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、いくつかの困難が待ち受けています。</font></font><br>
<br>
<ul>
<li>  ,  ,  .         . <br>
<br>
  ,     ,     .  home assistant,  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">mini-graph-card</a>,     :<br>
<br>
<ul>
<li>        (     ,         )</li>
<li>       (   ,      )</li>
</ul></li>
<li> ,  home assistant        SQLite <s>( , ,    MySQL  Postgres)</s>,        . , ,               json   <br>
<br>
<pre><code class="json hljs">{<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"old_state"</span>: {<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"state"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-attr">"attributes"</span>: {<span class="hljs-attr">"source"</span>: <span class="hljs-string">"sensor.water_meter_cold"</span>, <span class="hljs-attr">"status"</span>: <span class="hljs-string">"collecting"</span>, <span class="hljs-attr">"last_period"</span>: <span class="hljs-string">"29"</span>, <span class="hljs-attr">"last_reset"</span>: <span class="hljs-string">"2020-02-23T21:00:00.022246+02:00"</span>, <span class="hljs-attr">"meter_period"</span>: <span class="hljs-string">"hourly"</span>, <span class="hljs-attr">"unit_of_measurement"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-attr">"friendly_name"</span>: <span class="hljs-string">"water_cold_hourly"</span>, <span class="hljs-attr">"icon"</span>: <span class="hljs-string">"mdi:counter"</span>}, <span class="hljs-attr">"last_changed"</span>: <span class="hljs-string">"2020-02-23T19:05:06.897604+00:00"</span>, <span class="hljs-attr">"last_updated"</span>: <span class="hljs-string">"2020-02-23T19:05:06.897604+00:00"</span>, <span class="hljs-attr">"context"</span>: {<span class="hljs-attr">"id"</span>: <span class="hljs-string">"aafc8ca305ba4e49ad4c97f0eddd8893"</span>, <span class="hljs-attr">"parent_id"</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">"user_id"</span>: <span class="hljs-literal">null</span>}}, <span class="hljs-attr">"new_state"</span>: {<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"state"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-attr">"attributes"</span>: {<span class="hljs-attr">"source"</span>: <span class="hljs-string">"sensor.water_meter_cold"</span>, <span class="hljs-attr">"status"</span>: <span class="hljs-string">"collecting"</span>, <span class="hljs-attr">"last_period"</span>: <span class="hljs-string">"29"</span>, <span class="hljs-attr">"last_reset"</span>: <span class="hljs-string">"2020-02-23T21:00:00.022246+02:00"</span>, <span class="hljs-attr">"meter_period"</span>: <span class="hljs-string">"hourly"</span>, <span class="hljs-attr">"unit_of_measurement"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-attr">"friendly_name"</span>: <span class="hljs-string">"water_cold_hourly"</span>, <span class="hljs-attr">"icon"</span>: <span class="hljs-string">"mdi:counter"</span>}, <span class="hljs-attr">"last_changed"</span>: <span class="hljs-string">"2020-02-23T19:11:11.251545+00:00"</span>, <span class="hljs-attr">"last_updated"</span>: <span class="hljs-string">"2020-02-23T19:11:11.251545+00:00"</span>, <span class="hljs-attr">"context"</span>: {<span class="hljs-attr">"id"</span>: <span class="hljs-string">"0de64b8af6f14bb9a419dcf3b200ef56"</span>, <span class="hljs-attr">"parent_id"</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">"user_id"</span>: <span class="hljs-literal">null</span>}}}</code></pre><br>
     (    ,    ),         .      SDM220      10-15 ,         8.      ,      . ..         100-200  .      ,      (    home assistant  raspberry PI),            .</li>
<li>  ,      .           <s> </s>   .           (RS232/RS485/Modbus/Zigbee)   .<br>
<br>
         (    ),      X -  .            .         ,        . , ,        home assistant,          ,             (  home assistant).</li>
</ul><br>
<h2> 1</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、箱から出してすぐに提供されるホームアシスタントを見てみましょう。一定期間の消費を測定することは、非常に要求される機能です。もちろん、それはずっと前に、特殊なコンポーネント（utility_meter）の形で実現されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネントの本質は、内部で変数current_accumulated_valueを開始し、指定された期間（時間/週/月）後にそれをリセットすることです。コンポーネント自体は受信変数（ある種のセンサーの値）を監視し、値自体の変更をサブスクライブします-完成した結果を取得するだけです。このことは、構成ファイルのほんの数行で説明されています。</font></font><br>
<br>
<pre><code class="python hljs">utility_meter:<font></font>
  water_cold_hour_um:<font></font>
    source: sensor.water_meter_cold<font></font>
    cycle: hourly<font></font>
  water_cold_day_um:<font></font>
    source: sensor.water_meter_cold<font></font>
    cycle: daily<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、sensor.water_meter_coldは、カウンターの現在の値（リットル）です。これは</font><font style="vertical-align: inherit;">、mqttによって鉄片</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から直接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">さ</font></a><font style="vertical-align: inherit;">れます。このデザインでは、2つの新しいセンサーwater_cold_hour_umとwater_cold_day_umを作成します。これらは、毎時と毎日の読み取り値を累積し、一定期間後にそれらをリセットします。これは30分バッテリーチャートです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/le/u3/fk/leu3fkbgddojjis_lmcawt6gcv4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lovelace-UIの毎時および毎日のチャートコードは次のようになります。</font></font><br>
<br>
<pre><code class="python hljs">      - type: history-graph<font></font>
        title: <span class="hljs-string">'Hourly water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">48</span><font></font>
        entities:<font></font>
          - sensor.water_hour<font></font>
<font></font>
      - type: history-graph<font></font>
        title: <span class="hljs-string">'Daily water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">360</span><font></font>
        entities:<font></font>
          - sensor.water_day<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、このアプローチの問題はこのアルゴリズムにあります。前述のように、各入力値（次の1リットルごとの現在のメーターの読み取り値）に対して、1 kbのレコードがデータベースに生成されます。各ユーティリティメーターは新しい値も生成し、これもデータベースに追加されます。毎時/毎日/毎週/毎月の測定値を収集したい場合、およびいくつかのウォーターライザーについて、さらには電気メーターの束を追加したい場合-これは大量のデータになります。より正確には、データは多くありませんが、ホームアシスタントがデータベースに不必要な情報を大量に書き込むため、データベースのサイズは飛躍的に大きくなります。毎週と毎月のチャートのベースのサイズを見積もることは恐ろしいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ユーティリティメーターだけでは問題を解決できません。</font><font style="vertical-align: inherit;">ユーティリティメーターが提供する値のグラフは、1時間ごとに0にリセットされる単調増加関数です。</font><font style="vertical-align: inherit;">ユーザーフレンドリーな消費チャート、つまり期間中に何リットルが消費されたかが必要です。</font><font style="vertical-align: inherit;">標準の履歴グラフコンポーネントはこれを行う方法を知りませんが、外部のミニグラフカードコンポーネントが役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはlovelace-UIのカードコードです。</font></font><br>
<br>
<pre><code class="python hljs">      - aggregate_func: max<font></font>
        entities:<font></font>
          - color: var(--primary-color)<font></font>
            entity: sensor.water_cold_hour_um<font></font>
        group_by: hour<font></font>
        hours_to_show: <span class="hljs-number">48</span>
        name: <span class="hljs-string">"Hourly water consumption aggregated by utility meter"</span>
        points_per_hour: <span class="hljs-number">1</span><font></font>
        show:<font></font>
          graph: bar<font></font>
        type: <span class="hljs-string">'custom:mini-graph-card'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
センサーの名前、グラフのタイプ、色（標準のオレンジは好きではなかった）などの標準設定に加えて、3つの設定に注意することが重要です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">group_by：hour-チャートは時間の初めに列が揃えられて生成されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">points_per_hour：1-1時間ごとに1つのバー</font></font></li>
<li>  , aggregate_func: max —       .         </li>
</ul><br>
<img src="https://habrastorage.org/webt/yj/du/c7/yjduc7nhxnq18qvcityd_ul91y0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
左側の列の数には注意しないでください。これは、データがない場合のコンポーネントの標準的な動作です。データはありませんでした。この記事のために、数時間前にユーティリティメーターのデータ収集をオンにしただけです（現在のアプローチについては、少し後で説明します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この画像では、データ表示が機能することもあり、バーが実際に正しい値を反映していることを示したいと思いました。しかし、それだけではありません。何らかの理由で午前11時から12時までの期間に選択された列は19リットルを表示しますが、歯がためのチャートでは同じ期間に少し高く、同じセンサーからの62リットルの消費が見られます。バグか手が曲がっています。しかし、右側のデータが途切れた理由がわかりません。そこでの消費は正常でした。これは、歯の粗いスケジュールでも確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、私はこのアプローチの信頼性をどうにかして達成できませんでした-グラフはほとんど常にある種の異端を示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
日センサーの同じコード。</font></font><br>
<br>
<pre><code class="python hljs">      - aggregate_func: max<font></font>
        entities:<font></font>
          - color: var(--primary-color)<font></font>
            entity: sensor.water_cold_day_um<font></font>
        group_by: interval<font></font>
        hours_to_show: <span class="hljs-number">360</span>
        name: <span class="hljs-string">"Daily water consumption aggregated by utility meter"</span>
        points_per_hour: <span class="hljs-number">0.0416666666</span><font></font>
        show:<font></font>
          graph: bar<font></font>
        type: <span class="hljs-string">'custom:mini-graph-card'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
group_byパラメータはintervalに設定され、points_per_hourパラメータはすべてをルール化することに注意してください。</font><font style="vertical-align: inherit;">そして、これはこのコンポーネントのもう1つの問題です。points_per_hourは1時間以内のグラフではうまく機能しますが、間隔が広いので嫌です。</font><font style="vertical-align: inherit;">したがって、1日に1つの列を取得するには、値1/24 = 0.04166666を入力する必要がありました。</font><font style="vertical-align: inherit;">私は毎週と毎月のチャートについて話しているのではありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプローチ2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホームアシスタントを理解するだけで、このビデオをここで見つけました。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-0HrYFCRH0M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
友人がいくつかのタイプのXiaomiコンセントから消費データを収集します。彼の仕事は少し簡単です-今日、昨日、そしてその月の消費の値を表示するだけです。スケジュールは必要ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
瞬時電力値の手動統合についての議論はさておき、このアプローチの「正確さ」についてはすでに書きました。同じコンセントですでに収集されている累積消費値を使用しなかった理由は明らかではありません。私の意見では、鉄片の内部の統合はうまく機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオから、期間の消費量を手動で計算するという考えを取り入れています。農民は今日と昨日の値だけを数えますが、さらに進んでグラフを描こうとします。私の場合の提案手法の本質は以下の通りです。</font></font><br>
<br>
<ul>
<li>  ___,      </li>
<li>     (   )          .         —    ,         . </li>
<li>  “”  ___     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはすべて、</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w ...</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホームアシスタント自身の手段で</font><font style="vertical-align: inherit;">行うことができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のアプローチよりも多くのコードを記述する必要があります。</font><font style="vertical-align: inherit;">まず、これらの「変数」を取得しましょう。</font><font style="vertical-align: inherit;">そのままでは「可変」エンティティはありませんが、mqttブローカーのサービスを使用できます。</font><font style="vertical-align: inherit;">ここで、retain = trueフラグを使用して値を送信します-これにより、ブローカー内の値が保存され、ホームアシスタントが再起動したときでもいつでも値を引き出すことができます。</font><font style="vertical-align: inherit;">私はすぐに時間と日のカウンターを作りました。</font></font><br>
<br>
<pre><code class="python hljs">- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/hour"</span><font></font>
  name: water_hour<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/hour_begin"</span><font></font>
  name: water_hour_begin<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/day"</span><font></font>
  name: water_day<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/day_begin"</span><font></font>
  name: water_day_begin<font></font>
  unit_of_measurement: l</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての魔法は、それぞれ毎時と毎晩実行される自動化で発生します。</font></font><br>
<br>
<pre><code class="python hljs">- id: water_new_hour<font></font>
  alias: water_new_hour<font></font>
  initial_state: true<font></font>
  trigger:<font></font>
    - platform: time_pattern<font></font>
      minutes: <span class="hljs-number">0</span><font></font>
  action:<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/hour"</span><font></font>
        payload_template: &gt;<font></font>
          {{ (states.sensor.water_meter_cold.state|int) - (states.sensor.water_hour_begin.state|int) }}<font></font>
        retain: true<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/hour_begin"</span><font></font>
        payload_template: &gt;<font></font>
          {{ states.sensor.water_meter_cold.state }}<font></font>
        retain: true<font></font>
<font></font>
- id: water_new_day<font></font>
  alias: water_new_day<font></font>
  initial_state: true<font></font>
  trigger:<font></font>
    - platform: time<font></font>
      at: <span class="hljs-string">"00:00:00"</span><font></font>
  action:<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/day"</span><font></font>
        payload_template: &gt;<font></font>
          {{ (states.sensor.water_meter_cold.state|int) - (states.sensor.water_day_begin.state|int) }}<font></font>
        retain: true<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/day_begin"</span><font></font>
        payload_template: &gt;<font></font>
          {{ states.sensor.water_meter_cold.state }}<font></font>
        retain: true</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらのオートメーションも2つのアクションを実行します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">間隔の値は、開始値と終了値の差として計算されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の間隔のベース値を更新します</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合のグラフ化は、通常の履歴グラフによって解決されます。</font></font><br>
<br>
<pre><code class="python hljs">      - type: history-graph<font></font>
        title: <span class="hljs-string">'Hourly water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">48</span><font></font>
        entities:<font></font>
          - sensor.water_hour<font></font>
<font></font>
      - type: history-graph<font></font>
        title: <span class="hljs-string">'Daily water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">360</span><font></font>
        entities:<font></font>
          - sensor.water_day</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/nn/ah/rpnnahsspezbcydtjmhlu6kb53w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、これはすでに必要なものです。</font><font style="vertical-align: inherit;">この方法の利点は、データが間隔ごとに1回生成されることです。</font><font style="vertical-align: inherit;">それら。</font><font style="vertical-align: inherit;">時間別チャートでは、1日あたり24エントリのみです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、これは依然として成長する基地の一般的な問題を解決しません。</font><font style="vertical-align: inherit;">毎月の消費スケジュールが必要な場合、少なくとも1年間データを保存する必要があります。</font><font style="vertical-align: inherit;">また、ホームアシスタントはデータベース全体の保存期間に対して1つの設定しか提供しないため、システム内のすべてのデータを1年間保存する必要があります。</font><font style="vertical-align: inherit;">たとえば、1年間、200立方メートルの水を消費しています。つまり、データベースでは200,000レコードです。</font><font style="vertical-align: inherit;">そして、他のセンサーを考慮に入れると、その数字はまったく卑猥になります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプローチ3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いなことに、賢い人々はすでにInfluxDBデータベースを作成することでこの問題を解決しています。このデータベースは、時間ベースのデータを保存するために特別に最適化されており、さまざまなセンサーの値を保存するのに最適です。システムはSQLのようなクエリ言語も提供し、データベースから値を取り出して、さまざまな方法でそれらを集計できます。最後に、異なるデータを異なる時間に保存できます。たとえば、頻繁に変化する温度や湿度などの測定値は数週間しか保存できませんが、水の消費量の毎日の測定値は1年間保存できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
賢い人々は、InfluxDBに加えて、InfluxDBからのデータに基づいたグラフ作成システムであるGrafanaも発明しました。</font><font style="vertical-align: inherit;">Grafanaは、さまざまなタイプのグラフを描画し、それらを詳細にカスタマイズできます。最も重要なのは、これらのグラフがlovelace-UIホームアシスタントに「スタック」される可能性があることです。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ここ</font></a><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ここ</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
からインスピレーションを得</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらの記事では、InfluxDBとGrafanaをインストールしてホームアシスタントに接続するプロセスについて詳しく説明しています。</font><font style="vertical-align: inherit;">特定の問題の解決に焦点を当てます。</font><font style="vertical-align: inherit;">
それでは、まず、influxDBのカウンター値を追加していきましょう。</font><font style="vertical-align: inherit;">ホームアシスタント構成の一部（この例では、冷水だけでなく温水も楽しんでいます）：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">influxdb:<font></font>
  host: localhost<font></font>
  max_retries: <span class="hljs-number">3</span><font></font>
  default_measurement: state<font></font>
  database: homeassistant<font></font>
  include:<font></font>
    entities:<font></font>
      - sensor.water_meter_hot<font></font>
      - sensor.water_meter_cold</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じデータをホームアシスタントの内部データベースに保存しないようにして、もう一度膨らまないようにします。</font></font><br>
<br>
<pre><code class="python hljs">recorder:<font></font>
  purge_keep_days: <span class="hljs-number">10</span>
  purge_interval: <span class="hljs-number">1</span><font></font>
  exclude:<font></font>
    entities:<font></font>
      - sensor.water_meter_hot<font></font>
      - sensor.water_meter_cold</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、InfluxDBコンソールに移動してデータベースをセットアップします。特に、このデータまたはそのデータが保存される期間を構成する必要があります。これは、いわゆる保持ポリシー-これはメインデータベース内のデータベースに似ており、内部データベースごとに独自の設定があります。デフォルトでは、すべてのデータはautogenという保存ポリシーに保存され、このデータは1週間保存されます。時間ごとのデータを1か月間、週ごとに1年間保存し、月ごとのデータは絶対に削除しないでください。適切な保持ポリシーを作成する</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"month"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> <span class="hljs-number">30</span>d <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"year"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> <span class="hljs-number">52</span>w <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"infinite"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> INF <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、実際には、主要なトリックは、連続クエリを使用したデータ集計です。</font><font style="vertical-align: inherit;">これは、指定された間隔でクエリを自動的に開始し、このクエリのデータを集計し、結果を新しい値に追加するメカニズムです。</font><font style="vertical-align: inherit;">例を見てみましょう（読みやすくするために列に書き込みますが、実際にはこのコマンドを1行で入力する必要がありました）。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> CONTINUOUS <span class="hljs-keyword">QUERY</span> cq_water_hourly <span class="hljs-keyword">ON</span> homeassistant 
<span class="hljs-keyword">BEGIN</span> 
  <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">value</span> 
  <span class="hljs-keyword">INTO</span> homeassistant.month.water_meter_hour 
  <span class="hljs-keyword">FROM</span> homeassistant.autogen.l 
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>h), entity_id fill(previous) 
<span class="hljs-keyword">END</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンド：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">homeassistantデータベースにcq_water_cold_hourlyという名前の連続クエリを作成します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストは1時間ごとに実行されます（時間（1h））</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストは、冷水と温水の測定値を含む、測定値のhomeassistant.autogen.l（リットル）からすべてのデータを取得します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集約されたデータはentity_idでグループ化され、冷水と温水に個別の値が作成されます。</font></font></li>
<li>               ,      max(value) </li>
<li>     homeassistant.month.water_meter_hour,  month   retention policy     .               entity_id     value</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
夜間または自宅に誰もいないときは水の消費がないため、homeassistant.autogen.lにも新しいエントリはありません。通常のクエリで欠損値を回避するには、fill（前）を使用できます。これにより、InfluxDBは過去1時間の値を使用するようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、連続クエリには特殊性があります。フィル（以前の）トリックは機能せず、レコードは作成されません。さらに、これは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1年以上議論され</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">てきたいくつかの克服できない問題です</font><font style="vertical-align: inherit;">。後でこの問題に対処し、継続的なクエリの（前の）塗りつぶしを可能にします-干渉しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が起こったかを確認しましょう（もちろん、数時間待つ必要があります）：</font></font><br>
<br>
<pre><code class="python hljs">&gt; select * <span class="hljs-keyword">from</span> homeassistant.month.water_meter_hour group by entity_id<font></font>
...<font></font>
name: water_meter_hour<font></font>
tags: entity_id=water_meter_cold<font></font>
time                 value<font></font>
----                 -----<font></font>
...<font></font>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T01:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370511</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T02:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370513</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T05:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370527</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T06:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370605</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T07:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370635</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T08:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370699</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T09:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370761</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T10:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370767</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T11:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370810</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T12:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370818</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T13:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370827</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T14:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370849</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T15:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370921</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベース内の値はUTCで保存されているため、このリストでは3時間の差があることに注意してください。InfluxDBの出力の午前7時の値は、上記のグラフの午前10時の値に対応しています。</font><font style="vertical-align: inherit;">また、午前2時から5時の間は、単にレコードがないことに注意してください。これは、連続クエリの同じ機能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、集計値も単調に増加するシーケンスであり、レコードのみが頻度が低くなります（1時間に1回）。</font><font style="vertical-align: inherit;">しかし、これは問題ではありません。チャートの正しいデータを生成する別のクエリを作成できます。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">difference</span>(<span class="hljs-keyword">max</span>(<span class="hljs-keyword">value</span>)) 
<span class="hljs-keyword">FROM</span> homeassistant.month.water_meter_hour 
<span class="hljs-keyword">WHERE</span> entity_id=<span class="hljs-string">'water_meter_cold'</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">time</span> &gt;= <span class="hljs-keyword">now</span>() <span class="hljs-number">-24</span>h 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>h), entity_id <font></font>
fill(previous)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解読します：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">homeassistant.month.water_meter_hourデータベースから、最終日のentity_id = 'water_meter_cold'のデータを抽出します（time&gt; = now（）-24h）。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンスhomeassistant.month.water_meter_hourで説明したように、一部のエントリが欠落している可能性があります。</font><font style="vertical-align: inherit;">GROUP BY時間（1時間）でクエリを実行して、このデータを再生成します。</font><font style="vertical-align: inherit;">今回の塗りつぶし（前の）は必要に応じて機能し、欠落データを生成します（関数は前の値を取ります）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このリクエストで最も重要なのは、毎時のマーク間の差を計算する差分関数です。</font><font style="vertical-align: inherit;">それ自体では機能せず、集約関数が必要です。</font><font style="vertical-align: inherit;">以前に使用したmax（）にします。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行結果は次のようになります</font></font><br>
<br>
<pre><code class="python hljs">name: water_meter_hour<font></font>
tags: entity_id=water_meter_cold<font></font>
time                 difference<font></font>
----                 ----------<font></font>
...<font></font>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T02:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">2</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T03:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">0</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T04:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">0</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T05:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">14</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T06:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">78</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T07:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">30</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T08:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">64</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T09:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">62</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T10:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">6</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T11:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">43</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T12:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">8</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T13:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">9</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T14:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">22</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T15:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">72</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
午前2時から5時（UTC）には、消費はありませんでした。</font><font style="vertical-align: inherit;">それでも、クエリは、fill（前）により同じ消費値を返し、差分関数はそれ自体からこの値を減算し、実際に必要な出力で0を取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残っているのは、スケジュールを作成することだけです。</font><font style="vertical-align: inherit;">これを行うには、Grafanaを開き、既存の（または新しい）ダッシュボードを開き、新しいパネルを作成します。</font><font style="vertical-align: inherit;">チャート設定はこんな感じになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ux/q0/c8/uxq0c834j1eq4h7ey4qazk4cc7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
冷水と温水のデータを1つのグラフに表示します。</font><font style="vertical-align: inherit;">リクエストは上記で説明したものとまったく同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表示パラメータは以下のように設定します。</font><font style="vertical-align: inherit;">階段で折れ線グラフを作成します。</font><font style="vertical-align: inherit;">すぐ下のStackパラメータについて説明します。</font><font style="vertical-align: inherit;">以下にいくつかの表示オプションがありますが、それほど興味深いものではありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/rd/5x/bird5xpaysckqtigczjerbp5mti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受信したスケジュールをHome Assistantに追加するには、以下が必要です。</font></font><br>
<br>
<ul>
<li>    . -         </li>
<li>     ,    share</li>
<li>      embed</li>
<li>  current time range —       URL </li>
<li>  .     light</li>
<li>  URL    lovelace-UI</li>
</ul><br>
<pre><code class="python hljs">      - type: iframe<font></font>
        id: graf_water_hourly<font></font>
        url: <span class="hljs-string">"http://192.168.10.200:3000/d-solo/rZARemQWk/water?orgId=1&amp;panelId=2&amp;from=now-2d&amp;to=now&amp;theme=light"</span>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時間範囲（過去2日間）はダッシュボードの設定ではなく、ここで設定されることに注意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフはこんな感じ。過去2日間は温水を使用していなかったため、冷水のグラフのみが描かれています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/e7/hk/mse7hkckiwjjm_b5ppli9dakd2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自分が一番好きなスケジュール、ステップライン、実際のバーを自分で決めることはしませんでした。そのため、今回は列でのみ、1日の消費量チャートの例を示します。リクエストは上記と同じ方法で作成されます。表示パラメータは次のとおりです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ns/se/jt/nssejtoburugxcldedjuj0cvywm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このグラフは次のようになり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zd/yl/hj/zdylhjfnrdonlnkezr3n4dlwdwm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。スタックパラメータについてです。このグラフでは、冷水の柱が温水の柱の上に描かれています。全高は、期間中の冷水と温水の総消費量に対応します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表示されるすべてのグラフは動的です。関心のあるポイントにマウスを置くと、特定のポイントの詳細と値を確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、数杯のタールはできませんでした。棒グラフでは（ステップラインのあるグラフとは対照的に）、棒の中央は1日の中央ではなく、00：00にあります。それら。列の左半分は前日の代わりに描画されます。したがって、土曜日と日曜日のチャートは、青みがかったゾーンよりも少し左側に描かれています。勝つ方法がわかるまで。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の問題は、毎月の間隔で正しく動作できないことです。</font><font style="vertical-align: inherit;">事実は、時間/日/週の長さは固定されていますが、月の長さは毎回異なります。</font><font style="vertical-align: inherit;">InfluxDBは定期的にしか機能しません。</font><font style="vertical-align: inherit;">これまでのところ、私の脳は30日の固定間隔を設定するのに十分でした。</font><font style="vertical-align: inherit;">はい、グラフは年間を通じて少し変動し、列は月に正確に対応しません。</font><font style="vertical-align: inherit;">しかし、これは単にディスプレイデバイスとしては興味深いので、それで十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少なくとも2つの解決策があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">毎月のスケジュールでスコアを付け、毎週に制限します。</font><font style="vertical-align: inherit;">年間52週間のバーはかなり良さそうです</font></font></li>
<li>     №2,       .     .          —    .</li>
</ul><br>
<br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理由はわかりませんが、このようなグラフを探しています。彼らは人生が本格化し、すべてが変化していることを示しています。昨日はたくさんでした、今日は十分ではありません、明日は他の何かになります。消費の問題については、世帯と協力する必要があります。しかし、現在の食欲があったとしても、支払いにおける大きくて理解できない数字はすでにかなり明確な消費の姿に変わっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラマーとしてのほぼ20年のキャリアにもかかわらず、私はデータベースと交差しませんでした。したがって、外部データベースのインストールは、非常に厄介で理解しにくいもののように見えました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前述の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によってすべてが変更され</font><font style="vertical-align: inherit;">ました。適切なツールを台無しにすることは数回のクリックで実行され、専用のツールを使用するとグラフ作成のタスクが少し簡単になることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見出しでは、消費電力について触れました。</font><font style="vertical-align: inherit;">残念ながら、現時点では1つのグラフを提供することはできません。</font><font style="vertical-align: inherit;">SDM120カウンターの1つは機能しておらず、もう1つはModbus経由でアクセスするときにバグがあります。</font><font style="vertical-align: inherit;">ただし、これはこの記事のトピックには影響しません。グラフィックは水と同じ方法で作成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、自分が試したアプローチを引用しました。</font><font style="vertical-align: inherit;">確かに、私が知らないデータの収集と視覚化を整理する他の方法がいくつかあります。</font><font style="vertical-align: inherit;">コメントで教えてください。とても興味深いです。</font><font style="vertical-align: inherit;">私は建設的な批評と新しいアイデアに喜んでいます。</font><font style="vertical-align: inherit;">提示された資料が誰かにも役立つことを願っています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja492298/index.html">Polygons Another World：IBM PC</a></li>
<li><a href="../ja492302/index.html">テスター向けのスマートフォンを備えたスマートスタンド-ITMO大学のアクセラレータからのスタートアッププロジェクト</a></li>
<li><a href="../ja492306/index.html">CESでのライダー</a></li>
<li><a href="../ja492308/index.html">ニューロンとそのモデリング</a></li>
<li><a href="../ja492312/index.html">KafkaでのAvroシリアル化</a></li>
<li><a href="../ja492318/index.html">コロナウイルスがIT業界に与える影響</a></li>
<li><a href="../ja492320/index.html">Covid-19、データサイエンスの観点から見たあなたの社会とあなた</a></li>
<li><a href="../ja492322/index.html">Raspberry Pi + Fedora（aarch64）= Wi-Fiホットスポット（または青い帽子のラズベリールーター）</a></li>
<li><a href="../ja492324/index.html">E2E暗号化の禁止につながる可能性のある新しい米国の法案であるEARN IT法について議論します</a></li>
<li><a href="../ja492326/index.html">Eurovision 2020参加者のYouTubeビデオの人気の分析</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>