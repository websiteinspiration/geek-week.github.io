<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äç‚úàÔ∏è ‚óΩÔ∏è ‚ò™Ô∏è Rake marche dans un champ propre ou comment collecter les adresses MAC des appareils Wi-Fi √† proximit√© üö£üèº üë©üèø‚Äç‚öïÔ∏è üë©‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je commence tous mes discours publics (heureusement, il n'y en a pas beaucoup) en mentionnant explicitement ou implicitement la th√®se ¬´Notre industrie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rake marche dans un champ propre ou comment collecter les adresses MAC des appareils Wi-Fi √† proximit√©</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503382/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je commence tous mes discours publics (heureusement, il n'y en a pas beaucoup) en mentionnant explicitement ou implicitement la th√®se ¬´Notre industrie est complexe, les probl√®mes peuvent √™tre r√©v√©l√©s √† n'importe quelle √©tape, m√™me la plus √©vidente, et il est optimiste de supposer que tout sera simple et facile - na√Øf¬ª . Curieusement, cette id√©e simple, obtenue par de nombreuses ann√©es de bourrage de c√¥nes, est parfois une r√©v√©lation pour des sp√©cialistes plus exp√©riment√©s, m√™me s'il semblerait que tout l'enthousiasme et la croyance fr√©n√©tiques en l'infaillibilit√© de leurs propres id√©es et pratiques auraient d√ª √™tre alt√©r√©s pendant longtemps. Je vais vous raconter une histoire √† ce sujet, un exemple d'un projet simple, √† premi√®re vue.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/vd/fg/lyvdfgr98fqlrow-vtmumb4ucbw.jpeg"><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un beau jour, un ami m'a lanc√© un lien vers une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startup int√©ressante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les gars ont sugg√©r√© que les repr√©sentants des petites entreprises des secteurs des services et des ventes mettent en place un point d'acc√®s (avec un portail captif) pour leurs clients afin de distribuer Internet, collectant simultan√©ment les adresses MAC des smartphones des passants. Le but de cette action est tr√®s simple - un grand nombre de r√©seaux publicitaires vous permettent de cibler la liste des adresses d'appareils, donc, en dirigeant la soci√©t√© de publicit√© vers les utilisateurs de passage, nous sommes plus susceptibles de recevoir de nouveaux visiteurs (car elle est proche et "quelque part je l'ai d√©j√† vue") . Ceux. une telle distribution de flyers virtuels. Un ami a demand√© comment cela se faisait et si nous pouvions recommencer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une recherche rapide sur le sujet a r√©v√©l√© le m√©canisme d'une telle collecte de donn√©es. L'adaptateur WiFi a √©t√© lanc√© en mode d'√©coute a√©rienne et a parcouru les canaux, capturant les paquets, les analysant et agr√©geant les donn√©es re√ßues. Il y avait aussi des utilitaires ouverts pr√™ts √† l'emploi pour cela, par exemple, airodump-ng de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aircrack-ng</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ceux. pour la r√©p√©tition, nous avons juste besoin d'ex√©cuter cet utilitaire, de pr√©f√©rence sur un appareil compact et portable s√©par√©, et de pousser les donn√©es re√ßues dans la base de donn√©es, √† partir de laquelle nous obtenons ensuite des listes d'adresses MAC pr√™tes √† l'emploi pour les r√©seaux publicitaires. Il semble que la t√¢che soit simple, r√©solue en un, au plus - deux soir√©es de travail tranquille, presque tout est pr√™t. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, cela n'a jamais √©t√© le cas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, ce qui est permis √† Jupiter ne l'est pas au taureau. </font><font style="vertical-align: inherit;">Et lorsque l'on utilise un seul payeur, il faut tout d'abord sacrifier les ressources informatiques et la m√©moire. </font><font style="vertical-align: inherit;">De plus, le sacrifice des ressources est suivi du sacrifice de la commodit√© de d√©veloppement et de d√©bogage - tous les syst√®mes ne permettent pas de faire glisser les outils de compilation vers l'appareil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©part, nous voulions prendre quelque chose de simple et pas cher, par exemple, des bo√Ætes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orange Pi Zero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, placez airodump-ng et transf√©rez les donn√©es crach√©es par l'utilitaire vers le serveur, o√π elles peuvent √™tre plac√©es en toute s√©curit√© dans la base de donn√©es. </font><font style="vertical-align: inherit;">J'avais de l'exp√©rience avec de tels syst√®mes distribu√©s avec un centre d√©di√© (m√™me si, l√†-bas, les machines virtuelles agissaient comme des chevaux de bataille lev√©s via l'API cloud via le m√™me centre que n√©cessaire, mais pas le but), donc une partie du code a migr√© avec succ√®s vers un nouveau projet .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'outil de transfert des donn√©es vers le serveur √©tait la simple application Erlang √©crite, qui √©tait cens√©e extraire les donn√©es du registre √©ther (analyse), les s√©rialiser (s√©rialisation native d'Erlang) et les transf√©rer via la socket Web vers le serveur via HTTPS (sans provoquer de soup√ßons). Syst√®mes DPI et ne pas inventer leurs propres protocoles). Les processeurs Allwinner H2 + utilis√©s dans l'Orange Pi sont suffisamment puissants pour √™tre assembl√©s et d√©bogu√©s directement sur l'appareil. Encore une fois, en th√©orie, tout va bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pratique a commenc√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. comme il s'est av√©r√©, le WiFi int√©gr√© dans Orange Pi √©tait seulement bon pour ramasser un point d'acc√®s et jeter des donn√©es dans le serveur. Eh bien, plus pr√©cis√©ment, pas l'adaptateur lui-m√™me, mais le support de son chipset dans le noyau. Pour la plupart des projets IoT, cela suffirait probablement. Cependant, nous √©tions pr√™ts pour ce coup, car une √©tude pr√©liminaire du site aircrack-ng a donn√© une id√©e tr√®s claire et ambigu√´ "cela ne fonctionnera pas partout, si ce n'est pas de notre faute, nous allons joindre une liste de chipsets test√©s". Presque tous les appareils Atheros (achet√©s par Qualcomm) et Ralink (achet√©s par MediaTek) ont √©t√© trouv√©s dans la liste, ce qui a inspir√© certaines perspectives dans le cas d'une transition d'ARM chinois voraces vers des MIPS plus asc√©tiques √† partir de chipsets pour routeurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, alors que tout cela va de la morve et des b√¢tons, c'est-√†-dire prototyp√© - vous devez r√©soudre le probl√®me ici et maintenant. Par cons√©quent, nous avons profit√© de ces esp√®ces exotiques √† notre √©poque technologique (lorsque la communication sans fil est plus l√©g√®re) en tant qu'adaptateur USB Wi-Fi. L'√©tude de la liste de compatibilit√© et la comparaison avec l'assortiment du magasin le plus proche a donn√© √† la victime - le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DLink DWA-160</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la r√©vision C1 (cela est important parce que d'autres r√©visions mat√©rielles ont utilis√© une puce diff√©rente et ont caus√© des maux de t√™te en termes d'application du travail). Double bande, qui ne n√©cessite pas de danser avec le pilote, car le support est depuis longtemps dans le noyau, ce sifflet est devenu utile plus tard dans d'autres projets, alors je les ai achet√©s, probablement tous (cinq pi√®ces) qui √©taient disponibles dans notre ville de province.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/7t/z7/bl7tz7yaohb2gfeh1ekkjha31us.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s m'√™tre assur√© que l'appareil fonctionnait, je l'ai connect√© √† un appareil √† carte unique et j'ai d√©sactiv√© l'adaptateur WiFi int√©gr√© dans l'espoir que l'Internet serait disponible via l'interface Ethernet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/em/nk/cyemnk-n5d2lzg1aximnuzddg4q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me cochon a √©t√© pondu par aircrack-ng. Cet ensemble d'utilitaires a √©t√© cr√©√© dans le but de </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pirater.</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contr√¥les de p√©n√©tration WiFi, c.-√†-d. a √©t√© √©crit par des pirates pour des pirates. Je ne sais pas, gr√¢ce √† quelle logique ils ont pr√©f√©r√© utiliser le dumper d'√©ther sans fil non sous la forme d'une approche unix traditionnelle, pour cracher du texte structur√© pour un traitement ult√©rieur, mais pour cr√©er une interface terminologique √† part enti√®re sur laquelle afficher des informations presque en temps r√©el (et en tenant compte des param√®tres du terminal) par des r√©seaux et des appareils d√©couverts, mais ils l'ont fait. Oui, j'ai trouv√© l'API Python d'un degr√© de pr√©paration inconnu pour tout cela, mais, encore une fois, l'araign√©e de prototypage qui vivait dans ma t√™te interdisait strictement de faire glisser une autre langue, de passer √† une autre (nous nous souvenons, la partie serveur √©tait d√©j√† partiellement pr√™te et √©crite √©tait loin de Python-e) ou, √† Dieu ne plaise, impl√©mentez airodump-ng vous-m√™me sur la base de tcpdump. Et par cons√©quent,J'ai d√ª chercher des solutions de contournement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, les pirates sans fil ont commenc√© √† soup√ßonner quelque chose qui se bloquait constamment dans l'interface √©tait une telle activit√©, alors ils ont mis en ≈ìuvre le t√©l√©chargement p√©riodique de tout ce qui a √©t√© trouv√© et agr√©g√© sous forme de fichiers CSV. Avec un intervalle d√©fini. Vous pouvez d√©j√† vivre avec. Bien s√ªr, l'option na√Øve - pour ex√©cuter l'utilitaire et relire le fichier sur une minuterie - a √©t√© imm√©diatement donn√©e √† la main. Travaillant sur un ordinateur portable, lors du transfert sur une seule carte, il a commenc√© √† √©chouer dans le processus de lecture du fichier pour des raisons √©videntes - parfois, l'utilitaire n'a tout simplement pas eu le temps de tout d√©charger et certaines des donn√©es ont √©t√© irr√©m√©diablement perdues.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution √† cela √©tait le m√©canisme inotify dans le noyau, notifiant les op√©rations sur les fichiers - d√®s que mon code a vu les modifications du fichier de donn√©es, il a commenc√© sa lecture avec un l√©ger retard (plut√¥t, ayant une valeur purement psychologique, rassure son auteur). Les exp√©riences ont montr√© que dans ce cas, les √©checs de lecture et la perte de donn√©es ne se produisent pas. Eh bien, chouette, CSV parsim, mis en structures internes et envoy√© au serveur. Nous l'enregistrons sur le serveur dans PostgreSQL (merci pour jsonb) et apr√®s cela il est d√©j√† possible de faire des requ√™tes, de d√©charger des formulaires, etc. Nous ajouterons l'autorisation la plus simple √† l'aide d'une cl√© sym√©trique, afin que nous ne nous y retrouvions pas et que nous puissions lier les donn√©es au point o√π l'appareil est install√©, et tout semble aller bien, vous pouvez aller au combat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouais, maintenant comment. L'assemblage de test de cette cha√Æne (et l'√©criture de code et le d√©bogage ont vraiment pris quelques soir√©es) a r√©v√©l√© un fait amusant - le nombre d'adresses captur√©es par jour dans notre bureau, assez √©loign√© des lieux praticables publics, a fluctu√© autour de quelques milliers de pi√®ces. Oui, bien s√ªr, il y avait un petit h√¥tel √† proximit√© (c'√©tait en p√©riode d'isolement pr√©-quarantaine, ne soyez pas surpris), mais quand m√™me, il y en a beaucoup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rafra√Æchissant la connaissance de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure de l'adresse MAC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et rappelant le fait que les appareils mobiles g√©n√®rent souvent des adresses locales pour cacher leurs vraies adresses MAC, j'ai modifi√© la partie serveur avec un simple filtre qui nettoie toutes les adresses locales et de diffusion en entr√©e. La liste a √©t√© r√©duite d'un ordre de grandeur et ressemblait d√©j√† √† la v√©rit√©. Tout √©tait pr√™t pour les essais sur le terrain.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, lors du changement de lieu d'un bureau chaleureux et confortable √† des conditions de combat impitoyables, les prototypes ont tendance √† cesser de fonctionner normalement, de sorte que le processus de mise en ≈ìuvre doit √™tre accompagn√© de la disponibilit√© d'un ing√©nieur de poche qui corrigera tous les probl√®mes √©mergents. D'autre part, il est √©galement bien connu qu'un appareil qui ne n√©cessite pas de danse suppl√©mentaire avec un tambourin au d√©but de l'op√©ration est susceptible de tomber en panne rapidement et irr√©vocablement. Cela, bien s√ªr, se refl√©tait dans les lois de Murphy, mais, h√©las, l‚Äôauteur de ces lignes est trop paresseux pour v√©rifier laquelle, par cons√©quent, nous nous mettrons d‚Äôaccord sur le terme ¬´loi de la m√©chancet√©¬ª. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re installation a imm√©diatement r√©v√©l√© un tas de d√©fauts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premi√®rement, la plupart des cartes de prototypage chinois sont livr√©es avec une m√©moire microSD √† long terme par opposition aux puces flash NAND / NOR. Une exception n'est faite que pour les SoC puissants, clairement redondants pour cette t√¢che. H√©las, MicroSD est le casse-t√™te imm√©diat de l'op√©rateur - oxydation des √©lectrodes, d√©faillance des cartes SD, d√©pendance des contacts √† la temp√©rature √† l'int√©rieur du bo√Ætier (ce qui est consid√©rable, les puces chinoises ne sont pas tr√®s √©conerg√©tiques et les cartes sont souvent calcul√©es compl√®tement sur la base de pic de consommation d'√©nergie, donc sans radiateur suppl√©mentaire, eh bien, pas du tout). Il s'est donc av√©r√© que lorsque l'alimentation a √©t√© coup√©e de l'appareil, le syst√®me est devenu inutilisable - les fichiers avec le bytecode ERTS ont √©t√© endommag√©s, apr√®s le red√©marrage, l'application a refus√© de fonctionner.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me moment d√©sagr√©able - au point d'installation, Internet √©tait fourni par un routeur LTE et √©tait, pour le moins, de qualit√© m√©diocre, contrairement √† un fil de bureau. Le r√©seau a constamment d√©clench√©, l'application s'est souvent reconnect√©e ou est m√™me morte √† cause des messages accumul√©s dans les files d'attente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, les deux probl√®mes sont surmontables, par exemple, la perte de donn√©es serait √©limin√©e en recherchant la combinaison optimale d'une bonne carte MicroSD et des param√®tres du syst√®me de fichiers, et l'instabilit√© de la connexion pourrait √™tre compens√©e par une agr√©gation pr√©liminaire des donn√©es, de courtes sessions d'envoi, d√©charg√©es √† temps, etc. Mais les probl√®mes qui ont √©t√© r√©v√©l√©s sont l'occasion de se demander si la bonne voie a √©t√© choisie. La n√©cessit√© d'une connexion permanente au serveur a mis fin √† la collecte de donn√©es d'√©v√©nements, lorsque l'appareil est suspendu √† une batterie externe et jet√© dans un sac √† dos, dont le propri√©taire se rend √† un √©v√©nement de masse, o√π, bien s√ªr, vous ne pouvez pas vous attendre √† la stabilit√© de la connexion.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, l'√©tape suivante consistait √† abandonner la partie serveur et √† localiser l'entrep√¥t de donn√©es directement sur l'appareil. De plus, afin d'√©viter des exp√©riences longues et tr√®s mornes avec les cartes SD, il a √©t√© d√©cid√© d'utiliser des mod√®les de maquette avec des puces flash lors de la prochaine it√©ration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce moment-l√†, je me suis souvenu que dans ma collection il y avait une merveilleuse planche </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carambola 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des camarades lituaniens </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8Devices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et si vous allez sur leur site, vous pouvez trouver un appareil encore plus compact sur la m√™me puce appel√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Centipede</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Des exp√©riences pr√©c√©dentes avec cette classe d'appareils ont montr√© qu'Erlang s'int√®gre compl√®tement dans les 16 Mo de m√©moire flash allou√©s (et qu'il reste un peu pour l'application). Le seul inconv√©nient (ce qui est plut√¥t un avantage) est la faible puissance MIPS et la n√©cessit√© d'une compilation crois√©e, ce qui rend la construction d'une application Erlang un peu plus simple. Mais c'√©tait d√©j√† une route bien connue, j'ai donc command√© quelques Centipede, et jusqu'√† pr√©sent, j'ai port√© la version existante qui fonctionne avec le serveur vers Carambol.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ll/x6/sq/llx6sqtfo4vwd4bvbi8tvvcmzsg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque les composants sont arriv√©s, une nouvelle phase a commenc√©. La puce AR9331 a √©t√© prise en charge avec succ√®s par aircrack-ng hors de la bo√Æte, les donn√©es peuvent √™tre prises √† partir de l'interface Ethernet, les derni√®res versions d'OpenWRT et ERTS ont √©t√© collect√©es et test√©es avec succ√®s. L'application a √©t√© r√©√©crite - une partie du code a √©t√© d√©plac√©e vers le code de l'appareil, les donn√©es ont √©t√© accumul√©es dans un processus distinct et p√©riodiquement transf√©r√©es dans un fichier sous la forme d'un terme Erlang s√©rialis√©. √Ä cela a √©t√© tir√©e l'interface Web la plus simple qui re√ßoit des donn√©es via websocket. Les ports pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inotify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erlexec sont</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compil√©s en toute s√©curit√© avec OpenWRT.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une seule chose confuse - 300 kilo-octets restaient sur les donn√©es. Ce n'est pas si petit si vous ne stockez que les adresses MAC des appareils clients, mais airodump-ng vous donne des informations beaucoup plus int√©ressantes, y compris les adresses des points d'acc√®s, leurs ESSID et ainsi de suite, ce qui serait √©galement agr√©able √† retenir. Au cas o√π. D'accord, nous agirons en fonction des circonstances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous collectons, v√©rifions. Un probl√®me est r√©v√©l√© √† la vol√©e. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openwrt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme nous le savons tous, il s'agit d'une version Linux minimaliste con√ßue sp√©cifiquement pour les appareils avec une m√©moire limit√©e. En cons√©quence, il a jet√© √† partir de l√† qu'il √©tait possible de jeter sans douleur et a simplifi√© ce qui pourrait √™tre simplifi√©, y compris le mode multijoueur. Ceux. C'est une pratique courante lorsque le code d√©marre √† partir de la racine et fonctionne avec des privil√®ges maximaux, ce qui, bien s√ªr, facilite les probl√®mes li√©s aux groupes, aux utilisateurs et au contr√¥le de leurs actions. Oui, oui, la lettre S dans l'abr√©viation IoT est responsable de la s√©curit√©. Le probl√®me est que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erlexec</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que j'avais l'habitude d'ex√©cuter et de g√©rer airodump-ng, ne peut pas effectuer d'op√©rations sous la racine - pour cela, il a besoin d'un utilisateur suppl√©mentaire, au nom duquel il g√©n√©rera les processus qui lui sont assign√©s. Et lorsque vous cr√©ez un utilisateur suppl√©mentaire avec un niveau de privil√®ge diff√©rent ... correctement, cela emp√™che l'airodump d'atteindre le p√©riph√©rique r√©seau. D√©visser cette restriction de la biblioth√®que semblait √™tre un processus lent, donc erlexec a √©t√© remplac√© par des ports - le m√©canisme int√©gr√© pour lancer des processus tiers dans Erlang. Une bagatelle, mais d√©sagr√©able.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, les appareils sont re√ßus, reflash√©s et fonctionnent m√™me en serre. Nous attrapons la batterie, jetons la bo√Æte dans le sac √† dos, allons au centre commercial. Le lendemain, nous regardons le r√©sultat - un fiasco, un fichier de donn√©es de longueur nulle - soit il n'y avait pas assez d'espace, soit une distorsion de la puissance n'a pas fonctionn√© √† un tr√®s bon moment. Nous corrigeons le code afin que l'enregistrement se d√©roule en deux √©tapes - un fichier temporaire a d'abord √©t√© cr√©√©, puis il a remplac√© le fichier actuel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, les mains n'ont pas pu v√©rifier l'op√©rabilit√© de cette option - le prochain jouet - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Onion Omega2 +</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le Mediatek 7688 est apparu. Comme leurs fr√®res, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le concepteur LinkIt Smart 7688</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il y avait </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beaucoup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais la chose la plus importante est deux fois plus de m√©moire flash, ce qui signifie que vous ne pouvez plus vous soucier du manque d'espace pour le stockage des donn√©es. d'accord </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commandons, attendez. Mois. Deux. La patience √©clate - nous √©crivons aux Am√©ricains sur le sujet ¬´o√π sont les marchandises, Zin¬ª. Silence. Ouvrez un litige sur PayPal. Les Am√©ricains se r√©veillent. Ils disent: "Oh, notre syst√®me d'acceptation des commandes a √©chou√©, maintenant nous allons tout envoyer." Ils envoient, nous attendons trois semaines. Fuh, l'appareil est √† port√©e de main et fonctionne m√™me.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/3a/ph/yb3aphpjdskqkkfcqlzw25pobuc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous devons faire une petite digression - malgr√© le fait que j'avais plusieurs cartes LinkIt Smart √† distance de marche, je ne les consid√©rais pas comme une plate-forme, car au tout d√©but de la saga, une tentative de les utiliser comme p√©riph√©riques de capture a √©chou√©. Ensuite, les pilotes de la puce ont √©t√© fournis sous forme de modules assembl√©s pour des versions sp√©cifiques du noyau et, apparemment, cela est devenu la cause de l'inop√©rabilit√©. Dans les derni√®res versions d'OpenWRT, la prise en charge native du 7688 et un pilote ouvert sont apparus, c'est donc l'occasion de reconsid√©rer l'approche de ces p√©riph√©riques.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, il √©tait habituel d'utiliser le WiFi directement sur la puce pour son usage pr√©vu - apr√®s tout, l'appareil a besoin d'au moins une interface de contr√¥le, et √©galement sur le terrain, au moins afin de comprendre s'il fonctionne ou non. Il serait √©galement utile d'examiner les donn√©es obtenues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, nous combinons les approches pr√©c√©dentes - nous utilisons la seule interface USB affich√©e sur le MiniDoc pour un sifflet WiFi pour scanner l'espace, et le WiFi int√©gr√© - pour contr√¥ler l'appareil en tant que point d'acc√®s √† faible consommation. Nous collectons, v√©rifions, tout fonctionne.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais l'app√©tit vient avec manger. Pour commencer, le fichier de donn√©es sous forme de s√©rialisation Erlang est le lot de vrais maniaques, et un √©ventail l√©g√®rement plus large de professionnels sp√©cialement form√©s a besoin de quelque chose de plus simple. Encore une fois, en plus d'ajouter des donn√©es √† partir du d√©chargement a√©rien, je voudrais √©galement le temps de mesure exact et, de pr√©f√©rence, au moins une sorte de r√©f√©rence √† l'emplacement de l'appareil dans l'espace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous int√©grons entre un sifflet WiFi et un concentrateur USB. Les param√®tres (et ils d√©pendent de la position de l'appareil sur le bus dans le cas d'OpenWRT) sont bois√©s, mais ce sont des bagatelles mineures. Correct. Nous sortons le r√©cepteur USB-GPS des d√©combres, heureusement, d√©j√† test√© dans le temps et avec le </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">code</font></a><font style="vertical-align: inherit;"> √©crit</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse NMEA-0183 (le code, bien s√ªr, a d√ª √™tre corrig√© de toute fa√ßon). Nous v√©rifions - l'appareil n'est pas d√©tect√© en toute s√©curit√© par le syst√®me, il y a clairement un manque de pilotes. Nous collectons les pilotes USB Serial et les d√©posons sur l'appareil - √©galement en silence. Ensuite, nous rappelons que dans les grands syst√®mes, le sifflet GPS a √©t√© d√©tect√© non pas comme ttyUSBx, mais comme ttyACMx, c'est-√†-dire Modem GSM USB. Eh bien, tr√®s bien, le deuxi√®me appel √† ajouter des pilotes, le succ√®s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prenons le code, int√©grons dans l'application. </font><font style="vertical-align: inherit;">Ajoutez sqlite3 √† l'application en tant que stockage. </font><font style="vertical-align: inherit;">Maintenant, il ne sera pas n√©cessaire de v√©rifier la disponibilit√© de l'enregistrement dans l'√©tat, et en g√©n√©ral le travail avec les donn√©es est simplifi√© √† un petit nombre de lignes. </font><font style="vertical-align: inherit;">En mettant tout cela ensemble, nous enseignons lors de l'ajout de donn√©es pour prendre des lectures GPS, nous corrigeons le code JS sur le visage pour l'afficher en cas de jeu de donn√©es incomplet (cela peut se produire lorsque le GPS n'a pas encore capt√© de satellites et que les donn√©es de balayage a√©rien vont d√©j√†). </font><font style="vertical-align: inherit;">Nous v√©rifions le travail - il semble vivre. </font><font style="vertical-align: inherit;">Vous pouvez d√©clarer une victoire int√©rimaire.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/vd/fg/lyvdfgr98fqlrow-vtmumb4ucbw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant quelques semaines de travail ininterrompu - beaucoup de donn√©es √† la fois sur les stations en direct et sur les clients. </font><font style="vertical-align: inherit;">Maintenant, je lutte contre la tentation d'offrir cet appareil aux sp√©cialistes de la s√©curit√© de l'information pour contr√¥ler la diffusion dans les territoires confi√©s et √† l'√âtat pour contr√¥ler la circulation des t√©l√©phones des citoyens. </font><font style="vertical-align: inherit;">C‚Äôest une blague, bien s√ªr, eux-m√™mes savent d√©j√† tout.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, toutes les √©preuves d√©crites ci-dessus ne sont qu'un projet familier avec une tr√®s faible complexit√© (il √©tait presque imm√©diatement clair quoi faire et comment), le manque de d√©veloppement mat√©riel (bonjour, physique) et l'acc√®s √† un produit un peu plus ou moins complet. </font><font style="vertical-align: inherit;">Non, bien s√ªr, il ne peut pas √™tre exclu que l'auteur de ces lignes soit un amateur dense, et de vrais gourous vont de cette fa√ßon en une soir√©e entre le th√© du soir et un verre de cognac, mais jusqu'√† pr√©sent l'exp√©rience n'a montr√© qu'une chose: l'informatique est compliqu√©e et l'optimisme est puni financi√®rement et de r√©putation et motivationnellement, et ceux qui disent ¬´tout est simple¬ª sont des g√©nies ou des escrocs, et le second est plus probable.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503364/index.html">HandsAppMVP: architecture iOS pour l'externalisation du d√©veloppement de studio</a></li>
<li><a href="../fr503366/index.html">Pourquoi un tiret devient-il une question? Ou des probl√®mes avec le codage des donn√©es en SQL</a></li>
<li><a href="../fr503368/index.html">Gigantomania: pourquoi les jeux modernes p√®sent-ils autant?</a></li>
<li><a href="../fr503372/index.html">Ethereum 2.0 peut √™tre √† nouveau retard√© en raison d'erreurs, de probl√®mes et de concurrents</a></li>
<li><a href="../fr503380/index.html">Emplois asynchrones √† Django avec c√©leri</a></li>
<li><a href="../fr503386/index.html">Coach agile personne en bonne sant√©</a></li>
<li><a href="../fr503388/index.html">Num√©risation de la panique: DIT de Moscou contre les Moscovites - une table ronde le 23 mai</a></li>
<li><a href="../fr503390/index.html">Pourquoi Intel parie-t-il sur le d√©veloppement de puces pour le g√©nie de Jim Keller?</a></li>
<li><a href="../fr503394/index.html">Exp√©rience d'investissement en actions</a></li>
<li><a href="../fr503398/index.html">Comment cr√©er rapidement une mod√©lisation th√©matique d'un forum ou ce qui d√©range les personnes atteintes de la maladie c≈ìliaque</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>