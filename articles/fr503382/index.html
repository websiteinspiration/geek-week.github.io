<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍✈️ ◽️ ☪️ Rake marche dans un champ propre ou comment collecter les adresses MAC des appareils Wi-Fi à proximité 🚣🏼 👩🏿‍⚕️ 👩‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je commence tous mes discours publics (heureusement, il n'y en a pas beaucoup) en mentionnant explicitement ou implicitement la thèse «Notre industrie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Rake marche dans un champ propre ou comment collecter les adresses MAC des appareils Wi-Fi à proximité</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503382/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je commence tous mes discours publics (heureusement, il n'y en a pas beaucoup) en mentionnant explicitement ou implicitement la thèse «Notre industrie est complexe, les problèmes peuvent être révélés à n'importe quelle étape, même la plus évidente, et il est optimiste de supposer que tout sera simple et facile - naïf» . Curieusement, cette idée simple, obtenue par de nombreuses années de bourrage de cônes, est parfois une révélation pour des spécialistes plus expérimentés, même s'il semblerait que tout l'enthousiasme et la croyance frénétiques en l'infaillibilité de leurs propres idées et pratiques auraient dû être altérés pendant longtemps. Je vais vous raconter une histoire à ce sujet, un exemple d'un projet simple, à première vue.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/vd/fg/lyvdfgr98fqlrow-vtmumb4ucbw.jpeg"><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un beau jour, un ami m'a lancé un lien vers une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startup intéressante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les gars ont suggéré que les représentants des petites entreprises des secteurs des services et des ventes mettent en place un point d'accès (avec un portail captif) pour leurs clients afin de distribuer Internet, collectant simultanément les adresses MAC des smartphones des passants. Le but de cette action est très simple - un grand nombre de réseaux publicitaires vous permettent de cibler la liste des adresses d'appareils, donc, en dirigeant la société de publicité vers les utilisateurs de passage, nous sommes plus susceptibles de recevoir de nouveaux visiteurs (car elle est proche et "quelque part je l'ai déjà vue") . Ceux. une telle distribution de flyers virtuels. Un ami a demandé comment cela se faisait et si nous pouvions recommencer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une recherche rapide sur le sujet a révélé le mécanisme d'une telle collecte de données. L'adaptateur WiFi a été lancé en mode d'écoute aérienne et a parcouru les canaux, capturant les paquets, les analysant et agrégeant les données reçues. Il y avait aussi des utilitaires ouverts prêts à l'emploi pour cela, par exemple, airodump-ng de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aircrack-ng</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ceux. pour la répétition, nous avons juste besoin d'exécuter cet utilitaire, de préférence sur un appareil compact et portable séparé, et de pousser les données reçues dans la base de données, à partir de laquelle nous obtenons ensuite des listes d'adresses MAC prêtes à l'emploi pour les réseaux publicitaires. Il semble que la tâche soit simple, résolue en un, au plus - deux soirées de travail tranquille, presque tout est prêt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, cela n'a jamais été le cas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, ce qui est permis à Jupiter ne l'est pas au taureau. </font><font style="vertical-align: inherit;">Et lorsque l'on utilise un seul payeur, il faut tout d'abord sacrifier les ressources informatiques et la mémoire. </font><font style="vertical-align: inherit;">De plus, le sacrifice des ressources est suivi du sacrifice de la commodité de développement et de débogage - tous les systèmes ne permettent pas de faire glisser les outils de compilation vers l'appareil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au départ, nous voulions prendre quelque chose de simple et pas cher, par exemple, des boîtes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Orange Pi Zero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, placez airodump-ng et transférez les données crachées par l'utilitaire vers le serveur, où elles peuvent être placées en toute sécurité dans la base de données. </font><font style="vertical-align: inherit;">J'avais de l'expérience avec de tels systèmes distribués avec un centre dédié (même si, là-bas, les machines virtuelles agissaient comme des chevaux de bataille levés via l'API cloud via le même centre que nécessaire, mais pas le but), donc une partie du code a migré avec succès vers un nouveau projet .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'outil de transfert des données vers le serveur était la simple application Erlang écrite, qui était censée extraire les données du registre éther (analyse), les sérialiser (sérialisation native d'Erlang) et les transférer via la socket Web vers le serveur via HTTPS (sans provoquer de soupçons). Systèmes DPI et ne pas inventer leurs propres protocoles). Les processeurs Allwinner H2 + utilisés dans l'Orange Pi sont suffisamment puissants pour être assemblés et débogués directement sur l'appareil. Encore une fois, en théorie, tout va bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pratique a commencé.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. comme il s'est avéré, le WiFi intégré dans Orange Pi était seulement bon pour ramasser un point d'accès et jeter des données dans le serveur. Eh bien, plus précisément, pas l'adaptateur lui-même, mais le support de son chipset dans le noyau. Pour la plupart des projets IoT, cela suffirait probablement. Cependant, nous étions prêts pour ce coup, car une étude préliminaire du site aircrack-ng a donné une idée très claire et ambiguë "cela ne fonctionnera pas partout, si ce n'est pas de notre faute, nous allons joindre une liste de chipsets testés". Presque tous les appareils Atheros (achetés par Qualcomm) et Ralink (achetés par MediaTek) ont été trouvés dans la liste, ce qui a inspiré certaines perspectives dans le cas d'une transition d'ARM chinois voraces vers des MIPS plus ascétiques à partir de chipsets pour routeurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, alors que tout cela va de la morve et des bâtons, c'est-à-dire prototypé - vous devez résoudre le problème ici et maintenant. Par conséquent, nous avons profité de ces espèces exotiques à notre époque technologique (lorsque la communication sans fil est plus légère) en tant qu'adaptateur USB Wi-Fi. L'étude de la liste de compatibilité et la comparaison avec l'assortiment du magasin le plus proche a donné à la victime - le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DLink DWA-160</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la révision C1 (cela est important parce que d'autres révisions matérielles ont utilisé une puce différente et ont causé des maux de tête en termes d'application du travail). Double bande, qui ne nécessite pas de danser avec le pilote, car le support est depuis longtemps dans le noyau, ce sifflet est devenu utile plus tard dans d'autres projets, alors je les ai achetés, probablement tous (cinq pièces) qui étaient disponibles dans notre ville de province.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/7t/z7/bl7tz7yaohb2gfeh1ekkjha31us.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après m'être assuré que l'appareil fonctionnait, je l'ai connecté à un appareil à carte unique et j'ai désactivé l'adaptateur WiFi intégré dans l'espoir que l'Internet serait disponible via l'interface Ethernet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/em/nk/cyemnk-n5d2lzg1aximnuzddg4q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième cochon a été pondu par aircrack-ng. Cet ensemble d'utilitaires a été créé dans le but de </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pirater.</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrôles de pénétration WiFi, c.-à-d. a été écrit par des pirates pour des pirates. Je ne sais pas, grâce à quelle logique ils ont préféré utiliser le dumper d'éther sans fil non sous la forme d'une approche unix traditionnelle, pour cracher du texte structuré pour un traitement ultérieur, mais pour créer une interface terminologique à part entière sur laquelle afficher des informations presque en temps réel (et en tenant compte des paramètres du terminal) par des réseaux et des appareils découverts, mais ils l'ont fait. Oui, j'ai trouvé l'API Python d'un degré de préparation inconnu pour tout cela, mais, encore une fois, l'araignée de prototypage qui vivait dans ma tête interdisait strictement de faire glisser une autre langue, de passer à une autre (nous nous souvenons, la partie serveur était déjà partiellement prête et écrite était loin de Python-e) ou, à Dieu ne plaise, implémentez airodump-ng vous-même sur la base de tcpdump. Et par conséquent,J'ai dû chercher des solutions de contournement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, les pirates sans fil ont commencé à soupçonner quelque chose qui se bloquait constamment dans l'interface était une telle activité, alors ils ont mis en œuvre le téléchargement périodique de tout ce qui a été trouvé et agrégé sous forme de fichiers CSV. Avec un intervalle défini. Vous pouvez déjà vivre avec. Bien sûr, l'option naïve - pour exécuter l'utilitaire et relire le fichier sur une minuterie - a été immédiatement donnée à la main. Travaillant sur un ordinateur portable, lors du transfert sur une seule carte, il a commencé à échouer dans le processus de lecture du fichier pour des raisons évidentes - parfois, l'utilitaire n'a tout simplement pas eu le temps de tout décharger et certaines des données ont été irrémédiablement perdues.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution à cela était le mécanisme inotify dans le noyau, notifiant les opérations sur les fichiers - dès que mon code a vu les modifications du fichier de données, il a commencé sa lecture avec un léger retard (plutôt, ayant une valeur purement psychologique, rassure son auteur). Les expériences ont montré que dans ce cas, les échecs de lecture et la perte de données ne se produisent pas. Eh bien, chouette, CSV parsim, mis en structures internes et envoyé au serveur. Nous l'enregistrons sur le serveur dans PostgreSQL (merci pour jsonb) et après cela il est déjà possible de faire des requêtes, de décharger des formulaires, etc. Nous ajouterons l'autorisation la plus simple à l'aide d'une clé symétrique, afin que nous ne nous y retrouvions pas et que nous puissions lier les données au point où l'appareil est installé, et tout semble aller bien, vous pouvez aller au combat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouais, maintenant comment. L'assemblage de test de cette chaîne (et l'écriture de code et le débogage ont vraiment pris quelques soirées) a révélé un fait amusant - le nombre d'adresses capturées par jour dans notre bureau, assez éloigné des lieux praticables publics, a fluctué autour de quelques milliers de pièces. Oui, bien sûr, il y avait un petit hôtel à proximité (c'était en période d'isolement pré-quarantaine, ne soyez pas surpris), mais quand même, il y en a beaucoup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rafraîchissant la connaissance de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure de l'adresse MAC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et rappelant le fait que les appareils mobiles génèrent souvent des adresses locales pour cacher leurs vraies adresses MAC, j'ai modifié la partie serveur avec un simple filtre qui nettoie toutes les adresses locales et de diffusion en entrée. La liste a été réduite d'un ordre de grandeur et ressemblait déjà à la vérité. Tout était prêt pour les essais sur le terrain.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, lors du changement de lieu d'un bureau chaleureux et confortable à des conditions de combat impitoyables, les prototypes ont tendance à cesser de fonctionner normalement, de sorte que le processus de mise en œuvre doit être accompagné de la disponibilité d'un ingénieur de poche qui corrigera tous les problèmes émergents. D'autre part, il est également bien connu qu'un appareil qui ne nécessite pas de danse supplémentaire avec un tambourin au début de l'opération est susceptible de tomber en panne rapidement et irrévocablement. Cela, bien sûr, se reflétait dans les lois de Murphy, mais, hélas, l’auteur de ces lignes est trop paresseux pour vérifier laquelle, par conséquent, nous nous mettrons d’accord sur le terme «loi de la méchanceté». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première installation a immédiatement révélé un tas de défauts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premièrement, la plupart des cartes de prototypage chinois sont livrées avec une mémoire microSD à long terme par opposition aux puces flash NAND / NOR. Une exception n'est faite que pour les SoC puissants, clairement redondants pour cette tâche. Hélas, MicroSD est le casse-tête immédiat de l'opérateur - oxydation des électrodes, défaillance des cartes SD, dépendance des contacts à la température à l'intérieur du boîtier (ce qui est considérable, les puces chinoises ne sont pas très éconergétiques et les cartes sont souvent calculées complètement sur la base de pic de consommation d'énergie, donc sans radiateur supplémentaire, eh bien, pas du tout). Il s'est donc avéré que lorsque l'alimentation a été coupée de l'appareil, le système est devenu inutilisable - les fichiers avec le bytecode ERTS ont été endommagés, après le redémarrage, l'application a refusé de fonctionner.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième moment désagréable - au point d'installation, Internet était fourni par un routeur LTE et était, pour le moins, de qualité médiocre, contrairement à un fil de bureau. Le réseau a constamment déclenché, l'application s'est souvent reconnectée ou est même morte à cause des messages accumulés dans les files d'attente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, les deux problèmes sont surmontables, par exemple, la perte de données serait éliminée en recherchant la combinaison optimale d'une bonne carte MicroSD et des paramètres du système de fichiers, et l'instabilité de la connexion pourrait être compensée par une agrégation préliminaire des données, de courtes sessions d'envoi, déchargées à temps, etc. Mais les problèmes qui ont été révélés sont l'occasion de se demander si la bonne voie a été choisie. La nécessité d'une connexion permanente au serveur a mis fin à la collecte de données d'événements, lorsque l'appareil est suspendu à une batterie externe et jeté dans un sac à dos, dont le propriétaire se rend à un événement de masse, où, bien sûr, vous ne pouvez pas vous attendre à la stabilité de la connexion.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, l'étape suivante consistait à abandonner la partie serveur et à localiser l'entrepôt de données directement sur l'appareil. De plus, afin d'éviter des expériences longues et très mornes avec les cartes SD, il a été décidé d'utiliser des modèles de maquette avec des puces flash lors de la prochaine itération. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce moment-là, je me suis souvenu que dans ma collection il y avait une merveilleuse planche </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carambola 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des camarades lituaniens </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8Devices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et si vous allez sur leur site, vous pouvez trouver un appareil encore plus compact sur la même puce appelé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Centipede</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Des expériences précédentes avec cette classe d'appareils ont montré qu'Erlang s'intègre complètement dans les 16 Mo de mémoire flash alloués (et qu'il reste un peu pour l'application). Le seul inconvénient (ce qui est plutôt un avantage) est la faible puissance MIPS et la nécessité d'une compilation croisée, ce qui rend la construction d'une application Erlang un peu plus simple. Mais c'était déjà une route bien connue, j'ai donc commandé quelques Centipede, et jusqu'à présent, j'ai porté la version existante qui fonctionne avec le serveur vers Carambol.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ll/x6/sq/llx6sqtfo4vwd4bvbi8tvvcmzsg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque les composants sont arrivés, une nouvelle phase a commencé. La puce AR9331 a été prise en charge avec succès par aircrack-ng hors de la boîte, les données peuvent être prises à partir de l'interface Ethernet, les dernières versions d'OpenWRT et ERTS ont été collectées et testées avec succès. L'application a été réécrite - une partie du code a été déplacée vers le code de l'appareil, les données ont été accumulées dans un processus distinct et périodiquement transférées dans un fichier sous la forme d'un terme Erlang sérialisé. À cela a été tirée l'interface Web la plus simple qui reçoit des données via websocket. Les ports pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inotify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erlexec sont</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compilés en toute sécurité avec OpenWRT.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une seule chose confuse - 300 kilo-octets restaient sur les données. Ce n'est pas si petit si vous ne stockez que les adresses MAC des appareils clients, mais airodump-ng vous donne des informations beaucoup plus intéressantes, y compris les adresses des points d'accès, leurs ESSID et ainsi de suite, ce qui serait également agréable à retenir. Au cas où. D'accord, nous agirons en fonction des circonstances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous collectons, vérifions. Un problème est révélé à la volée. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openwrt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme nous le savons tous, il s'agit d'une version Linux minimaliste conçue spécifiquement pour les appareils avec une mémoire limitée. En conséquence, il a jeté à partir de là qu'il était possible de jeter sans douleur et a simplifié ce qui pourrait être simplifié, y compris le mode multijoueur. Ceux. C'est une pratique courante lorsque le code démarre à partir de la racine et fonctionne avec des privilèges maximaux, ce qui, bien sûr, facilite les problèmes liés aux groupes, aux utilisateurs et au contrôle de leurs actions. Oui, oui, la lettre S dans l'abréviation IoT est responsable de la sécurité. Le problème est que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erlexec</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que j'avais l'habitude d'exécuter et de gérer airodump-ng, ne peut pas effectuer d'opérations sous la racine - pour cela, il a besoin d'un utilisateur supplémentaire, au nom duquel il générera les processus qui lui sont assignés. Et lorsque vous créez un utilisateur supplémentaire avec un niveau de privilège différent ... correctement, cela empêche l'airodump d'atteindre le périphérique réseau. Dévisser cette restriction de la bibliothèque semblait être un processus lent, donc erlexec a été remplacé par des ports - le mécanisme intégré pour lancer des processus tiers dans Erlang. Une bagatelle, mais désagréable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, les appareils sont reçus, reflashés et fonctionnent même en serre. Nous attrapons la batterie, jetons la boîte dans le sac à dos, allons au centre commercial. Le lendemain, nous regardons le résultat - un fiasco, un fichier de données de longueur nulle - soit il n'y avait pas assez d'espace, soit une distorsion de la puissance n'a pas fonctionné à un très bon moment. Nous corrigeons le code afin que l'enregistrement se déroule en deux étapes - un fichier temporaire a d'abord été créé, puis il a remplacé le fichier actuel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, les mains n'ont pas pu vérifier l'opérabilité de cette option - le prochain jouet - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Onion Omega2 +</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le Mediatek 7688 est apparu. Comme leurs frères, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le concepteur LinkIt Smart 7688</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il y avait </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beaucoup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais la chose la plus importante est deux fois plus de mémoire flash, ce qui signifie que vous ne pouvez plus vous soucier du manque d'espace pour le stockage des données. d'accord </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commandons, attendez. Mois. Deux. La patience éclate - nous écrivons aux Américains sur le sujet «où sont les marchandises, Zin». Silence. Ouvrez un litige sur PayPal. Les Américains se réveillent. Ils disent: "Oh, notre système d'acceptation des commandes a échoué, maintenant nous allons tout envoyer." Ils envoient, nous attendons trois semaines. Fuh, l'appareil est à portée de main et fonctionne même.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/3a/ph/yb3aphpjdskqkkfcqlzw25pobuc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous devons faire une petite digression - malgré le fait que j'avais plusieurs cartes LinkIt Smart à distance de marche, je ne les considérais pas comme une plate-forme, car au tout début de la saga, une tentative de les utiliser comme périphériques de capture a échoué. Ensuite, les pilotes de la puce ont été fournis sous forme de modules assemblés pour des versions spécifiques du noyau et, apparemment, cela est devenu la cause de l'inopérabilité. Dans les dernières versions d'OpenWRT, la prise en charge native du 7688 et un pilote ouvert sont apparus, c'est donc l'occasion de reconsidérer l'approche de ces périphériques.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, il était habituel d'utiliser le WiFi directement sur la puce pour son usage prévu - après tout, l'appareil a besoin d'au moins une interface de contrôle, et également sur le terrain, au moins afin de comprendre s'il fonctionne ou non. Il serait également utile d'examiner les données obtenues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous combinons les approches précédentes - nous utilisons la seule interface USB affichée sur le MiniDoc pour un sifflet WiFi pour scanner l'espace, et le WiFi intégré - pour contrôler l'appareil en tant que point d'accès à faible consommation. Nous collectons, vérifions, tout fonctionne.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais l'appétit vient avec manger. Pour commencer, le fichier de données sous forme de sérialisation Erlang est le lot de vrais maniaques, et un éventail légèrement plus large de professionnels spécialement formés a besoin de quelque chose de plus simple. Encore une fois, en plus d'ajouter des données à partir du déchargement aérien, je voudrais également le temps de mesure exact et, de préférence, au moins une sorte de référence à l'emplacement de l'appareil dans l'espace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous intégrons entre un sifflet WiFi et un concentrateur USB. Les paramètres (et ils dépendent de la position de l'appareil sur le bus dans le cas d'OpenWRT) sont boisés, mais ce sont des bagatelles mineures. Correct. Nous sortons le récepteur USB-GPS des décombres, heureusement, déjà testé dans le temps et avec le </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">code</font></a><font style="vertical-align: inherit;"> écrit</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse NMEA-0183 (le code, bien sûr, a dû être corrigé de toute façon). Nous vérifions - l'appareil n'est pas détecté en toute sécurité par le système, il y a clairement un manque de pilotes. Nous collectons les pilotes USB Serial et les déposons sur l'appareil - également en silence. Ensuite, nous rappelons que dans les grands systèmes, le sifflet GPS a été détecté non pas comme ttyUSBx, mais comme ttyACMx, c'est-à-dire Modem GSM USB. Eh bien, très bien, le deuxième appel à ajouter des pilotes, le succès.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prenons le code, intégrons dans l'application. </font><font style="vertical-align: inherit;">Ajoutez sqlite3 à l'application en tant que stockage. </font><font style="vertical-align: inherit;">Maintenant, il ne sera pas nécessaire de vérifier la disponibilité de l'enregistrement dans l'état, et en général le travail avec les données est simplifié à un petit nombre de lignes. </font><font style="vertical-align: inherit;">En mettant tout cela ensemble, nous enseignons lors de l'ajout de données pour prendre des lectures GPS, nous corrigeons le code JS sur le visage pour l'afficher en cas de jeu de données incomplet (cela peut se produire lorsque le GPS n'a pas encore capté de satellites et que les données de balayage aérien vont déjà). </font><font style="vertical-align: inherit;">Nous vérifions le travail - il semble vivre. </font><font style="vertical-align: inherit;">Vous pouvez déclarer une victoire intérimaire.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/vd/fg/lyvdfgr98fqlrow-vtmumb4ucbw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant quelques semaines de travail ininterrompu - beaucoup de données à la fois sur les stations en direct et sur les clients. </font><font style="vertical-align: inherit;">Maintenant, je lutte contre la tentation d'offrir cet appareil aux spécialistes de la sécurité de l'information pour contrôler la diffusion dans les territoires confiés et à l'État pour contrôler la circulation des téléphones des citoyens. </font><font style="vertical-align: inherit;">C’est une blague, bien sûr, eux-mêmes savent déjà tout.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, toutes les épreuves décrites ci-dessus ne sont qu'un projet familier avec une très faible complexité (il était presque immédiatement clair quoi faire et comment), le manque de développement matériel (bonjour, physique) et l'accès à un produit un peu plus ou moins complet. </font><font style="vertical-align: inherit;">Non, bien sûr, il ne peut pas être exclu que l'auteur de ces lignes soit un amateur dense, et de vrais gourous vont de cette façon en une soirée entre le thé du soir et un verre de cognac, mais jusqu'à présent l'expérience n'a montré qu'une chose: l'informatique est compliquée et l'optimisme est puni financièrement et de réputation et motivationnellement, et ceux qui disent «tout est simple» sont des génies ou des escrocs, et le second est plus probable.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503364/index.html">HandsAppMVP: architecture iOS pour l'externalisation du développement de studio</a></li>
<li><a href="../fr503366/index.html">Pourquoi un tiret devient-il une question? Ou des problèmes avec le codage des données en SQL</a></li>
<li><a href="../fr503368/index.html">Gigantomania: pourquoi les jeux modernes pèsent-ils autant?</a></li>
<li><a href="../fr503372/index.html">Ethereum 2.0 peut être à nouveau retardé en raison d'erreurs, de problèmes et de concurrents</a></li>
<li><a href="../fr503380/index.html">Emplois asynchrones à Django avec céleri</a></li>
<li><a href="../fr503386/index.html">Coach agile personne en bonne santé</a></li>
<li><a href="../fr503388/index.html">Numérisation de la panique: DIT de Moscou contre les Moscovites - une table ronde le 23 mai</a></li>
<li><a href="../fr503390/index.html">Pourquoi Intel parie-t-il sur le développement de puces pour le génie de Jim Keller?</a></li>
<li><a href="../fr503394/index.html">Expérience d'investissement en actions</a></li>
<li><a href="../fr503398/index.html">Comment créer rapidement une modélisation thématique d'un forum ou ce qui dérange les personnes atteintes de la maladie cœliaque</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>