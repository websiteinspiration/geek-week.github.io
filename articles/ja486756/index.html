<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🔬 😮 💲 テスターのためのPython：小さなc pandasスクリプトが大規模なデータセットのテストにどのように役立つか ⛹🏼 🚵🏾 🏒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私はプロジェクトのテスターとして働いています。その本質は、さまざまなデータの収集と保存、およびそれらに基づくさまざまなレポートとファイルのアップロードの形成です。このようなレポートを生成する場合、データ選択のための多数の条件が考慮されるため、テスト時には、データベース内のSQLクエリで多くの作業を行...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>テスターのためのPython：小さなc pandasスクリプトが大規模なデータセットのテストにどのように役立つか</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486756/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はプロジェクトのテスターとして働いています。その本質は、さまざまなデータの収集と保存、およびそれらに基づくさまざまなレポートとファイルのアップロードの形成です。</font><font style="vertical-align: inherit;">このようなレポートを生成する場合、データ選択のための多数の条件が考慮されるため、テスト時には、データベース内のSQLクエリで多くの作業を行う必要があります。</font><font style="vertical-align: inherit;">しかし、データの正しい選択を確認し、過剰な/欠落したデータを検索するために、これはしばしば十分ではないので、これのための追加のツールを探す必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はすでにいくつかの基本的なpythonの知識を持っているので、既存のデータを使って何かを実行し、それによってテストプロセスを促進および高速化できる小さなスクリプトを書くことを試みることにしました。</font><font style="vertical-align: inherit;">この記事では、何が起こったのかを説明します。</font></font><br>
<a name="habracut"></a><br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトスクリプトの設計</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトを作成するには、スクリプトが正確に何を実行する必要があるか、どのデータを入力する必要があるか、どのデータを出力する必要があるかを理解する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シナリオのサンプル手順：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定の形式のデータを含むファイル（または複数のファイル）を取得します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルからデータを取得する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なデータを選択</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データに対していくつかの操作を実行します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要に応じて、Excelファイルにデータをアップロードします（通常、この形式は、さらに分析および保存するのに最も便利です）</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、入力を取得する方法と場所について考える必要があります。</font><font style="vertical-align: inherit;">手動で作成されたデータを含むファイル、UIへのフィルター付きファイルへのデータのアップロード、別のスクリプトを使用してデータを解析するファイル、SQLクエリの結果をデータベースにアップロードするファイル（データベースからcsvファイルにデータをすばやくアップロードできます）、json -fileまたはxml-file（APIへの要求への応答からのデータなど）</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはパンダや他のライブラリを使ってpythonでスクリプトを書きます</font></font></h3></b><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pythonで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
スクリプトを作成</font><font style="vertical-align: inherit;">するには、インタープリターと適切なIDEをインストールする必要があります。</font><font style="vertical-align: inherit;">また</font><font style="vertical-align: inherit;">、このプロジェクト用に</font><font style="vertical-align: inherit;">別の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想環境</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成することもお勧めします</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はスクリプトに異なるライブラリを使用しています。それらのいくつかは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組み込みのPythonライブラリであり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、いくつかは追加でインストールする必要があります：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パンダ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はデータ分析のためのライブラリです。</font><font style="vertical-align: inherit;">さまざまな形式のファイルのデータを操作したり、SQLクエリを使用してデータベースから直接データを受信したりできます。</font><font style="vertical-align: inherit;">ファイルからのデータはデータフレーム（視覚的にはExcelと同じテーブル）に読み込まれ、すでにさまざまな操作を実行できるデータが含まれています。SQLの結合/ユニオンと同様に、さまざまなデータフレームのデータを組み合わせ、必要なデータを選択します特定の条件下で、データフレームの異なる列のデータを比較します。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openpyxl、xlrd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Excelで作業するためのライブラリ。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
csv、json、Excelファイルからのデータを操作する最も簡単なスクリプトフレームワークは次のとおりです。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df = pd.read_csv(<span class="hljs-string">'./csv_file.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># df = pd.read_json('./json_file.json', encoding='utf-8')</span><font></font>
<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-comment">#    Excel-  -,     </span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment"># file_excel = 'Excel_file.xlsx'</span>
<span class="hljs-comment"># df = pd.ExcelFile(file_excel).parse('1')</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このスクリプトでは、必要な形式のファイルからのデータがデータフレームに読み込まれ、必要なデータが選択されていくつかの操作が実行された後、データが新しいExcelファイルに書き込まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースへのSQLクエリの結果として取得したデータを操作する必要がある場合、データをcsvファイルにエクスポートすることはできませんが、スクリプト自体でデータベースのSQLクエリを実行することにより、データフレームにすぐに取り込むことができます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-comment">#      ,     PostgreSQL</span>
<span class="hljs-comment"># (   -    )</span>
<span class="hljs-keyword">import</span> psycopg2<font></font>
<font></font>
<span class="hljs-comment">#    </span>
conn = psycopg2.connect(dbname=<span class="hljs-string">'_'</span>, host=<span class="hljs-string">''</span>, port=<span class="hljs-string">''</span>,<font></font>
                        user=<span class="hljs-string">''</span>, password=<span class="hljs-string">''</span>)<font></font>
<font></font>
<span class="hljs-comment">#   SQL-</span>
q = <span class="hljs-string">"""select ... 
    from ... 
    where ..."""</span><font></font>
<font></font>
<span class="hljs-comment">#    -,  SQL-</span><font></font>
df = pd.read_sql_query(q, conn)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">#  -     -  </span>
<span class="hljs-comment">#    - final_df</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,  </span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
final_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XMLファイルからデータを取得する必要がある場合は、このために設計されたライブラリを使用できます。</font><font style="vertical-align: inherit;">組み込みライブラリ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ElementTree</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データがデータフレームで受信されると、すぐに別のデータフレームからのデータ（SQLの結合またはユニオンのアナログ）と結合するか、または特定のセルで重複を削除したり、空の値を持つ行を削除したりするなどの操作を実行できます。 、複数の列のデータを比較し、目的の行/列を選択します。</font><font style="vertical-align: inherit;">詳しくはパンダのドキュメントをご覧ください。</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト使用オプション</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、テスターのメインツールをオンにして、プロジェクトのデータ/機能を選択します。このようなスクリプトがどの検証に役立つかを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
generatedataを使用して</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">された少量のテストデータを含むファイルは、スクリプト用に作成されました</font><font style="vertical-align: inherit;">。実際には、データファイルには数万行と多数の列が含まれています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シナリオ＃1</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
データを含むcsv形式のファイルが3つあります。各データ行には、一意の識別子IDを持つフィールドがあります。これらのファイルからのデータは、特定の条件を考慮して選択され、データベースのテーブルに入力されます。これらのデータは、UIのテーブルの形式でレポートに表示されます。 UI上のデータをExcelファイルにアップロードできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースファイルからレポートのデータを選択するための条件が次のとおりであるとします。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルはIDごとに重複する可能性があります。レポートでは、同じ識別子のレコードは1回だけ考慮されます（同時に、データからこの識別子の行のいずれか1つを選択するだけです）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg_date列のセルにデータがない行はカウントされません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際、より多くの選択条件がある可能性があります。また、データはシステム内の既存のデータと比較でき、IDで交差するデータのみがレポートに表示されますが、たとえば、上記の2つの条件のみを考慮します。</font></font></li>
</ul><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスターのタスク：</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なオブジェクトを含む行がソースファイルから正しく選択されていること、およびこれらのすべてのオブジェクトがUIのレポートに表示されていることを確認します。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトのスクリプトを作成します。</font></font></u><br>
<br>
<ul>
<li>  -      csv-,     - (   union  SQL),      id,       reg_date.</li>
<li>  UI     Excel-,   ,       -.</li>
<li> (merge)   -   (   outer join  SQL)          Excel-   .</li>
<li>              ,   ,   -   ,      ,   UI.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終的なファイルでは、異なるデータフレームの列の名前が一致した場合、データにはidを持つ列が1つだけ含まれ、どのファイルのどの列/行であるかが明確にならない場合があります。</font><font style="vertical-align: inherit;">したがって、ファイルに異なる名前で一意の識別子を付けて列に名前を付けるか、個別の列「そのようなファイルからの行」を各ファイルに追加して「はい」を入れます-結果のExcelファイルを分析するとき、この列でフィルターすると便利ですなぜなら </font><font style="vertical-align: inherit;">それらには常に値が含まれており、それらによってフィルタリングすると、対応する列でどのデータが分岐しているかをすでに理解できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example1_csv_1.csv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からのサンプルデータ</font><font style="vertical-align: inherit;">：</font><i><font style="vertical-align: inherit;">report_UI.xlsx</font></i></font><br>
<br>
<img src="https://habrastorage.org/webt/of/5j/_u/of5j_us3u07uset3ljspbbwtrr4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ファイルからのサンプルデータ</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
Pythonスクリプトは次のようになります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/xy/1s/uhxy1sygvioxbbhlksppdpsar_e.png"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#     csv-    -</span>
<span class="hljs-comment"># (        )</span>
df_from_file1 = pd.read_csv(<span class="hljs-string">'./example1_csv_1.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file2 = pd.read_csv(<span class="hljs-string">'./example1_csv_2.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>,<span class="hljs-string">'reg_date'</span>])<font></font>
df_from_file3 = pd.read_csv(<span class="hljs-string">'./example1_csv_3.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>,<font></font>
                            usecols=[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'reg_date'</span>])<font></font>
<font></font>
<span class="hljs-comment">#    -    - </span>
<span class="hljs-comment"># (   union  SQL)</span><font></font>
df_from_csv = pd.concat([df_from_file1, df_from_file2, df_from_file3]).\<font></font>
    reset_index(drop=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#       </span>
df_from_csv.drop_duplicates(subset=<span class="hljs-string">'id'</span>, keep=<span class="hljs-string">'first'</span>, inplace=<span class="hljs-literal">True</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#     NaN ( )   reg_date</span><font></font>
df_from_csv = df_from_csv.dropna()<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-   UI  -,</span>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (        )</span>
file_excel = <span class="hljs-string">'report_UI.xlsx'</span>
df_from_excel = pd.ExcelFile(file_excel).parse(<span class="hljs-string">'1'</span>)<font></font>
print(df_from_excel)<font></font>
<font></font>
<span class="hljs-comment">#  -     - </span>
<span class="hljs-comment"># -       UI</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_excel, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">""</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#     Excel-</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制限：</font></font></u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>   (  Excel)  /           ,            .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シナリオNo. 2</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このセクションには、単一のソースからの特定のオブジェクトのテーブル形式のデータが含まれています。システムは2番目のソース（統合）からデータを受け取り、既存のテーブルデータをこのデータで更新します。テーブルの各レコードは、一意の識別子を持つ1つのオブジェクトのデータです。新しいソースからの識別子によるオブジェクトのデータが既存のオブジェクトのデータと一致する場合、既存のレコードのすべてのフィールドが新しいソースからのデータで更新されます（確認済み）。テーブルに2番目のソースからの識別子を持つオブジェクトがまだない場合、新しいレコードがテーブルに作成され、新しいソースからのデータが含まれます。 2番目のシステムのデータは、事前にjsonファイルにアップロードできます。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスターのタスク：</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事前にテスト用のデータを含むファイルを準備し、既存のレコードが正しく更新され、識別子による一致がある場合はデータベースに確認サインが添付されていること、および新しいレコードが正しく作成され、そのようなレコードがある場合はデータベースに追加するという印が付けられることを確認するため識別子はまだありませんでした。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトのスクリプトを作成します。</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データをパーティションテーブルからUIのExcelファイルにアップロードします（これが不可能な場合は、コードで使用されているSQLクエリの結果からデータをいつでもエクスポートして、UIのこのテーブルにデータを出力できます）。そのデータを最初のデータフレームに入力します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目のソースからデータを含むjsonファイルを取得し、2番目のデータフレームにロードします。</font></font></li>
<li>  (merge —    outer join  SQL)    -    -          Excel-,        .      ,        ,      .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>               (  ,       30 000 ).</li>
<li>  json-     /  –           /,    -   json-   pandas        /.</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シナリオ3</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
json形式のオブジェクトに関するどのデータが受信されたかに応じて、システムAPIに対して要求が行われます。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスターのタスク：</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> APIへの要求に対する応答からのデータを、データベース内のSQLクエリの結果からのデータと比較します。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトのスクリプトを作成します。</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースでSQLクエリを実行し、クエリ結果からcsvファイルにデータをエクスポートし、このデータを最初のデータフレームに読み込みます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIへのリクエストに対する応答からのデータをjsonファイルに保存し、ファイルから2番目のデータフレームにデータをロードします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信した2つのデータフレームのデータ（SQLの外部結合とのマージによる）を一意の識別子によって1つの新しいデータフレームに結合し、そのデータをExcelファイルにアンロードします。このファイルでは、次の関数を使用して列ごとにデータを比較します。エクセル</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または、一般的なデータフレームの列のデータをパンダを使用して比較し、列内の同じ/異なるデータを含む行を新しいデータフレーム/ Excelファイルにアンロードして分析できます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下からのデータ例</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example3_csv.csvの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/e6/xz/zxe6xzjff9vbfwgntsfqb-qyykc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
から例のデータ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example3_json.jsonの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16421118-4116"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Tempor Consulting"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"Nullam.lobortis.quam@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-821-805-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"12-11-16"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Natales"</span><font></font>
    },<font></font>
    {<font></font>
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"16040210-2206"</span>,
        <span class="hljs-attr">"name_json"</span>: <span class="hljs-string">"Odio Etiam Incorporated"</span>,
        <span class="hljs-attr">"email_json"</span>: <span class="hljs-string">"arcu@***"</span>,
        <span class="hljs-attr">"tel_json"</span>: <span class="hljs-string">"1-730-291-****"</span>,
        <span class="hljs-attr">"reg_date_json"</span>: <span class="hljs-string">"26-06-05"</span>,
        <span class="hljs-attr">"city_json"</span>: <span class="hljs-string">"Viddalba"</span><font></font>
    },<font></font>
...<font></font>
]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonスクリプトは次のようになります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
<span class="hljs-comment"># (        )</span>
<span class="hljs-comment">#       csv-     ";"</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example3_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#    json-  -</span>
<span class="hljs-comment"># (        )</span>
df_from_json = pd.read_json(<span class="hljs-string">'./example3_json.json'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_json)<font></font>
<font></font>
<span class="hljs-comment">#  -    -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df_csv_json = df_from_csv.merge(df_from_json, left_on=<span class="hljs-string">'id'</span>, <font></font>
                                right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df_csv_json)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-,   ,</span>
<span class="hljs-comment">#      -   ,</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
<span class="hljs-comment"># writer = pd.ExcelWriter('.xlsx')</span>
<span class="hljs-comment"># df_csv_json.to_excel(writer, '1')</span>
<span class="hljs-comment"># writer.save()</span><font></font>
<font></font>
<span class="hljs-comment">#       </span>
<span class="hljs-comment"># (, name_csv  name_json) </span>
<span class="hljs-comment">#       Excel-  </span>
<span class="hljs-comment"># (        )</span>
unequal_data_df = df_csv_json.loc[df_csv_json[<span class="hljs-string">'name_csv'</span>] != <font></font>
                                  df_csv_json[<span class="hljs-string">'name_json'</span>]]<font></font>
unequal_data_df = unequal_data_df[[<span class="hljs-string">'id'</span>, <span class="hljs-string">'name_csv'</span>, <span class="hljs-string">'name_json'</span>]]<font></font>
print(unequal_data_df)<font></font>
<font></font>
writer = pd.ExcelWriter(<span class="hljs-string">'_name.xlsx'</span>)<font></font>
unequal_data_df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
<font></font>
</code></pre><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制限：</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常に多数の行を持つファイルを操作する場合、それらを別々のファイルに分割する必要があります（ここで試す必要があるのは、私が30,000行を超えるファイルがほとんどないためです）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jsonファイルにオブジェクト/データ配列のネストのレベルが複数ある場合、それらは内部レベルからオブジェクト/配列としてセルに読み込まれるため、パンダを使用したjsonファイルの操作は、オブジェクトを過度にネストしないデータに対してのみ便利です。 /配列。</font></font></li>
<li>       API         SQL-  ,             SQL-   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIへのリクエストへの応答がxml形式の場合、まずElementTreeまたは別のライブラリを使用してxmlファイルから必要なデータを解析し、それをデータフレームにロードする必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シナリオNo. 4</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
UIで、オブジェクトに関するデータを含むxmlファイルがダウンロードされます。これは、特定の条件（たとえば、オブジェクトのステータス、日付、年、またはその他のパラメーター値が考慮される）に従って、データベースのデータからその場で生成されます。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスターのタスク：</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会社タグの属性にあるxmlファイルからのオブジェクトの一意の識別子IDを、データベース内のSQLクエリの結果からのオブジェクトの識別子と比較します。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトのスクリプトを作成します。</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIへのリクエストに対する応答からのデータをxml-fileに保存し、ElementTreeライブラリを使用してこのファイルから必要なデータを取得し、データを最初のデータフレームにロードします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースでSQLクエリを実行し、クエリ結果からcsvファイルにデータをエクスポートし、このデータを2番目のデータフレームに読み込みます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つの受信データフレームからのデータ（マージ-SQLの外部結合と同様）を一意の識別子によって1つの新しいデータフレームに結合し、そこからExcelファイルにデータをアンロードします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、結果のファイルを開き、データ行を分析します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下からのデータ例</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example4_csv.csvの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gb/zk/ou/gbzkou2bivh2gsnk6do0lthh1_g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
から例のデータ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example4_xml.xmlの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/x4/no/zhx4noe3virrsagqnaduwpqyp_w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなPythonスクリプトのルックス：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   ElementTree</span>
<span class="hljs-keyword">from</span> xml.etree <span class="hljs-keyword">import</span> ElementTree
<span class="hljs-comment">#   pandas</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
<span class="hljs-comment">#    xml-   </span>
<span class="hljs-comment"># (        )</span>
tree = ElementTree.parse(<span class="hljs-string">"example4_xml.xml"</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
root = tree.getroot()<font></font>
<font></font>
<span class="hljs-comment">#  ,     </span><font></font>
data_list = []<font></font>
i = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#    -   id_type1  id_type2</span>
<span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">"companies"</span>):
    <span class="hljs-keyword">for</span> child_1 <span class="hljs-keyword">in</span> child.iter(<span class="hljs-string">"company"</span>):<font></font>
            data_list.append({<span class="hljs-string">""</span>: i, <span class="hljs-string">"id"</span>: child_1.get(<span class="hljs-string">"id_type1"</span>)
                                                <span class="hljs-keyword">or</span> child_1.get(<span class="hljs-string">"id_type2"</span>), 
                              <span class="hljs-string">"  xml"</span>: <span class="hljs-string">""</span>})<font></font>
            i += <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#     data_list  -</span>
df_from_xml = pd.DataFrame.from_dict(data_list, orient=<span class="hljs-string">'columns'</span>)<font></font>
print(df_from_xml)<font></font>
<font></font>
<span class="hljs-comment">#    csv-  -</span>
df_from_csv = pd.read_csv(<span class="hljs-string">'./example4_csv.csv'</span>, sep=<span class="hljs-string">';'</span>, encoding=<span class="hljs-string">'utf-8'</span>)<font></font>
print(df_from_csv)<font></font>
<font></font>
<span class="hljs-comment">#  -   -</span>
<span class="hljs-comment"># (   outer join  SQL)</span>
df = df_from_csv.merge(df_from_xml, left_on=<span class="hljs-string">'id'</span>, right_on=<span class="hljs-string">"id"</span>, how=<span class="hljs-string">'outer'</span>)<font></font>
print(df)<font></font>
<font></font>
<span class="hljs-comment">#    Excel-</span>
<span class="hljs-comment">#          </span>
<span class="hljs-comment"># (      )</span>
writer = pd.ExcelWriter(<span class="hljs-string">'.xlsx'</span>)<font></font>
df.to_excel(writer, <span class="hljs-string">'1'</span>)<font></font>
writer.save()<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シナリオ5</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
UIで、セクションはオブジェクトのデータをテーブルの形式で表示します。</font><font style="vertical-align: inherit;">Excelファイルにデータをアップロードすることが可能です。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスターのタスク：</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティションテーブルのデータとExcelファイルにダウンロードされたデータを比較します。</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトのスクリプトを作成します。</font></font></u><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIのパーティションテーブルにデータを出力するコードから、データベース内のSQLクエリを開発者に求めます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このSQLクエリをデータベースで実行し、データをcsvファイルにアップロードし、そこから最初のデータフレームにデータをロードします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティションテーブルからUI上のExcelファイルにデータをアップロードし、そこから2番目のデータフレームにデータを読み込みます。</font></font></li>
<li>  (merge —    outer join  SQL)    -    -          Excel-,             Excel.</li>
<li>      -     pandas,      /      -/Excel-  .</li>
</ul><br>
<u>:</u><br>
<br>
<ul>
<li>    ,     Excel-  UI, ,         ,          .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、同様のスクリプトを使用して、jsonファイルまたはcsvファイルからExcelファイルにデータを転送することもできます。</font><font style="vertical-align: inherit;">または、特定の列にある複数のExcelファイルのデータを組み合わせて、1つの新しいExcelファイルにアップロードすることもできます。</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらは、python + pandasを使用してテストプロセスを高速化し、バグを見つける方法のほんの数例です。</font><font style="vertical-align: inherit;">実際、パンダはデータを操作する機会がはるかに多いので、このライブラリのドキュメントで詳細を読むことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、プロジェクトにはそのようなスクリプトを使用するための他のオプションがあり、この記事はテスターの作業でそれらを使用し始めるのに役立ちます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja486744/index.html">スマートな国産姿勢補正器を発売。新製品を見ました-IBACK</a></li>
<li><a href="../ja486746/index.html">書いて、カットしないでください。Habrの出版物で見逃したもの</a></li>
<li><a href="../ja486750/index.html">シリーズ「For All Mankind」：オルタナティブストーリーからゴミまで</a></li>
<li><a href="../ja486752/index.html">ESP8266を使用する一意のWSGI Webサーバー。パート1</a></li>
<li><a href="../ja486754/index.html">JIRA：要件管理</a></li>
<li><a href="../ja486760/index.html">Security Week 06：モバイルアプリケーションでのトラッカーの広告</a></li>
<li><a href="../ja486762/index.html">ベッドサイドホスティング：ホームホスティングの不気味な習慣</a></li>
<li><a href="../ja486764/index.html">Do-it-yourself Schema.org：プログラマーなしでのマイクロレイアウトのカスタマイズ</a></li>
<li><a href="../ja486766/index.html">古いファクタリング市場ですべてのトランザクションをオンラインで転送する方法は？Sberbank Factoringの経験</a></li>
<li><a href="../ja486768/index.html">Webasyst管理パネルの改訂</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>