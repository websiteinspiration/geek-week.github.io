<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µ ‚ò†Ô∏è üëñ DEFCON 27 Konferenz. Buttplug: True Penetration Testing. Teil 1 ‚úçüèª ü¶É üëàüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Analysten gehen davon aus, dass es derzeit etwa 10 Milliarden Ger√§te aus dem Internet der Dinge (IoT) gibt. Manchmal gewinnen diese Ger√§te ihren Platz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DEFCON 27 Konferenz. Buttplug: True Penetration Testing. Teil 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495378/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analysten gehen davon aus, dass es derzeit etwa 10 Milliarden Ger√§te aus dem Internet der Dinge (IoT) gibt. Manchmal gewinnen diese Ger√§te ihren Platz auf dem Markt und klettern buchst√§blich auf menschliche √Ñrsche. Wie sich herausstellte, eignen sich billige und stromsparende Funkchips nicht nur hervorragend f√ºr die Heimautomation, sondern ver√§ndern auch die Art und Weise, wie Menschen mit Sexspielzeug umgehen. In diesem Bericht tauchen wir in die Welt der Fernsehdildonik ein, der Technologie des Sex in einer Entfernung, in der Tast-, Temperatur- und andere Empfindungen zwischen Partnern √ºber eine bidirektionale Kommunikationsleitung √ºbertragen werden. Der Sprecher wird erkl√§ren, dass die Sicherheit von elektronischen elektronischen Analsexspielzeugen von Buttplug einem Angreifer entgegengesetzt werden kann, der auf jeder Ebene des Stapels Schwachstellen findet und ausnutzt. Letztendlich k√∂nnen dadurch die Sextoys selbst kompromittiert werden.und die Ger√§te, mit denen sie verbunden sind.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Hacker mit dem Spitznamen smea oder Smealum begann seine Karriere als Entwickler von Videospielen f√ºr Spielekonsolen wie den Nintendo DS und versuchte gleichzeitig, sie zu knacken. Irgendwann erwarben die Konsolen ernsthafte Sicherheitssysteme, und Smea wechselte von selbst entwickelter Software zur Entwicklung von Techniken, um diese zu brechen. Smea ist bekannt f√ºr seine ‚ÄûArbeit‚Äú an Nintendo 3DS und Wii U, hat aber auch zur Entwicklung von Exploits f√ºr die beliebtesten Webbrowser und Virtualisierungsstacks beigetragen. Wahrscheinlich interessierte er sich jetzt daf√ºr, in ‚Äûintelligente‚Äú Analplugs einzubrechen.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo allerseits, ich bin Smia und heute werden wir dar√ºber sprechen, wie man einen Boot-Plug knackt. Dies ist ein Objekt, das ich in meiner Hand halte, ich wei√ü nicht, ob Sie es schon einmal gesehen haben, ich pers√∂nlich nicht. Aber in den letzten 2 Jahren habe ich viele interessante Vertreter der IoT-Branche getroffen, und jetzt ist die Wende gekommen. Sie fragen sich vielleicht, wie Sie eine Bootplag knacken k√∂nnen, weil es nur ein St√ºck Silikon ist, das irgendwo eingesetzt werden muss, und Sie werden zustimmen, dass es daf√ºr nicht viele Stellen gibt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich erfordert dies keine Elektronik. Aber in den letzten Jahren oder sogar Jahrzehnten ist eine neue Industrie elektronischer Ger√§te namens Teledildonika entstanden. Der Ursprung dieses Begriffs ist auf der Folie dargestellt: Das griechische Wort "tele" bedeutet "aus der Ferne", und der englische "Dildo" bedeutet nichts weiter als einen Dildo. Ich habe versucht, den Ursprung des Wortes Dildo zu finden, aber niemand wei√ü, woher es kommt. Aber das ist verst√§ndlich, oder? Die Idee ist, dass Sie Sexspielzeug herstellen m√∂chten, das irgendwie aus der Ferne gesteuert werden kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hierf√ºr gibt es mehrere Szenarien. Ich m√∂chte Ihnen nur erkl√§ren, wie dies funktioniert, da nicht jeder mit solchen Ger√§ten vertraut ist. Sie nehmen also das Bootplag, setzen es bei Bedarf ein und k√∂nnen es von √ºberall aus fernsteuern - von Ihrem Telefon, Laptop usw. Dies ist das erste Szenario namens "Solospiel". Das zweite Szenario, das ich "lokaler Multiplayer" genannt habe - dies ist, wenn Sie die Kontrolle √ºber dieses Ding an jemand anderen √ºbertragen. Dies ist eine ziemlich reale Sache, f√ºr die oft geworben wird - Sie k√∂nnen zum Beispiel mit ihr in eine Bar gehen und niemand wird wissen, wie viel Spa√ü es macht. Technisch gesehen entsteht dadurch ein neuer Angriffsvektor, da Sie einem Au√üenstehenden die Kontrolle √ºber das Ger√§t geben und sich hier das Bedrohungsmodell wirklich √§ndert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das dritte Szenario, "Remote Multiplayer", √§hnelt dem zweiten, nur dass Sie jetzt einer anderen Person erlauben, das Ger√§t √ºber das Internet zu steuern. Denken Sie daran, dass diese Person ein Fremder sein kann. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/nb/hr/mnnbhrbihysuf1iengokudmgudm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr viele sieht Sex aus der Ferne ziemlich cool und lustig aus, und ich werde nicht dar√ºber scherzen. Einige verwenden Teledildonik, um ihren Lebensunterhalt zu verdienen, und Szenario 3B wird als "Remote Paid Multiplayer" bezeichnet. Daher ist die Tatsache, dass ich versuche, den Butt Plug zu knacken, nicht nur Unterhaltung - sie gibt meinen Penetrationsstudien eine gewisse Rechtfertigung.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gn/g0/m4/gng0m40-kjudzygpgp6fkeczt_i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viele Menschen, ich wei√ü nicht, wie ich sie nennen soll - Jungen, M√§dchen - bieten dynamische sexuelle Unterhaltung im Internet, sodass andere Menschen ihre Sexspielzeuge gegen Geld kontrollieren k√∂nnen. Das Unternehmen, das diese Stummel herstellt, hat ein Patent f√ºr das Konzept des Gewinnabzugs bei der Verwendung seiner Produkte f√ºr Sexspiele im Internet. In diesem Szenario haben Sie f√ºr 5 USD Abz√ºge das Recht, einen Link zu platzieren, z. B. auf Twitter, um jemandem die M√∂glichkeit zu geben, Ihre Bootplag f√ºr eine begrenzte Zeit zu verwalten. Da sich die Menschen auf diese Spielzeuge als Mittel zum Geldverdienen verlassen, ist es meiner Meinung nach sehr wichtig, ihre Sicherheit zu ber√ºcksichtigen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns Szenarien an, die f√ºr Angreifer von Interesse sind. Der erste ist ein lokaler Hack, bei dem ein Angreifer, der sich in Reichweite des Ger√§ts befindet, die Kontrolle √ºber das Ger√§t √ºber drahtlose Kommunikation abf√§ngt. Es wurde viel √ºber diese Hacking-Methode geforscht, sodass wir uns nicht darauf konzentrieren m√ºssen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/wb/8g/gywb8gehwmsgsmf_5pra4m_lmr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Technisch gesehen kann eine solche Intervention als sexueller Missbrauch angesehen werden. Versuchen Sie also nicht, ob dies legal ist oder nicht. Gem√§√ü dem folgenden Szenario macht ein Angreifer dasselbe, jedoch remote, √ºber das Internet. Wie ich bereits sagte, wenn Sie so verdienen, k√∂nnen Sie sehr gut freiwillig einen Fremden zur Verf√ºgung stellen - einen Angreifer mit Fernzugriff auf Ihr Sexspielzeug.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies bedeutet, dass ein Hacker Ihre "intelligenten" Sexspielzeuge oder verwandte Ger√§te kompromittieren kann, kurz gesagt, Ihnen etwas B√∂ses antun kann, und dies ist v√∂llig legal, da Sie ihm selbst Zugriff gew√§hrt haben. F√ºr einen Hacker ist dies eine interessantere Option, daher bleiben wir etwas l√§nger dabei. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/cb/hz/8vcbhzhmae_kgh9ka8v37s2jg_8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das dritte Szenario ist das Gegenteil: Der Angreifer selbst verwendet das Boot-Plug-In, um die Kontrolle √ºber einen Computer oder ein Telefon zu √ºbernehmen und Ger√§te zu hacken, die sich auf der Seite des Benutzers befinden, der mit dem Plug-In remote an Spielen teilnimmt. Die Leute verstehen nicht, dass dies ein echtes Risiko ist, aber Sie stellen sich wahrscheinlich vor, wie heimt√ºckisch Buttplugs sein k√∂nnen (Lachen in der Halle). Wir untersuchen auch dieses Szenario.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vn/tv/sr/vntvsrxrvefsyh_y7k48hqd7fiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie sich ein Bild von der Welt der Teledildonik gemacht haben, schauen wir uns an, wie es in der Praxis aussieht. Auf der Folie sehen Sie ein Dildomodell namens Lovense Hush, und sp√§ter werde ich Ihnen eine Demo mit diesem Ding in der Luft zeigen. Dies ist das weltweit erste Modell der Dildoteledildonik, ein Analplug, der von Ihrem Telefon oder Computer aus gesteuert werden kann. Es gibt Anwendungen f√ºr IoS und Android f√ºr dieses Boot-Plag. Sie k√∂nnen es von einem Computer aus steuern, auf dem Mac OS und Windows ausgef√ºhrt werden. Mobile Anwendungen unterst√ºtzen soziale Funktionen wie Chatten, Teilen von Text, Bildern, Videos und Steuern von Spielzeug mit Freunden oder Fremden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/ry/zq/b-ryzqagf71doiiyxeoj_hzvzm8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr Windows ben√∂tigen Sie einen speziellen USB-Stick, den ich sp√§ter zeigen werde, da dieses Boot-Plug-In jetzt mit meinem Computer verbunden ist. Der elektronische Flash-Drive-Schl√ºssel wurde von derselben Firma, "Lovens", entwickelt, einem Hersteller eines Boot-Plug-Ins, das ein eigenes √ñkosystem von "intelligenten" Dildos erstellt hat und f√ºr eine Sitzung im Internet etwa 5 US-Dollar Provision ben√∂tigt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bv/lg/dl/bvlgdlcsp4qckbaej8gps_szkua.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende Folie zeigt meine Vision eines Angriffs auf einen Boot-Plug mit einer PC-Anwendung. Zwischen dem Startstecker und dem USB-Stick besteht eine BLE-Verbindung (BlueTooth Low Energy). Der Schl√ºssel ist mit dem Computer des Benutzers verbunden, der wiederum mit dem Internet verbunden ist. Szenario Nr. 1 wird von einem Angreifer im Bereich Boot-Plug-USB-Key verwendet, dh die BLE-Verbindung wird angegriffen. Tats√§chlich gibt es keinen Schutz, so dass jeder Fremde die Kontrolle √ºber dieses Spielzeug √ºbernehmen kann. Letztes Jahr gab es eine ernsthafte Diskussion √ºber ein Tool namens BTLE Jack, mit dem Sie eine solche Verbindung erfolgreich angreifen k√∂nnen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l_/ma/24/l_ma24foabt77cti9__dmq7ufam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Szenario Nr. 2 besteht darin, einen Teil der Internetverbindung eines Benutzers anzugreifen. Das dritte Szenario ist ein Versuch, sich in eine der drei Sites zu hacken: BLE, USB, Internet. Es ist wahrscheinlich, dass es ein offenes Projekt gibt. Buttplug ... Sie k√∂nnen lachen, es war ein Witz. Wo fangen wir also mit unseren ‚Äûechten Penetrationstests‚Äú an?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cj/ov/21/cjov21ngohs6fh0gqaccbp2mdn0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe keine Codes oder Bin√§rdateien f√ºr den Dildo und den Dongle selbst gefunden, aber es gibt bin√§re Anwendungsdateien f√ºr mobile Ger√§te und einen Computer, die im Internet heruntergeladen werden k√∂nnen. Ich habe diese Dateien auf meinem Computer installiert und angefangen, daran zu arbeiten. Auf der n√§chsten Folie sehen Sie die Anwendungsoberfl√§che zum Verwalten des Boot-Plug-Ins. In der Mitte des Bildschirms befindet sich ein Schieberegler zum Einstellen der Vibration des Spielzeugs. Links befindet sich das Bedienfeld mit den Tasten - Zugriff auf das Konto, Steuermodus im lokalen Netzwerk, Fernbedienungsmodus √ºber das Internet. Um die Struktur der Anwendung zu verstehen, m√ºssen Sie nur etwas verwirrenden JavaScript-Code lesen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/tc/l_/gytcl_o4cfm0iolamia3r6cfryo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mag JavaScript nicht, aber was gut daran ist, ist das Vorhandensein einer Reihe von Variablennamen und Objektfeldnamen, und all dies ist perfekt r√ºckentwickelt. Legen Sie einfach den Code in Beautifier ab und finden Sie heraus, wie es funktioniert. Sobald Sie dies getan haben, k√∂nnen Sie beginnen, die Funktionsweise des elektronischen Schl√ºssels zu verstehen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fp/km/1s/fpkm1shgzrwislgaj09vm2ileg8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich herausfand, dass dies nur eine serielle Schnittstelle f√ºr die Verbindung √ºber USB ist, fing ich an, den Datenverkehr zwischen dem Schl√ºssel und der Anwendung zu √ºberwachen. Achten Sie auf die Zeilen rechts von der Folie. Zun√§chst stellte ich fest, dass die Nachrichten zwischen dem Dongle und der Anwendung im JSON-Textformat vorliegen. F√ºr JavaScript-Code ist dies bekannt, aber f√ºr einen USB-Stick, bei dem es sich um einen 32-Bit-Mikrocontroller handelt, sieht das Einbetten des JSON-Parsers seltsam aus ... F√ºr uns ist dies sehr praktisch, da JSON-Parser normalerweise Firmware-Fehler enthalten, die verwendet werden k√∂nnen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/5r/rk/hj5rrk2imjq5byefebbencwwmsg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Auffinden von Fehlern ohne den Schl√ºsselcode selbst ist jedoch eine m√ºhsame Aufgabe. Da ich jedoch den Anwendungscode hatte, suchte ich nach einem Mechanismus zum Aktualisieren der USB-Schl√ºssel-Firmware und fand bald das, was ich wollte - die URL des Aktualisierungsknotens. Es stellte sich heraus, dass die Firmware in keiner Weise verschl√ºsselt oder signiert war, also habe ich sie einfach heruntergeladen und eine Bin√§rdatei zur Analyse erhalten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/q7/vs/xcq7vsjbakxsctt8th2gd_fwhni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann begann ich mit dem Reverse Engineering und machte auf zwei Dinge aufmerksam. Erstens gibt es 2 Befehlshandler f√ºr den seriellen USB-Anschluss. Der erste verwendet einfache Befehle wie Zur√ºcksetzen oder Ger√§tetyp, der zweite verwendet Befehle wie DFU, um die Firmware des Ger√§ts zu aktualisieren, sodass wir diese Befehle senden und die Firmware aktualisieren k√∂nnen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/ol/b-/oyolb-kfxvjs8uq4ccxmvyrowdw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich mir den JSON-Parser angesehen hatte, der f√ºr uns am interessantesten ist, entdeckte ich den erwarteten Fehler - die parseJsonString-Funktion. Es muss nur eine Kopie der urspr√ºnglichen Zeichenfolge in einem neuen Puffer zuweisen und auch mit Dingen wie Escape-Sequenzen arbeiten. Bei der Berechnung der L√§nge des neuen Puffers stimmt diese nicht mit der tats√§chlich verwendeten L√§nge √ºberein. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/n7/vw/pon7vwgs51_0b0xicll5adjy0km.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Funktion funktioniert folgenderma√üen: Sie unterst√ºtzt eine Escape-Sequenz von 5 Parametern U, anstatt sie erwartungsgem√§√ü mit 0 gleichzusetzen. Dank dieser Funktion k√∂nnen wir eine nullterminierte Zeichenfolge vermeiden und die L√§nge der ersten berechneten Zeichenfolge falsch machen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/am/4y/lgam4y0v4ijpkvue8j2snjfr7xm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese kleine Animation zeigt, was hier passiert. Der Backslash vor U bedeutet, dass 6 Zeichen verworfen werden m√ºssen. Als n√§chstes springt die Funktion durch den Nullterminator, was ein Problem darstellt. Dann wird der Prozess fortgesetzt, alle Zeichen werden kopiert und fallen mit einer L√§nge von nur 6 Bytes in den Puffer. Hier tritt das zweite Problem auf - das Risiko eines Puffer√ºberlaufs. Das ist gro√üartig, aber wir wissen immer noch nicht, wie die Dongle-Hardware funktioniert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/ea/hl/wjeahlydyx11z5kl0e_entwcoiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir wissen mit Sicherheit, dass es keine Randomisierung des ASLR-Adressraums und keinen Cookie-Stack gibt, aber es ist m√∂glich, dass der Schl√ºssel einen Schutz wie die Verhinderung der DEP-Datenausf√ºhrung oder einen XN-Schutz hat, der die Codeausf√ºhrung im Speicher verhindert, mit Ausnahme des Textbereichs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Schl√ºssel ist mit einem NRF51822-SoC-Chip mit einem Cortex M0-Prozessor ohne DEP-Schutz ausgestattet, der f√ºr BLE-Ger√§te sehr beliebt ist und mit einer Reihe von Debugging-Kontakten ausgestattet ist. Daher ist es recht einfach, eine Verbindung zu diesem Schl√ºssel herzustellen, indem einige Dinge daran angel√∂tet werden, und das Debuggen √ºber die Schnittstelle zum Debuggen und Flashen von SWD-Chips durchzuf√ºhren, wenn dies in den Werkseinstellungen nicht deaktiviert ist. Durch die Verbindung √ºber SWD k√∂nnen wir den Heap-Inhalt leeren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass es nur f√ºr den JSON-Parser verwendet wird, der nicht sehr cool ist, aber der Heap enth√§lt Metadaten. Was kann hier also verw√∂hnt werden? Nat√ºrlich Heap-Metadaten! Auf diese Weise erstellen wir einen Exploit f√ºr den JSON-Parser.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qw/9o/zh/qw9ozhk_k6ixcm_iupcoyvun3xa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Haufen ist nur eine freie Liste. Wenn Sie sich diesen Code ansehen, k√∂nnen Sie sehen, dass jede Distribution ihre eigene L√§nge und ihren eigenen Zeiger hat. Wenn Sie einen Puffer√ºberlauf verwenden, k√∂nnen Sie die L√§nge und Position des n√§chsten Zeigers verderben, wodurch Sie die Position der n√§chsten Verteilung steuern k√∂nnen. Durch Kopieren einer neuen Zeile k√∂nnen Sie beliebige Daten einfach an einer beliebigen Stelle anordnen. All dies kann durchgef√ºhrt werden, w√§hrend der Debugger verbunden ist. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tb/hk/y7/tbhky7ub8kj5cbgpjhmrl-frong.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der rechten Seite der Folie sehen Sie einen Stapel, der zur√ºckgesetzt und mit nur 8 Zeichen vollst√§ndig √ºberschrieben wird. Dies gibt uns die Ausf√ºhrung des USB-Schl√ºsselcodes, was ziemlich cool ist.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich erinnerte mich, dass dieser Dongle leider einen DFU-Notfall-Firmware-Aktualisierungsmodus hat. Ich habe erwartet, dass dieser Modus in Analogie zu Hacking-Spielekonsolen dazu dient, das Update auf jede m√∂gliche Weise zu authentifizieren. Es stellt sich heraus, dass die DFU hier die klassische CRC16-Pr√ºfsummenberechnung verwendet, die, wenn Sie die Kryptographie verstehen, keinerlei Authentifizierung darstellt. Ich glaube nicht, dass sie in diesem Fall wirklich die Authentifizierung verwenden wollten. H√∂chstwahrscheinlich haben sie nur entschieden, dass nur wenige Leute daran interessiert sind, den USB-Schl√ºsselcode f√ºr den Boot-Plug auszuf√ºhren. Es hat mich jedoch interessiert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/lg/py/iflgpyq2h1z6kusfwcpqf-x0vxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Moment hatte ich zwei verschiedene M√∂glichkeiten, Code auf diesem Ger√§t auszuf√ºhren, aber die Arbeit mit dem JSON-Parser, f√ºr den ich viel Zeit aufgewendet habe, erwies sich aufgrund des DFU-Modus als nicht besonders effektiv. Sp√§ter werden wir diese Methode zusammen mit der vorhandenen Parser-Sicherheitsanf√§lligkeit betrachten. Bisher war ich mehr daran interessiert, ob es m√∂glich ist, die Datei main.bin einfach zu √§ndern, ihre CRC16 neu zu berechnen und sie mit dem in der Lovense Remote-Anwendung enthaltenen Programm einzubetten. Es stellte sich heraus, dass es m√∂glich ist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis haben wir einen USB-Stick erhalten, der mit einer PC-Anwendung kompromittiert wurde, und es war definitiv der am einfachsten zu knackende Teil. Nachdem ich die Kontrolle √ºber den Schl√ºssel erlangt hatte, suchte ich nach einer M√∂glichkeit, Code auf dem Boot-Plug selbst auszuf√ºhren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vi/k2/vm/vik2vmib-ohaqm0hlaaldyaqmgc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zweck habe ich mich der "Hardware" unseres Sexspielzeugs zugewandt - wahrscheinlich hatte es auch einen Debugger und es war einen Blick wert. Nachdem ich den Boot-Plug untersucht hatte, fand ich einen ernsthafteren Chip mit viel Flash-Speicher und RAM sowie einem leistungsst√§rkeren Cortex M4-Prozessor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich fand leicht heraus, was fehlte und was sich an Bord der Bootplag befand. Es gibt keine DEP wie bei einem Dongle. Oben befinden sich Kabel zur Batterie. Als n√§chstes befinden sich der Ladeanschluss, die Kontakte des Vibrationsmotors, mehrere Kontaktfl√§chen zum Debuggen und eine Bluetooth-Antenne. Dank des Vorhandenseins von SWD kann das Ger√§t daher problemlos neu geflasht werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r8/ln/rd/r8lnrdx8uis5lkt3f-gtdkpssr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie sehen, was passiert ist - ich habe keinen Aktion√§r, aber in der Tasche werden immer ein paar Buttplugs f√ºr Experimente sein. Dann begann ich mit dem Reverse Engineering und dem Debuggen des Bootplags, wobei die urspr√ºngliche Firmware zur√ºckgesetzt wurde. Es gab keine JSON-Parser, nur einfache Befehle, aber in gro√üer Anzahl.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich dachte, wenn der Dongle-Firmware-Aktualisierungsmodus so unsicher ist, ist es m√∂glich, dass es Schwachstellen gibt. Es stellte sich heraus, wie es ist. Als Ergebnis der DFU-Suche habe ich zwei Dinge gefunden: den regul√§ren DFU-Befehlshandler und die DfuTarg-Zeile im Bootsektor. Dieses DfuTarg wird auf die gleiche Weise wie die Kennung des LVS-Z00-Boot-Plugins verwendet, dh es √§hnelt dem DFU-Bootloader f√ºr BLE. Daher wird im DFU-Modus das Bootlog als Ger√§t unter dem Namen DfuTarg erkannt, und diese eindeutige Kennung kann zur Suche nach dem Ger√§t verwendet werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie ihm also genau den gleichen DFU-Befehl senden, den wir an den Schl√ºssel gesendet haben, wechselt das Bootplag in den Firmware-Aktualisierungsmodus des Ger√§ts. Zum Flashen k√∂nnen Sie die propriet√§ren Werkzeuge des Herstellers der Nordic Semiconductor-Mikroschaltung - nRF Toolbox - verwenden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/iy/pr/xbiyprlhoukirnf_su9htx71rqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit einem Hardware-Sniffer k√∂nnen Sie BLE-Pakete in Wireshark visualisieren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/ea/9o/xcea9of9tdquhsfcjnjglzcsj78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe eine kurze Nachricht "Hallo vom Plug" gesendet. Dies bedeutet, dass Sie den Code auf der Batplag ausf√ºhren k√∂nnen, ohne ihn zu hacken. Dies ist keine Sicherheitsanf√§lligkeit, sondern lediglich eine Art Entwicklerdesign, mit dem Sie das Ger√§t erneut flashen k√∂nnen. Vielleicht m√∂chte die Open Source Community diese L√∂sung. Das Fazit ist, dass jeder, der eine Verbindung zu Ihrem Boot-Plug-In herstellen kann, seinen eigenen Code darauf ausf√ºhren kann, und dies ist bereits eine ziemlich gef√§hrliche Sache. In diesem Fall sollte sich der Hacker im Bereich der lokalen Verbindung befinden, dh nahe genug am Sexspielzeug sein, um √ºber einen kompromittierten Dongle- und BLE-Kanal die Kontrolle dar√ºber zu erlangen. Gleichzeitig k√∂nnen Sie den Dongle selbst oder ein anderes BLE-Ger√§t verwenden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d_/uo/uy/d_uouyokp1p8mdsyx2x0yehkl14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Frage ist, was wirklich mit dem Boot-Plug-In gemacht werden kann, wenn Sie die M√∂glichkeit haben, Ihren eigenen Code darauf auszuf√ºhren. Ich habe ein paar Ideen. Als erstes k√∂nnen Sie die Kontrolle √ºber dieses Ding √ºbernehmen und ein Ransomware-Bootplag erstellen. Sie k√∂nnen die Firmware so √§ndern, dass der Benutzer den DFU-Modus erst aktivieren kann, wenn Sie ihm einen bestimmten Schl√ºssel zur Verf√ºgung stellen, oder Sie schalten einfach die Vibrationsfunktion aus und fordern 50 Dollar an, um dieses n√ºtzliche Ger√§t zu entsperren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cl/jb/ob/cljbobzlggrarkc30am8im-fe14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr viele wird dies als eine Art Impfstoff aus der Verwendung solcher Spielzeuge dienen. Die zweite Idee ist, die Bootplag in eine Waffe zu verwandeln. Es hat eine ziemlich starke Batterie, die den Vibrationsmotor speist. Wir k√∂nnen sagen, dass 80% des Inhalts des Boot-Steckers eine Batterie ist. Sie erinnern sich wahrscheinlich daran, was mit den Samsung Galaxy Note-Smartphones passiert ist - sie sind gerade explodiert (Gel√§chter), daher ist es wahrscheinlich, dass dies mit Buttplugs passieren kann. Ich wei√ü nicht, wie hoch die Wahrscheinlichkeit einer Explosion ist, aber wenn Sie viele Sexspielzeuge mit einem Motor haben, sollten Sie dar√ºber nachdenken. Das Entwicklungsteam behauptet, dass diese Dinge trotz des Vorhandenseins vieler beweglicher Teile absolut sicher sind. Ist dies jedoch der Fall, wird die Sicherheitsfunktion des Ger√§ts in Software und nicht in Hardware codiert.In diesem Fall kann die Ausf√ºhrung von Schadcode katastrophale Folgen haben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sexspielzeug mit Luftpumpe ist ebenfalls gef√§hrlich. Sie haben auch einen ziemlich starken Motor mit einer Batterie, deshalb sollten Sie auch auf sie achten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schlie√ülich ist die letzte Idee ein feindliches Kampf-Plug-In. Feindlich, nicht in dem Sinne, dass es in der Lage ist, Ihren Arsch zu blasen, sondern in der Tatsache, dass es als Mittel dienen kann, den Rest Ihrer Ger√§te zu hacken. Daher werden wir den Battle Plug unter dem Gesichtspunkt seiner Feindseligkeit betrachten, die durch die Ausf√ºhrung von Schadcode sichergestellt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir herauszufinden, ob es m√∂glich ist, eine Codeausf√ºhrung in der Anwendung f√ºr das Boot-Plug-In zu erreichen, indem wir √ºberlegen, wie eingehende Nachrichten verarbeitet werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/ov/1v/g_ov1vzowj7o8hifa6xhfoo5gmq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Links sehen Sie einen R√ºckruf in JavaScript und rechts, wie er √ºber die serielle Schnittstelle mit der Anwendung interagiert. Der R√ºckruf wird in eine Zeichenfolge eingef√ºgt und dann von einer Reihe verschiedener Funktionen verarbeitet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Funktion besteht darin, den Schl√ºssel zu finden. Sie verarbeitet die vom Schl√ºssel kommenden Initialisierungsnachrichten. Die zweite Funktion ist aktiviert (‚ÄûDaten‚Äú), eine Verarbeitungsfunktion, die ein eingehendes JSON-Paket akzeptiert, dessen L√§nge √ºbrigens 32 Zeichen nicht √ºberschreiten darf. Als n√§chstes wird das Parsen und alles andere erledigt. Tats√§chlich findet hier keine ernsthafte Verarbeitung statt - es wird lediglich eine Anfrage nach dem Status des Ger√§ts gestellt, wobei die Batterieladung und dergleichen √ºberpr√ºft werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die letzte Funktion ist viel interessanter - ich nenne sie das Debug-Protokoll, obwohl sie im echten Code eigentlich keinen Namen hat. Diese Funktion registriert alles, was √ºber die serielle Schnittstelle in das Ger√§t gelangt, und setzt diese Leitungen zur Konsole zur√ºck, die bei Bedarf eine Fehlermeldung anzeigt. Dar√ºber hinaus erstellt diese Funktion ein neues DOM-Element als HTML-Element und wirft den gesamten √ºber die serielle Schnittstelle empfangenen Inhalt in diesen HTML-Code. Ich bin kein Webentwickler, aber ich denke, dies ist eine schwerwiegende XSS-Sicherheitsl√ºcke.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie also die Kontrolle √ºber den Dongle haben, k√∂nnen Sie alles √ºber die serielle Schnittstelle senden und die Anwendung dazu zwingen, dies als HTML zu interpretieren. </font><font style="vertical-align: inherit;">Dies ist das Problem, da HTML in der Lage ist, neuen JavaScript-Code in einer auf Ihrem Computer installierten Anwendung zu erstellen, dh es kann ihn gef√§hrden. </font><font style="vertical-align: inherit;">Die Frage ist, welche Malware erfunden werden kann, wenn man wei√ü, dass jeweils nur 32 Zeichen zul√§ssig sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22:00 min </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFCON 27 Konferenz. Buttplug: echte Penetrationstests. </font><font style="vertical-align: inherit;">Teil 2</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Werbung :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank f√ºr Ihren Aufenthalt bei uns. Gef√§llt dir unser Artikel? M√∂chten Sie weitere interessante Materialien sehen? Unterst√ºtzen Sie uns, indem Sie eine Bestellung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufgeben</font></a><font style="vertical-align: inherit;"> oder Ihren Freunden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud-basiertes VPS f√ºr Entwickler ab 4,99 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> empfehlen </font><font style="vertical-align: inherit;">, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einzigartiges Analogon von Einstiegsservern, das von uns f√ºr Sie erfunden wurde: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ganze Wahrheit √ºber VPS (KVM) E5-2697 v3 (6 Kerne) 10 GB DDR4 480 GB SSD 1 Gbit / s ab 19 $ oder wie teilt man den Server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verf√ºgbar). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2-mal g√ºnstiger im Equinix Tier IV-Rechenzentrum in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nur wir haben </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2,6 GHz 14C 64 GB DDR4 4 x 960 GB SSD 1 Gbit / s 100 TV von 199 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den Niederlanden!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2,2 GHz 6C 128 GB DDR3 2x960 GB SSD 1 Gbit / s 100 TB - ab 99 US-Dollar! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie Sie eine Infrastruktur aufbauen </font><font style="vertical-align: inherit;">Klasse C mit Dell R730xd E5-2650 v4-Servern f√ºr 9.000 Euro f√ºr einen Cent?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495366/index.html">16 Arten von Programmierern oder Entwicklern sind nicht dieselben Roboter</a></li>
<li><a href="../de495368/index.html">Wir registrieren uns selbst f√ºr selbstlaufende Selbsthunde unter Bedingungen der Selbstisolation</a></li>
<li><a href="../de495370/index.html">√ñffentlichkeit ist b√∂se</a></li>
<li><a href="../de495374/index.html">Dekorative Deckenleuchte General Lumino 02</a></li>
<li><a href="../de495376/index.html">Langeweile in Quarant√§ne. So geben Sie mit einem Klick das meiste Geld in Azure aus</a></li>
<li><a href="../de495380/index.html">Gro√üe √§gyptische Firewall</a></li>
<li><a href="../de495384/index.html">Meine Praktikumserfahrung bei Microsoft Redmond und ein Angebot bekommen</a></li>
<li><a href="../de495388/index.html">1970er Fernsehsendung, die ein Vorfahr des eSports wurde</a></li>
<li><a href="../de495390/index.html">STM32CubeMonitor ist einen Versuch wert</a></li>
<li><a href="../de495392/index.html">So suchen Sie im Frontend nach Fehlern: 4 Hauptphasen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>