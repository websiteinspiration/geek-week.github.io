<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛡️ 🚾 🧙🏽 Pengalaman kami dalam mengembangkan driver CSI di Kubernetes untuk Yandex.Cloud 👊🏼 👩‍🔧 🤘🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami dengan senang hati mengumumkan bahwa perusahaan Flant sedang mengisi kembali kontribusinya pada alat Open Source untuk Kubernetes dengan merilis ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pengalaman kami dalam mengembangkan driver CSI di Kubernetes untuk Yandex.Cloud</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/486190/"><img src="https://habrastorage.org/webt/1y/to/tn/1ytotnf73zepbwfalhzoropf9qa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami dengan senang hati mengumumkan bahwa perusahaan Flant sedang mengisi kembali kontribusinya pada alat Open Source untuk Kubernetes dengan merilis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versi alpha dari driver CSI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Container Storage Interface) untuk Yandex.Cloud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi sebelum beralih ke detail implementasi, kami akan menjawab pertanyaan mengapa ini diperlukan sama sekali ketika Yandex sudah memiliki </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layanan Terkelola untuk layanan Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kenapa ini?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di dalam perusahaan kami, sejak awal pengoperasian Kubernetes dalam produksi (mis. Selama beberapa tahun), alat kami sendiri (deckhouse) telah berkembang, yang, omong-omong, kami juga berencana untuk segera menyediakannya sebagai proyek Open Source. Dengan bantuannya, kami secara seragam mengonfigurasi dan mengonfigurasi semua cluster kami, dan saat ini ada lebih dari 100 dari mereka, apalagi, pada konfigurasi besi yang paling beragam dan di semua layanan cloud yang tersedia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cluster di mana deckhouse digunakan memiliki semua komponen yang diperlukan untuk pekerjaan: penyeimbang, pemantauan dengan bagan yang nyaman, metrik dan peringatan, otentikasi pengguna melalui penyedia eksternal untuk mengakses semua dasbor, dan sebagainya. </font><font style="vertical-align: inherit;">Tidak masuk akal untuk menempatkan kluster "dipompa" ke dalam solusi yang dikelola, karena seringkali tidak mungkin atau akan mengarah pada kebutuhan untuk menonaktifkan setengah dari komponen. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Ini adalah pengalaman kami, dan ini cukup spesifik. </font><font style="vertical-align: inherit;">Kami sama sekali tidak mengklaim bahwa setiap orang harus secara independen terlibat dalam penyebaran cluster Kubernetes alih-alih menggunakan solusi yang sudah jadi. </font><font style="vertical-align: inherit;">Omong-omong, kami tidak memiliki pengalaman nyata dalam mengoperasikan Kubernetes dari Yandex dan kami tidak akan memberikan penilaian atas layanan ini dalam artikel ini.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa itu dan untuk siapa?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kita sudah membicarakan tentang pendekatan modern terhadap penyimpanan di Kubernetes: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bagaimana CSI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bekerja </font><font style="vertical-align: inherit;">dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bagaimana masyarakat sampai</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada pendekatan ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, banyak penyedia layanan cloud besar telah mengembangkan driver untuk menggunakan drive cloud mereka sebagai Volume Persisten di Kubernetes. Jika pemasok tidak memiliki driver seperti itu, tetapi pada saat yang sama semua fungsi yang diperlukan disediakan melalui API, maka tidak ada yang mencegah pengemudi dari mengimplementasikan sumber dayanya sendiri. Dan begitulah yang terjadi dengan Yandex.Cloud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai dasar untuk pengembangan, kami mengambil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">driver CSI untuk cloud DigitalOcean</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan beberapa ide dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">driver untuk GCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena interaksi dengan API cloud ini (Google dan Yandex) memiliki sejumlah kesamaan. Secara khusus, API dan</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan objek </font></font><code>Operation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk melacak status operasi yang panjang (misalnya, membuat disk baru). </font><font style="vertical-align: inherit;">Untuk berinteraksi dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Cloud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">SDK Yandex.Cloud Go digunakan</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil dari pekerjaan yang dilakukan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dipublikasikan pada GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan mungkin bermanfaat bagi mereka yang karena alasan tertentu menggunakan instalasi Kubernet mereka sendiri di Yandex. Mesin virtual Cloud (tetapi bukan cluster terkelola yang siap pakai) dan ingin menggunakan disk (pesanan) melalui CSI.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penerapan</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fitur utama</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, driver mendukung fungsi-fungsi berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Memesan disk di semua zona cluster sesuai dengan topologi node di cluster</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Menghapus disk yang dipesan sebelumnya;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubah ukuran offline untuk disk (Yandex. Cloud </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak mendukung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peningkatan dalam disk yang dipasang pada mesin virtual). </font><font style="vertical-align: inherit;">Tentang cara memodifikasi driver untuk mengubah ukuran tanpa rasa sakit mungkin, lihat di bawah.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di masa depan, direncanakan untuk mengimplementasikan dukungan untuk pembuatan dan penghapusan snapshot disk.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesulitan utama dan penanggulangannya</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurangnya kemampuan untuk memperluas disk secara real time di Yandex.Cloud API adalah batasan yang mempersulit operasi mengubah ukuran untuk PV (Persistent Volume): dalam hal ini, perlu bahwa pod aplikasi yang menggunakan disk dihentikan, dan ini dapat menyebabkan sederhana aplikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spesifikasi CSI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jika pengontrol CSI melaporkan bahwa itu hanya dapat mengubah ukuran disk "offline" ( </font></font><code>VolumeExpansion.OFFLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), maka proses peningkatan disk harus seperti ini:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika plugin hanya memiliki </font></font><code>VolumeExpansion.OFFLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemampuan ekspansi dan volume saat ini diterbitkan atau tersedia pada sebuah node maka </font></font><code>ControllerExpandVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HARUS dipanggil HANYA setelah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plugin memiliki </font></font><code>PUBLISH_UNPUBLISH_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemampuan </font><font style="vertical-align: inherit;">pengontrol </font><font style="vertical-align: inherit;">dan </font></font><code>ControllerUnpublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berhasil dijalankan.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ATAU</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plugin TIDAK memiliki </font></font><code>PUBLISH_UNPUBLISH_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemampuan </font><font style="vertical-align: inherit;">pengontrol </font><font style="vertical-align: inherit;">, plugin memiliki </font></font><code>STAGE_UNSTAGE_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemampuan </font><font style="vertical-align: inherit;">node </font><font style="vertical-align: inherit;">, dan </font></font><code>NodeUnstageVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telah berhasil diselesaikan.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ATAU</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plugin TIDAK memiliki </font></font><code>PUBLISH_UNPUBLISH_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemampuan </font><font style="vertical-align: inherit;">pengontrol </font><font style="vertical-align: inherit;">, atau </font></font><code>STAGE_UNSTAGE_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemampuan </font><font style="vertical-align: inherit;">simpul </font><font style="vertical-align: inherit;">, dan </font></font><code>NodeUnpublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telah selesai dengan sukses.</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada dasarnya, ini berarti kebutuhan untuk melepaskan disk dari mesin virtual sebelum meningkatkannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, sayangnya, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> spesifikasi CSI melalui sespan tidak memenuhi persyaratan ini:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam wadah sespan </font></font><code>csi-attacher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang harus bertanggung jawab atas keberadaan celah yang diperlukan antara tunggangan, fungsi ini sama sekali tidak diimplementasikan dengan offline-resize. </font><font style="vertical-align: inherit;">Diskusi tentang ini telah dimulai di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa wadah sespan dalam konteks ini? </font><font style="vertical-align: inherit;">Plugin CSI itu sendiri tidak berinteraksi dengan Kubernetes API, tetapi hanya menanggapi panggilan gRPC yang dikirim oleh kontainer sespan. </font><font style="vertical-align: inherit;">Yang terakhir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sedang dikembangkan oleh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> komunitas Kubernetes.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam kasus kami (plugin CSI), operasi untuk meningkatkan disk adalah sebagai berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menerima panggilan gRPC </font></font><code>ControllerExpandVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami mencoba untuk meningkatkan disk di API, tetapi kami mendapatkan kesalahan tentang ketidakmungkinan operasi, karena disk sudah terpasang;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menyimpan pengidentifikasi disk di peta yang berisi disk yang Anda perlukan untuk melakukan operasi peningkatan. </font><font style="vertical-align: inherit;">Selanjutnya untuk singkatnya kita akan menyebut peta ini sebagai </font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hapus pod secara manual yang menggunakan disk. </font><font style="vertical-align: inherit;">Kubernetes akan memulai kembali. </font><font style="vertical-align: inherit;">Agar disk tidak punya waktu untuk memasang ( </font></font><code>ControllerPublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) sebelum penyelesaian operasi peningkatan ketika mencoba memasang, kami memeriksa bahwa disk ini masih dalam </font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan mengembalikan kesalahan;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Driver CSI sedang mencoba menjalankan kembali operasi pengubahan ukuran. </font><font style="vertical-align: inherit;">Jika operasi berhasil, maka hapus disk dari </font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena </font><font style="vertical-align: inherit;">pengidentifikasi disk tidak ada </font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>ControllerPublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berhasil, disk sudah terpasang, pod dimulai.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya terlihat cukup sederhana, tetapi seperti biasa ada jebakan. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eksternal-resizer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terlibat dalam </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">ekspansi</font></a><font style="vertical-align: inherit;"> disk </font><font style="vertical-align: inherit;">, yang, jika terjadi kesalahan selama operasi, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan antrian</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan peningkatan waktu tunggu hingga 1000 detik secara eksponensial:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DefaultControllerRateLimiter</span><span class="hljs-params">()</span> <span class="hljs-title">RateLimiter</span></span> {
  <span class="hljs-keyword">return</span> NewMaxOfRateLimiter(<font></font>
  NewItemExponentialFailureRateLimiter(<span class="hljs-number">5</span>*time.Millisecond, <span class="hljs-number">1000</span>*time.Second),
  <span class="hljs-comment">// 10 qps, 100 bucket size.  This is only for retry speed and its only the overall factor (not per item)</span>
  &amp;BucketRateLimiter{Limiter: rate.NewLimiter(rate.Limit(<span class="hljs-number">10</span>), <span class="hljs-number">100</span>)},<font></font>
  )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini secara berkala dapat mengarah pada fakta bahwa operasi peningkatan disk direntangkan selama 15+ menit dan, dengan demikian, tidak dapat diaksesnya pod yang sesuai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu-satunya opsi yang memungkinkan kami untuk mengurangi potensi downtime dengan mudah dan tanpa rasa sakit adalah menggunakan versi eksternal-resizer kami dengan batas waktu maksimum </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 detik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
 <br>
<pre><code class="go hljs">workqueue.NewItemExponentialFailureRateLimiter(<span class="hljs-number">5</span>*time.Millisecond, <span class="hljs-number">5</span>*time.Second)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tidak menganggap perlu untuk segera memulai diskusi dan menambal-resizer eksternal, karena disk pengubahan ukuran offline adalah atavisme yang akan segera menghilang dari semua penyedia cloud.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara mulai menggunakan?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengemudi didukung di Kubernetes versi 1.15 dan lebih tinggi. </font><font style="vertical-align: inherit;">Agar pengemudi dapat bekerja, persyaratan berikut harus dipenuhi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera </font></font><code>--allow-privileged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diatur ke nilai </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk server API dan kubelet;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Termasuk </font></font><code>--feature-gates=VolumeSnapshotDataSource=true,KubeletPluginsWatcher=true,CSINodeInfo=true,CSIDriverRegistry=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk server API dan kubelet;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mount propagasi ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mount propagation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) harus dimasukkan dalam cluster. </font><font style="vertical-align: inherit;">Saat menggunakan Docker, daemon harus dikonfigurasikan agar mount bersama diizinkan.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua langkah yang diperlukan untuk instalasi itu sendiri </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dijelaskan dalam README</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Instalasi adalah pembuatan objek di Kubernetes dari manifes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar pengemudi dapat bekerja, Anda memerlukan yang berikut ini:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tunjukkan pengidentifikasi direktori katalog Yandex.Cloud ( </font></font><code>folder-id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">dalam manifes </font><font style="vertical-align: inherit;">( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lihat dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk berinteraksi dengan Yandex.Cloud API di driver CSI, akun layanan digunakan. </font><font style="vertical-align: inherit;">Di manifes Rahasia, Anda harus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memberikan kunci yang diotorisasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ke akun layanan. </font><font style="vertical-align: inherit;">Dokumentasi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menjelaskan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cara membuat akun layanan dan mendapatkan kunci.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cobalah</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan kami akan dengan senang hati menerima umpan balik dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masalah baru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jika Anda menemui masalah!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan lebih lanjut</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, kami ingin mencatat bahwa kami menerapkan driver CSI ini bukan dari keinginan besar untuk bersenang-senang menulis aplikasi di Go, tetapi karena kebutuhan mendesak di dalam perusahaan. </font><font style="vertical-align: inherit;">Tampaknya tidak disarankan untuk mendukung implementasi kami sendiri, oleh karena itu, jika Yandex menunjukkan minat dan memutuskan untuk terus mendukung pengemudi, kami dengan senang hati akan memindahkan repositori ke pembuangan mereka. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, mungkin, Yandex di kluster yang dikelola Kubernetes memiliki implementasi sendiri dari driver CSI, yang dapat dirilis di Open Source. </font><font style="vertical-align: inherit;">Opsi pengembangan ini juga tampaknya menguntungkan bagi kami - komunitas akan dapat menggunakan driver yang telah terbukti dari penyedia layanan, dan bukan dari perusahaan pihak ketiga.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baca juga di blog kami:</font></font><br>
<br>
<ul>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> Kubernetes CCM (Cloud Controller Manager)  .</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">     Kubernetes:  Flexvolume  CSI</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> Container Storage Interface ( Kubernetes   )</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> Kubernetes-   ?  addon-operator</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   Kubernetes (   )</a>».</li>
</ul></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486178/index.html">Berita FOSS No. 1 - ulasan berita sumber terbuka dan gratis untuk 27 Januari - 2 Februari 2020</a></li>
<li><a href="../id486180/index.html">Kiat dan sumber untuk membuat aplikasi tanpa server</a></li>
<li><a href="../id486184/index.html">Cara menggunakan pencarian secara efektif</a></li>
<li><a href="../id486186/index.html">Catastrophic Cloud: Bagaimana Cara Kerjanya</a></li>
<li><a href="../id486188/index.html">Memperkenalkan sistem cadangan PostgreSQL wal-g</a></li>
<li><a href="../id486192/index.html">Penipu dunia maya meretas operator seluler untuk mendapatkan nomor telepon pelanggan</a></li>
<li><a href="../id486194/index.html">Tentang cadangan di Proxmox VE</a></li>
<li><a href="../id486198/index.html">Berbicara itu sulit. Esai tentang Berkomunikasi dengan Non-Programmer</a></li>
<li><a href="../id486200/index.html">Tips Docker: Bersihkan Mesin Anda Dari Sampah</a></li>
<li><a href="../id486202/index.html">Alpine mengumpulkan pembangunan Docker di bawah Python 50 kali lebih lambat, dan gambar 2 kali lebih berat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>