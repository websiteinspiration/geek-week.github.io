<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüöí üõÉ ü§£ C√≥mo encontrar errores en un proyecto de C #, trabajando bajo Linux y macOS ü§üüèø üë®üèª‚Äç‚öñÔ∏è üö£üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio es un conocido analizador de c√≥digo est√°tico que le permite encontrar muchos errores dif√≠ciles ocultos en la fuente. La prueba beta de la n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C√≥mo encontrar errores en un proyecto de C #, trabajando bajo Linux y macOS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="Cuadro 8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio es un conocido analizador de c√≥digo est√°tico que le permite encontrar muchos errores dif√≠ciles ocultos en la fuente. </font><font style="vertical-align: inherit;">La prueba beta de la nueva versi√≥n se ha completado recientemente, en la que es posible analizar proyectos de C # para Linux y macOS. </font><font style="vertical-align: inherit;">Adem√°s, el analizador ahora puede integrarse con JetBrains Cross-Platform IDE - Rider. </font><font style="vertical-align: inherit;">Este art√≠culo le permitir√° familiarizarse con estas caracter√≠sticas en el ejemplo de verificar el proyecto de c√≥digo abierto RavenDB.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hace alg√∫n tiempo, mi colega </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Vasiliev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escribi√≥ una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nota</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre la apertura de una prueba beta de una nueva versi√≥n del analizador est√°tico PVS-Studio que estamos desarrollando. </font><font style="vertical-align: inherit;">Ahora se completa la prueba beta y la nueva versi√≥n se puede descargar haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En el mismo art√≠culo, examinaremos c√≥mo analizar proyectos de C # en Linux / macOS utilizando la interfaz de la consola y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Despu√©s de eso, realizaremos un an√°lisis tradicional de algunas operaciones interesantes del analizador.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="Cuadro 5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la verificaci√≥n, se eligi√≥ un proyecto RavenDB abierto, cuyo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> totaliza casi 5 mil archivos de c√≥digo fuente. </font><font style="vertical-align: inherit;">Es una base de datos NoSQL bastante popular. </font><font style="vertical-align: inherit;">Los detalles se pueden encontrar en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sitio web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es f√°cil adivinar que me atrajo su tama√±o, porque en un proyecto tan grande y, sin duda, serio, probablemente habr√° algo interesante.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfaz de l√≠nea de comando</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar, considere c√≥mo analizar a trav√©s de la consola. </font><font style="vertical-align: inherit;">Esta secci√≥n, en mi opini√≥n, ser√° especialmente interesante para aquellos que quieran integrar el analizador en el sistema de CI. </font><font style="vertical-align: inherit;">El equipo que comienza el an√°lisis tiene varias opciones interesantes, pero en el caso general, todo es bastante trivial. </font><font style="vertical-align: inherit;">Para analizar RavenDB, voy a la carpeta del proyecto e ingreso lo siguiente en la consola:</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El indicador -t (abreviatura de destino) se utiliza para especificar una soluci√≥n o archivo de proyecto para verificaci√≥n. </font><font style="vertical-align: inherit;">La l√≠nea presentada anteriormente comienza el an√°lisis y, como resultado del trabajo, forma un archivo que contiene los errores encontrados. </font><font style="vertical-align: inherit;">Es simple, ¬øno es as√≠?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jinete</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajar con el analizador en Rider es casi lo mismo que en Visual Studio. </font><font style="vertical-align: inherit;">La interfaz simple e intuitiva del complemento le permite verificar el proyecto con solo un par de clics. </font><font style="vertical-align: inherit;">Esto no es una exageraci√≥n: para el an√°lisis de RavenDB solo tuve que hacer clic en el men√∫ superior Herramientas, seleccionar "PVS-Studio" y hacer clic en "Comprobar soluci√≥n / proyecto actual".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="Imagen 2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los resultados del an√°lisis se mostrar√°n en la parte inferior de la ventana en la pesta√±a PVS-Studio (bueno, ¬øcu√°l m√°s? :))</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="Cuadro 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al igual que con el complemento para Visual Studio, hacer doble clic en una advertencia mostrar√° la ubicaci√≥n con la que est√° asociado. Todo es conveniente y comprensible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√°s importante a√∫n, la herramienta PVS-Studio no solo indica errores, sino que tiene una infraestructura que facilita la implementaci√≥n de la metodolog√≠a de an√°lisis est√°tico incluso en un proyecto antiguo grande.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea general es la siguiente. El usuario inici√≥ el analizador y recibi√≥ muchas advertencias. Dado que un proyecto que se ha desarrollado durante muchos a√±os est√° vivo, se desarrolla y genera dinero, lo m√°s probable es que no haya muchas advertencias en el informe que indiquen defectos cr√≠ticos. En otras palabras, los errores cr√≠ticos ya se han solucionado de una forma u otra de manera m√°s costosa o gracias a los comentarios de los clientes. En consecuencia, todo lo que el analizador ahora encuentra puede considerarse una deuda t√©cnica, lo cual no es pr√°ctico para tratar de eliminarlo de inmediato. Es racional ignorar estas advertencias por ahora, pero escribir c√≥digo nuevo que ya realice an√°lisis regulares.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede decirle a PVS-Studio que considere estas advertencias como irrelevantes (posponga la deuda t√©cnica para m√°s adelante) y no las muestre nuevamente. El analizador crea un archivo especial donde almacena informaci√≥n sobre errores hasta ahora poco interesantes. Y ahora PVS-Studio emitir√° advertencias solo en c√≥digo nuevo o modificado. Adem√°s, todo esto se implementa de manera inteligente. Si, por ejemplo, se agrega una l√≠nea vac√≠a al comienzo de un archivo, entonces el analizador comprende que, de hecho, nada ha cambiado y permanecer√° en silencio. Este archivo de marcado se puede incrustar en el sistema de control de versiones. El archivo es grande, pero no da miedo, porque a menudo no tiene sentido colocarlo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora todos los programadores ver√°n advertencias relacionadas solo con el c√≥digo nuevo o modificado. Por lo tanto, el analizador puede comenzar a usar lo que se llama al d√≠a siguiente. Y ser√° posible volver a la deuda t√©cnica m√°s tarde, y gradualmente corregir errores y configurar el analizador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para suprimir las advertencias sobre el c√≥digo existente en Rider, simplemente vaya al men√∫ superior en Herramientas-&gt; PVS-Studio y haga clic en "Suprimir todos los mensajes".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="Foto 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la ventana que aparece, advirtiendo que todas las operaciones actuales caer√°n en la lista de supresi√≥n, haga clic en "Aceptar". </font><font style="vertical-align: inherit;">Como resultado, se crear√° un archivo de supresi√≥n en la carpeta del proyecto, que el analizador tendr√° en cuenta durante el trabajo posterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cabe se√±alar que Rider ya tiene un analizador que resalta con √©xito algunos errores. </font><font style="vertical-align: inherit;">Por lo tanto, una serie de advertencias de PVS-Studio apunta a un c√≥digo que parece sospechoso desde el punto de vista del editor. </font><font style="vertical-align: inherit;">Sin embargo, PVS-Studio a menudo encuentra errores que podr√≠an alejarse del ojo sensible del analizador de JetBrains. </font><font style="vertical-align: inherit;">Es por eso que la soluci√≥n m√°s efectiva es permitirles trabajar en equipo.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="Cuadro 10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y de postre</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, como se prometi√≥, consideraremos qu√© advertencias interesantes mostr√≥ el analizador de acuerdo con los resultados de la verificaci√≥n. El proyecto contiene una gran cantidad de archivos de c√≥digo fuente, por lo que no fue sorprendente encontrar muchos momentos sospechosos en √©l. No hay nada que hacer: todos cometen errores, pero es importante hacer todo lo posible para detectarlos y corregirlos de manera oportuna. El an√°lisis est√°tico puede simplificar enormemente esta tarea. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado de la verificaci√≥n, se mostraron alrededor de mil advertencias:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="Cuadro 11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede leer m√°s sobre los niveles de advertencia haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, no todos los desencadenantes indican errores s√∫per aterradores. </font><font style="vertical-align: inherit;">Si esto fuera as√≠, ser√≠a poco probable que al menos algo funcionara en el proyecto :). </font><font style="vertical-align: inherit;">Pero es importante comprender que si el analizador "jura", entonces el c√≥digo parece extra√±o y debe estudiarse cuidadosamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, el proyecto encontr√≥ muchos aspectos positivos interesantes. </font><font style="vertical-align: inherit;">Sin embargo, no quisiera que el art√≠culo sea muy grande, por lo que consideraremos solo algunos de ellos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øSolo un cheque extra?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresi√≥n </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> 'dirpath == null' siempre es falsa. PosixHelper.cs (124) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta operaci√≥n puede considerarse de diferentes maneras. Por un lado, un cheque adicional, por supuesto, no es muy bueno, pero en s√≠ mismo no es un error. Por otro lado, vale la pena considerarlo: ¬øeste c√≥digo realmente funciona de la manera prevista por el programador? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s el desarrollador realmente no sab√≠a que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nunca volver√≠a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si esto no es as√≠, entonces podemos suponer lo que √©l quer√≠a lograr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tal vez </font><font style="vertical-align: inherit;">deber√≠a llamarse a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuando no es posible obtener un padre para el directorio en cuesti√≥n. Si es as√≠, entonces verificando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiene sentido. </font><font style="vertical-align: inherit;">Sin embargo, debemos considerar no el resultado de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sino el valor devuelto por el m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lo contrario, devolver </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent genera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una excepci√≥n al llamar a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nulo t√≠pico</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El objeto 'art√≠culo' se us√≥ despu√©s de que se verific√≥ contra nulo. L√≠neas de verificaci√≥n: 249, 247. ActiveTransactions.cs (249), ActiveTransactions.cs (247) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo se ve extra√±o debido a lo que sucede cuando el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realmente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De hecho, si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tambi√©n </font><i><font style="vertical-align: inherit;">es </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condici√≥n es verdadera y un intento de obtener </font><font style="vertical-align: inherit;">un elemento. El </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arrojar√° una excepci√≥n. Y si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no puede ser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces la condici√≥n " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"es simplemente superfluo. Esto se debe a que se verifica solo cuando el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento == nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Bueno, si de repente el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no puede ser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces toda la condici√≥n pierde su significado y solo agrega anidamiento innecesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que aqu√≠, tal vez se selecciona el operador l√≥gico incorrecto. Si reemplaza "||" con "&amp;&amp;" en la condici√≥n, el c√≥digo inmediatamente comienza a verse l√≥gico. Bueno, no pueden surgir problemas en este caso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El desarrollo de dicho plan son representantes t√≠picos de errores muy peligrosos en la teor√≠a detectada por el analizador Para ser justos, debe tenerse en cuenta que el analizador integrado en Rider tambi√©n marca este fragmento como potencialmente peligroso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øOtro cheque de nuevo?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresi√≥n </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> '_continuationState.Count&gt; 0' siempre es verdadera. </font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs (152) Sparrow </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, en la condici√≥n externa, se verifica que el n√∫mero de elementos en la colecci√≥n sea mayor que 1, y luego en la siguiente l√≠nea el operador ternario verifica que su n√∫mero sea mayor que 0. Parece que una de las verificaciones deber√≠a verse diferente. </font><font style="vertical-align: inherit;">De una forma u otra, este c√≥digo parece muy sospechoso y debe estudiarse y procesarse cuidadosamente si es necesario.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE posible</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El objeto 'node.Indexer' se us√≥ antes de que se verificara como nulo. Verifique las l√≠neas: 1180, 1182. ExpressionStringBuilder.cs (1180), ExpressionStringBuilder.cs (1182) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, este es otro lugar que PVS-Studio y Rider consideran sospechoso. Es cierto que la redacci√≥n es algo diferente: el analizador de JetBrains solo resalta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer.DeclaringType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el comentario "Posible NullReferenceException". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambos revisores afirman que, de hecho, se puede lanzar una excepci√≥n en este fragmento. Debo decir que la advertencia de PVS-Studio no solo dice que aqu√≠ es posible un error, sino que tambi√©n explica por qu√© ten√≠a esa opini√≥n. Parece un poco, pero agradable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, no es un hecho que realmente haya un error. </font><font style="vertical-align: inherit;">Es posible que si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especifique exactamente. </font><font style="vertical-align: inherit;">En este caso, una situaci√≥n es permisible cuando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer son</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no tanto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Solo en este caso la operaci√≥n dada de ambos analizadores puede considerarse falsa. </font><font style="vertical-align: inherit;">Por lo tanto, vale la pena analizar cuidadosamente todas las opciones posibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øY si cavas m√°s profundo?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expresi√≥n 'command! = Null' siempre es verdadera. AsyncDocumentSession.Load.cs (175) Raven.Client Se emite una </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
advertencia porque el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo CreateRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nunca devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De hecho, solo mira su c√≥digo para ver esto:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, esta comprobaci√≥n no es un problema, aunque puede ser que el m√©todo utilizado para devolver nulo en ciertas circunstancias, pero ahora arroja una excepci√≥n. </font><font style="vertical-align: inherit;">Qui√©n sabe, es posible que en lugar de esa comprobaci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ahora haya un try-catch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede tener una pregunta muy razonable: ¬ød√≥nde se lanza la excepci√≥n aqu√≠? </font><font style="vertical-align: inherit;">Si no lo son, entonces todav√≠a tenemos un cheque adicional, y no puede haber ning√∫n error aqu√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, por desgracia, cuando se ejecuta el m√©todo, se puede lanzar una excepci√≥n, adem√°s, dos veces. </font><font style="vertical-align: inherit;">Primero en el m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, en el constructor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copiar y pegar tradicional</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">encontraron</font></a><font style="vertical-align: inherit;"> dos fragmentos de c√≥digo similares. Quiz√°s, esto es un error tipogr√°fico. SmugglerResult.cs (256), SmugglerResult.cs (253) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dudo mucho que al menos alguien vea rarezas aqu√≠ al mirar el c√≥digo. La funci√≥n consta de 14 condiciones similares y todas las variables terminan con Actualizado. Incluso cuando se proporciona una peque√±a parte aqu√≠, el error no es inmediatamente visible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cerebro humano literalmente se niega a buscar cualquier cosa en ese c√≥digo. Al mismo tiempo, PVS-Studio descubri√≥ f√°cilmente que est√° asignado, lo m√°s probable es que est√© completamente equivocado, deber√≠a:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es l√≥gico que la l√≠nea inferior a la derecha del operador de asignaci√≥n sea </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Estoy seguro de que sin un an√°lisis est√°tico, esta rareza se encontrar√≠a solo si algo lo suficientemente grave se hubiera roto debido a eso. </font><font style="vertical-align: inherit;">El programador podr√° notar que un problema est√° oculto en esta funci√≥n, a menos que solo si lo sabe de antemano.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh eso "??"</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quiz√°s el '??' El operador funciona de una manera diferente a la esperada. Su prioridad es inferior a la prioridad de otros operadores en su parte izquierda. InMemoryDocumentSessionOperations.cs (1952) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, existe la posibilidad de que esto no sea un error en absoluto, as√≠ es como se pretend√≠a. Y sin embargo, este lugar parece muy sospechoso. Despu√©s de todo, es l√≥gico suponer que la idea de la funci√≥n no es devolver 0 con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == null.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Creo que realmente hay un error relacionado con las prioridades de los operadores. En este caso, debe poner los corchetes:</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, si de repente todo est√° realmente planeado, entonces quiz√°s deber√≠as se√±alarlo expl√≠citamente, entonces el analizador y los programadores que leen el c√≥digo no tendr√°n preguntas:</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero esto es cuesti√≥n de gustos, por supuesto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pasando par√°metros</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posible orden incorrecto de argumentos pasados ‚Äã‚Äãal m√©todo 'ValidateLicense': 'newLicense' y 'oldLicense'. </font><font style="vertical-align: inherit;">LicenseHelper.cs (177) Raven. Los </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
argumentos del </font><font style="vertical-align: inherit;">servidor </font><font style="vertical-align: inherit;">pasaron al m√©todo en orden sospechoso. </font><font style="vertical-align: inherit;">De hecho, eche un vistazo al anuncio:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es muy agradable que PVS-Studio pueda encontrar incluso tales errores. </font><font style="vertical-align: inherit;">Este es un gran ejemplo de la cuesti√≥n de los beneficios del an√°lisis est√°tico sobre el an√°lisis din√°mico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de lo anterior, inicialmente suger√≠ que puede no importar en qu√© orden se pasan estos argumentos. </font><font style="vertical-align: inherit;">Por supuesto, en este caso los nombres no se habr√≠an elegido correctamente, pero ¬øqu√© puede hacer? </font><font style="vertical-align: inherit;">Sin embargo, la estructura interna de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sugiere que estos par√°metros todav√≠a tienen significados diferentes. </font><font style="vertical-align: inherit;">El c√≥digo de esta funci√≥n se puede ver haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nunca continuar</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresi√≥n </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> 'GetCounterValueAndCheckIfShouldSkip (item.DocumentId, null, prop, out long value, out bool delete)' siempre es falsa. RavenEtlDocumentTransformer.cs (362) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√©todo se puede considerar completamente haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una advertencia indica que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se puede acceder a </font><font style="vertical-align: inherit;">una llamada </font><i><font style="vertical-align: inherit;">continua</font></i><font style="vertical-align: inherit;"> en este bucle. Y si es as√≠, entonces el fragmento es realmente extra√±o. ¬øPero tal vez es solo un falso positivo? Sin embargo, Rider no jura por esto. </font><i><font style="vertical-align: inherit;">Eche un</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
vistazo al m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, este m√©todo puede devolver </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solo si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En el c√≥digo considerado anteriormente, exactamente el puntero nulo se pasa al lugar de este par√°metro. </font><font style="vertical-align: inherit;">Entonces, la llamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continua</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><font style="vertical-align: inherit;">realmente inalcanzable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este momento puede ser tanto una omisi√≥n inofensiva como un problema asociado con alg√∫n error en la condici√≥n. </font><font style="vertical-align: inherit;">De una forma u otra, debes prestarle atenci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Confiar pero verificar</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una parte de la expresi√≥n condicional siempre es verdadera si se eval√∫a: ¬°Atributos! = Nulo. </font><font style="vertical-align: inherit;">LicenseStatus.cs (28) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un fragmento extremadamente extra√±o. </font><font style="vertical-align: inherit;">Por lo general, las comprobaciones superfluas se separan al menos de alguna manera: aqu√≠ la correspondencia de la variable con el puntero nulo se verifica directamente en las siguientes l√≠neas. </font><font style="vertical-align: inherit;">Parece que el c√≥digo, muy probablemente, no tiene en absoluto lo que el programador quer√≠a.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anulable que nunca es nulo</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresi√≥n 'suspend.HasValue' siempre es verdadera. </font><font style="vertical-align: inherit;">RachisAdminHandler.cs (116) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra comprobaci√≥n "extra" aparentemente inofensiva. </font><font style="vertical-align: inherit;">Aunque a√∫n no est√° claro por qu√© el analizador lo considera as√≠. </font><i><font style="vertical-align: inherit;">Gire</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, a veces esta funci√≥n devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">S√≠, y Rider no consider√≥ innecesario ese cheque. </font><font style="vertical-align: inherit;">¬øFall√≥ el unicornio?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="Cuadro 15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¬øqu√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si nos fijamos en el m√©todo </font><i><font style="vertical-align: inherit;">GetStringQueryString</font></i><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm, si el par√°metro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requiere</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llamar√° al</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m√©todo </font><i><font style="vertical-align: inherit;">ThrowRequiredMember</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Me pregunto qu√© hace √©l. </font><font style="vertical-align: inherit;">:) Bueno, as√≠ que ciertamente no queda ninguna duda:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, resumimos. El desarrollador llama al m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Probablemente cree que potencialmente el m√©todo no obtendr√° el valor necesario. Bueno, como resultado, devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En el interior, se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llama a GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En caso de problemas, devolver√° nulo o arrojar√° una excepci√≥n. El segundo ocurre si el par√°metro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requerido</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se </font><font style="vertical-align: inherit;">establece en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Adem√°s, este es su valor predeterminado. Al mismo tiempo, al llamar a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , si observa el c√≥digo anterior, simplemente no se transmite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos una vez m√°s el c√≥digo del m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuyo fragmento jur√≥ el analizador:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que, por dise√±o, el hilo no debe interrumpirse aqu√≠ si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no puede obtener el valor. De hecho, despu√©s de un bloque con una comprobaci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se realizan varias acciones y se devuelve un valor. Creo que, por dise√±o, estas acciones se realizan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">independientemente del</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©xito del m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ¬øQu√© pasar√° realmente? Un hilo de ejecuci√≥n ser√° interrumpido por una excepci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para corregir este punto, necesita una llamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pasar como el </font><font style="vertical-align: inherit;">valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requerido</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del segundo par√°metro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Entonces todo funcionar√° realmente como se esperaba.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije antes, a veces parece que el analizador est√° equivocado (qu√© pecado ocultar, a veces sucede). </font><font style="vertical-align: inherit;">Tambi√©n con bastante frecuencia, la advertencia parece insignificante. </font><font style="vertical-align: inherit;">Parece que hay un cheque adicional aqu√≠, y est√° bien. </font><font style="vertical-align: inherit;">Bueno, o incluso mejor, lo eliminamos y no hay problemas, ¬°la advertencia desaparecer√°! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso en los casos en que la operaci√≥n parezca extra√±a e incomprensible, no la marque apresuradamente como falsa. </font><font style="vertical-align: inherit;">Debe intentar comprender por qu√© el analizador considera que el lugar es problem√°tico y tomar una decisi√≥n despu√©s de eso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rarezas</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : el </font><font style="vertical-align: inherit;">par√°metro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'numberOfResults' siempre se reescribe en el cuerpo del m√©todo antes de usarse. </font><font style="vertical-align: inherit;">DocumentHandler.cs (273), DocumentHandler.cs (267) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El par√°metro pasado a la funci√≥n no se utiliza, pero se sobrescribe de inmediato. </font><font style="vertical-align: inherit;">¬øPor qu√© se necesita aqu√≠? </font><font style="vertical-align: inherit;">¬øQuer√≠an pasarlo por ref? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ten√≠a curiosidad por ver c√≥mo se usa este m√©todo en el c√≥digo existente. </font><font style="vertical-align: inherit;">Esperaba que, dado que es privado, no deber√≠a haber demasiados. </font><font style="vertical-align: inherit;">Gracias Rider, encontr√© f√°cilmente d√≥nde se realiza la llamada. </font><font style="vertical-align: inherit;">Este era el √∫nico lugar:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la variable se le asigna 0, luego se pasa al m√©todo, cuyo resultado se le asigna. </font><font style="vertical-align: inherit;">Y dentro del m√©todo, este par√°metro no se usa de ninguna manera. </font><font style="vertical-align: inherit;">Em. </font><font style="vertical-align: inherit;">¬øPor qu√© todo esto?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="Cuadro 6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operador l√≥gico incorrecto</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresi√≥n 'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3' siempre es falsa. </font><font style="vertical-align: inherit;">Probablemente el '||' </font><font style="vertical-align: inherit;">El operador debe usarse aqu√≠. </font><font style="vertical-align: inherit;">QueryMetadata.cs (861) Raven.Server El </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m√©todo completo se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta vez tenemos un error obvio, que consiste en usar el operador l√≥gico incorrecto. </font><font style="vertical-align: inherit;">En su forma actual, verificar el n√∫mero de argumentos simplemente no funciona, porque no hay ning√∫n valor que sea menor que 2 y mayor que 3. Las intenciones reales del desarrollador se revelan f√°cilmente con el primer argumento pasado al constructor de excepciones:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo de prueba extra√±o</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una parte de la expresi√≥n condicional siempre es verdadera si se eval√∫a: isMethod. QueryParser.cs (1797) Raven.Server El </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m√©todo completo se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La construcci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Method (campo, fuera del m√©todo var)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> me record√≥ m√©todos est√°ndar como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><i><font style="vertical-align: inherit;">TryParse</font></i><font style="vertical-align: inherit;"> . Dichos m√©todos intentan obtener el resultado y escribirlo en la variable out, y el indicador del √©xito de la operaci√≥n es el valor de retorno. El c√≥digo que usa tales funciones generalmente verifica el valor de retorno y luego realiza ciertas operaciones basadas en √©l. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi opini√≥n, la funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado aqu√≠ de esta manera. El resultado del </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , adem√°s, es el valor de retorno del m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operador</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que lo llama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El analizador indica que la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> siempre ser√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y su verificaci√≥n en la condici√≥n no tiene sentido. Esto significa que la funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nunca devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ¬øCu√°l es entonces el uso de tal construcci√≥n? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, aseg√∫rese de que el analizador no se haya equivocado:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, el valor de retorno de este m√©todo es siempre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cierto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Y si todo se plane√≥ como estaba, entonces esto ... es extra√±o, pero no importa, en principio. ¬øPero y si no? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReadMethodArguments</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuyo c√≥digo se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , arroja excepciones en algunos casos. Esto sucede cuando un m√©todo no puede realizar correctamente su tarea. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que el c√≥digo que llama a la funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font><i><font style="vertical-align: inherit;">est√°</font></i><font style="vertical-align: inherit;"> dise√±ado para generar excepciones. Lo m√°s probable es que se suponga que cuando no es posible obtener correctamente el valor de la variable out, la funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devolver√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sin embargo, con la implementaci√≥n actual, se lanzar√° una excepci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sea como fuere, vale la pena prestar atenci√≥n a este fragmento.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo! = nulo?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una parte de la expresi√≥n condicional siempre es falsa si se eval√∫a: m_curEdgeBlock! = Null. </font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs (803) Raven.Debug A la </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
variable se le asigna un puntero nulo, y luego, despu√©s de algunas l√≠neas, se verifica su desigualdad </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En este caso, el c√≥digo que verifica </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index! = M_curEdgeBlock.Index + 1 deja de tener</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sentido </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Adem√°s, nunca se lanzar√° una excepci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es l√≥gico suponer que algo no funciona como deber√≠a, porque el fragmento se ve muy extra√±o. </font><font style="vertical-align: inherit;">O bien la verificaci√≥n no es necesaria aqu√≠, o de alguna manera se implementa incorrectamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede considerar la activaci√≥n y, por otro lado, ir desde el opuesto. </font><font style="vertical-align: inherit;">Tratemos de imaginar una situaci√≥n en la que esta respuesta sea falsa. </font><font style="vertical-align: inherit;">Creo que esto solo es posible si el valor de la variable se puede cambiar llamando a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sin embargo, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un campo privado y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una cola est√°ndar que se inicializa en la misma clase. </font><font style="vertical-align: inherit;">Por lo tanto, es muy dudoso que una llamada a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pueda afectar de alguna manera el valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por lo tanto, lo m√°s probable es que el desencadenante no sea falso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero o nulo</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posible </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">anulaci√≥n de</font></a><font style="vertical-align: inherit;"> referencia de 'mainSchema'. 'Tables.FirstOrDefault' puede devolver un valor nulo predeterminado. DatabaseSchema.cs (31) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font><font style="vertical-align: inherit;">operaci√≥n </font><font style="vertical-align: inherit;">, a primera vista, puede parecer incomprensible. De hecho, ¬ø </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu√©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene que ver </font><i><font style="vertical-align: inherit;">FirstOrDefault</font></i><font style="vertical-align: inherit;"> con </font><i><font style="vertical-align: inherit;">√©l</font></i><font style="vertical-align: inherit;"> ? Para dejar en claro por qu√© el analizador jura, debe mirar la funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llamar al m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lugar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede deberse al hecho de que la colecci√≥n puede no contener elementos que coincidan con la condici√≥n especificada. En este caso, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y, por lo tanto, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devolver√°n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ya que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TableSchema</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un tipo de referencia. Es por eso que PVS-Studio dice que en este c√≥digo puede ocurrir un intento de desreferenciar un puntero nulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todav√≠a puede valer la pena verificar este caso para que la ejecuci√≥n no se interrumpa con una </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si la opci√≥n en la que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tables.FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imposible, entonces no tiene sentido usar</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lugar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siempre cierto</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresi√≥n </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> siempre es verdadera. </font><font style="vertical-align: inherit;">Probablemente el operador '&amp;&amp;' deber√≠a usarse aqu√≠. </font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs (21) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro ejemplo de una situaci√≥n en la que es muy probable que se seleccione el operador l√≥gico incorrecto. </font><font style="vertical-align: inherit;">En este caso, la condici√≥n siempre es verdadera, porque la variable definitivamente no es igual a al menos uno de los valores con los que se compara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que "||" </font><font style="vertical-align: inherit;">debe ser reemplazado por "&amp;&amp;". </font><font style="vertical-align: inherit;">Entonces lo escrito tendr√° sentido. </font><font style="vertical-align: inherit;">Sin embargo, si el operador l√≥gico se elige correctamente, lo m√°s probable es que una de las condiciones sea una comparaci√≥n de otras variables. </font><font style="vertical-align: inherit;">De una forma u otra, este fragmento parece muy sospechoso y debe analizarse.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, quiero agradecer a todos los que llegaron a este lugar. El art√≠culo fue bastante extenso, pero espero que est√© interesado en trabajar conmigo para comprender la nueva versi√≥n del analizador PVS-Studio y estudiar los errores encontrados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es importante recordar que el desarrollador debe establecer como su objetivo principal no reducir el n√∫mero de operaciones. No por el simple hecho de lograr un registro de errores vac√≠o, debe usar PVS-Studio. Combatir lo positivo es como combatir los s√≠ntomas de una enfermedad que sufre el c√≥digo fuente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mirar los mensajes del analizador, siempre debe intentar comprender por qu√© se emite esta o aquella advertencia. </font><font style="vertical-align: inherit;">Solo al darnos cuenta de la l√≥gica por la cual el analizador emiti√≥ una advertencia podemos concluir si indica un error o no. </font><font style="vertical-align: inherit;">Es en este caso que no luchar√°s con el s√≠ntoma, sino con la enfermedad. </font><font style="vertical-align: inherit;">Y as√≠ es como su c√≥digo se volver√° m√°s limpio y saludable. </font><font style="vertical-align: inherit;">Y, por supuesto, habr√° muchos menos problemas con una fuente tan buena. </font><font style="vertical-align: inherit;">Aunque es mejor, deseo que no los tengas en absoluto :)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="Cuadro 16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea compartir este art√≠culo con una audiencia de habla inglesa, utilice el enlace a la traducci√≥n: Nikita Lipilin. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo encontrar errores en un proyecto de C # que funciona en Linux y macOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es507086/index.html">Convierta el script Bash a c√≥digo C # para enviar SMS a trav√©s del m√≥dem usb HUAWEI E3372</a></li>
<li><a href="../es507090/index.html">¬øC√≥mo puede un equipo de tecnolog√≠a construir su inicio, o la ruta desde el monitoreo funcional a la plataforma AIOps?</a></li>
<li><a href="../es507092/index.html">Te invitamos al segundo mitap en l√≠nea Zabbix</a></li>
<li><a href="../es507104/index.html">La gran divisi√≥n en la importaci√≥n: aclarando la incertidumbre con la importaci√≥n en Typecript</a></li>
<li><a href="../es507106/index.html">¬øC√≥mo es la implementaci√≥n de DNS sobre HTTPS?</a></li>
<li><a href="../es507112/index.html">PayOnline | Adquisici√≥n de Internet para empresas</a></li>
<li><a href="../es507114/index.html">Oda Excel: 34 a√±os de magia</a></li>
<li><a href="../es507116/index.html">"Udalenka". Notas del desarrollador de la oficina de ayer. Parte 2</a></li>
<li><a href="../es507124/index.html">PDB no es solo piel valiosa</a></li>
<li><a href="../es507132/index.html">Vladimir Kitov: "¬°Es imposible entender c√≥mo los cient√≠ficos pioneros previeron la informatizaci√≥n universal en la d√©cada de 1950!"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>