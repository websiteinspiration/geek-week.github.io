<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🚒 🛃 🤣 Cómo encontrar errores en un proyecto de C #, trabajando bajo Linux y macOS 🤟🏿 👨🏻‍⚖️ 🚣🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio es un conocido analizador de código estático que le permite encontrar muchos errores difíciles ocultos en la fuente. La prueba beta de la n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cómo encontrar errores en un proyecto de C #, trabajando bajo Linux y macOS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="Cuadro 8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio es un conocido analizador de código estático que le permite encontrar muchos errores difíciles ocultos en la fuente. </font><font style="vertical-align: inherit;">La prueba beta de la nueva versión se ha completado recientemente, en la que es posible analizar proyectos de C # para Linux y macOS. </font><font style="vertical-align: inherit;">Además, el analizador ahora puede integrarse con JetBrains Cross-Platform IDE - Rider. </font><font style="vertical-align: inherit;">Este artículo le permitirá familiarizarse con estas características en el ejemplo de verificar el proyecto de código abierto RavenDB.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducción</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hace algún tiempo, mi colega </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Vasiliev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escribió una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nota</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre la apertura de una prueba beta de una nueva versión del analizador estático PVS-Studio que estamos desarrollando. </font><font style="vertical-align: inherit;">Ahora se completa la prueba beta y la nueva versión se puede descargar haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En el mismo artículo, examinaremos cómo analizar proyectos de C # en Linux / macOS utilizando la interfaz de la consola y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Después de eso, realizaremos un análisis tradicional de algunas operaciones interesantes del analizador.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="Cuadro 5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la verificación, se eligió un proyecto RavenDB abierto, cuyo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> totaliza casi 5 mil archivos de código fuente. </font><font style="vertical-align: inherit;">Es una base de datos NoSQL bastante popular. </font><font style="vertical-align: inherit;">Los detalles se pueden encontrar en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sitio web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es fácil adivinar que me atrajo su tamaño, porque en un proyecto tan grande y, sin duda, serio, probablemente habrá algo interesante.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfaz de línea de comando</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar, considere cómo analizar a través de la consola. </font><font style="vertical-align: inherit;">Esta sección, en mi opinión, será especialmente interesante para aquellos que quieran integrar el analizador en el sistema de CI. </font><font style="vertical-align: inherit;">El equipo que comienza el análisis tiene varias opciones interesantes, pero en el caso general, todo es bastante trivial. </font><font style="vertical-align: inherit;">Para analizar RavenDB, voy a la carpeta del proyecto e ingreso lo siguiente en la consola:</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El indicador -t (abreviatura de destino) se utiliza para especificar una solución o archivo de proyecto para verificación. </font><font style="vertical-align: inherit;">La línea presentada anteriormente comienza el análisis y, como resultado del trabajo, forma un archivo que contiene los errores encontrados. </font><font style="vertical-align: inherit;">Es simple, ¿no es así?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jinete</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajar con el analizador en Rider es casi lo mismo que en Visual Studio. </font><font style="vertical-align: inherit;">La interfaz simple e intuitiva del complemento le permite verificar el proyecto con solo un par de clics. </font><font style="vertical-align: inherit;">Esto no es una exageración: para el análisis de RavenDB solo tuve que hacer clic en el menú superior Herramientas, seleccionar "PVS-Studio" y hacer clic en "Comprobar solución / proyecto actual".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="Imagen 2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los resultados del análisis se mostrarán en la parte inferior de la ventana en la pestaña PVS-Studio (bueno, ¿cuál más? :))</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="Cuadro 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al igual que con el complemento para Visual Studio, hacer doble clic en una advertencia mostrará la ubicación con la que está asociado. Todo es conveniente y comprensible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Más importante aún, la herramienta PVS-Studio no solo indica errores, sino que tiene una infraestructura que facilita la implementación de la metodología de análisis estático incluso en un proyecto antiguo grande.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea general es la siguiente. El usuario inició el analizador y recibió muchas advertencias. Dado que un proyecto que se ha desarrollado durante muchos años está vivo, se desarrolla y genera dinero, lo más probable es que no haya muchas advertencias en el informe que indiquen defectos críticos. En otras palabras, los errores críticos ya se han solucionado de una forma u otra de manera más costosa o gracias a los comentarios de los clientes. En consecuencia, todo lo que el analizador ahora encuentra puede considerarse una deuda técnica, lo cual no es práctico para tratar de eliminarlo de inmediato. Es racional ignorar estas advertencias por ahora, pero escribir código nuevo que ya realice análisis regulares.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede decirle a PVS-Studio que considere estas advertencias como irrelevantes (posponga la deuda técnica para más adelante) y no las muestre nuevamente. El analizador crea un archivo especial donde almacena información sobre errores hasta ahora poco interesantes. Y ahora PVS-Studio emitirá advertencias solo en código nuevo o modificado. Además, todo esto se implementa de manera inteligente. Si, por ejemplo, se agrega una línea vacía al comienzo de un archivo, entonces el analizador comprende que, de hecho, nada ha cambiado y permanecerá en silencio. Este archivo de marcado se puede incrustar en el sistema de control de versiones. El archivo es grande, pero no da miedo, porque a menudo no tiene sentido colocarlo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora todos los programadores verán advertencias relacionadas solo con el código nuevo o modificado. Por lo tanto, el analizador puede comenzar a usar lo que se llama al día siguiente. Y será posible volver a la deuda técnica más tarde, y gradualmente corregir errores y configurar el analizador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para suprimir las advertencias sobre el código existente en Rider, simplemente vaya al menú superior en Herramientas-&gt; PVS-Studio y haga clic en "Suprimir todos los mensajes".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="Foto 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la ventana que aparece, advirtiendo que todas las operaciones actuales caerán en la lista de supresión, haga clic en "Aceptar". </font><font style="vertical-align: inherit;">Como resultado, se creará un archivo de supresión en la carpeta del proyecto, que el analizador tendrá en cuenta durante el trabajo posterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cabe señalar que Rider ya tiene un analizador que resalta con éxito algunos errores. </font><font style="vertical-align: inherit;">Por lo tanto, una serie de advertencias de PVS-Studio apunta a un código que parece sospechoso desde el punto de vista del editor. </font><font style="vertical-align: inherit;">Sin embargo, PVS-Studio a menudo encuentra errores que podrían alejarse del ojo sensible del analizador de JetBrains. </font><font style="vertical-align: inherit;">Es por eso que la solución más efectiva es permitirles trabajar en equipo.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="Cuadro 10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y de postre</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, como se prometió, consideraremos qué advertencias interesantes mostró el analizador de acuerdo con los resultados de la verificación. El proyecto contiene una gran cantidad de archivos de código fuente, por lo que no fue sorprendente encontrar muchos momentos sospechosos en él. No hay nada que hacer: todos cometen errores, pero es importante hacer todo lo posible para detectarlos y corregirlos de manera oportuna. El análisis estático puede simplificar enormemente esta tarea. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado de la verificación, se mostraron alrededor de mil advertencias:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="Cuadro 11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede leer más sobre los niveles de advertencia haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, no todos los desencadenantes indican errores súper aterradores. </font><font style="vertical-align: inherit;">Si esto fuera así, sería poco probable que al menos algo funcionara en el proyecto :). </font><font style="vertical-align: inherit;">Pero es importante comprender que si el analizador "jura", entonces el código parece extraño y debe estudiarse cuidadosamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, el proyecto encontró muchos aspectos positivos interesantes. </font><font style="vertical-align: inherit;">Sin embargo, no quisiera que el artículo sea muy grande, por lo que consideraremos solo algunos de ellos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Solo un cheque extra?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresión </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> 'dirpath == null' siempre es falsa. PosixHelper.cs (124) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta operación puede considerarse de diferentes maneras. Por un lado, un cheque adicional, por supuesto, no es muy bueno, pero en sí mismo no es un error. Por otro lado, vale la pena considerarlo: ¿este código realmente funciona de la manera prevista por el programador? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quizás el desarrollador realmente no sabía que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nunca volvería </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si esto no es así, entonces podemos suponer lo que él quería lograr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tal vez </font><font style="vertical-align: inherit;">debería llamarse a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuando no es posible obtener un padre para el directorio en cuestión. Si es así, entonces verificando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiene sentido. </font><font style="vertical-align: inherit;">Sin embargo, debemos considerar no el resultado de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sino el valor devuelto por el método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lo contrario, devolver </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent genera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una excepción al llamar a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nulo típico</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El objeto 'artículo' se usó después de que se verificó contra nulo. Líneas de verificación: 249, 247. ActiveTransactions.cs (249), ActiveTransactions.cs (247) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El código se ve extraño debido a lo que sucede cuando el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realmente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De hecho, si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> también </font><i><font style="vertical-align: inherit;">es </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condición es verdadera y un intento de obtener </font><font style="vertical-align: inherit;">un elemento. El </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arrojará una excepción. Y si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no puede ser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces la condición " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"es simplemente superfluo. Esto se debe a que se verifica solo cuando el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento == nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Bueno, si de repente el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no puede ser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces toda la condición pierde su significado y solo agrega anidamiento innecesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que aquí, tal vez se selecciona el operador lógico incorrecto. Si reemplaza "||" con "&amp;&amp;" en la condición, el código inmediatamente comienza a verse lógico. Bueno, no pueden surgir problemas en este caso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El desarrollo de dicho plan son representantes típicos de errores muy peligrosos en la teoría detectada por el analizador Para ser justos, debe tenerse en cuenta que el analizador integrado en Rider también marca este fragmento como potencialmente peligroso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Otro cheque de nuevo?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresión </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> '_continuationState.Count&gt; 0' siempre es verdadera. </font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs (152) Sparrow </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, en la condición externa, se verifica que el número de elementos en la colección sea mayor que 1, y luego en la siguiente línea el operador ternario verifica que su número sea mayor que 0. Parece que una de las verificaciones debería verse diferente. </font><font style="vertical-align: inherit;">De una forma u otra, este código parece muy sospechoso y debe estudiarse y procesarse cuidadosamente si es necesario.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE posible</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El objeto 'node.Indexer' se usó antes de que se verificara como nulo. Verifique las líneas: 1180, 1182. ExpressionStringBuilder.cs (1180), ExpressionStringBuilder.cs (1182) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, este es otro lugar que PVS-Studio y Rider consideran sospechoso. Es cierto que la redacción es algo diferente: el analizador de JetBrains solo resalta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer.DeclaringType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el comentario "Posible NullReferenceException". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambos revisores afirman que, de hecho, se puede lanzar una excepción en este fragmento. Debo decir que la advertencia de PVS-Studio no solo dice que aquí es posible un error, sino que también explica por qué tenía esa opinión. Parece un poco, pero agradable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, no es un hecho que realmente haya un error. </font><font style="vertical-align: inherit;">Es posible que si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especifique exactamente. </font><font style="vertical-align: inherit;">En este caso, una situación es permisible cuando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer son</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no tanto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Solo en este caso la operación dada de ambos analizadores puede considerarse falsa. </font><font style="vertical-align: inherit;">Por lo tanto, vale la pena analizar cuidadosamente todas las opciones posibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Y si cavas más profundo?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expresión 'command! = Null' siempre es verdadera. AsyncDocumentSession.Load.cs (175) Raven.Client Se emite una </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
advertencia porque el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">método CreateRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nunca devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De hecho, solo mira su código para ver esto:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, esta comprobación no es un problema, aunque puede ser que el método utilizado para devolver nulo en ciertas circunstancias, pero ahora arroja una excepción. </font><font style="vertical-align: inherit;">Quién sabe, es posible que en lugar de esa comprobación de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ahora haya un try-catch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede tener una pregunta muy razonable: ¿dónde se lanza la excepción aquí? </font><font style="vertical-align: inherit;">Si no lo son, entonces todavía tenemos un cheque adicional, y no puede haber ningún error aquí. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, por desgracia, cuando se ejecuta el método, se puede lanzar una excepción, además, dos veces. </font><font style="vertical-align: inherit;">Primero en el método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, en el constructor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copiar y pegar tradicional</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">encontraron</font></a><font style="vertical-align: inherit;"> dos fragmentos de código similares. Quizás, esto es un error tipográfico. SmugglerResult.cs (256), SmugglerResult.cs (253) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dudo mucho que al menos alguien vea rarezas aquí al mirar el código. La función consta de 14 condiciones similares y todas las variables terminan con Actualizado. Incluso cuando se proporciona una pequeña parte aquí, el error no es inmediatamente visible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cerebro humano literalmente se niega a buscar cualquier cosa en ese código. Al mismo tiempo, PVS-Studio descubrió fácilmente que está asignado, lo más probable es que esté completamente equivocado, debería:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es lógico que la línea inferior a la derecha del operador de asignación sea </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Estoy seguro de que sin un análisis estático, esta rareza se encontraría solo si algo lo suficientemente grave se hubiera roto debido a eso. </font><font style="vertical-align: inherit;">El programador podrá notar que un problema está oculto en esta función, a menos que solo si lo sabe de antemano.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh eso "??"</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quizás el '??' El operador funciona de una manera diferente a la esperada. Su prioridad es inferior a la prioridad de otros operadores en su parte izquierda. InMemoryDocumentSessionOperations.cs (1952) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, existe la posibilidad de que esto no sea un error en absoluto, así es como se pretendía. Y sin embargo, este lugar parece muy sospechoso. Después de todo, es lógico suponer que la idea de la función no es devolver 0 con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == null.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Creo que realmente hay un error relacionado con las prioridades de los operadores. En este caso, debe poner los corchetes:</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, si de repente todo está realmente planeado, entonces quizás deberías señalarlo explícitamente, entonces el analizador y los programadores que leen el código no tendrán preguntas:</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero esto es cuestión de gustos, por supuesto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pasando parámetros</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posible orden incorrecto de argumentos pasados ​​al método 'ValidateLicense': 'newLicense' y 'oldLicense'. </font><font style="vertical-align: inherit;">LicenseHelper.cs (177) Raven. Los </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
argumentos del </font><font style="vertical-align: inherit;">servidor </font><font style="vertical-align: inherit;">pasaron al método en orden sospechoso. </font><font style="vertical-align: inherit;">De hecho, eche un vistazo al anuncio:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es muy agradable que PVS-Studio pueda encontrar incluso tales errores. </font><font style="vertical-align: inherit;">Este es un gran ejemplo de la cuestión de los beneficios del análisis estático sobre el análisis dinámico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de lo anterior, inicialmente sugerí que puede no importar en qué orden se pasan estos argumentos. </font><font style="vertical-align: inherit;">Por supuesto, en este caso los nombres no se habrían elegido correctamente, pero ¿qué puede hacer? </font><font style="vertical-align: inherit;">Sin embargo, la estructura interna de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sugiere que estos parámetros todavía tienen significados diferentes. </font><font style="vertical-align: inherit;">El código de esta función se puede ver haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nunca continuar</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresión </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> 'GetCounterValueAndCheckIfShouldSkip (item.DocumentId, null, prop, out long value, out bool delete)' siempre es falsa. RavenEtlDocumentTransformer.cs (362) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este método se puede considerar completamente haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una advertencia indica que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se puede acceder a </font><font style="vertical-align: inherit;">una llamada </font><i><font style="vertical-align: inherit;">continua</font></i><font style="vertical-align: inherit;"> en este bucle. Y si es así, entonces el fragmento es realmente extraño. ¿Pero tal vez es solo un falso positivo? Sin embargo, Rider no jura por esto. </font><i><font style="vertical-align: inherit;">Eche un</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
vistazo al método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, este método puede devolver </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solo si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En el código considerado anteriormente, exactamente el puntero nulo se pasa al lugar de este parámetro. </font><font style="vertical-align: inherit;">Entonces, la llamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continua</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><font style="vertical-align: inherit;">realmente inalcanzable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este momento puede ser tanto una omisión inofensiva como un problema asociado con algún error en la condición. </font><font style="vertical-align: inherit;">De una forma u otra, debes prestarle atención.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Confiar pero verificar</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una parte de la expresión condicional siempre es verdadera si se evalúa: ¡Atributos! = Nulo. </font><font style="vertical-align: inherit;">LicenseStatus.cs (28) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un fragmento extremadamente extraño. </font><font style="vertical-align: inherit;">Por lo general, las comprobaciones superfluas se separan al menos de alguna manera: aquí la correspondencia de la variable con el puntero nulo se verifica directamente en las siguientes líneas. </font><font style="vertical-align: inherit;">Parece que el código, muy probablemente, no tiene en absoluto lo que el programador quería.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anulable que nunca es nulo</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresión 'suspend.HasValue' siempre es verdadera. </font><font style="vertical-align: inherit;">RachisAdminHandler.cs (116) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra comprobación "extra" aparentemente inofensiva. </font><font style="vertical-align: inherit;">Aunque aún no está claro por qué el analizador lo considera así. </font><i><font style="vertical-align: inherit;">Gire</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, a veces esta función devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sí, y Rider no consideró innecesario ese cheque. </font><font style="vertical-align: inherit;">¿Falló el unicornio?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="Cuadro 15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¿qué </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si nos fijamos en el método </font><i><font style="vertical-align: inherit;">GetStringQueryString</font></i><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm, si el parámetro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requiere</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llamará al</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> método </font><i><font style="vertical-align: inherit;">ThrowRequiredMember</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Me pregunto qué hace él. </font><font style="vertical-align: inherit;">:) Bueno, así que ciertamente no queda ninguna duda:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, resumimos. El desarrollador llama al método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Probablemente cree que potencialmente el método no obtendrá el valor necesario. Bueno, como resultado, devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En el interior, se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llama a GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En caso de problemas, devolverá nulo o arrojará una excepción. El segundo ocurre si el parámetro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requerido</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se </font><font style="vertical-align: inherit;">establece en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Además, este es su valor predeterminado. Al mismo tiempo, al llamar a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , si observa el código anterior, simplemente no se transmite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos una vez más el código del método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuyo fragmento juró el analizador:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que, por diseño, el hilo no debe interrumpirse aquí si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no puede obtener el valor. De hecho, después de un bloque con una comprobación de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se realizan varias acciones y se devuelve un valor. Creo que, por diseño, estas acciones se realizan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">independientemente del</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éxito del método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ¿Qué pasará realmente? Un hilo de ejecución será interrumpido por una excepción. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para corregir este punto, necesita una llamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pasar como el </font><font style="vertical-align: inherit;">valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requerido</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del segundo parámetro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Entonces todo funcionará realmente como se esperaba.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije antes, a veces parece que el analizador está equivocado (qué pecado ocultar, a veces sucede). </font><font style="vertical-align: inherit;">También con bastante frecuencia, la advertencia parece insignificante. </font><font style="vertical-align: inherit;">Parece que hay un cheque adicional aquí, y está bien. </font><font style="vertical-align: inherit;">Bueno, o incluso mejor, lo eliminamos y no hay problemas, ¡la advertencia desaparecerá! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso en los casos en que la operación parezca extraña e incomprensible, no la marque apresuradamente como falsa. </font><font style="vertical-align: inherit;">Debe intentar comprender por qué el analizador considera que el lugar es problemático y tomar una decisión después de eso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rarezas</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : el </font><font style="vertical-align: inherit;">parámetro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'numberOfResults' siempre se reescribe en el cuerpo del método antes de usarse. </font><font style="vertical-align: inherit;">DocumentHandler.cs (273), DocumentHandler.cs (267) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El parámetro pasado a la función no se utiliza, pero se sobrescribe de inmediato. </font><font style="vertical-align: inherit;">¿Por qué se necesita aquí? </font><font style="vertical-align: inherit;">¿Querían pasarlo por ref? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenía curiosidad por ver cómo se usa este método en el código existente. </font><font style="vertical-align: inherit;">Esperaba que, dado que es privado, no debería haber demasiados. </font><font style="vertical-align: inherit;">Gracias Rider, encontré fácilmente dónde se realiza la llamada. </font><font style="vertical-align: inherit;">Este era el único lugar:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la variable se le asigna 0, luego se pasa al método, cuyo resultado se le asigna. </font><font style="vertical-align: inherit;">Y dentro del método, este parámetro no se usa de ninguna manera. </font><font style="vertical-align: inherit;">Em. </font><font style="vertical-align: inherit;">¿Por qué todo esto?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="Cuadro 6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operador lógico incorrecto</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresión 'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3' siempre es falsa. </font><font style="vertical-align: inherit;">Probablemente el '||' </font><font style="vertical-align: inherit;">El operador debe usarse aquí. </font><font style="vertical-align: inherit;">QueryMetadata.cs (861) Raven.Server El </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
método completo se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta vez tenemos un error obvio, que consiste en usar el operador lógico incorrecto. </font><font style="vertical-align: inherit;">En su forma actual, verificar el número de argumentos simplemente no funciona, porque no hay ningún valor que sea menor que 2 y mayor que 3. Las intenciones reales del desarrollador se revelan fácilmente con el primer argumento pasado al constructor de excepciones:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método de prueba extraño</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una parte de la expresión condicional siempre es verdadera si se evalúa: isMethod. QueryParser.cs (1797) Raven.Server El </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
método completo se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La construcción </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Method (campo, fuera del método var)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> me recordó métodos estándar como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><i><font style="vertical-align: inherit;">TryParse</font></i><font style="vertical-align: inherit;"> . Dichos métodos intentan obtener el resultado y escribirlo en la variable out, y el indicador del éxito de la operación es el valor de retorno. El código que usa tales funciones generalmente verifica el valor de retorno y luego realiza ciertas operaciones basadas en él. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi opinión, la función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado aquí de esta manera. El resultado del </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , además, es el valor de retorno del método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operador</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que lo llama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El analizador indica que la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> siempre será </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verdadera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y su verificación en la condición no tiene sentido. Esto significa que la función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nunca devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ¿Cuál es entonces el uso de tal construcción? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, asegúrese de que el analizador no se haya equivocado:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, el valor de retorno de este método es siempre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cierto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Y si todo se planeó como estaba, entonces esto ... es extraño, pero no importa, en principio. ¿Pero y si no? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReadMethodArguments</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuyo código se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , arroja excepciones en algunos casos. Esto sucede cuando un método no puede realizar correctamente su tarea. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que el código que llama a la función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font><i><font style="vertical-align: inherit;">está</font></i><font style="vertical-align: inherit;"> diseñado para generar excepciones. Lo más probable es que se suponga que cuando no es posible obtener correctamente el valor de la variable out, la función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devolverá </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sin embargo, con la implementación actual, se lanzará una excepción.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sea como fuere, vale la pena prestar atención a este fragmento.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo! = nulo?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Una parte de la expresión condicional siempre es falsa si se evalúa: m_curEdgeBlock! = Null. </font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs (803) Raven.Debug A la </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
variable se le asigna un puntero nulo, y luego, después de algunas líneas, se verifica su desigualdad </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En este caso, el código que verifica </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index! = M_curEdgeBlock.Index + 1 deja de tener</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sentido </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Además, nunca se lanzará una excepción. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es lógico suponer que algo no funciona como debería, porque el fragmento se ve muy extraño. </font><font style="vertical-align: inherit;">O bien la verificación no es necesaria aquí, o de alguna manera se implementa incorrectamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede considerar la activación y, por otro lado, ir desde el opuesto. </font><font style="vertical-align: inherit;">Tratemos de imaginar una situación en la que esta respuesta sea falsa. </font><font style="vertical-align: inherit;">Creo que esto solo es posible si el valor de la variable se puede cambiar llamando a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sin embargo, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un campo privado y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una cola estándar que se inicializa en la misma clase. </font><font style="vertical-align: inherit;">Por lo tanto, es muy dudoso que una llamada a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pueda afectar de alguna manera el valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por lo tanto, lo más probable es que el desencadenante no sea falso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero o nulo</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posible </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">anulación de</font></a><font style="vertical-align: inherit;"> referencia de 'mainSchema'. 'Tables.FirstOrDefault' puede devolver un valor nulo predeterminado. DatabaseSchema.cs (31) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font><font style="vertical-align: inherit;">operación </font><font style="vertical-align: inherit;">, a primera vista, puede parecer incomprensible. De hecho, ¿ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qué</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene que ver </font><i><font style="vertical-align: inherit;">FirstOrDefault</font></i><font style="vertical-align: inherit;"> con </font><i><font style="vertical-align: inherit;">él</font></i><font style="vertical-align: inherit;"> ? Para dejar en claro por qué el analizador jura, debe mirar la función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llamar al método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lugar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede deberse al hecho de que la colección puede no contener elementos que coincidan con la condición especificada. En este caso, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y, por lo tanto, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devolverán </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ya que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TableSchema</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un tipo de referencia. Es por eso que PVS-Studio dice que en este código puede ocurrir un intento de desreferenciar un puntero nulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todavía puede valer la pena verificar este caso para que la ejecución no se interrumpa con una </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si la opción en la que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tables.FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devuelve </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imposible, entonces no tiene sentido usar</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lugar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siempre cierto</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia del analizador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expresión </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;"> siempre es verdadera. </font><font style="vertical-align: inherit;">Probablemente el operador '&amp;&amp;' debería usarse aquí. </font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs (21) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro ejemplo de una situación en la que es muy probable que se seleccione el operador lógico incorrecto. </font><font style="vertical-align: inherit;">En este caso, la condición siempre es verdadera, porque la variable definitivamente no es igual a al menos uno de los valores con los que se compara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que "||" </font><font style="vertical-align: inherit;">debe ser reemplazado por "&amp;&amp;". </font><font style="vertical-align: inherit;">Entonces lo escrito tendrá sentido. </font><font style="vertical-align: inherit;">Sin embargo, si el operador lógico se elige correctamente, lo más probable es que una de las condiciones sea una comparación de otras variables. </font><font style="vertical-align: inherit;">De una forma u otra, este fragmento parece muy sospechoso y debe analizarse.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusión</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, quiero agradecer a todos los que llegaron a este lugar. El artículo fue bastante extenso, pero espero que esté interesado en trabajar conmigo para comprender la nueva versión del analizador PVS-Studio y estudiar los errores encontrados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es importante recordar que el desarrollador debe establecer como su objetivo principal no reducir el número de operaciones. No por el simple hecho de lograr un registro de errores vacío, debe usar PVS-Studio. Combatir lo positivo es como combatir los síntomas de una enfermedad que sufre el código fuente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mirar los mensajes del analizador, siempre debe intentar comprender por qué se emite esta o aquella advertencia. </font><font style="vertical-align: inherit;">Solo al darnos cuenta de la lógica por la cual el analizador emitió una advertencia podemos concluir si indica un error o no. </font><font style="vertical-align: inherit;">Es en este caso que no lucharás con el síntoma, sino con la enfermedad. </font><font style="vertical-align: inherit;">Y así es como su código se volverá más limpio y saludable. </font><font style="vertical-align: inherit;">Y, por supuesto, habrá muchos menos problemas con una fuente tan buena. </font><font style="vertical-align: inherit;">Aunque es mejor, deseo que no los tengas en absoluto :)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="Cuadro 16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea compartir este artículo con una audiencia de habla inglesa, utilice el enlace a la traducción: Nikita Lipilin. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo encontrar errores en un proyecto de C # que funciona en Linux y macOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es507086/index.html">Convierta el script Bash a código C # para enviar SMS a través del módem usb HUAWEI E3372</a></li>
<li><a href="../es507090/index.html">¿Cómo puede un equipo de tecnología construir su inicio, o la ruta desde el monitoreo funcional a la plataforma AIOps?</a></li>
<li><a href="../es507092/index.html">Te invitamos al segundo mitap en línea Zabbix</a></li>
<li><a href="../es507104/index.html">La gran división en la importación: aclarando la incertidumbre con la importación en Typecript</a></li>
<li><a href="../es507106/index.html">¿Cómo es la implementación de DNS sobre HTTPS?</a></li>
<li><a href="../es507112/index.html">PayOnline | Adquisición de Internet para empresas</a></li>
<li><a href="../es507114/index.html">Oda Excel: 34 años de magia</a></li>
<li><a href="../es507116/index.html">"Udalenka". Notas del desarrollador de la oficina de ayer. Parte 2</a></li>
<li><a href="../es507124/index.html">PDB no es solo piel valiosa</a></li>
<li><a href="../es507132/index.html">Vladimir Kitov: "¡Es imposible entender cómo los científicos pioneros previeron la informatización universal en la década de 1950!"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>