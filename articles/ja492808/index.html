<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔩 👨🏿‍🤝‍👨🏼 😓 非常灯スイッチ位置センサー ✊🏿 🤱🏼 👈🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="自律型非常灯システムを設計するすべての人の前に、遅かれ早かれ、非常灯のオン/オフの問題が発生します。追加のスイッチで部屋のデザインを台無しにしないように、これを最も便利で透過的な方法で行うにはどうすればよいですか？
 
 
 カットの下でのソリューションの1つ。
 
 
 バックグラウンド
 現代の...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>非常灯スイッチ位置センサー</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自律型非常灯システムを設計するすべての人の前に、遅かれ早かれ、非常灯のオン/オフの問題が発生します。</font><font style="vertical-align: inherit;">追加のスイッチで部屋のデザインを台無しにしないように、これを最も便利で透過的な方法で行うにはどうすればよいですか？</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f4/90/kp/f490kpxmliwuhfpeeuf-lhmjhou.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カットの下でのソリューションの1つ。</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンド</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現代の世界では、多くのことが無停電電源に結びついています。ほとんどのタイプの知的活動は、コンピューターと通信が24時間年中無休で稼働していなければ、すでに考えられません。これは良くも悪くもありません、そしてあなたはそれとともに生きる必要があります。特に、職場がUPSやバックアップディーゼル発電機を備えた近代的なオフィスではなく、普通の住宅の高層ビルのアパートにある場合。そして偶然にも旧ソ連のほとんどの都市における住宅のエネルギー供給の信頼性は望まれるべき多くのものを残しています。その結果、家庭用コンセントと最寄りの発電所を接続するスレッドは、定期的に壊れるという悪い癖があります。 6か月に1回、1日に3回。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、新しいアパートで修理を始めるときは、プロジェクトに電源と照明を中断することなく平行配線を最初に敷設しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アパート全体に通常の電力を供給できるICEを備えた強力な発電機を自由に使えるようにしたいのですが、この考えを放棄する必要がありました。民家ではまったく問題は出なかったでしょうが、アパートはまったく別です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の問題は排気ガスの除去であり、セントラルヒーティングのある家のアパートには絶対に入れられません。まあ、窓のすぐ外にあるホースを捨てないでください。煙はすぐに最も近くの開いている隣人の窓に吸い込まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の問題はノイズです。はい、現代のインバーター4ストロークジェネレーターは、路上で聞くと非常に静かに見えます。また、追加のサイレンサーを掛けると、完全にサイレントになります。しかし、私が信じているのは、完全に静かなアパートの建物を意味する、エネルギーを奪われた状態です。そのような静かなうなり声でさえ、すべての隣人に完全に聞こえるでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要するに、ジェネレーターを使ったアイデアは死んでしまいました。残りの実際のオプションのうち、残ったのはバッテリーだけでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、普遍的な真実を主張することなく、自分の感情的な試練と最初の人で行われた決定についての簡単な物語を自分自身に許可します。</font><font style="vertical-align: inherit;">そして、私は誰かへの私の議論が納得できないように見えるかもしれないとすぐに警告します、そしてなされた決定は物議を醸しています。</font><font style="vertical-align: inherit;">しかし、それにもかかわらず、ここで説明されているすべてが現在ハードウェアに実装されており、タスクを正常に実行しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、誰かが問題の純粋に実用的な面に興味があり、私がそのような人生に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">たどり着いたとしても</font></a><font style="vertical-align: inherit;">、彼は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの手紙をスキップして既製の解決策の説明に直接行くことができます。</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッテリーの種類の選択について簡単に</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題は記事のトピックとは関係ありませんが、ここにも5セントを挿入します。さらに、そのようなステートメントの下で必然的に発生することは、ディスカッションが多く</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のlulz</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有用な情報</font><s><font style="vertical-align: inherit;">を</font></s><font style="vertical-align: inherit;">運ぶことがよくあり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日、代替エネルギーの急速な発展の時代に、比較的手頃な価格の工業用に製造された家庭用無停電電源システムが、太陽光発電または風力発電所と組み合わされて登場し始めています。それらの最も進んだものは、システム全体の有効性の電子「エンハンサー」の全ヒープを備えたリチウムイオン電池を使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の場合、客観的な理由により、どの小型発電所についても話をすることはできず、「啓発」中に通常のコンセントから再生できるバックアップソースだけが興味深いものでした。したがって、集合UPSがアパートUPSのすべての電子スタッフィングを自分たちで集合的に行うことになりました。そして、私の手が完全にほどかれたので、最初に決定する必要があったのは、どのタイプの電池を使用するかでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初、私は次のように考えました。</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタイリッシュでトレンディな若者</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。密閉され、エネルギー効率が高く、耐久性があります。」しかし、価格を見てみると、私のリチウムへの熱意は著しく落ち着きました。学校の算数と組み合わせてすばやく検索すると、（もちろん）最も正直な5000 mAHを備えた非常に「馬鹿げた」中国の26650銀行でさえ、同じエネルギー消費の酸性バッテリーの5倍の費用がかかることがわかりました。そして、価格で並べ替えられた価格の下からではないものを選択すると、その差は簡単に8〜10倍に達します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、どうすればこのような大きな価値の違いを埋め合わせることができますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、リチウムは1キログラムと1立方メートルあたりのエネルギーをより効率的に蓄えます。シガレットブロックのサイズのバッテリーは、10キログラムの鉛蓄電池を簡単に使用できます。しかし、この事実は静止した使用にとってとても重要ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、優れた「リチウム」ですが、適切なアプローチにより、より長く持続します。でも10回？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、スケールの反対側では、原因不明のバッテリーの潜在的な爆発性、より複雑な充電アルゴリズム、廃棄の問題（すべてのホームレスの人が鉛バッテリーの使用方法を知っている一方で、リチウムははるかに複雑です）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要するに、要因の合計によって、私はリチウムのアイデアを次の反復まで延期することにしました。おそらく数年で何かが変わるでしょうが、今のところ、リードが私たちのすべてです。</font></font><br>
<br>
<blockquote>,      ,        .    ,    ,           ,           .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
鉛電池に関しては、いくつかのオプションもあります。 「正しい」オプションは、UPS、セルラー基地局、および大電流を取り込んで供給し、時々強い放電を経験し、実際に人々の注意をそらさずに作業できることが必要な他の同様の場所で使用される特殊なバックアップバッテリーです。サービスのため。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの「正しい」オプションは、電気オートローダー用の牽引バッテリー、または何といってもディーゼル潜水艦です。これらのバッテリーは、耐久性が高く、深い放電に対する耐性が高く、所有者から「水を補給する」機会を奪わない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、「間違った」オプションは、最寄りの自動車店からのスターターバッテリーです。そのようなバッテリーは、一時的に最大1キロワットの電力を山に与える可能性がありますが、怠惰な人の仕事のように、放電はストレスになります。そして、使い捨て電池の栄光は、一般的に現代のカルシウム電池に根付いています：「放電-変化」。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、それでは、実装のために最終的にどのオプションを選択したのか誰も疑わないことを願っていますか？右、3番目。そして、ここでの理由は、よく知られたいぼ状の両生類だけでなく、単純な実用的な計算にもあります。スターターバッテリーは他のすべてのオプションよりも数倍安価であり、リチウムの価値に近づくこともあります。そして、高価なバッテリーを揺さぶる代わりに、健康的な無関心の状況では、交換により数週間の食料消費量が失われるため、はるかに自由になります。さらに、パルスを失う前にこれらのバッテリーを使い尽くさない場合、バックアップの役割でのバッテリーの寿命は何年もの間計算されます。いつでも容量の大きいバッテリーを入れて、放電制限を柔らかく設定し、さらに「適切な」バッテリーよりも優れた価格/容量比を得ることができます。深い放電に苦しんでいます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題の主なものは、少なくともバッテリーの設置場所の「壁の穴」レベルで換気を提供することです。</font><font style="vertical-align: inherit;">まあ、電流源の低電圧は警戒を鈍らせ、すべてが非常にひどく終わる可能性があるので、短絡に対する平凡な保護を組織してください。</font></font><br>
<br>
<h3><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単一のアパートでの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">現在の戦争</font></a></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バッテリーの種類に関する最終的な決定によって引き起こされた道徳的な安心の後、新しい理由が慎重に考えるようにすぐに現れました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に230 Vの交流発電機を手に入れたかったことを思い出させてください。しかし、客観的な現実と調和し、精神的にバッテリーに切り替えた後、適切なDCからACコンバーターを選択するために、思考の慣性がすでに有名な中国のオンライン市場に運ばれました。そして、その特性を研究する過程で、忘れられた「修正された正弦波」という言葉が最初に浮上し、常識が不快な疑問を投げ出し始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
質問の本質は次のとおりです。小さなバッテリーでアパートのすべてのエネルギー需要をカバーすることはまだ機能しません。ボイラー、電子レンジ、洗濯機、強力なデスクトップコンピューターは、依然として電力に耐えられません。そして、この非常に修正された正弦波のために、冷蔵庫、フード、そして平凡なファンさえも適切に動作することができません。もちろん、真の正弦波を備えたインバータもありますが、それらは高価であるだけでなく、効率も劣ります。そして、強力な消費者の問題はまだ解決されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
予算内に残っている消費者は？それほど多くはありません。ラップトップや携帯電話/タブレットなどの家庭用電化製品、ルーター、ARMサーバー、気分はテレビ、そしてもちろん照明です。さらに、記事の最初のメッセージ（および私の個人的な動機）は、バックアップワークステーションがラップトップの形で機能し、トイレの照明などの家庭の快適さが最小限であることを確実にすることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのデバイスのほとんどすべてが動作するために5〜21 Vの一定電圧を必要とし、最初にバッテリー電圧を230 V ACに上げ、次にそれを再び下げて初期レベルのプラスまたはマイナスに直線化する必要はありません。これらの変換では、エネルギーの最大50％を失うのは簡単ですが、私はまったく笑いませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、これが代替案として低電圧直流ネットワークを使用するようになったアイデアです。</font><font style="vertical-align: inherit;">ワイヤの損失を概算すると、最初の12（13.8）Vがより実用的な24（27.6）Vに変わりました。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初は36（41.4）Bも取得したかったのですが、このすべての経済での作業に使用する予定のいくつかの電子部品の特性を調べた後、食欲を抑える必要がありました。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font><font style="vertical-align: inherit;">純銅の</font><font style="vertical-align: inherit;">断面が3.5 mm </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2の</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替配線では、</font><font style="vertical-align: inherit;">直列に接続された2つの自動車用バッテリーから最終的に電圧が印加されました。</font></font><br>
<br>
<blockquote>,        .           (   )   .                ,      .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
部屋の消費者が利用できるようにするために、コンセントの各「大きな」ブロックにさらに1つのコンセントが追加されました。また、通常のコンセントとバックアップコンセントを混同しないように、幅の異なるフラットコンタクトの「アメリカン」タイプを後者として設置しました。これにより、まず、掃除機をDCネットワークに接続できなくなります。次に、そのようなコンセントは、ヨーロッパのコンセントとは異なり、「正しい」プラグを使用するときに常に同じ極性を使用します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/sm/th/blsmthnmtxqcekbdftv8dfg3u2a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのコンセント用にラップトップアダプターが作成され、電圧を必要な18〜20 Vに下げ、対応するコネクターを装備しました。</font><font style="vertical-align: inherit;">かかとがすべての小さなもののための通常の5ボルトUSB充電でできていたことは明らかです。</font><font style="vertical-align: inherit;">まあ、念のために、電力が50ワットと200ワットの一対の小型24/230 Vコンバーターを購入しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アメリカのプラグ、同じ電源コード、パルスダウンコンバーターの既製のボードで充電するためのケースは、中国から注文されました。</font><font style="vertical-align: inherit;">ワイヤーを接続するためだけにはんだごてが必要でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では特に興味深いことは何もないので、この記事では発電所については触れません。そのため、「底」の問題の1つ、つまり、バッテリーによって蓄積されたエネルギーを照明目的に利用する問題に直接進みます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点灯</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、アパートを主配線と並列に配線するとき、電圧が24（27.6）Vの代替DCネットワークの配線が引き出されました。とりわけ、そのような配線のペアで構成されるループが各スイッチボックスに巻き付けられ、230 Vネットワーク配線と一緒にシーリングライトにつながった（部屋に複数ある場合は、代わりのワイヤーが1つだけにつながっていた）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ランプの分野でDCネットワークの出力をどうするかは、個別のアプローチの問題です。光源として、通常の24ボルトLEDストリップが選択されました。備品の設計に応じて、（部屋の面積に比例して）異なる長さのそのセグメントは、それらのハウジングに直接取り付けられるか、またはそれがよく輝き、あまり目立たない場所から接着されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれにせよ、これは技術的な問題よりも美的であり、現在は別の問題です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、各スイッチのボックスには、「通常の」ライトをオンに切り替えるための230 Vネットワークの相線のループと、緊急照明用のDCネットワークの両方の線のループがあります。これからダンス。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局、私の前の課題は、3つの状態を互いに分離できる特定のデバイスを作成することでした。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AC電源はOK→非常灯をオフにします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACネットワークがオフになり、スイッチの接点が閉じます→非常灯をオンにします。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACネットワークがオフになり、スイッチの接点が開いている→非常灯をオフにします。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクションは一方的であると見なします。たとえば、すでにオフになっている照明をオフにしても、何も変わりません。</font><font style="vertical-align: inherit;">これらの状態は、ACネットワークの動作とスイッチの接点の位置を決定するタスクが解決されれば、互いに区別できます。</font><font style="vertical-align: inherit;">同時に、私は以下の初期条件を持っていました：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主照明と非常照明の両方の管理は、追加のボタンの「集合農場」ではなく、1つの統治機関から完全に透過である必要があります。</font></font></li>
<li> ,  ,   ,        .</li>
<li>      ,        .</li>
<li>      –    ,  .</li>
<li>-        .</li>
<li>        (    ),  .</li>
<li>      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、ゼロボックスにAC主電源がないことは、非常に複雑な設計の誤計算であることが判明しました。</font><font style="vertical-align: inherit;">それがなければ、スイッチの入力での電圧の存在の決定は不可能になります。</font><font style="vertical-align: inherit;">技術的には、直流ネットワークのマイナス線をゼロとして使用することは可能ですが、これは私の参照条件の完全に破壊できない段落5と矛盾します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">センサー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それにもかかわらず、幹線電圧を測定する代替手段が存在します。電圧の存在を判断する必要はありません。スイッチの接点を閉じた状態で、相線の電流の存在を判断するだけで十分です。結局のところ、電流があれば電圧があります。さらに、正確な電流の「読み取り」により、停電の場合だけでなく、平凡な電球の焼損の場合にも緊急照明を作動させることができます。この方法では、スイッチがオフのときにACネットワークの状態を判別することはできませんが、この状態は問題になりません。スイッチがオフになると、非常照明も機能しなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特にこの電流が交流である場合、ワイヤー内の電流の存在を決定することは非常に簡単です。</font><font style="vertical-align: inherit;">ここでは、たとえば、ワイヤの周囲の磁場を検出するホールセンサーを適用できます。</font><font style="vertical-align: inherit;">しかし</font><font style="vertical-align: inherit;">、巻線付きのリング磁気回路で構成</font><font style="vertical-align: inherit;">された一般的な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変流器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用することで問題を解決できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">リングに交流線を通し、磁気回路に磁場を作ります。</font><font style="vertical-align: inherit;">このフィールドは、巻線の1次電流に比例して、巻線に2次電流を誘導します。</font><font style="vertical-align: inherit;">したがって、この単純なデバイスを使用すると、ワイヤーを切断することなく、一般に一次回路との電気的接続なしに、ワイヤーの交流電流の強度を測定できます。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電気技師にとって非常に便利なツールである電流クランプの作業は、同じ原理に基づいています。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スイッチの近くにそのような変圧器がある場合は、2次巻線の電圧を測定して、ランプ回路に電流が流れているかどうかを確認するだけで十分です。私が言ったように、最初の近似での電流の存在は、2つの事実を示しています。ネットワークに電圧が230 Vあり、スイッチが閉じています。これらの最初の事実は、非常用照明作動装置の操作に不可欠です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の将来のデバイスの2番目の「入力パラメーター」は、スイッチの接点の位置になるはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
趣味の同僚によって開始されたブレーンストーミングは、回路遮断器の位置を決定するためのさまざまなオプションをもたらしました。基本的には、別の接点のペアを追加するために設計を変更することになります。ここで想像の範囲は非常に大きいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単一のスイッチの代わりに二重のスイッチを使用し、それらの半分を機械的に「並列化」して、それらが単一の全体になるようにすることが可能でした。このオプションは外部の美学に違いはなく、照明が二重回路でスイッチが最初は二重だった部屋の問題を解決しませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その他のオプションには、スイッチメカニズムに磁石を備えたマイクロスイッチまたはリードスイッチの導入が含まれていました。しかし、適用された回路遮断器の設計を研究した後、これらのオプションも消えました。優れたスイッチのモノリシックセラミックベースは、コンパクトなマイクロスイッチであってもチャンスを残さず、キーのストロークが小さすぎ、リードスイッチの操作/リリースカーブにヒステリシスがあるため、マグネットとリードスイッチは機能しませんでした。</font></font><br>
<br>
<blockquote> «»        ,     . , ,       ,  .  ,   ,    ,               .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、スイッチの変更を必要としない方法を考え出す必要がありました。そして、この方法が見つかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記で、変流器について説明しました。これにより、破断やガルバニック接触なしに、ワイヤー内の交流電流の存在を判別できます。しかし、どのトランスも（同じホールセンサーとは対照的に）双方向デバイスであり、その1次巻線と2次巻線は交換可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような変圧器の二次巻線に交流電流を加えると、リングに通されたワイヤの端に電圧が誘導されます。そして、最も重要なことは、ソースからの巻線によって消費されるエネルギーは、ワイヤーの二次電流が円運動をするかどうかによって異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ここはもっと面白くなります。</font><font style="vertical-align: inherit;">ワイヤーがリングを通過します。リングはすぐに数センチメートルになり、スイッチの接点の1つに接続されます。</font><font style="vertical-align: inherit;">接点の位置を「感知」するためのデバイスを得るために、スイッチの反対側からの戻り経路をこの電流に提供することだけが残っています。</font><font style="vertical-align: inherit;">そして、この電流が交流であるという理由で、従来のコンデンサはそれのためのブリッジになることができます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gs/tr/g1/gstrg12mwdwhgu0qmbnl3twrfjc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、特定の条件下でこの回路を閉じるために、コンデンサは必要ありません。</font><font style="vertical-align: inherit;">十分に高い周波数の電流がトランスに「ポンプ」で送られる場合、ワイヤ間の浮遊容量は通過するのに十分です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/up/yp/ws/upypwscprb9xjbrlaye26xfkry8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、そのような検出器を整理するために必要なもの：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変流器。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランス出力電圧計。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高周波交流のソース。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆変圧器の巻線を流れる電流計。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最適なパラメーターの選択に関して最も難しいのは変圧器です。変流器モードでは、50 Hzの周波数で許容可能な電圧を与える必要があり、回路ブレーカーのアクティブな「検知」モードでは、数百KHzの周波数で許容可能な伝送係数を持ちます。</font><font style="vertical-align: inherit;">この要素は、電子回路をモデル化するためのプログラムでシミュレートすることは不可能であり、数学的な計算を使用しても、すべてが非常に困難であることが判明しました。</font><font style="vertical-align: inherit;">私は手にはんだごてを持って行き、最高のものを探すためにさまざまなオプションを運転するのに何時間も費やす必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
巻数と最適な負荷抵抗は経験的に選択されたものであり、最高の比率を見逃していないという事実ではありません。</font><font style="vertical-align: inherit;">実験の結果、次の構造が現れました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">透磁率10,000、サイズ10x6x4 mmのフェライトコア。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.25 mmエナメル線で30ターン巻きます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巻線の有効負荷は1 kOhmです。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
透磁率はかなり大きいです、おそらく、5000または2000ユニットのリングを使用することは理にかなっていますが、十分な量で私はこれらのリングを持っていました。</font><font style="vertical-align: inherit;">一般に、この場合の透過性は妥協値です。</font><font style="vertical-align: inherit;">低すぎると、トランスは50 Hzの周波数での動作に適さなくなり、高すぎると、数百キロヘルツを超える周波数ではすべてが損なわれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数の実験によりアイデアの現実が確認され、次の結果が得られました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変流器モードでは、透過係数は流れる電力（電圧220〜230 V）のワットあたり約1ミリボルトであることがわかりました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プローブモードでは、リークの周波数と静電容量に応じて、スイッチの開閉接点の電流差が2〜3倍に達しました。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。</font><font style="vertical-align: inherit;">両方の値は、流れる電流の両方を確実に固定するため、およびスイッチ接点の位置を決定するために十分すぎるほどです。</font><font style="vertical-align: inherit;">特定の実装次第です。</font></font><br>
<br>
<a name="Solution"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉄で</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のほとんどの設計とは異なり、ここではすでに検討の初期段階にあり、すぐにマイクロコントローラーを使用することが決定されました。</font><font style="vertical-align: inherit;">ニーズと経験に基づいて、選択はATtiny13Aで行いました。</font><font style="vertical-align: inherit;">このチップにはADCが搭載されており、電源電圧の代わりに1.1 Vの内部リファレンスソースを使用できます。</font><font style="vertical-align: inherit;">サウンディング信号の生成に最適なPWMがあります。</font><font style="vertical-align: inherit;">そして、後で重要であることが判明しましたが、キャリブレーションデータを保存できるEEPROMがあります。</font></font><br>
<br>
<blockquote>,          «  ,       ,       - «» ,  ».<br>
<br>
      .         .           .   ,   ,  ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、少なくともジェネレーター、電圧計、およびある種のトリガーを組み合わせて、測定間の現在の状態を保存する必要があります。一般に、投機的なスケッチには「コア」上でのみ少なくとも3つのケースが必要であり、コントローラーははるかに実用的であることが判明しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
負荷が10〜20 Wの電流トランスからの電圧は10〜20 mVであり、1.1 Vの制限でDAC入力に供給するには小さすぎます。したがって、コントローラーに加えて、信号電圧の最小値を上げるために、約100の伝達係数を持つアンプも必要です。数百ミリボルトまで。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般に、変流器の出力信号の電圧は、負荷電力だけでなく、その性質にも依存します。</font><font style="vertical-align: inherit;">たとえば、Ilyich電球などの純粋にアクティブな負荷では、ミリボルトレベルの正弦波が得られます。</font><font style="vertical-align: inherit;">単純なパルス電力と同じ電力のLED電球は、ボルト以上に短いバーストを与えます。</font><font style="vertical-align: inherit;">私たちはこれで遊ぶことができましたが、最初に、ユニバーサルデバイスを作成したいと思いました。次に、アパートに、PFC回路を装備した外部電源ユニットを備えた1つのランプがありました（つまり、アクティブに近い消費特性を持っています）。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は読者に中間オプションを苦しめることはせず、すぐにデバイスの最終図を示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/at/a-/vdata-spt78rd_pzv7s5awoobya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、経済的なリニアレギュレータLM2931-5.0を介したDC電圧がコントローラに給電します。ハウジング、機能、ピン配置の点では、このスタビライザーは一般的な78L05と似ていますが、内部消費量が低く（10 mAの負荷で約500μA）、入力電圧の短いバーストに対する耐性が大きい点が異なります。 20 V以下の電圧で作業する場合は、LP2950-5.0のさらに経済的なアナログを使用できます。</font></font><br>
<br>
<blockquote>   LP2950-5.0        30 .      24      .    -      ,     ,       ,     ,   .          50%,   100%.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トランスは図には示されていませんが、その巻線はピンTR1およびTR2に接続されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
負荷を切り替えるための重要な要素として、低電流のPチャネルMOSトランジスタ2SJ196が使用されます（LEDランプには最大1 Aの電流で十分です）。ただし、ピン配置、最大電流、最大ドレイン電圧に適した他の任意のものを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントローラとアクティブエレメントのキーに加えて、2つのトランジスタが使用されます。 1つは、非常用電源の電圧で動作するキーのシャッターを制御するために必要です。 2つ目は、変流器の出力からの増幅器信号として機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点で、オペアンプを使用することができますが、詳細に関してはゲインは最小限であり、数百キロヘルツを超える周波数での作業を忘れなければなりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ADCに供給されるのはトランス自体からの増幅信号ではなく、単一のサンプルで測定できるエンベロープであり、しばらくの間の「ストリーミング」デジタル化では測定できません。エンベロープを分離するために、2倍のショットキーダイオードが使用され、電圧倍増回路に従って接続されます。このような包含物は、古典的な振幅検出器を形成し、ダイオード自体の両端の電圧降下が大幅に補償されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
センサーの動作原理は簡単です。最初に、ワイヤーの電流を測定するために必要なアクションのアルゴリズムを検討します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
電流測定モードでは、PB0ピンは出力モードになり、ロジック0によって接地されます。これにより、コントローラからの信号がポイントTR1に送信されなくなります。並行して、ピンPB3で同じ動作が実行され、その結果、コンデンサC2の上部出力が接地されます。このコンデンサと抵抗R1により、カットオフ周波数が約1500 Hzのローパスフィルターが作成されます。このフィルターのおかげで、測定信号の形成におけるさまざまな高周波ノイズの役割が大幅に軽減されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、PB4に高レベルを適用して、信号増幅器に電力を供給します。トランジェントの完了後、変圧器の出力からの50 Hzの電流が増幅されて整流器に到達し、整流器でコンデンサC8を充電します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンデンサC8の充電はADC1を使用して測定され、得られた電圧値から、変圧器を流れる「一次」電流について結論が導き出されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクティブセンシングは別の方法で実行されます。まず、ピンPB0がPWMソルバーに変換され、数百キロヘルツからメガヘルツの単位の周波数で信号が供給されます。この信号は、抵抗分割器によっていくらか減衰され、ポイントTR1で変流器巻線に供給されます。コンデンサC1は、分周器R4の上アームと一緒に、カットオフ周波数が約1.5 MHzのローパスフィルターを作成します。これにより、矩形パルスからの高周波高調波のレベルが低減されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トランス巻線を通過した後、ポイントTR2からのプローブ信号は同じ増幅器と検出器に到達し、同様に最終的にコンデンサーC8を「外部」トランス回路の負荷に比例する電圧に充電します。同様に、コンデンサの電荷は、マイクロコントローラのADCを使用して測定されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの「緩い」の説明。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
抵抗R5は、パワースイッチのゲートの電圧を制限するように設計されています。これは、低電圧MOSFETの場合、通常20 Vを超えないようにする必要があります。私の場合、DCネットワークの電圧は最大30 Vであり、R3と組み合わせて得られる1：3分圧器の必要性を示しました。 20 V未満の電源から給電する場合、抵抗R5は必要ありません（ジャンパーに置き換えられます）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンデンサC4とC5は並列に接続され、2μFの静電容量を実現します。このコンデンサのペアは、低周波数と高周波数の両方の信号を等しく適切に送信する必要があるという点で注目に値します。ここでは、いくつかのマイクロファラッドの電解コンデンサと100つか2つのナノファラッドのセラミックの並列接続を使用することは可能ですが、そのような小さな容量の「電解質」は、マイクロファラッドの「セラミック」と比較した場合、サイズが大きくなりません。確かに、2マイクロファラッドでセラミックコンデンサを購入することは不可能だったので、2つを同じに配置しました。</font></font><br>
<br>
<blockquote>,   50     2  ,      .   ,        .               .    100   , ,   .       .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
抵抗R4とR1は分圧を形成し、PWM出力での5ボルトの交流電圧を変流器の出力電圧とほぼ等しくします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンデンサC8は、前述のように、測定対象の電圧を蓄積します。漏れ電流が最小の高品質のコンデンサであることが望ましいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特筆すべきは、マイクロコントローラのリセットレッグに接続された2ピンの「くし」TP1 / TP2に値します。これらの連絡先は、再起動するだけでなく、以下で説明する調整モードに入るときにも使用されます。単純に、すべてのウィッシュリストの実装後、コントローラーには空きピンがなくなり、ファームウェアのデバッグ中に1つの単純なコントロールを追加する必要が出てきました。したがって、この目的のためにコントローラーのリセットフットを使用する必要がありました。</font></font><br>
<br>
<blockquote> «»  AVR     RESET       GPIO.         ,       .         ,        .   ,        ,      ,      ,            RESET.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、回路は非常にシンプルであることが判明し、すべての「魔法」はマイクロコントローラーのファームウェアに実装されています。しかし、プロトタイプの製造後、「プローブ」の信頼性の高い動作のための配線容量は、多くの場合不十分であることが判明しました。変圧器を流れる電流の違いは、干渉のレベルと同等であることがわかり、回路の動作は信頼できなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、プロービング作業を容易にするために、ワイヤーにぶら下がっているフェライトリングを放棄し、デバイスの新しいリビジョンでボードに直接高電圧回路を追加する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでのポイントは、スイッチの接点を介してRF電流への経路を閉じる最短の方法となるようにオンにされた専用コンデンサを追加することです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i-/_f/63/i-_f636miltufzwifkx4xaxnab0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンデンサC10は、少なくともキロボルトの電圧用に設計する必要があり、その容量は妥協の原則に従って選択する必要があります。これにより、動作の信頼性が実用に十分であり、ランプを流れる浮遊容量電流が大きくなりすぎないようにします。</font><font style="vertical-align: inherit;">実際には、必要に応じて、この額面で「遊んでみる」ことができます。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いずれにせよ、そのようなセンサーを備えたスイッチはもはや理想的とは見なされません。</font><font style="vertical-align: inherit;">むしろ、インジケーター付きのスイッチに似ているため、まず、低品質のLEDランプの迷光やちらつきが発生する可能性があります。次に、強いものではありませんが、感電を引き起こす可能性があります。</font><font style="vertical-align: inherit;">したがって、壁のスイッチのみに依存して、照明の配線を操作する必要はありません。常に入り口の「スイッチ」をオフにしてください。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ボードにACネットワークの一部を追加する必要があったため、2つのシャットオフチョークも追加しました。これにより、高周波プローブ電流が配線に流れなくなります。プローブ電圧の周波数の実用的な値は数MHzに達する可能性があり、私はラジオのアマチュアとして、自分の手でネットワークの干渉の量を増やすという考えに非常にうんざりしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チョークL1とL2はパワーである必要があり、ダンベルまたはリングタイプのコアに目立つ厚さのワイヤーが巻かれています。 「抵抗」軸設計の信号チョークは使用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変流器の一次巻線は、リングに通されたワイヤの一部であり、ボード上のポイントTR3とTR4にはんだ付けされています。リングの両側で画面をTR5とTR6に接続するときに、このワイヤをシールドすることをお勧めします。</font></font><br>
<br>
<blockquote> TR6       ,   .    -   ,           .          ,          .</blockquote><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファームウェアコードとアセンブルされたHEXファイルは、回路とプリント基板のレイアウトとともに記事の最後に添付されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同調検出器のアルゴリズムは単純です。 3秒に1回、コントローラーはディープスリープから復帰し、測定を行い、必要に応じて、コントロールキーの状態を一方向または別の方向に変更します。したがって、スイッチの位置の変化に対する反応には、最大3秒の遅延があります。あまり便利ではありませんが、これは、第1にバックアップソースのエネルギーを節約するために行われ、第2に、ポーリング間隔を大幅に削減するために、測定のさまざまな段階でのトランジェントの持続時間が許可されません。最小間隔は1秒と見なすことができますが、その場合、回路はほぼ常にアクティブ消費モードになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論として、構成についてです。ランプによって消費される電流、長さおよびその他の配線機能、干渉のレベルなどに応じて、異なるセンサーが完全に異なる条件で動作する必要があるという事実により、適応パラメーターのユニバーサルセットをファームウェアに組み込むことは不可能でした。したがって、設置後の各センサーは、現場で1回の校正が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
センサーは、キャリブレーションデータがない間、または接点TP1とTP2を閉じた後、オンになるたびにキャリブレーションモードに入ります。キャリブレーションの最初の段階に入ったことは、5回点滅する緊急ランプで示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5回点滅した後、7.5秒後にスイッチが「オフ」の位置に設定されます。この後、ACネットワークに常に存在する干渉のレベルが測定されます。得られた値は、デューティサイクルでの測定の開始点として使用されます。また、この時点で、回路ブレーカーはさまざまな周波数で感知され、その後に最も「コントラスト」の高い周波数が選択されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、2番目の校正段階が始まり、非常ランプが2回点滅します。スイッチを「オン」の位置に切り替えるのに7.5秒の時間が与えられ、タイムアウト後、プログラムはランプによって消費される電流を測定します。ランプにいくつかの輝度レベルがある場合は、電源を入れた後、すぐに最小に切り替えて、将来センサーが使用可能なレベルのいずれかで正しく機能するようにする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目と最後のキャリブレーションステージの開始は、非常ランプが3回点滅することで示され、スイッチが「オン」モードのままであり、照明ネットワークがより高いレベルで（つまり、パネルのメインまたはセカンダリ回路ブレーカーを使用して）非励磁されている必要があります。 7.5秒この場合、異なる周波数で既にオンになっている回路ブレーカーの2回目の鳴動が実行され、最初の段階で得られた値を考慮して、オンとオフのスイッチの電流差が最大になる周波数が選択されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャリブレーションが正常に完了したことは、非常ランプが1回点滅することで示されます。3番目のステージ後の照明ネットワークがまだオフになっている場合は、調査の次の動作サイクルで非常照明をオンにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまな条件での電流と抵抗の測定値が近すぎて、信頼できる検出に使用できない場合、キャリブレーションは失敗します。</font><font style="vertical-align: inherit;">この場合、緊急照明ランプは、スイッチの位置がうまくいかないときに2回点滅するか、標準照明ランプの消費量が少なすぎるときに3回点滅します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終的にセンサーが2回点滅することでキャリブレーションを行いたくない場合は、C10の容量を増やしてみてください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスは非常にシンプルで、スイッチボックスに収まるほどコンパクトであることがわかりましたが、構成が非常に簡単であるとは言いませんでした。</font><font style="vertical-align: inherit;">もちろん、5G、クラウド制御がなく、GPSを使用した平凡なWiFiも提供されていないため、現代の「スマートホーム」のコンポーネントを利用していません。</font><font style="vertical-align: inherit;">それでも、これらのデバイスのうち8つが唯一の機能を実行し、停電状態では他に何も必要ありません。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファームウェアソースコード（Atmel Studio 7）</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 9600000 <span class="hljs-comment">//   (  : avrdude.exe -U lfuse:w:0x7a:m -U hfuse:w:0xff:m)</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/io.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/wdt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/interrupt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/eeprom.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//#define PROTEUS</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">bool</span>; <span class="hljs-comment">//   </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> true  (0 == 0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> false (0 != 0)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_U10BIT 0b0000001111111111 <span class="hljs-comment">//      </span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTERVAL         3   <span class="hljs-comment">//  , </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUR_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RES_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_DIV_OFFSET  2   <span class="hljs-comment">//     </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_MAXIMAL_DIV 6   <span class="hljs-comment">//     </span></span><font></font>
<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_cur_edge;<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_res_edge; <font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> EEPROM_frequency_dividor;<font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_edge, res_edge; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frequency_dividor; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> clk = <span class="hljs-number">0</span>; <span class="hljs-comment">//   watchdog</span>
<span class="hljs-keyword">bool</span> tp_reset = <span class="hljs-literal">false</span>; <span class="hljs-comment">//   TP1  TP2</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_vars</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">if</span>(MCUSR &amp; (<span class="hljs-number">1</span> &lt;&lt; EXTRF)) { <span class="hljs-comment">// ,       TP1  TP2</span>
    tp_reset = <span class="hljs-literal">true</span>;<font></font>
    MCUSR &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; EXTRF); <span class="hljs-comment">//  EXTRF       ,   </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_pins</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB0) | (<span class="hljs-number">1</span> &lt;&lt; PB1) | (<span class="hljs-number">1</span> &lt;&lt; PB2) | (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//       </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    watchdog</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_interrupts</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  sleep_enable(); <span class="hljs-comment">//   </span><font></font>
<font></font>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDCE) | (<span class="hljs-number">1</span> &lt;&lt; WDE); <span class="hljs-comment">//  watchdog</span>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDTIE) | WDTO_1S; <span class="hljs-comment">// watchdog      ,  1 </span><font></font>
<font></font>
  sei(); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_settings</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  cur_edge = eeprom_read_word(&amp;EEPROM_cur_edge); <span class="hljs-comment">//   </span>
  res_edge = eeprom_read_word(&amp;EEPROM_res_edge); <span class="hljs-comment">//   </span>
  frequency_dividor = eeprom_read_byte(&amp;EEPROM_frequency_dividor); <span class="hljs-comment">//   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_load</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">blink_load</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> count)</span> </span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">true</span>);<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">false</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   (   )</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) sleep_cpu();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_amp</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//     PB4</span>
    _delay_ms(<span class="hljs-number">250</span>);      <span class="hljs-comment">//       200 .</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB4);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_lpf</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    (  "0")     C2</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    ( )   C2  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_gen</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    TCCR0A |= (<span class="hljs-number">1</span> &lt;&lt; COM0A0) | (<span class="hljs-number">1</span> &lt;&lt; WGM01); <span class="hljs-comment">//    ( )    OC0A      OCR0A</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> PROTEUS</span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00); <span class="hljs-comment">//    1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00) | (<span class="hljs-number">1</span> &lt;&lt; CS02); <span class="hljs-comment">//    1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    OCR0A = FREQ_DIV_OFFSET + frequency_dividor; <span class="hljs-comment">//   ,         OC0A</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    TCCR0A = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_adc</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    ( )</span>
    ADMUX = <span class="hljs-number">0b01</span> | (<span class="hljs-number">1</span> &lt;&lt; REFS0); <span class="hljs-comment">// PB2, 1.1v reference</span>
    ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADPS0) | (<span class="hljs-number">1</span> &lt;&lt; ADPS1) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2) | <span class="hljs-comment">//       = 128 (75 )</span>
             (<span class="hljs-number">1</span> &lt;&lt; ADIE) |  <span class="hljs-comment">//    </span>
             (<span class="hljs-number">1</span> &lt;&lt; ADEN);   <span class="hljs-comment">//  </span>
  } <span class="hljs-keyword">else</span> {<font></font>
    ADCSRA = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    (  "0")   C8</span>
    _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//      C8</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_adc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_ADC); <span class="hljs-comment">//   "" </span>
  <span class="hljs-keyword">do</span> {<font></font>
    sleep_cpu(); <span class="hljs-comment">//      ,      ,   </span>
  } <span class="hljs-keyword">while</span>(ADCSRA &amp; (<span class="hljs-number">1</span> &lt;&lt; ADSC)); <span class="hljs-comment">//        ,  </span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> ADC;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
//  
static void blink_bin(unsigned int value, unsigned char count) {
  for(unsigned char i = 0; i &lt; count; ++i) {
    _delay_ms(1000);
    toggle_load(true);
    if(value &amp; (1 &lt;&lt; (count - i - 1))) {
      _delay_ms(500);
    } else {
      _delay_ms(50);
    }
    toggle_load(false);
  }
}
*/</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur;<font></font>
<font></font>
  toggle_lpf(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  cur = do_adc(); <span class="hljs-comment">//  </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
  toggle_lpf(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> cur;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_resistance</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> res;<font></font>
<font></font>
  toggle_gen(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  toggle_gen(<span class="hljs-literal">false</span>); <span class="hljs-comment">//   ,   C8     </span>
  res = do_adc(); <span class="hljs-comment">//     </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> MAX_U10BIT - res; <span class="hljs-comment">//      ,      </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_current() &gt;= cur_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_toggled_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_resistance() &lt;= res_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">do_main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is_current()) {<font></font>
    toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span>(is_toggled_on()) {<font></font>
      toggle_load(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  ,  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span><font></font>
    }<font></font>
  }<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">first_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (frequency_dividor == <span class="hljs-number">0xff</span>); <span class="hljs-comment">//   EEPROM   0xFF,        FREQ_MAXIMAL_DIV</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_off, cur_on, res_off, res_on, res_on_tmp, res_off_array[FREQ_MAXIMAL_DIV + <span class="hljs-number">1</span>], diff, max_diff, frequency_dividor_tmp;<font></font>
<font></font>
  blink_load(<span class="hljs-number">5</span>); <span class="hljs-comment">//    ,    </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  cur_off = get_current(); <span class="hljs-comment">//      ( )</span><font></font>
<font></font>
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_off_array[frequency_dividor] = get_resistance();<font></font>
  }<font></font>
<font></font>
  blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  cur_on = get_current(); <span class="hljs-comment">//     </span><font></font>
<font></font>
  blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  <font></font>
  res_off = MAX_U10BIT;<font></font>
  res_on = MAX_U10BIT;<font></font>
  frequency_dividor_tmp = <span class="hljs-number">0</span>;<font></font>
  max_diff = <span class="hljs-number">0</span>;
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_on_tmp = get_resistance();<font></font>
<font></font>
    <span class="hljs-comment">//   ,      </span>
    <span class="hljs-keyword">if</span>(res_off_array[frequency_dividor] &gt; res_on_tmp) {<font></font>
      diff = res_off_array[frequency_dividor] - res_on_tmp;<font></font>
      <span class="hljs-keyword">if</span>(diff &gt; max_diff) {<font></font>
        res_off = res_off_array[frequency_dividor];<font></font>
        res_on = res_on_tmp;<font></font>
        frequency_dividor_tmp = frequency_dividor;<font></font>
        max_diff = diff;<font></font>
      }    <font></font>
    }<font></font>
  }<font></font>
  frequency_dividor = frequency_dividor_tmp;<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(cur_on &gt; cur_off + CUR_MINIMAL_DIFF) { <font></font>
    cur_edge = cur_off + (cur_on - cur_off) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,     </span><font></font>
 <font></font>
    <span class="hljs-keyword">if</span>(res_on + RES_MINIMAL_DIFF &lt; res_off) {<font></font>
      res_edge = res_off - (res_off - res_on) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,      </span><font></font>
<font></font>
      <span class="hljs-comment">//   </span><font></font>
      eeprom_write_word(&amp;EEPROM_cur_edge, cur_edge);<font></font>
      eeprom_write_word(&amp;EEPROM_res_edge, res_edge);<font></font>
      eeprom_write_byte(&amp;EEPROM_frequency_dividor, frequency_dividor);<font></font>
      <font></font>
      blink_load(<span class="hljs-number">1</span>); <span class="hljs-comment">//  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
  }<font></font>
}<font></font>
<font></font>
ISR(WDT_vect) {<font></font>
  WDTCR |= (<span class="hljs-number">1</span> &lt;&lt; WDTIE); <span class="hljs-comment">//    watchdog   ""    </span><font></font>
}<font></font>
<font></font>
EMPTY_INTERRUPT(ADC_vect); <span class="hljs-comment">//     ,     </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  init_vars();<font></font>
  init_pins();       <font></font>
  init_interrupts(); <font></font>
  init_settings();<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(tp_reset || first_on()) {<font></font>
    calibrate(); <span class="hljs-comment">//          </span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {<font></font>
    set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
    sleep_cpu(); <span class="hljs-comment">//   watchdog</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span>(++clk &gt;= INTERVAL) {<font></font>
      do_main(); <span class="hljs-comment">//  </span>
      clk = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図、配線、および完全なAtmel Studio 7プロジェクトでアーカイブ</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja492788/index.html">疲れたが、ドイツはCOVID-19の最初の波を完全に止めた</a></li>
<li><a href="../ja492798/index.html">人々はインターネット上でチャットをするようになりましたが、今や再びオフラインを夢見ています。何が起こっていますか？</a></li>
<li><a href="../ja492800/index.html">住宅および公益事業におけるGSM IoTプロバイダー（パート1）</a></li>
<li><a href="../ja492804/index.html">パンデミック時の発生率の増加を最小限に抑えるための鍵としてのインターネット上の社会活動の複製の問題について</a></li>
<li><a href="../ja492806/index.html">エンゲージメントをモバイルゲームやアプリの収益化にリンクする方法</a></li>
<li><a href="../ja492810/index.html">[COVID-19]あなたの仕事はピークを滑らかにすることです</a></li>
<li><a href="../ja492812/index.html">OpenVINOでGANネットワークを実行しようとしています</a></li>
<li><a href="../ja492816/index.html">IntelliJ IDEAのヒントとコツ：4.設定を同期して共有する</a></li>
<li><a href="../ja492820/index.html">.Net Core API：さまざまなソースからのリクエストでデータを取得する</a></li>
<li><a href="../ja492822/index.html">CSS開発者-なぜ世界はそれらを必要とするのですか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>