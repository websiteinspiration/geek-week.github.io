<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ñ´Ô∏è üó∫Ô∏è üë©‚Äçüè≠ Why, when and how to use multithreading and multiprocessing in Python üôá üé∏ üëèüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salute, Khabrovsk. Right now, OTUS has opened a set for the Machine Learning course , in connection with this we have translated for you one very inte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Why, when and how to use multithreading and multiprocessing in Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501056/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salute, Khabrovsk. </font><font style="vertical-align: inherit;">Right now, OTUS has opened a set for the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Machine Learning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> course </font><font style="vertical-align: inherit;">, in connection with this we have translated for you one very interesting ‚Äúfairy tale‚Äù. </font><font style="vertical-align: inherit;">Go.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/mi/su/ev/misuevluvampqjc3br79pgtgscg.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Once upon a time, in a distant, distant galaxy ... A </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wise and powerful wizard lived in a small village in the middle of the desert. </font><font style="vertical-align: inherit;">And their name was Dumbledalf. </font><font style="vertical-align: inherit;">He was not only wise and powerful, but also helped people who came from distant lands to ask for help from a wizard. </font><font style="vertical-align: inherit;">Our story began when one traveler brought the wizard a magic scroll. </font><font style="vertical-align: inherit;">The traveler did not know what was in the scroll, he only knew that if anyone could reveal all the secrets of the scroll, then this was Dumbledalf.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 1: Single-Threaded, Single-Process</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have not guessed yet, I drew an analogy with the processor and its functions. </font><font style="vertical-align: inherit;">Our wizard is a processor, and a scroll is a list of links that lead to Python's power and knowledge to master it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thought of the wizard who deciphered the list without any difficulty was to send his faithful friend (Garrigorn? I know, I know that sounds awful) to each of the places that were described in the scroll to find and bring what he could find there.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<font></font>
In [<span class="hljs-number">2</span>]:<font></font>
urls = [<font></font>
  <span class="hljs-string">'http://www.python.org'</span>,
  <span class="hljs-string">'https://docs.python.org/3/'</span>,
  <span class="hljs-string">'https://docs.python.org/3/whatsnew/3.7.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/tutorial/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/library/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/reference/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/using/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/howto/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/installing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/distributing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/extending/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/c-api/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/faq/index.html'</span><font></font>
  ]<font></font>
In [<span class="hljs-number">3</span>]:<font></font>
%%time<font></font>
<font></font>
results = []<font></font>
<span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:
    <span class="hljs-keyword">with</span> urllib.request.urlopen(url) <span class="hljs-keyword">as</span> src:<font></font>
        results.append(src)<font></font>
<font></font>
CPU times: user <span class="hljs-number">135</span> ms, sys: <span class="hljs-number">283</span> ¬µs, total: <span class="hljs-number">135</span> ms<font></font>
Wall time: <span class="hljs-number">12.3</span> s<font></font>
In [ ]:<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, we simply iterate over the URLs one by one using the for loop and read the answer. </font><font style="vertical-align: inherit;">Thanks to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%% time</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the magic of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we can see that it took about 12 seconds with my sad internet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 2: Multithreading</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was not without reason that the wizard was famous for his wisdom; he was quickly able to come up with a much more effective way. Instead of sending one person to each place in order, why not gather a squad of reliable associates and send them to different parts of the world at the same time! The wizard will be able to unite all the knowledge that they bring at once! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's right, instead of viewing the list in a loop in sequence, we can use </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multithreading</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to access multiple URLs at once.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<font></font>
In [<span class="hljs-number">2</span>]:<font></font>
urls = [<font></font>
  <span class="hljs-string">'http://www.python.org'</span>,
  <span class="hljs-string">'https://docs.python.org/3/'</span>,
  <span class="hljs-string">'https://docs.python.org/3/whatsnew/3.7.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/tutorial/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/library/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/reference/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/using/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/howto/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/installing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/distributing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/extending/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/c-api/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/faq/index.html'</span><font></font>
  ]<font></font>
In [<span class="hljs-number">4</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">122</span> ms, sys: <span class="hljs-number">8.27</span> ms, total: <span class="hljs-number">130</span> ms<font></font>
Wall time: <span class="hljs-number">3.83</span> s<font></font>
In [<span class="hljs-number">5</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">122</span> ms, sys: <span class="hljs-number">14.7</span> ms, total: <span class="hljs-number">137</span> ms<font></font>
Wall time: <span class="hljs-number">1.79</span> s<font></font>
In [<span class="hljs-number">6</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">16</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">143</span> ms, sys: <span class="hljs-number">3.88</span> ms, total: <span class="hljs-number">147</span> ms<font></font>
Wall time: <span class="hljs-number">1.32</span> s<font></font>
In [ ]:<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Much better! Almost like ... magic. Using multiple threads can significantly speed up many I / O tasks. In my case, most of the time spent reading URLs is due to network latency. Programs tied to I / O spend most of their lives waiting, you guessed it, for input or output (just like a wizard waits for his friends to go to places from the scroll and return back). This can be input / output from the network, database, file, or from the user. Such I / O usually takes a lot of time, because the source may need to perform preprocessing before transferring the data to the I / O. For example, a processor will count much faster than a network connection will transmit data (at a speed of approximatelylike Flash vs your grandmother).</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can be very useful in tasks such as cleaning web pages.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 3: Multiprocessing</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Years passed, the fame of the good wizard grew, and with it grew the envy of one impartial dark wizard (Sarumort? Or maybe Volandeman?). </font><font style="vertical-align: inherit;">Armed with immeasurable cunning and driven by envy, the dark wizard cast a terrible curse on Dumbledalf. </font><font style="vertical-align: inherit;">When the curse overtook him, Dumbledalf realized that he had only a few moments to ward him off. </font><font style="vertical-align: inherit;">Desperate, he rummaged through his spell books and quickly found one counter-spell that was supposed to work. </font><font style="vertical-align: inherit;">The only problem was that the wizard needed to calculate the sum of all primes less than 1,000,000. A strange spell, of course, but what we have.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The wizard knew that calculating the value would be trivial if he had enough time, but he didn‚Äôt have that luxury. Despite the fact that he is a great wizard, yet he is limited by his humanity and can check for simplicity only one number at a time. If he decided to simply add up the primes one after another, it would take too much time. When there were only seconds left before applying the counterspell, he suddenly remembered the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> spell </font><font style="vertical-align: inherit;">, which he had learned from the magic scroll many years ago. This spell will allow him to copy himself in order to distribute numbers between his copies and check several at the same time. And in the end, all he needs to do is simply add up the numbers that he and his copies will discover.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<font></font>
In [<span class="hljs-number">2</span>]:
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">if_prime</span>(<span class="hljs-params">x</span>):</span>
    <span class="hljs-keyword">if</span> x &lt;= <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">elif</span> x &lt;= <span class="hljs-number">3</span>:
        <span class="hljs-keyword">return</span> x
    <span class="hljs-keyword">elif</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> x % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    i = <span class="hljs-number">5</span>
    <span class="hljs-keyword">while</span> i**<span class="hljs-number">2</span> &lt;= x:
        <span class="hljs-keyword">if</span> x % i == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> x % (i + <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        i += <span class="hljs-number">6</span>
    <span class="hljs-keyword">return</span> x<font></font>
In [<span class="hljs-number">17</span>]:<font></font>
%%time<font></font>
<font></font>
answer = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000000</span>):<font></font>
    answer += if_prime(i)<font></font>
<font></font>
CPU times: user <span class="hljs-number">3.48</span> s, sys: <span class="hljs-number">0</span> ns, total: <span class="hljs-number">3.48</span> s<font></font>
Wall time: <span class="hljs-number">3.48</span> s<font></font>
In [<span class="hljs-number">18</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
CPU times: user <span class="hljs-number">114</span> ms, sys: <span class="hljs-number">4.07</span> ms, total: <span class="hljs-number">118</span> ms<font></font>
Wall time: <span class="hljs-number">1.91</span> s<font></font>
In [<span class="hljs-number">19</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
CPU times: user <span class="hljs-number">99.5</span> ms, sys: <span class="hljs-number">30.5</span> ms, total: <span class="hljs-number">130</span> ms<font></font>
Wall time: <span class="hljs-number">1.12</span> s<font></font>
In [<span class="hljs-number">20</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">729</span> ms ¬± <span class="hljs-number">3.02</span> ms per loop (mean ¬± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">21</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">16</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">512</span> ms ¬± <span class="hljs-number">39.8</span> ms per loop (mean ¬± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">22</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">32</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">518</span> ms ¬± <span class="hljs-number">13.3</span> ms per loop (mean ¬± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">23</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">64</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">621</span> ms ¬± <span class="hljs-number">10.5</span> ms per loop (mean ¬± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [ ]:</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modern processors have more than one core, so we can speed up the tasks using multiprocess processing module </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The tasks associated with the processor are programs that most of the time they work perform calculations on the processor (trivial mathematical calculations, image processing, etc.). </font><font style="vertical-align: inherit;">If the calculations can be performed independently of each other, we have the opportunity to divide them between the available processor cores, thereby obtaining a significant increase in processing speed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All you have to do is:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Determine which function to apply</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare a list of elements to which the function will be applied;</font></font></li>
<li>    <code>multiprocessing.Pool</code>. ,     <code>Pool()</code>,     .   <code>with</code> ,         .</li>
<li>     Pool    <code>map</code>.    map  ,    ,    .</li>
</ol><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : A function can be defined to perform any task that can be performed in parallel. For example, a function may contain code to write the result of a calculation to a file.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
So why do we need to separate</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? If you have ever tried to improve the performance of a task on the processor using multithreading, the result is exactly the opposite. That's just terrible! Let's see how it happened.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just as a wizard is limited by his human nature and can only calculate one number per unit of time, Python comes with a thing called</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Global Interpreter Lock (GIL)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Python is happy to let you spawn as many threads as you want, but</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GIL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ensures that only one of these threads will execute at any given time. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For a task related to I / O, this situation is completely normal. One thread sends a request to one URL and waits for a response, only then this thread can be replaced by another, which will send another request to a different URL. Since the thread does not have to do anything until it receives a response, it makes no difference that at the given time only one thread is running.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For tasks performed on the processor, having multiple threads is almost as useless as nipples in armor. Since only one thread can be executed per unit time, even if you generate several threads, each of which will be allocated a number to check for simplicity, the processor will still work with only one thread. In fact, these numbers will still be checked one by one. And the overhead of working with multiple threads will help reduce performance, which you can just observe when used </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in tasks performed on the processor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get around this ‚Äúrestriction‚Äù, we use the module</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Instead of using threads, multiprocessing uses, as you say it ... several processes. Each process gets its own personal interpreter and memory space, so the GIL will not limit you. In fact, each process will use its own processor core and work with its own unique number, and this will be performed simultaneously with the work of other processes. How sweet of them! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You may notice that the CPU load will be higher when you use </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it compared to a regular for loop or even </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This happens because your program uses not one core, but several. And this is good! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
remember, that</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It has its own overhead of managing multiple processes, which is usually more serious than the cost of multithreading. (Multiprocessing spawns separate interpreters and assigns each memory area to each process, so yes!) That is, as a rule, it is better to use a lightweight version of multithreading when you want to get out in this way (remember about tasks related to I / O). But when the calculation on the processor becomes a bottleneck, the module time comes </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. But remember that with great power comes great responsibility.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you spawn more processes than your processor can process per unit of time, you will notice that performance will begin to decline. </font><font style="vertical-align: inherit;">This happens because the operating system needs to do more work by shuffling processes between the processor cores, because there are more processes. </font><font style="vertical-align: inherit;">In reality, everything can be even more complicated than I told you today, but I conveyed the main idea. </font><font style="vertical-align: inherit;">For example, on my system, performance will drop when the number of processes is 16. This is because there are only 16 logical cores in my processor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 4: Conclusion</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In tasks related to I / O, it </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can improve performance.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In tasks related to I / O, </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it can also increase productivity, but the costs, as a rule, are higher than when using </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The existence of the Python GIL makes it clear to us that at any given time in a program, only one thread can execute.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In tasks related to the processor, use </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can reduce performance.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In processor related tasks, use </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can improve performance.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wizards are awesome!</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is where we will end our introduction to </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in Python </font><font style="vertical-align: inherit;">today </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Now go and win!</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Modeling COVID-19 using graph analysis and parsing open data." </font><font style="vertical-align: inherit;">Free lesson.</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501044/index.html">Do not hold people for idiots or why a person with an engineering background can burn a cell tower (video)</a></li>
<li><a href="../en501046/index.html">Around solid advantages: top 10 reports of the conference C ++ Russia 2019 Piter</a></li>
<li><a href="../en501048/index.html">Organization of remote work SMB organization on OpenVPN</a></li>
<li><a href="../en501050/index.html">Install and activate LabVIEW Community Edition</a></li>
<li><a href="../en501052/index.html">The Return of the Chinese Spaceship</a></li>
<li><a href="../en501058/index.html">Teamcenter Rapid Start Solution Helps Industrial Equipment Manufacturers Cut Design Time By 25%</a></li>
<li><a href="../en501060/index.html">JetBrains .NET Days Online, May 13-14</a></li>
<li><a href="../en501062/index.html">All reports of the free online part of PHP Russia with foreign speakers can be viewed in translation</a></li>
<li><a href="../en501064/index.html">To the flight of the Chinese experimental ship. Infographics and collages.</a></li>
<li><a href="../en501068/index.html">Deepfakes and deep media: A new battleground for security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>