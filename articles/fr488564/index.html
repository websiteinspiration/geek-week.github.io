<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëø üë®üèæ‚Äçüç≥ üßëüèº Votre premier r√©seau neuronal sur une unit√© de traitement graphique (GPU). Guide du d√©butant üê≤ ü§∑üèø üëßüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je vais vous expliquer comment configurer un environnement d'apprentissage automatique en 30 minutes, cr√©er un r√©seau neuronal pour ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Votre premier r√©seau neuronal sur une unit√© de traitement graphique (GPU). Guide du d√©butant</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488564/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wg/sv/g2/wgsvg24lytktztdczee_4rteb28.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je vais vous expliquer comment configurer un environnement d'apprentissage automatique en 30 minutes, cr√©er un r√©seau neuronal pour la reconnaissance d'images, puis ex√©cuter le m√™me r√©seau sur un processeur graphique (GPU). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©finissons d'abord ce qu'est un r√©seau neuronal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, il s'agit d'un mod√®le math√©matique, ainsi que de sa mise en ≈ìuvre logicielle ou mat√©rielle, construit sur le principe d'organisation et de fonctionnement des r√©seaux neuronaux biologiques - r√©seaux de cellules nerveuses d'un organisme vivant. Ce concept est apparu dans l'√©tude des processus se produisant dans le cerveau et dans une tentative de simuler ces processus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les r√©seaux de neurones ne sont pas programm√©s au sens habituel du terme, ils sont form√©s. </font><font style="vertical-align: inherit;">La capacit√© d'apprentissage est l'un des principaux avantages des r√©seaux de neurones par rapport aux algorithmes traditionnels. </font><font style="vertical-align: inherit;">Techniquement, l'entra√Ænement consiste √† trouver les coefficients de connexions entre les neurones. </font><font style="vertical-align: inherit;">Dans le processus d'apprentissage, le r√©seau neuronal est capable d'identifier des relations complexes entre l'entr√©e et la sortie, ainsi que d'effectuer une g√©n√©ralisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue de l'apprentissage automatique, un r√©seau neuronal est un cas particulier des m√©thodes de reconnaissance de formes, d'analyse discriminante, de m√©thodes de clustering et d'autres m√©thodes.</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âquipement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commen√ßons d'abord par l'√©quipement. Nous avons besoin d'un serveur sur lequel le syst√®me d'exploitation Linux est install√©. Les √©quipements pour le fonctionnement des syst√®mes d'apprentissage automatique n√©cessitent un appareil suffisamment puissant et, par cons√©quent, co√ªteux. Pour ceux qui n'ont pas une bonne voiture √† port√©e de main, je recommande de pr√™ter attention √† l'offre des fournisseurs de cloud. Le serveur n√©cessaire peut √™tre lou√© rapidement et ne payer que pour le temps d'utilisation.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les projets o√π il est n√©cessaire de cr√©er des r√©seaux de neurones, j'utilise les serveurs d'un des fournisseurs de cloud russes. </font><font style="vertical-align: inherit;">La soci√©t√© propose des serveurs cloud de location sp√©cifiquement pour l'apprentissage automatique avec les puissantes unit√©s de traitement graphique (GPU) Tesla V100 de NVIDIA. </font><font style="vertical-align: inherit;">En bref: l'utilisation d'un serveur avec un GPU peut √™tre des dizaines de fois plus efficace (rapide) par rapport √† un serveur de m√™me co√ªt, o√π un CPU (un processeur central bien connu) est utilis√© pour les calculs. </font><font style="vertical-align: inherit;">Cela est d√ª aux sp√©cificit√©s de l'architecture GPU, qui g√®re les calculs plus rapidement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour effectuer les exemples d√©crits ci-dessous, nous avons achet√© le serveur suivant pendant plusieurs jours:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSD 150 Go</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM 32 Go</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processeur Tesla V100 16 Go avec 4 c≈ìurs</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu 18.04 a √©t√© install√© sur la machine.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finissez l'environnement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, installez sur le serveur tout ce dont vous avez besoin pour travailler. </font><font style="vertical-align: inherit;">√âtant donn√© que notre article s'adresse principalement aux d√©butants, j'y parlerai de quelques points qui leur seront utiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de travail lors de la configuration de l'environnement se fait via la ligne de commande. </font><font style="vertical-align: inherit;">La plupart des utilisateurs utilisent Windows comme syst√®me d'exploitation fonctionnel. </font><font style="vertical-align: inherit;">La console standard de cet OS laisse beaucoup √† d√©sirer. </font><font style="vertical-align: inherit;">Par cons√©quent, nous utiliserons l'outil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Cmder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pratique </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">T√©l√©chargez la version mini et ex√©cutez Cmder.exe. </font><font style="vertical-align: inherit;">Ensuite, vous devez vous connecter au serveur via SSH:</font></font><br>
<br>
<pre><code class="bash hljs">ssh root@server-ip-or-hostname</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de server-ip-or-hostname, sp√©cifiez l'adresse IP ou le nom DNS de votre serveur. </font><font style="vertical-align: inherit;">Ensuite, entrez le mot de passe et apr√®s une connexion r√©ussie, nous devrions obtenir quelque chose comme √ßa.</font></font><br>
<br>
<pre><code class="bash hljs">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-74-generic x86_64)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le langage principal pour d√©velopper des mod√®les ML est Python. </font><font style="vertical-align: inherit;">Et la plate-forme la plus populaire pour l'utiliser sur Linux est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anaconda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez-le sur notre serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commen√ßons par mettre √† jour le gestionnaire de paquets local:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez curl (utilitaire de ligne de commande):</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install curl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√©l√©chargez la derni√®re version d'Anaconda Distribution:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /tmp<font></font>
curl ‚ÄìO https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commen√ßons l'installation:</font></font><br>
<br>
<pre><code class="bash hljs">bash Anaconda3-2019.10-Linux-x86_64.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant le processus d'installation, vous devrez confirmer l'accord de licence. </font><font style="vertical-align: inherit;">En cas d'installation r√©ussie, vous devriez voir ceci:</font></font><br>
<br>
<pre><code class="bash hljs">Thank you <span class="hljs-keyword">for</span> installing Anaconda3!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour d√©velopper des mod√®les ML, de nombreux frameworks sont maintenant cr√©√©s, nous travaillons avec les plus populaires: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyTorch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tensorflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation du framework vous permet d'augmenter la vitesse de d√©veloppement et d'utiliser des outils pr√™ts √† l'emploi pour les t√¢ches standard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, nous travaillerons avec PyTorch. </font><font style="vertical-align: inherit;">Installez-le:</font></font><br>
<br>
<pre><code class="bash hljs">conda install pytorch torchvision cudatoolkit=10.1 -c pytorch</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons maintenant lancer Jupyter Notebook - un outil de d√©veloppement populaire parmi les sp√©cialistes ML. </font><font style="vertical-align: inherit;">Il vous permet d'√©crire du code et de voir imm√©diatement les r√©sultats de son ex√©cution. </font><font style="vertical-align: inherit;">Jupyter Notebook fait partie d'Anaconda et est d√©j√† install√© sur notre serveur. </font><font style="vertical-align: inherit;">Vous devez vous y connecter depuis notre syst√®me de bureau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, nous ex√©cutons d'abord Jupyter sur le serveur en sp√©cifiant le port 8080:</font></font><br>
<br>
<pre><code class="bash hljs">jupyter notebook --no-browser --port=8080 --allow-root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, en ouvrant un autre onglet dans notre console Cmder (le menu sup√©rieur est la bo√Æte de dialogue Nouvelle console), connectez-vous sur le port 8080 au serveur via SSH:</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh -L 8080:localhost:8080 root@server-ip-or-hostname</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous entrez la premi√®re commande, des liens nous seront propos√©s pour ouvrir Jupyter dans notre navigateur:</font></font><br>
<br>
<pre><code class="bash hljs">To access the notebook, open this file <span class="hljs-keyword">in</span> a browser:<font></font>
        file:///root/.<span class="hljs-built_in">local</span>/share/jupyter/runtime/nbserver-18788-open.html<font></font>
    Or copy and paste one of these URLs:<font></font>
        http://localhost:8080/?token=cca0bd0b30857821194b9018a5394a4ed2322236f116d311<font></font>
     or http://127.0.0.1:8080/?token=cca0bd0b30857821194b9018a5394a4ed2322236f116d311<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez le lien pour localhost: 8080. </font><font style="vertical-align: inherit;">Copiez le chemin complet et collez-le dans la barre d'adresse du navigateur local de votre PC. </font><font style="vertical-align: inherit;">Le bloc-notes Jupyter s'ouvre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ons un nouvel ordinateur portable: Nouveau - Notebook - Python 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√©rifiez le bon fonctionnement de tous les composants que nous avons install√©s. </font><font style="vertical-align: inherit;">Nous introduisons un exemple de code PyTorch dans Jupyter et commen√ßons l'ex√©cution (bouton Ex√©cuter):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">import</span> torch<font></font>
x = torch.rand(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<font></font>
print(x)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le r√©sultat devrait √™tre quelque chose comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/o8/su/pso8sugii4txi_beqrbx13nsry8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
si vous avez un r√©sultat similaire, alors nous nous sommes tous install√©s correctement et pouvons commencer √† d√©velopper un r√©seau de neurones!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©er un r√©seau de neurones</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons cr√©er un r√©seau neuronal pour la reconnaissance d'images. </font><font style="vertical-align: inherit;">Nous prenons ce </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guide comme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> base </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour former le r√©seau, nous utiliserons l'ensemble de donn√©es CIFAR10 accessible au public. </font><font style="vertical-align: inherit;">Il a des cours: "avion", "voiture", "oiseau", "chat", "cerf", "chien", "grenouille", "cheval", "bateau", "camion". </font><font style="vertical-align: inherit;">Les images dans CIFAR10 ont une taille de 3x32x32, c'est-√†-dire des images couleur √† 3 canaux de 32x32 pixels.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wg/sv/g2/wgsvg24lytktztdczee_4rteb28.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le travail, nous utiliserons le package PyTorch cr√©√© pour travailler avec des images - torchvision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prendrons les mesures suivantes dans l'ordre:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©chargez et normalisez les ensembles de donn√©es de formation et de test</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finition du r√©seau neuronal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formation r√©seau sur les donn√©es de formation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test du r√©seau avec des donn√©es de test</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©p√©ter la formation et les tests GPU</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout le code ci-dessous sera ex√©cut√© dans le bloc-notes Jupyter.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©chargez et normalisez CIFAR10</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copiez et ex√©cutez le code suivant dans Jupyter:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torchvision
<span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<font></font>
<font></font>
transform = transforms.Compose(<font></font>
    [transforms.ToTensor(),<font></font>
     transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<font></font>
<font></font>
trainset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">'./data'</span>, train=<span class="hljs-literal">True</span>,<font></font>
                                        download=<span class="hljs-literal">True</span>, transform=transform)<font></font>
trainloader = torch.utils.data.DataLoader(trainset, batch_size=<span class="hljs-number">4</span>,<font></font>
                                          shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">2</span>)<font></font>
<font></font>
testset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">'./data'</span>, train=<span class="hljs-literal">False</span>,<font></font>
                                       download=<span class="hljs-literal">True</span>, transform=transform)<font></font>
testloader = torch.utils.data.DataLoader(testset, batch_size=<span class="hljs-number">4</span>,<font></font>
                                         shuffle=<span class="hljs-literal">False</span>, num_workers=<span class="hljs-number">2</span>)<font></font>
<font></font>
classes = (<span class="hljs-string">'plane'</span>, <span class="hljs-string">'car'</span>, <span class="hljs-string">'bird'</span>, <span class="hljs-string">'cat'</span>,
           <span class="hljs-string">'deer'</span>, <span class="hljs-string">'dog'</span>, <span class="hljs-string">'frog'</span>, <span class="hljs-string">'horse'</span>, <span class="hljs-string">'ship'</span>, <span class="hljs-string">'truck'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La r√©ponse devrait √™tre comme ceci:</font></font><br>
<br>
<pre><code class="python hljs">Downloading https://www.cs.toronto.edu/~kriz/cifar<span class="hljs-number">-10</span>-python.tar.gz to ./data/cifar<span class="hljs-number">-10</span>-python.tar.gz<font></font>
Extracting ./data/cifar<span class="hljs-number">-10</span>-python.tar.gz to ./data<font></font>
Files already downloaded <span class="hljs-keyword">and</span> verified</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons d√©river plusieurs images de formation pour v√©rifier:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
<span class="hljs-comment"># functions to show an image</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">imshow</span>(<span class="hljs-params">img</span>):</span>
    img = img / <span class="hljs-number">2</span> + <span class="hljs-number">0.5</span>     <span class="hljs-comment"># unnormalize</span><font></font>
    npimg = img.numpy()<font></font>
    plt.imshow(np.transpose(npimg, (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)))<font></font>
    plt.show()<font></font>
<font></font>
<span class="hljs-comment"># get some random training images</span><font></font>
dataiter = iter(trainloader)<font></font>
images, labels = dataiter.next()<font></font>
<font></font>
<span class="hljs-comment"># show images</span><font></font>
imshow(torchvision.utils.make_grid(images))<font></font>
<span class="hljs-comment"># print labels</span>
print(<span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[labels[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))
</code></pre><br>
<img src="https://habrastorage.org/webt/yy/w4/xw/yyw4xwjhaa6kfy41fvnylvz6qdy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finition du r√©seau neuronal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons d'abord le fonctionnement d'un r√©seau de neurones pour la reconnaissance d'images. </font><font style="vertical-align: inherit;">Il s'agit d'un simple r√©seau de connexion directe. </font><font style="vertical-align: inherit;">Il prend une entr√©e, la passe √† travers plusieurs couches une par une, puis donne finalement la sortie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t8/4m/yg/t84mygi1sjuzssoezguistupmeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ons un r√©seau similaire dans notre environnement:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span>(<span class="hljs-params">nn.Module</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super(Net, self).__init__()<font></font>
        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>)<font></font>
        self.pool = nn.MaxPool2d(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<font></font>
        self.conv2 = nn.Conv2d(<span class="hljs-number">6</span>, <span class="hljs-number">16</span>, <span class="hljs-number">5</span>)<font></font>
        self.fc1 = nn.Linear(<span class="hljs-number">16</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>, <span class="hljs-number">120</span>)<font></font>
        self.fc2 = nn.Linear(<span class="hljs-number">120</span>, <span class="hljs-number">84</span>)<font></font>
        self.fc3 = nn.Linear(<span class="hljs-number">84</span>, <span class="hljs-number">10</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span><font></font>
        x = self.pool(F.relu(self.conv1(x)))<font></font>
        x = self.pool(F.relu(self.conv2(x)))<font></font>
        x = x.view(<span class="hljs-number">-1</span>, <span class="hljs-number">16</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>)<font></font>
        x = F.relu(self.fc1(x))<font></font>
        x = F.relu(self.fc2(x))<font></font>
        x = self.fc3(x)<font></font>
        <span class="hljs-keyword">return</span> x<font></font>
<font></font>
net = Net()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous d√©finissons √©galement la fonction de perte et l'optimiseur </font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<font></font>
<font></font>
criterion = nn.CrossEntropyLoss()<font></font>
optimizer = optim.SGD(net.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formation r√©seau sur les donn√©es de formation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commen√ßons √† former notre r√©seau neuronal. </font><font style="vertical-align: inherit;">J'attire votre attention sur le fait qu'apr√®s cela, pendant que vous ex√©cutez ce code, vous devrez attendre un certain temps jusqu'√† ce que le travail soit termin√©. </font><font style="vertical-align: inherit;">Cela m'a pris 5 minutes. </font><font style="vertical-align: inherit;">Le r√©seautage prend du temps.</font></font><br>
<br>
<pre><code class="python hljs"> <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):  <span class="hljs-comment"># loop over the dataset multiple times</span><font></font>
<font></font>
    running_loss = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> enumerate(trainloader, <span class="hljs-number">0</span>):
        <span class="hljs-comment"># get the inputs; data is a list of [inputs, labels]</span><font></font>
        inputs, labels = data<font></font>
<font></font>
        <span class="hljs-comment"># zero the parameter gradients</span><font></font>
        optimizer.zero_grad()<font></font>
<font></font>
        <span class="hljs-comment"># forward + backward + optimize</span><font></font>
        outputs = net(inputs)<font></font>
        loss = criterion(outputs, labels)<font></font>
        loss.backward()<font></font>
        optimizer.step()<font></font>
<font></font>
        <span class="hljs-comment"># print statistics</span><font></font>
        running_loss += loss.item()<font></font>
        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2000</span> == <span class="hljs-number">1999</span>:    <span class="hljs-comment"># print every 2000 mini-batches</span>
            print(<span class="hljs-string">'[%d, %5d] loss: %.3f'</span> %<font></font>
                  (epoch + <span class="hljs-number">1</span>, i + <span class="hljs-number">1</span>, running_loss / <span class="hljs-number">2000</span>))<font></font>
            running_loss = <span class="hljs-number">0.0</span><font></font>
<font></font>
print(<span class="hljs-string">'Finished Training'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous obtenons le r√©sultat suivant: Nous </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/05/k2/sw05k2ewk-gu9fiyrv3xncxjaki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sauvegardons notre mod√®le form√©:</font></font><br>
<br>
<pre><code class="python hljs">PATH = <span class="hljs-string">'./cifar_net.pth'</span>
torch.save(net.state_dict(), PATH)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test du r√©seau avec des donn√©es de test</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons form√© le r√©seau √† l'aide d'un ensemble de donn√©es de formation. </font><font style="vertical-align: inherit;">Mais nous devons v√©rifier si le r√©seau a appris quoi que ce soit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons v√©rifier cela en pr√©disant l'√©tiquette de classe que le r√©seau neuronal produit et en v√©rifiant la v√©rit√©. </font><font style="vertical-align: inherit;">Si la pr√©vision est correcte, nous ajoutons l'√©chantillon √† la liste des pr√©visions correctes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Montrons l'image de la suite de tests:</font></font><br>
<br>
<pre><code class="python hljs">dataiter = iter(testloader)<font></font>
images, labels = dataiter.next()<font></font>
<font></font>
<span class="hljs-comment"># print images</span><font></font>
imshow(torchvision.utils.make_grid(images))<font></font>
print(<span class="hljs-string">'GroundTruth: '</span>, <span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[labels[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))</code></pre><br>
<img src="https://habrastorage.org/webt/hp/ph/zm/hpphzma6rus04gw-edxsowf1ifu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, demandez au r√©seau neuronal de nous dire ce qu'il y a dans ces images:</font></font><br>
<br>
<pre><code class="python hljs"><font></font>
net = Net()<font></font>
net.load_state_dict(torch.load(PATH))<font></font>
<font></font>
outputs = net(images)<font></font>
<font></font>
_, predicted = torch.max(outputs, <span class="hljs-number">1</span>)<font></font>
<font></font>
print(<span class="hljs-string">'Predicted: '</span>, <span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[predicted[j]]
                              <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))
</code></pre><br>
<img src="https://habrastorage.org/webt/j2/vp/uc/j2vpucdaps0fuci2yg38ip2fbdo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les r√©sultats semblent plut√¥t bons: le r√©seau a correctement identifi√© trois des quatre images. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment fonctionne le r√©seau dans l'ensemble des donn√©es.</font></font><br>
<br>
<pre><code class="python hljs">
correct = <span class="hljs-number">0</span>
total = <span class="hljs-number">0</span>
<span class="hljs-keyword">with</span> torch.no_grad():
    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> testloader:<font></font>
        images, labels = data<font></font>
        outputs = net(images)<font></font>
        _, predicted = torch.max(outputs.data, <span class="hljs-number">1</span>)<font></font>
        total += labels.size(<span class="hljs-number">0</span>)<font></font>
        correct += (predicted == labels).sum().item()<font></font>
<font></font>
print(<span class="hljs-string">'Accuracy of the network on the 10000 test images: %d %%'</span> % (
    <span class="hljs-number">100</span> * correct / total))</code></pre><br>
<img src="https://habrastorage.org/webt/fy/i4/cn/fyi4cnkjgimshkhhbsva4udixhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que le r√©seau connaisse et fonctionne. </font><font style="vertical-align: inherit;">S'il d√©finissait des classes au hasard, la pr√©cision serait de 10%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons maintenant quelles classes le r√©seau d√©finit mieux:</font></font><br>
<br>
<pre><code class="python hljs">class_correct = list(<span class="hljs-number">0.</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>))<font></font>
class_total = list(<span class="hljs-number">0.</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>))
<span class="hljs-keyword">with</span> torch.no_grad():
    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> testloader:<font></font>
        images, labels = data<font></font>
        outputs = net(images)<font></font>
        _, predicted = torch.max(outputs, <span class="hljs-number">1</span>)<font></font>
        c = (predicted == labels).squeeze()<font></font>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>):<font></font>
            label = labels[i]<font></font>
            class_correct[label] += c[i].item()<font></font>
            class_total[label] += <span class="hljs-number">1</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):<font></font>
    print(<span class="hljs-string">'Accuracy of %5s : %2d %%'</span> % (<font></font>
        classes[i], <span class="hljs-number">100</span> * class_correct[i] / class_total[i]))</code></pre><br>
<img src="https://habrastorage.org/webt/l9/s9/qu/l9s9quxd-lzx2kh7wphxe9-2qzs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que le r√©seau d√©termine le mieux les voitures et les navires: pr√©cision de 71%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, le r√©seau fonctionne. </font><font style="vertical-align: inherit;">Essayons maintenant de transf√©rer son travail sur le processeur graphique (GPU) et de voir quels changements.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formation au r√©seau neuronal GPU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, je vais expliquer bri√®vement ce qu'est CUDA. </font><font style="vertical-align: inherit;">CUDA (Compute Unified Device Architecture) est une plate-forme informatique parall√®le d√©velopp√©e par NVIDIA pour le calcul g√©n√©ral sur GPU. </font><font style="vertical-align: inherit;">Avec CUDA, les d√©veloppeurs peuvent acc√©l√©rer consid√©rablement les applications informatiques en utilisant les capacit√©s des GPU. </font><font style="vertical-align: inherit;">Sur notre serveur que nous avons achet√©, cette plateforme est d√©j√† install√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©finissons d'abord notre GPU comme le premier appareil cuda visible.</font></font><br>
<br>
<pre><code class="python hljs">device = torch . device ( <span class="hljs-string">"cuda:0"</span> <span class="hljs-keyword">if</span> torch . cuda . is_available () <span class="hljs-keyword">else</span> <span class="hljs-string">"cpu"</span> )
<span class="hljs-comment"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span>
<span class="hljs-keyword">print</span> ( device )</code></pre><br>
<img src="https://habrastorage.org/webt/n2/2k/bf/n22kbfvilr6kn30eel6dfhaose4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Envoyez le r√©seau au GPU:</font></font><br>
 <br>
<pre><code class="python hljs">net.to(device)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devrons √©galement envoyer des entr√©es et des objectifs √† chaque √©tape et au GPU:</font></font><br>
<br>
<pre><code class="python hljs">inputs, labels = data[<span class="hljs-number">0</span>].to(device), data[<span class="hljs-number">1</span>].to(device)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ex√©cutez le recyclage du r√©seau d√©j√† sur le GPU: </font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<font></font>
<font></font>
criterion = nn.CrossEntropyLoss()<font></font>
optimizer = optim.SGD(net.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)
<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):  <span class="hljs-comment"># loop over the dataset multiple times</span><font></font>
<font></font>
    running_loss = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> enumerate(trainloader, <span class="hljs-number">0</span>):
        <span class="hljs-comment"># get the inputs; data is a list of [inputs, labels]</span>
    inputs, labels = data[<span class="hljs-number">0</span>].to(device), data[<span class="hljs-number">1</span>].to(device)<font></font>
<font></font>
        <span class="hljs-comment"># zero the parameter gradients</span><font></font>
        optimizer.zero_grad()<font></font>
<font></font>
        <span class="hljs-comment"># forward + backward + optimize</span><font></font>
        outputs = net(inputs)<font></font>
        loss = criterion(outputs, labels)<font></font>
        loss.backward()<font></font>
        optimizer.step()<font></font>
<font></font>
        <span class="hljs-comment"># print statistics</span><font></font>
        running_loss += loss.item()<font></font>
        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2000</span> == <span class="hljs-number">1999</span>:    <span class="hljs-comment"># print every 2000 mini-batches</span>
            print(<span class="hljs-string">'[%d, %5d] loss: %.3f'</span> %<font></font>
                  (epoch + <span class="hljs-number">1</span>, i + <span class="hljs-number">1</span>, running_loss / <span class="hljs-number">2000</span>))<font></font>
            running_loss = <span class="hljs-number">0.0</span><font></font>
<font></font>
print(<span class="hljs-string">'Finished Training'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette fois, la formation r√©seau a dur√© environ 3 minutes. </font><font style="vertical-align: inherit;">Rappelons que la m√™me √©tape sur un processeur r√©gulier a dur√© 5 minutes. </font><font style="vertical-align: inherit;">La diff√©rence n'est pas significative, c'est parce que notre r√©seau n'est pas si grand. </font><font style="vertical-align: inherit;">Lorsque vous utilisez de grandes baies pour la formation, la diff√©rence entre la vitesse du GPU et le processeur traditionnel augmentera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semble √™tre tout. </font><font style="vertical-align: inherit;">Ce que nous avons r√©ussi √† faire:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons examin√© ce qu'est le GPU et choisi le serveur sur lequel il est install√©;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons mis en place un environnement logiciel pour cr√©er un r√©seau neuronal;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons cr√©√© un r√©seau de neurones pour la reconnaissance d'images et l'avons form√©;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons r√©p√©t√© la formation du r√©seau √† l'aide du GPU et avons re√ßu une augmentation de vitesse.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je me ferai un plaisir de r√©pondre aux questions dans les commentaires.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488548/index.html">Exp√©rience: comment apprendre √† cr√©er des textes populaires en anglais (et pourquoi les Habristes anglophones lisent si peu)</a></li>
<li><a href="../fr488550/index.html">Qui veut faire des coop√©ratives des g√©ants de l'informatique</a></li>
<li><a href="../fr488552/index.html">D√©veloppeurs Apple FAS et contr√¥le parental</a></li>
<li><a href="../fr488558/index.html">Assurer une haute disponibilit√© des applications avec Kafka Streams</a></li>
<li><a href="../fr488560/index.html">H√©bergement gratuit de bots Telegram sur Google Cloud Platform</a></li>
<li><a href="../fr488566/index.html">Comment un ing√©nieur QA a sauv√© une journ√©e enti√®re en liant les tests automatiques dans Visual Studio et Test IT</a></li>
<li><a href="../fr488568/index.html">Les r√©seaux de neurones r√™vent-ils d'argent √©lectrique?</a></li>
<li><a href="../fr488570/index.html">Comment les services secrets am√©ricains ont confondu le RPG cyberpunk avec un manuel pour les pirates</a></li>
<li><a href="../fr488572/index.html">Les analyseurs Unity sont d√©sormais open-source</a></li>
<li><a href="../fr488574/index.html">Les √©l√®ves √©crivent le pilote Uart pour STM32F411</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>