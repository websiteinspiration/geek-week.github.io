<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👧 🧑🏾‍🤝‍🧑🏼 🛅 Wir sind Freunde STM32 mit LCD-Anzeige 1604 am I2C-Bus (HAL-Bibliothek) 🕰️ 🍬 🖖🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 
 
 In diesem Artikel möchte ich über meine Erfahrungen beim Anschließen von LCD-Displays an den STM32-Mikrocontroller mithilfe der HAL-Bi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wir sind Freunde STM32 mit LCD-Anzeige 1604 am I2C-Bus (HAL-Bibliothek)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501006/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel möchte ich über meine Erfahrungen beim Anschließen von LCD-Displays an den STM32-Mikrocontroller mithilfe der HAL-Bibliothek am I2C-Bus sprechen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/tq/li/yjtqliuuokrq220g_4kyg5lty3y.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde das Display 1602 und 2004 anschließen. Beide haben einen gelöteten I2C-Adapter, der auf dem PCF8574T-Chip basiert. </font><font style="vertical-align: inherit;">Das Debug-Board ist </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nucleo767ZI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und die Entwicklungsumgebung ist </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STM32CubeIDE 1.3.0.</font></font></b><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde nicht im Detail über das Funktionsprinzip des I2C-Busses sprechen, ich rate Ihnen, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nachzuschauen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erstellen das Projekt, wählen die Debug- </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ka/dg/gq/kadggqufgj38rtpnuhafups7usg.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karte aus </font><font style="vertical-align: inherit;">: Wir </font><font style="vertical-align: inherit;">geben an, dass wir I2C1 verwenden werden. Ich werde auch UART5 verbinden, um mit der Karte zu kommunizieren. Dies ist erforderlich, um Informationen von der Karte über die Anzeigeadresse zu erhalten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/h2/o5/cvh2o5rcohuwwpqecrcedg4m62a.jpeg" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/cp/iz/dt/cpizdtxz2sosftjpdrvgycthcz8.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im selben Fenster sehen Sie die Nummern der Beine, an die das Display angeschlossen ist. In meinem Fall stellte sich </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/jg/yd/gjjgydsz_j5o4czfol2wgsqfayy.jpeg" alt="Bild"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Folgendes </font><font style="vertical-align: inherit;">heraus: </font><font style="vertical-align: inherit;">Um zu beginnen, schließen Sie nur ein Display an. Ich beginne mit 1602. Außerdem schließe ich den USB-UART CH340-Adapter an, der erfahrenen Arduin-Treibern bekannt ist, um Daten von der Karte zu empfangen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pl/ka/tq/plkatqffrxr3txh7d3gar6m9wka.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitte beachten Sie, dass der Adapter RX mit TX und TX mit RX verbindet. Der Jumper am Adapter beträgt 3,3 V.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n_/u-/jl/n_u-jlv9qayzjrgmqg9yoqlz7mi.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns die Arbeit mit dem PCF8574T-Chip und -Display genauer an. </font><font style="vertical-align: inherit;">Unten sehen Sie eine schematische Darstellung eines Moduls mit Anzeige: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/-p/5e/-v-p5ehplnmtvvbvncmbaqqo1ru.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der PCF8574T-Chip ähnelt in seiner Funktionalität dem Schieberegister 74hc595 - er empfängt Bytes über die I2C-Schnittstelle und weist seinen Ausgängen die Werte des entsprechenden Bits zu (P0-P7). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überlegen Sie, welche Stifte der Mikroschaltung mit dem Display verbunden sind und wofür sie verantwortlich sind:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Anschluss P0 der Mikroschaltung ist mit dem RS-Anschluss des Displays verbunden, der für den Empfang der Anzeigedaten (1) oder der Anzeigebetriebsanweisungen (0) verantwortlich ist;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pin P1 ist mit R \ W verbunden, wenn 1 - Daten in die Anzeige schreiben, 0 - lesen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klemme P2 ist mit CS verbunden - der Klemme, deren Zustandsänderung gelesen wird;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlussfolgerung P3 - Hintergrundbeleuchtung;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlussfolgerungen P4 - P7 werden verwendet, um Daten an das Display zu übertragen. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es können mehrere Geräte gleichzeitig an einen I2C-Bus angeschlossen werden. Um auf ein bestimmtes Gerät zugreifen zu können, hat jedes von ihnen eine eigene Adresse. Zuerst werden wir es herausfinden. Wenn die Kontakte A1, A2 und A3 auf der Adapterplatine nicht versiegelt sind, lautet die Adresse höchstwahrscheinlich 0x27, es ist jedoch besser, dies zu überprüfen. Dazu schreiben wir eine kleine Funktion, die die Adressen aller Geräte anzeigt, die an den I2C-Bus angeschlossen sind:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">I2C_Scan</span> <span class="hljs-params">()</span>
</span>{
	<span class="hljs-comment">//  ,  </span><font></font>
        HAL_StatusTypeDef res;                          <font></font>
	<span class="hljs-comment">//    </span>
        <span class="hljs-keyword">char</span> info[] = <span class="hljs-string">"Scanning I2C bus...\r\n"</span>;      
        <span class="hljs-comment">//    UART	</span>
        HAL_UART_Transmit(&amp;huart5, (<span class="hljs-keyword">uint8_t</span>*)info, <span class="hljs-built_in">strlen</span>(info), HAL_MAX_DELAY);  
	<span class="hljs-comment">/* &amp;huart5 -   UART
	 * (uint8_t*)info -     
	 * strlen(info) -   
	 * HAL_MAX_DELAY - 
	 */</span>
        <span class="hljs-comment">//    </span>
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">uint16_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">128</span>; i++)              <font></font>
	{<font></font>
            <span class="hljs-comment">// ,      i  </span>
            res = HAL_I2C_IsDeviceReady(&amp;hi2c1, i &lt;&lt; <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, HAL_MAX_DELAY);                   
	    <span class="hljs-comment">//  , </span>
            <span class="hljs-keyword">if</span>(res == HAL_OK)                              <font></font>
	    {<font></font>
	    	<span class="hljs-keyword">char</span> msg[<span class="hljs-number">64</span>];
	    	<span class="hljs-comment">//   i,   ,     </span>
                <span class="hljs-comment">// 16 :</span>
	    	<span class="hljs-built_in">snprintf</span>(msg, <span class="hljs-keyword">sizeof</span>(msg), <span class="hljs-string">"0x%02X"</span>, i);
	    	<span class="hljs-comment">//    </span>
	    	HAL_UART_Transmit(&amp;huart5, (<span class="hljs-keyword">uint8_t</span>*)msg, <span class="hljs-built_in">strlen</span>(msg), HAL_MAX_DELAY);
	    	<span class="hljs-comment">//    </span>
	    	HAL_UART_Transmit(&amp;huart5, (<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">"\r\n"</span>, <span class="hljs-number">2</span>, HAL_MAX_DELAY);<font></font>
	    }<font></font>
	    <span class="hljs-keyword">else</span> HAL_UART_Transmit(&amp;huart5, (<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">"."</span>, <span class="hljs-number">1</span>, HAL_MAX_DELAY);<font></font>
	}<font></font>
	HAL_UART_Transmit(&amp;huart5, (<span class="hljs-keyword">uint8_t</span>*)<span class="hljs-string">"\r\n"</span>, <span class="hljs-number">2</span>, HAL_MAX_DELAY);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Funktion fragt alle Adressen von 0 bis 127 ab. Wenn eine Antwort von dieser Adresse empfangen wird, sendet sie die Adressnummer in hexadezimaler Form an UART. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um mit dem Board zu kommunizieren, verwende ich das Termite-Programm. Standardmäßig ist die UART-Geschwindigkeit des Mikrocontrollers auf 115200 eingestellt, Sie müssen dies auch für Termiten einstellen. Wir rufen die Funktion im Hauptteil des Programms auf, flashen die Karte und verbinden Termiten mit unserem Mikrocontroller: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/3d/uj/0f3dujga-iwbhudpe7kauth_ivi.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Punkte zeigen alle Adressen an, von denen die Antwort nicht empfangen wurde. Die Adresse auf meinem Display ist 0x26, da ich den Jumper A0 gelötet habe. Schließen Sie nun die zweite Anzeige parallel zur ersten an und sehen Sie, was das Programm geben wird:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f4/dz/hm/f4dzhm0py_f9kbvecthsshrpemi.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben zwei Adressen: 0x26 (Anzeige 1602) und 0x27 (Anzeige 2004). Nun erfahren Sie, wie Sie mit dem Display arbeiten. Der Mikrocontroller sendet ein Adressbyte, und alle an den Bus angeschlossenen Geräte überprüfen es mit ihrem eigenen. Wenn es übereinstimmt, beginnt das Modul mit der Kommunikation mit dem Mikrocontroller. Zunächst müssen Sie die Anzeige konfigurieren: Woher kommt die Anzahl der Zeichen und in welche Richtung, wie verhält sich der Cursor usw. Danach ist es bereits möglich, Informationen zur Anzeige an die Anzeige zu übertragen. Die Besonderheit ist, dass wir nur 4 Bits verwenden können, um Informationen zu übertragen, d.h. Daten müssen in zwei Teile geteilt werden. Die Daten werden in den High-Bits (4-7) gespeichert, und die Low-Bits werden verwendet, um anzuzeigen, ob die Hintergrundbeleuchtung eingeschaltet wird (3 Bits), ob Daten zur Ausgabe kommen oder Anzeigeeinstellungen (RS-Ausgang, 0 Bits) und 2 Bits. durch deren Änderung das Lesen stattfindet, d.h.e Um 1 Byte Daten zu senden, müssen Sie 4 Bytes senden - das 1. Byte enthält 4 Informationsbits, das 2. Bit den Zustand 1, das 2. Byte eine Wiederholung des 1., nur das 2. Bit den Zustand 0. Das 3. und 4. Byte sind ähnlich, nur sie enthalten zweite Hälfte der Daten. Es klingt ein wenig unverständlich, ich zeige Ihnen ein Beispiel:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">I2C_send</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> data, <span class="hljs-keyword">uint8_t</span> flags)</span>
</span>{<font></font>
	HAL_StatusTypeDef res;<font></font>
	 <span class="hljs-comment">//     </span>
        <span class="hljs-keyword">for</span>(;;) {
                <span class="hljs-comment">// ,      lcd_addr                                                                                        </span>
	        res = HAL_I2C_IsDeviceReady(&amp;hi2c1, LCD_ADDR, <span class="hljs-number">1</span>, HAL_MAX_DELAY);               
	         <span class="hljs-comment">//  ,     </span>
                <span class="hljs-keyword">if</span>(res == HAL_OK) <span class="hljs-keyword">break</span>;                                                  <font></font>
	    }<font></font>
        <span class="hljs-comment">//    1111 0000      0  3,    4  7</span>
	<span class="hljs-keyword">uint8_t</span> up = data &amp; <span class="hljs-number">0xF0</span>;   
        <span class="hljs-comment">//   ,  data   4                	</span>
        <span class="hljs-keyword">uint8_t</span> lo = (data &lt;&lt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0xF0</span>;          <font></font>
                                          <font></font>
	<span class="hljs-keyword">uint8_t</span> data_arr[<span class="hljs-number">4</span>];
         <span class="hljs-comment">// 4-7   ,  0-3   </span>
	data_arr[<span class="hljs-number">0</span>] = up|flags|BACKLIGHT|PIN_EN; 
         <span class="hljs-comment">//  ,       0  </span>
	data_arr[<span class="hljs-number">1</span>] = up|flags|BACKLIGHT;         <font></font>
	data_arr[<span class="hljs-number">2</span>] = lo|flags|BACKLIGHT|PIN_EN;<font></font>
	data_arr[<span class="hljs-number">3</span>] = lo|flags|BACKLIGHT;<font></font>
<font></font>
	HAL_I2C_Master_Transmit(&amp;hi2c1, LCD_ADDR, data_arr, <span class="hljs-keyword">sizeof</span>(data_arr), HAL_MAX_DELAY);<font></font>
	HAL_Delay(LCD_DELAY_MS);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nehmen wir es in Ordnung. Am Anfang gibt es Variablen, die die Anzeigeadresse speichern, und Einstellungsbits, die jedes Mal zusammen mit den Daten gesendet werden müssen. In der Sendefunktion prüfen wir zunächst, ob sich an der aufgezeichneten Adresse ein Modul befindet. Im Falle des Empfangs der HAL_OK-Nachricht beginnen wir, Bytes zum Senden zu bilden. Am Anfang des Bytes, das wir senden, ist es notwendig, in zwei Teile zu teilen und beide in die hohen Bits zu schreiben. Angenommen, die Anzeige soll die Zeichen 's' anzeigen, im Binärsystem ist es 1110011 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taschenrechner)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Unter Verwendung der logischen Operation &amp; schreiben wir = 01110000 in die Variable, d.h. schreibe nur die höchstwertigen Bits. Die niederwertigen Bits werden zu Beginn um 4 Zeichen nach links verschoben und dann in die Variable lo = 00110000 geschrieben. Als nächstes bilden wir ein Array von 4 Bytes, das Informationen über das anzuzeigende Zeichen enthält. Jetzt weisen wir vorhandenen Bytes Konfigurationsbits (0-3 Bits) zu. Danach senden wir das Adressbyte und 4 Informationsbytes mit der Funktion HAL_I2C_Master_Transmit () an die Anzeige. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beeilen Sie sich jedoch nicht, das Programm herunterzuladen, da Sie zu Beginn die Anzeigeeinstellungen vornehmen müssen. Die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verfügt über eine ausgezeichnete übersetzte Tabelle mit Befehlen zum Anpassen der Anzeige. Nachdem ich es mit der Dokumentation überprüft hatte, kam ich zu den folgenden Einstellungen, die für mich optimal sind:</font></font><br>
<br>
<pre><code class="cpp hljs">  I2C_send(<span class="hljs-number">0b00110000</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">// 8  </span>
  I2C_send(<span class="hljs-number">0b00000010</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//     </span>
  I2C_send(<span class="hljs-number">0b00001100</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//   ,  </span>
  I2C_send(<span class="hljs-number">0b00000001</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//  </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir platzieren diese Befehle vor dem Beginn einer Endlosschleife, so dass die Einstellungen vor Arbeitsbeginn einmal gesendet werden (wie das Void-Setup in Arduinki). </font><font style="vertical-align: inherit;">Für die Funktion I2C_send müssen Sie zusätzlich zum Byte angeben, ob Anzeigeeinstellungen oder Daten gesendet werden sollen. </font><font style="vertical-align: inherit;">Wenn das zweite Argument der Funktion 0 ist, dann die Einstellungen und wenn 1, dann die Daten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und die letzte Berührung - Sie benötigen eine Funktion, die Zeichen für Zeichen eine Frist sendet. </font><font style="vertical-align: inherit;">Hier ist alles ziemlich einfach:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD_SendString</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str)</span>
</span>{
    <span class="hljs-comment">// *char    </span>
    <span class="hljs-comment">//    </span>
	<span class="hljs-keyword">while</span>(*str) <font></font>
        {                                   <font></font>
                <span class="hljs-comment">//    </span>
		I2C_send((<span class="hljs-keyword">uint8_t</span>)(*str), <span class="hljs-number">1</span>); 
                <span class="hljs-comment">//     1               </span><font></font>
                str++;                                     <font></font>
        }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie alle diese Funktionen zusammengestellt haben, können Sie schreiben:</font></font><br>
<br>
<pre><code class="cpp hljs">  LCD_SendString(<span class="hljs-string">"  Hello"</span>);<font></font>
  I2C_send(<span class="hljs-number">0b11000000</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//  </span>
  LCD_SendString(<span class="hljs-string">"    Habr"</span>);
</code></pre><br>
<img src="https://habrastorage.org/webt/wl/yz/_p/wlyz_pkm6xjhc8pqk9anu93m5n0.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, wir haben das 1602-Display jetzt 2004 herausgefunden. Der Unterschied zwischen ihnen ist minimal, selbst dieser Code wird gut funktionieren. Der Unterschied besteht darin, die Adressen der Zellen auf dem Display zu organisieren. In beiden Anzeigen enthält der Speicher 80 Zellen, in der Anzeige 1602 sind die ersten 16 Zellen für die erste Zeile und die Zellen 40 bis 56 für die zweite Zeile verantwortlich. Die verbleibenden Speicherzellen werden nicht angezeigt. Wenn Sie also 17 Zeichen an die Anzeige senden, wird die letzte nicht übertragen in der zweiten Zeile und wird in einer Speicherzelle aufgezeichnet, die keinen Ausgang zur Anzeige hat. Etwas klarer ist der Speicher wie folgt organisiert: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pz/-u/cp/pz-ucp3k76pfuilzikli5ce_m7g.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Zeilenvorschub zu verwenden, habe ich den Befehl </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I2C_send (0b11000000,0) verwendet;</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geht es nur zu 40 Zellen. Das 2004er Display ist interessanter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Reihe besteht aus den Zellen 1 bis 20, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
die zweite Reihe aus den Zellen 40 bis 60</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die dritte Reihe - Zellen von 21 bis 40 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die vierte Reihe - Zellen von 60 bis 80, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
d.h. </font><font style="vertical-align: inherit;">wenn Sie einen Befehl senden</font></font><br>
<br>
<pre><code class="cpp hljs">LCD_SendString(<span class="hljs-string">"___________________1___________________2___________________3___________________4"</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erhalten Folgendes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/fe/xw/z9fexwtyq9grtdqtnq1bbw7jijm.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Übergänge zwischen Zeilen zu organisieren, müssen Sie den Cursor manuell auf die gewünschte Speicherzelle bewegen, oder Sie können die Funktion programmgesteuert ergänzen. </font><font style="vertical-align: inherit;">Ich habe mich bisher für die manuelle Version entschieden:</font></font><br>
<br>
<pre><code class="cpp hljs">  I2C_send(<span class="hljs-number">0b10000000</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//   1 </span>
  LCD_SendString(<span class="hljs-string">"  Hello Habr"</span>);<font></font>
  I2C_send(<span class="hljs-number">0b11000000</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//   2 </span>
  LCD_SendString(<span class="hljs-string">" STM32 + LCD 1602"</span>);<font></font>
  I2C_send(<span class="hljs-number">0b10010100</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//   3 </span>
  LCD_SendString(<span class="hljs-string">" +LCD 2004A"</span>);<font></font>
  I2C_send(<span class="hljs-number">0b11010100</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">//   4 </span>
  LCD_SendString(<span class="hljs-string">" library HAL"</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ergebnis: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/tq/li/yjtqliuuokrq220g_4kyg5lty3y.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist wahrscheinlich alles mit diesen Displays, nützlichen Links, dank derer ich alles herausfinden konnte:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Code sah </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">hier</font></a><font style="vertical-align: inherit;"> sehr gut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aus</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabellen zur Anzeigekonfiguration finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a> </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Verfahren wurde </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">hier</font></a><font style="vertical-align: inherit;"> angeschaut</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programm- und Datenblatt</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PS: Vergessen Sie nicht, die Helligkeit des Displays im Voraus anzupassen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de500992/index.html">Wie ist Performance Management in den besten IT-Unternehmen</a></li>
<li><a href="../de500994/index.html">Führen Sie Ameise. Lauf</a></li>
<li><a href="../de500996/index.html">So werden Sie in sechs Monaten oder noch schneller DevOps-Ingenieur. Teil 1. Einführung</a></li>
<li><a href="../de501002/index.html">Umka: Neue statisch typisierte Skriptsprache</a></li>
<li><a href="../de501004/index.html">Tu es. Arbeit</a></li>
<li><a href="../de501008/index.html">Dominos Pflaster</a></li>
<li><a href="../de501010/index.html">Linux Kernel TLS und Nginx</a></li>
<li><a href="../de501012/index.html">Wie ich nach einer Kindermaschine für einen Blog gesucht habe</a></li>
<li><a href="../de501016/index.html">Über die Entwicklungstrends der Prozessorarchitektur oder warum ich an den Erfolg von Huawei auf dem Servermarkt glaube</a></li>
<li><a href="../de501018/index.html">So umgehen Sie einige Einschränkungen bei der Google-Übersetzung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>