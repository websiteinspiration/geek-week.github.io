<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ù üèí üåπ Navega√ß√£o aut√¥noma de um rob√¥ m√≥vel ü§πüèæ üßïüèª üõ¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° um grande n√∫mero de maneiras pelas quais um rob√¥ pode receber informa√ß√µes do mundo exterior para interagir com ele. Al√©m disso, dependendo das tare...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Navega√ß√£o aut√¥noma de um rob√¥ m√≥vel</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497302/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° um grande n√∫mero de maneiras pelas quais um rob√¥ pode receber informa√ß√µes do mundo exterior para interagir com ele. </font><font style="vertical-align: inherit;">Al√©m disso, dependendo das tarefas atribu√≠das a ele, os m√©todos de processamento dessas informa√ß√µes diferem. </font><font style="vertical-align: inherit;">Neste artigo, descreverei as principais etapas do trabalho realizado como parte do projeto da escola, cujo objetivo √© sistematizar informa√ß√µes sobre v√°rios m√©todos de navega√ß√£o aut√¥noma do rob√¥ e aplicar o conhecimento adquirido no processo de cria√ß√£o do rob√¥ para as competi√ß√µes da "Copa RTK".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/xw/dw/qbxwdwc_cwrypc3c8dthahudzmk.jpeg"><br>
<a name="habracut"></a><br>
<h2><font color="#4d7f95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas competi√ß√µes "RTK Cup", h√° um bloco de tarefas que devem ser conclu√≠das sem a interven√ß√£o do operador. </font><font style="vertical-align: inherit;">Acredito que muitos participantes est√£o evitando injustamente essas tarefas, porque a aparente complexidade de criar um projeto de rob√¥ e escrever um programa oculta tarefas amplamente simplificadas de outras disciplinas competitivas, combinadas em um campo de treinamento. </font><font style="vertical-align: inherit;">Pelo meu projeto, quero mostrar poss√≠veis solu√ß√µes para esses problemas, considerando como exemplo o seguinte ao longo da linha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para atingir a meta do projeto, foram formuladas as seguintes tarefas intermedi√°rias:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regras da</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> competi√ß√£o ‚ÄúRTK Cup‚Äù</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise de algoritmos existentes para orienta√ß√£o aut√¥noma de um rob√¥ m√≥vel</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria√ß√£o de software</font></font></li>
</ul><br>
<h2><font color="#4d7f95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise das regras da competi√ß√£o ‚ÄúRTK Cup‚Äù</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas competi√ß√µes da "Copa RTK", os participantes recebem um campo de treinamento no qual se√ß√µes de complexidade variada s√£o modeladas. </font><font style="vertical-align: inherit;">A competi√ß√£o tem como objetivo estimular a rob√≥tica jovem a criar dispositivos que possam trabalhar em condi√ß√µes extremas, superar obst√°culos, sob controle humano ou autonomamente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6a/sr/6w/6asr6wzvlhnqgkmz0b8dfyf2h9o.jpeg"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">brevemente sobre os elementos que comp√µem o pol√≠gono</font></font></b><div class="spoiler_text"> ¬´¬ª          ,    .    ,       ,     (), ,      (),   ..<br>
<br>
:<br>
<br>
<img src="https://habrastorage.org/webt/mk/ks/d3/mkksd313rprmlsilxcrq5xdytg4.png" width="300"><br>
<br>
:<br>
<br>
<img src="https://habrastorage.org/webt/rv/fp/cu/rvfpcu-6qtvdfrclsqjzlr2xok4.jpeg" width="300"><br>
<br>
  ‚Äì  ,     ¬´¬ª  ( )  ,        . ,         ,    ,      ,         .<br>
<br>
     .    ,       ,     ,   ,     ,    ,    .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As competi√ß√µes s√£o divididas em duas nomea√ß√µes fundamentalmente diferentes umas das outras: "Buscador" e "Extremo". Isso √© feito para garantir que a competi√ß√£o seja realizada entre participantes com uma diferen√ßa m√≠nima de idade e experi√™ncia no desenvolvimento de sistemas rob√≥ticos: "Buscador" para o n√≠vel mais jovem e "Extremo" - para participantes a partir dos 14 anos de idade. Na indica√ß√£o de apanhador, o operador pode se mover livremente ao redor da faixa e ter contato visual direto com a m√°quina, enquanto a indica√ß√£o Extreme pressup√µe que o rob√¥ tenha sistemas de comunica√ß√£o por v√≠deo e / ou vis√£o computacional, j√° que o operador deve navegar no labirinto, contando apenas com o labirinto a c√¢mera e os sensores embutidos no rob√¥, enquanto estiver atr√°s de uma tela especial.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para se qualificar em competi√ß√µes, o rob√¥ deve passar a tarefa de controle remoto do manipulador ou executar um dos elementos da autonomia. </font><font style="vertical-align: inherit;">Na estrutura do projeto, a tarefa foi definida para cumprir as tarefas de autonomia, pois elas fornecem mais pontos ao menor custo do operador. </font><font style="vertical-align: inherit;">Os elementos da autonomia incluem:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condu√ß√£o ao longo de uma linha com um sensor de luz ambiente ou um sistema de linha de vis√£o</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Captura aut√¥noma de farol usando sensor de dist√¢ncia ou sistemas de vis√£o</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Movimento ao longo de uma trajet√≥ria complexa (por exemplo, subida / descida de escadas) ao longo de uma linha usando uma b√∫ssola, girosc√≥pio, aceler√¥metro, sistema de vis√£o ou m√©todos combinados</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, os pontos para superar obst√°culos s√£o duplicados se o rob√¥ os passar autonomamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dentro da estrutura deste projeto, a solu√ß√£o para a primeira das tarefas ser√° considerada - movimento ao longo da linha. Os m√©todos mais comuns usados ‚Äã‚Äãao se mover ao longo da linha s√£o sensores de luz e uma c√¢mera. As vantagens dos sensores incluem a simplicidade de criar um programa - muitos deles est√£o equipados com um resistor de sintonia, de modo que, ao configurar o sensor para ilumina√ß√£o de fundo, ele fornecer√° 0 ou 1, dependendo se est√° na linha ou n√£o. Pela mesma raz√£o, os sensores de luz n√£o exigem a pot√™ncia de processamento do controlador usado. Al√©m disso, por causa disso, resolver o problema com a ajuda de sensores de luz √© o menos dispendioso - o custo do sensor mais simples √© de 35 rublos e, para um percurso relativamente est√°vel ao longo da linha, tr√™s sensores s√£o suficientes (um √© instalado na linha e dois nas laterais). Contudo,Uma das principais desvantagens de tais sensores s√£o as restri√ß√µes de instala√ß√£o. Idealmente, o sensor deve ser instalado exatamente no centro, a uma pequena dist√¢ncia do ch√£o, caso contr√°rio, fornecer√° valores incorretos. Isso n√£o √© um problema em competi√ß√µes especializadas em que o rob√¥ deve dirigir o mais r√°pido poss√≠vel ao longo da pista, mas, nas condi√ß√µes da competi√ß√£o "Copa RTK", todas as falhas dos sensores acima mencionadas podem ser cr√≠ticas - sua instala√ß√£o requer principalmente a presen√ßa de pe√ßas mec√¢nicas adicionais no rob√¥ que elevam e abaixar os sensores, e isso requer espa√ßo adicional no rob√¥, um mecanismo separado movendo os sensores e tamb√©m √© um local de dano potencial e aumenta a massa do rob√¥.caso contr√°rio, fornecer√° valores incorretos. Isso n√£o √© um problema em competi√ß√µes especializadas, nas quais o rob√¥ deve dirigir o mais r√°pido poss√≠vel ao longo da pista, mas, nas condi√ß√µes da competi√ß√£o "Copa RTK", todas as falhas dos sensores acima mencionadas podem ser cr√≠ticas - sua instala√ß√£o requer principalmente a presen√ßa de pe√ßas mec√¢nicas adicionais no rob√¥ que elevam e abaixar os sensores, e isso requer espa√ßo adicional no rob√¥, um mecanismo separado movendo os sensores e tamb√©m √© um local de dano potencial e aumenta a massa do rob√¥.caso contr√°rio, fornecer√° valores incorretos. Isso n√£o √© um problema em competi√ß√µes especializadas, nas quais o rob√¥ deve dirigir o mais r√°pido poss√≠vel ao longo da pista, mas, nas condi√ß√µes da competi√ß√£o "Copa RTK", todas as falhas dos sensores acima mencionadas podem ser cr√≠ticas - sua instala√ß√£o requer principalmente a presen√ßa de pe√ßas mec√¢nicas adicionais no rob√¥ que elevam e abaixar os sensores, e isso requer espa√ßo adicional no rob√¥, um mecanismo separado movendo os sensores e tamb√©m √© um local de dano potencial e aumenta a massa do rob√¥.todas as falhas do sensor acima mencionadas podem ser cr√≠ticas - sua instala√ß√£o requer principalmente a presen√ßa de pe√ßas mec√¢nicas adicionais no rob√¥ que elevam e abaixam os sensores, e isso requer espa√ßo adicional no rob√¥, um motor separado que move os sensores e tamb√©m √© um local de dano potencial e aumenta a massa do rob√¥ .todas as falhas do sensor acima mencionadas podem ser cr√≠ticas - sua instala√ß√£o requer principalmente a presen√ßa no rob√¥ de pe√ßas mec√¢nicas adicionais, elevando e abaixando os sensores, e isso requer espa√ßo adicional no rob√¥, um motor separado movendo os sensores e tamb√©m √© um local de dano potencial e aumenta a massa do rob√¥ .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/_g/pt/zz/_gptzzip0rdk6ocgg67ttumux2k.jpeg" width="300" align="right"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A c√¢mera, por sua vez, possui as seguintes vantagens: possui um raio de medi√ß√£o praticamente ilimitado (em compara√ß√£o com sensores), ou seja, apenas um m√≥dulo de c√¢mera √© capaz de ver simultaneamente a linha, diretamente abaixo do rob√¥, e a uma dist√¢ncia suficiente dela, o que permite, por exemplo, avaliar sua curvatura e selecionar uma a√ß√£o de controle proporcional. Ao mesmo tempo, o m√≥dulo da c√¢mera n√£o interfere no avan√ßo do rob√¥ em outras partes do aterro que n√£o exigem autonomia, uma vez que a c√¢mera √© fixada a uma dist√¢ncia do ch√£o. O principal ponto negativo da c√¢mera √© que o processamento de v√≠deo requer um poderoso complexo de computa√ß√£o a bordo do rob√¥, e o software em desenvolvimento precisa de um ajuste mais fino, porque a c√¢mera recebe uma ordem de magnitude mais informa√ß√µes do mundo exterior do que tr√™s sensores de luz, enquanto a c√¢mera e o computadorcapazes de processar as informa√ß√µes recebidas s√£o muitas vezes mais do que tr√™s sensores e "arduins".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mim, pessoalmente, a resposta √© √≥bvia para mim - na nomea√ß√£o ‚Äúextremal‚Äù, o rob√¥ deve ter uma c√¢mera direcional, com a qual o operador navegar√°. </font><font style="vertical-align: inherit;">Se voc√™ usar solu√ß√µes FPV prontas, o custo total de "sensores" poder√° ser ainda mais alto, exigindo a instala√ß√£o de dispositivos adicionais. </font><font style="vertical-align: inherit;">Al√©m disso, um rob√¥ com raspberry pi e uma c√¢mera tem maior potencial para o desenvolvimento de movimento aut√¥nomo, j√° que a c√¢mera pode resolver uma ampla gama de problemas e pode ser usada n√£o apenas no movimento da linha, sem complicar muito o design.</font></font><br>
<br>
<h2><font color="#4d7f95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise de algoritmos de vis√£o computacional existentes</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vis√£o computacional √© a teoria da cria√ß√£o de dispositivos que podem receber imagens de objetos do mundo real, processar e usar os dados obtidos para resolver v√°rios tipos de problemas aplicados sem interven√ß√£o humana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os sistemas de vis√£o computacional consistem em:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma ou mais c√¢meras </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">complexo de computadores </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software que fornece ferramentas de processamento de imagem</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canais de comunica√ß√£o para transmiss√£o de informa√ß√µes de alvo e telemetria. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como escrito anteriormente, existem muitas maneiras de identificar objetos de interesse para n√≥s. No caso de dirigir ao longo de uma linha, √© necess√°rio separar a pr√≥pria linha do fundo contrastante (uma linha preta em um fundo branco ou uma linha branca em um fundo preto para uma linha inversa). Os algoritmos que usam um sistema de vis√£o computacional podem ser divididos em v√°rias "etapas" para processar a imagem original: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquisi√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de imagens: as imagens digitais s√£o obtidas diretamente da c√¢mera, de um fluxo de v√≠deo transmitido ao dispositivo ou como imagens separadas. Os valores de pixel geralmente correspondem √† intensidade da luz (imagens coloridas ou em escala de cinza), mas podem ser associados a v√°rias medi√ß√µes f√≠sicas, como, por exemplo, temperatura de uma c√¢mera de imagem t√©rmica. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processamento preliminar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Antes que os m√©todos de vis√£o computacional possam ser aplicados aos dados de v√≠deo, √© necess√°rio pr√©-processamento para introduzir determinadas condi√ß√µes, dependendo do m√©todo usado. </font><font style="vertical-align: inherit;">Exemplos s√£o:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remo√ß√£o de ru√≠dos ou distor√ß√µes causados ‚Äã‚Äãpelo sensor usado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O desfoque de imagem usado para eliminar pequenos artefatos que ocorrem durante a opera√ß√£o da c√¢mera, elementos de descompress√£o, ru√≠do etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhorando o contraste para que a informa√ß√£o correta possa ser detectada com mais probabilidade</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alterar a exposi√ß√£o para cortar sombras ou realces</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dimensionar ou cortar para distinguir melhor as estruturas da imagem.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convertendo uma imagem em monocrom√°tico ou alterando sua resolu√ß√£o para obter um desempenho mais r√°pido do sistema</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detalhes de destaque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : os detalhes da imagem de v√°rios n√≠veis de dificuldade s√£o extra√≠dos dos dados do v√≠deo. </font><font style="vertical-align: inherit;">Exemplos t√≠picos de tais detalhes s√£o linhas, bordas, arestas, pontos individuais, √°reas caracter√≠sticas de qualquer recurso. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : em uma determinada etapa do trabalho do programa, as informa√ß√µes relevantes para o programa s√£o separadas do restante da imagem. </font><font style="vertical-align: inherit;">Exemplos s√£o:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A sele√ß√£o de um determinado conjunto de pontos de interesse em cores, o n√∫mero de pixels isolados que s√£o semelhantes de alguma forma (curvatura da figura, cor, brilho etc.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segmenta√ß√£o de uma ou mais se√ß√µes de imagem que cont√™m um objeto caracter√≠stico.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processamento de alto n√≠vel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : nesta etapa, a abund√¢ncia de informa√ß√µes da imagem √© reduzida para um tamanho que pode ser facilmente processado, por exemplo, um conjunto de determinados pixels ou as coordenadas da parte da imagem na qual o objeto de interesse est√° supostamente localizado. </font><font style="vertical-align: inherit;">Exemplos s√£o:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtrando valores por qualquer crit√©rio</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalia√ß√£o de par√¢metros como as dimens√µes f√≠sicas do objeto, forma, sua localiza√ß√£o no quadro ou em rela√ß√£o a outros objetos caracter√≠sticos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classifica√ß√£o</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, foi necess√°rio escolher a biblioteca com base na qual o programa ser√° criado. </font><font style="vertical-align: inherit;">Os principais fatores na minha escolha foram:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O suporte da biblioteca √† interface Python, devido √† relativa facilidade de aprender esse idioma por um iniciante, √© uma sintaxe simples, que tem um efeito ben√©fico na legibilidade do programa.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portabilidade, ou seja, </font><font style="vertical-align: inherit;">a capacidade de executar um programa usando esta biblioteca no raspberry pi3.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A preval√™ncia da biblioteca, que garante uma comunidade bem desenvolvida de programadores que podem j√° ter encontrado problemas que podem surgir durante o seu trabalho.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre as op√ß√µes que examinei, destaquei a biblioteca aberta de vis√£o computacional OpenCV, uma vez que suporta Python, possui extensa documenta√ß√£o online. </font><font style="vertical-align: inherit;">Existem muitos artigos e instru√ß√µes na Internet que descrevem todas as sutilezas de trabalhar com esta biblioteca. </font><font style="vertical-align: inherit;">Existe um f√≥rum oficial de desenvolvedores, onde qualquer pessoa pode fazer uma pergunta sobre isso. </font><font style="vertical-align: inherit;">Al√©m disso, essa biblioteca √© implementada nas linguagens C / C ++, que garantem o desempenho do sistema, e sua estrutura suporta v√°rios m√≥dulos que podem ser desativados para aumentar o desempenho.</font></font><br>
<br>
<h2><font color="#4d7f95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desenvolvimento de software</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s instalar o SO e a configura√ß√£o inicial do Raspberry pi, mas antes de come√ßar a criar o programa, voc√™ deve instalar todos os pacotes necess√°rios para ele. </font><font style="vertical-align: inherit;">A maioria desses pacotes, por sua vez, √© instalada usando o gerenciador de pacotes pip (no caso do Python 3, pip3)</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo apt install python3-pip</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As seguintes bibliotecas est√£o instaladas, como:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">picamera - biblioteca para trabalhar com a c√¢mera raspberry pi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numpy - uma biblioteca para trabalhar com matrizes de dados multidimensionais, como imagens</font></font></li>
</ul><br>
<pre><code class="bash hljs">$ sudo pip3 install picamera<font></font>
$ sudo pip3 install numpy<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cmake - Utilit√°rio para criar automaticamente um programa a partir do c√≥digo fonte </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cmake-curses-gui - pacote GUI (interface gr√°fica) para cmake</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo apt-get install cmake cmake-curses-gui libgtk2.0-dev<font></font>
$ sudo apt-get install cmake cmake-curses-gui libgtk2.0-dev<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bibliotecas para trabalhar com diferentes formatos de imagem e v√≠deo e muito mais</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev libx264-dev libxvidcore-dev<font></font>
$ sudo apt-get install libjpeg-dev libpng12-dev libtiff5-dev libjasper-dev<font></font>
$ sudo apt-get install gfortran libatlas-base-dev<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para transmitir dados de v√≠deo do rob√¥ para o computador, o GStreamer ser√° usado - uma estrutura projetada para receber, processar e transmitir dados multim√≠dia:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo apt install libgstreamer1.0-0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo passo √© instalar a pr√≥pria biblioteca openCV a partir de fontes, configur√°-la e compil√°-la. </font><font style="vertical-align: inherit;">Para fazer isso, uma pasta de trabalho opencv √© criada.</font></font><br>
<br>
<pre><code class="bash hljs">$ mkdir opencv<font></font>
$ <span class="hljs-built_in">cd</span> opencv
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer o download das vers√µes mais recentes da biblioteca, o wget √© usado - um programa de console para baixar arquivos da rede. </font><font style="vertical-align: inherit;">No momento da cria√ß√£o do programa, a vers√£o est√°vel mais recente do openCV √© a 4.1.0, ent√£o fa√ßa o download e descompacte as fontes:</font></font><br>
<br>
<pre><code class="bash hljs">$ wget https://github.com/opencv/opencv/archive/4.1.0.zip -O opencv_source.zip<font></font>
$ unzip opencv_source.zip<font></font>
$ wget https://github.com/opencv/opencv_contrib/archive/4.1.0.zip -O opencv_contrib.zip<font></font>
$ unzip opencv_contrib.zip<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a conclus√£o do processo de descompacta√ß√£o, os arquivos de origem podem ser exclu√≠dos.</font></font><br>
<br>
<pre><code class="bash hljs">$ rm opencv_source.zip<font></font>
$ rm opencv_contrib.zip<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diret√≥rio √© criado para montagem e configura√ß√£o.</font></font><br>
<br>
<pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> /home/pi/opencv/opencv-4.1.0<font></font>
$ mkdir build<font></font>
$ <span class="hljs-built_in">cd</span> build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os par√¢metros de constru√ß√£o s√£o configurados usando o utilit√°rio cmake. </font><font style="vertical-align: inherit;">Para fazer isso, todos os par√¢metros significativos s√£o passados ‚Äã‚Äãcomo vari√°veis ‚Äã‚Äãde utilit√°rio, juntamente com os valores atribu√≠dos:</font></font><br>
<br>
<pre><code class="cmake hljs">cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D INSTALL_PYTHON_EXAMPLES=<span class="hljs-keyword">ON</span> -D INSTALL_C_EXAMPLES=<span class="hljs-keyword">OFF</span> -D BUILD_opencv_python2=<span class="hljs-keyword">OFF</span> -D WITH_GSTREAMER=<span class="hljs-keyword">ON</span> -D BUILD_EXAMPLES=<span class="hljs-keyword">ON</span> -DENABLE_VFPV3=<span class="hljs-keyword">ON</span> -DENABLE_NEON=<span class="hljs-keyword">ON</span> -DCPU_BASELINE=NEON ..
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de definir a configura√ß√£o, o utilit√°rio exibir√° todos os par√¢metros. Em seguida, voc√™ precisa compilar a biblioteca. Para fazer isso, use o comando do console make ‚ÄìjN, onde N √© o n√∫mero de n√∫cleos que estar√£o envolvidos no processo de compila√ß√£o. Para o raspberry pi 3, o n√∫mero de n√∫cleos √© 4, mas voc√™ pode descobrir esse n√∫mero gravando o comando nproc no console.</font></font><br>
<br>
<pre><code class="bash hljs">$ make ‚Äìj4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devido aos recursos limitados da framboesa, a compila√ß√£o pode demorar um pouco. </font><font style="vertical-align: inherit;">Em alguns casos, as framboesas podem at√© congelar, mas se voc√™ mais tarde entrar na pasta de compila√ß√£o e registrar novamente a marca, o trabalho continuar√°. </font><font style="vertical-align: inherit;">Se isso acontecer, vale a pena reduzir o n√∫mero de n√∫cleos envolvidos, no entanto, minha compila√ß√£o foi sem problemas. </font><font style="vertical-align: inherit;">Al√©m disso, nesta fase, vale a pena pensar no resfriamento ativo da framboesa, porque mesmo com ela a temperatura do processador atingiu cerca de 75 graus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando a compila√ß√£o foi bem-sucedida, a biblioteca precisa ser instalada. </font><font style="vertical-align: inherit;">Isso tamb√©m √© feito usando o utilit√°rio make. </font><font style="vertical-align: inherit;">Em seguida, formaremos todas as conex√µes necess√°rias com o utilit√°rio ldconfig:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo make install<font></font>
$ sudo ldconfig<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificamos a instala√ß√£o escrevendo os seguintes comandos no modo interativo python:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> cv2<font></font>
print(cv2.getBuildInformation())<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguinte conclus√£o do programa evidenciar√° a instala√ß√£o correta: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/np/vi/ng/npving2rmncveg11-8qxvhvco1q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note-se que o procedimento de compila√ß√£o da biblioteca acima deve ser executado no rob√¥ e no PC do qual est√° planejado controlar o rob√¥ e em que transmiss√µes do rob√¥ ser√£o recebidas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criando um esquema de distribui√ß√£o de v√≠deo</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de come√ßar a escrever o c√≥digo, voc√™ precisa desenvolver um esquema segundo o qual o algoritmo funcionar√°. Nesse caso, no desenvolvimento de software do rob√¥ criado para participa√ß√£o nas competi√ß√µes da RTK Cup na nomea√ß√£o Extreme, todo o programa ser√° dividido em duas partes: um rob√¥ e um controle remoto, que ser√£o reproduzidos por um computador com o sistema operacional Linux instalado. Uma das tarefas mais importantes aqui √© criar um esquema aproximado de como os dados de v√≠deo ser√£o transmitidos entre diferentes partes do algoritmo. O Wi-Fi ser√° usado como um canal de comunica√ß√£o entre os dois dispositivos. Os pacotes de dados que fornecem controle do rob√¥ e os dados de feedback ser√£o transmitidos de um dispositivo para outro usando o protocolo UDP implementado no uso da biblioteca de soquetes. Dados de v√≠deodevido a limita√ß√µes no tamanho do pacote UDP ser√£o transmitidos usando o GStreamer. Para a conveni√™ncia da depura√ß√£o, dois fluxos de v√≠deo ser√£o implementados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream de v√≠deo principal - transfere dados de v√≠deo diretamente da c√¢mera do rob√¥ para um computador para garantir um atraso m√≠nimo no controle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fluxo de v√≠deo auxiliar - transfere os dados de v√≠deo processados ‚Äã‚Äãpelo rob√¥, necess√°rios para configurar e depurar um programa que implementa a vis√£o computacional.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dois fluxos de v√≠deo estar√£o ativos simultaneamente no rob√¥, e o computador exibir√° a imagem desejada, dependendo do modo de unidade ativado. </font><font style="vertical-align: inherit;">O rob√¥, por sua vez, dependendo de o modo de autonomia estar ativado ou desativado, usar√° os dados de controle recebidos de um computador ou gerados por um processador de imagem. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zw/0l/uw/zw0luwrmjjesbm1ygsra6gxtkm4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O controle remoto do rob√¥ ser√° realizado devido ao trabalho de dois fluxos paralelos no rob√¥ e no computador:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O "console" em um ciclo pesquisa todos os dispositivos de entrada dispon√≠veis e forma um pacote de dados de controle que consiste nos pr√≥prios dados e na soma de verifica√ß√£o (no momento de fazer as altera√ß√µes finais no artigo, eu me recusei a criar somas de verifica√ß√£o para reduzir o atraso, mas nas fontes, que eu disposto no final deste peda√ßo de c√≥digo) - de um determinado valor calculado a partir de um conjunto de dados pela opera√ß√£o de algum algoritmo usado para determinar a integridade dos dados durante a transmiss√£o</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rob√¥ - aguarda o acesso a dados do computador. </font><font style="vertical-align: inherit;">Descompacta os dados, recalcula a soma de verifica√ß√£o e a compara com a enviada e calculada no lado do computador. </font><font style="vertical-align: inherit;">Se as somas de verifica√ß√£o corresponderem, os dados s√£o transferidos para o programa principal.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de analisar o algoritmo de detec√ß√£o de linha, sugiro que voc√™ se familiarize com os recursos de design do rob√¥:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre o rob√¥</font></font></b><div class="spoiler_text">          .<br>
<br>
<img src="https://habrastorage.org/webt/vw/ao/ex/vwaoexwehb49titxcgdis_ryonc.jpeg" width="200" align="right"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"></a> ‚Äî       .      (3  )        .                 ,      .      6 ,        .           .      .          .     ,    -  .     ¬´¬ª   rasberry pi 3 b ‚Äî      .<br>
<br>
<img src="https://habrastorage.org/webt/ho/zw/bi/hozwbiptp_fihoiqncxq2zsbpim.png" width="200" align="left"> ,       ,   ,   ,   Solidworks    petg .    ,     raspberry        .<br>
<br>
<img src="https://habrastorage.org/webt/mh/po/bd/mhpobduedmyoxzrdbhhac2ewdpq.png" width="200" align="left">          ubiquiti bullet M5 hp.     (   )      ,          .   ,   ¬´¬ª  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> </a> . <br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ti/h_/7l/tih_7l74vjx8leso89cwynfpb3o.jpeg" width="400"></div><br>
:     ¬´¬ª     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">  thingiverse</a>.    ,  ,   ,      ,          .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wd/df/q_/wddfq_nyi7-xcqmdiil5glkybqe.gif" width="300"></div><br>
   ,     ,   .       ,     .              ,  ,        ,     ,    .     ,       ,        ,     .<br>
<br>
<img src="https://habrastorage.org/webt/sl/ju/f9/sljuf9jwaqm2kdadelgsgubyf5o.gif" width="450"><br>
<br>
<img src="https://habrastorage.org/webt/sg/xk/_k/sgxk_kt1f0xdxkg4igwgzmbudk0.png" width="250"><br>
<br>
-     (   -  200 )    ,       ,     90       70   (     ),          ,     ¬´ ¬ª. ,            VL53L0X        ,      .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jq/wh/hc/jqwhhc7et4crpin64qkaw6txgk0.png" width="250"></div><br>
 ¬´¬ª     ,     ,    (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">rds3115</a>).    ‚Äî ,     ,  ,     ,     .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4p/ot/ic/4poticuqt_itsiasls1of3927ma.jpeg" width="250"></div><br>
      ,      ,    ,   :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qc/w5/ol/qcw5olk3klaxq75typuz41hdt18.png" width="250"></div><br>
- ,       ,          ,      .           . <img src="https://habrastorage.org/webt/he/4o/kp/he4okpaqyd5pof9x1cjwc1aalwi.jpeg" width="200" align="left">        raspberry,      ,     .       ,      .<br>
<br>
     ,   USB.            ,            ,     .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rq/wv/yr/rqwvyr8kv5dtvpgz6x7rahoyfho.gif" width="200"></div><br>
<i>        </i><br>
</div></div><br>
<h3><font color="#4d7f95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria√ß√£o de um algoritmo de detec√ß√£o de linha usando m√©todos de biblioteca OpenCV</font></font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I. Recebendo dados</font></font></b> <br>
<br>
<img src="https://habrastorage.org/webt/ua/q7/zo/uaq7zojtflqtezqkiq2meem5mam.png" width="300" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Devido ao fato de o processador de imagem n√£o receber dados de v√≠deo diretamente da c√¢mera, mas do fluxo principal, √© necess√°rio transferi-los do formato usado para tradu√ß√£o para o formato usado para processamento de imagem, ou seja, um array numpy composto por valores em vermelho , verde e azul para cada um dos pixels. </font><font style="vertical-align: inherit;">Para fazer isso, voc√™ precisa dos dados iniciais - um quadro recebido do m√≥dulo da c√¢mera raspberry pi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais f√°cil de obter quadros da c√¢mera c para processamento adicional √© usar a biblioteca picamera. </font><font style="vertical-align: inherit;">Antes de come√ßar, voc√™ precisa permitir o acesso √† c√¢mera atrav√©s de raspi-config -&gt; interface interface camera -&gt; selecione yes.</font></font><br>
<br>
<pre><code class="bash hljs">sudo raspi-config</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a pr√≥xima se√ß√£o do c√≥digo √© conectada √† c√¢mera raspberry e, em um ciclo com uma determinada frequ√™ncia, recebe quadros na forma de um array pronto para uso pela biblioteca opencv.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> picamera.array <span class="hljs-keyword">import</span> PiRGBArray
<span class="hljs-keyword">from</span> picamera <span class="hljs-keyword">import</span> PiCamera
<span class="hljs-keyword">import</span> cv2
<span class="hljs-comment">#   </span><font></font>
camera = PiCamera()<font></font>
camera.resolution = (<span class="hljs-number">640</span>, <span class="hljs-number">480</span>) <font></font>
camera.framerate = <span class="hljs-number">30</span>
cap = PiRGBArray(camera, size=(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>))<font></font>
<font></font>
<span class="hljs-keyword">for</span> frame <span class="hljs-keyword">in</span> camera.capture_continuous(cap , format=<span class="hljs-string">"bgr"</span>, use_video_port=<span class="hljs-literal">True</span>):<font></font>
	new_frame = frame.array<font></font>
	cap.truncate(<span class="hljs-number">0</span>)
	<span class="hljs-keyword">if</span> <span class="hljs-literal">False</span>: <span class="hljs-comment">#   -   </span>
		<span class="hljs-keyword">break</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m √© importante notar que esse m√©todo de captura de quadros, embora seja o mais simples, mas tem uma s√©ria desvantagem: n√£o √© muito eficaz se voc√™ precisar transmitir quadros pelo GStreamer, pois isso exige v√°rias vezes a recodifica√ß√£o do v√≠deo, o que reduz a velocidade do programa. </font><font style="vertical-align: inherit;">Uma maneira muito mais r√°pida de obter imagens ser√° a sa√≠da de quadros do fluxo de v√≠deo a pedido do processador de imagens; no entanto, os est√°gios adicionais do processamento da imagem n√£o depender√£o do m√©todo usado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo de imagem de uma c√¢mera de cabe√ßalho de rob√¥ sem processamento:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bo/yi/ez/boyiezf6vfa1nqrlcdllhwbmsgg.png" width="350"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">II Pr√©-processamento</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ao dirigir em uma linha, ser√° mais simples separar a √°rea dos pontos que mais contrastam com a cor de fundo. Este m√©todo √© ideal para a competi√ß√£o da Copa RTK, porque usa uma linha preta em fundo branco (ou uma linha branca em fundo preto para se√ß√µes inversas). Para reduzir a quantidade de informa√ß√µes que precisam ser processadas, voc√™ pode aplicar um algoritmo de binariza√ß√£o, ou seja, converter a imagem em um formato monocrom√°tico, onde existem apenas dois tipos de pixels - escuro e claro. Antes disso, a imagem deve ser traduzida para tons de cinza e tamb√©m borrada, a fim de eliminar pequenos defeitos e ru√≠dos que inevitavelmente aparecem durante a opera√ß√£o da c√¢mera. Para desfocar a imagem, √© usado um filtro gaussiano.</font></font><br>
<br>
<pre><code class="python hljs">gray = cv2.cvtColor(self._frame, cv2.COLOR_RGB2GRAY)<font></font>
blur = cv2.GaussianBlur(gray, (ksize, ksize), <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
onde ksize √© o tamanho do n√∫cleo gaussiano, aumentando o qual, voc√™ pode aumentar o grau de desfoque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo de imagem ap√≥s tradu√ß√£o em escala de cinza e desfoque:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/5h/_d/ye5h_d7dqttbxo_af3hhkxnllce.png" width="350"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">III </font><font style="vertical-align: inherit;">Selecionando detalhes</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depois que a imagem √© traduzida em escala de cinza, √© necess√°rio binariz√°-la em um determinado limite. </font><font style="vertical-align: inherit;">Essa a√ß√£o permite reduzir ainda mais a quantidade de dados, que ser√° ajustado antes de cada partida do rob√¥ em um novo local ou quando as condi√ß√µes de ilumina√ß√£o mudarem. </font><font style="vertical-align: inherit;">Idealmente, a tarefa da calibra√ß√£o √© garantir que o contorno da linha seja definido na imagem, mas, ao mesmo tempo, n√£o deve haver outros detalhes na imagem que n√£o sejam uma linha:</font></font><br>
<br>
<pre><code class="python hljs">thresh = cv2.threshold(blur, self._limit, <span class="hljs-number">255</span>, cv2.THRESH_BINARY_INV)[<span class="hljs-number">1</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, todos os pixels mais escuros que o valor do limite (limite auto) s√£o substitu√≠dos por 0 (preto), mais claro - por 255 (branco). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s o processamento, a imagem tem a seguinte apar√™ncia:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ne/rq/tl/nerqtlzt7p-k0q-4quw6nhsbfau.png" width="350"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, o programa identificou v√°rias das partes mais escuras da imagem. </font><font style="vertical-align: inherit;">No entanto, ap√≥s calibrar o valor limite para "capturar" completamente os fones de ouvido, outros elementos brancos aparecem na tela al√©m deles. </font><font style="vertical-align: inherit;">Obviamente, voc√™ pode ajustar o limiar e, no campo de treinamento competitivo, a c√¢mera olha para baixo, n√£o permitindo elementos desnecess√°rios no quadro, mas considero necess√°rio separar a linha de todo o resto. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IV.Detec√ß√£o</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na imagem binarizada, apliquei um algoritmo de pesquisa de borda. </font><font style="vertical-align: inherit;">√â necess√°rio para determinar pontos independentes e transform√°-los em uma matriz conveniente de valores de coordenadas dos pontos que comp√µem a borda. </font><font style="vertical-align: inherit;">No caso do opencv, conforme escrito na documenta√ß√£o, o algoritmo padr√£o para encontrar loops usa o algoritmo Suzuki85 (n√£o consegui encontrar refer√™ncias ao algoritmo com esse nome em nenhum lugar, exceto na documenta√ß√£o do opencv, mas assumirei que esse √© o algoritmo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suzuki-Abe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<pre><code class="python hljs">contours = cv2.findContours(thresh, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui est√° o quadro obtido nesta fase:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ex/3r/gx/ex3rgxc7bmefqdwhetn5wfxrtko.png" width="350"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V. Processamento de alto n√≠vel</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de encontrar todos os contornos do quadro, o contorno com a maior √°rea √© selecionado e tomado como o contorno da linha. Conhecendo as coordenadas de todos os pontos desse contorno, a coordenada de seu centro √© encontrada. Para isso, s√£o utilizados os chamados "momentos da imagem". O momento √© a caracter√≠stica total do contorno, calculada somando as coordenadas de todos os pixels do contorno. Existem v√°rios tipos de momentos - at√© a terceira ordem. Para esse problema, apenas o momento de ordem zero (m00) √© necess√°rio - o n√∫mero de todos os pontos que comp√µem o contorno (per√≠metro do contorno), o momento de primeira ordem (m10), que √© a soma das coordenadas X de todos os pontos, e m01 √© a soma das coordenadas Y de todos os pontos. Ao dividir a soma das coordenadas dos pontos ao longo de um dos eixos pelo n√∫mero, obt√©m-se a m√©dia aritm√©tica - a coordenada aproximada do centro do contorno. Em seguida, o desvio do rob√¥ do curso √© calculado:o percurso "diretamente" corresponde √† coordenada do ponto central ao longo de X pr√≥ximo √† largura do quadro dividido por dois. Se a coordenada do centro da linha estiver pr√≥xima ao centro do quadro, a a√ß√£o de controle ser√° m√≠nima e, portanto, o rob√¥ manter√° seu curso atual. Se o rob√¥ se desviar de um dos lados, uma a√ß√£o de controle proporcional ao desvio ser√° introduzida at√© que ele retorne.</font></font><br>
<br>
<pre><code class="python hljs">mainContour = max(contours, key = cv2.contourArea)<font></font>
M = cv2.moments(mainContour)<font></font>
<span class="hljs-keyword">if</span> M[<span class="hljs-string">'m00'</span>] != <span class="hljs-number">0</span>:<span class="hljs-comment">#     (..   -  )</span>
    cx = int(M[<span class="hljs-string">'m10'</span>]/M[<span class="hljs-string">'m00'</span>])<font></font>
    cy = int(M[<span class="hljs-string">'m01'</span>]/M[<span class="hljs-string">'m00'</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√° um desenho esquem√°tico da posi√ß√£o do rob√¥ em rela√ß√£o √† linha e aos quadros, com os resultados do programa sobrepostos: o contorno ‚Äúprincipal‚Äù, as linhas que passam pelo centro do contorno, bem como o ponto localizado no centro para estimar o desvio. </font><font style="vertical-align: inherit;">Esses elementos s√£o adicionados usando o seguinte c√≥digo:</font></font><br>
<br>
<pre><code class="python hljs">cv2.line(frame, (cx, <span class="hljs-number">0</span>), (cx, self.height), (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)    <span class="hljs-comment">#    </span>
cv2.line(frame, (<span class="hljs-number">0</span>, cy), (self.width, cy), (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)                  <font></font>
cv2.circle(frame, (self.width//<span class="hljs-number">2</span>, self.height//<span class="hljs-number">2</span>), <span class="hljs-number">3</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">-1</span>) <span class="hljs-comment">#  </span>
cv2.drawContours(frame, mainContour, <span class="hljs-number">-1</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>, cv2.FILLED) <span class="hljs-comment">#   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conveni√™ncia da depura√ß√£o, todos os elementos descritos anteriormente s√£o adicionados ao quadro bruto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f4/fl/os/f4flos522ouvlu-vi2b9rr_17lg.png" width="350"><br>
<br>
<img src="https://habrastorage.org/webt/uc/r1/vx/ucr1vxcecjqdv5qdswcbjsltw9w.png" width="350"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
assim, tendo conduzido o quadro pelo algoritmo de processamento, obtivemos as coordenadas X e Y do centro do objeto de interesse para n√≥s, bem como a imagem de depura√ß√£o. </font><font style="vertical-align: inherit;">A seguir, √© mostrada esquematicamente a posi√ß√£o do rob√¥ em rela√ß√£o √† linha, bem como a imagem que passou no algoritmo de processamento.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4r/co/fy/4rcofyknawjnesluhuvoyp9zomu.jpeg" width="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo passo no programa √© converter as informa√ß√µes obtidas no passo anterior nos valores de pot√™ncia de dois motores. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/s3/gn/ios3gnw-mt2xsmvh_hsfrpsdkdu.jpeg" width="250" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maneira mais f√°cil de converter a diferen√ßa entre a mudan√ßa do centro da mancha colorida em rela√ß√£o ao centro do quadro √© o regulador proporcional (tamb√©m existe um regulador de rel√©, mas, devido √†s caracter√≠sticas de sua opera√ß√£o, ele n√£o √© muito adequado para conduzir ao longo da linha). O princ√≠pio de opera√ß√£o de um algoritmo desse tipo √© que o controlador gera uma a√ß√£o de controle no objeto proporcionalmente √† magnitude do erro. Al√©m do controlador proporcional, h√° tamb√©m um integral, onde, com o tempo, o componente integral ‚Äúacumula‚Äù o erro e os diferenciais, cujo princ√≠pio se baseia na aplica√ß√£o da influ√™ncia regulat√≥ria apenas com uma altera√ß√£o suficiente na vari√°vel controlada. Na pr√°tica, esses controladores P, I, D mais simples s√£o combinados em controladores do tipo PI, PD, PID.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale ressaltar que no meu rob√¥ eu tentei "iniciar" o controlador PID, mas seu uso n√£o trouxe nenhuma vantagem s√©ria sobre o controlador proporcional usual. Admito que n√£o consegui ajustar adequadamente o regulador, mas tamb√©m √© poss√≠vel que suas vantagens n√£o sejam t√£o claramente vis√≠veis no caso de um rob√¥ pesado que √© incapaz de desenvolver fisicamente altas velocidades. Na vers√£o mais recente do programa, no momento da reda√ß√£o deste documento, √© utilizado um regulador proporcional simples, mas com um pequeno recurso que permite usar mais informa√ß√µes da c√¢mera: ao gerar o valor do erro, n√£o apenas a posi√ß√£o horizontal do ponto m√©dio do ponto foi levada em considera√ß√£o, mas tamb√©m verticalmente, o que permitiu diferentes formas. responder a elementos de linhalocalizado "√† dist√¢ncia" e imediatamente em frente ou embaixo do rob√¥ (a c√¢mera de dire√ß√£o do rob√¥ tem um grande √¢ngulo de vis√£o, ent√£o, girando-a apenas 45 graus para baixo, voc√™ j√° pode ver uma parte significativa do campo sob o rob√¥).</font></font><br>
<br>
<pre><code class="python hljs">error= cx / (self.width/<span class="hljs-number">2</span>) - <span class="hljs-number">1</span>  
<span class="hljs-comment">#  ( 0   )  [-1; 1]</span>
error*= cy / self.height + self.gain <span class="hljs-comment">#</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria das vezes, nas condi√ß√µes da competi√ß√£o "Copa RTK", os participantes usam o chamado "circuito do tanque" - um ou mais motores controlam um lado do rob√¥ e funciona tanto com esteiras quanto com rodas. O uso desse esquema permite eliminar elementos de transmiss√£o complexos que aumentam a chance de quebra (diferenciais ou eixos cardan), obt√™m o menor raio de viragem poss√≠vel, o que oferece uma vantagem em um pol√≠gono confinado. Esse esquema envolve o controle paralelo de dois "lados" para o movimento ao longo de um caminho complexo. Para fazer isso, o programa usa duas vari√°veis ‚Äã‚Äã- a pot√™ncia do motor direito e esquerdo. Essa energia depende da velocidade base (BASE_SPEED), variando de 0 a 100.Erros (erro) - a diferen√ßa entre o centro do quadro e a coordenada do meio da linha e o coeficiente de efeito proporcional (self._koof), que √© calibrado pelo operador. Seu valor absoluto afeta a rapidez com que o rob√¥ tenta se alinhar √† linha. Devido ao fato de que em um mecanismo a a√ß√£o de controle √© subtra√≠da da velocidade base e, por outro - √© adicionado, √© executada uma curva ao se desviar do curso. A dire√ß√£o na qual a revers√£o ser√° realizada pode ser ajustada alterando o sinal da vari√°vel self._koof. Al√©m disso, voc√™ pode perceber que, como resultado da pr√≥xima se√ß√£o de c√≥digo, pode aparecer um valor de pot√™ncia superior a 100, mas, no meu programa, esses casos s√£o processados ‚Äã‚Äãposteriormente posteriormente.Seu valor absoluto afeta a rapidez com que o rob√¥ tenta se alinhar √† linha. Devido ao fato de que em um mecanismo a a√ß√£o de controle √© subtra√≠da da velocidade base e, por outro - √© adicionado, √© executada uma curva ao se desviar do curso. A dire√ß√£o na qual a revers√£o ser√° realizada pode ser ajustada alterando o sinal da vari√°vel self._koof. Al√©m disso, voc√™ pode perceber que, como resultado da pr√≥xima se√ß√£o de c√≥digo, pode aparecer um valor de pot√™ncia superior a 100, mas, no meu programa, esses casos s√£o processados ‚Äã‚Äãposteriormente posteriormente.Seu valor absoluto afeta a rapidez com que o rob√¥ tenta se alinhar √† linha. Devido ao fato de que em um motor a a√ß√£o de controle √© subtra√≠da da velocidade base e, por outro - √© adicionado, √© executada uma curva ao se desviar do curso. A dire√ß√£o na qual a revers√£o ser√° realizada pode ser ajustada alterando o sinal da vari√°vel self._koof. Al√©m disso, voc√™ pode perceber que, como resultado da pr√≥xima se√ß√£o de c√≥digo, pode aparecer um valor de pot√™ncia superior a 100, mas no meu programa esses casos s√£o processados ‚Äã‚Äãadicionalmente posteriormente.em que a revers√£o ser√° feita, voc√™ pode ajustar alterando o sinal da vari√°vel self._koof. Al√©m disso, voc√™ pode perceber que, como resultado da pr√≥xima se√ß√£o de c√≥digo, pode aparecer um valor de pot√™ncia superior a 100, mas no meu programa esses casos s√£o processados ‚Äã‚Äãadicionalmente posteriormente.em que a revers√£o ser√° feita, voc√™ pode ajustar alterando o sinal da vari√°vel self._koof. Al√©m disso, voc√™ pode perceber que, como resultado da pr√≥xima se√ß√£o de c√≥digo, pode aparecer um valor de pot√™ncia superior a 100, mas, no meu programa, esses casos s√£o processados ‚Äã‚Äãposteriormente posteriormente.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#if lineFound:</span><font></font>
leftSpeed = round(self.base_speed + error*self.koof)<font></font>
rightSpeed = round(self.base_speed - error*self.koof)<font></font>
</code></pre><br>
<h2><font color="#4d7f95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tendo testado o programa resultante, posso dizer que o principal momento dif√≠cil na configura√ß√£o do programa √© a calibra√ß√£o do algoritmo para os recursos de ilumina√ß√£o. </font><font style="vertical-align: inherit;">Como a fase de cria√ß√£o do artigo coincidiu com o auto-isolamento declarado, tive que criar um v√≠deo com uma demonstra√ß√£o do trabalho em uma pequena sala. </font><font style="vertical-align: inherit;">Isso colocou as seguintes dificuldades em mim:</font></font><br>
<br>
<ul>
<li> -,    ,    (   ,     ),        .        ,    ,         ,      .      ,     , ,            ,              </li>
<li> -,       ‚Äî    ,   ,         </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar de ambos os problemas estarem ausentes nas condi√ß√µes de competi√ß√µes reais, tomarei medidas para garantir que o trabalho do programa dependa minimamente de fatores externos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, no futuro, est√° planejado continuar o trabalho de implementa√ß√£o de algoritmos usando m√©todos de vis√£o computacional, criando software capaz de passar pelos elementos restantes de autonomia descritos na primeira parte do artigo (captura aut√¥noma de farol, movimento por um caminho complexo). Est√° planejado expandir a funcionalidade do rob√¥, adicionando sensores adicionais: tel√™metro, aceler√¥metro girosc√≥pio, b√∫ssola. Apesar de a publica√ß√£o deste artigo encerrar meu trabalho no projeto como disciplina escolar obrigat√≥ria, pretendo continuar descrevendo aqui os est√°gios adicionais de desenvolvimento. Portanto, gostaria de receber coment√°rios sobre este trabalho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de implementar todas as etapas destinadas a solucionar os problemas do projeto, √© seguro dizer que o uso de algoritmos de vis√£o computacional, com toda a sua relativa complexidade na programa√ß√£o e depura√ß√£o, proporciona o maior ganho no est√°gio das pr√≥prias competi√ß√µes. Com as pequenas dimens√µes da c√¢mera, ele tem um enorme potencial em termos de desenvolvimento de software, porque a c√¢mera permite substituir v√°rios sensores "tradicionais" de uma s√≥ vez, ao mesmo tempo em que recebe incrivelmente mais informa√ß√µes do mundo exterior. Foi poss√≠vel realizar o objetivo do projeto - criar um programa que utiliza a vis√£o computacional para resolver o problema da navega√ß√£o aut√¥noma do rob√¥ nas condi√ß√µes da competi√ß√£o ‚ÄúCopa RTK‚Äù, al√©m de descrever o processo de cria√ß√£o do programa e os principais est√°gios do processamento de imagens.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu disse anteriormente, n√£o foi poss√≠vel recriar a trajet√≥ria complexa da linha da casa, no entanto, e este exemplo mostra como o algoritmo realiza curvas. </font><font style="vertical-align: inherit;">A espessura da linha aqui corresponde √† de acordo com os regulamentos, e a maior parte das curvas reflete aproximadamente a curvatura da rota√ß√£o em 90 graus no pol√≠gono:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/YmHk3f-qQ5E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver o c√≥digo do programa, bem como monitorar trabalhos futuros no projeto, no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meu github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou aqui, se eu continuar.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt497286/index.html">Ludum Dare: lista de verifica√ß√£o uma semana antes do in√≠cio</a></li>
<li><a href="../pt497288/index.html">Plafon decorativo Feron AL5000</a></li>
<li><a href="../pt497290/index.html">Melhorando o desempenho usando o cache uop no Sandy Bridge +</a></li>
<li><a href="../pt497292/index.html">Pilha de tecnologia Shiro Games</a></li>
<li><a href="../pt497296/index.html">Erros populares em ingl√™s entre profissionais de TI. Parte 2: Pron√∫ncia</a></li>
<li><a href="../pt497304/index.html">Intercepter-NG 2.5 lan√ßado para Android</a></li>
<li><a href="../pt497306/index.html">Falsifica√ß√£o de DLL (seq√ºestro de DLL)</a></li>
<li><a href="../pt497308/index.html">A intelig√™ncia artificial pode fazer arte?</a></li>
<li><a href="../pt497310/index.html">Redes morfol√≥gicas bipolares: um neur√¥nio sem multiplica√ß√£o</a></li>
<li><a href="../pt497312/index.html">Pergunta sobre o CAN FD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>