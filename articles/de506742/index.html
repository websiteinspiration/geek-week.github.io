<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👧 🧝🏿 🧝🏻 Warum sollte die Mitte des Pixels bei (0,5; 0,5) liegen? 👩🏿‍🏭 👰🏼 👰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn heute die Strahlverfolgung vom „Auge“ der Kamera aus immer beliebter wird, muss diese Lektion erneut gelernt werden: Der Code wird besser und das...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Warum sollte die Mitte des Pixels bei (0,5; 0,5) liegen?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506742/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn heute die Strahlverfolgung vom „Auge“ der Kamera aus immer beliebter wird, muss diese Lektion erneut gelernt werden: Der Code wird besser und das Leben ist einfacher, wenn sich die Mitte des Pixels an der Koordinate befindet (0,5; 0,5). Wenn Sie sicher sind, dass Sie alles richtig machen, fahren Sie auf die gleiche Weise fort: Für Sie ist der Artikel nichts Neues. Lesen Sie, je besser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gefühl, die Mitte des Pixels bei (0,5; 0,5) zu platzieren, wurde zuerst (zumindest für mich) durch Paul Huckberts niedlichen Kurzartikel "Was sind Pixelkoordinaten?" Erklärt. aus dem 1990 erschienenen Buch </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphics Gems</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , S. 246-248.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute ist dieser Artikel schwer zu finden, daher werde ich kurz auf seine Essenz eingehen. Angenommen, wir haben einen Bildschirm mit einer Breite und Höhe von 1000. Betrachten wir nur die X-Achse. Es kann verlockend sein, der Mitte des am weitesten links liegenden Pixels in einer Reihe 0,0, der Mitte des nächsten Pixels 1,0 und so weiter zuzuweisen. Sie können sogar die Rundung verwenden, bei der die Gleitkommakoordinaten 73.6 und 74.4 in die Mitte 74.0 übertragen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es lohnt sich jedoch zu überlegen. Bei diesem Vergleich liegt die linke Kante bei der Koordinate -0,5 und die rechte Kante bei 999,5. Es ist unpraktisch, mit einem solchen System zu arbeiten. Schlimmer noch, wenn unterschiedliche Operatoren die Werte der Koordinaten der Pixel mögen </font></font><code>abs()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font><font style="vertical-align: inherit;">auf diese angewendet werden, </font></font><code>mod()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann ein solcher Vergleich zu unbedeutenden Fehlern an den Kanten führen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist einfacher, mit einem Intervall von 0,0 bis 1000,0 zu arbeiten, in dem die Mitte jedes Pixels einen Bruchteil von 0,5 hat. Zum Beispiel hat das ganzzahlige Pixel 43 dann einen schönen Wertebereich der Werte seiner Subpixel von 43,0 bis 43,99999. Hier ist die Zeichnung aus Pauls Artikel:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcf/16a/79e/fcf16a79ea636a04f37b2259a034a954.png"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL hatte die</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mitte des Pixels immer einen Bruchteil (0,5; 0,5). DirectX hat sich zunächst nicht daran gehalten, aber in DirectX 10 hat es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Verstand übernommen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Operationen zum Konvertieren von Ganzzahlkoordinaten in die Koordinaten eines Gleitkommapixels sind das Addieren von 0,5; Float in Integer umzuwandeln ist ausreichend </font></font><code>floor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber das ist eine lange Geschichte. Immerhin machen es heute alle, oder? Ich bin zu diesem Thema zurückgekehrt, weil ich in meinen Beispielen auf (Pseudo-) Code zum Generieren der Richtung einer perspektivischen Kamera für die Strahlverfolgung gestoßen bin:</font></font><br>
<br>
<pre><code class="cpp hljs"> float3 ray_origin = camera-&gt;eye;<font></font>
 float2 d = <span class="hljs-number">2.0</span> * <font></font>
     ( float2(idx.x, idx.y) / <font></font>
       float2(width, height) ) - <span class="hljs-number">1.0</span>;<font></font>
 float3 ray_direction =<font></font>
     d.x*camera-&gt;U + d.y*camera-&gt;V + camera-&gt;W;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vektor </font><font style="vertical-align: inherit;">ist die ganzzahlige Position des Pixels, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Breite</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Höhe</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind die Bildschirmauflösung. Der Vektor </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird berechnet und verwendet, um einen Vektor in den Weltraum unter Verwendung der Multiplikation von zwei Vektoren, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , zu erzeugen </font><font style="vertical-align: inherit;">. Dann wird der Vektor </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzugefügt </font><font style="vertical-align: inherit;">- die Richtung der Kamera im Weltraum. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bezeichnen die positiven Richtungen der </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Achse </font><font style="vertical-align: inherit;">der Anzeigeebene in einem Abstand </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vom Auge. Im obigen Code sieht alles schön und symmetrisch aus. so ist es zum größten Teil.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8d/cb1/563/d8dcb1563f2b9b2c440d51ca0e0aa5fe.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Vektor </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muss ein Wertepaar von -1,0 bis 1,0 in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normalisierten Gerätekoordinaten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Normalized Device Coordinates, NDC) für Punkte auf dem Bildschirm bezeichnen. Der </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code schlägt hier jedoch fehl</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fahren wir mit unserem Beispiel fort: Die Position der ganzzahligen Pixel (0; 0) wird auf (-1,0; -1,0) übertragen. Das scheint gut zu sein, oder? Die maximale ganzzahlige Pixelposition ist jedoch (999; 999), was (0,998; 0,998) entspricht. Die Gesamtdifferenz von 0,002 ist darauf zurückzuführen, dass diese falsche Überlagerung das gesamte Bild um ein halbes Pixel verschiebt. Diese Pixelmitten sollten von jeder Kante 0,001 betragen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite Codezeile sollte folgendermaßen aussehen:</font></font><br>
<br>
<pre><code class="cpp hljs">    float2 d = <span class="hljs-number">2.0</span> *<font></font>
        ( ( float2(idx.x, idx.y) + float2(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>) ) / <font></font>
            float2(width, height) ) - <span class="hljs-number">1.0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann erhalten wir das richtige NDC-Intervall für die Zentren der Pixel von -0,999 bis 0,999. Wenn wir stattdessen die Winkelwerte mit einem Gleitkomma (0,0; 0,0) und (1000,0; 1000,0) auf diese Weise konvertieren (wir addieren nicht 0,5, da wir bereits mit einem Gleitkomma arbeiten), dann erhalten wir das volle NDC-Intervall von -1,0 bis 1,0 von Kante zu Kante; Dies beweist die Richtigkeit des Codes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn 0,5 Sie stört und Ihnen die Symmetrie fehlt, können Sie zufällige Werte innerhalb eines Pixels erzeugen, d. H. Wenn Sie eine Glättung durchführen, indem Sie zufällige Strahlen durch jedes Pixel senden, können Sie diese elegante Formulierung verwenden:</font></font><br>
<br>
<pre><code class="cpp hljs">    float2 d = <span class="hljs-number">2.0</span> *<font></font>
        ( ( float2(idx.x, idx.y) + <font></font>
                float2( rand(seed), rand(seed) ) ) /<font></font>
            float2(width, height) ) - <span class="hljs-number">1.0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir addieren einfach eine Zufallszahl aus dem Intervall [0.0,1.0) zu jedem ganzzahligen Wert der Pixelposition. </font><font style="vertical-align: inherit;">Der Durchschnitt dieses Zufallswerts beträgt 0,5, dh die Mitte des Pixels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also werde ich kurz sagen: Sei vorsichtig. </font><font style="vertical-align: inherit;">Implementieren Sie das halbe Pixel korrekt. </font><font style="vertical-align: inherit;">Nach meiner Erfahrung treten solche Halbpixelfehler im Laufe der Jahre meiner Arbeit an Rasterizer-Code in Autodesk an vielen verschiedenen Stellen (Kameras, Texturabtastung usw.) auf. </font><font style="vertical-align: inherit;">Weiter unten am Fließband bringen sie nichts als Schmerz. </font><font style="vertical-align: inherit;">Wenn wir nicht aufpassen, können sie auch in Raytracern auftreten.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de506730/index.html">Schnauben oder Suricata. Teil 1: Wählen Sie ein kostenloses IDS / IPS, um das Unternehmensnetzwerk zu schützen</a></li>
<li><a href="../de506732/index.html">Organisationsweite Wiederverwendung von UI-Komponenten</a></li>
<li><a href="../de506734/index.html">Übergangsberechnungen in elektrischen Netzen</a></li>
<li><a href="../de506736/index.html">Wie viele Methoden sollte eine Klasse haben?</a></li>
<li><a href="../de506740/index.html">So verwenden Sie Microsoft SQL für Berichte in Power BI. Am Beispiel von Mindbox</a></li>
<li><a href="../de506748/index.html">Wer hat das Umsatzwachstum unter Quarantäne gestellt?</a></li>
<li><a href="../de506758/index.html">Products organisierte eine Konferenz nach dem Open-Source-Prinzip, und seit 10 Jahren ist jeder Teilnehmer Organisator</a></li>
<li><a href="../de506762/index.html">Sicherheitswoche 25: Das rekordverdächtige Patch-Set von Microsoft</a></li>
<li><a href="../de506766/index.html">Wir lehnen kostenpflichtige RPA-Plattformen ab und basieren auf OpenSource (OpenRPA)</a></li>
<li><a href="../de506772/index.html">Erstellen oder ablehnen - ein Test der Ideen für Stärke</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>