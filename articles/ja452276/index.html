<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥢 👂🏾 ❎ Dropboxクライアントリバースエンジニアリング 👋🏽 👨🏽‍🍳 ❎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL、DR。この記事では、Dropboxクライアントの逆の開発、Pythonでのクライアントの難読化と逆コンパイルのメカニズムのハッキング、および通常モードでは非表示になっているデバッグ機能をアクティブにするためのプログラムの変更について説明しています。適切なコードと指示のみに関心がある場合は、最後...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Dropboxクライアントリバースエンジニアリング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452276/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL、DR。</font><font style="vertical-align: inherit;">この記事では、Dropboxクライアントの逆の開発、Pythonでのクライアントの難読化と逆コンパイルのメカニズムのハッキング、および通常モードでは非表示になっているデバッグ機能をアクティブにするためのプログラムの変更について説明しています。</font><font style="vertical-align: inherit;">適切なコードと指示のみに関心がある場合は、最後までスクロールしてください。</font><font style="vertical-align: inherit;">この記事の執筆時点では、コードはCPython 3.6インタープリターに基づく最新のDropboxバージョンと互換性があります。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dropboxは、到着した瞬間から私を魅了してきました。コンセプトはまだ一見シンプルです。これがフォルダです。そこにファイルを置きます。同期されます。別のデバイスに移動しています。再度同期されます。フォルダとファイルもここに表示されます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
隠された背景の仕事の量は本当に素晴らしいです。まず、メインデスクトップオペレーティングシステム（OS X、Linux、Windows）向けのクロスプラットフォームアプリケーションを作成および維持するときに対処する必要があるすべての問題が解消されません。これに、さまざまなWebブラウザー、さまざまなモバイルオペレーティングシステムのサポートを追加します。また、クライアント側についてのみ説明します。また、Dropboxバックエンドにも興味があります。これにより、5億人のユーザーが作成した非常に重いワークロードで、このようなスケーラビリティと低遅延を実現できました。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの理由から、私は常にDropboxが内部で何をするか、そしてそれが長年にわたってどのように進化してきたのかを見るのが好きでした。約8年前、ホテルにいる間に未知のトラフィックのブロードキャストに気づいたとき、私は最初にDropboxクライアントが実際にどのように機能するかを調べようとしました。調査の結果、これはLanSyncと呼ばれるDropbox機能の一部であることがわかりました。これにより、同じLAN上のDropboxホストが同じファイルにアクセスできる場合に、より高速に同期できます。しかし、プロトコルは文書化されていなかったので、もっと知りたいと思いました。そこで、もう少し詳しく見てみることにしたので、プログラム全体のリバースエンジニアリングを行いました。この研究は決して出版されなかったが、私は時々何人かの人々とメモを共有した。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anvil Venturesを開いたとき、Chrisと私は、ドキュメントの保存、共有、およびコラボレーションのための多数のツールを高く評価しました。</font><font style="vertical-align: inherit;">それらの1つは明らかにDropboxでした。私にとってこれは、古い研究を掘り下げて、クライアントの現在のバージョンでそれらをチェックするもう1つの理由です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解読と解読</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初にLinux用のクライアントをダウンロードしましたが、それがPythonで書かれていることがすぐにわかりました。 Pythonライセンスはかなり寛容であるため、Pythonインタープリターを商用ソフトウェアなどの他の依存関係とともに簡単に変更および配布できます。次に、クライアントの動作を理解するためにリバースエンジニアリングを開始しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当時、バイトコードを含むファイルは、実行可能バイナリと結合されたZIPファイルでした。メインバイナリは、Pythonインポートメカニズムをキャプチャすることによってロードされた、変更されたPythonインタープリターでした。後続の各インポート呼び出しは、ZIPファイルの解析によりこのバイナリにリダイレクトされました。もちろん、バイナリからこのZIPを抽出するのは簡単です。たとえば、便利な</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">binwalk</font></a><font style="vertical-align: inherit;">ツール</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのバイトコンパイルされた.pycファイルでそれを取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、.pycファイルの暗号化を解除することはできませんでしたが、最終的には標準のPythonライブラリの一般的なオブジェクトを取得して再コンパイルし、内部にバックドアを挿入しました。</font><font style="vertical-align: inherit;">Dropboxクライアントがこのオブジェクトをロードしているので、作業中のインタープリターで任意のPythonコードを簡単に実行できました。</font><font style="vertical-align: inherit;">私は自分でこれを発見</font><font style="vertical-align: inherit;">しましたが、2012年のHack.luに関する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレゼンテーション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、Florian LedaとNicolas Raffが同じ方法を使用しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dropboxで実行中のコードを探索および操作する機能により、多くのことが明らかになりました。</font><font style="vertical-align: inherit;">コードはいくつかの保護トリックを使用して、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">コードオブジェクトの</font></a><font style="vertical-align: inherit;">ダンプを困難にしました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、通常のCPythonインタープリターでは、関数を表すコンパイル済みバイトコードを簡単に復元できます。</font><font style="vertical-align: inherit;">簡単な例：</font></font><br>
<br>
<pre><code class="python hljs">    &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>(<span class="hljs-params">i=<span class="hljs-number">0</span></span>):</span>
    ...     <span class="hljs-keyword">return</span> i * i<font></font>
    ...<font></font>
    &gt;&gt;&gt; f.__code__<font></font>
    &lt;code object f at <span class="hljs-number">0x109deb540</span>, file <span class="hljs-string">"&lt;stdin&gt;"</span>, line <span class="hljs-number">1</span>&gt;<font></font>
    &gt;&gt;&gt; f.__code__.co_code<font></font>
    <span class="hljs-string">b'|\x00|\x00\x14\x00S\x00'</span>
    &gt;&gt;&gt; <span class="hljs-keyword">import</span> dis<font></font>
    &gt;&gt;&gt; dis.dis(f)<font></font>
      <span class="hljs-number">2</span>           <span class="hljs-number">0</span> LOAD_FAST                <span class="hljs-number">0</span> (i)
                  <span class="hljs-number">2</span> LOAD_FAST                <span class="hljs-number">0</span> (i)
                  <span class="hljs-number">4</span> BINARY_MULTIPLY
                  <span class="hljs-number">6</span> RETURN_VALUE<font></font>
    &gt;&gt;&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objects / codeobject.cの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイルされたバージョンで</font><i><font style="vertical-align: inherit;">は、</font></i><font style="vertical-align: inherit;">プロパティは</font></font><code>co_code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開いているリストから削除されました。このメンバーリストは通常​​、次のようになります。</font></font><br>
<br>
<pre><code class="python hljs">    static PyMemberDef code_memberlist[] = {<font></font>
    ...<font></font>
        {<span class="hljs-string">"co_flags"</span>,        T_INT,          OFF(co_flags),          READONLY},<font></font>
        {<span class="hljs-string">"co_code"</span>,         T_OBJECT,       OFF(co_code),           READONLY},<font></font>
        {<span class="hljs-string">"co_consts"</span>,       T_OBJECT,       OFF(co_consts),         READONLY},<font></font>
    ...<font></font>
    };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロパティ</font></font><code>co_code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">消えると、</font><font style="vertical-align: inherit;">これらのコードオブジェクトをダンプできなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、標準の</font><font style="vertical-align: inherit;">Python </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆アセンブラー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの他のライブラリーは削除されました</font><font style="vertical-align: inherit;">。結局、コードオブジェクトをファイルにダンプすることはできましたが、それでも逆コンパイルできませんでした。 Dropboxインタープリターで使用されるオペコードがPythonの標準のオペコードと一致しないことに気づくまでにしばらく時間がかかりました。したがって、コードオブジェクトを元のPythonバイトコードに書き戻すには、新しいオペコードを理解する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプションの1つ- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロードキャストオペコード</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（オペコードの再マッピング）。私の知る限り、この手法はリッチスミスによって開発され、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defcon 18で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">導入されました</font><font style="vertical-align: inherit;">。そのスピーチで、彼は楽器も見せました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyREtic</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、メモリ内のPythonバイトコードをリバースエンジニアリングします。 pyREticコードはサポートされていないようで、ツールは「古い」Python 2.xバイナリをターゲットにしています。リッチが考案したテクニックに慣れるために、彼のパフォーマンスを見ることを強くお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
opcode変換メソッドは、標準Pythonライブラリのすべてのコードオブジェクトを取得し、それらをDropboxバイナリから抽出されたオブジェクトと比較します。たとえば</font><font style="vertical-align: inherit;">、標準ライブラリにある</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashlib.pyc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.pycの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトをコード</font><font style="vertical-align: inherit;">化します。</font></font><code>0x43</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、オペコードが解読された</font><font style="vertical-align: inherit;">オペコードに</font><font style="vertical-align: inherit;">対応する</font><font style="vertical-align: inherit;">場合</font></font><code>0x21</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コードオブジェクトを上書きするための変換テーブルを徐々に作成できます。次に、これらのコードオブジェクトをPythonデコンパイラに渡すことができます。ダンプを作成するには、正しいオブジェクトを持つ正しいインタープリターが必要</font></font><code>co_code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のオプションは、シリアル化フォーマットをハックすることです。 Pythonでは、シリアル化は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マーシャリング</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><font style="vertical-align: inherit;">ます。難読化されたファイルを通常の方法で逆シリアル化しても機能しませんでした。 IDA Proでバイナリをリバースエンジニアリングするときに、復号化の手順を発見しました。私の知る限り、このテーマについて何かを最初に公開したのは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼のブログの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハーゲン・フリッチ</font><font style="vertical-align: inherit;">でした。そこで、Dropboxの新しいバージョンでの変更について言及しています（DropboxがPython 2.5からPython 2.7に切り替わったとき）。アルゴリズムは次のように機能します。</font></font><br>
<br>
<ul>
<li>  pyc-      .    ,     CPython.<br>
</li>
<li>   ,    .  <code>True</code>, <code>False</code>, <code>floats</code>  .&nbsp;.,   &nbsp;—      Python, <code>code object</code>.<br>
</li>
<li>  <code>code object</code>        .<br>
</li>
<li>  &nbsp;— 32-  <code>random</code>.<br>
</li>
<li>&nbsp;— 32-  <code>length</code>,     .<br>
</li>
<li>  <code>rand</code>  <code>length</code>     RNG,   <code>seed</code>.<br>
</li>
<li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,    32- .<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの4つの値を組み合わせると、シリアル化されたデータの暗号化キーが提供されます。</font><font style="vertical-align: inherit;">暗号化アルゴリズムは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiny暗号化アルゴリズム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してデータを復号化します</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のコードでは、Pythonの非整列化手順を最初から作成しました。</font><font style="vertical-align: inherit;">コードオブジェクトを復号化する部分は、以下のフラグメントのようになります。</font><font style="vertical-align: inherit;">このメソッドは再帰的に呼び出す必要があることに注意してください。</font><font style="vertical-align: inherit;">pycファイルの最上位オブジェクトは、それ自体がクラス、関数、またはラムダのコードオブジェクトを含むコードオブジェクトです。</font><font style="vertical-align: inherit;">次に、メソッド、関数、またはラムダを含めることもできます。</font><font style="vertical-align: inherit;">これらはすべて階層の下のコードオブジェクトです。</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_code</span>(<span class="hljs-params">self</span>):</span><font></font>
        rand = self.r_long()<font></font>
        length = self.r_long()<font></font>
    <font></font>
        seed = rng(rand, length)<font></font>
        mt = MT19937(seed)<font></font>
        key = []<font></font>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>):<font></font>
            key.append(mt.extract_number())<font></font>
    <font></font>
        <span class="hljs-comment"># take care of padding for size calculation</span>
        sz = (length + <span class="hljs-number">15</span>) &amp; ~<span class="hljs-number">0xf</span>
        words = sz / <span class="hljs-number">4</span><font></font>
    <font></font>
        <span class="hljs-comment"># convert data to list of dwords</span><font></font>
        buf = self._read(sz)<font></font>
        data = list(struct.unpack(<span class="hljs-string">"&lt;%dL"</span> % words, buf))<font></font>
    <font></font>
        <span class="hljs-comment"># decrypt and convert back to stream of bytes</span><font></font>
        data = tea.tea_decipher(data, key)<font></font>
        data = struct.pack(<span class="hljs-string">"&lt;%dL"</span> % words, *data)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードオブジェクトを復号化する機能は、プロシージャを逆シリアル化した後、実際のバイトコードを書き換える必要があることを意味します。コードオブジェクトには、行番号、定数、およびその他の情報が含まれています。実際のバイトコードはオブジェクト内にあります</font></font><code>co_code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。オペコード変換テーブルを作成したとき、難読化されたDropbox値を標準のPython 3.6の同等のものに置き換えるだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、コードオブジェクトは通常のPython 3.6形式になり、逆コンパイラに渡すことができます。</font><font style="vertical-align: inherit;">R. Bernsteinの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uncompyle6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクト</font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">おかげで、Pythonデ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">コンパイラー</font></a><font style="vertical-align: inherit;">の品質は大幅に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">向上し</font></a><font style="vertical-align: inherit;">ました</font><font style="vertical-align: inherit;">。逆コンパイルによりかなり良い結果が得られました。私はできる限り、Dropboxクライアントの現在のバージョンを逆コンパイルするツールにすべてをまとめることができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを複製すると</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と指示に従ってください。結果は次のようになります。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    __main__-情報-正常に逆コンパイルされたドロップボックス/クライアント/機能/ browse_search / __ init __。pyc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    __main__-情報-_bootstrap_overrides.pycの復号化、パッチ適用、および逆コンパイル</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    __main__-情報-正常に逆コンパイルされた_bootstrap_overrides.pyc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    __main__-情報-3713ファイルを処理しました（3591は正常に逆コンパイルされ、122は失敗しました）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    opcodemap-警告-強制上書きが設定されていないため、オペコードマップを書き込みません</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり</font></font><code>out/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Dropboxのソースコードの逆コンパイルバージョンを</font><font style="vertical-align: inherit;">含むディレクトリ</font><font style="vertical-align: inherit;">が作成されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dropboxトレースを有効にする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オープンソースで、何か面白いものを探し始めたところ、次の断片が私の注目を集めました。</font><font style="vertical-align: inherit;">トレースハンドラーは</font></font><code>out/dropbox/client/high_trace.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アセンブリが凍結</font></font><code>1430</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さ</font><font style="vertical-align: inherit;">れて</font><font style="vertical-align: inherit;">いないか、機能を制限するマジックキーまたはCookie </font><font style="vertical-align: inherit;">が行に</font><font style="vertical-align: inherit;">インストールさ</font><font style="vertical-align: inherit;">れて</font><font style="vertical-align: inherit;">いない場合にのみインストールさ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-number">1424</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install_global_trace_handlers</span>(<span class="hljs-params">flags=None, args=None</span>):</span>
    <span class="hljs-number">1425</span>     <span class="hljs-keyword">global</span> _tracing_initialized
    <span class="hljs-number">1426</span>     <span class="hljs-keyword">if</span> _tracing_initialized:
    <span class="hljs-number">1427</span>         TRACE(<span class="hljs-string">'!! Already enabled tracing system'</span>)
    <span class="hljs-number">1428</span>         <span class="hljs-keyword">return</span>
    <span class="hljs-number">1429</span>     _tracing_initialized = <span class="hljs-literal">True</span>
    <span class="hljs-number">1430</span>     <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> build_number.is_frozen() <span class="hljs-keyword">or</span> magic_trace_key_is_set() <span class="hljs-keyword">or</span> limited_support_cookie_is_set():
    <span class="hljs-number">1431</span>         <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.getenv(<span class="hljs-string">'DBNOLOCALTRACE'</span>):
    <span class="hljs-number">1432</span>             add_trace_handler(db_thread(LtraceThread)().trace)
    <span class="hljs-number">1433</span>         <span class="hljs-keyword">if</span> os.getenv(<span class="hljs-string">'DBTRACEFILE'</span>):
    <span class="hljs-number">1434</span>             <span class="hljs-keyword">pass</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
凍結されたビルドについて言及することは、Dropboxの内部デバッグビルドを指します。</font><font style="vertical-align: inherit;">そして、同じファイルの少し上にそのような行を見つけることができます：</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-number">272</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_time_limited_cookie</span>(<span class="hljs-params">cookie</span>):</span>
    <span class="hljs-number">273</span>     <span class="hljs-keyword">try</span>:
    <span class="hljs-number">274</span>         <span class="hljs-keyword">try</span>:
    <span class="hljs-number">275</span>             t_when = int(cookie[:<span class="hljs-number">8</span>], <span class="hljs-number">16</span>) ^ <span class="hljs-number">1686035233</span>
    <span class="hljs-number">276</span>         <span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-number">277</span>             <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-number">278</span>         <span class="hljs-keyword">else</span>:
    <span class="hljs-number">279</span>             <span class="hljs-keyword">if</span> abs(time.time() - t_when) &lt; SECONDS_PER_DAY * <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> md5(make_bytes(cookie[:<span class="hljs-number">8</span>]) + <span class="hljs-string">b'traceme'</span>).hexdigest()[:<span class="hljs-number">6</span>] == cookie[<span class="hljs-number">8</span>:]:
    <span class="hljs-number">280</span>                 <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-number">281</span>     <span class="hljs-keyword">except</span> Exception:
    <span class="hljs-number">282</span>         report_exception()
    <span class="hljs-number">283</span>
    <span class="hljs-number">284</span>     <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-number">285</span>
    <span class="hljs-number">286</span>
    <span class="hljs-number">287</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">limited_support_cookie_is_set</span>():</span>
    <span class="hljs-number">288</span>     dbdev = os.getenv(<span class="hljs-string">'DBDEV'</span>)
    <span class="hljs-number">289</span>     <span class="hljs-keyword">return</span> dbdev <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> is_valid_time_limited_cookie(dbdev)<font></font>
    build_number/environment.py</code></pre><br><font style="vertical-align: inherit;"></font><code>limited_support_cookie_is_set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行</font><font style="vertical-align: inherit;">
のメソッドからわかる</font></font><code>287</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ように、名前付きの環境変数が有効</font></font><code>DBDEV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期間が制限されたCookieに正しく設定され</font><font style="vertical-align: inherit;">ている場合にのみ、トレースが有効になります</font><font style="vertical-align: inherit;">。面白いですね！そして今、私たちはそのような時間制限のあるクッキーを生成する方法を知っています。名前から判断すると、DropboxエンジニアはそのようなCookieを生成し、場合によっては顧客のサポートが必要な場合に一時的にトレースを有効にすることができます。 Dropboxを再起動した後、またはコンピューターを再起動した後、指定されたCookieがまだ存在していても、自動的に期限切れになります。これにより、たとえば、継続的なトレースによるパフォーマンスの低下を防ぐことができると思います。また、Dropboxのリバースエンジニアリングが困難になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、小さなスクリプトでこれらのCookieを常に生成して設定するだけです。</font><font style="vertical-align: inherit;">そんな感じ：</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-comment">#!/usr/bin/env python3</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">output_env</span>(<span class="hljs-params">name, value</span>):</span>
        print(<span class="hljs-string">"%s=%s; export %s"</span> % (name, value, name))<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_time_cookie</span>():</span><font></font>
        t = int(time.time())<font></font>
        c = <span class="hljs-number">1686035233</span>
        s = <span class="hljs-string">"%.8x"</span> % (t ^ c)<font></font>
        h = md5(s.encode(<span class="hljs-string">"utf-8?"</span>) + <span class="hljs-string">b"traceme"</span>).hexdigest()<font></font>
        ret = <span class="hljs-string">"%s%s"</span> % (s, h[:<span class="hljs-number">6</span>])
        <span class="hljs-keyword">return</span> ret<font></font>
    c = generate_time_cookie()<font></font>
    output_env(<span class="hljs-string">"DBDEV"</span>, c)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、時間ベースのCookieが作成されます。</font></font><br>
<br>
<pre><code class="python hljs">    $ python3 setenv.py<font></font>
    DBDEV=<span class="hljs-number">38</span>b28b3f349714; export DBDEV;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、このスクリプトの出力を環境に正しくロードし、Dropboxクライアントを実行します。</font></font><br>
<br>
<pre><code class="python hljs">    $ eval `python3 setenv.py`<font></font>
    $ ~/.dropbox-dist/dropbox-lnx_64<span class="hljs-number">-71.4</span><span class="hljs-number">.108</span>/dropbox</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これには、マルチカラーの書式設定などのトレース出力が含まれます。</font><font style="vertical-align: inherit;">これは、次の未登録クライアントのようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e83/d0a/a4f/e83d0aa4f475709108cb1cfc0cb16d74.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいコードを実装する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは少しおかしいです。</font><font style="vertical-align: inherit;">逆コンパイルされたコードをさらに調査すると、次のことがわかります</font></font><code>out/build_number/environment.pyc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特定のマジックキーがインストールされているかどうかをチェックする機能があります。</font><font style="vertical-align: inherit;">このキーはコードにハードコーディングされていませんが、SHA-256ハッシュと比較されます。</font><font style="vertical-align: inherit;">これが対応するスニペットです。</font></font><br>
<br>
<pre><code class="python hljs">      <span class="hljs-number">1</span> <span class="hljs-keyword">import</span> hashlib, os
      <span class="hljs-number">2</span> <span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional, Text
      <span class="hljs-number">3</span> _MAGIC_TRACE_KEY_IS_SET = <span class="hljs-literal">None</span>
      <span class="hljs-number">4</span>
      <span class="hljs-number">5</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">magic_trace_key_is_set</span>():</span>
      <span class="hljs-number">6</span>     <span class="hljs-keyword">global</span> _MAGIC_TRACE_KEY_IS_SET
      <span class="hljs-number">7</span>     <span class="hljs-keyword">if</span> _MAGIC_TRACE_KEY_IS_SET <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
      <span class="hljs-number">8</span>         dbdev = os.getenv(<span class="hljs-string">'DBDEV'</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">''</span>
      <span class="hljs-number">9</span>         <span class="hljs-keyword">if</span> isinstance(dbdev, Text):
     <span class="hljs-number">10</span>             bytes_dbdev = dbdev.encode(<span class="hljs-string">'ascii'</span>)
     <span class="hljs-number">11</span>         <span class="hljs-keyword">else</span>:
     <span class="hljs-number">12</span>             bytes_dbdev = dbdev
     <span class="hljs-number">13</span>         dbdev_hash = hashlib.sha256(bytes_dbdev).hexdigest()
     <span class="hljs-number">14</span>         _MAGIC_TRACE_KEY_IS_SET = dbdev_hash == <span class="hljs-string">'e27eae61e774b19f4053361e523c771a92e838026da42c60e6b097d9cb2bc825'</span>
     <span class="hljs-number">15</span>     <span class="hljs-keyword">return</span> _MAGIC_TRACE_KEY_IS_SET</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドは、コードのさまざまな場所から複数回呼び出され、マジックトレースキーが設定されているかどうかを確認します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John the Ripperの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブルートフォース</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">SHA-256ハッシュをクラックしようとしました</font><font style="vertical-align: inherit;">が、単純なブルートフォースには時間がかかりすぎ、内容についての推測がなかったため、オプションの数を減らすことができませんでした。 Dropboxでは、開発者は特定のハードコードされた開発キーを使用でき、必要に応じてインストールして、トレースのためにクライアントの「マジックキー」モードをアクティブにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トレース用のこのキーのセットでDropboxを起動する迅速で簡単な方法を見つけたかったので、これは私を困らせました。</font><font style="vertical-align: inherit;">そこで、Dropbox暗号化に従って暗号化されたpycファイルを生成するマーシャリング手順を作成しました。</font><font style="vertical-align: inherit;">したがって、私は自分のコードを入力するか、単に上記のハッシュを置き換えることができました。</font><font style="vertical-align: inherit;">Githubのリポジトリにあるこのコードは、ファイルにあります</font></font><code>patchzip.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その結果、ハッシュはSHA-256ハッシュに置き換えられ</font></font><code>ANVILVENTURES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">次に、コードオブジェクトが再暗号化され、zipに配置されます。ここに、難読化されたすべてのコードが格納されます。</font><font style="vertical-align: inherit;">これにより、次のことが可能になります。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    $ DBDEV = ANVILVENTURES; </font><font style="vertical-align: inherit;">DBDEVのエクスポート。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    $〜/ .dropbox-dist / dropbox-lnx_64-71.4.108 / dropbox</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムトレイのDropboxアイコンを右クリックすると、すべてのデバッグ機能が表示されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/619/c68/385/619c6838574ff7023a0dbdf27b880b2d.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに逆コンパイルされたソース</font></font><code>dropbox/webdebugger/server.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を調査したところ</font><font style="vertical-align: inherit;">、ファイル内</font><font style="vertical-align: inherit;">にという名前のメソッド</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">見つかりました</font></font><code>is_enabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">組み込みのWebデバッガーを有効にする必要があるかどうかを確認しているようです。</font><font style="vertical-align: inherit;">まず最初に、彼は言及された魔法の鍵をチェックします。</font><font style="vertical-align: inherit;">SHA-256ハッシュを置き換えたので、単純に値を設定できます</font></font><code>ANVILVENTURES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">2番目の部分は行に</font></font><code>201</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり</font><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">同じSHA-256ハッシュ</font><font style="vertical-align: inherit;">を持つ</font></font><code>202</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前の環境変数があるかどうか</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">確認します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すでに見てきたように、環境の値は時間制限のあるCookieを設定します。</font></font><code>DB&lt;x&gt;</code><font style="vertical-align: inherit;"></font><code>x</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-number">191</span>     @classmethod
    <span class="hljs-number">192</span>     <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_enabled</span>(<span class="hljs-params">cls</span>):</span>
    <span class="hljs-number">193</span>         <span class="hljs-keyword">if</span> cls._magic_key_set:
    <span class="hljs-number">194</span>             <span class="hljs-keyword">return</span> cls._magic_key_set
    <span class="hljs-number">195</span>         <span class="hljs-keyword">else</span>:
    <span class="hljs-number">196</span>             cls._magic_key_set = <span class="hljs-literal">False</span>
    <span class="hljs-number">197</span>             <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> magic_trace_key_is_set():
    <span class="hljs-number">198</span>                 <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-number">199</span>             <span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> os.environ:
    <span class="hljs-number">200</span>                 <span class="hljs-keyword">if</span> var.startswith(<span class="hljs-string">'DB'</span>):
    <span class="hljs-number">201</span>                     var_hash = hashlib.sha256(make_bytes(var[<span class="hljs-number">2</span>:])).hexdigest()
    <span class="hljs-number">202</span>                     <span class="hljs-keyword">if</span> var_hash == <span class="hljs-string">'5df50a9c69f00ac71f873d02ff14f3b86e39600312c0b603cbb76b8b8a433d3ff0757214287b25fb01'</span> <span class="hljs-keyword">and</span> is_valid_time_limited_cookie(os.environ[var]):
    <span class="hljs-number">203</span>                         cls._magic_key_set = <span class="hljs-literal">True</span>
    <span class="hljs-number">204</span>                         <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-number">205</span>
    <span class="hljs-number">206</span>             <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まったく同じ手法を使用して、このハッシュを以前に使用したSHA-256に置き換え、以前に作成したスクリプト</font></font><code>setenv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を次のように</font><font style="vertical-align: inherit;">変更できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">    $ cat setenv.py<font></font>
    …<font></font>
    c = generate_time_cookie()<font></font>
    output_env(<span class="hljs-string">"DBDEV"</span>, <span class="hljs-string">"ANVILVENTURES"</span>)<font></font>
    output_env(<span class="hljs-string">"DBANVILVENTURES"</span>, c)<font></font>
    $ python3 setenv.py<font></font>
    DBDEV=ANVILVENTURES; export DBDEV;<font></font>
    DBANVILVENTURES=<span class="hljs-number">38</span>b285c4034a67; export DBANVILVENTURES<font></font>
    $ eval `python3 setenv.py`<font></font>
    $ ~/.dropbox-dist/dropbox-lnx_64<span class="hljs-number">-71.4</span><span class="hljs-number">.108</span>/dropbox</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、クライアントを起動すると、新しいTCPポートがリスニング用に開きます。</font><font style="vertical-align: inherit;">環境変数が正しく設定されていないと開きません。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    $ netstat --tcp -lnp | </font><font style="vertical-align: inherit;">grepドロップボックス</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    tcp 0 0 127.0.0.1-00-00242 0.0.0.0:* LISTEN 1517 / dropbox   </font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらにコード内で、ファイル内のWebSocketインターフェイスを見つけることができます</font></font><code>webpdb.pyc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、標準のpython </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pdb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティのラッパーです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">インターフェイスへのアクセスは、このポートのHTTPサーバーを介して行われます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">websocketクライアント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">インストールし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">て試し</font></a><font style="vertical-align: inherit;">て</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">みましょう</font></a><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    $ websocat -t ws：//127.0.0.1：4242 / pdb</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    -返品-</font></font><font></font>
    <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    &gt; /home/gvb/dropbox/webdebugger/webpdb.pyc(101)run（）-&gt;なし</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    &gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （Pdb）from build_number.environment import magic_trace_key_is_set as ms</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （Pdb）ms（）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    本当</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、クライアントに本格的なデバッガーができるようになり、他のすべての点で以前と同じように機能します。</font><font style="vertical-align: inherit;">任意のPythonコードを実行でき、内部のデバッグメニューとトレース機能を有効にすることができました。</font><font style="vertical-align: inherit;">これはすべて、Dropboxクライアントのさらなる分析に大いに役立ちます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、Dropboxをリバースエンジニアリングし、Python 3.6に基づく現在のDropboxクライアントで動作するコード復号化および挿入ツールを作成することに成功しました。</font><font style="vertical-align: inherit;">個々の隠し機能をリバースエンジニアリングしてアクティブにしました。</font><font style="vertical-align: inherit;">明らかに、デバッガーはさらにハッキングに役立ちます。</font><font style="vertical-align: inherit;">特に、decompyle6の短所のために正常に逆コンパイルできないファイルが多数ある場合。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Githubにあり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">そこでの使用方法。</font><font style="vertical-align: inherit;">このリポジトリには、2011年に書かれた私の古いコードも含まれています。</font><font style="vertical-align: inherit;">Python 2.7をベースにした古いバージョンのDropboxを誰かが使用している場合は、いくつかの変更を加えるだけで機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リポジトリには、オペコードをブロードキャストするためのスクリプト、Dropbox環境変数の設定手順、およびzipファイルを変更するために必要なすべてのものが含まれています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のコードをレビューしてくれたAnvil VenturesのBrianに感謝します。このコードの作業は数年続きました。時々、私はそれを更新し、新しいメソッドを導入し、フラグメントを書き直して、Dropboxの新しいバージョンで動作するように復元しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述のように、Pythonアプリケーションのリバースエンジニアリングの優れた出発点は、リッチスミス、フロリアンレドゥー、ニコラスラフ、およびハーゲンフリッチの作品です。特に彼らの仕事は、世界最大のPythonアプリケーションの1つであるDropboxクライアントの逆開発に関連しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R. Bernsteinが率いるuncompyle6プロジェクトのおかげで、Pythonコードの逆コンパイルが大幅に進んだことに注意してください。この逆コンパイラは、多くの異なるPython逆コンパイラをコンパイルおよび改善しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事をレビューしてくれた同僚のブライアン、オースティン、ステファン、クリスにも感謝します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja452264/index.html">マスコットカーアワードのサイトの作り方</a></li>
<li><a href="../ja452266/index.html">サーバーレスラック</a></li>
<li><a href="../ja452268/index.html">C＃WPFアナログWindow.ShowDialog（）またはDispatcherFrameを処理する</a></li>
<li><a href="../ja452270/index.html">Xamarin APIドキュメントが公開されました</a></li>
<li><a href="../ja452272/index.html">滝の下の女の子</a></li>
<li><a href="../ja452278/index.html">Bluetooth LEはそれほど怖くない、またはそれほど努力せずにユーザーエクスペリエンスを向上させる方法</a></li>
<li><a href="../ja452280/index.html">PostgreSQL 11：Postgres 9.6からPostgres 11へのパーティショニングの進化</a></li>
<li><a href="../ja452282/index.html">Elementary、Watson：Voximplantと統合します</a></li>
<li><a href="../ja452284/index.html">eo-learnを使用した土地被覆の分類。パート1</a></li>
<li><a href="../ja452288/index.html">状況：サブスクライバージオデータの違法取引で告発された米国の携帯電話会社</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>