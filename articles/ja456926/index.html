<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✉️ 🦁 🐵 スポーツマスターのやり方 👨🏿‍🚀 🗒️ 💍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは！私たちの店でTシャツ、ボール、スニーカー、その他のスポーツ用品を購入したことのある方は多いと思いますが、技術的な観点からSportmasterを知っている人はほとんどいません。2003年のweb.archive.orgのサンプルの小さなSportmaster 私の名前はDmit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>スポーツマスターのやり方</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/456926/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みなさん、こんにちは！私たちの店でTシャツ、ボール、スニーカー、その他のスポーツ用品を購入したことのある方は多いと思いますが、技術的な観点からSportmasterを知っている人はほとんどいません。</font><i><font style="vertical-align: inherit;">2003年のweb.archive.orgのサンプルの小さなSportmaster</font></i><font style="vertical-align: inherit;"> 
私の名前はDmitryです。私はSportmasterのシニアJava開発者です。今日は、オンラインストアについて、彼がどのような道をたどったのかについてお話したいと思います。あなたは今彼を知っています。私たちがどのように始めたのか、どのように発展したのか、何が起こって何が起きなかったのか、今日の問題について、そして将来の計画についてです。面白い？猫へようこそ！</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/_s/2g/78/_s2g78t3lwucifnjqtiod7yatja.png"></a><br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウェブ上での当社の存在の歴史は、1999年にSportmasterの最初のサイトで始まりました。これは、訪問者用カードと卸売りバイヤー向けの商品のカタログでした。実は同社のオンラインストアは2001年以来の歴史があります。当時、同社にはオンラインプロジェクトを開発するための独自のチームがなく、オンラインストアはいくつかの自作プラットフォームを変更することができました（現在、私たちはいくつも覚えていません）。私たちにとって最初の比較的安定したソリューションは、CMS 1C Bitrixに基づいて、2011年にPHPで次のインテグレーターによって作成されました。このサイトはシンプルであることがわかりました。実際、Bitrixのボックス化された機能が使用され、注文を行うための小さなカスタマイズが行われました。ハードウェアの場合、初期構成には2つのアプリケーションサーバーと1つのデータベースサーバーが含まれていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その間、同社はオンライン販売の分野で、主にビジネスの側面で積極的に独自の能力を築き始めました。これは、言うまでもありませんが、かなり迅速に参入し、開発チームはそのニーズを満たすためにあらゆる意味で急速に成長することを余儀なくされました。 1年も経たないうちに、3つのチームがサイトの開発とサポートにすぐに回答し始めました。インテグレーター自身、当時はわずか数人で構成されていたSportmasterの内部チーム、そしてもう1人の請負業者でした。実際、その外観はインテグレーターがその時、私は人々に必要な能力を提供することができませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当時どんな問題がありましたか？多くの問題がありましたが、最も重要なのはオンラインストアの不安定な運用です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビジネスがなんらかのニュースレターを配信し、その後2000〜2500人がサイトにアクセスしたこと、または今覚えているように、Yandexの広告バナーが私たちを深いノックダウンに導いたという事実からも脱落する可能性があります。もちろん、これは受け入れられないことです。これは、利益を失うだけでなく、会社のイメージでもあるためです。一般的に、何かを変更する必要があることを理解しました。まず、私たちのワークロードを使用した標準的なソリューション（当時は超大規模ではないが、まだ小規模ではない）が機能しないことに気づきました。その後、通常はオンラインで1000人のビジター、ピーク時には2500人、さらに年間2倍の開発計画がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハードウェアの面ですぐに強化されました。2つのアプリケーションサーバーを追加し、2つのデータベースサーバーのクラスターを作成しました。当時のスタックはnginx、MySQL、PHPでした。並行して、現在のソリューションを最適化しようとしました-ボトルネックを検索し、可能な限りすべてを書き直そうとしました。私たちのボトルネックがベースだったので、常に最初に「死ぬ」ので、それを最大限にアンロードすることにしました。選択されたフィルターおよび接続されたキャッシュによる、全文検索およびファセット付きの商品タイルの出力用のスフィンクスを実装しました。そして出来上がり-昨日私たちにとって致命的であることが判明したこれらの負荷は、私たちは簡単に保持し始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに加えて、サイトの技術的な更新を実行したいという枠組みの中で、パイロットが並行して立ち上げられました。これは、根本的に異なるプラットフォームへの移行です。たくさんのアイデアやアイデアがありました-当時、あらゆるものの個人化、個人的な推奨、郵送、割引、その他の便利なものが人気を集めていて、もちろん私たちもこれをすべて使用したいと思っていました。これから、市場で入手できるものを検討し、「かつては高価で、次に冷たい」という原則に基づいて最も高価なプラットフォームを購入しました。実装はインテグレーターの助けを借りて計画されましたが、新しいプラットフォームが新しいプラットフォームで稼働するまで、条件付きで古いIMのサポートとさらなる開発がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、現在のサイトの機能開発の速度は非常に速かったため、当時はオースティンの小売チェーンのオンラインストアであり、ITスポーツマスターチームもサービスを提供していた、小規模でシンプルな新しいeコマースプラットフォームの実装を開始することにしました。その過程で、機能が高度で機能的に洗練されているが、技術的には時代遅れであることを認識し、それを完全に実装する人々を見つけることは大きな問題であることが判明しました。さらに、プロジェクトの開始前に行われたサイジングにより、ハードウェアの要件とライセンスの数が大幅に削減されました-人生ははるかに残酷であることが判明しました。一般的に、私たちは1つのことを理解しました。その上でSportmasterを行うことはありません。そして、プラットフォームへの移行のためのチームはすでに採用の過程にあるので、彼らは独自のソリューションのプロトタイピングを開始することを決めました、新しいプラットフォームに対してビジネスが設定した要件に基づいています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テクノロジスタックは、Java、Spring、Tomcat、ElasticSearch、Hazelcastから選択されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、2014年末までに、完全に自己作成された新しいバージョンのIMが完成し、それを正常に切り替えました。</font><font style="vertical-align: inherit;">彼女はあなたが今日見るサイトの最初のバージョンです。</font><font style="vertical-align: inherit;">当然、今日のバージョンはより機能的で技術的に高度ですが、基本的なプラットフォームは同じです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主な目標</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、大きなオンラインストアについて話すときは、ビジネスだけでなくエンドユーザーにとっても安定しているように、日々の負荷だけでなくピーク時の負荷にも対応する意欲について話しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでの主なアプローチは、水平方向にスケーリングする機能と、さまざまなレベルでのデータキャッシュアプ​​ローチのアプリケーションです。そして今、以前のように、データへのアクセスを最適化することにしました。ただし、通常のページキャッシュは使用できません。一般的に。これはビジネス要件であり、要件は非常に合理的です。サイトのユーザーに誤った価格や誤った製品の在庫状況を示すと、購入の拒否や顧客ロイヤルティの低下につながる可能性が高くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、クライアントが299ルーブルのソックスを15ペア注文したとしても、実際には14ペアと300ルーブルしかないと店で見つけたので、なんとかして生活できます。受け入れ、何であるかを購入し、あなたの魂のこの傷跡を乗り越えてください。しかし、数の不一致が深刻な場合、または特定のサイズを探していた場合-チェッカードショーツの幸せな所有者のレビューを読んでいるときに売り切れてしまった場合、すべてが悲しいです。つまり、満足している（この時点までの）クライアントの損失、およびコールセンターの作業における時間とお金の損失。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ユーザーは常に最新の価格と商品残高の最新データを確認する必要があります。したがって、キャッシュはスマートであり、データベース内のデータがいつ変更されるかを把握しています。キャッシングにはHazelcastを使用します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ちなみに残り物について</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、商品の残留物の深さが非常に小さいことに注意することが重要です。</font><font style="vertical-align: inherit;">そして、非常に多くの注文が（非常に）集荷に行きます。</font><font style="vertical-align: inherit;">したがって、クライアントは通常、適切な店舗で商品を予約し、残高を追跡する必要があります。</font><font style="vertical-align: inherit;">かつてBitrixでは、10ユニットを超える残基は単に無限大と見なされていたため、残基の問題が取り上げられていました。</font><font style="vertical-align: inherit;">つまり、10を超えるすべての値は常に10に等しくなりますが、低い値はすでに計算して興味深いものであり、それらを考慮してサイトにアップロードします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、これを実行することはできなくなったため、15分ごとにすべての店から残り物をダウンロードします。</font><font style="vertical-align: inherit;">また、約500の店舗と、いくつかの地域の倉庫、およびいくつかの小売チェーンがあります。</font><font style="vertical-align: inherit;">そして、これらすべては迅速に更新されなければなりません。</font><font style="vertical-align: inherit;">ここでチェリーは、宅配会社の労働条件がロシア連邦の規模で非常に頻繁に変化するという事実であり、したがって、配送パラメータもロードする必要があります。</font><font style="vertical-align: inherit;">さらに、会社の倉庫への商品の継続的な流れがあるため、倉庫内の商品の数量が変化することが予想されます。</font><font style="vertical-align: inherit;">そのため、再度プルする必要もあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これが商品アイテムID（SKU）の形成方法です。</font><font style="vertical-align: inherit;">約4万、いわゆるカラーモデルの商品があります。</font><font style="vertical-align: inherit;">商品のサイズをさらに拡大すると、約20万SKUが得られます。</font><font style="vertical-align: inherit;">そして、これらすべてのために、500店舗の規模で200,000を更新する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、店舗や倉庫から商品を配送する数万の市や村があります。したがって、1つの製品ページ（都市* SKU）のキャッシュの変動性は、値の100万分の1であることがわかります。私たちのアプローチはこれです。ユーザーが製品のカードを入力すると、商品ユニットの可用性の計算がその場で行われます。ユーザーの地域の宅配業者の仕事を見て、彼らの仕事のスケジュールを見て、配達チェーンを計算し、その期間を検討します。これに加えて、近くの店舗の残留物が並行して分析され、そこから輸送を手配できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてを管理しやすくするために、アプリケーションには非常に高速なキャッシュがいくつかあります。これにより、必要なすべてのデータをIDですばやく取得し、その場で整理できます。宅配便業者も同じです。これらをクラスターにグループ化すると、クラスターは既にデータベースに保存されています。 15分ごとに、これがすべて更新されます。着信要求ごとに、必要なパラメーターを使用して特定の宅配便のクラスターを計算し、それらを集計して、すぐに購入者に渡します-すべて問題ありません。50番目のサイズの緑色のショートパンツがあります。今すぐ近くの3つの店舗でペンで受け取るか、3日間（または自宅まで）向かいの店舗で注文します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モスクワの場合、この状況は不必要に思えるかもしれませんが、地域の場合、これはまったく別の問題です。非常に頻繁に、いくつかの店（おそらく、特別に行く必要もあります）に商品を注文します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、サイトは静的を考慮に入れて毎秒数千のリクエストを受け取り、アプリケーションサーバーへの毎秒500〜1000のリクエストを受け取ります。</font><font style="vertical-align: inherit;">アプリケーションサーバーの数は変更されていませんが、その構成は大幅に増加しています。</font><font style="vertical-align: inherit;">1日あたり平均約3,000,000回のビューが取得されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DDoSがサイトに見つかることがあります。</font><font style="vertical-align: inherit;">同時に、ロシア連邦のボットネットや私たちの親族も攻撃しています。</font><font style="vertical-align: inherit;">昔、メキシコと台湾からボットネットを攻撃しようとするケースがありましたが、現在はそうではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
市場には、DDoSに対するクラウド保護のためのソリューションがいくつかあります。</font><font style="vertical-align: inherit;">ただし、特定のセキュリティポリシーでは、この種のクラウドソリューションを使用できません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今何</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラットフォームソリューションの作成を開始し、チームを垂直方向（一部のサイトと別のサイトを表示）ではなく水平方向に分離し、共通のプラットフォームレイヤーを強調表示して、それをパーツに分割し、その周りにチームを形成します。そして彼らについては、すでにサイトを閉鎖しているだけでなく、外部および内部の両方の会社の顧客を含むだけではありません。したがって、複雑で興味深い作業がたくさんあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかな理由により、この期間の最前列のスタックはそれほど変わっていません。Java、Spring、Tomcat、ElasticSearch、Hazelcastは、まだ私たちのニーズに適しています。</font><font style="vertical-align: inherit;">もう1つは、さまざまなテクノロジーを使用する多くのバックオフィスシステムがサイトの背後に隠れていることです。</font><font style="vertical-align: inherit;">そしてもちろん、リエンジニアリングが進行中です（内部システムへの要求とシステム全体での作業を全体として最適化する必要があるため、ビジネス要件と新しいビジネス機能を忘れないため）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、新機能、ビジュアルコンポーネント、および全体的なユーザーエクスペリエンスの両方の観点から、サイトを改善するための個人的な（またはコメントの）提案を安全に送っていただけます。</font><font style="vertical-align: inherit;">迅速に対応し、すべてを考慮に入れます。</font><font style="vertical-align: inherit;">そして、もしあなたがチームの一員になりたいと思っていて、それをすべて内部から見たければ、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">歓迎し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja456910/index.html">インターネットプロジェクトsecurity.txt-別の.well-knownファイルを知る</a></li>
<li><a href="../ja456912/index.html">2019年にサイトを作る方法</a></li>
<li><a href="../ja456916/index.html">Dockerでのクロスコンパイル。何故なの？</a></li>
<li><a href="../ja456920/index.html">Sony Xperia 1 in Russia-価格と予約注文のボーナス</a></li>
<li><a href="../ja456922/index.html">プロセッサの設計と製造方法：コンピュータアーキテクチャの基本</a></li>
<li><a href="../ja456928/index.html">JMeter-スイステスターナイフ（パート1）</a></li>
<li><a href="../ja456930/index.html">IoTを大衆にもたらす：GeekBrainsとRostelecomによる最初のIoTハッカソンの結果</a></li>
<li><a href="../ja456932/index.html">超近代的なOpenGL。パート1</a></li>
<li><a href="../ja456936/index.html">SwiftUIのアニメーションカード</a></li>
<li><a href="../ja456942/index.html">締め切りの多武装神または分析の広範な使用</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>