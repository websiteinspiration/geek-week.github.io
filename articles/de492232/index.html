<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧖🏾 📓 🚫 Wie Smartcalls zu Voximplant Kit wurden - Rebranding- und Killer-Funktionen 🤱🏿 👨🏿‍🌾 🅰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lange Zeit haben wir ein Update für Smartcalls vorbereitet, einen visuellen Editor für ausgehende Anrufe, und jetzt ist es passiert. Heute werden wir ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie Smartcalls zu Voximplant Kit wurden - Rebranding- und Killer-Funktionen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/492232/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/by/c2/ih/byc2ihl70ggcz-ftm-a4ziskyvo.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lange Zeit haben wir ein Update für Smartcalls vorbereitet, einen visuellen Editor für ausgehende Anrufe, und jetzt ist es passiert. </font><font style="vertical-align: inherit;">Heute werden wir unter dem Schnitt über UI / UX-Änderungen sprechen und unter die Haube des Demo-Modus klettern, um zu zeigen, wie wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JointJS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gezähmt </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">haben</font></a><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was hat sich tatsächlich geändert?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus dem offensichtlichsten - ein neuer Name und eine neue URL, was bedeutet, dass das Voximplant Kit unter dem entsprechenden Link </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voximplant.com/kit verfügbar ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wir haben auch die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registrierungsseite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geändert </font><font style="vertical-align: inherit;">, jetzt ist es so:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/jh/vc/cljhvcpw84_miyo3xcr8tsamgwo.png" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl das Konzept unverändert geblieben ist, hat sich die Produktoberfläche erheblich geändert und ist benutzerfreundlicher geworden. </font><font style="vertical-align: inherit;">Das Hauptmenü wurde nach links verschoben, wodurch das Navigieren in den Blöcken logischer und bequemer wurde.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zr/9y/hf/zr9yhfrpoz4qjawojzkqgdl5kpa.png" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus stehen jetzt die Gruppierung und Sortierung von Skripten und Audioaufnahmen, die Suche nach Zahlen sowie Kampagnenkarten mit kurzen Informationen dazu, einschließlich neuer Indikatoren - die durchschnittliche Dauer eines erfolgreichen Anrufs und der Gesamtbetrag der Ausgaben - zur Verfügung.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/yf/12/kgyf12bkj5jjx_cffukvfnqnk7g.png" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was die Integrationen betrifft: Die benutzerfreundliche Oberfläche hat die E-Mail-Einstellungen aufgerufen, und auf den Registerkarten Dialogflow, SIP, Globale Variablen wurde eine Suche und Sortierung der Dateien nach ID und Host angezeigt.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/wm/dj/srwmdjgvejupi9urypqn1iyglzk.png" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Im Allgemeinen viel Neues und Cooles! </font><font style="vertical-align: inherit;">Lesen Sie mehr über die Änderungen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in unserem Blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Wichtigste ist jedoch der Herausgeber</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Demo-Modus (Spoiler: Dies ist die Hauptkiller-Funktion).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/po/du/7mpoduas-ap0m6lbi-o12g9eyd0.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Echtzeitausführung eines Skripts mit Hervorhebung der beteiligten Blöcke und nach der Ausführung - das Ergebnis eines Aufrufs (Flow and Log), wodurch das Debuggen von Skripten noch einfacher und schneller wird.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_i/vl/0a/_ivl0ayzlmrojpumqdf_knc99ie.png" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können das Video des Demo-Modus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ansehen </font><font style="vertical-align: inherit;">oder es selbst testen, nachdem Sie sich beim </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voximplant Kit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registriert </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">haben</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wie dies alles umgesetzt wird, erfahren Sie im nächsten Abschnitt. </font><font style="vertical-align: inherit;">Neue Funktionen des Editors:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rückgängig machen / wiederholen (1 im Bild unten);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hotkeys (2);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Popup-Menü, in dem Sie die Blöcke und Verknüpfungen mit einem Klick ausrichten, den Maßstab ändern, mit miniMap arbeiten, das Skript auf Vollbild erweitern und auch freigeben (kopieren oder als PNG speichern) können (3);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rechtsklick auf das Kontextmenü;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kopierblöcke - nicht nur innerhalb desselben Skripts, sondern auch zwischen verschiedenen Skripten und sogar (!) verschiedenen Konten;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Block sperren / entsperren - Ein gesperrter Block kann verschoben werden, es ist jedoch NICHT möglich, ihn zu bearbeiten, um unerwünschte Änderungen zu vermeiden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Farbwechsel - visuell können Sie mehrere "verwandte" Blöcke auswählen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suche nach Namen und Inhalten der verwendeten Blöcke;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Block „Interaktives Menü“ - die Möglichkeit, Ports (Antwortoptionen) durch einfaches Ziehen und Ablegen an bestimmten Stellen auszutauschen.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wp/fw/u4/wpfwu4ddvz--h5gd0yqm9ipcfzs.png" alt="Bild"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir enthüllen die Karten</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist Zeit herauszufinden, wie Blockanimationen im Code implementiert sind.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/qo/cz/zoqoczrubc5rvxijm-cshjukoq0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Editor ruft unsere HTTP-API-Methode StartScenarios auf, um das Cloud-Skript auszuführen. </font><font style="vertical-align: inherit;">Die Voximplant-Cloud startet das Skript und gibt es an den Editor media_access_url weiter. </font><font style="vertical-align: inherit;">Von diesem Moment an zieht der Editor jede Sekunde media_access_url und erhält Informationen darüber, wie das Skript als Antwort durch die Blöcke „wandert“. Basierend auf diesen Daten hebt der Editor die erforderlichen Blöcke hervor und animiert die Verbindungen zwischen ihnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Verlauf ist ein JSON-Objekt mit den folgenden Feldern:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitstempel;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idSource - Anfangsblock;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idTarget - letzter Block;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port - Port (es können mehrere Ausgänge von 1 Block vorhanden sein).</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wl/qt/ht/wlqthtjgn0l2bnwfoqophwregpy.png" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mithilfe dieser benutzerdefinierten Variablen und Dienstvariablen versteht das Front-End, an welchen Block es während welcher Tests übergeben wird. </font><font style="vertical-align: inherit;">Wie versteht er das? </font><font style="vertical-align: inherit;">Wenn eine visuelle Konstruktion erfolgt (ein neuer Block wird hinzugefügt), wird ihm sofort eine ID zugewiesen, die dann im Verlauf als idSource / idTarget verwendet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diese Funktionalität zu implementieren, haben wir die JointJS-Bibliothek verwendet, aber es gab selbst geschriebenen Code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit der Hauptmethode selectBlock (). Sie funktioniert wie folgt: Wir gehen das Array des Bewegungsverlaufs (idSource, idTarget) durch und suchen nach der Verbindung zwischen ihnen, sobald wir den Start- und Endpunkt gefunden haben:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> link = <span class="hljs-keyword">this</span>.editor.getTestLink(sourceCell, portId);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn es eine Verbindung zwischen ihnen gibt, animieren wir einen Ball, der entlang der Kommunikationslinie läuft:</font></font><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (link) <span class="hljs-keyword">this</span>.setLinkAnimation(link);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Methode selectBlock () wird nach jeder Aktualisierung von this.testHistory aufgerufen. </font><font style="vertical-align: inherit;">Da mehrere übergebene Blöcke gleichzeitig in this.testHistory eintreffen können, rufen wir selectBlock rekursiv alle 700 ms auf (dies ist die ungefähre Zeit, die für die Animation der Bewegung von Block zu Block aufgewendet wird):</font></font><br>
<br>
<pre><code class="javascript hljs">setTimeout(<span class="hljs-keyword">this</span>.selectBlock, <span class="hljs-number">700</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der gesamte Code für diese Methode lautet wie folgt. </font><font style="vertical-align: inherit;">Beachten Sie die Methoden selectTestBlock und getTestLink, Zeilen 7 und 10 - jetzt werden wir separat darüber sprechen:</font></font><br>
<br>
<div class="oembed"><script type="text/javascript" src="https://gist.github.com/5ffed5b2bbb82d4a3eff6df3f153a1ed.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-31007ea0d3bd9f80540adfbc55afc7bd.css"><div id="gist101791201" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-selectblock-js" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-selectblock-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-selectblock-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-selectblock-js-LC2" class="blob-code blob-code-inner js-file-line">     <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt; </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testHistory </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">length </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-selectblock-js-LC3" class="blob-code blob-code-inner js-file-line">       <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const </font></font></span> <span class="pl-s1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-selectblock-js-LC4" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idTarget</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-selectblock-js-LC5" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idSource</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-selectblock-js-LC6" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">portId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">port</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-selectblock-js-LC7" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">selectTestBlock</span><span class="pl-kos">(</span><span class="pl-s1">targetCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-selectblock-js-LC8" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getCell</span><span class="pl-kos">(</span><span class="pl-s1">sourceCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-selectblock-js-LC9" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">sourceCell</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">targetCell</span><span class="pl-kos">)</span> <span class="pl-kos">{</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-selectblock-js-LC10" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">const</span> <span class="pl-s1">link</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getTestLink</span><span class="pl-kos">(</span><span class="pl-s1">sourceCell</span><span class="pl-kos">,</span> <span class="pl-s1">portId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-selectblock-js-LC11" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-en">setLinkAnimation</span><span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-selectblock-js-LC12" class="blob-code blob-code-inner js-file-line">       <span class="pl-kos">}</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-selectblock-js-LC13" class="blob-code blob-code-inner js-file-line">       <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">historyIndex</span> <span class="pl-c1">+=</span> <span class="pl-c1">1</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-selectblock-js-LC14" class="blob-code blob-code-inner js-file-line">       <span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setTimeout </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700 </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-selectblock-js-LC15" class="blob-code blob-code-inner js-file-line">     <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}}</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-selectblock-js-LC16" class="blob-code blob-code-inner js-file-line">   <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}}</font></font></span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ansicht roh</font></font></a>
        <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        wird von </font><a href=""><font style="vertical-align: inherit;">GitHub</font></a><font style="vertical-align: inherit;"> mit ❤ </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gehostet</font></font></a>
      </div>
    </div>
</div>
</div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeichnen Sie eine Verbindung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Methode getTestLink () hilft beim Herstellen der Verbindung zwischen den Blöcken. Sie basiert auf getConnectedLinks (), einer integrierten JointJS-Methode, die eine Blockeingabe verwendet und ein Array von Links zurückgibt. </font><font style="vertical-align: inherit;">In unserer Implementierung suchen wir im resultierenden Array nach einer Verknüpfung mit einem Port, wobei die Quelleigenschaft den Wert portId hat:</font></font><br>
<br>
<pre><code class="javascript hljs">link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn es dann einen Link gibt, markieren Sie ihn:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methodencode:</font></font><br>
<br>
<pre><code class="javascript hljs">getTestLink(sourceCell: Cell, <span class="hljs-attr">portId</span>: string): Link {
  <span class="hljs-keyword">let</span> link = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (sourceCell &amp;&amp; sourceCell.id) {
    <span class="hljs-keyword">let</span> cell = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (sourceCell.type === <span class="hljs-string">'ScenarioStart'</span> || sourceCell.type === <span class="hljs-string">'IncomingStart'</span>) {<font></font>
      cell = <span class="hljs-keyword">this</span>.getStartCell()<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      cell = <span class="hljs-keyword">this</span>.graph.getCell(sourceCell.id);<font></font>
    }<font></font>
    link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;<font></font>
    });<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;<font></font>
}<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Animation eines laufenden Balls wird vollständig mittels JointJS implementiert ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">siehe Demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir gehen zum aktuellen Block</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir rufen die Methode selectTestBlock () auf, wenn der letzte Block ausgewählt und die Zeichenfläche dorthin verschoben werden muss. </font><font style="vertical-align: inherit;">Hier erhalten wir die Koordinaten der Blockmitte:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> center = cell.getBBox().center();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rufen Sie dann setTestCell () auf, um den Block einzufärben:</font></font><br>
<br>
<pre><code class="javascript hljs">editor.tester.setTestCell(cell);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schließlich haben wir mit der selbstgeschriebenen Funktion zoomToCell () in die Mitte gezoomt (es ist die interessanteste, aber am Ende darüber):</font></font><br>
<br>
<pre><code class="javascript hljs">editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methodencode:</font></font><br>
<br>
<pre><code class="javascript hljs">selectTestBlock(id: string): Cell {
 <span class="hljs-keyword">const</span> cell = (id === <span class="hljs-string">'ScenarioStart'</span>) ? editor.tester.getStartCell() : editor.graph.getCell(id);
 <span class="hljs-keyword">if</span> (cell) {
   <span class="hljs-keyword">const</span> center = cell.getBBox().center();<font></font>
   editor.tester.setTestCell(cell);<font></font>
   editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);<font></font>
 }<font></font>
 <span class="hljs-keyword">return</span> cell;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methode zum Färben: Suchen Sie das SVG-Element unseres Blocks und fügen Sie die CSS-Klasse .is-getestet hinzu, um die Blockfarbe zu erhalten:</font></font><br>
<br>
<pre><code class="javascript hljs">setTestCell(cell: Cell): <span class="hljs-keyword">void</span> {
 <span class="hljs-keyword">const</span> view = cell.findView(<span class="hljs-keyword">this</span>.paper);
 <span class="hljs-keyword">if</span> (view) view.el.classList.add(<span class="hljs-string">'is-tested'</span>);<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reibungsloser Zoom</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Schluss zoomToCell ()! JointJS verfügt über eine integrierte Methode zum Verschieben der Leinwand entlang der X- und Y-Achse. Zunächst wollten sie diese aufnehmen. Diese Methode verwendet jedoch die Transformation als Attribut des SVG-Tags. Sie unterstützt keine reibungslose Animation im Firefox + -Browser und verwendet nur die CPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben einen kleinen Hack gemacht - wir haben unsere Funktion zoomToCell () geschrieben, die im Wesentlichen dasselbe tut, aber die Transformation als Inline-CSS umwandelt. Dies ermöglicht das Rendern mit der GPU (da WebGL mit dem Prozess verbunden ist). Damit ist das Problem der Cross-Browser-Kompatibilität gelöst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Funktion verschiebt nicht nur die Leinwand in XY, sondern ermöglicht es uns auch, mithilfe der Transformationsmatrix gleichzeitig zu skalieren (zu zoomen).</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Eigenschaft will-change der Klasse .animate-viewport teilt dem Browser mit, dass das Element geändert wird und Optimierungen angewendet werden müssen, einschließlich der Verwendung der GPU, und die Übergangseigenschaft legt die Glätte des Verschiebens der Zeichenfläche in den Block fest:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-class">.animate-viewport</span> {
 <span class="hljs-attribute">will-change</span>: transform;
 <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.5s</span> ease-in-out;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser gesamter Methodencode ist unten aufgeführt:</font></font><br>
<br>
<pre><code class="javascript hljs">public zoomToCell(center: g.Point, <span class="hljs-attr">zoom</span>: number, <span class="hljs-attr">offset</span>: boolean = <span class="hljs-literal">true</span>): <span class="hljs-keyword">void</span> {
   <span class="hljs-keyword">this</span>.updateGridSize();
   <span class="hljs-keyword">const</span> currentMatrix = <span class="hljs-keyword">this</span>.paper.layers.getAttribute(<span class="hljs-string">'transform'</span>);
   <span class="hljs-comment">//   svg-,        center</span>
   <span class="hljs-comment">//   ,     style</span>
   <span class="hljs-keyword">const</span> { a, b, c, d, e, f } = <span class="hljs-keyword">this</span>.zoomMatrix(zoom, center, offset);
   <span class="hljs-comment">//  FireFox    ,       </span>
   <span class="hljs-keyword">this</span>.paper.layers.style.transform = currentMatrix;
   <span class="hljs-comment">//    FF  ,     ,    </span>
   setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">//  CSS- .animate-viewport,    - transition;</span>
     <span class="hljs-comment">//    style      - transition</span>
     <span class="hljs-keyword">this</span>.paper.layers.classList.add(<span class="hljs-string">'animate-viewport'</span>);
     <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-string">`matrix(<span class="hljs-subst">${ a }</span>, <span class="hljs-subst">${ b }</span>, <span class="hljs-subst">${ c }</span>, <span class="hljs-subst">${ d }</span>, <span class="hljs-subst">${ e }</span>, <span class="hljs-subst">${ f }</span>)`</span>;
     <span class="hljs-keyword">const</span> duration = <span class="hljs-built_in">parseFloat</span>(getComputedStyle(<span class="hljs-keyword">this</span>.paper.layers)[<span class="hljs-string">'transitionDuration'</span>]) * <span class="hljs-number">1000</span>;
     <span class="hljs-comment">//        style;</span>
     <span class="hljs-comment">//      joint</span>
     setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
       <span class="hljs-keyword">this</span>.paper.layers.classList.remove(<span class="hljs-string">'animate-viewport'</span>);
       <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-literal">null</span>;
       <span class="hljs-keyword">this</span>.paper.matrix(newMatrix);
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:zoom'</span>);
       <span class="hljs-keyword">this</span>.updateGridSize();
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:update'</span>);<font></font>
     }, duration);<font></font>
   }, <span class="hljs-number">100</span>);<font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sich herausstellte, müssen manchmal sogar die fortgeschrittensten mit einer Datei fertig werden :) Wir hoffen, Sie haben es genossen, in das Innere des Wals zu graben (egal wie gruselig es klingt). </font><font style="vertical-align: inherit;">Wir wünschen Ihnen eine erfolgreiche Entwicklung mit dem Voximplant Kit und mehr!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de492218/index.html">Zu beachtende Icon-Design-Regeln</a></li>
<li><a href="../de492220/index.html">5 wenig bekannte Geheimnisse der Pandas</a></li>
<li><a href="../de492222/index.html">Write-up CTFZone Quals 2019: Huhn</a></li>
<li><a href="../de492226/index.html">Kostenvergleich für verwaltete Kubernetes (2020)</a></li>
<li><a href="../de492228/index.html">Als Sports.ru schrieb ihr WYSIWYG-Editor</a></li>
<li><a href="../de492234/index.html">Forschung: Warum Menschen bereit sind, in sozialen Projekten weniger zu erhalten</a></li>
<li><a href="../de492242/index.html">M5Stack und seine Kontakte</a></li>
<li><a href="../de492244/index.html">Entfernung für die Zeit des Coronavirus: "Verhaftung" zu Hause oder Zeit der Gelegenheit?</a></li>
<li><a href="../de492246/index.html">Coronavirus: Mögliche Auswirkungen auf Gesellschaft, Wirtschaft und Medizin</a></li>
<li><a href="../de492248/index.html">Entprellen mit React Hooks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>