<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ ğŸ• âœ¡ï¸ Ø§Ù„Ø­Ø¨Ø§Ø± Ø§Ù„Ø´ÙØ§Ù Ù…Ø¹ SSL-Bump Ù„Ù€ Gentoo Ù…Ø¹ nft ğŸ¤²ğŸ¾ ğŸ‘ğŸ¼ ğŸ¤¬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ø®Ù„ÙÙŠØ©
 ÙÙŠ Ø§Ù„Ø¢ÙˆÙ†Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© ØŒ ØªØ¹Ù‡Ø¯Øª Ø¨ØªØ±Ø¬Ù…Ø© Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ Ù…Ø¹ iptables Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø®ØªØ¨Ø§Ø±Ù‡Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù† Ø¥Ù„Ù‰ nftables Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªÙ…Ø§Ù…Ù‹Ø§. Ù„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ø§Ù„Ø­Ø¨Ø§Ø± Ø§Ù„Ø´ÙØ§Ù Ù…Ø¹ SSL-Bump Ù„Ù€ Gentoo Ù…Ø¹ nft</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/infowatch/blog/492260/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6i/gj/ij/6igjijyvov-oxhfi4er8ecb6fu4.png" alt="ØµÙˆØ±Ø©"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø®Ù„ÙÙŠØ©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙÙŠ Ø§Ù„Ø¢ÙˆÙ†Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© ØŒ ØªØ¹Ù‡Ø¯Øª Ø¨ØªØ±Ø¬Ù…Ø© Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ Ù…Ø¹ iptables Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø®ØªØ¨Ø§Ø±Ù‡Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù† Ø¥Ù„Ù‰ nftables Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªÙ…Ø§Ù…Ù‹Ø§. </font><font style="vertical-align: inherit;">Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¯Ø±Ø§Ø³Ø© Ø£ÙƒØ«Ø± ØªÙØµÙŠÙ„Ø§Ù‹ Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ nf ØŒ Ù‚Ù…Øª Ø¨ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†ÙØ³ÙŠ: Ù„ØªÙƒÙˆÙŠÙ† Ø®Ø§Ø¯Ù… ÙˆÙƒÙŠÙ„ Ø´ÙØ§Ù (Squid) Ù…Ø¹ ØªØ­Ù„ÙŠÙ„ Ø§ØªØµØ§Ù„ Ù…Ø´ÙØ± (HTTPS) Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙˆØ£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± "Raspberry Pi" Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù‡Ø§ØªÙÙŠ Ø§Ù„Ø°ÙƒÙŠ (Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¸Ø§Ù… Android Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¯Ø³) Ø¹Ø¨Ø± Ø§ØªØµØ§Ù„ Ù„Ø§Ø³Ù„ÙƒÙŠ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ hostapd).</font></font><br>
<a name="habracut"></a><br>
<h3></h3><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>  </td>
<td>     .</td>
</tr>
<tr>
<td><b> </b></td>
<td>,     .</td>
</tr>
<tr>
<td><i> </i></td>
<td>,     (  ,     ,     . .).    ,  ,  .</td>
</tr>
<tr>
<td><u> </u></td>
<td>,      </td>
</tr>
</tbody></table></div><br>
<h3></h3><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td> </td>
<td>Â«Gentoo LinuxÂ»     Â«OpenRCÂ».<br>
       <br>
</td>
</tr>
<tr>
<td></td>
<td>sys-kernel/gentoo-sources-5.3.1<br>
USE=""<br>
    USE-  <br>
</td>
</tr>
<tr>
<td>-</td>
<td>net-proxy/squid-4.8<br>
USE="<b>caps</b> ssl ssl-crtd"<br>
</td>
</tr>
<tr>
<td><u> </u></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev-libs / openssl-1.1.1c-r1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USE = "asm test zlib"</font></font><br>
</td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØ·Ø¨ÙŠÙ‚ Nft</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net-firewall / nftables-0.9.2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USE = "doc gmp modern_kernel"</font></font><br>
</td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØ·Ø¨ÙŠÙ‚ IP</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys-apps / iproute2-5.2.0-r1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USE = "Ù‚Ø¨Ø¹Ø§Øª ØµØºÙŠØ±Ø©"</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù…Ø´Ø±Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ / ulogd-2.0.7-r1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USE = "nfct nflog"</font></font><br>
</td>
</tr>
</tbody></table></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªÙˆÙ„ÙŠÙ Ø§Ù„Ù†ÙˆØ§Ø©</font></font></h3><br>
<img src="https://habrastorage.org/webt/ji/de/sw/jideswukirdke8u-7ud5kv6zsya.png" alt="ØµÙˆØ±Ø©"><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù†ÙØ³ Ø§Ù„Ø´ÙŠØ¡ ÙˆÙ„ÙƒÙ† Ø§Ù„Ù†Øµ</font></font></b><div class="spoiler_text"><code>[*] Networking support ---&gt;<br>
 Networking options ---&gt;<br>
 [*] TCP/IP networking<br>
 [*] IP: advanced router<br>
 [*] IP: policy routing<br>
 [*] Network packet filtering framework (Netfilter) ---&gt;<br>
 [*] Advanced netfilter configuration<br>
 Core Netfilter Configuration ---&gt;<br>
 #  ,         <br>
 [*] Netfilter ingress support<br>
 #  ,    <br>
 &lt;*&gt; Netfilter LOG over NFNETLINK interface<br>
 &lt;*&gt; Netfilter connection tracking support<br>
 &lt;*&gt; Netfilter nf_tables support<br>
 &lt;*&gt; Netfilter nf_tables set infrastructure<br>
 #  ,         <br>
 [*] Netfilter nf_tables netdev tables support<br>
 &lt;*&gt; Netfilter nf_tables conntrack module<br>
 #  ,    <br>
 &lt;*&gt; Netfilter nf_tables counter module<br>
 #  ,    <br>
 &lt;*&gt; Netfilter nf_tables log module<br>
 &lt;*&gt; Netfilter nf_tables masquerade support<br>
 &lt;*&gt; Netfilter nf_tables nat module<br>
 &lt;*&gt; Netfilter nf_tables socket match support<br>
 &lt;*&gt; Netfilter nf_tables tproxy support<br>
 IP: Netfilter Configuration ---&gt;<br>
 [*] IPv4 nf_tables support<br>
 #  ,        <br>
 &lt;*&gt; Ethernet Bridge nf_tables support ---&gt;<br>
</code><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙƒÙ…Ø±Ø¬Ø¹ ØŒ Ø£Ù‚ØªØ¨Ø³ Ù…Ù‚ØªØ·ÙÙ‹Ø§ Ù…Ù† /usr/src/linux/.config:</font></font><br>
<br>
<pre><code class="plaintext hljs">CONFIG_NET=y<font></font>
CONFIG_INET=y<font></font>
&lt;b&gt;CONFIG_IP_ADVANCED_ROUTER=y<font></font>
CONFIG_IP_MULTIPLE_TABLES=y&lt;/b&gt;<font></font>
CONFIG_NETFILTER=y<font></font>
CONFIG_NETFILTER_ADVANCED=y<font></font>
CONFIG_NETFILTER_INGRESS=y<font></font>
CONFIG_NETFILTER_NETLINK=y<font></font>
CONFIG_NETFILTER_NETLINK_LOG=y<font></font>
CONFIG_NF_CONNTRACK=y<font></font>
CONFIG_NF_TABLES=y<font></font>
CONFIG_NF_TABLES_SET=y<font></font>
CONFIG_NF_TABLES_NETDEV=y<font></font>
CONFIG_NFT_CT=y<font></font>
CONFIG_NFT_COUNTER=y<font></font>
CONFIG_NFT_LOG=y<font></font>
CONFIG_NFT_MASQ=y<font></font>
CONFIG_NFT_NAT=y<font></font>
&lt;b&gt;CONFIG_NFT_SOCKET=y<font></font>
CONFIG_NFT_TPROXY=y&lt;/b&gt;<font></font>
CONFIG_NF_TABLES_BRIDGE=y<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªÙƒÙˆÙŠÙ† Ø´Ø¨ÙƒØ©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¥Ø°Ø§ Ù„Ù… ØªØªÙ… Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© net.lo Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ…Ù‡ÙŠØ¯ ØŒ ÙÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù‡Ù†Ø§Ùƒ:</font></font><br>
<br>
<pre><code class="bash hljs">rc-config add net.lo boot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© ØŒ ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ ÙˆØªÙƒÙˆÙŠÙ†Ù‡Ø§ Ù„Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø´Ø¨ÙƒØ©. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">br0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Ø¬Ø³Ø± Ù„Ù„Ø¢Ù„Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙˆØ§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ø°ÙƒÙŠØ©) ØŒ ØµØ§ÙÙŠ. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enp0s25</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ÙˆØ§Ø¬Ù‡Ø© Ø³Ù„ÙƒÙŠØ©) ÙˆØµØ§ÙÙŠ. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp3s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ÙˆØ§Ø¬Ù‡Ø© Ù„Ø§Ø³Ù„ÙƒÙŠØ©) ØŒ Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„:</font></font><br>
<br>
<pre><code class="bash hljs">ln -s net.lo /etc/init.d/net.br0<font></font>
rc-config add net.br0 default<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠØ¨Ø¯Ùˆ Ù…Ù„Ù Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ /etc/conf.d/net ÙÙŠ Ù…Ø«Ø§Ù„Ù†Ø§ ÙƒÙ…Ø§ ÙŠÙ„ÙŠ (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù…Ù‡Ù…ØªÙ†Ø§):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ij/tr/ss/ijtrssmgqse8ds1utvhxm5pyafm.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù†ÙØ³ Ø§Ù„Ø´ÙŠØ¡ ÙˆÙ„ÙƒÙ† Ø§Ù„Ù†Øµ</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs"># TProxy<font></font>
routes_lo='local default dev lo table 3128'<font></font>
<font></font>
# Qemu bridge<font></font>
bridge_force_br0=''<font></font>
mac_br0='XX:XX:XX:XX:XX:XX'<font></font>
config_br0='192.168.120.1/24'<font></font>
<font></font>
# Ethernet<font></font>
config_enp0s25='dhcp'<font></font>
modules_enp0s25='udhcpc'<font></font>
dhcp_enp0s25='release nontp'<font></font>
udhcpc_enp0s25='--retries 8 --timeout 10'<font></font>
fallback_enp0s25='10.a.b.c/16'<font></font>
fallback_routes_enp0s25='default via 10.a.0.1'<font></font>
<font></font>
# Wi-Fi<font></font>
if [[ -f /var/lib/misc/hostapd ]]; then<font></font>
  modules_wlp3s0="!ifconfig !iwconfig !wpa_supplicant"<font></font>
  config_wlp3s0='null'<font></font>
else<font></font>
  config_wlp3s0='dhcp'<font></font>
  modules_wlp3s0='udhcpc'<font></font>
  wpa_supplicant_wlp3s0='-Dnl80211'<font></font>
fi<font></font>
<font></font>
postup() {<font></font>
  if [ "${IFACE}" == lo ]; then<font></font>
    ip rule add fwmark 3128 lookup 3128<font></font>
  fi<font></font>
  return 0<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ØªØ¶ÙŠÙ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¬Ø¯ÙˆÙ„ ØªÙˆØ¬ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯ ØŒ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ ØªØ­Øª Ø§Ù„Ø±Ù‚Ù… 3128 ØŒ ÙˆØªÙƒÙˆÙ† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ù‡ÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹) ØŒ ÙˆØ§Ù„Ù‚Ø§Ø¹Ø¯Ø© ÙˆÙÙ‚Ù‹Ø§ Ù„Ù„Ø­Ø²Ù… Ø§Ù„ØªÙŠ ØªÙ… ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„ÙŠÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ØµÙ‚ 3128 (Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø´Ø±ÙŠØ© ÙÙŠ ÙƒÙ„ØªØ§ Ø§Ù„Ø­Ø§Ù„ØªÙŠÙ†) Ø³ØªÙƒÙˆÙ† ÙŠØ®Ø¯Ù…Ù‡ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù„Ù…Ù†Ø¹ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ù…ÙˆØ¬Ù‡Ø© Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø´Ø¨ÙƒØ© (ÙŠØ¹Ù…Ù„ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„Ø© Ø§Ù„Ø´ÙØ§ÙØ© Ø¹Ù„Ù‰ Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø­Ø²Ù… ÙƒÙ…Ø§ Ù‡ÙŠ!) ØŒ Ø£Ø¶Ù Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¥Ù„Ù‰ /etc/sysctl.conf (Ø£Ùˆ Ù‚Ù… Ø¨ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/44/lp/hn44lpq6q4fnukzklzjnanliucy.png" alt="ØµÙˆØ±Ø©"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¥Ø°Ø§ ÙƒÙ†Øª Ø¨Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ØŒ Ø«Ù… ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø£ÙŠØ¶Ù‹Ø§ ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ Ù„ÙƒÙ„ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ© Ù…Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª:</font></font><br>
<br>
<pre><code class="bash hljs">sysctl net.ipv4.conf.enp0s25.rp_filter=0<font></font>
sysctl net.ipv4.conf.wlp3s0.rp_filter=0</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù†Ù‡ Ø³ÙŠØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø¹Ø§Ø¯ÙŠ (ØºÙŠØ± Ø§Ù„Ø´ÙØ§Ù) Ù„Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¥Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø³Ø± ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.120.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ØŒ Ø£Ø¶Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ù„Ù‰ /etc/rc.conf:</font></font><br>
<br>
<pre><code class="bash hljs">rc_squid_need=<span class="hljs-string">"net.br0"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù„Ù† ÙŠØªÙ… Ø§Ù„Ù†Ø¸Ø± ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‚Ø§Ù„Ø©:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù…Ù†ÙØ° Ø¹Ø§Ø¯ÙŠ (ØºÙŠØ± Ø´ÙØ§Ù) Ø›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ ICAP Ù…Ø¹ Ø¬Ù‡Ø§Ø² Ù…Ù†Ø¹ ØªØ³Ø±Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø«Ù„ InfoWatch Traffic Monitor) Ø›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªÙˆÙ„ÙŠØ¯ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ´ÙÙŠØ± ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø´Ù‡Ø§Ø¯Ø©.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠØ¨Ø¯Ùˆ Ù…Ù„Ù Ø§Ù„ØªÙƒÙˆÙŠÙ† /etc/squid/squid.conf ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙƒÙ…Ø§ ÙŠÙ„ÙŠ (ÙÙ‚Ø· ÙÙŠ Ø­Ø§Ù„ Ø£Ø¹Ø·ÙŠØªÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9l/q8/k3/9lq8k3q9zsxsp8iedwfxqdnvzeq.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<img src="https://habrastorage.org/webt/3t/4n/zz/3t4nzzhfayg0nz-fjnlyetksspy.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù†ÙØ³ Ø§Ù„Ø´ÙŠØ¡ ÙˆÙ„ÙƒÙ† Ø§Ù„Ù†Øµ</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">	#    <font></font>
1	acl virtual_machines src 192.168.120.0/24<font></font>
2	acl SSL_ports port 443<font></font>
	#      HTTPS <font></font>
3	acl SSL_ports port 1012        #  badssl.com<font></font>
	#      HTTPS <font></font>
4	acl SSL_ports port 33443       # getcourse.ru  artlinerschool.ru<font></font>
5	acl Safe_ports port 21         # ftp<font></font>
6	acl Safe_ports port 80         # http<font></font>
7	acl Safe_ports port 443        # https<font></font>
	#     <font></font>
8	acl Safe_ports port 1012       #  badssl.com<font></font>
9	acl Safe_ports port 1025-65535 #  <font></font>
10	acl CONNECT method CONNECT <font></font>
11	http_access deny !Safe_ports<font></font>
12	http_access deny CONNECT !SSL_ports<font></font>
13	http_access allow localhost manager<font></font>
14	http_access deny manager<font></font>
15	http_access allow localhost<font></font>
	#      -<font></font>
16	http_access allow virtual_machines<font></font>
17	http_access deny all<font></font>
	#   () .   ,       (,   - FTP)<font></font>
18	http_port 192.168.120.1:3128 ssl-bump options=ALL:NO_SSLv3:NO_TLSv1 cert=/etc/squid/squid.pem<font></font>
	#      .     Â«loopbackÂ»,         3128,  ,         <font></font>
19	http_port 127.0.0.1:3129 tproxy<font></font>
	#      .     Â«loopbackÂ»,         3128,  ,         <font></font>
20	https_port 127.0.0.1:3130 tproxy ssl-bump options=ALL:NO_SSLv3:NO_TLSv1 cert=/etc/squid/squid.pem<font></font>
	# -    ,   -<font></font>
21	always_direct allow all<font></font>
	#    ,   <font></font>
22	acl BrokenButTrustedServers dstdomain "/etc/squid/selfsigned.txt"<font></font>
	#      ,   <font></font>
23	sslproxy_cert_error allow BrokenButTrustedServers<font></font>
24	sslproxy_cert_error deny all<font></font>
	#       TLS<font></font>
25	tls_outgoing_options min-version=1.2<font></font>
	#    <font></font>
26	acl blocked ssl::server_name "/etc/squid/blocked_domains.txt"<font></font>
	#   ,    -   (          SSL)<font></font>
27	acl fragile dstdomain "/etc/squid/fragile_domains.txt"<font></font>
28	acl step1 at_step SslBump1<font></font>
29	ssl_bump peek step1<font></font>
	#     <font></font>
30	ssl_bump terminate blocked<font></font>
	#       ,    -  <font></font>
31	ssl_bump splice fragile<font></font>
	#     ,  <font></font>
32	ssl_bump bump all<font></font>
	#    <font></font>
33	sslcrtd_program /usr/libexec/squid/security_file_certgen -s /var/lib/squid/ssl -M 4MB<font></font>
34	cache_dir rock /var/cache/squid-r 512 max-size=32768<font></font>
35	cache_dir aufs /var/cache/squid 512 64 1024 min-size=32768<font></font>
36	coredump_dir /var/tmp/squid<font></font>
37	refresh_pattern    ^ftp:          1440 20% 10080<font></font>
38	refresh_pattern -i (/cgi-bin/|\?) 0    0%  0<font></font>
39	refresh_pattern    .              0    20% 4320<font></font>
40	memory_replacement_policy heap GDSF<font></font>
41	cache_replacement_policy LFUDA<font></font>
42	maximum_object_size 32 MB<font></font>
43	logfile_rotate 3<font></font>
44	debug_options ALL,1,rotate=3<font></font>
45	cache_mem 512 MB<font></font>
46	visible_hostname host.shadow.amn<font></font>
47	udp_incoming_address 127.0.0.1<font></font>
48	pinger_enable off<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù‚Ù… Ø¨Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø¯Ù…Ø§Øª nftables Ùˆ ulogd Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ´ØºÙŠÙ„ "Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ" (Ù‡Ø°Ø§ Ø§Ù„Ø£Ø®ÙŠØ± Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø­Ø²Ù…Ø©):</font></font><br>
<br>
<pre><code class="bash hljs">rc-config add nftables default<font></font>
rc-config add ulogd default</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù†Ù‡ Ø³ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø¬Ø³Ø± ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© ØŒ Ø£Ø¶Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ù„Ù‰ /etc/rc.conf:</font></font><br>
<br>
<pre><code class="bash hljs">rc_nftables_need=<span class="hljs-string">"net.br0"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù„ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¥Ø®Ø·Ø§Ø± ÙÙŠ /etc/sysctl.conf ØŒ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ:</font></font><br>
<br>
<pre><code class="bash hljs">net.netfilter.nf_log.2 = nfnetlink_log</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¨Ø­ÙŠØ« ÙŠÙƒÙˆÙ† Ù…Ù„Ù Ø§Ù„ØªÙƒÙˆÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ / etc / nftables ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ /etc/conf.d/nftables:</font></font><br>
<br>
<pre><code class="bash hljs">NFTABLES_SAVE=<span class="hljs-string">"/etc/nftables/rules-save"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù„Ù…Ù†Ø¹ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ© ÙÙŠ Ù…Ù„Ù Ø§Ù„ØªÙƒÙˆÙŠÙ† ØŒ Ù‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ØªØºÙŠÙŠØ± Ø¢Ø®Ø± Ø¹Ù„Ù‰ /etc/conf.d/nftables:</font></font><br>
<br>
<pre><code class="bash hljs">SAVE_ON_STOP=<span class="hljs-string">"no"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø³Ø£ØµÙ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¹ÙŠÙ†Ø© Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙŠØ¬Ø¨ Ø£Ù† ØªØ²ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø³Ù„Ø§Ø³Ù„ Ø¬Ø¯ÙˆÙ„ Ø¹Ø§Ù…Ù„ ØªØµÙÙŠØ© IP Ø§Ù„Ø­Ø²Ù… (Ø­ØªÙ‰ ÙÙŠ Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬!). </font><font style="vertical-align: inherit;">ÙˆØ¨Ø§Ù„Ù…Ø«Ù„ Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø±Ø´Ø­ netdev Ø›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙŠØªÙ… Ø­Ø¸Ø± Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ù…Ù† Ø£ÙŠ Ù†ÙˆØ¹ ØŒ Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ IPv4 ÙˆØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø© (Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ ARP) ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ† (Ù„Ø§ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… IPv4 Ø£Ùˆ IPSec) Ø›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØªÙ… Ø£ÙŠØ¶Ù‹Ø§ Ø¥Ø²Ø§Ù„Ø© Ø­Ø²Ù… IPv4 Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ† Ø›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¸Ø§Ù… Android (Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¬Ø³Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ hostapd) ØŒ ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¨Ø« Ø§Ù„Ø°ÙŠ ÙŠØªÙ… Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„ ØªØ­Øª Ù†Ø¸Ø§Ù… ØªØ´ØºÙŠÙ„ Microsoft Windows Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠØ©.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙŠÙ…ÙƒÙ†Ùƒ ÙÙ‚Ø· Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¬Ù‡Ø²Ø© Wi-Fi Ù…Ø¹ Ø¹Ù†Ø§ÙˆÙŠÙ† MAC Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠØ¨Ø¯Ùˆ Ù…Ù„Ù Ø§Ù„ØªÙƒÙˆÙŠÙ† / etc / nftables / Rules-save ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙƒÙ…Ø§ ÙŠÙ„ÙŠ (Ù†Ø§Ù‚Øµ Ù…Ø¹Ø¸Ù… Ø§Ù„ØªÙØ³ÙŠØ±Ø§Øª):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/wy/fw/chwyfwcn5nv_n7nlt2zxrpdm53w.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<img src="https://habrastorage.org/webt/l4/ne/7s/l4ne7sbb2axs_3d05e23aiq0qhg.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<img src="https://habrastorage.org/webt/sg/fi/tw/sgfitwvevtdo4fz54ggdjrmosn4.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<img src="https://habrastorage.org/webt/iu/o8/hs/iuo8hs0m7zteeidibt9auoamnca.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<img src="https://habrastorage.org/webt/ak/9j/xi/ak9jxifxhq1s44cuanzyfqgyxlu.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<img src="https://habrastorage.org/webt/lt/sb/iw/ltsbiweb6a1n-na0cabv2xegvjq.png" alt="ØµÙˆØ±Ø©"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù†ÙØ³ Ø§Ù„Ø´ÙŠØ¡ ÙˆÙ„ÙƒÙ† Ø§Ù„Ù†Øµ</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">1	#!/sbin/nft -f<font></font>
	#  ,     <font></font>
2	define icmp_types = { destination-unreachable, time-exceeded, parameter-problem, echo-request, echo-reply }<font></font>
3	define host = 192.168.120.1<font></font>
4	define br = br0<font></font>
5	define my_br_mac = XX:XX:XX:XX:XX:XX<font></font>
6	define eth = enp0s25<font></font>
7	define my_eth_mac = YY:YY:YY:YY:YY:YY<font></font>
8	define wifi = wlp3s0<font></font>
9	define my_wifi_mac = WW:WW:WW:WW:WW:WW<font></font>
10	define my_phone = TT:TT:TT:TT:TT:TT<font></font>
11	define virtual_machines = 192.168.120.0/24<font></font>
12	define privileged_vm = { 192.168.120.22, 192.168.120.129 }<font></font>
13	define dhcp_client = 192.168.120.224/27<font></font>
14	define transmission_port = 51413<font></font>
15	define no_track = { microsoft-ds, ms-wbt-server }<font></font>
16	define vm_ssh = 192.168.120.70<font></font>
17	define infowatch_pc = { 10.a.0.0/16, 10.h.0.0/16 }<font></font>
18	define infowatch_my = 10.a.b.c<font></font>
19	define squid_normal = 3128<font></font>
20	define squid_transp = 3129<font></font>
21	define squid_trassl = 3130<font></font>
22	define sslvpn.infowatch.com = 46.148.194.86<font></font>
23	define files.infowatch.ru = 178.16.25.15<font></font>
24	define iwprint.infowatch.ru = 10.d.e.f<font></font>
25	define s163.getcourses.ru = 95.213.153.163<font></font>
26	define tls-v1-2.badssl.com = 104.154.89.105<font></font>
27	flush ruleset<font></font>
28	table ip raw {<font></font>
29	  chain prerouting {<font></font>
30	    type filter hook prerouting priority -300;<font></font>
	    #      ,          <font></font>
31	    meta l4proto { tcp, udp } th dport $transmission_port notrack<font></font>
32	    tcp sport $no_track ip saddr != $iwprint.infowatch.ru notrack<font></font>
33	    ip saddr { $sslvpn.infowatch.com, $files.infowatch.ru } tcp sport https notrack<font></font>
34	  }<font></font>
35	}<font></font>
36	table ip filter {<font></font>
37	  chain input {<font></font>
38	    type filter hook input priority 0; policy drop;<font></font>
	    #         ,        Â«loopbackÂ»<font></font>
39	    iif lo accept<font></font>
	    #   ICMP       ,       ICMP<font></font>
40	    icmp type $icmp_types accept<font></font>
	    #   <font></font>
41	    ct state invalid counter drop<font></font>
	    #   ,     (SACK)  TCP.        ,       <font></font>
42	    tcp flags syn tcp option maxseg size &lt; 999 counter drop<font></font>
	    #   Bittorrent,         31<font></font>
43	    iif $eth meta l4proto { tcp, udp } th dport $transmission_port accept<font></font>
	    #  ,  ,       ,      <font></font>
44	    tcp flags &amp; (syn | ack) == syn ct state untracked log prefix "Untracked:" group 2 counter counter drop<font></font>
	    #    ,        32<font></font>
45	    tcp sport $no_track accept<font></font>
	    #    ,        33<font></font>
46	    ip saddr { $sslvpn.infowatch.com, $files.infowatch.ru } tcp sport https accept<font></font>
	    #     ,   3128 ( )<font></font>
47	    iif $br ip saddr $virtual_machines mark set 3128 counter accept<font></font>
	    #       ,      ()  -<font></font>
48	    iif $br ip daddr $host ip saddr $virtual_machines tcp dport { domain, http, microsoft-ds, nfs, $squid_normal } accept<font></font>
	    #     <font></font>
49	    ct state { established, related } accept<font></font>
	    #       ,   <font></font>
50	    iif $br udp dport { domain, bootps, tftp, 4011 } counter accept<font></font>
	    #    ,        ,   (.  38)<font></font>
51	    counter comment "  "<font></font>
52	  }<font></font>
53	  chain output {<font></font>
54	    type filter hook output priority 100; policy drop;<font></font>
	    #         ,        Â«loopbackÂ»<font></font>
55	    oif lo accept<font></font>
	    #   ICMP       ,       ICMP<font></font>
56	    icmp type $icmp_types counter accept<font></font>
	    #          (   48  50)<font></font>
57	    oif { $eth, $wifi } udp dport . udp sport { bootps . bootpc } counter accept<font></font>
58	    oif $br ip saddr $host ip daddr { $dhcp_client, 255.255.255.255 } udp sport . udp dport { bootps . bootpc } counter accept<font></font>
59	    oif $br ip saddr $host ip daddr $virtual_machines udp sport { domain, tftp } counter accept<font></font>
60	    oif $br ip saddr $host ip daddr $virtual_machines tcp sport { domain, http, microsoft-ds } accept<font></font>
	    #  -           .      HTTPS   ,            <font></font>
61	    oif $br ip daddr $virtual_machines tcp sport { http, https, 1012 } counter accept<font></font>
	    #      ,     ,    1024<font></font>
62	    meta l4proto { tcp, udp } th sport &gt;= 1025 accept<font></font>
	    #    ,        ,   (.  54)<font></font>
63	    counter comment "  "<font></font>
64	  }<font></font>
65	  chain forward {<font></font>
66	    type filter hook forward priority 0; policy drop;<font></font>
	    #        (MTU)<font></font>
67	    tcp flags syn tcp option maxseg size set rt mtu counter<font></font>
	    #         <font></font>
68	    iif $br ip daddr != $host meta l4proto { tcp, udp } th dport domain drop<font></font>
	    #      ( -)      ,     ,  ,   .    ,      ( 80  443)     -,    divert         forward (  66  81).  ,   96      ,      80  443<font></font>
69	    iif $br ip saddr { $privileged_vm, $dhcp_client } accept<font></font>
70	    oif $br ip daddr { $privileged_vm, $dhcp_client } accept<font></font>
	    #    ,        ,   (.  66)<font></font>
71	    counter comment "  "<font></font>
72	  }<font></font>
	  #    Â«   â€¢ Â»     HTTPS  ,   443<font></font>
73	  set nonstandard_https {<font></font>
74	    type ipv4_addr . inet_service;<font></font>
75	    elements = {<font></font>
76	      $s163.getcourses.ru . 33443, #   artlinerschool.ru<font></font>
77	      $tls-v1-2.badssl.com . 1012, #   badssl.com<font></font>
78	  }<font></font>
79	}<font></font>
80	  chain divert {<font></font>
81	    type filter hook prerouting priority -150; policy accept;<font></font>
	    #   3128 (. .)   TCP,   ,    (  -)<font></font>
82	    meta l4proto tcp socket transparent 1 mark set 3128 accept<font></font>
	    #   3128 (. .)   TCP   ,   80.      -<font></font>
83	    ip daddr != { 127.0.0.1, $host } tcp dport http tproxy to 127.0.0.1:$squid_transp mark set 3128 counter accept<font></font>
	    #   3128 (. .)   TCP   ,   443.      -<font></font>
84	    ip daddr != { 127.0.0.1, $host } tcp dport https tproxy to 127.0.0.1:$squid_trassl mark set 3128 counter accept<font></font>
	    #    3128 (. .)   TCP        nonstandard_https (.  76  77  ).      -<font></font>
85	    ip daddr . tcp dport @nonstandard_https tproxy to 127.0.0.1:$squid_trassl mark set 3128 counter accept<font></font>
86	  }<font></font>
87	}<font></font>
88	table ip nat {<font></font>
89	  chain prerouting {<font></font>
90	    type nat hook prerouting priority 0; policy accept;<font></font>
	    #               SSH<font></font>
91	    iif $eth ip daddr $infowatch_my ip saddr $infowatch_pc tcp dport ssh counter dnat $vm_ssh<font></font>
92	  }<font></font>
93	  chain postrouting {<font></font>
94	    type nat hook postrouting priority 100; policy accept;<font></font>
	    #      ,   -,         .  -     UID  GID <font></font>
95	    oif { $eth, $wifi } ip saddr $virtual_machines skuid . skgid { squid . squid } counter masquerade<font></font>
	    #      ,     ,  ,     , (   69  70).     ,    ,       HTTPS .           nonstandard_https (.  76  77  ).<font></font>
96	    oif { $eth, $wifi } ip saddr { $privileged_vm, $dhcp_client } tcp dport != { http, https } log prefix "NAT:" group 2 counter masquerade<font></font>
97	  }<font></font>
98	}<font></font>
	<font></font>
99	table bridge filter {<font></font>
  #   â„–5:     Wi-Fi   <font></font>
100	  chain input {<font></font>
    type filter hook input priority -200; policy accept;<font></font>
    iif $wifi ether saddr != $my_phone counter drop<font></font>
  }<font></font>
  #   â„–4:    ,    IPv4,      <font></font>
  chain forward {<font></font>
101	    type filter hook forward priority -200; policy accept;<font></font>
102	    oif $wifi ether type arp accept<font></font>
103	    oif $wifi ip protocol { icmp, tcp, udp } ip daddr != 192.168.120.255 accept<font></font>
104	    oif $wifi drop<font></font>
105	  }<font></font>
  #   â„–5:   Wi-Fi     <font></font>
106	  chain output {<font></font>
    type filter hook input priority 200; policy accept;<font></font>
    oif $wifi ether daddr != $my_phone counter drop<font></font>
  }<font></font>
}<font></font>
	#   â„–2:     ,    IPv4<font></font>
107	table netdev filter {<font></font>
108	  chain enp0s25 {<font></font>
109	    type filter hook ingress device enp0s25 priority 0; policy drop;<font></font>
110	    ether type arp accept<font></font>
111	    ether daddr $my_eth_mac ip protocol { icmp, tcp, udp, gre } accept<font></font>
112	  }<font></font>
113	  chain wlp3s0 {<font></font>
114	    type filter hook ingress device wlp3s0 priority 0; policy drop;<font></font>
	    #  ARP  EAPOL  ,        <font></font>
115	    ether type { arp, 0x888e } accept<font></font>
	    #       ,         ,   <font></font>
116	    ether daddr { $my_br_mac, $my_wifi_mac, ff:ff:ff:ff:ff:ff } ip protocol { icmp, tcp, udp, gre } accept<font></font>
117	  }<font></font>
118	}<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù†ÙØ³Ù‡</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø£ÙƒØ«Ø± Ø´Ù…ÙˆÙ„Ø§Ù‹ Ù„Ø®Ø§Ø¯Ù… ÙˆÙƒÙŠÙ„ Ø´ÙØ§Ù ØŒ Ù‚Ø±Ø±Øª Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª (Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª ØŒ ÙˆØ§Ù„Ù…Ø²ÙŠØ¯ Ø­ÙˆÙ„ Ø°Ù„Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§) Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù†ÙØ³Ù‡. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø£Ø¶Ù Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø´ØªØ±Ùƒ:</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p /usr/<span class="hljs-built_in">local</span>/share/ca-certificates<font></font>
cp /etc/squid/squid.pem /usr/<span class="hljs-built_in">local</span>/share/ca-certificates/squid.crt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:</font></font><br>
<br>
<pre><code class="bash hljs">update-ca-certificates</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª - Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ù…ØªØµÙØ­Ø§Øª Ø§Ù„ÙˆÙŠØ¨ Firefox Ùˆ Chromium Ù…ØªØ¬Ø± Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ø´ØªØ±ÙƒÙ‹Ø§ ØŒ Ù„Ø°Ù„Ùƒ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„ØªÙƒÙˆÙŠÙ† /etc/env.d/38proxy Ù…Ø¹ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠØ©:</font></font><br>
<br>
<pre><code class="bash hljs">http_proxy=http://192.168.120.1:3128<font></font>
https_proxy=http://192.168.120.1:3128<font></font>
ftp_proxy=http://192.168.120.1:3128<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ØªØ­Ø¯ÙŠØ« Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©:</font></font><br>
<br>
<pre><code class="bash hljs">env-update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ØŒ Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø­ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙÙ‚Ø· ÙÙŠ Ø­Ø§Ù„Ø© ØŒ Ø¯Ø¹Ù†Ø§ Ù†ØªØ±Ùƒ Ù…ØªØµÙØ­ Ø§Ù„ÙˆÙŠØ¨ Chromium ØŒ ÙˆØ³ÙˆÙ ÙŠØªØµÙ„ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø© ØŒ Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù… ÙˆÙƒÙŠÙ„ ØŒ Ù„Ø°Ù„Ùƒ Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØºÙŠÙŠØ± Ù…Ù„Ù Ø§Ù„ØªÙƒÙˆÙŠÙ† / etc / chromium / default Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: </font></font><br>
<br>
<pre><code class="bash hljs">CHROMIUM_FLAGS=<span class="hljs-string">"--enable-seccomp-sandbox â€”no-proxy-server"</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙÙŠ ÙˆØ¬ÙˆØ¯ Ù…ØªØºÙŠØ± Ø¨ÙŠØ¦Ø© https_proxy ØŒ ÙŠØ­Ø§ÙˆÙ„ ØªØ·Ø¨ÙŠÙ‚ xfreerdp Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ø¨Ø± Ø®Ø§Ø¯Ù… ÙˆÙƒÙŠÙ„ ØŒ Ù„Ø°Ø§ Ø£Ø¶Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ù„Ù‰ Ù…Ù„Ù ØªÙƒÙˆÙŠÙ† shell: </font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">alias</span> xfreerdp=<span class="hljs-string">'https_proxy= xfreerdp'</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÙŠØªØ¹Ø°Ø± Ø¹Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ youtube-dl Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØŒ Ø±Ø¨Ù…Ø§ Ø¨Ø³Ø¨Ø¨ Ø·Ø¨ÙŠØ¹Ø© Ù…Ø®Ø²Ù† Ø´Ù‡Ø§Ø¯Ø§Øª Python. </font><font style="vertical-align: inherit;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù„ Ø¯Ø§Ø¦Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù† ØŒ Ù„Ø°Ø§ Ø£Ø¶Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ù„Ù‰ Ù…Ù„Ù ØªÙƒÙˆÙŠÙ† shell:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">alias</span> youtube-dl=<span class="hljs-string">'youtube-dl --no-check-certificate'</span></code></pre></li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¹Ù„Ù‰ Red Hat Enterprise Linux OS 6 Ùˆ 7 Ø£Ø¬Ù‡Ø²Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠ ØŒ Ù‚Ù… Ø¨ØªÙ…ÙƒÙŠÙ† Ø´Ù‡Ø§Ø¯Ø§Øª PEM:</font></font><br>
<br>
<pre><code class="bash hljs">update-ca-trust force-enable</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ù†Ø¹ÙŠØ¯ ÙƒØªØ§Ø¨Ø© Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ù…Ù† Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠ:</font></font><br>
<br>
<pre><code class="bash hljs">scp squid.crt root@192.168.120.66:/etc/pki/ca-trust/<span class="hljs-built_in">source</span>/anchors/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠ Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©:</font></font><br>
<br>
<pre><code class="bash hljs">update-ca-trust extract</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„ Ø¨Ø£Ù†Ø¸Ù…Ø© ØªØ´ØºÙŠÙ„ Microsoft Windows Ø¨Ø¥ØµØ¯Ø§Ø±Ø§Øª Ù…Ø®ØªÙ„ÙØ©</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ù…Ø®Ø²Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø¬Ù‡Ø§Ø² (ÙˆÙ„ÙŠØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!) ÙÙŠ Ù‚Ø³Ù… "Ø§Ù„Ø¬Ø°ÙˆØ± Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚Ø© ...". </font><font style="vertical-align: inherit;">Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Ù…ØªØµÙØ­ Ø§Ù„ÙˆÙŠØ¨ Firefox Ù…ØªØ¬Ø± Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ø´ØªØ±ÙƒÙ‹Ø§ ØŒ Ù„Ø°Ù„Ùƒ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² ÙƒÙ…Ø¨ÙŠÙˆØªØ± Raspberry Pi Ø¨Ù†Ø¸Ø§Ù… Raspbian OS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ØªÙ…Øª ØªØ±Ù‚ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø¯ÙˆÙ† ØªØ«Ø¨ÙŠØª Ø´Ù‡Ø§Ø¯Ø©.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ Android</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² ØŒ Ø«Ù… ÙŠØªÙ… ØªØ«Ø¨ÙŠØªÙ‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©. </font><font style="vertical-align: inherit;">Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ ØŒ Ø³ÙŠÙØ·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ¹Ø²ÙŠØ² Ø£Ù…Ø§Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‚Ø¯ ØªÙ… Ø¨Ø§Ù„ÙØ¹Ù„) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø±Ø³ÙˆÙ…ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ø³ØªÙ†ØªØ§Ø¬</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ÙŠØ¹Ø¯ Ø¬Ø¯Ø§Ø± Ø­Ù…Ø§ÙŠØ© Linux Ø§Ù„Ø¬Ø¯ÙŠØ¯ (nft) Ù…Ø«Ø§Ù„Ù‹Ø§ Ø±Ø§Ø¦Ø¹Ù‹Ø§ Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø§Ù„ØªÙŠ ØªØªÙˆØ§ÙÙ‚ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯ Ù…Ø¹ Squid ØŒ ÙˆÙ‡Ùˆ Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ø®Ø§Ø¯Ù… ÙˆÙƒÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://wiki.squid-cache.org/Features/Tproxy4</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2. /usr/src/linux/Documentation/networking/tproxy.txt </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://wiki.nftables.org</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
4. nft (8) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.bounca.org/tutorials/install_root_certificate.html </font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø§Ù„Ù…Ø¤Ù„Ù:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ø´Ø§Ù…Ù„ Ø³Ø§ÙŠØªÙˆÙ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nikodim_Tychoblin</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar492244/index.html">Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù„ÙØªØ±Ø© Ø§Ù„Ø¥ØµØ§Ø¨Ø© Ø¨Ø§Ù„ÙÙŠØ±ÙˆØ³ Ø§Ù„ØªØ§Ø¬ÙŠ: "ØªÙˆÙ‚ÙŠÙ" Ù…Ù†Ø²Ù„ÙŠ Ø£Ùˆ ÙˆÙ‚Øª ÙØ±ØµØ©ØŸ</a></li>
<li><a href="../ar492246/index.html">Ø§Ù„ÙÙŠØ±ÙˆØ³ Ø§Ù„ØªØ§Ø¬ÙŠ: Ø§Ù„Ø¢Ø«Ø§Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© Ù„Ù„Ù…Ø¬ØªÙ…Ø¹ ÙˆØ§Ù„Ø§Ù‚ØªØµØ§Ø¯ ÙˆØ§Ù„Ø·Ø¨</a></li>
<li><a href="../ar492248/index.html">Ø§Ù„ØªÙÙƒÙŠÙƒ Ù…Ø¹ Ø®Ø·Ø§ÙØ§Øª Ø±Ø¯ Ø§Ù„ÙØ¹Ù„</a></li>
<li><a href="../ar492254/index.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ØŒ Ø§Ù„ÙØ¦Ø© 30+</a></li>
<li><a href="../ar492258/index.html">Ù…Ø§ Ù‡Ùˆ ØªØ±Ù…ÙŠØ² Open Graph ÙˆÙƒÙŠÙÙŠØ© ØªÙ†ÙÙŠØ°Ù‡ Ø¨Ø¯ÙˆÙ† Ù…Ø¨Ø±Ù…Ø¬</a></li>
<li><a href="../ar492262/index.html">ØªØ£Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª DotNext Ùˆ Heisenbug Ùˆ HolyJS Ùˆ C ++ Russia Ùˆ DevOops Ùˆ JPoint Ø¨Ø³Ø¨Ø¨ ÙÙŠØ±ÙˆØ³ ÙƒÙˆØ±ÙˆÙ†Ø§</a></li>
<li><a href="../ar492268/index.html">Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ø¨ÙƒØ©: Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª ÙˆØ§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„ÙƒÙ…</a></li>
<li><a href="../ar492270/index.html">Ø³ÙˆÙ ØªØ­Ù…ÙŠ Ù…Ù†Ø¸Ù…Ø© Ø§Ù„Ø¹ÙÙˆ Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ø§Ù„Ø£Ø®ØªØ§Ù… ÙˆØ§Ù„Ø­ÙŠØªØ§Ù† Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡</a></li>
<li><a href="../ar492272/index.html">FragmentLifecycleCallbacks</a></li>
<li><a href="../ar492274/index.html">Ù…Ø§Ø°Ø§ Ù†Ø±ÙŠØ¯ Ù…Ù† Ù…Ø­Ù„Ù„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>