<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛓️ 🌏 🚗 PVS-Studioスタティックアナライザーによる.NET Coreライブラリのソースコードの検証 📃 🧑‍🤝‍🧑 🍱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=".NET Core Librariesは、GitHubで最も人気のあるC＃プロジェクトの1つです。その幅広い人気と使いやすさを考えると、当然のことです。PVS-Studioスタティックアナライザーを使用して、これらのライブラリのソースコードに暗いコーナーが見つかる可能性があることを調べるのはさらに興...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PVS-Studioスタティックアナライザーによる.NET Coreライブラリのソースコードの検証</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/463537/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/-a/bm/pb/-abmpb2yelga7y1zu59bejm6vgo.png" alt="写真19"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.NET Core Librariesは、GitHubで最も人気のあるC＃プロジェクトの1つです。</font><font style="vertical-align: inherit;">その幅広い人気と使いやすさを考えると、当然のことです。</font><font style="vertical-align: inherit;">PVS-Studioスタティックアナライザーを使用して、これらのライブラリのソースコードに暗いコーナーが見つかる可能性があることを調べるのはさらに興味深いことです。</font><font style="vertical-align: inherit;">結局、何か面白いものを発見できたと思いますか？</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はこの記事に1年半以上行きました。</font><font style="vertical-align: inherit;">ある時点で、.NET Coreライブラリーは一口であり、それらをチェックアウトすることは興味深いものであると私の頭の中に落ち着きました。</font><font style="vertical-align: inherit;">何度かプロジェクトをチェックしたところ、アナライザーはますます興味深い場所を見つけましたが、警告のリストをすばやくスクロールする以上のことはしませんでした。</font><font style="vertical-align: inherit;">そしてここにあります-完了！</font><font style="vertical-align: inherit;">プロジェクトがチェックされ、記事が目の前にあります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトと分析の詳細</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードの分析に没頭したい場合は、このセクションはスキップできますが、ぜひ読んでいただきたいと思います。ここでは、プロジェクトとアナライザーについて少し詳しく説明し、エラーを分析して再現する方法についても少し説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監査済みプロジェクト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、CoreFX（.NET Coreライブラリ）が何であるかを知らない可能性がありますが、聞いたことがない場合は、以下に説明があります。</font><font style="vertical-align: inherit;">私はそれを言い換えず</font><font style="vertical-align: inherit;">、ソースをダウンロードできる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubのプロジェクトページから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このリポジトリには、.NET Coreのライブラリ実装（「CoreFX」と呼ばれます）が含まれています。</font><font style="vertical-align: inherit;">System.Collections、System.IO、System.Xml、およびその他の多くのコンポーネントが含まれます。</font><font style="vertical-align: inherit;">対応する.NET Coreランタイムリポジトリ（「CoreCLR」と呼ばれる）には、.NET Coreのランタイム実装が含まれています。</font><font style="vertical-align: inherit;">RyuJIT、.NET GC、および他の多くのコンポーネントが含まれています。</font><font style="vertical-align: inherit;">ランタイム固有のライブラリコード（System.Private.CoreLib）は、CoreCLRリポジトリにあります。</font><font style="vertical-align: inherit;">ランタイムと並行してビルドおよびバージョン管理する必要があります。</font><font style="vertical-align: inherit;">CoreFXの残りの部分は、ランタイムの実装に依存せず、互換性のある任意の.NETランタイム（CoreRTなど）で実行できます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中古分析装置と分析方法</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioスタティックアナライザー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用してソースコードをチェックしました</font><font style="vertical-align: inherit;">。一般に、PVS-StudioはCコードだけでなく、C、C ++、Javaも分析できます。これまでのC＃コードの分析はWindowsでのみ機能しますが、C、C ++、JavaのコードはWindows、Linux、macOSで分析できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は通常、Visual StudioのPVS-Studioプラグインを使用してC＃プロジェクトをテストします（バージョン2010-2019がサポートされています）。これはおそらく、分析を開く、分析を開始する、警告のリストを操作する、最も簡単で便利な分析方法です。ただし、CoreFXを使用すると、状況が少し複雑になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、プロジェクトには単一の.slnファイルがないため、Visual Studioでプロジェクトを開いて、PVS-Studioプラグインを使用して完全な分析を実行すると失敗します。おそらく、それは良いことです。VisualStudioがこのサイズのソリューションをどのように処理するのか、本当にわかりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、PVS-Studio配布キットには、MSBuildプロジェクト（実際には.sln）用のアナライザーのコマンドラインバージョンが含まれているため、分析に問題はありませんでした。私に必要だったのは、CoreFXディレクトリの各.slnに対して「PVS-Studio_Cmd.exe」を実行し、分析結果を別のディレクトリ（アナライザーの起動フラグで示される）に配置する小さなスクリプトを書くことだけでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出来上がり！ -出口には一連のログがあり、興味深いことがたくさんあります。必要に応じて、配布キットに付属のPlogConverterユーティリティを使用してログを組み合わせることができます。しかし、個々のログを処理する方が便利だったので、それらを結合し始めませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのエラーについて説明するときは、docs.microsoft.comのドキュメントと、nuget.orgからダウンロードできるNuGetパッケージを参照します。ドキュメントに記載されているコード/パッケージに含まれているコードは、分析したコードと少し異なる場合があることを認めます。それにもかかわらず、たとえば、ドキュメントにいくつかの入力データに対して生成された例外の説明がなく、パッケージの新しいバージョンに表示される場合は非常に奇妙です-同意すると、これは疑わしい驚きです。ライブラリのデバッグに使用されたのと同じ入力データでNuGetからのパッケージのエラーを再現すると、問題は新しいものではなく、さらに重要なことに、ソースからプロジェクトをビルドしなくても問題に触れることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、理論的なコードの非同期化の可能性を想定して、docs.microsoft.comの対応するメソッドの説明を参照し、nuget.orgのパッケージの問題を再現することは許容されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、提供されたリンクの説明、およびパッケージ内の情報（コメント）（他のバージョン）は、記事の執筆中に変更される可能性があることにも注意します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の実績のあるプロジェクト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、これはこの種のユニークな記事ではありません。プロジェクトのチェックに関する他の記事を書いています。そのリストは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さらに、サイトではプロジェクトの分析に関する記事だけでなく、C、C ++、C＃、Javaに関するさまざまな技術記事だけでなく、興味深いメモも収集しています。</font><font style="vertical-align: inherit;">このすべてを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブログで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つけることができます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の同僚は、2015年に.NET Coreライブラリを以前にテストしました。</font><font style="vertical-align: inherit;">以前の分析の結果は、対応する記事「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NET Core Libraries（CoreFX）の新年のチェック</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」に記載されてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーが発見され、疑わしく興味深い場所</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつものように、関心を高めるために、まずフラグメントのエラーを自分で検索してから、アナライザーの警告と問題の説明を読むことをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
便宜上、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の形式のラベルを使用して、検討中のフラグメントを互いに明示的に分離しました-1 </font><font style="vertical-align: inherit;">つのエラーの説明がどこで終わり、他のエラーの分析が始まるかを理解するのが簡単です。はい、特定のフラグメントを参照するのも簡単です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1号</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Principal</span> : <span class="hljs-title">IDisposable</span> <font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Save</span>(<span class="hljs-params">PrincipalContext context</span>)</span><font></font>
  {<font></font>
    ....<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (   context.ContextType == ContextType.Machine <font></font>
        || _ctx.ContextType == ContextType.Machine)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<font></font>
        SR.SaveToNotSupportedAgainstMachineStore);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (context == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      Debug.Assert(<span class="hljs-keyword">this</span>.unpersisted == <span class="hljs-literal">true</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(SR.NullArguments);<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に 'context'オブジェクトが使用されました。チェック行：340、346。Principal.cs 340 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者</font><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">コンテキスト</font></i><font style="vertical-align: inherit;">パラメーターの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">が無効である</font><font style="vertical-align: inherit;">ことを明示的に示しており、</font><i><font style="vertical-align: inherit;">InvalidOperationException</font></i><font style="vertical-align: inherit;">型の例外を使用してこれを強調したいと考えてい</font><font style="vertical-align: inherit;">ます。ただし、少し高い、前の条件では、</font><i><font style="vertical-align: inherit;">コンテキスト</font></i><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">無条件に逆参照され</font><i><font style="vertical-align: inherit;">ます</font></i><i><font style="vertical-align: inherit;">-context.ContextType</font></i><font style="vertical-align: inherit;">。その結果、</font><i><font style="vertical-align: inherit;">コンテキスト</font></i><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">nullの</font></i><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、予想される</font><i><font style="vertical-align: inherit;">InvalidOperationExcetion</font></i><font style="vertical-align: inherit;">ではなく、</font><font style="vertical-align: inherit;">タイプ</font><i><font style="vertical-align: inherit;">NullReferenceExceptionの</font></i><font style="vertical-align: inherit;">例外が</font><i><font style="vertical-align: inherit;">スロー</font></i><font style="vertical-align: inherit;">され</font><i><font style="vertical-align: inherit;">ます。</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を再現してみましょう。</font><font style="vertical-align: inherit;">適切なライブラリ（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.DirectoryServices.AccountManagement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）をプロジェクトに</font><font style="vertical-align: inherit;">接続し</font><font style="vertical-align: inherit;">、次のコードを実行します。</font></font><br>
<br>
<pre><code class="cs hljs">GroupPrincipal groupPrincipal <font></font>
  = <span class="hljs-keyword">new</span> GroupPrincipal(<span class="hljs-keyword">new</span> PrincipalContext(ContextType.Machine));<font></font>
groupPrincipal.Save(<span class="hljs-literal">null</span>);</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GroupPrincipal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">必要な</font><i><font style="vertical-align: inherit;">Save</font></i><font style="vertical-align: inherit;">メソッドの実装を含む</font><font style="vertical-align: inherit;">抽象クラス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Principalの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後継</font><font style="vertical-align: inherit;">です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コードを実行して、証明するために何が必要かを確認します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/290/09a/2cc/29009a2cc3a5408808b9814d48bb0dea.png" alt="写真1"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
楽しみのために、NuGetから適切なパッケージをダウンロードして、同じ方法で問題を再現してみることができます。</font><font style="vertical-align: inherit;">パッケージバージョン4.5.0をインストールし、期待どおりの結果を得ました。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3de/891/b4a/3de891b4a4ba8100bb63af19e4455842.png" alt="写真2"></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2号</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> SearchResultCollection <span class="hljs-title">FindAll</span>(<span class="hljs-params"><span class="hljs-keyword">bool</span> findMoreThanOne</span>)</span><font></font>
{<font></font>
  searchResult = <span class="hljs-literal">null</span>;<font></font>
<font></font>
  DirectoryEntry clonedRoot = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (_assertDefaultNamingContext == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    clonedRoot = SearchRoot.CloneBrowsable();<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    clonedRoot = SearchRoot.CloneBrowsable();<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「then」ステートメントは「else」ステートメントと同等です。 DirectorySearcher.cs 629 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
にかかわらずの真実の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_assertDefaultNamingContext == nullでの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">から、同じアクションは、実行され</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た後</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、他</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の枝</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if文は、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じボディを持っています。いくつかのブランチに別のアクションがあるべきか、または</font><font style="vertical-align: inherit;">プログラマーとアナライザーを混同しないように</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメントを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">省略でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3号</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DirectoryEntry</span> : <span class="hljs-title">Component</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RefreshCache</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] propertyNames</span>)</span><font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">object</span>[] names = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[propertyNames.Length];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; propertyNames.Length; i++)<font></font>
      names[i] = propertyNames[i];    <font></font>
    ....<font></font>
    <span class="hljs-keyword">if</span> (_propertyCollection != <span class="hljs-literal">null</span> &amp;&amp; propertyNames != <span class="hljs-literal">null</span>)<font></font>
      ....<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に 'propertyNames'オブジェクトが使用されました。チェック行：990、1004。DirectoryEntry.cs 990 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも、奇妙な手順が見られます。方法はあり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propertyNames！= NULLの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェック</font><font style="vertical-align: inherit;">、すなわちを開発者は、メソッドが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返すことを保証し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。ここでは、この潜在的にnull参照に、いくつかのアクセスを観察することができますだけ上回っている- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propertyNames.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[i]をpropertyNames</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。結果は非常に予測可能です</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照がメソッドに渡されると、</font><i><font style="vertical-align: inherit;">NullReferenceExcepption</font></i><font style="vertical-align: inherit;">型の例外</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">発生します。</font><i><font style="vertical-align: inherit;">RefreshCache</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
が偶然</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-パブリッククラスのパブリックメソッド。</font><font style="vertical-align: inherit;">問題を再現してみますか？</font><font style="vertical-align: inherit;">これを行うには、プロジェクトに目的のライブラリ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-System.DirectoryServices-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に接続し、次の</font><font style="vertical-align: inherit;">ようなコードを記述します。</font></font><br>
<br>
<pre><code class="cs hljs">DirectoryEntry de = <span class="hljs-keyword">new</span> DirectoryEntry();<font></font>
de.RefreshCache(<span class="hljs-literal">null</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行するコードを実行し、予想される画像を確認します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d9/040/d0a/2d9040d0ae8d91394c476d6788aa7275.png" alt="写真3"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
楽しみのために、NuGetパッケージのリリースバージョンで問題を再現してみてください。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.DirectoryServices</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージをNuGetプロジェクト</font><font style="vertical-align: inherit;">（バージョン4.5.0を使用）に接続し、既におなじみのコードを実行します。</font><font style="vertical-align: inherit;">結果は低くなります。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d6/31e/309/0d631e3096fa8ba00b41fe10ad1001db.png" alt="写真4"></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題4</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、反対の方向から説明します。まず、クラスのインスタンスを使用するコードを記述してから、内部を調べます。</font><i><font style="vertical-align: inherit;">System.Drawing.Common</font></i><font style="vertical-align: inherit;">ライブラリの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Drawing.CharacterRange</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の構造と</font><font style="vertical-align: inherit;">同じ名前のNuGetパッケージを</font><font style="vertical-align: inherit;">見てみましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
使用されるコードは次のとおりです。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs">CharacterRange range = <span class="hljs-keyword">new</span> CharacterRange();
<span class="hljs-keyword">bool</span> eq = range.Equals(<span class="hljs-literal">null</span>);<font></font>
Console.WriteLine(eq);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
念のため、リフレッシュメモリに、我々はに変わります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から期待されているものの戻り値のリコールに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obj.Equals（ヌル）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の文は、すべての実装のために真でなければならない</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のEquals（Object）を</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド。</font><font style="vertical-align: inherit;">リストでは、x、y、およびzは、nullでないオブジェクト参照を表します。</font></font></i><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.... </font></font></i><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x.Equals（null）はfalseを返します。</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「False」というテキストがコンソールに表示されると思いますか？</font><font style="vertical-align: inherit;">もちろん、それは簡単すぎるでしょう。</font><font style="vertical-align: inherit;">:)コードを実行し、結果を確認します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e87/159/8f6/e871598f6ca5dacdb4a4fae7b5776520.png" alt="写真5"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、NuGetパッケージ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Drawing.Common</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン4.5.1 </font><font style="vertical-align: inherit;">を使用して上記のコードを実行したときの結論</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ライブラリのデバッグバージョンで同じコードを実行すると、次のようになります。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e9/f27/f1a/6e9f27f1a78768078fdd940e0a4be0ad.png" alt="写真6"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、ソースコードでの見てみましょう-の実装は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等しい</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CharacterRangeの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造</font><font style="vertical-align: inherit;">とアナライザの警告：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> obj</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (obj.GetType() != <span class="hljs-keyword">typeof</span>(CharacterRange))
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  CharacterRange cr = (CharacterRange)obj;<font></font>
  <span class="hljs-keyword">return</span> ((_first == cr.First) &amp;&amp; (_length == cr.Length));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3115</font></a><font style="vertical-align: inherit;"> 'null'を 'Equals'メソッドに渡しても、 'NullReferenceException'にならないはずです。 CharacterRange.cs 56 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明する必要があることがわかります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。obj</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターが正しく処理され</font><font style="vertical-align: inherit;">ないため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスメソッドを呼び出すときに条件式で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外</font><i><font style="vertical-align: inherit;">がスローさ</font></i><font style="vertical-align: inherit;">れます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題5</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このライブラリを探索する際に、別の興味深い場所である</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Icon.Save</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを検討して</font><i><font style="vertical-align: inherit;">ください</font></i><font style="vertical-align: inherit;">。調査の前に、方法の説明を参照してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドの説明はありません：</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffd/fef/402/ffdfef402f77c462c94b9ff284f42e0c.png" alt="写真7"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
docs.microsoft.com-" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Icon.Save（Stream）Method</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "に目を向けます。ただし、入力値に制限はなく、生成された例外に関する情報もありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、コード研究に移りましょう。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Icon</span> : 
  <span class="hljs-title">MarshalByRefObject</span>, <span class="hljs-title">ICloneable</span>, <span class="hljs-title">IDisposable</span>, <span class="hljs-title">ISerializable</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Save</span>(<span class="hljs-params">Stream outputStream</span>)</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (_iconData != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      outputStream.Write(_iconData, <span class="hljs-number">0</span>, _iconData.Length);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      ....<font></font>
      <span class="hljs-keyword">if</span> (outputStream == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"dataStream"</span>);<font></font>
      ....<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に、「outputStream」オブジェクトが使用されました。チェック行：654、672。Icon.Windows.cs 654 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をチェックせずにメソッドパラメーターが逆参照されるため、既にわかっているのは、null参照の逆参照の可能性</font><font style="vertical-align: inherit;">です。繰り返しになりますが、状況とクラスとメソッドの両方の適切な組み合わせが公開されているため、問題を再現することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクは簡単です。コードの実行を式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outputStream.Write（_iconData、0、_iconData.Length）;にすることです。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outputStream</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値を保持し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。これを行うには、条件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_iconData！= Nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">満たさ</font><i><font style="vertical-align: inherit;">れれ</font></i><font style="vertical-align: inherit;">ば十分です</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なパブリックコンストラクタを見てみましょう。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Icon</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> fileName</span>) : <span class="hljs-title">this</span>(<span class="hljs-params">fileName, <span class="hljs-number">0</span>, <span class="hljs-number">0</span></span>)</span>
{ }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼は単にその作業を別のコンストラクターに委任するだけです。</font><font style="vertical-align: inherit;">さて、さらに見てください-ここで使用されているコンストラクタ。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Icon</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> fileName, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height</span>) : <span class="hljs-title">this</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (FileStream f <font></font>
           = <span class="hljs-keyword">new</span> FileStream(fileName, FileMode.Open, <font></font>
                            FileAccess.Read, FileShare.Read))<font></font>
  {<font></font>
    Debug.Assert(f != <span class="hljs-literal">null</span>, 
      <span class="hljs-string">"File.OpenRead returned null instead of throwing an exception"</span>);<font></font>
    _iconData = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[(<span class="hljs-keyword">int</span>)f.Length];<font></font>
    f.Read(_iconData, <span class="hljs-number">0</span>, _iconData.Length);<font></font>
  }<font></font>
<font></font>
  Initialize(width, height);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに、あなたが必要とするものがあります。</font><font style="vertical-align: inherit;">このコンストラクターを呼び出した後、ファイルからデータを正常に読み取り、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">クラッシュ</font><font style="vertical-align: inherit;">が発生</font><font style="vertical-align: inherit;">しなかった場合</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_iconData</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">には、必要なオブジェクトへのリンクが含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を再現するに</font><font style="vertical-align: inherit;">は、実際のアイコンを使用して</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Icon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスのインスタンスを作成し、</font><font style="vertical-align: inherit;">次に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出し</font><font style="vertical-align: inherit;">て、引数として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を渡して</font><font style="vertical-align: inherit;">実行する必要があることがわかります。</font><font style="vertical-align: inherit;">たとえば、コードは次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs">Icon icon = <span class="hljs-keyword">new</span> Icon(<span class="hljs-string">@"D:\document.ico"</span>);<font></font>
icon.Save(<span class="hljs-literal">null</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
期待通りの結果。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b37/fdb/dd1/b37fdbdd1288c054fdaaa0add0ffcfcf.png" alt="写真8"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題6</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
レビューを続行し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Management</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリに進みます</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">CimType.UInt32の</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケース</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とそれ以外の</font><i><font style="vertical-align: inherit;">ケースで</font></i><font style="vertical-align: inherit;">実行されるアクションの3つの違いを見つけてください</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> 
  <span class="hljs-title">ConvertToNumericValueAndAddToArray</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">string</span> retFunctionName = <span class="hljs-keyword">string</span>.Empty;<font></font>
  enumType = <span class="hljs-keyword">string</span>.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>(cimType)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> CimType.UInt8:              
    <span class="hljs-keyword">case</span> CimType.SInt8:
    <span class="hljs-keyword">case</span> CimType.SInt16:
    <span class="hljs-keyword">case</span> CimType.UInt16:
    <span class="hljs-keyword">case</span> CimType.SInt32:<font></font>
      arrayToAdd.Add(System.Convert.ToInt32(<font></font>
                       numericValue,<font></font>
                       (IFormatProvider)CultureInfo.InvariantCulture<font></font>
                                                   .GetFormat(<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">int</span>))));<font></font>
      retFunctionName = <span class="hljs-string">"ToInt32"</span>;<font></font>
      enumType = <span class="hljs-string">"System.Int32"</span>;
      <span class="hljs-keyword">break</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> CimType.UInt32:<font></font>
      arrayToAdd.Add(System.Convert.ToInt32(<font></font>
                       numericValue,<font></font>
                       (IFormatProvider)CultureInfo.InvariantCulture<font></font>
                                                   .GetFormat(<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">int</span>))));<font></font>
      retFunctionName = <span class="hljs-string">"ToInt32"</span>;<font></font>
      enumType = <span class="hljs-string">"System.Int32"</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> retFunctionName;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、アナライザーが警告する違いはありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3139</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つ以上のケースブランチが同じアクションを実行します。</font><font style="vertical-align: inherit;">WMIGenerator.cs 5220 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このスタイルのコードは個人的には理解できません。</font><font style="vertical-align: inherit;">ここで間違いがなければ、同じロジックを異なるケースに広げる価値はなかったと思います。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">発行7 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Microsoft.CSharp</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ライブラリ</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> IList&lt;KeyValuePair&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt;&gt;<font></font>
QueryDynamicObject(<span class="hljs-keyword">object</span> obj)<font></font>
{<font></font>
  ....<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; names = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;(mo.GetDynamicMemberNames());<font></font>
  names.Sort();<font></font>
  <span class="hljs-keyword">if</span> (names != <span class="hljs-literal">null</span>)<font></font>
  { .... }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">式 'names！= Null'は常にtrueです。 DynamicDebuggerProxy.cs 426 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">および</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3063診断</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
によって発行された多くの同様の警告と一緒に、この警告をおそらく無視でき</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。多くの（非常に多くの）奇妙なチェックがありましたが、これはどういうわけか私の魂に沈みました。ローカル変数</font><i><font style="vertical-align: inherit;">名</font></i><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">と比較し</font><font style="vertical-align: inherit;">てこの変数</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">比較する前</font><font style="vertical-align: inherit;">に、新しく作成されたオブジェクトへの参照が書き込まれるだけでなく、インスタンスメソッド</font><i><font style="vertical-align: inherit;">Sort</font></i><font style="vertical-align: inherit;">も呼び出される可能性があります</font><font style="vertical-align: inherit;">。もちろんこれは間違いではありませんが、私にとっては興味深い場所です。</font><b><font style="vertical-align: inherit;">問題8</font></b><font style="vertical-align: inherit;"> 
もう1つの興味深いコードがあります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InsertChildNoGrow</span>(<span class="hljs-params">Symbol child</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">while</span> (sym?.nextSameName != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    sym = sym.nextSameName;<font></font>
  }<font></font>
<font></font>
  Debug.Assert(sym != <span class="hljs-literal">null</span> &amp;&amp; sym.nextSameName == <span class="hljs-literal">null</span>);<font></font>
  sym.nextSameName = child;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3042</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NullReferenceExceptionの可能性があります。</font><font style="vertical-align: inherit;">「？」</font><font style="vertical-align: inherit;">と '。' </font><font style="vertical-align: inherit;">演算子は、「sym」オブジェクトのメンバーにアクセスするために使用されます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。</font><font style="vertical-align: inherit;">このサイクルは、次の2つの条件のいずれかが満たされたときに終了します。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sym == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sym.nextSameName == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextSameName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスフィールドへの無条件の呼び出しで</font><font style="vertical-align: inherit;">あり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sym</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、呼び出し中にNullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外が発生</font><font style="vertical-align: inherit;">するため、最初の条件とは言えない2番目の条件に問題はありません</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「あなたは盲目ですか？</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug.Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への呼び出しもあり</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sym！= Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "-誰かが異議</font><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">唱える可能性</font></i><font style="vertical-align: inherit;">があることが検証され</font><font style="vertical-align: inherit;">ます。しかし、それはすべての塩です！</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug.Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のリリースバージョンで作業する場合</font><i><font style="vertical-align: inherit;">、</font></i><font style="vertical-align: inherit;">何も役に立ちません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">上記の状態では、取得されるのは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionだけ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。さらに、Microsoftの別のプロジェクト</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">-Roslyn</font></a><font style="vertical-align: inherit;">でも同様のエラーが発生しました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug.Assertで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常によく似た状況が発生し</font><i><font style="vertical-align: inherit;">ました</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">あなたの許可を得て、Roslynに少し気を取られました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題は</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft.CodeAnalysis</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリを使用するか</font><font style="vertical-align: inherit;">、Syntax Visualizerを使用してVisual Studioで直接</font><font style="vertical-align: inherit;">再現できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Visual Studio 16.1.6 + Syntax Visualizer 1.0では、この問題はまだ再現しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再現するには、次のコードで十分です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">C1</span>&lt;T1, T2&gt;<font></font>
{<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>)</span><font></font>
  {<font></font>
    T1 val = <span class="hljs-keyword">default</span>;
    <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)<font></font>
    { }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Syntax Visualizer </font><font style="vertical-align: inherit;">で、コード内の</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">対応する</font><font style="vertical-align: inherit;">、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConstantPatternSyntaxの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構文ツリーのノードを見つけ、</font><i><font style="vertical-align: inherit;">TypeSymbol</font></i><font style="vertical-align: inherit;">を要求する</font><i><font style="vertical-align: inherit;">必要</font></i><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/855/b9c/baa/855b9cbaa67c9a5909117d513e154293.png" alt="写真9"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、Visual Studioが再起動します。</font><font style="vertical-align: inherit;">イベントビューアを開くと、ライブラリの問題に関する情報が見つかります。</font></font><br>
<br>
<pre><code class="cs hljs">Application: devenv.exe<font></font>
Framework Version: v4<span class="hljs-number">.0</span><span class="hljs-number">.30319</span><font></font>
Description: The process was terminated due to an unhandled exception.<font></font>
Exception Info: <font></font>
  System.Resources.MissingManifestResourceException<font></font>
   at System.Resources.ManifestBasedResourceGroveler<font></font>
                      .HandleResourceStreamMissing(System.String)<font></font>
   at System.Resources.ManifestBasedResourceGroveler.GrovelForResourceSet(<font></font>
        System.Globalization.CultureInfo, <font></font>
        System.Collections.Generic.Dictionary<span class="hljs-string">'2
          &lt;System.String,System.Resources.ResourceSet&gt;, Boolean, Boolean,  
        System.Threading.StackCrawlMark ByRef)
   at System.Resources.ResourceManager.InternalGetResourceSet(
        System.Globalization.CultureInfo, Boolean, Boolean, 
        System.Threading.StackCrawlMark ByRef)
   at System.Resources.ResourceManager.InternalGetResourceSet(
        System.Globalization.CultureInfo, Boolean, Boolean)
   at System.Resources.ResourceManager.GetString(System.String, 
        System.Globalization.CultureInfo)
   at Roslyn.SyntaxVisualizer.DgmlHelper.My.
        Resources.Resources.get_SyntaxNodeLabel()
....</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、devenv.exeの問題について：</font></font><br>
<br>
<pre><code class="cs hljs">Faulting application name:<font></font>
devenv.exe, version: <span class="hljs-number">16.1</span><span class="hljs-number">.29102</span><span class="hljs-number">.190</span>, time stamp: <span class="hljs-number">0x5d1c133b</span><font></font>
Faulting module name:<font></font>
KERNELBASE.dll, version: <span class="hljs-number">10.0</span><span class="hljs-number">.18362</span><span class="hljs-number">.145</span>, time stamp: <span class="hljs-number">0xf5733ace</span>
Exception code: <span class="hljs-number">0xe0434352</span>
Fault offset: <span class="hljs-number">0x001133d2</span>
....</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Roslynライブラリのデバッグバージョンがあると、例外が発生した場所を見つけることができます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Conversion <span class="hljs-title">ClassifyImplicitBuiltInConversionSlow</span>(<span class="hljs-params">
  TypeSymbol source, TypeSymbol destination, 
  <span class="hljs-keyword">ref</span> HashSet&lt;DiagnosticInfo&gt; useSiteDiagnostics</span>)</span><font></font>
{<font></font>
  Debug.Assert((<span class="hljs-keyword">object</span>)source != <span class="hljs-literal">null</span>);<font></font>
  Debug.Assert((<span class="hljs-keyword">object</span>)destination != <span class="hljs-literal">null</span>);<font></font>
<font></font>
   <font></font>
  <span class="hljs-keyword">if</span> (   source.SpecialType == SpecialType.System_Void <font></font>
      || destination.SpecialType == SpecialType.System_Void)<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> Conversion.NoConversion;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、.NET Coreライブラリの上記のコードと同様に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug.Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によるチェックも</font><font style="vertical-align: inherit;">行われていますが、ライブラリのリリースバージョンを使用する場合はまったく役に立ちませんでした。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題9</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
少し気が散った-.NET Coreライブラリに戻るとそれで十分です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.IO.IsolatedStorage</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージに</font><font style="vertical-align: inherit;">は、以下の興味深いコードが含まれています。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ContainsUnknownFiles</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> directory</span>)</span><font></font>
{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">return</span> (files.Length &gt; <span class="hljs-number">2</span> ||<font></font>
    (<font></font>
      (!IsIdFile(files[<span class="hljs-number">0</span>]) &amp;&amp; !IsInfoFile(files[<span class="hljs-number">0</span>]))) ||<font></font>
      (files.Length == <span class="hljs-number">2</span> &amp;&amp; !IsIdFile(files[<span class="hljs-number">1</span>]) &amp;&amp; !IsInfoFile(files[<span class="hljs-number">1</span>]))<font></font>
    );<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告PVS-Studio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3088</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式が括弧で2回囲まれました：（（式））。 1組の括弧が不要であるか、誤植が存在します。 IsolatedStorageFile.cs 839 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードのフォーマットがわかりにくいと言っても、何も言えません。このコードをちらりと見ると、最初の演算子の左側のオペランドは|| - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">files.Length&gt; 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、右がカッコ内のものです。少なくともコードはこのようにフォーマットされています。少し詳しく見てみると、そうではないことがわかります。実際、正しいオペランドは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（（！IsIdFile（files [0]）&amp;&amp;！IsInfoFile（files [0]）））</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。私の意見では、このコードはかなり混乱しています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題10</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
診断ルールがPVS-Studio 7.03リリースで追加されました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3138は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、補間された文字列のエラーを検索します。より正確には、補間される可能性が最も高い行ですが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字</font><font style="vertical-align: inherit;">がない</font><font style="vertical-align: inherit;">ため、そう</font><font style="vertical-align: inherit;">ではありません。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Net</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">は、この診断ルールに対するいくつかの興味深い応答を見つけました。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CacheCredential</span>(<span class="hljs-params">SafeFreeCredentials newHandle</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">try</span><font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> (Exception e)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (!ExceptionCheck.IsFatal(e))<font></font>
    {<font></font>
      NetEventSource.Fail(<span class="hljs-literal">null</span>, <span class="hljs-string">"Attempted to throw: {e}"</span>);<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3138</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列リテラルに補間式が含まれている可能性があります。検査を検討してください：e。 SSPIHandleCache.cs 42 </font><i><font style="vertical-align: inherit;">Fail</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドの2番目の引数</font><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">e</font></i><font style="vertical-align: inherit;">例外の文字列表現が置き換えられた補間文字列でなければならない</font><font style="vertical-align: inherit;">可能性が非常に高く</font><font style="vertical-align: inherit;">なります</font><font style="vertical-align: inherit;">。ただし、</font><i><font style="vertical-align: inherit;">$</font></i><font style="vertical-align: inherit;">文字が</font><font style="vertical-align: inherit;">ない</font><font style="vertical-align: inherit;">ため</font><font style="vertical-align: inherit;">、例外の文字列表現はスローされません。</font><b><font style="vertical-align: inherit;">問題11</font></b><font style="vertical-align: inherit;"> 
別の同様のインシデントが発生しました。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">GetDigestTokenForCredential</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (NetEventSource.IsEnabled)<font></font>
    NetEventSource.Error(digestResponse, <font></font>
                         <span class="hljs-string">"Algorithm not supported: {algorithm}"</span>);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3138</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列リテラルに補間式が含まれている可能性があります。検査を検討してください：アルゴリズム。 AuthenticationHelper.Digest.cs 58 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状況は上記の状況と同様であり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記号</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">欠落し</font><font style="vertical-align: inherit;">ています。無効な文字列が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Error</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドに</font><font style="vertical-align: inherit;">送信さ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題12 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Net.Mail</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パッケージ</font><font style="vertical-align: inherit;">。メソッドは小さいので、エラーをもう少し興味深いものにするために、それを完全に取り入れます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetContent</span>(<span class="hljs-params">Stream stream</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (stream == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(stream));<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (_streamSet)<font></font>
  {<font></font>
    _stream.Close();<font></font>
    _stream = <span class="hljs-literal">null</span>;<font></font>
    _streamSet = <span class="hljs-literal">false</span>;<font></font>
  }<font></font>
<font></font>
  _stream = stream;<font></font>
  _streamSet = <span class="hljs-literal">true</span>;<font></font>
  _streamUsedOnce = <span class="hljs-literal">false</span>;<font></font>
  TransferEncoding = TransferEncoding.Base64;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3008</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「_streamSet」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：123、119。MimePart.cs 123 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_streamSetの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">二重割り当ては奇妙に見えます</font><font style="vertical-align: inherit;">（最初に、条件の下で、次に外部）。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_stream</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数をゼロに</font><i><font style="vertical-align: inherit;">設定する</font></i><font style="vertical-align: inherit;">場合も</font><i><font style="vertical-align: inherit;">同じ</font></i><font style="vertical-align: inherit;">です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その結果、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_stream</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は引き続き</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">設定され</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_streamSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定さ</font><font style="vertical-align: inherit;">れ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題13 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Linq.Expressions</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ライブラリの興味深い場所</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アナライザーはすぐに2つの警告を発行しました。</font><font style="vertical-align: inherit;">この場合、それはバグというより機能ですが、それでも方法は非常に興味深いです...</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">// throws NRE when o is null</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">NullCheck</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> o</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    o.GetType();<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3010</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数「GetType」の戻り値を利用する必要があります。</font><font style="vertical-align: inherit;">Instruction.cs 36</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル逆参照の可能性があります。</font><font style="vertical-align: inherit;">「o」の検査を検討してください。</font><font style="vertical-align: inherit;">Instruction.cs 36</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コメントすることさえおそらくないでしょう。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c9/a88/a22/5c9a88a221d4cd5ba5f4f1d9f74a346b.png" alt="写真20"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題14</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
「外部から」で作業する別のケースを見てみましょう。</font><font style="vertical-align: inherit;">まず、コードを記述し、問題を特定してから、内部を調べます。</font><font style="vertical-align: inherit;">調査するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Configuration.ConfigurationManager</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">と同じ名前のNuGetパッケージを使用してください。</font><font style="vertical-align: inherit;">パッケージバージョン4.5.0を使用しました。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Configuration.CommaDelimitedStringCollection</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスを操作し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それほど難しくないことをしましょう。</font><font style="vertical-align: inherit;">たとえば、オブジェクトを作成し、その文字列表現を抽出し、この文字列の長さを取得して出力します。</font><font style="vertical-align: inherit;">関連コード：</font></font><br>
<br>
<pre><code class="cs hljs">CommaDelimitedStringCollection collection <font></font>
  = <span class="hljs-keyword">new</span> CommaDelimitedStringCollection();<font></font>
Console.WriteLine(collection.ToString().Length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
念のため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの説明を見てください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8dc/544/56d/8dc54456dd1296d89fbe447fac71ac17.png" alt="写真11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
異常なことは何もありません。オブジェクトの文字列表現が単に返されます。</font><font style="vertical-align: inherit;">念のため、docs.microsoft.com-" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CommaDelimitedStringCollection.ToString Method</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">も確認し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">特別なことでもないようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OK、実行のためにコードを実行します、ii ...</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa5/89f/1af/fa589f1afc8ceb9415694e1261e59ab7.png" alt="写真12"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
うーん、予想外。</font><font style="vertical-align: inherit;">それでは、要素をコレクションに追加して、その文字列表現を取得してみましょう。</font><font style="vertical-align: inherit;">「完全に偶然」空の文字列を追加します:)。</font><font style="vertical-align: inherit;">コードが変更され、次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs">CommaDelimitedStringCollection collection <font></font>
  = <span class="hljs-keyword">new</span> CommaDelimitedStringCollection();<font></font>
collection.Add(String.Empty);<font></font>
Console.WriteLine(collection.ToString().Length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはそれを起動して見ます...</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d37/4bc/d2e/d374bcd2ed23bd048276493ed19d30fe.png" alt="写真13"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また何ですか！</font><font style="vertical-align: inherit;">さて、最後</font><font style="vertical-align: inherit;">に</font><i><font style="vertical-align: inherit;">CommaDelimitedStringCollection</font></i><font style="vertical-align: inherit;">クラスの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの実装を見てみましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コードを以下に示します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (Count &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
    StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder();
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>)<font></font>
    {<font></font>
        ThrowIfContainsDelimiter(str);<font></font>
        <span class="hljs-comment">// ....</span><font></font>
        sb.Append(str.Trim());<font></font>
        sb.Append(<span class="hljs-string">','</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (sb.Length &gt; <span class="hljs-number">0</span>) sb.Length = sb.Length - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> sb.Length == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : sb.ToString();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'ToSting（）'メソッドから 'null'を返すことはお勧めしません。</font><font style="vertical-align: inherit;">StringAttributeCollection.cs 57</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'ToSting（）'メソッドから 'null'を返すことはお勧めしません。</font><font style="vertical-align: inherit;">StringAttributeCollection.cs 71</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、現在の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返すことができる</font><font style="vertical-align: inherit;">場所が2つあり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを実装するときにMicrosoftがアドバイスしたことを思い出してください。その</font><font style="vertical-align: inherit;">ため、再びdocs.microsoft.com-" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object.ToString Method</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "：</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">継承者へのメモ.... ToString（）メソッドのオーバーライドは、次のガイドラインに従う必要があります。</font></font></i><ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">....</font></font></i></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString（）オーバーライドは、Emptyまたは</font></font></i><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">文字列を</font></i><i><font style="vertical-align: inherit;">返しません</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">....</font></font></i></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これはPVS-Studioが警告していることです。問題を再現するために記述した上記の2つのコードスニペットは、異なる出口ポイントに到達します</font><font style="vertical-align: inherit;">。それぞれ</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が返される最初と2番目の場所</font><font style="vertical-align: inherit;">です。もう少し掘り下げます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のケース。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カウント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -基本クラスのプロパティ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StringCollectionを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。要素が追加されなかったため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count &lt;= 0の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件が満たされ</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のケースでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のインスタンスメソッド</font><i><font style="vertical-align: inherit;">CommaDelimitedStringCollection.Add</font></i><font style="vertical-align: inherit;">を使用して要素を追加しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> new <span class="hljs-keyword">void</span> <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
{<font></font>
  ThrowIfReadOnly();<font></font>
  ThrowIfContainsDelimiter(<span class="hljs-keyword">value</span>);<font></font>
  _modified = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">base</span>.Add(<span class="hljs-keyword">value</span>.Trim());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThrowIf ...</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドでのチェック</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">正常に</font><i><font style="vertical-align: inherit;">パス</font></i><font style="vertical-align: inherit;">し、アイテムが基本コレクションに追加されます。したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値は</font><font style="vertical-align: inherit;">1になります。ここで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドに戻り</font><font style="vertical-align: inherit;">ます。式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count &lt;= 0の値</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であるため、メソッドから抜け出す方法はなく、コードは引き続き実行されます。内部コレクションの走査が始まり、</font><font style="vertical-align: inherit;">2つの要素が空の文字列とコンマで</font><font style="vertical-align: inherit;">ある</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StringBuilderに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加さ</font><font style="vertical-align: inherit;">れ</font><font style="vertical-align: inherit;">ます。その結果、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sbに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はカンマのみが含まれ、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティの値は</font><font style="vertical-align: inherit;">それぞれ1に等しいことがわかります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sb.Length&gt; 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式の値</font><font style="vertical-align: inherit;">- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、減算、および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sb.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への</font><i><font style="vertical-align: inherit;">書き込みが実行され</font></i><font style="vertical-align: inherit;">、今度は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sb.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値</font><font style="vertical-align: inherit;">が0になります。これにより、メソッドから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再び返されるという事実につながり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題15</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
かなり予期せず、私は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Configuration.ConfigurationProperty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスを使用したいと思いました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ほとんどのパラメーターを使用してコンストラクターを取得します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConfigurationProperty</span>(<span class="hljs-params">
  <span class="hljs-keyword">string</span> name, 
  Type type, 
  <span class="hljs-keyword">object</span> defaultValue, 
  TypeConverter typeConverter, 
  ConfigurationValidatorBase validator, 
  ConfigurationPropertyOptions options, 
  <span class="hljs-keyword">string</span> description</span>)</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のパラメータの説明を見てみましょう：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//   description:</span>
<span class="hljs-comment">//     The description of the configuration entity.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
docs.microsoft.comのコンストラクタの説明でも同じことが言えます。</font><font style="vertical-align: inherit;">さて、このパラメーターがコンストラクター本体でどのように使用されるかを見てみましょう。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConfigurationProperty</span>(<span class="hljs-params">...., <span class="hljs-keyword">string</span> description</span>)</span><font></font>
{<font></font>
    ConstructorInit(name, type, options, validator, typeConverter);<font></font>
<font></font>
    SetDefaultValue(defaultValue);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、パラメーターは使用されません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'description'は使用されません。</font><font style="vertical-align: inherit;">ConfigurationProperty.cs 62 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らはおそらく意図的にそれを使用しませんが、対応するパラメータの説明は混乱を招きます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題16</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
別の同様の場所が出会った。</font><font style="vertical-align: inherit;">自分でエラーを見つけてみてください。コンストラクタのコードは次のとおりです。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-title">SectionXmlInfo</span>(<span class="hljs-params">
    <span class="hljs-keyword">string</span> configKey, <span class="hljs-keyword">string</span> definitionConfigPath, <span class="hljs-keyword">string</span> targetConfigPath, 
    <span class="hljs-keyword">string</span> subPath, <span class="hljs-keyword">string</span> filename, <span class="hljs-keyword">int</span> lineNumber, <span class="hljs-keyword">object</span> streamVersion,
    <span class="hljs-keyword">string</span> rawXml, <span class="hljs-keyword">string</span> configSource, <span class="hljs-keyword">string</span> configSourceStreamName, 
    <span class="hljs-keyword">object</span> configSourceStreamVersion, <span class="hljs-keyword">string</span> protectionProviderName, 
    OverrideModeSetting overrideMode, <span class="hljs-keyword">bool</span> skipInChildApps</span>)</span><font></font>
{<font></font>
    ConfigKey = configKey;<font></font>
    DefinitionConfigPath = definitionConfigPath;<font></font>
    TargetConfigPath = targetConfigPath;<font></font>
    SubPath = subPath;<font></font>
    Filename = filename;<font></font>
    LineNumber = lineNumber;<font></font>
    StreamVersion = streamVersion;<font></font>
    RawXml = rawXml;<font></font>
    ConfigSource = configSource;<font></font>
    ConfigSourceStreamName = configSourceStreamName;<font></font>
    ProtectionProviderName = protectionProviderName;<font></font>
    OverrideModeSetting = overrideMode;<font></font>
    SkipInChildApps = skipInChildApps;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'configSourceStreamVersion'は使用されません。</font><font style="vertical-align: inherit;">SectionXmlInfo.cs 16 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
対応するプロパティがありますが、少し奇妙に見えます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">object</span> ConfigSourceStreamVersion<font></font>
{<font></font>
  <span class="hljs-keyword">set</span> { }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、コードは疑わしく見えます。おそらく、パラメータ/プロパティは互換性のために残されましたが、これらは私の推測にすぎません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題17 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Runtime.WindowsRuntime.UI.Xaml</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ライブラリ</font><font style="vertical-align: inherit;">と同じ名前のNuGetパッケージの</font><font style="vertical-align: inherit;">コードで興味深いものが見つかったのか見てみましょう</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> RepeatBehavior : IFormattable<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> InternalToString(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'ToSting（）'メソッドから 'null'を返すことはお勧めしません。 RepeatBehavior.cs 113 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おなじみの話ですが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返すことがあり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。このため、呼び出しコードの作成者は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RepeatBehavior.ToStringが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常にゼロ以外の参照を返す</font><font style="vertical-align: inherit;">と想定している</font><i><font style="vertical-align: inherit;">ため</font></i><font style="vertical-align: inherit;">、ある時点で不愉快に驚くかもしれません。繰り返しになりますが、これはマイクロソフトのガイドラインからの逸脱です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、このメソッドからのみ、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返すことができる</font><font style="vertical-align: inherit;">かどうか</font><font style="vertical-align: inherit;">は明確ではありません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">詳しく調べて、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InternalToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを調べる必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">string</span> <span class="hljs-title">InternalToString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> format, IFormatProvider formatProvider</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">switch</span> (_Type)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> RepeatBehaviorType.Forever:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"Forever"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> RepeatBehaviorType.Count:<font></font>
      StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder();<font></font>
      sb.AppendFormat(<font></font>
        formatProvider,<font></font>
        <span class="hljs-string">"{0:"</span> + format + <span class="hljs-string">"}x"</span>,<font></font>
        _Count);<font></font>
      <span class="hljs-keyword">return</span> sb.ToString();<font></font>
<font></font>
    <span class="hljs-keyword">case</span> RepeatBehaviorType.Duration:
      <span class="hljs-keyword">return</span> _Duration.ToString();<font></font>
<font></font>
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザー</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">デフォルトの</font></i><font style="vertical-align: inherit;">分岐が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイッチ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">実行される</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">InternalToString</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">を返す</font><font style="vertical-align: inherit;">ため、</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">も</font><i><font style="vertical-align: inherit;">ToStringを</font></i><font style="vertical-align: inherit;">返す</font><font style="vertical-align: inherit;">ことを発見しました</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">RepeatBehavior</font></i><font style="vertical-align: inherit;">はパブリック構造であり、</font><i><font style="vertical-align: inherit;">ToString</font></i><font style="vertical-align: inherit;">はパブリックメソッドであるため、実際に問題を再現することができます。これを行うために、インスタンスの作成</font><i><font style="vertical-align: inherit;">RepeatBehaviorを</font></i><font style="vertical-align: inherit;">、呼び出し</font><i><font style="vertical-align: inherit;">たToString</font></i><font style="vertical-align: inherit;">それに対してメソッドを</font><font style="vertical-align: inherit;">、しかし、それを覚えて</font><i><font style="vertical-align: inherit;">_Typeが</font></i><font style="vertical-align: inherit;">等しくあってはならない</font><i><font style="vertical-align: inherit;">RepeatBehaviorType.Forever</font></i><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">RepeatBehaviorType.Count</font></i><font style="vertical-align: inherit;">か</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RepeatBehaviorType.Duration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Type</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、パブリックプロパティを通じて割り当てることができるプライベートフィールドです。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> RepeatBehavior : IFormattable<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> RepeatBehaviorType _Type;<font></font>
  ....<font></font>
  <span class="hljs-keyword">public</span> RepeatBehaviorType Type<font></font>
  {<font></font>
    <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _Type; }
    <span class="hljs-keyword">set</span> { _Type = <span class="hljs-keyword">value</span>; }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、すべてがよさそうです。</font><font style="vertical-align: inherit;">では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RepeatBehaviorType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型を見て</font><i><font style="vertical-align: inherit;">みましょ</font></i><font style="vertical-align: inherit;">う</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> RepeatBehaviorType<font></font>
{<font></font>
  Count,<font></font>
  Duration,<font></font>
  Forever<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RepeatBehaviorType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は3つの要素すべてを含む列挙型です。</font><font style="vertical-align: inherit;">さらに、これらの3つの要素はすべて、必須の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switchステートメントで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カバーされてい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ただし、これは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランチに到達でき</font><font style="vertical-align: inherit;">ないことを意味するものではありません</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を再現するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Runtime.WindowsRuntime.UI.Xaml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージをプロジェクト</font><font style="vertical-align: inherit;">（バージョン4.3.0を使用）に接続し、次のコードを実行します。</font></font><br>
<br>
<pre><code class="cs hljs">RepeatBehavior behavior = <span class="hljs-keyword">new</span> RepeatBehavior()<font></font>
{<font></font>
    Type = (RepeatBehaviorType)<span class="hljs-number">666</span><font></font>
};<font></font>
Console.WriteLine(behavior.ToString() <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>);</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
がコンソール</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">出力されることが期待されています</font><font style="vertical-align: inherit;">。つまり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返しまし</font><font style="vertical-align: inherit;">た。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Typeは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">case</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランチの</font><font style="vertical-align: inherit;">どの値とも等しくなく</font><font style="vertical-align: inherit;">、制御は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランチに渡されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">実際、私たちが求めていたもの。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、メソッドのコメントにも</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にも、メソッドが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返すことができることを示している</font><font style="vertical-align: inherit;">ことにも注意してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題18</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Private.DataContractSerialization</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からのいくつかの警告を</font><i><font style="vertical-align: inherit;">見てみましょう</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CharType</span><font></font>
{<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> None = <span class="hljs-number">0x00</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> FirstName = <span class="hljs-number">0x01</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> Name = <span class="hljs-number">0x02</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> Whitespace = <span class="hljs-number">0x04</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> Text = <span class="hljs-number">0x08</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> AttributeText = <span class="hljs-number">0x10</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> SpecialWhitespace = <span class="hljs-number">0x20</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">byte</span> Comment = <span class="hljs-number">0x40</span>;<font></font>
}<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] s_charType = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">256</span>]<font></font>
{<font></font>
  ....<font></font>
  CharType.None,<font></font>
  <span class="hljs-comment">/*  9 (.) */</span><font></font>
  CharType.None|<font></font>
  CharType.Comment|<font></font>
  CharType.Comment|<font></font>
  CharType.Whitespace|<font></font>
  CharType.Text|<font></font>
  CharType.SpecialWhitespace,<font></font>
  <span class="hljs-comment">/*  A (.) */</span><font></font>
  CharType.None|<font></font>
  CharType.Comment|<font></font>
  CharType.Comment|<font></font>
  CharType.Whitespace|<font></font>
  CharType.Text|<font></font>
  CharType.SpecialWhitespace,<font></font>
  <span class="hljs-comment">/*  B (.) */</span><font></font>
  CharType.None,<font></font>
  <span class="hljs-comment">/*  C (.) */</span><font></font>
  CharType.None,<font></font>
  <span class="hljs-comment">/*  D (.) */</span>                       <font></font>
  CharType.None|<font></font>
  CharType.Comment|<font></font>
  CharType.Comment|<font></font>
  CharType.Whitespace,<font></font>
  <span class="hljs-comment">/*  E (.) */</span><font></font>
  CharType.None,<font></font>
  ....<font></font>
};</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">V3001</a> There are identical sub-expressions 'CharType.Comment' to the left and to the right of the '|' operator. XmlUTF8TextReader.cs 56</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">V3001</a> There are identical sub-expressions 'CharType.Comment' to the left and to the right of the '|' operator. XmlUTF8TextReader.cs 58</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">V3001</a> There are identical sub-expressions 'CharType.Comment' to the left and to the right of the '|' operator. XmlUTF8TextReader.cs 64</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CharType.Comment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式の使用が疑わしいと判断しました</font><i><font style="vertical-align: inherit;">。 CharType.Comment</font></i><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（CharType.Comment | CharType.Comment）== CharType.Commentなので</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、少し奇妙に見え</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CharType.Comment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する配列の他の要素を初期化する場合、その</font><font style="vertical-align: inherit;">ような重複はありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第19号</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
続き。</font><font style="vertical-align: inherit;">メソッドの説明とdocs.microsoft.com-" </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">XmlBinaryWriterSession.TryAdd（XmlDictionaryString、Int32）メソッド</font></a><font style="vertical-align: inherit;"> "で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlBinaryWriterSession.TryAdd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの戻り値に関する情報を見てみましょう</font><font style="vertical-align: inherit;">：</font><i><font style="vertical-align: inherit;">戻り値：文字列を追加できた場合はtrue。それ以外の場合はfalse。</font></i><font style="vertical-align: inherit;"> 
次に、メソッドの本体を見てみましょう。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">TryAdd</span>(<span class="hljs-params">XmlDictionaryString <span class="hljs-keyword">value</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">int</span> key</span>)</span><font></font>
{<font></font>
  IntArray keys;<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">throw</span> System.Runtime<font></font>
                .Serialization<font></font>
                .DiagnosticUtility<font></font>
                .ExceptionUtility<font></font>
                .ThrowHelperArgumentNull(<span class="hljs-keyword">nameof</span>(<span class="hljs-keyword">value</span>));<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (_maps.TryGetValue(<span class="hljs-keyword">value</span>.Dictionary, <span class="hljs-keyword">out</span> keys))<font></font>
  {<font></font>
    key = (keys[<span class="hljs-keyword">value</span>.Key] - <span class="hljs-number">1</span>);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (key != <span class="hljs-number">-1</span>)<font></font>
    {<font></font>
      <span class="hljs-comment">// If the key is already set, then something is wrong</span>
      <span class="hljs-keyword">throw</span> System.Runtime<font></font>
                  .Serialization<font></font>
                  .DiagnosticUtility<font></font>
                  .ExceptionUtility<font></font>
                  .ThrowHelperError(<font></font>
                    <span class="hljs-keyword">new</span> InvalidOperationException(<font></font>
                          SR.XmlKeyAlreadyExists));<font></font>
    }<font></font>
<font></font>
    key = Add(<span class="hljs-keyword">value</span>.Value);<font></font>
    keys[<span class="hljs-keyword">value</span>.Key] = (key + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  key = Add(<span class="hljs-keyword">value</span>.Value);<font></font>
  keys = AddKeys(<span class="hljs-keyword">value</span>.Dictionary, <span class="hljs-keyword">value</span>.Key + <span class="hljs-number">1</span>);<font></font>
  keys[<span class="hljs-keyword">value</span>.Key] = (key + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3009</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このメソッドが常に1つの同じ値「true」を返すのは奇妙です。 XmlBinaryWriterSession.cs 29 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返すか</font><font style="vertical-align: inherit;">例外をスローするが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返さないのは</font><font style="vertical-align: inherit;">奇妙に見え</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題20</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
同様の問題のあるコード</font><b><font style="vertical-align: inherit;">に</font></b><font style="vertical-align: inherit;">出会いましたが、今ではその逆です-常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">OnHandleReference</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (xmlWriter.depth &lt; depthToCheckCyclicReference)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (canContainCyclicReference)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_byValObjectsInScope.Contains(obj))
            <span class="hljs-keyword">throw</span> ....;<font></font>
        _byValObjectsInScope.Push(obj);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3009</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このメソッドが常に1つの同じ値「false」を返すのは奇妙です。</font><font style="vertical-align: inherit;">XmlObjectSerializerWriteContext.cs 415 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、すでに長い道のりを進んでいるのです！</font><font style="vertical-align: inherit;">したがって、続行する前に、短い休憩を取ることをお勧めします-筋肉を伸ばし、少し歩き、目を休ませ、窓の外を見てください...</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/008/d6a/92d/008d6a92d6f4cf4066e744e4c857b47d.png" alt="画像21"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点であなたが再び元気になっているといいので、続けましょう。</font><font style="vertical-align: inherit;">:) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題21 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Security.Cryptography.Algorithms</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロジェクトの興味深い場所を見てみましょう</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">GenerateMask</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] rgbSeed, <span class="hljs-keyword">int</span> cbReturn</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (HashAlgorithm hasher <font></font>
    = (HashAlgorithm)CryptoConfig.CreateFromName(_hashNameValue))<font></font>
  {<font></font>
    <span class="hljs-keyword">byte</span>[] rgbCounter = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">byte</span>[] rgbT = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[cbReturn];<font></font>
<font></font>
    <span class="hljs-keyword">uint</span> counter = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> ib = <span class="hljs-number">0</span>; ib &lt; rgbT.Length;)<font></font>
    {<font></font>
      <span class="hljs-comment">//  Increment counter -- up to 2^32 * sizeof(Hash)</span><font></font>
      Helpers.ConvertIntToByteArray(counter++, rgbCounter);<font></font>
      hasher.TransformBlock(rgbSeed, <span class="hljs-number">0</span>, rgbSeed.Length, rgbSeed, <span class="hljs-number">0</span>);<font></font>
      hasher.TransformFinalBlock(rgbCounter, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);
      <span class="hljs-keyword">byte</span>[] hash = hasher.Hash;<font></font>
      hasher.Initialize();<font></font>
      Buffer.BlockCopy(hash, <span class="hljs-number">0</span>, rgbT, ib, <font></font>
                       Math.Min(rgbT.Length - ib, hash.Length));<font></font>
<font></font>
      ib += hasher.Hash.Length;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> rgbT;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能性のあるnull逆参照。 「ハッシャー」の検査を検討してください。 PKCS1MaskGenerationMethod.cs 37 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasher.TransformBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式を評価するとき</font><font style="vertical-align: inherit;">に、</font><i><font style="vertical-align: inherit;">hasher</font></i><font style="vertical-align: inherit;">変数の値</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">なる可能性があることを</font><i><font style="vertical-align: inherit;">警告し</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">スローされ</font></i><font style="vertical-align: inherit;">ます。この警告の出現は、手続き間の分析のおかげで可能になりました。</font><font style="vertical-align: inherit;">
したがって、</font><font style="vertical-align: inherit;">この場合</font><font style="vertical-align: inherit;">の</font><i><font style="vertical-align: inherit;">ハッシュ</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">なる可能性がある</font><font style="vertical-align: inherit;">かどうかを理解するには</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">CreateFromName</font></i><font style="vertical-align: inherit;">メソッドに</font><i><font style="vertical-align: inherit;">移動</font></i><font style="vertical-align: inherit;">する必要があります</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span> <span class="hljs-title">CreateFromName</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> CreateFromName(name, <span class="hljs-literal">null</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、何もない-私たちはより深く行きます。</font><font style="vertical-align: inherit;">2つのパラメーターを持つ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFromName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のオーバーロードされたバージョンの本体</font><font style="vertical-align: inherit;">は非常に大きいため、要約バージョン</font><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">用意</font></i><font style="vertical-align: inherit;">しています。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span> <span class="hljs-title">CreateFromName</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">params</span> <span class="hljs-keyword">object</span>[] args</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (retvalType == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (cons == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (candidates.Count == <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (rci == <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span>(Delegate).IsAssignableFrom(rci.DeclaringType))<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-keyword">return</span> retval;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、メソッドには</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明示的に返される出口点がいくつかあり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、少なくとも理論的には、警告が発行された前述のメソッドでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外が発生する可能性があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理論は良いですが、問題を実践してみましょう。</font><font style="vertical-align: inherit;">これを行うには、元の方法をもう一度見て、重要な点に注意してください。</font><font style="vertical-align: inherit;">メソッドからの無関係なコードは削減可能です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PKCS1MaskGenerationMethod</span> : .... <span class="hljs-comment">// &lt;= 1</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PKCS1MaskGenerationMethod</span>(<span class="hljs-params"></span>) <span class="hljs-comment">// &lt;= 2</span></span><font></font>
  {<font></font>
    _hashNameValue = DefaultHash;<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">GenerateMask</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] rgbSeed, <span class="hljs-keyword">int</span> cbReturn</span>) <span class="hljs-comment">// &lt;= 3</span></span><font></font>
  {<font></font>
    <span class="hljs-keyword">using</span> (HashAlgorithm hasher <font></font>
      = (HashAlgorithm)CryptoConfig.CreateFromName(_hashNameValue)) <span class="hljs-comment">// &lt;= 4</span><font></font>
    {<font></font>
        <span class="hljs-keyword">byte</span>[] rgbCounter = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">4</span>];
        <span class="hljs-keyword">byte</span>[] rgbT = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[cbReturn]; <span class="hljs-comment">// &lt;= 5</span><font></font>
<font></font>
        <span class="hljs-keyword">uint</span> counter = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> ib = <span class="hljs-number">0</span>; ib &lt; rgbT.Length;) <span class="hljs-comment">// &lt;= 6</span><font></font>
        {<font></font>
            ....<font></font>
            Helpers.ConvertIntToByteArray(counter++, rgbCounter); <span class="hljs-comment">// &lt;= 7</span>
            hasher.TransformBlock(rgbSeed, <span class="hljs-number">0</span>, rgbSeed.Length, rgbSeed, <span class="hljs-number">0</span>);<font></font>
            ....<font></font>
        }<font></font>
        ....<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キーポイントをもう少し詳しく検討してみましょう：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1、3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。クラスとメソッドには</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パブリック</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクセス</font><i><font style="vertical-align: inherit;">修飾子があり</font></i><font style="vertical-align: inherit;">ます。したがって、ライブラリを接続するときにこのインターフェイスを使用できます。問題を再現することができます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">２</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。クラス-非抽象インスタンスにはパブリックコンストラクターがあります-処理するインスタンスを簡単に作成できます。私が調べたいくつかのケースでは、クラスは抽象的だったので、問題を繰り返すために、相続人とそれらを取得する方法を探す必要がありました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">４</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFromName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は例外をスローしてはならず</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返す必要があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。最も重要な点は、後でそれに戻ることです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5、6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">CbReturn</font></i><font style="vertical-align: inherit;">値</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 0でなければなりません（もちろん、アレイを正常に作成するための適切な制限内です）。</font><font style="vertical-align: inherit;">条件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cbReturn&gt; 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を満たすことは、追加条件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ib &lt;rgbT.Lengthを満たし</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ループ本体に入る</font><font style="vertical-align: inherit;">のに必要</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">７</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helpres.ConvertIntToByteArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は例外なく</font><i><font style="vertical-align: inherit;">機能する</font></i><font style="vertical-align: inherit;">はずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドのパラメーターに応じて条件を満たすには、適切な引数を渡すだけで十分です。次に例を示します。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rgbCeed-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいバイト[] {0、1、2、3}。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cbReturn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -42。</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptoConfig.CreateFromName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドを「妥協」するに</font><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_hashNameValue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドの値を変更できる必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">幸いなことに、このフィールドのラッパープロパティがクラスで定義されているため、存在します。</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> HashName<font></font>
{<font></font>
  <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _hashNameValue; }
  <span class="hljs-keyword">set</span> { _hashNameValue = <span class="hljs-keyword">value</span> ?? DefaultHash; }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HashName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（より正確には</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_hashNameValue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">
「合成」値を設定する</font><font style="vertical-align: inherit;">こと</font><font style="vertical-align: inherit;">で、最初にマークした戻り点</font><font style="vertical-align: inherit;">の</font><i><font style="vertical-align: inherit;">CreateFromName</font></i><font style="vertical-align: inherit;">メソッドから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">取得できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この方法は非常に長いので、詳細には触れません（ご容赦ください）。</font><font style="vertical-align: inherit;">
その結果、</font><i><font style="vertical-align: inherit;">NullReferenceException</font></i><font style="vertical-align: inherit;">型の例外をスローするコードは次の</font><font style="vertical-align: inherit;">ようになります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs">PKCS1MaskGenerationMethod tempObj = <span class="hljs-keyword">new</span> PKCS1MaskGenerationMethod();<font></font>
tempObj.HashName = <span class="hljs-string">"Dummy"</span>;<font></font>
tempObj.GenerateMask(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[] { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> }, <span class="hljs-number">42</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバッグライブラリをプロジェクトに接続して実行し、期待される結果を取得します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ab/384/8e5/2ab3848e542172cd92a7e03f55bba9fe.png" alt="写真10"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味を引くために、NuGetパッケージバージョン4.3.1で同じコードを実行しようとしました。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b4/a94/766/7b4a947666444496ca077e7530415c76.png" alt="写真14"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成された例外に関する情報、メソッドの説明における出力パラメーターの制限は、docs.microsoft.comにも記載されていません-" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKCS1MaskGenerationMethod.GenerateMask（Byte []、Int32）Method</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、記事の執筆と問題の再生シーケンスの説明の最中に、この方法を「壊す」ための2つの方法が見つかりました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数として</font><font style="vertical-align: inherit;">大きすぎる値</font><font style="vertical-align: inherit;">を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cbReturnに渡し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rgbSeed</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">渡し</font></i><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のケースでは、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OutOfMemoryExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外が発生し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c50/474/7f9/c504747f9a771843da10a128866811dd.png" alt="写真15"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のケースでは</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">rgbSeed.Length</font></i><font style="vertical-align: inherit;">式が</font><i><font style="vertical-align: inherit;">実行されると</font></i><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外が発生し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">この場合、</font><i><font style="vertical-align: inherit;">ハッシュが</font></i><font style="vertical-align: inherit;">ゼロ以外の値である</font><font style="vertical-align: inherit;">ことが重要</font><font style="vertical-align: inherit;">です。そうでない場合、実行のスレッドは</font><i><font style="vertical-align: inherit;">rgbSeed.Lengthに</font></i><font style="vertical-align: inherit;">到達しません</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">第22号</font></b><font style="vertical-align: inherit;"> 
いくつかの類似した場所に会った。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SignatureDescription</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> FormatterAlgorithm { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> DeformatterAlgorithm { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SignatureDescription</span>(<span class="hljs-params"></span>)</span><font></font>
  {<font></font>
  }<font></font>
<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> AsymmetricSignatureDeformatter <span class="hljs-title">CreateDeformatter</span>(<span class="hljs-params">
    AsymmetricAlgorithm key</span>)</span><font></font>
  {<font></font>
    AsymmetricSignatureDeformatter item = (AsymmetricSignatureDeformatter)<font></font>
      CryptoConfig.CreateFromName(DeformatterAlgorithm);<font></font>
    item.SetKey(key); <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">return</span> item;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> AsymmetricSignatureFormatter <span class="hljs-title">CreateFormatter</span>(<span class="hljs-params">
    AsymmetricAlgorithm key</span>)</span><font></font>
  {<font></font>
    AsymmetricSignatureFormatter item = (AsymmetricSignatureFormatter)<font></font>
      CryptoConfig.CreateFromName(FormatterAlgorithm);<font></font>
    item.SetKey(key); <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">return</span> item;<font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル逆参照の可能性があります。</font><font style="vertical-align: inherit;">「アイテム」の検査を検討してください。</font><font style="vertical-align: inherit;">SignatureDescription.cs 31</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル逆参照の可能性があります。</font><font style="vertical-align: inherit;">「アイテム」の検査を検討してください。</font><font style="vertical-align: inherit;">SignatureDescription.cs 38</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも、</font><i><font style="vertical-align: inherit;">CryptoConfig.CreateFromName</font></i><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">CreateDeformatter</font></i><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">CreateFormatter</font></i><font style="vertical-align: inherit;">メソッドで</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">返す</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FormatterAlgorithm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ</font><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeformatterAlgorithm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティに</font><font style="vertical-align: inherit;">値を</font><font style="vertical-align: inherit;">書き込むことができ</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。次に、インスタンスメソッド</font><i><font style="vertical-align: inherit;">SetKeyを呼び出すと、NullReferenceException</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">スローされ</font></i><font style="vertical-align: inherit;">ます。この問題も、実際には簡単に再現できます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs">SignatureDescription signature = <span class="hljs-keyword">new</span> SignatureDescription()<font></font>
{<font></font>
    DeformatterAlgorithm = <span class="hljs-string">"Dummy"</span>,<font></font>
    FormatterAlgorithm = <span class="hljs-string">"Dummy"</span><font></font>
};<font></font>
<font></font>
signature.CreateDeformatter(<span class="hljs-literal">null</span>); <span class="hljs-comment">// NRE</span>
signature.CreateFormatter(<span class="hljs-literal">null</span>);   <span class="hljs-comment">// NRE</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateDeformatterを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出すとき</font><font style="vertical-align: inherit;">、および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFormatterを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出すときに</font><font style="vertical-align: inherit;">、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外</font><i><font style="vertical-align: inherit;">がスローされ</font></i><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題23 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Private.Xml</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロジェクトの興味深い場所を見てみましょう</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteBase64</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] buffer, <span class="hljs-keyword">int</span> index, <span class="hljs-keyword">int</span> count</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (!_inAttr &amp;&amp; (_inCDataSection || StartCDataSection()))<font></font>
    _wrapped.WriteBase64(buffer, index, count);<font></font>
  <span class="hljs-keyword">else</span><font></font>
    _wrapped.WriteBase64(buffer, index, count);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「then」ステートメントは「else」ステートメントと同等です。</font><font style="vertical-align: inherit;">QueryOutputWriterV1.cs 242 </font><i><font style="vertical-align: inherit;">ifステートメントの</font></i><i><font style="vertical-align: inherit;">then</font></i><font style="vertical-align: inherit;">ブランチ</font><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">else</font></i><font style="vertical-align: inherit;">ブランチに</font><font style="vertical-align: inherit;">同じコードが含ま</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
れているのは奇妙に見え</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">エラーがあり、ブランチの1つが別のアクションを想定しているか、</font><i><font style="vertical-align: inherit;">ifステートメント</font></i><font style="vertical-align: inherit;">を省略できます。</font><b><font style="vertical-align: inherit;">戸建24</font></b></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Depends</span>(<span class="hljs-params">XmlSchemaObject item, ArrayList refs</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (content <span class="hljs-keyword">is</span> XmlSchemaSimpleTypeRestriction)<font></font>
  {<font></font>
    baseType = ((XmlSchemaSimpleTypeRestriction)content).BaseType;<font></font>
    baseName = ((XmlSchemaSimpleTypeRestriction)content).BaseTypeName;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (content <span class="hljs-keyword">is</span> XmlSchemaSimpleTypeList)<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (content <span class="hljs-keyword">is</span> XmlSchemaSimpleTypeRestriction)<font></font>
  {<font></font>
    baseName = ((XmlSchemaSimpleTypeRestriction)content).BaseTypeName;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t == <span class="hljs-keyword">typeof</span>(XmlSchemaSimpleTypeUnion))<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3003</font></a><font style="vertical-align: inherit;"> 'if（A）{...} else if（A）{...}'パターンの使用が検出されました。</font><font style="vertical-align: inherit;">論理エラーが存在する可能性があります。</font><font style="vertical-align: inherit;">チェック行：381、396。ImportContext.cs 381 </font><i><font style="vertical-align: inherit;">if-else-if</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
シーケンスに</font><font style="vertical-align: inherit;">は2つの同一の条件式</font><i><font style="vertical-align: inherit;">があり</font></i><font style="vertical-align: inherit;">ます。</font><i><font style="vertical-align: inherit;">コンテンツはXmlSchemaSimpleTypeRestriction</font></i><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">さらに興味深いことに、</font><i><font style="vertical-align: inherit;">then-</font></i><font style="vertical-align: inherit;">対応するオペレータの枝体は、式の異なるセットが含まれています。</font><font style="vertical-align: inherit;">何らかの方法で、最初に対応する</font><i><font style="vertical-align: inherit;">then</font></i><font style="vertical-align: inherit;">分岐</font><font style="vertical-align: inherit;">の本体が実行されるか</font><font style="vertical-align: inherit;">（条件式がtrueの場合）、または対応する式がfalseの場合はどちらも</font><font style="vertical-align: inherit;">実行され</font><font style="vertical-align: inherit;">ません。</font><b><font style="vertical-align: inherit;">戸建25</font></b></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の方法でエラーを探すのをもっと面白くするために、私は彼の全身を持っていきます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">MatchesXmlType</span>(<span class="hljs-params">IList&lt;XPathItem&gt; seq, <span class="hljs-keyword">int</span> indexType</span>)</span><font></font>
{<font></font>
  XmlQueryType typBase = GetXmlType(indexType);<font></font>
  XmlQueryCardinality card;<font></font>
<font></font>
  <span class="hljs-keyword">switch</span> (seq.Count)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: card = XmlQueryCardinality.Zero; <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: card = XmlQueryCardinality.One; <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>: card = XmlQueryCardinality.More; <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!(card &lt;= typBase.Cardinality))
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  typBase = typBase.Prime;<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; seq.Count; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (!CreateXmlType(seq[<span class="hljs-number">0</span>]).IsSubtypeOf(typBase))
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完了したら、おめでとうございます！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そうでない場合、PVS-Studioの警告が役立ちます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。V3102</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループ内の定数インデックスによる「seq」オブジェクトの要素への不審なアクセス。 XmlQueryRuntime.cs 738 </font><i><font style="vertical-align: inherit;">for</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ループが</font><font style="vertical-align: inherit;">実行され</font><font style="vertical-align: inherit;">、式</font><i><font style="vertical-align: inherit;">i &lt;seq.Count</font></i><font style="vertical-align: inherit;">が終了条件として使用されます</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">seq</font></i><font style="vertical-align: inherit;">のシーケンスをバイパスしたいことを示唆してい</font><font style="vertical-align: inherit;">ます。ただし、ループ内でのみ、カウンター（</font><i><font style="vertical-align: inherit;">seq [i]</font></i><font style="vertical-align: inherit;">）を使用せず、数値リテラル-ゼロ（</font><i><font style="vertical-align: inherit;">seq [0]</font></i><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を使用してシーケンスの要素にアクセスします</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">問題26</font></b><font style="vertical-align: inherit;"> 
次のエラーは小さなコードに収まりますが、そのためにそれほど興味深いものではありません。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteValue</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
{<font></font>
  WriteValue(<span class="hljs-keyword">value</span>);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3110</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「WriteValue」メソッド内で無限の再帰が</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">発生する</font></a><font style="vertical-align: inherit;">可能性があります。 XmlAttributeCache.cs 166 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドはそれ自体を呼び出すため、終了条件なしで再帰を形成します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戸建27</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IList&lt;XPathNavigator&gt; <span class="hljs-title">DocOrderDistinct</span>(<span class="hljs-params">IList&lt;XPathNavigator&gt; seq</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (seq.Count &lt;= <span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> seq;<font></font>
<font></font>
  XmlQueryNodeSequence nodeSeq = (XmlQueryNodeSequence)seq;<font></font>
  <span class="hljs-keyword">if</span> (nodeSeq == <span class="hljs-literal">null</span>)<font></font>
    nodeSeq = <span class="hljs-keyword">new</span> XmlQueryNodeSequence(seq);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> nodeSeq.DocOrderDistinct(_docOrderCmp);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に 'seq'オブジェクトが使用されました。チェック行：880、884。XmlQueryRuntime.cs 880 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
引数として、メソッドは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値を</font><font style="vertical-align: inherit;">受け取る</font><font style="vertical-align: inherit;">こと</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">あり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。そのため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティを呼び出すと、</font><font style="vertical-align: inherit;">タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外が</font><i><font style="vertical-align: inherit;">スローされ</font></i><font style="vertical-align: inherit;">ます。以下では</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">seq</font></i><font style="vertical-align: inherit;">の明示的なキャストの結果として取得された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodeSeq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を確認します</font><font style="vertical-align: inherit;">が、なぜそれが存在するのかは明確ではありません。</font><i><font style="vertical-align: inherit;">seq</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">nullの</font></i><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、例外のため、スレッドはこのチェックに到達しません。</font><i><font style="vertical-align: inherit;">seq</font></i><font style="vertical-align: inherit;">の値が</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">ない</font><font style="vertical-align: inherit;">場合、次のようになります</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャストが失敗した場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidCastException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外が</font><i><font style="vertical-align: inherit;">スロー</font></i><font style="vertical-align: inherit;">されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャストが成功した場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodeSeqは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確実に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以外の値になり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
未使用のパラメーターがあった</font><b><font style="vertical-align: inherit;">28の</font></b><font style="vertical-align: inherit;"> Met 4デザイナーを</font><b><font style="vertical-align: inherit;">発行し</font></b><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">互換性のために残された可能性がありますが、これらの未使用のパラメーターに関するコメントは見つかりませんでした。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'securityUrl'は使用されません。</font><font style="vertical-align: inherit;">XmlSecureResolver.cs 15</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'strdata'は使用されません。</font><font style="vertical-align: inherit;">XmlEntity.cs 18</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'location'は使用されません。</font><font style="vertical-align: inherit;">Compilation.cs 58</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'access'は使用されません。</font><font style="vertical-align: inherit;">XmlSerializationILGen.cs 38</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のものは私に最も興味を持っていました（少なくとも私は記事の警告のリストにそれを書きました）。</font><font style="vertical-align: inherit;">より？</font><font style="vertical-align: inherit;">わからない。</font><font style="vertical-align: inherit;">おそらく名前。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">XmlSecureResolver</span>(<span class="hljs-params">XmlResolver resolver, <span class="hljs-keyword">string</span> securityUrl</span>)</span><font></font>
{<font></font>
  _resolver = resolver;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関心のために、私は彼らがdocs.microsoft.comに書くものを見るために行ってきました- 「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlSecureResolverコンストラクタ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」について</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">securityUrlの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URLは、基礎となるXmlResolverのに適用されることのPermissionSetを作成するために使用されます。 XmlSecureResolverは、基になるXmlResolverでGetEntity（Uri、String、Type）を呼び出す前に、作成されたPermissionSetでPermitOnly（）を呼び出します。</font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題29 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Private.Uri</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パッケージ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドをオーバーライドするためのMicrosoftのガイドラインとほとんど競合しないメソッドを見つけました</font><font style="vertical-align: inherit;">。ヒントのリコール1 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object.ToStringをメソッドの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページ</font><font style="vertical-align: inherit;">：</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたのToString（）オーバーライドが例外をスローするべきではありません</font></font></i></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オーバーライドされたメソッド自体は次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (_username.Length == <span class="hljs-number">0</span> &amp;&amp; _password.Length &gt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UriFormatException(SR.net_uri_BadUserPassword);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'ToSting（）'メソッドから例外をスローすることはお勧めしません。</font><font style="vertical-align: inherit;">UriBuilder.cs 406 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コード</font><font style="vertical-align: inherit;">セット</font><font style="vertical-align: inherit;">のための空白行</font><i><font style="vertical-align: inherit;">_usernameの</font></i><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">と非</font><font style="vertical-align: inherit;">空のライン</font><i><font style="vertical-align: inherit;">_password</font></i><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">を介して</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パスワードの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パブリックプロパティを</font><font style="vertical-align: inherit;">、その後、</font><i><font style="vertical-align: inherit;">呼び出し</font></i><i><font style="vertical-align: inherit;">のToStringの</font></i><font style="vertical-align: inherit;">方法を</font><font style="vertical-align: inherit;">、例外を受け取ります。</font><font style="vertical-align: inherit;">そのようなコードの例：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs">UriBuilder uriBuilder = <span class="hljs-keyword">new</span> UriBuilder()<font></font>
{<font></font>
  UserName = String.Empty,<font></font>
  Password = <span class="hljs-string">"Dummy"</span><font></font>
};<font></font>
<font></font>
String stringRepresentation = uriBuilder.ToString();<font></font>
Console.WriteLine(stringRepresentation);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、この場合、開発者は、呼び出されたときに例外がスローされる可能性があることを正直に警告します。これは、メソッドとdocs.microsoft.comのコメントの両方に記載されています-" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UriBuilder.ToStringメソッド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題30 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Data.Common</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロジェクトコードで発行された警告を確認します</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> ArrayList _tables;
<span class="hljs-function"><span class="hljs-keyword">private</span> DataTable <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableName, <span class="hljs-keyword">string</span> ns</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_tables.Count == <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> (DataTable)_tables[<span class="hljs-number">0</span>];<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらくインデックスが範囲外です。</font><font style="vertical-align: inherit;">'0'インデックスは '_tables'の範囲を超えています。</font><font style="vertical-align: inherit;">XMLDiffLoader.cs 277 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは異常に見えますか？</font><font style="vertical-align: inherit;">これは何だと思いますか？</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArgumentOutOfRangeException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外をスローするための豪華な方法は</font><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">私はおそらくこのアプローチに驚かないでしょう。</font><font style="vertical-align: inherit;">一般に、コードは奇妙で疑わしいものです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戸建31</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> XmlNodeOrder <span class="hljs-title">ComparePosition</span>(<span class="hljs-params">XPathNodePointer other</span>)</span><font></font>
{<font></font>
  RealFoliate();<font></font>
  other.RealFoliate();<font></font>
  Debug.Assert(other != <span class="hljs-literal">null</span>);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に、「その他」のオブジェクトが使用されました。チェック行：1095、1096。XPathNodePointer.cs 1095 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Expression </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug.Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への引数としての</font><i><font style="vertical-align: inherit;">= null</font></i><font style="vertical-align: inherit;">は、引数</font><font style="vertical-align: inherit;">として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ComparePosition</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値を取得できることを</font><font style="vertical-align: inherit;">明確に示唆してい</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。少なくとも、彼らはそのようなケースを捕らえたいと思っています。しかし、同時に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上の行</font><font style="vertical-align: inherit;">はインスタンスメソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RealFoliateを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出します</font><font style="vertical-align: inherit;">。その結果、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">other</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font><font style="vertical-align: inherit;">チェックスルーする前に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外が</font><i><font style="vertical-align: inherit;">スロー</font></i><font style="vertical-align: inherit;">されます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アサート</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戸建32</font></font></b><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> PropertyDescriptorCollection <span class="hljs-title">GetProperties</span>(<span class="hljs-params">Attribute[] attributes</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">foreach</span> (Attribute attribute <span class="hljs-keyword">in</span> attributes)<font></font>
  {<font></font>
    Attribute attr = property.Attributes[attribute.GetType()];<font></font>
    <span class="hljs-keyword">if</span> (   (attr == <span class="hljs-literal">null</span> &amp;&amp; !attribute.IsDefaultAttribute()) <font></font>
        || !attr.Match(attribute))<font></font>
    {<font></font>
      match = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能性のあるnull逆参照。</font><font style="vertical-align: inherit;">「attr」を調べることを検討してください。</font><font style="vertical-align: inherit;">DbConnectionStringBuilder.cs 534 </font><i><font style="vertical-align: inherit;">ifステートメント</font></i><font style="vertical-align: inherit;">の</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件式は</font><font style="vertical-align: inherit;">やや疑わしく見えます。</font><i><font style="vertical-align: inherit;">Match</font></i><font style="vertical-align: inherit;">はインスタンスメソッドです。</font><i><font style="vertical-align: inherit;">attr == null</font></i><font style="vertical-align: inherit;">チェック</font><font style="vertical-align: inherit;">から</font><font style="vertical-align: inherit;">判断すると</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">はこの変数の有効な（期待される）値です。</font><font style="vertical-align: inherit;">したがって、実行のスレッドが演算子の正しいオペランドに到達した場合、|| </font><font style="vertical-align: inherit;">ことを提供</font><i><font style="vertical-align: inherit;">attrが</font></i><font style="vertical-align: inherit;">ある</font><i><font style="vertical-align: inherit;">ヌル</font></i><font style="vertical-align: inherit;">、我々は、型の例外取得</font><i><font style="vertical-align: inherit;">とNullReferenceExceptionを</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
したがって、例外の条件は次のとおりです。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><i> attr </i> — <i>null</i>.     &amp;&amp;.</li>
<li> <i>!attribute.IsDefaultAttribute()</i> — <i>false</i>.      &amp;&amp; — <i>false</i>.</li>
<li>     ||   <i>false</i>,   .</li>
<li>  <i>attr</i> — <i>null</i>,    <i>Match</i>  .</li>
</ol><br>
<b>Issue 33</b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ReadOldRowData</span>(<span class="hljs-params">
  DataSet ds, <span class="hljs-keyword">ref</span> DataTable table, <span class="hljs-keyword">ref</span> <span class="hljs-keyword">int</span> pos, XmlReader row</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    row.Skip(); <span class="hljs-comment">// need to skip this element if we dont know about it, </span>
                <span class="hljs-comment">// before returning -1</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">throw</span> ExceptionBuilder.DiffgramMissingTable(<font></font>
            XmlConvert.DecodeName(row.LocalName));<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ条件式を持つ2つの「if」ステートメントがあります。最初の 'if'ステートメントには、メソッドreturnが含まれています。つまり、2番目の「if」ステートメントは無意味なXMLDiffLoader.csです。301 </font><font style="vertical-align: inherit;">同じ条件式を含む</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があります</font><font style="vertical-align: inherit;">-table </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">== null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。さらに、これらの演算子の分岐は異なるアクションを含みます-1つのケースでは、メソッドは-1の値で終了します。2番目のケースでは、例外がスローされます。チェックの間、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テーブル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">は変更されません。したがって、問題の例外はスローされません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題34 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.ComponentModel.TypeConverter</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロジェクトから興味深いメソッドを見てみましょう</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。より正確には、まずそれを説明するコメントを見てください</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。フォーマットされた文字列から最後の文字を削除します。 （仮想文字列の最後の文字を削除します）。終了時に、outパラメータには、操作が実際に実行された位置が含まれます。この位置は、テスト文字列を基準にしています。 MaskedTextResultHint outパラメータは、操作結果に関する詳細情報を提供します。</font></font></i> <font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">成功し</font></i><b><i><font style="vertical-align: inherit;">た</font></i></b><i><font style="vertical-align: inherit;">場合は</font></i></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">それ以外の場合</font></i><i><font style="vertical-align: inherit;">は</font></i></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseを</font></font></i></b> <font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">返します</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
戻り値の要点：操作が成功した場合、メソッドは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返し</font><font style="vertical-align: inherit;">、それ以外の場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。事後に何が起こるか見てみましょう。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Remove</span>(<span class="hljs-params"><span class="hljs-keyword">out</span> <span class="hljs-keyword">int</span> testPosition, <span class="hljs-keyword">out</span> MaskedTextResultHint resultHint</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (lastAssignedPos == INVALID_INDEX)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// nothing to remove.</span><font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3009</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このメソッドが常に1つの同じ値「true」を返すのは奇妙です。 MaskedTextProvider.cs 1529 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、メソッドの戻り値は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみであることが</font><font style="vertical-align: inherit;">わかり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戸建35</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Clear</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (_table != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (_table.fInitInProgress &amp;&amp; _delayLoadingConstraints != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証された後、「_ table」オブジェクトが使用されました。チェック行：</font><i><font style="vertical-align: inherit;">437、423。ConstraintCollection.cs</font></i><font style="vertical-align: inherit;"> 437 </font><i><font style="vertical-align: inherit;">_tableの</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
チェック</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！= Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はそれ自体を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><i><font style="vertical-align: inherit;">-_table</font></i><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">ことができ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。少なくともこの場合、再保険されます。しかし、彼らは介して、インスタンスフィールドへのアクセス以下</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_TABLE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をチェックせずに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_TABLE .fInitInProgress</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題36</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Runtime.Serialization.Formatters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトのプロジェクトコードで発行されたいくつかの警告を見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Write</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (memberNameInfo != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    ....<font></font>
    _serWriter.WriteObjectEnd(memberNameInfo, typeNameInfo);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((objectInfo._objectId == _topId) &amp;&amp; (_topName != <span class="hljs-literal">null</span>))<font></font>
    {<font></font>
      _serWriter.WriteObjectEnd(topNameInfo, typeNameInfo);<font></font>
      ....<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!ReferenceEquals(objectInfo._objectType, Converter.s_typeofString))<font></font>
    {<font></font>
      _serWriter.WriteObjectEnd(typeNameInfo, typeNameInfo);<font></font>
    }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3038</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数がメソッドに数回渡されました。</font><font style="vertical-align: inherit;">代わりに他の引数を渡す必要がある可能性があります。</font><font style="vertical-align: inherit;">BinaryObjectWriter.cs 262 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_serWriter.WriteObjectEnd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">への最後の呼び出しを</font><font style="vertical-align: inherit;">、2つの同一の引数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeNameInfo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">混同しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">誤字のようですが、確かに言えません。</font><font style="vertical-align: inherit;">呼び出された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteObjectEnd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">何であるかを確認することにしました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params">NameInfo memberNameInfo, NameInfo typeNameInfo</span>)</span> 
{ }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ええと...先に進みましょう。</font><font style="vertical-align: inherit;">:) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37号</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteSerializationHeader</span>(<span class="hljs-params">
  <span class="hljs-keyword">int</span> topId,
  <span class="hljs-keyword">int</span> headerId,
  <span class="hljs-keyword">int</span> minorVersion,
  <span class="hljs-keyword">int</span> majorVersion</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> record = <span class="hljs-keyword">new</span> SerializationHeaderRecord(<font></font>
                     BinaryHeaderEnum.SerializedStreamHeader,<font></font>
                     topId,<font></font>
                     headerId,<font></font>
                     minorVersion,<font></font>
                     majorVersion);<font></font>
  record.Write(<span class="hljs-keyword">this</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを見ても、ここで間違っているとか疑わしいとかはすぐにはわかりません。しかし、分析者はそれが彼を守ったと言うかもしれません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告PVS-Studio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'SerializationHeaderRecord'コンストラクターに渡される引数の順序が誤っている可能性があります： 'minorVersion'および 'majorVersion'。 BinaryFormatterWriter.cs 111 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
呼び出されている</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SerializationHeaderRecord</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスのコンストラクターを見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-title">SerializationHeaderRecord</span>(<span class="hljs-params">
  BinaryHeaderEnum binaryHeaderEnum,
  <span class="hljs-keyword">int</span> topId,
  <span class="hljs-keyword">int</span> headerId,
  <span class="hljs-keyword">int</span> majorVersion,
  <span class="hljs-keyword">int</span> minorVersion</span>)</span><font></font>
{<font></font>
  _binaryHeaderEnum = binaryHeaderEnum;<font></font>
  _topId = topId;<font></font>
  _headerId = headerId;<font></font>
  _majorVersion = majorVersion;<font></font>
  _minorVersion = minorVersion;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、コンストラクターのパラメーターは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">majorVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minorVersionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">順になってい</font><font style="vertical-align: inherit;">ます。コンストラクターを呼び出すと、それらは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minorVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">majorVersionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">順序で転送され</font><font style="vertical-align: inherit;">ます。タイプミスのように聞こえます。これが計画されていた場合（そして突然？）-説明コメントを残すべきだと思います。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戸建38</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-title">ObjectManager</span>(<span class="hljs-params">
  ISurrogateSelector selector, 
  StreamingContext context, 
  <span class="hljs-keyword">bool</span> checkSecurity, 
  <span class="hljs-keyword">bool</span> isCrossAppDomain</span>)</span><font></font>
{<font></font>
  _objects = <span class="hljs-keyword">new</span> ObjectHolder[DefaultInitialSize];<font></font>
  _selector = selector;<font></font>
  _context = context;<font></font>
  _isCrossAppDomain = isCrossAppDomain;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'checkSecurity'は使用されません。</font><font style="vertical-align: inherit;">ObjectManager.cs 33 </font><i><font style="vertical-align: inherit;">checkSecurity</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
コンストラクター</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーター</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は決して使用されません。</font><font style="vertical-align: inherit;">コメントはありません。</font><font style="vertical-align: inherit;">これは互換性のために残されていると思いますが、何らかの方法で、近年のセキュリティに関する議論の中で、これは興味深いように見えます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39号</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
別のコードが出会い、私には異常に思えました。</font><font style="vertical-align: inherit;">パターンは、検出された3つのケースすべてで1対1に見え、同じ名前と変数名を持つメソッドで見つかります。</font><font style="vertical-align: inherit;">したがって：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、私は十分に啓蒙されておらず、そのような複製の意味を理解していませんでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーは、copy-pasteメソッドを使用してコード全体に伝播しました。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コード自体：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnlargeArray</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">int</span> newLength = _values.Length * <span class="hljs-number">2</span>;
  <span class="hljs-keyword">if</span> (newLength &lt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (newLength == <span class="hljs-keyword">int</span>.MaxValue)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SerializationException(SR.Serialization_TooManyElements);<font></font>
    }<font></font>
    newLength = <span class="hljs-keyword">int</span>.MaxValue;<font></font>
  }<font></font>
  FixupHolder[] temp = <span class="hljs-keyword">new</span> FixupHolder[newLength];<font></font>
  Array.Copy(_values, <span class="hljs-number">0</span>, temp, <span class="hljs-number">0</span>, _count);<font></font>
  _values = temp;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'newLength == int.MaxValue'は常にfalseです。</font><font style="vertical-align: inherit;">ObjectManager.cs 1423</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'newLength == int.MaxValue'は常にfalseです。</font><font style="vertical-align: inherit;">ObjectManager.cs 1511</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 'newLength == int.MaxValue'は常にfalseです。</font><font style="vertical-align: inherit;">ObjectManager.cs 1558</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のメソッドで異なるのは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一時</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列の要素タイプのみです</font><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FixupHolder</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではなく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">long</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">だから私はまだコピー・ペーストについて疑いがあります... </font><i><font style="vertical-align: inherit;">System.Data.Odbc</font></i><font style="vertical-align: inherit;"> 
プロジェクトからのコード</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40の発行</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">UnquoteIdentifier</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrEmpty(quotePrefix) || quotePrefix != <span class="hljs-string">" "</span>)<font></font>
  { .... }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式 '！String.IsNullOrEmpty（quotePrefix）|| quotePrefix！= "" 'は常にtrueです。 OdbcCommandBuilder.cs 338 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザは、上記の式が常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueである</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と見なし</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。そして確かにそうです。さらに、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に実際に</font><font style="vertical-align: inherit;">含ま</font><font style="vertical-align: inherit;">れる</font><font style="vertical-align: inherit;">値は問題ではありません</font><font style="vertical-align: inherit;">-条件自体が誤って書き込まれています。それを正しくしましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、||演算子は、したがって、式の値がされる必要があり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、真の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左または右（あるいは両方）のオペランドであれば</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。左はすべてクリアです。右のオペランドは、左のオペランドが</font><i><font style="vertical-align: inherit;">falseの</font></i><font style="vertical-align: inherit;">場合にのみ評価され</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、式が右側のオペランドの値が常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">なるように構成されている</font><font style="vertical-align: inherit;">場合、左側の値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、式全体の結果は常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコードから、正しいオペランドが計算された場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string.IsNullOrEmpty（quotePrefix）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式の値</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であるため、ステートメントの1つ</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">true</font></i><font style="vertical-align: inherit;">であること</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">わかり</font></i><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのステートメントのいずれかが真の場合、式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix！= ""</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も真になりますが</font><font style="vertical-align: inherit;">、これは証明したかったものです。したがって、</font><i><font style="vertical-align: inherit;">quotePrefix</font></i><font style="vertical-align: inherit;">の内容に関係なく、</font><font style="vertical-align: inherit;">式全体の値は常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題41</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
未使用のパラメーターを持つコンストラクターに関する会話に戻る：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PendingGetConnection</span><font></font>
{<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PendingGetConnection</span>(<span class="hljs-params">
           <span class="hljs-keyword">long</span> dueTime,
           DbConnection owner,
           TaskCompletionSource&lt;DbConnectionInternal&gt; completion,
           DbConnectionOptions userOptions</span>)</span><font></font>
    {<font></font>
        DueTime = dueTime;<font></font>
        Owner = owner;<font></font>
        Completion = completion;<font></font>
    }<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> DueTime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DbConnection Owner { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> TaskCompletionSource&lt;DbConnectionInternal&gt; <font></font>
             Completion { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DbConnectionOptions UserOptions { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクターパラメーター 'userOptions'は使用されません。</font><font style="vertical-align: inherit;">DbConnectionPool.cs 26 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーのコードと警告から、コンストラクターパラメーターの1つ（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">userOptions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">のみ</font><font style="vertical-align: inherit;">が使用され、他の</font><font style="vertical-align: inherit;">パラメーターは</font><font style="vertical-align: inherit;">同じ名前のプロパティの初期化に使用されている</font><font style="vertical-align: inherit;">ことが明らかです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プロパティの1つを初期化するのを忘れたようです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題42</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このプロジェクトで2回遭遇した不審なコードがあります。</font><font style="vertical-align: inherit;">パターンは同じです。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> DataTable <span class="hljs-title">ExecuteCommand</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">foreach</span> (DataRow row <span class="hljs-keyword">in</span> schemaTable.Rows)<font></font>
  {<font></font>
    resultTable.Columns<font></font>
               .Add(row[<span class="hljs-string">"ColumnName"</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">string</span>, <font></font>
                   (Type)row[<span class="hljs-string">"DataType"</span>] <span class="hljs-keyword">as</span> Type);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3051</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過剰な型キャスト。</font><font style="vertical-align: inherit;">オブジェクトは既に「タイプ」タイプです。</font><font style="vertical-align: inherit;">DbMetaDataFactory.cs 176</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3051</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過剰な型キャスト。</font><font style="vertical-align: inherit;">オブジェクトは既に「タイプ」タイプです。</font><font style="vertical-align: inherit;">OdbcMetaDataFactory.cs 1109</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Type）の行["DataType"] Type</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が不審に見える</font><font style="vertical-align: inherit;">。明示的なキャストが最初に実行され、次に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子によるキャストが実行さ</font><i><font style="vertical-align: inherit;">れ</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行["DataType"]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、両方のキャストが正常に「通過」し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの引数として渡され</font><font style="vertical-align: inherit;">ます。場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、行[「データ型が」]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にキャストできない値を返す</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、明示的なキャストがスローされます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidCastExceptionが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。最後に、なぜ2つの幽霊がいるのですか？質問は未解決です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題43 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Runtime.InteropServices.RuntimeInformation</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
からの疑わしいフラグメントを見てみましょう</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> FrameworkDescription<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (s_frameworkDescription == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">string</span> versionString = (<span class="hljs-keyword">string</span>)AppContext.GetData(<span class="hljs-string">"FX_PRODUCT_VERSION"</span>);
      <span class="hljs-keyword">if</span> (versionString == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        ....<font></font>
        versionString <font></font>
          = <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">object</span>).Assembly<font></font>
                          .GetCustomAttribute&lt;<font></font>
                             AssemblyInformationalVersionAttribute&gt;()<font></font>
                         ?.InformationalVersion;<font></font>
        ....<font></font>
        <span class="hljs-keyword">int</span> plusIndex = versionString.IndexOf(<span class="hljs-string">'+'</span>);<font></font>
        ....<font></font>
      }<font></font>
      ....<font></font>
    }<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3105</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">versionString</font></a><font style="vertical-align: inherit;"> '変数は、null条件演算子を介して割り当てられた後に使用されました。 NullReferenceExceptionが発生する可能性があります。 RuntimeInformation.cs 29 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザは、可能な例外について警告</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とNullReferenceExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOfメソッドの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドが呼び出される</font><font style="vertical-align: inherit;">ため</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versionStringの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">。変数の値を取得する場合、コードの作成者は「？。」演算子を使用して</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">InfromationalVersion</font></i><font style="vertical-align: inherit;">プロパティにアクセスするときに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得しません</font><font style="vertical-align: inherit;">。冗談は、</font><i><font style="vertical-align: inherit;">GetCustomAttribute &lt;...&gt;の</font></i><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">nullを</font></i><font style="vertical-align: inherit;">返す</font><font style="vertical-align: inherit;">場合</font><i><font style="vertical-align: inherit;">です。</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外は引き続きスローされますが、それより低い</font><i><font style="vertical-align: inherit;">-versionString</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">nullに</font></i><font style="vertical-align: inherit;">なる</font><font style="vertical-align: inherit;">ため</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出すとき</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">問題44 </font></b><i><font style="vertical-align: inherit;">System.ComponentModel.Composition</font></i><font style="vertical-align: inherit;"> 
プロジェクトに目を向けると、</font><font style="vertical-align: inherit;">いくつかの警告が表示されます。</font><font style="vertical-align: inherit;">次のコードに対して2つの警告がすぐに発行されました。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CanSpecialize</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">object</span>[] genericParameterConstraints = ....;<font></font>
  GenericParameterAttributes[] genericParameterAttributes = ....;<font></font>
<font></font>
  <span class="hljs-comment">// if no constraints and attributes been specifed, anything can be created</span>
  <span class="hljs-keyword">if</span> ((genericParameterConstraints == <span class="hljs-literal">null</span>) &amp;&amp; <font></font>
      (genericParameterAttributes == <span class="hljs-literal">null</span>))<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ((genericParameterConstraints != <span class="hljs-literal">null</span>) &amp;&amp; <font></font>
      (genericParameterConstraints.Length != partArity))<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ((genericParameterAttributes != <span class="hljs-literal">null</span>) &amp;&amp; <font></font>
      (genericParameterAttributes.Length != partArity))<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; partArity; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (!GenericServices.CanSpecialize(<font></font>
        specialization[i],<font></font>
        (genericParameterConstraints[i] <span class="hljs-keyword">as</span> Type[]).<font></font>
          CreateTypeSpecializations(specialization),<font></font>
        genericParameterAttributes[i]))<font></font>
    {<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「genericParameterConstraints」オブジェクトは、nullに対して検証された後に使用されました。</font><font style="vertical-align: inherit;">チェック行：603、589。GenericSpecializationPartCreationInfo.cs 603</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「genericParameterAttributes」オブジェクトは、nullに対して検証された後に使用されました。</font><font style="vertical-align: inherit;">チェック行：604、594。GenericSpecializationPartCreationInfo.cs 604</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">genericParameterAttributes！= Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">genericParameterConstraints！=</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
コードに</font><i><font style="vertical-align: inherit;">Null</font></i><font style="vertical-align: inherit;">チェックがあります</font><font style="vertical-align: inherit;">。したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの変数の有効な値は考慮されます。両方の変数が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、メソッドを終了します-質問はありません。しかし、変数のいずれかが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であるが、メソッドが終了していない場合はどうなりますか？そのような状態が可能で、実行がループに到達すると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外が発生し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戸建45</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じプロジェクトからの別の興味深い警告を見てみましょう。</font><font style="vertical-align: inherit;">ただし、別の方法で実行してみましょう。最初にクラスを再度使用し、次にコードを確認します。</font><font style="vertical-align: inherit;">最後に利用可能なプレリリースバージョンのNuGetパッケージをプロジェクトに接続します（パッケージバージョン4.6.0-preview6.19303.8をインストールしました）。</font><font style="vertical-align: inherit;">次のような簡単なコードを書いてみましょう。</font></font><br>
<br>
<pre><code class="cs hljs">LazyMemberInfo lazyMemberInfo = <span class="hljs-keyword">new</span> LazyMemberInfo();
<span class="hljs-keyword">var</span> eq = lazyMemberInfo.Equals(<span class="hljs-literal">null</span>);<font></font>
Console.WriteLine(eq);</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドは</font><font style="vertical-align: inherit;">コメントされていません。docs.microsoft.comで、.NET Coreのこのメソッドの説明は見つかりませんでした。.NETFrameworkの場合のみです。</font><font style="vertical-align: inherit;">これを見ると（ " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LazyMemberInfo.Equals（Object）Method</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "）-異常は見られません</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">-true</font></a><font style="vertical-align: inherit;">または</font><i><font style="vertical-align: inherit;">falseを</font></i><font style="vertical-align: inherit;">返し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、生成された例外に関する情報はありません。</font><font style="vertical-align: inherit;">
コードを実行して実行します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e5/8f7/aa4/8e58f7aa4e5a274751cde57da4d9497f.png" alt="写真16"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し変態させて、次のコードを書いて、興味深い結論を得ることができます。</font></font><br>
<br>
<pre><code class="cs hljs">LazyMemberInfo lazyMemberInfo = <span class="hljs-keyword">new</span> LazyMemberInfo();
<span class="hljs-keyword">var</span> eq = lazyMemberInfo.Equals(<span class="hljs-keyword">typeof</span>(String));<font></font>
Console.WriteLine(eq);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コード実行の結果。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e74/199/292/e74199292d39b2df8a7b205218c9c1fe.png" alt="写真17"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いことに、これらの例外は両方とも同じ式で生成されます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの内部を見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> obj</span>)</span><font></font>
{<font></font>
  LazyMemberInfo that = (LazyMemberInfo)obj;<font></font>
<font></font>
  <span class="hljs-comment">// Difefrent member types mean different members</span>
  <span class="hljs-keyword">if</span> (_memberType != that._memberType)<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// if any of the lazy memebers create accessors in a delay-loaded fashion, </span>
  <span class="hljs-comment">// we simply compare the creators</span>
  <span class="hljs-keyword">if</span> ((_accessorsCreator != <span class="hljs-literal">null</span>) || (that._accessorsCreator != <span class="hljs-literal">null</span>))<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">object</span>.Equals(_accessorsCreator, that._accessorsCreator);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// we are dealing with explicitly passed accessors in both cases</span>
  <span class="hljs-keyword">if</span>(_accessors == <span class="hljs-literal">null</span> || that._accessors == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(SR.Diagnostic_InternalExceptionMessage);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> _accessors.SequenceEqual(that._accessors);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3115</font></a><font style="vertical-align: inherit;"> 'null'を 'Equals'メソッドに渡しても、 'NullReferenceException'にならないはずです。 LazyMemberInfo.cs 116 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、アナライザーは式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that._memberType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に対して警告を発行したため、少し</font><i><font style="vertical-align: inherit;">変動しました</font></i><font style="vertical-align: inherit;">。ただし、上記の式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（LazyMemberInfo）objを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行すると、例外が発生します</font><font style="vertical-align: inherit;">。すでにメモしました。</font><i><font style="vertical-align: inherit;">InvalidCastExceptionが</font></i><font style="vertical-align: inherit;">、私はすべてが明らかだと思います。</font><i><font style="vertical-align: inherit;">NullReferenceExceptionが発生するの</font></i><font style="vertical-align: inherit;">はなぜ</font><font style="vertical-align: inherit;">ですか？実際には、</font><i><font style="vertical-align: inherit;">LazyMemberInfo</font></i><font style="vertical-align: inherit;">は構造であるため、解凍が実行されます。そして、</font><i><font style="vertical-align: inherit;">ヌル</font></i><font style="vertical-align: inherit;">値をアンパックすると</font><font style="vertical-align: inherit;">、タイプの例外が発生します</font></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">まあ、これもコメントにいくつかのタイプミスがありますが、同時に修正することもできます。</font><font style="vertical-align: inherit;">まあ、例外の明示的なスローも著者の良心に残ります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第46号</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ちなみに、</font><i><font style="vertical-align: inherit;">TriState</font></i><font style="vertical-align: inherit;">構造の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Drawing.Common</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">も同様のものが見つかりました</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> o</span>)</span><font></font>
{<font></font>
  TriState state = (TriState)o;<font></font>
  <span class="hljs-keyword">return</span> _value == state._value;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3115</font></a><font style="vertical-align: inherit;"> 'null'を 'Equals'メソッドに渡しても、 'NullReferenceException'にならないはずです。</font><font style="vertical-align: inherit;">TriState.cs 53 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は上記の場合と同じです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題47 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Text.Jsonの</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
いくつかのスニペットを検討してください</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">ToString</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">nullを</font></i><font style="vertical-align: inherit;">返すべきではない</font><font style="vertical-align: inherit;">
という事実について話しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">留めて。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">switch</span> (TokenType)<font></font>
  {<font></font>
    <span class="hljs-keyword">case</span> JsonTokenType.None:
    <span class="hljs-keyword">case</span> JsonTokenType.Null:
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>.Empty;
    <span class="hljs-keyword">case</span> JsonTokenType.True:
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">bool</span>.TrueString;
    <span class="hljs-keyword">case</span> JsonTokenType.False:
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">bool</span>.FalseString;
    <span class="hljs-keyword">case</span> JsonTokenType.Number:
    <span class="hljs-keyword">case</span> JsonTokenType.StartArray:
    <span class="hljs-keyword">case</span> JsonTokenType.StartObject:<font></font>
    {<font></font>
      <span class="hljs-comment">// null parent should have hit the None case</span>
      Debug.Assert(_parent != <span class="hljs-literal">null</span>);
      <span class="hljs-keyword">return</span> _parent.GetRawValueAsString(_idx);<font></font>
    }<font></font>
    <span class="hljs-keyword">case</span> JsonTokenType.String:
      <span class="hljs-keyword">return</span> GetString();
    <span class="hljs-keyword">case</span> JsonTokenType.Comment:
    <span class="hljs-keyword">case</span> JsonTokenType.EndArray:
    <span class="hljs-keyword">case</span> JsonTokenType.EndObject:
    <span class="hljs-keyword">default</span>:<font></font>
      Debug.Fail(<span class="hljs-string">$"No handler for <span class="hljs-subst">{<span class="hljs-keyword">nameof</span>(JsonTokenType)}</span>.<span class="hljs-subst">{TokenType}</span>"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>.Empty;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見、このメソッドは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で戻りませんが、アナライザーはその逆を主張します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'ToSting（）'メソッドから 'null'を返すことはお勧めしません。</font><font style="vertical-align: inherit;">JsonElement.cs 1460 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetString（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを呼び出して行をポイントし</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それを見てみましょう：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetString</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  CheckValidInstance();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> _parent.GetString(_idx, JsonTokenType.String);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より深く</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掘り下げる-GetString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドのオーバーロードされたバージョンに</font><font style="vertical-align: inherit;">：</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetString</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> index, JsonTokenType expectedType</span>)</span><font></font>
{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (tokenType == JsonTokenType.Null)<font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ここでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が返される条件が既に確認されてい</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このメソッドと最初に検討した</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToStringの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">両方から</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題48</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
別の興味深い場所：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> JsonPropertyInfo <span class="hljs-title">CreatePolymorphicProperty</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  JsonPropertyInfo runtimeProperty <font></font>
    = CreateProperty(property.DeclaredPropertyType, <font></font>
                     runtimePropertyType, <font></font>
                     property.ImplementedPropertyType, <font></font>
                     property?.PropertyInfo, <font></font>
                     Type, <font></font>
                     options);<font></font>
  property.CopyRuntimeSettingsTo(runtimeProperty);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> runtimeProperty;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3042</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NullReferenceExceptionの可能性があります。 「？」と '。'演算子は「プロパティ」オブジェクトのJsonClassInfo.AddProperty.cs 179のメンバーにアクセスするために使用されている</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
呼び出し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreatePropertyの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法を、</font><font style="vertical-align: inherit;">彼らは、変数を使用してプロパティを複数回アクセスし</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">property.DeclaredPropertyType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">property.ImplementedPropertyType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ.PropertyInfo？ </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ご覧のように、ある場合には「？。」演算子を使用します。ここで不要ではなく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能</font><i><font style="vertical-align: inherit;">性</font></i><font style="vertical-align: inherit;">がある場合</font><font style="vertical-align: inherit;">、直接アクセスするとタイプの例外が生成されるため、この演算子はまったく役に立ちません</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題49</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次の疑わしい場所が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Security.Cryptography.Xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトで見つかり、</font><font style="vertical-align: inherit;">他の警告で何度か発生したように、ペアで移動します。</font><font style="vertical-align: inherit;">コードは再びコピーと貼り付けのように見えます。自分で比較してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のフラグメント：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Write</span>(<span class="hljs-params">StringBuilder strBuilder, 
                  DocPosition docPos, 
                  AncestralNamespaceContextManager anc</span>)</span><font></font>
{<font></font>
  docPos = DocPosition.BeforeRootElement;<font></font>
  <span class="hljs-keyword">foreach</span> (XmlNode childNode <span class="hljs-keyword">in</span> ChildNodes)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (childNode.NodeType == XmlNodeType.Element)<font></font>
    {<font></font>
      CanonicalizationDispatcher.Write(<font></font>
        childNode, strBuilder, DocPosition.InRootElement, anc);<font></font>
      docPos = DocPosition.AfterRootElement;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      CanonicalizationDispatcher.Write(childNode, strBuilder, docPos, anc);<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のスニペット：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteHash</span>(<span class="hljs-params">HashAlgorithm hash, 
                      DocPosition docPos, 
                      AncestralNamespaceContextManager anc</span>)</span><font></font>
{<font></font>
  docPos = DocPosition.BeforeRootElement;<font></font>
  <span class="hljs-keyword">foreach</span> (XmlNode childNode <span class="hljs-keyword">in</span> ChildNodes)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (childNode.NodeType == XmlNodeType.Element)<font></font>
    {<font></font>
      CanonicalizationDispatcher.WriteHash(<font></font>
        childNode, hash, DocPosition.InRootElement, anc);<font></font>
      docPos = DocPosition.AfterRootElement;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      CanonicalizationDispatcher.WriteHash(childNode, hash, docPos, anc);<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioの警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ「docPos」は、使用前に常にメソッド本体で書き換えられます。</font><font style="vertical-align: inherit;">CanonicalXmlDocument.cs 37</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ「docPos」は、使用前に常にメソッド本体で書き換えられます。</font><font style="vertical-align: inherit;">CanonicalXmlDocument.cs 54</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのメソッドの両方で、</font><font style="vertical-align: inherit;">その値が使用される前に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docPos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーター</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">上書きされるため、メソッドの引数として使用される値は単に無視されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題50 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Data.SqlClient</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロジェクトコードに関するいくつかの警告を検討してください</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBOMNeeded</span>(<span class="hljs-params">MetaType type, <span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (type.NullableType == TdsEnums.SQLXMLTYPE)<font></font>
  {<font></font>
    Type currentType = <span class="hljs-keyword">value</span>.GetType();<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (currentType == <span class="hljs-keyword">typeof</span>(SqlString))<font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (!((SqlString)<span class="hljs-keyword">value</span>).IsNull &amp;&amp; ((((SqlString)<span class="hljs-keyword">value</span>).Value).Length &gt; <span class="hljs-number">0</span>))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> ((((SqlString)<span class="hljs-keyword">value</span>).Value[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span>) != <span class="hljs-number">0xff</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((currentType == <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">string</span>)) &amp;&amp; (((String)<span class="hljs-keyword">value</span>).Length &gt; <span class="hljs-number">0</span>))<font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">value</span> != <span class="hljs-literal">null</span>) &amp;&amp; (((<span class="hljs-keyword">string</span>)<span class="hljs-keyword">value</span>)[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span>) != <span class="hljs-number">0xff</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentType == <span class="hljs-keyword">typeof</span>(SqlXml))<font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (!((SqlXml)<span class="hljs-keyword">value</span>).IsNull)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentType == <span class="hljs-keyword">typeof</span>(XmlDataFeed))<font></font>
    {<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// Values will eventually converted to unicode string here</span><font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に 'value'オブジェクトが使用されました。チェック行：8696、8708。TdsParser.cs 8696 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をチェックする</font><i><font style="vertical-align: inherit;">ことで</font></i><font style="vertical-align: inherit;">混乱しました</font><i><font style="vertical-align: inherit;">！=</font></i><font style="vertical-align: inherit;">いずれかの条件で</font><i><font style="vertical-align: inherit;">NULL</font></i><font style="vertical-align: inherit;">。上記の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何度も逆参照</font><font style="vertical-align: inherit;">されるため、彼女はリファクタリング中にそこで失われたようです</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">なる可能性がある</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">は、問題</font><font style="vertical-align: inherit;">があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題51</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
テストの次のエラーですが、それは私には興味深く思われたので、それを持ってくることにしました。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">virtual</span> TDSMessageCollection <span class="hljs-title">CreateQueryResponse</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (....)<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (   lowerBatchText.Contains(<span class="hljs-string">"name"</span>)<font></font>
           &amp;&amp; lowerBatchText.Contains(<span class="hljs-string">"state"</span>)<font></font>
           &amp;&amp; lowerBatchText.Contains(<span class="hljs-string">"databases"</span>)<font></font>
           &amp;&amp; lowerBatchText.Contains(<span class="hljs-string">"db_name"</span>))  
  <span class="hljs-comment">// SELECT [name], [state] FROM [sys].[databases] WHERE [name] = db_name()</span><font></font>
  {<font></font>
    <span class="hljs-comment">// Delegate to current database response</span><font></font>
    responseMessage = _PrepareDatabaseResponse(session);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告PVS-Studio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3053</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">過度の表現。サブストリング 'name'および 'db_name'を調べます。 QueryEngine.cs 151 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、この場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowerBatchText.Contains（ "name"）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowerBatchText.Contains（ "db_name"）の部分式</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の組み合わせ</font><font style="vertical-align: inherit;">は冗長です。実際、チェックされる文字列に部分文字列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ db_name”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が含まれている場合、部分文字列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ name”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も含まれます</font><font style="vertical-align: inherit;">。文字列が含まれていない場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、「名前」を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そして</font><font style="vertical-align: inherit;">それは含まれません</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「DB_NAMEを」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のいずれか。</font><i><font style="vertical-align: inherit;">lowerBatchText.Contains（ "name"）</font></i><font style="vertical-align: inherit;">をチェックすると、</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冗長です。チェックされる文字列に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"name"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が含まれていない場合に評価される式の数を減らすことができない場合を除きます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題52 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Net.Requests</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロジェクトからの不審なコードスニペット</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> PipelineInstruction <span class="hljs-title">PipelineCallback</span>(<span class="hljs-params">
  PipelineEntry entry, ResponseDescription response, ....</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (NetEventSource.IsEnabled) <font></font>
    NetEventSource.Info(<span class="hljs-keyword">this</span>, 
      <span class="hljs-string">$"Command:<span class="hljs-subst">{entry?.Command}</span> Description:<span class="hljs-subst">{response?.StatusDescription}</span>"</span>);
  <span class="hljs-comment">// null response is not expected</span>
  <span class="hljs-keyword">if</span> (response == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> PipelineInstruction.Abort;<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (entry.Command == <span class="hljs-string">"OPTS utf8 on\r\n"</span>)<font></font>
    ....<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「entry」オブジェクトは、nullに対して検証された後に使用されました。チェック行：270、227。FtpControlStream.cs 270 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
補間された行をコンパイルするとき、式の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エントリ？。コマンド</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">応答？。説明が使用され</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。 「。」演算子の代わりに</font><font style="vertical-align: inherit;">対応するパラメーターのいずれかが</font><i><font style="vertical-align: inherit;">nullの</font></i><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、「?.」を使用して、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外を取得しません</font><font style="vertical-align: inherit;">。この場合、この手法は機能します。さらに、コードからわかるように</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">応答の</font></i><font style="vertical-align: inherit;">可能な</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">値</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">切り捨てられます（</font><i><font style="vertical-align: inherit;">response == nullの</font></i><font style="vertical-align: inherit;">場合はメソッドから終了し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">）が、</font><i><font style="vertical-align: inherit;">エントリは</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのような何もありません。その結果、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entry</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entry.Commandを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出すと</font><font style="vertical-align: inherit;">例外がスローされます（すでに「？。」では</font><i><font style="vertical-align: inherit;">なく</font></i><font style="vertical-align: inherit;">「。」を使用しています）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、コードのかなり詳細な調査を行います。少し気を散らしたり、お茶を淹れたり、コーヒーを飲んだりすることをお勧めします。その後、またお会いしましょう。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/3fc/f07/56a3fcf075284f021a56249627e518bb.png" alt="画像23"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたは戻ってきていますか？次に続けましょう。 :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Issue 53</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Collections.Immutable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトから興味深いものを見てみましょう</font><font style="vertical-align: inherit;">。今回は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Collections.Immutable.ImmutableArray &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造体を少し実験します</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IStructuralEquatable.Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IStructuralComparable.CompareTo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドに興味があります</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">IStructuralEquatable.Equals</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
メソッドから始めましょう</font><font style="vertical-align: inherit;">。コードは下にありますが、自分でそれの何が問題になっているのかを理解することをお勧めします：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">bool</span> IStructuralEquatable.Equals(<span class="hljs-keyword">object</span> other, IEqualityComparer comparer)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;<font></font>
  Array otherArray = other <span class="hljs-keyword">as</span> Array;
  <span class="hljs-keyword">if</span> (otherArray == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> theirs = other <span class="hljs-keyword">as</span> IImmutableArray;
    <span class="hljs-keyword">if</span> (theirs != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      otherArray = theirs.Array;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span> &amp;&amp; otherArray == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  IStructuralEquatable ours = self.array;<font></font>
  <span class="hljs-keyword">return</span> ours.Equals(otherArray, comparer);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
管理されていますか？もしそうなら、再び、おめでとうございます。 :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3125</font></a><font style="vertical-align: inherit;"> nullに対して検証された後、「ours」オブジェクトが使用されました。チェック行：1212、1204。ImmutableArray_1.cs 1212 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは、</font><font style="vertical-align: inherit;">ここでは</font><i><font style="vertical-align: inherit;">NullReferenceException</font></i><font style="vertical-align: inherit;">型の例外が発生する可能性があると想定しているため</font><font style="vertical-align: inherit;">、最後の</font><i><font style="vertical-align: inherit;">returnステートメントに</font></i><font style="vertical-align: inherit;">ある</font><i><font style="vertical-align: inherit;">ours</font></i><font style="vertical-align: inherit;">変数を介した</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスメソッドの呼び出しを混乱させ</font><font style="vertical-align: inherit;">ました</font><font style="vertical-align: inherit;">。彼はどのようにしてこの結論に達しましたか？説明を簡単にするために、同じメソッドの簡略化したコードを次に示します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">bool</span> IStructuralEquatable.Equals(<span class="hljs-keyword">object</span> other, IEqualityComparer comparer)<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (....)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">if</span> (....)<font></font>
    {<font></font>
      ....<font></font>
      <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span> &amp;&amp; otherArray == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  IStructuralEquatable ours = self.array;<font></font>
  <span class="hljs-keyword">return</span> ours.Equals(otherArray, comparer);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の式から、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たち</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から派生していることが</font><i><font style="vertical-align: inherit;">わかり</font></i><font style="vertical-align: inherit;">ます。上記では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のチェックが数回実行されてい</font><font style="vertical-align: inherit;">ます。したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、つまり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのもの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なる可能性があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。少なくとも理論的には。そのような状態は実際に達成可能ですか？調べてみましょう。これを行うには、メソッドの本体をキーポイントを離してもう一度繰り返します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">bool</span> IStructuralEquatable.Equals(<span class="hljs-keyword">object</span> other, IEqualityComparer comparer)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>; <span class="hljs-comment">// &lt;= 1</span>
  Array otherArray = other <span class="hljs-keyword">as</span> Array;
  <span class="hljs-keyword">if</span> (otherArray == <span class="hljs-literal">null</span>) <span class="hljs-comment">// &lt;= 2</span><font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> theirs = other <span class="hljs-keyword">as</span> IImmutableArray;
    <span class="hljs-keyword">if</span> (theirs != <span class="hljs-literal">null</span>) <span class="hljs-comment">// &lt;= 3</span><font></font>
    {<font></font>
      otherArray = theirs.Array;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span> &amp;&amp; otherArray == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span>) <span class="hljs-comment">// &lt;= 4</span><font></font>
      {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
      }<font></font>
  }<font></font>
<font></font>
  IStructuralEquatable ours = self.array; <span class="hljs-comment">// &lt;= 5</span>
  <span class="hljs-keyword">return</span> ours.Equals(otherArray, comparer);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要点1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == this.array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self = thisによる</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。したがって、メソッドを呼び出す前に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.array == nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態にする必要があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーポイント2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を無視することができます</font><font style="vertical-align: inherit;">。これは、目標を達成するための最も簡単なオプションです。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を無視するに</font><font style="vertical-align: inherit;">は、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">other</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の型が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型</font><font style="vertical-align: inherit;">またはその派生</font><font style="vertical-align: inherit;">型</font><font style="vertical-align: inherit;">であり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">otherが</font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullでなければ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十分</font><font style="vertical-align: inherit;">です。次に</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">otherArrayで</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子を使用した後</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロ以外の参照が書き込まれ、最初の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は無視され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーポイント3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この点は、より複雑なパスを意味します。</font><font style="vertical-align: inherit;">2番目の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（条件式</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">theirs！= Nullを含むもの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">間違いなく出かける必要があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これが発生せず、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分岐の</font><font style="vertical-align: inherit;">実行が始まる</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、キーポイント4により</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供されているため、必要なポイント5に到達しないことが保証され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">キーポイント3の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメントに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入らないためには</font><font style="vertical-align: inherit;">、次のいずれかを実行する必要があります。条件：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのため、実際のタイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">other</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IImmutableArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェイスを実装しません</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーポイント5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">このポイントに到達する</font><font style="vertical-align: inherit;">と、目標が達成され、メソッドに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の例外がスローされ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目標に導く次のデータセットを取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.arrayはnull</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目は次のいずれかです。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のタイプは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはその派生物です。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型</font><font style="vertical-align: inherit;">またはその派生物がなく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IImmutableArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェイスを実装していません</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、次のように宣言されたフィールドです。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">internal</span> T[] array;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以来</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImmutableArray &lt;T&gt;は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造であり、それは、その結果として、（引数なし）既定のコンストラクタを有する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレイ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドは</font><font style="vertical-align: inherit;">、デフォルトの値は、かかる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして、これが私たちに必要なものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、インターフェイスメソッドの明示的な実装を調査したことを忘れないでください。したがって、呼び出しの前にキャストを実行する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、3つの方法で例外を達成するためのすべてのカードが手に入りました。</font><font style="vertical-align: inherit;">ライブラリのデバッグバージョンを接続し、コードを記述して実行し、観察します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードスニペット1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> comparer = EqualityComparer&lt;String&gt;.Default;<font></font>
ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword">new</span> ImmutableArray&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
((IStructuralEquatable)immutableArray).Equals(<span class="hljs-literal">null</span>, comparer);</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードスニペット2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> comparer = EqualityComparer&lt;String&gt;.Default;<font></font>
ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword">new</span> ImmutableArray&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
((IStructuralEquatable)immutableArray).Equals(<span class="hljs-keyword">new</span> <span class="hljs-keyword">string</span>[] { }, comparer);</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードスニペット3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> comparer = EqualityComparer&lt;String&gt;.Default;<font></font>
ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword">new</span> ImmutableArray&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
((IStructuralEquatable)immutableArray).Equals(<span class="hljs-keyword">typeof</span>(Object), comparer);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つすべてのコードフラグメントの実行結果は同じになりますが、入力データと実行パスが異なるために実行されます。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/a3b/e8a/13aa3be8a0b68a646aee130773f2c862.png" alt="画像18"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題54</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
忘れていない場合は、別の方法で妥協する必要があります。</font><font style="vertical-align: inherit;">:)今回だけは、そのような詳細には分解しません。</font><font style="vertical-align: inherit;">さらに、前の例の情報の一部はすでに知っています。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">int</span> IStructuralComparable.CompareTo(<span class="hljs-keyword">object</span> other, IComparer comparer)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;<font></font>
  Array otherArray = other <span class="hljs-keyword">as</span> Array;
  <span class="hljs-keyword">if</span> (otherArray == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> theirs = other <span class="hljs-keyword">as</span> IImmutableArray;
    <span class="hljs-keyword">if</span> (theirs != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      otherArray = theirs.Array;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span> &amp;&amp; otherArray == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (self.array == <span class="hljs-literal">null</span> ^ otherArray == <span class="hljs-literal">null</span>)<font></font>
      {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<font></font>
                    SR.ArrayInitializedStateNotEqual, <span class="hljs-keyword">nameof</span>(other));<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (otherArray != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    IStructuralComparable ours = self.array;<font></font>
    <span class="hljs-keyword">return</span> ours.CompareTo(otherArray, comparer); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(SR.ArrayLengthsNotEqual, <span class="hljs-keyword">nameof</span>(other));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証された後、「ours」オブジェクトが使用されました。</font><font style="vertical-align: inherit;">チェック行：1265、1251。ImmutableArray_1.cs 1265 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、状況は前に検討した例と非常に似ています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコードを書きます。</font></font><br>
<br>
<pre><code class="cs hljs">Object other = ....;
<span class="hljs-keyword">var</span> comparer = Comparer&lt;String&gt;.Default;<font></font>
ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword">new</span> ImmutableArray&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
((IStructuralComparable)immutableArray).CompareTo(other, comparer);</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
型の例外が</font><i><font style="vertical-align: inherit;">発生する</font></i><font style="vertical-align: inherit;">ポイントに到達するように、入力値を選択してみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい文字列[] {}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eef/d77/08a/eefd7708a187f5060f2074e642f18434.png" alt="画像22"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、メソッドで例外が発生する一連の入力データを再び選択することができました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題55 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Net.HttpListener</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロジェクト</font><font style="vertical-align: inherit;">には、疑わしいだけでなく、互いに非常によく似た場所</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">いくつかあり</font><font style="vertical-align: inherit;">ました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">繰り返しになりますが、コピーと貼り付けについての漠然とした疑問が潜んでいます。</font><font style="vertical-align: inherit;">パターンは同じなので、コード例を1つ考えてください。他の場合は、アナライザーの警告を表示します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> IAsyncResult <span class="hljs-title">BeginRead</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] buffer, ....</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (NetEventSource.IsEnabled)<font></font>
  {<font></font>
    NetEventSource.Enter(<span class="hljs-keyword">this</span>);<font></font>
    NetEventSource.Info(<span class="hljs-keyword">this</span>, 
                        <span class="hljs-string">"buffer.Length:"</span> + buffer.Length + 
                        <span class="hljs-string">" size:"</span> + size + 
                        <span class="hljs-string">" offset:"</span> + offset);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (buffer == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(buffer));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証される前に 'buffer'オブジェクトが使用されました。行をチェック：51は、53 HttpRequestStream.cs 51 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
型の例外を投げる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外ArgumentNullException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファ== nullが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明示的にそのヒント</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、この変数に無効な値です。ただし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetEventSource.IsEnabled</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">式の値</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、式</font><i><font style="vertical-align: inherit;">buffer.Lengthを</font></i><font style="vertical-align: inherit;">評価するときに</font><font style="vertical-align: inherit;">、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外が</font><i><font style="vertical-align: inherit;">スローされ</font></i><font style="vertical-align: inherit;">ます。したがって、</font><i><font style="vertical-align: inherit;">バッファを</font></i><font style="vertical-align: inherit;">チェックする前に</font><i><font style="vertical-align: inherit;">== null</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この場合、問題は解決されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まったく同じパターンで他のメソッドに対して発行されたPVS-Studio警告：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'buffer'オブジェクトは、nullに対して検証される前に使用されました。</font><font style="vertical-align: inherit;">チェック行：49、51。HttpResponseStream.cs 49</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'buffer'オブジェクトは、nullに対して検証される前に使用されました。</font><font style="vertical-align: inherit;">チェック行：74、75。HttpResponseStream.cs 74</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題56</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
同様のコードが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Transactions.Local</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトで見つかりました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnterState</span>(<span class="hljs-params">InternalTransaction tx</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (tx._outcomeSource._isoLevel == IsolationLevel.Snapshot)<font></font>
  {<font></font>
    <span class="hljs-keyword">throw</span> TransactionException.CreateInvalidOperationException(<font></font>
            TraceSourceType.TraceSourceLtm,<font></font>
            SR.CannotPromoteSnapshot, <font></font>
            <span class="hljs-literal">null</span>, <font></font>
            tx == <span class="hljs-literal">null</span> ? Guid.Empty : tx.DistributedTxId);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「tx」オブジェクトは、nullに対して検証される前に使用されました。チェック行：3282、3285。TransactionState.cs 3282 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定の条件下で、タイプ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidOperationExceptionの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外をスローする必要があります</font><font style="vertical-align: inherit;">。メソッドが呼び出されると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを使用して例外オブジェクトが作成され</font><font style="vertical-align: inherit;">、式</font><i><font style="vertical-align: inherit;">tx.DistributedTxIdを</font></i><font style="vertical-align: inherit;">評価するとき</font><font style="vertical-align: inherit;">にタイプ</font><i><font style="vertical-align: inherit;">NullReferenceExceptionの</font></i><font style="vertical-align: inherit;">例外をスローしないように</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がチェックされ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。皮肉なことに、if </font><i><font style="vertical-align: inherit;">tx</font></i><font style="vertical-align: inherit;"> - </font><i><font style="vertical-align: inherit;">nullの</font></i><font style="vertical-align: inherit;">場合、</font><font style="vertical-align: inherit;">このチェックは役に立ちません</font><i><font style="vertical-align: inherit;">。if </font></i><i><font style="vertical-align: inherit;">ステートメントの</font></i><font style="vertical-align: inherit;">条件を計算するときに</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンスフィールドは、を介してアクセスされる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TXの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tx._outcomeSource._isoLevel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">System.Runtime.Caching</font></i><font style="vertical-align: inherit;"> 
プロジェクトから</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">57</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードを</font><b><font style="vertical-align: inherit;">発行し</font></b><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetLimit</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> cacheMemoryLimitMegabytes</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">long</span> cacheMemoryLimit = cacheMemoryLimitMegabytes;<font></font>
  cacheMemoryLimit = cacheMemoryLimit &lt;&lt; MEGABYTE_SHIFT;<font></font>
<font></font>
  _memoryLimit = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-comment">// never override what the user specifies as the limit;</span>
  <span class="hljs-comment">// only call AutoPrivateBytesLimit when the user does not specify one.</span>
  <span class="hljs-keyword">if</span> (cacheMemoryLimit == <span class="hljs-number">0</span> &amp;&amp; _memoryLimit == <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-comment">// Zero means we impose a limit</span><font></font>
    _memoryLimit = EffectiveProcessMemoryLimit;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cacheMemoryLimit != <span class="hljs-number">0</span> &amp;&amp; _memoryLimit != <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-comment">// Take the min of "cache memory limit" and </span>
    <span class="hljs-comment">// the host's "process memory limit".</span><font></font>
    _memoryLimit = Math.Min(_memoryLimit, cacheMemoryLimit);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cacheMemoryLimit != <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-comment">// _memoryLimit is 0, but "cache memory limit" </span>
    <span class="hljs-comment">// is non-zero, so use it as the limit</span><font></font>
    _memoryLimit = cacheMemoryLimit;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">式 'cacheMemoryLimit！= 0 &amp;&amp; _memoryLimit！= 0'は常にfalseです。 CacheMemoryMonitor.cs 250 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードをよく見ると、式の1つ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-cacheMemoryLimit！= 0 &amp;&amp; _memoryLimit！= 0-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseである</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことが</font><i><font style="vertical-align: inherit;">わかり</font></i><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。以来</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_memoryLimitが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値0（前に設定している</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if文を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、&amp;&amp;演算子の右オペランドは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偽</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従って、全体の発現の結果でもある、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偽</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題58</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
以下は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Diagnostics.TraceSource</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトからの疑わしいコード</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">object</span> <span class="hljs-title">Pop</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  StackNode n = _stack.Value;<font></font>
  <span class="hljs-keyword">if</span> (n == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">base</span>.Pop();<font></font>
  }<font></font>
  _stack.Value = n.Prev;<font></font>
  <span class="hljs-keyword">return</span> n.Value;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullに対して検証された後、「n」オブジェクトが使用されました。チェック行：115、111。CorrelationManager.cs 115 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いコード。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をチェックする</font><font style="vertical-align: inherit;">ため、このローカル変数の値として</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">考えられ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。この場合、</font><font style="vertical-align: inherit;">インスタンスプロパティ</font><i><font style="vertical-align: inherit;">-n.Prev</font></i><font style="vertical-align: inherit;">にアクセスする</font><font style="vertical-align: inherit;">と、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプの例外が</font><i><font style="vertical-align: inherit;">以下</font></i><font style="vertical-align: inherit;">で生成され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。この場合の</font><i><font style="vertical-align: inherit;">n</font></i><font style="vertical-align: inherit;">を</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">できない場合</font><font style="vertical-align: inherit;">、このコンテキストで</font><i><font style="vertical-align: inherit;">base.Pop（）</font></i><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">呼び出す</font><font style="vertical-align: inherit;">ことはできません</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">問題59</font></b><font style="vertical-align: inherit;"> 
プロジェクト</font><i><font style="vertical-align: inherit;">System.Drawing.Primitives</font></i><font style="vertical-align: inherit;">で興味深い場所が見つかりました</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして再び、私は自分で問題を見つけることを提案します。</font><font style="vertical-align: inherit;">これがコードです：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToHtml</span>(<span class="hljs-params">Color c</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">string</span> colorString = <span class="hljs-keyword">string</span>.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (c.IsEmpty)
    <span class="hljs-keyword">return</span> colorString;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ColorUtil.IsSystemColor(c))<font></font>
  {<font></font>
    <span class="hljs-keyword">switch</span> (c.ToKnownColor())<font></font>
    {<font></font>
      <span class="hljs-keyword">case</span> KnownColor.ActiveBorder:<font></font>
        colorString = <span class="hljs-string">"activeborder"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.GradientActiveCaption:
      <span class="hljs-keyword">case</span> KnownColor.ActiveCaption:<font></font>
        colorString = <span class="hljs-string">"activecaption"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.AppWorkspace:<font></font>
        colorString = <span class="hljs-string">"appworkspace"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.Desktop:<font></font>
        colorString = <span class="hljs-string">"background"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.Control:<font></font>
        colorString = <span class="hljs-string">"buttonface"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.ControlLight:<font></font>
        colorString = <span class="hljs-string">"buttonface"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.ControlDark:<font></font>
        colorString = <span class="hljs-string">"buttonshadow"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.ControlText:<font></font>
        colorString = <span class="hljs-string">"buttontext"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.ActiveCaptionText:<font></font>
        colorString = <span class="hljs-string">"captiontext"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.GrayText:<font></font>
        colorString = <span class="hljs-string">"graytext"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.HotTrack:
      <span class="hljs-keyword">case</span> KnownColor.Highlight:<font></font>
        colorString = <span class="hljs-string">"highlight"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.MenuHighlight:
      <span class="hljs-keyword">case</span> KnownColor.HighlightText:<font></font>
        colorString = <span class="hljs-string">"highlighttext"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.InactiveBorder:<font></font>
        colorString = <span class="hljs-string">"inactiveborder"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.GradientInactiveCaption:
      <span class="hljs-keyword">case</span> KnownColor.InactiveCaption:<font></font>
        colorString = <span class="hljs-string">"inactivecaption"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.InactiveCaptionText:<font></font>
        colorString = <span class="hljs-string">"inactivecaptiontext"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.Info:<font></font>
        colorString = <span class="hljs-string">"infobackground"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.InfoText:<font></font>
        colorString = <span class="hljs-string">"infotext"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.MenuBar:
      <span class="hljs-keyword">case</span> KnownColor.Menu:<font></font>
        colorString = <span class="hljs-string">"menu"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.MenuText:<font></font>
        colorString = <span class="hljs-string">"menutext"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.ScrollBar:<font></font>
        colorString = <span class="hljs-string">"scrollbar"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.ControlDarkDark:<font></font>
        colorString = <span class="hljs-string">"threeddarkshadow"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.ControlLightLight:<font></font>
        colorString = <span class="hljs-string">"buttonhighlight"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.Window:<font></font>
        colorString = <span class="hljs-string">"window"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.WindowFrame:<font></font>
        colorString = <span class="hljs-string">"windowframe"</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> KnownColor.WindowText:<font></font>
        colorString = <span class="hljs-string">"windowtext"</span>;
        <span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.IsNamedColor)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (c == Color.LightGray)<font></font>
    {<font></font>
      <span class="hljs-comment">// special case due to mismatch between Html and enum spelling</span>
      colorString = <span class="hljs-string">"LightGrey"</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
      colorString = c.Name;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    colorString = <span class="hljs-string">"#"</span> + c.R.ToString(<span class="hljs-string">"X2"</span>, <span class="hljs-literal">null</span>) +<font></font>
                        c.G.ToString(<span class="hljs-string">"X2"</span>, <span class="hljs-literal">null</span>) +<font></font>
                        c.B.ToString(<span class="hljs-string">"X2"</span>, <span class="hljs-literal">null</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> colorString;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、さて、再び、これらは私のジョークです...またはあなたはできますか？</font><font style="vertical-align: inherit;">いずれの場合も、コードを短くして問題をより明確に示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にコードの短縮版を示します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">switch</span> (c.ToKnownColor())<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">case</span> KnownColor.Control:<font></font>
    colorString = <span class="hljs-string">"buttonface"</span>;
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> KnownColor.ControlLight:<font></font>
    colorString = <span class="hljs-string">"buttonface"</span>;
    <span class="hljs-keyword">break</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3139</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つ以上のケースブランチが同じアクションを実行します。</font><font style="vertical-align: inherit;">ColorTranslator.cs 302 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確かには言えませんが、これはまだ間違いだと思います。</font><font style="vertical-align: inherit;">他の場合では、複数の列挙要素に同じ値を返したい場合、</font><font style="vertical-align: inherit;">互いに続く</font><font style="vertical-align: inherit;">いくつかの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケース</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そして、コピー・ペーストを間違えることは、私には思えるほど簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう少し掘り下げます。</font><font style="vertical-align: inherit;">分析された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToHtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドの出力で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「buttonface」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を取得するに</font><font style="vertical-align: inherit;">は、次の値のいずれかを入力に渡すことができます（予想）。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.Control</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.ControlLight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの各色のARGB値を見ると、次のことがわかります。</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.Control</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（255、240、240、240）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.ControlLight-（255、227、227、227）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受け取った値（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「buttonface」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を逆変換メソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-FromHtmlで呼び出す</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、色</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control（</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">255、240、240、240</font></i><font style="vertical-align: inherit;">）が取得され</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FromHtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ControlLight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カラー</font><font style="vertical-align: inherit;">を取得できます</font><font style="vertical-align: inherit;">か？</font><font style="vertical-align: inherit;">はい。</font><font style="vertical-align: inherit;">この方法では、（特定の場合に）どの色を取得するかに基づいたカラーテーブルがあります。</font><font style="vertical-align: inherit;">テーブル初期化子には次の行があります。</font></font><br>
<br>
<pre><code class="cs hljs">s_htmlSysColorTable[<span class="hljs-string">"threedhighlight"</span>] <font></font>
  = ColorUtil.FromKnownColor(KnownColor.ControlLight);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FromHtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">、値</font><i><font style="vertical-align: inherit;">"threedhighlight"</font></i><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ControlLight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カラー</font><i><font style="vertical-align: inherit;">（</font></i><i><font style="vertical-align: inherit;">255、227、227、227）を</font></i><font style="vertical-align: inherit;">返します</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">KnownColor.ControlLightの場合に</font></i><font style="vertical-align: inherit;">使用されるべきだったのはこの値だったと思います</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">問題60 </font></b><i><font style="vertical-align: inherit;">System.Text.RegularExpressions</font></i><font style="vertical-align: inherit;"> 
プロジェクトからの</font><i><font style="vertical-align: inherit;">いくつかの</font></i><font style="vertical-align: inherit;">興味深い警告を見てください</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">string</span> <span class="hljs-title">TextposDescription</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> sb = <span class="hljs-keyword">new</span> StringBuilder();
  <span class="hljs-keyword">int</span> remaining;<font></font>
<font></font>
  sb.Append(runtextpos);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (sb.Length &lt; <span class="hljs-number">8</span>)<font></font>
    sb.Append(<span class="hljs-string">' '</span>, <span class="hljs-number">8</span> - sb.Length);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (runtextpos &gt; runtextbeg)<font></font>
    sb.Append(RegexCharClass.CharDescription(runtext[runtextpos - <span class="hljs-number">1</span>]));
  <span class="hljs-keyword">else</span>
    sb.Append(<span class="hljs-string">'^'</span>);<font></font>
<font></font>
  sb.Append(<span class="hljs-string">'&gt;'</span>);<font></font>
<font></font>
  remaining = runtextend - runtextpos;<font></font>
<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = runtextpos; i &lt; runtextend; i++)<font></font>
  {<font></font>
    sb.Append(RegexCharClass.CharDescription(runtext[i]));<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (sb.Length &gt;= <span class="hljs-number">64</span>)<font></font>
  {<font></font>
    sb.Length = <span class="hljs-number">61</span>;<font></font>
    sb.Append(<span class="hljs-string">"..."</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    sb.Append(<span class="hljs-string">'$'</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> sb.ToString();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3137</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「残りの」変数が割り当てられていますが、関数の最後で使用されていません。 RegexRunner.cs 612 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカル変数の</font><i><font style="vertical-align: inherit;">残りに</font></i><font style="vertical-align: inherit;">書き込まれ</font><font style="vertical-align: inherit;">ます</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">、メソッドが終了するまで使用されません。おそらくそれを使用しているいくつかのコードは削除されましたが、変数自体を忘れていました。または、これはより深刻な間違いであり、この変数は何らかの方法で使用する必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戸建61</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddRange</span>(<span class="hljs-params"><span class="hljs-keyword">char</span> first, <span class="hljs-keyword">char</span> last</span>)</span><font></font>
{<font></font>
  _rangelist.Add(<span class="hljs-keyword">new</span> SingleRange(first, last));
  <span class="hljs-keyword">if</span> (_canonical &amp;&amp; _rangelist.Count &gt; <span class="hljs-number">0</span> &amp;&amp;<font></font>
     first &lt;= _rangelist[_rangelist.Count - <span class="hljs-number">1</span>].Last)<font></font>
  {<font></font>
    _canonical = <span class="hljs-literal">false</span>;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-メーカー</font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3063</font></a><font style="vertical-align: inherit;"> Aそれが評価された場合、条件式の一部が常に真です：_rangelist.Count&gt; 0 RegexCharClass.cs 523 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-アナライザは正しく表現の一部と指摘</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_rangelist.Count&gt; 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -常になります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合このコードが実行されます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_rangelist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">指すリスト</font><font style="vertical-align: inherit;">が空であった</font><font style="vertical-align: inherit;">としても</font><font style="vertical-align: inherit;">、要素</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_rangelist.Add（....）を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加した後は、その</font><font style="vertical-align: inherit;">ようなものではなくなります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題62 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">System.Drawing.Common</font></i><font style="vertical-align: inherit;">および</font><i><font style="vertical-align: inherit;">System.Transactions.Local</font></i><font style="vertical-align: inherit;">プロジェクト</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
での</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3128</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">診断ルールのトリガーを見てみましょう</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ArrayEnumerator</span> : <span class="hljs-title">IEnumerator</span><font></font>
{<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span>[] _array;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _item;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> _index;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> _startIndex;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> _endIndex;
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayEnumerator</span>(<span class="hljs-params"><span class="hljs-keyword">object</span>[] array, <span class="hljs-keyword">int</span> startIndex, <span class="hljs-keyword">int</span> count</span>)</span><font></font>
  {<font></font>
    _array = array;<font></font>
    _startIndex = startIndex;<font></font>
    _endIndex = _index + count;<font></font>
<font></font>
    _index = _startIndex;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3128</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「_index」フィールドは、コンストラクターで初期化される前に使用されます。 PrinterSettings.Windows.cs 1679 </font><i><font style="vertical-align: inherit;">_endIndex</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フィールドを初期化するとき</font><font style="vertical-align: inherit;">、別のフィールドが使用されます</font><i><font style="vertical-align: inherit;">-_index</font></i><font style="vertical-align: inherit;">、使用時に標準値- </font><i><font style="vertical-align: inherit;">デフォルト（int）</font></i><font style="vertical-align: inherit;">、つまり</font><i><font style="vertical-align: inherit;">0を</font></i><font style="vertical-align: inherit;">持ち</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">_index</font></i><font style="vertical-align: inherit;">フィールドの下</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">すでに初期化されています。突然これがエラーではない場合、</font><font style="vertical-align: inherit;">混乱しないように、この式で</font><font style="vertical-align: inherit;">は</font><i><font style="vertical-align: inherit;">_index</font></i><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">を省略してください。</font><b><font style="vertical-align: inherit;">戸建63</font></b></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TransactionTable</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> _timerInterval;<font></font>
  .... <font></font>
  <span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-title">TransactionTable</span>(<span class="hljs-params"></span>)</span><font></font>
  {<font></font>
    <span class="hljs-comment">// Create a timer that is initially disabled by specifing </span>
    <span class="hljs-comment">//  an Infinite time to the first interval</span>
    _timer = <span class="hljs-keyword">new</span> Timer(<span class="hljs-keyword">new</span> TimerCallback(ThreadTimer), 
                       <span class="hljs-literal">null</span>, <font></font>
                       Timeout.Infinite,<font></font>
                       _timerInterval);<font></font>
<font></font>
    ....<font></font>
<font></font>
    <span class="hljs-comment">// Store the timer interval</span>
    _timerInterval = <span class="hljs-number">1</span> &lt;&lt; TransactionTable.timerInternalExponent;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3128</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「_timerInterval」フィールドは、コンストラクターで初期化される前に使用されます。</font><font style="vertical-align: inherit;">TransactionTable.cs 151 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状況は上記で説明したものと同様です。</font><font style="vertical-align: inherit;">最初は、の値を使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_timerInterval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドを</font><font style="vertical-align: inherit;">（それがまだある間に等しい</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（int）をデフォルト</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化する）</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_timer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、とだけにして初期化</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_timerInterval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font><i><font style="vertical-align: inherit;">自体を</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題64</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次の警告は、まだ開発中の診断ルールによって受信されました。</font><font style="vertical-align: inherit;">彼にはまだ文書も最終報告もありませんが、彼の助けによりすでにいくつかの興味深い場所を見つけることができました。</font><font style="vertical-align: inherit;">再びこれらの場所は</font><i><font style="vertical-align: inherit;">コピーと貼り付けの</font></i><font style="vertical-align: inherit;">ように見えます</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なので、1つのコードのみを検討します。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ProcessNotifyConnection</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  WeakReference reference = (WeakReference)(<font></font>
    LdapConnection.s_handleTable[referralFromConnection]);<font></font>
  <span class="hljs-keyword">if</span> (   reference != <span class="hljs-literal">null</span> <font></font>
      &amp;&amp; reference.IsAlive <font></font>
      &amp;&amp; <span class="hljs-literal">null</span> != ((LdapConnection)reference.Target)._ldapHandle)<font></font>
  { .... }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio警告（スタブ）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：VXXXX TODO_MESSAGE。 LdapSessionOptions.cs 974 </font><i><font style="vertical-align: inherit;">reference.IsAliveを</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
確認した後</font><font style="vertical-align: inherit;">にガベージコレクションが実行され、</font><i><font style="vertical-align: inherit;">WeakReference</font></i><font style="vertical-align: inherit;">によって参照されるオブジェクトがその下に置かれる</font><font style="vertical-align: inherit;">と、</font><i><font style="vertical-align: inherit;">reference.Target</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">を返す</font><font style="vertical-align: inherit;">という危険があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。その結果、インスタンスフィールド</font><i><font style="vertical-align: inherit;">_ldapHandle</font></i><font style="vertical-align: inherit;">にアクセスすると、</font><font style="vertical-align: inherit;">タイプ</font><i><font style="vertical-align: inherit;">NullReferenceExceptionの</font></i><font style="vertical-align: inherit;">例外が</font><i><font style="vertical-align: inherit;">スローされ</font></i><font style="vertical-align: inherit;">ます。実際、Microsoft自体は、IsAliveの検証によりこのトラップについて警告しています。 docs.microsoft.comからの引用-" </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">WeakReference.IsAliveプロパティ</font></a><font style="vertical-align: inherit;"> "：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i>Because an object could potentially be reclaimed for garbage collection immediately after the IsAlive property returns true, using this property is not recommended unless you are testing only for a false return value.</i><br>
<br>
<h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析の結果、これらすべてのエラーと興味深い場所が見つかりましたか？もちろん違います！分析の結果を見てから、私は警告を注意深く調べました。それらの数が増え、記事に警告があることが明らかになったので、私は結果に目を通し、最も興味深いと思われるものだけを選択しようとしました。最後のログ（最大のログ）に到達したとき、残ったのはすべて、すべての警告をめくるだけであり、目が何か変わったことに気づきました。なので、掘り下げるともっと面白い場所が見つかるはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、私はほとんどすべての警告</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を無視</font><font style="vertical-align: inherit;">し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。比較的言えば、次の形式のコードがあった場合：</font></font><br>
<br>
<pre><code class="cs hljs">String str = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span>) <font></font>
  ....</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が説明したい興味深い場所があったので、私はそれを逃しました。</font><i><font style="vertical-align: inherit;">thisを</font></i><font style="vertical-align: inherit;">ロック</font><font style="vertical-align: inherit;">する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lockステートメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用した安全でないロックのトリガーがありました</font><font style="vertical-align: inherit;">。 - </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V3090</font></a><font style="vertical-align: inherit;"> ;安全でないイベント呼び出し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">-V3083</font></a><font style="vertical-align: inherit;"> ;タイプが</font><i><font style="vertical-align: inherit;">IDisposableを</font></i><font style="vertical-align: inherit;">実装している</font><font style="vertical-align: inherit;">が、</font><i><font style="vertical-align: inherit;">Dispose</font></i><font style="vertical-align: inherit;"> / </font><i><font style="vertical-align: inherit;">Close</font></i><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">呼び出されない</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">オブジェクト-V3072</font></a><font style="vertical-align: inherit;">および同様の診断。そして、はるかに。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
書き出さなかった（少なくとも試しましたが、誤って書き出すことができました）テストで見つかった問題を見つけました。それらに注意を引くために私にとって十分に興味深く思えたいくつかの場所に加えて。ただし、テストコードがエラーを含むこともあります。そのため、テストは正しく機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、まだ学ぶべきことはありますが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、見つかったすべての問題を完全</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">書き出す</font><font style="vertical-align: inherit;">という目標は設定しませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードの品質にばらつきがあるようです。完全にクリーンなプロジェクトもあれば、疑わしい場所が含まれているプロジェクトもあります。おそらく、プロジェクトの純粋さが期待されます。特に、最も一般的に使用されるライブラリクラスの場合はそうです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般化するとしたら、おそらくコードの量はかなり分析されているという事実を考慮すると、コードは非常に高品質であると言えます。</font><font style="vertical-align: inherit;">しかし、この記事から次のように、いくつかの暗いコーナーがありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、このサイズのプロジェクトは、アナライザーにとっても良いテストです。</font><font style="vertical-align: inherit;">検査と修正のために選択した一連の誤った/奇妙な警告を見つけることができました。</font><font style="vertical-align: inherit;">したがって、分析の結果、PVS-Studio自体で作業する価値のあるポイントを見つけることができました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事全文を読んだ後でこの場所に着いたら、握手をしましょう。</font><font style="vertical-align: inherit;">興味深いエラーを表示し、静的分析の利点を実証できたと思います。</font><font style="vertical-align: inherit;">さらに優れたコードを記述できる新しい何かを自分で習得した場合、私は二重に嬉しく思います。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ef/dbc/f2d/6efdbcf2d984bef000cf44face04c6a4.png" alt="画像24"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれにせよ、静的解析の助けは不必要ではないので、私は</font><font style="vertical-align: inherit;">あなたのプロジェクトで</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">試して</font></a><font style="vertical-align: inherit;">、それを</font><font style="vertical-align: inherit;">使ってどんな興味深い場所を見つけることができるかを確認することをお</font><font style="vertical-align: inherit;">勧め</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">質問がある場合、または発見された興味深い場所を共有したい場合は、</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support @ viva64.comまでお</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">気軽にご</font><a href=""><font style="vertical-align: inherit;">連絡ください</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最高です！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS .NET Coreライブラリの開発者への連絡</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうもありがとうございました！</font><font style="vertical-align: inherit;">あなたは素晴らしい仲間です。</font><font style="vertical-align: inherit;">この記事がコードの改善に役立つことを願っています。</font><font style="vertical-align: inherit;">記事のすべての不審な場所を書き留めたわけではないことを忘れないでください。アナライザーを使用してプロジェクトを個別にチェックする方が良いです。この方法では、すべての警告をより詳細に調査でき、単純なテキストログ/エラーリストを使用するよりも作業する方が便利です（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これについて</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もう少し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">書きました）こちら</font></a><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：セルゲイヴァシリエフ。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Static Analyzerによる.NETコアライブラリのソースコードの確認</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja463511/index.html">「燃える、消えるまではっきりと燃やす」、または従業員の精神的な燃え尽きの危険は何ですか</a></li>
<li><a href="../ja463515/index.html">HTMS APIを使用してリレーショナルネットワークデータベースを操作する</a></li>
<li><a href="../ja463525/index.html">セレン、セレノイド、セレニド、セレンドロイド...これはどういう意味ですか？</a></li>
<li><a href="../ja463527/index.html">現れる！iOSで転写</a></li>
<li><a href="../ja463533/index.html">すべての開発者が最初から知っておくべきこと</a></li>
<li><a href="../ja463541/index.html">Cisco 200-125 CCNA v3.0のトレーニング。17日目：CCNAコースのまとめとロードマップ</a></li>
<li><a href="../ja463551/index.html">従業員との関係と大規模IT企業のワークフローの整理方法</a></li>
<li><a href="../ja463553/index.html">「あなたはグーグルの人々ですか？」または採用時に行った5つのこと</a></li>
<li><a href="../ja463559/index.html">Cisco 200-125 CCNA v3.0のトレーニング。18日目。ルーティングの基本</a></li>
<li><a href="../ja463563/index.html">Cisco 200-125 CCNA v3.0のトレーニング。19日目。ルーターを使い始める</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>