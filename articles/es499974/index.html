<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíù üìπ üßôüèæ Juegos 3D en Javascript de Instagram, o ruta de vuelo de salchichas üë∑üèº üëäüèº ‚òÅÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despu√©s del primer art√≠culo sobre la programaci√≥n de juegos con m√°scaras en Instagram, un cliente me pidi√≥ que creara un juego en Instagram para su pi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Juegos 3D en Javascript de Instagram, o ruta de vuelo de salchichas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499974/"><img src="https://habrastorage.org/webt/gl/zq/2a/glzq2aogs8xde9o1cauyy8qc838.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s del primer art√≠culo sobre la programaci√≥n de juegos con m√°scaras en Instagram, un cliente me pidi√≥ que creara un juego en Instagram para su pizzer√≠a. Este juego fue planeado para ser utilizado con fines de promoci√≥n comercial. Por supuesto, entiendo que, a juzgar por la cantidad de visitas del primer art√≠culo, el tema de Instagram no es particularmente interesante para la comunidad de Habr. Aparentemente, este servicio todav√≠a se considera una especie de entretenimiento fr√≠volo para las rubias, y un art√≠culo sobre √©l solo es adecuado como lectura de viernes para un c√≥ctel nocturno. Sin embargo, hoy, solo viernes. Consigue un c√≥ctel. Y no olvides invitar a las rubias. Sin embargo, es probable que en el futuro la tecnolog√≠a alcance tal altura que comencemos a jugar en Instagram en GTA-5. O 10.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo discutir√° dos juegos a la vez. </font><font style="vertical-align: inherit;">Hice uno para ordenar, y luego el segundo para m√≠. </font><font style="vertical-align: inherit;">Con cada nuevo juego, me enfrentaba a nuevas tareas, la b√∫squeda de soluciones que me hicieron conocer los nuevos matices del desarrollo. </font><font style="vertical-align: inherit;">Quiz√°s esta historia sea √∫til para otros desarrolladores de elementos de realidad aumentada. </font><font style="vertical-align: inherit;">Los juegos est√°n escritos en Javascript puro sin el uso de ninguna biblioteca adicional. </font><font style="vertical-align: inherit;">Para mostrar gr√°ficos en 3D, se utilizan las herramientas integradas de Instagram.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juego 1. Pizza</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ¬øcu√°l es la esencia del primer juego? Spinning pizza. Los componentes salen volando de su superficie: trozos de salchicha, tomates, etc. Dos jugadores deben atrapar su boca. El ganador es el que, como puede suponer, atrapar√° m√°s. Con el tiempo, la velocidad de rotaci√≥n aumenta. Lo m√°s divertido de este juego para m√≠ fue programar las rutas de vuelo de estos elementos comestibles. Imagina programar un vuelo de salchicha. No, definitivamente, nunca me hab√≠a divertido tanto con la programaci√≥n. Me r√≠o incluso ahora, escribiendo este art√≠culo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando el cliente vio el prototipo funcional, me envi√≥ esto: ":))". Hubo un problema al probar el resultado final. Consisti√≥ en el hecho de que los sujetos no pod√≠an jugar el juego: simplemente estaban llenos de risas, fue muy divertido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perm√≠teme recordarte que el desarrollo de m√°scaras y juegos se realiza en Spark AR Studio. Y luego desde all√≠ puedes subir tu trabajo en Instagram para que todos lo vean. Es de destacar que las tecnolog√≠as web difuminan los l√≠mites entre los sistemas operativos para un desarrollador. Escribe un c√≥digo, que luego funciona en la aplicaci√≥n de Instagram para iOS y Android, sin modificaciones ni cambios. Por supuesto, el pago de esto se convierte en una velocidad de script fundamentalmente baja.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El horario del juego fue proporcionado por el cliente. Hubo algunas dificultades con los modelos 3D. En particular, al usar el motor de animaci√≥n incorporado Spark AR Studio, result√≥ que si el objeto en movimiento se escala, entonces sus coordenadas se determinan incorrectamente en el juego. Pero este efecto molesto no se observa si no escala el objeto completo por completo, sino cada una de sus mallas por separado. Tuve que dejar la escala de pizza 1: 1, y prescribir un cierto coeficiente para cada elemento que lo hace. Tambi√©n hubo problemas con el formato FBX en el que necesita exportar modelos para un juego de Instagram. El dise√±ador gr√°fico envi√≥ modelos con texturas incorporadas, que, adem√°s, se colocaron a lo largo de un camino relativo. El editor 3D los vio, pero Spark AR no. Tuve que volver a embalar los modelos para que los archivos de textura se separen de los modelos y sigan un camino con ellos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y otro peque√±o problema que encontr√© fue que el objeto API Saprk AR responsable de mostrar el texto en la pantalla se neg√≥ a aceptar el valor como un valor, por ejemplo, una puntuaci√≥n de juego. </font><font style="vertical-align: inherit;">Durante mucho tiempo no pude entender por qu√© no se muestra nada. </font><font style="vertical-align: inherit;">¬øQu√© estoy haciendo mal? </font><font style="vertical-align: inherit;">Result√≥ que primero necesitas convertir los n√∫meros en cadenas (.toString ()). </font><font style="vertical-align: inherit;">Esto es evidente para otros idiomas, pero es bastante at√≠pico para javascript, que siempre lo ha hecho por s√≠ mismo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animaci√≥n simple</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las cosas nuevas para m√≠ en este juego fue programar la animaci√≥n de objetos 3D. (En mi anterior juego de Instagram "Tic-Tac-Toe", no hab√≠a animaci√≥n alguna). El motor de animaci√≥n en Spark AR Studio es muy espec√≠fico. Toma algunos par√°metros de entrada y luego conecta de forma reactiva la variable con el objeto en el que desea cambiar algo. Por ejemplo, esto cambiar√° la coordenada y (startValue, endValue - sus valores iniciales y finales) de alg√∫n objeto 3D a lo largo del tiempo t:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> driverParameters = {
    <span class="hljs-attr">durationMilliseconds</span>: t,
    <span class="hljs-attr">loopCount</span>: <span class="hljs-literal">Infinity</span>,
    <span class="hljs-attr">mirror</span>: <span class="hljs-literal">false</span><font></font>
};<font></font>
<span class="hljs-keyword">var</span> driver = Animation.timeDriver(driverParameters);
<span class="hljs-keyword">var</span> sampler = Animation.samplers.linear(startValue, endValue);<font></font>
sceneObject.transform.y = Animation.animate(driver, sampler);<font></font>
driver.start();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mover los ingredientes de la pizza volando en el espacio, decid√≠ simplemente ejecutar tres de esas animaciones en paralelo para cada coordenada. Fue suficiente para indicar la coordenada inicial (startValue) y la coordenada final calculada por el √°ngulo de rotaci√≥n de la pizza (endValue), de modo que estaba en alg√∫n lugar lejano en caso de que el jugador no atrapara este "caparaz√≥n" con su boca. Si es atrapado, entonces el movimiento se detiene. El evento de apertura de boca que ya describ√≠ en un art√≠culo anterior. Solo aqu√≠ hay un juego para dos y, en consecuencia, ya habr√° dos caras y dos bocas:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});<font></font>
<font></font>
FaceTracking.face(<span class="hljs-number">1</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El punto clave en este juego es atrapar ingredientes voladores con la boca, en otras palabras, encontrar un objeto volador en un √°rea peque√±a determinada alrededor del centro de la boca de una persona. </font><font style="vertical-align: inherit;">Al principio, este c√°lculo no quer√≠a hacerse correctamente para m√≠, pero se encontr√≥ una soluci√≥n al problema despu√©s de la introducci√≥n de un objeto oculto atado a las coordenadas de la boca, y funcion√≥. </font><font style="vertical-align: inherit;">Por alguna raz√≥n, las coordenadas directas de la boca no regresaron. </font><font style="vertical-align: inherit;">Aqu√≠ cameraTransform.applyTo es la reducci√≥n de las coordenadas de los puntos faciales a las coordenadas en el mundo 3D (el m√©todo se toma de la documentaci√≥n).</font></font><br>
<br>
<pre><code class="javascript hljs">move: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//   (   )</span><font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> object = Scene.root.find(<span class="hljs-string">'pizzafly'</span>);
    <span class="hljs-keyword">var</span> olast = {
        <span class="hljs-attr">x</span>: object.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: object.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: object.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   ,       </span>
    <span class="hljs-keyword">var</span> objectHidden = Scene.root.find(<span class="hljs-string">'nullObject'</span>);<font></font>
    objectHidden.transform.x = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).x;<font></font>
    objectHidden.transform.y = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).y;<font></font>
    objectHidden.transform.z = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).z;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> mouth = {
        <span class="hljs-attr">x</span>: objectHidden.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: objectHidden.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: objectHidden.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> d = {
        <span class="hljs-attr">x</span>: <span class="hljs-built_in">Math</span>.abs(olast.x - mouth.x),
        <span class="hljs-attr">y</span>: <span class="hljs-built_in">Math</span>.abs(olast.y - mouth.y),
        <span class="hljs-attr">z</span>: <span class="hljs-built_in">Math</span>.abs(olast.z - mouth.z)<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> ((d.x &gt; <span class="hljs-number">0.03</span>) || (d.y &gt; <span class="hljs-number">0.03</span>) || (d.z &gt; <span class="hljs-number">0.03</span>)) {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    };<font></font>
<font></font>
},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, me di cuenta de que deber√≠a eliminar la verificaci√≥n de profundidad (coordenada z), ya que en este juego en particular es visualmente dif√≠cil estimar la profundidad. </font><font style="vertical-align: inherit;">Es decir, ahora fue posible atrapar el ingrediente abriendo la boca en cualquier momento durante el vuelo. </font><font style="vertical-align: inherit;">Lo principal es la combinaci√≥n de x e y.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nw/v9/dw/nwv9dwt-p5wip4yhnnhtirudgoe.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, el √∫ltimo problema que encontr√© al escribir este juego fue limitar el tama√±o de la compilaci√≥n final a 4 MB. Adem√°s, de acuerdo con la recomendaci√≥n de Facebook, para que el juego se muestre en tantos dispositivos m√≥viles como sea posible, es conveniente incluir incluso 2 MB. Y los modeladores 3D son personas creativas y quieren hacer modelos pesados ‚Äã‚Äãcon una grilla densa y texturas enormes, sin preocuparse por nosotros, los programadores o, m√°s bien, por el rendimiento final en los juegos. Tambi√©n de alguna manera reduje el tama√±o de las texturas y comprim√≠ en jpg (en lugar de png), pero el modelo de pizza en s√≠ tuvo que enviarse para su revisi√≥n (retopolog√≠a). Como resultado, sin embargo, fue posible encajar en el volumen de 2MB con todos los modelos, texturas y un script. Y el juego fue con moderaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y despu√©s de un tiempo regres√≥ con la redacci√≥n de que "el efecto contiene demasiado texto est√°tico". </font><font style="vertical-align: inherit;">Tuve que eliminar los n√∫meros de cuenta regresiva y, en lugar de ellos, establecer la animaci√≥n en la flecha del cron√≥metro, que ahora comenz√≥ a contar el tiempo en lugar de ellos. </font><font style="vertical-align: inherit;">Despu√©s de eso, el juego fue aprobado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juego 2. Sobre la mariposa (ButterFlap)</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wd/dt/63/wddt63fejsxelpizwyffhzw5zig.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora hablar√© sobre crear un segundo juego. No puedo evitar hacer juegos, este es mi hobby. Unos d√≠as antes del 8 de marzo, decid√≠ crear un juego de Instagram para estas vacaciones. Algo sobre flores, mariposas y dulces. Pero no pod√≠a pensar cu√°l podr√≠a ser la esencia del juego. La idea giraba en mi cabeza. ¬øQuiz√°s la mariposa recoger√° dulces y los pondr√° en una canasta? ¬øO tal vez las mariposas recoger√°n dulces en el aire y los arrojar√°n, y el jugador deber√° atraparlos con la boca? En general, estaf√© durante un par de d√≠as y, al no encontrar una soluci√≥n, me di cuenta de que para el 8 de marzo, mi juego a√∫n no tendr√≠a tiempo de pasar por la moderaci√≥n, ya que el √∫ltimo demora de 3 a 4 d√≠as. Ya quer√≠a dejar esta empresa, cuando de repente la idea surgi√≥ por s√≠ sola, de repente. Ya no at√© el juego al D√≠a de la Mujer, ahora era solo un juego.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scroller </font><font style="vertical-align: inherit;">De izquierda a derecha, el paisaje y los diversos obst√°culos se mueven. </font><font style="vertical-align: inherit;">El jugador debe controlar una mariposa que puede moverse libremente dentro de la pantalla y recoger diamantes que cuelgan en el aire. </font><font style="vertical-align: inherit;">Adem√°s, de derecha a izquierda un poco m√°s r√°pido que el resto de la imagen, las nubes se mueven, de las cuales llueve a c√°ntaros. </font><font style="vertical-align: inherit;">Necesitas esconderte de la lluvia debajo de las flores. </font><font style="vertical-align: inherit;">Si una mariposa cae bajo el agua, sus alas se mojan y cae, este es el final del juego. </font><font style="vertical-align: inherit;">Llam√© al juego simplemente: ButterFlap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√≠, todo esto suena bien. </font><font style="vertical-align: inherit;">Yo, directamente, quer√≠a jugar solo. </font><font style="vertical-align: inherit;">Pero record√© que no era artista en absoluto. </font><font style="vertical-align: inherit;">Sin embargo, puedo hacer modelos 3D, y esto es m√°s f√°cil que dibujar. </font><font style="vertical-align: inherit;">Entonces, se decidi√≥, dejar que haya un desplazamiento 3D.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artes graficas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encontr√© modelos libres de regal√≠as en l√≠nea que tuve que refinar. Puso las texturas sobre las que no ten√≠an texturas, ya que las hab√≠a colocado previamente en un atlas de texturas: los artefactos en forma de "escaleras" son visibles en los modelos sin textura, y el suavizado se puede configurar para las texturas en el juego, lo que hace que la apariencia de los objetos sea m√°s presentable y no tan plana. Aquellos modelos que conten√≠an texturas tambi√©n ten√≠an sus defectos que ten√≠an que ser reparados. En primer lugar, el tama√±o de las texturas no era un m√∫ltiplo de dos en el poder. Es decir, por ejemplo, podr√≠a ser igual a 1200x1200. Tuve que comprimir a 1024x1024. Los procesadores de video pueden escalar o completar texturas inapropiadas con espacio vac√≠o, es decir, aquellos que no son 1024x1024, 512x512, 256x256, etc. En cualquier caso, tales acciones son una carga adicional durante el trabajo del juego y un consumo de memoria sin sentido,por lo tanto, es mejor preparar las im√°genes correctas primero manualmente. La situaci√≥n tambi√©n se salv√≥ por el hecho de que distribu√≠ todas las texturas por atlas de texturas, por lo que si, por ejemplo, la textura original ten√≠a un tama√±o de 400x200 p√≠xeles, entonces podr√≠a ponerla en el atlas 1024x1024, como est√°, junto a otras similares. Despu√©s de esto, es naturalmente necesario escalar tambi√©n la exploraci√≥n UV, pero esto se hace en un par de segundos. Todav√≠a encontr√© variantes de modelos donde, por alguna raz√≥n, las texturas estaban ligadas a lo largo de un camino absoluto como "C: \ Work \ Vasya \ Map.jpg". Bueno, ¬°no hay tal carpeta en mi computadora! Ten√≠a que especificar las rutas de acceso a las texturas manualmente ... ¬øPero por qu√© se te ocurri√≥ la idea de que deber√≠a mantener todos mis proyectos en la unidad "C:"? Oh, estos modeladores, artistas libres ... Por cierto, de esta manera, por los nombres de las carpetas en rutas aleatorias, puedes aprender inadvertidamente m√°s sobre la identidad del modelador,Por ejemplo, su nombre. Encantada de conocerte!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s dif√≠cil fue encontrar un modelo de mariposa adecuado con animaci√≥n. Spark AR usa animaci√≥n que se puede exportar desde cualquier editor 3D al formato FBX. Las alas de un par de modelos de mariposas que descargu√© estaban de alguna manera extra√±amente reflejadas: un ala fue modelada y la segunda se reflej√≥ de alguna manera que no entend√≠, y, por lo tanto, dos de ellas resultaron. Con este enfoque de modelado, al final, en el juego, una de las alas (copiada) no quer√≠a recibir luz de la fuente y siempre permanec√≠a tenue. No me arriesgu√© a cambiar dr√°sticamente el modelo, porque entonces la animaci√≥n habr√≠a volado. Y en animaci√≥n soy un novato a√∫n m√°s grande que en modelado 3D. Quiz√°s el problema era otra cosa: intent√©, por ejemplo, expandir las normales, pero eso no ayud√≥. En resumen, los modelos 3D gratuitos son una molestia. Como resultado, habiendo lavado toda la noche,por prueba y error, encontr√© un modelo adecuado, que despu√©s de algunos ajustes con un archivo comenz√≥ a parecer satisfactorio. Algo que no me gust√≥, pero fueron peque√±as cosas: rehice la textura, cambi√© la geometr√≠a en algunos lugares y ajust√© los par√°metros del material. Finalmente, la mariposa se fue. ¬°Hurra! Pero ahora estoy agotado. Entonces decid√≠ acostarme y continuar al d√≠a siguiente. S√≠, pas√© 7-8 d√≠as creando el juego. Pero fue un trabajo bastante pausado por las tardes, leyendo documentaci√≥n, art√≠culos y encontrando respuestas a preguntas.Entonces decid√≠ acostarme y continuar al d√≠a siguiente. S√≠, pas√© 7-8 d√≠as creando el juego. Pero fue un trabajo bastante pausado por las tardes, leyendo documentaci√≥n, art√≠culos y encontrando respuestas a preguntas.Entonces decid√≠ acostarme y continuar al d√≠a siguiente. S√≠, pas√© 7-8 d√≠as creando el juego. Pero fue un trabajo bastante pausado por las tardes, leyendo documentaci√≥n, art√≠culos y encontrando respuestas a preguntas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/zb/iy/rrzbiyezloccrjo_egas613ltry.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda la tarde del d√≠a siguiente trabaj√© en gr√°ficos. La especificidad de las m√°scaras de juego para Instagram, como ya he mencionado, es que es aconsejable no ir m√°s all√° del volumen de 2 MB para todo el juego (m√°ximo 4 MB). No estaba preocupado por el script: es poco probable que su tama√±o supere los 50 Kb. Pero sobre modelos 3D de plantas tuvieron que ser bastante evocados. Por ejemplo, esa parte del girasol donde se encuentran las semillas se hizo por geometr√≠a. Cientos de pol√≠gonos ... Reempl√°celos con un fragmento de una esfera de un par de docenas de tri√°ngulos y estire la textura descargada, de hecho, de esta parte. El n√∫mero de hojas tambi√©n se puede reducir. Hacemos hierba en la parte inferior de la escena con un plano de dos tri√°ngulos con una textura superpuesta con un canal alfa. Alcanzamos el volumen con sombras y copiando fragmentos de la imagen dentro de la textura misma.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, es deseable minimizar el n√∫mero de texturas, as√≠ como su tama√±o en bytes. </font><font style="vertical-align: inherit;">Son las texturas las que crean la mayor parte del juego. </font><font style="vertical-align: inherit;">Estoy acostumbrado a las texturas donde se necesita transparencia, colocadas en un atlas de texturas - en png 32 bit, y las texturas que no usan el canal alfa, empaquetar en otro atlas, guard√°ndolo en jpg. </font><font style="vertical-align: inherit;">Jpg puede reducirse m√°s fuerte que png. </font><font style="vertical-align: inherit;">Los elementos Grass y UI que necesitan transparencia se han ido al atlas png, y todo lo dem√°s a jpg.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El volumen total. </font><font style="vertical-align: inherit;">En total, obtuve 4 tipos de plantas, una roca, una mariposa, que el jugador controlar√°, y una nube. </font><font style="vertical-align: inherit;">Las texturas de todos estos modelos en forma comprimida tomaron 2 atlas 1024x1024 jpg y png con un volumen total de 500 Kb. </font><font style="vertical-align: inherit;">Los modelos mismos tomaron alrededor de 200 Kb. </font><font style="vertical-align: inherit;">Adem√°s de un gui√≥n. </font><font style="vertical-align: inherit;">Sonidos - 31 Kb. </font><font style="vertical-align: inherit;">Total: aproximadamente 1 Mb. </font><font style="vertical-align: inherit;">En verde, solo se muestra el tama√±o de la compilaci√≥n (esto es lo que deber√≠a caber en 2 MB).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/7r/c1/ak7rc1e09ycyaee13ypwnokgeqm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De repente me encontr√© con un problema completamente inesperado. </font><font style="vertical-align: inherit;">Elimin√© varios modelos no utilizados, pero no a trav√©s de Spark AR Studio, sino del sistema de archivos. </font><font style="vertical-align: inherit;">Posteriormente, al ensamblar la construcci√≥n, descubr√≠ que desaparecieron de la escena de Spark AR Studio, pero a√∫n as√≠ entraron en el ensamblaje. </font><font style="vertical-align: inherit;">Y limpiar el proyecto de los recursos no utilizados es imposible. </font><font style="vertical-align: inherit;">Los enlaces a ellos desde el "Resumen de activos" no conducen a ninguna parte. </font><font style="vertical-align: inherit;">Aparentemente, este es un defecto en Spark AR Studio. </font><font style="vertical-align: inherit;">Tuve que recrear el proyecto nuevamente, agregando todos los recursos necesarios all√≠ desde el principio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escena</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He estado pensando durante mucho tiempo sobre c√≥mo implementar el desplazamiento de todos los objetos en la pantalla. </font><font style="vertical-align: inherit;">De las herramientas para esto, solo hay javascript y el motor de animaci√≥n incorporado m√°s simple en Spark AR Studio, que simplemente puede cambiar las coordenadas del objeto desde el valor inicial hasta el final en un momento dado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√≠, el dilema a√∫n surgi√≥ antes de esto: si crear el nivel completo del juego, una escena en el editor 3D, duplicando las plantas repetidas el n√∫mero requerido de veces y coloc√°ndolas en las posiciones correctas, para desplazar toda la escena en el juego, o cargar solo una copia de cada 3D objetar y sustituirlos en la direcci√≥n del jugador justo fuera de la pantalla. La respuesta fue obvia. Nuestra elecci√≥n es la segunda opci√≥n. De lo contrario, definitivamente no es posible caber en 2 MB: lo m√°s probable es que la escena seg√∫n la primera opci√≥n sea pesada. Pero entonces necesitas un dise√±o de objetos. Y yo, sin dudarlo, decid√≠ usar el editor 3D como editor de niveles. S√≠, resulta que hice las dos cosas. Plantas para el juego, guard√© cada una en una copia. Y del editor solo necesitaba las coordenadas. Despu√©s de completar el trabajo,Escrib√≠ las coordenadas de todos los objetos e hice una matriz con los datos del juego.</font></font><br>
<br>
<pre><code class="javascript hljs">lv:[<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">8.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-6.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'cloud'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0.1</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'rain'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">6.6</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">14</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-2.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'diamond_red'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">20</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">2.0</span>},<font></font>
	...<font></font>
],</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, sin embargo, una matriz asociativa separada, de acuerdo con los tipos de objetos, donde se almacenan los tama√±os de los colisionadores y sus desplazamientos en relaci√≥n con los centros de los objetos 3D, as√≠ como una bandera (col) que determina si el objeto es un obst√°culo (de lo contrario, el jugador lo atraviesa). </font><font style="vertical-align: inherit;">Para algunos tipos de objetos, se establece la bandera (destruir), que determina si el objeto debe ocultarse despu√©s de la interacci√≥n, as√≠ como el par√°metro (v), que determina cierto grado de interacci√≥n, por ejemplo, el n√∫mero de puntos que un jugador gana o pierde.</font></font><br>
<br>
<pre><code class="javascript hljs">colld:{
    <span class="hljs-string">'flower1'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">2.3</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1.4</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_green'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">destroy</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_red'</span>:{<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">-2</span>},<font></font>
<font></font>
    ...<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un peque√±o matiz. </font><font style="vertical-align: inherit;">La hierba en la parte inferior de la escena debe desplazarse continuamente. </font><font style="vertical-align: inherit;">Por lo tanto, debe usar dos copias de este objeto y sustituirlas una tras otra a medida que se mueve. </font><font style="vertical-align: inherit;">Las flores aparecer√°n en una pantalla no m√°s que en una copia cada una.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teniendo en cuenta el problema de escala que encontr√© al desarrollar el primer juego, restablec√≠ la escala de todos los modelos en el editor 3D. Por lo tanto, en los modelos Saprk AR se cargan inmediatamente en tama√±os normales. Es cierto, de todos modos, en el gui√≥n, no podr√≠a prescindir del "n√∫mero m√°gico", el coeficiente global, el c√≥digo universal, que contiene la esencia del universo. Un universo virtual, por supuesto. Y estoy listo para revelarte este n√∫mero. ¬°√öselo, gente! ¬°No me importa! Este n√∫mero es 0.023423. En resumen, a pesar del restablecimiento de todas las escalas, un metro en el editor 3D result√≥ ser igual a este n√∫mero en Spark AR Studio. Sin embargo, lo m√°s probable es que no entiendo completamente todas las complejidades de trabajar con gr√°ficos 3D, de ah√≠ el coeficiente. Las coordenadas (pero no el tama√±o) de todos los objetos que se exportaron desde el editor se multiplican por √©l, lo adivin√≥.D√≥nde ajustar la escala de la escena en Spark AR, no lo encontr√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente problema que encontr√© fue la p√©rdida del orden de los objetos al exportar desde un editor 3D. </font><font style="vertical-align: inherit;">Los objetos complejos que consisten en varias mallas podr√≠an aparecer de manera impredecible en la escena del juego de tal manera que, por ejemplo, una malla que estaba detr√°s de otra salt√≥ repentinamente hacia adelante. </font><font style="vertical-align: inherit;">Y, si observa el orden de los objetos despu√©s de exportar a Spark AR Studio, puede ver que esta malla es, por alguna raz√≥n, m√°s alta en la lista, aunque fue m√°s baja en el editor. </font><font style="vertical-align: inherit;">Resolv√≠ este problema dividiendo la escena en capas y guard√°ndolas en diferentes archivos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animaci√≥n compleja</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante otras tres noches, jugu√© con la programaci√≥n. Si utilic√© el motor est√°ndar Spark AR Studio para animar las alas de una mariposa, la tarea de mover el fondo no fue tan simple. Todav√≠a no entend√≠a c√≥mo adjuntar no solo un par√°metro variable a las iteraciones del ciclo de movimiento, sino una funci√≥n de devoluci√≥n de llamada completa. En cualquier caso, no pude hacerlo, los par√°metros de animaci√≥n actuales no quer√≠an transferirse all√≠. Y tal funci√≥n es simplemente necesaria, porque si en el primer juego (con pizza) verifiqu√© la colisi√≥n por el evento de abrir la boca suscribi√©ndome, entonces no hubo tal evento aqu√≠. Y solo era necesario verificar las colisiones con objetos ambientales a medida que el personaje se mueve, de acuerdo con sus coordenadas actuales. Y para esto, las coordenadas deben compararse en cada iteraci√≥n. Y luego pens√©. Despu√©s de todo, ya escrib√≠ juegos en javascript.¬øY por qu√© no usar el motor de animaci√≥n que escrib√≠ anteriormente para esos juegos? Su principio de funcionamiento es aproximadamente el mismo: en un momento dado, el par√°metro (o par√°metros) cambia entre los valores iniciales y finales dados. Y el valor actual se pasa como un par√°metro, no lo creer√°, en la funci√≥n de devoluci√≥n de llamada dada, en la que, por ejemplo, puede establecer un objeto 3D en la escena en coordenadas iguales a estos valores actuales, o verificar las colisiones en ellos. Gracias Cap. Tuve que adaptar ligeramente mi motor al "ecosistema" local: eliminar referencias al objeto de la ventana desde all√≠, ya que no est√° aqu√≠, y otras peque√±as cosas.Y el valor actual se pasa como un par√°metro, no lo creer√°, en la funci√≥n de devoluci√≥n de llamada dada, en la que, por ejemplo, puede establecer un objeto 3D en la escena en coordenadas iguales a estos valores actuales, o verificar las colisiones en ellos. Gracias Cap. Tuve que adaptar ligeramente mi motor al "ecosistema" local: eliminar referencias al objeto de la ventana desde all√≠, ya que no est√° aqu√≠, y otras peque√±as cosas.Y el valor actual se pasa como un par√°metro, no lo creer√°, en la funci√≥n de devoluci√≥n de llamada dada, en la que, por ejemplo, puede establecer un objeto 3D en la escena en coordenadas iguales a estos valores actuales, o verificar las colisiones en ellos. Gracias Cap. Tuve que adaptar ligeramente mi motor al "ecosistema" local: eliminar referencias al objeto de la ventana desde all√≠, ya que no est√° aqu√≠, y otras peque√±as cosas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√≠, todav√≠a, sobre desplazarse por el paisaje y los objetos del entorno. Decid√≠ poner todo el mundo en un NullObject, es decir, en un objeto 3D vac√≠o, un contenedor, y moverlo usando solo un par√°metro para la animaci√≥n: su coordenada x. Dentro del contenedor, todos los modelos tienen las mismas coordenadas que si estuvieran afuera, solo que para ellos el sistema de referencia est√° vinculado a este objeto vac√≠o. Las rocas y las flores se repetir√°n (adem√°s, a diferentes alturas del suelo, de acuerdo con el diagrama de nivel), para que pueda reutilizar estos objetos a medida que se mueve, estableciendo la posici√≥n horizontal y vertical deseada dentro del "contenedor". Escrib√≠ un sistema de b√∫squeda de objetos que caen en el marco (en el desplazamiento del contenedor actual), que establece el objeto que deja el marco en una nueva posici√≥n m√°s si aparece all√≠. Puedes ver,c√≥mo funciona en el ejemplo de tres objetos. (Habr√° m√°s de ellos en el juego, por lo que ya no ver√° ese efecto de "reorganizaci√≥n" de los objetos del entorno).</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f3i72svxLHM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n para actualizar las coordenadas de los objetos se ve as√≠:</font></font><br>
<br>
<pre><code class="javascript hljs">oCoordSet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-comment">//  :    </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> camx = -ap.oWorld.transform.x.pinLastValue();
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> x1 = camx - ap.game.scro.w2;
    <span class="hljs-keyword">var</span> x2 = camx + ap.game.scro.w2;
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> ((ap.d.lv[i].x &gt;= x1) &amp; (ap.d.lv[i].x &lt;= x2)) {
            <span class="hljs-comment">//   </span><font></font>
            ap.d.lv[i].o = Scene.root.find(ap.d.lv[i].n);<font></font>
            <span class="hljs-comment">//  -  </span><font></font>
            ap.d.lv[i].o.transform.y = ap.d.lv[i].y;<font></font>
            <span class="hljs-keyword">if</span> ((ap.d.lv[i].n == <span class="hljs-string">'cloud'</span>) || (ap.d.lv[i].n == <span class="hljs-string">'rain'</span>)) {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//  </span>
                <span class="hljs-comment">//   2.3,</span>
                <span class="hljs-comment">//     </span>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x - (x2 - ap.d.lv[i].x) * <span class="hljs-number">2.3</span> + <span class="hljs-number">0.2</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//      </span><font></font>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x;<font></font>
            };<font></font>
        };<font></font>
    };<font></font>
    <span class="hljs-comment">//        </span>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">if</span> (camx &gt; ap.game.grassPosLast) {<font></font>
        ap.game.grassPosLast += ap.game.grassd;<font></font>
        ap.game.grassi = <span class="hljs-number">1</span> - ap.game.grassi;<font></font>
        ap[ap.game.grassNm[ap.game.grassi]].transform.x = ap.game.grassPosLast;<font></font>
    };<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El personaje principal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El personaje principal del juego es una mariposa insumergible, que vuela audazmente, superando obst√°culos. </font><font style="vertical-align: inherit;">Decid√≠ hacer la gesti√≥n estableciendo un marcador o cursor (punto de luz), girando e inclinando la cabeza. </font><font style="vertical-align: inherit;">Y en la direcci√≥n de este punto, una mariposa volar√° lentamente (de hecho, no es una luchadora, ni puede teletransportarse). </font><font style="vertical-align: inherit;">Por ejemplo, si se suscribe al evento de inclinaci√≥n de la cabeza, puede implementar un control vertical como este:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationX.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> v = event.newValue;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> scrH2 = ap.game.scr.h2;
    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">var</span> p = -v * <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">if</span> (p &lt; -scrH2) {<font></font>
        p = -scrH2;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p &gt; scrH2) {<font></font>
        p = scrH2;<font></font>
    };<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> d = <span class="hljs-number">0.006</span>;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> cur = ap.oPers.transform.y.pinLastValue();
    <span class="hljs-keyword">if</span> (p &lt; cur) {<font></font>
        cur -= d;<font></font>
        <span class="hljs-keyword">if</span> (cur &lt; p) {cur = p;};<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        cur += d;<font></font>
        <span class="hljs-keyword">if</span> (cur &gt; p) {cur = p;};<font></font>
    };<font></font>
    <span class="hljs-comment">//    ()</span><font></font>
    ap.oPointer1.transform.y = p;<font></font>
    <span class="hljs-comment">//   ,</span>
    <span class="hljs-comment">// ,    </span><font></font>
    ap.game.pers.dy + = cur - ap.game.pers.y;<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Del mismo modo para el horizontal. </font><font style="vertical-align: inherit;">Solo all√≠ es necesario suscribirse al evento, no de una inclinaci√≥n, sino de una rotaci√≥n de la cabeza (rotaci√≥nY), y en lugar de la altura de la pantalla, considere su ancho.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colisionadores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo esto es maravilloso, el mundo se mueve y el personaje del juego puede moverse libremente por la pantalla. Pero ahora necesitas un controlador de colisi√≥n, de lo contrario, ning√∫n juego funcionar√°. Hay tres eventos en el juego, seg√∫n los cuales la posici√≥n del personaje puede cambiar. Esta es la rotaci√≥n e inclinaci√≥n de la cabeza, as√≠ como el movimiento del mundo, en el cual la coordenada horizontal del jugador (x) aumenta autom√°ticamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como no s√© c√≥mo funcionan las iteraciones del controlador de cara en Spark AR, ya sea que se llamen con una frecuencia determinada o est√©n configuradas con la frecuencia de reloj m√°xima posible, y en mi motor de animaci√≥n puedo controlar este par√°metro, decid√≠ que definir√≠a las colisiones en mi funci√≥n El movimiento del mundo, que se llama a una frecuencia establecida por m√≠ (60 cuadros por segundo). En eventos de procesamiento facial, solo "acumularemos" movimiento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El principio ser√° as√≠. En eventos de inclinaci√≥n de cabeza y giro de cabeza, se acumula un desplazamiento a lo largo de los ejes x e y. Adem√°s, en la funci√≥n de desplazamiento por el mundo, se agrega un desplazamiento horizontal a la "alcanc√≠a". Y luego se verifica, si el desplazamiento acumulado se agrega a las coordenadas originales, entonces habr√° una colisi√≥n con cualquiera de los objetos del mundo. Si no, entonces las coordenadas originales del jugador m√°s el desplazamiento son hechas por las coordenadas actuales. Y luego actualizamos los de origen a los actuales (restablecer) y restablecemos las compensaciones. Si es as√≠, retroceda las coordenadas al original. Adem√°s, necesitamos determinar qu√© eje ser√≠a la colisi√≥n, ya que ambas coordenadas no pueden revertirse. De lo contrario, el jugador simplemente "se queda" en un punto en el espacio y ya no puede moverse a ning√∫n lado. Es necesario darle libertad de movimiento a lo largo del eje a lo largo del cual no se produce la colisi√≥n.Para que pueda darle la oportunidad de volar alrededor de un obst√°culo.</font></font><br>
<br>
<pre><code class="javascript hljs">setPersPos: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">camx, camdx</span>) </span>{
    <span class="hljs-comment">//   </span>
    <span class="hljs-comment">//       (camx,camdx)</span><font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">var</span> persx = ap.game.pers.x;
    <span class="hljs-keyword">var</span> persy = ap.game.pers.y;
    <span class="hljs-keyword">var</span> dx = ap.game.pers.dx;
    <span class="hljs-keyword">var</span> dy = ap.game.pers.dy;<font></font>
<font></font>
    <span class="hljs-comment">// ,     </span>
    <span class="hljs-keyword">var</span> col = ap.collisionDetect(<font></font>
        {<span class="hljs-attr">x</span>: persx, <span class="hljs-attr">y</span>: persy, <span class="hljs-attr">dx</span>: dx, <span class="hljs-attr">dy</span>: dy},<font></font>
        {<span class="hljs-attr">x</span>: camx, <span class="hljs-attr">dx</span>: camdx, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>}<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (col.f == <span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.colx == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//(    ,    )</span><font></font>
            ap.game.pers.x = col.x;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span><font></font>
            ap.game.pers.x = persx + dx;<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.coly == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// -  </span><font></font>
            ap.game.pers.y = col.y;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            ap.game.pers.y = persy + dy;<font></font>
        };<font></font>
<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//  ,   </span><font></font>
        ap.game.pers.x = persx + dx;<font></font>
        ap.game.pers.y = persy + dy;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// </span>
    ap.game.pers.dx = <span class="hljs-number">0</span>;<font></font>
    ap.game.pers.dy = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">//     </span><font></font>
    ap.oPers.transform.x = ap.game.pers.x;<font></font>
    ap.oPers.transform.y = ap.game.pers.y;<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n de detecci√≥n de colisi√≥n en s√≠:</font></font><br>
<br>
<pre><code class="javascript hljs">collisionDetect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opers, ow</span>) </span>{
    <span class="hljs-comment">// , opers -   , ow -  </span><font></font>
<font></font>
    <span class="hljs-keyword">var</span> res = {<span class="hljs-attr">f</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">colx</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">coly</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ocoll, x, y, w, h, persx, persy, persx0, persy0, od, colx1, coly1, colx2, coly2;
    <span class="hljs-keyword">var</span> collw = <span class="hljs-literal">false</span>, collh = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-comment">//(  ,  "" )</span><font></font>
    persx0 = opers.x + ow.x - ow.dx;<font></font>
    persy0 = opers.y + ow.y;<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    persx = persx0 + opers.dx;<font></font>
    persy = persy0 + opers.dy;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {<font></font>
        od = ap.d.lv[i]; <span class="hljs-comment">//obj data</span><font></font>
<font></font>
        <span class="hljs-comment">//    (   ),</span>
        <span class="hljs-comment">//     </span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ap.d.colld[od.n] !== <span class="hljs-string">"undefined"</span>) {<font></font>
<font></font>
            <span class="hljs-comment">//       </span><font></font>
            ocoll = ap.d.colld[od.n];<font></font>
            colx1 = od.x + ocoll.x1;<font></font>
            colx2 = od.x + ocoll.x2;<font></font>
            coly1 = od.y + ocoll.y1;<font></font>
            coly2 = od.y + ocoll.y2;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ((persx &lt; colx1) || (persx &gt; colx2) || (persy &lt; coly1) || (persy &gt; coly2)) {} <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//   </span>
                res.f = <span class="hljs-literal">true</span>;<font></font>
<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persx0 &lt; colx1) || (persx0 &gt; colx2)) {<font></font>
                    collw = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persy0 &lt; coly1) || (persy0 &gt; coly2)) {<font></font>
                    collh = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
<font></font>
            };<font></font>
        };<font></font>
<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
<font></font>
    <span class="hljs-comment">//  ,     ,</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (collw == <span class="hljs-literal">true</span>) {<font></font>
        res.colx = <span class="hljs-literal">true</span>;<font></font>
        res.x = persx0 - ow.x;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.x = opers.x;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">if</span> (collh == <span class="hljs-literal">true</span>) {<font></font>
        res.coly = <span class="hljs-literal">true</span>;<font></font>
        res.y = persy0 + ow.y;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.y = opers.y;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">return</span> res;<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lluvia</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilic√© el motor de part√≠culas est√°ndar Spark AR Studio para animar la lluvia. </font><font style="vertical-align: inherit;">No hay nada especial aqu√≠. </font><font style="vertical-align: inherit;">Agregamos un objeto Emtter a la escena, sin olvidar preguntarle Emitter -&gt; Space -&gt; Local (en lugar de World). </font><font style="vertical-align: inherit;">Esto es para asegurar que las gotas no se retrasen din√°micamente detr√°s de las nubes durante el movimiento, sino que siempre caigan directamente. </font><font style="vertical-align: inherit;">Este m√©todo es m√°s conveniente para una determinaci√≥n m√°s f√°cil del momento en que la mariposa cae bajo la lluvia, no es necesario hacer una correcci√≥n de altura. </font><font style="vertical-align: inherit;">Para las gotas en s√≠, prepar√© la textura adecuada. </font><font style="vertical-align: inherit;">Bueno y, por supuesto, el objeto de lluvia se mover√° junto con el objeto de la nube. </font><font style="vertical-align: inherit;">Luego agregu√© una condici√≥n de impacto en la nube al c√≥digo de manejo de colisiones. </font><font style="vertical-align: inherit;">Y, si no hay ning√∫n obst√°culo por encima del jugador en este momento, la mariposa cae y el juego termina.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moderaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para una moderaci√≥n exitosa, el video obligatorio del juego no debe contener texto est√°tico que no est√© vinculado a objetos. </font><font style="vertical-align: inherit;">De lo contrario, el robot detiene instant√°neamente la moderaci√≥n. </font><font style="vertical-align: inherit;">Sin embargo, despu√©s de eso, una persona revisa el juego durante varios d√≠as. </font><font style="vertical-align: inherit;">Y no le gust√≥ la abundancia de texto antes del juego, as√≠ como al final. </font><font style="vertical-align: inherit;">Tuve que reducir la cantidad de texto. </font><font style="vertical-align: inherit;">Despu√©s de eso, el juego fue aprobado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No es que mi juego fuera particularmente emocionante. </font><font style="vertical-align: inherit;">Probablemente carece de din√°mica y mec√°nica adicional. </font><font style="vertical-align: inherit;">Publicar√© una actualizaci√≥n. </font><font style="vertical-align: inherit;">Pero me di cuenta de que hacer juegos en Instagram es interesante. </font><font style="vertical-align: inherit;">Este es un tipo de desaf√≠o. </font><font style="vertical-align: inherit;">Realmente disfrut√© el proceso de programaci√≥n y resoluci√≥n de todo tipo de tareas bajo el minimalismo en t√©rminos de herramientas y la cantidad de memoria asignada. </font><font style="vertical-align: inherit;">Recuerdo que alguien dijo que 640 Kb es suficiente para todos. </font><font style="vertical-align: inherit;">Ahora intenta ajustar un juego 3D de 2 MB. </font><font style="vertical-align: inherit;">Yo, tal vez, no argumentar√© que son suficientes para todos ... ¬°Pero pru√©balo!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/g7/kr/7fg7kra8uhidburs19pognju5vc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusi√≥n, me gustar√≠a reunir en una lista todos los momentos no obvios que encontr√©. </font><font style="vertical-align: inherit;">Tal vez esto sea √∫til para alguien como una hoja de trucos al crear juegos para Instagram.</font></font><br>
<br>
<i><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escala. </font><font style="vertical-align: inherit;">Ajuste la escala de todos los modelos 3D en el editor 3D para que est√© inmediatamente 1: 1 en el escenario del juego.</font></font></li>
<li>       .              .   ,            .</li>
<li>.          FBX,     .        -.           ,    .</li>
<li>  .  JPG   ,     ,   ,       -,    JPG,    PNG.</li>
<li>   . , ,        .   Spark AR  ,         . , , ,   3D-.</li>
<li>   3D ,    :     ,    .       .             .</li>
<li>,    ,      .   javascript   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el contexto de Spark AR, no hay objetos de ventana y todo tipo de objetos espec√≠ficos del navegador, como webkitRequestAnimationFrame, mozRequestAnimationFrame, etc. </font><font style="vertical-align: inherit;">Este es un destino cuando se programa en animaci√≥n javascript.</font></font></li>
</ul></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es499962/index.html">Algunos datos sobre los clasificadores en cascada, que rara vez se consideran seriamente en los art√≠culos cient√≠ficos.</a></li>
<li><a href="../es499964/index.html">La NASA ha seleccionado tres compa√±√≠as que participar√°n en el programa de creaci√≥n de un barco para aterrizar en la luna</a></li>
<li><a href="../es499968/index.html">Lista de los mitaps en l√≠nea m√°s persistentes que tienen lugar incluso en mayo</a></li>
<li><a href="../es499970/index.html">Estudiamos el motor VoIP Mediastreamer2. Parte 12</a></li>
<li><a href="../es499972/index.html">Resumen de eventos en l√≠nea de mayo</a></li>
<li><a href="../es499978/index.html">Traducci√≥n del libro de Andrew Un, Pasi√≥n por el aprendizaje autom√°tico, cap√≠tulos 36 y 37</a></li>
<li><a href="../es499982/index.html">Plan de prueba para principiantes: de "Ingrese a TI" a "¬°Soy ingeniero!"</a></li>
<li><a href="../es499986/index.html">Y nuevamente sobre incrustado: buscando errores en el proyecto Embox</a></li>
<li><a href="../es499988/index.html">Az√∫car y COVID-19</a></li>
<li><a href="../es499990/index.html">Geocodificaci√≥n ¬øC√≥mo vincular 250 mil direcciones a coordenadas en 10 minutos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>