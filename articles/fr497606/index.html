<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç∑ üëï ü§≥üèæ Syst√®me d'arrosage automatique du jardin pour Home Assistant, ESP8266 et MiFlora üë®üèª‚Äç‚úàÔ∏è üàµ ü•Ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a quelque temps, ma famille avait une maison avec un petit jardin dans un endroit tr√®s chaud et aride, et nous avons √©t√© confront√©s au probl√®me d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Syst√®me d'arrosage automatique du jardin pour Home Assistant, ESP8266 et MiFlora</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497606/"><img src="https://habrastorage.org/webt/87/-y/wi/87-ywilifgui1kkhe06izsbt7ag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque temps, ma famille avait une maison avec un petit jardin dans un endroit tr√®s chaud et aride, et nous avons √©t√© confront√©s au probl√®me d'un arrosage r√©gulier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je souhaitais que le syst√®me d'irrigation soit automatique, en le choisissant j'ai d√ª prendre en compte les conditions suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eau tr√®s ch√®re qui doit √™tre √©conomis√©e de toutes les mani√®res disponibles </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diff√©rentes plantes dans le jardin pour les besoins en humidit√©, des plantes succulentes aux amoureux de l'humidit√©</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la n√©cessit√© d'un arrosage totalement autonome en l'absence de personnes dans la maison, de pr√©f√©rence avec possibilit√© de t√©l√©commande </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> climat aride qui ne pardonne pas les erreurs d'irrigation</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir √©valu√© les solutions toutes faites trouv√©es sur les r√©seaux de bricolage locaux et sur Amazon et lu des critiques sur leur fiabilit√© (g√©n√©ralement pas la plus √©lev√©e), nous avons d√©cid√© d'essayer de faire quelque chose par nous-m√™mes. </font></font><br>
<a name="habracut"></a><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement: L'auteur n'est pas un sp√©cialiste en informatique et ne pr√©tend pas √™tre une connaissance professionnelle du sujet. </font><font style="vertical-align: inherit;">Le niveau d'ex√©cution du projet est un hobby. </font><font style="vertical-align: inherit;">L'auteur conna√Æt bien le niveau de ses connaissances en programmation et en √©lectronique et appr√©ciera grandement les suggestions d'am√©lioration et d'optimisation des solutions utilis√©es.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sch√©ma</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le jardin √©tait divis√© en 4 zones d'irrigation, chacune d'entre elles est √©quip√©e d'un capteur d'humidit√© du sol individuel et peut √™tre arros√©e selon un horaire individuel et une quantit√© d'eau diff√©rente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au sol, des tuyaux PND d'irrigation goutte √† goutte avec perforation sont pos√©s, qui sont connect√©s √† des tuyaux convergeant dans l'unit√© de collecte d'eau et reli√©s par les vannes √©lectromagn√©tiques √† l'alimentation en eau. </font><font style="vertical-align: inherit;">Les vannes sont contr√¥l√©es par des relais connect√©s √† l'ESP8266 (Sonoff 4Ch). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'arrosage est effectu√© par des minuteries, la nuit, pour augmenter la quantit√© d'eau qui est absorb√©e dans le sol et ne sera pas √©vapor√©e par le soleil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l'heure d'arrosage programm√©e, le respect de plusieurs conditions est v√©rifi√©:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> humidit√© du sol inf√©rieure √† une valeur pr√©d√©termin√©e </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il n'y a pas de pr√©cipitations pr√©vues en quantit√© suffisante pour les 2 prochains jours </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la limite d'eau pour l'arrosage d√©finie pour cette ligne n'est pas d√©pass√©e</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mat√©riel usag√©</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec HassIO install√© (avait d√©j√†) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32 DevKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un firmware ESPHome, agissant comme une passerelle Bluetooth pour MiFlora et recevant des donn√©es de capteurs d'humidit√© filaires. </font><font style="vertical-align: inherit;">Situ√© dans le jardin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capteurs d'humidit√© c√¢bl√©s </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteur d'humidit√© du sol capacitif v1.2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui mesure l'humidit√© dans les zones d'arrosage les plus proches du site d'installation de l'ESP32. Les </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capteurs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MiFlora </font><b><font style="vertical-align: inherit;">sont</font></b><font style="vertical-align: inherit;"> connect√©s √† l'ESP32 via BLE, qui mesure l'humidit√© dans les zones d'arrosage √† distance. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SONOFF 4Ch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cousu avec ESPHome, est situ√© dans l'unit√© de prise d'eau, o√π les tuyaux de toutes les zones d'arrosage viennent </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 √©lectrovannes normalement ferm√©es pour 220V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">situ√© dans le r√©servoir d'eau et connect√© au Sonoff 4Ch. Ouvrez l'arriv√©e d'eau pour l'irrigation. Un mod√®le normalement ferm√© a √©t√© choisi de mani√®re √† minimiser la probabilit√© d '¬´inondation¬ª en cas de panne des circuits √©lectriques et √©lectroniques, et afin de minimiser le nombre de sorties relais n√©cessaires. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compteur d' </font><b><font style="vertical-align: inherit;">eau puls√©</font></b><font style="vertical-align: inherit;"> √† l'entr√©e du syst√®me d'irrigation dans l'unit√© de prise d'eau et connect√© au Sonoff 4ch. Autoris√© √† transf√©rer enti√®rement les donn√©es de d√©bit d'eau √† Home Asssistant et √† mettre en ≈ìuvre la fonctionnalit√© d'irrigation avec une quantit√© donn√©e. Il s'est av√©r√© tr√®s r√©ussi que sur cette version de sonoff les contacts pour le firmware √©taient d√©j√† soud√©s et m√™me il y avait un GPIO02 gratuit - un compteur d'impulsions √©tait accroch√© dessus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/zz/d9/eczzd9zfq4drf8katpm4ofyn0b4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il ressemble √† un collecteur avec des vannes install√©es et un compteur d'eau. </font><font style="vertical-align: inherit;">Le contr√¥leur (sonoff 4Ch) n'est pas entr√© dans le cadre, il est install√© √† une distance d'un demi-m√®tre dans le blindage IP65</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP Param√®tres Home et Home Assistant</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff 4ch</font></font></b><div class="spoiler_text"> ESPHome    ,     :<br>
<br>
<pre><code class="xml hljs">switch:<font></font>
  - platform: gpio<font></font>
    name: "   1"<font></font>
    pin: GPIO12<font></font>
    id: sw1<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   2"<font></font>
    pin: GPIO5<font></font>
    id: sw2<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   3"<font></font>
    pin: GPIO4<font></font>
    id: sw3<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   4"<font></font>
    pin: GPIO15<font></font>
    id: sw4<font></font>
    icon: mdi:water<font></font>
binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: button<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteur capacitif d'humidit√© du sol v1.2</font></font></b><div class="spoiler_text">   ESPHome:<br>
<br>
<pre><code class="xml hljs">sensor:<font></font>
  - platform: adc<font></font>
    pin: GPIO34<font></font>
    filters:<font></font>
      - lambda: |-<font></font>
          if (x &gt; 3.22) {<font></font>
            return 0;<font></font>
          } else if (x <span class="hljs-tag">&lt; <span class="hljs-attr">1.65</span>) {
            <span class="hljs-attr">return</span> <span class="hljs-attr">100</span>;
          } <span class="hljs-attr">else</span> {
            <span class="hljs-attr">return</span> (<span class="hljs-attr">3.22-x</span>) / (<span class="hljs-attr">3.22-1.65</span>) * <span class="hljs-attr">100.0</span>;
          }
    <span class="hljs-attr">name:</span> "   <span class="hljs-attr">1</span>  "
    <span class="hljs-attr">update_interval:</span> <span class="hljs-attr">60s</span>
    <span class="hljs-attr">attenuation:</span> <span class="hljs-attr">11db</span>
    <span class="hljs-attr">unit_of_measurement:</span> "%"
    <span class="hljs-attr">accuracy_decimals:</span> <span class="hljs-attr">0</span>
    <span class="hljs-attr">icon:</span> <span class="hljs-attr">mdi:water-percent</span>
</span></code></pre><br>
       (ADC)  <br>
  ,        (   3.22 )     (1,65 ).      log'   ESPHome  HassIO            .<br>
<br>
<img src="https://habrastorage.org/webt/sb/tf/b4/sbtfb4ckgxx7kltxe6kk8a5q0r4.png"><br>
<br>
  ESP32  Home Assistant    ,         <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compteur d'eau √† impulsions</font></font></b><div class="spoiler_text">   ¬´¬ª,          (   ).       ‚Äî      ,   ,        (  ‚Äî  3   10 ). <br>
,      GND    GPIO      .<br>
<br>
  ESPHome   : <br>
<br>
<pre><code class="xml hljs">binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: counter<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
 Home Assistant   :<br>
<br>
     (counter),       <br>
          (,   ¬´¬ª  ).      ‚Äî  counter,              ESPHome,   sensor,          counter (       ).<br>
<br>
           2      ‚Äî    ,    ¬´¬ª.       ,   ,                      . <br>
<br>
<div class="spoiler"><b class="spoiler_title">    ( automations.yaml   )</b><div class="spoiler_text"><pre><code class="xml hljs">- alias:     <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_counter<font></font>
    service: counter.increment<font></font>
- alias:    1 <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: switch.sistema_poliva_liniia_1<font></font>
      state: 'on'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_line1, counter.my_water_line1t<font></font>
    service: counter.increment    <font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml    +      </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
      water_counter:    <font></font>
        unit_of_measurement: 'M3'<font></font>
        value_template: "{{ (states('counter.my_water_counter')| float)/1000 }}"    <font></font>
counter:<font></font>
  my_water_counter:<font></font>
    initial: 2.667<font></font>
    step: 10<font></font>
  my_water_line1:<font></font>
    name: " 1     ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
  my_water_line1t:<font></font>
    name: " 1   ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
</code></pre><br>
</div></div><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteur MiFlora</font></font></b><div class="spoiler_text"> MiFlora   ESPHome   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">esphome.io</a> <br>
 Home Assistant          ‚Äî , ,   ¬´¬ª .   ‚Äî     ,        .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteur de pluie virtuel</font></font></b><div class="spoiler_text">   ‚Äî          .            ,   . <br>
<br>
       darksky.  ,          Apple        ¬´ ¬ª. API  , ,   ,      ,   HA     .      darksky, ,          .<br>
<br>
  2        :<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml   </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: darksky<font></font>
    api_key: xxxx_your_API_key_xxxx<font></font>
    forecast:<font></font>
      - 1<font></font>
      - 2<font></font>
    monitored_conditions:<font></font>
      - precip_intensity<font></font>
</code></pre><br>
   HA   : sensor.dark_sky_precip_intensity_1d  sensor.dark_sky_precip_intensity_2d,              .<br>
</div></div><br>
       template-sensor:<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml    </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
       rain2days:    <font></font>
        unit_of_measurement: 'mm'<font></font>
        value_template: "{{ (((states('sensor.dark_sky_precip_intensity_2d')| float)+(states('sensor.dark_sky_precip_intensity_1d')| float))*24)| round(3) }}"    <font></font>
</code></pre><br>
 HA  sensor.rain2days          2 . <br>
  ,   Darksky         ,              <br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois toutes les donn√©es collect√©es, vous pouvez proc√©der directement √† l'arrosage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici comment je regarde un morceau de l'interface de l'une des zones du Home Assistant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/l6/ut/pfl6ut8aoieytcg0kxlk-mjslcu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ici, vous pouvez d√©finir la quantit√© d'eau pour l'irrigation (avec un curseur) et voir les valeurs des principaux capteurs et compteurs. </font><font style="vertical-align: inherit;">J'ai donn√© l'interface pour l'une des lignes, pour le reste tout est pareil, seulement sur les lignes avec des capteurs de donn√©es c√¢bl√©s c'est un peu moins.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'interface, vous pouvez remarquer un d√©tail ¬´superflu¬ª - le capteur auxiliaire ¬´La norme a √©t√© atteinte¬ª. </font><font style="vertical-align: inherit;">Il fallait l'introduire, car </font><font style="vertical-align: inherit;">Je n'ai pas pu obtenir la condition: le mod√®le fonctionne pour arr√™ter l'automatisation lorsque la norme pour la quantit√© d'eau a √©t√© atteinte, et en cons√©quence, l'automatisation v√©rifie simplement la valeur de ce capteur. </font><font style="vertical-align: inherit;">Je suis s√ªr que cette partie de l'automatisation peut √™tre rendue plus simple et plus √©l√©gante, mais mon niveau n'√©tait pas suffisant pour cela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous trouverez ci-dessous le code du capteur de mod√®le de ¬´b√©quille¬ª r√©sultant:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteur de suffisance d'arrosage (√† l'int√©rieur de configuration.yaml ou un fichier s√©par√©)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">  - platform: template<font></font>
    sensors:<font></font>
      line4_status:<font></font>
        friendly_name: " 4 -  "<font></font>
        value_template: &gt;-<font></font>
          {% if states('counter.my_water_line4t')|float &gt; states('input_number.slider4')|float %}<font></font>
            yes<font></font>
          {% elif states('counter.my_water_line4t')|float == states('input_number.slider4')|float  %}<font></font>
            yes<font></font>
          {% else %}<font></font>
            no<font></font>
          {% endif %}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'automatisation pour commencer l'arrosage ressemble finalement √† ceci:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commencez l'arrosage (dans automations.yaml ou dans un fichier s√©par√©)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4   23.01<font></font>
  trigger:<font></font>
    platform: time<font></font>
    at: "23:01:00"<font></font>
  condition:<font></font>
   condition: and<font></font>
   conditions:<font></font>
#    <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.rainfor2days<font></font>
      below: 5<font></font>
#      <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.miflora_1_moisture<font></font>
      below: 50<font></font>
# ,       <font></font>
    - condition: state<font></font>
      entity_id: 'sensor.line4_status'<font></font>
      state: 'no'<font></font>
  action:<font></font>
   - service: switch.turn_on<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'arrosage commence tard dans la soir√©e, chaque ligne commen√ßant √† son propre intervalle de temps. </font><font style="vertical-align: inherit;">La s√©paration par heure de d√©but vous permet d'utiliser un compteur d'eau d'entr√©e pour obtenir des donn√©es sur 4 lignes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©marrage, trois conditions sont v√©rifi√©es:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La limite de la quantit√© d'eau pour aujourd'hui n'est-elle pas d√©pass√©e (si, par exemple, l'arrosage manuel a √©t√© activ√©)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'humidit√© d√©passe-t-elle 50% (selon les observations dans nos conditions, le sol fra√Æchement renvers√© a une teneur en humidit√© ne d√©passant pas 60%)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des pr√©cipitations sup√©rieures √† 5 mm ne sont pas attendues dans les deux prochains jours.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'automatisation suivante d√©sactive l'arrosage:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©sactiver l'arrosage (dans automations.yaml ou un fichier s√©par√©)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4 <font></font>
  trigger:<font></font>
#      <font></font>
  - entity_id: sensor.line4_status<font></font>
    platform: state<font></font>
    to: 'yes'<font></font>
    for: <font></font>
      seconds: 5    <font></font>
#   <font></font>
  - platform: time<font></font>
    at: "23:59:00"<font></font>
#     <font></font>
  - platform: numeric_state<font></font>
    entity_id: sensor.miflora_1_moisture<font></font>
    above: 65<font></font>
#       <font></font>
  - platform: state<font></font>
    entity_id: switch.sistema_poliva_liniia_4<font></font>
    to: 'on'<font></font>
    for: <font></font>
      minutes: 60<font></font>
  action:<font></font>
   - service: switch.turn_off<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'automatisation, jusqu'√† 4 variantes de d√©clencheurs ont √©t√© utilis√©es, mais dans la plupart des cas, cela fonctionne selon le premier - un capteur ¬´b√©quille¬ª, qui surveille le d√©passement de la limite par la quantit√© d'eau. </font><font style="vertical-align: inherit;">Les autres d√©clencheurs sont effectu√©s dans une large mesure pour des raisons de s√©curit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la derni√®re automatisation li√©e au probl√®me remet √† z√©ro le compteur journalier</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remise √† z√©ro du compteur journalier (dans automations.yaml ou un fichier s√©par√©)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
- alias:    4 <font></font>
  trigger:<font></font>
  - platform: time<font></font>
    at: "00:00:01"<font></font>
  action:<font></font>
  - service: counter.reset<font></font>
    entity_id: counter.my_water_line4t<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Economie du projet</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les co√ªts pour la partie contr√¥le du syst√®me d'irrigation √©taient les suivants: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Raspberry PIE avec HassIO √† bord et un routeur WiFi avec un rev√™tement dans le jardin √©taient d√©j√† avant le d√©but du projet, je ne les prends pas en compte) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âlectrovanne UNIPUMP BCX-15 1/2 "(normalement ferm√©e) 4 * 20 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonoff 4CH 17 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compteur d'impulsions Pulsar 8 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32 DevKitC 3,5 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capteur capacitif d'humidit√© du sol v1.2 2 * 0,67 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capteurs MiFlora 2 * 16 euros Protecteurs </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, collecteur, fils, raccords tous ensemble environ 50 euros </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TOTAL: environ 190 euros</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le temps consacr√© √† la configuration des capteurs et du MK est d'environ 15 √† 16 heures pendant plusieurs heures, mais la plupart du temps a √©t√© consacr√© √† ¬´inventer des v√©los¬ª et √† inventer des ¬´b√©quilles¬ª, en g√©n√©ral, il n'y a pas beaucoup de travail. </font><font style="vertical-align: inherit;">L'assemblage physique du syst√®me a pris environ 2 soir√©es. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, des √©conomies d'eau d'environ 20 √† 50% sont attendues par rapport au syst√®me de minuterie ¬´idiot¬ª et aux prix locaux de l'eau, le syst√®me devrait √™tre rentable en une ou deux saisons.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lacunes et plans de r√©vision</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la suite du projet, certaines nuances et possibilit√©s d'am√©lioration ont √©t√© r√©v√©l√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En particulier, je remplacerais les √©lectrovannes 220V par un mod√®le 24V - cette tension est standard pour les syst√®mes d'irrigation. Dans ce cas, vous devrez ajouter un transformateur 24 V au syst√®me et changer le Sonoff 4Ch en quelque chose avec un contact sec (par exemple, Sonoff 4CH Pro ou quelque chose d'auto-assembl√©). Les valves elles-m√™mes sont moins ch√®res (√† partir de 8 euros) et r√©duisent la probabilit√© de choc √©lectrique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est √©galement av√©r√© que pour travailler avec des canalisations en plastique, la pression de l'alimentation en eau est trop √©lev√©e et les raccords peuvent fuir pendant le cycle d'irrigation. Dans mon cas, ce n'est pas critique, tous les raccords sont situ√©s au-dessus du plan d'eau, mais dans le bon sens, vous devez ajouter un r√©ducteur √† l'entr√©e pour abaisser la pression.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai √©t√© encore plus boulevers√© par l'impossibilit√© de tenir compte de la quantit√© d'eau pour l'irrigation dans des volumes inf√©rieurs √† 10 litres - ce volume est la quantit√© minimale mesurable pour un tel compteur. </font><font style="vertical-align: inherit;">Ce probl√®me peut √™tre r√©solu en d√©montant le comptoir et en √©changeant les roues, mais jusque-l√† les mains ne l'ont pas atteint.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr497588/index.html">Spring Security - Un exemple d'application Web d'autorisation OAuth2 via BitBucket</a></li>
<li><a href="../fr497590/index.html">Nous traitons de l'algorithme d'effondrement de la fonction d'onde</a></li>
<li><a href="../fr497594/index.html">Stockage de donn√©es externes: de l'√©poque d'IBM 1311 √† nos jours. Partie 1</a></li>
<li><a href="../fr497596/index.html">Vive PHP</a></li>
<li><a href="../fr497602/index.html">Vous consid√©rez-vous comme signataire? Qui plaisantez-vous</a></li>
<li><a href="../fr497608/index.html">Comment les syst√®mes d'analyse du trafic d√©tectent les tactiques des pirates par MITRE ATT & CK, partie 5</a></li>
<li><a href="../fr497612/index.html">L'histoire de la fa√ßon dont la main invisible du march√© m'a transf√©r√© dans un endroit √©loign√©</a></li>
<li><a href="../fr497614/index.html">Exp√©riences de pens√©e, paradoxes et limites de la logique // Nous sommes condamn√©s # 2</a></li>
<li><a href="../fr497616/index.html">Entretien avec Alexander Makarov (Yii) sur OpenSource, conf√©rences et Yii</a></li>
<li><a href="../fr497618/index.html">Mise en ≈ìuvre du concept d'acc√®s √† distance hautement s√©curis√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>