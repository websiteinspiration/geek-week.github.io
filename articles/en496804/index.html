<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëΩ üë©üèª‚Äçüåæ ‚ôêÔ∏è Installing and Configuring Docker on Windows Subsystem Linux (WSL) üí™üèª üì¥ üßìüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prerequisites
 Before you begin, make sure your system has approximately the following configuration:
 
 

- Windows 10 Version 1803 Build 1734 and la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Installing and Configuring Docker on Windows Subsystem Linux (WSL)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/496804/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prerequisites</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before you begin, make sure your system has approximately the following configuration:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Version 1803 Build 1734 and later</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubuntu for WSL 16.0.4 LTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or something like that (your version may vary slightly)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is important that the version and build of Windows is not lower than what is indicated here. </font><font style="vertical-align: inherit;">The fact is that, starting with these numbers, fundamental changes have been made to the Windows WSL kernel that allow the use of cgroups (control groups - added to the Linux kernel in 2008). </font><font style="vertical-align: inherit;">And they are necessary for Docker to manage the resources of your system in containers.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/by/4g/ff/by4gffs01h0l8uuips6nzxr3f3s.jpeg"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install Docker-CE 09.17.0</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will install Docker Community Edition 17.09.0 (because at the time of this writing, more recent versions have </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fallen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> when installed on WSL). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing we will do is get rid of all previous Docker installations (if any). </font><font style="vertical-align: inherit;">To do this, run the bash terminal and write the following:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo apt-get remove docker docker-engine docker.io containerd runc
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now install the repository for Docker CE. </font><font style="vertical-align: inherit;">Through apt-get, we can install the necessary version without having to build it from the sources ourselves. </font><font style="vertical-align: inherit;">Following the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recommendations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on the official Docker website, we write the following commands:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#   </span><font></font>
$ sudo apt-get update<font></font>
<span class="hljs-comment">#   ,   apt    HTTPS</span><font></font>
$ sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common<font></font>
<font></font>
<span class="hljs-comment">#      GPG   Docker</span><font></font>
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<font></font>
<span class="hljs-comment">#  Docker   :</span>
$ sudo add-apt-repository <span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable"</span><font></font>
<font></font>
<span class="hljs-comment">#        Docker    </span><font></font>
$ sudo apt-get update<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you've ever added a new repository using apt, all of this is familiar to you as a whole. </font><font style="vertical-align: inherit;">If not, I hope you still stayed with me :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, install Docker:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo apt-get install docker-ce=17.09.0~ce-0~ubuntu</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are not using Ubuntu-style WSL, you can see the list of available versions like this:</font></font><br>
<br>
<pre><code class="bash hljs">$ apt list -a docker-ce</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... or use a similar command from some other library if you abandoned APT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the end, you need to add your current user to the docker group in order to be able to correctly use the Docker Engine, which should be running on your system with as root.</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -aG docker <span class="hljs-variable">$USER</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Running Docker on Windows</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now that Docker is installed, we need to use a rather tricky method to start it as a service in WSL every time we boot Windows. </font><font style="vertical-align: inherit;">This is not as easy as it may seem. </font><font style="vertical-align: inherit;">We need to act on behalf of the superuser and run the command shell with elevated privileges, which complicates the task a bit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To simplify the process a bit, create a </font><font style="vertical-align: inherit;">new file </font><font style="vertical-align: inherit;">in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / local / sbin /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a script that contains the appropriate commands for launching the Docker service:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo nano /usr/<span class="hljs-built_in">local</span>/sbin/start_docker.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
with the following contents:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/usr/bin/env bash</span><font></font>
sudo cgroups-mount<font></font>
sudo service docker start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first sudo command is to mount cgroups (it will be executed at reboot), and the second gives the docker service to systemd (this is the Ubuntu subsystem for initializing and managing services). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let the script run and run it:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo chmod +x /usr/<span class="hljs-built_in">local</span>/sbin/start_docker.sh
<span class="hljs-comment">#  </span>
$ sudo chmod 755 /usr/<span class="hljs-built_in">local</span>/sbin/start_docker.sh<font></font>
$ /bin/sh /usr/<span class="hljs-built_in">local</span>/sbin/start_docker.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the Docker service will not start for two reasons:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The script makes calls as the superuser, so the script itself must be run with superuser privileges in order to work as intended. </font><font style="vertical-align: inherit;">In theory, doing this is as simple as writing any sudo command, but for this, the user must enter their data after each download, which is very annoying.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first command to mount cgroups must be run in bash with elevated privileges. </font><font style="vertical-align: inherit;">To run it without user input, we have to use the Windows Task Scheduler.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All clear? </font><font style="vertical-align: inherit;">Then to the point ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Running a script with root privileges without user input</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the Linux family of OSs, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / sudoers</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">determines who and what can run with superuser privileges. </font><font style="vertical-align: inherit;">Let's modify it so that your user can call the script without having to constantly enter the root password. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(But be very careful with this file! It is very easy to cut yourself out of the system if you don't know what you are doing!)</font></font></i><br>
<br>
<pre><code class="bash hljs">$ sudo nano /etc/sudoers</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add a new line to the end of the file. </font><font style="vertical-align: inherit;">In this case, you must know your user name exactly (run echo $ USER if you are not sure):</font></font><br>
<br>
<pre><code class="bash hljs">&lt;your username here&gt; ALL=(ALL:ALL) NOPASSWD: /bin/sh /usr/<span class="hljs-built_in">local</span>/sbin/start_docker.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we can start the Docker service as root without user input:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo /bin/sh /usr/<span class="hljs-built_in">local</span>/sbin/start_docker.sh </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hooray, comrades!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proper Docker Startup on Windows Boot</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, when the system boots, we will be able to launch Docker as an administrator using a separate command that does not require user interaction. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gz/yk/ay/gzykayux91cms_vnq69ps3ed0ec.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Launch the Windows </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task Scheduler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and select the </font><i><font style="vertical-align: inherit;">Task Scheduler Library</font></i><font style="vertical-align: inherit;"> in the left pane. Then select </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create Task</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the right pane. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/ny/nc/oenyncdy3ahozyistesjwkbdloq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, you will be prompted to edit the basic settings of the task. Give your task a clear name and make sure that the rest of the settings match mine. It is important that you select </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run with highest privileges</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/s3/gm/whs3gmaydakxuyr2j49c2fgal3w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Triggers</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tab, </font><font style="vertical-align: inherit;">add a new trigger that will start the task as soon as the local user logs in.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r5/as/ky/r5askyk3f5x59twkprg-blvh9tg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Switching to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tab </font><font style="vertical-align: inherit;">, create a new action that will run bash and immediately execute our script with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the -c switch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">-c <span class="hljs-string">"sudo /bin/sh /usr/local/sbin/start_docker.sh"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that this must be done with elevated privileges, so check the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run with highest privileges</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> checkbox </font><font style="vertical-align: inherit;">on the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tab </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/nr/fk/opnrfko4_0fjl9obd2dbaxo3sok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The rest of the parameters mainly depend on individual preferences, but I will show my settings. </font><font style="vertical-align: inherit;">If you want, you can copy them. </font><font style="vertical-align: inherit;">Some power settings may not appear if you are sitting on a stationary car. </font><font style="vertical-align: inherit;">Personally, I use a laptop. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jr/gt/x_/jrgtx_z_kndgcg3c5esh6mogzta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, everything goes as we intended. </font><font style="vertical-align: inherit;">If you didn‚Äôt launch Docker in the previous steps using commands with elevated privileges, just right-click on the task that we created in the Task Scheduler and select ‚ÄúRun‚Äù! </font><font style="vertical-align: inherit;">That's all!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check that everything works</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to play it safe, reboot your machine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(yes, for this you will have to close your browser tabs for some time)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , start bash and enter:</font></font><br>
<br>
<pre><code class="bash hljs">$ docker run --rm hello-world</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If all goes well, you will see Docker's standard greeting. </font><font style="vertical-align: inherit;">The service will start automatically and directly in WSL! </font><font style="vertical-align: inherit;">Congratulations!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Round off</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You just installed and started Docker in WSL. </font><font style="vertical-align: inherit;">This means that your containers can now share Ubuntu already running on your system. </font><font style="vertical-align: inherit;">Thus, there is no need to deploy a new (virtualized) OS, as a regular Docker for Windows does. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The performance of Docker in WSL so far [at the time of writing of the original article] leaves much to be desired, but as the platform develops and Windows updates are released, it will only improve.</font></font><br>
<br>
<h2> </h2><br>
<ol>
<li>onomatopellan  GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://github.com/Microsoft/WSL/issues/2291#issuecomment-383698720</a></li>
<li>Official Docker Documentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://docs.docker.com/install/linux/docker-ce/ubuntu</a>/</li>
<li>cgroupfs-mount: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://github.com/tianon/cgroupfs-mount</a></li>
<li>Bash Command Line Interface: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://docs.microsoft.com/en-us/windows/wsl/reference</a></li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496776/index.html">Hacking Unmanned Vehicles: Who Will Be Responsible (RAND Corporation study)</a></li>
<li><a href="../en496782/index.html">How I refused to calculate the square root</a></li>
<li><a href="../en496790/index.html">Unigine Engine - New Unique</a></li>
<li><a href="../en496792/index.html">Drawing a graph with cairo in GTK3</a></li>
<li><a href="../en496802/index.html">Simple Made Easy - Rich Hickey (with Russian translation)</a></li>
<li><a href="../en496810/index.html">General Financial Analysis in Python (Part 3)</a></li>
<li><a href="../en496812/index.html">Zoom - banal negligence or targeted espionage?</a></li>
<li><a href="../en496816/index.html">Can you feel the candidate, is he alive?</a></li>
<li><a href="../en496818/index.html">Hundreds of thousands of routes per second per core. Yandex.Routing Experience</a></li>
<li><a href="../en496820/index.html">Pitfalls of Terraform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>