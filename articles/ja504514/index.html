<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👧‍👧 🐗 🚶🏽 ESP32でのWiFiの5つの実験 🚭 👩🏾‍🤝‍👨🏼 👩‍❤️‍👨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちはHabr。
 
 ESP32ボードは、低価格、優れたコンピューティング能力（200 MHzプロセッサー）、MicroPythonとArduino IDEの両方をサポートするSDKが開発され、周辺機器（SPI、I2Cなど）とGPIOが存在し、ワイヤレス接続（WiFi、Bluetooth）があ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESP32でのWiFiの5つの実験</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504514/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちはHabr。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32ボードは、低価格、優れたコンピューティング能力（200 MHzプロセッサー）、MicroPythonとArduino IDEの両方をサポートするSDKが開発され、周辺機器（SPI、I2Cなど）とGPIOが存在し、ワイヤレス接続（WiFi、Bluetooth）があるため、非常に人気があります。今日私たちは、たった12ドルほどの価格でそのようなボードで何ができるかを見ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vo/9b/qv/vo9bqvvrdeibts3zfean7ldfisa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークへの単純な接続からWiFiスニファーまで、WiFiを使用するためのさまざまなオプションを検討します。テストには、ESP32（図のようにOLEDスクリーンが望ましい）とArduino IDEを備えたボードが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがどのように機能するかに興味がある人のために、カットの下で続けられました。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32ライブラリをArduino IDEに接続する方法は記述しません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">誰でも</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このボードには機能があるだけです。ArduinoIDEからコードをダウンロードするには、入力中にブートボタンを押し続ける必要があります。</font><font style="vertical-align: inherit;">それ以外の場合、ボードの使用は通常のArduinoと変わりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードに取り掛かりましょう。</font><font style="vertical-align: inherit;">すべてのコード例は完全に使用する準備ができており、Arduino IDEにコピーして貼り付けるだけです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. WiFiに接続して正確な時間を取得する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボード上にWiFiがあるので、私たちができる最も簡単なことは、既存のWiFiネットワークに接続することです。</font><font style="vertical-align: inherit;">これは一般的な知識であり、ESP8266でも機能しました。</font><font style="vertical-align: inherit;">ただし、接続して何もしないのは面白くないので、NTPを使用して正確な時刻をダウンロードする方法を示します。</font><font style="vertical-align: inherit;">以下のコードを使用すると、ESPボードをデスクトップ（または100lvlオタク用の腕時計:)ウォッチに簡単に変換できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6p/is/nr/6pisnrytjjlb4jtycmaywtxcqpo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは非常にシンプルで、NTPサポートが標準ライブラリに既に組み込まれていて、何もインストールする必要がないのは興味深いことです。</font><font style="vertical-align: inherit;">OLED画面を機能させるには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSD1306</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリをインストールする必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ssidおよびpassword変数は、実際のアクセスポイントのパラメーターに置き換える必要があります。そうしないと、すべてがそのまま機能します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFi.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SSD1306Wire.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><font></font>
 <font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ssid     = <span class="hljs-string">"MYWIFI"</span>;     
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* password = <span class="hljs-string">"12345678"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ntpServer = <span class="hljs-string">"pool.ntp.org"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">long</span>  gmtOffset_sec = <span class="hljs-number">3600</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span>   daylightOffset_sec = <span class="hljs-number">3600</span>;<font></font>
<font></font>
<span class="hljs-comment">// OLED Display 128x64</span>
<span class="hljs-function">SSD1306Wire  <span class="hljs-title">display</span><span class="hljs-params">(<span class="hljs-number">0x3c</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>)</span></span>;<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  Serial.begin(<span class="hljs-number">115200</span>);         <font></font>
  delay(<span class="hljs-number">10</span>);<font></font>
  Serial.println(<span class="hljs-string">'\n'</span>);<font></font>
  <font></font>
  WiFi.begin(ssid, password);             <span class="hljs-comment">// Connect to the network</span>
  <span class="hljs-keyword">while</span> (WiFi.status() != WL_CONNECTED) { <span class="hljs-comment">// Wait for the Wi-Fi to connect</span>
    delay(<span class="hljs-number">500</span>);<font></font>
    Serial.print(<span class="hljs-string">'.'</span>);<font></font>
  }<font></font>
  Serial.println(<span class="hljs-string">'\n'</span>);<font></font>
  Serial.println(<span class="hljs-string">"Connection established"</span>);  <font></font>
  Serial.print(<span class="hljs-string">"IP address:\t"</span>);<font></font>
  Serial.println(WiFi.localIP()); <font></font>
<font></font>
  <span class="hljs-comment">// Get the NTP time</span><font></font>
  configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);<font></font>
<font></font>
  <span class="hljs-comment">// OLED display init</span><font></font>
  display.init();<font></font>
  display.clear();<font></font>
  display.setTextAlignment(TEXT_ALIGN_LEFT);<font></font>
  display.setFont(ArialMT_Plain_10);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Access Point connected"</span>);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-string">"AP IP address: "</span>);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">36</span>, WiFi.localIP().toString());<font></font>
  display.display();<font></font>
  delay(<span class="hljs-number">1000</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw_time</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span> </span>{<font></font>
  display.clear();<font></font>
  display.setTextAlignment(TEXT_ALIGN_CENTER);<font></font>
  display.setFont(ArialMT_Plain_24);<font></font>
  display.drawString(display.getWidth()/<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, msg);<font></font>
  display.display();<font></font>
<font></font>
  Serial.println(msg);<font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{ 
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> <span class="hljs-title">timeinfo</span>;</span>
  <span class="hljs-keyword">if</span> (getLocalTime(&amp;timeinfo)) {
      <span class="hljs-keyword">char</span> time_str[<span class="hljs-number">16</span>];<font></font>
      strftime(time_str, <span class="hljs-number">16</span>, <span class="hljs-string">"%H:%M:%S"</span>, &amp;timeinfo);<font></font>
<font></font>
      draw_time(time_str);<font></font>
  }  <font></font>
  delay(<span class="hljs-number">500</span>);<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. WiFiアクセスポイント</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、アクセスポイントに接続するだけでなく、独自のものを作成することもできます。</font><font style="vertical-align: inherit;">この例では、スマートフォンなどから開くことができるミニWebサーバーを起動します。</font><font style="vertical-align: inherit;">これとは別に、SYSTEM_EVENT_AP_STACONNECTEDイベントの処理に注目します。これにより、アクセスポイントに接続しているクライアントの数を確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがどのように機能するかの写真がKDPVに示されています。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFi.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;DNSServer.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SSD1306Wire.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// Access Point credentials</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *ssid = <span class="hljs-string">"TEST-123"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *password = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// "12345678";</span>
<span class="hljs-keyword">int</span> connections = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-comment">// Onboard WiFi server</span>
<span class="hljs-function">WiFiServer <span class="hljs-title">server</span><span class="hljs-params">(<span class="hljs-number">80</span>)</span></span>;<font></font>
String responseHTML = <span class="hljs-string">"&lt;!DOCTYPE html&gt;&lt;html&gt;"</span>
                      <span class="hljs-string">"&lt;head&gt;&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;"</span>
                      <span class="hljs-string">"&lt;style&gt;html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center;}"</span>
                      <span class="hljs-string">"&lt;/style&gt;&lt;/head&gt;"</span>
                      <span class="hljs-string">"&lt;body&gt;&lt;h1&gt;ESP32 Web Server&lt;/h1&gt;"</span>
                      <span class="hljs-string">"&lt;p&gt;Hello World&lt;/p&gt;"</span>
                      <span class="hljs-string">"&lt;/body&gt;&lt;/html&gt;"</span>;<font></font>
<font></font>
<span class="hljs-comment">// OLED Display 128x64</span>
<span class="hljs-function">SSD1306Wire  <span class="hljs-title">display</span><span class="hljs-params">(<span class="hljs-number">0x3c</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>)</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">WiFiStationConnected</span><span class="hljs-params">(WiFiEvent_t event, WiFiEventInfo_t info)</span></span>{<font></font>
  connections += <span class="hljs-number">1</span>;<font></font>
  showConnectionsCount();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">showConnectionsCount</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">char</span> data[<span class="hljs-number">32</span>];
  <span class="hljs-built_in">sprintf</span>(data, <span class="hljs-string">"Connections: %d"</span>, connections);<font></font>
  draw_message(data);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  Serial.begin(<span class="hljs-number">115200</span>);                   <font></font>
  Serial.println();<font></font>
  Serial.println(<span class="hljs-string">"Configuring access point..."</span>);<font></font>
<font></font>
  <span class="hljs-comment">// Start access point </span><font></font>
  WiFi.mode(WIFI_AP);                   <font></font>
  WiFi.softAP(ssid, password);<font></font>
  WiFi.onEvent(WiFiStationConnected, SYSTEM_EVENT_AP_STACONNECTED);<font></font>
<font></font>
  IPAddress ip_address = WiFi.softAPIP();     <span class="hljs-comment">//IP Address of our accesspoint</span><font></font>
<font></font>
  <span class="hljs-comment">// Start web server</span><font></font>
  server.begin();<font></font>
  <font></font>
  Serial.print(<span class="hljs-string">"AP IP address: "</span>);<font></font>
  Serial.println(ip_address);<font></font>
<font></font>
  <span class="hljs-comment">// Oled display </span><font></font>
  display.init();<font></font>
  <span class="hljs-comment">// Draw info</span><font></font>
  display.clear();<font></font>
  display.setTextAlignment(TEXT_ALIGN_LEFT);<font></font>
  display.setFont(ArialMT_Plain_10);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Access Point started"</span>);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">12</span>, ssid);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-string">"AP IP address: "</span>);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">36</span>, ip_address.toString());<font></font>
  display.display();<font></font>
<font></font>
  <span class="hljs-comment">// Total number of connections</span><font></font>
  showConnectionsCount();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw_message</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span> </span>{<font></font>
  display.setColor(BLACK);<font></font>
  display.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>, display.getWidth(), <span class="hljs-number">12</span>);<font></font>
  display.setColor(WHITE);<font></font>
  display.drawString(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>, msg);<font></font>
  display.display();<font></font>
<font></font>
  Serial.println(msg);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
  WiFiClient client = server.available();   <span class="hljs-comment">// Listen for incoming clients</span>
  <span class="hljs-keyword">if</span> (client) {                             <span class="hljs-comment">// If a new client connects,</span>
    draw_message(<span class="hljs-string">"Client connected"</span>);<font></font>
    <font></font>
    String currentLine = <span class="hljs-string">""</span>;   <span class="hljs-comment">// make a String to hold incoming data from the client</span>
    <span class="hljs-keyword">while</span> (client.connected()) {  <span class="hljs-comment">// loop while the client's connected</span>
      <span class="hljs-keyword">if</span> (client.available()) {        <span class="hljs-comment">// if there's bytes to read from the client,</span>
        <span class="hljs-keyword">char</span> c = client.read();      <span class="hljs-comment">// read a byte, then</span>
        Serial.write(c);                <span class="hljs-comment">// print it out the serial monitor</span>
        <span class="hljs-keyword">if</span> (c == <span class="hljs-string">'\n'</span>) {                 <span class="hljs-comment">// if the byte is a newline character</span>
          <span class="hljs-comment">// if the current line is blank, you got two newline characters in a row.</span>
          <span class="hljs-comment">// that's the end of the client HTTP request, so send a response:</span>
          <span class="hljs-keyword">if</span> (currentLine.length() == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// Send header</span>
            client.println(<span class="hljs-string">"HTTP/1.1 200 OK"</span>);<font></font>
            client.println(<span class="hljs-string">"Content-type:text/html"</span>);<font></font>
            client.println(<span class="hljs-string">"Connection: close"</span>);<font></font>
            client.println();<font></font>
            <font></font>
            <span class="hljs-comment">// Display the HTML web page</span><font></font>
            client.println(responseHTML);            <font></font>
            <span class="hljs-comment">// The HTTP response ends with another blank line</span><font></font>
            client.println();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
          } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// if we got a newline, then clear currentLine</span>
            currentLine = <span class="hljs-string">""</span>;<font></font>
          }<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c != <span class="hljs-string">'\r'</span>) {  <span class="hljs-comment">// if we got anything else but a CR character,</span>
          currentLine += c;   <span class="hljs-comment">// add it to the end of the currentLine</span><font></font>
        }<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-comment">// Close the connection</span><font></font>
    client.stop();<font></font>
    showConnectionsCount();<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムが起動すると、アクセスポイントの名前とIPアドレスが画面に表示されます。</font><font style="vertical-align: inherit;">スマートフォンからアクセスポイントに接続したら、ブラウザにIPを入力してWebページのコンテンツを表示できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーはOLED画面なしで動作します。この場合、デバッグ情報はArduino IDEのシリアルモニターを使用して表示できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. DNSを備えたWiFiアクセスポイント</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の例は、DNSサポートをアクティブにすることで改善できます。</font><font style="vertical-align: inherit;">この場合、IPを駆動する必要はありません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">代わりに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.myesp32.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのフルネームを使用できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5t/up/su/5tupsuhqi7gjkij1ccoykmu15te.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースコードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebServer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font><font style="vertical-align: inherit;">を使用しているため、リクエスト処理コードを大幅に短縮できます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFi.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;DNSServer.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WebServer.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function">WebServer <span class="hljs-title">webServer</span><span class="hljs-params">(<span class="hljs-number">80</span>)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *ssid = <span class="hljs-string">"TEST-123"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *password = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// "12345678";</span><font></font>
<font></font>
<span class="hljs-function">IPAddress <span class="hljs-title">apIP</span><span class="hljs-params">(<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>)</span></span>;<font></font>
DNSServer dnsServer;<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *server_name = <span class="hljs-string">"www.myesp32.com"</span>;  <span class="hljs-comment">// Can be "*" to all DNS requests</span><font></font>
<font></font>
String responseHTML = <span class="hljs-string">"&lt;!DOCTYPE html&gt;&lt;html&gt;"</span>
                      <span class="hljs-string">"&lt;head&gt;&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;"</span>
                      <span class="hljs-string">"&lt;style&gt;html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: center;}"</span>
                      <span class="hljs-string">"&lt;/style&gt;&lt;/head&gt;"</span>
                      <span class="hljs-string">"&lt;body&gt;&lt;h1&gt;ESP32 Web Server&lt;/h1&gt;"</span>
                      <span class="hljs-string">"&lt;p&gt;Hello World&lt;/p&gt;"</span>
                      <span class="hljs-string">"&lt;/body&gt;&lt;/html&gt;"</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  WiFi.mode(WIFI_AP);<font></font>
  WiFi.softAP(ssid, password);<font></font>
  delay(<span class="hljs-number">100</span>);<font></font>
  <font></font>
  WiFi.softAPConfig(apIP, apIP, IPAddress(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>));<font></font>
<font></font>
  <span class="hljs-keyword">const</span> byte DNS_PORT = <span class="hljs-number">53</span>;<font></font>
  dnsServer.start(DNS_PORT, server_name, apIP);<font></font>
<font></font>
  webServer.onNotFound([]() {<font></font>
    webServer.send(<span class="hljs-number">200</span>, <span class="hljs-string">"text/html"</span>, responseHTML);<font></font>
  });<font></font>
  webServer.begin();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
  dnsServer.processNextRequest();<font></font>
  webServer.handleClient();<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. WiFIスニファ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WiFiを使用するもう1つの興味深い例は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https：//github.com/ESP-EOS/ESP32-WiFi-Snifferにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ESP32上のWiFiは、いわゆる無差別モードに転送できます。これにより、ネットワーク自体に接続することなくWiFiパケットをシームレスに監視できます。</font><font style="vertical-align: inherit;">特に、近くのデバイスのMACアドレスを確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cx/0v/iq/cx0viqtn1knxpr53cr3syoj3v4k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、たとえば、「スマートホーム」が所有者がいつ家に帰ったかを知るのに役立ちます。</font><font style="vertical-align: inherit;">一部の企業では、デバイスのMACアドレスを使用して</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">訪問者</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">監視し</font></a><font style="vertical-align: inherit;">、Googleにターゲット広告を表示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソースコードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/ESP-EOS/ESP32-WiFi-Sniffer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からダウンロードでき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. WiFiパケットモニター</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
無差別モードを使用するもう1つの例は、前のケースと同様に、チャネルアクティビティのグラフィックモニタリングです。ネットワーク自体への接続は必要ありません。</font></font><br>
<img src="https://habrastorage.org/webt/yo/tc/ez/yotcezcy3_21l2egwu6qkkcyslo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでソースコードを取得</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、SDへの書き込みのサポートを削除し（ボードにはまだ存在しません）、グラフィックライブラリのバグを修正しました。</font><font style="vertical-align: inherit;">ボタンを押すか（ボードにはありません）、またはシリアルモニター経由で対応する番号をArduino IDEに送信することにより、監視するチャネル番号を切り替えることができます。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;esp_wifi.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;esp_wifi_types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;esp_system.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;esp_event.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;esp_event_loop.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;nvs_flash.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstddef&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Wire.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Preferences.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_CH 14       <span class="hljs-comment">// 1 - 14</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SNAP_LEN 2324   <span class="hljs-comment">// max len of each recieved packet</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUTTON_PIN 5    <span class="hljs-comment">// button to change the channel</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> USE_DISPLAY     <span class="hljs-comment">// comment out if you don't want to use OLED</span></span>
<span class="hljs-comment">//#define FLIP_DISPLAY    // comment out if you don't like to flip it</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_X 128</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_Y 64</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> CONFIG_FREERTOS_UNICORE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RUNNING_CORE 0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RUNNING_CORE 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_DISPLAY</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SSD1306Wire.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">esp_err_t</span> <span class="hljs-title">event_handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>* ctx, <span class="hljs-keyword">system_event_t</span>* event)</span> </span>{
  <span class="hljs-keyword">return</span> ESP_OK;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// OLED Display 128x64</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_DISPLAY</span>
<span class="hljs-function">SSD1306Wire  <span class="hljs-title">display</span><span class="hljs-params">(<span class="hljs-number">0x3c</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>)</span></span>;
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
Preferences preferences;<font></font>
<font></font>
<span class="hljs-keyword">bool</span> useSD = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">bool</span> buttonPressed = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">bool</span> buttonEnabled = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">uint32_t</span> lastDrawTime;
<span class="hljs-keyword">uint32_t</span> lastButtonTime;
<span class="hljs-keyword">uint32_t</span> tmpPacketCounter;
<span class="hljs-keyword">uint32_t</span> pkts[MAX_X];       <span class="hljs-comment">// here the packets per second will be saved</span>
<span class="hljs-keyword">uint32_t</span> deauths = <span class="hljs-number">0</span>;       <span class="hljs-comment">// deauth frames per second</span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ch = <span class="hljs-number">1</span>;       <span class="hljs-comment">// current 802.11 channel</span>
<span class="hljs-keyword">int</span> rssiSum;<font></font>
<font></font>
<span class="hljs-comment">/* ===== functions ===== */</span>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">getMultiplicator</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">uint32_t</span> maxVal = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; MAX_X; i++) {
    <span class="hljs-keyword">if</span> (pkts[i] &gt; maxVal) maxVal = pkts[i];<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (maxVal &gt; MAX_Y) <span class="hljs-keyword">return</span> (<span class="hljs-keyword">double</span>)MAX_Y / (<span class="hljs-keyword">double</span>)maxVal;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setChannel</span><span class="hljs-params">(<span class="hljs-keyword">int</span> newChannel)</span> </span>{<font></font>
  ch = newChannel;<font></font>
  <span class="hljs-keyword">if</span> (ch &gt; MAX_CH || ch &lt; <span class="hljs-number">1</span>) ch = <span class="hljs-number">1</span>;<font></font>
<font></font>
  preferences.begin(<span class="hljs-string">"packetmonitor32"</span>, <span class="hljs-literal">false</span>);<font></font>
  preferences.putUInt(<span class="hljs-string">"channel"</span>, ch);<font></font>
  preferences.end();<font></font>
<font></font>
  esp_wifi_set_promiscuous(<span class="hljs-literal">false</span>);<font></font>
  esp_wifi_set_channel(ch, WIFI_SECOND_CHAN_NONE);<font></font>
  esp_wifi_set_promiscuous_rx_cb(&amp;wifi_promiscuous);<font></font>
  esp_wifi_set_promiscuous(<span class="hljs-literal">true</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">wifi_promiscuous</span><span class="hljs-params">(<span class="hljs-keyword">void</span>* buf, <span class="hljs-keyword">wifi_promiscuous_pkt_type_t</span> type)</span> </span>{
  <span class="hljs-keyword">wifi_promiscuous_pkt_t</span>* pkt = (<span class="hljs-keyword">wifi_promiscuous_pkt_t</span>*)buf;
  <span class="hljs-keyword">wifi_pkt_rx_ctrl_t</span> ctrl = (<span class="hljs-keyword">wifi_pkt_rx_ctrl_t</span>)pkt-&gt;rx_ctrl;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (type == WIFI_PKT_MGMT &amp;&amp; (pkt-&gt;payload[<span class="hljs-number">0</span>] == <span class="hljs-number">0xA0</span> || pkt-&gt;payload[<span class="hljs-number">0</span>] == <span class="hljs-number">0xC0</span> )) deauths++;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (type == WIFI_PKT_MISC) <span class="hljs-keyword">return</span>;             <span class="hljs-comment">// wrong packet type</span>
  <span class="hljs-keyword">if</span> (ctrl.sig_len &gt; SNAP_LEN) <span class="hljs-keyword">return</span>;           <span class="hljs-comment">// packet too long</span><font></font>
<font></font>
  <span class="hljs-keyword">uint32_t</span> packetLength = ctrl.sig_len;
  <span class="hljs-keyword">if</span> (type == WIFI_PKT_MGMT) packetLength -= <span class="hljs-number">4</span>;  <span class="hljs-comment">// fix for known bug in the IDF https://github.com/espressif/esp-idf/issues/886</span><font></font>
<font></font>
  <span class="hljs-comment">//Serial.print(".");</span><font></font>
  tmpPacketCounter++;<font></font>
  rssiSum += ctrl.rssi;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_DISPLAY</span>
  <span class="hljs-keyword">double</span> multiplicator = getMultiplicator();
  <span class="hljs-keyword">int</span> len;
  <span class="hljs-keyword">int</span> rssi;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (pkts[MAX_X - <span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>) rssi = rssiSum / (<span class="hljs-keyword">int</span>)pkts[MAX_X - <span class="hljs-number">1</span>];
  <span class="hljs-keyword">else</span> rssi = rssiSum;<font></font>
<font></font>
  display.clear();<font></font>
<font></font>
  display.setTextAlignment(TEXT_ALIGN_RIGHT);<font></font>
  display.drawString( <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, (String)ch);<font></font>
  display.drawString( <span class="hljs-number">14</span>, <span class="hljs-number">0</span>, (<span class="hljs-string">"|"</span>));<font></font>
  display.drawString( <span class="hljs-number">30</span>, <span class="hljs-number">0</span>, (String)rssi);<font></font>
  display.drawString( <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, (<span class="hljs-string">"|"</span>));<font></font>
  display.drawString( <span class="hljs-number">82</span>, <span class="hljs-number">0</span>, (String)tmpPacketCounter);<font></font>
  display.drawString( <span class="hljs-number">87</span>, <span class="hljs-number">0</span>, (<span class="hljs-string">"["</span>));<font></font>
  display.drawString(<span class="hljs-number">106</span>, <span class="hljs-number">0</span>, (String)deauths);<font></font>
  display.drawString(<span class="hljs-number">110</span>, <span class="hljs-number">0</span>, (<span class="hljs-string">"]"</span>));<font></font>
  display.drawString(<span class="hljs-number">114</span>, <span class="hljs-number">0</span>, (<span class="hljs-string">"|"</span>));<font></font>
  display.drawString(<span class="hljs-number">128</span>, <span class="hljs-number">0</span>, (useSD ? <span class="hljs-string">"SD"</span> : <span class="hljs-string">""</span>));<font></font>
  display.setTextAlignment(TEXT_ALIGN_LEFT);<font></font>
  display.drawString( <span class="hljs-number">36</span>,  <span class="hljs-number">0</span>, (<span class="hljs-string">"Pkts:"</span>));<font></font>
<font></font>
  display.drawLine(<span class="hljs-number">0</span>, <span class="hljs-number">63</span> - MAX_Y, MAX_X, <span class="hljs-number">63</span> - MAX_Y);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; MAX_X; i++) {<font></font>
    len = pkts[i] * multiplicator;<font></font>
    display.drawLine(i, <span class="hljs-number">63</span>, i, <span class="hljs-number">63</span> - (len &gt; MAX_Y ? MAX_Y : len));
    <span class="hljs-keyword">if</span> (i &lt; MAX_X - <span class="hljs-number">1</span>) pkts[i] = pkts[i + <span class="hljs-number">1</span>];<font></font>
  }<font></font>
  display.display();<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// Serial</span>
  Serial.begin(<span class="hljs-number">115200</span>);<font></font>
<font></font>
  <span class="hljs-comment">// Settings</span>
  preferences.begin(<span class="hljs-string">"packetmonitor32"</span>, <span class="hljs-literal">false</span>);<font></font>
  ch = preferences.getUInt(<span class="hljs-string">"channel"</span>, <span class="hljs-number">1</span>);<font></font>
  preferences.end();<font></font>
<font></font>
  <span class="hljs-comment">// System &amp; WiFi</span><font></font>
  nvs_flash_init();<font></font>
  tcpip_adapter_init();<font></font>
  <span class="hljs-keyword">wifi_init_config_t</span> cfg = WIFI_INIT_CONFIG_DEFAULT();<font></font>
  ESP_ERROR_CHECK(esp_event_loop_init(event_handler, <span class="hljs-literal">NULL</span>));<font></font>
  ESP_ERROR_CHECK(esp_wifi_init(&amp;cfg));<font></font>
  <span class="hljs-comment">//ESP_ERROR_CHECK(esp_wifi_set_country(WIFI_COUNTRY_EU));</span><font></font>
  ESP_ERROR_CHECK(esp_wifi_set_storage(WIFI_STORAGE_RAM));<font></font>
  ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_NULL));<font></font>
  ESP_ERROR_CHECK(esp_wifi_start());<font></font>
<font></font>
  esp_wifi_set_channel(ch, WIFI_SECOND_CHAN_NONE);<font></font>
<font></font>
  <span class="hljs-comment">// I/O</span><font></font>
  pinMode(BUTTON_PIN, INPUT_PULLUP);<font></font>
<font></font>
  <span class="hljs-comment">// display</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_DISPLAY</span><font></font>
  display.init();<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> FLIP_DISPLAY</span><font></font>
  display.flipScreenVertically();<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
  <span class="hljs-comment">/* show start screen */</span><font></font>
  display.clear();<font></font>
  display.setFont(ArialMT_Plain_16);<font></font>
  display.drawString(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-string">"PacketMonitor32"</span>);<font></font>
  display.setFont(ArialMT_Plain_10);<font></font>
  display.drawString(<span class="hljs-number">24</span>, <span class="hljs-number">34</span>, <span class="hljs-string">"Made with &lt;3 by"</span>);<font></font>
  display.drawString(<span class="hljs-number">29</span>, <span class="hljs-number">44</span>, <span class="hljs-string">"@Spacehuhn"</span>);<font></font>
  display.display();<font></font>
<font></font>
  delay(<span class="hljs-number">1000</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
  <span class="hljs-comment">// second core</span><font></font>
  xTaskCreatePinnedToCore(<font></font>
    coreTask,               <span class="hljs-comment">/* Function to implement the task */</span>
    <span class="hljs-string">"coreTask"</span>,             <span class="hljs-comment">/* Name of the task */</span>
    <span class="hljs-number">2500</span>,                   <span class="hljs-comment">/* Stack size in words */</span>
    <span class="hljs-literal">NULL</span>,                   <span class="hljs-comment">/* Task input parameter */</span>
    <span class="hljs-number">0</span>,                      <span class="hljs-comment">/* Priority of the task */</span>
    <span class="hljs-literal">NULL</span>,                   <span class="hljs-comment">/* Task handle. */</span>
    RUNNING_CORE);          <span class="hljs-comment">/* Core where the task should run */</span><font></font>
<font></font>
  <span class="hljs-comment">// start Wifi sniffer</span><font></font>
  esp_wifi_set_promiscuous_rx_cb(&amp;wifi_promiscuous);<font></font>
  esp_wifi_set_promiscuous(<span class="hljs-literal">true</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
  vTaskDelay(portMAX_DELAY);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">coreTask</span><span class="hljs-params">( <span class="hljs-keyword">void</span> * p )</span> </span>{
  <span class="hljs-keyword">uint32_t</span> currentTime;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {<font></font>
    currentTime = millis();<font></font>
<font></font>
    <span class="hljs-comment">// check button</span>
    <span class="hljs-keyword">if</span> (digitalRead(BUTTON_PIN) == LOW) {
      <span class="hljs-keyword">if</span> (buttonEnabled) {
        <span class="hljs-keyword">if</span> (!buttonPressed) {<font></font>
          buttonPressed = <span class="hljs-literal">true</span>;<font></font>
          lastButtonTime = currentTime;<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentTime - lastButtonTime &gt;= <span class="hljs-number">2000</span>) {<font></font>
          draw();<font></font>
          buttonPressed = <span class="hljs-literal">false</span>;<font></font>
          buttonEnabled = <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
      }<font></font>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (buttonPressed) {<font></font>
        setChannel(ch + <span class="hljs-number">1</span>);<font></font>
        draw();<font></font>
      }<font></font>
      buttonPressed = <span class="hljs-literal">false</span>;<font></font>
      buttonEnabled = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// draw Display</span>
    <span class="hljs-keyword">if</span> ( currentTime - lastDrawTime &gt; <span class="hljs-number">1000</span> ) {<font></font>
      lastDrawTime = currentTime;<font></font>
      <span class="hljs-comment">// Serial.printf("\nFree RAM %u %u\n", heap_caps_get_minimum_free_size(MALLOC_CAP_8BIT), heap_caps_get_minimum_free_size(MALLOC_CAP_32BIT));// for debug purposes</span><font></font>
<font></font>
      pkts[MAX_X - <span class="hljs-number">1</span>] = tmpPacketCounter;<font></font>
<font></font>
      draw();<font></font>
<font></font>
      Serial.println((String)pkts[MAX_X - <span class="hljs-number">1</span>]);<font></font>
<font></font>
      tmpPacketCounter = <span class="hljs-number">0</span>;<font></font>
      deauths = <span class="hljs-number">0</span>;<font></font>
      rssiSum = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// Serial input</span>
    <span class="hljs-keyword">if</span> (Serial.available()) {<font></font>
      ch = Serial.readString().toInt();<font></font>
      <span class="hljs-keyword">if</span> (ch &lt; <span class="hljs-number">1</span> || ch &gt; <span class="hljs-number">14</span>) ch = <span class="hljs-number">1</span>;<font></font>
      setChannel(ch);<font></font>
    }<font></font>
  }<font></font>
}</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一つESP32ボードは、1チャンネルのみを監視することができますが、これらのボードの安っぽでそれを行うことができます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このよう</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/kl/_b/axkl_b9bmso088pcajq0-mvejru.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出典：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/spacehuhn/WiFiSatellite</font></font></a></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、機能と価格の比率の点で、ESP32は非常に興味深いものであり、いずれにしても、通常のArduinoよりはるかに機能的です。</font><font style="vertical-align: inherit;">WiFiの実験も非常に楽しいものです。ボード上では、完全に機能するWebサーバー（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebSocketを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポートしている場合でも）を維持できるだけでなく、</font><font style="vertical-align: inherit;">WiFiとMACの動作をより詳細に研究できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、ESP32モジュールは、Arduinoの機能が十分ではなく、LinuxでのRaspberry Piの使用が依然として冗長である場合に役立ちます。</font><font style="vertical-align: inherit;">ちなみに、ESP32のコンピューティング機能では、カメラモジュールを使用することもできるため、ボードをワイヤレスビデオ通話として、またはホームビデオ監視システムのプロトタイプとして使用できます。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カメラ付きESP32</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/jg/az/7l/jgaz7lhh1acil6nwvlvk33jsjuw.png"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての成功した実験。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja504492/index.html">ボタンを押す：電子投票の理論と実践-5月30日の円卓会議</a></li>
<li><a href="../ja504494/index.html">新しいWindows 10アップデートの7つの機能</a></li>
<li><a href="../ja504496/index.html">ゼロからの音声スキル：アリスがTsoiの曲をどのように教えたのか、運転中に私を眠らせず、Yandexから6つの賞を獲得しました</a></li>
<li><a href="../ja504502/index.html">世界初のやさしいロボットの短くて奇妙な生活</a></li>
<li><a href="../ja504510/index.html">自分でプログラムします。ITで仕事を見つける方法</a></li>
<li><a href="../ja504516/index.html">好きなハッカーの戦術</a></li>
<li><a href="../ja504520/index.html">1週間で未知のプロジェクトに関する70の無料の出版物を作成する方法</a></li>
<li><a href="../ja504522/index.html">検疫で何を確認しますか？テクノストリームからの厳選された資料（パート6）</a></li>
<li><a href="../ja504524/index.html">典型的なCOVID-19流行開発モデル</a></li>
<li><a href="../ja504528/index.html">ハイブリッドクラウドを使用しています。誰が情報セキュリティの責任者であり、どのような新しい脅威が出現しますか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>