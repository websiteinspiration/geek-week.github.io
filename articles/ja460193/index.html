<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👧 👥 🥤 NetXMS上のWindowsでの証明書の有効期限の監視 🤾🏼 💂🏼 🐺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、Windowsを搭載したサーバーで証明書の有効期間を監視するタスクがありました。さて、私が立ち上がったとき、証明書が数回カボチャに変わった後、同時に、更新を担当するひげを生やした同僚が休暇中でした。その後、私たちは何かを疑い、それについて考えることにしました。 NetXMS監視システムを徐々に...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>NetXMS上のWindowsでの証明書の有効期限の監視</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460193/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、Windowsを搭載したサーバーで証明書の有効期間を監視するタスクがありました。さて、私が立ち上がったとき、証明書が数回カボチャに変わった後、同時に、更新を担当するひげを生やした同僚が休暇中でした。その後、私たち</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は何か</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><s><font style="vertical-align: inherit;">疑い</font></s><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">それについて考えることにしました。 NetXMS監視システムを徐々に導入しているため、これがメインであり、原則としてこのタスクの唯一の候補になりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は最終的にこの形で得られました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/wa/9q/pfwa9qmxenfj334rth33mcitz80.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてプロセス自体はさらに進んでいます。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行け。 NetXMSには、有効期限が切れる証明書用の組み込みカウンターがないため、独自のカウンターを作成し、スクリプトを使用してそれに証明書を提供する必要があります。もちろん、PowershellではWindowsです。スクリプトは、オペレーティングシステム内のすべての証明書を読み取り、そこから日数で有効期限を取得し、この番号をNetXMSに転送する必要があります。彼のエージェントを通して。彼から始めましょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプション1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最も簡単です。証明書が最も近い日付で期限切れになるまでの日数を取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NetXMSサーバーがカスタムパラメータの存在を知るためには、エージェントからそれを受け取る必要があります。それ以外の場合、このパラメーターがないため、このパラメーターを追加できません。したがって、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nxagentd.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エージェント構成ファイル</font><font style="vertical-align: inherit;">で、次の名前の外部パラメーター行を追加します</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS.CertificateExpireDateSimple</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、スクリプトの起動を記述します。</font></font><br>
<br>
<pre><code class="plaintext hljs">ExternalParameter = HTTPS.CertificateExpireDateSimple: powershell.exe -File "\\server\share\NetXMS_CertExpireDateSimple.ps1"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトがネットワーク上で実行されることを考えると、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行ポリシーを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忘れないでください。また、コードを読みやすくするために省略した他の「-NoLogo -NoProfile -NonInteractive」も忘れないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、エージェント構成は次のようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs">#<font></font>
# NetXMS agent configuration file<font></font>
# Created by agent installer at Thu Jun 13 11:24:43 2019<font></font>
#<font></font>
 <font></font>
MasterServers = netxms.corp.testcompany.ru<font></font>
ConfigIncludeDir = C:\NetXMS\etc\nxagentd.conf.d<font></font>
LogFile = {syslog}<font></font>
FileStore = C:\NetXMS\var<font></font>
SubAgent = ecs.nsm<font></font>
SubAgent = filemgr.nsm<font></font>
SubAgent = ping.nsm<font></font>
SubAgent = logwatch.nsm<font></font>
SubAgent = portcheck.nsm<font></font>
SubAgent = winperf.nsm<font></font>
SubAgent = wmi.nsm<font></font>
 <font></font>
ExternalParameter = HTTPS.CertificateExpireDateSimple: powershell.exe -File "\\server\share\NetXMS_CertExpireDateSimple.ps1"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、設定を保存してエージェントを再起動する必要があります。これは、NetXMSコンソールから実行できます。構成（エージェントの構成ファイルの編集）を開き、編集して、保存して適用を実行します。その結果、まったく同じことが行われます。次に、待機する力がまったくない場合は、構成を再度読み取ります（ポーリング&gt;構成）。これらの手順が完了すると、カスタムパラメータを追加できるようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NetXMSコンソールで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ収集構成に移動します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書を監視し、そこで新しいパラメーターを作成する実験サーバー（将来的には、構成後、テンプレートに転送するのが理にかなっています）。リストからHTTPS.CertificateExpireDateSimpleを選択し、わかりやすい名前でDescriptionを入力し、タイプをIntegerに設定し、ポーリング間隔を設定します。不必要な情報でデータベースを詰まらせないように、短くしすぎるのは意味がありません。チェックするときにあまり長く待つのは不便です。証明書の場合、通常は600秒に設定します。デバッグ時に、たとえば30秒短くすることは理にかなっています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q_/r2/gy/q_r2gyru9rrf4rexqombopnjohg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
十分に準備ができている限り、すべての準備が整います。確認できます...いいえ、早すぎます。もちろん、今は何も得られません。スクリプトがまだ書かれていないからです。この脱落を修正します。スクリプトは、証明書の有効期限が切れるまでの残りの日数のみを提供します。利用可能なすべての最小値。スクリプトの例：</font></font><br>
 <br>
<pre><code class="powershell hljs"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">#      </span>
    <span class="hljs-variable">$lmCertificates</span> = <span class="hljs-selector-tag">@</span>( <span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-path</span> <span class="hljs-string">'Cert:\LocalMachine\My'</span> <span class="hljs-literal">-ErrorAction</span> Stop )<font></font>
     <font></font>
    <span class="hljs-comment">#   ,  "10 "</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$lmCertificates</span>.Count <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>) { <span class="hljs-keyword">return</span> <span class="hljs-number">3650</span> }<font></font>
 <font></font>
    <span class="hljs-comment">#  Expiration Date  </span>
    <span class="hljs-variable">$expirationDates</span> = <span class="hljs-selector-tag">@</span>( <span class="hljs-variable">$lmCertificates</span> | <span class="hljs-built_in">ForEach-Object</span> { <span class="hljs-keyword">return</span> <span class="hljs-variable">$_</span>.NotAfter } )<font></font>
 <font></font>
    <span class="hljs-comment">#    Expiration Date  </span>
    <span class="hljs-variable">$minExpirationDate</span> = (<span class="hljs-variable">$expirationDates</span> | <span class="hljs-built_in">Measure-Object</span> <span class="hljs-literal">-Minimum</span> <span class="hljs-literal">-ErrorAction</span> Stop ).Minimum<font></font>
 <font></font>
    <span class="hljs-comment">#    Expiration Date         </span>
    <span class="hljs-variable">$daysLeft</span> = [<span class="hljs-type">Math</span>]::Floor( (<span class="hljs-variable">$minExpirationDate</span> - [<span class="hljs-built_in">DateTime</span>]::Now).TotalDays )<font></font>
 <font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$daysLeft</span><font></font>
}<font></font>
<span class="hljs-keyword">catch</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">-1</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは次のようになります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gt/wg/r0/gtwgr01zmsst4vl8mw-2h2du1cm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書が約2年間有効期限切れになる723日前。最近、Exchangeのテストベンチで証明書を書き換えたので、これは論理的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは簡単なオプションでした。おそらく誰かがそれに満足しているでしょうが、私たちはもっと欲しかったのです。サーバー上のすべての証明書のリストを名前で取得し、それぞれが証明書の有効期限が切れるまでの残り日数を確認するタスクを設定しました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目のオプション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、もう少し複雑です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再度、エージェント構成を編集し、ExternalParameterを含む行の代わりに、他の2つを記述します。</font></font><br>
 <br>
<pre><code class="plaintext hljs">ExternalList = HTTPS.CertificateNames: powershell.exe -File "\\server\share\netxms_CertExternalNames.ps1"<font></font>
ExternalParameter = HTTPS.CertificateExpireDate(*): powershell.exe -File "\\server\share\netxms_CertExternalParameter.ps1" -CertificateId "$1"</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExternalList</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
では</font><font style="vertical-align: inherit;">、文字列のリストのみを取得します。</font><font style="vertical-align: inherit;">この例では、証明書名を含む文字列のリストです。</font><font style="vertical-align: inherit;">スクリプトを取得するこれらの行のリスト。</font><font style="vertical-align: inherit;">リストの名前は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS.CertificateNames</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトNetXMS_CertNames.ps1：</font></font><br>
 <br>
<pre><code class="powershell hljs"><span class="hljs-comment">#   </span>
<span class="hljs-variable">$nameTypeList</span> = <span class="hljs-selector-tag">@</span>(<font></font>
        [<span class="hljs-type">System.Security.Cryptography.X509Certificates.X509NameType</span>]::SimpleName,<font></font>
        [<span class="hljs-type">System.Security.Cryptography.X509Certificates.X509NameType</span>]::DnsName,<font></font>
        [<span class="hljs-type">System.Security.Cryptography.X509Certificates.X509NameType</span>]::DnsFromAlternativeName,<font></font>
        [<span class="hljs-type">System.Security.Cryptography.X509Certificates.X509NameType</span>]::UrlName,<font></font>
        [<span class="hljs-type">System.Security.Cryptography.X509Certificates.X509NameType</span>]::EmailName,<font></font>
        [<span class="hljs-type">System.Security.Cryptography.X509Certificates.X509NameType</span>]::UpnName<font></font>
)<font></font>
 <font></font>
<span class="hljs-comment">#  ,   </span>
<span class="hljs-variable">$certList</span> = <span class="hljs-selector-tag">@</span>( <span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">'Cert:\LocalMachine\My'</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span>.HasPrivateKey <span class="hljs-operator">-eq</span> <span class="hljs-variable">$true</span> } )<font></font>
 <font></font>
<span class="hljs-comment">#   ,   "  -  - Thumbprint"   </span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$cert</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$certList</span>) {
    <span class="hljs-variable">$name</span> = <span class="hljs-string">'(unknown name)'</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable">$thumbprint</span> = <span class="hljs-variable">$cert</span>.Thumbprint
        <span class="hljs-variable">$dateExpire</span> = <span class="hljs-variable">$cert</span>.NotAfter
        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$nameType</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$nameTypeList</span>) {
            <span class="hljs-variable">$name_temp</span> = <span class="hljs-variable">$cert</span>.GetNameInfo( <span class="hljs-variable">$nameType</span>, <span class="hljs-variable">$false</span>)
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$name_temp</span> <span class="hljs-operator">-ne</span> <span class="hljs-variable">$null</span> <span class="hljs-operator">-and</span> <span class="hljs-variable">$name_temp</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">''</span>) {
                <span class="hljs-variable">$name</span> = <span class="hljs-variable">$name_temp</span>;
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-built_in">Write-Output</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$name</span>) - <span class="hljs-variable">$</span>(<span class="hljs-variable">$dateExpire</span>.ToString('dd.MM.yyyy')) - [T:<span class="hljs-variable">$</span>(<span class="hljs-variable">$thumbprint</span>)]"</span><font></font>
    }<font></font>
    <span class="hljs-keyword">catch</span> {
        <span class="hljs-built_in">Write-Error</span> <span class="hljs-literal">-Message</span> <span class="hljs-string">"Error processing certificate list: <span class="hljs-variable">$</span>(<span class="hljs-variable">$_</span>.Exception.Message)"</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、すでに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExternalParameter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、ExternalListリストから行をフィードし、出力でそれぞれに同じ日数を取得します。</font><font style="vertical-align: inherit;">識別子は拇印証明書です。</font><font style="vertical-align: inherit;">このオプションのHTTPS.CertificateExpireDateにはアスタリスク（*）が含まれていることに注意してください。</font><font style="vertical-align: inherit;">これは、CertificateIdだけの外部変数を受け入れるために必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スクリプトNetXMS_CertExpireDate.ps1：</font></font><br>
 <br>
<pre><code class="powershell hljs"><span class="hljs-comment">#   $CertificateId</span>
<span class="hljs-keyword">param</span> (<font></font>
    [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>=<span class="hljs-variable">$false</span>)]<font></font>
    [<span class="hljs-built_in">String</span>]<span class="hljs-variable">$CertificateId</span><font></font>
)<font></font>
 <font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$CertificateId</span> <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span>) {
    <span class="hljs-built_in">Write-Error</span> <span class="hljs-literal">-Message</span> <span class="hljs-string">"CertificateID parameter is required!"</span>
    <span class="hljs-keyword">return</span><font></font>
}<font></font>
 <font></font>
<span class="hljs-comment"># Thumbprint    $CertificateId      Expiration Date </span>
<span class="hljs-variable">$certId</span> = <span class="hljs-variable">$CertificateId</span>;
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$certId</span> <span class="hljs-operator">-match</span> <span class="hljs-string">'^.*\[T:(?&lt;Thumbprint&gt;[A-Z0-9]+)\]$'</span>) {
        <span class="hljs-variable">$thumbprint</span> = <span class="hljs-variable">$Matches</span>[<span class="hljs-string">'Thumbprint'</span>]
        <span class="hljs-variable">$certificatePath</span> = <span class="hljs-string">"Cert:\LocalMachine\My\<span class="hljs-variable">$</span>(<span class="hljs-variable">$thumbprint</span>)"</span><font></font>
         <font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Test-Path</span> <span class="hljs-literal">-PathType</span> Leaf <span class="hljs-literal">-Path</span> <span class="hljs-variable">$certificatePath</span> ) {
            <span class="hljs-variable">$certificate</span> = <span class="hljs-built_in">Get-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$certificatePath</span>;
            <span class="hljs-variable">$certificateExpirationDate</span> = <span class="hljs-variable">$certificate</span>.NotAfter
            <span class="hljs-variable">$certificateDayToLive</span> = [<span class="hljs-type">Math</span>]::Floor( (<span class="hljs-variable">$certificateExpirationDate</span> - [<span class="hljs-built_in">DateTime</span>]::Now).TotalDays )
            <span class="hljs-built_in">Write-Output</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$certificateDayToLive</span>)"</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">Write-Error</span> <span class="hljs-literal">-Message</span> <span class="hljs-string">"No certificate matching this thumbprint found on this server <span class="hljs-variable">$</span>(<span class="hljs-variable">$certId</span>)"</span><font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">Write-Error</span> <span class="hljs-literal">-Message</span> <span class="hljs-string">"CertificateID provided in wrong format. Must be FriendlyName [T:&lt;thumbprint&gt;]"</span><font></font>
    }<font></font>
}<font></font>
<span class="hljs-keyword">catch</span> {
    <span class="hljs-built_in">Write-Error</span> <span class="hljs-literal">-Message</span> <span class="hljs-string">"Error while executing script: <span class="hljs-variable">$</span>(<span class="hljs-variable">$_</span>.Exception.Message)"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data Collectionサーバー構成で、新しいパラメーターを作成します。 [パラメーター]で</font><font style="vertical-align: inherit;">、リストから</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS.CertificateExpireDate（*）を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択し</font><font style="vertical-align: inherit;">、（注意！）アスタリスクを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{instance}に</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更します</font><font style="vertical-align: inherit;">。この重要なポイントにより、インスタンス（証明書）ごとに個別のカウンターを作成できます。残りは前のバージョンと同様に入力さ</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iz/js/yw/izjsywknmc_7lrph5axbulycbx4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
れます。作成元のカウンターを作成するには、[インスタンスの検出]タブで、リストから[エージェントリスト]を選択し、[リスト名]フィールドにスクリプトからの外部リストの名前を入力します-HTTPS.CertificateNames。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほぼ待機中の場合は、少し待つか、ポーリングが完全に待機できない場合は、ポーリング&gt;構成およびポーリング&gt;インスタンスの検出を強制します。その結果、有効期限付きのすべての証明書が取得されます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="元の画像を表示" rel="nofollow"><img src="https://habrastorage.org/webt/4i/6g/rb/4i6grbiuzscvt_9jsr7oo8vlr10.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要とされていること？ええ、はい、完璧主義のワームだけがカウンターの名前でこの不必要な拇印を悲しそうな目で見ており、記事を完成させることはできません。彼にフィードするには、カウンターのプロパティを再度開き、[インスタンスの検出フィルタースクリプト]フィールドの[インスタンスの検出]タブで、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NXSL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">NetXMS</font></a><font style="vertical-align: inherit;">内部言語）で</font><font style="vertical-align: inherit;">記述されたスクリプトを追加します</font><font style="vertical-align: inherit;">。</font></font><br>
 <br>
<pre><code class="javascript hljs">instance = $<span class="hljs-number">1</span>;
 <span class="hljs-keyword">if</span> (instance ~= <span class="hljs-string">"^(.*)\s\-\s\[T\:[a-zA-Z0-9]+\]$"</span>)<font></font>
 {<font></font>
 <span class="hljs-keyword">return</span> %(<span class="hljs-literal">true</span>, instance, $<span class="hljs-number">1</span>);<font></font>
 }<font></font>
 <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：これは、拇印をフィルタリングします</font></font><br>
<br>
<img src="https://habrastorage.org/webt/79/js/hr/79jshrqquu9hvwmkyxppz1tmr_k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
と、{インスタンス}：説明フィールド、変更CertificateExpireDateで[全般]タブで、濾過し、それを表示するために</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CertificateExpireDate：{インスタンス名}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lb/wt/t_/lbwtt_qjjy-91-nduegszqkfyze.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて、ついにからフィニッシュ</font></font><abbr title="注意を引く絵"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KDPV</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
美容、その後？</font><font style="vertical-align: inherit;">
証明書の論理的な有効期限が切れたときに通知がメールで届くように通知を構成する必要があります。</font><font style="vertical-align: inherit;">
1.最初に、カウンター値を設定したしきい値まで下げるときに、イベントテンプレートを作成してアクティブにする必要があります。で</font><b><font style="vertical-align: inherit;">イベント設定、</font></b><font style="vertical-align: inherit;">言って、名前を持つ2つの新しいテンプレートを作成</font><b><font style="vertical-align: inherit;">CertificateExpireDate_Threshold_Activateを</font></b><font style="vertical-align: inherit;">警告ステータスで：</font><font style="vertical-align: inherit;">
と同様の</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="元の画像を表示" rel="nofollow"><img src="https://habrastorage.org/webt/jy/gw/ce/jygwce-b5rghps1aojzw7piqkhk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/rh/nc/se/rhncseix1uuw3agz4ioeyx3d02u.png"><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステータスがNormalの</font><b><font style="vertical-align: inherit;">CertificateExpireDate_Threshold_Deactivate</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.次に、カウンターのプロパティに移動し、[Tresholds]タブでしきい値を設定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/tm/6y/zutm6yv1byvr5kuzbvhbegm7hro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、作成したイベントCertificateExpireDate_Threshold_ActivateおよびCertificateExpireDate_Threshold_Deactivateを選択し、測定数（サンプル）1を設定します（このカウンターをより具体的に設定しても意味がありません）。値は、たとえば30（日）です。 、そして重要なことに、イベントの繰り返し時間を設定します。本番環境の証明書の場合、私は1日に1回（86400秒）設定しました。デバッグの場合、たとえば60秒以下に設定するのが理にかなっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクション構成</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のような通知レターのテンプレートを作成します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3i/a1/z8/3ia1z8vqbnn260wcs0cqvfx6s0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべて％m、％Sなど。 -パラメータの値が代入されるマクロ。これらについては、</font><font style="vertical-align: inherit;">NetXMS </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニュアルで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詳しく説明して</font><font style="vertical-align: inherit;">い</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.最後に、前のポイントを組み合わせて、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント処理ポリシー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、アラームを作成してメッセージを送信するルールを作成します</font><font style="vertical-align: inherit;">
。ポリシー</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">保存すると、すべてをテストできます。検証のためにしきい値を高く設定します。私の最も近い証明書は723日で期限が切れます。検証用に724を設定しました。その結果、次のような</font><font style="vertical-align: inherit;">
警告が表示されます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" title="元の画像を表示" rel="nofollow"><img src="https://habrastorage.org/webt/dg/yw/3b/dgyw3bg6yk1iqbogvunteln3sek.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/56/z_/vu56z_zmsfu2g5jz2yqi9l8zf6i.png"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/vy/a8/zzvya8x9qqdaaqwdjkrzjyuhu1m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これですべてです。</font><font style="vertical-align: inherit;">もちろん、ダッシュボードを設定してグラフを作成することもできますが、証明書の場合は、たとえばCPUやメモリの負荷のグラフとは異なり、意味がなく退屈な直線になります。</font><font style="vertical-align: inherit;">しかし、それについてどういうわけか別の時に。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460179/index.html">LEAN + AGILE = AGILEANまたは全体を部分的に収集</a></li>
<li><a href="../ja460181/index.html">ソースコードを解析してJavaScriptの知識を向上させる</a></li>
<li><a href="../ja460185/index.html">オンラインサービス「事故別速報動画」</a></li>
<li><a href="../ja460187/index.html">データを収集する前に想像してみてください。</a></li>
<li><a href="../ja460191/index.html">ラインを停止するか、パイプラインをポンプで送ります。</a></li>
<li><a href="../ja460195/index.html">小さく、はい、削除：ミニチュア線形粒子加速器、新しい記録を樹立</a></li>
<li><a href="../ja460197/index.html">現代の子供の技術クラブVSソビエトスーツ</a></li>
<li><a href="../ja460205/index.html">PKCS＃12コンテナーに基づく暗号化ワークステーション。電子署名CadES-X Long Type 1の作成。パート3</a></li>
<li><a href="../ja460207/index.html">Linux管理者がUbuntu 16.04で音楽認識システムを使用して児童合唱団を管理した方法。マイクとコード</a></li>
<li><a href="../ja460211/index.html">Intel Pohoiki Beach-800万のニューロンを持つニューロモーフィックシステム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>