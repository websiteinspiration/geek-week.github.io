<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🎤 🆖 👍🏾 Funktionsoptionen für Steroide 🥫 🎻 🤞🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Ich präsentiere Ihnen die Übersetzung des Artikels Funktionsoptionen für Steroide von Márk Sági-Kazár . 
 
 
 
 Funktionsoptionen sind Go'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Funktionsoptionen für Steroide</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489296/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! </font><font style="vertical-align: inherit;">Ich präsentiere Ihnen die Übersetzung des Artikels </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funktionsoptionen für Steroide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Márk Sági-Kazár</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/tg/q_/netgq_6sygojlguqfqahr_k_hh0.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funktionsoptionen sind Go's Paradigma für saubere und erweiterbare APIs. </font><font style="vertical-align: inherit;">Sie wird von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dave Cheney</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rob Pike</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> populär gemacht </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In diesem Beitrag geht es um Praktiken, die die Vorlage seit ihrer Einführung betreffen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurden funktionale Optionen entwickelt, um gute und saubere APIs mit einer Konfiguration zu erstellen, die optionale Parameter enthält. </font><font style="vertical-align: inherit;">Es gibt viele offensichtliche Möglichkeiten, dies zu tun (Konstruktor, Konfigurationsstruktur, Setter usw.), aber wenn Sie Dutzende von Optionen übergeben müssen, werden diese schlecht gelesen und bieten keine so guten APIs wie funktionale Optionen.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung - Was sind funktionale Optionen?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie ein „Objekt“ erstellen, rufen Sie normalerweise den Konstruktor mit den erforderlichen Argumenten auf:</font></font><br>
<br>
<pre><code class="go hljs">obj := New(arg1, arg2)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Ignorieren wir die Tatsache, dass es in Go keine herkömmlichen Konstruktoren gibt.) Mit den</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Funktionsoptionen können Sie die API um zusätzliche Parameter erweitern und die obige Zeile wie folgt umwandeln:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// I can still do this...</span><font></font>
obj := New(arg1, arg2)<font></font>
<font></font>
<span class="hljs-comment">// ...but this works too</span>
obj := New(arg1, arg2, myOption1, myOption2)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funktionsoptionen sind im Grunde Argumente einer variablen Funktion, die als Parameter einen zusammengesetzten oder Zwischenkonfigurationstyp verwendet. </font><font style="vertical-align: inherit;">Aufgrund seiner variablen Natur ist es durchaus akzeptabel, den Konstruktor ohne Optionen aufzurufen und ihn sauber zu halten, selbst wenn Sie die Standardwerte verwenden möchten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns zur besseren Veranschaulichung des Musters ein realistisches Beispiel an (ohne funktionale Optionen):</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {<font></font>
    addr <span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// NewServer initializes a new Server listening on addr.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">Server</span></span> {
    <span class="hljs-keyword">return</span> &amp;Server {<font></font>
        addr: addr,<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Hinzufügen der Timeout-Option sieht der Code folgendermaßen aus:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {<font></font>
    addr <span class="hljs-keyword">string</span><font></font>
<font></font>
    <span class="hljs-comment">// default: no timeout</span><font></font>
    timeout time.Duration<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Timeout configures a maximum length of idle connection in Server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Timeout</span><span class="hljs-params">(timeout time.Duration)</span> <span class="hljs-title">func</span><span class="hljs-params">(*Server)</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.timeout = timeout<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// NewServer initializes a new Server listening on addr with optional configuration.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(*Server)</span>) *<span class="hljs-title">Server</span></span> {<font></font>
    server := &amp;Server {<font></font>
        addr: addr,<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// apply the list of options to Server</span>
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
        opt(server)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> server<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die resultierende API ist einfach zu verwenden und leicht zu lesen:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// no optional paramters, use defaults</span>
server := NewServer(<span class="hljs-string">":8080"</span>)<font></font>
<font></font>
<span class="hljs-comment">// configure a timeout in addition to the address</span>
server := NewServer(<span class="hljs-string">":8080"</span>, Timeout(<span class="hljs-number">10</span> * time.Second))<font></font>
<font></font>
<span class="hljs-comment">// configure a timeout and TLS in addition to the address</span>
server := NewServer(<span class="hljs-string">":8080"</span>, Timeout(<span class="hljs-number">10</span> * time.Second), TLS(&amp;TLSConfig{}))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Vergleich sehen Sie hier, wie die Initialisierung mit dem Konstruktor und der Konfigurationskonfigurationsstruktur aussieht:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// constructor variants</span>
server := NewServer(<span class="hljs-string">":8080"</span>)<font></font>
server := NewServerWithTimeout(<span class="hljs-string">":8080"</span>, <span class="hljs-number">10</span> * time.Second)<font></font>
server := NewServerWithTimeoutAndTLS(<span class="hljs-string">":8080"</span>, <span class="hljs-number">10</span> * time.Second, &amp;TLSConfig{})<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// config struct</span>
server := NewServer(<span class="hljs-string">":8080"</span>, Config{})<font></font>
server := NewServer(<span class="hljs-string">":8080"</span>, Config{ Timeout: <span class="hljs-number">10</span> * time.Second })<font></font>
server := NewServer(<span class="hljs-string">":8080"</span>, Config{ Timeout: <span class="hljs-number">10</span> * time.Second, TLS: &amp;TLSConfig{} })</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Vorteil der Verwendung von Funktionsoptionen gegenüber dem Konstruktor liegt wahrscheinlich auf der Hand: Sie sind einfacher zu warten und zu lesen / schreiben. </font><font style="vertical-align: inherit;">Funktionsparameter überschreiten auch die Konfigurationsstruktur, wenn Parameter nicht an den Konstruktor übergeben werden. </font><font style="vertical-align: inherit;">In den folgenden Abschnitten werde ich noch weitere Beispiele zeigen, bei denen die Konfigurationsstruktur möglicherweise nicht den Erwartungen entspricht. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie den vollständigen Verlauf der Funktionsoptionen, indem Sie auf die Links in der Einführung klicken. </font><font style="vertical-align: inherit;">(Anmerkung des Übersetzers - Ein Blog mit einem Originalartikel von Dave Cheney ist in Russland nicht immer verfügbar, und Sie müssen möglicherweise eine Verbindung über VPN herstellen, um ihn anzuzeigen. Informationen aus dem Artikel finden Sie auch im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video seines Berichts über dotGo 2014.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Praktiken für funktionale Optionen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funktionsoptionen selbst sind nichts anderes als Funktionen, die an den Konstruktor übergeben werden. </font><font style="vertical-align: inherit;">Die einfache Verwendung einfacher Funktionen bietet Flexibilität und großes Potenzial. </font><font style="vertical-align: inherit;">Daher ist es nicht verwunderlich, dass im Laufe der Jahre viele Praktiken rund um die Vorlage aufgetaucht sind. </font><font style="vertical-align: inherit;">Im Folgenden werde ich eine Liste der meiner Meinung nach beliebtesten und nützlichsten Praktiken bereitstellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schicken Sie mir eine E-Mail, wenn Sie der Meinung sind, dass etwas fehlt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Art der Optionen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die Vorlage für Funktionsoptionen anwenden, können Sie zunächst den Typ für die optionale Funktion festlegen:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Option configures a Server.</span>
<span class="hljs-keyword">type</span> Option <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl dies keine große Verbesserung zu sein scheint, wird der Code besser lesbar, indem ein Typname verwendet wird, anstatt eine Funktion zu definieren:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Timeout</span><span class="hljs-params">(timeout time.Duration)</span> <span class="hljs-title">func</span><span class="hljs-params">(*Server)</span></span> { <span class="hljs-comment">/*...*/</span> }<font></font>
<font></font>
<span class="hljs-comment">// reads: a new server accepts an address</span>
<span class="hljs-comment">//      and a set of functions that accepts the server itself</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(s *Server)</span>) *<span class="hljs-title">Server</span></span><font></font>
<font></font>
<span class="hljs-comment">// VS</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Timeout</span><span class="hljs-params">(timeout time.Duration)</span> <span class="hljs-title">Option</span></span> { <span class="hljs-comment">/*...*/</span> }<font></font>
<font></font>
<span class="hljs-comment">// reads: a new server accepts an address and a set of options</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...Option)</span> *<span class="hljs-title">Server</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer Vorteil eines Optionstyps besteht darin, dass Godoc Optionsfunktionen unter dem Typ platziert:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ng/7j/cw/ng7jcwf-ayhf9tfblay4-dl7_ck.png" alt="Bild"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optionstypliste</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Regel werden Funktionsparameter verwendet, um eine einzelne Instanz von etwas zu erstellen. Dies ist jedoch nicht immer der Fall. </font><font style="vertical-align: inherit;">Die Wiederverwendung der Standardparameterliste beim Erstellen mehrerer Instanzen ist ebenfalls keine Seltenheit:</font></font><br>
<br>
<pre><code class="go hljs">defaultOptions := []Option{Timeout(<span class="hljs-number">5</span> * time.Second)}<font></font>
<font></font>
server1 := NewServer(<span class="hljs-string">":8080"</span>, <span class="hljs-built_in">append</span>(defaultOptions, MaxConnections(<span class="hljs-number">10</span>))...)<font></font>
<font></font>
server2 := NewServer(<span class="hljs-string">":8080"</span>, <span class="hljs-built_in">append</span>(defaultOptions, RateLimit(<span class="hljs-number">10</span>, time.Minute))...)<font></font>
<font></font>
server3 := NewServer(<span class="hljs-string">":8080"</span>, <span class="hljs-built_in">append</span>(defaultOptions, Timeout(<span class="hljs-number">10</span> * time.Second))...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist kein sehr lesbarer Code, insbesondere wenn man bedenkt, dass der Sinn der Verwendung von Funktionsoptionen darin besteht, benutzerfreundliche APIs zu erstellen. </font><font style="vertical-align: inherit;">Glücklicherweise gibt es eine Möglichkeit, dies zu vereinfachen. </font><font style="vertical-align: inherit;">Wir müssen nur die Option [] direkt mit der Option aufteilen:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Options turns a list of Option instances into an Option.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Options</span><span class="hljs-params">(opts ...Option)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {
        <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
            opt(s)<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Ersetzen des Slice durch die Options-Option lautet der obige Code:</font></font><br>
<br>
<pre><code class="go hljs">defaultOptions := Options(Timeout(<span class="hljs-number">5</span> * time.Second))<font></font>
<font></font>
server1 := NewServer(<span class="hljs-string">":8080"</span>, defaultOptions, MaxConnections(<span class="hljs-number">10</span>))<font></font>
<font></font>
server2 := NewServer(<span class="hljs-string">":8080"</span>, defaultOptions, RateLimit(<span class="hljs-number">10</span>, time.Minute))<font></font>
<font></font>
server3 := NewServer(<span class="hljs-string">":8080"</span>, defaultOptions, Timeout(<span class="hljs-number">10</span> * time.Second))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Präfixe der With / Set-Optionen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Optionen sind häufig komplexe Typen, im Gegensatz zu einer Zeitüberschreitung oder einer maximalen Anzahl von Verbindungen. </font><font style="vertical-align: inherit;">Im Serverpaket können Sie beispielsweise die Logger-Schnittstelle als Option definieren (und verwenden, wenn kein Standardlogger vorhanden ist):</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Logger <span class="hljs-keyword">interface</span> {<font></font>
    Info(msg <span class="hljs-keyword">string</span>)<font></font>
    Error(msg <span class="hljs-keyword">string</span>)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Offensichtlich kann der Logger-Name nicht als Optionsname verwendet werden, da er bereits von der Schnittstelle verwendet wird. </font><font style="vertical-align: inherit;">Sie können die Option LoggerOption aufrufen, aber es ist kein sehr freundlicher Name. </font><font style="vertical-align: inherit;">Wenn Sie den Konstruktor als Satz betrachten, fällt Ihnen in unserem Fall das Wort mit: WithLogger ein.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithLogger</span><span class="hljs-params">(logger Logger)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.logger = logger<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// reads: create a new server that listens on :8080 with a logger</span>
NewServer(<span class="hljs-string">":8080"</span>, WithLogger(logger))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiteres häufiges Beispiel für eine komplexe Typoption ist ein Werteschnitt:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// ...</span><font></font>
<font></font>
    whitelistIPs []<span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithWhitelistedIP</span><span class="hljs-params">(ip <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.whitelistIPs = <span class="hljs-built_in">append</span>(s.whitelistIPs, ip)<font></font>
    }<font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithWhitelistedIP(<span class="hljs-string">"10.0.0.0/8"</span>), WithWhitelistedIP(<span class="hljs-string">"172.16.0.0/12"</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall hängt die Option die Werte normalerweise an vorhandene an, anstatt sie zu überschreiben. </font><font style="vertical-align: inherit;">Wenn Sie einen vorhandenen Wertesatz überschreiben müssen, können Sie den Wortsatz im Optionsnamen verwenden:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SetWhitelistedIP</span><span class="hljs-params">(ip <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.whitelistIPs = []<span class="hljs-keyword">string</span>{ip}<font></font>
    }<font></font>
}<font></font>
<font></font>
NewServer(<font></font>
    <span class="hljs-string">":8080"</span>,<font></font>
    WithWhitelistedIP(<span class="hljs-string">"10.0.0.0/8"</span>),<font></font>
    WithWhitelistedIP(<span class="hljs-string">"172.16.0.0/12"</span>),<font></font>
    SetWhitelistedIP(<span class="hljs-string">"192.168.0.0/16"</span>), <span class="hljs-comment">// overwrites any previous values</span>
)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voreingestellte Vorlage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spezielle Anwendungsfälle sind normalerweise universell genug, um sie in der Bibliothek zu unterstützen. </font><font style="vertical-align: inherit;">Im Fall einer Konfiguration kann dies eine Reihe von Parametern bedeuten, die zusammengefasst und als Voreinstellung für die Verwendung verwendet werden. </font><font style="vertical-align: inherit;">In unserem Beispiel kann der Server über offene und interne Nutzungsszenarien verfügen, in denen Zeitüberschreitungen, Geschwindigkeitsbegrenzungen, Anzahl der Verbindungen usw. auf unterschiedliche Weise festgelegt werden.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// PublicPreset configures a Server for public usage.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PublicPreset</span><span class="hljs-params">()</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> Options(<font></font>
        WithTimeout(<span class="hljs-number">10</span> * time.Second),<font></font>
        MaxConnections(<span class="hljs-number">10</span>),<font></font>
    )<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// InternalPreset configures a Server for internal usage.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InternalPreset</span><span class="hljs-params">()</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> Options(<font></font>
        WithTimeout(<span class="hljs-number">20</span> * time.Second),<font></font>
        WithWhitelistedIP(<span class="hljs-string">"10.0.0.0/8"</span>),<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl Voreinstellungen in einigen Fällen nützlich sein können, sind sie in internen Bibliotheken wahrscheinlich von großem Wert, und in öffentlichen Bibliotheken ist ihr Wert geringer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standardtypwerte im Vergleich zu voreingestellten Standardwerten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go hat immer Standardwerte. Für Zahlen ist dies normalerweise Null, für Boolesche Typen ist es falsch und so weiter. In einer optionalen Konfiguration wird empfohlen, sich auf die Standardwerte zu verlassen. Zum Beispiel sollte ein Nullwert eine unbegrenzte Zeitüberschreitung anstelle seiner Abwesenheit bedeuten (was normalerweise bedeutungslos ist). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einigen Fällen ist der Standardtypwert kein guter Standardwert. Der Standardwert für Logger ist beispielsweise Null, was zu Panik führen kann (wenn Sie die Logger-Aufrufe nicht durch bedingte Überprüfungen schützen). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesen Fällen ist das Festlegen des Werts im Konstruktor (vor dem Anwenden der Parameter) eine gute Möglichkeit, den Fallback zu bestimmen:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(*Server)</span>) *<span class="hljs-title">Server</span></span> {<font></font>
    server := &amp;Server {<font></font>
        addr:   addr,<font></font>
        logger: noopLogger{},<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// apply the list of options to Server</span>
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
        opt(server)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> server<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe Beispiele mit Standardvoreinstellungen gesehen (unter Verwendung der im vorherigen Abschnitt beschriebenen Vorlage). </font><font style="vertical-align: inherit;">Ich halte dies jedoch nicht für eine gute Praxis. </font><font style="vertical-align: inherit;">Dies ist viel weniger aussagekräftig als nur das Festlegen von Standardwerten im Konstruktor:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(*Server)</span>) *<span class="hljs-title">Server</span></span> {<font></font>
    server := &amp;Server {<font></font>
        addr:   addr,<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// what are the defaults?</span>
    opts = <span class="hljs-built_in">append</span>([]Option{DefaultPreset()}, opts...)<font></font>
<font></font>
    <span class="hljs-comment">// apply the list of options to Server</span>
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
        opt(server)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> server<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurationsstrukturoption</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Konfigurationsstruktur als funktionale Option zu haben, ist wahrscheinlich nicht so häufig, aber dies wird manchmal gefunden. </font><font style="vertical-align: inherit;">Die Idee ist, dass sich die Funktionsoptionen auf die Konfigurationsstruktur beziehen, anstatt auf das tatsächlich erstellte Objekt:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {<font></font>
    Timeout time.Duration<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> Option <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Config)</span></span><font></font>
<font></font>
<span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// ...</span><font></font>
<font></font>
    config Config<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Vorlage ist nützlich, wenn Sie viele Optionen haben und das Erstellen einer Konfigurationsstruktur sauberer erscheint als das Auflisten aller Optionen in einem Funktionsaufruf:</font></font><br>
<br>
<pre><code class="go hljs">config := Config{<font></font>
    Timeout: <span class="hljs-number">10</span> * time.Second
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// lots of other options</span><font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithConfig(config))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer Anwendungsfall für diese Vorlage ist das Festlegen von Standardwerten:</font></font><br>
<br>
<pre><code class="go hljs">config := Config{<font></font>
    Timeout: <span class="hljs-number">10</span> * time.Second
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// lots of other options</span><font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithConfig(config), WithTimeout(<span class="hljs-number">20</span> * time.Second))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweiterte Vorlagen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie Dutzende von Funktionsoptionen geschrieben haben, fragen Sie sich möglicherweise, ob es einen besseren Weg gibt, dies zu tun. </font><font style="vertical-align: inherit;">Nicht in Bezug auf die Nutzung, sondern in Bezug auf die langfristige Unterstützung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wäre zum Beispiel, wenn wir Typen definieren und als Parameter verwenden könnten:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Timeout time.Duration<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, Timeout(time.Minute))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Beachten Sie, dass die Verwendung der API gleich bleibt.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass wir durch Ändern des Optionstyps auf einfache Weise Folgendes tun können:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Option configures a Server.</span>
<span class="hljs-keyword">type</span> Option <span class="hljs-keyword">interface</span> {
    <span class="hljs-comment">// apply is unexported,</span>
    <span class="hljs-comment">// so only the current package can implement this interface.</span><font></font>
    apply(s *Server)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Überschreiben einer optionalen Funktion als Schnittstelle eröffnet eine Reihe neuer Möglichkeiten zur Implementierung von Funktionsoptionen: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verschiedene integrierte Typen können als Parameter ohne Wrapper-Funktion verwendet werden:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Timeout configures a maximum length of idle connection in Server.</span>
<span class="hljs-keyword">type</span> Timeout time.Duration<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Timeout)</span> <span class="hljs-title">apply</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
    s.timeout = time.Duration(t)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listen von Optionen und Konfigurationsstrukturen (siehe vorherige Abschnitte) können auch wie folgt neu definiert werden:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Options turns a list of Option instances into an Option.</span>
<span class="hljs-keyword">type</span> Options []Option<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o Options)</span> <span class="hljs-title">apply</span><span class="hljs-params">(s *Server)</span></span> {
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> o {<font></font>
        o.apply(s)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {<font></font>
    Timeout time.Duration<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c Config)</span> <span class="hljs-title">apply</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
    s.config = c<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein persönlicher Favorit ist die Möglichkeit, die Option in mehreren Konstruktoren wiederzuverwenden:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// ServerOption configures a Server.</span>
<span class="hljs-keyword">type</span> ServerOption <span class="hljs-keyword">interface</span> {<font></font>
    applyServer(s *Server)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ClientOption configures a Client.</span>
<span class="hljs-keyword">type</span> ClientOption <span class="hljs-keyword">interface</span> {<font></font>
    applyClient(c *Client)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Option configures a Server or a Client.</span>
<span class="hljs-keyword">type</span> Option <span class="hljs-keyword">interface</span> {<font></font>
    ServerOption<font></font>
    ClientOption<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithLogger</span><span class="hljs-params">(logger Logger)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> withLogger{logger}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> withLogger <span class="hljs-keyword">struct</span> {<font></font>
    logger Logger<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o withLogger)</span> <span class="hljs-title">applyServer</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
    s.logger = o.logger<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o withLogger)</span> <span class="hljs-title">applyClient</span><span class="hljs-params">(c *Client)</span></span> {<font></font>
    c.logger = o.logger<font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithLogger(logger))<font></font>
NewClient(<span class="hljs-string">"http://localhost:8080"</span>, WithLogger(logger))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funktionsparameter sind eine leistungsstarke Vorlage zum Erstellen sauberer und erweiterbarer APIs mit Dutzenden von Parametern. </font><font style="vertical-align: inherit;">Dies ist zwar etwas mehr Arbeit als die Unterstützung einer einfachen Konfigurationsstruktur, bietet jedoch viel mehr Flexibilität und viel sauberere APIs als Alternativen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489282/index.html">DirectX 12 - Von Leonardo da Vinci zur zeitgenössischen Kunst</a></li>
<li><a href="../de489284/index.html">Meine Lieblings-Chrome-Entwicklertools</a></li>
<li><a href="../de489286/index.html">Slips, Socken und Rasierpinsel: Anti-Rating von Geschenken am 23. Februar</a></li>
<li><a href="../de489290/index.html">"Work in IT - 2020" oder Wer und für was wir lieben</a></li>
<li><a href="../de489294/index.html">Lernen von CSS-Variablen anhand eines praktischen Beispiels</a></li>
<li><a href="../de489298/index.html">Ein informelles Interview mit Maria Dolgusheva (HR aus dem Silicon Valley)</a></li>
<li><a href="../de489302/index.html">Problem Nr. 31: IT-Schulung - aktuelle Probleme und Herausforderungen führender Unternehmen</a></li>
<li><a href="../de489304/index.html">ChIP-seq-Datenanalyse: von Histonen zu Computeraufgaben</a></li>
<li><a href="../de489306/index.html">[Habr]: Donuts</a></li>
<li><a href="../de489310/index.html">Top 10: die besten Berichte von Heisenbug 2019 Moskau</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>