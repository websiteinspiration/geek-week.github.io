<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüîß üöå üåπ Trimming Threads: Migrating from Puppet Enterprise to Ansible Tower. Part 1 üë©üèæ‚Äçüåæ üôâ üö¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The National Environmental Satellite Information Service (NESDIS) has reduced its Red Hat Enterprise Linux (RHEL) configuration management costs by 35...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Trimming Threads: Migrating from Puppet Enterprise to Ansible Tower. Part 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/500400/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The National Environmental Satellite Information Service (NESDIS) has reduced its Red Hat Enterprise Linux (RHEL) configuration management costs by 35% by moving from Puppet Enterprise to Ansible Tower. </font><font style="vertical-align: inherit;">In this video of the ‚Äúhow we did it‚Äù category, system engineer Michael Rau substantiates the implementation of this migration, shares useful tips and experience gained as a result of the transition from one SCM to another. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From this video you will learn:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to justify management the feasibility of moving from Puppet Enterprise to Ansible Tower;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">what strategies to use for the smoothest transition;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tips for transcoding PE manifests in Ansible Playbook;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Best practices for installing Ansible Tower.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/il/x5/_s/ilx5_sfom5yddgi9ib92bngs_qs.jpeg"><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Greetings to all, my name is Michael Rau, I am a senior systems engineer at ActioNet, which works for the NESDIS National Oceanic and Atmospheric Administration (NOAA). Today we‚Äôll talk about line trimming ‚Äî my own experience migrating from Puppet Enterprise to Ansible Tower. The theme of this presentation is to ‚Äúlook at my scars‚Äù left after I made this transition at the beginning of the year. I want to tell what I learned during this process. So when you do this, using my experience, you can make the transition without too much difficulty.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You see slides similar to this at the beginning of every presentation at Ansible Fest. This slide shows the history of my company‚Äôs automation. I am not new to this business because I have been using Puppet / Puppet Enterprise since 2007. I started working with Ansible in 2016, and I, like many other users of this product, was attracted by the possibility of ‚Äútricks‚Äù using the command line and simple scripts (playbooks). At the end of 2017, I turned to my leadership about the good reasons for moving to Ansible Tower. In a minute I will talk about the reasons that prompted me to take this step. After obtaining the consent of the management, it took several more months to fulfill the plan, and I made the transition in January-February of this year. So, we completely abandoned Puppet in favor of Ansible, and this is a great thing.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s6/nx/q0/s6nxq03epm0ijbadvufk813frw4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What attracts me most to Ansible is the ability to write and use roles and scripts (playbooks). Roles are great for creating different, but interrelated tasks (tasks) and placing all the data related to these tasks in one place. Playbook is YAML syntax, a script file that describes actions for one or more hosts. I talk about these features to users, primarily software developers. Ansible Tower makes it possible to say: "No, you do not have access to shell access, but I give you the opportunity to start all Tower processes and restart the service when you need it." I will tell you about the working environment and the equipment we use.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s2/7x/ee/s27xeejr86013vqsinb1pm4jzc4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a federal LAN, 7 physical sites connected via cloud-based MPLS, 140 RHEL servers, 99% of which are virtual (vSphere), SuperMicro hardware, NexentaStore NAS, a set of Cisco, Arista and Cumulus switches and Fortinet UTM unified threat management tools on each site .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The federal network means that I must use all means of information protection provided for by legislative acts. You should keep in mind that Puppet Enterprise does not support most of the equipment we use. We are forced to use budget hardware because government agencies are having problems financing this item of expenditure. Therefore, we buy SuperMicro class hardware and assemble our equipment from individual parts, the maintenance of which is guaranteed by government contracts. We use Linux, and this is one of the important reasons for switching to Ansible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our history with Puppet is this.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5a/c0/tb/5ac0tbxla5h2wfv1d6lznhkhzcw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2007, we had a small network of 20-25 nodes, in which we deployed Puppet. Basically, these nodes were just ‚Äúboxes‚Äù of RedHat. In 2010, we started using the Puppet Dashboard web interface for 45 nodes. As the network continued to expand, in 2014 we switched to PE 3.3, making a complete transition with rewriting the manifest for 75 nodes. This had to be done because Puppet likes to change the rules of the game, and in this case they completely changed the language. A year later, when support for version 3 of Puppet Enterprise stopped, we were forced to migrate to PE 2015.2. I again had to rewrite the manifest for the new servers and purchase a license with a reserve of 100 nodes, although at that time we had only 85 nodes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Only 2 years passed, and again we had to do a lot of work to switch to the new version of PE 2016.4. We bought a license for 300 nodes, with a total of 130. We again had to make major changes to the manifest, because the new version of the language had a different syntax from the language of the 2015 version. As a result, our SCM switched from an SVN version control system to Bitbucket (Git). That was our ‚Äúrelationship‚Äù with Puppet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, I had to explain to management why we need to switch to another SCM using the following arguments. The first is the high price of the service. I spoke with the RedHat guys and they said that the cost of maintaining a network of 300 nodes using Ansible Tower is half the cost of Puppet Enterprise. If you purchase another Ansible Engine, the cost will be about the same, but you will get much more features than PE. Since we are a state company funded by the federal budget, this is a pretty weighty argument.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2m/40/kq/2m40kqd4jgicxjzmp5ubw8thhni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second argument is versatility. Puppet only supports hardware with a Puppet agent. This means that you need to install an agent on all switches, and it must be the latest version. And if part of your switches supports one version, and part - another, you will need to install a new version of the PE agent on them so that they can all work on the same SCM system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Ansible Tower system works differently because it does not have any agents, but there are modules that support Cisco switches and all other switches. This SCM supports Qubes OS, Linux, and 4.NET UTM. Ansible Tower also supports NexentaStore NASs based on the Illumos kernel, an open source Unix-based operating system. This is very little support, but Ansible Tower does it anyway.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The third argument, which is very important both for me and for our administration, is ease of development. I mastered the Puppet manifest modules and code for 10 years, but I studied Ansible for a week, because it is much easier to work with this SCM. If you run executable files, of course, if you do not do it unnecessarily, then reasonable and responsive handlers work with them. YAML-based playbooks scripts are easy to learn and quick to use. Those who have never heard of YAML before can simply read the scripts and easily understand how it works.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestly, Puppet complicates your work as a developer, because it is based on the use of Puppet Master. This is the only machine authorized to communicate with Puppet agents. If you made any changes to the manifest and want to test your code, you must rewrite the code for the Puppet Master, that is, configure the Puppet master file / etc / hosts to connect all clients and start the Puppet Server service. Only then can you test the operation of network equipment on one host. This is a rather painful procedure. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Ansible, everything is much simpler. All that needs to be done is to develop code for a machine that can communicate via SSH with the host under test. This is much easier to work with.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next big plus of Ansible Tower is the ability to leverage your existing support system and save your existing hardware configuration. </font><font style="vertical-align: inherit;">This SCM without any additional actions uses all available information about your infrastructure and equipment, virtual machines, servers, etc. </font><font style="vertical-align: inherit;">It can communicate with your RH Satellite servers, if any, and provides you with integration that you will never get when working with Puppet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another important thing is detailed control. </font><font style="vertical-align: inherit;">You know that Puppet is a modular system, it is a client-server application, so you must determine the existing aspects of the operation of all your machines in one long manifest. </font><font style="vertical-align: inherit;">In this case, the state of each individual element of the system must be tested every half hour - this is the default period. </font><font style="vertical-align: inherit;">This is how Puppet works.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tower saves you from this. You can perform various processes on a wide variety of equipment without restrictions, you can do the main work, start other important processes, configure the security system, work with databases. You can do everything that comes with certain difficulties in Puppet Enterprise. So, if you have configured on one host, it will take time for the changes to take effect on the other hosts. In Ansible, all changes take effect simultaneously.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, consider the security module. In Ansible Tower, it is implemented simply amazingly, with great accuracy and thoroughness. You can provide users with access to specific services or to specific hosts. I do this with my employees who are used to working on Windows, restricting them access to the Linux shell. I provide them with access to the Tower so that they can only do the work and run only those services that are within their competence.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q4/wg/nj/q4wgnjqoxdzrxefokqrmspfhgis.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at the things you need to do in advance to facilitate the transition to Ansible Tower. First of all, it is necessary to prepare your equipment. If any elements of your infrastructure are not yet in the database, you need to add them there. There are systems that do not change their characteristics and therefore are absent in the Puppet database, but if you do not add them there before moving to Tower, you will lose a number of advantages. This may be a ‚Äúdirty‚Äù preliminary database, but it should contain information about all the equipment you have. Therefore, you should write a dynamic hardware script that will automatically make all infrastructure changes to the database, then Ansible will know which hosts should be in the new system. You will not need to inform this SCM,which hosts you added and which hosts no longer exist, because she will know all this automatically. The more data there will be in the database, the more useful and flexible Ansible will be. It works as if it simply reads a barcode of equipment status from the database.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spend some time getting to know the command line in Ansible. Run some special commands to test the hardware script, write and run some simple but useful playbook scripts, use Jinja2 templates where appropriate. Try writing a role and script for a complex multi-stage process using a standard, frequently encountered hardware configuration. Play with these things, test how it works. This way you will learn how to work with the tools for creating libraries used in the Tower. I already said that it took me about 3 months to prepare for the transition. I think that based on my experience, you will be able to do it faster. Do not consider this time lost, because later you will feel all the advantages of the work done.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, you need to decide what you expect from Ansible Tower, what exactly this system should do for you. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/e5/br/cee5brmkpaonw1gbfdrdohmoemi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do you need to deploy the system on empty hardware, on empty virtual machines? Or do you want to keep the original conditions of work and settings of existing equipment? This is a very important aspect for the work of state-owned companies, so you must be sure that you will be able to migrate and deploy Ansible on your existing configuration. Identify the routine administrative processes you want to automate. Find out if you need to deploy specific applications and services on the new system. Make a list of what you want to do and prioritize.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then start writing code for scripts and roles that will help you complete your planned tasks. Combine them in Projects, a logical collection of relevant playbooks scripts. Each Project will relate to a separate Git repository or another repository depending on which code manager you use. You can manage playbook scripts and playbook directories by manually placing them in Project Base Path on the Tower server, or by placing the playbook in any tower source code management (SCM) system, including Git, Subversion, Mercurial, and Red Hat Insights. Within one Project, you can place as many scripts as you want. For example, I created one basic Project, in which I placed a script for the main elements of RedHat, a script for the basics of Linux,Scenarios for the remaining baselines. Thus, in one project there were a wide variety of roles and scripts that were managed from one Git repository.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run all these things through the command line, this is a good way to test their performance. This way you get ready for the Tower installation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's talk a little bit about transcoding the Puppet manifest, because I spent a lot of time on it until I figured out what really needed to be done.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ep/y2/aq/epy2aqqfgbwc2xvvp4x8nfiajva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As I said before, Puppet stores all the settings and equipment parameters in one long manifest, and this manifest contains everything that this SCM should do. During the transition, you don‚Äôt need to push all your tasks into one list, instead think about the structure of the new system: roles, scripts, tags, groups and what should go there. Some of the stand-alone network elements should be grouped into groups for which you can create scripts. More complex infrastructure elements that involve a large number of resources, including autonomous classes, can be combined in roles. Before migration, you need to decide on this. If you create voluminous roles or scripts that do not fit on one screen, you should use tags to be able to capture individual parts of the infrastructure.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
18:00 </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trimming Threads: Migrating from Puppet Enterprise to Ansible Tower. </font><font style="vertical-align: inherit;">Part 2</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit of advertising :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for staying with us. Do you like our articles? Want to see more interesting materials? Support us by placing an order or recommending to your friends, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS for developers from $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unique analog of entry-level servers that was invented by us for you: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The whole truth about VPS (KVM) E5-2697 v3 (6 Cores) 10GB DDR4 480GB SSD 1Gbps from $ 19 or how to divide the server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (options are available with RAID1 and RAID10, up to 24 cores and up to 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 times cheaper at the Equinix Tier IV data center in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Only we have </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV from $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the Netherlands!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - from $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read about</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to Build Infrastructure Bldg. </font><font style="vertical-align: inherit;">class c using Dell R730xd E5-2650 v4 servers costing 9,000 euros for a penny?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500384/index.html">Pixar Studio Pioneers Received Turing Award and $ 1 Million</a></li>
<li><a href="../en500386/index.html">Adapting your existing business solution for SwiftUI. Part 2</a></li>
<li><a href="../en500390/index.html">Actual models of linguistic localization in the field of IT and digital communications. Part 1</a></li>
<li><a href="../en500396/index.html">Problems of autonomous access control systems - Where they did not expect</a></li>
<li><a href="../en500398/index.html">Remote Marathon Week 3: Inoperative Processes</a></li>
<li><a href="../en500402/index.html">[Part 1/2] Guide to FFmpeg and SDL or How to write a video player in less than 1000 lines</a></li>
<li><a href="../en500404/index.html">How to make friends Electron and Webix. Part 2. Create an application with your View</a></li>
<li><a href="../en500406/index.html">The Story of the First Paralysis of the Internet: The Curse of the Busy Signal</a></li>
<li><a href="../en500408/index.html">Happiness in poverty</a></li>
<li><a href="../en500410/index.html">Creating backlash *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>