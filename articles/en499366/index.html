<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåü üõ∞Ô∏è üëâ Geo-chat, harmful bots and steganography: enriching knowledge about Telegram üë©üèº‚Äçüç≥ üë©üèΩ‚Äçüé® üçà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What do you know about telegrams in Telegram? And can you distinguish steganography in VideoNote (popularly - round-robin)? We analyze the very task N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Geo-chat, harmful bots and steganography: enriching knowledge about Telegram</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neobit/blog/499366/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ls/r-/kn/lsr-knoirt_c2eklbngtrv43ys4.png"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What do you know about telegrams in Telegram? </font><font style="vertical-align: inherit;">And can you distinguish steganography in VideoNote (popularly - round-robin)? </font><font style="vertical-align: inherit;">We analyze the very task </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeoQUEST-2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which caused the most questions and exclamations to our support! </font><font style="vertical-align: inherit;">Spoiler: yes, and there will also be a bit of crypto here :)</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeoQUEST-2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> legend, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">we</font></a><font style="vertical-align: inherit;"> find a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to the profile of a traveling robot on Instagram. </font><font style="vertical-align: inherit;">Nothing out of the ordinary, right? </font><font style="vertical-align: inherit;">So we decided so too, but we still need to solve the problem, so we carefully consider all the pictures in the profile and look for at least some clues. </font><font style="vertical-align: inherit;">A little meditation on a beautiful picture of Lake Baikal, and we come to the realization that the clue is in the last post:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wg/f3/yp/wgf3ypumnzx-gms9aj5ixn7qllw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks to the picture, we understand that we need to somehow connect Baikal (Shaman Rock) and Telegram (‚ÄúU can join my ...‚Äù - doesn‚Äôt it remind anything?). </font><font style="vertical-align: inherit;">At first, we decided not to give the participants a direct hint of geo-chat (which is exactly it!), And many of them successfully coped with the task using an emulator or a mobile device with the ability to change the geo-location. </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shamanim We set the</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coordinates (53.20074, 107.349426) (you can by eye) in the area of ‚Äã‚Äãthe Shamanka rock and prepare for the most difficult thing - the wait. </font><font style="vertical-align: inherit;">Telegram strangely works with geo-positioning and pulls up relevant contacts and chats for an hour. </font><font style="vertical-align: inherit;">For our diligence and patience, we are fully rewarded - the desired chat appears in the Contacts section -&gt; Find people nearby -&gt; Groups nearby.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cb/z_/ti/cbz_tiwdqa0j0cqdikmwjob704y.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila, we're in business! </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_c/or/zt/_corztflxylgeewrehp61prvssu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The bot meets us with a task in the form of a file some.bytes with unidentified contents, in which we can read the lines ‚ÄúDecrypt me‚Äù and ‚ÄúApocalypse Spares Nobody‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We understand the first line without any problems, but what does the second mean? .. Here, the participants divided into two camps: some wrote to us by mail, because they got into a dead end, while others carefully looked at the phrase "Apocalypse Spares Nobody" and discerned that ? Right! Good old </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASN.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> format </font><font style="vertical-align: inherit;">( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we already wrote about how to parse it).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bb/vr/k4/bbvrk4nu0xsdayswyptuv2z1gpw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's get it right. Inside are 2 structures. In one, we find a set of bytes marked "Decrypt me", from which we assume that this is ciphertext. In the second structure, we see two numbers. It is unlikely that this is a key generously presented by the participant along with ciphertext, which means most likely. We are dealing with a public key. All the information gathered leads us to the obvious conclusion - why not try </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we have a module and an open indicator, which, by the way, is quite large. After a </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convulsive study of the RSA for some</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> thought, we conclude that the closed indicator is small, which means what? Bingo! We can definitely play bad guys and use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiener's attack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We thought it through even for those who do not like cryptography - you could use a ready-made version of the attack, for example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we get the value of a closed figure </font></font><code>d=40553818206320299896275948250950248823966726834704013657854904761789429403771</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and decrypt ciphertext: </font></font><code>key=nq2020faAeFeGUCBjYf7UDrH9FapFCdFPa4u;pass=passCxws3jzYhp0HD5Fy84</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We get the key "nq2020faAeFeGUCBjYf7UDrH9FapFCdFPa4u" to the first part of the job and the password "passCxws3jzYhp0HD5Fy84", which you need to feed the bot representative. </font><font style="vertical-align: inherit;">It can be found among the chat participants under the name @neoquestbot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Being on the wave of positive from receiving the first key, we do not immediately realize that the bot is picky in communication and all the time says that it does not see the interlocutor:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ex/ky/t_/exkyt__66acqprkte1kk_hljuge.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the bot happily receives VideoNote round messages and even answers them ... in the same round form:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gv/tk/k4/gvtkk4hr8u_a8gsidkkqijtcuzy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It seems that the video and sound are the same, but this is only at first glance. </font><font style="vertical-align: inherit;">What if our bot gives us some secret signs? </font><font style="vertical-align: inherit;">To find out, we‚Äôll save and compare the original video with the bot‚Äôs response. </font><font style="vertical-align: inherit;">For this and for the next steps, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> package is great for us </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">So, let's see what is there:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/re/jy/z0/rejyz0tnqx0lgvvcggpctdv2elq.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ri/e3/_v/rie3_vg77u1j1txjch9te5a8y1w.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Format aac -&gt; flac, frequency 44100 Hz -&gt; 98000 Hz. </font><font style="vertical-align: inherit;">They found out, we continue to work further with audio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With a deft movement of the hands we pull it out of the video:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/er/ql/jh/erqljhyvzkhdq34zoxmfvl7ezty.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same can be done with our original message, so that we can compare them later. </font><font style="vertical-align: inherit;">For clarity, open both tracks in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audacity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gd/ga/gq/gdgagqn_qtefqtnbyphj2ud0b00.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The jump in amplitude in the bot‚Äôs audio response immediately catches your eye (especially strange if we were silent at all). </font><font style="vertical-align: inherit;">On closer inspection, we note the clear boundaries of the intervals during the alternation of "wave-silence":</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mu/7f/zp/mu7fzposl6z9ozjrxanvjfnh2hw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We suggest putting all things aside and counting a little. </font><font style="vertical-align: inherit;">We analyze by fragments: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0 - 0.005 - silence </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0.005 - 0.01 - wave </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0, 01 - 0.0225 - silence </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0.025 - 0.04 - wave </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0.04 - 0.045 - silence </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The smallest interval is 0.005, and all the others intervals are multiples of 0.005. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We take the presence of a wave of 0.005 for 1, and silence for 0. We get nothing more than a binary code! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We recall that the frequency has changed, and try to look at the spectrum graph (Analysis -&gt; Spectrum graph):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7p/us/g0/7pusg01eyco5oawp9fyw92rbpzi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We see that the most powerful signal is at a frequency of ~ 44100 Hz, which is ultrasound. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, then you should work only with high frequencies. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, the bot superimposes its signal on the original audio in the audible spectrum. And those participants who had sound in the original video noticed this in Audacity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We cut off the high frequencies with a high-pass filter either in Audacity, or in the same ffmpeg:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3c/tk/tc/3ctktc0fgdc9zevjijzypncxb9o.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we have a 16-bit mono wav file. It consists of a header, uncompressed audio stream, and metadata. The audio stream itself is divided into frames (and frames can store several samples, but this is a completely different story), in our case 16 bits each (this is indicated by the letters pcm_s16 in the screenshots). Frames are sequences of bits that describe the amplitude of the wave at a time for one or more channels (in our case, for one). The sampling frequency of the audio stream is 98000 frames (that is, 98000 frames per one second), 490 frames per 0.005 second interval. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, further we work according to a simple algorithm: we read 490 frames, determine whether it is a wave or silence, and, depending on this, set the bit to 0 or 1. We will </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
use python and a package</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wave</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for parsing wav files. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the error ‚Äúwave.Error: unknown format: 65534‚Äù occurs when opening the file, then replace ‚ÄúwFormatTag‚Äù in the header from 'FE FF' to '01 00 ':</font></font><br>
<br>
<pre><code class="python hljs">fh = open(input_file, <span class="hljs-string">"r+b"</span>)<font></font>
fh.seek(<span class="hljs-number">20</span>)<font></font>
fh.write(<span class="hljs-string">b'\x01\x00'</span>)<font></font>
fh.close()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, open the file, process 490 frames and calculate the average value:</font></font><br>
<br>
<pre><code class="python hljs">file = wave.open(input_file,<span class="hljs-string">"r"</span>)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range (<span class="hljs-number">1</span>, int(file.getnframes()/<span class="hljs-number">490</span>)+<span class="hljs-number">1</span>):<font></font>
        frames = file.readframes(<span class="hljs-number">490</span>)<font></font>
        bit = <span class="hljs-number">0</span>
        sum = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">246</span>):<font></font>
            frame_bytes = frames[k*<span class="hljs-number">2</span>:k*<span class="hljs-number">2</span>+<span class="hljs-number">2</span>]<font></font>
            sum += int.from_bytes(frame_bytes, <span class="hljs-string">"big"</span>)
        <span class="hljs-keyword">if</span> sum/<span class="hljs-number">490</span> &gt; <span class="hljs-number">16000</span>:<font></font>
            bit = <span class="hljs-number">1</span><font></font>
        bits.append(bit)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is possible that where there should be silence (compare with the picture in Audacity), noise may remain. </font><font style="vertical-align: inherit;">Therefore, we set the threshold (let it be 16000), upon exceeding which we consider the signal to be 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we group the bits into bytes:</font></font><br>
<br>
<pre><code class="python hljs">bytes = []    
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range (<span class="hljs-number">1</span>, int(len(bits)/<span class="hljs-number">8</span>)+<span class="hljs-number">1</span>):<font></font>
        b1 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-8</span>]<font></font>
        b2 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-7</span>]<font></font>
        b3 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-6</span>]<font></font>
        b4 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-5</span>]<font></font>
        b5 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-4</span>]<font></font>
        b6 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-3</span>]<font></font>
        b7 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-2</span>]<font></font>
        b8 = bits[i*<span class="hljs-number">8</span><span class="hljs-number">-1</span>]<font></font>
        byte = (b1 &lt;&lt; <span class="hljs-number">7</span>) | (b2 &lt;&lt; <span class="hljs-number">6</span>) | (b3 &lt;&lt; <span class="hljs-number">5</span>) | (b4 &lt;&lt; <span class="hljs-number">4</span>) | (b5 &lt;&lt; <span class="hljs-number">3</span>) | (b6 &lt;&lt; <span class="hljs-number">2</span>) | (b7 &lt;&lt; <span class="hljs-number">1</span>) | b8<font></font>
        bytes.append(byte.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">'big'</span>)) 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If everything is done correctly, the result is the string ‚ÄúGivemethepassword‚Äù. </font><font style="vertical-align: inherit;">Since the bot communicates in circles using steganography, it will be logical to slip a password for it (and we received it together with the key as a result of decryption) in the same format. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get started, compose an audio track with a password. </font><font style="vertical-align: inherit;">To do this, we use the data obtained during the analysis of the message from the bot: sampling frequency 98000 Hz; </font><font style="vertical-align: inherit;">the duration of the signal describing each bit is 5 ms; </font><font style="vertical-align: inherit;">the signal frequency corresponding to the bit value ‚Äú1‚Äù - as we saw from the graphs, 44100 Hz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we need to "generate" silence. </font><font style="vertical-align: inherit;">We do this by neutralizing:</font></font><br>
<br>
<pre><code class="python hljs">sample_rate = <span class="hljs-number">98000.0</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_silence</span>(<span class="hljs-params">duration_milliseconds=<span class="hljs-number">5</span></span>):</span><font></font>
    fragment = []<font></font>
    num_samples = duration_milliseconds * (sample_rate / <span class="hljs-number">1000.0</span>)
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(int(num_samples)): <font></font>
        fragment.append(<span class="hljs-number">0.0</span>)
    <span class="hljs-keyword">return</span> fragment
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To generate sound, we will use a sine wave (information can be read </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_sinewave</span>(<span class="hljs-params">
        freq=<span class="hljs-number">41000.0</span>, 
        duration_milliseconds=<span class="hljs-number">5</span>, 
        volume=<span class="hljs-number">0.5</span></span>):</span><font></font>
    fragment = []<font></font>
    amplitude = volume * <span class="hljs-number">32767.0</span>
    num_samples = duration_milliseconds * (sample_rate / <span class="hljs-number">1000.0</span>)
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(int(num_samples)):<font></font>
        fragment.append(amplitude * math.sin(<span class="hljs-number">2</span> * math.pi * freq * ( x / sample_rate )))
    <span class="hljs-keyword">return</span> fragment
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the thing is small: it remains to convert the password into bits, and then into sound. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note: The bot uses the original input video track to overlay its message, as mentioned earlier. </font><font style="vertical-align: inherit;">Therefore, you need to add a few zero bytes after the password in order to shake out the whole key from the bot, and not just its beginning (the key length was 36 bytes).</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sound generation</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs">    audio = []<font></font>
    f = open(input_file, <span class="hljs-string">'rb'</span>)
    <span class="hljs-keyword">for</span> character <span class="hljs-keyword">in</span> f.read():<font></font>
        a = character<font></font>
        b8 = a &amp; <span class="hljs-number">0b00000001</span> 
        b7 = (a &amp; <span class="hljs-number">0b00000010</span>) &gt;&gt; <span class="hljs-number">1</span> 
        b6 = (a &amp; <span class="hljs-number">0b00000100</span>) &gt;&gt; <span class="hljs-number">2</span>
        b5 = (a &amp; <span class="hljs-number">0b00001000</span>) &gt;&gt; <span class="hljs-number">3</span>
        b4 = (a &amp; <span class="hljs-number">0b00010000</span>) &gt;&gt; <span class="hljs-number">4</span>
        b3 = (a &amp; <span class="hljs-number">0b00100000</span>) &gt;&gt; <span class="hljs-number">5</span>
        b2 = (a &amp; <span class="hljs-number">0b01000000</span>) &gt;&gt; <span class="hljs-number">6</span>
        b1 = (a &amp; <span class="hljs-number">0b10000000</span>) &gt;&gt; <span class="hljs-number">7</span>
        <span class="hljs-keyword">if</span> b1 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
        <span class="hljs-keyword">if</span> b2 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
        <span class="hljs-keyword">if</span> b3 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
        <span class="hljs-keyword">if</span> b4 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
        <span class="hljs-keyword">if</span> b5 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
        <span class="hljs-keyword">if</span> b6 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
        <span class="hljs-keyword">if</span> b7 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
        <span class="hljs-keyword">if</span> b8 == <span class="hljs-number">1</span>:<font></font>
            audio += generate_sinewave()<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            audio += generate_silence()<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we will create the finished wave file:</font></font><br>
<br>
<pre><code class="python hljs">wav_file=wave.open(file_name,<span class="hljs-string">"w"</span>)<font></font>
    nchannels = <span class="hljs-number">1</span>
    sampwidth = <span class="hljs-number">2</span><font></font>
    nframes = len(audio)<font></font>
    comptype = <span class="hljs-string">"NONE"</span>
    compname = <span class="hljs-string">"not compressed"</span><font></font>
    wav_file.setparams((nchannels, sampwidth, sample_rate, nframes, comptype, compname))<font></font>
    <span class="hljs-keyword">for</span> sample <span class="hljs-keyword">in</span> audio:<font></font>
        wav_file.writeframes(struct.pack(<span class="hljs-string">'h'</span>, int(sample)))<font></font>
    wav_file.close()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We save our track, for example, in pass.wav. </font><font style="vertical-align: inherit;">Along the way, we check with our stego decoder whether the password is recognized. </font><font style="vertical-align: inherit;">If all is well, then we get a new video with a password from the original video my_video.mp4, replacing the audio track:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7y/vg/_u/7yvg_ulbp5wmx8jmz5vmxucgogu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we need to make VideoNote out of this. </font><font style="vertical-align: inherit;">You can try to look for working ones (some of the participants, for example, found @TelescopyBot), or you can write your bot using TelegramAPI.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rk/_4/np/rk_4nphgkerx68klet43x0npzrg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Anyway, forward to our bot:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3x/li/0g/3xli0gyrmnawsnl6fyqa90slv6e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We get a new round and congratulations (we would have done such a job!), Decoded the audio according to the already worked out scenario, and got the key: ‚Äúnq2020SyOMK7SnnJP1sNlvbTs8zt35vUrrsD‚Äù </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indeed, steganography is considered one of the most difficult areas of cybersecurity for no reason - try to guess all these here! </font><font style="vertical-align: inherit;">But NeoQUEST participants showed great dexterity and a sense of humor during this task, so we are addressing our sincere (from the bot congratulations) sincere admiration!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499356/index.html">Hackintosh on Powermac G5 or how to assemble a workstation. Part 2</a></li>
<li><a href="../en499358/index.html">PEP 257 in Russian. (Docstrings Agreement)</a></li>
<li><a href="../en499360/index.html">Creating and configuring the Mesh network first hand, as well as some numbers and analytics</a></li>
<li><a href="../en499362/index.html">Remote Marathon Week 2: Workflows</a></li>
<li><a href="../en499364/index.html">Alexey Kapterev: Critical Thinking 101 (Part 1)</a></li>
<li><a href="../en499368/index.html">About Phrasal Verbs-4 (in / out)</a></li>
<li><a href="../en499370/index.html">My favorite CSS questions with detailed answers</a></li>
<li><a href="../en499374/index.html">Examination of COVID-19 proliferation data using first-order differences. And what came of it</a></li>
<li><a href="../en499376/index.html">A little about the device of modern radio on the example of HackRF One</a></li>
<li><a href="../en499378/index.html">Build Your First Cypress Test</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>