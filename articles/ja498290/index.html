<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏽 📱 🚴🏼 手続き型水文学：川と湖の動的シミュレーション 🆗 ☺️ 🧟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="注：プロジェクトの完全なソースコードは、Github [ こちら ]に投稿されています。リポジトリには、コードの読み取り方法と使用方法に関する詳細情報も含まれています。
 粒子ベースの水力侵食シミュレーションを実装した後、私はこの概念を拡張して表面水文学の他の側面をシミュレートすることが可能であると...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>手続き型水文学：川と湖の動的シミュレーション</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498290/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93d/664/fbe/93d664fbe19ce63dfa6b60d9621d07ae.png"></div><blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトの完全なソースコードは、Github [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]に</font><font style="vertical-align: inherit;">投稿されて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">い</font></a><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">リポジトリには、コードの読み取り方法と使用方法に関する詳細情報も含まれています。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
粒子ベースの水力侵食シミュレーションを実装した後、私はこの概念を拡張して表面水文学の他の側面をシミュレートすることが可能であると判断しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
河川や湖沼の既存の手順による生成方法を調査しましたが、見つかった結果は私に適していませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの方法の主な目的は、さまざまなアルゴリズムを使用して（非常に美しい）河川システムを作成することです（以前に作成された標高マップまたは逆問題に基づく場合もあります）が、地形と水文学の間に強い現実的な関係がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、レリーフ全体の水モデルの処理は、一部のリソースで考慮され、非常に複雑な流体のシミュレーションが使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、粒子ベースの水力侵食をシミュレートする機能を拡張する手法を使用して、これらの問題を克服する私の試みを示します。</font><font style="vertical-align: inherit;">また、「安心の水」の問題を一般的にどのように解決するかも説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の方法では、基礎となる侵食システムの複雑さをわずかに増加させることを犠牲にして、単純さと現実性の両方に努めています。</font><font style="vertical-align: inherit;">新しい</font><font style="vertical-align: inherit;">システム</font><font style="vertical-align: inherit;">はこれに基づいているため、</font><font style="vertical-align: inherit;">このシステムについての以前の記事[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">Habréの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]を</font><font style="vertical-align: inherit;">読むことをお勧め</font><font style="vertical-align: inherit;">します。</font></font><br>
<a name="habracut"></a><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Hydrology6.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このシステムは、水文学によって非常にリアルな地形をすばやく生成することができます。</font><font style="vertical-align: inherit;">このビデオはリアルタイムでレンダリングされました。</font><font style="vertical-align: inherit;">このシステムは、このような景観を無数に生成することができます。</font></font></i><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は地質学者ではないので、私の知識に基づいてシステムを作成しました。</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水文学のコンセプト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は、以下を含む多数の地理的現象をシミュレートできる生成システムを作成したいと考えています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">河川と小川の移動</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自然の滝</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャニオンの形成</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">土壌と氾濫原の膨潤</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、水文学と地形学のシステムは動的で密接に関連している必要があります。</font><font style="vertical-align: inherit;">粒子ベースの水力侵食システムには、これに必要な基本的な側面がすでにあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レリーフは水の動きに影響します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侵食と堆積が地形に影響を与える</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、このシステムは雨による侵食をシミュレートしますが、他の多くの影響を伝えることはできません。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移動する</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリームでは、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水は異なる動作をします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立っている</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プールでは、</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水の動きが異なります</font></font></li>
</ul><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリーム</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プール</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">についてよく触れ</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">モデルでは、これらが2次元の大規模な現象であると仮定されています。</font><font style="vertical-align: inherit;">モデルの複雑さを大幅に軽減します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の地理的現象のほとんどは、流れと盆地のモデルを使用して伝えることができます。</font><font style="vertical-align: inherit;">理想的には、パーティクルベースのシステムの現実性を借りて強化する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡略化された水文モデル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フローとプールに関する情報を1つ以上のデータ構造（グラフ、オブジェクトなど）に格納するのは複雑すぎて、機能が制限されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちの水文モデルは、</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フロー</font></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マップ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><strong><font style="vertical-align: inherit;">盆地マップ</font></strong><font style="vertical-align: inherit;">の2つのマップで構成されてい</font><strong><font style="vertical-align: inherit;">ます</font></strong><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2Dシステムとしてモデル化されていることを忘れないでください。</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリームおよびプールマップ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フローマップは、表面（河川）に流れる水を表します。</font><font style="vertical-align: inherit;">時間平均されたパーティクルの位置をマップに保存します。</font><font style="vertical-align: inherit;">古い情報は徐々に削除されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
盆地マップは、地表の静水（水たまり、池、湖、海）を説明します。</font><font style="vertical-align: inherit;">マップの対応する位置に水深を格納します。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリームマップとプールマップは、高さマップと同じサイズの配列です。</font></font></blockquote><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/869/209/77f/86920977ff555d0cf5a2e0a923d79207.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水文学的影響の緩和。</font><font style="vertical-align: inherit;">レンダーの水層は水文図から取得されます。</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f1/2a1/1c2/0f12a11c2164cc93995a9f5599b1a7a9.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結合水文マップ。</font><font style="vertical-align: inherit;">ライトブルーはストリームマップ、ダークブルーはプールマップです。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのマップは、地形に沿って水を動かす粒子によって生成および接続されます。</font><font style="vertical-align: inherit;">これらの水文マップを追加すると、時間とは無関係な情報が得られ、シミュレーションと粒子の相互作用を個別に行うことができます。</font><font style="vertical-align: inherit;">パーティクルは、これらのカードを使用して相互作用し、その動きに影響を与えるパラメーターを取得できます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリームマップは、イーズインアウト関数を通過した後に表示され、これに基づいて地形上にレンダリングされます。</font><font style="vertical-align: inherit;">より細かい/より鋭い流れを取得する（または広い平坦な領域で低い値を無視する）には、この表示を変更するか、しきい値を設定します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">粒子としての水</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
水は、体積を持ち、レリーフの表面に沿って移動する離散した塊（「粒子」）の形で提示されます。</font><font style="vertical-align: inherit;">運動に影響を与えるいくつかのパラメータがあります（摩擦、蒸発速度、堆積速度など）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、水文学のシミュレーションに使用される基本的なデータ構造です。</font><font style="vertical-align: inherit;">パーティクルは</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存されません</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、高さ、フロー、プールのマップ間の相互作用にのみ使用されます。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティクル</font><strong><font style="vertical-align: inherit;">の</font></strong><font style="vertical-align: inherit;">概念については、以前の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font><font style="vertical-align: inherit;">Habréの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]（およびその他の無数のリソース）で</font><font style="vertical-align: inherit;">詳しく説明されてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水文循環とマップの相互作用</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マップは、水文学的サイクルを通じて相互に作用します。</font><font style="vertical-align: inherit;">水循環は次のステップで構成されています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地形上に粒子を作成する</font></font></li>
<li><strong></strong>        (.. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">     </a>).</li>
<li>        ,                  <strong></strong>.</li>
<li>  ,           <strong></strong>.</li>
<li> ,     (    )      .</li>
<li>     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システム全体で、アルゴリズムは2つしかありません：</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下降（降下）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">洪水（洪水）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">下降粒子は流れのマップを変更し、洪水粒子は盆地のマップを変更します。</font><font style="vertical-align: inherit;">これらのアルゴリズムについては、以下で詳しく説明します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/989/a81/2cb/989a812cb5d769edbb76fd5a284d18b1.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水文モデルの1次元ダイアグラム。</font><font style="vertical-align: inherit;">パーティクルは地形上に作成され、降順と洪水という2つのアルゴリズムによって周期的に処理されます。</font><font style="vertical-align: inherit;">その過程で、盆地と流れのマップが変化し、粒子の動きに影響を与えます。</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下では、結果の生成に使用されるシステムの完全な実装について説明し、コード例を示します。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関連するコードのみを示します。</font><font style="vertical-align: inherit;">詳細については、Githubのリポジトリを参照してください。</font><font style="vertical-align: inherit;">コードの関連部分はすべて「water.h」ファイルにあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">粒子クラス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドロップ粒子の構造は、前のシステムの構造と同じです。</font><font style="vertical-align: inherit;">下降と洪水は一度に1つのパーティクルのみに作用するため、構造のメンバーになりました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Drop</span>{</span><font></font>
  <font></font>
  <span class="hljs-comment">//... constructors</span><font></font>
<font></font>
  <span class="hljs-keyword">int</span> index;                         <span class="hljs-comment">//Flat Array Index</span>
  glm::vec2 pos;                     <span class="hljs-comment">//2D Position</span>
  glm::vec2 speed = glm::vec2(<span class="hljs-number">0.0</span>);
  <span class="hljs-keyword">double</span> volume = <span class="hljs-number">1.0</span>;
  <span class="hljs-keyword">double</span> sediment = <span class="hljs-number">0.0</span>;<font></font>
<font></font>
  <span class="hljs-comment">//... parameters</span>
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> volumeFactor = <span class="hljs-number">100.0</span>; <span class="hljs-comment">//"Water Deposition Rate"</span><font></font>
<font></font>
  <span class="hljs-comment">//Hydrological Cycle Functions</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">descend</span><span class="hljs-params">(<span class="hljs-keyword">double</span>* h, <span class="hljs-keyword">double</span>* stream, <span class="hljs-keyword">double</span>* pool, <span class="hljs-keyword">bool</span>* track, glm::ivec2 dim, <span class="hljs-keyword">double</span> scale)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flood</span><span class="hljs-params">(<span class="hljs-keyword">double</span>* h, <span class="hljs-keyword">double</span>* pool, glm::ivec2 dim)</span></span>;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加のパラメーターは、体積係数です。これは、洪水が体積を水位に移動する方法を決定します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">降下アルゴリズム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
降下アルゴリズムは、単純な粒子侵食アルゴリズムとほとんど同じです。</font><font style="vertical-align: inherit;">彼は追加の入力「トラック」を受け取ります-配列には、自分が訪れたすべての位置が書き込まれます。</font><font style="vertical-align: inherit;">将来、ストリームマップを構築するには配列が必要です。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Drop::descend</span><span class="hljs-params">(<span class="hljs-keyword">double</span>* h, <span class="hljs-keyword">double</span>* stream, <span class="hljs-keyword">double</span>* pool, <span class="hljs-keyword">bool</span>* track, glm::ivec2 dim, <span class="hljs-keyword">double</span> scale)</span></span>{<font></font>
<font></font>
  glm::ivec2 ipos; <font></font>
<font></font>
  <span class="hljs-keyword">while</span>(volume &gt; minVol){<font></font>
<font></font>
    ipos = pos; <span class="hljs-comment">//Initial Position</span>
    <span class="hljs-keyword">int</span> ind = ipos.x*dim.y+ipos.y; <span class="hljs-comment">//Flat Array Index</span><font></font>
<font></font>
    <span class="hljs-comment">//Register Position</span>
    track[ind] = <span class="hljs-literal">true</span>;<font></font>
<font></font>
    <span class="hljs-comment">//...</span><font></font>
  }<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータのセットは、フローマップとプールマップによって変更されます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//...</span>
  <span class="hljs-comment">//Effective Parameter Set</span>
  <span class="hljs-keyword">double</span> effD = depositionRate;
  <span class="hljs-keyword">double</span> effF = friction*(<span class="hljs-number">1.0</span><span class="hljs-number">-0.5</span>*stream[ind]);
  <span class="hljs-keyword">double</span> effR = evapRate*(<span class="hljs-number">1.0</span><span class="hljs-number">-0.2</span>*stream[ind]);
<span class="hljs-comment">//...</span></code></pre><br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このようなパラメーターの変更がうまく機能することがわかりました。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のシステムでは、粒子はこのサイクルから抜け出し、完全に蒸発するか、レリーフの境界を超えた場合にのみ破壊されました。</font><font style="vertical-align: inherit;">これで、2つの追加の終了条件がここに追加されました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//... nind is the next position after moving the particle</span><font></font>
  <font></font>
  <span class="hljs-comment">//Out-Of-Bounds</span>
  <span class="hljs-keyword">if</span>(!glm::all(glm::greaterThanEqual(pos, glm::vec2(<span class="hljs-number">0</span>))) ||<font></font>
     !glm::all(glm::lessThan((glm::ivec2)pos, dim))){<font></font>
       volume = <span class="hljs-number">0.0</span>;
       <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//Slow-Down</span>
  <span class="hljs-keyword">if</span>(stream[nind] &gt; <span class="hljs-number">0.5</span> &amp;&amp; length(acc) &lt; <span class="hljs-number">0.01</span>)
    <span class="hljs-keyword">break</span>;<font></font>
<font></font>
  <span class="hljs-comment">//Enter Pool</span>
  <span class="hljs-keyword">if</span>(pool[nind] &gt; <span class="hljs-number">0.0</span>)
    <span class="hljs-keyword">break</span>;<font></font>
<font></font>
<span class="hljs-comment">//...</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
粒子に十分な加速がなく、他の粒子に囲まれている場合、または直接プールに入る場合は、残りのすべての体積で降下を早めに完了し、フラッディングアルゴリズムに進みます。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オーバーフロー条件は、パーティクルがフラッディングアルゴリズムに渡らないようにボリュームもリセットします。</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラッディングアルゴリズム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのボリュームを持つパーティクルは、現在の位置から溢れる可能性があります。これは、下降を停止する（加速がない）か、既存のプールに入ると発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フラッディングアルゴリズムは、増加した水位にパーティクルのボリュームを転送し、盆地のマップを変更します。この手法は、「テスト平面」を使用して、粒子の体積の一部だけ水位を段階的に増加させることです。水位が上昇すると、粒子の体積が減少します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c28/908/ebc/c28908ebc4f1efee43232578962beed2.gif"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラッディングアルゴリズムのアニメーション。テスト平面と水位が徐々に増加し、粒子の体積が減少します。リークが見つかった場合、残りのボリュームはリークポイントに移動して降下を実行します。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
各ステップで、パーティクルの位置から塗りつぶしを実行し（つまり、近傍の位置を再帰的にチェックし）、元の平面（現在の水位）の上とテスト平面の下にあるすべての位置を「洪水セット」に追加します。これは、プールの一部であるレリーフの領域です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
充填中に、漏れがないか確認します。これらは、テスト平面の下で、かつ元の平面の下にある、フラッディングのセットからのポイントです。複数のリークポイントが見つかった場合は、最も低いものを選択します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Drop::flood</span><span class="hljs-params">(<span class="hljs-keyword">double</span>* height, <span class="hljs-keyword">double</span>* pool, glm::ivec2 dim)</span></span>{<font></font>
<font></font>
  index = (<span class="hljs-keyword">int</span>)pos.x*dim.y + (<span class="hljs-keyword">int</span>)pos.y;
  <span class="hljs-keyword">double</span> plane = height[index] + pool[index];  <span class="hljs-comment">//Testing Plane</span>
  <span class="hljs-keyword">double</span> initialplane = plane;                 <span class="hljs-comment">//Water Level</span><font></font>
<font></font>
  <span class="hljs-comment">//Flood Set</span>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-built_in">set</span>;
  <span class="hljs-keyword">int</span> fail = <span class="hljs-number">10</span>; <span class="hljs-comment">//Just in case...</span><font></font>
<font></font>
  <span class="hljs-comment">//Iterate while particle still has volume</span>
  <span class="hljs-keyword">while</span>(volume &gt; minVol &amp;&amp; fail){<font></font>
<font></font>
    <span class="hljs-built_in">set</span>.clear();
    <span class="hljs-keyword">bool</span> tried[dim.x*dim.y] = {<span class="hljs-literal">false</span>};<font></font>
<font></font>
    <span class="hljs-comment">//Lowest Drain</span>
    <span class="hljs-keyword">int</span> drain;
    <span class="hljs-keyword">bool</span> drainfound = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//Recursive Flood-Fill Function</span>
    <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>)&gt; fill = [&amp;](<span class="hljs-keyword">int</span> i){<font></font>
<font></font>
      <span class="hljs-comment">//Out of Bounds</span>
      <span class="hljs-keyword">if</span>(i/dim.y &gt;= dim.x || i/dim.y &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span>(i%dim.y &gt;= dim.y || i%dim.y &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<font></font>
<font></font>
      <span class="hljs-comment">//Position has been tried</span>
      <span class="hljs-keyword">if</span>(tried[i]) <span class="hljs-keyword">return</span>;<font></font>
      tried[i] = <span class="hljs-literal">true</span>;<font></font>
<font></font>
      <span class="hljs-comment">//Wall / Boundary of the Pool</span>
      <span class="hljs-keyword">if</span>(plane &lt; height[i] + pool[i]) <span class="hljs-keyword">return</span>;<font></font>
<font></font>
      <span class="hljs-comment">//Drainage Point</span>
      <span class="hljs-keyword">if</span>(initialplane &gt; height[i] + pool[i]){<font></font>
<font></font>
        <span class="hljs-comment">//No Drain yet</span>
        <span class="hljs-keyword">if</span>(!drainfound)<font></font>
          drain = i;<font></font>
<font></font>
        <span class="hljs-comment">//Lower Drain</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( pool[drain] + height[drain] &lt; pool[i] + height[i] )<font></font>
          drain = i;<font></font>
<font></font>
        drainfound = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">//No need to flood from here</span><font></font>
      }<font></font>
<font></font>
      <span class="hljs-comment">//Part of the Pool</span>
      <span class="hljs-built_in">set</span>.push_back(i);<font></font>
      fill(i+dim.y);    <span class="hljs-comment">//Fill Neighbors</span><font></font>
      fill(i-dim.y);<font></font>
      fill(i+<span class="hljs-number">1</span>);<font></font>
      fill(i<span class="hljs-number">-1</span>);<font></font>
      fill(i+dim.y+<span class="hljs-number">1</span>);  <span class="hljs-comment">//Diagonals (Improves Drainage)</span>
      fill(i-dim.y<span class="hljs-number">-1</span>);<font></font>
      fill(i+dim.y<span class="hljs-number">-1</span>);<font></font>
      fill(i-dim.y+<span class="hljs-number">1</span>);<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//Perform Flood</span><font></font>
    fill(index);<font></font>
<font></font>
    <span class="hljs-comment">//...</span></code></pre><br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単にするため、ここでは8 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方向の塗りつぶしアルゴリズム</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将来的には、より効率的に実装できるようになるでしょう。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの洪水と漏れのポイントを特定した後、水位とプールマップを変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リークポイントが見つかった場合、パーティクル（およびその「オーバーフロー」ボリューム）をリークポイントに移動して、再び下降を開始できるようにします。</font><font style="vertical-align: inherit;">その後、水位はリークポイントの高さまで下がります。</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-comment">//...</span><font></font>
<font></font>
    <span class="hljs-comment">//Drainage Point</span>
    <span class="hljs-keyword">if</span>(drainfound){<font></font>
<font></font>
      <span class="hljs-comment">//Set the Particle Position</span><font></font>
      pos = glm::vec2(drain/dim.y, drain%dim.y);<font></font>
<font></font>
      <span class="hljs-comment">//Set the New Waterlevel (Slowly)</span>
      <span class="hljs-keyword">double</span> drainage = <span class="hljs-number">0.001</span>;<font></font>
      plane = (<span class="hljs-number">1.0</span>-drainage)*initialplane + drainage*(height[drain] + pool[drain]);<font></font>
<font></font>
      <span class="hljs-comment">//Compute the New Height</span>
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; s: <span class="hljs-built_in">set</span>) <span class="hljs-comment">//Iterate over Set</span>
        pool[s] = (plane &gt; height[s])?(plane-height[s]):<span class="hljs-number">0.0</span>;<font></font>
<font></font>
      <span class="hljs-comment">//Remove some sediment</span>
      sediment *= <span class="hljs-number">0.1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//...</span></code></pre><br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏水により水位が低下した場合、これが低い漏水率で最もよく機能することがわかりました。</font><font style="vertical-align: inherit;">さらに、堆積岩の一部を除去することにより、実装が容易になります。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このため、プールに体積を追加すると、同じ体積がそこから押し出されるため、満たされたプールに入る新しい粒子は即座に体積をリークポイントに移動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リークポイントが見つからない場合は、テスト平面の下の体積を計算し、それを粒子の体積と比較します。</font><font style="vertical-align: inherit;">少ない場合は、粒子から体積を取り除き、水位を調整します。</font><font style="vertical-align: inherit;">次に、テスト平面が上昇します。</font><font style="vertical-align: inherit;">大きい場合、テスト面は低くなります。</font><font style="vertical-align: inherit;">このプロセスは、粒子がスペースを使い果たすか、リークポイントが見つかるまで繰り返されます。</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-comment">//...</span><font></font>
<font></font>
    <span class="hljs-comment">//Get Volume under Plane</span>
    <span class="hljs-keyword">double</span> tVol = <span class="hljs-number">0.0</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; s: <span class="hljs-built_in">set</span>)<font></font>
      tVol += volumeFactor*(plane - (height[s]+pool[s]));<font></font>
<font></font>
    <span class="hljs-comment">//We can partially fill this volume</span>
    <span class="hljs-keyword">if</span>(tVol &lt;= volume &amp;&amp; initialplane &lt; plane){<font></font>
<font></font>
      <span class="hljs-comment">//Raise water level to plane height</span>
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; s: <span class="hljs-built_in">set</span>)<font></font>
        pool[s] = plane - height[s];<font></font>
<font></font>
      <span class="hljs-comment">//Adjust Drop Volume</span><font></font>
      volume -= tVol;<font></font>
      tVol = <span class="hljs-number">0.0</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//Plane was too high and we couldn't fill it</span>
    <span class="hljs-keyword">else</span> fail--;<font></font>
<font></font>
    <span class="hljs-comment">//Adjust Planes</span>
    <span class="hljs-keyword">float</span> approach = <span class="hljs-number">0.5</span>;<font></font>
    initialplane = (plane &gt; initialplane)?plane:initialplane;<font></font>
    plane += approach*(volume-tVol)/(<span class="hljs-keyword">double</span>)<span class="hljs-built_in">set</span>.size()/volumeFactor;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//Couldn't place the volume (for some reason)- so ignore this drop.</span>
  <span class="hljs-keyword">if</span>(fail == <span class="hljs-number">0</span>)<font></font>
    volume = <span class="hljs-number">0.0</span>;<font></font>
<font></font>
} <span class="hljs-comment">//End of Flood Algorithm</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
平面の高さは、プールの表面積によって（つまり、セットのサイズによって）スケーリングされたボリュームの差に比例して調整されます。</font><font style="vertical-align: inherit;">近接係数を使用することにより、平面が正しい水位に到達する方法の安定性を高めることができます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侵食ラップ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
worldクラスには、3つのマップすべてが通常の配列の形式で含まれています。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">World</span> {</span><font></font>
<font></font>
<span class="hljs-keyword">public</span>:
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">generate</span><span class="hljs-params">()</span></span>;            <span class="hljs-comment">//Initialize</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">erode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cycles)</span></span>;     <span class="hljs-comment">//Erode with N Particles</span><font></font>
<font></font>
  <span class="hljs-comment">//...</span><font></font>
<font></font>
  <span class="hljs-keyword">double</span> heightmap[<span class="hljs-number">256</span>*<span class="hljs-number">256</span>] = {<span class="hljs-number">0.0</span>};
  <span class="hljs-keyword">double</span> waterstream[<span class="hljs-number">256</span>*<span class="hljs-number">256</span>] = {<span class="hljs-number">0.0</span>};
  <span class="hljs-keyword">double</span> waterpool[<span class="hljs-number">256</span>*<span class="hljs-number">256</span>] = {<span class="hljs-number">0.0</span>};<font></font>
<font></font>
};</code></pre><br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高さマップは、Perlinノイズを使用して初期化されます。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
個々の粒子の各水文学的ステップは、次のもので構成されています。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//...</span><font></font>
<font></font>
<span class="hljs-comment">//Spawn Particle</span>
glm::vec2 newpos = glm::vec2(rand()%(<span class="hljs-keyword">int</span>)dim.x, rand()%(<span class="hljs-keyword">int</span>)dim.y);
<span class="hljs-function">Drop <span class="hljs-title">drop</span><span class="hljs-params">(newpos)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">int</span> spill = <span class="hljs-number">5</span>;
<span class="hljs-keyword">while</span>(drop.volume &gt; drop.minVol &amp;&amp; spill != <span class="hljs-number">0</span>){<font></font>
<font></font>
  drop.descend(heightmap, waterstream, waterpool, track, dim, scale);<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(drop.volume &gt; drop.minVol)<font></font>
    drop.flood(heightmap, waterpool, dim);<font></font>
<font></font>
  spill--;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//...</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
流出パラメータは、パーティクルがプールに入ることができる回数を決定し、単純に破棄される前に再びプールを離れます。</font><font style="vertical-align: inherit;">それ以外の場合は、ボリュームがなくなると、パーティクルは消滅します。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">粒子がプールに入ったり、降下段階で完全に蒸発したりする前に1〜2回以上離れることはめったにありませんが、念のためこれを追加しました。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
侵食関数はこのコードをラップし、N個の粒子に対して水文学的ステップを実行して、フローマップを直接変更します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">World::erode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> N)</span></span>{<font></font>
<font></font>
  <span class="hljs-comment">//Track the Movement of all Particles</span>
  <span class="hljs-keyword">bool</span> track[dim.x*dim.y] = {<span class="hljs-literal">false</span>};<font></font>
<font></font>
  <span class="hljs-comment">//Simulate N Particles</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++){<font></font>
   <font></font>
    <span class="hljs-comment">//... simulate individual particle</span><font></font>
<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//Update Path</span>
  <span class="hljs-keyword">double</span> lrate = <span class="hljs-number">0.01</span>;  <span class="hljs-comment">//Adaptation Rate</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; dim.x*dim.y; i++)<font></font>
    waterstream[i] = (<span class="hljs-number">1.0</span>-lrate)*waterstream[i] + lrate*((track[i])?<span class="hljs-number">1.0</span>:<span class="hljs-number">0.0</span>);<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、トラック配列が降下関数に渡されます。</font><font style="vertical-align: inherit;">複数の粒子の動きと対応する変化を同時に追跡すると、フローマップの結果が改善されることがわかりました。</font><font style="vertical-align: inherit;">適応率は、古い情報が削除される速度を決定します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">木</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちょうど楽しみのために、侵食シミュレーションをさらに改善できるかどうかを確認するために木を追加しました。</font><font style="vertical-align: inherit;">それらはベクトルとして世界の教室に保存されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
木は、プールや強い小川がなく、地形がそれほど急ではない場所の地図上にランダムに作成されます。</font><font style="vertical-align: inherit;">彼らはまた、自分の周りに追加の木を作成する機会があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
樹木を作成する過程で、周囲の特定の半径にある植生の密度マップに書き込みます。</font><font style="vertical-align: inherit;">植生密度が高いため、下降粒子と地形の間の物質移動が減少します。</font><font style="vertical-align: inherit;">これは、根がどのように土を固定するかをシミュレートするためのものです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//... descend function</span>
<span class="hljs-keyword">double</span> effD = depositionRate*max(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>-treedensity[ind]);
<span class="hljs-comment">//...</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
木がプールにある場合、またはその下の小川が強すぎる場合、木は死にます。</font><font style="vertical-align: inherit;">さらに、彼らはランダムな死亡確率を持っています。</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/trees.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シェーディングと法線マップのおかげで、非常に単純な木のスプライトでさえ、レリーフをより美しくします。</font></font></i><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツリーモデルは、ファイル "vegetation.h"および関数 "World :: grow（）"にあります。</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の情報</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は、自家製のOpenGLラッパーを使用して視覚化され</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パーティクルは、必要な分布に応じてマップ上に作成できます。</font><font style="vertical-align: inherit;">私のデモでは、256×256のカードに均一に配布して作成しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に示すように、結果のシミュレーションは、元のレリーフの選択に大きく依存しています。</font><font style="vertical-align: inherit;">このシステムは、多数の自然現象をシミュレートできます。</font><font style="vertical-align: inherit;">峡谷だけでは十分に取れませんでした。</font><font style="vertical-align: inherit;">彼らは非常に長くて遅いシミュレーションを必要とするかもしれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
滝、蛇行、川の三角州、湖、土壌の膨潤など、他の現象がシステムで観察されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このシステムは、ランダムな場所ではなく、大量の雨が蓄積する場所に流れとプールをうまく分配することもできます。</font><font style="vertical-align: inherit;">したがって、生成された水文学は地形と密接に関連しています。</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="http://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/rivererosion.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">256×256グリッドのリアルタイム水文シミュレーション。</font><font style="vertical-align: inherit;">元のレリーフは比較的滑らかで、ストリームをすばやく表示できます。</font><font style="vertical-align: inherit;">最初に、プールとリークの最も単純な作成を観察できます。その後、大きなフローが現れて残ります。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流れを狭めることの効果の比較</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マップを侵食システムにリンクすることによって作成された違いを比較するために、さまざまな効果を含めて無効にする同じマップで水文学をシミュレートできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じ地形を3回シミュレーションしました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フローマップとプールマップを受け取るパーティクルベースの侵食（基本的な侵食）。</font><font style="vertical-align: inherit;">プールはまだ世代に影響を与えます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水文学マップによって変更されたパラメーターを使用した基本的な侵食（侵食と組み合わせて）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水文図によって変化し、樹木による侵食に影響を与えるパラメータと侵食の組み合わせ</font></font></li>
</ul><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これはかなり無秩序なシステムであり、表示される水文学のタイプは地形に大きく依存します。</font><font style="vertical-align: inherit;">浮き彫りの「非常に明白な」例を見つけるのは困難です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39e/e81/65c/39ee8165c1b4a8ca4f8a987e12464de4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本システムのレリーフレンダリング</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/969/6b2/fc0/9696b2fc03defb56681b7bfff7fa6740.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複合システム標高レンダリング</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/868/d7f/8bc/868d7f8bcd087c968833ba0a4c99619c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">木があるシステムの地形のレンダリング</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
興味深い観察：水文図と粒子パラメーターを組み合わせると、実際に河床が狭くなります。</font><font style="vertical-align: inherit;">特に平面領域では、粒子の分布が少なく、少量の強い流れに合流します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
摩擦と蒸発の減少は、粒子が既存のチャネルを好むようになるという事実にうまく対処します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その他の効果は、レリーフを直接観察することで、より明確になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a5/acd/d6b/9a5acdd6b7130655c66c716d0b713ec2.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベースシステムの水文地図</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5df/f5a/575/5dff5a575ae295091062b6e2153694ff.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複合システムの水文図</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d0/acb/8fa/9d0acb8fa508aa24afab3a5dddacf7a5.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">樹木を含むシステムの水文マップ</font></font></i><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの結果は、シミュレーション時間のちょうど60秒で生成されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
木はさらにナローイングに影響します。</font><font style="vertical-align: inherit;">彼らは急な地域で明確なパスを切り取るプロセスを強化します。</font><font style="vertical-align: inherit;">それらはストリームを既に敷設されたチャネルに留まらせるため、蛇行を減らします。</font><font style="vertical-align: inherit;">したがって、木の位置は水の動きに影響を与えます。</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Example_Hydrology2.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">木の位置がストリームの位置の維持にどのように役立つかを記録する例。</font><font style="vertical-align: inherit;">これは以前と同じ救済であり、すべての効果がアクティブになります。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プールの影響</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プールを作成するシステムは適切に機能し、高さが異なる複数の水域を同じレリーフに存在させることができます。</font><font style="vertical-align: inherit;">彼らはまた、互いにこぼれ出して空になることもあります。</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Pooling-1.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標高差が大きい、より粗いベースラインレリーフでのプールの形成のビデオの例。</font><font style="vertical-align: inherit;">上の湖は物理的に下の湖の上にあり、結果として生じた水を下の湖に直接排出します。</font></font></i><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3つの湖が順番にお互いに流れ込む種をいくつか入手しましたが、この記事に適した種を見つけるのに多くの時間を費やしたくありませんでした。</font><font style="vertical-align: inherit;">生成した写真やビデオが多すぎます。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時々、プールの高さのレベルがジャンプします。</font><font style="vertical-align: inherit;">これは、水位が漏水レベルに近く、大量の水が追加されたときに発生すると思います。</font><font style="vertical-align: inherit;">この影響は、フラッディング機能の漏れ率を減らすことで軽減できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/475/469/f09/475469f09d224928863b2b2eaf48cfb8.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに数分の世代の後、いくつかの新しいプールが独自に現れました。</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78a/36c/76e/78a36c76ed90db36cae64c47376fc585.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">急な角度では、盆地の高さの違いがより顕著になります。</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac8/bd1/897/ac8bd18976e9cb06bd8d6d1fffd23667.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水文図は、中央盆地が下部盆地に合流していることを明確に示しています。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フラッディングアルゴリズムを実行すると、プールはマップの境界に「壁」を見ることができます。</font><font style="vertical-align: inherit;">これは、上記の画像で顕著です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の可能な改善は、世界に海面を追加して、プールが海面でマップの端にあるリークを観察するようにすることです。それ以外の場合は、単にオーバーフローします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シミュレーション速度</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
降下とフラッディングの各ステップの時間は粒子ごとに異なりますが、約1桁（約1マイクロ秒）残ります。定常流では、パーティクルはマップ内をより速く移動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注ぐ操作が最もコストのかかるステップであるため、フラッディング時間はプールのサイズに比例して変化します。プールが大きいほど、水位を上げる必要のある領域が大きくなります。大きなプールは間違いなくシステムのボトルネックです。速度を上げるためのアイデアがあれば教えてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
降下時間は、マップのサイズと、摩擦や蒸発率など、他の多くのパラメーターに比例して変化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事のすべてのビデオはリアルタイムで記録されます。つまり、一般的にシミュレーションは高速です。</font></font><br>
<br>
<blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事の公開直後に、表面法線の計算方法を少し変更し、シミュレーション速度を向上させました。</font><font style="vertical-align: inherit;">これの影響はシミュレーション中に非常に顕著ですが、発射と洪水にかかる時間には大きな変動があるため、ベンチマークするのは困難です。</font><font style="vertical-align: inherit;">私の見積もりによると、シミュレーション速度は2倍になりました。</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より美しい動画</font></font></h3><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Hydrology1.mp4" type="video/mp4"></video></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不均一な垂直地形の水文学シミュレーション。</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Hydrology5.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少し滑らかなレリーフ。</font><font style="vertical-align: inherit;">一部の湖は少し変動していることがわかります。</font></font></i><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Hydrology3.mp4" type="video/mp4"></video></div></div></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平坦で滑らかな地形の水文学シミュレーション。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
後続のビデオは速度向上後に記録されました。</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Hydrology10.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに平坦で滑らかな地形。</font></font></i><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Hydrology7.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの接続されたストリームから形成された川のビデオ。</font><font style="vertical-align: inherit;">メインリバーには2つのポイントがあり、そこに小さなフローが組み込まれており、そのサイズがどのように成長するかがわかります。</font></font></i><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お使いのブラウザはHTML5ビデオをサポートしていません。</font></font><source src="https://weigert.vsos.ethz.ch/wp-content/uploads/2020/04/Hydrology9.mp4" type="video/mp4"></video></div></div></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">河川の形成によるより不均一なレリーフ。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は永遠に続けることができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論と未来への取り組み</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この単純な手法は依然としてパーティクルベースですが、多くの追加の効果をうまく伝えることに成功しています。流体力学を完全にシミュレートすることなく、大規模な水の動きを簡単にシミュレートできます。さらに、彼女は直感的な水モデルを使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シミュレーションでは、曲がりくねった川、滝、湖、および湖の輸血、デルタに平坦な領域に分かれる川などの外観を観察できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
侵食パラメータを取得できる土壌マップの形式でさまざまなタイプの土壌を追加することは興味深いでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ツリーシステムを簡単に変更して、土壌を固定するさまざまなタイプの木を作成することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成されたさまざまな結果をいくつかの写真やビデオで伝えるのは難しいので、自分で行う必要があります。非常に興味深いことがわかりました。</font><font style="vertical-align: inherit;">オクターブノイズやマップスケールなど、元のマップパラメーターを試すことをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
質問やコメントがありましたら、私に連絡してください。</font><font style="vertical-align: inherit;">私はこのプロジェクトにかなり一生懸命取り組んでいたので、私の頭脳は焼結しており、いくつかの興味深い側面を見逃していると確信しています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja498278/index.html">出版社ピーター。春のセール</a></li>
<li><a href="../ja498280/index.html">フェニックス属のドードー鳥の物語。ドードー大崩壊IS</a></li>
<li><a href="../ja498282/index.html">[手順] Googleサイトプラットフォームでアカウントとサイトを作成する</a></li>
<li><a href="../ja498284/index.html">英語学習を最適化する方法</a></li>
<li><a href="../ja498288/index.html">あなたの街には地下鉄バスが必要です</a></li>
<li><a href="../ja498292/index.html">PostgreSQLで大量にお金を節約する</a></li>
<li><a href="../ja498294/index.html">オブジェクト検出 認識し、支配する。パート1</a></li>
<li><a href="../ja498296/index.html">システムレベルでの設計。パート1.アイデアからシステムへ</a></li>
<li><a href="../ja498298/index.html">企業はバグ報奨金を使用してハッカーの沈黙を購入</a></li>
<li><a href="../ja498300/index.html">Blitz.Engine：アセットシステム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>