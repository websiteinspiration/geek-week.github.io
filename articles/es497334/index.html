<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñïüèæ üë©üèº‚Äçüé® üôéüèº Los errores notorios y c√≥mo evitarlos en el ejemplo de ClickHouse ‚ö±Ô∏è üíÄ üëáüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si est√° escribiendo c√≥digo, prep√°rese para los problemas. Definitivamente lo ser√°n, y se debe esperar de todos lados: desde su c√≥digo y compilador, de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Los errores notorios y c√≥mo evitarlos en el ejemplo de ClickHouse</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/497334/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si est√° escribiendo c√≥digo, prep√°rese para los problemas. </font><font style="vertical-align: inherit;">Definitivamente lo ser√°n, y se debe esperar de todos lados: desde su c√≥digo y compilador, desde el sistema operativo y el hardware, y los usuarios a veces arrojan "sorpresas". </font><font style="vertical-align: inherit;">Si escalaste el cl√∫ster a escalas c√≥smicas, entonces espera errores de "espacio". </font><font style="vertical-align: inherit;">Especialmente cuando se trata de datos del tr√°fico de Internet.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/ooBAQIe0KlQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexey Milovidov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o6CuFl2Q</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) hablar√° sobre los problemas m√°s rid√≠culos, desalentadores y desesperados de su experiencia en el desarrollo y soporte de ClickHouse. </font><font style="vertical-align: inherit;">Veamos c√≥mo tuvieron que depurarse y qu√© medidas deber√≠an tomar los desarrolladores desde el principio, para que hubiera menos problemas.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores notorios</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si escribi√≥ alg√∫n c√≥digo, prep√°rese para los problemas de inmediato. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores en el c√≥digo.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ser√°n requeridos. Pero supongamos que escribi√≥ el c√≥digo perfecto, compilado, pero aparecer√°n errores </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el compilador</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y el c√≥digo no funcionar√° correctamente. Arreglamos el compilador, todo compilado, ejec√∫telo. Pero (inesperadamente) todo funciona incorrectamente, porque </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tambi√©n hay errores en el n√∫cleo del sistema operativo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si no hay errores en el sistema operativo, inevitablemente, estar√°n </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el hardware</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Incluso si escribi√≥ el c√≥digo perfecto que funciona perfectamente en el hardware perfecto, a√∫n encontrar√° problemas, por ejemplo, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">errores de configuraci√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Parece que hiciste todo bien, pero alguien cometi√≥ un error en el archivo de configuraci√≥n y no todo vuelve a funcionar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se hayan corregido todos los errores, los usuarios lo terminar√°n, porque constantemente usan su c√≥digo "incorrectamente". </font><font style="vertical-align: inherit;">Pero el problema definitivamente no est√° en los usuarios, sino en el c√≥digo: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escribiste algo que es dif√≠cil de usar</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos estos errores con algunos ejemplos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores de configuraci√≥n</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminaci√≥n de datos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El primer caso de la pr√°ctica. Afortunadamente, no es m√≠o y no Yandex, no te preocupes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introductorio primero. La arquitectura de reducci√≥n de mapas de un cl√∫ster (como Hadoop) consta de varios servidores de datos (nodos de datos) que almacenan datos, y uno o m√°s servidores maestros que conocen la ubicaci√≥n de todos los datos en los servidores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los nodos de datos conocen la direcci√≥n del maestro y se conectan a ella. El asistente monitorea d√≥nde y qu√© datos deben ubicarse, y da diferentes comandos a los nodos de datos: "Descargue los datos X, debe tener los datos Y y elimine los datos Z". ¬øQu√© puede salir mal?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se carg√≥ un nuevo archivo de configuraci√≥n a todos los nodos de datos, se conectaron por error al maestro desde otro cl√∫ster, y no al suyo. </font><font style="vertical-align: inherit;">El maestro examin√≥ los datos sobre los cuales se informaron los nodos de datos, decidi√≥ que los datos eran incorrectos y deber√≠an eliminarse. </font><font style="vertical-align: inherit;">El problema se not√≥ cuando se borr√≥ la mitad de los datos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s8/ii/6i/s8ii6igrww4j3zdjhrfyyqrl2nk.png" width="350"></div><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los errores m√°s √©picos son aquellos que conducen a la eliminaci√≥n accidental de datos.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evitar esto es muy simple. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No elimine datos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por ejemplo, reservar en un directorio separado o eliminar con retraso. Primero, transferimos para que no sean visibles para el usuario, y si descubre que algo ha desaparecido en unos d√≠as, lo devolveremos. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No elimine datos inesperados si se desconoce la causa</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Limite program√°ticamente el inicio de la eliminaci√≥n de datos desconocidos: inesperados, con nombres extra√±os o si hay demasiados. El administrador notar√° que el servidor no se inicia y escribe alg√∫n mensaje, y lo comprender√°. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el programa realiza acciones destructivas, a√≠sle las pruebas y la producci√≥n a nivel de red</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(iptables) Por ejemplo, eliminar archivos o enviar correos electr√≥nicos es una acci√≥n destructiva porque ‚Äúdevorar√°‚Äù la atenci√≥n de alguien. Ponles un umbral: se pueden enviar cien cartas, y por mil pon una casilla de seguridad, que se establece antes de que ocurra algo terrible. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraciones</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El segundo ejemplo ya es de mi pr√°ctica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una buena compa√±√≠a de alguna manera ten√≠a un extra√±o cl√∫ster de ClickHouse. Lo extra√±o era que las r√©plicas no se sincronizaban. Cuando se reinici√≥ el servidor, no se inici√≥ y apareci√≥ un mensaje de que todos los datos eran incorrectos: "Hay muchos datos inesperados, no comenzar√©. Debemos establecer la bandera </font></font><code>force_restore_data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y resolverlo ".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nadie pudo resolverlo en la empresa, solo pusieron la bandera. Al mismo tiempo, la mitad de los datos desaparecieron en alguna parte, lo que result√≥ en gr√°ficos con lagunas. Los desarrolladores se volvieron hacia m√≠, pens√© que algo interesante estaba sucediendo y decid√≠ investigar. Cuando amaneci√≥ unas horas m√°s tarde y los p√°jaros comenzaron a cantar fuera de la ventana, me di cuenta de que no entend√≠a nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El servidor ClickHouse utiliza el servicio ZooKeeper para la coordinaci√≥n. ClickHouse almacena datos y ZooKeeper determina en qu√© servidores deben estar los datos: almacena metadatos sobre qu√© datos deben estar en qu√© r√©plica. ZooKeeper tambi√©n es un cl√∫ster: se replica de acuerdo con un algoritmo de consenso distribuido muy bueno, con una consistencia estricta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como regla general, ZooKeeper tiene 3 m√°quinas, a veces 5. En la configuraci√≥n ClickHouse, todas las m√°quinas se indican a la vez, la conexi√≥n se establece con una m√°quina aleatoria, interact√∫a con ella y este servidor replica todas las solicitudes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQue pas√≥? La compa√±√≠a ten√≠a tres servidores ZooKeeper. Pero no funcionaron como un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grupo de tres nodos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sino como </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tres nodos independientes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : tres grupos de un nodo. One ClickHouse se conecta a un servidor y escribe datos. Las r√©plicas quieren descargar estos datos, pero no se encuentran en ninguna parte. Al reiniciar, el servidor se conecta a otro ZooKeeper: ve que los datos con los que trabaj√≥ antes son superfluos, deben posponerse en alg√∫n lugar. No los elimina, sino que los transfiere a un directorio separado; en ClickHouse, los datos no se eliminan tan f√°cilmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decido arreglar la configuraci√≥n de ZooKeeper. </font><font style="vertical-align: inherit;">Renombro todos los datos y solicito </font></font><code>ATTACH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partes de los datos del directorio </font></font><code>detached/unexpeted_*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, se restauraron todos los datos, las r√©plicas se sincronizaron, no hubo p√©rdidas, los gr√°ficos fueron continuos. </font><font style="vertical-align: inherit;">La compa√±√≠a est√° satisfecha, agradecida, como si ya hubieran olvidado c√≥mo todo hab√≠a funcionado mal antes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos fueron simples errores de configuraci√≥n. </font><font style="vertical-align: inherit;">M√°s errores estar√°n en el c√≥digo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores en el c√≥digo</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribimos c√≥digo en C ++. </font><font style="vertical-align: inherit;">Esto significa que ya tenemos problemas.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El siguiente ejemplo es un error real de producci√≥n en </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el cl√∫ster Yandex.Metrica</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2015), una consecuencia del c√≥digo C ++. </font><font style="vertical-align: inherit;">El error fue que a veces el usuario en lugar de responder a la solicitud recibi√≥ un mensaje de error:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"La suma de verificaci√≥n no coincide, los datos da√±ados" - la suma de verificaci√≥n no coincide, los datos est√°n rotos - ¬°da miedo!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"LRUCache se volvi√≥ inconsistente. </font><font style="vertical-align: inherit;">Debe haber un error en √©l ‚Äù: el cach√© se volvi√≥ inconsistente, probablemente un error en √©l.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo que escribimos se informa de que hay un error all√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"La </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suma de comprobaci√≥n no coincide, los datos da√±ados</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Las sumas de verificaci√≥n de los bloques de datos comprimidos se verifican antes de descomprimirse. </font><font style="vertical-align: inherit;">Por lo general, este error aparece cuando los datos se rompen en el sistema de archivos. </font><font style="vertical-align: inherit;">Por varias razones, algunos archivos resultan ser basura cuando se reinicia el servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero aqu√≠ hay otro caso: le√≠ el archivo manualmente, la suma de verificaci√≥n coincide, no hay error. </font><font style="vertical-align: inherit;">Una vez aparecido, el error se reproduce de manera estable a pedido repetido. </font><font style="vertical-align: inherit;">Cuando el servidor se reinicia, el error desaparece por un tiempo y luego vuelve a aparecer de manera estable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQuiz√°s el asunto est√° en la RAM? </font><font style="vertical-align: inherit;">Una situaci√≥n t√≠pica es cuando los bits est√°n latiendo en ella. </font><font style="vertical-align: inherit;">Miro en </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dmesg</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(kern.log), pero no hay excepciones de comprobaci√≥n de m√°quina: generalmente escriben cuando algo est√° mal con la RAM. Si el servidor hubiera superado la RAM, no solo mi programa funcionar√≠a incorrectamente, sino que todos los dem√°s generar√≠an errores al azar. Sin embargo, no hay otras manifestaciones del error. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"LRUCache se volvi√≥ inconsistente. Debe haber un error en √©l ".</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este es un claro error en el c√≥digo, y estamos escribiendo en C ++, ¬øquiz√°s acceso a la memoria? Pero las pruebas bajo AddressSanitizer, ThreadSanitizer, MemorySanitizer, UndefinedBehaviorSanitizer en CI no muestran nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQuiz√°s algunos casos de prueba no est√°n cubiertos? Recopilo el servidor con AddressSanitizer, lo ejecuto en producci√≥n, no detecta nada. Durante alg√∫n tiempo, el error se borra restableciendo alguna cach√© de marcas (cach√© de sobres).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las reglas de programaci√≥n dice: si no est√° claro cu√°l es el error, mire de cerca el c√≥digo, esperando encontrar algo all√≠. Lo hice, encontr√© un error, lo arregl√©, no ayud√≥. Miro a otro lugar en el c√≥digo, tambi√©n hay un error. Corregido, nuevamente no ayud√≥. Arregl√© algunos m√°s, el c√≥digo mejor√≥, ¬°pero el error a√∫n no desapareci√≥! </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Porque.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Intentar encontrar un patr√≥n por servidor, por tiempo, por la naturaleza de la carga, nada ayuda. Luego se dio cuenta de que el problema se manifiesta solo en uno de los grupos, y nunca en los otros. El error no se reproduce con tanta frecuencia, pero siempre aparece en un cl√∫ster despu√©s de un reinicio, y todo est√° limpio en el otro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result√≥ que la raz√≥n es que en el cl√∫ster "problem√°tico" utilizaron una nueva caracter√≠stica: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diccionarios de cach√©</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Utilizan el </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asignador de</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memoria escrito a mano </font><strong><font style="vertical-align: inherit;">ArenaWithFreeLists</font></strong><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No solo escribimos en C ++, sino que tambi√©n vimos alg√∫n tipo de asignadores personalizados: nos condenamos a los problemas dos veces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ArenaWithFreeLists es una parte de la memoria en la que la memoria se asigna consecutivamente en tama√±os divisibles por dos: 16, 32, 64 bytes. </font><font style="vertical-align: inherit;">Si se libera memoria, forman una lista individualmente vinculada de bloques gratuitos de FreeLists. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Miremos el c√≥digo.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArenaWithFreeLists</span>
{</span>
    Block * free_lists[<span class="hljs-number">16</span>] {};
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">sizeToPreviousPowerOfTwo</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> size)</span>
    </span>{
        <span class="hljs-keyword">return</span> _bit_scan_reverse(size - <span class="hljs-number">1</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">char</span> * <span class="hljs-title">alloc</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> size)</span>
    </span>{
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> list_idx = findFreeListIndex(size);<font></font>
        free_lists[list_idx] -&gt;...<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto utiliza la funci√≥n de </font></font><code>_bit_scan_reverse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subrayado al principio.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay una regla no escrita: "Si una funci√≥n tiene un gui√≥n bajo al principio, lea la documentaci√≥n una vez, y si hay dos, l√©ala dos veces".</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escuchamos y leemos la documentaci√≥n: ‚Äúint _bit_scan_reverse (int a). Establezca dst en el √≠ndice del bit de ajuste m√°s alto en un entero de 32 bits a. Si no se establecen bits en a, entonces dst </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° </font><strong><font style="vertical-align: inherit;">definido</font></strong><font style="vertical-align: inherit;"> ". Parece que hemos encontrado un problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En C ++, esta situaci√≥n se considera imposible para el compilador. El compilador puede usar un comportamiento indefinido, esta "imposibilidad", como una suposici√≥n para optimizar el c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El compilador no hace nada malo: honestamente genera instrucciones de ensamblaje </font></font><code>bsr %edi, %eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pero, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si el operando es cero, la instrucci√≥n tiene </font></font></strong><code><strong>bsr</strong></code><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un comportamiento indefinido no a nivel de C ++, sino a nivel de CPU.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si el registro de origen es cero, entonces el registro de destino no cambia: hab√≠a algo de basura en la entrada, esta basura tambi√©n permanecer√° en la salida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resultado depende de d√≥nde el compilador coloca esta instrucci√≥n. </font><font style="vertical-align: inherit;">A veces, una funci√≥n con esta instrucci√≥n est√° en l√≠nea, a veces no. </font><font style="vertical-align: inherit;">En el segundo caso, habr√° algo como este c√≥digo:</font></font><br>
<br>
<pre><code class="cpp hljs">bsrl %edi, %eax<font></font>
retq</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego mir√© un ejemplo de c√≥digo similar en mi binario usando </font></font><code>objdump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lq/6k/4f/lq6k4fg0lwpm2nhwhxbyauyjt2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n los resultados, veo que a veces el registro de origen y el registro de destino son iguales. </font><font style="vertical-align: inherit;">Si hubo cero, entonces el resultado tambi√©n ser√° cero: todo est√° bien. </font><font style="vertical-align: inherit;">Pero a veces los registros son diferentes, y el resultado ser√° basura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo se manifiesta este error?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usamos basura como √≠ndice en la matriz FreeLists. </font><font style="vertical-align: inherit;">En lugar de una matriz, vamos a alguna direcci√≥n distante y obtenemos acceso a la memoria.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somos afortunados, casi todas las direcciones cercanas est√°n llenas de datos de la cach√©; la estropeamos. </font><font style="vertical-align: inherit;">El cach√© contiene compensaciones de archivos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leemos archivos en el desplazamiento incorrecto. </font><font style="vertical-align: inherit;">Del desplazamiento incorrecto, obtenemos la suma del cheque. </font><font style="vertical-align: inherit;">Pero no hay una suma de verificaci√≥n, sino algo m√°s: esta suma de verificaci√≥n no coincidir√° con los siguientes datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recibimos el error "La suma de comprobaci√≥n no coincide, los datos da√±ados".</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, no los datos est√°n da√±ados, sino solo el cach√© en la RAM. </font><font style="vertical-align: inherit;">Nos informaron de inmediato sobre el error, porque verificamos y sumamos los datos. </font><font style="vertical-align: inherit;">El error fue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corregido</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> el 27 de diciembre de 2015 y fue a celebrar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, el c√≥digo incorrecto puede al menos repararse. </font><font style="vertical-align: inherit;">Pero, ¬øc√≥mo solucionar errores en el hardware?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bichos en hierro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos ni siquiera son errores, sino leyes f√≠sicas, efectos inevitables. Seg√∫n las leyes f√≠sicas, el hierro es inevitablemente defectuoso. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escritura no at√≥mica en RAID</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por ejemplo, creamos RAID1. Se compone de dos discos duros. Esto significa que un servidor es un sistema distribuido: los datos se escriben en un disco duro y en otro. Pero, ¬øqu√© pasa si los datos se escriben en un disco y se pierde energ√≠a mientras se graba en el segundo? Los datos en una matriz RAID1 no ser√°n consistentes. No podremos entender qu√© datos son correctos, porque leeremos un byte u otro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede lidiar con esto colocando el registro. Por ejemplo, en ZFS este problema est√° resuelto, pero m√°s sobre eso m√°s adelante. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">putrefacci√≥n de bits en HDD y SSD</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Los bits en los discos duros y en los SSD pueden salir mal as√≠ como as√≠. Los SSD modernos, especialmente aquellos con celdas de varios niveles, est√°n dise√±ados para garantizar que las celdas se deterioren constantemente. Los c√≥digos de correcci√≥n de errores ayudan, pero a veces las c√©lulas se deterioran tanto y tanto que incluso esto no se guarda. Se obtienen errores no detectados. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit voltea en RAM</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pero ¬øqu√© pasa con ECC?). En la RAM de los servidores, los bits tambi√©n est√°n da√±ados. Tambi√©n tiene c√≥digos de correcci√≥n de errores. Cuando se producen errores, generalmente son visibles desde los mensajes en el registro del kernel de Linux en dmesg. Cuando haya muchos errores, veremos algo como: "Se han solucionado N millones de errores con memoria". Pero los bits individuales no se notar√°n, y seguramente algo tendr√° errores. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit voltea a nivel de CPU y red</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Hay errores a nivel de CPU, en cach√©s de CPU y, por supuesto, al transmitir datos a trav√©s de una red.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo suelen manifestarse los errores de hierro? El ticket " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un znode con formato incorrecto impide que ClickHouse se inicie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">llega a GitHub </font><font style="vertical-align: inherit;">: los datos en el nodo ZooKeeper est√°n da√±ados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ZooKeeper, usualmente escribimos algunos metadatos en texto plano. Hay algo mal con √©l: " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©plica</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " est√° escrita muy extra√±a. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8_/gk/zk/8_gkzkxlb1dzwhiph0saer-0d50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Raramente sucede que debido a un error en el c√≥digo, un bit cambia. Por supuesto, podemos escribir este c√≥digo: tomamos el filtro Bloom, cambiamos el bit en ciertas direcciones, calculamos las direcciones incorrectamente, cambiamos el bit incorrecto, cae en algunos datos. Eso es todo, ahora en ClickHouse no es " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">replica"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sino " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repli </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " y en √©l todos los datos est√°n equivocados. Pero generalmente, un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambio en un bit es un s√≠ntoma de problemas de hierro</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s conoces el ejemplo de bitsquatting. </font><font style="vertical-align: inherit;">Artyom Dinaburg </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hizo un experimento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : hay dominios en Internet que tienen mucho tr√°fico, aunque los usuarios no van a estos dominios por su cuenta. </font><font style="vertical-align: inherit;">Por ejemplo, dicho dominio FB-CDN.com es un CDN de Facebook. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artyom registr√≥ un dominio similar (y muchos otros), pero cambi√≥ un poco. </font><font style="vertical-align: inherit;">Por ejemplo, FA-CDN.com en lugar de FB-CDN.com. </font><font style="vertical-align: inherit;">El dominio no se public√≥ en ninguna parte, pero el tr√°fico lleg√≥ a √©l. </font><font style="vertical-align: inherit;">En ocasiones, el host FB-CDN se escribi√≥ en los encabezados HTTP y la solicitud se envi√≥ a otro host debido a errores en la RAM de los dispositivos de los usuarios. </font><font style="vertical-align: inherit;">La RAM con correcci√≥n de errores no siempre ayuda. </font><font style="vertical-align: inherit;">A veces incluso interfiere y conduce a vulnerabilidades (lea sobre Rowhammer, ECCploit, RAMBleed).</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n: siempre verifique y sume los datos usted mismo.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al escribir en el sistema de archivos, verifique la suma sin fallar. </font><font style="vertical-align: inherit;">Al transmitir a trav√©s de la red, compruebe tambi√©n el resumen, no espere que haya sumas de comprobaci√≥n all√≠.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√°s errores! ..</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©trica del cl√∫ster de producci√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Los usuarios en respuesta a una solicitud a veces obtienen una excepci√≥n: "La suma de verificaci√≥n no coincide: datos da√±ados": la suma de verificaci√≥n no es correcta, los datos est√°n da√±ados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/lb/wz/jylbwzqxrbk-g3hgygq4bktgdr8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El mensaje de error muestra datos detallados: qu√© cantidad de cheque se esperaba, qu√© cantidad de cheque est√° realmente en estos datos, el tama√±o del bloque para el que verificamos el monto del cheque y el contexto de excepci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando recibimos el paquete a trav√©s de la red de alg√∫n servidor, apareci√≥ una excepci√≥n: parece familiar. </font><font style="vertical-align: inherit;">Quiz√°s de nuevo pasando por la memoria, la condici√≥n de la carrera u otra cosa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta excepci√≥n apareci√≥ en 2015. El error fue corregido, ya no apareci√≥. En febrero de 2019, apareci√≥ de nuevo de repente. En este momento estaba en una de las conferencias, mis colegas trataron el problema. El error se reprodujo varias veces al d√≠a entre 1000 servidores con ClickHouse: no es posible recopilar estad√≠sticas en un servidor y luego en otro. Al mismo tiempo, no hubo nuevos lanzamientos en este momento. No funcion√≥ y resolvi√≥ el problema, pero despu√©s de unos d√≠as el error desapareci√≥. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se olvidaron del error y, el 15 de mayo de 2019, se repiti√≥. Continuamos tratando con ella. Lo primero que hice fue mirar todos los registros y gr√°ficos disponibles. Los estudi√≥ todo el d√≠a, no entendi√≥ nada, no encontr√≥ ning√∫n patr√≥n. Si el problema no se puede reproducir, la √∫nica opci√≥n es recopilar todos los casos, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buscar patrones</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y adicciones </font><font style="vertical-align: inherit;">Quiz√°s el kernel de Linux no funciona correctamente con el procesador, guarda o carga incorrectamente cualquier registro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hip√≥tesis y patrones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 de los 9 servidores con E5-2683 v4 fallaron. Pero del error propenso, solo aproximadamente la mitad del E5-2683 v4 es una hip√≥tesis vac√≠a. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los errores generalmente no se repiten</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Adem√°s del cl√∫ster mtauxyz, donde de hecho hay datos da√±ados (datos incorrectos en el disco). Este es otro caso, rechazamos la hip√≥tesis. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El error no depende del kernel de Linux</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : comprobado en diferentes servidores, no encontr√≥ nada. Nada interesante en kern.log, </font></font><code>machine check exception</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sin </font><font style="vertical-align: inherit;">mensajes </font><font style="vertical-align: inherit;">. En gr√°ficos de red, incluidos retransmisores, CPU, IO, Red, nada interesante. Todos los adaptadores de red en los servidores en los que se producen errores y no aparecen son los mismos. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No hay patrones</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ¬øQu√© hacer? Contin√∫a buscando patrones. Segundo intento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Miro los servidores de tiempo de actividad:</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el tiempo de actividad es alto, los servidores funcionan de manera estable</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por defecto y algo as√≠ no lo es. Siempre me alegro cuando veo que el programa se bloque√≥ con segfault, al menos se bloque√≥. Peor a√∫n, cuando hay un error, estropea algo, pero nadie lo nota. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los errores se agrupan por d√≠a</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y ocurren dentro de un par de d√≠as. En unos 2 d√≠as, aparecen m√°s, en algunos menos, luego de nuevo m√°s: no es posible determinar con precisi√≥n el momento en que se producen los errores. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunos errores coinciden con los paquetes y el monto del cheque que esper√°bamos.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La mayor√≠a de los errores tienen solo dos opciones de paquete. Tuve suerte porque en el mensaje de error agregamos el valor de la suma de verificaci√≥n, lo que ayud√≥ a compilar estad√≠sticas. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin patrones de servidor</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de donde leemos los datos. El tama√±o del bloque comprimido que verificamos suma es inferior a un kilobyte. Mir√© los tama√±os de paquete en HEX. Esto no fue √∫til para m√≠: la representaci√≥n binaria de los tama√±os de paquetes y las sumas de verificaci√≥n no se nota. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No solucion√© el error. Estaba buscando patrones nuevamente. Tercer intento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por alguna raz√≥n, el error aparece solo </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en uno de los grupos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : en las terceras r√©plicas en Vladimir DC (nos gusta llamar a los centros de datos por nombres de ciudades). En febrero de 2019, tambi√©n apareci√≥ un error en Vladimirs DC, pero en una versi√≥n diferente de ClickHouse. Este es otro argumento en contra de la hip√≥tesis de que escribimos el c√≥digo incorrecto. Ya lo reescribimos tres veces de febrero a mayo; el </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">error probablemente no est√° en el c√≥digo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los errores al leer paquetes a trav√©s de la red:</font></font><code>while receiving packet from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">El paquete en el que ocurri√≥ el error depende de la estructura de la solicitud. </font><font style="vertical-align: inherit;">Para solicitudes que difieren en estructura, un error en diferentes sumas de verificaci√≥n. </font><font style="vertical-align: inherit;">Pero en las solicitudes donde el error est√° en la misma suma de verificaci√≥n, las constantes difieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas las solicitudes con un error, excepto una, son </font></font><code>GLOBAL JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pero para comparar, hay una solicitud inusualmente simple, y el tama√±o del bloque comprimido es solo de 75 bytes.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(ReceiveTimestamp) <span class="hljs-keyword">FROM</span> tracking_events_all 
<span class="hljs-keyword">WHERE</span> APIKey = <span class="hljs-number">1111</span> <span class="hljs-keyword">AND</span> (OperatingSystem <span class="hljs-keyword">IN</span> (<span class="hljs-string">'android'</span>, <span class="hljs-string">'ios'</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rechazamos la hip√≥tesis de la influencia </font></font><code>GLOBAL JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s interesante es que los servidores afectados </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se agrupan en rangos por sus nombres</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<code>mtxxxlog01-{39..44 57..58 64 68..71 73..74 76}-3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estaba cansado y desesperado, comenc√© a buscar patrones completamente delirantes. </font><font style="vertical-align: inherit;">Es bueno que no haya podido depurar el c√≥digo usando la numerolog√≠a. </font><font style="vertical-align: inherit;">Pero todav√≠a hab√≠a pistas.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los grupos de servidores problem√°ticos son los mismos que en febrero.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los servidores problem√°ticos se encuentran en ciertas partes del centro de datos. </font><font style="vertical-align: inherit;">En DC Vladimir hay las llamadas l√≠neas, sus diferentes partes: VLA-02, VLA-03, VLA-04. </font><font style="vertical-align: inherit;">Los errores est√°n claramente agrupados: en algunas colas es bueno (VLA-02), en otros problemas (VLA-03, VLA-04).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depuraci√≥n de mecanograf√≠a</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo quedaba depurar usando el m√©todo de "lanza". </font><font style="vertical-align: inherit;">Esto significa formar la hip√≥tesis "¬øQu√© sucede si intentas hacerlo?" </font><font style="vertical-align: inherit;">y recopilar datos. </font><font style="vertical-align: inherit;">Por ejemplo, encontr√© una </font></font><code>query_log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consulta simple con un error </font><font style="vertical-align: inherit;">en la tabla </font><font style="vertical-align: inherit;">para la cual el tama√±o del paquete es </font></font><code>size of compressed block</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muy peque√±o (= 107). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cs/zz/fd/cszzfdvfkob2rhon1-n_xfnqtn4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tom√© la solicitud, la copi√© y la ejecut√© manualmente usando clickhouse-local.</font></font><br>
<br>
<pre><code class="sql hljs">strace -f -e trace=network -s 1000 -x \<font></font>
clickhouse-local <span class="hljs-comment">--query "</span>
    <span class="hljs-keyword">SELECT</span> uniqIf(DeviceIDHash, SessionType = <span class="hljs-number">0</span>)
    <span class="hljs-keyword">FROM</span> remote(<span class="hljs-string">'127.0.0.{2,3}'</span>, mobile.generic_events)
    <span class="hljs-keyword">WHERE</span> StartDate = <span class="hljs-string">'2019-02-07'</span> <span class="hljs-keyword">AND</span> APIKey <span class="hljs-keyword">IN</span> (<span class="hljs-number">616988</span>,<span class="hljs-number">711663</span>,<span class="hljs-number">507671</span>,<span class="hljs-number">835591</span>,<span class="hljs-number">262098</span>,<span class="hljs-number">159700</span>,<span class="hljs-number">635121</span>,<span class="hljs-number">509222</span>)
        <span class="hljs-keyword">AND</span> EventType = <span class="hljs-number">1</span> <span class="hljs-keyword">WITH</span> TOTALS<span class="hljs-string">" --config config.xml</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la ayuda de strace recib√≠ una instant√°nea (volcado) de bloques a trav√©s de la red, exactamente los mismos paquetes que se reciben cuando se ejecuta esta solicitud, y puedo estudiarlos. Puede usar tcpdump para esto, pero es inconveniente: es dif√≠cil aislar una solicitud espec√≠fica del tr√°fico de producci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando strace, puede rastrear el servidor ClickHouse. Pero este servidor funciona en producci√≥n, si hago esto obtendr√© una variedad de informaci√≥n incomprensible. Por lo tanto, lanc√© un programa separado que ejecuta exactamente una solicitud. Ya para este programa ejecuto strace y obtengo lo que se transmiti√≥ a trav√©s de la red. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La solicitud se ejecuta sin errores; el error no se reproduce</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si se reproduce, el problema se resolver√≠a. Por lo tanto, copi√© los paquetes en un archivo de texto y comenc√© a analizar el protocolo manualmente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f5/0y/-8/f50y-8qvloj4brnns-nvgydpbsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El monto del cheque fue el mismo que se esperaba. </font><font style="vertical-align: inherit;">Este es exactamente el paquete en el que a veces, en otro momento, en otras solicitudes, se produjeron errores. </font><font style="vertical-align: inherit;">Pero hasta ahora no ha habido errores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escrib√≠ un programa simple que toma un paquete y verifica la cantidad del cheque al reemplazar un bit en cada byte. </font><font style="vertical-align: inherit;">El programa realiz√≥ un cambio de bit en cada posici√≥n posible y ley√≥ la cantidad del cheque. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3m/fn/wr/3mfnwrp1udvm_ecrw0lnpcyoz0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenc√© el programa y descubr√≠ que si cambias el valor de un bit, obtienes exactamente esa suma de verificaci√≥n rota, por lo que hay una queja</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema de hardware</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hay un error en el software (por ejemplo, conducir a trav√©s de la memoria), es improbable que se invierta un bit. </font><font style="vertical-align: inherit;">Por lo tanto, apareci√≥ una nueva hip√≥tesis: el problema est√° en la gl√°ndula. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uno podr√≠a cerrar la tapa de la computadora port√°til y decir: "El problema no est√° de nuestro lado, sino en el hardware, no hacemos esto". </font><font style="vertical-align: inherit;">Pero no, intentemos comprender d√≥nde est√° el problema: en la RAM, en el disco duro, en el procesador, en la tarjeta de red o en la RAM de la tarjeta de red en el equipo de red. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo localizar un problema de hardware?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El problema surgi√≥ y desapareci√≥ en ciertas fechas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidores afectados se agrupan por sus nombres: </font></font><code>mtxxxlog01-{39..44 57..58 64 68..71 73..74 76}-3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los grupos de servidores problem√°ticos son los mismos que en febrero.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los servidores con problemas solo se encuentran en ciertas colas del centro de datos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubo preguntas para los ingenieros de redes: los datos est√°n latiendo en los conmutadores de red. Resulta que los ingenieros de red intercambiaron conmutadores por otros exactamente en esas fechas. Despu√©s de una pregunta, los reemplazaron con los anteriores y el problema desapareci√≥. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema est√° resuelto, pero a√∫n quedan preguntas (ya no son para ingenieros). </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© no ayuda ECC (memoria de correcci√≥n de errores) en los conmutadores de red?</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Debido a que la inversi√≥n de m√∫ltiples bits puede compensarse entre s√≠, se obtiene un error no detectado. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© no ayudan las sumas de comprobaci√≥n de TCP?</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ellos son debiles. Si solo un bit ha cambiado en los datos, las sumas de verificaci√≥n TCP siempre ver√°n el cambio. Si dos bits han cambiado, entonces los cambios pueden no detectarse: se cancelan entre s√≠.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo un bit ha cambiado en nuestro paquete, pero el error no es visible. Esto se debe a que 2 bits cambiaron en el segmento TCP: calcularon la suma de verificaci√≥n a partir de √©l, coincidi√≥. Pero en un segmento TCP se encuentra m√°s de un paquete de nuestra aplicaci√≥n. Y para uno de ellos, ya consideramos nuestra suma de verificaci√≥n. Solo un bit ha cambiado en este paquete. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© las sumas de verificaci√≥n de Ethernet no ayudan? ¬øSon m√°s fuertes que TCP? </font></font></strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cantidad de comprobaci√≥n de Ethernet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique y resuma los datos para que no se rompan durante la transmisi√≥n a trav√©s de un segmento (puedo estar equivocado con la terminolog√≠a, no soy un ingeniero de red). </font><font style="vertical-align: inherit;">El equipo de red reenv√≠a estos paquetes y puede reenviar algunos datos durante el reenv√≠o. </font><font style="vertical-align: inherit;">Por lo tanto, los montos de los cheques son simplemente contados. </font><font style="vertical-align: inherit;">Verificamos: en el cable los paquetes no han cambiado. </font><font style="vertical-align: inherit;">Pero si golpean el conmutador de red en s√≠, volver√° a calcular la cantidad del cheque (ser√° diferente) y reenviar√° el paquete a√∫n m√°s.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nada te salvar√°, comprueba t√∫ mismo. </font><font style="vertical-align: inherit;">No esperes que alguien haga esto por ti.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para los bloques de datos, se considera una suma de verificaci√≥n de 128 bits (esta exageraci√≥n por si acaso). </font><font style="vertical-align: inherit;">Informamos correctamente al usuario sobre el error. </font><font style="vertical-align: inherit;">Los datos se transmiten a trav√©s de la red, est√°n da√±ados, pero no los registramos en ning√∫n lado: todos nuestros datos est√°n en orden, no puede preocuparse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los datos que se almacenan en ClickHouse permanecen consistentes. </font><font style="vertical-align: inherit;">Use sumas de verificaci√≥n en ClickHouse. </font><font style="vertical-align: inherit;">Nos encantan las sumas de cheques tanto que inmediatamente consideramos tres opciones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para bloques de datos comprimidos al escribir en un archivo, en la red.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La verificaci√≥n total es la suma de datos comprimidos para la verificaci√≥n de conciliaci√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La verificaci√≥n total es la suma de datos sin comprimir para la verificaci√≥n de conciliaci√≥n.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay errores en los algoritmos de compresi√≥n de datos, este es un caso conocido. </font><font style="vertical-align: inherit;">Por lo tanto, cuando los datos se replican, tambi√©n consideramos la suma total de verificaci√≥n de los datos comprimidos y la cantidad total de datos sin comprimir.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No tenga miedo de contar los montos de los cheques, no disminuyen la velocidad.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por supuesto, depende de cu√°les y c√≥mo contar. </font><font style="vertical-align: inherit;">Hay matices, pero aseg√∫rese de considerar el monto del cheque. </font><font style="vertical-align: inherit;">Por ejemplo, si cuenta a partir de los datos comprimidos, habr√° menos datos, no se ralentizar√°n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mensaje de error mejorado</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo explicarle al usuario cuando recibe un mensaje de error tal que se trata de un problema de hardware? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t4/f6/rj/t4f6rj1mtuo38kojydfgddfh2nc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la suma de verificaci√≥n no coincide, antes de enviar una excepci√≥n, trato de cambiar cada bit, por si acaso. Si la suma de verificaci√≥n converge al cambiar y se cambia un bit, entonces el problema es muy probablemente el hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si podemos detectar este error, y si cambia cuando se cambia un bit, ¬øpor qu√© no solucionarlo? Podemos hacer esto, pero si corregimos los errores todo el tiempo, el usuario no sabr√° que el equipo tiene un problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando descubrimos que hab√≠a problemas en los interruptores, las personas de otros departamentos comenzaron a informar: ‚Äú¬°Y tenemos un poco incorrectamente escrito en Mongo! ¬°Y algo nos atrap√≥ en PostgreSQL! ‚Äù Esto es bueno, pero es mejor informar problemas antes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando lanzamos una nueva versi√≥n de diagn√≥stico, el primer usuario con el que trabaj√≥ escribi√≥ una semana despu√©s: "Aqu√≠ est√° el mensaje: ¬øcu√°l es el problema?" </font><font style="vertical-align: inherit;">Lamentablemente, no lo ley√≥. </font><font style="vertical-align: inherit;">Pero le√≠ y suger√≠ con una probabilidad del 99% que si el error aparece en un servidor, entonces el problema est√° en el hardware. </font><font style="vertical-align: inherit;">Dejo el porcentaje restante en caso de que escrib√≠ el c√≥digo incorrectamente, esto sucede. </font><font style="vertical-align: inherit;">Como resultado, el usuario reemplaz√≥ el SSD y el problema desapareci√≥.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Delirio" en los datos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este interesante e inesperado problema me hizo preocuparme. Tenemos datos Yandex.Metrica. Se escribe un JSON simple en la base de datos en una de las columnas: par√°metros de usuario del c√≥digo JavaScript del contador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Realizo alg√∫n tipo de solicitud y el servidor ClickHouse se bloque√≥ con segfault. Desde el seguimiento de la pila, me di cuenta de cu√°l era el problema: un nuevo compromiso de nuestros colaboradores externos de otro pa√≠s. El commit arreglado, segfault desapareci√≥. </font><font style="vertical-align: inherit;">Ejecuto </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la misma solicitud: </font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en ClickHouse, para obtener JSON, pero de nuevo, sin sentido, todo funciona lentamente. Me sale JSON, y es de 10 MB. Lo muestro y miro con m√°s atenci√≥n: </font></font><code>{"jserrs": cannot find property of object undefind...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y luego cay√≥ un megabyte de c√≥digo binario.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/ab/1g/ntab1gtbj8eialtctjq4nu-ucdi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubo pensamientos de que esto es nuevamente un pasaje de la memoria o una condici√≥n de carrera. </font><font style="vertical-align: inherit;">Muchos de estos datos binarios son malos, pueden contener cualquier cosa. </font><font style="vertical-align: inherit;">Si es as√≠, ahora encontrar√© contrase√±as y claves privadas all√≠. </font><font style="vertical-align: inherit;">Pero no encontr√© nada, por lo que inmediatamente rechac√© la hip√≥tesis. </font><font style="vertical-align: inherit;">¬øQuiz√°s es un error en mi programa en el servidor ClickHouse? </font><font style="vertical-align: inherit;">Quiz√°s en un programa que escribe (tambi√©n est√° escrito en C ++), ¬øde repente ella accidentalmente pone su memoria de volcado en ClickHouse? </font><font style="vertical-align: inherit;">En este infierno, comenc√© a mirar de cerca las letras y me di cuenta de que no era tan simple.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pista de pista</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La misma basura se registr√≥ en dos grupos, independientemente uno del otro. </font><font style="vertical-align: inherit;">Los datos son basura, pero son v√°lidos UTF-8. </font><font style="vertical-align: inherit;">Este UTF-8 tiene algunas URL extra√±as, nombres de fuente y muchas letras "I" seguidas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© tiene de especial el peque√±o "yo" cir√≠lico? </font><font style="vertical-align: inherit;">No, esto no es Yandex. </font><font style="vertical-align: inherit;">El hecho es que en la codificaci√≥n de Windows 1251 es el 255o car√°cter. </font><font style="vertical-align: inherit;">Y en nuestros servidores Linux, nadie usa la codificaci√≥n de Windows 1251. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que este es un volcado del navegador: el c√≥digo JavaScript del contador m√©trico recopila errores de JavaScript. </font><font style="vertical-align: inherit;">Al final result√≥ que, la respuesta es simple: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo vino del usuario</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De aqu√≠ tambi√©n se pueden sacar conclusiones.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores de todo el Internet</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Metrica recopila tr√°fico de mil millones de dispositivos en Internet: navegadores en PC, tel√©fonos celulares, tabletas. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La basura vendr√° inevitablemente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : hay errores en los dispositivos de los usuarios, RAM en todas partes poco confiable y hardware terrible que se sobrecalienta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base de datos almacena m√°s de 30 billones de l√≠neas (p√°ginas vistas). Si analiza los datos de esta tabla, puede encontrar cualquier cosa all√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, es correcto simplemente filtrar esta basura antes de escribir en la base de datos. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No es necesario escribir basura en la base de datos, a ella no le gusta.</font></font></b><br>
<br>
<blockquote> HighLoad++   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> 133 </a>   ),       -  ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">++</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PHP Russia 2020 Online</a>. <br>
<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Badoo</a>, <b> PHP Russia 2020 Online  </b>. PHP Russia 2020 Online  13 ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>.<br>
<br>
          ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>,     . </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es497324/index.html">"Como la ni√±a de un ojo ..." o hacemos un sistema de seguridad simple basado en un microcontrolador (Canny o Arduino) y Raspberry PI</a></li>
<li><a href="../es497326/index.html">Conectividad SSH m√°s segura con DNSSEC</a></li>
<li><a href="../es497328/index.html">Manera f√°cil de aprender un idioma (cualquiera)</a></li>
<li><a href="../es497330/index.html">Escritorio remoto de Chrome. Soporte remoto</a></li>
<li><a href="../es497332/index.html">Houston, tenemos un problema. Falla de dise√±o del sistema</a></li>
<li><a href="../es497336/index.html">Marcas de computadoras de los 90, parte 3, final</a></li>
<li><a href="../es497338/index.html">Lo que sucedi√≥ con el transporte la semana pasada: la crisis se est√° desarrollando</a></li>
<li><a href="../es497340/index.html">COVID-19: c√≥mo dejar de leer noticias y comenzar a analizar datos</a></li>
<li><a href="../es497342/index.html">Navegador en guardia de solicitudes API: construyendo una comunicaci√≥n segura entre el front-end y el back-end</a></li>
<li><a href="../es497346/index.html">Acelere numpy, scikit y pandas 100 veces con Rust y LLVM: entrevista con el desarrollador Weld</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>