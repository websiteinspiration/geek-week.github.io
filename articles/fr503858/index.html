<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💉 ⛰️ 🔙 Le livre "Terraform: infrastructure au niveau du code" 🚷 🤴🏽 😦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, habrozhiteli! Le livre est destiné à tous ceux qui sont responsables du code déjà écrit. Cela s'applique aux administrateurs système, aux spé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Le livre "Terraform: infrastructure au niveau du code"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/503858/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/el/eg/lp/eleglpt_bkgjd7cftgp1yrmg_gk.jpeg" align="left" alt="image"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, habrozhiteli! Le livre est destiné à tous ceux qui sont responsables du code déjà écrit. Cela s'applique aux administrateurs système, aux spécialistes des opérations, aux ingénieurs des versions, SR, DevOps, aux développeurs d'infrastructure, aux développeurs à cycle complet, aux chefs d'équipe d'ingénierie et aux directeurs techniques. Quelle que soit votre position, si vous êtes impliqué dans l'infrastructure, déployez du code, configurez des serveurs, mettez à l'échelle des clusters, sauvegardez des données, surveillez des applications et répondez à des appels à trois heures du matin, ce livre est pour vous.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensemble, ces responsabilités sont communément appelées activités opérationnelles (ou administration du système). </font><font style="vertical-align: inherit;">Auparavant, les développeurs qui savaient écrire du code mais ne comprenaient pas l'administration système étaient souvent rencontrés; </font><font style="vertical-align: inherit;">les administrateurs système ont souvent rencontré sans la possibilité d'écrire du code. </font><font style="vertical-align: inherit;">Une fois que cette séparation était acceptable, mais dans le monde moderne, qui ne peut plus être imaginé sans le cloud computing et le mouvement DevOps, presque tous les développeurs ont besoin de compétences administratives et tout administrateur système doit pouvoir programmer.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous apprendrez non seulement comment gérer l'infrastructure sous forme de code à l'aide de Terraform, mais aussi comment elle s'intègre dans le concept global de DevOps. </font><font style="vertical-align: inherit;">Voici quelques questions auxquelles vous pouvez répondre en lisant ce livre.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi utiliser IaC?</font></font></li>
<li>    , ,     ?</li>
<li>   Terraform, Chef, Ansible, Puppet, Salt, CloudFormation, Docker, Packer  Kubernetes?</li>
<li>   Terraform       ?</li>
<li>   Terraform,    ?</li>
<li>    Terraform,       ?</li>
<li>     Terraform?</li>
<li>  Terraform     ?</li>
<li>    Terraform   ?</li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    </b>
                        <div class="spoiler_text">    2017 .   2019-         ,      !                 .  ,        .<br>
<br>
        ,  ,     ,    Terraform,    .<br>
<br>
<ul>
<li>   Terraform.    ,   Terraform  0.8.     Terraform   0.12.       ,     .  ,   !</li>
<li>   .           Terraform.    , ,    ,  ,    ,  ,  ,    .</li>
<li>  .      Terraform   .  , ,               — ,      .</li>
<li>   .  8      ,      Terraform    . ,  ,      ,          : ,      .</li>
<li>HCL2.  Terraform 0.12   HCL   HCL2.        (       ${…}!),   ,     ,   null, for_each  for,    .          HCL2,         5  6.</li>
<li>   .  Terraform 0.9    .        Terraform    .  Terraform 0.9     ,       ;     0.10      .       3.</li>
<li>    Terraform.  Terraform 0.10         (    AWS, GCP, Azure  . .).         ,         .          terraform init  ,       .       2  7.</li>
<li>   .  2016   Terraform        (AWS, GCP  Azure).      100,  ,  ,   1.               (,     Alicloud, Oracle Cloud Infrastructure, VMware vSphere  .),       ,     (GitHub, GitLab  BitBucket),   (MySQL, PostreSQL  InfluxDB),     ( DataDog, New Relic  Grafana),   Kubernetes, Helm, Heroku, Rundeck  Rightscale   .  ,       : ,   AWS     ,        ,   CloudFormation!</li>
<li>  Terraform.  2017   HashiCorp    Terraform (registry.terraform.io) —  ,         Terraform,  .  2018          .  Terraform 0.11        .       « »  . 153.</li>
<li>  .  Terraform 0.9    :         ,    ,   errored.tfstate.  Terraform 0.12    .    ,            ,     .</li>
<li>   .      ,     (.  «  »  . 144),  « »         (,  «  Terraform»  . 242),  plan    apply (.  «  »  . 64),     create_before_destroy,    count,           (.  «»  . 160),    ,   provider   .</li>
</ul></div>
                    </div><br>
<h3>.    Terraform</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(beaucoup plus d'attention est accordée aux questions des tests automatiques dans le livre plus tard) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le monde DevOps est plein de peurs différentes: tout le monde a peur de permettre aux choses de fonctionner, de perdre des données ou d'être piraté. Lorsque vous effectuez un changement, vous vous demandez toujours quelles conséquences cela aura. Se comportera-t-il de la même manière dans tous les environnements? Cela provoquera-t-il une autre panne? Et, si cela se produit, combien devrez-vous rester au travail cette fois pour y remédier? Au fur et à mesure que l'entreprise grandit, de nouveaux enjeux sont en jeu, ce qui aggrave le processus de déploiement et augmente le risque d'erreurs. De nombreuses entreprises tentent de minimiser ce risque par des déploiements moins fréquents, mais en conséquence, chaque déploiement individuel devient plus important et plus sujet aux erreurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous gérez votre infrastructure sous forme de code, vous avez un meilleur moyen de minimiser les risques: les tests. </font><font style="vertical-align: inherit;">Leur objectif est de vous donner suffisamment confiance pour apporter des changements. </font><font style="vertical-align: inherit;">Le mot clé ici est la confiance: aucun test ne peut garantir aucune erreur, vous êtes donc plus susceptible de gérer la probabilité. </font><font style="vertical-align: inherit;">Si vous pouvez capturer tous vos processus d'infrastructure et de déploiement sous forme de code, vous pouvez tester ce code dans un environnement de test. </font><font style="vertical-align: inherit;">En cas de succès, il y a de grandes chances que le même code fonctionne dans un environnement industriel. </font><font style="vertical-align: inherit;">Dans un monde de peur et d'incertitude, une probabilité et une confiance élevées coûtent cher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce chapitre, nous allons passer en revue le processus de test du code d'infrastructure, à la fois manuel et automatique, en mettant l'accent sur ce dernier. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests manuels:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bases des tests manuels;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nettoyage des ressources après les tests.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests automatisés:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests unitaires;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests d'intégration;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests de bout en bout;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'autres approches de test.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests manuels</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous réfléchissez à la façon de tester le code Terraform, il est utile de faire des parallèles avec le code de test écrit dans des langages de programmation à usage général comme Ruby. </font><font style="vertical-align: inherit;">Imaginez que vous écrivez un simple serveur Web Ruby dans le fichier web-server.rb:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code renverra une réponse 200 OK avec le corps Hello, World pour l'URL /; </font><font style="vertical-align: inherit;">pour toute autre adresse, la réponse sera 404. Comment testeriez-vous ce code manuellement? </font><font style="vertical-align: inherit;">En règle générale, un peu plus de code est ajouté pour exécuter le serveur Web localement:</font></font><br>
<br>
<pre><code class="java hljs">#   ,      <font></font>
#  ,       <font></font>
<span class="hljs-keyword">if</span> __FILE__ == $<span class="hljs-number">0</span>
  #      <span class="hljs-number">8000</span>
  server = WEBrick::HTTPServer.new :Port =&gt; <span class="hljs-number">8000</span>
  server.mount <span class="hljs-string">'/'</span>, WebServer<font></font>
<font></font>
  #    Ctrl+C<font></font>
  trap <span class="hljs-string">'INT'</span> <span class="hljs-keyword">do</span> server.shutdown end<font></font>
<font></font>
  #  <font></font>
  server.start<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous exécutez ce fichier dans le terminal, il chargera le serveur Web sur le port 8000:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour vérifier le fonctionnement de ce serveur, vous pouvez utiliser le navigateur ou curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/<font></font>
Hello, World<font></font>
<font></font>
$ curl localhost:<span class="hljs-number">8000</span>/invalid-path<font></font>
Not Found</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez maintenant que nous avons changé ce code en y ajoutant un point d'entrée / api qui renvoie 201 Created et un corps au format JSON:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     when <span class="hljs-string">"/api"</span>
         response.status = <span class="hljs-number">201</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>
         response.body = <span class="hljs-string">'{"foo":"bar"}'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester manuellement ce code mis à jour, appuyez sur Ctrl + C et redémarrez le serveur Web en exécutant à nouveau le script:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span><font></font>
^C<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO going to shutdown ...<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO WEBrick::HTTPServer#start done.<font></font>
<font></font>
$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour vérifier la nouvelle version, vous pouvez à nouveau utiliser la commande curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/api<font></font>
{<span class="hljs-string">"foo"</span>:<span class="hljs-string">"bar"</span>}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bases des tests manuels</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À quoi ressemblera ce type de test manuel dans Terraform? </font><font style="vertical-align: inherit;">Par exemple, dans les chapitres précédents, vous avez toujours le code pour déployer ALB. </font><font style="vertical-align: inherit;">Voici un extrait du fichier modules / networking / alb / main.tf:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                     = <span class="hljs-keyword">var</span>.alb_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets                  = <span class="hljs-keyword">var</span>.subnet_ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
        content_type = <span class="hljs-string">"text/plain"</span>
        message_body = <span class="hljs-string">"404: page not found"</span>
        status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
    }<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"alb"</span> {<font></font>
   name = <span class="hljs-keyword">var</span>.alb_name<font></font>
}<font></font>
<font></font>
# (...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous comparez cette liste avec le code Ruby, vous pouvez voir une différence assez évidente: AWS ALB, les groupes cibles, les écouteurs, les groupes de sécurité et toutes les autres ressources ne peuvent pas être déployés sur votre propre ordinateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La principale conclusion concernant le test n ° 1 en découle: le test de code Terraform ne peut pas avoir lieu localement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela s'applique non seulement à Terraform, mais aussi à la plupart des outils IaC. Le seul moyen pratique de faire des tests manuels dans Terraform est de déployer le code dans un environnement réel (c'est-à-dire dans AWS). En d'autres termes, le lancement indépendant des commandes terraform apply et terraform destroy sur lesquelles vous avez travaillé pendant la lecture du livre est un test manuel dans Terraform.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est l'une des raisons pour lesquelles il est si important d'avoir des exemples faciles à déployer dans le dossier d'exemples de chaque module (voir chapitre 6). </font><font style="vertical-align: inherit;">Pour tester le module alb, la façon la plus simple est d'utiliser le code de démonstration que vous avez créé dans examples / alb:</font></font><br>
<br>
<pre><code class="java hljs">provider <span class="hljs-string">"aws"</span> {<font></font>
   region = <span class="hljs-string">"us-east-2"</span><font></font>
<font></font>
   #     AWS  <span class="hljs-number">2</span>.x<font></font>
   version = <span class="hljs-string">"~&gt; 2.0"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"alb"</span> {<font></font>
    source = <span class="hljs-string">"../../modules/networking/alb"</span><font></font>
<font></font>
    alb_name = <span class="hljs-string">"terraform-up-and-running"</span>
    subnet_ids = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour déployer cet exemple, vous devez exécuter la commande terraform apply, comme vous l'avez fait à plusieurs reprises:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 5 added, 0 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À la fin du déploiement, vous pouvez utiliser un outil tel que curl pour, par exemple, vous assurer que ALB renvoie 404 par défaut:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com<font></font>
<font></font>
<span class="hljs-number">404</span></code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vérification de l'infrastructure</font></font><br>
<br>
      ,   HTTP, ,     ,   curl  HTTP-.        . ,        MySQL,       MySQL.      VPN-,      VPN.      ,      ,       SSH    - .    .   ,    ,      .       ,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi de vous rappeler: ALB renvoie 404 en raison de l'absence d'autres règles d'écoute dans la configuration, et l'action par défaut dans le module alb a une réponse de 404:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
       content_type = <span class="hljs-string">"text/plain"</span>
       message_body = <span class="hljs-string">"404: page not found"</span>
       status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, vous savez déjà comment exécuter et tester votre code. </font><font style="vertical-align: inherit;">Vous pouvez maintenant commencer à apporter des modifications. </font><font style="vertical-align: inherit;">Chaque fois que vous modifiez quelque chose (pour que, par exemple, l'action par défaut renvoie 401), vous devez utiliser la commande terraform apply pour déployer le nouveau code:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour vérifier la nouvelle version, vous pouvez redémarrer curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
   hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com
<span class="hljs-number">401</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois terminé, exécutez la commande terraform destroy pour supprimer les ressources:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">destroy</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 0 changed, 5 destroyed.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En d'autres termes, lorsque vous travaillez avec Terraform, chaque développeur a besoin de bons exemples de code pour les tests et d'un environnement de développement réel (comme un compte AWS), qui sert d'équivalent à un ordinateur local et est utilisé pour exécuter des tests. Dans le processus de test manuel, vous devrez probablement créer et supprimer un grand nombre de composants d'infrastructure, ce qui peut entraîner de nombreuses erreurs. À cet égard, l'environnement doit être complètement isolé des environnements plus stables destinés aux tests finaux et en particulier aux applications industrielles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compte tenu de ce qui précède, je recommande fortement à chaque équipe de développement de préparer un environnement isolé dans lequel vous pouvez créer et supprimer toute infrastructure sans conséquences. </font><font style="vertical-align: inherit;">Pour minimiser la probabilité de conflits entre différents développeurs (imaginez que deux développeurs tentent de créer un équilibreur de charge avec le même nom), la solution idéale serait de donner à chaque membre de l'équipe un environnement séparé et complètement isolé. </font><font style="vertical-align: inherit;">Par exemple, si vous utilisez Terraform en conjonction avec AWS, chaque développeur devrait idéalement avoir son propre compte où il peut tester tout ce qu'il veut.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nettoyage des ressources après les tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La présence de nombreux environnements isolés est nécessaire pour la haute productivité des développeurs, mais si vous ne faites pas attention, vous pouvez accumuler beaucoup de ressources supplémentaires qui encombreront tous vos environnements et vous coûteront une somme ronde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour maîtriser les coûts, nettoyez régulièrement vos supports isolés. Telle est la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principale conclusion concernant le test numéro 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au minimum, vous devez créer une telle culture dans l'équipe lorsque, après les tests, les développeurs suppriment tout ce qu'ils ont déployé à l'aide de la commande terraform destroy. Il peut être possible de trouver des outils pour nettoyer les ressources excédentaires ou anciennes qui peuvent être exécutées régulièrement (par exemple, en utilisant cron). Voici quelques exemples pour différents environnements de déploiement.</font></font><br>
<br>
<ul>
<li>cloud-nuke (http://bit.ly/2OIgM9r).      ,         .        AWS ( Amazon EC2 Instances, ASG, ELB  . .).      (Google Cloud, Azure)   .    —    ,    . , cloud-nuke      cron,           .   ,   ,      ,      :<br>
<br>
<pre><code class="java hljs">$ cloud-nuke aws --older-than <span class="hljs-number">48</span>h</code></pre></li>
<li>Janitor Monkey (http://bit.ly/2M4GoLB).      ,   AWS  ,    (  —   ).    ,  ,    ,            .    Netflix Simian Army,      Chaos Monkey    .   ,    Simian Army    ,       : ,   Janitor Monkey   Swabbie (http://bit.ly/2OLrOLb).</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-nuke (http://bit.ly/2ZB8lOe). </font><font style="vertical-align: inherit;">Il s'agit d'un outil open source pour supprimer tout le contenu d'un compte AWS. </font><font style="vertical-align: inherit;">Les comptes et ressources à supprimer sont spécifiés dans le fichier de configuration au format YAML:</font></font><br>
<br>
<pre><code class="java hljs">#   <font></font>
regions:<font></font>
- us-east-<span class="hljs-number">2</span><font></font>
<font></font>
#    <font></font>
accounts:<font></font>
   <span class="hljs-string">"111111111111"</span>: {}<font></font>
<font></font>
#    <font></font>
resource-types:<font></font>
   targets:<font></font>
   - S3Object<font></font>
   - S3Bucket<font></font>
   - IAMRole</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aws-nuke commence comme suit:</font></font><br>
<br>
<pre><code class="java hljs">$ aws-nuke -<span class="hljs-number">5</span>c config.yml</code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests automatisés</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le concept du test automatique est que les tests sont écrits pour tester le comportement du code réel. </font><font style="vertical-align: inherit;">Au chapitre 8, vous apprendrez qu'en utilisant le serveur CI, ces tests peuvent être exécutés après chaque validation individuelle. </font><font style="vertical-align: inherit;">S'ils ne sont pas terminés, la fixation peut être immédiatement annulée ou corrigée. </font><font style="vertical-align: inherit;">Ainsi, votre code sera toujours opérationnel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe trois types de tests automatisés.</font></font><br>
<br>
<ul>
<li> .       — .    ,             .   (,  , -    )   mock-.       (, mock-     ,  )    ,        .</li>
<li> .      .          ,          .      mock-: ,     ,     ,      ,   , ,  ,  mock-.</li>
<li> .      (, ,  ,  )       .          : , Selenium        .         - mock-,          (        ,  ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque type de test a son propre objectif, et avec leur aide, vous pouvez identifier toutes sortes d'erreurs, elles doivent donc être utilisées ensemble. Les tests unitaires sont rapides et vous permettent de vous faire une idée immédiate des modifications apportées et de vérifier une variété de combinaisons. Cela vous donne la certitude que les composants élémentaires de votre code (modules individuels) se comportent comme prévu. Cependant, le fait que les modules fonctionnent correctement séparément ne signifie pas du tout qu'ils peuvent fonctionner ensemble, par conséquent, pour vous assurer que vos composants élémentaires sont compatibles, des tests d'intégration sont nécessaires. D'un autre côté, le comportement correct des différentes parties du système ne garantit pas que ce système fonctionnera comme il se doit après le déploiement dans un environnement industriel.Par conséquent, des tests sont nécessaires pour tester votre code dans des conditions proches des conditions réelles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
»Plus d'informations sur le livre peuvent être trouvées sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site Web de l'éditeur</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extrait</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
pour Khabrozhiteley 25% de réduction sur le coupon - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lors du paiement de la version papier du livre, un livre électronique est envoyé par e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503842/index.html">Prothèse cérébrale: synchronisation des réseaux neuronaux artificiels et biologiques</a></li>
<li><a href="../fr503844/index.html">Accélérez le rendu de MatTable en quelques étapes</a></li>
<li><a href="../fr503846/index.html">Flash, "Qu'il meure à nouveau est inconnu, mais les fleurs disparaissent ..."</a></li>
<li><a href="../fr503848/index.html">Nous vous invitons à des webinaires gratuits sur l'impression SLS sur Sinterit 26.05 et les scanners 3D Shining 28.05</a></li>
<li><a href="../fr503854/index.html">Utilisez SIL au maximum</a></li>
<li><a href="../fr503860/index.html">Configuration de l'environnement du réseau de neurones Mask R-CNN</a></li>
<li><a href="../hi486176/index.html">कॉर्पोरेट ईमेल पत्राचार मेमो</a></li>
<li><a href="../hi486178/index.html">FOSS News No. 1 - 27 जनवरी - 2 फरवरी, 2020 के लिए स्वतंत्र और मुक्त स्रोत समाचार की समीक्षा</a></li>
<li><a href="../hi486180/index.html">सर्वर रहित एप्लिकेशन बनाने के लिए सुझाव और स्रोत</a></li>
<li><a href="../hi486184/index.html">प्रभावी ढंग से खोज का उपयोग कैसे करें</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>