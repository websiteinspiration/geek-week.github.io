<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíâ ‚õ∞Ô∏è üîô Le livre "Terraform: infrastructure au niveau du code" üö∑ ü§¥üèΩ üò¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, habrozhiteli! Le livre est destin√© √† tous ceux qui sont responsables du code d√©j√† √©crit. Cela s'applique aux administrateurs syst√®me, aux sp√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Le livre "Terraform: infrastructure au niveau du code"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/503858/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/el/eg/lp/eleglpt_bkgjd7cftgp1yrmg_gk.jpeg" align="left" alt="image"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, habrozhiteli! Le livre est destin√© √† tous ceux qui sont responsables du code d√©j√† √©crit. Cela s'applique aux administrateurs syst√®me, aux sp√©cialistes des op√©rations, aux ing√©nieurs des versions, SR, DevOps, aux d√©veloppeurs d'infrastructure, aux d√©veloppeurs √† cycle complet, aux chefs d'√©quipe d'ing√©nierie et aux directeurs techniques. Quelle que soit votre position, si vous √™tes impliqu√© dans l'infrastructure, d√©ployez du code, configurez des serveurs, mettez √† l'√©chelle des clusters, sauvegardez des donn√©es, surveillez des applications et r√©pondez √† des appels √† trois heures du matin, ce livre est pour vous.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensemble, ces responsabilit√©s sont commun√©ment appel√©es activit√©s op√©rationnelles (ou administration du syst√®me). </font><font style="vertical-align: inherit;">Auparavant, les d√©veloppeurs qui savaient √©crire du code mais ne comprenaient pas l'administration syst√®me √©taient souvent rencontr√©s; </font><font style="vertical-align: inherit;">les administrateurs syst√®me ont souvent rencontr√© sans la possibilit√© d'√©crire du code. </font><font style="vertical-align: inherit;">Une fois que cette s√©paration √©tait acceptable, mais dans le monde moderne, qui ne peut plus √™tre imagin√© sans le cloud computing et le mouvement DevOps, presque tous les d√©veloppeurs ont besoin de comp√©tences administratives et tout administrateur syst√®me doit pouvoir programmer.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous apprendrez non seulement comment g√©rer l'infrastructure sous forme de code √† l'aide de Terraform, mais aussi comment elle s'int√®gre dans le concept global de DevOps. </font><font style="vertical-align: inherit;">Voici quelques questions auxquelles vous pouvez r√©pondre en lisant ce livre.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi utiliser IaC?</font></font></li>
<li>    , ,     ?</li>
<li>   Terraform, Chef, Ansible, Puppet, Salt, CloudFormation, Docker, Packer  Kubernetes?</li>
<li>   Terraform       ?</li>
<li>   Terraform,    ?</li>
<li>    Terraform,       ?</li>
<li>     Terraform?</li>
<li>  Terraform     ?</li>
<li>    Terraform   ?</li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    </b>
                        <div class="spoiler_text">    2017 .   2019-         ,      !                 .  ,        .<br>
<br>
        ,  ,     ,    Terraform,    .<br>
<br>
<ul>
<li>   Terraform.    ,   Terraform  0.8.     Terraform   0.12.       ,     .  ,   !</li>
<li>   .           Terraform.    , ,    ,  ,    ,  ,  ,    .</li>
<li>  .      Terraform   .  , ,               ‚Äî ,      .</li>
<li>   .  8      ,      Terraform    . ,  ,      ,          : ,      .</li>
<li>HCL2.  Terraform 0.12   HCL   HCL2.        (       ${‚Ä¶}!),   ,     ,   null, for_each  for,    .          HCL2,         5  6.</li>
<li>   .  Terraform 0.9    .        Terraform    .  Terraform 0.9     ,       ;     0.10      .       3.</li>
<li>    Terraform.  Terraform 0.10         (    AWS, GCP, Azure  . .).         ,         .          terraform init  ,       .       2  7.</li>
<li>   .  2016   Terraform        (AWS, GCP  Azure).      100,  ,  ,   1.               (,     Alicloud, Oracle Cloud Infrastructure, VMware vSphere  .),       ,     (GitHub, GitLab  BitBucket),   (MySQL, PostreSQL  InfluxDB),     ( DataDog, New Relic  Grafana),   Kubernetes, Helm, Heroku, Rundeck  Rightscale   .  ,       : ,   AWS     ,        ,   CloudFormation!</li>
<li>  Terraform.  2017   HashiCorp    Terraform (registry.terraform.io) ‚Äî  ,         Terraform,  .  2018          .  Terraform 0.11        .       ¬´ ¬ª  . 153.</li>
<li>  .  Terraform 0.9    :         ,    ,   errored.tfstate.  Terraform 0.12    .    ,            ,     .</li>
<li>   .      ,     (.  ¬´  ¬ª  . 144),  ¬´ ¬ª         (,  ¬´  Terraform¬ª  . 242),  plan    apply (.  ¬´  ¬ª  . 64),     create_before_destroy,    count,           (.  ¬´¬ª  . 160),    ,   provider   .</li>
</ul></div>
                    </div><br>
<h3>.    Terraform</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(beaucoup plus d'attention est accord√©e aux questions des tests automatiques dans le livre plus tard) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le monde DevOps est plein de peurs diff√©rentes: tout le monde a peur de permettre aux choses de fonctionner, de perdre des donn√©es ou d'√™tre pirat√©. Lorsque vous effectuez un changement, vous vous demandez toujours quelles cons√©quences cela aura. Se comportera-t-il de la m√™me mani√®re dans tous les environnements? Cela provoquera-t-il une autre panne? Et, si cela se produit, combien devrez-vous rester au travail cette fois pour y rem√©dier? Au fur et √† mesure que l'entreprise grandit, de nouveaux enjeux sont en jeu, ce qui aggrave le processus de d√©ploiement et augmente le risque d'erreurs. De nombreuses entreprises tentent de minimiser ce risque par des d√©ploiements moins fr√©quents, mais en cons√©quence, chaque d√©ploiement individuel devient plus important et plus sujet aux erreurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous g√©rez votre infrastructure sous forme de code, vous avez un meilleur moyen de minimiser les risques: les tests. </font><font style="vertical-align: inherit;">Leur objectif est de vous donner suffisamment confiance pour apporter des changements. </font><font style="vertical-align: inherit;">Le mot cl√© ici est la confiance: aucun test ne peut garantir aucune erreur, vous √™tes donc plus susceptible de g√©rer la probabilit√©. </font><font style="vertical-align: inherit;">Si vous pouvez capturer tous vos processus d'infrastructure et de d√©ploiement sous forme de code, vous pouvez tester ce code dans un environnement de test. </font><font style="vertical-align: inherit;">En cas de succ√®s, il y a de grandes chances que le m√™me code fonctionne dans un environnement industriel. </font><font style="vertical-align: inherit;">Dans un monde de peur et d'incertitude, une probabilit√© et une confiance √©lev√©es co√ªtent cher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce chapitre, nous allons passer en revue le processus de test du code d'infrastructure, √† la fois manuel et automatique, en mettant l'accent sur ce dernier. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests manuels:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bases des tests manuels;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nettoyage des ressources apr√®s les tests.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests automatis√©s:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests unitaires;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests d'int√©gration;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tests de bout en bout;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'autres approches de test.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests manuels</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous r√©fl√©chissez √† la fa√ßon de tester le code Terraform, il est utile de faire des parall√®les avec le code de test √©crit dans des langages de programmation √† usage g√©n√©ral comme Ruby. </font><font style="vertical-align: inherit;">Imaginez que vous √©crivez un simple serveur Web Ruby dans le fichier web-server.rb:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code renverra une r√©ponse 200 OK avec le corps Hello, World pour l'URL /; </font><font style="vertical-align: inherit;">pour toute autre adresse, la r√©ponse sera 404. Comment testeriez-vous ce code manuellement? </font><font style="vertical-align: inherit;">En r√®gle g√©n√©rale, un peu plus de code est ajout√© pour ex√©cuter le serveur Web localement:</font></font><br>
<br>
<pre><code class="java hljs">#   ,      <font></font>
#  ,       <font></font>
<span class="hljs-keyword">if</span> __FILE__ == $<span class="hljs-number">0</span>
  #      <span class="hljs-number">8000</span>
  server = WEBrick::HTTPServer.new :Port =&gt; <span class="hljs-number">8000</span>
  server.mount <span class="hljs-string">'/'</span>, WebServer<font></font>
<font></font>
  #    Ctrl+C<font></font>
  trap <span class="hljs-string">'INT'</span> <span class="hljs-keyword">do</span> server.shutdown end<font></font>
<font></font>
  #  <font></font>
  server.start<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ex√©cutez ce fichier dans le terminal, il chargera le serveur Web sur le port 8000:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour v√©rifier le fonctionnement de ce serveur, vous pouvez utiliser le navigateur ou curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/<font></font>
Hello, World<font></font>
<font></font>
$ curl localhost:<span class="hljs-number">8000</span>/invalid-path<font></font>
Not Found</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez maintenant que nous avons chang√© ce code en y ajoutant un point d'entr√©e / api qui renvoie 201 Created et un corps au format JSON:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     when <span class="hljs-string">"/api"</span>
         response.status = <span class="hljs-number">201</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>
         response.body = <span class="hljs-string">'{"foo":"bar"}'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester manuellement ce code mis √† jour, appuyez sur Ctrl + C et red√©marrez le serveur Web en ex√©cutant √† nouveau le script:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span><font></font>
^C<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO going to shutdown ...<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO WEBrick::HTTPServer#start done.<font></font>
<font></font>
$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour v√©rifier la nouvelle version, vous pouvez √† nouveau utiliser la commande curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/api<font></font>
{<span class="hljs-string">"foo"</span>:<span class="hljs-string">"bar"</span>}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bases des tests manuels</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä quoi ressemblera ce type de test manuel dans Terraform? </font><font style="vertical-align: inherit;">Par exemple, dans les chapitres pr√©c√©dents, vous avez toujours le code pour d√©ployer ALB. </font><font style="vertical-align: inherit;">Voici un extrait du fichier modules / networking / alb / main.tf:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                     = <span class="hljs-keyword">var</span>.alb_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets                  = <span class="hljs-keyword">var</span>.subnet_ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
        content_type = <span class="hljs-string">"text/plain"</span>
        message_body = <span class="hljs-string">"404: page not found"</span>
        status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
    }<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"alb"</span> {<font></font>
   name = <span class="hljs-keyword">var</span>.alb_name<font></font>
}<font></font>
<font></font>
# (...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous comparez cette liste avec le code Ruby, vous pouvez voir une diff√©rence assez √©vidente: AWS ALB, les groupes cibles, les √©couteurs, les groupes de s√©curit√© et toutes les autres ressources ne peuvent pas √™tre d√©ploy√©s sur votre propre ordinateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La principale conclusion concernant le test n ¬∞ 1 en d√©coule: le test de code Terraform ne peut pas avoir lieu localement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela s'applique non seulement √† Terraform, mais aussi √† la plupart des outils IaC. Le seul moyen pratique de faire des tests manuels dans Terraform est de d√©ployer le code dans un environnement r√©el (c'est-√†-dire dans AWS). En d'autres termes, le lancement ind√©pendant des commandes terraform apply et terraform destroy sur lesquelles vous avez travaill√© pendant la lecture du livre est un test manuel dans Terraform.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est l'une des raisons pour lesquelles il est si important d'avoir des exemples faciles √† d√©ployer dans le dossier d'exemples de chaque module (voir chapitre 6). </font><font style="vertical-align: inherit;">Pour tester le module alb, la fa√ßon la plus simple est d'utiliser le code de d√©monstration que vous avez cr√©√© dans examples / alb:</font></font><br>
<br>
<pre><code class="java hljs">provider <span class="hljs-string">"aws"</span> {<font></font>
   region = <span class="hljs-string">"us-east-2"</span><font></font>
<font></font>
   #     AWS  <span class="hljs-number">2</span>.x<font></font>
   version = <span class="hljs-string">"~&gt; 2.0"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"alb"</span> {<font></font>
    source = <span class="hljs-string">"../../modules/networking/alb"</span><font></font>
<font></font>
    alb_name = <span class="hljs-string">"terraform-up-and-running"</span>
    subnet_ids = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour d√©ployer cet exemple, vous devez ex√©cuter la commande terraform apply, comme vous l'avez fait √† plusieurs reprises:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 5 added, 0 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la fin du d√©ploiement, vous pouvez utiliser un outil tel que curl pour, par exemple, vous assurer que ALB renvoie 404 par d√©faut:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com<font></font>
<font></font>
<span class="hljs-number">404</span></code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√©rification de l'infrastructure</font></font><br>
<br>
      ,   HTTP, ,     ,   curl  HTTP-.        . ,        MySQL,       MySQL.      VPN-,      VPN.      ,      ,       SSH    - .    .   ,    ,      .       ,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi de vous rappeler: ALB renvoie 404 en raison de l'absence d'autres r√®gles d'√©coute dans la configuration, et l'action par d√©faut dans le module alb a une r√©ponse de 404:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
       content_type = <span class="hljs-string">"text/plain"</span>
       message_body = <span class="hljs-string">"404: page not found"</span>
       status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, vous savez d√©j√† comment ex√©cuter et tester votre code. </font><font style="vertical-align: inherit;">Vous pouvez maintenant commencer √† apporter des modifications. </font><font style="vertical-align: inherit;">Chaque fois que vous modifiez quelque chose (pour que, par exemple, l'action par d√©faut renvoie 401), vous devez utiliser la commande terraform apply pour d√©ployer le nouveau code:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour v√©rifier la nouvelle version, vous pouvez red√©marrer curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
   hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com
<span class="hljs-number">401</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois termin√©, ex√©cutez la commande terraform destroy pour supprimer les ressources:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">destroy</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 0 changed, 5 destroyed.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En d'autres termes, lorsque vous travaillez avec Terraform, chaque d√©veloppeur a besoin de bons exemples de code pour les tests et d'un environnement de d√©veloppement r√©el (comme un compte AWS), qui sert d'√©quivalent √† un ordinateur local et est utilis√© pour ex√©cuter des tests. Dans le processus de test manuel, vous devrez probablement cr√©er et supprimer un grand nombre de composants d'infrastructure, ce qui peut entra√Æner de nombreuses erreurs. √Ä cet √©gard, l'environnement doit √™tre compl√®tement isol√© des environnements plus stables destin√©s aux tests finaux et en particulier aux applications industrielles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compte tenu de ce qui pr√©c√®de, je recommande fortement √† chaque √©quipe de d√©veloppement de pr√©parer un environnement isol√© dans lequel vous pouvez cr√©er et supprimer toute infrastructure sans cons√©quences. </font><font style="vertical-align: inherit;">Pour minimiser la probabilit√© de conflits entre diff√©rents d√©veloppeurs (imaginez que deux d√©veloppeurs tentent de cr√©er un √©quilibreur de charge avec le m√™me nom), la solution id√©ale serait de donner √† chaque membre de l'√©quipe un environnement s√©par√© et compl√®tement isol√©. </font><font style="vertical-align: inherit;">Par exemple, si vous utilisez Terraform en conjonction avec AWS, chaque d√©veloppeur devrait id√©alement avoir son propre compte o√π il peut tester tout ce qu'il veut.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nettoyage des ressources apr√®s les tests</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pr√©sence de nombreux environnements isol√©s est n√©cessaire pour la haute productivit√© des d√©veloppeurs, mais si vous ne faites pas attention, vous pouvez accumuler beaucoup de ressources suppl√©mentaires qui encombreront tous vos environnements et vous co√ªteront une somme ronde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ma√Ætriser les co√ªts, nettoyez r√©guli√®rement vos supports isol√©s. Telle est la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principale conclusion concernant le test num√©ro 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au minimum, vous devez cr√©er une telle culture dans l'√©quipe lorsque, apr√®s les tests, les d√©veloppeurs suppriment tout ce qu'ils ont d√©ploy√© √† l'aide de la commande terraform destroy. Il peut √™tre possible de trouver des outils pour nettoyer les ressources exc√©dentaires ou anciennes qui peuvent √™tre ex√©cut√©es r√©guli√®rement (par exemple, en utilisant cron). Voici quelques exemples pour diff√©rents environnements de d√©ploiement.</font></font><br>
<br>
<ul>
<li>cloud-nuke (http://bit.ly/2OIgM9r).      ,         .        AWS ( Amazon EC2 Instances, ASG, ELB  . .).      (Google Cloud, Azure)   .    ‚Äî    ,    . , cloud-nuke      cron,           .   ,   ,      ,      :<br>
<br>
<pre><code class="java hljs">$ cloud-nuke aws --older-than <span class="hljs-number">48</span>h</code></pre></li>
<li>Janitor Monkey (http://bit.ly/2M4GoLB).      ,   AWS  ,    (  ‚Äî   ).    ,  ,    ,            .    Netflix Simian Army,      Chaos Monkey    .   ,    Simian Army    ,       : ,   Janitor Monkey   Swabbie (http://bit.ly/2OLrOLb).</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-nuke (http://bit.ly/2ZB8lOe). </font><font style="vertical-align: inherit;">Il s'agit d'un outil open source pour supprimer tout le contenu d'un compte AWS. </font><font style="vertical-align: inherit;">Les comptes et ressources √† supprimer sont sp√©cifi√©s dans le fichier de configuration au format YAML:</font></font><br>
<br>
<pre><code class="java hljs">#   <font></font>
regions:<font></font>
- us-east-<span class="hljs-number">2</span><font></font>
<font></font>
#    <font></font>
accounts:<font></font>
   <span class="hljs-string">"111111111111"</span>: {}<font></font>
<font></font>
#    <font></font>
resource-types:<font></font>
   targets:<font></font>
   - S3Object<font></font>
   - S3Bucket<font></font>
   - IAMRole</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aws-nuke commence comme suit:</font></font><br>
<br>
<pre><code class="java hljs">$ aws-nuke -<span class="hljs-number">5</span>c config.yml</code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests automatis√©s</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le concept du test automatique est que les tests sont √©crits pour tester le comportement du code r√©el. </font><font style="vertical-align: inherit;">Au chapitre 8, vous apprendrez qu'en utilisant le serveur CI, ces tests peuvent √™tre ex√©cut√©s apr√®s chaque validation individuelle. </font><font style="vertical-align: inherit;">S'ils ne sont pas termin√©s, la fixation peut √™tre imm√©diatement annul√©e ou corrig√©e. </font><font style="vertical-align: inherit;">Ainsi, votre code sera toujours op√©rationnel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe trois types de tests automatis√©s.</font></font><br>
<br>
<ul>
<li> .       ‚Äî .    ,             .   (,  , -    )   mock-.       (, mock-     ,  )    ,        .</li>
<li> .      .          ,          .      mock-: ,     ,     ,      ,   , ,  ,  mock-.</li>
<li> .      (, ,  ,  )       .          : , Selenium        .         - mock-,          (        ,  ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque type de test a son propre objectif, et avec leur aide, vous pouvez identifier toutes sortes d'erreurs, elles doivent donc √™tre utilis√©es ensemble. Les tests unitaires sont rapides et vous permettent de vous faire une id√©e imm√©diate des modifications apport√©es et de v√©rifier une vari√©t√© de combinaisons. Cela vous donne la certitude que les composants √©l√©mentaires de votre code (modules individuels) se comportent comme pr√©vu. Cependant, le fait que les modules fonctionnent correctement s√©par√©ment ne signifie pas du tout qu'ils peuvent fonctionner ensemble, par cons√©quent, pour vous assurer que vos composants √©l√©mentaires sont compatibles, des tests d'int√©gration sont n√©cessaires. D'un autre c√¥t√©, le comportement correct des diff√©rentes parties du syst√®me ne garantit pas que ce syst√®me fonctionnera comme il se doit apr√®s le d√©ploiement dans un environnement industriel.Par cons√©quent, des tests sont n√©cessaires pour tester votre code dans des conditions proches des conditions r√©elles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬ªPlus d'informations sur le livre peuvent √™tre trouv√©es sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site Web de l'√©diteur</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extrait</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
pour Khabrozhiteley 25% de r√©duction sur le coupon - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lors du paiement de la version papier du livre, un livre √©lectronique est envoy√© par e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503842/index.html">Proth√®se c√©r√©brale: synchronisation des r√©seaux neuronaux artificiels et biologiques</a></li>
<li><a href="../fr503844/index.html">Acc√©l√©rez le rendu de MatTable en quelques √©tapes</a></li>
<li><a href="../fr503846/index.html">Flash, "Qu'il meure √† nouveau est inconnu, mais les fleurs disparaissent ..."</a></li>
<li><a href="../fr503848/index.html">Nous vous invitons √† des webinaires gratuits sur l'impression SLS sur Sinterit 26.05 et les scanners 3D Shining 28.05</a></li>
<li><a href="../fr503854/index.html">Utilisez SIL au maximum</a></li>
<li><a href="../fr503860/index.html">Configuration de l'environnement du r√©seau de neurones Mask R-CNN</a></li>
<li><a href="../hi486176/index.html">‡§ï‡•â‡§∞‡•ç‡§™‡•ã‡§∞‡•á‡§ü ‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡•ç‡§∞‡§æ‡§ö‡§æ‡§∞ ‡§Æ‡•á‡§Æ‡•ã</a></li>
<li><a href="../hi486178/index.html">FOSS News No. 1 - 27 ‡§ú‡§®‡§µ‡§∞‡•Ä - 2 ‡§´‡§∞‡§µ‡§∞‡•Ä, 2020 ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§î‡§∞ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§∏‡•ç‡§∞‡•ã‡§§ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§ï‡•Ä ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ</a></li>
<li><a href="../hi486180/index.html">‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∞‡§π‡§ø‡§§ ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§î‡§∞ ‡§∏‡•ç‡§∞‡•ã‡§§</a></li>
<li><a href="../hi486184/index.html">‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§ñ‡•ã‡§ú ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>