<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü©Ô∏è üõåüèΩ üåπ Schnelle Berechnung von Formeln aus Excel in C # üíù üì≠ ü§∏üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie oft h√∂ren Sie von Kunden, dass sie Daten an Excel senden oder Sie auffordern, diese in einem Excel-kompatiblen Format zu importieren oder hochzula...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Schnelle Berechnung von Formeln aus Excel in C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/498032/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie oft h√∂ren Sie von Kunden, dass sie Daten an Excel senden oder Sie auffordern, diese in einem Excel-kompatiblen Format zu importieren oder hochzuladen? </font><font style="vertical-align: inherit;">Ich bin sicher, dass Excel in den meisten Bereichen eines der beliebtesten, leistungsf√§higsten und gleichzeitig einfachsten und bequemsten Tools ist. </font><font style="vertical-align: inherit;">Der problematischste Punkt ist jedoch immer die Integration solcher Daten in verschiedene automatisierte Systeme. </font><font style="vertical-align: inherit;">Unser Team wurde gebeten, die M√∂glichkeit zu pr√ºfen, Datenberechnungen mithilfe der Einstellungen aus einer benutzerdefinierten Excel-Datei durchzuf√ºhren.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/8g/to/wx/8gtowxbs0dnpmjvr59epns8b0sq.jpeg" alt="Schnelle Berechnung von Formeln aus Excel in C #"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie eine produktive Bibliothek f√ºr die Arbeit mit Excel-Dateien ausw√§hlen m√ºssen oder nach einer L√∂sung f√ºr die Berechnung komplexer Finanzdaten (und nicht nur) mit einem praktischen Tool zum sofortigen Verwalten und Visualisieren von Formeln suchen, sind Sie bei cat willkommen.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Untersuchung der Anforderungen eines neuen Projekts im Unternehmen fanden wir einen sehr interessanten Punkt: ‚ÄûDie entwickelte L√∂sung sollte in der Lage sein, die Kosten des Produkts (n√§mlich des Balkons) beim √Ñndern der Konfiguration zu berechnen und die neuen Kosten sofort auf der Benutzeroberfl√§che anzuzeigen. Es ist erforderlich, die M√∂glichkeit zum Herunterladen einer Excel-Datei mit allen Berechnungsfunktionen und Komponentenpreislisten bereitzustellen. ‚Äú Der Kunde musste ein Portal f√ºr die Gestaltung der Konfiguration von Balkonen entwickeln, das von den Gr√∂√üen, Formen, Arten der Verglasung und verwendeten Materialien, den Arten der Befestigungen sowie vielen anderen verwandten Parametern abh√§ngt, die zur Berechnung der genauen Produktionskosten und der Zuverl√§ssigkeitsindikatoren verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir formalisieren die Eingabeanforderungen, damit leichter zu verstehen ist, in welchem ‚Äã‚ÄãKontext das Problem gel√∂st werden musste:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnelle Berechnung der Preise auf der Schnittstelle beim √Ñndern der Parameter des Balkons;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnelle Berechnung von Konstruktionsdaten, einschlie√ülich vieler verschiedener Konfigurationen von Balkonen und individuellen Angeboten, bereitgestellt durch eine separate Berechnungsdatei;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Langfristig - die Entwicklung von Funktionen mithilfe verschiedener ressourcenintensiver Vorg√§nge (Aufgaben zur Optimierung von Parametern usw.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All dies ist auf einem Remote-Server mit Ausgabe √ºber API, weil </font><font style="vertical-align: inherit;">Alle Formeln sind geistiges Eigentum des Kunden und sollten f√ºr Dritte nicht sichtbar sein;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spitzenlast-Eingabedatenstrom: Der Benutzer kann h√§ufig und schnell Parameter √§ndern, um die Produktkonfiguration entsprechend seinen Anforderungen auszuw√§hlen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es klingt sehr ungew√∂hnlich und sehr verlockend, fangen wir an!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schl√ºsselfertige L√∂sungen und Datenaufbereitung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Recherche zur L√∂sung komplexer Probleme beginnt mit dem Surfen in StackOverflow, GitHub und vielen Foren, um nach vorgefertigten L√∂sungen zu suchen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurden mehrere vorgefertigte L√∂sungen ausgew√§hlt, die das Lesen von Daten aus Excel-Dateien sowie das Ausf√ºhren von Berechnungen basierend auf in der Bibliothek angegebenen Formeln unterst√ºtzen. </font><font style="vertical-align: inherit;">Unter diesen Bibliotheken gibt es sowohl v√∂llig kostenlose L√∂sungen als auch kommerzielle Entwicklungen.&nbsp;</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliothek</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verkn√ºpfung</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lizenz</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/JanKallman/EPPlus</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/JanKallman/EPPlus/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU Library General Public License&nbsp;</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/EPPlusSoftware/EPPlus</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/EPPlusSoftware/EPPlus/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polyform Noncommercial License 1.0.0 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.epplussoftware.com/LicenseOverview</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )&nbsp;</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/tonyqus/npoi</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/tonyqus/npoi/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache License 2.0</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turm</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.e-iceblue.com/Introduce/excel-for-net-introduce.html</a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.e-iceblue.com/Tutorials/Spire.XLS/Spire.XLS-Program-Guide/Spire.XLS-Program-Guide-Content.html</a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.e-iceblue.com/Tutorials/Licensing/License-Agreement.html</a>&nbsp;</td>
</tr>
<tr>
<td><strong>Excel Interop</strong><i>(Microsoft.Office.Interop.Excel)</i></td>
<td>n/a</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs.microsoft.com/ru-ru/dotnet/api/microsoft.office.interop.excel._workbook?view=excel-pia</a></td>
<td><i>  Excel     </i></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der n√§chste Schritt besteht darin, Auslastungstests zu schreiben und die Laufzeit jeder Bibliothek zu messen. Bereiten Sie dazu Testdaten vor. Wir erstellen eine neue Excel-Datei, definieren 10 Zellen f√ºr die Eingabeparameter und </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesen Moment merken</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) Formel, um ein Ergebnis zu erhalten, das alle Eingabeparameter verwendet. In der Formel versuchen wir, alle m√∂glichen mathematischen Funktionen unterschiedlicher Rechenkomplexit√§t zu nutzen und auf knifflige Weise zu kombinieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
weil Es geht auch um Geld (die Kosten des Produkts), es ist wichtig, die Genauigkeit der Ergebnisse zu √ºberpr√ºfen. In diesem Fall nehmen wir die resultierenden Werte, die mit </font><strong><font style="vertical-align: inherit;">Excel Interop erhalten wurden,</font></strong><font style="vertical-align: inherit;"> als Referenz</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da Die auf diese Weise erhaltenen Daten werden √ºber den Excel-Kern berechnet und entsprechen den Werten, die Kunden bei der Entwicklung von Formeln und der manuellen Berechnung der Kosten sehen.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Referenzlaufzeit verwenden wir nativen Code, der manuell in reinem C # geschrieben wurde, um dieselbe in Excel geschriebene Formel anzuzeigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√úbersetzte erste Testformel:</font></font><br>
<br>
<pre><code class="plaintext hljs">public double Execute(double[] p)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return Math.Pow(p[0] * p[8] / p[4] * Math.Sin(p[5]) * Math.Cos(p[2]) +<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Math.Abs(p[1] - (p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8]))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Math.Sqrt(p[0] * p[0] + p[1] * p[1]) / 2.0 * Math.PI, p[9]);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir bilden einen Strom von zuf√§lligen Eingabedaten f√ºr N Iterationen (in diesem Fall verwenden wir 10.000 Vektoren). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir starten die Berechnungen f√ºr jeden Vektor von Eingabeparametern im gesamten Stream, erhalten die Ergebnisse und messen den Zeitpunkt der Initialisierung der Bibliothek und die allgemeine Berechnung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Genauigkeit der Ergebnisse zu vergleichen, verwenden wir zwei Indikatoren - die Standardabweichung und den Prozentsatz der √ºbereinstimmenden Werte mit einem bestimmten Genauigkeitsschritt epsilon. Wenn Sie zuf√§llig eine Liste von Eingabewerten mit einem Gleitkomma nach dem Dezimalpunkt erstellen, m√ºssen Sie die Genauigkeit der Eingabeparameter bestimmen. Auf diese Weise erhalten Sie die richtigen Ergebnisse. Andernfalls k√∂nnen Zufallszahlen einen gro√üen Unterschied in Gr√∂√üenordnungen aufweisen - dies kann die Genauigkeit der Ergebnisse stark beeinflussen und die Sch√§tzung des Fehlers des Ergebnisses beeinflussen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
weil Zun√§chst gehen wir davon aus, dass es erforderlich ist, mit konstanten Werten der Materialkosten sowie einigen Konstanten aus verschiedenen Wissensgebieten zu arbeiten. Wir k√∂nnen akzeptieren, dass alle Eingabeparameter Werte haben, die auf 3 Dezimalstellen genau sind. Im Idealfall m√ºssen Sie f√ºr jeden Parameter einen g√ºltigen Wertebereich angeben und nur diese verwenden, um zuf√§llige Werte zu generieren Die Testformel wurde ohne mathematische und physikalische Begr√ºndung zuf√§llig zusammengestellt. Dann ist es nicht m√∂glich, einen solchen Wertebereich f√ºr alle 10 Parameter in einem angemessenen Zeitraum zu berechnen. Daher ist es bei Berechnungen manchmal m√∂glich, einen Berechnungsfehler zu erhalten. Wir schlie√üen solche Eingabedatenvektoren bereits zum Zeitpunkt der Berechnung f√ºr Genauigkeitsindikatoren aus.aber wir werden solche Fehler als separates Merkmal z√§hlen.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testarchitektur&nbsp;</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr jede separate Bibliothek wurde eine eigene Klasse geschaffen, die eine Schnittstelle implementiert , </font></font><code>ITestExecutor </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die drei Methoden enthalten - </font></font><code>SetUp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Execute </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>TearDown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">public interface ITestExecutor<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//      <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;void SetUp();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//   ,           <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;double Execute(double[] p);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//    ,      <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;void TearDown();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methoden </font></font><code>SetUp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>TearDown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden nur einmal beim Testen der Bibliothek verwendet und werden bei der Messung von Zeitberechnungen f√ºr den gesamten Satz von Eingabedaten nicht ber√ºcksichtigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen beschr√§nkte sich der Testalgorithmus auf Folgendes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenaufbereitung (wir bilden einen Strom von Eingabevektoren mit einer bestimmten Genauigkeit);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuweisung von Speicher f√ºr die resultierenden Daten (ein Array von Ergebnissen f√ºr jede Bibliothek, ein Array mit der Anzahl von Fehlern);&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisierung von Bibliotheken;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abrufen von Berechnungsergebnissen f√ºr jede der Bibliotheken durch Speichern des Ergebnisses in einem vorbereiteten Array und Aufzeichnen der Ausf√ºhrungszeit;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abschluss der Arbeit mit dem Code der Bibliotheken;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse der Daten:</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine grafische Darstellung dieses Algorithmus ist unten dargestellt.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/yg/e0/slyge0dloc1dednqql-hgga6um4.png" alt="Flussdiagramm der Leistungs- und Genauigkeitstests von Excel-Unterst√ºtzungsbibliotheken"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse der ersten Iteration</font></font></h1><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Index</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einheimisch</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
&amp; </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turm</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excel Interop</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisierungszeit (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">257</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">266</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">632</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1653</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heiraten </font><font style="vertical-align: inherit;">Zeit f√ºr 1 Durchgang (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0002</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,4086</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,6847</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.9782</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38,8423</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durchschn </font><font style="vertical-align: inherit;">Abweichung</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000394</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000395</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000237</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000631</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Richtigkeit</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,99%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,92%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,97%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,84%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,94%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,94%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,52%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,94%</font></font></td>
</tr>
</tbody></table></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum werden die Ergebnisse von EPPlus 5 und EPPlus 4 kombiniert?</font></font></b>
                        <div class="spoiler_text">      EPPlus      .    ,       ,         .    ,         .     EPPlus 5     ,       .          ,      EPPlus,    .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Iteration der Tests zeigte ein gutes Ergebnis, bei dem die Leiter der Bibliotheken sofort sichtbar wurden. </font><font style="vertical-align: inherit;">Wie aus den obigen Daten ersichtlich ist, ist die EPPlus-Bibliothek in dieser Situation der absolute Marktf√ºhrer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ergebnisse sind im Vergleich zum nativen Code nicht beeindruckend, aber Sie k√∂nnen leben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies h√§tte gestoppt werden k√∂nnen, aber nach einem Gespr√§ch mit Kunden schlichen sich die ersten Zweifel ein: Die Ergebnisse waren zu gut.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zp/7s/ry/zp7sryxdmhkg5rp8xfhwf537kti.jpeg"></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funktionen f√ºr die Arbeit mit der Spire-Bibliothek</font></font></b>
                        <div class="spoiler_text">     Spire  ,             InvalidCastException.      ,          Excel-    ,     ,      ,     .                    try...catch.       ,         .<br>
</div>
                    </div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rechen der ersten Iteration von Tests</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oben habe ich Sie gebeten, Ihre Aufmerksamkeit auf einen Punkt zu lenken, der eine wichtige Rolle bei der Erzielung von Ergebnissen spielte. Wir hatten den Verdacht, dass die in der realen Excel-Datei des Kunden verwendeten Formeln mit vielen Abh√§ngigkeiten alles andere als primitiv sind, aber wir hatten nicht den Verdacht, dass dies die Indikatoren stark beeinflussen k√∂nnte. Bei der Zusammenstellung der Testdaten habe ich dies jedoch zun√§chst nicht vorausgesehen, und die Daten des Kunden (zumindest die Information, dass mindestens 120 Eingabeparameter in der endg√ºltigen Datei verwendet werden) deuteten darauf hin, dass wir Formeln mit Abh√§ngigkeiten zwischen Zellen denken und hinzuf√ºgen m√ºssen .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir bereiten neue Daten f√ºr die n√§chste Testiteration vor. </font><font style="vertical-align: inherit;">Lassen Sie uns auf 10 Eingabeparameter eingehen und weitere 4 neue Formeln hinzuf√ºgen, die nur von Parametern und 1 Aggregationsformel abh√§ngen. Diese basieren auf diesen vier Zellen mit Formeln und basieren auch auf den Werten der Eingabedaten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die neue Formel, die f√ºr nachfolgende Tests verwendet wird:</font></font><br>
<br>
<pre><code class="plaintext hljs">public double Execute(double[] p)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price1 = Math.Pow(p[0] * p[8] / p[4] * Math.Sin(p[5]) * Math.Cos(p[2]) +<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Math.Abs(p[1] - (p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8]))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Math.Sqrt(p[0] * p[0] + p[1] * p[1]) / 2.0 * Math.PI, p[9]);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price2 = p[4] * p[5] * p[2] / Math.Max(1, Math.Abs(p[7]));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price3 = Math.Abs(p[7] - p[3]) * p[2];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price4 = Math.Sqrt(Math.Abs(p[1] * p[2] + p[3] * p[4] + p[5] * p[6]) + 1.0);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price5 = p[0] * Math.Cos(p[1]) + p[2] * Math.Sin(p[1]);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var sum = p[0] + p[1] + p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8] + p[9];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price6 = sum / Math.Max(1, Math.Abs((p[0] + p[1] + p[2] + p[3]) / 4.0))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ sum / Math.Max(1, Math.Abs((p[4] + p[5] + p[6] + p[7] + p[8] + p[9]) / 6.0));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var pricingAverage = (price1 + price2 + price3 + price4 + price5 + price6) / 6.0;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return pricingAverage / Math.Max(1, Math.Abs(price1 + price2 + price3 + price4 + price5 + price6));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, stellte sich heraus, dass die resultierende Formel viel komplizierter war, was sich nat√ºrlich auf die Ergebnisse auswirkte - nicht zum Besseren. </font><font style="vertical-align: inherit;">Eine Tabelle mit den Ergebnissen ist unten dargestellt:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Index</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einheimisch</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4 </font></font></strong><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turm</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excel Interop</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisierungszeit (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">241</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">368</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">722</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1640</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heiraten </font><font style="vertical-align: inherit;">Zeit f√ºr 1 Durchgang (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0004</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,9174 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 124%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,8996 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 177%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7,7647 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 11%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,7194 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 30%)</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durchschn </font><font style="vertical-align: inherit;">Abweichung</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,035884</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Richtigkeit</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">98,79%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,28%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
</tr>
</tbody></table></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xg/l5/ye/xgl5yefp3_meak1f4qzj1mctjsm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis: Weil </font><font style="vertical-align: inherit;">Excel Interop ist zu gro√ü, musste aus dem Diagramm ausgeschlossen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie aus den Ergebnissen hervorgeht, ist die Situation f√ºr den Einsatz in der Produktion v√∂llig ungeeignet geworden. </font><font style="vertical-align: inherit;">Ein bisschen traurig, Kaffee auff√ºllen und tiefer in die Studie eintauchen - direkt in die Codegenerierung.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nv/d_/kh/nvd_khyfluufkuwh64vikgafdpe.jpeg"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codegenerierung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie pl√∂tzlich nie mehr vor einer √§hnlichen Aufgabe standen, werden wir einen kurzen Ausflug durchf√ºhren.&nbsp;</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Codegenerierung ist eine M√∂glichkeit, ein Problem zu l√∂sen, indem Quellcode basierend auf Eingabedaten dynamisch generiert und anschlie√üend kompiliert und ausgef√ºhrt wird. </font><font style="vertical-align: inherit;">Es gibt sowohl statische Codegenerierung, die w√§hrend der Erstellung des Projekts auftritt (als Beispiel kann ich T4MVC anf√ºhren, das neuen Code basierend auf Vorlagen und Metadaten erstellt, die beim Schreiben des Hauptanwendungscodes verwendet werden k√∂nnen), als auch dynamischen Code, der zur Laufzeit ausgef√ºhrt wird.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Aufgabe ist es, eine neue Funktion basierend auf den Quelldaten (Formeln aus Excel) zu bilden, die das Ergebnis basierend auf dem Vektor der Eingabewerte empf√§ngt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu m√ºssen Sie:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie die Formel aus der Datei.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sammle alle Abh√§ngigkeiten;</font></font></li>
<li>       C#;</li>
<li>     ;</li>
<li>            ;</li>
<li>     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle vorgestellten Bibliotheken eignen sich zum Lesen von Formeln. Die </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek erwies sich jedoch als die bequemste Schnittstelle f√ºr solche Funktionen </font><font style="vertical-align: inherit;">. Nachdem ich ein bisschen im Quellcode dieser Bibliothek gest√∂bert hatte, entdeckte ich √∂ffentliche Klassen, um eine Liste von Token zu erstellen und diese weiter in einen Ausdrucksbaum umzuwandeln. Bingo, dachte ich! Ein vorgefertigter Ausdrucksbaum aus der Box ist ideal. Gehen Sie ihn einfach durch und bilden Sie unseren C # -Code.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber ein gro√üer Haken wartete auf mich, als ich anfing, die Knoten des resultierenden Ausdrucksbaums zu untersuchen. Einige Knoten, insbesondere der Aufruf von Excel-Funktionen, kapselten Informationen √ºber die verwendete Funktion und ihre Eingabeparameter und boten keinen offenen Zugriff auf diese Daten. Daher musste die Arbeit mit dem fertigen Ausdrucksbaum verschoben werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir gehen eine Ebene tiefer und versuchen, mit der Liste der Token zu arbeiten. Hier ist alles ganz einfach: Wir haben Token, die Typ und Wert haben. weil Wir erhalten eine Funktion und m√ºssen eine Funktion bilden. Dann k√∂nnen wir stattdessen die Baum-Token in das √Ñquivalent in C # konvertieren. Die Hauptsache bei diesem Ansatz ist die Organisation kompatibler Funktionen. Die meisten mathematischen Funktionen waren bereits kompatibel - wie das Berechnen des Cosinus, des Sinus, das Erhalten der Wurzel und das Erh√∂hen auf eine Potenz. Die Aggregationsfunktionen wie Maximalwert, Minimalwert und Betrag mussten jedoch finalisiert werden. Der Hauptunterschied besteht darin, dass diese Funktionen in Excel mit einem Wertebereich arbeiten. Zur Vereinfachung des Prototyps werden wir Funktionen erstellen, die eine Liste von Parametern als Eingabe verwenden und zuvor den Wertebereich in eine lineare Liste erweitern.Auf diese Weise erhalten wir die korrekte und kompatible Konvertierung von Excel-Syntax in C # -Syntax.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten finden Sie den Hauptcode zum Konvertieren einer Liste von Token aus einer Excel-Formel in einen g√ºltigen C # -Code.</font></font><br>
<br>
<pre><code class="plaintext hljs">private string TransformToSharpCode(string formula, ParsingContext parsingContext)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize basic compile components, e.g. lexer<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var lexer = new Lexer(parsingContext.Configuration.FunctionRepository, parsingContext.NameValueProvider);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// List of dependency variables that can be filled during formula transformation<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var variables = new Dictionary&lt;string, string&gt;();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;using (var scope = parsingContext.Scopes.NewScope(RangeAddress.Empty))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Take resulting code line<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var compiledResultCode = TransformToSharpCode(formula, parsingContext, scope, lexer, variables);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var output = new StringBuilder();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Define dependency variables in reverse order.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (var variableDefinition in variables.Reverse())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.AppendLine($"var {variableDefinition.Key} = {variableDefinition.Value};");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Take the result<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.AppendLine($"return {compiledResultCode};");<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return output.ToString();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
private string TransformToSharpCode(ICollection&lt;Token&gt; tokens, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var output = new StringBuilder();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;foreach (Token token in tokens)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token.TokenType)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Function:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(BuildFunctionName(token.Value));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.OpeningParenthesis:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append("(");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.ClosingParenthesis:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(")");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Comma:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(", ");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.ExcelAddress:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var address = token.Value;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(TransformAddressToSharpCode(address, parsingContext, scope, lexer, variables));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Decimal:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Integer:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Boolean:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(token.Value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Operator:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(token.Value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return output.ToString();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die n√§chste Nuance bei der Konvertierung war die Verwendung von Excel-Konstanten - sie sind Funktionen, daher m√ºssen sie in C # auch in eine Funktion eingeschlossen werden.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt nur eine Frage zu l√∂sen: die Konvertierung von Zellreferenzen in einen Parameter. In dem Fall, in dem das Token Informationen √ºber die Zelle enth√§lt, bestimmen wir zuerst, was in dieser Zelle gespeichert ist. Wenn dies eine Formel ist, erweitern Sie sie rekursiv. Wenn die Konstante durch einen C # -Analog-Link der Form ersetzt wird </font></font><code>p[row, column]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann es sich entweder um ein zweidimensionales Array oder eine indizierte Zugriffsklasse f√ºr eine korrekte Datenzuordnung handeln. Bei einer Reihe von Zellen machen wir dasselbe, erweitern den Bereich einfach auf einzelne Zellen und verarbeiten sie separat. Daher behandeln wir die Hauptfunktionalit√§t bei der √úbersetzung einer Excel-Funktion.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/kk/hz/gwkkhzpfeudqdzcbfsgsdzdtolo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unten finden Sie den Code zum Konvertieren eines Links zu einer Excel-Tabellenzelle in einen g√ºltigen C # -Code:</font></font><br>
<br>
<pre><code class="plaintext hljs">private string TransformAddressToSharpCode(string excelAddress, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Try to parse excel range of addresses<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Currently, reference to another worksheet in address string is not supported<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var rangeParts = excelAddress.Split(':');<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (rangeParts.Length == 1)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Unpack single excel address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return UnpackExcelAddress(excelAddress, parsingContext, scope, lexer, variables);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Parse excel range address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(rangeParts[0], out int startRowIndex, out int startColumnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(rangeParts[1], out int endRowIndex, out int endColumnIndex);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var rowDelta = endRowIndex - startRowIndex;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var columnDelta = endColumnIndex - startColumnIndex;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var allAccessors = new List&lt;string&gt;(Math.Abs(rowDelta * columnDelta));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// TODO This part of code doesn't support reverse-ordered range address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;for (var rowIndex = startRowIndex; rowIndex &lt;= endRowIndex; rowIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var columnIndex = startColumnIndex; columnIndex &lt;= endColumnIndex; columnIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Unpack single excel address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allAccessors.Add(UnpackExcelAddress(rowIndex, columnIndex, parsingContext, scope, lexer, variables));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return string.Join(", ", allAccessors);<font></font>
}<font></font>
<font></font>
private string UnpackExcelAddress(string excelAddress, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(excelAddress, out int rowIndex, out int columnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return UnpackExcelAddress(rowIndex, columnIndex, parsingContext, scope, lexer, variables);<font></font>
}<font></font>
<font></font>
private string UnpackExcelAddress(int rowIndex, int columnIndex, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var formula = parsingContext.ExcelDataProvider.GetRangeFormula(_worksheet.Name, rowIndex, columnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (string.IsNullOrWhiteSpace(formula))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// When excel address doesn't contain information about any excel formula, we should just use external input data parameter provider.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $"p[{rowIndex},{columnIndex}]";<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// When formula is provided, try to identify that variable is not defined yet<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// TODO Worksheet name is not included in variable name, potentially that can cause conflicts<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Extracting and reusing calculations via local variables improves performance for 0.0045ms<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var cellVariableId = $"C{rowIndex}R{columnIndex}";<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (variables.ContainsKey(cellVariableId))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return cellVariableId;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// When variable does not exist, transform new formula and register that to variable scope<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;variables.Add(cellVariableId, TransformToSharpCode(formula, parsingContext, scope, lexer, variables));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return cellVariableId;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt nur, den resultierenden konvertierten Code in eine statische Funktion zu verpacken, die Assembly mit Kompatibilit√§tsfunktionen zu verkn√ºpfen und die dynamische Assembly zu kompilieren. </font><font style="vertical-align: inherit;">Laden Sie es in den Speicher, erhalten Sie einen Link zu unserer Funktion - und Sie k√∂nnen es verwenden.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schreiben eine Wrapper-Klasse zum Testen und f√ºhren Tests mit Zeitmessung durch.&nbsp;</font></font><br>
<br>
<pre><code class="plaintext hljs">public void SetUp()<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize excel package by EPPlus library<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_package = new ExcelPackage(new FileInfo(_fileName));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_workbook = _package.Workbook;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_worksheet = _workbook.Worksheets[1];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_inputRange = new ExcelRange[10];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;for (int rowIndex = 0; rowIndex &lt; 10; rowIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_inputRange[rowIndex] = _worksheet.Cells[rowIndex + 1, 2];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Access to result cell and extract formula string<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_resultRange = _worksheet.Cells[11, 2];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var formula = _resultRange.Formula;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize parsing context and setup data provider<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var parsingContext = ParsingContext.Create();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;parsingContext.ExcelDataProvider = new EpplusExcelDataProvider(_package);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Transform Excel formula to CSharp code<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var sourceCode = TransformToSharpCode(formula, parsingContext);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Compile CSharp code to IL dynamic assembly via helper wrappers<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_code = CodeGenerator.CreateCode&lt;double&gt;(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sourceCode,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new string[]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// List of used namespaces<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System", // Required for Math functions<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ExcelCalculations.PerformanceTests" // Required for Excel function wrappers stored at ExcelCompiledFunctions static class<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new string[]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add reference to current compiled assembly, that is required to use Excel function wrappers located at ExcelCompiledFunctions static class<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"....\\bin\\Debug\\ExcelCalculations.PerformanceTests.exe"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Notify that this source code should use parameter;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Use abstract p parameter - interface for values accessing.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new CodeParameter("p", typeof(IExcelValueProvider))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis haben wir einen Prototyp dieser L√∂sung und markieren ihn als </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-I</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nach dem Ausf√ºhren der Tests erhalten wir das lang erwartete Ergebnis. Die Beschleunigung betr√§gt fast das 300-fache. Schon nicht schlecht, aber der resultierende Code ist immer noch 16-mal langsamer als der native. K√∂nnte es besser sein? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, du kannst! Versuchen wir, das Ergebnis zu verbessern, da wir alle Links zu zus√§tzlichen Zellen durch Formeln mit Variablen ersetzen. Unser Test verwendet die mehrfache Verwendung abh√§ngiger Zellen in der Formel, sodass wir in der ersten Version des √úbersetzers mehrere Berechnungen derselben Daten erhalten haben. Daher wurde beschlossen, bei den Berechnungen Zwischenvariablen zu verwenden. Nachdem wir den Code mithilfe generierter Variablen erweitert haben, konnten wir die Leistung noch zweimal steigern. Diese Verbesserung hei√üt</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-II</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die Vergleichstabelle ist unten dargestellt:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliothek</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heiraten </font><font style="vertical-align: inherit;">Zeit (ms)</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coef. </font><font style="vertical-align: inherit;">Verlangsamungen</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einheimisch</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,00004</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-II</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,003</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-I</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0061</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sechszehn</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,2089</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3023</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter diesen Bedingungen und den f√ºr die Aufgabe zugewiesenen Fristen haben wir ein Ergebnis erhalten, das uns der Leistung des nativen Codes mit einer leichten Verz√∂gerung n√§her bringt - 8-mal im Vergleich zur Originalversion - einer Verz√∂gerung von mehreren Gr√∂√üenordnungen, 3028-mal. </font><font style="vertical-align: inherit;">Aber ist es m√∂glich, das Ergebnis zu verbessern und dem nativen Code so nahe wie m√∂glich zu kommen, wenn Sie die Fristen entfernen und wie viel wird angemessen sein?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meine Antwort lautet ja, aber leider hatte ich keine Zeit mehr, diese Techniken zu implementieren. </font><font style="vertical-align: inherit;">Vielleicht widme ich diesem Thema einen eigenen Artikel. </font><font style="vertical-align: inherit;">Im Moment kann ich nur √ºber die wichtigsten Ideen und Optionen sprechen und sie in Form von kurzen Abstracts schreiben, die durch umgekehrte Transformation verifiziert wurden. </font><font style="vertical-align: inherit;">Mit umgekehrter Konvertierung meine ich die Verschlechterung des von Hand geschriebenen nativen Codes in Richtung des generierten Codes. </font><font style="vertical-align: inherit;">Dieser Ansatz erm√∂glicht es Ihnen, einige Thesen schnell genug zu √ºberpr√ºfen und erfordert keine wesentlichen √Ñnderungen im Code. </font><font style="vertical-align: inherit;">Au√üerdem k√∂nnen Sie die Frage beantworten, wie sich die Leistung des nativen Codes unter bestimmten Bedingungen verschlechtert. Wenn der generierte Code automatisch in die entgegengesetzte Richtung verbessert wird, k√∂nnen Sie eine Leistungsverbesserung mit einem √§hnlichen Koeffizienten erzielen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abstracts</font></font></h2><br>
<ol>
<li>  ,                     ;</li>
<li>           inline      ;</li>
<li> -     Sum, Max, Min   ;</li>
<li>  Sum  inline     ;</li>
<li>   (         )    .</li>
</ol><br>
<h1></h1><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong></strong></td>
<td><strong>Native</strong></td>
<td><strong>EPPlus Compiled, Mark-II</strong></td>
<td><strong>EPPlus 4</strong><strong>EPPlus 5</strong></td>
<td><strong>NPOI</strong></td>
<td><strong>Spire</strong></td>
<td><strong>Excel Interop</strong></td>
</tr>
<tr>
<td><strong>  ()</strong></td>
<td>0</td>
<td>239</td>
<td>241</td>
<td>368</td>
<td>722</td>
<td>1640</td>
</tr>
<tr>
<td><strong>.   1  ()</strong></td>
<td>0,0004</td>
<td>0,003</td>
<td>0,9174</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,8996</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7,7647</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,7194</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durchschn </font><font style="vertical-align: inherit;">Abweichung</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,035884</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Richtigkeit</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">98,79%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,28%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
</tr>
</tbody></table></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kd/py/vy/kdpyvy0-qfqtfbwgtvbwjo28coo.png" alt="Schnelle Berechnung von Formeln aus Excel in C #"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusammenfassend haben wir einen Mechanismus zum Konvertieren von Formeln direkt aus einem benutzerdefinierten Excel-Dokument in Arbeitscode auf dem Server. </font><font style="vertical-align: inherit;">Auf diese Weise k√∂nnen Sie die unglaubliche Flexibilit√§t der Integration von Excel in jede Gesch√§ftsl√∂sung nutzen, ohne die leistungsstarke Benutzeroberfl√§che zu verlieren, mit der eine gro√üe Anzahl von Benutzern vertraut ist. </font><font style="vertical-align: inherit;">War es m√∂glich, f√ºr einen so kurzen Entwicklungszeitraum eine so bequeme Benutzeroberfl√§che mit denselben Tools zur Analyse und Visualisierung von Daten wie in Excel zu entwickeln? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und was waren die ungew√∂hnlichsten und interessantesten Integrationen in Excel-Dokumente, die Sie implementieren mussten?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de498022/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 341 (vom 13. bis 19. April)</a></li>
<li><a href="../de498024/index.html">St√§dte mit einem Mausklick mit Houdini und Python bauen</a></li>
<li><a href="../de498026/index.html">FOSS News Nr. 12 - √úberpr√ºfung der kostenlosen und Open Source-Nachrichten f√ºr den 13. bis 19. April 2020</a></li>
<li><a href="../de498028/index.html">Python COVID-19-Pandemiesimulation</a></li>
<li><a href="../de498030/index.html">Backup: wo, wie und warum?</a></li>
<li><a href="../de498034/index.html">Das moderne Flugzeug ist besser als Sie denken vor biologischen Bedrohungen (COVID-19) gesch√ºtzt</a></li>
<li><a href="../de498036/index.html">Mark Andriessen: Es ist Zeit f√ºr uns selbst zu schaffen (es ist Zeit zu bauen)</a></li>
<li><a href="../de498038/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 411 (13.-19. April 2020)</a></li>
<li><a href="../de498042/index.html">Analysieren, nicht validieren</a></li>
<li><a href="../de498046/index.html">Die Forscher entwickeln einen Ansatz zur Verringerung der Verzerrung in Computer-Vision-Datens√§tzen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>