<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë©‚Äçüëß‚Äçüë¶ üë©üèø‚Äçüöí ü§´ Fr√ºhling: Kontext suchen ‚õèÔ∏è ü§üüèø üèôÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor ein paar Monaten wurde in meinem Profil ein ausf√ºhrlicher Beitrag zum Laden von Klassen in der JVM ver√∂ffentlicht . Nach diesem Vortrag stellten m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Fr√ºhling: Kontext suchen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489236/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor ein paar Monaten wurde in meinem Profil ein ausf√ºhrlicher Beitrag </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Laden von Klassen in der JVM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ver√∂ffentlicht </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nach diesem Vortrag stellten meine Kollegen eine gute Frage: Welchen Mechanismus </font><font style="vertical-align: inherit;">verwendet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Parsen von Konfigurationen und wie werden Klassen aus dem Kontext geladen?</font></font></p><br>
<img src="https://habrastorage.org/webt/vz/-z/00/vz-z001zifi89ni-1_rxixaxr00.jpeg"><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach vielen Stunden des Debuggens von Fr√ºhlingsquellen kam mein Kollege experimentell zu der sehr einfachen und verst√§ndlichen Wahrheit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Theorie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sofort fest, dass </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApplicationContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Hauptschnittstelle in einer Spring-Anwendung ist, die Informationen zur Anwendungskonfiguration bereitstellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor wir direkt zur Demonstration </font><font style="vertical-align: inherit;">
√ºbergehen, werfen wir </font><font style="vertical-align: inherit;">einen Blick auf die Schritte zum Erstellen eines </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vo/co/_d/voco_dc-kmx1qqd04ctg9zpssre.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Beitrag analysieren wir den ersten Schritt, da wir daran interessiert sind, Konfigurationen zu lesen und BeanDefinition zu erstellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BeanDefinition ist eine Schnittstelle, die eine Bean, ihre Eigenschaften, Konstruktorargumente und andere Metainformationen beschreibt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Bezug auf die Konfiguration der Beans selbst verf√ºgt Spring √ºber vier Konfigurationsmethoden:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML-Konfiguration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ClassPathXmlApplicationContext (‚Äùcontext.xml‚Äù);</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Groovy-Konfiguration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - GenericGroovyApplicationContext (‚Äùcontext.groovy‚Äù);</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfiguration √ºber Anmerkungen, die das zu scannende Paket angeben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - AnnotationConfigApplicationContext (‚Äùpackage.name‚Äù);</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaConfig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Konfiguration √ºber Annotationen, die die mit @Configuration - AnnotationConfigApplicationContext (JavaConfig.class) gekennzeichnete Klasse (oder das Klassenarray) angeben.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML-Konfiguration</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir nehmen ein einfaches Projekt als Grundlage:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringContextTest</span></span>{
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String classFilter = <span class="hljs-string">"film."</span>;<font></font>
   <font></font>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>{<font></font>
        <font></font>
         printLoadedClasses(classFilter);<font></font>
         <span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
            All - 5 : 0 - Filtered      /*
        doSomething(MainCharacter.num); doSomething(FilmMaker.class);
        printLoadedClasses(classFilter);
        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
            All - 7 : 2 - Filtered     /*</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sollten Sie ein wenig erkl√§ren, welche Methoden und welche verwendet werden:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printLoadedClasses (String ... -Filter)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die Methode druckt den Namen des </font><i><font style="vertical-align: inherit;">Loaders</font></i><font style="vertical-align: inherit;"> an die Konsole und l√§dt JVM-Klassen aus dem als Parameter √ºbergebenen Paket. </font><font style="vertical-align: inherit;">Dar√ºber hinaus gibt es Informationen zur Anzahl aller geladenen Klassen.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doSomething (Object o)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine Methode, die primitive Arbeit leistet, jedoch nicht zul√§sst, dass die genannten Klassen w√§hrend der Optimierung w√§hrend der Kompilierung ausgeschlossen werden.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verbinden uns mit dem Spring-Projekt (im Folgenden fungiert Spring 4 als Testperson):</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-number">11</span> <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringContextTest</span></span>{
<span class="hljs-number">12</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String calssFilter = <span class="hljs-string">"film."</span>;
<span class="hljs-number">13</span>    
<span class="hljs-number">14</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>{
<span class="hljs-number">15</span>        
<span class="hljs-number">16</span>        printLoadedClasses(classFilter);
<span class="hljs-number">17</span>       <span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
18           All - 5 : 0 - Filtered      /*
19        doSomething(MainCharacter.num); doSomething(FilmMaker.class);
20        printLoadedClasses(classFilter);
21        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
22               class film.MainCharacter
23               class film.FilmMaker
24               All - 7 : 2 - Filtered   /*
25        ApplicationContext context = new ClassPathXmlApplicationContext(
26                  configLocation: "applicationContext.xml");
27        printLoadedClasses(classFilter);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zeile 25 ist die Deklaration und Initialisierung von ApplicationContext √ºber die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konfiguration </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Konfigurations-XML-Datei lautet wie folgt:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span> = <span class="hljs-string">"http://www.spingframework.org/schema/beans"</span> <span class="hljs-attr">xmlns:xsi</span> = <span class="hljs-string">"http..."</span>
        &lt;<span class="hljs-attr">bean</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"villain"</span> <span class="hljs-attr">class</span> = <span class="hljs-string">"film.Villain"</span> <span class="hljs-attr">lazy-init</span>= <span class="hljs-string">"true"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> = <span class="hljs-string">"name"</span> <span class="hljs-attr">value</span> = <span class="hljs-string">"Vasily"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Konfiguration der Bean geben wir eine wirklich vorhandene Klasse an. </font><font style="vertical-align: inherit;">Beachten Sie die angegebene Eigenschaft </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lazy-init = ‚Äùtrue‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : In diesem Fall wird der Bin erst erstellt, nachdem er vom Kontext angefordert wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sehen uns an, wie Spring beim Erh√∂hen des Kontexts die Situation mit den in der Konfigurationsdatei deklarierten Klassen aufkl√§rt:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringContextTest</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String classFilter = <span class="hljs-string">"film."</span>;<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<font></font>
        <font></font>
           printLoadedClasses(classFilter);<font></font>
        <span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
           All - 5 : 0 - Filtered      /*
        doSomething(MainCharacther.num); doSomething(FilmMaker.class);
        printLoadedClasses(classFilter);
        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
            All - 7 : 2 - Filtered     /*
        ApplicationContext context = new ClassPathXmlApplicationContext(
                  configLocation: "applicationContext.xml");
        printLoadedClasses(classFilter);
        /* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
               class film.Villain

            All - 343 : 3- Filtered     /*</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die Details der XML-Konfiguration untersuchen: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Das Lesen der Konfigurationsdatei war die Klasse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlBeanDefinitionReader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die die Schnittstelle </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinitionReader implementiert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlBeanDefinitionReader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> am Eingang empf√§ngt einen InputStream und l√§dt das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokument</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºber den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DefaultDocumentLoader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="java hljs">Document doc = doLoadDocument(inputSource, resource);
<span class="hljs-keyword">return</span> registerBeanDefinitions(doc, resource);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Danach wird jedes Element dieses Dokuments verarbeitet und, wenn es sich um einen Bin handelt, wird BeanDefinition basierend auf den gef√ºllten Daten (ID, Name, Klasse, Alias, Init-Methode, Zerst√∂rungsmethode usw.) erstellt:</font></font><br>
<br>
<pre><code class="java hljs">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, <span class="hljs-string">"bean"</span>)) {
    <span class="hljs-keyword">this</span>.processBeanDefinition(ele, delegate);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Jede BeanDefinition wird in einer Map platziert, die in der DefaultListableBeanFactory-Klasse gespeichert ist:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);
<span class="hljs-keyword">this</span>.beanDefinitionNames.add(beanName);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Code sieht Map folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">/** Map of bean definition objects, keyed by bean name */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;String, BeanDefinition&gt;(<span class="hljs-number">64</span>);
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nun in derselben Konfigurationsdatei eine weitere Bean-Deklaration mit der </font><i><font style="vertical-align: inherit;">film.BadVillain-</font></i><font style="vertical-align: inherit;"> Klasse hinzu </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span> = <span class="hljs-string">"http://www.spingframework.org/schema/beans"</span> <span class="hljs-attr">xmlns:xsi</span> = <span class="hljs-string">"http..."</span>
        &lt;<span class="hljs-attr">bean</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"goodVillain"</span> <span class="hljs-attr">class</span> = <span class="hljs-string">"film.Villain"</span> <span class="hljs-attr">lazy-init</span>= <span class="hljs-string">"true"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> = <span class="hljs-string">"name"</span> <span class="hljs-attr">value</span> = <span class="hljs-string">"Good Vasily"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"badVillain"</span> <span class="hljs-attr">class</span> = <span class="hljs-string">"film.BadVillain"</span> <span class="hljs-attr">lazy-init</span>= <span class="hljs-string">"true"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> = <span class="hljs-string">"name"</span> <span class="hljs-attr">value</span> = <span class="hljs-string">"Bad Vasily"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sehen,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was passiert, wenn Sie eine Liste der erstellten </font><i><font style="vertical-align: inherit;">BeanDefenitionNames</font></i><font style="vertical-align: inherit;"> und geladenen Klassen </font><font style="vertical-align: inherit;">drucken </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<font></font>
        configLocation: <span class="hljs-string">"applicationContext.xml"</span>);<font></font>
System.out.println(Arrays.asList(context.getBeanDefinitionNames()));<font></font>
        <font></font>
printLoadedClasses(calssFilter);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotz der Tatsache, dass die </font><font style="vertical-align: inherit;">in der Konfigurationsdatei angegebene </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">film.BadVillain-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">nicht vorhanden ist, funktioniert Spring fehlerfrei:</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<font></font>
        configLocation: <span class="hljs-string">"applicationContext.xml"</span>);<font></font>
System.out.println(Arrays.asList(context.getBeanDefinitionNames()));<font></font>
<span class="hljs-comment">//  [goodVillain, badVillain]</span><font></font>
printLoadedClasses(calssFilter);<font></font>
<span class="hljs-comment">/* Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2
               class film.MainCharacter
               class film.FilmMaker
               class film.Villain
    All - 343 : 3- Filtered   /*</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefenitionNames-Liste</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enth√§lt 2 Elemente. Das hei√üt, diese 2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in unserer Datei konfigurierten BeanDefinition wurden erstellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Konfigurationen beider Beh√§lter sind im Wesentlichen gleich. W√§hrend die vorhandene Klasse geladen wurde, traten jedoch keine Probleme auf. Daraus k√∂nnen wir schlie√üen, dass es auch einen Versuch gab, eine nicht vorhandene Klasse zu laden, aber ein fehlgeschlagener Versuch hat nichts gebrochen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, die Bohnen selbst beim Namen zu bekommen:</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<font></font>
        configLocation: <span class="hljs-string">"applicationContext.xml"</span>);<font></font>
System.out.println(Arrays.asList(context.getBeanDefinitionNames()));<font></font>
<span class="hljs-comment">//  [goodVillain, badVillain]</span>
System.out.println(context.getBean( name: <span class="hljs-string">"goodVillain"</span>));<font></font>
<font></font>
System.out.println(context.getBean( name: <span class="hljs-string">"badVillain"</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erhalten Folgendes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s9/ot/wk/s9otwkgtbjbiwazcku5ferzpobm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn im ersten Fall eine g√ºltige Bean empfangen wurde, ist im zweiten Fall eine Ausnahme aufgetreten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Achten Sie auf die Stapelverfolgung: verz√∂gertes Laden der bearbeiteten Klassen. Alle Klassenlader werden gecrawlt, um die gesuchte Klasse unter den zuvor geladenen zu finden. Und nachdem die gew√ºnschte Klasse nicht gefunden wurde, wird durch Aufrufen der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utils.forName-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><font style="vertical-align: inherit;">versucht, eine nicht vorhandene Klasse nach Namen zu finden, was zu einem nat√ºrlichen Fehler f√ºhrte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Ausl√∂sen des Kontexts wurde nur eine Klasse geladen, w√§hrend der Versuch, eine nicht vorhandene Datei zu laden, nicht zu einem Fehler f√ºhrte. Warum ist das geschehen? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das liegt daran, dass wir </font><i><font style="vertical-align: inherit;">faul-init</font></i><font style="vertical-align: inherit;"> registriert haben </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: wahr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und verbot Spring, eine Instanz der Bean zu erstellen, in der die zuvor empfangene Ausnahme generiert wird. </font><font style="vertical-align: inherit;">Wenn Sie diese Eigenschaft aus der Konfiguration entfernen oder ihren Wert </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lazy-init: false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √§ndern </font><font style="vertical-align: inherit;">, st√ºrzt der oben beschriebene Fehler ebenfalls ab, die Anwendung wird jedoch nicht ignoriert. </font><font style="vertical-align: inherit;">In unserem Fall wurde der Kontext initialisiert, aber wir konnten keine Instanz der Bean erstellen, weil </font><font style="vertical-align: inherit;">Die angegebene Klasse wurde nicht gefunden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Groovige Konfiguration</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie einen Kontext mithilfe einer Groovy-Datei konfigurieren, m√ºssen Sie einen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericGroovyApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> generieren </font><font style="vertical-align: inherit;">, der eine Zeichenfolge mit der </font><i><font style="vertical-align: inherit;">Kontextkonfiguration</font></i><font style="vertical-align: inherit;"> als Eingabe empf√§ngt. </font><font style="vertical-align: inherit;">In diesem Fall </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die </font><i><font style="vertical-align: inherit;">GroovyBeanDefinitionReader-</font></i><font style="vertical-align: inherit;"> Klasse den Kontext </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Diese Konfiguration funktioniert im Wesentlichen genauso wie XML, nur mit Groovy-Dateien. </font><font style="vertical-align: inherit;">Dar√ºber hinaus </font><font style="vertical-align: inherit;">funktioniert </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GroovyApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gut mit der XML-Datei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Beispiel f√ºr eine einfache Groovy-Konfigurationsdatei:</font></font><br>
<br>
<pre><code class="xml hljs">beans {<font></font>
    goodOperator(film.Operator){bean - &gt;<font></font>
            bean.lazyInit = 'true' &gt;<font></font>
            name = 'Good Oleg' <font></font>
         }<font></font>
    badOperator(film.BadOperator){bean - &gt;<font></font>
            bean.lazyInit = 'true' &gt;<font></font>
            name = 'Bad Oleg' / &gt;<font></font>
        }<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir versuchen das Gleiche wie bei Xml: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ng/qp/zd/ngqpzdgjzxhy_naj3tar3vhtbbs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fehler st√ºrzt sofort ab: Groovy erstellt wie Xml BeanDefenitions, aber in diesem Fall gibt der Postprozessor sofort einen Fehler aus.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfiguration √ºber Anmerkungen, die das Paket f√ºr den Scan oder JavaConfig angeben</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Konfiguration unterscheidet sich von den beiden vorherigen. </font><font style="vertical-align: inherit;">Die Konfiguration durch Annotationen verwendet zwei Optionen: JavaConfig und Annotation √ºber Klassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier wird derselbe Kontext verwendet: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnnotationConfigApplicationContext ("package" /JavaConfig.class)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dies funktioniert abh√§ngig davon, was an den Konstruktor √ºbergeben wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Kontext von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnnotationConfigApplicationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt es zwei private Felder:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">private final AnnotatedBeanDefinitionReader reader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (funktioniert mit JavaConfig);</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">private final ClassPathBeanDefinitionScanner scanne</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r (scannt das Paket).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Besonderheit von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnnotatedBeanDefinitionReader</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist, dass es in mehreren Stufen funktioniert:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registrierung aller </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ Configuration-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dateien zur weiteren Analyse;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registrieren Sie einen speziellen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanFactoryPostProcesso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , n√§mlich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinitionRegistryPostProcessor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der mithilfe der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfigurationClassParser-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">JavaConfig analysiert und eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeanDefinition erstellt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie ein einfaches Beispiel:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaConfig</span> </span>{<font></font>
    <font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Lazy</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> MainCharacter <span class="hljs-title">mainCharacter</span><span class="hljs-params">()</span></span>{<font></font>
        MainCharacter mainCharacter = <span class="hljs-keyword">new</span> MainCharacter();<font></font>
        mainCharacter.name = <span class="hljs-string">"Patric"</span>;
        <span class="hljs-keyword">return</span> mainCharacter;        <font></font>
   }<font></font>
}</code></pre><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<font></font>
<font></font>
     ApplicationContext javaConfigContext = <font></font>
               <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(JavaConfig.class);
     <span class="hljs-keyword">for</span> (String str : javaConfigContext.getBeanDefinitionNames()){<font></font>
          System.out.println(str);<font></font>
     }<font></font>
     printLoadedClasses(classFilter);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erstellen eine Konfigurationsdatei mit dem einfachsten m√∂glichen Bin. </font><font style="vertical-align: inherit;">Wir schauen uns an, was geladen wird: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dh/ja/lc/dhjalckod1_f10h-vb_scdcali4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn im Fall von Xml und Groovy so viele BeanDefinition geladen wurden, wie angek√ºndigt wurde, werden in diesem Fall sowohl deklarierte als auch zus√§tzliche BeanDefinition geladen, um den Kontext zu erh√∂hen. </font><font style="vertical-align: inherit;">Bei der Implementierung √ºber JavaConfig werden alle Klassen sofort geladen, einschlie√ülich der Klasse von JavaConfig selbst, da es sich selbst um eine Bean handelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer Punkt: Bei XML- und Groovy-Konfigurationen wurden 343 Dateien hochgeladen, hier trat eine ‚Äûschwerere‚Äú Last von 631 zus√§tzlichen Dateien auf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arbeitsschritte von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClassPathBeanDefinitionScanner</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das angegebene Paket bestimmt die Liste der zu scannenden Dateien. </font><font style="vertical-align: inherit;">Alle Dateien fallen in Verzeichnisse;</font></font></li>
<li>    ,  InputStream      <i>org.springframework.asm.ClassReader.class</i>;</li>
<li> 3-   ,        <i>org.springframework.core.type.filter.AnnotationTypeFilter</i>.   Spring  ,    <i>Component</i>    ,     <i>Component</i>;</li>
<li>   ,     BeanDefinition.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ganze ‚ÄûMagie‚Äú der Arbeit mit Anmerkungen, wie dies bei Xml und Groovy der Fall ist, liegt genau in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClassReader.class-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klasse </font><font style="vertical-align: inherit;">aus dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">springframework.asm-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Paket </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Die Besonderheit dieses Leseger√§ts besteht darin, dass es mit Bytecode arbeiten kann. </font><font style="vertical-align: inherit;">Das hei√üt, der Leser nimmt einen InputStream aus dem Bytecode, scannt ihn und sucht dort nach Anmerkungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie den Scanner anhand eines einfachen Beispiels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie Ihre eigene Anmerkung, um nach den entsprechenden Klassen zu suchen:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component
<span class="hljs-keyword">import</span> java.lang.annotation.*;
<span class="hljs-meta">@Target({ElementType.TYPE})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyBeanLoader{
       <span class="hljs-function">String <span class="hljs-title">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> ""</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erstellen zwei Klassen: eine mit der Standard- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponentenanmerkung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die zweite mit der benutzerdefinierten Anmerkung:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Component</span> 
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharacter</span> </span>{
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">1</span>;
      <span class="hljs-meta">@Value("Silence")</span>
      <span class="hljs-keyword">public</span> String name;
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainCharacter</span><span class="hljs-params">()</span> </span>{ }</code></pre><br>
<pre><code class="java hljs">MyBeanLoader(<span class="hljs-string">"makerFilm"</span>)
<span class="hljs-meta">@Lazy</span> 
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilmMaker</span> </span>{
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> staticInt = <span class="hljs-number">1</span>;
      <span class="hljs-meta">@Value("Silence")</span>
      <span class="hljs-keyword">public</span> String filmName;
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FilmMaker</span><span class="hljs-params">()</span></span>{}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis erhalten wir die generierte BeanDefinition f√ºr diese Klassen und haben Klassen erfolgreich geladen.</font></font><br>
<br>
<pre><code class="java hljs">ApplicationContext annotationConfigContext =
       <span class="hljs-keyword">new</span> AnnotationConfigApplicationContext(...basePackages: <span class="hljs-string">"film"</span>);
<span class="hljs-keyword">for</span> (String str : annotationConfigContext.getBeanDefinitionNames()){<font></font>
     System.out.println(str);<font></font>
}<font></font>
printLoadedClasses(classFilter);</code></pre><br>
<img src="https://habrastorage.org/webt/k4/zz/kf/k4zzkfqlqqz5sprw3i49w59zjdu.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus dem Vorstehenden k√∂nnen die gestellten Fragen wie folgt beantwortet werden:</font></font><br>
<br>
<ol>
<li>   Spring   ?<br>
<br>
     ,     .    BeanDefinition,     :      ,     BeanDefinition‚Äô    .       BeanDefinition,      ..</li>
<li> Spring    ?<br>
<br>
     Java:            , ,      ,    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Ich hoffe, dass ich in diesem Beitrag ‚Äûden Schleier der Geheimhaltung √∂ffnen‚Äú und detailliert zeigen konnte, wie die Bildung des entspringenden Kontextes in der ersten Phase erfolgt. </font><font style="vertical-align: inherit;">Es stellt sich heraus, dass nicht alles so "be√§ngstigend" ist. </font><font style="vertical-align: inherit;">Dies ist jedoch nur ein kleiner Teil eines gro√üen Rahmens, was bedeutet, dass noch viel Neues und Interessantes vor uns liegt.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489226/index.html">Methoden zum Optimieren von LINQ-Abfragen in C # .NET</a></li>
<li><a href="../de489228/index.html">Sprachbot in der Bank - die schlechteste UX aller Zeiten</a></li>
<li><a href="../de489230/index.html">Was ist die Leistung von Webanwendungen?</a></li>
<li><a href="../de489232/index.html">Zur√ºck in die Zukunft der Handys II</a></li>
<li><a href="../de489234/index.html">Wie man einen Pentest erfolgreich besteht (schlechter Rat)</a></li>
<li><a href="../de489240/index.html">Merkmale regionaler Konferenzen. Warum sollte ein Sprecher das MKAD verlassen?</a></li>
<li><a href="../de489242/index.html">"Schau, das ist etwas": Selbstreplikation k√ºnstlicher DNA</a></li>
<li><a href="../de489244/index.html">Plugin-Entwicklung f√ºr Zabbix Agent 2</a></li>
<li><a href="../de489246/index.html">Ich bin 14 und habe beschlossen, ein Spiel zu entwickeln</a></li>
<li><a href="../de489252/index.html">Die Geschichte des Telegramms: Von der Idee zur eigenen Kryptow√§hrung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>