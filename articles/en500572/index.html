<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ù§Ô∏è üßëüèø‚Äçü§ù‚Äçüßëüèº üë∑üèº Spring MVC: Website Design and RESTful Services üë©üèæ‚Äçüåæ üëçüèΩ üìÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You can use this article to understand how to use Spring MVC to create websites or RESTful services. And also get an overview of frequently asked ques...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Spring MVC: Website Design and RESTful Services</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500572/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can use this article to understand how to use Spring MVC to create websites or RESTful services. </font><font style="vertical-align: inherit;">And also get an overview of frequently asked questions covering the most common tasks of Spring MVC.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note: An article of ~ 7,500 words is probably not worth reading on a mobile device. </font><font style="vertical-align: inherit;">Bookmark it and come back later.</font></font></p><br>
<h2 id="soderzhanie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction </font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HttpServlets 101 </font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DispatcherServlet </font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controllers - HTML Creation</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST controllers - creating XML / JSON</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frequently asked Questions </font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acknowledgments</font></font></a><a name="habracut"></a></li>
</ul><br>
<h2 id="anchort1anchor-vvedenie"><a name="t1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introduction</font></font></h2><br>
<h3 id="chto-takoe-spring-mvc"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is Spring MVC?</font></font></h3><br>
<p>Spring MVC ‚Äî  - Spring.    -  RESTful  (, JSON/XML)      Spring, ,     REST    Spring Boot .</p><br>
<p>   ,   ?</p><br>
<p><strong> ,     </strong>:    .</p><br>
<p>(   ,     Spring  Spring Boot,    , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  Spring Framework?</a>)</p><br>
<h2 id="anchort2anchor-httpservlets-101"><a name="t2"></a> HttpServlets 101</h2><br>
<p>  -  Java   Spring    (MVC/Boot)        ,      :</p><br>
<ol>
<li><strong>HTML</strong> ‚Üí  -  HTML-,     .</li>
<li><strong>JSON/XML</strong> ‚Üí  -   RESTful,   JSON  XML.     Javascript    -    ,    .</li>
<li>,        ,     .</li>
</ol><br>
<p>      <strong></strong> - ?    Java?</p><br>
<p>     - Java      <strong>HttpServlets</strong>.    HTML, JSON  XML. ,     1   -  Java (Spring MVC, Wicket, Struts)    HttpServlets.</p><br>
<p>(<u>  </u>:      HttpServlets,     .)</p><br>
<h3 id="sozdanie-html-stranic-s-pomoschyu-httpservlets"> HTML-   HttpServlets</h3><br>
<p>     HttpServlet,      HTML-.</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.io.IOException;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServletV1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>{
        <span class="hljs-keyword">if</span> (req.getRequestURI().equals(<span class="hljs-string">"/"</span>)) {<font></font>
            resp.setContentType(<span class="hljs-string">"text/html"</span>);<font></font>
            resp.getWriter().print(<span class="hljs-string">"&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome!&lt;/h1&gt;&lt;p&gt;This is a very cool page!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"Help, I don't know what to do with this url"</span>);<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServletV1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{</code></pre><br>
<p>    Java HttpServlet.</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>{</code></pre><br>
<p>  ()  GET,     doGet ()  .   POST    doPost ().     HTTP .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (req.getRequestURI().equals(<span class="hljs-string">"/"</span>)) {</code></pre><br>
<p>   ,   URL-  ,     .     ¬´/¬ª,     www.marcobehler.com,   www.marcobehler.com/hello.</p><br>
<pre><code class="java hljs">resp.setContentType(<span class="hljs-string">"text/html"</span>);</code></pre><br>
<p>       ServletResponse,   ,    .     HTML.</p><br>
<pre><code class="java hljs">resp.getWriter().print(<span class="hljs-string">"&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome!&lt;/h1&gt;&lt;p&gt;This is a very cool page!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</code></pre><br>
<p>: - ‚Äî    HTML!     HTML-           ServletResponse.        response writer.</p><br>
<p>          ,   Tomcat  Jetty.        ,  ,     ,    :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.apache.catalina.Context;
<span class="hljs-keyword">import</span> org.apache.catalina.LifecycleException;
<span class="hljs-keyword">import</span> org.apache.catalina.Wrapper;
<span class="hljs-keyword">import</span> org.apache.catalina.startup.Tomcat;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TomcatApplicationLauncher</span> </span>{<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> LifecycleException </span>{<font></font>
        Tomcat tomcat = <span class="hljs-keyword">new</span> Tomcat();<font></font>
        tomcat.setPort(<span class="hljs-number">8080</span>);<font></font>
        tomcat.getConnector();<font></font>
<font></font>
        Context ctx = tomcat.addContext(<span class="hljs-string">""</span>, <span class="hljs-keyword">null</span>);<font></font>
        Wrapper servlet = Tomcat.addServlet(ctx, <span class="hljs-string">"myServlet"</span>, <span class="hljs-keyword">new</span> MyServletV2());<font></font>
        servlet.setLoadOnStartup(<span class="hljs-number">1</span>);<font></font>
        servlet.addMapping(<span class="hljs-string">"/*"</span>);<font></font>
<font></font>
        tomcat.start();<font></font>
    }<font></font>
}</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs">Tomcat tomcat = <span class="hljs-keyword">new</span> Tomcat();<font></font>
tomcat.setPort(<span class="hljs-number">8080</span>);<font></font>
tomcat.getConnector();</code></pre><br>
<p>    Tomcat,     8080.</p><br>
<pre><code class="java hljs">        Context ctx = tomcat.addContext(<span class="hljs-string">""</span>, <span class="hljs-keyword">null</span>);<font></font>
        Wrapper servlet = Tomcat.addServlet(ctx, <span class="hljs-string">"myServlet"</span>, <span class="hljs-keyword">new</span> MyServletV2());</code></pre><br>
<p>      Tomcat.   ,     Tomcat   .</p><br>
<pre><code class="java hljs">        servlet.addMapping(<span class="hljs-string">"/*"</span>);</code></pre><br>
<p>   Tomcat,     ,    .  /* ,        (/users, /register, /checkout).</p><br>
<pre><code class="java hljs">        tomcat.start();</code></pre><br>
<p>  .     main(),    8080    - (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">http://localhost:8080</a> /),      HTML.</p><br>
<p> ,  ,      doGet ()  doPost (),   -      .   .</p><br>
<h3 id="sozdanie-json-s-pomoschyu-httpservlets"> JSON   HttpServlets</h3><br>
<p> ,    ( ) HTML-       REST API       .     React  AngularJS   URL-  :</p><br>
<pre><code class="plaintext hljs">/api/users/{userId}</code></pre><br>
<p>        JSON     userId.       MyServlet  ,  ,  - ?</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.io.IOException;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServletV2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> IOException </span>{
        <span class="hljs-keyword">if</span> (req.getRequestURI().equals(<span class="hljs-string">"/"</span>)) {<font></font>
            resp.setContentType(<span class="hljs-string">"text/html"</span>);<font></font>
            resp.getWriter().print(<span class="hljs-string">"&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome!&lt;/h1&gt;&lt;p&gt;This is a very cool page!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.getRequestURI().startsWith(<span class="hljs-string">"/api/users/"</span>)) {<font></font>
<font></font>
            Integer prettyFragileUserId = Integer.valueOf(req.getRequestURI().lastIndexOf(<span class="hljs-string">"/"</span>) + <span class="hljs-number">1</span>);<font></font>
<font></font>
            resp.setContentType(<span class="hljs-string">"application/json"</span>);<font></font>
<font></font>
            <span class="hljs-comment">// User user = dao.findUser(prettyFragileUserId)</span>
            <span class="hljs-comment">// actually: jsonLibrary.toString(user)</span>
            resp.getWriter().print(<span class="hljs-string">"{\n"</span> +
                    <span class="hljs-string">"  \"id\":"</span> + prettyFragileUserId + <span class="hljs-string">",\n"</span> +
                    <span class="hljs-string">"  \"age\": 55,\n"</span> +
                    <span class="hljs-string">"  \"name\" : \"John Doe\"\n"</span> +
                    <span class="hljs-string">"}"</span>);<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"Help, I don't know what to do with this url"</span>);<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.getRequestURI().startsWith(<span class="hljs-string">"/api/users/"</span>)) {</code></pre><br>
<p>    if    doGet    /api/users/.</p><br>
<pre><code class="java hljs">  Integer prettyFragileUserId = Integer.valueOf(req.getRequestURI().lastIndexOf(<span class="hljs-string">"/"</span>) + <span class="hljs-number">1</span>);</code></pre><br>
<p>  <strong><em></em></strong>   URL.   URL ‚Äî    userID, , 5  /api/users/5.    ,      int,      !</p><br>
<pre><code class="java hljs">resp.setContentType(<span class="hljs-string">"application/json"</span>);</code></pre><br>
<p> JSON       .</p><br>
<pre><code class="java hljs"><span class="hljs-comment">// User user = dao.findUser(prettyFragileUserId)</span>
<span class="hljs-comment">// actually: jsonLibrary.toString(user)</span>
resp.getWriter().print(<span class="hljs-string">"{\n"</span> +
        <span class="hljs-string">"  \"id\":"</span> + prettyFragileUserId + <span class="hljs-string">",\n"</span> +
        <span class="hljs-string">"  \"age\": 55,\n"</span> +
        <span class="hljs-string">"  \"name\" : \"John Doe\"\n"</span> +
        <span class="hljs-string">"}"</span>);</code></pre><br>
<p> , JSON ‚Äî   ,        HTTPServletResponse. ,     JSON     Java-   ,         .</p><br>
<h3 id="problema-s-nashim-podhodom-odin-servlet-dlya-vsego">    ¬´   ¬ª</h3><br>
<p>    ,      :</p><br>
<ol>
<li>      HTTP- ,  URI ,    ..  :    <strong></strong>  .</li>
<li>       ,    .  :   , <strong></strong>.           ,     .</li>
<li>       JSON  HTML     .</li>
</ol><br>
<p>   ,   ?     ,           ?    URI   ,    JSON,    ?</p><br>
<p><strong></strong>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Spring MVC</a>.</p><br>
<h2 id="anchort3anchor-dispatcherservlet"><a name="t3"></a> DispatcherServlet</h2><br>
<p>   Spring MVC         ,   Model-View-Controller.     .</p><br>
<p>    ,  Spring MVC ‚Äî     ,    -?</p><br>
<p> <strong>DispatcherServlet</strong>.</p><br>
<p>( ,  , ,  )</p><br>
<h3 id="chto-delaet-spring-mvc-dispatcherservlet">  Spring MVC DispatcherServlet?</h3><br>
<p>   ,   - Java   ,  Spring MVC   ,     HTTP- ( DispatcherServlet   <em>-</em>).</p><br>
<p>     <strong><em></em></strong> HTTP-, ?   ¬´   ¬ª,                HTML    .</p><br>
<p>    DispatcherServlet    :</p><br>
<ol>
<li>  URI   HTTP    . : POST /register?name=john&amp;age33.</li>
<li>      (/ )     Java        REST ,,  <strong></strong> .</li>
<li>       ,      .. ,  ,     ,   ,      .</li>
<li>             HTML/JSON/XML.</li>
</ol><br>
<p>    ,       ,   DispatcherServlet     .</p><br>
<p><img src="https://habrastorage.org/webt/cd/3n/fk/cd3nfkgh_84hwdxm56uoy9bpgbq.png"></p><br>
<p>            .   ModelAndView   ?   DispatcherServlet  ?</p><br>
<p>    Let's-write-HTML?      .</p><br>
<h2 id="anchort4anchor-kontrollery--sozdanie-html"><a name="t4"></a>  ‚Äî  HTML</h2><br>
<p> ,     HTML  ,     Spring MVC ( Spring Boot),     .    .</p><br>
<h3 id="kak-napisat-kontroller-v-spring">    Spring</h3><br>
<p>       (POST/register?name=john&amp;age33)     .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<font></font>
<font></font>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegistrationController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@PostMapping("/register")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">registerUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(required = false)</span> Integer age, <span class="hljs-meta">@RequestParam</span> String name, Model model)</span> </span>{<font></font>
        User user = <span class="hljs-keyword">new</span> User(name, age);<font></font>
<font></font>
        <span class="hljs-comment">// TODO save user to database</span>
        <span class="hljs-comment">// userDao.save(user);</span><font></font>
<font></font>
        <span class="hljs-comment">// TODO send out registration email</span>
        <span class="hljs-comment">// mailService.sendRegistrationEmail(user);</span><font></font>
<font></font>
        model.addAttribute(<span class="hljs-string">"user"</span>, user);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"registration-success"</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegistrationController</span> </span>{</code></pre><br>
<p>   Spring    <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link">Controller</a></strong>,           .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@PostMapping("/register")</span></code></pre><br>
<p>    DispatcherServlet,   ,    POST   <strong><em>/register</em></strong>,     (, ?Username=),        .</p><br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">registerUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(required = false)</span> Integer age, <span class="hljs-meta">@RequestParam</span> String name, Model model)</span> </span>{</code></pre><br>
<p><em><u></u></em>         ,     .<br>
  ,        ,      URL (?age=10&amp;name=Joe),      POST.  ,    <strong>name</strong> ( <strong>age</strong>  )</p><br>
<p>  <strong>age</strong>,    ,    Integer ( ,       Integer)</p><br>
<p>,    , Spring MVC    <strong>model</strong>    .      ,       ,        HTML-,     .</p><br>
<pre><code class="java hljs">User user = <span class="hljs-keyword">new</span> User(name, age);<font></font>
<font></font>
<span class="hljs-comment">// TODO save user to database</span>
<span class="hljs-comment">// userDao.save(user);</span><font></font>
<font></font>
<span class="hljs-comment">// TODO send out registration email</span>
<span class="hljs-comment">// mailService.sendRegistrationEmail(user);</span></code></pre><br>
<p>  ,        .  ,     ,    .   -.</p><br>
<pre><code class="java hljs">model.addAttribute(<span class="hljs-string">"user"</span>, user);</code></pre><br>
<p>        ¬´user¬ª.  ,         HTML- , , ¬´${user.name}¬ª.     .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">return</span> <span class="hljs-string">"registration-success"</span>;</code></pre><br>
<p>       <strong>registration-success</strong>.    ,     , ..  HTML,   ,  Spring .</p><br>
<h3 id="views-predstavleniya">Views ()</h3><br>
<p>  ,  (, , ) Spring MVC    , ..  ,    ,      <strong>registration-success.html</strong>.</p><br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"'Hello ' + ${user.name} + '!'"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br>
<p>  HTML-,     <em></em>.    ,    .</p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"'Hello ' + ${user.name} + '!'"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></code></pre><br>
<p>  ,    th:text=?    Spring?   - ?</p><br>
<p>  : Spring MVC      HTML.    HTML-    ,      ,    .</p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Thymeleaf</a>,        Spring MVC.</p><br>
<h3 id="spring-mvc-i-biblioteki-shablonov">Spring MVC   </h3><br>
<p>    ,     Spring MVC,     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Thymeleaf</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Velocity</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Freemarker</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Mustache</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">JSP</a> (    ).</p><br>
<p>,  <strong></strong>    ,         ,       ,         HTML- ‚Äî     ,   . </p><br>
<p>  ,              ,    ,     <strong><em></em></strong>    . , ?</p><br>
<h3 id="chto-takoe-viewresolver">  ViewResolver?</h3><br>
<p>   ,  Spring       HTML-,    .</p><br>
<p>,   <em></em>  ,  <strong>ViewResolver</strong>.   ,      , Spring   ViewResolvers   ,      .      ViewResolvers,   .</p><br>
<p>,      Thymeleaf. ,   ThymeleafViewResolver.</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.thymeleaf.spring5.SpringTemplateEngine;
<span class="hljs-keyword">import</span> org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver;
<span class="hljs-keyword">import</span> org.thymeleaf.spring5.view.ThymeleafViewResolver;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThymeleafConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ThymeleafViewResolver <span class="hljs-title">viewResolver</span><span class="hljs-params">()</span> </span>{<font></font>
        ThymeleafViewResolver viewResolver = <span class="hljs-keyword">new</span> ThymeleafViewResolver();<font></font>
<font></font>
        SpringResourceTemplateResolver templateResolver = <span class="hljs-keyword">new</span> SpringResourceTemplateResolver();<font></font>
        templateResolver.setPrefix(<span class="hljs-string">"classpath:/templates"</span>);<font></font>
        templateResolver.setSuffix(<span class="hljs-string">".html"</span>);
        <span class="hljs-comment">// some other lines neglected...</span><font></font>
<font></font>
        SpringTemplateEngine templateEngine = <span class="hljs-keyword">new</span> SpringTemplateEngine();<font></font>
        templateEngine.setTemplateResolver(templateResolver);<font></font>
        <span class="hljs-comment">// some other lines neglected...</span><font></font>
<font></font>
        viewResolver.setTemplateEngine(templateEngine);<font></font>
        <span class="hljs-keyword">return</span> viewResolver;<font></font>
    }<font></font>
}</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs">    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ThymeleafViewResolver <span class="hljs-title">viewResolver</span><span class="hljs-params">()</span> </span>{<font></font>
        ThymeleafViewResolver viewResolver = <span class="hljs-keyword">new</span> ThymeleafViewResolver();</code></pre><br>
<p>  , ThymeleafViewResolver    Spring <strong>ViewResolver</strong>.    (: <strong>registration-success</strong>), ViewResolvers    .</p><br>
<pre><code class="java hljs">        SpringResourceTemplateResolver templateResolver = <span class="hljs-keyword">new</span> SpringResourceTemplateResolver();</code></pre><br>
<p>   ThymeleafViewResolver      Thymeleaf .      <strong>SpringResourceTemplateResolver</strong>.        .</p><br>
<p><em><u></u></em> SpringResourceTemplateResolver   Thymeleaf</p><br>
<pre><code class="java hljs">templateResolver.setPrefix(<span class="hljs-string">"classpath:/templates"</span>);<font></font>
templateResolver.setSuffix(<span class="hljs-string">".html"</span>);</code></pre><br>
<p> ,   (   Spring Resources): ¬´      classpath,   <strong>/templates</strong>¬ª.        .html.  :</p><br>
<p> ,     String,  registration-success, ThymeleafViewResolver   : <strong>classpath:/templates/registration-success.html</strong>.</p><br>
<h3 id="zametka-na-polyah-spring-boot">  : Spring Boot</h3><br>
<p>  : , <strong> </strong>     ViewResolver,    Spring Boot.   .   Spring Boot       ,       ,   <strong>spring-boot-starter-thymeleaf</strong>.</p><br>
<p>   ViewResolver ,        src/main/resources/template.</p><br>
<p>, Spring Boot    Spring MVC  . .</p><br>
<h3 id="rezyume-model-view-controller">: Model-View-Controller</h3><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link">Controller</a> &amp; ViewResolver,       Spring <strong>M</strong>odel-<strong>V</strong>iew-<strong>C</strong>ontroller.</p><br>
<ul>
<li>    (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link">Controller</a>, @PostMapping, @RequestParam)    <strong></strong>,            .</li>
<li> <strong></strong>    ( <em></em> ),       .   ,     .</li>
<li> <strong></strong> ‚Äî    HTML. ,     ().    HTTP-.        HTTP-  .</li>
</ul><br>
<p>    .</p><br>
<p>  ,   ,   Spring    ,      HTTP,   -   .</p><br>
<h3 id="podrobnee-o-kontrollerah">  </h3><br>
<p>    ,    Spring MVC    HTTP.</p><br>
<ul>
<li>     requestURI,      .</li>
<li>         ,       ,      .</li>
</ul><br>
<p>    ,     <em></em> HTTP-.</p><br>
<h3 id="getmapping-i-requestmappping">@GetMapping  @RequestMappping</h3><br>
<p>    <strong>@GetMapping</strong> .    <code>*@RequestMapping*</code>.   :</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@GetMapping("/books")</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">book</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">//</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* these two mappings are identical */</span><font></font>
<font></font>
<span class="hljs-meta">@RequestMapping(value = "/books", method = RequestMethod.GET)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">book2</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
}</code></pre><br>
<p>@GetMapping, @[Post|Put|Delete|Patch]Mapping  @RequestMapping(method=XXX).      (Spring 4.3+)    ()  URL,   ,   @RequestMapping     ,   Spring.</p><br>
<h3 id="requestparam">@RequestParam</h3><br>
<p>  HTTP-,     URL (?Key=value)      ,      <em>@RequestParam</em>.</p><br>
<p>  ,       (,   HTTP String  int),       .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@PostMapping("/users")</span>   <span class="hljs-comment">/* First Param is optional */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(required = false)</span> Integer age, <span class="hljs-meta">@RequestParam</span> String name)</span> </span>{
   <span class="hljs-comment">// does not matter</span>
}</code></pre><br>
<p>       ,     <strong>400 Bad Request</strong> ,   Spring Boot,    ,    :</p><br>
<pre><code class="json hljs">{<span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2020-04-26T08:34:34.441+0000"</span>,<span class="hljs-attr">"status"</span>:<span class="hljs-number">400</span>,<span class="hljs-attr">"error"</span>:<span class="hljs-string">"Bad Request"</span>,<span class="hljs-attr">"message"</span>:<span class="hljs-string">"Required Integer parameter 'age' is not present"</span>,<span class="hljs-attr">"path"</span>:<span class="hljs-string">"/users"</span>}</code></pre><br>
<p>     ,    Spring    @RequestParams    -  .    <strong></strong>  "<em> </em>".</p><br>
<p>   ,        getter/setter.</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@PostMapping("/users")</span>   <span class="hljs-comment">/* Spring   ,     getters and setters */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">createUser</span><span class="hljs-params">(UserDto userDto)</span> </span>{
    <span class="hljs-comment">//</span>
}</code></pre><br>
<h3 id="pathvariable">@PathVariable</h3><br>
<p>  ,           URI ,  <em>@PathVariable</em>. ,      <em>userId=123</em>,     URL: <strong>GET / users/123</strong></p><br>
<ol>
<li>   ,        {}     . </li>
</ol><br>
<p> , <strong>PathVariables</strong>      .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@GetMapping("/users/{userId}")</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(required = false)</span> String userId)</span> </span>{
       <span class="hljs-comment">// ...</span>
       <span class="hljs-keyword">return</span> user;<font></font>
   }</code></pre><br>
<p> PathVariables, ,      Java- ( ,       getter/setter).</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@GetMapping("/users/{userId}")</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser</span><span class="hljs-params">(UserDto userDto)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> user;<font></font>
}</code></pre><br>
<h3 id="rezyume-kontrollery">: </h3><br>
<p> ,   HTML-   Spring MVC      :</p><br>
<ol>
<li>  , ""  . Spring   ,      ( ,  )  .</li>
<li>  ,     .         .</li>
<li>  ,   HTML   ,       .</li>
<li> ,   , Spring           ,    HTML-      .</li>
<li> , ,     ,  Spring Boot    ,        .</li>
</ol><br>
<p>  .</p><br>
<h2 id="anchort5anchor-rest-kontrollery---sozdanie-xmljson"><a name="t5"></a> REST  ‚Äî  XML/JSON</h2><br>
<p>   RESTFul ,   -.  ,      -,  ()   JSON  XML.  , ,  JSON,   ,      JSON. </p><br>
<p> ,       JSON    HTTP-.</p><br>
<pre><code class="bash hljs">POST http://localhost:8080/users<font></font>
<font></font>
<span class="hljs-comment">###</span>
{<span class="hljs-string">"email"</span>: <span class="hljs-string">"angela@merkel.de"</span>}</code></pre><br>
<p>   Java (   Spring MVC)       JSON .    ,   ,      .         Java,   Spring   JSON.</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDto</span> </span>{
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-comment">//...</span>
}</code></pre><br>
<p>  ,   <em> </em>      ,       HTML   .  RESTful      ,   HTML     ,      JSON.</p><br>
<p>       <strong>HTTP </strong> ‚Üí <strong>Java </strong>   <strong>Java </strong> ‚Üí <strong>HTTP </strong>.</p><br>
<p>   ,   ,  Spring MVC    <strong> REST </strong>.</p><br>
<h3 id="kak-napisat--rest-kontroller">  REST </h3><br>
<p>,       XML/JSON,    @RestController  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link">Controller</a>. ( @RestController  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link">Controller</a>, . FAQ   ).</p><br>
<p>    REST-  ,     ,      :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;<font></font>
<font></font>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BankController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/transactions/{userId}")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Transaction&gt; <span class="hljs-title">transactions</span><span class="hljs-params">(String userId)</span> </span>{<font></font>
<font></font>
        <span class="hljs-comment">// find transaction by user</span>
        <span class="hljs-comment">// List&lt;Transaction&gt; = dao.findByUserId(userId);</span><font></font>
<font></font>
        List&lt;Transaction&gt; transactions = Collections.emptyList();<font></font>
        <span class="hljs-keyword">return</span> transactions;<font></font>
    }<font></font>
}</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BankController</span> </span>{</code></pre><br>
<p>   BankController  @RestController,   Spring,      HTML-    ModelAndView.      XML/JSON ( -  )     HTTP.</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Transaction&gt; <span class="hljs-title">transactions</span><span class="hljs-params">(String userId)</span> </span>{</code></pre><br>
<p>     String ().     <em>List,  Spring      JSON  XML.  ,  ,   Java  Transaction   (-  -   ):</em><br>
</p><pre><code class="json hljs">[<font></font>
  {<font></font>
    <span class="hljs-attr">"occurred"</span>: <span class="hljs-string">"28.04.2020 03:18"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"McDonalds - Binging"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">"amount"</span>: <span class="hljs-number">10</span><font></font>
  },<font></font>
  {<font></font>
    <span class="hljs-attr">"occurred"</span>: <span class="hljs-string">"28.04.2020 06:18"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Burger King - Never enough"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"amount"</span>: <span class="hljs-number">15</span><font></font>
  }<font></font>
]</code></pre><br>
<p>  Spring MVC ,         JSON?   XML?  YAML?    REST  ,      ?</p><br>
<p>   Spring   <strong> </strong>.</p><br>
<h3 id="soglasovanie-kontenta-otveta---accept-header">   ‚Äî Accept Header</h3><br>
<p> ,   ,      ,         REST .</p><br>
<p>?   Accept  HTTP-.</p><br>
<pre><code class="bash hljs">GET http://localhost:8080/transactions/{userid}<font></font>
Accept: application/json</code></pre><br>
<p>Spring MVC    Accept  :    JSON (application/json),      <em>List  JSON. ( .      ,   Accept   .)</em><br>
</p><p>     ,        HTTP,      .</p><br>
<p>       .  .</p><br>
<h3 id="soglasovanie-kontenta--zaprosa---content-type-header-zagolovok-tipa-kontenta">   ‚Äî Content-Type Header (  )</h3><br>
<p>  RESTful API    ,          JSON  XML.       ,      REST    :</p><br>
<pre><code class="bash hljs">POST http://localhost:8080/users<font></font>
<font></font>
<span class="hljs-comment">###</span>
{<span class="hljs-string">"email"</span>: <span class="hljs-string">"angela@merkel.de"</span>}</code></pre><br>
<p> Spring ,      JSON,   XML  YAML? ,  ,      ,      <strong>Content-Type</strong>.</p><br>
<pre><code class="bash hljs">POST ...<font></font>
<font></font>
Content-Type: application/json; charset=UTF-8<font></font>
<font></font>
<span class="hljs-comment">###</span>
...</code></pre><br>
<p>    REST    ?</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<font></font>
<font></font>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookingController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@PostMapping("/transactions")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Transaction <span class="hljs-title">transaction</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> TransactionDto dto)</span> </span>{
        <span class="hljs-comment">// do something with the dto..create the booking..convert it to a transaction</span>
        Transaction transaction = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">return</span> transaction;<font></font>
    }<font></font>
}</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword">public</span> Transaction <span class="hljs-title">transaction</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> TransactionDto dto)</span> </span>{</code></pre><br>
<p> @RequestParam  @Pathvariable,    ,  <em>@RequestBody</em>. </p><br>
<p>@RequestBody     <strong>Content-Type</strong>   Spring  ,      HTTP-      Content-Type,  : JSON   .</p><br>
<pre><code class="java hljs">    <span class="hljs-comment">// do something with the dto..create the booking..convert it to a transaction</span>
    Transaction transaction = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">return</span> transaction;<font></font>
}</code></pre><br>
<p>          JSON,      TransactionDTO,     ,    Transaction,  .    Spring MVC.</p><br>
<h3 id="sam-spring-ne-mozhet-konvertirovat-formaty-dannyh"> Spring     </h3><br>
<p>    : Spring    Accept  Content-Type,   ,     Java  JSON.  XML.  .</p><br>
<p>        (  <em> / </em>  <em> / </em>.)</p><br>
<p> ,    Spring MVC    ,  <strong>HttpMessageConverters</strong>.</p><br>
<h3 id="chto-takoe-httpmessageconverter">  HttpMessageConverter?</h3><br>
<p>HttpMessageConverter ‚Äî      ( ,        ,          ).</p><br>
<ol>
<li><strong>canRead (MediaType)</strong> ‚Üí      (JSON | XML | YAML |  . .)?   MediaType       Content-Type.</li>
<li><strong>canWrite (MediaType)</strong> ‚Üí      (JSON | XML | YAML |  . .)?  MediaType,  ,       Accept.</li>
<li><strong>read(Object, InputStream, MediaType)</strong> ‚Üí   Java-  (JSON | XML | YAML |  . .) InputStream</li>
<li><strong>write(Object, OutputStream, MediaType)</strong> ‚Üí   Java-  OutputStream  (JSON | XML | YAML |  . .)</li>
</ol><br>
<p> , MessageConverter  ,  MediaTypes   (, application/json),          /     .</p><br>
<h3 id="kakie-est-httpmessageconverters">  HttpMessageConverters?</h3><br>
<p> ,        . Spring MVC   ,      HTTPMessageConverters   ‚Äî           .</p><br>
<p>     ,     .   ,   Spring <strong>AllEncompassingFormHttpMessageConverter</strong> (   ).</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">static</span> {<font></font>
        ClassLoader classLoader = AllEncompassingFormHttpMessageConverter.class.getClassLoader();<font></font>
        jaxb2Present = ClassUtils.isPresent("javax.xml.bind.Binder", classLoader);<font></font>
        jackson2Present = ClassUtils.isPresent("com.fasterxml.jackson.databind.ObjectMapper", classLoader) &amp;&amp;<font></font>
                                        ClassUtils.isPresent("com.fasterxml.jackson.core.JsonGenerator", classLoader);<font></font>
        jackson2XmlPresent = ClassUtils.isPresent("com.fasterxml.jackson.dataformat.xml.XmlMapper", classLoader);<font></font>
        jackson2SmilePresent = ClassUtils.isPresent("com.fasterxml.jackson.dataformat.smile.SmileFactory", classLoader);<font></font>
        gsonPresent = ClassUtils.isPresent("com.google.gson.Gson", classLoader);<font></font>
        jsonbPresent = ClassUtils.isPresent("javax.json.bind.Jsonb", classLoader);<font></font>
}</code></pre><br>
<p>    .</p><br>
<pre><code class="java hljs">jaxb2Present = ClassUtils.isPresent(<span class="hljs-string">"javax.xml.bind.Binder"</span>, classLoader);</code></pre><br>
<p>Spring MVC    javax.xml.bind.Binder ,   , ,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">JAXB</a>.</p><br>
<pre><code class="java hljs">jackson2Present = ClassUtils.isPresent(<span class="hljs-string">"com.fasterxml.jackson.databind.ObjectMapper"</span>, classLoader) &amp;&amp;<font></font>
ClassUtils.isPresent(<span class="hljs-string">"com.fasterxml.jackson.core.JsonGenerator"</span>, classLoader);</code></pre><br>
<p>Spring MVC     <em>..jackson..ObjectMapper</em>  <em>..jackson..JsonGenerator</em> ,   , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Jackson</a>       JSON.</p><br>
<pre><code class="java hljs">jackson2XmlPresent = ClassUtils.isPresent(<span class="hljs-string">"com.fasterxml.jackson.dataformat.xml.XmlMapper"</span>, classLoader);</code></pre><br>
<p>Spring MVC    <em>..jackson..XmlMapper</em> ,   , ,     XML  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Jackson</a> s       XML.</p><br>
<p>  .     Spring   HttpMessageConverter   ,   ¬´¬ª.</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (jaxb2Present &amp;&amp; !jackson2XmlPresent) {<font></font>
        addPartConverter(<span class="hljs-keyword">new</span> Jaxb2RootElementHttpMessageConverter());<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> (jackson2Present) {<font></font>
        addPartConverter(<span class="hljs-keyword">new</span> MappingJackson2HttpMessageConverter());<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gsonPresent) {<font></font>
        addPartConverter(<span class="hljs-keyword">new</span> GsonHttpMessageConverter());<font></font>
}</code></pre><br>
<h3 id="zametka-na-polyah-spring-boot-1">  : Spring Boot</h3><br>
<p>   Spring Boot     Spring MVC  .  Spring Boot   Jackson  .</p><br>
<p><strong></strong>        JSON   Spring Boot,    HttpMessageConverts     .</p><br>
<h3 id="rezyume-rest-kontrollery">: REST </h3><br>
<p>   HTML  JSON / XML  ,       Model  View.</p><br>
<p>       Java,  Spring MVC     JSON / XML    ,      HttpMessageConverters.</p><br>
<p>      , :</p><br>
<ol>
<li>       .</li>
<li>   Accept  Content-Type   .</li>
</ol><br>
<h2 id="anchort6anchor-chasto-zadavaemye-voprosy"><a name="t6"></a>   </h2><br>
<h3 id="vy-gde-nibud-publikovali-ishodnyy-kod-etoy-stati"> -     ?</h3><br>
<p>              GitHub:<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://github.com/marcobehler/spring-mvc-article</a></p><br>
<p>      <strong>SpringMvcArticleApplication</strong>,   -.</p><br>
<h3 id="v-chem-raznica-mezhdu-spring-mvc-i-spring-boot">    Spring MVC  Spring Boot?</h3><br>
<p>: <em>  </em>, Spring Boot     <strong></strong> Spring MVC.</p><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  Spring Framework?</a>.</p><br>
<h3 id="kakoy-samyy-bystryy-sposob-sozdat-novoe-prilozhenie-spring-mvc">       Spring MVC?</h3><br>
<p>     Spring MVC,       Spring Boot .</p><br>
<ol>
<li>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://start.spring.io/</a>.</li>
<li>  <strong>Spring Web</strong>       .</li>
</ol><br>
<p>     / RESTful-   Spring MVC.</p><br>
<h3 id="kakoy-tip-vvoda-http-zaprosa-ponimaet-spring-mvc">   HTTP-  Spring MVC?</h3><br>
<p>Spring MVC   ,   HTTP ‚Äî    .</p><br>
<p> ,         JSON, XML  HTTP (Multipart) Fileuploads,  Spring        Java.</p><br>
<h3 id="kakie-http-otvety-mozhet-sozdavat-spring-mvc"> HTTP-   Spring MVC?</h3><br>
<p>Spring MVC       HttpServletResponse ‚Äî    .</p><br>
<p>  HTML, JSON, XML     WebSocket.  ,     Java       .</p><br>
<h3 id="v-chem-raznica-mezhdu-kontrollerom--i-rest-kontrollerom">      REST </h3><br>
<ol>
<li><strong></strong>    HTML     ,      @ResponseBody   ,     XML / JSON.</li>
<li>  <strong>REST </strong> ,      <strong></strong>    @ResponseBody.       @ResponseBody   .</li>
</ol><br>
<pre><code class="java hljs"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RestController {</code></pre><br>
<ol>
<li> REST     XML / JSON  HTML.</li>
</ol><br>
<p><strong><u>.</u></strong> XML  JSON ‚Äî      ,       Spring MVC.    / REST    - , , YAML.    ,   HttpMessageConverter    ApplicationContext.</p><br>
<h3 id="kakuyu-biblioteku-shablonov-mne-vybrat">    ?</h3><br>
<p>           , ,       Thymeleaf   Spring,     . ,   Thymeleaf (        ),   ,    .</p><br>
<h3 id="pochemu-moy-kontroller-vyvodit-404-vse-mapingi-verny">    404?   .</h3><br>
<p>    ,    ,      JSON  XML,      @ResponseBody.</p><br>
<p>Spring     404 Not Found   .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<font></font>
<font></font>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_404WithMissingResponseBodyController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>   <span class="hljs-comment">/* This won't work and lead to a 404 */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser_404</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Everyone's name is John"</span>, id);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/users2/{id}")</span>
    <span class="hljs-meta">@ResponseBody</span>  <span class="hljs-comment">/* This will work */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser_200</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Everyone's name is John"</span>, id);<font></font>
    }<font></font>
}</code></pre><br>
<p><strong></strong>:  @ResponseBody    <em></em>  <em>REST </em>.</p><br>
<h3 id="chto-proizoydet-esli-vy-opredelite-odin-i-tot-zhe-maping-zaprosov-dlya-dvuh-raznyh-metodov"> ,             ?</h3><br>
<p>      HTTP ,    .</p><br>
<pre><code class="java hljs"><span class="hljs-comment">/*   */</span><font></font>
<font></font>
<span class="hljs-meta">@PostMapping("/users")</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@GetMapping("/users")</span>
<span class="hljs-function">publi <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span> </span>{<font></font>
<font></font>
}</code></pre><br>
<p>     HTTP       ,    .</p><br>
<pre><code class="java hljs"><span class="hljs-comment">/*    */</span><font></font>
<font></font>
<span class="hljs-meta">@PostMapping("/users")</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@PostMapping("/users")</span>
<span class="hljs-function">publi <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span> </span>{<font></font>
<font></font>
}</code></pre><br>
<p>       <em>IllegalStateException</em>,      .</p><br>
<pre><code class="powershell hljs">Caused by: java.lang.IllegalStateException: Ambiguous mapping. Cannot map <span class="hljs-string">'howToPassAndRetrieveRequestParametersController'</span> method<font></font>
com.marcobehler.springmvcarticle.HowToPassAndRetrieveRequestParametersController<span class="hljs-comment">#createUser(User)</span>
to {POST /users3}: There is already <span class="hljs-string">'howToPassAndRetrieveRequestParametersController'</span> bean method</code></pre><br>
<h3 id="nuzhno-li-v-url-kodirovat-requestparams">   URL  @RequestParams?</h3><br>
<p>,   Spring <strong></strong>    URL.  :</p><br>
<p>,          ,    ,     ¬´+¬ª     , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">marco+wantsnospam@marcobehler.com</a>.</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@GetMapping("/confirm")</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">confirm</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String email, <span class="hljs-meta">@RequestParam</span> String token)</span></span>{
    <span class="hljs-comment">// confirm user...</span>
}</code></pre><br>
<p>      ‚Äò+‚Äô  URL   -        ,       @RequestParam?</p><br>
<p>  ¬´marco[space]wantnospam@marcobehler.com¬ª,   Spring  + ,     RFC3986.</p><br>
<p><strong>:</strong> ,  URL-,      ,  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">marco%2Bwantsnospam@marcobehler.com</a>,   Spring    .</p><br>
<h3 id="kak-poluchit-dostup-k-tekuschey-httpsession-polzovatelya">     HttpSession ?</h3><br>
<p> Spring MVC   REST      HttpSession    ,  Spring <strong></strong>   ( ,     ).</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpSessionController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/session")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSession</span><span class="hljs-params">(HttpSession httpSession)</span> </span>{<font></font>
        System.out.println(<span class="hljs-string">"httpSession = "</span> + httpSession);
        <span class="hljs-keyword">return</span> httpSession.getId();<font></font>
    }<font></font>
}</code></pre><br>
<p>         ,       HttpSession  .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeOtherService</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> HttpSession httpSession;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HttpSession <span class="hljs-title">getHttpSession</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> httpSession;<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-poluchit-dostup-k-httpservletrequest">    HttpServletRequest?</h3><br>
<p>  Spring MVC   REST      HttpServletRequest    ,  Spring <strong></strong>   (,     )</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpServletRequestController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SomeRequestService someRequestService;<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/request")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRequest</span><span class="hljs-params">(HttpServletRequest request)</span> </span>{<font></font>
        System.out.println(<span class="hljs-string">"request = "</span> + request);
        <span class="hljs-keyword">return</span> request.toString();<font></font>
    }<font></font>
}</code></pre><br>
<p>         ,       HttpServletRequest  .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeRequestService</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> HttpServletRequest httpServletRequest;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HttpServletRequest <span class="hljs-title">getRequest</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> httpServletRequest;<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-chitat-http-zagolovki">  HTTP ?</h3><br>
<p>       ,    ,           .          @RequestHeader.</p><br>
<p>     ,      .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.http.HttpHeaders;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestHeader;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.util.Map;<font></font>
<font></font>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpHeaderController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/headers1")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">singleHeader</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader("x-forwarded-for")</span> String xForwardedFor)</span> </span>{
       <span class="hljs-comment">// ...</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/headers2")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">headersAsMap</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader</span> Map&lt;String,String&gt; headers)</span> </span>{  <span class="hljs-comment">// or MultiValueMap&lt;String,String&gt;</span>
        <span class="hljs-comment">// ...</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/headers3")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">headersAsObject</span><span class="hljs-params">(HttpHeaders headers)</span> </span>{
        <span class="hljs-comment">// ...</span><font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-chitat-i-pisat-cookie">    cookie?</h3><br>
<p>   cookie     <em>@CookieValue</em>   .     cookie   HttpServletResponse.</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.CookieValue;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<font></font>
<font></font>
<span class="hljs-keyword">import</span> javax.servlet.http.Cookie;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<font></font>
<font></font>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CookieController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/cookie")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handle</span><span class="hljs-params">(<span class="hljs-meta">@CookieValue("JSESSIONID")</span> String cookie, HttpServletResponse response)</span> </span>{<font></font>
<font></font>
        response.addCookie(<span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">"SOME_COOKIE_NAME"</span>, <span class="hljs-string">"This is a crazy new cookie!"</span>));
        <span class="hljs-comment">//...</span><font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-poluchit-ip-adres-polzovatelya">  IP- ?</h3><br>
<p>   .     <em>httpServletRequest.getRemoteAddr()</em>, , ,   IP-    -,  ,  99,99%    Nginx  Apache.</p><br>
<p>,     <em>X-Forwarded-For</em>    IP-.   ,   ,  ,    CDN,  CloudFront?   X-Forwarded-For   :</p><br>
<pre><code class="java hljs">X-Forwarded-For: MaybeSomeSpoofedIp, realIp, cloudFrontIp</code></pre><br>
<p>  ,        ,     , ,     X-Forwarded-For.     <em></em>   <em></em>   IP-.   CloudFront  ,      IP- CloudFront     . !</p><br>
<p>     ,  IP. ,     !</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<font></font>
<font></font>
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<font></font>
<font></font>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IpController</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] HEADERS_TO_TRY = {
            <span class="hljs-string">"X-Forwarded-For"</span>,
            <span class="hljs-string">"Proxy-Client-IP"</span>,
            <span class="hljs-string">"WL-Proxy-Client-IP"</span>,
            <span class="hljs-string">"HTTP_X_FORWARDED_FOR"</span>,
            <span class="hljs-string">"HTTP_X_FORWARDED"</span>,
            <span class="hljs-string">"HTTP_X_CLUSTER_CLIENT_IP"</span>,
            <span class="hljs-string">"HTTP_CLIENT_IP"</span>,
            <span class="hljs-string">"HTTP_FORWARDED_FOR"</span>,
            <span class="hljs-string">"HTTP_FORWARDED"</span>,
            <span class="hljs-string">"HTTP_VIA"</span>,
            <span class="hljs-string">"REMOTE_ADDR"</span>};<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/ip")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getClientIpAddress</span><span class="hljs-params">(HttpServletRequest request)</span> </span>{
        <span class="hljs-keyword">for</span> (String header : HEADERS_TO_TRY) {<font></font>
            String ip = request.getHeader(header);<font></font>
            <span class="hljs-keyword">if</span> (ip != <span class="hljs-keyword">null</span> &amp;&amp; ip.length() != <span class="hljs-number">0</span> &amp;&amp; !<span class="hljs-string">"unknown"</span>.equalsIgnoreCase(ip)) {
                <span class="hljs-keyword">return</span> getRealClientIpAddress(ip);<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> request.getRemoteAddr();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     * Goes through the supplied ip string (could be one or multiple). Traverses it through the right side...
     * and removes any known ip address ranges
     *
     * <span class="hljs-doctag">@param</span> ipString
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRealClientIpAddress</span><span class="hljs-params">(String ipString)</span> </span>{<font></font>
        String[] manyPossibleIps = ipString.split(<span class="hljs-string">","</span>);<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = manyPossibleIps.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {<font></font>
            String rightMostIp = manyPossibleIps[i].trim();<font></font>
            <span class="hljs-keyword">if</span> (isKnownAddress(rightMostIp)) {
                <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// skip this ip as it is trusted</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> rightMostIp;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> ipString;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isKnownAddress</span><span class="hljs-params">(String rightMostIp)</span> </span>{
        <span class="hljs-comment">// do your check here..for cloudfront you'd need to download their ip address ranges</span>
        <span class="hljs-comment">// from e.g. http://d7uri8nf7uskq.cloudfront.net/tools/list-cloudfront-ips</span>
        <span class="hljs-comment">// and compare the current ip against them</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-vy-mozhete-upravlyat-zagruzkoy-faylov-v-prilozhenii-spring-mvc">        Spring MVC?</h3><br>
<p>,        HTML-,    :</p><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/upload"</span>&gt;</span>
    File to upload:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"file"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Upload"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre><br>
<p>      @PostMapping    MultiPartFile,               .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.file.Path;
<span class="hljs-keyword">import</span> java.nio.file.Paths;<font></font>
<font></font>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUploadController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@PostMapping("/upload")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">handleFileUpload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> MultipartFile file)</span> <span class="hljs-keyword">throws</span> IOException </span>{
        <span class="hljs-comment">// don't generate upload files like this in a real project.</span>
        <span class="hljs-comment">// give them random names and save their uploaded name as metadata in a database or similar</span>
        <span class="hljs-keyword">final</span> Path uploadDestination = Paths.get(<span class="hljs-string">"C:\\uploads"</span>).resolve(file.getName());<font></font>
<font></font>
        file.transferTo(uploadDestination);<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/"</span>;<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-obrabatyvat-zagruzku-binarnyh-faylov-xls-pdf-csv-jpg-zip-s-pomoschyu-spring-kontrollerov">     (xls, pdf, csv, jpg, zip)   Spring ?</h3><br>
<p>     ,     HttpServletResponse    byte[]  .</p><br>
<p>  ,  Spring-       '<em>ResponseEntity '.    ,    ,     .</em><br>
</p><ul>
<li>  ‚Üí FileSystemResource</li>
<li>      ‚Üí ClassPathResource</li>
<li>   ¬´-¬ª ‚Üí InputStreamResource</li>
<li>     byte[]   ‚Üí ByteArrayResource</li>
</ul><br>
<p>,   ,    HTTP-  ( ,    ..).</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.core.io.ClassPathResource;
<span class="hljs-keyword">import</span> org.springframework.core.io.Resource;
<span class="hljs-keyword">import</span> org.springframework.http.HttpHeaders;
<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;
<span class="hljs-keyword">import</span> org.springframework.web.server.ResponseStatusException;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.io.IOException;<font></font>
<font></font>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileDownloadController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@RequestMapping(value = "/download/{jpgName}", method = RequestMethod.GET)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="hljs-title">downloadJpg</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> String jpgName)</span> <span class="hljs-keyword">throws</span> IOException </span>{<font></font>
<font></font>
        <span class="hljs-comment">//  Resource downloadResource = new InputStreamResource(soimeinputStream)</span>
        <span class="hljs-comment">//  Resource downloadResource = new ByteArrayResource(someByteArray)</span>
        <span class="hljs-comment">//  Resource downloadResource = new FileSystemResource(someFile)</span>
        <span class="hljs-keyword">final</span> ClassPathResource downloadResource = <span class="hljs-keyword">new</span> ClassPathResource(jpgName);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (!downloadResource.exists()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ResponseStatusException(HttpStatus.BAD_REQUEST);<font></font>
        }<font></font>
<font></font>
        HttpHeaders headers = <span class="hljs-keyword">new</span> HttpHeaders();<font></font>
<font></font>
        <span class="hljs-comment">// 1. set the correct content type</span><font></font>
        headers.setContentType(MediaType.IMAGE_JPEG);<font></font>
<font></font>
        <span class="hljs-comment">// 2. set the correct content length, maybe stored in a db table</span><font></font>
        headers.setContentLength(downloadResource.contentLength());<font></font>
<font></font>
        <span class="hljs-comment">// 3. if you want to force downloads, otherwise attachments might be displayed directly in the brwoser</span>
        headers.setContentDispositionFormData(<span class="hljs-string">"attachment"</span>, jpgName);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(downloadResource, headers, HttpStatus.OK);<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-ya-mogu-globalno-obrabatyvat-isklyucheniya-v-moih-kontrollerah">        ?</h3><br>
<p> Spring MVC     ,          ,     .</p><br>
<p>  <em>ControllerAdvice</em>  <em>RestControllerAdvice</em>     @ResponseStatus  @ExceptionHandler.  :</p><br>
<ol>
<li>        ,      REST .</li>
<li>@ResponseStatus      HTTP,         .</li>
<li>@ExceptionHandler  ,     -.</li>
<li> ,         REST .</li>
</ol><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;<font></font>
<font></font>
<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalControllerExceptionHandler</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.CONFLICT)</span>  <span class="hljs-comment">// 409</span>
    <span class="hljs-meta">@ExceptionHandler(SomeConflictException.class)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">handleConflict</span><span class="hljs-params">(SomeConflictException e, Model model)</span> </span>{
        <span class="hljs-comment">// do something</span>
        model.addAttribute(<span class="hljs-string">"message"</span>, e.getMessage());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"new-template"</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.NOT_IMPLEMENTED)</span>  <span class="hljs-comment">// 409</span>
    <span class="hljs-meta">@ExceptionHandler(NotYetImplementedExceptoin.class)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleBandwithLimitExceeded</span><span class="hljs-params">(NotYetImplementedExceptoin e)</span> </span>{
        <span class="hljs-comment">// do nothing;</span><font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-vernut-lyuboy-kod-sostoyaniya-400-404-i-td-iz-vashih-kontrollerov">     (400, 404  ..)   ?</h3><br>
<p>  <em>ResponseStatusException</em>     , , .</p><br>
<p>    ResponseEntity,      .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.marcobehler.springmvcarticle;<font></font>
<font></font>
<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.server.ResponseStatusException;<font></font>
<font></font>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpStatusCodeController</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@GetMapping("/somePath")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">alwaysThrowsException</span><span class="hljs-params">()</span> </span>{
         <span class="hljs-comment">//throw new ResponseStatusException(HttpStatus.NOT_FOUND, "Meeepp, not found.");</span><font></font>
<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ResponseStatusException(HttpStatus.BAD_REQUEST, <span class="hljs-string">"Well, that just wasn't right!"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="kak-naschet-koncepcii-xyz-v-spring-mvc">   XYZ  Spring MVC?</h3><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> Spring MVC</a>    , ,   -.</p><br>
<p>,       , , ViewHandlers, InitBinders, RootContexts, ,   ..,      Spring MVC.       ,    .</p><br>
<h2 id="anchort7anchor-zaklyuchenie"><a name="t7"></a> </h2><br>
<p>   .   ,        :</p><br>
<ul>
<li>Spring MVC ‚Äî    MVC-,      - HTML  JSON/XML -.</li>
<li>          ,       Spring,   Spring Boot.</li>
<li>         -,      ,  HTTP- /    .</li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That's all for today. </font><font style="vertical-align: inherit;">Thanks for reading.</font></font></p><br>
<h2 id="anchort8anchor-blagodarnosti"><a name="t8"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Acknowledgments</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many thanks to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patricio "Pato" Moschcovich</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , who not only corrected this article, but also gave invaluable feedback!</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500556/index.html">Two years of digital transformation in two months</a></li>
<li><a href="../en500558/index.html">A selection of articles on machine learning: case studies, guides and research for April 2020</a></li>
<li><a href="../en500562/index.html">Form design patterns. Book Review</a></li>
<li><a href="../en500564/index.html">Offline transactions in public transport - security and antifraud</a></li>
<li><a href="../en500568/index.html">Simple space simulation using Python and Box2D</a></li>
<li><a href="../en500574/index.html">Full analysis of the first part of the exam in SHAD 2020</a></li>
<li><a href="../en500576/index.html">Interpolation and discretization, why are they needed for projective image conversion?</a></li>
<li><a href="../en500578/index.html">The Only One That Matters (Part 4 of Mark Andriessen's Startup Guide, 2007)</a></li>
<li><a href="../en500580/index.html">Understanding CSS Grid (Part 3): Grid Areas</a></li>
<li><a href="../en500584/index.html">The prince said or where the war was. My experience in the study "War and Peace"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>