<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç∏ ‚öîÔ∏è üî∏ Cr√©ation de Minecraft en une semaine en C ++ et Vulkan üêã ü§≥üèΩ üë≤üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je me suis fix√© la t√¢che de recr√©er Minecraft √† partir de z√©ro en une semaine en utilisant mon propre moteur en C ++ et Vulkan. J'ai √©t√© inspir√© par H...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation de Minecraft en une semaine en C ++ et Vulkan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487832/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je me suis fix√© la t√¢che de recr√©er Minecraft √† partir de z√©ro en une semaine en utilisant mon propre moteur en C ++ et Vulkan. </font><font style="vertical-align: inherit;">J'ai √©t√© inspir√© par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopson</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui a fait de m√™me avec C ++ et OpenGL. </font><font style="vertical-align: inherit;">√Ä son tour, il a √©t√© inspir√© par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shane Beck</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui a √©t√© inspir√© par Minecraft, dont la source d'inspiration √©tait Infiniminer, dont la cr√©ation, vraisemblablement, a √©t√© inspir√©e par la vraie exploitation mini√®re.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa1/8b2/50c/aa18b250ce4120bd3a0dc94c01a63621.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le r√©f√©rentiel GitHub pour ce projet est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Chaque jour a sa propre balise git. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, je n'avais pas l'intention de recr√©er litt√©ralement Minecraft. </font><font style="vertical-align: inherit;">Ce projet √©tait cens√© √™tre √©ducatif. </font><font style="vertical-align: inherit;">Je voulais en savoir plus sur l'utilisation de Vulkan dans quelque chose de plus compliqu√© que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulkan-tutorial.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou la d√©mo de Sasha Willem. </font><font style="vertical-align: inherit;">Par cons√©quent, l'accent est mis principalement sur la conception du moteur Vulkan, et non sur la conception du jeu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√¢ches</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le d√©veloppement sur Vulkan est beaucoup plus lent que sur OpenGL, donc je ne pouvais pas int√©grer de nombreuses fonctionnalit√©s de ce Minecraft dans le jeu. </font><font style="vertical-align: inherit;">Il n'y a pas de monstres, pas d'artisanat, pas de pierre rouge, pas de physique des blocs, etc. </font><font style="vertical-align: inherit;">D√®s le d√©but, les objectifs du projet √©taient les suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ation d'un syst√®me de rendu de terrain</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brassage</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âclairage</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ation d'un syst√®me g√©n√©rateur de terrain</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le soulagement</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des arbres</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biomes</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout de la possibilit√© de changer de terrain et de d√©placer des blocs</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je devais trouver un moyen d'impl√©menter tout cela sans ajouter d'interface graphique au jeu, car je ne trouvais aucune biblioth√®que d'interface graphique fonctionnant avec Vulkan et facile √† int√©grer.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioth√®ques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, je n'allais pas √©crire une application Vulkan √† partir de z√©ro. </font><font style="vertical-align: inherit;">Pour acc√©l√©rer le processus de d√©veloppement, j'utiliserai autant que possible des biblioth√®ques pr√™tes √† l'emploi. </font><font style="vertical-align: inherit;">√Ä savoir:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanWrapper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mon propre wrapper C ++ pour l'API Vulkan</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLFW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour les fen√™tres et les entr√©es utilisateur</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanMemoryAllocator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour allouer de la m√©moire Vulkan</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour vecteurs et matrices math√©matiques</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour signaux / slots et ECS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour les utilitaires de chargement d'images</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FastNoise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour g√©n√©rer du bruit 3D</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jour 1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier jour, j'ai pr√©par√© un passe-partout Vulkan et un squelette moteur. </font><font style="vertical-align: inherit;">La plupart du code √©tait un passe-partout et je pouvais simplement le copier depuis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulkan-tutorial.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il comprenait √©galement une astuce avec le stockage des donn√©es de sommet dans le cadre d'un vertex shader. </font><font style="vertical-align: inherit;">Cela signifiait que je n'avais m√™me pas √† r√©gler l'allocation de m√©moire. </font><font style="vertical-align: inherit;">Un simple convoyeur qui ne peut faire qu'une seule chose: dessiner un triangle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur est assez simple pour prendre en charge le rendu des triangles. </font><font style="vertical-align: inherit;">Il a une fen√™tre et une boucle de jeu auxquelles les syst√®mes peuvent √™tre connect√©s. </font><font style="vertical-align: inherit;">L'interface graphique est limit√©e par la fr√©quence d'images affich√©e dans le titre de la fen√™tre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet est divis√© en deux parties: </font></font><code>VoxelEngine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>VoxelGame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/875/3cd/190/8753cd190975239ad550e8c0c8b27d00.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jour 2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai int√©gr√© la biblioth√®que Vulkan Memory Allocator. </font><font style="vertical-align: inherit;">Cette biblioth√®que prend en charge la plupart du passe-partout d'allocation de m√©moire Vulkan: types de m√©moire, tas de m√©moire de p√©riph√©rique et allocation secondaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que j'avais une allocation de m√©moire, j'ai cr√©√© des classes pour les maillages et les tampons de vertex. </font><font style="vertical-align: inherit;">J'ai chang√© le rendu des triangles pour qu'il utilise la classe des maillages, et non les tableaux int√©gr√©s dans le shader. </font><font style="vertical-align: inherit;">Actuellement, les donn√©es de maillage sont transf√©r√©es vers le GPU en rendant manuellement les triangles.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/627/28d/0fc/62728d0fce9015f2be4dad88f18c7b7a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peu de choses ont chang√©</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3e jour</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai ajout√© un syst√®me de rendu graphique. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce post a √©t√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pris comme base pour cr√©er cette classe </font><font style="vertical-align: inherit;">, mais la classe est tr√®s simplifi√©e. Mon graphique de rendu contient uniquement les √©l√©ments essentiels pour g√©rer la synchronisation avec Vulkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le graphique de rendu me permet de d√©finir des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n≈ìuds</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bords</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Les n≈ìuds sont le travail effectu√© par le GPU. Les nervures sont des d√©pendances de donn√©es entre les n≈ìuds. Chaque n≈ìud re√ßoit son propre tampon d'instructions, dans lequel il √©crit. Le graphique est engag√© dans des tampons de commande √† double tampon et les synchronise avec les trames pr√©c√©dentes. Les bords sont utilis√©s pour ins√©rer automatiquement des barri√®res de convoyeur avant et apr√®s l'√©criture d'un n≈ìud dans chaque tampon d'instructions. Les barri√®res de pipeline synchronisent l'utilisation de toutes les ressources et transf√®rent la propri√©t√© entre les files d'attente. De plus, les bords ins√®rent des s√©maphores entre les n≈ìuds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les n≈ìuds et les bords forment un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">graphe acyclique dirig√©</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le graphique de rendu effectue ensuite un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tri topologique.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n≈ìuds, ce qui conduit √† la cr√©ation d'une liste plate de n≈ìuds tri√©s de telle sorte que chaque n≈ìud va apr√®s tous les n≈ìuds dont il d√©pend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur a trois types de n≈ìuds. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">re√ßoit une image d'une cha√Æne tampon (swapchain), </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transf√®re les donn√©es de la CPU vers le GPU et </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fournit une image d'une cha√Æne tampon √† afficher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque n≈ìud peut impl√©menter </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui sont ex√©cut√©s dans chaque trame. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtient une image d'une cha√Æne de tampons pendant </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fournit cette image √† temps </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai refactoris√© le rendu triangle afin qu'il utilise un syst√®me de graphes de rendu, plut√¥t que de tout traiter moi-m√™me. Il y a un bord entre </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ainsi qu'entre </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela garantit que l'image de la cha√Æne tampon est correctement synchronis√©e lors de son utilisation pendant la trame.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12b/d88/6ba/12bd886ba9b41891ae1e2d0ff47b9929.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je jure que le moteur a chang√©</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jour 4</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai cr√©√© une cam√©ra et un syst√®me de rendu 3D. Jusqu'√† pr√©sent, la cam√©ra re√ßoit son propre pool de tampons et de descripteurs persistants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai ralenti ce jour-l√† parce que j'essayais de trouver la bonne configuration pour le rendu 3D avec Vulkan. La plupart des documents en ligne se concentrent sur le rendu √† l'aide d'OpenGL, qui utilise des syst√®mes de coordonn√©es l√©g√®rement diff√©rents de Vulkan. Dans OpenGL, l'axe Z de l'espace de clip est sp√©cifi√© comme </font></font><code>[-1, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le bord sup√©rieur de l'√©cran est √† </font></font><code>Y = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dans Vulkan, l'axe Z est sp√©cifi√© comme </font></font><code>[0, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le bord sup√©rieur de l'√©cran est √† </font></font><code>Y = -1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En raison de ces petites diff√©rences, les matrices de projection GLM standard ne fonctionnent pas correctement car elles sont con√ßues pour OpenGL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GLM a une option</font></font><code>GLM_FORCE_DEPTH_ZERO_TO_ONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √©liminant le probl√®me avec l'axe Z. Apr√®s cela, le probl√®me avec l'axe Y peut √™tre √©limin√© en changeant simplement le signe de </font></font><code>(1, 1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l' </font><font style="vertical-align: inherit;">√©l√©ment de </font><font style="vertical-align: inherit;">matrice de projection (GLM utilise l'indexation √† partir de 0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous inversons l'axe Y, nous devons inverser les donn√©es du sommet, car avant cela, la direction n√©gative de l'axe Y pointait vers le haut.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/05d/464/8d905d4643a189400471c7e8d4fbd3f6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant en 3D!</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5e jour</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai ajout√© une entr√©e utilisateur et la possibilit√© de d√©placer la cam√©ra avec la souris. </font><font style="vertical-align: inherit;">Le syst√®me d'entr√©e est trop sophistiqu√©, mais il √©limine les bizarreries de l'entr√©e GLFW. </font><font style="vertical-align: inherit;">En particulier, j'ai eu le probl√®me de changer la position de la souris tout en la bloquant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'entr√©e du clavier et de la souris est essentiellement une enveloppe mince au-dessus de GLFW, ouverte via des gestionnaires de signaux </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juste pour comparaison - √† peu pr√®s la m√™me chose que Hopson a fait le premier jour de son projet.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre navigateur ne prend pas en charge la vid√©o HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6e jour</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai commenc√© √† ajouter du code pour g√©n√©rer et rendre des blocs de voxels. </font><font style="vertical-align: inherit;">L'√©criture du code de maillage a √©t√© facile car je l'ai d√©j√† fait et connaissais des abstractions qui me permettaient de faire moins d'erreurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des abstractions √©tait une classe de mod√®le </font></font><code>ChunkData&lt;T, chunkSize&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui d√©finit un cube de type de la </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">taille </font></font><code>chunkSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de chaque c√¥t√©. </font><font style="vertical-align: inherit;">Cette classe stocke les donn√©es dans un tableau 1D et traite les donn√©es d'indexation avec une coordonn√©e 3D. </font><font style="vertical-align: inherit;">La taille de chaque bloc est de 16 x 16 x 16, donc les donn√©es internes sont un simple tableau d'une longueur de 4096. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre abstraction consiste √† cr√©er un it√©rateur de positions qui g√©n√®re des coordonn√©es de </font></font><code>(0, 0, 0)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√†</font></font><code>(15, 15, 15)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ces deux classes garantissent que les it√©rations avec les donn√©es de bloc sont effectu√©es dans un ordre lin√©aire pour augmenter la localit√© du cache. </font><font style="vertical-align: inherit;">La coordonn√©e 3D est toujours disponible pour les autres op√©rations qui en ont besoin. </font><font style="vertical-align: inherit;">Par exemple:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {
    <span class="hljs-keyword">auto</span>&amp; data = chunkData[pos];<font></font>
    glm::ivec3 offset = ...;<font></font>
    <span class="hljs-keyword">auto</span>&amp; neighborData = chunkData[pos + offset];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai plusieurs tableaux statiques qui sp√©cifient les d√©calages couramment utilis√©s dans le jeu. </font><font style="vertical-align: inherit;">Par exemple, il </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©finit 6 voisins avec lesquels le cube a des faces communes.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;glm::ivec3, 6&gt; Neighbors6 = {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//right</span>
        glm::ivec3(<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//left</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//top</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//bottom</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),    <span class="hljs-comment">//front</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)    <span class="hljs-comment">//back</span>
    };</code></pre><br>
<code>Neighbors26</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ce sont tous des voisins avec lesquels le cube a une face, une ar√™te ou un sommet commun. </font><font style="vertical-align: inherit;">Autrement dit, il s'agit d'une grille 3x3x3 sans cube central. </font><font style="vertical-align: inherit;">Il existe √©galement des tableaux similaires pour d'autres ensembles de voisins et pour des ensembles 2D de voisins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un tableau d√©finissant les donn√©es n√©cessaires pour cr√©er une face du cube. </font><font style="vertical-align: inherit;">Les directions de chaque face de ce tableau correspondent aux directions du tableau </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;FaceArray, 6&gt; NeighborFaces = {
    <span class="hljs-comment">//right face</span><font></font>
    FaceArray {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<font></font>
    },<font></font>
    ...<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√¢ce √† cela, le code de cr√©ation de maillage est tr√®s simple. Il contourne simplement les donn√©es des blocs et ajoute une face lorsque le bloc est solide, mais pas son voisin. Le code v√©rifie simplement chaque face de chaque cube d'un bloc. Ceci est similaire √† la m√©thode "na√Øve" d√©crite </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {<font></font>
    Block block = chunk.blocks()[pos];<font></font>
    <span class="hljs-keyword">if</span> (block.type == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; Chunk::Neighbors6.size(); i++) {<font></font>
        glm::ivec3 offset = Chunk::Neighbors6[i];<font></font>
        glm::ivec3 neighborPos = pos + offset;<font></font>
<font></font>
        <span class="hljs-comment">//<span class="hljs-doctag">NOTE:</span> bounds checking omitted</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (chunk.blocks()[neighborPos].type == <span class="hljs-number">0</span>) {<font></font>
            Chunk::FaceArray&amp; faceArray = Chunk::NeighborFaces[i];<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; faceArray.size(); j++) {<font></font>
                m_vertexData.push_back(pos + faceArray[j]);<font></font>
                m_colorData.push_back(glm::i8vec4(pos.x * <span class="hljs-number">16</span>, pos.y * <span class="hljs-number">16</span>, pos.z * <span class="hljs-number">16</span>, <span class="hljs-number">0</span>));<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai remplac√© </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. J'ai √©galement ajout√© un tampon de profondeur pour que le maillage du bloc puisse s'afficher correctement. Il √©tait n√©cessaire d'ajouter un bord suppl√©mentaire au graphique de rendu entre </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette p√©riph√©rie transf√®re la propri√©t√© des ressources de la famille de files d'attente entre la file d'attente de transfert et la file d'attente graphique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, j'ai chang√© le moteur afin qu'il puisse g√©rer correctement les √©v√©nements de changement de fen√™tre. Dans OpenGL, cela se fait simplement, mais de mani√®re assez confuse dans Vulkan. √âtant donn√© que la cha√Æne de tampons doit √™tre cr√©√©e explicitement et avoir une taille constante, lorsque vous redimensionnez la fen√™tre, vous devez la recr√©er. Vous devez recr√©er toutes les ressources qui d√©pendent de la cha√Æne de m√©moire tampon.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les commandes qui d√©pendent de la cha√Æne de m√©moire tampon (et maintenant ce sont toutes des commandes de dessin) doivent terminer l'ex√©cution avant de d√©truire l'ancienne cha√Æne de m√©moire tampon. </font><font style="vertical-align: inherit;">Cela signifie que l'ensemble du GPU sera inactif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez modifier le pipeline graphique pour fournir une fen√™tre dynamique et un redimensionnement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une cha√Æne tampon ne peut pas √™tre cr√©√©e si la taille de la fen√™tre est 0 sur l'axe X ou Y. Y compris lorsque la fen√™tre est r√©duite. </font><font style="vertical-align: inherit;">Autrement dit, lorsque cela se produit, le jeu entier est interrompu et se poursuit uniquement lorsque la fen√™tre se d√©plie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le maillage est un simple √©chiquier tridimensionnel. </font><font style="vertical-align: inherit;">Les couleurs RVB du maillage sont d√©finies en fonction de sa position XYZ multipli√©e par 16.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre navigateur ne prend pas en charge la vid√©o HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels2.webm" type="video/webm"></video></div></div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7e jour</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai fait le processus de jeu non pas un, mais plusieurs blocs √† la fois. Plusieurs blocs et leurs maillages sont g√©r√©s par la biblioth√®que ECS </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ensuite, j'ai refactoris√© le rendu de bloc pour qu'il rende tous les blocs qui sont dans ECS. Je n'ai toujours qu'un bloc, mais je </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pourrais en</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajouter de nouveaux si n√©cessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai refactoris√© le maillage afin que ses donn√©es puissent √™tre mises √† jour apr√®s sa cr√©ation. Cela me permettra de mettre √† jour le maillage des blocs √† l'avenir lorsque j'ajouterai la possibilit√© d'ajouter et de supprimer des cubes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous ajoutez ou supprimez un cube, le nombre de sommets du maillage peut potentiellement augmenter ou diminuer. Le tampon de vertex pr√©c√©demment s√©lectionn√© ne peut √™tre utilis√© que si le nouveau maillage est de la m√™me taille ou plus petit. Mais si le maillage est plus grand, de nouveaux tampons de vertex doivent √™tre cr√©√©s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tampon de vertex pr√©c√©dent ne peut pas √™tre supprim√© imm√©diatement. Il peut y avoir des tampons d'instructions ex√©cut√©s √† partir de trames pr√©c√©dentes qui sont sp√©cifiques √† un objet particulier </font></font><code>VkBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le moteur doit conserver un tampon jusqu'√† ce que ces tampons de commande soient termin√©s. Autrement dit, si nous dessinons un maillage dans un cadre </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le GPU peut utiliser ce tampon avant le d√©but du cadre </font></font><code>i + 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le tampon ne peut pas √™tre retir√© du CPU tant que le GPU n'a pas fini de l'utiliser. J'ai donc chang√© le graphique de rendu pour qu'il suive la dur√©e de vie des ressources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le n≈ìud du graphe de rendu souhaite utiliser une ressource (tampon ou image), il doit alors appeler la m√©thode </font></font><code>sync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† l'int√©rieur de la m√©thode </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette m√©thode obtient un pointeur </font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur une ressource. Cette</font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">garantit que la ressource ne sera pas supprim√©e pendant l'ex√©cution des tampons de commande. </font><font style="vertical-align: inherit;">(En termes de performances, cette solution n'est pas tr√®s bonne. Plus d'informations √† ce sujet plus tard.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le maillage du bloc est r√©g√©n√©r√© dans chaque cadre.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Votre navigateur ne prend pas en charge la vid√©o HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels3.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout ce que j'ai fait en une semaine - j'ai pr√©par√© les bases du rendu du monde avec plusieurs blocs de voxels et je continuerai √† travailler la deuxi√®me semaine.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487812/index.html">Test du spectre LED polonais Led E27</a></li>
<li><a href="../fr487814/index.html">La vitesse et la fiabilit√© sont plus √©lev√©es et le prix est plus bas. Nouveaux disques SSD Kingston KC2000</a></li>
<li><a href="../fr487822/index.html">AvitoTech On Tour: rencontre Android √† Nizhny Novgorod</a></li>
<li><a href="../fr487824/index.html">Aper√ßu des lampes LED Spectrum Led GU10 d'Europe</a></li>
<li><a href="../fr487826/index.html">Vue d'ensemble des lampes LED de Poland Spectrum Led E14</a></li>
<li><a href="../fr487834/index.html">Semaine de s√©curit√© 07: vuln√©rabilit√© de la pile Bluetooth Android</a></li>
<li><a href="../fr487836/index.html">T√©l√©chargement interactif de fichiers sur le serveur √† l'aide de RxJS</a></li>
<li><a href="../fr487838/index.html">Validation des donn√©es: une approche diff√©rente</a></li>
<li><a href="../fr487842/index.html">2 SIM pour un routeur de pays - est-ce beaucoup ou peu?</a></li>
<li><a href="../fr487844/index.html">L'odeur r√©v√®le</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>