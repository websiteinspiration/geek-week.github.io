<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèæ üßóüèø üåü Assert messages in tests üíÖüèº üÜñ üò•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello again. Ahead of the start of the "C # Developer" course , we have translated interesting material about assert messages in tests and are happy t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Assert messages in tests</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489274/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello again. </font><font style="vertical-align: inherit;">Ahead of the start of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C # Developer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> course </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">, we have</font></a><font style="vertical-align: inherit;"> translated interesting material about assert messages in tests and are happy to share the translation with you.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/ib/ig/bo/ibigbo8btlszevaqfb4awgpmml0.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this post we will talk about whether you should use Assert messages in your tests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I received an interesting question from a reader colleague, which I would like to dwell on in more detail: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I have a question about Assert messages: should I use the overload containing the message parameter and use it to send a string describing the reason for the failure of Assert (also ‚ÄúClaims‚Äù) ?</font></font></i><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The answer to this question comes down to two aspects:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Readability of the test - how easy it is to understand what the test does.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ease of diagnosis - how easy it is to understand why the test fails.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's discuss each of them individually</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test readability</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
People often use Assert messages to help team members and themselves in the future understand what is happening in the test. </font><font style="vertical-align: inherit;">Let's look at the following example:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    Assert.AreEqual(UserType.Employee, person.Type); <span class="hljs-comment">//  </span>
    Assert.AreEqual(<span class="hljs-number">1</span>, company.NumberOfEmployees); <span class="hljs-comment">//  </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead of a bare Assert, you can also indicate the reason why the test Assert validates something:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    Assert.AreEqual(UserType.Employee, person.Type, <span class="hljs-string">"Person must become an employee after hiring"</span>);<font></font>
    Assert.AreEqual(<span class="hljs-number">1</span>, company.NumberOfEmployees, <span class="hljs-string">"Number of employees must increase"</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Such statements help, but they come at a price. </font><font style="vertical-align: inherit;">These messages require you</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spend time writing them</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keep them moving forward</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here the set of pros and cons is the same as in the comments to the code. And, as in the case of the comments, I advise you: do not write assert messages purely for readability purposes. If you feel that the test is not obvious without assert messages, try refactoring it instead. In the long run, it‚Äôs easier to make the test speak for itself than to keep it in sync with assert messages (and this is only a matter of time before the synchronization is broken). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enter assert messages only when absolutely necessary - when you cannot improve the readability of the test in any other way. But even then, incline to choose not to write them.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The easiest way to get a quick gain in test readability is to switch to a readable statement record. </font><font style="vertical-align: inherit;">For example, NUnit has a special constraint based assertion model that helps you write your assertions as follows:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    Assert.That(person.Type, Is.EqualTo(UserType.Employee));<font></font>
    Assert.That(company.NumberOfEmployees, Is.EqualTo(<span class="hljs-number">1</span>));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or you can use my favorite </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fluent Assertions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Test</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hiring_a_new_team_member</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> company = <span class="hljs-keyword">new</span> Company();
    <span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(UserType.Customer);<font></font>
<font></font>
    company.HireNewMember(person);<font></font>
<font></font>
    person.Type.Should().Be(UserType.Employee);<font></font>
    company.NumberOfEmployees.Should().Be(<span class="hljs-number">1</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These statements are read in plain English ‚Äî exactly the way you would like all your code to be read. </font><font style="vertical-align: inherit;">We humans prefer to perceive information in the form of stories. </font><font style="vertical-align: inherit;">All stories adhere to this model:</font></font><br>
<br>
<pre><code class="plaintext hljs">[] [] [].</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For instance,</font></font><br>
<br>
<pre><code class="plaintext hljs">  .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the subject, </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the action, and </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the object. </font><font style="vertical-align: inherit;">The same goes for code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This version</font></font><br>
<br>
<pre><code class="cs hljs">company.NumberOfEmployees.Should().Be(<span class="hljs-number">1</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
reads better than</font></font><br>
<br>
<pre><code class="cs hljs">Assert.AreEqual(<span class="hljs-number">1</span>, company.NumberOfEmployees);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
precisely because history is traced here.</font></font><br>
<blockquote><i>,        .        ,     .</i></blockquote><h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another view of assert messages is in terms of ease of diagnosis. In other words, the simplicity of understanding the cause of a test failure without examining the code for this test. This is useful when reading CI assembly results. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From a diagnostic point of view, follow this guide: if you can easily restart the test locally, this test does not need an assert message. This is true for all unit tests (since they do not work with out-of-process dependencies), but to a lesser extent for integration and end-to-end tests. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/xu/iv/omxuivj5p6pgy71y_yisnf9gl0c.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testing pyramid</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As you climb higher in the test pyramid, you may need more detailed information, because integration (and especially end-to-end) tests are slower and you may not be able to re-run them at will.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But even with integration and end-to-end tests, there are ways to facilitate diagnostics without resorting to assert messages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Make the test test one behavior module - when a test checks one thing, it is often easy to determine what went wrong. </font><font style="vertical-align: inherit;">(This is not always applicable to end-to-end tests, as you might want these tests to check how several units of behavior work closely).</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name your unit tests accordingly</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - The ideal test name describes the behavior of the application in business terms so that even a non-programmer can understand it.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And don't forget that even without user statements, you still have the messages that the unit testing environment generates for you. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, an error in the following statement:</font></font><br>
<br>
<pre><code class="cs hljs">person.Type.Should().Be(UserType.Employee);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gives the following error message:</font></font><br>
<br>
<pre><code class="cs hljs">Xunit.Sdk.EqualException: Assert.Equal() Failure<font></font>
Expected: Employee<font></font>
Actual:   Customer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The combination of such messages generated by the environment and human-readable test names makes 90% of user-assert messages useless even in terms of ease of diagnosis. </font><font style="vertical-align: inherit;">The only exception is lengthy end-to-end tests. </font><font style="vertical-align: inherit;">They often contain multi-stage checks, so it makes sense to use additional assert messages to understand which of the steps failed. </font><font style="vertical-align: inherit;">However, there should not be many such end-to-end tests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, in order to take advantage of the error messages generated by the framework, you need to avoid common Boolean comparisons, such as:</font></font><br>
<br>
<pre><code class="cs hljs">(person.Type == UserType.Employee).Should().BeTrue();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Because they lead to the following error message:</font></font><br>
<br>
<pre><code class="cs hljs">Xunit.Sdk.TrueException: Assert.True() Failure<font></font>
Expected: True<font></font>
Actual:   False</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Which does not help with the diagnosis at all.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do you often feel lazy when it comes to writing statements? </font><font style="vertical-align: inherit;">Well, now you can justify it and send your colleagues to this article. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/yo/-f/ftyo-f1errhnirhqufowrtbn0ee.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúI am glad that this has a name‚Äù</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jokes aside, however, here is a summary:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are two aspects to using assert messages:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Readability of the test (how easy it is to understand what the test does).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ease of diagnosis (how easy it is to understand why the test fails during CI build).</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In terms of test readability, assert messages are code comments. </font><font style="vertical-align: inherit;">Instead of relying on them, refactor your test to achieve readability.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In terms of ease of diagnosis, the best alternative to assert messages is:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testing a single behavior module by a test</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naming tests in business terms</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The only exception is lengthy end-to-end tests.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all. </font><font style="vertical-align: inherit;">You can learn more about our course at the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free webinar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will be held today.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489260/index.html">How to design a large-scale automated system for a large enterprise in seven steps</a></li>
<li><a href="../en489262/index.html">Why it's not easy to give developers freedom of choice</a></li>
<li><a href="../en489268/index.html">Implementation of the process of uploading a file from a container with a browser to a test framework</a></li>
<li><a href="../en489270/index.html">WebAuthn in real life</a></li>
<li><a href="../en489272/index.html">Eyes, brain, video quality: reflections on 120fps, 8K, HDR, wands, cones and the ‚Äúsoap opera effect‚Äù</a></li>
<li><a href="../en489276/index.html">Blood test for iron - how to control the level, diagnose the reasons why it is important</a></li>
<li><a href="../en489280/index.html">Ping all IPv6 hosts on the channel</a></li>
<li><a href="../en489282/index.html">DirectX 12 - From Leonardo da Vinci to Contemporary Art</a></li>
<li><a href="../en489284/index.html">My favorite Chrome developer tools</a></li>
<li><a href="../en489286/index.html">Briefs, socks and shaving brush: anti-rating of gifts on February 23</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>