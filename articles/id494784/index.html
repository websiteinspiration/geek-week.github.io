<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ’­ ğŸ™‡ğŸ¾ DBLog - kerangka kerja umum untuk Ubah Pengambilan Data ğŸ£ ğŸ‘¸ğŸ½ ğŸ™ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! Kami menawarkan Anda untuk membaca terjemahan artikel, yang kami siapkan khusus untuk siswa dari kursus "Arsitek Beban Tinggi" .
 
 
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DBLog - kerangka kerja umum untuk Ubah Pengambilan Data</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/494784/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya! </font><font style="vertical-align: inherit;">Kami menawarkan Anda untuk membaca terjemahan artikel, yang kami siapkan khusus untuk siswa dari kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Arsitek Beban Tinggi"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/0l/li/m7/0llim77k9jjhhp94nyd5qozgmxw.png"><br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melacak perubahan data (Change Data Capture, CDC) memungkinkan Anda untuk menerima secara real time perubahan yang dilakukan dalam database dan mendistribusikannya ke berbagai konsumen [1] [2]. CDC menjadi semakin populer ketika sinkronisasi antara data warehousing heterogen diperlukan (misalnya, MySQL dan ElasticSearch) dan merupakan alternatif untuk metode tradisional seperti dual-tulis dan transaksi terdistribusi [3] [4].</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sumber untuk CDC, dalam database seperti MySQL dan PostgreSQL, adalah log transaksi (log transaksi). Tetapi karena log transaksi biasanya terpotong, mereka mungkin tidak mengandung seluruh sejarah perubahan. Oleh karena itu, untuk mendapatkan status sumber sepenuhnya, kita perlu dump. Kami memeriksa beberapa proyek CDC open source, sering menggunakan pustaka, API basis data, dan protokol yang sama, dan menemukan sejumlah batasan di dalamnya yang tidak memenuhi persyaratan kami. Misalnya, menghentikan pemrosesan peristiwa log hingga penyelesaian dump (snapshot data lengkap), ketidakmampuan untuk memulai dump dumping berdasarkan permintaan atau implementasi, memengaruhi lalu lintas tulis karena penggunaan kunci meja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini mendorong kami untuk mengembangkan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBLog.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan pendekatan terpadu untuk memproses log dan dump. </font><font style="vertical-align: inherit;">Untuk mendukungnya, sejumlah fungsi harus diimplementasikan dalam DBMS, yang sudah ada di MySQL, PostgreSQL, MariaDB, dan sejumlah database lainnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa fitur DBLog:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Log peristiwa diproses dalam urutan terjadinya.</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dumps dapat dibuat kapan saja</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk semua tabel, untuk satu tabel atau untuk kunci primer spesifik suatu tabel.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemrosesan log berganti dengan pemrosesan sampah, membagi dump menjadi beberapa blok. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan demikian, pemrosesan log dapat terjadi secara paralel dengan pemrosesan dump. </font><font style="vertical-align: inherit;">Jika proses berakhir maka dapat dilanjutkan setelah blok selesai terakhir tanpa harus memulai dari awal lagi. </font><font style="vertical-align: inherit;">Ini juga memungkinkan Anda untuk menyesuaikan throughput saat membuat dump dan, jika perlu, menghentikan sementara pembuatannya.</font></font></li>
<li><b>   </b>,          .</li>
<li><b>   </b>: ,     API.</li>
<li><b>     </b>.    ,           .</li>
</ul><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelumnya, kami membahas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terjemahan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), sebuah platform untuk pengayaan dan sinkronisasi data. Tujuan Delta adalah untuk menyinkronkan beberapa penyimpanan data, di mana salah satunya adalah primer (misalnya, MySQL), dan turunan lainnya (misalnya, ElasticSearch). Salah satu persyaratan pengembangan utama adalah keterlambatan rendah dalam menyebarkan perubahan dari sumber ke penerima, serta ketersediaan tinggi dari aliran acara. Ketentuan ini berlaku terlepas dari apakah semua gudang data digunakan oleh satu tim atau jika satu tim memiliki data dan yang lainnya mengkonsumsinya. Dalam sebuah artikel tentang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terjemahan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), kami juga menjelaskan kasus penggunaan yang melampaui sinkronisasi data, seperti pemrosesan acara.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menyinkronkan data dan memproses peristiwa, selain dapat melacak perubahan secara real time, kita harus memenuhi persyaratan berikut:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mendapatkan status penuh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Toko yang diturunkan (seperti ElasticSearch) pada akhirnya harus menyimpan status sumber sepenuhnya. </font><font style="vertical-align: inherit;">Kami menerapkan ini melalui kesedihan dari database asli.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mulai pemulihan negara kapan saja. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daripada mempertimbangkan dump sebagai operasi satu kali hanya untuk inisialisasi primer, kita dapat melakukannya kapan saja: untuk semua tabel, untuk satu tabel atau untuk kunci primer spesifik. </font><font style="vertical-align: inherit;">Ini sangat penting untuk pemulihan konsumen jika terjadi kehilangan atau kerusakan data.</font></font></li>
<li><b>    - </b>.          . ,        (,    ).              - .  ,  -        .</li>
<li><b>    </b>.                          .     API,     , ,  .        ,          ,  ,  .</li>
<li><b>   </b>.     Netflix   ,   Kafka, SQS, Kinesis,     Netflix,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Keystone</a>.   ,           (,    ),      (,    ).           .        API.</li>
<li><b>   </b>.  Netflix  ,    (MySQL, PostgreSQL)  AWS RDS.        .</li>
</ul><br>
<br>
<h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memeriksa beberapa solusi open source yang ada, termasuk: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxwell</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpinalTap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Yelp </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Streamer,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debezium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dalam hal pengumpulan data, mereka semua bekerja dengan cara yang sama, menggunakan log transaksi. </font><font style="vertical-align: inherit;">Misalnya, menggunakan protokol replikasi binlog di MySQL atau slot replikasi di PostgreSQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi ketika memproses dump, mereka memiliki setidaknya satu dari batasan berikut:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hentikan pemrosesan log peristiwa saat membuat dump</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Akibatnya, jika tempat pembuangan besar, maka pemrosesan peristiwa log berhenti untuk waktu yang lama. </font><font style="vertical-align: inherit;">Ini akan menjadi masalah jika konsumen mengandalkan penundaan kecil dalam menyebarkan perubahan.</font></font></li>
<li><b>     </b>.                .                (,   ElasticSearch)        .</li>
<li><b>      </b>.         .                    [5].          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a>,         .         . ,  PostgreSQL RDS        .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan fungsi basis data tertentu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kami menemukan bahwa beberapa solusi menggunakan fitur basis data tambahan yang tidak ada pada semua sistem. </font><font style="vertical-align: inherit;">Misalnya, menggunakan mesin lubang hitam di MySQL atau mendapatkan snapshot dump yang konsisten melalui slot replikasi di PostgreSQL. </font><font style="vertical-align: inherit;">Kode batas ini digunakan kembali antara database yang berbeda.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada akhirnya, kami memutuskan untuk mengambil pendekatan berbeda untuk bekerja dengan dump:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log alternatif dan peristiwa dump sehingga mereka dapat dieksekusi bersama;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memulai dump kapan saja;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan gunakan kunci meja</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan gunakan fitur basis data tertentu.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerangka DBLog</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBLog adalah kerangka kerja java untuk menerima dump dan perubahan secara real time. Dump dilakukan dalam beberapa bagian sehingga mereka bergantian dengan peristiwa waktu nyata dan tidak menunda pemrosesan mereka untuk waktu yang lama. Dumps dapat dilakukan kapan saja melalui API. Hal ini memungkinkan konsumen untuk mendapatkan keadaan penuh dari database pada tahap inisialisasi atau lambat untuk pemulihan bencana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat merancang kerangka kerja, kami berpikir untuk meminimalkan dampak pada database. Dumps dapat dijeda dan dilanjutkan seperlunya. Ini berfungsi baik untuk pemulihan kerusakan dan untuk berhenti jika database telah menjadi hambatan. Kami juga tidak mengunci tabel agar tidak memengaruhi operasi penulisan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBLog memungkinkan Anda untuk merekam acara dalam berbagai bentuk, termasuk di basis data lain atau melalui API. </font><font style="vertical-align: inherit;">Untuk menyimpan status yang terkait dengan pemrosesan log dan dump, serta untuk memilih node master, kami menggunakan Zookeeper. </font><font style="vertical-align: inherit;">Saat membuat DBLog, kami menerapkan kemampuan untuk menghubungkan berbagai plugin, memungkinkan Anda untuk mengubah implementasi sesuai keinginan (misalnya, mengganti Zookeeper dengan yang lain). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kami mempertimbangkan secara lebih rinci pemrosesan log dan dump.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Log</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kerangka kerja ini membutuhkan database untuk merekam acara untuk setiap baris yang diubah secara real time, sambil mempertahankan urutan komitmen. Sumber peristiwa ini diasumsikan sebagai log transaksi. Basis data mengirimkannya melalui transportasi yang dapat digunakan DBLog. Untuk transportasi ini kami menggunakan istilah "log perubahan". Suatu acara dapat dari jenis berikut: buat, buat, perbarui, atau hapus. Untuk setiap peristiwa, informasi berikut harus diberikan: nomor urut dalam log (nomor urut log), keadaan kolom selama operasi, dan skema yang diterapkan pada saat operasi dilakukan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap perubahan serial ke dalam format acara DBLog dan dikirim ke penulis, untuk transfer lebih lanjut ke output. </font><font style="vertical-align: inherit;">Mengirim acara ke penulis adalah operasi non-pemblokiran, karena penulis berjalan di utas terpisah dan mengumpulkan peristiwa dalam buffer internal. </font><font style="vertical-align: inherit;">Acara yang disangga dikirim sesuai urutan penerimaannya. </font><font style="vertical-align: inherit;">Kerangka kerja ini memungkinkan Anda untuk menghubungkan formatter khusus untuk membuat cerita bersambung peristiwa ke dalam format sewenang-wenang. </font><font style="vertical-align: inherit;">Output adalah antarmuka sederhana yang memungkinkan Anda terhubung ke penerima apa pun, seperti aliran, gudang data, atau bahkan API.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesedihan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pembuangan diperlukan karena log transaksi memiliki waktu penyimpanan terbatas, yang mencegahnya digunakan untuk memulihkan set data asli lengkap. Dump dibuat dalam blok (chunk) sehingga mereka dapat bergantian dengan peristiwa log, memungkinkan mereka untuk diproses secara bersamaan. Untuk setiap baris blok yang dipilih, suatu peristiwa dihasilkan dan diserialisasi dalam format yang sama dengan peristiwa log. Dengan demikian, konsumen tidak perlu khawatir suatu peristiwa datang dari log atau dump. Baik peristiwa log dan peristiwa dump dikirim ke output melalui penulis yang sama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dumps dapat dijadwalkan kapan saja melalui API untuk semua tabel, satu tabel, atau untuk kunci utama spesifik tabel. Tumpukan meja dilakukan oleh balok dengan ukuran tertentu. Anda juga dapat mengonfigurasi penundaan dalam memproses blok baru, yang hanya mengizinkan aktivitas log saat ini. Ukuran dan penundaan blok memungkinkan Anda menyeimbangkan pemrosesan peristiwa log dan dump. Kedua pengaturan dapat diubah saat runtime. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blok (chunk) dipilih dengan mengurutkan tabel dalam urutan naik dari kunci primer dan memilih baris di mana kunci utama lebih besar dari kunci primer terakhir dari blok sebelumnya. Basis data diperlukan untuk menjalankan kueri ini secara efisien, yang biasanya berlaku untuk sistem yang menerapkan pemindaian rentang pada rentang kunci utama.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ka/io/cc/kaioccujfq6yx3mcch7btisn-zo.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar 1. Tabel breakdown dengan 4 kolom c1-c4 dan c1 sebagai kunci utama (pk). Kunci utama dari tipe integer, ukuran blok 3. Blok 2 dipilih dengan kondisi c1&gt; 4.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Blok harus diambil sedemikian rupa agar tidak menunda pemrosesan peristiwa log untuk periode yang lama dan menyimpan riwayat perubahan sehingga baris yang dipilih dengan nilai lama tidak dapat menimpa yang lebih baru peristiwa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar dapat memilih blok secara berurutan, dalam log perubahan kita membuat "tanda air" yang dapat dikenali. </font><font style="vertical-align: inherit;">Tanda air diimplementasikan melalui tabel di basis data sumber. </font><font style="vertical-align: inherit;">Tabel ini disimpan dalam namespace khusus sehingga tidak ada konflik dengan tabel aplikasi. </font><font style="vertical-align: inherit;">Hanya satu baris dengan nilai UUID yang disimpan di dalamnya. </font><font style="vertical-align: inherit;">Tanda air dibuat ketika nilai ini berubah menjadi UUID tertentu. </font><font style="vertical-align: inherit;">Memperbarui baris mengarah ke acara perubahan, yang akhirnya kami terima melalui log perubahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tempat pembuangan air ditandai sebagai berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami sementara menangguhkan pemrosesan acara log.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasilkan tanda air "rendah" dengan memperbarui tabel tanda air.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mulai SELECT untuk blok berikutnya dan menyimpan dalam memori hasil diindeks oleh kunci utama.</font></font></li>
<li> â€œâ€ (high)  ,    .</li>
<li>    .         .</li>
<li>              ,     .</li>
<li>     ,     ,         .</li>
<li>   ,     1.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT seharusnya mengembalikan negara yang mewakili perubahan berkomitmen hingga titik dalam sejarah. Atau, setara dengan yang berikut: SELECT dijalankan di posisi tertentu dari log perubahan, dengan mempertimbangkan perubahan akun hingga saat ini. Database biasanya tidak memberikan informasi tentang waktu eksekusi SELECT (dengan pengecualian </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gagasan utama dari pendekatan kami adalah bahwa dalam log perubahan kami mendefinisikan jendela yang menjamin pelestarian posisi SELECT di blok. Jendela dibuka dengan menuliskan tanda air lebih rendah, setelah itu SELECT dijalankan, dan jendela ditutup dengan menuliskan tanda air atas. Karena posisi pasti SELECT tidak diketahui, semua baris yang dipilih yang bertentangan dengan peristiwa log di jendela ini dihapus. Ini memastikan bahwa tidak ada penulisan ulang sejarah di log perubahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar ini berfungsi, SELECT harus membaca status tabel sejak saat tanda air lebih rendah atau lebih baru (diizinkan untuk menyertakan perubahan yang dibuat setelah tanda air lebih rendah dan sebelum membaca). Secara umum, </font><b><font style="vertical-align: inherit;">SELECT</font></b><font style="vertical-align: inherit;"> diperlukan untuk </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melihat perubahan yang dibuat sebelum dieksekusi.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Kami menyebutnya "bacaan non-basi". Selain itu, karena tanda air atas ditulis setelahnya, dijamin bahwa SELECT akan dieksekusi sebelum itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar 2a dan 2b menggambarkan algoritma pemilihan blok. Sebagai contoh, kami memberikan tabel dengan kunci utama dari k1 ke k6. Setiap entri dalam log perubahan mewakili acara buat, perbarui, atau hapus untuk kunci utama. Gambar 2a menunjukkan pembuatan tanda air dan pemilihan blok (langkah 1 hingga 4). Memperbarui tabel tanda air pada langkah 2 dan 4 menciptakan dua peristiwa perubahan (magenta), yang akhirnya diterima melalui log. Pada Gambar 2b, kami fokus pada garis blok saat ini yang dihapus dari hasil yang ditetapkan dengan kunci utama yang muncul di antara tanda air (langkah 5 hingga 7).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/3w/ej/8w3wej0evpfqtnpdkbozswm58yu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar 2a - Algoritma Watermark untuk pemilihan blok (langkah 1-4). </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sg/i5/9s/sgi59s3d8zgf-f2eusi2itklqyu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar 2b - Algoritma Watermark untuk memilih blok (langkah 5-7).</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap dicatat bahwa antara tanda air yang lebih rendah dan yang lebih tinggi, sejumlah besar peristiwa dapat muncul di log jika satu atau lebih transaksi membuat banyak perubahan baris. </font><font style="vertical-align: inherit;">Untuk alasan ini, kami melakukan penangguhan jangka pendek dari pemrosesan log pada tahap 2-4 agar tidak ketinggalan tanda air. </font><font style="vertical-align: inherit;">Dengan demikian, pemrosesan peristiwa log dapat dilanjutkan peristiwa demi peristiwa, yang pada akhirnya memungkinkan Anda untuk mendeteksi tanda air tanpa perlu melakukan cache peristiwa log. </font><font style="vertical-align: inherit;">Pemrosesan log ditangguhkan hanya untuk waktu yang singkat, karena langkah 2â€“4 diharapkan lebih cepat: memperbarui tanda air adalah operasi penulisan tunggal, dan SELECT dilakukan dengan pembatasan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segera setelah tanda air atas diterima pada langkah 7, garis-garis blok yang tidak bertentangan ditransmisikan ke output sesuai urutan mereka diterima. </font><font style="vertical-align: inherit;">Ini adalah operasi non-pemblokiran, karena penulis berjalan di utas terpisah, yang memungkinkan Anda untuk dengan cepat melanjutkan memproses log setelah langkah 7. Setelah itu, pemrosesan log berlanjut untuk peristiwa yang terjadi setelah tanda air atas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar 2c menunjukkan urutan rekaman untuk seluruh blok menggunakan contoh yang sama seperti pada gambar 2a dan 2b. </font><font style="vertical-align: inherit;">Peristiwa dalam log yang muncul sebelum tanda air atas dicatat terlebih dahulu. </font><font style="vertical-align: inherit;">Kemudian garis yang tersisa dari hasil blok (magenta). </font><font style="vertical-align: inherit;">Dan akhirnya, peristiwa yang terjadi setelah tanda air teratas dicatat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4y/er/et/4yeretd8vbgtxvbp7sm9ppdxe7m.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar 2c - Urutan perekaman output. </font><font style="vertical-align: inherit;">Strip pergantian dengan dump.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Database yang didukung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menggunakan DBLog, database harus menyediakan log perubahan sebagai riwayat linear dari perubahan yang dilakukan dengan pembacaan non-basi. Kondisi ini dipenuhi oleh sistem seperti MySQL, PostgreSQL, MariaDB, dll., Sehingga kerangka kerja dapat digunakan dengan cara yang sama dengan database ini. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sejauh ini, kami telah menambahkan dukungan untuk MySQL dan PostgreSQL. Setiap basis data menggunakan perpustakaannya sendiri untuk menerima peristiwa log, karena masing-masing menggunakan protokol berpemilik. Untuk MySQL, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shyiko / mysql-binlog-connector</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengimplementasikan protokol replikasi binlog. Untuk PostgreSQL, ada slot replikasi dengan plugin </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wal2json</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Perubahan diterima melalui protokol replikasi streaming, yang diimplementasikan oleh </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">driver jdbc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL </font><font style="vertical-align: inherit;">Definisi skema untuk setiap perubahan yang diambil berbeda di MySQL dan PostgreSQL. </font><font style="vertical-align: inherit;">Di PostgreSQL, wal2json berisi nama, tipe kolom, dan nilai-nilai. </font><font style="vertical-align: inherit;">Untuk MySQL, perubahan skema harus dilacak sebagai peristiwa binlog. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemrosesan Dump dilakukan menggunakan SQL dan JDBC, hanya membutuhkan implementasi pemilihan blok dan memperbarui tanda air. </font><font style="vertical-align: inherit;">Untuk MySQL dan PostgreSQL, kode yang sama digunakan, yang dapat digunakan untuk database serupa lainnya. </font><font style="vertical-align: inherit;">Pemrosesan dump itu sendiri tidak tergantung pada SQL atau JDBC dan memungkinkan Anda untuk menggunakan database yang memenuhi persyaratan DBLog, bahkan jika mereka menggunakan standar yang berbeda. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/wg/nz/wuwgnzkxmagsrtt2_qnyp_yfiy8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar 3 - Arsitektur DBLog tingkat tinggi.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketersediaan tinggi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBLog menggunakan arsitektur pasif aktif node tunggal. </font><font style="vertical-align: inherit;">Satu instance aktif (terkemuka), sementara yang lain pasif (siaga). </font><font style="vertical-align: inherit;">Untuk memilih host, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zookeeper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sewa digunakan untuk node master, yang harus diperbarui secara berkala untuk terus menjadi master. </font><font style="vertical-align: inherit;">Dalam hal penghentian pembaruan sewa, fungsi pemimpin ditransfer ke simpul lain. </font><font style="vertical-align: inherit;">Saat ini, kami menyebarkan satu salinan untuk setiap AZ (zona ketersediaan, biasanya kami memiliki 3 AZ), jadi jika satu AZ jatuh, maka salinan di AZ lain dapat melanjutkan pemrosesan dengan total waktu henti minimum. </font><font style="vertical-align: inherit;">Mesin virtual cadangan dapat ditemukan di wilayah yang berbeda, meskipun Anda disarankan untuk bekerja di wilayah yang sama dengan host database untuk memberikan latensi rendah untuk menangkap perubahan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gunakan pada Produksi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBLog adalah dasar untuk konektor MySQL dan PostgreSQL yang digunakan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sejak 2018, Delta telah digunakan dalam produksi untuk menyinkronkan gudang data dan pemrosesan acara di aplikasi studio Netflix. </font><font style="vertical-align: inherit;">Konektor Delta menggunakan serializer acara mereka. </font><font style="vertical-align: inherit;">Aliran spesifik Netflix seperti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keystone</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digunakan sebagai output </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5g/3j/fo/5g3jfo6pe8l-mpsqrngh6ylvtyc.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar 4 - Konektor Delta. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain Delta, DBLog juga digunakan di Netflix untuk membuat konektor untuk platform pergerakan data lainnya yang memiliki format data sendiri.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tetaplah bersama kami</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBLog memiliki fitur tambahan yang tidak tercakup dalam artikel ini, seperti:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemampuan untuk mendapatkan skema tabel tanpa menggunakan kunci.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integrasi dengan penyimpanan skema. </font><font style="vertical-align: inherit;">Untuk setiap peristiwa, skema disimpan dalam penyimpanan, tautan yang ditunjukkan dalam muatan acara.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode tulis monoton. </font><font style="vertical-align: inherit;">Memastikan bahwa setelah menyimpan status baris tertentu, status lampau tidak dapat ditimpa. </font><font style="vertical-align: inherit;">Dengan demikian, konsumen menerima perubahan negara hanya dalam arah maju, tanpa bergerak maju mundur dalam waktu.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami berencana untuk membuka kode sumber DBLog pada tahun 2020 dan menyertakan dokumentasi tambahan di dalamnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ucapan Terima Kasih</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami ingin mengucapkan terima kasih kepada orang-orang berikut untuk berkontribusi pada pengembangan DBLog: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Josh Snyder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raghuram Onti Srinivasan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tharanga Gamaethige</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yun Wang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referensi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[1] Das, Shirshanka, dkk. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Semua di atas Databus!: Platform pengambilan data perubahan yang konsisten yang dapat diukur dari Linkedin." </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simposium ACM Ketiga tentang Cloud Computing. </font><font style="vertical-align: inherit;">ACM, 2012 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[2] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Tentang Ubah Pengambilan Data (SQL Server)"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Microsoft SQL docs, 2019 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[3] Kleppmann, Martin, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Menggunakan log untuk membangun infrastruktur data yang solid (atau: mengapa menulis ganda adalah ide yang buruk)"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Confluent, 2015 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[4] Kleppmann, Martin, Alastair R. Beresford, Boerge Svingen. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pemrosesan acara online." </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komunikasi ACM 62.5 (2019): 43â€“49 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[5] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://debezium.io/documentation/reference/0.10/connectors/mysql.html#snapshots </font></font><br>
</a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelajari lebih lanjut tentang kursus.</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id494766/index.html">Tren teknologi komunikasi masa depan</a></li>
<li><a href="../id494772/index.html">Bagaimana perang melawan panggilan robot berkembang di AS - pada ukuran politisi dan perusahaan telekomunikasi</a></li>
<li><a href="../id494776/index.html">PostgreSQL Antipatterns: menghitung kondisi dalam SQL</a></li>
<li><a href="../id494780/index.html">Pengungkapan dan ketakutan seorang karyawan Amazon di era coronavirus</a></li>
<li><a href="../id494782/index.html">Klasifikasi gambar di Android menggunakan TensorFlow Lite dan Azure Custom Vision</a></li>
<li><a href="../id494786/index.html">Dukungan RTOS seperti MitM di GDB</a></li>
<li><a href="../id494788/index.html">Cara kerja email</a></li>
<li><a href="../id494792/index.html">Yandex.Routing: bagaimana kami terjun ke bidang logistik dan memutuskan untuk mengubah masa depan</a></li>
<li><a href="../id494794/index.html">Kami memiliki lengan panjang</a></li>
<li><a href="../id494798/index.html">Snowden: pandemi akan berakhir, tetapi pengawasan populasi akan tetap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>