<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ ğŸ’² ğŸ‘¨ğŸ½â€ğŸš€ æšä¸¾ç¬¬äºŒéƒ¨åˆ†ä¸­çš„æœ€å¤§å€¼æ•° âš ï¸ ğŸ”“ ğŸ§‘ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬ä¸€éƒ¨åˆ†ï¼Œç†è®º Â |Â ç¬¬äºŒéƒ¨åˆ†ï¼Œå®ç”¨
 
 
 æˆ‘ä»¬ç»§ç»­åœ¨æšä¸¾ä¸­æœç´¢å€¼çš„æœ€å¤§æ•°é‡ã€‚
 è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºé—®é¢˜çš„å®é™…æ–¹é¢ï¼Œå¹¶äº†è§£IDEï¼Œç¼–è¯‘å™¨å’ŒJVMå°†å¦‚ä½•å“åº”æˆ‘ä»¬çš„æˆå°±ã€‚
 
 å†…å®¹
 â€ƒâ€ƒ
 â€ƒâ€ƒJavac å·¥å…·
 â€ƒâ€ƒæå–æ–¹æ³•
 â€ƒâ€ƒåŠ¨æ€ç±»æ–‡ä»¶å¸¸é‡
 â€ƒâ€ƒâ€ƒâ€ƒçªå¦‚å…¶æ¥çš„å›°éš¾
 â€ƒâ€ƒâ€ƒâ€ƒå…‰æ˜çš„æœªæ¥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æšä¸¾ç¬¬äºŒéƒ¨åˆ†ä¸­çš„æœ€å¤§å€¼æ•°</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501870/"><nobr><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬ä¸€éƒ¨åˆ†ï¼Œç†è®º</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;|&nbsp;</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬äºŒéƒ¨åˆ†ï¼Œå®ç”¨</font></font></b></nobr><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç»§ç»­åœ¨æšä¸¾ä¸­æœç´¢å€¼çš„æœ€å¤§æ•°é‡ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºé—®é¢˜çš„å®é™…æ–¹é¢ï¼Œå¹¶äº†è§£IDEï¼Œç¼–è¯‘å™¨å’ŒJVMå°†å¦‚ä½•å“åº”æˆ‘ä»¬çš„æˆå°±ã€‚</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†…å®¹</font></font></h1><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javac </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">å·¥å…·</font></a></font><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æå–æ–¹æ³•</font></font></a><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ¨æ€ç±»æ–‡ä»¶å¸¸é‡</font></font></a><br>
â€ƒâ€ƒâ€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çªå¦‚å…¶æ¥çš„å›°éš¾</font></font></a><br>
â€ƒâ€ƒâ€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…‰æ˜çš„æœªæ¥</font></font></a><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å®‰å…¨çš„</font></font></a><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ‹è¯•</font></font></a><br>
â€ƒâ€ƒâ€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javacå’Œå¼€å…³</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">æ€§èƒ½</font></a></font><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></a><br>
â€ƒâ€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä»–èµ„æº</font></font></a><br>
<br>
<a name="Tools"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·¥å…·ç±»</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javacä¼šç…§é¡¾æˆ‘ä»¬ï¼šå®ƒ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼šä»æ ‡è¯†ç¬¦ä¸­åˆ‡å‡ºä¸å–œæ¬¢çš„å­—ç¬¦ï¼Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ç¦æ­¢ä»ä¸­ç»§æ‰¿</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">å­—ç¬¦</font></a></font><code>java.lang.Enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤å¯¹äºå®éªŒï¼Œæˆ‘ä»¬éœ€è¦å…¶ä»–å·¥å…·ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asmtools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -JVMçš„æ±‡ç¼–å™¨å’Œåæ±‡ç¼–å™¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">æµ‹è¯•</font></a><font style="vertical-align: inherit;">å‡è®¾</font><font style="vertical-align: inherit;">ï¼Œå¹¶ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº“ä»¥å·¥ä¸šè§„æ¨¡ç”Ÿæˆç±»æ–‡ä»¶</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ä¾¿äºç†è§£ï¼Œå°†åœ¨ç±»ä¼¼Javaçš„ä¼ªä»£ç ä¸­å¤åˆ¶æ­£åœ¨å‘ç”Ÿçš„æœ¬è´¨ã€‚</font></font><br>
<br>
<a name="Javac"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaè¯­è¨€</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œåœ¨æ²¡æœ‰æŠ€å·§çš„æƒ…å†µä¸‹ï¼Œä»…é ä¸€ä¸ªå°±èƒ½è·å¾—æœ€ä½³ç»“æœï¼Œè¿™æ˜¯åˆä¹é€»è¾‘çš„</font></font><code>javac</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸€åˆ‡éƒ½å¾ˆç®€å•åœ¨è¿™é‡Œ-æˆ‘ä»¬åˆ›é€ çš„æºæ–‡ä»¶ï¼Œæšä¸¾å’Œå…ƒç´ æ·»åŠ åˆ°å®ƒï¼Œç›´åˆ°æ‹’ç»çš„javacç¼–è¯‘</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸â€œä»£ç å¤ªå¤§â€çš„è¯…å’’ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»Java 1.7å¼€å§‹ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œè¿™ä¸ªæ•°å­—ä¸€ç›´ä¿æŒåœ¨2_746ä¸ªå…ƒç´ çš„æ°´å¹³ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯åœ¨Java 11ä¹‹åçš„æŸä¸ªåœ°æ–¹ï¼Œç”¨äºåœ¨å¸¸é‡æ± ä¸­å­˜å‚¨å€¼çš„ç®—æ³•å‘ç”Ÿäº†å˜åŒ–ï¼Œæœ€å¤§æ•°é‡å‡å°‘åˆ°2_743ã€‚</font><font style="vertical-align: inherit;">æ˜¯çš„ï¼Œæ˜¯çš„ï¼Œåªæ˜¯å› ä¸ºæ›´æ”¹äº†å¸¸é‡æ± ä¸­å…ƒç´ çš„é¡ºåºï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ä¸“æ³¨äºæœ€å¥½çš„ä»·å€¼è§‚ã€‚</font></font><br>
<br>
<a name="ExtractMethod"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æå–æ–¹æ³•</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºé™åˆ¶å› ç´ ä¹‹ä¸€ä¸é™æ€åˆå§‹åŒ–å—ä¸­å­—èŠ‚ç çš„å¤§å°æœ‰å…³ï¼Œå› æ­¤æˆ‘ä»¬å°†å°è¯•ä½¿åè€…å°½å¯èƒ½å®¹æ˜“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›é¡¾ä¸€ä¸‹</font></font><code>FizzBuzz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬ä¸€éƒ¨åˆ†</font><font style="vertical-align: inherit;">ä¸­çš„æšä¸¾ç¤ºä¾‹çš„å¤–è§‚</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ³¨é‡Šæä¾›é€‚å½“çš„ç»„è£…è¯´æ˜ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™æ€çš„ {}</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">static</span>  {<font></font>
    Fizz = <span class="hljs-keyword">new</span> FizzBuzz(<span class="hljs-string">"Fizz"</span>, <span class="hljs-number">0</span>);
    <span class="hljs-comment">//  0: new           #2                  // class FizzBuzz</span>
    <span class="hljs-comment">//  3: dup</span>
    <span class="hljs-comment">//  4: ldc           #22                 // String Fizz</span>
    <span class="hljs-comment">//  6: iconst_0</span>
    <span class="hljs-comment">//  7: invokespecial #24                 // Method "&lt;init&gt;":(Ljava/lang/String;I)V</span>
    <span class="hljs-comment">// 10: putstatic     #25                 // Field Fizz:LFizzBuzz;</span>
    Buzz = <span class="hljs-keyword">new</span> FizzBuzz(<span class="hljs-string">"Buzz"</span>, <span class="hljs-number">1</span>);
    <span class="hljs-comment">// 13: new           #2                  // class FizzBuzz</span>
    <span class="hljs-comment">// 16: dup</span>
    <span class="hljs-comment">// 17: ldc           #28                 // String Buzz</span>
    <span class="hljs-comment">// 19: iconst_1</span>
    <span class="hljs-comment">// 20: invokespecial #24                 // Method "&lt;init&gt;":(Ljava/lang/String;I)V</span>
    <span class="hljs-comment">// 23: putstatic     #30                 // Field Buzz:LFizzBuzz;</span>
    FizzBuzz = <span class="hljs-keyword">new</span> FizzBuzz(<span class="hljs-string">"FizzBuzz"</span>, <span class="hljs-number">2</span>);
    <span class="hljs-comment">// 26: new           #2                  // class FizzBuzz</span>
    <span class="hljs-comment">// 29: dup</span>
    <span class="hljs-comment">// 30: ldc           #32                 // String FizzBuzz</span>
    <span class="hljs-comment">// 32: iconst_2</span>
    <span class="hljs-comment">// 33: invokespecial #24                 // Method "&lt;init&gt;":(Ljava/lang/String;I)V</span>
    <span class="hljs-comment">// 36: putstatic     #33                 // Field FizzBuzz:LFizzBuzz;</span><font></font>
<font></font>
    $VALUES = <span class="hljs-keyword">new</span> FizzBuzz[] {
    <span class="hljs-comment">// 39: iconst_3</span>
    <span class="hljs-comment">// 40: anewarray     #2                  // class FizzBuzz</span><font></font>
        Fizz, <font></font>
    <span class="hljs-comment">// 43: dup</span>
    <span class="hljs-comment">// 44: iconst_0</span>
    <span class="hljs-comment">// 45: getstatic     #25                 // Field Fizz:LFizzBuzz;</span>
    <span class="hljs-comment">// 48: aastore</span><font></font>
        Buzz, <font></font>
    <span class="hljs-comment">// 49: dup</span>
    <span class="hljs-comment">// 50: iconst_1</span>
    <span class="hljs-comment">// 51: getstatic     #30                 // Field Buzz:LFizzBuzz;</span>
    <span class="hljs-comment">// 54: aastore</span><font></font>
        FizzBuzz<font></font>
    <span class="hljs-comment">// 55: dup</span>
    <span class="hljs-comment">// 56: iconst_2</span>
    <span class="hljs-comment">// 57: getstatic     #33                 // Field FizzBuzz:LFizzBuzz;</span>
    <span class="hljs-comment">// 60: aastore</span><font></font>
    };<font></font>
    <span class="hljs-comment">// 61: putstatic     #1                  // Field $VALUES:[LFizzBuzz;</span>
    <span class="hljs-comment">// 64: return</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆæƒ³åˆ°çš„æ˜¯å°†æ•°ç»„çš„åˆ›å»ºå’Œå¡«å……</font></font><code>$VALUES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¾å…¥å•ç‹¬çš„æ–¹æ³•ä¸­ã€‚</font></font><br>
<br>
<pre><code class="java hljs">$VALUES = createValues();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰äº†è¿™ä¸ªæƒ³æ³•ï¼Œå°±å¯ä»¥å°†æšä¸¾å…ƒç´ å®ä¾‹çš„åˆ›å»ºè½¬ç§»åˆ°ç›¸åŒçš„æ–¹æ³•ä¸­ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">static</span>  {<font></font>
    FizzBuzz[] localValues = createValues();<font></font>
<font></font>
    <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;<font></font>
    Fizz = localValues[index++];<font></font>
    Buzz = localValues[index++];<font></font>
    FizzBuzz = localValues[index++];<font></font>
<font></font>
    $VALUES = localValues;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FizzBuzz[] createValues() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FizzBuzz[] {
        <span class="hljs-keyword">new</span> FizzBuzz(<span class="hljs-string">"Fizz"</span>, <span class="hljs-number">0</span>), 
        <span class="hljs-keyword">new</span> FizzBuzz(<span class="hljs-string">"Buzz"</span>, <span class="hljs-number">1</span>), 
        <span class="hljs-keyword">new</span> FizzBuzz(<span class="hljs-string">"FizzBuzz"</span>, <span class="hljs-number">2</span>)<font></font>
    };<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å·²ç»æ›´å¥½äº†ï¼Œä½†æ˜¯æ¯æ¬¡æ•è·æ•°ç»„å…ƒç´ å’Œéšåçš„ç´¢å¼•å¢é‡éƒ½èŠ±è´¹6ä¸ªå­—èŠ‚ï¼Œè¿™å¯¹äºæˆ‘ä»¬æ¥è¯´å¤ªæ˜‚è´µäº†ã€‚</font><font style="vertical-align: inherit;">å°†å®ƒä»¬æ”¾åœ¨å•ç‹¬çš„æ–¹æ³•ä¸­ã€‚</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> valueIndex;<font></font>
<font></font>
<span class="hljs-keyword">static</span>  {<font></font>
    $VALUES = createValues();<font></font>
<font></font>
    valueIndex = <span class="hljs-number">0</span>;<font></font>
    Fizz = nextValue();<font></font>
    Buzz = nextValue();<font></font>
    FizzBuzz = nextValue();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FizzBuzz <span class="hljs-title">nextValue</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> $VALUES[valueIndex++];<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒ</font><font style="vertical-align: inherit;">éœ€è¦11ä¸ªå­—èŠ‚æ¥</font><font style="vertical-align: inherit;">åˆå§‹åŒ–</font></font><code>$VALUES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>valueIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åä»é™æ€åˆå§‹åŒ–å—è¿”å›</font><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">è¿˜å‰©ä¸‹65_524ä¸ªå­—èŠ‚æ¥åˆå§‹åŒ–å­—æ®µã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªå­—æ®µçš„åˆå§‹åŒ–éœ€è¦6ä¸ªå­—èŠ‚ï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»º10_920ä¸ªå…ƒç´ çš„æšä¸¾ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€å®šè¦ç”¨ä»£ç ç”Ÿæˆæ¥åº†ç¥ä¸javacç›¸æ¯”å¢é•¿è¿‘å››å€ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆå™¨æºä»£ç ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExtractMethodHugeEnumGenerator.javaç”Ÿæˆçš„</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ç±»ç¤ºä¾‹ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExtractMethodHugeEnum.class</font></font></a><br>
<a name="ConDy"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ¨æ€ç±»æ–‡ä»¶å¸¸é‡</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æ˜¯æ—¶å€™è®°ä½</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 309</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠå…¶ç¥ç§˜çš„</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ¨æ€å¸¸æ•°äº†</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç®€è€Œè¨€ä¹‹ï¼Œåˆ›æ–°çš„å®è´¨æ˜¯ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç”±ä¸€ç»„å¸¸é‡æ”¯æŒçš„ç°æœ‰ç±»å‹ä¸­æ·»åŠ äº†å¦ä¸€ä¸ªå¸¸é‡</font></font><code>CONSTANT_Dynamic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚åŠ è½½ç±»æ—¶ï¼Œæ­¤ç±»å¸¸é‡çš„ç±»å‹å·²çŸ¥ï¼Œä½†å…¶å€¼æœªçŸ¥ã€‚ç¬¬ä¸€æ¬¡åŠ è½½å¸¸é‡ä¼šå¯¼è‡´è°ƒç”¨å…¶å£°æ˜ä¸­æŒ‡å®šçš„bootstrapæ–¹æ³•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•çš„ç»“æœå˜ä¸ºæ’å®šå€¼ã€‚æ— æ³•æ›´æ”¹ä¸å·²åˆå§‹åŒ–çš„å¸¸é‡å…³è”çš„å€¼ã€‚è¿™å¯¹äºä¸€ä¸ªå¸¸é‡æ¥è¯´æ˜¯å¾ˆåˆé€»è¾‘çš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨è¿˜æƒ³åˆ°äº†Singletonï¼Œè¯·ç«‹å³å°†å…¶å¿˜è®°ã€‚</font><font style="vertical-align: inherit;">è¯¥è§„èŒƒå•ç‹¬å¼ºè°ƒäº†åœ¨è¿™ç§æƒ…å†µä¸‹ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”å¤šçº¿ç¨‹ä»£ç ä¸­çš„åˆå§‹åŒ–æ–¹æ³•å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ã€‚</font><font style="vertical-align: inherit;">ä»…ä¿è¯åœ¨å¯¹åŒä¸€å¸¸é‡å¤šæ¬¡è°ƒç”¨bootstrapæ–¹æ³•çš„æƒ…å†µä¸‹ï¼ŒJVMä¼šæŠ›å‡ºä¸€ä¸ªç¡¬å¸å¹¶é€‰æ‹©ä¸€ä¸ªè®¡ç®—å€¼ä½œä¸ºå¸¸é‡å€¼çš„ä½œç”¨ï¼Œè€Œå…¶ä»–å€¼å°†è¢«ç‰ºç‰²ç»™åƒåœ¾æ”¶é›†å™¨ã€‚</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»è¡Œä¸ºä¸Šè®²ï¼Œå¯ä»¥é€šè¿‡å¯¹ä»¥ä¸‹å‚æ•°æ‰§è¡Œå…¶bootstrapæ–¹æ³•æ¥è§£æCONSTANT_Dynamicå¸¸é‡ï¼š </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬åœ°æŸ¥æ‰¾å¯¹è±¡ï¼Œ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£è¡¨å¸¸é‡åç§°éƒ¨åˆ†çš„å­—ç¬¦ä¸²ï¼Œ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£è¡¨æœŸæœ›çš„å¸¸é‡ç±»å‹çš„Classï¼Œä»¥åŠ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»»ä½•å‰©ä½™çš„å¼•å¯¼ç¨‹åºå‚æ•°ã€‚</font></font></li>
</ol><br>
As with invokedynamic, multiple threads can race to resolve, but a unique winner will be chosen and any other contending answers discarded.<br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ°ä»å­—èŠ‚ç å¸¸é‡æ± è´Ÿè½½å€¼ï¼Œæä¾›çš„å‘½ä»¤</font></font><code>ldc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>ldc_w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>ldc2_w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æˆ‘ä»¬é¦–å…ˆæ„Ÿå…´è¶£çš„æ˜¯- </font></font><code>ldc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸å…¶ä»–æ–¹æ³•ä¸åŒï¼Œå®ƒåªèƒ½ä»å¸¸é‡æ± çš„å‰255ä¸ªæ—¶éš™ä¸­åŠ è½½å€¼ï¼Œä½†å­—èŠ‚ç å ç”¨çš„å­—èŠ‚æ•°å°‘1ä¸ªå­—èŠ‚ã€‚æ‰€æœ‰è¿™äº›ä½¿æˆ‘ä»¬èŠ‚çœäº†æœ€å¤š255ä¸ªå­—èŠ‚ï¼Œå¹¶</font></font><code>255 + ((65_524 - (255 * 5)) / 6) = 10_963</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æšä¸¾ä¸­</font><font style="vertical-align: inherit;">èŠ‚çœäº†ä¸€ä¸ª</font><font style="vertical-align: inherit;">å…ƒç´ ã€‚è¿™æ¬¡å¢é•¿ä¸æ˜¯é‚£ä¹ˆä»¤äººå°è±¡æ·±åˆ»ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨é™æ€åˆå§‹åŒ–å—ä¸­ï¼Œ</font></font><code>nextValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ç°åœ¨å°†åŠ è½½åŠ¨æ€å¸¸é‡çš„å€¼</font><font style="vertical-align: inherit;">ï¼Œè€Œä¸æ˜¯æ–¹æ³•è°ƒç”¨</font><font style="vertical-align: inherit;">ã€‚</font></font><code>ordinal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æšä¸¾å…ƒç´ </font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">åºæ•°ç´¢å¼•</font><font style="vertical-align: inherit;">çš„å€¼</font><font style="vertical-align: inherit;">å°†è¢«æ˜¾å¼ä¼ é€’ï¼Œä»è€Œæ‘†è„±äº†field </font></font><code>valueIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œfactoryæ–¹æ³•</font></font><code>nextValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å¯¹æˆ‘ä»¬å®ç°çš„çº¿ç¨‹å®‰å…¨æ€§è¡¨ç¤ºæ€€ç–‘ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œä¸ºå¼•å¯¼æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MethodHandle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ç‰¹æ®Šå­ç±»å‹ï¼Œ</font><font style="vertical-align: inherit;">è¯¥</font><font style="vertical-align: inherit;">å­ç±»å‹</font><font style="vertical-align: inherit;">æ¨¡ä»¿</font></font><code>new</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaä¸­</font><font style="vertical-align: inherit;">è¿ç®—ç¬¦çš„è¡Œä¸º</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”¨äºè·å–æ­¤ç±»æ–¹æ³•å¥æŸ„çš„æ ‡å‡†åº“æä¾›äº†</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MethodHandles.Lookup :: findConstructorï¼ˆï¼‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•</font><font style="vertical-align: inherit;">ï¼Œä½†åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼ŒJVMå°†è´Ÿè´£æ‰€éœ€æ–¹æ³•å¥æŸ„çš„æ„é€ ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦å°†æšä¸¾çš„æ„é€ å‡½æ•°ç”¨ä½œå¼•å¯¼ç¨‹åºæ–¹æ³•ï¼Œå¿…é¡»é€šè¿‡æ›´æ”¹ç­¾åå¯¹å…¶è¿›è¡Œç•¥å¾®ä¿®æ”¹ã€‚</font><font style="vertical-align: inherit;">bootstrapæ–¹æ³•æ‰€éœ€çš„å‚æ•°å°†æ·»åŠ åˆ°åç§°æšä¸¾å…ƒç´ å’Œåºåˆ—å·çš„ä¼ ç»Ÿæ„é€ å‡½æ•°ä¸­ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">FizzBuzz</span><span class="hljs-params">(MethodHandles.Lookup lookup, String name, Class&lt;?&gt; enumClass, <span class="hljs-keyword">int</span> ordinal)</span> </span>{
    <span class="hljs-keyword">super</span>(name, ordinal);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¼ªä»£ç çš„å½¢å¼ï¼Œåˆå§‹åŒ–å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">static</span>  {<font></font>
    Fizz = JVM_ldc(FizzBuzz::<span class="hljs-keyword">new</span>, <span class="hljs-string">"Fizz"</span>, <span class="hljs-number">0</span>);<font></font>
    Buzz = JVM_ldc(FizzBuzz::<span class="hljs-keyword">new</span>, <span class="hljs-string">"Buzz"</span>, <span class="hljs-number">1</span>);<font></font>
    FizzBuzz = JVM_ldc(FizzBuzz::<span class="hljs-keyword">new</span>, <span class="hljs-string">"FizzBuzz"</span>, <span class="hljs-number">2</span>);<font></font>
<font></font>
    $VALUES = createValues();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¿™äº›æŒ‡ä»¤è¢«</font></font><code>ldc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šä¸ºæ–¹æ³•è°ƒç”¨</font></font><code>JVM_ldc()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåœ¨å®ƒä»¬æ‰€åœ¨çš„å­—èŠ‚ç ä¸­å°†æ˜¯ç›¸åº”çš„JVMæŒ‡ä»¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºç°åœ¨æˆ‘ä»¬å¯¹æšä¸¾çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„å¸¸é‡ï¼Œå› æ­¤æ•°ç»„çš„åˆ›å»ºå’Œå¡«å……</font></font><code>$VALUES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿå¯ä»¥é€šè¿‡åŠ¨æ€å¸¸é‡æ¥å®ç°ã€‚</font><font style="vertical-align: inherit;">bootstrapæ–¹æ³•éå¸¸ç®€å•ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FizzBuzz[] createValues(MethodHandles.Lookup lookup, String name, Class&lt;?&gt; clazz, FizzBuzz... elements) {
    <span class="hljs-keyword">return</span> elements;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤åŠ¨æ€å¸¸é‡çš„é™æ€å‚æ•°åˆ—è¡¨ä¸­çš„æ‰€æœ‰æŠ€å·§ï¼Œæˆ‘ä»¬å°†åˆ—å‡ºè¦æ”¾å…¥çš„æ‰€æœ‰å…ƒç´ </font></font><code>$VALUES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BootstrapMethodsï¼š</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  1ï¼šï¼ƒ54 REF_invokeStatic FizzBuâ€‹â€‹zz.createValuesï¼šï¼ˆLjava / lang / invoke / MethodHandles $ Lookup; Ljava / lang / String; Ljava / lang / Class; [LFizzBuâ€‹â€‹zz;ï¼‰[LFizzBuâ€‹â€‹zz;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    æ–¹æ³•å‚æ•°ï¼š</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      ï¼ƒ1ï¼ƒ0ï¼šå˜¶å˜¶å£°ï¼šLFizzBuâ€‹â€‹zzï¼›</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      ï¼ƒ2ï¼ƒ0ï¼šå—¡å—¡å£°ï¼šLFizzBuâ€‹â€‹zzï¼›</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      ï¼ƒ3ï¼ƒ0ï¼šFizzBuâ€‹â€‹zzï¼šLFizzBuâ€‹â€‹zzï¼›</font></font><font></font>
</pre><br>
</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JVMä»è¿™äº›é™æ€å‚æ•°ç ´åæ•°ç»„ï¼Œå¹¶å°†å…¶ä½œä¸ºvarargå‚æ•°ä¼ é€’ç»™æˆ‘ä»¬çš„bootstrapæ–¹æ³•</font></font><code>elements</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é™æ€å‚æ•°çš„æœ€å¤§æ•°ç›®æ˜¯ä¼ ç»Ÿçš„65_535ï¼Œå› æ­¤ï¼Œä¿è¯æšä¸¾çš„æ‰€æœ‰å…ƒç´ éƒ½è¶³å¤Ÿï¼Œæ— è®ºæœ‰å¤šå°‘ä¸ªå…ƒç´ ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºå…·æœ‰å¤§é‡å…ƒç´ çš„ä¼ è¾“ï¼Œæ­¤æ›´æ”¹å°†å‡å°ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„å¤§å°ï¼Œå¹¶ä¸”åœ¨ç”±äºå¤§é‡å…ƒç´ è€Œ</font></font><code>createValues()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å¾—ä¸</font><font style="vertical-align: inherit;">å°†æ–¹æ³•</font><font style="vertical-align: inherit;">æ‹†åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†</font><font style="vertical-align: inherit;">çš„æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•</font><font style="vertical-align: inherit;">è¿˜å°†æ—¶éš™ä¿å­˜åœ¨å¸¸é‡æ± ä¸­ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œå®ƒåªæ˜¯ç¾ä¸½ã€‚</font></font><br>
<br>
<a name="Surprise"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çªå¦‚å…¶æ¥çš„å›°éš¾</font></font></h1><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆç±»æ¥å…‹æœäº†è¿™ä¸€éš¾é¢˜ã€‚</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é«˜çº§åº“æä¾›äº†æ–¹ä¾¿çš„ç•Œé¢ï¼Œä»¥æ¢å–æŸäº›é™åˆ¶çš„è¡ŒåŠ¨è‡ªç”±ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”¨äºç”Ÿæˆç±»æ–‡ä»¶çš„ASMåº“ä¹Ÿä¸ä¾‹å¤–ã€‚</font><font style="vertical-align: inherit;">å®ƒæ²¡æœ‰æä¾›ç›´æ¥æ§åˆ¶å¸¸é‡æ± å†…å®¹çš„æœºåˆ¶ã€‚</font><font style="vertical-align: inherit;">è¿™é€šå¸¸ä¸æ˜¯å¾ˆé‡è¦ï¼Œä½†å°±æˆ‘ä»¬è€Œè¨€å¹¶éå¦‚æ­¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨è¿˜è®°å¾—ï¼Œæˆ‘ä»¬éœ€è¦å¸¸é‡æ± çš„å‰255ä¸ªå…ƒç´ å°†å®è´µçš„å­—èŠ‚ä¿å­˜åœ¨é™æ€åˆå§‹åŒ–å—ä¸­ã€‚</font><font style="vertical-align: inherit;">å½“ä»¥æ ‡å‡†æ–¹å¼æ·»åŠ åŠ¨æ€å¸¸é‡æ—¶ï¼Œå®ƒä»¬å°†ä½äºéšæœºç´¢å¼•å¤„ï¼Œå¹¶ä¸å¯¹æˆ‘ä»¬ä¸å¤ªé‡è¦çš„å…¶ä»–å…ƒç´ æ··åˆã€‚</font><font style="vertical-align: inherit;">è¿™å°†é˜»æ­¢æˆ‘ä»¬è¾¾åˆ°æœ€å¤§ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¼ ç»Ÿæ–¹å¼å½¢æˆçš„å¸¸æ•°æ± çš„ç‰‡æ®µ</font></font></b>
                        <div class="spoiler_text"><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’å®šæ± ï¼š</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   ï¼ƒ1 = Utf8 FizzBuâ€‹â€‹zz</font></font><font></font>
   #2 = Class              #1             // FizzBuzz<font></font>
   #3 = Utf8               java/lang/Enum<font></font>
   #4 = Class              #3             // java/lang/Enum<font></font>
   #5 = Utf8               $VALUES<font></font>
   #6 = Utf8               [LFizzBuzz;<font></font>
   #7 = Utf8               valueIndex<font></font>
   #8 = Utf8               I<font></font>
   #9 = Utf8               Fizz<font></font>
  #10 = Utf8               LFizzBuzz;<font></font>
  #11 = Utf8               Buzz<font></font>
  #12 = Utf8               FizzBuzz<font></font>
  #13 = Utf8               values<font></font>
  #14 = Utf8               ()[LFizzBuzz;<font></font>
  #15 = NameAndType        #5:#6          // $VALUES:[LFizzBuzz;<font></font>
  #16 = Fieldref           #2.#15         // FizzBuzz.$VALUES:[LFizzBuzz;<font></font>
  #17 = Class              #6             // "[LFizzBuzz;"<font></font>
  #18 = Utf8               clone<font></font>
  #19 = Utf8               ()Ljava/lang/Object;<font></font>
  #20 = NameAndType        #18:#19        // clone:()Ljava/lang/Object;<font></font>
  #21 = Methodref          #17.#20        // "[LFizzBuzz;".clone:()Ljava/lang/Object;<font></font>
  ...<font></font>
  #40 = NameAndType        #9:#10         // Fizz:LFizzBuzz;<font></font>
  #41 = Dynamic            #0:#40         // #0:Fizz:LFizzBuzz;<font></font>
  #42 = Fieldref           #2.#40         // FizzBuzz.Fizz:LFizzBuzz;<font></font>
  #43 = NameAndType        #11:#10        // Buzz:LFizzBuzz;<font></font>
  #44 = Dynamic            #0:#43         // #0:Buzz:LFizzBuzz;<font></font>
  #45 = Fieldref           #2.#43         // FizzBuzz.Buzz:LFizzBuzz;<font></font>
  #46 = NameAndType        #12:#10        // FizzBuzz:LFizzBuzz;<font></font>
  #47 = Dynamic            #0:#46         // #0:FizzBuzz:LFizzBuzz;<font></font>
  #48 = Fieldref           #2.#46         // FizzBuzz.FizzBuzz:LFizzBuzz;<font></font>
</pre><br>
</blockquote><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§è§£å†³æ–¹æ³•-åˆ›å»ºç±»æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªç¤ºä¾‹ç±»ï¼Œä»ä¸­å¤åˆ¶å¸¸é‡æ± å’Œå¸¦æœ‰å¼•å¯¼ç¨‹åºæ–¹æ³•æè¿°çš„å±æ€§ã€‚</font><font style="vertical-align: inherit;">åªæ˜¯ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨ç”Ÿæˆå®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®é™…ä¸Šï¼Œå®ƒå¹¶ä¸åƒä¹çœ‹èµ·æ¥é‚£æ ·å›°éš¾ã€‚</font><font style="vertical-align: inherit;">ç±»æ–‡ä»¶çš„æ ¼å¼éå¸¸ç®€å•ï¼Œå…¶æ‰‹åŠ¨ç”Ÿæˆæ˜¯ä¸€ä¸ªä¹å‘³çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ä¸€ç‚¹ä¹Ÿä¸å¤æ‚ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™é‡Œæœ€é‡è¦çš„æ˜¯ä¸€ä¸ªæ¸…æ™°çš„è®¡åˆ’ã€‚</font><font style="vertical-align: inherit;">è¦åˆ—ä¸¾å‡º</font></font><code>COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">å…ƒç´ ï¼š</font></font><br>
<br>
<ul>
<li><code>COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç±»å‹è®°å½•</font></font><code>CONSTANT_Dynamic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-æˆ‘ä»¬çš„åŠ¨æ€å¸¸æ•°</font></font></li>
<li><code>COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç±»å‹è®°å½•</font></font><code>CONSTANT_NameAndType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-æŒ‡å‘æšä¸¾å…ƒç´ åç§°åŠå…¶ç±»å‹çš„é“¾æ¥å¯¹ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªäººçš„ç±»å‹éƒ½æ˜¯ç›¸åŒçš„ï¼Œè¿™æ˜¯æˆ‘ä»¬æšä¸¾çš„ç±»ç±»å‹ã€‚</font></font></li>
<li><code>COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç±»å‹è®°å½•</font></font><code>CONSTANT_Utf8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ç›´æ¥åˆ—å‡ºæšä¸¾å…ƒç´ çš„åç§°</font></font></li>
<li><code>COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç±»å‹çš„è®°å½•</font></font><code>CONSTANT_Integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ä½œä¸ºå‚æ•°å€¼ä¼ é€’ç»™æ„é€ å‡½æ•°çš„æšä¸¾å…ƒç´ çš„åºåˆ—å·</font></font><code>ordinal</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å‰å’ŒåŸºç±»çš„åç§°ï¼Œå±æ€§ï¼Œæ–¹æ³•ç­¾åä»¥åŠå…¶ä»–ä»¤äººåŒçƒ¦çš„å®ç°ç»†èŠ‚ã€‚</font><font style="vertical-align: inherit;">é‚£äº›æ„Ÿå…´è¶£çš„äººå¯ä»¥æŸ¥çœ‹ç”Ÿæˆå™¨çš„æºä»£ç ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¸¸é‡æ± ä¸­æœ‰å¾ˆå¤šç»„æˆå…ƒç´ ï¼Œå®ƒä»¬é€šè¿‡ç´¢å¼•å¼•ç”¨æ± ä¸­çš„å…¶ä»–å…ƒç´ ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é¢„å…ˆè®¡ç®—æ‰€æœ‰ç´¢å¼•ï¼Œè¿™</font></font><code>elementNames</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯æˆ‘ä»¬æšä¸¾å…ƒç´ åç§°çš„åˆ—è¡¨ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">int</span> elementCount = elementNames.size();<font></font>
<font></font>
<span class="hljs-keyword">int</span> baseConDy = <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> baseNameAndType = baseConDy + elementCount;
<span class="hljs-keyword">int</span> baseUtf8 = baseNameAndType + elementCount;
<span class="hljs-keyword">int</span> baseInteger = baseUtf8 + elementCount;
<span class="hljs-keyword">int</span> indexThisClass = baseInteger + elementCount;
<span class="hljs-keyword">int</span> indexThisClassUtf8 = indexThisClass + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexSuperClass = indexThisClassUtf8 + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexSuperClassUtf8 = indexSuperClass + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexBootstrapMethodsUtf8 = indexSuperClassUtf8 + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexConDyDescriptorUtf8 = indexBootstrapMethodsUtf8 + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexBootstrapMethodHandle = indexConDyDescriptorUtf8 + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexBootstrapMethodRef = indexBootstrapMethodHandle + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexBootstrapMethodNameAndType = indexBootstrapMethodRef + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexBootstrapMethodName = indexBootstrapMethodNameAndType + <span class="hljs-number">1</span>;
<span class="hljs-keyword">int</span> indexBootstrapMethodDescriptor = indexBootstrapMethodName + <span class="hljs-number">1</span>;<font></font>
<font></font>
<span class="hljs-keyword">int</span> constantPoolSize = indexBootstrapMethodDescriptor + <span class="hljs-number">1</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å†™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¼€å§‹æ—¶-ç±»æ–‡ä»¶çš„ç­¾åï¼Œæ¯ä¸ªäººéƒ½çŸ¥é“çš„å››ä¸ªå­—èŠ‚</font></font><nobr><code>0xCA 0xFE 0xBA 0xBE</code></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥åŠæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// Class file header</span><font></font>
u4(CLASS_FILE_SIGNATURE);<font></font>
u4(version);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶å-å¸¸é‡æ± ï¼š</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸æ•°æ± </font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">// Constant pool</span><font></font>
u2(constantPoolSize);<font></font>
<font></font>
<span class="hljs-comment">// N * CONSTANT_Dynamic</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; elementCount; i++) {<font></font>
    u1u2u2(CONSTANT_Dynamic, i, baseNameAndType + i);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// N * CONSTANT_NameAndType</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; elementCount; i++) {<font></font>
    u1u2u2(CONSTANT_NameAndType, baseUtf8 + i, indexConDyDescriptorUtf8);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// N * CONSTANT_Utf8</span>
<span class="hljs-comment">//noinspection ForLoopReplaceableByForEach</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; elementCount; i++) {<font></font>
    u1(CONSTANT_Utf8);<font></font>
    utf8(elementNames.get(i));<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// N * CONSTANT_Integer</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; elementCount; i++) {<font></font>
    u1(CONSTANT_Integer);<font></font>
    u4(i);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ThisClass</span><font></font>
u1(CONSTANT_Class);<font></font>
u2(indexThisClassUtf8);<font></font>
<font></font>
<span class="hljs-comment">// ThisClassUtf8</span><font></font>
u1(CONSTANT_Utf8);<font></font>
utf8(enumClassName);<font></font>
<font></font>
<span class="hljs-comment">// SuperClass</span><font></font>
u1(CONSTANT_Class);<font></font>
u2(indexSuperClassUtf8);<font></font>
<font></font>
<span class="hljs-comment">// SuperClassUtf8</span><font></font>
u1(CONSTANT_Utf8);<font></font>
utf8(JAVA_LANG_ENUM);<font></font>
<font></font>
<span class="hljs-comment">// BootstrapMethodsUtf8</span><font></font>
u1(CONSTANT_Utf8);<font></font>
utf8(ATTRIBUTE_NAME_BOOTSTRAP_METHODS);<font></font>
<font></font>
<span class="hljs-comment">// ConDyDescriptorUtf8</span><font></font>
u1(CONSTANT_Utf8);<font></font>
utf8(binaryEnumClassName);<font></font>
<font></font>
<span class="hljs-comment">// BootstrapMethodHandle</span><font></font>
u1(CONSTANT_MethodHandle);<font></font>
u1(REF_newInvokeSpecial);<font></font>
u2(indexBootstrapMethodRef);<font></font>
<font></font>
<span class="hljs-comment">// BootstrapMethodRef</span><font></font>
u1u2u2(CONSTANT_Methodref, indexThisClass, indexBootstrapMethodNameAndType);<font></font>
<font></font>
<span class="hljs-comment">// BootstrapMethodNameAndType</span><font></font>
u1u2u2(CONSTANT_NameAndType, indexBootstrapMethodName, indexBootstrapMethodDescriptor);<font></font>
<font></font>
<span class="hljs-comment">// BootstrapMethodName</span><font></font>
u1(CONSTANT_Utf8);<font></font>
utf8(BOOTSTRAP_METHOD_NAME);<font></font>
<font></font>
<span class="hljs-comment">// BootstrapMethodDescriptor</span><font></font>
u1(CONSTANT_Utf8);<font></font>
utf8(BOOTSTRAP_METHOD_DESCRIPTOR);<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ± å¸¸æ•°è°ˆè®ºè®¿é—®ä¿®é¥°ç¬¦å’Œæ ‡å¿—åï¼ˆ</font></font><code>public</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>final</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>enun</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç­‰ï¼‰ï¼Œç±»åå’Œå®ƒçš„ç¥–å…ˆï¼š</font></font><br>
<br>
<pre><code class="java hljs">u2(access);<font></font>
u2(indexThisClass);<font></font>
u2(indexSuperClass);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç”Ÿæˆçš„è™šæ‹Ÿç±»å°†æ²¡æœ‰æ¥å£ï¼Œæ²¡æœ‰å­—æ®µï¼Œæ²¡æœ‰æ–¹æ³•ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªå¸¦æœ‰å¼•å¯¼æ–¹æ³•æè¿°çš„å±æ€§ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// Interfaces count</span>
u2(<span class="hljs-number">0</span>);
<span class="hljs-comment">// Fields count</span>
u2(<span class="hljs-number">0</span>);
<span class="hljs-comment">// Methods count</span>
u2(<span class="hljs-number">0</span>);
<span class="hljs-comment">// Attributes count</span>
u2(<span class="hljs-number">1</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯å±æ€§æœ¬èº«çš„ä¸»ä½“ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// BootstrapMethods attribute</span><font></font>
u2(indexBootstrapMethodsUtf8);<font></font>
<span class="hljs-comment">// BootstrapMethods attribute size</span>
u4(<span class="hljs-number">2</span> <span class="hljs-comment">/* num_bootstrap_methods */</span> + <span class="hljs-number">6</span> * elementCount);
<span class="hljs-comment">// Bootstrap method count</span><font></font>
u2(elementCount);<font></font>
<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; elementCount; i++) {
    <span class="hljs-comment">// bootstrap_method_ref</span><font></font>
    u2(indexBootstrapMethodHandle);<font></font>
    <span class="hljs-comment">// num_bootstrap_arguments</span>
    u2(<span class="hljs-number">1</span>);
    <span class="hljs-comment">// bootstrap_arguments[1]</span><font></font>
    u2(baseInteger + i);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°±æ˜¯è¿™æ ·ï¼Œç­çº§å°±å½¢æˆäº†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è·å–è¿™äº›å­—èŠ‚å¹¶ä»å®ƒä»¬åˆ›å»º</font></font><code>ClassReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> ClassReader <span class="hljs-title">getBootstrapClassReader</span><span class="hljs-params">(<span class="hljs-keyword">int</span> version, <span class="hljs-keyword">int</span> access, String enumClassName, List&lt;String&gt; elementNames)</span> </span>{
    <span class="hljs-keyword">byte</span>[] bootstrapClassBytes = <span class="hljs-keyword">new</span> ConDyBootstrapClassGenerator(<font></font>
        version,<font></font>
        access,<font></font>
        enumClassName,<font></font>
        elementNames<font></font>
    )<font></font>
    .generate();<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (bootstrapClassBytes == <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ClassReader(bootstrapClassBytes);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶ä¸æ˜¯é‚£ä¹ˆå›°éš¾ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆå™¨æºä»£ç ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConDyBootstrapClassGenerator.java</font></font></a><br>
<a name="Future"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…‰æ˜çš„æœªæ¥</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç®€è¦ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬çš„æ¸…å•ï¼š</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DiscoverConstantValueAttribute</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String STRING = <span class="hljs-string">"Habrahabr, world!"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object OBJECT = <span class="hljs-keyword">new</span> Object();<font></font>
<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ­¤ç±»çš„é™æ€åˆå§‹åŒ–å—ä¸­ï¼Œåœ¨è¯¥å­—æ®µä¸­çªç„¶åªæœ‰ä¸€ä¸ªå†™æ“ä½œ</font></font><code>OBJECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-keyword">static</span> {<font></font>
    OBJECT = <span class="hljs-keyword">new</span> Object();
    <span class="hljs-comment">//  0: new           #2                  // class java/lang/Object</span>
    <span class="hljs-comment">//  3: dup</span>
    <span class="hljs-comment">//  4: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span>
    <span class="hljs-comment">//  7: putstatic     #7                  // Field OBJECT:Ljava/lang/Object;</span>
    <span class="hljs-comment">// 10: return</span><font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯å‘¢</font></font><code>STRING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Ÿ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›¢é˜Ÿå°†å¸®åŠ©æ‚¨æ­å¼€è¿™ä¸ªè°œè¯­</font></font><nobr><code>javap -c -s -p -v DiscoverConstantValueAttribute.class</code></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿™æ˜¯æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç‰‡æ®µï¼š</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> java.lang.String STRING;<font></font>
  descriptor: Ljava/lang/String;<font></font>
  flags: (<span class="hljs-number">0x0019</span>) ACC_PUBLIC, ACC_STATIC, ACC_FINAL<font></font>
  ConstantValue: String Habrahabr, world!<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™æ€finalå­—æ®µçš„å€¼å·²ä»åˆå§‹åŒ–å—ç§»è‡³å•ç‹¬çš„å±æ€§</font></font><code>ConstantValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä»–ä»¬åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JVMS11Â§4.7.2ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³äºæ­¤å±æ€§çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">å†…å®¹</font></a><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConstantValueå±æ€§è¡¨ç¤ºå¸¸é‡è¡¨è¾¾å¼çš„å€¼ï¼ˆJLSÂ§15.28ï¼‰ï¼Œå…¶ç”¨æ³•å¦‚ä¸‹ï¼š</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœåœ¨field_infoç»“æ„çš„access_flagsé¡¹ä¸­è®¾ç½®äº†ACC_STATICæ ‡å¿—ï¼Œåˆ™å°†field_infoç»“æ„è¡¨ç¤ºçš„å­—æ®µåˆ†é…ä¸ºå…¶ConstantValueå±æ€§è¡¨ç¤ºçš„å€¼ï¼Œä½œä¸ºå£°æ˜è¯¥å­—æ®µçš„ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–çš„ä¸€éƒ¨åˆ†ï¼ˆç¬¬5.5èŠ‚ï¼‰ã€‚</font><font style="vertical-align: inherit;">è¿™å‘ç”Ÿåœ¨è°ƒç”¨è¯¥ç±»æˆ–æ¥å£çš„ç±»æˆ–æ¥å£åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰ï¼ˆç¬¬2.9.2èŠ‚ï¼‰ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦åˆ™ï¼ŒJavaè™šæ‹Ÿæœºå¿…é¡»é™é»˜å¿½ç•¥è¯¥å±æ€§ã€‚</font></font></li>
</ul><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœå‘ç”ŸåŒæ—¶è¿™æ ·çš„å±æ€§</font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>final</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå°½ç®¡åè€…æ²¡æœ‰æ˜ç¡®åœ°é˜è¿°äº†åœ¨è¿™é‡Œï¼‰ä¸­çš„å­—æ®µï¼Œåˆ™è¿™æ ·çš„å­—æ®µè¢«åˆå§‹åŒ–ä¸ºä»è¯¥å±æ€§çš„å€¼ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ç”šè‡³åœ¨è°ƒç”¨é™æ€åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰å°±å‘ç”Ÿäº†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨æ­¤å±æ€§æ¥åˆå§‹åŒ–æšä¸¾çš„å…ƒç´ å¾ˆè¯±äººï¼Œåœ¨ä¸Šä¸€ç« ä¸­ï¼Œå°½ç®¡æœ‰åŠ¨æ€å¸¸é‡ï¼Œä½†ä¹Ÿåªæœ‰å¸¸é‡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ªæœè¿™ä¸ªæ–¹å‘æ€è€ƒçš„äººï¼ŒJEP 309ä¸­æœ‰æåŠ</font></font><code>ConstantValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œæ­¤æåŠåœ¨â€œæœªæ¥å·¥ä½œâ€ä¸€ç« ä¸­ï¼š</font></font><br>
<br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æ¥çš„å·¥ä½œ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å¯èƒ½çš„å°†æ¥æ‰©å±•åŒ…æ‹¬ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†åŠ¨æ€å¸¸é‡é™„åŠ åˆ°é™æ€å­—æ®µçš„ConstantValueå±æ€§</font></font></li>
</ul><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ—¶ï¼Œæˆ‘ä»¬åªèƒ½æ¢¦åˆ°è¯¥åŠŸèƒ½å°†ä»â€œåšå¥½â€çŠ¶æ€å˜ä¸ºâ€œå‡†å¤‡å°±ç»ªâ€çŠ¶æ€çš„æ—¶é—´ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œåˆå§‹åŒ–å—ä¸­å¯¹ä»£ç å¤§å°çš„é™åˆ¶å°†å¤±å»å½±å“ï¼Œæšä¸¾ä¸­å…ƒç´ çš„æœ€å¤§æ•°é‡å°†ç¡®å®šå¸¸é‡æ± çš„é™åˆ¶ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ ¹æ®ç²—ç•¥ä¼°è®¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¸Œæœ›æœ‰ä¸€ä¸ª</font></font><code>65&nbsp;489 / 4 = 16_372</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ç´ ã€‚</font><font style="vertical-align: inherit;">è¿™</font></font><code>65_489</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å¸¸é‡æ± ä¸­æœªå ç”¨çš„æ—¶éš™æ•°ï¼Œç†è®ºä¸Šå¯èƒ½çš„65_535ä¸­æœ‰46ä¸ªè¿›å…¥äº†å¼€é”€ã€‚</font></font><code>4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-å£°æ˜ä¸€ä¸ªå­—æ®µæ‰€éœ€çš„æ—¶éš™æ•°å’Œç›¸åº”çš„åŠ¨æ€å¸¸æ•°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“ç„¶ï¼Œç¡®åˆ‡çš„æ•°å­—åªæœ‰åœ¨æ”¯æŒæ­¤åŠŸèƒ½çš„JDKç‰ˆæœ¬å‘å¸ƒåæ‰èƒ½æ‰¾åˆ°ã€‚</font></font><br>
<br>
<a name="Unsafe"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å®‰å…¨</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çš„æ•Œäººæ˜¯åˆå§‹åŒ–å—çš„çº¿æ€§å¢é•¿ä»¥åŠæšä¸¾å…ƒç´ æ•°é‡çš„å¢åŠ ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æ‰¾åˆ°äº†å‡å°‘å¾ªç¯åˆå§‹åŒ–çš„æ–¹æ³•ï¼Œä»è€Œæ¶ˆé™¤äº†æšä¸¾ä¸­çš„å…ƒç´ æ•°é‡ä¸åˆå§‹åŒ–å—çš„å¤§å°ä¹‹é—´çš„å…³ç³»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å–å¾—å¦ä¸€ä¸ªçªç ´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸å¹¸çš„æ˜¯ï¼Œæ ‡å‡†çš„å…¬å…±APIéƒ½ä¸å…è®¸</font></font><code>static final</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é™æ€åˆå§‹åŒ–å—å†…</font><font style="vertical-align: inherit;">å†™å…¥</font><font style="vertical-align: inherit;">å­—æ®µã€‚</font><font style="vertical-align: inherit;">Reflectionå’ŒVarHandleséƒ½ä¸ä¼šå¯¹è¿™é‡Œæœ‰æ‰€å¸®åŠ©ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å”¯ä¸€çš„å¸Œæœ›æ˜¯ä¼Ÿå¤§è€Œå¯æ€•çš„</font></font><code>sun.misc.Unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸å®‰å…¨åœ°æ‰§è¡ŒFizzBuâ€‹â€‹zzå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å®‰å…¨çš„FizzBuâ€‹â€‹zz</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">import</span> java.lang.reflect.Field;
<span class="hljs-keyword">import</span> sun.misc.Unsafe;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> FizzBuzz {<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> FizzBuzz[] $VALUES;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> FizzBuzz Fizz;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> FizzBuzz Buzz;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> FizzBuzz FizzBuzz;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> FizzBuzz[] values() {
        <span class="hljs-keyword">return</span> (FizzBuzz[]) $VALUES.clone();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> FizzBuzz <span class="hljs-title">valueOf</span><span class="hljs-params">(String name)</span> </span>{
        <span class="hljs-keyword">return</span> (FizzBuzz) Enum.valueOf(FizzBuzz.class, name);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">FizzBuzz</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> ordinal)</span> </span>{
        <span class="hljs-keyword">super</span>(name, ordinal);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FizzBuzz[] createValues() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FizzBuzz[] {<font></font>
            Fizz,<font></font>
            Buzz,<font></font>
            FizzBuzz<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">static</span>  {<font></font>
        Field unsafeField = Unsafe.class.getDeclaredField("theUnsafe");<font></font>
        unsafeField.setAccessible(<span class="hljs-keyword">true</span>);<font></font>
        Unsafe unsafe = (Unsafe) unsafeField.get(<span class="hljs-keyword">null</span>);<font></font>
<font></font>
        String[] fieldNames = "Fizz,Buzz,FizzBuzz".split(",");<font></font>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fieldNames.length; i++) {<font></font>
            String fieldName = fieldNames[i];<font></font>
            Field field = FizzBuzz.class.getDeclaredField(fieldName);<font></font>
            <span class="hljs-keyword">long</span> fieldOffset = unsafe.staticFieldOffset(field);<font></font>
            unsafe.putObject(FizzBuzz.class, fieldOffset, <span class="hljs-keyword">new</span> FizzBuzz(fieldName, i));<font></font>
        }<font></font>
<font></font>
        $VALUES = createValues();<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ç§æ–¹æ³•ä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªåŒ…å«çº¦21000ä¸ªå…ƒç´ çš„æšä¸¾ï¼›æ›´å¤šçš„å¸¸é‡æ± çš„å®¹é‡è¿˜ä¸å¤Ÿã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Enum :: ordinalï¼ˆï¼‰</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ä¸Šçš„æ–‡æ¡£</font><font style="vertical-align: inherit;">è¦æ±‚å…¶å€¼ä¸æšä¸¾å£°æ˜ä¸­ç›¸åº”å…ƒç´ çš„åºåˆ—å·åŒ¹é…ï¼Œå› æ­¤æ‚¨å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºæ˜¾å¼å­˜å‚¨å­—æ®µåç§°åˆ—è¡¨ï¼Œä»è€Œå‡ ä¹ä½¿ç±»æ–‡ä»¶çš„å¤§å°å¢åŠ ä¸€å€ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public final int ordinalï¼ˆï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿”å›æ­¤æšä¸¾å¸¸é‡çš„åºæ•°ï¼ˆå…¶åœ¨æšä¸¾å£°æ˜ä¸­çš„ä½ç½®ï¼Œå…¶ä¸­åˆå§‹å¸¸é‡çš„åºæ•°ä¸ºé›¶ï¼‰ã€‚</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™é‡Œï¼Œç”¨äºå¸¸é‡æ± å†…å®¹çš„å…¬å…±APIå¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•æŒ‰éœ€è¦çš„é¡ºåºå¡«å……å®ƒï¼Œä½†æ˜¯æ²¡æœ‰è¿™æ ·çš„APIï¼Œè€Œä¸”ä¸å¯èƒ½ã€‚ OpenJDKä¸­æä¾›çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Class :: getConstantPoolï¼ˆï¼‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•è¢«</font><font style="vertical-align: inherit;">å£°æ˜ä¸ºpackage-privateï¼Œåœ¨ç”¨æˆ·ä»£ç ä¸­ä¾èµ–å®ƒå¾ˆå®¹æ˜“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œåˆå§‹åŒ–å—éå¸¸ç´§å‡‘ï¼Œå¹¶ä¸”å‡ ä¹ä¸æšä¸¾ä¸­çš„å…ƒç´ æ•°é‡æ— å…³ï¼Œå› æ­¤æ‚¨</font></font><code>createValues()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥é€šè¿‡å°†å…¶ä¸»ä½“åµŒå…¥å¾ªç¯æ¥æ‹’ç»å®ƒï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">static</span>  {<font></font>
    Field unsafeField = Unsafe.class.getDeclaredField("theUnsafe");<font></font>
    unsafeField.setAccessible(<span class="hljs-keyword">true</span>);<font></font>
    Unsafe unsafe = (Unsafe) unsafeField.get(<span class="hljs-keyword">null</span>);<font></font>
<font></font>
    String[] fieldNames = "Fizz,Buzz,FizzBuzz".split(",");<font></font>
    FizzBuzz[] localValues = <span class="hljs-keyword">new</span> FizzBuzz[fieldNames.length];
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fieldNames.length; i++) {<font></font>
        String fieldName = fieldNames[i];<font></font>
        Field field = FizzBuzz.class.getDeclaredField(fieldName);<font></font>
        <span class="hljs-keyword">long</span> fieldOffset = unsafe.staticFieldOffset(field);<font></font>
        unsafe.putObject(<font></font>
            FizzBuzz.class,<font></font>
            fieldOffset,<font></font>
            (localValues[i] = <span class="hljs-keyword">new</span> FizzBuzz(fieldName, i))<font></font>
        );<font></font>
    }<font></font>
<font></font>
    $VALUES = localValues;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™é‡Œå‘ç”Ÿäº†ç±»ä¼¼é›ªå´©çš„è¿‡ç¨‹ï¼šéšç€è¯¥æ–¹æ³•çš„å‡ºç°</font></font><code>createValues()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç”¨äºè¯»å–æšä¸¾å…ƒç´ çš„å­—æ®µçš„æŒ‡ä»¤æ¶ˆå¤±äº†ï¼Œ</font></font><code>Fieldref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™äº›å­—æ®µçš„</font><font style="vertical-align: inherit;">ç±»å‹è®°å½•å˜å¾—ä¸å¿…è¦äº†</font><font style="vertical-align: inherit;">ï¼Œå› æ­¤ç±»å‹</font></font><code>NameAndType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®°å½•çš„ç±»å‹è®°å½•</font><font style="vertical-align: inherit;">ä¹Ÿ</font><font style="vertical-align: inherit;">éšä¹‹</font><font style="vertical-align: inherit;">è€Œæ¥</font></font><code>Fieldref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚åœ¨å¸¸é‡æ± ä¸­ï¼Œé‡Šæ”¾äº†</font></font><code>2 * &lt;   &gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ç”¨äºå£°æ˜å…¶ä»–æšä¸¾å…ƒç´ çš„æ’æ§½ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰äº‹æƒ…éƒ½å¦‚æ­¤ä¹è§‚ï¼Œæµ‹è¯•æ˜¾ç¤ºå‡ºæ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ï¼šåˆå§‹åŒ–ä¸€ä¸ªåŒ…å«65,000ä¸ªå…ƒç´ çš„æšä¸¾ç±»éœ€è¦èŠ±è´¹ä¸€åˆ†åŠé’Ÿçš„æ—¶é—´ã€‚ç»“æœå¾ˆå¿«ï¼Œâ€œåå°„é€Ÿåº¦å˜æ…¢äº†â€ã€‚</font><font style="vertical-align: inherit;">OpenJDK </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸­</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Class :: getDeclaredFieldï¼ˆï¼‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„å®ç°å…·æœ‰</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ç±»</font></a><font style="vertical-align: inherit;">ä¸­å­—æ®µæ•°çš„çº¿æ€§æ¸è¿‘è¡Œä¸ºï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„åˆå§‹åŒ–å—æ˜¯å¹³æ–¹çš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡æ— æ³•å®Œå…¨è§£å†³ï¼Œä½†æ·»åŠ ç¼“å­˜å¯ä»¥ç¨å¾®æ”¹å–„è¿™ç§æƒ…å†µï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">static</span>  {<font></font>
    Field unsafeField = Unsafe.class.getDeclaredField("theUnsafe");<font></font>
    unsafeField.setAccessible(<span class="hljs-keyword">true</span>);<font></font>
    Unsafe unsafe = (Unsafe) unsafeField.get(<span class="hljs-keyword">null</span>);<font></font>
<font></font>
    String[] fieldNames = "Fizz,Buzz,FizzBuzz".split(",");<font></font>
    Field[] fields = FizzBuzz.class.getDeclaredFields();<font></font>
    HashMap&lt;String, Field&gt; cache = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(fields.length);<font></font>
<font></font>
    <span class="hljs-keyword">for</span>(Field field : fields) {<font></font>
        cache.put(field.getName(), field);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fieldNames.length; i++) {<font></font>
        String fieldName = fieldNames[i];<font></font>
        Field field = cache.get(fieldName);<font></font>
        <span class="hljs-keyword">long</span> fieldOffset = unsafe.staticFieldOffset(field);<font></font>
        unsafe.putObject(<font></font>
            FizzBuzz.class,<font></font>
            fieldOffset,<font></font>
            (localValues[i] = <span class="hljs-keyword">new</span> FizzBuzz(fieldName, i))<font></font>
        );<font></font>
    }    <font></font>
<font></font>
    $VALUES = localValues;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬ç« ä¸­ä»‹ç»çš„ä¸å®‰å…¨æ–¹æ³•å…è®¸æ‚¨åˆ›å»ºæœ€å¤š65_410ä¸ªå…ƒç´ çš„ä¼ è¾“ï¼Œè¿™å‡ ä¹æ˜¯javacå¯è·å¾—çš„ç»“æœçš„24å€ï¼Œå¹¶ä¸”éå¸¸æ¥è¿‘æˆ‘ä»¬åœ¨å¾ªç¯çš„ä¸Šä¸€ç‰ˆä¸­è®¡ç®—å‡ºçš„65_505ä¸ªå…ƒç´ çš„ç†è®ºæé™ã€‚</font></font><br>
<br>
<a name="Testing"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥æ•ˆæœ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºæµ‹è¯•ï¼Œæˆ‘ä»¬é‡‡ç”¨æœ€å¤§çš„æšä¸¾ï¼Œå¹¶ä½¿ç”¨commandç”Ÿæˆå®ƒ</font></font><nobr><code>java -jar HugeEnumGen.jar -a Unsafe UnsafeHugeEnum</code></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¤§å°ä¸º2å…†å­—èŠ‚å’Œ65_410ä¸ªå…ƒç´ çš„ç±»æ–‡ä»¶ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨IDEAä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Javaé¡¹ç›®ï¼Œå¹¶å°†ç”Ÿæˆçš„ç±»æ·»åŠ ä¸ºå¤–éƒ¨åº“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡ ä¹å¯ä»¥ç«‹å³çœ‹å‡ºï¼ŒIDEAå°šæœªå‡†å¤‡å¥½è¿›è¡Œè¿™ç§å‹åŠ›æµ‹è¯•ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m4/su/-6/m4su-6bvdkkqmf3pypqrmpzntnw.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¤è€çš„ç§»åŠ¨i5å’Œæ›´ç°ä»£çš„i7 8700Kä¸Šï¼Œè‡ªåŠ¨å®Œæˆæšä¸¾å…ƒç´ éƒ½éœ€è¦æ•°åç§’ã€‚è€Œä¸”ï¼Œå¦‚æœæ‚¨å°è¯•ä½¿ç”¨å¿«é€Ÿä¿®å¤å°†ç¼ºå°‘çš„å…ƒç´ æ·»åŠ åˆ°å¼€å…³ï¼Œåˆ™IDEAç”šè‡³ä¼šåœæ­¢é‡ç»˜çª—å£ã€‚æˆ‘æš‚æ—¶æ€€ç–‘ï¼Œä½†æ²¡æœ‰ç­‰å¾…å®Œæˆã€‚è°ƒè¯•æœŸé—´çš„å“åº”èƒ½åŠ›ä¹Ÿæœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»ä¸­çš„å°‘é‡å…ƒç´ å¼€å§‹</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFew</span> </span>{<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String... args)</span> </span>{
        <span class="hljs-keyword">for</span>(String arg : args) {<font></font>
            System.out.print(arg + <span class="hljs-string">" : "</span>);<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {<font></font>
                UnsafeHugeEnum value = UnsafeHugeEnum.valueOf(arg);<font></font>
<font></font>
                doSwitch(value);<font></font>
            } <span class="hljs-keyword">catch</span>(Throwable e) {<font></font>
                e.printStackTrace(System.out);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSwitch</span><span class="hljs-params">(UnsafeHugeEnum value)</span> </span>{
        <span class="hljs-keyword">switch</span>(value) {
            <span class="hljs-keyword">case</span> VALUE_00001:<font></font>
                System.out.println(<span class="hljs-string">"First"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> VALUE_31415:<font></font>
                System.out.println(<span class="hljs-string">"(int) (10_000 * Math.PI)"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> VALUE_65410:<font></font>
                System.out.println(<span class="hljs-string">"Last"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:<font></font>
                System.out.println(<span class="hljs-string">"Unexpected value: "</span> + value);
                <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¯«ä¸å¥‡æ€ªï¼Œç¼–è¯‘å’Œå¯åŠ¨æ˜¯å¸¸è§„çš„ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$ java TestFew VALUE_00001 VALUE_00400 VALUE_31415 VALUE_65410<font></font>
VALUE_00001 : First<font></font>
VALUE_00400 : Unexpected value: VALUE_00400<font></font>
VALUE_31415 : (int) (10_000 * Math.PI)<font></font>
VALUE_65410 : Last<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‚£æ›´å¤šçš„ç‰©å“</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘¢ï¼Ÿ</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œ</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬</font><font style="vertical-align: inherit;">å¯ä»¥</font><font style="vertical-align: inherit;">ä¸€æ¬¡</font><font style="vertical-align: inherit;">å¤„ç†</font><font style="vertical-align: inherit;">æ‰€æœ‰65,000ä¸ªå…ƒç´ å—ï¼Ÿ</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">switch</span>(value) {
    <span class="hljs-keyword">case</span> VALUE_00001:
    <span class="hljs-keyword">case</span> VALUE_00002:<font></font>
        ...<font></font>
    <span class="hljs-keyword">case</span> VALUE_65410:<font></font>
        System.out.println(<span class="hljs-string">"One of known values: "</span> + value);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:<font></font>
        System.out.println(<span class="hljs-string">"Unexpected value: "</span> + value);
        <span class="hljs-keyword">break</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lasï¼Œä¸ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬å°è¯•ç¼–è¯‘æ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°ä¸€å †é”™è¯¯æ¶ˆæ¯ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$ javac -fullversion<font></font>
javac full version "14.0.1+7"<font></font>
<font></font>
$ javac TestAll.java<font></font>
TestAll.java:18: error: code too large for try statement<font></font>
        switch(value) {<font></font>
        ^<font></font>
TestAll.java:65433: error: too many constants<font></font>
                break;<font></font>
                ^<font></font>
TestAll.java:17: error: code too large<font></font>
    private static void doSwitch(UnsafeHugeEnum value) {<font></font>
                        ^<font></font>
TestAll.java:1: error: too many constants<font></font>
public class TestAll {<font></font>
       ^<font></font>
4 errors<font></font>
</code></pre><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testfew.java</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TestAll.java</font></font></a></li>
</ul><br>
<a name="JavacSwitchTranslation"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javacå’Œå¼€å…³</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦äº†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¿…é¡»å¼„æ¸…æ¥š</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æšä¸¾å…ƒç´ </font><font style="vertical-align: inherit;">çš„è½¬æ¢</font><font style="vertical-align: inherit;">æ˜¯</font><font style="vertical-align: inherit;">å¦‚ä½•å‘ç”Ÿçš„</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JVMè§„èŒƒåœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JVMS11Â§3.10ç¼–è¯‘å¼€å…³ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰å•ç‹¬çš„ç« èŠ‚</font><font style="vertical-align: inherit;">ï¼Œå…¶å»ºè®®å¯ä»¥å½’ç»“ä¸º</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ä¹‹ä¸€</font></font><code>tableswitch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–</font></font><code>lookupswitch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ‰¾ä¸åˆ°å¯¹å­—ç¬¦ä¸²æˆ–æšä¸¾å…ƒç´ çš„</font><font style="vertical-align: inherit;">ä»»ä½•å¼•ç”¨</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€å¥½çš„æ–‡æ¡£æ˜¯ä»£ç ï¼Œå› æ­¤è¯¥æ·±å…¥äº†è§£æºä»£ç äº†</font></font><code>javac</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å’Œ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹‹é—´çš„é€‰æ‹©</font><font style="vertical-align: inherit;">å‡ºç°åœ¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Gen :: visitSwitchï¼ˆï¼‰ä¸­ï¼Œ</font></a><font style="vertical-align: inherit;">å¹¶å–å†³äºä¸­çš„é€‰é¡¹æ•°é‡</font><font style="vertical-align: inherit;">ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè·èƒœ</font><font style="vertical-align: inherit;">ï¼š</font></font><code>tableswitch</code><font style="vertical-align: inherit;"></font><code>lookupswitch</code><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>switch</code><font style="vertical-align: inherit;"></font><code>tableswitch</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// Determine whether to issue a tableswitch or a lookupswitch</span>
<span class="hljs-comment">// instruction.</span>
<span class="hljs-keyword">long</span> table_space_cost = <span class="hljs-number">4</span> + ((<span class="hljs-keyword">long</span>) hi - lo + <span class="hljs-number">1</span>); <span class="hljs-comment">// words</span>
<span class="hljs-keyword">long</span> table_time_cost = <span class="hljs-number">3</span>; <span class="hljs-comment">// comparisons</span>
<span class="hljs-keyword">long</span> lookup_space_cost = <span class="hljs-number">3</span> + <span class="hljs-number">2</span> * (<span class="hljs-keyword">long</span>) nlabels;
<span class="hljs-keyword">long</span> lookup_time_cost = nlabels;
<span class="hljs-keyword">int</span> opcode =<font></font>
    nlabels &gt; <span class="hljs-number">0</span> &amp;&amp;<font></font>
    table_space_cost + <span class="hljs-number">3</span> * table_time_cost &lt;=<font></font>
    lookup_space_cost + <span class="hljs-number">3</span> * lookup_time_cost<font></font>
    ?<font></font>
    tableswitch : lookupswitch;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ ‡å¤´</font></font><code>tableswitch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¦ä¸º16ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå€¼4ä¸ªå­—èŠ‚ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œ</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸èƒ½æœ‰æ›´å¤š</font></font><code>( 65_535 - 16 ) / 4 = 16_379</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…ƒç´ ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¡®å®ï¼Œ</font></font><code>case</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å°†ä½“å†…</font><font style="vertical-align: inherit;">çš„åˆ†æ”¯æ•°å‡å°‘</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°1.6ä¸‡åï¼Œä»…å­˜åœ¨ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œè¿™æ˜¯æœ€ç¥ç§˜çš„ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">TestAll.java:18: error: code too large for try statement<font></font>
        switch(value) {<font></font>
        ^<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†å¯»æ‰¾é”™è¯¯çš„æ ¹æºï¼Œæˆ‘ä»¬å°†æ›´æ—©è¿”å›åˆ°æ‘†è„±è¯­æ³•ç³–çš„é˜¶æ®µã€‚</font><font style="vertical-align: inherit;">è¯¥</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•åˆ†åˆ«è´Ÿè´£</font><font style="vertical-align: inherit;">ç¿»è¯‘</font></font><code>visitEnumSwitch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>mapForEnum()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œç±»</font></font><code>EnumMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lower.java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜å‘ç°äº†ä¸€ä¸ªå°çš„çºªå®è¯„è®ºï¼š</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æšä¸¾JavaDoc</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/** This map gives a translation table to be used for enum
 *  switches.
 *
 *  &lt;p&gt;For each enum that appears as the type of a switch
 *  expression, we maintain an EnumMapping to assist in the
 *  translation, as exemplified by the following example:
 *
 *  &lt;p&gt;we translate
 *  &lt;pre&gt;
 *          switch(colorExpression) {
 *          case red: stmt1;
 *          case green: stmt2;
 *          }
 *  &lt;/pre&gt;
 *  into
 *  &lt;pre&gt;
 *          switch(Outer$0.$EnumMap$Color[colorExpression.ordinal()]) {
 *          case 1: stmt1;
 *          case 2: stmt2
 *          }
 *  &lt;/pre&gt;
 *  with the auxiliary table initialized as follows:
 *  &lt;pre&gt;
 *          class Outer$0 {
 *              synthetic final int[] $EnumMap$Color = new int[Color.values().length];
 *              static {
 *                  try { $EnumMap$Color[red.ordinal()] = 1; } catch (NoSuchFieldError ex) {}
 *                  try { $EnumMap$Color[green.ordinal()] = 2; } catch (NoSuchFieldError ex) {}
 *              }
 *          }
 *  &lt;/pre&gt;
 *  class EnumMapping provides mapping data and support methods for this translation.
 */</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä¸ªç¥ç§˜çš„äºº</font></font><code>try</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸæ¥æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„å¸®åŠ©ç¨‹åºç±»çš„ä¸€éƒ¨åˆ†</font></font><code>TestAll$0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å†…éƒ¨-é™æ€æ•°ç»„çš„å£°æ˜å’Œç”¨äºåˆå§‹åŒ–å®ƒçš„ä»£ç ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ•°ç»„å›ºå®šæšä¸¾å…ƒç´ çš„åç§°ä¸åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­åˆ†é…ç»™å®ƒä»¬çš„</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°å€¼</font><font style="vertical-align: inherit;">ä¹‹é—´çš„å¯¹åº”å…³ç³»</font><font style="vertical-align: inherit;">ï¼Œä»è€Œä¿æŠ¤ç¼–è¯‘çš„ä»£ç å…å—é‡æ„çš„æœ‰å®³å½±å“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“é‡æ–°æ’åºï¼Œæ·»åŠ æ–°çš„å…ƒç´ æˆ–åˆ é™¤ç°æœ‰çš„æšä¸¾å…ƒç´ æ—¶ï¼Œå…¶ä¸­ä¸€äº›å…ƒç´ å¯èƒ½ä¼šæ›´æ”¹å€¼</font></font><code>ordinal()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿™æ˜¯é™„åŠ çº§åˆ«çš„é—´æ¥ä¿æŠ¤çš„ç›®æ ‡ã€‚</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">try</span> {<font></font>
    $SwitchMap$UnsafeHugeEnum[UnsafeHugeEnum.VALUE_00001.ordinal()] = <span class="hljs-number">1</span>;
    <span class="hljs-comment">//  9: getstatic     #2                  // Field $SwitchMap$UnsafeHugeEnum:[I</span>
    <span class="hljs-comment">// 12: getstatic     #3                  // Field UnsafeHugeEnum.VALUE_00001:LUnsafeHugeEnum;</span>
    <span class="hljs-comment">// 15: invokevirtual #4                  // Method UnsafeHugeEnum.ordinal:()I</span>
    <span class="hljs-comment">// 18: iconst_1</span>
    <span class="hljs-comment">// 19: iastore</span><font></font>
}<font></font>
<span class="hljs-comment">// 20: goto          24</span>
<span class="hljs-keyword">catch</span>(NoSuchFieldError e) { }
<span class="hljs-comment">// 23: astore_0</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆå§‹åŒ–ä»£ç å¾ˆç®€å•ï¼Œæ¯ä¸ªå…ƒç´ å ç”¨15åˆ°17ä¸ªå­—èŠ‚ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œé™æ€åˆå§‹åŒ–å—å¯å®¹çº³ä¸è¶…è¿‡3_862ä¸ªå…ƒç´ çš„åˆå§‹åŒ–ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ªæ•°å­—</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å½“å‰å®ç°ä¸­</font><font style="vertical-align: inherit;">å¯ä»¥åœ¨ä¸€ä¸ªæšä¸¾å…ƒç´ ä¸­ä½¿ç”¨çš„æœ€å¤§æ•°é‡</font></font><code>javac</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<a name="Conclusion"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œå³ä½¿ä½¿ç”¨åˆ†é…æšä¸¾å…ƒç´ çš„åˆ›å»ºå¹¶å°†æ•°ç»„åˆå§‹åŒ–</font></font><code>$VALUES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºå•ç‹¬æ–¹æ³•</font><font style="vertical-align: inherit;">çš„ç®€å•æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥å°†æšä¸¾ä¸­</font><font style="vertical-align: inherit;">çš„æœ€å¤§å…ƒç´ æ•°ä»2_746å¢åŠ åˆ°10_920ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å…ˆå‰æˆå°±çš„èƒŒæ™¯ä¸‹è·å¾—çš„æ’å®šåŠ¨æ€ç»“æœçœ‹èµ·æ¥å¹¶ä¸ä»¤äººå°è±¡æ·±åˆ»ï¼Œå¹¶ä¸”æ‚¨åªèƒ½è·å¾—43ä¸ªå…ƒç´ ï¼Œä½†æ˜¯é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå¯ä»¥ä¸ºæšä¸¾æ·»åŠ æ–°å±æ€§æ›´åŠ ä¼˜é›…-åªéœ€ä¿®æ”¹æ„é€ å‡½æ•°å¹¶å°†å…¶é€šè¿‡åŠ¨æ€å¸¸é‡çš„é™æ€å‚æ•°ä¼ é€’ç»™å¿…è¦çš„å€¼å³å¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœåœ¨æœªæ¥çš„æŸä¸ªæ—¶å€™å±æ€§</font></font><code>ConstantValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å­¦ä¹ ï¼Œäº†è§£åŠ¨æ€å¸¸æ•°ï¼Œè¿™ä¸ªæ•°å­—å°†ä¸Šå‡åˆ°10ä¸‡åˆ°16 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨</font></font><code>sun.misc.Unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿æ‚¨å¯ä»¥é£è·ƒï¼Œå¹¶å°†å…ƒç´ çš„æœ€å¤§æ•°é‡å¢åŠ åˆ°65_410ã€‚ä½†æ˜¯è¯·ä¸è¦å¿˜è®°ï¼Œ</font></font><code>Unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªä¸“æœ‰çš„APIï¼Œéšç€æ—¶é—´çš„æµé€ï¼Œå®ƒå¯èƒ½ä¼šæ¶ˆå¤±ï¼Œå¹¶ä¸”ä½¿ç”¨å®ƒä¼šå¸¦æ¥å¾ˆå¤§çš„é£é™©ï¼Œå› ä¸ºjavacç›´æ¥è­¦å‘Šï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">Test.java:3: warning: Unsafe is internal proprietary API and may be removed in a future release<font></font>
import sun.misc.Unsafe;<font></font>
               ^<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œäº‹å®è¯æ˜ï¼Œä»…äº§ç”Ÿä¸€ä¸ªå·¨å¤§çš„æšä¸¾æ˜¯ä¸å¤Ÿçš„ï¼Œæ‚¨è¿˜éœ€è¦èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“å‰ï¼ŒIDEå’ŒJavaç¼–è¯‘å™¨çº§åˆ«å¯¹æ­¤ç±»æšä¸¾çš„æ”¯æŒéƒ½å­˜åœ¨é—®é¢˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç¼–è¾‘å’Œè°ƒè¯•æœŸé—´ï¼Œç±»ä¸­çš„å¤§é‡å­—æ®µå¯èƒ½ä¼šé™ä½IDEçš„å“åº”èƒ½åŠ›ã€‚</font><font style="vertical-align: inherit;">æœ‰æ—¶ä¼šå®Œå…¨æ­»æœºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç±»æ–‡ä»¶æ ¼å¼å’Œjavacçš„å®ç°ç»†èŠ‚æ‰€æ–½åŠ çš„é™åˆ¶ä½¿å¾—ä¸å¯èƒ½åœ¨ä»£ç </font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­åŒæ—¶</font><font style="vertical-align: inherit;">ä½¿ç”¨</font><font style="vertical-align: inherit;">3_862ä¸ªä»¥ä¸Šçš„å…ƒç´ ã€‚</font><font style="vertical-align: inherit;">åœ¨ç§¯ææ–¹é¢ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™äº›å¯ä»¥æ˜¯ä»»æ„çš„3_862å…ƒç´ ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»…é€šè¿‡æ”¹è¿›Javaç¼–è¯‘å™¨ï¼Œæ‰èƒ½è¿›ä¸€æ­¥æ”¹å–„ç»“æœï¼Œä½†è¿™æ˜¯å®Œå…¨ä¸åŒçš„æ•…äº‹ã€‚</font></font><br>
<br>
<a name="Appendix"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™„åŠ ææ–™</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GitHubæºä»£ç ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">//github.com/Maccimo/HugeEnumGeneratorArticle</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ”¶é›†çš„JARæ–‡ä»¶ï¼š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//github.com/Maccimo/HugeEnumGeneratorArticle/releases/tag/v1.0</font></font></a><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¯æŒçš„å¯åŠ¨å¸®åŠ©</font></font></b>
                        <div class="spoiler_text"><pre><font></font>
Huge enumeration generator<font></font>
<font></font>
    https://github.com/Maccimo/HugeEnumGeneratorArticle<font></font>
<font></font>
Additional information (in Russian):<font></font>
<font></font>
    https://habr.com/ru/post/483392/<font></font>
    https://habr.com/ru/post/501870/<font></font>
<font></font>
Usage:<font></font>
    java -jar HugeEnumGen.jar [ &lt;options&gt; ] &lt;enum name&gt;<font></font>
<font></font>
    &lt;enum name&gt;<font></font>
        An enumeration class name.<font></font>
        Should be a valid Java identifier. May contain package name.<font></font>
<font></font>
Options:<font></font>
<font></font>
    -d &lt;directory&gt;<font></font>
        Output directory path.<font></font>
        Current working directory by default.<font></font>
<font></font>
    -e &lt;item list file&gt;<font></font>
        Path to UTF8-encoded text file with list of enumeration item names.<font></font>
        Item names will be autogenerated if absent.<font></font>
        Mutually exclusive with the -c option.<font></font>
<font></font>
    -c &lt;count&gt;<font></font>
        Count of autogenerated enumeration item names.<font></font>
        Mutually exclusive with the -e option.<font></font>
        Default value: Algorithm-depended<font></font>
<font></font>
    -a &lt;algorithm&gt;<font></font>
        Enumeration generation algorithm.<font></font>
        Supported algorithms:<font></font>
          ConDy          - Employ Constant Dynamic (JEP 309) for enum elements initialization<font></font>
          ExtractMethod  - Extract enum elements initialization code to separate method<font></font>
          Unsafe         - Employ sun.misc.Unsafe for enum elements initialization<font></font>
<font></font>
        Default algorithm: ExtractMethod<font></font>
<font></font>
    -h / -?<font></font>
        Show this help page.<font></font>
<font></font>
Example:<font></font>
<font></font>
    java -jar HugeEnumGen.jar -d ./bin -c 2020 com.habr.maccimo.HugeEnum2020<font></font>
<font></font>
</pre><br>
</div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN501860/index.html">5æœˆ15æ—¥RU-Centerå¯èƒ½ä¼šåœ¨æ²¡æœ‰æ‚¨å‚ä¸çš„æƒ…å†µä¸‹ä¸ºæ‚¨æ·»åŠ ä»˜è´¹æœåŠ¡</a></li>
<li><a href="../zh-CN501862/index.html">å¼•æ“ç›–ä¸‹é£˜åŠ¨</a></li>
<li><a href="../zh-CN501864/index.html">åŠ©ç†æˆ–æ£€æŸ¥å‘˜ï¼šæœºå™¨äººè¦å‘¼å«è°ï¼Ÿ</a></li>
<li><a href="../zh-CN501866/index.html">æœºå™¨äººå°†é”€æ¯å¤šå°‘å·¥ä½œ</a></li>
<li><a href="../zh-CN501868/index.html">å¦‚ä½•ä¸è®©ä¼šè®¡å¸ˆä¸¢è„¸ï¼Œè¿˜æ˜¯æˆ‘ä»¬å°†1Cè½¬ç§»åˆ°äº‘ç«¯ã€‚åˆ†æ­¥æŒ‡å¯¼</a></li>
<li><a href="../zh-CN501872/index.html">æ§åˆ¶è®ºç³»ç»Ÿä¸­çš„å­¦ä¹ åœ°ç‚¹</a></li>
<li><a href="../zh-CN501874/index.html">ç°ä»£å‰ç«¯æ¶æ„ï¼ˆç¬¬2éƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN501880/index.html">å…³äºæ²¡æœ‰å¼€å§‹ï¼Œå¼€å§‹å’Œå¼€å§‹çš„â€œå¼€å§‹â€å’Œâ€œå¼€å§‹â€çš„ç¿»è¯‘</a></li>
<li><a href="../zh-CN501882/index.html">æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨è®¡ç®—æœºè§†è§‰ç®—æ³•ï¼šä½¿ç”¨OpenCV.jsåœ¨ç§»åŠ¨æµè§ˆå™¨ä¸­è¿›è¡Œè§†é¢‘å¤„ç†</a></li>
<li><a href="../zh-CN501884/index.html">ç”µå­åŒ»ç–—ä¿¡æ¯æ¡£æ¡ˆåº“å°†å¦‚ä½•å¸®åŠ©æ›´æœ‰æ•ˆåœ°è¯Šæ–­ç–¾ç—…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>