<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ø ‚úåüèª üë©üèΩ‚Äçü§ù‚Äçüë®üèø Snort or Suricata. Part 2: installation and initial setup of Suricata üë®üèø‚Äçüöí üèáüèø üéÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to statistics, the volume of network traffic increases by about 50% every year. This leads to an increase in the load on the equipment and, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Snort or Suricata. Part 2: installation and initial setup of Suricata</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/507234/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">According to statistics, the volume of network traffic increases by about 50% every year. </font><font style="vertical-align: inherit;">This leads to an increase in the load on the equipment and, in particular, increases the performance requirements of IDS / IPS. </font><font style="vertical-align: inherit;">You can buy expensive specialized hardware, but there is a cheaper option - the introduction of one of the open source systems. </font><font style="vertical-align: inherit;">Many novice administrators find it difficult to install and configure free IPS. </font><font style="vertical-align: inherit;">In the case of Suricata, this is not entirely true - you can install it and start repelling typical attacks with a set of free rules in a few minutes.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/nn/5i/pc/nn5ipc7z3qk2abxsmfthdja8vww.jpeg"></div></a><a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snort or Suricata. </font><font style="vertical-align: inherit;">Part 1: choose a free IDS / IPS to protect the corporate network</font></font></a><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why do I need another open IPS?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For a long time, the Snort system, considered standard, has been developed since the late nineties, so it was originally single-threaded. Over the years, all modern chips have appeared in it, such as IPv6 support, the possibility of analyzing application level protocols or a universal data access module. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The basic engine Snort 2.X has learned to work with multiple cores, but has remained single-threaded and therefore cannot optimally use the advantages of modern hardware platforms.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The problem was solved in the third version of the system, but it was prepared for so long that Suricata, written from scratch, managed to appear on the market. </font><font style="vertical-align: inherit;">In 2009, they began to develop it precisely as a multi-threaded alternative to Snort, which has IPS functions out of the box. </font><font style="vertical-align: inherit;">The code is distributed under the GPLv2 license, but the financial partners of the project have access to a closed version of the engine. </font><font style="vertical-align: inherit;">Some problems with scalability appeared in the first versions of the system, but they were quickly resolved.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why Suricata?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suricata has several modules (like Snort): capture, capture, decode, detect, and output. By default, the captured traffic goes before decoding by one stream, although this loads the system more. If necessary, the streams can be divided in the settings and distributed among processors - Suricata is very well optimized for a specific hardware, although this is not a HOWTO level for beginners. It is also worth noting that Suricata has an advanced HTTP inspection tool based on the HTP library. They can also be used to record traffic without detection. The system also supports IPv6 decoding, including IPv4-in-IPv6, IPv6-in-IPv6 tunnels and others.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Different interfaces can be used to intercept traffic (NFQueue, IPFRing, LibPcap, IPFW, AF_PACKET, PF_RING), and in Unix Socket mode, PCAP files captured by another sniffer can be automatically analyzed. In addition, Suricata's modular architecture makes it easy to connect new elements to capture, decode, analyze, and process network packets. It is also important to note that in Suricata, traffic is blocked by means of a standard filter of the operating system. There are two IPS options available on GNU / Linux: through the NFQUEUE queue (NFQ mode) and through zero copy (AF_PACKET mode). In the first case, the packet that gets into iptables is sent to the NFQUEUE queue, where it can be processed at the user level. Suricata runs it by its own rules and makes one of three verdicts: NF_ACCEPT, NF_DROP and NF_REPEAT.The first two explanations are not required, and the last allows you to mark packets and send them to the beginning of the current iptables table. AF_PACKET mode is characterized by higher speed, but imposes a number of limitations on the system: it must have two network interfaces and work as a gateway. A blocked packet is simply not forwarded to the second interface.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An important feature of Suricata is the ability to use developments for Snort. The administrator can access, in particular, the Sourcefire VRT and OpenSource Emerging Threats rule sets, as well as the commercial Emerging Threats Pro. Unified output can be analyzed using popular backends, and output to PCAP and Syslog is also supported. System settings and rules are stored in YAML files, which are easy to read and can be processed automatically. The Suricata engine recognizes many protocols, so there is no need to bind to the port number in the rules. In addition, the concept of flowbits is actively practiced in Suricata rules. To track the response, session variables are used to create and apply various counters and flags.Many IDS consider different TCP connections as separate entities and may not see the connection between them, indicating the beginning of an attack. Suricata tries to see the whole picture and in many cases recognizes malicious traffic distributed across different connections. You can talk about its advantages for a long time, we better move on to installation and configuration.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to install?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will install Suricata on a virtual server running Ubuntu 18.04 LTS. </font><font style="vertical-align: inherit;">All commands must be run as root (root). </font><font style="vertical-align: inherit;">The most secure option is to connect to the server via SSH with the rights of a regular user, and then use the sudo utility to increase privileges. </font><font style="vertical-align: inherit;">First you need to install the packages that we need:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt -y install libpcre3 libpcre3-dev build-essential autoconf automake libtool libpcap-dev libnet1-dev libyaml-0-2 libyaml-dev zlib1g zlib1g-dev libmagic-dev libcap-ng-dev libjansson-dev pkg-config libnetfilter-queue-dev geoip-bin geoip-database geoipupdate apt-transport-https</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We connect an external repository:</font></font><br>
<br>
<pre><code class="bash hljs">sudo add-apt-repository ppa:oisf/suricata-stable<font></font>
sudo apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Install the latest stable version of Suricata:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install suricata</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If necessary, edit the configuration files name, replacing the default eth0 with the actual name of the external server interface. </font><font style="vertical-align: inherit;">The default settings are stored in the / etc / default / suricata file, and the user settings are stored in /etc/suricata/suricata.yaml. </font><font style="vertical-align: inherit;">Setting up IDS is for the most part limited to editing this configuration file. </font><font style="vertical-align: inherit;">It has a lot of parameters, which in name and purpose coincide with their counterparts from Snort. </font><font style="vertical-align: inherit;">The syntax is, however, completely different, but the file is much easier to read than Snort configs, and it is well commented.</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano /etc/default/suricata</code></pre><br>
<img src="https://habrastorage.org/webt/d3/oc/qt/d3ocqteatkouq5i01wub0k9dmyo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano /etc/suricata/suricata.yaml</code></pre><br>
<img src="https://habrastorage.org/webt/nh/v8/it/nhv8itz1ajztjvvvkpmfxxxw8cc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Attention! </font><font style="vertical-align: inherit;">Before starting it is worth checking the values ‚Äã‚Äãof the variables from the vars section. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To complete the configuration, you will need to install suricata-update to update and download the rules. </font><font style="vertical-align: inherit;">To do this is quite simple:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install python-pip<font></font>
sudo pip install pyyaml<font></font>
sudo pip install &lt;a href=<span class="hljs-string">"https://github.com/OISF/suricata-update/archive/master.zip"</span>&gt;https://github.com/OISF/suricata-update/archive/master.zip&lt;/a&gt;<font></font>
sudo pip install --pre --upgrade suricata-update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we need to run the suricata-update command to set the Emerging Threats Open rule set:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update</code></pre><br>
<img src="https://habrastorage.org/webt/tg/nz/yd/tgnzydwuy7jqdeq7swl0sf1xwmc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To view the list of rule sources, run the following command:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update list-sources</code></pre><br>
<img src="https://habrastorage.org/webt/8o/tf/od/8otfodsrz6j0r0lxgnyjuirwyso.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Updating the sources of rules:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update update-sources</code></pre><br>
<img src="https://habrastorage.org/webt/yc/gf/jd/ycgfjdt8bfuxkd5ncvt03uhxtgc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We revisit updated sources:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update list-sources</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If necessary, you can enable available free sources:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update <span class="hljs-built_in">enable</span>-source ptresearch/attackdetection<font></font>
sudo suricata-update <span class="hljs-built_in">enable</span>-source oisf/trafficid<font></font>
sudo suricata-update <span class="hljs-built_in">enable</span>-source sslbl/ssl-fp-blacklist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, you need to update the rules again:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On this, the installation and initial configuration of Suricata in Ubuntu 18.04 LTS can be considered complete. </font><font style="vertical-align: inherit;">The most interesting part begins: in the next article we will connect a virtual server to the office network via VPN and begin to analyze all incoming and outgoing traffic. </font><font style="vertical-align: inherit;">We will pay special attention to blocking DDoS attacks, malware activity, and attempts to exploit vulnerabilities in services accessible from public networks. </font><font style="vertical-align: inherit;">For clarity, attacks of the most common types will be modeled.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/gu/ab/cg/guabcgmwuqoopx1ar80sjpz6keq.png"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/de/0y/l-/de0yl-6ppopvisr_a80b4yuhjj8.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en507214/index.html">How to create and modify interactive PDF forms, or the new skill ABBYY FineReader PDF</a></li>
<li><a href="../en507218/index.html">Read me, or why the text is not read to the end</a></li>
<li><a href="../en507222/index.html">Why everyone should wear masks</a></li>
<li><a href="../en507224/index.html">How to eliminate blind spots with visual testing</a></li>
<li><a href="../en507226/index.html">OCR for PDF in .NET - How to extract text from inaccessible PDF documents</a></li>
<li><a href="../en507236/index.html">We increase the effectiveness of interaction between designers and frontend developers</a></li>
<li><a href="../en507238/index.html">We use DS to process customer reviews from large sites</a></li>
<li><a href="../en507242/index.html">What is interesting Wi-Fi 6 in the performance of Huawei</a></li>
<li><a href="../en507250/index.html">Defining a winning poker hand using map / reduce in JavaScript</a></li>
<li><a href="../en507254/index.html">Zabbix - expanding macro borders</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>