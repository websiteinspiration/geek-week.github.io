<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö≥ üëê üîÖ Combate a vazamentos de mem√≥ria em aplicativos da web ‚ôâÔ∏è üå† üëÇüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando passamos do desenvolvimento de sites cujas p√°ginas s√£o formadas no servidor para a cria√ß√£o de aplicativos Web de p√°gina √∫nica que s√£o renderiza...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Combate a vazamentos de mem√≥ria em aplicativos da web</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/490622/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando passamos do desenvolvimento de sites cujas p√°ginas s√£o formadas no servidor para a cria√ß√£o de aplicativos Web de p√°gina √∫nica que s√£o renderizados no cliente, adotamos certas regras do jogo. Um deles √© o manuseio preciso dos recursos no dispositivo do usu√°rio. Isso significa - n√£o bloqueie o fluxo principal, n√£o "gire" o ventilador do laptop, n√£o coloque a bateria do telefone. Trocamos uma melhoria na interatividade dos projetos da Web e o fato de o comportamento deles se parecer mais com o de aplicativos comuns, uma nova classe de problemas que n√£o existia no mundo da renderiza√ß√£o de servidores.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/wv/_c/nl/wv_cnlo46dgs8op0yzhybzgkpw8.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um desses problemas s√£o vazamentos de mem√≥ria. </font><font style="vertical-align: inherit;">Um aplicativo de uma p√°gina mal projetado pode consumir facilmente megabytes ou mesmo gigabytes de mem√≥ria. </font><font style="vertical-align: inherit;">√â capaz de ocupar cada vez mais recursos, mesmo quando est√° silenciosamente na guia plano de fundo. </font><font style="vertical-align: inherit;">A p√°gina desse aplicativo, depois de capturar uma quantidade exorbitante de recursos, pode come√ßar a "desacelerar" bastante. </font><font style="vertical-align: inherit;">Al√©m disso, o navegador pode simplesmente fechar a guia e informar ao usu√°rio: "Algo deu errado".</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34b/e9d/da8/34be9dda87ca7f35d70a1a934816ce78.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algo deu errado</font></font></font></i><br>
<cut></cut><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, os sites renderizados no servidor tamb√©m podem sofrer um problema de vazamento de mem√≥ria. Mas aqui estamos falando sobre mem√≥ria do servidor. Ao mesmo tempo, √© altamente improv√°vel que esses aplicativos causem um vazamento de mem√≥ria no cliente, pois o navegador limpa a mem√≥ria ap√≥s cada transi√ß√£o de usu√°rio entre as p√°ginas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O t√≥pico vazamentos de mem√≥ria n√£o √© bem abordado nas publica√ß√µes de desenvolvimento da web. E, apesar disso, tenho quase certeza de que a maioria dos aplicativos n√£o triviais de p√°gina √∫nica sofre com vazamentos de mem√≥ria - a menos que as equipes que lidam com eles tenham ferramentas confi√°veis ‚Äã‚Äãpara detectar e corrigir esse problema. O ponto aqui √© que, em JavaScript, √© extremamente f√°cil alocar aleatoriamente uma certa quantidade de mem√≥ria e, em seguida, esque√ßa de liberar essa mem√≥ria.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O autor do artigo, cuja tradu√ß√£o estamos publicando hoje, compartilhar√° com os leitores sua experi√™ncia no combate a vazamentos de mem√≥ria em aplicativos da Web e tamb√©m deseja dar exemplos de sua detec√ß√£o efetiva.</font></font><br>
<cut></cut><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que t√£o pouco est√° escrito sobre isso?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, quero falar sobre por que t√£o pouco est√° escrito sobre vazamentos de mem√≥ria. </font><font style="vertical-align: inherit;">Suponho que aqui voc√™ pode encontrar v√°rios motivos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falta de reclama√ß√µes dos usu√°rios: a maioria dos usu√°rios n√£o est√° ocupada monitorando de perto o gerenciador de tarefas enquanto navega na web. </font><font style="vertical-align: inherit;">Normalmente, o desenvolvedor n√£o encontra reclama√ß√µes de usu√°rios at√© que o vazamento de mem√≥ria seja t√£o grave que fa√ßa com que a incapacidade funcione ou diminua a velocidade do aplicativo.</font></font></li>
<li>  :   Chrome   -   ,     .          .</li>
<li> :            .</li>
<li>      :       ¬´¬ª     .   ,     ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>,   -.</li>
</ul><br>
<h2><font color="#3AC1EF">  </font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bibliotecas e estruturas modernas para o desenvolvimento de aplicativos da Web, como React, Vue e Svelte, usam o modelo de componente do aplicativo. Nesse modelo, a maneira mais comum de causar vazamento de mem√≥ria √© algo como isto:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">this</span>.onMessage.bind(<span class="hljs-keyword">this</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© tudo. </font><font style="vertical-align: inherit;">Isso √© tudo o que √© necess√°rio para "equipar" um projeto com um vazamento de mem√≥ria. </font><font style="vertical-align: inherit;">Para fazer isso, basta chamar o m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addEventListener</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><font style="vertical-align: inherit;">algum objeto global (como </font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><code>&lt;body&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algo semelhante) e, ao desmontar o componente, esque√ßa de remover o ouvinte de eventos usando o m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">removeEventListener</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas as consequ√™ncias disso s√£o ainda piores, pois ocorre o vazamento de todo o componente. </font><font style="vertical-align: inherit;">Isso se deve ao fato de o m√©todo estar </font></font><code>this.onMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anexado </font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Junto com esse componente, ocorre o vazamento de seus componentes filhos. </font><font style="vertical-align: inherit;">√â muito prov√°vel que todos os n√≥s do DOM associados a este componente vazem. </font><font style="vertical-align: inherit;">A situa√ß√£o, como resultado, pode sair do controle muito rapidamente, levando a consequ√™ncias muito ruins.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja como resolver esse problema:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//   </span>
<span class="hljs-keyword">this</span>.onMessage = <span class="hljs-keyword">this</span>.onMessage.bind(<span class="hljs-keyword">this</span>);
<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">this</span>.onMessage);<font></font>
&nbsp;<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-built_in">window</span>.removeEventListener(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">this</span>.onMessage);</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situa√ß√µes em que vazamentos de mem√≥ria ocorrem com mais frequ√™ncia</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A experi√™ncia me diz que o vazamento de mem√≥ria ocorre com mais frequ√™ncia ao usar as seguintes APIs:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo </font></font><code>addEventListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√â aqui que os vazamentos de mem√≥ria ocorrem com mais frequ√™ncia. </font><font style="vertical-align: inherit;">Para resolver o problema, basta ligar na hora certa </font></font><code>removeEventListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">setTimeout</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">setInterval</a>.   ,        (,  30 ),  ,   ,      ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">clearTimeout</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">clearInterval</a>. ,    <code>setTimeout</code>,  ¬´¬ª   ,    ,     <code>setInterval</code>-.  ,    <code>setTimeout</code>       .</li>
<li>API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IntersectionObserver</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ResizeObserver</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MutationObserver</a>   .  ,  ,  .         .     -         ,  ,   ,     ,   ,   <code>disconnect</code>  .    ,     DOM    ,           ,  -.        -,     .  ‚Äî  <code>&lt;body&gt;</code>,  <code>document</code>,   <code>header</code>  <code>footer</code>,     .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Promise-</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>      .   ,    ,     ‚Äî   ,      . , ,  ¬´¬ª   ,        .    ¬´¬ª     <code>.then()</code>-.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reposit√≥rios representados por objetos globais. </font><font style="vertical-align: inherit;">Quando voc√™ usa algo como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para controlar o estado de um aplicativo </font><font style="vertical-align: inherit;">, o armazenamento de estado √© representado por um objeto global. </font><font style="vertical-align: inherit;">Como resultado, se voc√™ lidar com esse armazenamento de forma descuidada, dados desnecess√°rios n√£o ser√£o exclu√≠dos dele, como resultado do qual seu tamanho aumentar√° constantemente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crescimento infinito do DOM. </font><font style="vertical-align: inherit;">Se a p√°gina implementar rolagem sem fim, sem o uso da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">virtualiza√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , isso significa que o n√∫mero de n√≥s DOM nesta p√°gina poder√° aumentar ilimitadamente.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acima, examinamos situa√ß√µes nas quais vazamentos de mem√≥ria ocorrem com mais frequ√™ncia, mas, √© claro, existem muitos outros casos que causam o problema de nosso interesse.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifica√ß√£o de vazamento de mem√≥ria</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora passamos ao desafio de identificar vazamentos de mem√≥ria. Para come√ßar, n√£o acho que nenhuma das ferramentas existentes seja muito adequada para isso. Eu tentei as ferramentas de an√°lise de mem√≥ria do Firefox, tentei as ferramentas do Edge e do IE. Testou at√© o Windows Performance Analyzer. Mas as melhores ferramentas ainda s√£o as Ferramentas do desenvolvedor do Chrome. √â verdade que nessas ferramentas existem muitos "cantos afiados" que valem a pena conhecer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre as ferramentas que o desenvolvedor do Chrome fornece, estamos mais interessados </font></font><code>Heap snapshot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no </font><font style="vertical-align: inherit;">criador de perfil de </font><font style="vertical-align: inherit;">guias </font></font><code>Memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que permite criar instant√¢neos de heap. Existem outras ferramentas para analisar a mem√≥ria no Chrome, mas n√£o consegui extrair benef√≠cios especiais delas na detec√ß√£o de vazamentos de mem√≥ria.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7d/e42/63a/e7de4263abd59eecce420c4bcbfc55ea.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A ferramenta Haps snapshot permite tirar instant√¢neos da mem√≥ria do fluxo principal, trabalhadores da Web ou elementos iframe.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se a janela da ferramenta Chrome se parecer com a mostrada na figura anterior, quando voc√™ clicar no bot√£o</font></font><code>Take snapshot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ser√£o capturadas informa√ß√µes sobre todos os objetos na mem√≥ria da m√°quina virtual selecionada JavaScript da p√°gina investigada. Isso inclui objetos mencionados em</font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, objetos referenciados pelos retornos de chamada usados ‚Äã‚Äãna chamada</font></font><code>setInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e assim por diante. Um instant√¢neo da mem√≥ria pode ser percebido como um "momento congelado" do trabalho da entidade investigada, representando informa√ß√µes sobre toda a mem√≥ria usada por essa entidade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que a foto √© tirada, chegamos ao pr√≥ximo passo para encontrar vazamentos. Consiste em reproduzir um cen√°rio em que, de acordo com o desenvolvedor, pode ocorrer um vazamento de mem√≥ria. Por exemplo, est√° abrindo e fechando uma determinada janela modal. Depois que a janela semelhante √© fechada, espera-se que a quantidade de mem√≥ria alocada retorne ao n√≠vel que existia antes da abertura da janela. Portanto, eles tiram outra foto e a comparam com a foto tirada anteriormente. De fato, a compara√ß√£o de imagens √© a caracter√≠stica mais importante de nosso interesse </font></font><code>Heap snapshot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92d/776/4c7/92d7764c7fbe5d561032c3bc092e1541.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiramos o primeiro instant√¢neo, depois executamos a√ß√µes que podem causar um vazamento de mem√≥ria e depois outro. </font><font style="vertical-align: inherit;">Se n√£o houver vazamento, o tamanho da mem√≥ria alocada ser√° igual</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
,</font><i><font color="#999999"><font style="vertical-align: inherit;"> pois</font></font></i><font style="vertical-align: inherit;"> isso</font></font><code>Heap snapshot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° longe de ser uma ferramenta ideal. </font><font style="vertical-align: inherit;">Vale a pena conhecer algumas limita√ß√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesmo se voc√™ clicar no pequeno bot√£o no painel </font></font><code>Memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que inicia a coleta de lixo ( </font></font><code>Collect garbage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), para ter certeza de que a mem√≥ria est√° realmente limpa, talvez seja necess√°rio tirar v√°rias fotos consecutivas. </font><font style="vertical-align: inherit;">Eu normalmente tenho tr√™s doses. </font><font style="vertical-align: inherit;">Aqui vale a pena focar no tamanho total de cada imagem - ela, no final, deve estabilizar.</font></font></li>
<li>    -, -,  <code>iframe</code>,      ,   ,          .   ,        JavaScript.   ‚Äî      ,       ,    .</li>
<li>           ¬´¬ª.             .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse ponto, se o seu aplicativo for bastante complexo, voc√™ poder√° observar muitos objetos "vazando" ao comparar instant√¢neos. </font><font style="vertical-align: inherit;">Aqui a situa√ß√£o √© um pouco complicada, pois o que pode ser confundido com um vazamento de mem√≥ria nem sempre √© o caso. </font><font style="vertical-align: inherit;">Muito do que √© suspeito √© apenas processos normais para trabalhar com objetos. </font><font style="vertical-align: inherit;">A mem√≥ria ocupada por alguns objetos √© limpa para colocar outros objetos nessa mem√≥ria, algo √© liberado no cache e, portanto, a mem√≥ria correspondente n√£o √© limpa imediatamente e assim por diante.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abrimos caminho atrav√©s do ru√≠do da informa√ß√£o</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu descobri que a melhor maneira de romper o ru√≠do da informa√ß√£o √© repetir as a√ß√µes que deveriam causar um vazamento de mem√≥ria. Por exemplo, em vez de abrir e fechar a janela modal apenas uma vez ap√≥s a captura da primeira foto, isso pode ser feito 7 vezes. Por que 7? Sim, apenas porque 7 √© um primo percept√≠vel. Ent√£o voc√™ precisa fazer uma segunda tentativa e, comparando com a primeira, descobrir se um determinado objeto ‚Äúvazou‚Äù 7 vezes (ou 14 vezes ou 21 vezes).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a7/ac2/243/2a7ac2243dc82f0e7887b23098e7c893.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compare instant√¢neos de heap. Observe que estamos comparando a imagem n¬∫ 3 com a imagem n¬∫ 6. O fato √© que tirei tr√™s fotos seguidas para que o Chrome tivesse mais sess√µes de coleta de lixo. Al√©m disso, observe que alguns objetos ‚Äúvazaram‚Äù 7 vezes.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Outro truque √∫til √© que, no in√≠cio do estudo, antes de criar a primeira imagem, execute o procedimento uma vez, durante o qual, conforme o esperado, vazamento de mem√≥ria. Isso √© especialmente recomendado se a divis√£o de c√≥digo for usada no projeto. Nesse caso, √© muito prov√°vel que, ap√≥s a primeira execu√ß√£o da a√ß√£o suspeita, os m√≥dulos JavaScript necess√°rios sejam carregados, o que afetar√° a quantidade de mem√≥ria alocada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode ter uma pergunta sobre por que deve prestar aten√ß√£o especial ao n√∫mero de objetos e n√£o √† quantidade total de mem√≥ria. Aqui podemos dizer que nos esfor√ßamos intuitivamente para reduzir a quantidade de mem√≥ria "vazando". Nesse sentido, voc√™ pode pensar que deve monitorar a quantidade total de mem√≥ria usada. Mas essa abordagem, por um motivo importante, n√£o nos conv√©m particularmente bem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se algo ‚Äúvaza‚Äù, acontece porque (recontando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joe Armstrong</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) voc√™ precisa de uma banana, mas acaba com uma banana, o gorila que a segura e, al√©m disso, toda a selva. Se focarmos na quantidade total de mem√≥ria, ser√° o mesmo que ‚Äúmedir‚Äù a floresta, e n√£o a banana que nos interessa.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e8/af8/847/7e8af8847ab7e8689e1638ac218582d6.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gorila comendo uma banana</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora, de volta ao exemplo acima com</font></font><code>addEventListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Uma fonte de vazamento √© um ouvinte de eventos que faz refer√™ncia a uma fun√ß√£o. E essa fun√ß√£o, por sua vez, refere-se a um componente que, possivelmente, armazena links para v√°rias coisas boas, como matrizes, seq√º√™ncias de caracteres e objetos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ analisar a diferen√ßa entre as imagens, classificando as entidades pela quantidade de mem√≥ria que elas ocupam, isso permitir√° que voc√™ veja muitas matrizes, linhas, objetos, a maioria dos quais provavelmente n√£o est√° relacionada ao vazamento. E, afinal, precisamos encontrar o pr√≥prio ouvinte de eventos a partir do qual tudo come√ßou. Ele, em compara√ß√£o com o que ele se refere, ocupa muito pouca mem√≥ria. Para consertar o vazamento, voc√™ precisa encontrar uma banana, n√£o a selva.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, se voc√™ classificar os registros pelo n√∫mero de objetos "vazados", notar√° 7 ouvintes de eventos. </font><font style="vertical-align: inherit;">E talvez 7 componentes e 14 subcomponentes, e talvez algo assim. </font><font style="vertical-align: inherit;">Este n√∫mero 7 deve se destacar do quadro geral, pois √©, no entanto, um n√∫mero bastante percept√≠vel e incomum. </font><font style="vertical-align: inherit;">Nesse caso, n√£o importa quantas vezes a a√ß√£o suspeita seja repetida. </font><font style="vertical-align: inherit;">Ao examinar imagens, se as suspeitas forem justificadas, elas ser√£o gravadas com o mesmo n√∫mero de objetos "vazados". </font><font style="vertical-align: inherit;">√â assim que voc√™ pode identificar rapidamente a fonte de um vazamento de mem√≥ria.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise de √Årvore de Link</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ferramenta para criar capturas instant√¢neas fornece a capacidade de visualizar "cadeias de links" que ajudam a descobrir quais objetos s√£o referenciados por outros objetos. </font><font style="vertical-align: inherit;">√â isso que permite que o aplicativo funcione. </font><font style="vertical-align: inherit;">Analisando essas "cadeias" ou "√°rvores" de links, voc√™ pode descobrir exatamente onde a mem√≥ria foi alocada para o objeto "vazando".</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bf/77a/07d/7bf77a07dd2d15e479f77c2279b9942d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A cadeia de links permite descobrir qual objeto se refere ao objeto "com vazamento". </font><font style="vertical-align: inherit;">Ao ler essas cadeias, √© necess√°rio levar em considera√ß√£o que os objetos localizados nelas abaixo se referem aos objetos localizados</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
acima.No exemplo acima, h√° uma vari√°vel chamada</font></font><code>someObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">referenciada no encerramento (</font></font><code>context</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) referenciado pelo ouvinte de evento. </font><font style="vertical-align: inherit;">Se voc√™ clicar no link que leva ao c√≥digo fonte, ser√° exibido um texto bastante compreens√≠vel do programa:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeObject</span> () </span>{ <span class="hljs-comment">/* ... */</span> }<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">const</span> someObject = <span class="hljs-keyword">new</span> SomeObject();
<span class="hljs-keyword">const</span> onMessage = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-comment">/* ... */</span> };
<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'message'</span>, onMessage);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se compararmos esse c√≥digo com a figura anterior, verifica-se que </font></font><code>context</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a figura √© um fechamento a </font></font><code>onMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que se refere </font></font><code>someObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Este √© um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo artificial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vazamentos reais de mem√≥ria podem ser muito menos √≥bvios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale ressaltar que a ferramenta de instant√¢neo de heap tem algumas limita√ß√µes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ salvar um arquivo de captura instant√¢nea e envi√°-lo novamente, os links para arquivos com c√≥digo ser√£o perdidos. </font><font style="vertical-align: inherit;">Ou seja, por exemplo, ap√≥s o download de um instant√¢neo, n√£o ser√° poss√≠vel descobrir que o c√≥digo de fechamento do ouvinte de eventos est√° na linha 22 do arquivo </font></font><code>foo.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como essas informa√ß√µes s√£o extremamente importantes, salvar arquivos de instant√¢neo de heap ou, por exemplo, transferi-los para algu√©m, √© quase in√∫til.</font></font></li>
<li>     <code>WeakMap</code>,  Chrome       ,      . ,   ,     ,    ,   .    <code>WeakMap</code> ‚Äî     .</li>
<li>Chrome  ,    .  ,        ,     ,     ,     .      ,       <code>object</code>,    <code>EventListener</code>.   <code>object</code> ‚Äî     ,  ,   ,  ¬´¬ª   7  .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma descri√ß√£o da minha estrat√©gia b√°sica para identificar vazamentos de mem√≥ria. </font><font style="vertical-align: inherit;">Utilizei com sucesso essa t√©cnica para detectar dezenas de vazamentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â verdade que devo dizer que este guia para encontrar vazamentos de mem√≥ria cobre apenas uma pequena parte do que est√° acontecendo na realidade. </font><font style="vertical-align: inherit;">Este √© apenas o come√ßo do trabalho. </font><font style="vertical-align: inherit;">Al√©m disso, voc√™ precisa ser capaz de lidar com a instala√ß√£o de pontos de interrup√ß√£o, registro em log e corre√ß√µes de teste para determinar se eles resolvem o problema. </font><font style="vertical-align: inherit;">E, infelizmente, tudo isso, em ess√™ncia, se traduz em um s√©rio investimento de tempo.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise automatizada de vazamento de mem√≥ria</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desejo iniciar esta se√ß√£o com o fato de n√£o encontrar uma boa abordagem para automatizar a detec√ß√£o de vazamentos de mem√≥ria. O Chrome possui sua pr√≥pria API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performance.memory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas por motivos de privacidade, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o permite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coletar dados suficientemente detalhados. Como resultado, essa API n√£o pode ser usada na produ√ß√£o para detectar vazamentos. O W3C Web Performance Working Group discutiu anteriormente as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ferramentas de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mem√≥ria, mas seus membros ainda n√£o concordaram com um novo padr√£o projetado para substituir esta API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em ambientes de teste, voc√™ pode aumentar a granularidade da sa√≠da de dados </font></font><code>performance.memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o sinalizador do Chrome </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--enable-specific-memory-info</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Os instant√¢neos de heap ainda podem ser criados usando a pr√≥pria equipe do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chromedriver: takeHeapSnapshot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Essa equipe tem as mesmas limita√ß√µes que j√° discutimos. √â prov√°vel que, se voc√™ usar esse comando, pelos motivos descritos acima, fa√ßa sentido cham√°-lo tr√™s vezes e, em seguida, leve apenas o que foi recebido como resultado da √∫ltima chamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como os ouvintes de eventos s√£o a fonte mais comum de vazamento de mem√≥ria, falarei sobre outra t√©cnica de detec√ß√£o de vazamento que uso. Consiste na cria√ß√£o de patches de macaco para a API </font></font><code>addEventListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>removeEventListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na contagem dos links para verificar se o n√∫mero deles est√° retornando a zero. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um exemplo de como isso √© feito.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas Ferramentas do desenvolvedor do Chrome, voc√™ tamb√©m pode usar a API nativa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getEventListeners</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para descobrir quais ouvintes de eventos est√£o anexados a um elemento espec√≠fico. </font><font style="vertical-align: inherit;">Este comando, no entanto, est√° dispon√≠vel apenas na barra de ferramentas do desenvolvedor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quero acrescentar que Matthias Binens me falou sobre outra API √∫til de ferramentas do Chrome. </font><font style="vertical-align: inherit;">Estes s√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queryObjects</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Com ele, voc√™ pode obter informa√ß√µes sobre todos os objetos criados usando um determinado construtor. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um bom material sobre este t√≥pico sobre como automatizar a detec√ß√£o de vazamento de mem√≥ria no Puppeteer.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesquisa e a corre√ß√£o de vazamentos de mem√≥ria em aplicativos da web ainda est√£o engatinhando. Aqui eu falei sobre algumas t√©cnicas que, no meu caso, tiveram um bom desempenho. Mas deve-se reconhecer que a aplica√ß√£o dessas t√©cnicas ainda est√° repleta de certas dificuldades e consome muito tempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como em qualquer problema de desempenho, como se costuma dizer, uma pitada de anteced√™ncia vale um quilo. Talvez algu√©m ache √∫til preparar os testes sint√©ticos apropriados, em vez de analisar o vazamento depois que ele j√° ocorreu. E se n√£o √© um vazamento, mas v√°rios, a an√°lise do problema pode se transformar em algo como descascar cebolas: depois que um problema √© corrigido, outro √© descoberto e esse processo se repete (e todo esse tempo, como nas cebolas) l√°grimas nos olhos). As revis√µes de c√≥digo tamb√©m podem ajudar a identificar padr√µes comuns de vazamento. Mas isso - se voc√™ souber - para onde olhar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JavaScript √© uma linguagem que fornece trabalho seguro com mem√≥ria. </font><font style="vertical-align: inherit;">Portanto, h√° alguma ironia na facilidade com que vazamentos de mem√≥ria acontecem em aplicativos da web. </font><font style="vertical-align: inherit;">√â verdade que isso se deve em parte aos recursos das interfaces de usu√°rio do dispositivo. </font><font style="vertical-align: inherit;">Voc√™ precisa ouvir muitos eventos: eventos do mouse, eventos de rolagem, eventos do teclado. </font><font style="vertical-align: inherit;">A aplica√ß√£o de todos esses padr√µes pode facilmente levar a vazamentos de mem√≥ria. </font><font style="vertical-align: inherit;">Mas, nos esfor√ßando para garantir que nossos aplicativos da Web usem a mem√≥ria com modera√ß√£o, podemos aumentar seu desempenho e proteg√™-los de "falhas". </font><font style="vertical-align: inherit;">Al√©m disso, demonstramos respeito pelos limites de recursos dos dispositivos do usu√°rio. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queridos leitores! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ encontrou vazamentos de mem√≥ria em seus projetos da web?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490610/index.html">Baidu bate Waymo na classifica√ß√£o de autonomia de rob√¥s da Calif√≥rnia</a></li>
<li><a href="../pt490612/index.html">Abordagem funcional para transa√ß√µes no Scala ou escreva sua pr√≥pria m√¥nada √∫til</a></li>
<li><a href="../pt490616/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 404 (24 de fevereiro a 1 de mar√ßo de 2020)</a></li>
<li><a href="../pt490618/index.html">Buffers de pilha da Goroutine</a></li>
<li><a href="../pt490620/index.html">Quando ou√ßo as palavras "restaurou a rede neural", subo para verificar os backups</a></li>
<li><a href="../pt490624/index.html">Controle de cabe√ßalho HTTP da pol√≠tica de recursos e navegador da Web</a></li>
<li><a href="../pt490626/index.html">Um guia completo para dados- * atributos HTML</a></li>
<li><a href="../pt490628/index.html">O que fazer quando o CSS bloqueia a an√°lise de p√°gina?</a></li>
<li><a href="../pt490630/index.html">Carregando matrizes NumPy do disco: Comparando memmap () e Zarr / HDF5</a></li>
<li><a href="../pt490634/index.html">Eventos digitais em Moscou de 2 a 8 de mar√ßo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>