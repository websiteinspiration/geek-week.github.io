<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💆🏾 ✌️ 🤛🏽 إنشاء Minecraft في أسبوع واحد في C ++ و Vulkan 💅🏽 😝 🧠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="لقد حددت لنفسي مهمة إعادة إنشاء لعبة Minecraft من الصفر في أسبوع واحد باستخدام محركي الخاص في C ++ و Vulkan. لقد ألهمت Hopson ، الذي فعل الشيء نفسه مع...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>إنشاء Minecraft في أسبوع واحد في C ++ و Vulkan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487832/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لقد حددت لنفسي مهمة إعادة إنشاء لعبة Minecraft من الصفر في أسبوع واحد باستخدام محركي الخاص في C ++ و Vulkan. </font><font style="vertical-align: inherit;">لقد ألهمت </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopson</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، الذي فعل الشيء نفسه مع C ++ و OpenGL. </font><font style="vertical-align: inherit;">في المقابل ، كان مستوحى من </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shane Beck</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، الذي استلهم من Minecraft ، مصدر الإلهام الذي كان Infiniminer ، والذي من المفترض أنه مستوحى من التعدين الحقيقي.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa1/8b2/50c/aa18b250ce4120bd3a0dc94c01a63621.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
مستودع جيثب لهذا المشروع </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هنا</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">كل يوم له علامة git الخاصة به. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بالطبع ، لم أخطط لإعادة إنشاء لعبة Minecraft. </font><font style="vertical-align: inherit;">كان من المفترض أن يكون هذا المشروع تعليميًا. </font><font style="vertical-align: inherit;">كنت أرغب في معرفة استخدام Vulkan في شيء أكثر تعقيدًا من </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulkan-tutorial.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> أو عرض Sasha Willem. </font><font style="vertical-align: inherit;">لذلك ، ينصب التركيز الرئيسي على تصميم محرك Vulkan ، وليس على تصميم اللعبة.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مهام</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
التطوير على Vulkan أبطأ بكثير من OpenGL ، لذلك لم أستطع دمج العديد من ميزات Minecraft في اللعبة. </font><font style="vertical-align: inherit;">لا يوجد غوغاء ، ولا صياغة ، ولا حجر أحمر ، ولا فيزياء كتلة ، إلخ. </font><font style="vertical-align: inherit;">كانت أهداف المشروع منذ البداية على النحو التالي:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إنشاء نظام عرض التضاريس</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يهرس</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إضاءة</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إنشاء نظام مولد التضاريس</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ارتياح</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الأشجار</font></font></li>
</ul><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المناطق الأحيائية</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إضافة القدرة على تغيير التضاريس وتحريك الكتل</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كنت بحاجة إلى إيجاد طريقة لتنفيذ كل هذا دون إضافة واجهة مستخدم رسومية إلى اللعبة ، لأنني لم أجد أي مكتبات GUI تعمل مع Vulkan وكان من السهل دمجها.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مكتبات</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بالطبع ، لم أكن لأكتب تطبيق Vulkan من البداية. </font><font style="vertical-align: inherit;">لتسريع عملية التطوير ، سأستخدم مكتبات جاهزة كلما أمكن ذلك. </font><font style="vertical-align: inherit;">يسمى:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanWrapper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - غلاف C ++ الخاص بي لـ Vulkan API</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLFW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - للنوافذ وإدخال المستخدم</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulkanMemoryAllocator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - لتخصيص ذاكرة Vulkan</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GLM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - لمصفوفات ومصفوفات الرياضيات</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - للإشارات / الفتحات و ECS</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - لمرافق تحميل الصور</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FastNoise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - لتوليد ضجيج ثلاثي الأبعاد</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اليوم 1</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في اليوم الأول ، قمت بإعداد لوح فولكاني وهيكل المحرك. </font><font style="vertical-align: inherit;">كانت معظم الشفرة عبارة عن </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لوحة مرجعية</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ويمكنني فقط نسخها من </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">vulkan-tutorial.com</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">كما تضمنت خدعة مع تخزين بيانات الرأس كجزء من جهاز تظليل الرأس. </font><font style="vertical-align: inherit;">هذا يعني أنني لم أكن مضطراً إلى ضبط تخصيص الذاكرة. </font><font style="vertical-align: inherit;">مجرد ناقل بسيط يمكنه القيام بشيء واحد فقط: رسم مثلث. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
المحرك بسيط بما يكفي لدعم أداة تقديم المثلثات. </font><font style="vertical-align: inherit;">يحتوي على نافذة واحدة وحلقة لعبة يمكن توصيل الأنظمة بها. </font><font style="vertical-align: inherit;">واجهة المستخدم الرسومية محدودة بمعدل الإطارات المعروض في عنوان النافذة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ينقسم المشروع إلى قسمين: </font></font><code>VoxelEngine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">و </font></font><code>VoxelGame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/875/3cd/190/8753cd190975239ad550e8c0c8b27d00.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اليوم الثاني</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
قمت بدمج مكتبة Vulkan Memory Allocator. </font><font style="vertical-align: inherit;">تهتم هذه المكتبة بمعظم لوحة مرجعية لتخصيص ذاكرة Vulkan: أنواع الذاكرة وأكوام ذاكرة الجهاز والتخصيص الثانوي. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن بعد أن حصلت على تخصيص للذاكرة ، أنشأت فئات للشبكات والمخازن المؤقتة للرأس. </font><font style="vertical-align: inherit;">لقد غيرت عارض المثلثات بحيث تستخدم فئة الشبكات ، وليس الصفائف المضمنة في التظليل. </font><font style="vertical-align: inherit;">حاليًا ، يتم نقل بيانات الشبكة إلى وحدة معالجة الرسومات عن طريق عرض المثلثات يدويًا.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/627/28d/0fc/62728d0fce9015f2be4dad88f18c7b7a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لقد تغير القليل</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يوم 3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أضفت نظام عرض الرسم البياني. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تم</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> أخذ هذا المنشور كأساس لإنشاء هذا الفصل </font><font style="vertical-align: inherit;">، ولكن الفصل مبسط للغاية. يحتوي الرسم البياني للعرض على أساسيات معالجة المزامنة مع Vulkan فقط. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الرسم البياني تقديم يتيح لي الفرصة لتعيين </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">العقد</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> و </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حواف</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. العقد هي العمل الذي يقوم به GPU. الأضلاع هي تبعيات البيانات بين العقد. تتلقى كل عقدة مخزن التعليمات الخاص بها ، والذي تكتب فيه. يعمل الرسم البياني في مخازن أوامر التخزين المؤقت المزدوج ومزامنتها مع الإطارات السابقة. يتم استخدام الحواف لإدراج حواجز الناقل تلقائيًا قبل وبعد كتابة العقدة في كل مخزن تعليمات. تزامن حواجز خطوط الأنابيب استخدام جميع الموارد ونقل الملكية بين قوائم الانتظار. بالإضافة إلى ذلك ، تقوم الحواف بإدراج الإشارات بين العقد. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تشكل العُقد والحواف رسمًا </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بيانيًا حلقياً موجهًا</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ثم يقوم الرسم البياني لتقديم </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الفرز الطوبولوجي.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">العقد ، مما يؤدي إلى إنشاء قائمة مسطحة من العقد المصنفة بحيث تذهب كل عقدة بعد جميع العقد التي تعتمد عليها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يحتوي المحرك على ثلاثة أنواع من العقد. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتلقى صورة من سلسلة عازلة (swapchain) ، </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">وينقل البيانات من وحدة المعالجة المركزية إلى GPU ، </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ويوفر صورة لسلسلة عازلة ليتم عرضها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كل عقدة يمكن أن تنفذ </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">، </font></font><code>render</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">و </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">التي يتم تنفيذها في كل إطار. </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يحصل على صورة لسلسلة من المخازن المؤقتة أثناء </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">توفر هذه الصورة في الوقت المحدد </font></font><code>postRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لقد قمت بإعادة بناء العارض المثلث بحيث يستخدم نظام رسم بياني للعرض ، بدلاً من معالجة كل شيء بنفسي. هناك حافة بين </font></font><code>AcquireNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">و</font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">وكذلك بين </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">و </font></font><code>PresentNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">هذا يضمن أن صورة سلسلة المخزن المؤقت متزامنة بشكل صحيح أثناء استخدامها أثناء الإطار.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12b/d88/6ba/12bd886ba9b41891ae1e2d0ff47b9929.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أقسم داخل المحرك قد تغير</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اليوم الرابع</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لقد أنشأت كاميرا ونظام عرض ثلاثي الأبعاد. حتى الآن ، تستقبل الكاميرا مجموعة العازلة والواصف الخاصة بها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لقد تباطأت في ذلك اليوم لأنني كنت أحاول العثور على التكوين الصحيح للعرض ثلاثي الأبعاد باستخدام Vulkan. تركز معظم المواد عبر الإنترنت على العرض باستخدام OpenGL ، والذي يستخدم أنظمة إحداثيات مختلفة قليلاً عن Vulkan. في OpenGL ، يتم تحديد المحور Z لمساحة المقطع بالشكل </font></font><code>[-1, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">، وتكون الحافة العلوية للشاشة </font></font><code>Y = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. في Vulkan ، يتم تحديد المحور Z كـ </font></font><code>[0, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">، والحافة العلوية للشاشة عند </font></font><code>Y = -1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. بسبب هذه الاختلافات الصغيرة ، لا تعمل مصفوفات الإسقاط القياسية لـ GLM بشكل صحيح لأنها مصممة لـ OpenGL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GLM لديه خيار</font></font><code>GLM_FORCE_DEPTH_ZERO_TO_ONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">، القضاء على المشكلة في المحور Z. بعد ذلك ، يمكن التخلص من المشكلة في المحور Y ببساطة عن طريق تغيير علامة عنصر </font></font><code>(1, 1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مصفوفة الإسقاط (يستخدم GLM الفهرسة من 0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا قلبنا المحور Y ، فسنحتاج إلى قلب بيانات القمة ، لأنه قبل ذلك ، يشير الاتجاه السلبي للمحور Y إلى الأعلى.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/05d/464/8d905d4643a189400471c7e8d4fbd3f6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الآن في 3D!</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يوم 5</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أضفت مدخلات المستخدم والقدرة على تحريك الكاميرا بالماوس. </font><font style="vertical-align: inherit;">نظام الإدخال معقد للغاية ، ولكنه يزيل الشذوذ في إدخال GLFW. </font><font style="vertical-align: inherit;">على وجه الخصوص ، واجهت مشكلة في تغيير موضع الماوس أثناء حظره. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يعتبر إدخال لوحة المفاتيح والماوس جزءًا أساسيًا من الأغلفة الرفيعة أعلى GLFW ، ويتم فتحه من خلال معالجات الإشارة </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
للمقارنة فقط - نفس الشيء الذي فعله هوبسون في اليوم الأول من مشروعه.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">متصفحك لا يدعم فيديو HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يوم 6</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بدأت بإضافة رمز لإنشاء كتل voxel وتقديمها. </font><font style="vertical-align: inherit;">كانت كتابة شفرة الربط سهلة لأنني فعلت ذلك من قبل وعرفت التجريدات التي سمحت لي بارتكاب أخطاء أقل. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كان أحد التجريدات فئة قالب </font></font><code>ChunkData&lt;T, chunkSize&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يحدد مكعبًا من نوع </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حجم </font></font><code>chunkSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">كل جانب. </font><font style="vertical-align: inherit;">يخزن هذا الفصل البيانات في صفيف 1D ويعالج بيانات الفهرسة بإحداثيات ثلاثية الأبعاد. </font><font style="vertical-align: inherit;">حجم كل كتلة هو 16 × 16 × 16 ، وبالتالي فإن البيانات الداخلية عبارة عن مصفوفة بسيطة بطول 4096. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وهناك تجريد آخر هو إنشاء مكرر للمواضع التي تولد إحداثيات من </font></font><code>(0, 0, 0)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إلى</font></font><code>(15, 15, 15)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">تضمن هاتين الفئتين إجراء عمليات التكرار مع بيانات الكتلة بترتيب خطي لزيادة موقع ذاكرة التخزين المؤقت. </font><font style="vertical-align: inherit;">لا يزال الإحداثيات ثلاثية الأبعاد متاحة للعمليات الأخرى التي تحتاج إليها. </font><font style="vertical-align: inherit;">على سبيل المثال:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {
    <span class="hljs-keyword">auto</span>&amp; data = chunkData[pos];<font></font>
    glm::ivec3 offset = ...;<font></font>
    <span class="hljs-keyword">auto</span>&amp; neighborData = chunkData[pos + offset];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لدي العديد من الصفائف الثابتة التي تحدد الإزاحات التي يشيع استخدامها في اللعبة. </font><font style="vertical-align: inherit;">على سبيل المثال ، </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تحدد 6 جيران لها المكعب وجوه مشتركة.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;glm::ivec3, 6&gt; Neighbors6 = {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//right</span>
        glm::ivec3(<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//left</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment">//top</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">//bottom</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),    <span class="hljs-comment">//front</span>
        glm::ivec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)    <span class="hljs-comment">//back</span>
    };</code></pre><br>
<code>Neighbors26</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- هذه كلها جيران لها المكعب وجه أو حافة أو قمة مشتركة. </font><font style="vertical-align: inherit;">أي أنها شبكة 3x3x3 بدون مكعب مركزي. </font><font style="vertical-align: inherit;">هناك أيضًا صفائف مماثلة لمجموعات أخرى من الجيران وللمجموعات ثنائية الأبعاد من الجيران. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك مصفوفة تحدد البيانات المطلوبة لإنشاء وجه واحد للمكعب. </font><font style="vertical-align: inherit;">تتوافق اتجاهات كل وجه في هذا المصفوفة مع الاتجاهات في المصفوفة </font></font><code>Neighbors6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">array</span>&lt;FaceArray, 6&gt; NeighborFaces = {
    <span class="hljs-comment">//right face</span><font></font>
    FaceArray {<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
        glm::ivec3(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<font></font>
    },<font></font>
    ...<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وبفضل هذا ، فإن رمز إنشاء الشبكة بسيط للغاية. يتجاوز ببساطة بيانات الكتل ويضيف وجهًا عندما تكون الكتلة صلبة ، لكن جارها ليس كذلك. يفحص الرمز ببساطة كل وجه من كل مكعب في كتلة. هذا مشابه للطريقة "الساذجة" الموصوفة </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هنا</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (glm::ivec3 pos : Chunk::Positions()) {<font></font>
    Block block = chunk.blocks()[pos];<font></font>
    <span class="hljs-keyword">if</span> (block.type == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; Chunk::Neighbors6.size(); i++) {<font></font>
        glm::ivec3 offset = Chunk::Neighbors6[i];<font></font>
        glm::ivec3 neighborPos = pos + offset;<font></font>
<font></font>
        <span class="hljs-comment">//<span class="hljs-doctag">NOTE:</span> bounds checking omitted</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (chunk.blocks()[neighborPos].type == <span class="hljs-number">0</span>) {<font></font>
            Chunk::FaceArray&amp; faceArray = Chunk::NeighborFaces[i];<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; faceArray.size(); j++) {<font></font>
                m_vertexData.push_back(pos + faceArray[j]);<font></font>
                m_colorData.push_back(glm::i8vec4(pos.x * <span class="hljs-number">16</span>, pos.y * <span class="hljs-number">16</span>, pos.z * <span class="hljs-number">16</span>, <span class="hljs-number">0</span>));<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
استبدلت </font></font><code>TriangleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مع </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. أضفت أيضًا مخزنًا مؤقتًا للعمق بحيث يمكن عرض شبكة الكتلة بشكل صحيح. كان من الضروري إضافة حافة أخرى إلى الرسم البياني للعرض بين </font></font><code>TransferNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">و </font></font><code>ChunkRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. تنقل هذه الحافة ملكية موارد عائلة قائمة الانتظار بين قائمة انتظار النقل وقائمة انتظار الرسومات. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ثم قمت بتغيير المحرك حتى يتمكن من معالجة أحداث تغيير النافذة بشكل صحيح. في OpenGL ، يتم ذلك ببساطة ، ولكن بشكل مربك في فولكان. نظرًا لأنه يجب إنشاء سلسلة المخازن المؤقتة بشكل صريح ولها حجم ثابت ، عند تغيير حجم النافذة ، فأنت بحاجة إلى إعادة إنشائها. يجب إعادة إنشاء جميع الموارد التي تعتمد على سلسلة المخزن المؤقت.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يجب أن تكمل جميع الأوامر التي تعتمد على سلسلة المخزن المؤقت (والآن هذه كلها أوامر رسم) التنفيذ قبل تدمير سلسلة المخزن المؤقت القديمة. </font><font style="vertical-align: inherit;">هذا يعني أن وحدة معالجة الرسومات بالكامل ستكون خاملة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تحتاج إلى تغيير مسار الرسومات لتوفير إطار عرض ديناميكي وتغيير الحجم. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لا يمكن إنشاء سلسلة عازلة إذا كان حجم النافذة 0 على المحور س أو ص. بما في ذلك عندما يتم تصغير النافذة. </font><font style="vertical-align: inherit;">أي ، عندما يحدث هذا ، يتم إيقاف اللعبة بالكامل وتستمر فقط عندما تتكشف النافذة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن الشبكة هي رقعة شطرنج بسيطة ثلاثية الأبعاد. </font><font style="vertical-align: inherit;">يتم ضبط ألوان RGB للشبكة وفقًا لموضع XYZ مضروبًا في 16.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">متصفحك لا يدعم فيديو HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels2.webm" type="video/webm"></video></div></div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اليوم السابع</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لم أجعل عملية اللعبة واحدة ، بل عدة كتل في وقت واحد. تتم إدارة كتل متعددة وشبكاتها من قبل مكتبة ECS </font></font><code>entt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ثم قمت بإعادة تصميم جهاز عرض الكتل بحيث يتم عرض جميع الكتل الموجودة في ECS. لا يزال لدي كتلة واحدة فقط، لكنني </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يمكن</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> إضافة مواقع جديدة إذا لزم الأمر. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لقد قمت بإعادة هيكلة الشبكة بحيث يمكن تحديث بياناتها بعد إنشائها. سيسمح لي هذا بتحديث شبكة الكتلة في المستقبل عندما أضيف القدرة على إضافة المكعبات وإزالتها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند إضافة مكعب أو إزالته ، من المحتمل أن يزيد أو ينقص عدد القمم في الشبكة. لا يمكن استخدام المخزن العمودي المحدد مسبقًا إلا إذا كانت الشبكة الجديدة بنفس الحجم أو أصغر. ولكن إذا كانت الشبكة أكبر ، فيجب إنشاء مخازن جديدة للرأس.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لا يمكن حذف المخزن المؤقت الذروة السابق على الفور. قد تكون هناك مخازن تعليمات تم تنفيذها من إطارات سابقة خاصة بكائن معين </font></font><code>VkBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. يجب أن يحتفظ المحرك بمخزن مؤقت حتى تكتمل مخازن الأوامر المؤقتة هذه. أي ، إذا رسمنا شبكة في إطار </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">، يمكن لوحدة معالجة الرسومات استخدام هذا المخزن المؤقت قبل بدء الإطار </font></font><code>i + 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. لا يمكن إزالة المخزن المؤقت من وحدة المعالجة المركزية حتى ينتهي GPU من استخدامه. لذلك قمت بتغيير الرسم البياني للعرض بحيث يتتبع عمر الموارد. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا كانت عقدة عرض الرسم البياني تريد استخدام مورد (مخزن مؤقت أو صورة) ، فيجب أن تستدعي الطريقة </font></font><code>sync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">داخل الطريقة </font></font><code>preRender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. تحصل هذه الطريقة على مؤشر </font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لمورد. هذه</font></font><code>shared_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يضمن عدم حذف المورد أثناء تنفيذ المخازن المؤقتة للأوامر. </font><font style="vertical-align: inherit;">(من حيث الأداء ، هذا الحل ليس جيدًا جدًا. المزيد عن هذا لاحقًا.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن يتم إعادة إنشاء شبكة الكتل في كل إطار.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">متصفحك لا يدعم فيديو HTML5.</font></font><source src="https://vazgriz.com/wp-content/uploads/2020/01/voxels3.webm" type="video/webm"></video></div></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">استنتاج</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هذا كل ما فعلته في أسبوع - أعدت أساسيات جعل العالم مع كتل voxel متعددة وسيستمر في العمل في الأسبوع الثاني.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar487812/index.html">اختبار الطيف LED البولندي E27</a></li>
<li><a href="../ar487814/index.html">السرعة والموثوقية أعلى والسعر أقل. محركات الأقراص الصلبة Kingston KC2000 الجديدة</a></li>
<li><a href="../ar487822/index.html">AvitoTech On Tour: لقاء Android في نيجني نوفغورود</a></li>
<li><a href="../ar487824/index.html">نظرة عامة على مصابيح LED الطيف LED GU10 من أوروبا</a></li>
<li><a href="../ar487826/index.html">نظرة عامة على مصابيح LED من بولندا Spectrum Led E14</a></li>
<li><a href="../ar487834/index.html">أسبوع الأمن 07: ثغرة Android Bluetooth Stack</a></li>
<li><a href="../ar487836/index.html">تحميل تفاعلي للملفات إلى الخادم باستخدام RxJS</a></li>
<li><a href="../ar487838/index.html">التحقق من صحة البيانات: نهج مختلف</a></li>
<li><a href="../ar487842/index.html">2 بطاقة SIM لجهاز التوجيه القطري - هل هو كثير أم قليل؟</a></li>
<li><a href="../ar487844/index.html">تكشف الرائحة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>