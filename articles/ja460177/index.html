<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ„ ğŸ‡ ğŸ”° nRF52832ã€DIYãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹æ¼æ°´ã‚»ãƒ³ã‚µãƒ¼ ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ˜™ â–</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habrã®DIYã¾ãŸã¯æ—¥æ›œå¤§å·¥ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã™ã¹ã¦ã®èª­è€…ã¸ã®æŒ¨æ‹¶ï¼ä»Šæ—¥ã¯ç§ã®æ¬¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ãŠè©±ã—ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã“ã®è¨˜äº‹ã¯ãƒãƒƒãƒ†ãƒªãƒ¼é§†å‹•ã®æ¼æ°´æ¤œçŸ¥å™¨ã«ã¤ã„ã¦ã§ã™ã€‚ä»¥å‰ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒæ§˜ã«ã€ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯nRF52832ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®ã‚»ãƒ³ã‚µãƒ¼ã«ã¯3ã¤ã®ãƒãƒ¼ã‚¸ãƒ§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>nRF52832ã€DIYãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹æ¼æ°´ã‚»ãƒ³ã‚µãƒ¼</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460177/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habrã®DIYã¾ãŸã¯æ—¥æ›œå¤§å·¥ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã™ã¹ã¦ã®èª­è€…ã¸ã®æŒ¨æ‹¶ï¼</font><font style="vertical-align: inherit;">ä»Šæ—¥ã¯ç§ã®æ¬¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ãŠè©±ã—ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã“ã®è¨˜äº‹ã¯ãƒãƒƒãƒ†ãƒªãƒ¼é§†å‹•ã®æ¼æ°´æ¤œçŸ¥å™¨ã«ã¤ã„ã¦ã§ã™ã€‚</font><font style="vertical-align: inherit;">ä»¥å‰ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒæ§˜ã«ã€ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯nRF52832ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚»ãƒ³ã‚µãƒ¼ã«ã¯3ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚Šã€3ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã™ã¹ã¦nRF52832ã§äº‹å‰ã«ä½œæˆã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€HOLYIOTã®YJ-17103ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ä¸­é–“ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/jp/np/cujpnppmqhppnxx4ytplarqgfgs.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æµä½“æ¤œå‡ºå™¨ã¯ã€ãƒãƒƒãƒ—SN74LVC1G00ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ã‚·ãƒƒãƒˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å›è·¯è¨­è¨ˆã¨å‹•ä½œåŸç†ã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜ã—ã¾ã™ã€‚ã‚»ãƒ³ã‚µãƒ¼é›»æ¥µ1ç•ªã¯ã‚¢ãƒ¼ã‚¹ã«æ¥ç¶šã•ã‚Œã€ã‚»ãƒ³ã‚µãƒ¼é›»æ¥µ2ç•ªã¯SN74LVC1G00ãƒã‚¤ã‚¯ãƒ­å›è·¯ã®ãƒ¬ãƒƒã‚°AãŠã‚ˆã³Bã«100ã‚ªãƒ¼ãƒ ã®æŠµæŠ—ã‚’ä»‹ã—ã¦æ¥ç¶šã•ã‚Œã€1MæŠµæŠ—ã‚’ä»‹ã—ã¦3.3Vã‚‚ã“ã®ãƒ©ã‚¤ãƒ³ã«æ¥ç¶šã•ã‚Œã€é™é›»å®¹é‡ã‚‚å›è·¯ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚ãƒã‚¤ã‚¯ãƒ­å›è·¯Aã¨Bã®ãƒ¬ãƒƒã‚°ã§æ¶²ä½“ã¨ã®æ¥è§¦ãŒãªã„å ´åˆã€MKãƒ¬ãƒƒã‚°ã«æ¥ç¶šã•ã‚ŒãŸãƒ¬ãƒƒã‚°Yã®è«–ç†ãƒ¦ãƒ‹ãƒƒãƒˆï¼ˆçµ„ã¿è¾¼ã¿ã®ã‚³ãƒ³ãƒ‘ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä»‹ã—ã¦ä¸­æ–­ã‚’æ¤œå‡ºã™ã‚‹ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼‰ã¯ãã‚Œãã‚Œè«–ç†ã‚¼ãƒ­ã§ã™ã€‚æ¶²ä½“ã¨ã®æ¥è§¦ãŒç™ºç”Ÿã—ã¦ãƒ¬ãƒƒã‚°Aã¨BãŒä½ããªã‚‹ã¨ã™ãã«ã€SN74LVC1G00ãƒã‚¤ã‚¯ãƒ­å›è·¯ã®ãƒ¬ãƒƒã‚°Yã®ä¿¡å·ã‚‚åè»¢ã—ã€ä¸­æ–­ãŒç™ºç”Ÿã—ã€MKãŒã‚¹ãƒªãƒ¼ãƒ—çŠ¶æ…‹ã‹ã‚‰è§£é™¤ã•ã‚Œã¾ã™ã€‚å°†æ¥ã€ãƒãƒƒãƒ—SN74LVC1G00ã¯ãƒãƒƒãƒ—SN74LVC1G14ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ã‚·ãƒƒãƒˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãã—ã¦å¤šåˆ†ãã†ã§ã¯ãªã„:)å†…è”µã‚³ãƒ³ãƒ‘ãƒ¬ãƒ¼ã‚¿ã‚’ä»‹ã—ãŸMKè„šã‹ã‚‰ã®æ¶²ä½“ã®æ¤œå‡ºã¯è¨ˆç”»ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®ä»–ã®ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒæ§˜ã«ã€ã“ã‚Œã‚‚Arduinoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Šã€éå»1å¹´é–“ï¼ˆãŠã‚ˆãï¼‰ã®ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒæ§˜ã«ã€ã“ã‚Œã‚‚Mysensorsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚ä»–ã®è¨˜äº‹ã¨åŒæ§˜ã«ã€ã“ã®è¨˜äº‹ã§ã¯ãƒã‚¤ã‚»ãƒ³ã‚µãƒ¼ã®ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦å°‘ã—è§¦ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mysensorsã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºè€…ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ç„¡ç·šãŠã‚ˆã³æœ‰ç·šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å…ƒã€…Arduinoãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç”¨ã«é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚æ¨™æº–ã®Mysensorsãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ã€ã‚²ãƒ¼ãƒˆï¼ˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ï¼‰ã€å†å¤‰æ›å™¨ã€ãŠã‚ˆã³ã‚¨ãƒ³ãƒ‰ãƒ‡ãƒã‚¤ã‚¹ï¼ˆãƒãƒ¼ãƒ‰ï¼‰ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚ 1ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯ã€æœ€å¤§254å°ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚å„ãƒ‡ãƒã‚¤ã‚¹ã«ã¯ã€æœ€å¤§254å€‹ã®ã‚»ãƒ³ã‚µãƒ¼ã€ã‚»ãƒ³ã‚µãƒ¼ã€ä½œå‹•ãƒ¦ãƒ‹ãƒƒãƒˆã‚’è£…å‚™ã§ãã¾ã™ã€‚ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ“ä½œã€ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã€ãŠã‚ˆã³å¯¾è©±ã¯ã€UDã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ä¸€éƒ¨ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆMajordomoï¼‰ã¯è¤‡æ•°ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨Mysensorsï¼ˆãƒãƒ«ãƒã‚²ãƒ¼ãƒˆï¼‰ã®æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã€1ã¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§åˆ¶å¾¡ã•ã‚Œã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚ˆã‚Šã‚‚ã¯ã‚‹ã‹ã«å¤šãã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šLinux / Raspberry Pi / Orange Pi | ATMega 328P | ESP8266 | ESP32 | nRF5xï¼ˆCortex M0ã€M4ï¼‰| Arduino Zeroï¼ˆCortex M0ï¼‰ã§ä½¿ç”¨ã•ã‚Œã‚‹Atmel SAMD | Teensy3ï¼ˆMK66FX1M0VMD18ï¼‰| STM32F1ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ç„¡ç·šé€ä¿¡æ©Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šNRF24L01 | RFM69 | RFM95ï¼ˆLoRaï¼‰| nRF5x </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹æœ‰ç·šé€šä¿¡ã‚¿ã‚¤ãƒ—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šRS485 </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚²ãƒ¼ãƒˆã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼é–“ã®ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹é€šä¿¡ã‚¿ã‚¤ãƒ—</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šMQTT |ã‚·ãƒªã‚¢ãƒ«USB | Wifi |ã‚¤ãƒ¼ã‚µãƒãƒƒãƒˆ| GSM</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¼ã‚Œã‚»ãƒ³ã‚µãƒ¼ã«æˆ»ã‚Šã¾ã™ã€‚ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯ã€CR2430ã€CR2450ã€ã¾ãŸã¯CR2477ãƒãƒƒãƒ†ãƒªãƒ¼ã‚’æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚ç¡çœ æ¶ˆè²»é‡ã¯3Î¼Aæœªæº€ã§ã™ã€‚ä¼é€é€Ÿåº¦-250Kbpsã€10-15msã€‚é€ä¿¡æ™‚ã®æ¶ˆè²»é›»åŠ›ã¯8mAä»¥ä¸‹ã§ã™ã€‚ç†è«–çš„ã«ã¯ã€1ã¤ã®ãƒãƒƒãƒ†ãƒªãƒ¼ã®ãƒãƒƒãƒ†ãƒªãƒ¼å¯¿å‘½ã¯ã€ãƒãƒƒãƒ†ãƒªãƒ¼ã®è‡ªå·±æ”¾é›»æ™‚é–“ã¨ã»ã¼åŒã˜ã§ã™ã€‚å®Ÿéš›ã«ã¯ã€ã‚‚ã¡ã‚ã‚“ã€ç™»éŒ²ã€æç¤ºã€å……é›»ãƒ¬ãƒ™ãƒ«ã®å®šæœŸçš„ãªé€ä¿¡ãŒã‚ã‚‹ã®ã§ã€ã™ã¹ã¦ãŒãƒãƒ©è‰²ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€ãƒãƒƒãƒ†ãƒªãƒ¼å¯¿å‘½ã¯å€¤ã«è¿‘ããªã‚Šã¾ã™-è‡ªå·±æ”¾é›»æ™‚é–“/ 2 :)ã€‚é›»æºã¯ãƒãƒƒãƒ†ãƒªã‹ã‚‰ç›´æ¥ä¾›çµ¦ã•ã‚Œã€ãƒãƒƒãƒ†ãƒªãƒ¬ãƒ™ãƒ«ã¯VDDãƒ”ãƒ³ã‹ã‚‰ç›´æ¥åˆ¶å¾¡ã•ã‚Œã¾ã™ã€‚ã‚»ãƒ³ã‚µãƒ¼ã«ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ã‚»ãƒ³ã‚µãƒ¼ã®ç™»éŒ²ã‚’ç¤ºã—ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’ç¤ºã—ã€ãƒªãƒ¼ã‚¯æ¤œå‡ºã‚’ç¤ºã™ãŸã‚ã«ã€RGB LEDãŒå–ã‚Šä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚å½“ç„¶ã®ã“ã¨ãªãŒã‚‰ã€LEDã¯ã¾ã£ãŸãä½¿ç”¨ã•ã‚Œãªã„ã“ã¨ã‚‚ã‚ã‚Œã°ã€ä¸€éƒ¨ä½¿ç”¨ã•ã‚Œãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒã‚¤ã‚¹ãƒœãƒ¼ãƒ‰ã¯ã€LUTæ³•ã«å¾“ã£ã¦ã•ã‚‰ã«è£½é€ ã™ã‚‹ãŸã‚ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‹ã‚‰ã€ãã‚Œã¯ãƒˆãƒ©ãƒƒã‚¯ã®å¹…ã®å¢—åŠ ã€ãƒˆãƒ©ãƒƒã‚¯é–“ã®è·é›¢ã®å¢—åŠ ã€å±¤é–“ç§»è¡Œã®ãŸã‚ã®é ˜åŸŸã®å¢—åŠ ï¼ˆã‚ˆã‚Šä¾¿åˆ©ãªç©´ã‚ã‘ã®ãŸã‚ï¼‰ã€ãŠã‚ˆã³ãƒœãƒ¼ãƒ‰ã®å°ã•ãªé ˜åŸŸã®ãŸã‚ã«ç©ºã®é ˜åŸŸã‚’åŸ‹ã‚ã‚‹ã“ã¨ãŒãªã„ã“ã¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãã®å¾Œã€ç”Ÿç”£ä¸­ã®æ³¨æ–‡ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t3/nt/fl/t3ntflgy-mpiiijyx9ch2kr_dro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒã‚¤ã‚¹ã‚±ãƒ¼ã‚¹ã¯2ã¤ã®éƒ¨åˆ†ã§è¨­è¨ˆã•ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãƒœãƒ¼ãƒ‰ã‚’å–ã‚Šä»˜ã‘ã‚‹ãŸã‚ã®å ´æ‰€ã®ã‚ã‚‹ä¸Šéƒ¨ã‚«ãƒãƒ¼ã¨ã€ã‚¹ãƒãƒ¼ãƒ«è£½ã®ã‚³ãƒ³ã‚¿ã‚¯ãƒˆãƒã‚¸ç”¨ã®2ã¤ã®ç©´ï¼ˆãƒã‚¸ã®é ­ã«ã‚·ãƒªã‚³ãƒ³ã‚·ãƒ¼ãƒ©ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ä¸è¦ï¼‰ã§ä¸‹éƒ¨ï¼ˆãƒã‚¹ï¼‰ã¨ãƒœãƒ¼ãƒ‰ä¸Šã®ãƒœã‚¿ãƒ³ç”¨ã®2ã¤ã®ãƒãƒ¥ãƒ¼ãƒ–ï¼ˆãƒªã‚»ãƒƒãƒˆã¨ãƒ¢ãƒ¼ãƒ‰ï¼‰ã‚’å‚™ãˆãŸä¸‹éƒ¨ï¼ˆãƒã‚¹ï¼‰ã€‚</font><font style="vertical-align: inherit;">å°åˆ·ã¯ANICUBIC PHOTON SLA 3Dãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã§è¡Œã‚ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">å°åˆ·å¾Œã€ã‚µãƒ³ãƒ‰ãƒšãƒ¼ãƒ‘ãƒ¼320ã¨1000ã‚’å‡¦ç†ã—ã¦ã€è“‹ã¨æœ¬ä½“ã®åº•é¢ã®æ¥åˆéƒ¨ã«åˆã‚ã›ã¾ã—ãŸã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wo/6a/lp/wo6alplsifb0q1chfytor46xijm.png"><br>
<br>
<img src="https://habrastorage.org/webt/ln/as/rc/lnasrcwqmv4sp26y-e-qrjt5-n4.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚»ãƒ³ã‚µãƒ¼å†™çœŸ</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/xs/yc/ar/xsycarves23jwawofy3qaqqpux0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/sj/1i/yz/sj1iyz35chjsvv1zmvbivm3fnx4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/sj/ra/kx/sjrakx6tb17aoe6pseqgrn8ls2m.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/vx/jf/9_/vxjf9_zdw6uw3wa3nlgr6_rijdk.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bk/tl/el/bktlelcpzcd77cmrlugwyc0t_ta.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/of/ng/fh/ofngfhmlz_ax3fy-e1jajaueq0q.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/hf/cy/fa/hfcyfaxvkcrbplypfjh2wbf2wrw.jpeg"><br>
<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text">wl_standart_test.ino<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">bool</span> button_flag;
<span class="hljs-keyword">bool</span> send_flag;
<span class="hljs-keyword">bool</span> detection;
<span class="hljs-keyword">bool</span> nosleep;<font></font>
byte timer;<font></font>
<span class="hljs-keyword">bool</span> AckG;
<span class="hljs-keyword">bool</span> AckB;
<span class="hljs-keyword">bool</span> AckL;
<span class="hljs-keyword">bool</span> PRESENT_ACK;
<span class="hljs-keyword">bool</span> flag_lq;
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> SLEEP_TIME = <span class="hljs-number">172800000</span>; <span class="hljs-comment">//48 hours</span>
<span class="hljs-comment">//unsigned long SLEEP_TIME = 3600000; //1 hour</span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> oldmillis;
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> newmillis;
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> interrupt_time;
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> SLEEP_TIME_W;
<span class="hljs-keyword">uint16_t</span> currentBatteryPercent;
<span class="hljs-keyword">uint16_t</span> batteryVoltage = <span class="hljs-number">0</span>;
<span class="hljs-keyword">uint16_t</span> battery_vcc_min = <span class="hljs-number">2300</span>;
<span class="hljs-keyword">uint16_t</span> battery_vcc_max = <span class="hljs-number">3000</span>;<font></font>
<font></font>
<span class="hljs-keyword">int16_t</span> linkQuality;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_DISABLED_SERIAL</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_RADIO_NRF5_ESB</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_RF24_PA_LEVEL (NRF5_PA_MAX)</span>
<span class="hljs-comment">//#define MY_PASSIVE_NODE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_NODE_ID 86</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_PARENT_NODE_ID 0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_PARENT_NODE_IS_STATIC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MY_TRANSPORT_UPLINK_CHECK_DISABLED</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTR_PIN 3 <span class="hljs-comment">//(PORT0,  gpio 5)</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;MySensors.h&gt;</span></span>
<span class="hljs-comment">// see https://www.mysensors.org/download/serial_api_20</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> W_L_SENS_CHILD_ID 0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LINK_QUALITY_CHILD_ID 253</span>
<span class="hljs-function">MyMessage <span class="hljs-title">sensMsg</span><span class="hljs-params">(W_L_SENS_CHILD_ID, V_VAR1)</span></span>;
<span class="hljs-comment">//MyMessage voltMsg(CHILD_ID_VOLT, V_VOLTAGE);</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">preHwInit</span><span class="hljs-params">()</span> </span>{<font></font>
  pinMode(POWER_PIN, OUTPUT);<font></font>
  digitalWrite(POWER_PIN, HIGH);<font></font>
  wait(<span class="hljs-number">3000</span>);<font></font>
  pinMode(RED_LED, OUTPUT);<font></font>
  digitalWrite(RED_LED, HIGH);<font></font>
  pinMode(GREEN_LED, OUTPUT);<font></font>
  digitalWrite(GREEN_LED, HIGH);<font></font>
  pinMode(BLUE_LED, OUTPUT);<font></font>
  digitalWrite(BLUE_LED, HIGH);<font></font>
  pinMode(PIN_BUTTON, INPUT);<font></font>
  pinMode(W_L_SENS, INPUT);<font></font>
<font></font>
  <span class="hljs-comment">//pinMode(24, OUTPUT);</span>
  <span class="hljs-comment">//pinMode(20, OUTPUT);</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span>
</span>{<font></font>
  NRF_POWER-&gt;DCDCEN = <span class="hljs-number">1</span>;<font></font>
  NRF_UART0-&gt;ENABLE = <span class="hljs-number">0</span>;<font></font>
  digitalWrite(BLUE_LED, LOW);<font></font>
  sleep(<span class="hljs-number">50</span>);<font></font>
  digitalWrite(BLUE_LED, HIGH);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">presentation</span><span class="hljs-params">()</span> </span>{<font></font>
  sendSketchInfo(<span class="hljs-string">"EFEKTA ST WL Sensor"</span>, <span class="hljs-string">"1.1"</span>);<font></font>
  present(W_L_SENS_CHILD_ID, S_CUSTOM, <span class="hljs-string">"SWITCH STATUS"</span>);<font></font>
  present(LINK_QUALITY_CHILD_ID, S_CUSTOM, <span class="hljs-string">"LINK_QUALITY"</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  digitalWrite(BLUE_LED, LOW);<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
  digitalWrite(BLUE_LED, HIGH);<font></font>
  wait(<span class="hljs-number">200</span>);<font></font>
  digitalWrite(BLUE_LED, LOW);<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
  digitalWrite(BLUE_LED, HIGH);<font></font>
  lpComp();<font></font>
  detection = <span class="hljs-literal">false</span>;<font></font>
  SLEEP_TIME_W = SLEEP_TIME;<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
  sendBatteryStatus();<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
  send(sensMsg.<span class="hljs-built_in">set</span>(detection), <span class="hljs-number">1</span>);<font></font>
  wait(<span class="hljs-number">2000</span>, <span class="hljs-number">1</span>, V_VAR1);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (nosleep == <span class="hljs-number">0</span>) {<font></font>
    oldmillis = millis();<font></font>
    sleep(SLEEP_TIME_W);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (detection) {
    <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">1</span> &amp;&amp; button_flag == <span class="hljs-number">0</span> &amp;&amp; digitalRead(W_L_SENS) == <span class="hljs-number">0</span>) {
      <span class="hljs-comment">//back side button detection</span>
      button_flag = <span class="hljs-number">1</span>;<font></font>
      nosleep = <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">1</span> &amp;&amp; button_flag == <span class="hljs-number">1</span> &amp;&amp; digitalRead(W_L_SENS) == <span class="hljs-number">0</span>) {<font></font>
      digitalWrite(GREEN_LED, LOW);<font></font>
      wait(<span class="hljs-number">10</span>);<font></font>
      digitalWrite(GREEN_LED, HIGH);<font></font>
      wait(<span class="hljs-number">50</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (digitalRead(PIN_BUTTON) == <span class="hljs-number">0</span> &amp;&amp; button_flag == <span class="hljs-number">1</span> &amp;&amp; digitalRead(W_L_SENS) == <span class="hljs-number">0</span>) {<font></font>
      nosleep = <span class="hljs-number">0</span>;<font></font>
      button_flag = <span class="hljs-number">0</span>;<font></font>
      digitalWrite(GREEN_LED, HIGH);<font></font>
      lpComp_reset();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (digitalRead(W_L_SENS) == <span class="hljs-number">1</span> &amp;&amp; digitalRead(PIN_BUTTON) == <span class="hljs-number">0</span>) {
      <span class="hljs-comment">//sens detection</span><font></font>
      newmillis = millis();<font></font>
      interrupt_time = newmillis - oldmillis;<font></font>
      SLEEP_TIME_W = SLEEP_TIME_W - interrupt_time;<font></font>
      send(sensMsg.<span class="hljs-built_in">set</span>(detection), <span class="hljs-number">1</span>);<font></font>
      wait(<span class="hljs-number">3000</span>, <span class="hljs-number">1</span>, V_VAR1);
      <span class="hljs-keyword">if</span> (AckG == <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">while</span> (timer &lt; <span class="hljs-number">10</span>) {<font></font>
          timer++;<font></font>
          digitalWrite(BLUE_LED, LOW);<font></font>
          wait(<span class="hljs-number">20</span>);<font></font>
          digitalWrite(BLUE_LED, HIGH);<font></font>
          wait(<span class="hljs-number">30</span>);<font></font>
        }<font></font>
        timer = <span class="hljs-number">0</span>;<font></font>
        AckG = <span class="hljs-number">0</span>;<font></font>
        wait(<span class="hljs-number">200</span>);<font></font>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">while</span> (timer &lt; <span class="hljs-number">10</span>) {<font></font>
          timer++;<font></font>
          digitalWrite(RED_LED, LOW);<font></font>
          wait(<span class="hljs-number">20</span>);<font></font>
          digitalWrite(RED_LED, HIGH);<font></font>
          wait(<span class="hljs-number">30</span>);<font></font>
        }<font></font>
        timer = <span class="hljs-number">0</span>;<font></font>
        send(sensMsg.<span class="hljs-built_in">set</span>(detection), <span class="hljs-number">1</span>);<font></font>
        wait(<span class="hljs-number">3000</span>, <span class="hljs-number">1</span>, V_VAR1);
        <span class="hljs-keyword">if</span> (AckG == <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">while</span> (timer &lt; <span class="hljs-number">10</span>) {<font></font>
            timer++;<font></font>
            digitalWrite(BLUE_LED, LOW);<font></font>
            wait(<span class="hljs-number">20</span>);<font></font>
            digitalWrite(BLUE_LED, HIGH);<font></font>
            wait(<span class="hljs-number">30</span>);<font></font>
          }<font></font>
          timer = <span class="hljs-number">0</span>;<font></font>
          AckG = <span class="hljs-number">0</span>;<font></font>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">while</span> (timer &lt; <span class="hljs-number">10</span>) {<font></font>
            timer++;<font></font>
            digitalWrite(RED_LED, LOW);<font></font>
            wait(<span class="hljs-number">20</span>);<font></font>
            digitalWrite(RED_LED, HIGH);<font></font>
            wait(<span class="hljs-number">30</span>);<font></font>
          }<font></font>
          timer = <span class="hljs-number">0</span>;<font></font>
        }<font></font>
        lpComp_reset();<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (SLEEP_TIME_W &lt; <span class="hljs-number">60000</span>) {<font></font>
      SLEEP_TIME_W = SLEEP_TIME;<font></font>
      sendBatteryStatus();<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">//if (detection == -1) {</span><font></font>
    SLEEP_TIME_W = SLEEP_TIME;<font></font>
    sendBatteryStatus();<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MyMessage &amp; message)</span> </span>{
  <span class="hljs-keyword">if</span> (message.type == V_VAR1) {
    <span class="hljs-keyword">if</span> (message.sensor == W_L_SENS_CHILD_ID) {
      <span class="hljs-keyword">if</span> (mGetCommand(message) == <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">if</span> (message.isAck()) {<font></font>
          AckG = <span class="hljs-number">1</span>;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (message.type == I_BATTERY_LEVEL) {
    <span class="hljs-keyword">if</span> (message.sensor == <span class="hljs-number">255</span>) {
      <span class="hljs-keyword">if</span> (mGetCommand(message) == <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">if</span> (message.isAck()) {<font></font>
          AckB = <span class="hljs-number">1</span>;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (message.type == V_VAR1) {
    <span class="hljs-keyword">if</span> (message.sensor == <span class="hljs-number">255</span>) {
      <span class="hljs-keyword">if</span> (mGetCommand(message) == <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">if</span> (message.isAck()) {<font></font>
          AckL = <span class="hljs-number">1</span>;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">void</span> sendBatteryStatus() {<font></font>
  wait(<span class="hljs-number">100</span>);<font></font>
  batteryVoltage = hwCPUVoltage();<font></font>
  wait(<span class="hljs-number">20</span>);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (batteryVoltage &gt; battery_vcc_max) {<font></font>
    currentBatteryPercent = <span class="hljs-number">100</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (batteryVoltage &lt; battery_vcc_min) {<font></font>
    currentBatteryPercent = <span class="hljs-number">0</span>;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    currentBatteryPercent = (<span class="hljs-number">100</span> * (batteryVoltage - battery_vcc_min)) / (battery_vcc_max - battery_vcc_min);<font></font>
  }<font></font>
  sendBatteryLevel(currentBatteryPercent, <span class="hljs-number">1</span>);<font></font>
  wait(<span class="hljs-number">3000</span>, C_INTERNAL, I_BATTERY_LEVEL);
  <span class="hljs-keyword">if</span> (AckB == <span class="hljs-number">1</span>) {<font></font>
    AckB = <span class="hljs-number">0</span>;<font></font>
    flag_lq = <span class="hljs-number">1</span>;<font></font>
  } <span class="hljs-keyword">else</span> {  <font></font>
    sendBatteryLevel(currentBatteryPercent, <span class="hljs-number">1</span>); <font></font>
    wait(<span class="hljs-number">3000</span>, C_INTERNAL, I_BATTERY_LEVEL); 
    <span class="hljs-keyword">if</span> (AckB == <span class="hljs-number">1</span>) {<font></font>
      AckB = <span class="hljs-number">0</span>;<font></font>
      flag_lq = <span class="hljs-number">1</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment">//send(powerMsg.set(batteryVoltage), 1);</span>
  <span class="hljs-comment">//wait(2000, 1, V_VAR1);</span><font></font>
<font></font>
  <span class="hljs-comment">//sleep(10000); //</span>
  <span class="hljs-keyword">if</span> (flag_lq == <span class="hljs-number">1</span>) {<font></font>
    linkQuality = calculationRxQuality();<font></font>
    wait(<span class="hljs-number">50</span>);<font></font>
    sendSignalStrength(linkQuality, <span class="hljs-number">1</span>);<font></font>
    wait(<span class="hljs-number">2000</span>, <span class="hljs-number">1</span>, V_VAR1);
    <span class="hljs-keyword">if</span> (AckL == <span class="hljs-number">1</span>) {<font></font>
      AckL = <span class="hljs-number">0</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      sendSignalStrength(linkQuality, <span class="hljs-number">1</span>);<font></font>
      wait(<span class="hljs-number">2000</span>, <span class="hljs-number">1</span>, V_VAR1);
      <span class="hljs-keyword">if</span> (AckL == <span class="hljs-number">1</span>) {<font></font>
        AckG = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
    }<font></font>
    flag_lq = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lpComp</span><span class="hljs-params">()</span> </span>{<font></font>
  NRF_LPCOMP-&gt;PSEL = INTR_PIN;<font></font>
  NRF_LPCOMP-&gt;ANADETECT = <span class="hljs-number">1</span>;<font></font>
  NRF_LPCOMP-&gt;INTENSET = B0100;<font></font>
  NRF_LPCOMP-&gt;ENABLE = <span class="hljs-number">1</span>;<font></font>
  NRF_LPCOMP-&gt;TASKS_START = <span class="hljs-number">1</span>;<font></font>
  NVIC_SetPriority(LPCOMP_IRQn, <span class="hljs-number">15</span>);<font></font>
  NVIC_ClearPendingIRQ(LPCOMP_IRQn);<font></font>
  NVIC_EnableIRQ(LPCOMP_IRQn);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">s_lpComp</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> ((NRF_LPCOMP-&gt;ENABLE) &amp;&amp; (NRF_LPCOMP-&gt;EVENTS_READY)) {<font></font>
    NRF_LPCOMP-&gt;INTENCLR = B0100;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">r_lpComp</span><span class="hljs-params">()</span> </span>{<font></font>
  NRF_LPCOMP-&gt;INTENSET = B0100;<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> __CORTEX_M == 0x04</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NRF5_RESET_EVENT(event)                                                 \
  event = 0;                                                                   \
  (void)event</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NRF5_RESET_EVENT(event) event = 0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lpComp_reset</span> <span class="hljs-params">()</span> </span>{<font></font>
  s_lpComp();<font></font>
  detection = <span class="hljs-literal">false</span>;<font></font>
  NRF_LPCOMP-&gt;EVENTS_UP = <span class="hljs-number">0</span>;<font></font>
  r_lpComp();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//****************************** very experimental *******************************</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">sendSignalStrength</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">int16_t</span> level, <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span> ack)</span>
</span>{
  <span class="hljs-keyword">return</span> _sendRoute(build(_msgTmp, GATEWAY_ADDRESS, NODE_SENSOR_ID, C_SET, V_VAR1,<font></font>
                          ack).<span class="hljs-built_in">set</span>(level));<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int16_t</span> <span class="hljs-title">calculationRxQuality</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">int16_t</span> nRFRSSI_temp = transportGetReceivingRSSI();
  <span class="hljs-keyword">int16_t</span> nRFRSSI = <span class="hljs-built_in">map</span>(nRFRSSI_temp, <span class="hljs-number">-85</span>, <span class="hljs-number">-40</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);
  <span class="hljs-keyword">if</span> (nRFRSSI &lt; <span class="hljs-number">0</span>) {<font></font>
    nRFRSSI = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (nRFRSSI &gt; <span class="hljs-number">100</span>) {<font></font>
    nRFRSSI = <span class="hljs-number">100</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> nRFRSSI;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//****************************** very experimental *******************************</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LPCOMP_IRQHandler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
    detection = <span class="hljs-literal">true</span>;<font></font>
    NRF5_RESET_EVENT(NRF_LPCOMP-&gt;EVENTS_UP);<font></font>
    NRF_LPCOMP-&gt;EVENTS_UP = <span class="hljs-number">0</span>;<font></font>
    MY_HW_RTC-&gt;CC[<span class="hljs-number">0</span>] = (MY_HW_RTC-&gt;COUNTER + <span class="hljs-number">2</span>);<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
MyBoardNRF5.h<br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> _MYBOARDNRF5_H_</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MYBOARDNRF5_H_</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __cplusplus</span>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span><font></font>
{<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// __cplusplus</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PINS_COUNT (32u)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NUM_DIGITAL_PINS (32u)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NUM_ANALOG_INPUTS (8u)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NUM_ANALOG_OUTPUTS (8u)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN_LED1 (27)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN_LED2 (25)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN_LED3 (26)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RED_LED (PIN_LED1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GREEN_LED (PIN_LED2)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BLUE_LED (PIN_LED3)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN_BUTTON (14)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> W_L_SENS (8)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> POWER_PIN (7)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN_SERIAL_RX (12)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN_SERIAL_TX (11)</span><font></font>
<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __cplusplus</span><font></font>
}<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nRF52832ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚ˆã£ã¦ä½é›»åŠ›ãƒ¢ãƒ¼ãƒ‰ï¼ˆDC-DCãƒ¢ãƒ¼ãƒ‰ï¼‰ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ãŠã‚Šã€MCã¯å†…éƒ¨LPCOMPã‚³ãƒ³ãƒ‘ãƒ¬ãƒ¼ã‚¿ã‚’ä»‹ã—ãŸSN74LVC1G00ãƒã‚¤ã‚¯ãƒ­å›è·¯ã‹ã‚‰ã®ä¿¡å·ã«ã‚ˆã£ã¦ã‚¹ãƒªãƒ¼ãƒ—ã‹ã‚‰ã‚¦ã‚§ã‚¤ã‚¯ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‡ãƒã‚¤ã‚¹ã«ã¯ã€ãƒ‡ãƒã‚¤ã‚¹ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã€ãƒ‡ãƒã‚¤ã‚¹ã®ãƒªã‚»ãƒƒãƒˆãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®æ™‚è¨ˆãƒœã‚¿ãƒ³ã‚‚ã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒœã‚¿ãƒ³ã¯ã€æ¼ã‚Œæ¤œçŸ¥å™¨ã¨åŒã˜MKãƒ•ãƒƒãƒˆã«å·»ã‹ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¸¡æ–¹ã®ãƒ©ã‚¤ãƒ³ã¯ã‚·ãƒ§ãƒƒãƒˆã‚­ãƒ¼ãƒ€ã‚¤ã‚ªãƒ¼ãƒ‰ã§åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®ãƒãƒƒãƒ—SN74LVC1G00ã¯ä½•ã‚‚æ¶ˆè²»ã—ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ã‚­ãƒƒãƒˆã®é›»æºç®¡ç†ã¯ã€MKã®ãƒ¬ãƒƒã‚°ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¾åœ¨ã€ã“ã‚Œã‚‰ã®ã‚»ãƒ³ã‚µãƒ¼ãŒæ©Ÿèƒ½ã™ã‚‹æ¼æ°´ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®é–‹ç™ºã¯ã»ã¼çµ‚äº†ã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¼ã‚Œã‚»ãƒ³ã‚µãƒ¼ã‚’ç¤ºã™ãƒ“ãƒ‡ã‚ª</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/5jZt3NWf9GA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ï¼ˆã‚¬ãƒ¼ãƒãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€ã‚±ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒªã‚¹ãƒˆï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MYSENSORSã‚’çŸ¥ã‚ŠãŸã„ã™ã¹ã¦ã®äººãŒã„ã¤ã§ã‚‚å–œã‚“ã§ãŠæ‰‹ä¼ã„ã§ãã‚‹å ´æ‰€ï¼ˆãƒœãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€Arduino IDEã§ã®nRF5ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®æ“ä½œã€mysensorsãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®æ“ä½œã«é–¢ã™ã‚‹ãƒ’ãƒ³ãƒˆã€æ–°ã—ã„ä½œè€…ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã®è­°è«–ï¼‰ - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é›»å ±ãƒãƒ£ãƒƒãƒˆ@mysensors_rus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460163/index.html">ã©ã†ã‚„ã‚‰</a></li>
<li><a href="../ja460165/index.html">èƒŒæ™¯ï¼šé‡å­ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼æš—å·</a></li>
<li><a href="../ja460169/index.html">Rãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¯æœ€è¿‘ã€å­¦è¡“è«–æ–‡ã§æœ€ã‚‚å¼•ç”¨ã•ã‚Œã¦ã„ã‚‹éå­¦è¡“å‡ºç‰ˆç‰©ã§ã™ã€‚</a></li>
<li><a href="../ja460173/index.html">Dockerã®é–‹ç™ºã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã€‚ãƒ‘ãƒ¼ãƒˆ2-Nginx + PHP + MySql + phpMyAdmin</a></li>
<li><a href="../ja460175/index.html">ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®è¨˜å·è«–ï¼šãƒ–ãƒ©ãƒ³ãƒ‰ã«ã¨ã£ã¦ã®æ„å‘³</a></li>
<li><a href="../ja460179/index.html">LEAN + AGILE = AGILEANã¾ãŸã¯å…¨ä½“ã‚’éƒ¨åˆ†çš„ã«åé›†</a></li>
<li><a href="../ja460181/index.html">ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã¦JavaScriptã®çŸ¥è­˜ã‚’å‘ä¸Šã•ã›ã‚‹</a></li>
<li><a href="../ja460185/index.html">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã€Œäº‹æ•…åˆ¥é€Ÿå ±å‹•ç”»ã€</a></li>
<li><a href="../ja460187/index.html">ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã™ã‚‹å‰ã«æƒ³åƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚</a></li>
<li><a href="../ja460191/index.html">ãƒ©ã‚¤ãƒ³ã‚’åœæ­¢ã™ã‚‹ã‹ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒãƒ³ãƒ—ã§é€ã‚Šã¾ã™ã€‚</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>