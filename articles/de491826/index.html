<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüîß üë©üèø‚Äçüé§ üì• Bitrix Do-it-yourself-Audit üßù ü§§ ‚õ±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo alle zusammen. 
 
 Als ich nach Informationen √ºber die Protokollierung (Pr√ºfung von Ereignissen) in Bitrix suchte, gab es auf Habr nichts, den R...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bitrix Do-it-yourself-Audit</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo alle zusammen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich nach Informationen √ºber die Protokollierung (Pr√ºfung von Ereignissen) in Bitrix suchte, gab es auf Habr nichts, den Rest haben Sie etwas ausgef√ºhrt, aber wer wird es dort finden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Wissensbasis aufzuf√ºllen, habe ich beschlossen, diesen Artikel zu schreiben: Teilen Sie meine Erfahrungen und warnen Sie vor einem m√∂glichen Rechen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulierung des Problems</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meine Aufgabe war es, das einfachste Buchhaltungssystem f√ºr Werbestrukturen zu entwickeln. Gem√§√ü den Bestimmungen des Staatsvertrags sollte das System auf der Grundlage von Bitrix (Version 15) funktionieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war m√∂glich, alles auf der Seite von Bitrix zu fahren, aber ich entschied, dass es in Bezug auf den Kunden zu unehrlich w√§re, die Funktionalit√§t von Bitrix wurde maximal genutzt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzerauthentifizierung</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenspeichersystem (EAV)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dateneditor</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit Event Handler</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorbild f√ºr die Autorisierung von Benutzeraktionen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzerverwaltung</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arbeite mit Verzeichnissen</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel geht es haupts√§chlich um √úberwachungsereignisse. Ich werde auch ein wenig √ºber die Autorisierung und das Hinzuf√ºgen benutzerdefinierter Lesezeichen zur Infoblock-Aufzeichnungskarte sprechen.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audit-Ereignisse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dem entwickelten System wird die Arbeit mit Daten √ºber die API ausgef√ºhrt (Hinzuf√ºgen eines neuen Objekts zur Karte und √Ñndern seiner Koordinaten), andere Parameter des Objekts werden √ºber den Bitrix-Editor bearbeitet, da die API nicht alle Daten√§nderungsanforderungen verarbeitet, und die Pr√ºfung nur in der API nicht abgeschlossen w√§re Wir brauchen ein Audit auf der Seite von Bitrix. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist nicht so, dass ich nicht wusste, was Audit ist, aber ich muss es nicht oft schreiben. Normalerweise wird dies gel√∂st, indem die alte Version der Zeile (alte Daten) in eine separate Tabelle geschrieben wird und die Implementierung vollst√§ndig auf der DBMS-Seite durchgef√ºhrt wird. Dar√ºber hinaus haben wir gleichzeitig einen Zustand vor den √Ñnderungen und einen Zustand nach den √Ñnderungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine Pr√ºfung f√ºr DBMS-Trigger oder eine Pr√ºfung f√ºr Bitrix-Ereignisse zu schreiben, ist der Unterschied nicht gro√ü. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ereignisse zur Verarbeitung werden im Skript "</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitrix / php_interface / init.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Wenn keine Datei vorhanden ist, m√ºssen Sie diese erstellen:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">use</span> <span class="hljs-title">Topliner</span>\<span class="hljs-title">Scheme</span>\<span class="hljs-title">Logger</span>;
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">require_once</span>($_SERVER[<span class="hljs-string">'DOCUMENT_ROOT'</span>] . <span class="hljs-string">'/vendor/autoload.php'</span>);
<span class="hljs-comment">//        </span>
<span class="hljs-keyword">if</span> (!defined(<span class="hljs-string">'IBLOCK_MODULE'</span>)) {<font></font>
    define(<span class="hljs-string">'IBLOCK_MODULE'</span>, <span class="hljs-string">'iblock'</span>);<font></font>
}<font></font>
<span class="hljs-comment">//    </span>
AddEventHandler(IBLOCK_MODULE, <span class="hljs-string">'OnIBlockElementAdd'</span>,
    <span class="hljs-keyword">Array</span>(Logger::class, <span class="hljs-string">'OnAdd'</span>));
<span class="hljs-comment">//     ,  -    ,              ,   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein Beispiel f√ºr einen Handler. In meiner Implementierung gibt es mehrere davon. Der Code kann im Repository angezeigt werden. Der Link befindet sich am Ende des Artikels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Signatur der Methode zur Verarbeitung des Ereignisses f√ºr jedes Ereignis hat eine eigene, die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> speziell </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">in der Bitrix-Dokumentation</font></a><font style="vertical-align: inherit;"> oder im Deb√ºt betrachten und die Quellen betrachten (klarer </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">gesagt</font></a><font style="vertical-align: inherit;"> , alle Ereignisse und Momente des Aufrufs von Handlern k√∂nnen auch in den Quellen w√§hrend des Debuggens angezeigt werden). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier sehen wir uns mit der Tatsache konfrontiert, dass wir bei der Arbeit mit einem DBMS sowohl aktuelle (alte) Daten als auch die Daten haben, die aufgezeichnet werden (neu), und bei der Arbeit mit Bitrix entweder alte oder neue Daten haben, aber nicht wann Es wird kein Altes und Neues gleichzeitig geben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiteres Problem ist, dass es mehrere Ereignisse gibt, bevor die Daten ge√§ndert werden, und ich konnte den Unterschied zwischen ihnen nicht verstehen. In derselben Geschichte geht es um das Ausl√∂sen mehrerer Ereignisse nach dem √Ñndern der Daten. Die Augen starren auf die F√ºlle der Auswahl, tats√§chlich ist es nur eine Illusion der Auswahl.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meine bescheidene Meinung zu Bitrix</font></font></b><div class="spoiler_text"><blockquote>       ,      ,    _  ,     (       Delphi        PHP),     .<br>
<br>
           depricated       ¬´¬ª,       .<br>
<br>
  ¬´ ¬ª       ( )  ¬´¬ª (, , )  ,              .                ,         ¬´¬ª  .<br>
<br>
             ,      :)<br>
<br>
            ,            ,       ,                  ,   ,       ,     ,   ?   .<br>
</blockquote><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden des globalen Status</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Status zwischen Ereignishandlern zu speichern und zu √ºbergeben, m√ºssen globale Variablen vorhanden sein. </font><font style="vertical-align: inherit;">Globale Variablen k√∂nnen nicht √ºberarbeitet werden, daher verwende ich die statischen Eigenschaften der Klasse:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logger</span>
</span>{
    <span class="hljs-keyword">const</span> CHANGE = <span class="hljs-string">'change'</span>;
    <span class="hljs-keyword">const</span> REMOVE = <span class="hljs-string">'remove'</span>;
    <span class="hljs-keyword">const</span> CREATE = <span class="hljs-string">'create'</span>;
    <span class="hljs-keyword">const</span> UNDEFINED = <span class="hljs-string">'undefined'</span>;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $operation = <span class="hljs-built_in">self</span>::UNDEFINED;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> NO_VALUE = [];<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $fields = <span class="hljs-built_in">self</span>::NO_VALUE;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $properties = <span class="hljs-built_in">self</span>::NO_VALUE;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> $names = <span class="hljs-built_in">self</span>::NO_VALUE;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier m√ºssen Sie die Verwendung von "Feldern" und "Eigenschaften" verdeutlichen. Felder sind die Parameter, √ºber die jeder Infoblock-Datensatz verf√ºgt (Kennung, Name, Infoblock-Elternteil). Eigenschaften sind Parameter, die f√ºr Datens√§tze eines bestimmten Infoblock-Typs spezifisch sind. Im EAV-Modell sind dies Attribute und deren Werte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Namen" sind Namen von Attributen, in einem Fall haben wir Bezeichner von Attributen und Namen, in einem anderen Fall haben wir nur Bezeichner, und f√ºr einen sch√∂nen Datensatz im Journal m√ºssen wir die Namen speichern (wir k√∂nnen den Bezeichner nat√ºrlich subtrahieren, aber aus irgendeinem Grund m√∂chten Sie nicht).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Operation" ist die aktuelle Operation. F√ºr die Arbeit mit "Feldern" gibt Bitrix bestimmte Ereignisse aus. Wenn Sie mit "Eigenschaften" (Funktionen "SetPropertyValues" und "SetPropertyValuesEx") arbeiten, gibt es kein Ereignis mit der Art der Operation, es gibt ein Ereignis vor und nach dem Aufruf, aber nicht Es ist bekannt, welche Operation ausgef√ºhrt wird (Hinzuf√ºgen / Aktualisieren / L√∂schen), daher muss die Operation auch vom Handler zum Handler √ºbertragen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht habe ich es nicht herausgefunden und in Bitrix k√∂nnen Sie gleichzeitig die Werte so sehen, wie sie waren und wie sie sein werden, oder vielleicht sollte der Status vor und der Status danach separat aufgezeichnet werden, aber aus irgendeinem Grund habe ich beschlossen, dass der Protokolleintrag im Format "Eigenschaft" vorliegen sollte % name% war% value vor der √Ñnderung% =&gt; es wurde% value nach% ‚Äùund daher gibt es viele Probleme bei der Aufrechterhaltung des globalen Zustands.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feststellen, ob √Ñnderungen erforderlich sind</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seltsamerweise wird unser Handler aufgerufen, um jeden Datensatz eines Informationsblocks zu √§ndern. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher m√ºssen wir im Handler verstehen, welchen Informationsblock wir in den Parametern erhalten haben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Infoblock eines Datensatzes ist durch zwei Werte gekennzeichnet: den Infoblock selbst ('IBLOCK_ID') und seinen Abschnitt ('IBLOCK_SECTION_ID'), und die Abschnittskennung liegt manchmal im Wertearray mit dem Index 'IBLOCK_SECTION_ID' und manchmal 'IBLOCK_SECTION', also lese ich die Abschnittskennung durch beide Schl√ºssel mit Priorit√§t f√ºr 'IBLOCK_SECTION'. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dar√ºber hinaus kann in einigen Situationen die Abschnittskennung im Prinzip nicht bestimmt werden, weshalb die Notwendigkeit, einen Eintrag zum √úberwachungsprotokoll hinzuzuf√ºgen, nur auf der Grundlage der Informationsblockkennung √ºberpr√ºft werden muss.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir den Informationsblock und den Abschnitt festgelegt haben, entscheiden wir, ob das Ereignis im Journal registriert werden muss.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status vor √Ñnderungen speichern</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Infoblock-Eintrag besteht aus zwei Teilen, ein Teil besteht aus "Feldern", und diese Parameter werden durch Methoden ge√§ndert:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: Add () </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: Update () </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: Delete ()</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der andere Teil sind die "Eigenschaften" -Methoden:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: SetPropertyValues ‚Äã‚Äã()</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIBlockElement :: SetPropertyValuesEx ()</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wei√ü nicht mehr warum, aber es ist besser, CIBlockElement :: SetPropertyValuesEx () in meinem Code nicht zu verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Teil der Daten in der Ereignisbehandlungsroutine ist vom anderen getrennt. Durch Klicken auf die Schaltfl√§che "Speichern" k√∂nnen daher zwei Eintr√§ge im √úberwachungsprotokoll erstellt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Signaturen der Ereignisse f√ºr "Felder" und "Eigenschaften" sind unterschiedlich. In dem Teil mit der Verarbeitung von "Feldern" speichern wir den aktuellen Status f√ºr Felder und setzen den Wert auf Operation. In dem Teil mit der Verarbeitung von "Eigenschaften" speichern wir Eigenschaften und deren Namen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir machen das nat√ºrlich im "Vorher" -Handler.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registrierung √§ndern</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im "After" -Handler schreiben wir in das Protokoll. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Zusammenstellen einer Liste von Unterschieden in Datens√§tzen tritt ein Problem mit Attributen auf, die mehrere Werte annehmen k√∂nnen. </font><font style="vertical-align: inherit;">Das Format f√ºr die Aufzeichnung des Status "vor" und des Status "nach" unterscheidet sich so stark, dass einer den anderen nicht ableiten kann. Wenn Sie also entscheiden, ob √Ñnderungen registriert werden sollen, werden Sie immer zu dem Schluss kommen, dass eine Registrierung erforderlich ist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Quellcode des Audits im Repository in der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datei src / Topliner / Scheme / Logger.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinzuf√ºgen einer benutzerdefinierten Registerkarte zur Infoblock-Karte (im Bitrix-Klassifikator)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine Karte hinzuzuf√ºgen, wird ein √§hnlicher Ansatz wie beim Auditing verwendet - wir f√ºgen einen Handler hinzu:</font></font><br>
<br>
<pre><code class="php hljs">AddEventHandler(<span class="hljs-string">'main'</span>, <span class="hljs-string">'OnAdminIBlockElementEdit'</span>,
    <span class="hljs-keyword">Array</span>(PermitTab::class, <span class="hljs-string">'OnInit'</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der 'OnInit'-Methode definieren wir die anderen Methoden f√ºr die Arbeit mit der Registerkarte im Bitrix-Editor:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermitTab</span>
</span>{
    <span class="hljs-keyword">const</span> LINKS = <span class="hljs-string">'links'</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OnInit</span>(<span class="hljs-params">$arArgs</span>)
    </span>{<font></font>
        $permits = BitrixScheme::getPermits();<font></font>
        $pubPermits = BitrixScheme::getPublishedPermits();<font></font>
        $blockId = (<span class="hljs-keyword">int</span>)$arArgs[<span class="hljs-string">'IBLOCK'</span>][<span class="hljs-string">'ID'</span>];<font></font>
        $letShow = $blockId === $permits-&gt;getBlock()<font></font>
            || $blockId === $pubPermits-&gt;getBlock();<font></font>
        $result = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> ($letShow) {<font></font>
            $result = [<font></font>
                <span class="hljs-string">'TABSET'</span> =&gt; <span class="hljs-string">'LinksToConstructs'</span>,
                <span class="hljs-string">'GetTabs'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'GetTabs'</span>],
                <span class="hljs-string">'ShowTab'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'ShowTab'</span>],
                <span class="hljs-string">'Action'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'Action'</span>],
                <span class="hljs-string">'Check'</span> =&gt; [<span class="hljs-built_in">static</span>::class, <span class="hljs-string">'Check'</span>],<font></font>
            ];<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> $result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst √ºberpr√ºfen wir nat√ºrlich, ob wir f√ºr diesen Informationsblock unsere Benutzerregisterkarte anzeigen m√ºssen, falls erforderlich, setzen wir Methoden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier gibt es nichts Besonderes zu erz√§hlen. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie die Quellen im </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Repository src / Topliner / Scheme / PermitTab.php</font></a><font style="vertical-align: inherit;"> und lesen Sie die Dokumentation.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorbild f√ºr die Autorisierung von Benutzeraktionen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Autorisierungsmethoden von Bitrix arbeiten mit einer linearen Rechte-Skala, dh einem Szenario, in dem eine die erste und zweite, aber nicht die dritte und die andere die zweite und dritte, aber nicht die erste sein kann. Sie k√∂nnen Bitrix nicht direkt implementieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr solche kniffligen Szenarien in Bitrix wird lediglich eine Berechtigung √ºberpr√ºft, und im Code wird beim Ausf√ºhren des Vorgangs angezeigt, ob der Benutzer √ºber eine Berechtigung verf√ºgt oder nicht, und Sie erlauben die erste und zweite Rolle, und die zweite und dritte erlauben die andere Rolle.</font></font><br>
<br>
<pre><code class="php hljs">        $constSec = BitrixScheme::getConstructs();<font></font>
        $isAllow = CIBlockSectionRights::UserHasRightTo(<font></font>
            $constSec-&gt;getBlock(), $constSec-&gt;getSection(),<font></font>
            BitrixPermission::ELEMENT_ADD, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (!$isAllow) {<font></font>
            $output[<span class="hljs-string">'message'</span>] = <span class="hljs-string">'Forbidden, not enough permission;'</span>;<font></font>
        }<font></font>
</code></pre><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ constSec-&gt; getBlock () - Informationsblockkennung</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ constSec-&gt; getSection () - Abschnittskennung</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BitrixPermission :: ELEMENT_ADD - Berechtigungscode</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Klassifikator (Informationsblockverzeichnis) in den erforderlichen Informationsbl√∂cken und Abschnitten weisen Sie den Rollen die entsprechenden Rechte zu. </font><font style="vertical-align: inherit;">Verteilen Sie Rollen an Benutzer und alles wird unter Ihrer Kontrolle sein.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authentifizierung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie f√ºr einige Seiten eine Benutzerauthentifizierung ben√∂tigen, f√ºgen Sie einfach Folgendes hinzu:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>
define(<span class="hljs-string">"NEED_AUTH"</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">require</span>($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">"/bitrix/header.php"</span>);
<span class="hljs-meta">?&gt;</span><font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">require</span>($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">"/bitrix/footer.php"</span>);
<span class="hljs-meta">?&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Laden einer solchen Seite gibt Bitrix ein Anmeldeformular aus, wenn sich der Benutzer noch nicht angemeldet hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Bitrix nur in einem Skript verbinden m√ºssen, dann:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">require_once</span>($_SERVER[<span class="hljs-string">'DOCUMENT_ROOT'</span>]<font></font>
    . <span class="hljs-string">'/bitrix/modules/main/include/prolog_before.php'</span>);
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeiten Sie mit Verzeichnissen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die "neuen" Verzeichnisse (Stand November 2019) in Bitrix hei√üen "HighloadBlock", die Arbeit mit ihnen ist etwas un√ºblich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder Hyload-Block kann daher in einer separaten Tabelle gespeichert werden, um jedes Mal auf das Verzeichnis zuzugreifen, wenn Sie den Tabellennamen zum Lesen ermitteln m√ºssen. </font><font style="vertical-align: inherit;">Um dies nicht st√§ndig zu tun, m√ºssen Sie in Bitrix eine Instanz einer Klasse f√ºr den Zugriff auf Daten erstellen. </font><font style="vertical-align: inherit;">Eine Instanz wird in zwei Zeilen erstellt:</font></font><br>
<br>
<pre><code class="php hljs">CModule::IncludeModule(<span class="hljs-string">'highloadblock'</span>);<font></font>
$entity = HighloadBlockTable::compileEntity(<span class="hljs-string">'ConstructionTypes'</span>);<font></font>
$reference = $entity-&gt;getDataClass();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wobei 'ConstructionTypes' der Referenzcode ist. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Um</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
diese beiden Zeilen nicht st√§ndig zu schreiben, k√∂nnen Sie eine Klasse schreiben, die Referenzinstanzen f√ºr uns erstellt ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / Topliner / Bitrix / BitrixReference.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes arbeiten wir mit der Instanz wie mit der √ºblichen Bitrix ORM-Klasse (D7):</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $reference DataManager */</span>
$data = $reference::getList(<span class="hljs-keyword">array</span>(
    <span class="hljs-string">'select'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'UF_NAME'</span>, <span class="hljs-string">'UF_XML_ID'</span>),
    <span class="hljs-string">'filter'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'UF_TYPE_ID'</span> =&gt; <span class="hljs-number">0</span>)<font></font>
    ));<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (sorgf√§ltig, viel kopieren und einf√ºgen) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank f√ºr Ihre Aufmerksamkeit.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de491812/index.html">Tipps und Tricks zu IntelliJ IDEA: 2. Abh√§ngigkeitsanalyse</a></li>
<li><a href="../de491814/index.html">Netzwerkdiagramm als Code</a></li>
<li><a href="../de491816/index.html">[Prognose] Verkehr der Zukunft: langfristiger Horizont</a></li>
<li><a href="../de491818/index.html">Die Grundlagen einer zuverl√§ssigen Daten√ºbertragung</a></li>
<li><a href="../de491824/index.html">Liebe alle Menschen - die besten Berichte mit TeamLeadConf in 5 Minuten</a></li>
<li><a href="../de491828/index.html">DataMatrix oder wie man Schuhe richtig etikettiert</a></li>
<li><a href="../de491832/index.html">8 Pluspunkte von Flutter im Vergleich zu React Native</a></li>
<li><a href="../de491838/index.html">MIPT startet einen offenen Online-Kurs zum Thema Sportprogrammierung</a></li>
<li><a href="../de491840/index.html">Visualisierung der Arbeit von Servicemitarbeitern</a></li>
<li><a href="../de491844/index.html">Automatische Visualisierung der Testabdeckung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>