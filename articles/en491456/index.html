<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ô†Ô∏è üè≥Ô∏è‚Äçüåà ‚úåÔ∏è Remote incremental ZFS backups. Nowhere easier üë©üèΩ‚Äçü§ù‚Äçüë®üèæ ‚òØÔ∏è üíÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Secure your brother, secure ...
 ZFS 0.8 has the ability to send incremental snapshots of encrypted data without decrypting. That is, having an encryp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Remote incremental ZFS backups. Nowhere easier</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491456/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secure your brother, secure ...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZFS 0.8 has the ability to send incremental snapshots of encrypted data without decrypting. That is, having an encrypted array, you can organize a mirror copy of it on a remote machine, not trusting the owner of the remote premises. The key and decrypted data do not leave the trusted premises. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
None of my clients (microcontrollers) have more than one server room, if a fire comes there, for example, a star. Having agreed with your colleague in a dangerous admin business, you can mutually insure each other without fear that they might use the data.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any service in the form of a virtual machine is installed on Proxmox, where the data is located on ZFS, and you will always have the opportunity to store a remote copy of the virtual machine. </font><font style="vertical-align: inherit;">There is a chance that one day instead of falling into despondency, you will go to a remote room, pick up a piece of iron and run all the services in good health. </font><font style="vertical-align: inherit;">I already transferred almost all of my services to Proxmox about 2 years ago and I have no regrets, everything works fine. </font><font style="vertical-align: inherit;">On ZFS, I have a terminal server for 30 people, which is tied to thin clients (that is, 30 full-fledged jobs). </font><font style="vertical-align: inherit;">In addition to the current copy, you will also have snapshots for the last x days both locally and remotely. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, you will lose productivity from the very use of zfs and from encryption, but for myself I came to the conclusion that I was ready to pay this price for such functionality.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A spoon of tar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In tackle you immediately fly in the ointment. Yes, ZFS is slower. Essentially. But you cannot use it as a regular fs. It should work in an array of disks, where an increase in the number of disks is welcome, the disks should preferably be SAS, the controller should work in HBA mode (and not raid0 as single disks), there should be ECC RAM and it should be many, there must be one SSD (better PCI-E) as a cache for reading the second level (small, gigs from 64) and one SSD for ZIL can be very small, but preferably MLC.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regarding the SSD, I put on these recommendations and bought 2 PCI-E SSDs of 128 and each divided into 16 gigs and the rest. </font><font style="vertical-align: inherit;">I launched two 16 gigabyte partitions in ZIL as a mirror and launched the remaining parts under the second level cache as stripe. </font><font style="vertical-align: inherit;">At the mercy of zfs gave 16 gigs of opera. </font><font style="vertical-align: inherit;">(One slot on a mother bought with ebay turned out to be inoperative; if it worked, it would give 32)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the script I needed automatic notification of problems, monitoring the number of snaps at both ends and speed control. Of the scripts that fell into my hands, there were no scripts that satisfied me. Below I will give some of the scripts that I reviewed before doing this. To receive notifications by e-mail, replace my data in your send_error_to_mail () function with yours </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh help</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will show you examples of use </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh prepare</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will tell you the procedure for the preparatory actions (recommended) </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh bank / encrypted / subvol-100-disk-0 10</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will take the current snapshot and leave the last 10 snapshots </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh bank / encrypted / subvol-100-disk-0 10 Remotehost 22 10m replicator bank / rtl / subvol-100-disk-0 20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Send unencrypted data to remotehost: 22 under the user replicator with a speed of up to 10MB / s and leave 10 images on the source and 20 on the remote host </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeeper.sh bank / encrypted / subvol-100-disk-0 10 Remotehost 22 10m replicator bank / rtl / subvol -100-disk-0 20 -w the</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> same thing, but the data will be encrypted</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
zpool=<span class="hljs-variable">$1</span>
lsnaps=<span class="hljs-variable">$2</span><font></font>
<font></font>
ip=<span class="hljs-variable">$3</span>
port=<span class="hljs-variable">$4</span>
speedl=<span class="hljs-variable">$5</span>
remoteuser=<span class="hljs-variable">$6</span>
backpool=<span class="hljs-variable">$7</span>
rsnaps=<span class="hljs-variable">$8</span>
sendargs=<span class="hljs-variable">$9</span><font></font>
<font></font>
ZFSLOGDIR=~/zfskeeplogs<font></font>
<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$ZFSLOGDIR</span>"</span> ]; <span class="hljs-keyword">then</span>
    mkdir -p <span class="hljs-variable">$ZFSLOGDIR</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
NAMESNAP=`date <span class="hljs-string">"+%Y_%m_%d_%T"</span>|sed s/:/_/g`<font></font>
logfile=<span class="hljs-variable">$ZFSLOGDIR</span>/<span class="hljs-variable">$NAMESNAP</span>.<span class="hljs-built_in">log</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-title">write_to_log</span></span> ()<font></font>
{<font></font>
<span class="hljs-built_in">echo</span> `date +<span class="hljs-string">"%T"</span>`<span class="hljs-string">" <span class="hljs-variable">$1</span>"</span> &gt;&gt; <span class="hljs-variable">$logfile</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-title">log_last_command</span></span> ()<font></font>
{<font></font>
<span class="hljs-keyword">if</span> [ $? -ne 0 ]; <span class="hljs-keyword">then</span>
	    write_to_log <span class="hljs-string">"<span class="hljs-variable">$1</span> FAILED."</span>
	    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$2</span> = <span class="hljs-literal">true</span> ]; <span class="hljs-keyword">then</span>
		write_to_log <span class="hljs-string">"Script execution stops"</span>
		send_error_to_mail <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"$?"</span> <span class="hljs-string">"$*"</span>
		<span class="hljs-built_in">exit</span> 1
	    <span class="hljs-keyword">fi</span>
	<span class="hljs-keyword">else</span>
	    write_to_log <span class="hljs-string">"<span class="hljs-variable">$1</span> COMPLETED."</span>
	<span class="hljs-keyword">fi</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-title">send_error_to_mail</span></span> ()<font></font>
{<font></font>
<font></font>
Subject=`hostname`<span class="hljs-string">" ZFS backup <span class="hljs-variable">$zpool</span> missing"</span>
swaks --header <span class="hljs-string">"Subject: <span class="hljs-variable">$Subject</span>"</span> --to admin@mydomain.ru --from <span class="hljs-string">"alertbot@mydomain.ru"</span> -a LOGIN -au alertbot@mydomain.ru -ap ailPass --server mail.mydomain.ru -tls --body \
<span class="hljs-string">"<span class="hljs-variable">$Subject</span>
command: zfskeeper.sh <span class="hljs-variable">$3</span>

    <span class="hljs-variable">$1</span>
    <span class="hljs-variable">$2</span>"</span> \<font></font>
    --attach <span class="hljs-variable">$logfile</span>
<span class="hljs-comment">#    --attach-type "$(get_mimetype $logfile)" --attach $logfile</span><font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> <span class="hljs-keyword">in</span><font></font>
    1)<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-keyword">in</span><font></font>
	prepare)<font></font>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"
    Sender mashine:
    apt install swaks mbuffer
    useradd -s /bin/bash replicator
    mkdir -p /home/replicator 
    chown replicator:replicator /home/replicator
    zfs allow -u replicator send,snapshot,destroy,mount bank/encrypted
    su replicator
    ssh-keygen

    Receiver machine:
    ln -s /usr/sbin/zfs /usr/local/bin/zfs
    useradd -s /bin/bash replicator
    mkdir -p /home/replicator 
    chown replicator:replicator /home/replicator
    passwd replicator

    Sender mashine:
    ssh-copy-id -i .ssh/id_rsa.pub Remotehost
    zfs allow -u replicator compression,create,receive,destroy,mount bank/companyname

    "</span><font></font>
    ;;<font></font>
	*)<font></font>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"
    Usage:

    To show the prepare instrutions:
    zfskeeper.sh prepare

    localkeeping:
    keep last 10 snapshots of bank/encrypted/subvol-100-disk-0

    zfskeeper.sh bank/encrypted/subvol-100-disk-0 10

    remotekeeping:

    keep last 10 snapshots bank/encrypted/subvol-100-disk-0 and send it by ssh to Remotehost:22 bank/rtl/subvol-100-disk-0
    and keep last 20 copies by replicator user and limit transferspeed 10Mb/s

    zfskeeper.sh bank/encrypted/subvol-100-disk-0 10 Remotehost 22 10m replicator bank/rtl/subvol-100-disk-0 20

    If you need to send encrypted data, then you need add -w to the end of the line

    zfskeeper bank/encrypted/subvol-100-disk-0 10 Remotehost 22 10m replicator bank/rtl/subvol-100-disk-0 20 -w
    "</span><font></font>
    ;;<font></font>
    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">exit</span> 0<font></font>
    ;;<font></font>
    2)<font></font>
    <span class="hljs-built_in">echo</span> `date +<span class="hljs-string">"%T"</span>`<span class="hljs-string">" Local keeping of <span class="hljs-variable">$NAMESNAP</span> being started"</span> &gt; <span class="hljs-variable">$logfile</span><font></font>
    ;;<font></font>
    8|9)<font></font>
    <span class="hljs-built_in">echo</span> `date +<span class="hljs-string">"%T"</span>`<span class="hljs-string">" Remote keeping of <span class="hljs-variable">$NAMESNAP</span> being started"</span> &gt; <span class="hljs-variable">$logfile</span><font></font>
    ;;<font></font>
    *)<font></font>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"illegal number of parameters"</span> &gt;&amp;2
    <span class="hljs-built_in">exit</span> 1<font></font>
    ;;<font></font>
<span class="hljs-keyword">esac</span><font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-comment">####################################### Local part #######################################################</span><font></font>
<font></font>
<span class="hljs-comment"># Remove waste local snaps</span>
numsnap=`zfs list -H -o name -t snapshot -s creation|grep <span class="hljs-string">"<span class="hljs-variable">${zpool}</span>@"</span>|wc|awk <span class="hljs-string">'{ print $1 }'</span>`
<span class="hljs-built_in">let</span> MAXSNAP=numsnap-lsnaps+1 &gt;/dev/null
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$MAXSNAP</span> -gt 0 ] ; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> `zfs list -H -o name -t snapshot -s creation| grep <span class="hljs-string">"<span class="hljs-variable">${zpool}</span>@"</span>|/usr/bin/head -n<span class="hljs-string">"<span class="hljs-variable">$MAXSNAP</span>"</span>`; <span class="hljs-keyword">do</span>
        zfs destroy <span class="hljs-variable">${d}</span>
        log_last_command <span class="hljs-string">"Remove local snapshot <span class="hljs-variable">$d</span>"</span>
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment"># Create fresh local snap</span>
zfs snapshot <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span>
log_last_command <span class="hljs-string">"Create local <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span>"</span> <span class="hljs-literal">true</span><font></font>
<font></font>
<span class="hljs-comment">####################################### Local part #######################################################</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$backpool</span>"</span> ]; <span class="hljs-keyword">then</span>
    write_to_log <span class="hljs-string">"Local keeping is complete"</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment">####################################### Remote part #######################################################</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment"># Check remote address</span>
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$ip</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> ping -c 1 <span class="hljs-variable">$ip</span> &gt; null ; <span class="hljs-keyword">then</span>
            sship=<span class="hljs-string">"ssh -c aes128-ctr -p"</span><span class="hljs-variable">$port</span><span class="hljs-string">" -l"</span><span class="hljs-variable">$remoteuser</span><span class="hljs-string">" "</span><span class="hljs-variable">$ip</span>
    <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"URL <span class="hljs-variable">$ip</span> is not accesiible, abort"</span>
            send_error_to_mail <span class="hljs-string">"Try to ping remote host"</span> <span class="hljs-string">"URL <span class="hljs-variable">$ip</span> is not accesiible, abort"</span> <span class="hljs-string">"$*"</span>
            <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-comment"># Remote backup is unnecessary</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment"># Remove waste local snaps</span>
numsnap=`<span class="hljs-variable">$sship</span> zfs list -H -o name -t snapshot -s creation|grep <span class="hljs-string">"<span class="hljs-variable">${backpool}</span>@"</span>|wc|awk <span class="hljs-string">'{ print $1 }'</span>`
<span class="hljs-built_in">let</span> MAXSNAP=numsnap-rsnaps+1 &gt;/dev/null
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$MAXSNAP</span> -gt 0 ] ; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> `<span class="hljs-variable">$sship</span> zfs list -H -o name -t snapshot -s creation| grep <span class="hljs-string">"<span class="hljs-variable">${backpool}</span>@"</span>|/usr/bin/head -n<span class="hljs-string">"<span class="hljs-variable">$MAXSNAP</span>"</span>`; <span class="hljs-keyword">do</span>
        <span class="hljs-variable">$sship</span> zfs destroy <span class="hljs-variable">${d}</span>
        log_last_command <span class="hljs-string">"Remove local snapshot <span class="hljs-variable">$d</span>"</span>
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment"># Receive last remote snap</span>
MOST_SLAVE_SNAP_NAME=`<span class="hljs-variable">$sship</span> zfs list -H -o name -t snapshot -s creation|grep <span class="hljs-string">"<span class="hljs-variable">$backpool</span>@backup"</span>|tail -n1|awk -F <span class="hljs-string">"@"</span> <span class="hljs-string">'{print $2}'</span>`<font></font>
<font></font>
<span class="hljs-comment"># If localbackup has same snap then send incremental copy. If has't then send full</span>
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"`zfs list -H -o name -t snapshot -s creation|grep -w "</span><span class="hljs-variable">$zpool</span>@<span class="hljs-variable">$MOST_SLAVE_SNAP_NAME</span><span class="hljs-string">"`"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment">#zfs send $sendargs -i $MOST_SLAVE_SNAP_NAME $zpool@backup_$NAMESNAP | pv -L $speedl | $sship zfs receive -vF $backpool@backup_$NAMESNAP &amp;&gt;&gt; $logfile</span>
    zfs send <span class="hljs-variable">$sendargs</span> -i <span class="hljs-variable">$MOST_SLAVE_SNAP_NAME</span> <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span> | mbuffer -q -v 0 -s 128k -m 1G | pv -L <span class="hljs-variable">$speedl</span> | <span class="hljs-variable">$sship</span> <span class="hljs-string">"mbuffer -q -v 0 -s 128k -m 1G | zfs receive -vF <span class="hljs-variable">$backpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span>"</span> &amp;&gt;&gt; <span class="hljs-variable">$logfile</span>
    log_last_command <span class="hljs-string">"Sending incremental backup to the remote machine"</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-comment">#If backpool exist we remove it. You can rename it</span>
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"`<span class="hljs-variable">$sship</span> zfs list -H -o name -s creation|grep -w "</span><span class="hljs-variable">$backpool</span><span class="hljs-string">"`"</span> ]; <span class="hljs-keyword">then</span>
	<span class="hljs-comment">#$sship zfs rename -p $backpool `$sship zfs list -H -o name|grep -w "$backpool"|awk -F "/" '{print $1}'`/old_$NAMESNAP</span>
	<span class="hljs-variable">$sship</span> zfs destroy -r <span class="hljs-variable">$backpool</span> 2&gt;&gt; <span class="hljs-variable">$logfile</span>
	log_last_command <span class="hljs-string">"Need to destroy remotepool for full sending <span class="hljs-variable">$backpool</span>"</span> <span class="hljs-literal">true</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-comment">#zfs send $sendargs $zpool@backup_$NAMESNAP | pv -L $speedl | $sship zfs receive -vF $backpool &amp;&gt;&gt; $logfile</span>
    zfs send <span class="hljs-variable">$sendargs</span> <span class="hljs-variable">$zpool</span>@backup_<span class="hljs-variable">$NAMESNAP</span> | mbuffer -q -v 0 -s 128k -m 1G | pv -L <span class="hljs-variable">$speedl</span> | <span class="hljs-variable">$sship</span> <span class="hljs-string">"mbuffer -q -v 0 -s 128k -m 1G | zfs receive -vF <span class="hljs-variable">$backpool</span>"</span> &amp;&gt;&gt; <span class="hljs-variable">$logfile</span><font></font>
<font></font>
    log_last_command <span class="hljs-string">"Sending full backup to the remote machine"</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">####################################### Remote part #######################################################</span><font></font>
<font></font>
write_to_log <span class="hljs-string">"Remote keeping is complete"</span>
<span class="hljs-built_in">exit</span> 0</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfskeepall.sh</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to keep toned several sections, you need a control script. </font><font style="vertical-align: inherit;">Everyone can already make it to their taste and color, depending on the configuration. </font><font style="vertical-align: inherit;">My test looks like this:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span><font></font>
scriptpath=/home/replicator/zfskeeper.sh<font></font>
<span class="hljs-variable">$scriptpath</span> bank/encrypted/subvol-100-disk-0 5 RemoteHost 22 30m replicator bank/rtl/subvol-100-disk-0 5 -w
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existing solutions</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I found it first, based on it I checked the overall operability of the mechanism. </font><font style="vertical-align: inherit;">Thanks to the authors, but the writing style is rather dirty, it had to be rewritten unambiguously. </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zfs-auto-snapshot.sh is just a block. </font><font style="vertical-align: inherit;">There is something to borrow, beautiful, neat, but bulky and </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">low- </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">functional </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">zfsbackup.sh - also a neat, but</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
low- </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">functional</font></a><font style="vertical-align: inherit;"> PS I bit the zfs from the third time, each time it nibbled for about a month. </font><font style="vertical-align: inherit;">I could not get her to work quickly, and to the fullest failed. </font><font style="vertical-align: inherit;">In general, the situation changed after installing SAS disks (at least 7200, at least NL). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peace for everyone! </font><font style="vertical-align: inherit;">Thank you for reading!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en491442/index.html">Food Design Digest, February 2020</a></li>
<li><a href="../en491444/index.html">Using variables in Azure DevOps pipelines</a></li>
<li><a href="../en491446/index.html">How to ‚Äúhack‚Äù RedBull</a></li>
<li><a href="../en491448/index.html">Using the FuzzyWuzzy library for fuzzy comparisons in Python. Levenshtein Distance (editorial distance)</a></li>
<li><a href="../en491454/index.html">Linux NVMe rig</a></li>
<li><a href="../en491458/index.html">Girls at tech, Ozon Tech</a></li>
<li><a href="../en491460/index.html">Reverse Engineering Brain. Memory</a></li>
<li><a href="../en491462/index.html">Weekend Read: 12 podcasts, sunset era FM radio stations and meditation apps</a></li>
<li><a href="../en491470/index.html">How to protect your assets during stock market corrections?</a></li>
<li><a href="../en491476/index.html">MEMS accelerometers, magnetometers and orientation angles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>