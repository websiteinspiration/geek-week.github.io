<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌🏿 🙅🏾 📙 PHPバックエンドのCodeceptionテスト 🕵🏿 🚟 👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは！私はパシャと申します。ラモダの注文処理チームのQAエンジニアです。最近、PHP Badoo Meetupで講演しました。今日は私のレポートの筆記録を提供したいと思います。
 
 Codeceptionについて、Lamodaでの使用方法、およびテストの作成方法について説明します。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PHPバックエンドのCodeceptionテスト</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/452136/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みなさん、こんにちは！</font><font style="vertical-align: inherit;">私はパシャと申します。ラモダの注文処理チームのQAエンジニアです。</font><font style="vertical-align: inherit;">最近、PHP Badoo Meetupで講演しました。</font><font style="vertical-align: inherit;">今日は私のレポートの筆記録を提供したいと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codeceptionについて、Lamodaでの使用方法、およびテストの作成方法について説明します。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/rg1h7mJrU7Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラモダには多くのサービスがあります。ユーザー、サイトのユーザー、モバイルアプリケーションと直接やり取りするクライアントサービスがあります。それらについては触れません。そして、当社がディープバックエンドと呼んでいるものがあります。これらは、ビジネスプロセスを自動化するバックオフィスシステムです。これらには、配達、倉庫、写真スタジオの自動化、コールセンターが含まれます。これらのサービスのほとんどはPHPで開発されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのスタックについて簡単に言えば、これはPHP + Symfonyです。 Zend'eのあちこちにある古いプロジェクト。 PostgreSQLとMySQLはデータベースとして使用され、RabbitまたはKafkaはメッセージングシステムとして使用されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜPHPバックエンドなのか？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らは通常、分岐の多いAPIを持っているため、それはいずれかのRESTであり、場所によってはSOAPが少しあります。 UIがある場合、これは内部ユーザーが使用するより補助的なUIです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lamodaで自動テストが必要なのはなぜですか？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、私がラモダで働くようになったとき、そのようなスローガンがありました：「手動回帰を取り除こう」。</font><font style="vertical-align: inherit;">手動による回帰テストは行いません。</font><font style="vertical-align: inherit;">そして、私たちはこの仕事に取り組みました。</font><font style="vertical-align: inherit;">実際、これが自動テストを必要とする主な理由の1つです。手動で回帰を行わないようにするためです。</font><font style="vertical-align: inherit;">なぜ私たちはこれが必要なのですか？</font><font style="vertical-align: inherit;">すぐに解放する権利。</font><font style="vertical-align: inherit;">そのため、リリースをスムーズに展開し、同時にセルフテストから何らかの種類のグリッドを提供して、良いか悪いかを教えてくれます。</font><font style="vertical-align: inherit;">これらはおそらく最も重要な目標です。</font><font style="vertical-align: inherit;">しかし、いくつかの補助的なものがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜ自動テストが必要なのですか？</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手で回帰をテストしないでください</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クイックリリース</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントとして使用</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新入社員のオンボーディングをスピードアップ</font></font></li>
<li>   (  )   .     , ,   ,   ,  ,      ,      —  ,   , —   .    ,   ,   .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
わかりました、なぜオートテストが必要なのか話しました。次に、Lamodaでどのようなテストを作成するかについて説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/ci/0f/qxci0fma8tivrntsz95gv-d802e.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、一部のビジネスチェーンが既にテストされている単体テストからE2Eテストまで、かなり標準的なテストピラミッドです。下の2つのレベルについては説明しません。そのような白い色で塗りつぶされているのは、当然です。これらはコード自体のテストであり、開発者によって書かれています。テスターは、極端な場合、プルリクエストに進み、コードを見て、「ここでは、十分ではないケースがあります。別のケースをカバーしましょう」と言います。これで、これらのテストに対するテスターの作業が完了します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者とテスターに​​よって書かれた上記のレベルについて話します。システムテストから始めましょう。これらは、API（RESTまたはSOAP）のテスト、一部の内部システムロジックのテスト、さまざまなコマンド、Rabbitのキューの解析、または外部システムとの交換を行うテストです。原則として、これらのテストは非常にアトミックです。チェーンはチェックしませんが、1つのアクションをチェックします。たとえば、1つのAPIメソッドまたは1つのコマンド。そして、ポジティブとネガティブの両方で、できるだけ多くのケースをチェックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さあ、E2Eテスト。二つに分けました。一連のUIとバックエンドをテストするテストがあります。また、フローテストと呼ばれるテストもあります。彼らはチェーンをテストします-最初から最後までオブジェクトの寿命。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、注文の処理管理システムがあります。このようなシステムの内部には、テスト（作成から配信までの順序、つまりすべてのステータスを通過させる）があります。システムがどのように機能するかを監視することは非常に簡単で簡単なことです。特定のオブジェクトのフロー全体がすぐにわかります。これはすべての外部システムとどのように相互作用し、このためにどのコマンドが使用されるかを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このUIは内部ユーザーが使用しているため、ブラウザー間のアクセスは重要ではありません。ファームでこれらのテストを実行することはありません。1つのブラウザーでチェックインするだけで十分です。ブラウザーを使用する必要がない場合もあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「なぜテストの自動化にCodeceptionを選んだのですか？」 -あなたはおそらく尋ねます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正直なところ、この質問には答えられません。</font><font style="vertical-align: inherit;">私がラモダに来たとき、Codeceptionはすでにオートテストを書くための標準として選択されていて、実際それを見つけました。</font><font style="vertical-align: inherit;">しかし、このフレームワークをしばらく使用した後も、なぜCodeceptionなのかを理解しました。</font><font style="vertical-align: inherit;">これは私があなたと共有したいことです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜコードセプション？</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あらゆる種類（ユニット、機能、受け入れ）の同じテストを作成して実行できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの熊手はすでに解決されており、多くのモジュールがすでに書かれています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのプロジェクトで、わずかに異なるニーズにもかかわらず、テストは同じに見えます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codeceptionの概念は、このフレームワーク（ユニット、統合、機能、受け入れ）でテストを書くことを示唆しています。</font><font style="vertical-align: inherit;">そして、あなたは、少なくとも、それらは等しく起動されます。</font></font></li>
<li>Codeception —    ,      ,  ,    .  -  ,   ,   -  —    -  .     -     ,   -.      Codeception     .</li>
<li>    (,      ,       ) —       - .   .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの人が協力していたので、Codeceptionがどのようなものかを簡単に説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/ac/nt/bpacntwtc_xvl52su3nh7-vvidi.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codeceptionは俳優モデルで動作します。プロジェクトにドラッグして初期化すると、そのような構造が生成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に、ymlファイルがあります。- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">functional.suite.yml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">integration.suit.yml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unit.suite.yml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。テストの構成を作成します。これらの試験は存在テストの種類ごとにお父さんがあり、3人の補助パパがある：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
_ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -テスト・データに対する、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
_ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -レポートが配置される場所（xml、html）; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
_ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポート</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-いくつかの補助的なヘルパー、関数、そしてあなたが書いたすべてのものがテストで使用される場所。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Codeceptionから何を取得して、何も変更せず、追加のタスクや問題を解決せずにそのまま使用できることを説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準モジュール</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phpbrowser</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残り</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Db</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AMQP</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような最初のモジュールはPhpBrowserです。このモジュールは、アプリケーションを操作するためのGuzzleのラッパーです。ページを開いたり、フォームに記入したり、フォームを送信したりできます。また、ブラウザー間およびブラウザーのテストを気にしない場合、突然UIをテストする場合は、PhpBrowserを使用できます。原則として、UIテストで使用します。複雑なインタラクションロジックは必要ないため、ページを開いてそこで小さなことを行うだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用する2番目のモジュールはRESTです。その名前が彼のしていることをはっきりさせていると思います。すべてのhttp対話では、このモジュールを使用できます。ヘッダー、Cookie、認証など、ほとんどすべてのやり取りが解決されているようです。必要なものがすべて入っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに使用できる3番目のモジュールはDbモジュールです。 Codeceptionの最近のバージョンでは、1つではなくいくつかのデータベースのサポートがそこに追加されました。したがって、プロジェクトに突然複数のデータベースが存在する場合でも、すぐに機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cliモジュール。これにより</font><font style="vertical-align: inherit;">、テストから</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シェル</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bash</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">を実行できます</font><font style="vertical-align: inherit;">。また、それを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロトコルに基づくメッセージブローカーと連携するAMQPモジュールがあります。 RabbitMQで正式にテストされていることに注意してください。私たちはRabbitMQを使用しているので、彼には何の問題もありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、少なくとも私たちの場合、Codeceptionは、必要なすべてのタスクの80〜85％をカバーしています。しかし、私はまだ何かに取り組む必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SOAPから始めましょう。</font></font><br>
<img src="https://habrastorage.org/webt/c9/zy/bk/c9zybkm3eu-kvkxc_uvpcte_h0u.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのサービスでは、いくつかの場所にSOAPエンドポイントがあります。彼らはテストされ、引っ張られ、何かをする必要があります。しかし、Codeceptionには、リクエストを送信し、その回答で何かを行うことができるモジュールがあると言うでしょう。どういうわけか、解析し、チェックを追加し、すべてがOKです。ただし、SOAPモジュールは、複数のSOAPエンドポイントがある状態では機能しません。</font></font><br>
<img src="https://habrastorage.org/webt/uj/s_/zv/ujs_zvshqpzmecycdggm3mys4nq.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、いくつかのWSDL、いくつかのSOAPエンドポイントを持つモノリスがあります。つまり、Codeceptionモジュールでは、ymlファイルでこれを構成して、複数で動作できるようにすることは不可能です。</font></font><br>
<img src="https://habrastorage.org/webt/uc/z-/ab/ucz-abgapgah_r9qo6uoitkstg8.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codeceptionには動的なモジュール再構成があり、SOAPモジュールなどを受信して​​動的に再構成するために、ある種のアダプターを作成できます。この場合、エンドポイントと使用するスキームを置き換える必要があります。次に、テストで、リクエストの送信先となるエンドポイントを変更する必要がある場合は、アダプターを取得して新しいエンドポイントに変更し、新しい回路に変更してリクエストを送信します。</font></font><br>
<img src="https://habrastorage.org/webt/68/iu/kl/68iuklk2oherxt4ov7odgrszyli.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codeceptionでは、Kafkaとの連携はなく、Kafkaと連携するサードパーティの多かれ少なかれ公式のアドオンはありません。心配することは何もありません。モジュールを作成しました。</font></font><br>
<img src="https://habrastorage.org/webt/es/gp/eg/esgpegswio_kwmtqer7gkqvjfgi.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、ymlファイルで構成されます。一部の設定は、ブローカー、コンシューマー、およびトピックに対して設定されます。これらの設定は、モジュールを作成するときに、initialize関数を使用してモジュールにプルし、同じ設定でこのモジュールを初期化できます。そして、実際には、モジュールは実装する他のすべてのメソッドを持っています-トピックにメッセージを入れて、それを読んでください。このモジュールで必要なのはこれだけです。</font></font><br>
<img src="https://habrastorage.org/webt/zo/5p/bo/zo5pbox8a8xxic2n8972phohhd0.jpeg" alt="画像"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Codeceptionのモジュールは簡単に作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
進め。先ほど述べたように、CodeceptionにはCliモジュール（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シェル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドの</font><font style="vertical-align: inherit;">ラッパー</font><font style="vertical-align: inherit;">とその出力の操作）があります。</font></font><br>
<img src="https://habrastorage.org/webt/8c/gg/yr/8cggyrxinincflxsx2ti3o4klwq.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、時には</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シェル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-チームはテストではなくアプリケーションで実行する必要があります。一般に、テストとアプリケーションは少し異なるエンティティであり、異なる場所に存在する可能性があります。テストは1つの場所で実行でき、アプリケーションは別の場所で実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、なぜ</font><font style="vertical-align: inherit;">テストで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シェル</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を実行する必要があるの</font><font style="vertical-align: inherit;">でしょうか。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、RabbitMQのキューを解析し、ステータスごとにオブジェクトを移動するコマンドがアプリケーションにあります。プロモードのこれらのコマンドは、スーパーバイザの下から起動されます。スーパーバイザはその実装を監視します。それらが落ちた場合、彼はそれらを再び起動し、以下同様に続きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テスト時には、スーパーバイザは実行されていません。そうしないと、テストが不安定になり、予測できなくなります。私たち自身が、アプリケーション内でこれらのコマンドの起動を制御したいと考えています。したがって、これらのコマンドをアプリケーションのテストから実行する必要があります。 2つのオプションを使用します。その1つ、もう1つ-原則として、すべてが同じで、すべてが機能します。</font><font style="vertical-align: inherit;">アプリケーションで</font><i><font style="vertical-align: inherit;">シェル</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を実行する方法は</font><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">
まず、アプリケーションと同じ場所でテストを実行します。 Dockerにあるすべてのアプリケーションのため、サービス自体が配置されているのと同じコンテナーでテストを実行できます。</font><font style="vertical-align: inherit;">
第二の選択肢：テストのための別個の容器、いくつか作る</font><i><font style="vertical-align: inherit;">のテストランナーを</font></i><font style="vertical-align: inherit;">、しかし、アプリケーションと、それは同じにします。つまり、同じDockerイメージから、すべてが同様に機能します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<img src="https://habrastorage.org/webt/wm/hw/g0/wmhwg0-0xviw0be73xgrwfppsfi.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストで遭遇したもう1つの問題は、さまざまなファイルシステムでの作業です。</font><font style="vertical-align: inherit;">以下は、何を処理できるか、およびどのように処理する必要があるかの例です。</font><font style="vertical-align: inherit;">最初の3つは私たちに関係があります。</font><font style="vertical-align: inherit;">これらは、Webdav、SFTP、Amazonファイルシステムです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何と連携する必要がありますか？</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webdav</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP / SFTP</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS S3</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地元</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Azure、Dropbox、googleドライブ</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codeceptionを掘り下げると、ほぼすべての一般的なファイルシステム用のモジュールが見つかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/84/kr/ol/84krold4wqwi4ckxe4trmr8u9oq.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が見つけなかった唯一のものはWebdavのためのものです。しかし、これらのファイルシステムのプラスまたはマイナスは、外部の作業に関しては同じであり、同じように作業したいと考えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flysystemというモジュールを作成しました。それは上に位置し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Githubの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SFTPおよびWebDAV - -パブリックドメインと支援2つのファイルシステムで、あなたは同じAPIを使用して、両方を操作できます。</font></font><br>
<img src="https://habrastorage.org/webt/5a/w5/sm/5aw5smemb1fabsbsyvt5eit70r8.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルのリストの取得、ディレクトリのクリーンアップ、ファイルの書き込みなどを行います。 Amazonファイルシステムもそこに追加すれば、私たちのニーズは確実にカバーされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のポイントは、自動テスト、特にシステムレベルでデータベースを操作するために非常に重要だと思います。</font><font style="vertical-align: inherit;">一般的には、図のようになりたい-VZHUHとすべてが起動し、動作します。これらのデータベースは、テストでのサポートが少ないはずです。</font></font><br>
<img src="https://habrastorage.org/webt/hb/-y/ul/hb-yulyfmetwazoatr4oukazpli.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私がここで見る主なタスクは何ですか：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的の構造のデータベースをロールアウトする方法-Db</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースにテストデータを入力する方法-Db、フィクスチャ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択とチェックの方法-Db</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codeceptionの3つのタスクすべてに、2つのモジュールがあります-私がすでに話したDb、もう1つはFixturesと呼ばれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの2つのモジュールと3つのタスクのうち、3番目のタスクにはDBのみを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のタスクでは、DBを使用できます。</font><font style="vertical-align: inherit;">そこで、データベースの展開元となるSQLダンプ、およびフィクスチャを備えたモジュールを構成できます。これが必要な理由は明らかだと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースに永続化できる配列形式のフィクスチャがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先ほど述べたように、最初の2つのタスクは少し異なる方法で解決します。次に、その方法を説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースの配置</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQLまたはMySQLでコンテナを上げる</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">教義の移行ですべての移行をロールバックします</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つ目は、データベースの展開です。これはテストでどのように発生しますか。その後、使用して必要なすべての移行をロール、PostgreSQLやMySQLのどちらか-私たちは、目的のデータベースの入った容器を持ち上げ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">教義の移行を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。すべて、目的の構造のデータベースの準備ができており、テストで使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
湿気を使用しない理由-湿気をサポートする必要がないため。これは、テストにある一種のダンプであり、データベースで何かが変更された場合は常に更新する必要があります。移行があります-ダンプを維持する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のポイントは、テストデータの作成です。 CodeceptionのFixturesモジュールは使用しません</font><font style="vertical-align: inherit;">。フィクスチャに</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Symfony</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バンドル</font><font style="vertical-align: inherit;">を使用し</font><font style="vertical-align: inherit;">ます。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ここにリンク</font></a></font><br>
<img src="https://habrastorage.org/webt/kx/lf/m9/kxlfm9zppbdqmgj_i_ekaripjw4.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
があり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースとフィクスチャーを作成する方法の例について説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィクスチャはドメインのオブジェクトとして作成され、データベースに保存でき、テストデータが準備されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜDoctrineFixtureBundleなのですか？</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関連オブジェクトのチェーンを簡単に作成できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるテストのフィクスチャが類似している場合、データの重複が少なくなります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースの構造を変更する際の編集が少なくなります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィクスチャークラスは配列よりもはるかに視覚的です。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜそれを使用するのですか？はい、同じ理由で-これらのフィクスチャは、Codeceptionのフィクスチャよりも保守がはるかに簡単です。すべてがsymfonyバンドルに含まれているため、関連オブジェクトのチェーンを作成する方が簡単です。フィクスチャは継承できるため、複製する必要のあるデータは少なく、これらはクラスです。データベース構造が変更された場合、これらの配列は常に編集する必要があり、クラスは常に編集する必要はありません。ドメインオブジェクトの形式のフィクスチャは、配列よりも常に目立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースについてお話しましたが、モキについて少しお話しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらはシステム全体をテストする十分に高いレベルのテストであり、システムが高度に相互接続されているため、いくつかの交換と相互作用があることは明らかです。ここで、システム間の相互作用についてのMokeyについて説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mokのルール</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての外部httpサービスインタラクションを泣かせる</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポジティブなシナリオだけでなく、ネガティブなシナリオもチェック</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
相互作用は、いくつかのRESTまたはSOAP http相互作用です。</font><font style="vertical-align: inherit;">私たちが濡らしているテストのフレームワーク内のこれらすべての相互作用。</font><font style="vertical-align: inherit;">つまり、私たちのテストでは、どこの外部システムにも本当の魅力はありません。</font><font style="vertical-align: inherit;">これにより、テストが安定します。</font><font style="vertical-align: inherit;">外部サービスは機能する可能性がありますが、機能しない場合があります。応答が遅くなる場合があります。一般的に、その動作がわからない場合があります。</font><font style="vertical-align: inherit;">したがって、すべてをモックで覆います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちにもそのようなルールがあります。</font><font style="vertical-align: inherit;">私たちはポジティブな相互作用だけでなく、いくつかのネガティブなケースをチェックしようとしています。</font><font style="vertical-align: inherit;">たとえば、サードパーティのサービスが500番目のエラーで応答したり、より意味のあるエラーを生成したりする場合、すべてをチェックしようとします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはモックにWiremockを使用していますが、Codeception自体がサポートしています...どのように機能しますか？</font></font><br>
<br>
<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wiremockはテスト中に別のDockerコンテナーとして発生し、外部システムに送信する必要があるすべてのリクエストはWiremockに送信されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n9/cb/y8/n9cby8a1hoiicw5fqprvzsfxsae.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワイヤモック、スライドを見ると、リクエストマッピングというボックスがあります。このようなマッピングのセットがあり、そのようなリクエストがあった場合は、そのような答えを出す必要があると言っています。すべてが非常に簡単です：リクエストが来ました-モックを受け取りました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モックは静的に作成できます。コンテナは、Wiremockがすでに上昇している場合、これらのモックが利用可能になり、手動テストで使用できます。ある種のテストでは、コード内で動的に作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モックを動的に作成する方法の例を次に示します。説明は非常に宣言的であり、作成しているモックの種類はコードからすぐにわかります。そのようなURLに到達するGETメソッドのモックと、実際には何を返すかです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d7/xu/2g/d7xu2gg75_-vjff1ejruhj2dvba.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このモックを作成できるという事実に加えて、Wiremockには、このモックに送信されたリクエストを確認する機会があります。これはテストでも非常に役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Codeception自体について、おそらくすべて、そしてテストの実行方法についての簡単な説明と、少しのインフラストラクチャーについて。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何を使用していますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qy/my/hj/qymyhjaocwm0apzi7orjlot7hnw.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Dockerにあるすべてのサービスなので、テスト環境を起動すると適切なコンテナーが発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Makeは内部コマンドに使用され、BambooはCIとして使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CIテスト実行はどのように見えますか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hb/iq/jf/hbiqjftacif8wg-67x666c7l5yc.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、目的のバージョンのアプリケーションを構築し、次に環境を上げます。これはアプリケーションであり、必要なすべてのサービス（Kafka、Rabbit、データベースなど）であり、データベースへの移行をロールバックします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このすべての環境は、Docker Composeの助けを借りて提起されています。すべてのコンテナがKubernetesの下でスピンするのは、製品版のCIです。次に、テストを実行して実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どれくらい時間がかかりますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはすべて特定のサービスに依存しますが、原則として、テストを実行する前に環境を上げるのは5〜10分で、テストは6〜30分です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nm/kh/n0/nmkhn0sdps-qtoowra4mrtgtu8m.jpeg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのテストが1つのスレッドで実行されている間、この質問にすぐに警告します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、そのような質問。テストはどのくらいの頻度で実行する必要がありますか？もちろん、より頻繁に、より良いです。問題をすぐに発見できるほど、早く解決できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは2つの主要なルールを持っています。</font><font style="vertical-align: inherit;">タスクがテストに入ると、ユニットテストでもユニットテストでもないすべてのテストが合格する必要があります。</font><font style="vertical-align: inherit;">一部のテストが失敗した場合、これはタスクを修正に移す機会です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然、リリースを公開するとき。</font><font style="vertical-align: inherit;">リリースでは、すべてのテストに合格する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、私は刺激的な何かを言いたいです-テストを書いて、それらを環境に優しくさせ、Codeceptionを使って、モキを作ってください。</font><font style="vertical-align: inherit;">皆さんはこれを完全に理解していると思います。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja452124/index.html">「知識と成果に飢えている必要があります」-アルファバンクでテスターに​​なるのはどんな感じですか</a></li>
<li><a href="../ja452128/index.html">マイクロ回路の耐放射線性に関する一般的な誤解</a></li>
<li><a href="../ja452130/index.html">月は縮んでいて、月の地震を引き起こしています</a></li>
<li><a href="../ja452132/index.html">フリーランサーパス</a></li>
<li><a href="../ja452134/index.html">それがすべて始まった方法：はんだごての歴史と現代のツールの登場</a></li>
<li><a href="../ja452138/index.html">13. Check Point Getting Started R80.20。ライセンシング</a></li>
<li><a href="../ja452140/index.html">CFOがITの運用コストモデルに切り替える理由</a></li>
<li><a href="../ja452142/index.html">コンテンツのコピー、または製品の最初の敵対的攻撃にどのように対処するか</a></li>
<li><a href="../ja452146/index.html">では、認証とパスワードはどうなりますか？Javelinの強力な認証ステータスレポートのパート2</a></li>
<li><a href="../ja452152/index.html">RostelecomがIIoTに対してどのようなソリューションを持っているか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>