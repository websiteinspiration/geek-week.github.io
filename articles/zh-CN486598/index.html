<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👩🏻 🗼 👈🏼 Jupyter Notebook中的微控制器实验 🎫 ✌🏽 🦎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jupyter Notebook是数据科学家，分析师，工程师，数学家，学生乃至我们（实验物理学中最普通的科学家）最喜欢的工具环境。 
 

该工具旨在与解释语言和便捷的数据图形表示一起使用。长期以来，我们只是依靠Python和数学库（numpy，SciPy，matplot等）来指望它。但是事实证明，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Jupyter Notebook中的微控制器实验</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486598/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jupyter Notebook是数据科学家，分析师，工程师，数学家，学生乃至我们（实验物理学中最普通的科学家）最喜欢的工具环境。 </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该工具旨在与解释语言和便捷的数据图形表示一起使用。</font><font style="vertical-align: inherit;">长期以来，我们只是依靠Python和数学库（numpy，SciPy，matplot等）来指望它。</font><font style="vertical-align: inherit;">但是事实证明，这种环境并不是那么简单，并且潜力更大。</font><font style="vertical-align: inherit;">出乎意料的是，但是Jupyter使得在微控制器上操作电子设备变得容易，它可以用作MK的REPL环境，而无需使用弱的MicroPython和对芯片外围的令人印象深刻的支持，所有这些几乎都是现成的。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/wm/gh/7f/wmgh7f8oyyssxa6qtfnkmqflv6k.gif"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个小介绍。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有一天，一个兄弟般的研究所向我们提供了一种测量设备，尽管该设备大声说着，而不是原始传感器，仍然需要处理来自该传感器的数据。</font><font style="vertical-align: inherit;">该算法很简单，您只需要测量信号前沿的上升时间即可。</font><font style="vertical-align: inherit;">像这样：</font></font></p><br>
<p><img src="https://habrastorage.org/webt/hs/wn/mn/hswnmnm4x9_hy5tjusep_vbr4sg.jpeg"></p><br>
<p> ,     ,  ,  .</p><br>
<p>           ,        ,      . </p><br>
<p>            .     - USB  Ethernet ,      ,     .                Python.</p><br>
<p>   :        sample rate    —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">10,000 times a second</a>    ,    8,000 times a second.       40,000 -50,000 times a second.</p><br>
<p>   ,          .        ( )             ,       .  ,        ,               , x  , computer vision   rocket science. .</p><br>
<p>   ,                     ,       .         ,     ,               .      .</p><br>
<p>  ,     .            .          Jupyter Notebook.  Jupyter    REPL      ,      MicroPython.  MicroPython      ,      COM-.</p><br>
<p><img src="https://habrastorage.org/webt/r9/ou/th/r9outhnjvympj67gsdvhg6rzgsa.png"></p><br>
<p><em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://www.youtube.com/watch?v=5LbgyDmRu9s</a></em> </p><br>
<p>    Jupyter  . Jupyter Notebook    ,           .     STM32  STM8,        —  STMicroelectronics.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Standard Peripheral Library</a></p><br>
<p>  :      STM8  -    .</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">uint16_t</span> <span class="hljs-title">ADC_GetConversionValue</span><span class="hljs-params">(ADC_TypeDef* ADCx)</span></span>;</code></pre><br>
<p>    .       Jupyter: </p><br>
<p><img src="https://habrastorage.org/webt/2o/fe/dd/2ofeddtweeppuod2azqjb01gwqw.png"> </p><br>
<p>    <strong>ADC_GetConversionValue</strong>   <em>/++</em> -,       Jupyter?!    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">xeus-cling</a>,   Jupyter   ++.   ,  Windows    .   ,     Microsoft,     c  Ubuntu.   MacOS,    MacBook     ...</p><br>
<p><strong>xeus-cling</strong>   /++ ,   -   Jupyter NoteBook     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">REMCU</a>.    ,     API,   <strong>Standard Peripheral Library</strong> ..   (header)   <strong>Standard Peripheral Library</strong>,    STM8LDiscovery          : </p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stm8l15x.h"</span></span></code></pre><br>
<p>        ,        ,         .          .</p><br>
<p>  ,       Jupyter   ,          . ,     ,  :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* Init GPIO Port C PC7 output push-pull up to 10MHz blue LED4*/</span>
    GPIOC-&gt;DDR |= <span class="hljs-number">0x80</span>;     <font></font>
    GPIOC-&gt;CR1 |= <span class="hljs-number">0x80</span>; <font></font>
    GPIOC-&gt;CR2 |= <span class="hljs-number">0x80</span>;</code></pre><br>
<p><em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">WavesGenerator</a></em></p><br>
<p>  Jupyter         .    <strong>Standard Peripheral Library</strong>      .</p><br>
<p>   .  :</p><br>
<ul>
<li> (  )  Ubuntu  MacOS      Anaconda, Jupyter Notebook     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">xeus-cling</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">xplots</a>(  )</li>
<li>  STM8LDiscovery —   ,        .     ,   c STM32.</li>
<li> REMCU  STM8LDiscovery,       .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>.</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p>  STM8LDiscovery  <strong>STM8L152C6</strong>   <strong><em>MCU name:</em></strong>,  StdPeriph_Driver     1.4.0<br>
<img src="https://habrastorage.org/webt/jz/h-/oi/jzh-oic_uboedjckpod8iac4lws.png"><br>
    .<br>
<img src="https://habrastorage.org/webt/qz/4r/6f/qz4r6f68q3omvuvvyfflapzjdoo.png"></p></div></div><br>
<ul>
<li>OpenOCD ,     REMCU.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>,   OpenOCD,    Ubuntu  <em>apt install</em>     STM8LDiscovery. </li>
<li>ST-Link stick —    STM8LDiscovery,     .    STM8LDiscovery   ,        OpenOCD.<br>
<em>UPD.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>        ST-Link</em></li>
</ul><br>
<p>    ST-Link  STM8LDiscovery    .</p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wb/53/y4/wb53y4gxraoli1qpgpuoejfgtcs.png"></p></div></div><br>
<p> OpenOCD   :</p><br>
<pre><code class="bash hljs">./openocd -f interface/stlink-v2.cfg -f target/stm8l.cfg</code></pre><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/e92/c07/b8a/e92c07b8a29cb082b8fb21513cba7869.png" alt="运行openocd"></p><br>
<p>   Jupyter     STM8LDiscovery.   <strong>Standard Peripheral Library</strong>       Arduino.       ,  -      ,      .    - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>,    . </p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GPIO_Toggle</a> —     .    c REMCU   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GitHub </a>   REMCU.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">notebook</a>:</p><br>
<div class="spoiler"><b class="spoiler_title">    :</b><div class="spoiler_text"><h1 id="stm8l-discovery-gpio-example">STM8L-Discovery GPIO example</h1><br>
<p>Load <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">REMCU</a> shared libray</p><br>
<pre><code class="plaintext hljs">.L libremcu.so</code></pre><br>
<p>Add path with header files</p><br>
<pre><code class="plaintext hljs">.I remcu_include</code></pre><br>
<p>Including necessary header files. The <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">“remcu.h”</a> header must be always included before any MCU header files.</p><br>
<pre><code class="plaintext hljs">#include "remcu.h"<font></font>
#include "stm8l15x.h"</code></pre><br>
<pre><code class="plaintext hljs">remcu_connect2OpenOCD(debug_server_ip, default_openocd_port, timeout_sec)</code></pre><br>
<pre><code class="plaintext hljs">remcu_resetRemoteUnit(__HALT)</code></pre><br>
<h2 id="setting-up-microcontroller-peripherals">Setting up microcontroller peripherals:</h2><br>
<pre><code class="plaintext hljs">GPIO_Init(GPIOE, GPIO_Pin_7, GPIO_Mode_Out_PP_High_Fast)</code></pre><br>
<pre><code class="plaintext hljs">GPIO_Init(GPIOC, GPIO_Pin_7, GPIO_Mode_Out_PP_High_Fast)</code></pre><br>
<pre><code class="plaintext hljs">GPIO_ResetBits(GPIOE, GPIO_Pin_7);<font></font>
GPIO_ResetBits(GPIOC, GPIO_Pin_7);</code></pre></div></div><br>
<p> notebook  Jupyter. </p><br>
<p> 6  c    REMCU.         <strong>Standard Peripheral Library</strong>  .      STM8L-Discovery,     -: </p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GPIO_Init</span><span class="hljs-params">(GPIO_TypeDef* GPIOx, <span class="hljs-keyword">uint8_t</span> GPIO_Pin, GPIO_Mode_TypeDef GPIO_Mode)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GPIO_ResetBits</span><span class="hljs-params">(GPIO_TypeDef* GPIOx, <span class="hljs-keyword">uint8_t</span> GPIO_Pin)</span></span>;</code></pre><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>    SDK,   .      <em>STM8L15X_EVAL</em>.         :</p><br>
<pre><code class="cpp hljs">GPIO_Init(GPIOE, GPIO_Pin_7, GPIO_Mode_Out_PP_High_Fast);<font></font>
GPIO_Init(GPIOC, GPIO_Pin_7, GPIO_Mode_Out_PP_High_Fast);</code></pre><br>
<p>   ,     REMCU     notebook . </p><br>
<p><img src="https://habrastorage.org/webt/8l/xr/gd/8lxrgdwrzdspbhcgpyujlczht7s.png"> </p><br>
<p>OpenOCD   .</p><br>
<p>    notebook,   - <em>GPIO_Init</em>  : </p><br>
<p><img src="https://habrastorage.org/webt/ff/hd/yb/ffhdybis-13vsuylzgfvlxkwdva.jpeg"> </p><br>
<p>   - <em>GPIO_ResetBits</em>,  </p><br>
<p>     Arduino.     :</p><br>
<div class="spoiler"><b class="spoiler_title">ADC code</b><div class="spoiler_text"><pre><code class="cpp hljs">      <span class="hljs-comment">/* Enable ADC1 clock */</span><font></font>
      CLK_PeripheralClockConfig(CLK_Peripheral_ADC1, ENABLE);<font></font>
<font></font>
      <span class="hljs-comment">/* Initialize and configure ADC1 */</span><font></font>
      ADC_Init(ADC1, ADC_ConversionMode_Continuous, ADC_Resolution_12Bit, ADC_Prescaler_2);<font></font>
<font></font>
      <span class="hljs-comment">/* ADC channel used for IDD measurement */</span><font></font>
      ADC_SamplingTimeConfig(ADC1, ADC_Group_SlowChannels, ADC_SamplingTime_384Cycles);<font></font>
<font></font>
      <span class="hljs-comment">/* Enable ADC1 */</span><font></font>
      ADC_Cmd(ADC1, ENABLE);<font></font>
<font></font>
      <span class="hljs-comment">/* Start ADC1 Conversion using Software trigger*/</span><font></font>
      ADC_SoftwareStartConv(ADC1);<font></font>
<font></font>
      <span class="hljs-comment">/* Get conversion value */</span>
      ADCData = ADC_GetConversionValue(ADC1);</code></pre></div></div><br>
<p>   -   STM8         40,000 sample rate    .     ,  STM8L         DMA —     ,      (   )   .  Jupyter Notebook        —       .          . </p><br>
<p>  ,       ,          .     ,          ,      .</p><br>
<p>   DMA    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ADC_DMA</a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">notebook</a></p><br>
<p>   Xplots     .       PC7  STM8LDiscovery.</p><br>
<p>         (   ):</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/f90/5af/8aa/f905af8aa3749ec27a674e352a2570dc.png"></p><br>
<p>      .     ,      -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  </a>,        little-endian  big-endian.     ,       little-endian,   STM8LDiscovery, big-endian!   ,         .    ,         .</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/in.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0xFF</span>; i++){
    <span class="hljs-keyword">uint16_t</span> temp = adc_data[i];<font></font>
    temp = htons(temp);<font></font>
    adc_data[i] = temp;<font></font>
}<font></font>
line.y = adc_data; <span class="hljs-comment">//plot graph</span>
fig</code></pre><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/244/4a0/878/2444a0878a89b841c039cb8dd1c93afa.png"></p><br>
<p>  ,     .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/f5a/ce7/ddd/f5ace7ddd3713913538b0bd9cf9ca733.png"></p><br>
<p> -           .  -          STM8LDiscovery  .  ,      ,     .            ,       . </p><br>
<p>     ,               ,          .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/cb8/982/b7a/cb8982b7ac1e66add69b658ba0155568.png"></p><br>
<p>       .   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">// </span>
<span class="hljs-keyword">int</span> osc_data[ADC_BUFFER_SIZE] = {<span class="hljs-number">0</span>};<font></font>
<font></font>
<span class="hljs-comment">//     DMA</span>
<span class="hljs-keyword">size_t</span> shift =  DMA_GetCurrDataCounter(DMA1_Channel0);
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; ADC_BUFFER_SIZE; i++){ osc_data[i] = adc_data[i];}
<span class="hljs-comment">// ,              </span><font></font>
shift =  ADC_BUFFER_SIZE - shift;<font></font>
<span class="hljs-comment">//</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; ADC_BUFFER_SIZE; i++){
        <span class="hljs-keyword">int</span> shift_pos = (i + shift) % ADC_BUFFER_SIZE;<font></font>
        adc_data[i] = osc_data[shift_pos];<font></font>
    }<font></font>
line.y = adc_data; <span class="hljs-comment">//plot graph</span>
fig</code></pre><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/6b2/180/d1a/6b2180d1ac7a2fac4812a42f53ab60fe.png"></p><br>
<p>        .       8.    —      !</p><br>
<p>    DMA  STM8LDiscovery.       255 .        ,      .     10.000 . ,      STM8LDiscovery — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">STM32F4Discovery</a>.  STM32F4     DMA    64  ,       .    ,            sample rate  ,          255 .</p><br>
<p>  ,   TIM1.      - :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TIM1_TimeBaseInit</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> TIM1_Prescaler,
                       TIM1_CounterMode_TypeDef TIM1_CounterMode,
                       <span class="hljs-keyword">uint16_t</span> TIM1_Period,
                       <span class="hljs-keyword">uint8_t</span> TIM1_RepetitionCounter)</span></span>;</code></pre><br>
<p>  ,         .    -,  .      .             TIM1_Period,    .  TIM1_Period      ,    .</p><br>
<p>        ,  ,        :</p><br>
<pre><code class="cpp hljs">SamplingTime = ADC_SamplingTime_4Cycles;<font></font>
TIM1_Prescaler = <span class="hljs-number">0x0</span>; <font></font>
TIM1_Period = <span class="hljs-number">0x2</span>;<font></font>
TIM1_RepetitionCounter = <span class="hljs-number">0</span>;</code></pre><br>
<p>,   ,  600-660 .          .</p><br>
<p>  ,          ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">notebook</a>,     (  DAC)  STM8LDiscovery. ,  ,   DMA    PF0  , , ,    ,    PC7( )  PF0( )  .     notebook,     : </p><br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><h2 id="dac-dma-example">DAC-DMA example</h2><br>
<pre><code class="plaintext hljs"> const uint16_t MEM_ADDRESS = ADC_BUFFER_SIZE*sizeof(adc_data.front()) + 1;<font></font>
 const uint8_t MEM_SIZE = 130;<font></font>
 uint8_t SINUS_TABLE[130] = {110,115,121,126,131,137,142,147,<font></font>
152,157,161,166,171,175,179,183,187,191,195,198,201,204,207,209,<font></font>
211,213,215,216,218,219,219,220,220,220,220,219,218,217,216,214,<font></font>
212,210,208,205,202,199,196,193,189,185,181,177,173,168,164,159,<font></font>
154,149,144,139,134,129,123,118,113,107,102,97,91,86,81,76,<font></font>
71,66,61,56,52,47,43,39,35,31,27,24,21,18,15,12,<font></font>
10,8,6,4,3,2,1,0,0,0,0,1,1,2,4,5,7,9,11,13,16,19,22,25,29,33,37,41,45,49,54,59,<font></font>
63,68,73,78,83,89,94,99,105,110, };</code></pre><br>
<pre><code class="plaintext hljs">  CLK_PeripheralClockConfig(CLK_Peripheral_DAC, ENABLE);<font></font>
  CLK_PeripheralClockConfig(CLK_Peripheral_TIM4, ENABLE);<font></font>
<font></font>
for(int i = 0 ; i &lt; 130*sizeof(SINUS_TABLE[0]); i+=10){<font></font>
    remcu_store2mem(MEM_ADDRESS + i, (uint8_t*)SINUS_TABLE + i, 10);<font></font>
}</code></pre><br>
<pre><code class="plaintext hljs">  /* DMA channel3 Config -----------------------------------------------------*/<font></font>
#define DAC_CH1RDHRH_ADDRESS      0x5388<font></font>
#define DAC_CH1RD8_ADDRESS      0x5390<font></font>
#define DAC_CH1RDHLH_ADDRESS      0x538C<font></font>
<font></font>
  DMA_DeInit(DMA1_Channel3);<font></font>
  DMA_Init(DMA1_Channel3,  MEM_ADDRESS,<font></font>
           DAC_CH1RD8_ADDRESS,<font></font>
           MEM_SIZE, DMA_DIR_MemoryToPeripheral, DMA_Mode_Circular,<font></font>
           DMA_MemoryIncMode_Inc, DMA_Priority_High,<font></font>
           DMA_MemoryDataSize_Byte<font></font>
          );<font></font>
<font></font>
  /* DMA1 Channel 3 enable */<font></font>
  DMA_Cmd(DMA1_Channel3, ENABLE);<font></font>
  DMA_GlobalCmd(ENABLE);</code></pre><br>
<pre><code class="plaintext hljs">  /* DAC Channel1 Config: 12bit right ----------------------------------------*/<font></font>
  /* DAC deinitialize */<font></font>
  DAC_DeInit();<font></font>
<font></font>
  /* Fill DAC Init param DAC_Trigger_T4_TRGO and  DAC Channel1 Init */<font></font>
  DAC_Init(DAC_Channel_1, DAC_Trigger_T4_TRGO, DAC_OutputBuffer_Enable);<font></font>
<font></font>
  /* Enable DAC Channel1 */<font></font>
  DAC_Cmd(DAC_Channel_1, ENABLE);<font></font>
<font></font>
  /* Enable DMA for DAC Channel1 */<font></font>
  DAC_DMACmd(DAC_Channel_1, ENABLE);</code></pre><br>
<pre><code class="plaintext hljs">  TIM4_DeInit();<font></font>
  /* Time base configuration */<font></font>
  TIM4_TimeBaseInit(TIM4_Prescaler_1, 0x1);<font></font>
<font></font>
  /* TIM4 TRGO selection */<font></font>
  TIM4_SelectOutputTrigger(TIM4_TRGOSource_Update);<font></font>
<font></font>
  /* TIM4 enable counter */<font></font>
  TIM4_Cmd(ENABLE);</code></pre></div></div><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>.          big-endian,       8-bit.</p><br>
<p>,     Standard Peripheral Library    .  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">DAC_Noise&amp;TriangleGenerator</a>    ,     -:</p><br>
<pre><code class="cpp hljs">DAC_SetTriangleWaveAmplitude</code></pre><br>
<p> -   <strong>Standard Peripheral Library</strong>  1.4.0.         ,       1.4.0      REMCU.</p><br>
<p>        LCD   ,        gif-.         ,        .     ,   15   .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>   STM8LDiscovery    LCD .       -: </p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LCD_print</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> str)</span></span>;</code></pre><br>
<p>        . </p><br>
<p>  notebook'    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Github</a>.</p><br>
<p>       STM8L151  Jupyter Notebok.        -  ,          .    ,    big-endian.                    , , ,         .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我认为所获得的经验是成功的，我们计划使用STM8LDiscovery和更专业的模型STM32F4Discovery来自动化实验。</font><font style="vertical-align: inherit;">现在，即使是针对Python的REMCU库绑定程序也已经出现。</font><font style="vertical-align: inherit;">因此，您已经可以不用具有Linux或MacOS的虚拟机而在本地窗口系统中编写脚本了。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有有趣的实验，</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
愿Jupyter伴随您！</font></font></p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN486598/">https://habr.com/ru/post/zh-CN486598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN486580/index.html">定义十年的一百种小工具（100-76）</a></li>
<li><a href="../zh-CN486582/index.html">微处理器和个人计算机的历史：1980年-1984年</a></li>
<li><a href="../zh-CN486584/index.html">Zilog Z-80-不朽的八十年代</a></li>
<li><a href="../zh-CN486586/index.html">IPv6地址-有那么多吗？</a></li>
<li><a href="../zh-CN486592/index.html">Robogami-终结者和变形金刚的真正后裔</a></li>
<li><a href="../zh-CN486602/index.html">Svelte社区资料摘要（1月16日至2月1日）</a></li>
<li><a href="../zh-CN486604/index.html">不，动态类型系统基本上不再开放</a></li>
<li><a href="../zh-CN486608/index.html">世界上最有效的情报服务情报中的基本助手（第2部分）</a></li>
<li><a href="../zh-CN486614/index.html">为什么需要eSIM。它是如何工作的，为什么他们这么多谈论它</a></li>
<li><a href="../zh-CN486622/index.html">并行计算模型</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>