<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘‹ğŸ¾ âœŒğŸ¿ ğŸï¸ Bagaimana cara kerja histogram Prometheus? ğŸ» ğŸ¥” ğŸ¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Terjemahan artikel disiapkan sebelum dimulainya kursus "Pemantauan dan Penebangan: Zabbix, Prometheus, ELK" .
 
 
 
 Sebelumnya kami melihat penghitun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bagaimana cara kerja histogram Prometheus?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501978/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terjemahan artikel disiapkan sebelum dimulainya kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pemantauan dan Penebangan: Zabbix, Prometheus, ELK"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/bb/b2/rl/bbb2rlroxgbryy_noc1mg9urkos.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelumnya kami melihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penghitung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengukur,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ringkasan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sekarang mari kita bicara tentang bagaimana histogram bekerja di Prometheus.</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Histogram memiliki beberapa kesamaan dengan ringkasan. </font><font style="vertical-align: inherit;">Histogram adalah kombinasi dari berbagai penghitung. </font><font style="vertical-align: inherit;">Seperti metrik ringkasan, metrik histogram digunakan untuk melacak pengukuran dimensi peristiwa, seringkali durasinya, menggunakan metode ini </font></font><code>observe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Alat ketepatan waktu biasanya sama dengan buletin. </font><font style="vertical-align: inherit;">Perbedaannya adalah pemrosesan kuantil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah contoh </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> label Prometheus </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">untuk pemaparan</font></a></font><code>handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="xml hljs"># HELP prometheus_http_request_duration_seconds Histogram of latencies for HTTP requests.<font></font>
# TYPE prometheus_http_request_duration_seconds histogram<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.1"} 25547<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.2"} 26688<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="0.4"} 27760<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="1"} 28641<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="3"} 28782<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="8"} 28844<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="20"} 28855<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="60"} 28860<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="120"} 28860<font></font>
prometheus_http_request_duration_seconds_bucket{handler="/",le="+Inf"} 28860<font></font>
prometheus_http_request_duration_seconds_sum{handler="/"} 1863.80491025699<font></font>
prometheus_http_request_duration_seconds_count{handler="/"} 28860</code></pre><br>
<code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan mereka </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bekerja dengan cara yang persis sama dengan ringkasan, dan dapat digunakan untuk mendapatkan waktu eksekusi rata-rata selama lima menit terakhir:</font></font><br>
<br>
<pre><code class="xml hljs"> rate(prometheus_http_request_duration_seconds_sum[5m]<font></font>
/<font></font>
  rate(prometheus_http_request_duration_seconds_count[5m])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, ada beberapa kasus yang sangat jarang dimana tidak </font></font><code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ada, misalnya, dalam beberapa metrik dari eksportir MySQLd. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagian penting dari histogram adalah deret waktu </font></font><code>_bucket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang sebenarnya merupakan bagian histogram dari metrik. Lebih khusus, ini adalah penghitung yang membentuk histogram kumulatif. </font></font><code>le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menunjukkan kurang dari atau sama dengan. Dengan demikian, 2.686 permintaan mengambil kurang dari atau sama dengan 200 ms, 27.760 permintaan mengambil kurang dari atau sama dengan 400 ms, dan ada total 28.860 permintaan. Nilai-nilai dalam bucket akan non-menurun secara monoton, dan </font></font><code>+Inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bucket akan memiliki nilai terbesar. </font></font><code>+Inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ember harus selalu ada dan sesuai dengan nilainya </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menghitung, katakanlah, kuantil 0,9 (persentil ke-90), Anda harus menggunakan:</font></font><br>
<br>
<pre><code class="xml hljs">histogram_quantile(0.9, <font></font>
  rate(prometheus_http_request_duration_seconds_bucket[5m])<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu keuntungan besar dari histogram dibandingkan dengan ringkasan adalah Anda dapat mengagregasi ember sebelum menghitung kuantil - berhati-hati agar tidak kehilangan label </font></font><code>le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="xml hljs">histogram_quantile(0.9, <font></font>
  sum without (handler)(<font></font>
    rate(prometheus_http_request_duration_seconds_bucket[5m])<font></font>
  )<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain agregasi, histogram lebih murah untuk klien, karena penghitungnya bertambah dengan cepat. </font><font style="vertical-align: inherit;">Jadi mengapa tidak selalu menggunakan histogram? </font><font style="vertical-align: inherit;">Ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jawaban panjang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tetapi versi singkatnya adalah bahwa dengan histogram Anda harus memilih ember Anda terlebih dahulu, dan biaya ditransfer dari klien ke Prometheus itu sendiri karena jumlah elemen ember. Sepuluh kotak secara default mencakup layanan web biasa dengan penundaan mulai dari milidetik hingga sedetik, dan dalam beberapa kasus Anda mungkin perlu mengubahnya. Di sini, misalnya, mereka didefinisikan ulang untuk lebih baik melacak permintaan PromQL, yang secara default memiliki batas waktu dua menit. Memiliki lebih dari selusin ember-s akan memberikan hasil yang lebih akurat, tetapi juga dapat menghasilkan banyak seri waktu. Terutama dalam kombinasi dengan tag lain.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika menggunakan sistem pemantauan real-time seperti Prometheus, tujuannya adalah untuk memberikan nilai analitis yang cukup untuk membuat keputusan teknik berdasarkan hal itu. Misalnya, untuk mengetahui bahwa penundaan persentil ke-90 telah meningkat sebesar 50 ms lebih penting daripada mengetahui jika sekarang 562 ms atau 563 ms, dan biasanya sepuluh ember-s sudah cukup untuk ini. Jika Anda membutuhkan jawaban yang tepat, Anda selalu dapat menghitungnya nanti dari log Anda. Jika ada terlalu banyak bucket, ember dapat dibuang selama pemrosesan data, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seperti yang ditunjukkan sebelumnya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dalam kasus yang lebih ekstrem, Anda dapat sepenuhnya mengabaikan rangkaian </font></font><code>_bucket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s dan mengandalkan rata-rata </font></font><code>_sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>_count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesimpulannya, histogram memungkinkan kuantil agregat untuk dihitung, meskipun jumlah elemen harus diperhitungkan. </font><font style="vertical-align: inherit;">Ingatlah bahwa ringkasan tanpa kuantil adalah opsi yang lebih murah jika Anda tidak memerlukan histogram.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebih banyak tentang kursus</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id501960/index.html">Pencarian skala. Pencarian Elastics Kelebihan dan persyaratan dasar untuk instalasi</a></li>
<li><a href="../id501964/index.html">Untuk apa komputer industri?</a></li>
<li><a href="../id501968/index.html">Template Arsitektur MVI di Kotlin Multiplatform, Bagian 1</a></li>
<li><a href="../id501970/index.html">Apa yang Anda butuhkan untuk membuat penjara bawah tanah yang baik di RPG?</a></li>
<li><a href="../id501976/index.html">Cara belajar menguji perangkat lunak</a></li>
<li><a href="../id501980/index.html">Sejarah satu proyek atau bagaimana saya membuat 7 tahun PBX berdasarkan Asterisk dan Php</a></li>
<li><a href="../id501982/index.html">Cara mentransfer shader dari mesin game ke Substance Painter</a></li>
<li><a href="../id501984/index.html">Apa yang harus dilihat di karantina? Pilihan bahan dari Technostream (bagian 4)</a></li>
<li><a href="../id501986/index.html">Rahasia kesuksesan Apple AirPods yang luar biasa</a></li>
<li><a href="../id501988/index.html">Bagaimana layar pesan VK ditampilkan?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>