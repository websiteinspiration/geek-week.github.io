<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛤️ 🕶️ 👐 偽のPayPalサイトからランサムウェアNemtyに出会う 🛶 🤷🏿 🏑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="新しいNemtyランサムウェアがネットワークに登場しました。これは、GrandCrabまたはBuranの後継と思われます。悪意のあるソフトウェアは主に偽のPayPalサイトから配布され、いくつかの興味深い機能を備えています。このランサムウェアの操作の詳細-カットの下。
 
 
  
 新しいNemt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>偽のPayPalサイトからランサムウェアNemtyに出会う</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/471968/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいNemtyランサムウェアがネットワークに登場しました。これは、GrandCrabまたはBuranの後継と思われます。</font><font style="vertical-align: inherit;">悪意のあるソフトウェアは主に偽のPayPalサイトから配布され、いくつかの興味深い機能を備えています。</font><font style="vertical-align: inherit;">このランサムウェアの操作の詳細-カットの下。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/1ad/322/52f/1ad32252f734b7c2f70ca706636719d4.jpg" alt="画像"><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいNemtyランサムウェアは</font><font style="vertical-align: inherit;">、2019年9月7日に</font><font style="vertical-align: inherit;">ユーザー</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nao_sec</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって発見されました</font><font style="vertical-align: inherit;">。悪意のあるソフトウェアが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PayPalに偽装し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たサイトを介して配布</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">されました</font></a><font style="vertical-align: inherit;">。また、ランサムウェアがエクスプロイトキットRIGを介してコンピューターに侵入する可能性もあります。攻撃者はソーシャルエンジニアリング手法を選択して、ユーザーがPayPal Webサイトから受け取ったとされるcacheback.exeファイルを実行するように強制しました。また、NemtyがTorローカルプロキシサービスに間違ったポートを指定したため、マルウェアがサーバーにデータを送信できないようになっていることも興味深いです。したがって、身代金を支払って攻撃者からの復号化を待つ場合、ユーザーは暗号化されたファイルを自分でTorネットワークにアップロードする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nemtyに関するいくつかの興味深い事実は、BuranとGrandCrabに関連する同じ人物またはサイバー犯罪者によって開発されたことを示唆しています。 </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ガンクラブと同様に、ネムティにはイースターエッグがあります。ロシアのプーチン大統領とわいせつな冗談の写真へのリンクです。</font><font style="vertical-align: inherit;">従来のGandCrabランサムウェアには、同じテキストの画像がありました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">両方のプログラムの言語アーティファクトは、同じロシア語を話す著者を指しています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは8092ビットのRSA鍵を使用する最初の暗号化プログラムです。</font><font style="vertical-align: inherit;">意味がありませんが、ハッキングから保護するための1024ビットのキーで十分です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buranと同様に、暗号化プログラムはObject Pascalで記述され、Borland Delphiでコンパイルされます。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的分析</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悪意のあるコードの実行は4段階で行われます。</font><font style="vertical-align: inherit;">最初のステップは、1198936バイトのサイズのMS WindowsでPE32実行可能ファイルであるcashback.exeを実行することです。</font><font style="vertical-align: inherit;">そのコードはVisual C ++で記述され、2013年10月14日にコンパイルされます。</font><font style="vertical-align: inherit;">これには、cashback.exeの起動時に自動的に解凍されるアーカイブが含まれています。</font><font style="vertical-align: inherit;">ソフトウェアはCabinet.dllライブラリとその関数FDICreate（）、FDIDestroy（）などを使用して、.cabアーカイブからファイルを取得します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/942/09b/a38/94209ba38048a2ecc035eeeb84e3779e.png" alt="画像"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/77a/2db/85d/77a2db85d1eec59dc707bbbf57e45d53.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA-256：A127323192ABED93AED53648D03CA84DE3B5B006B641033EB46A520B7A3C16FC </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アーカイブを解凍すると、3つのファイルが表示されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/460/969/886/460969886773b893df30da7d1b21f6d1.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、MS Windowsでサイズが307200バイトのPE32実行可能ファイルtemp.exeが起動されます。</font><font style="vertical-align: inherit;">コードはVisual C ++で記述され、UPXに似たパッカーであるMPRESSパッカーによってパッケージ化されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b0e/f3f/a7c/b0ef3fa7c3226b0fa4f87867e994c742.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA-256：EBDBA4B1D1DE65A1C6B14012B674E7FA7F8C5F5A8A5A2A9C3C338F02DD726AAD </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、ironman.exeです。</font><font style="vertical-align: inherit;">temp.exeを実行すると、埋め込まれたデータがtempで復号化され、名前がironman.exe（544768バイトのPE32実行可能ファイル）に名前変更されます。</font><font style="vertical-align: inherit;">Borland Delphiでコンパイルされたコード。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f27/524/300/f27524300e0dbb36c826870281dce049.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA-256：2C41B93ADD9AC5080A12BF93966470F8AB3BDE003001492A10F63758867F2A88 </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のステップは、ironman.exeファイルを再起動することです。</font><font style="vertical-align: inherit;">実行時に、コードを変換し、メモリから実行します。</font><font style="vertical-align: inherit;">このバージョンのironman.exeは悪質で、暗号化を行います。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻撃ベクトル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、Nemtyランサムウェアはpp-back.infoを通じて配布されています。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7e3/6f2/369/7e36f236961bc0a666d5f0181cf2c509.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全な感染チェーンは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.any.run</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サンドボックス</font><font style="vertical-align: inherit;">で</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">確認</font></a><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取り付け </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cashback.exe-攻撃の始まり。</font><font style="vertical-align: inherit;">すでに述べたように、cashback.exeは含まれている.cabファイルを解凍します。</font><font style="vertical-align: inherit;">次に、フォルダTMP4351 $ .TMPを%% TEMP％\ IXxxx.TMPの形式で作成します。xxxは001〜999の数字です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df8/42f/1ea/df842f1eabffae6ee11679ef588029b5.png" alt="画像"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b9/fc3/f1e/6b9fc3f1e6a5aa7e33ea27276884e5c9.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、レジストリキーがインストールされている、それはこのようになります：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[HKLM \ SOFTWARE \ WOW6432NODE \マイクロソフト\ Windowsの\ CurrentVersionの\ RunOnceを\ wextract_cleanup0] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「します。rundll32.exe」「C：\ WINDOWS \ SYSTEM32 \のAdvpack.dll、DelNodeRunDLL32」C：\ユーザー\ MALWAR〜1 \ AppData \ Local \ Temp \ IXPxxx.TMP \ "" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解凍されたファイルを削除するために使用されます。</font><font style="vertical-align: inherit;">最後に、cashback.exeはtemp.exeプロセスを開始します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5e/3fc/25e/b5e3fc25e123fa6e703a3a4cfd9aa2ca.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temp.exe-感染チェーンの2番目のステップ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ウイルス実行の2番目のステップである、</font><font style="vertical-align: inherit;">cashback.exe </font><font style="vertical-align: inherit;">ファイルによって起動されるプロセスです。</font><font style="vertical-align: inherit;">彼はAutoHotKey（Windowsでスクリプトを実行するためのツール）をダウンロードし、PEファイルのリソースセクションにあるWindowSpy.ahkスクリプトを実行しようとします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e3/e59/2cc/4e3e592cc9982dc634ea9e640f043414.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WindowSpy.ahkスクリプトは、RC4アルゴリズムとIwantAcakeパスワードを使用して、ironman.exeの一時ファイルを復号化します。</font><font style="vertical-align: inherit;">パスワードのキーは、MD5ハッシュアルゴリズムを使用して取得されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、temp.exeはironman.exeプロセスを呼び出します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cea/d24/0c7/cead240c70b478ec5aaca50747345292.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ironman.exe-3番目のステップ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ironman.exeは、iron.bmpファイルの内容を読み取り、次に開始する暗号ロック付きのiron.txtファイルを作成します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/804/ea2/6e1/804ea26e1e809deeaad2de358dc28bcc.png" alt="画像"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/775/320/a3e/775320a3e91acf2399d1862398ea35e2.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ウイルスはiron.txtをメモリにロードし、ironman.exeとして再起動します。</font><font style="vertical-align: inherit;">その後、iron.txtが削除されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ironman.exeは、影響を受けるコンピューター上のファイルを暗号化するNEMTYランサムウェアの主要部分です。</font><font style="vertical-align: inherit;">悪意のあるソフトウェアは、ヘイトと呼ばれるミューテックスを作成します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/082/939/daf/082939dafc9172d0b4a7336fd21465a6.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、彼はコンピュータの地理的な場所を決定します。</font><font style="vertical-align: inherit;">Nemtyはブラウザを開き、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http：</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> //api.ipify.orgでIPを認識します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">サイト</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api.db-ip.com/v2/free</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [IP] / countryNameでは、国は受信したIPによって決定され、コンピューターが以下にリストされた地域のいずれかにある場合、マルウェアコードの実行は停止します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロシア</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベラルーシ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウクライナ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カザフスタン</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タジキスタン</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどの場合、開発者は居住国の法執行機関の注意を引きたくないため、「自国」の管轄区域でファイルを暗号化しません。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
被害者のIPアドレスが上記のリストに含まれていない場合、ウイルスはユーザーの情報を暗号化します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/03a/c78/50e/03ac7850eab9fb3b8e382d05ea915e17.png" alt="画像"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルの回復を防ぐために、シャドウコピーは削除されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b7/b6f/c49/1b7b6fc49ef43257feeac39926f2555d.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、暗号化されないファイルとフォルダのリスト、およびファイル拡張子のリストが作成されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィンドウズ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ RECYCLE.BIN </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTDETECT.COM </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntldr </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSDOS.SYS </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IO.SYS </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boot.ini AUTOEXEC.BAT ntuser.dat </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desktop.ini </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONFIG.SYS </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOOTSECT.BAK </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bootmgr </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラムデータ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリデータ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osoft </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的なファイル </font></font></li>
</ul><br>
<pre><code class="plaintext hljs">log LOG CAB cab CMD cmd COM com cpl<font></font>
CPL exe EXE ini INI dll DDL lnk LNK url<font></font>
URL ttf TTF DECRYPT.txt NEMTY </code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">難読化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
URLと埋め込まれた構成データを非表示にするために、Nemtyは、base64およびRC4エンコードアルゴリズムとfuckavキーワードを使用しています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7a/cbe/422/b7acbe422f5f388d9a30a7c6e154186d.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CryptStringToBinaryを使用した復号化プロセスは次のとおりです</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e4/f54/2bc/4e4f542bca33b2fbf95105f270ad264e.png" alt="画像"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暗号化</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nemtyは3層の暗号化を使用します。 </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル用のAES-128-CBC。</font><font style="vertical-align: inherit;">128ビットのAESキーがランダムに生成され、すべてのファイルに同じように使用されます。</font><font style="vertical-align: inherit;">ユーザーのコンピューターの構成ファイルに格納されます。</font><font style="vertical-align: inherit;">IVはファイルごとにランダムに生成され、暗号化されたファイルに保存されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル暗号化用のRSA-2048 IV。</font><font style="vertical-align: inherit;">セッションの鍵ペアが生成されます。</font><font style="vertical-align: inherit;">セッションの秘密鍵は、ユーザーのコンピューターの構成ファイルに格納されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA-8192。</font><font style="vertical-align: inherit;">メインの公開鍵はプログラムに組み込まれており、RSA-2048セッションのAES鍵と秘密鍵を保管する構成ファイルの暗号化に使用されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nemtyは最初に32バイトのランダムデータを生成します。</font><font style="vertical-align: inherit;">最初の16バイトは、AES-128-CBCキーとして使用されます。</font></font></li>
</ul> <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f1/83b/f33/0f183bf33f1d420b6f978322fc60a7e6.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の暗号化アルゴリズムはRSA-2048です。</font><font style="vertical-align: inherit;">キーペアはCryptGenKey（）関数によって生成され、CryptImportKey（）関数によってインポートされます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ecd/b48/535/ecdb48535873a4cad5215173d8145588.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セッションのキーペアが生成された後、公開キーがMS暗号化サービスプロバイダーにインポートされます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/011/ec6/078/011ec6078fcf2900c79320879ab53e77.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セッション用に生成された公開鍵の例： </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff2/578/c1c/ff2578c1cb5d94f58bfcd2ef1b7830e8.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、秘密キーがCSPにインポートされます。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a8/5d5/d0d/0a85d5d0db5188e243fdc27136a9cbee.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セッション用に生成された秘密鍵の例： </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efe/54c/4b3/efe54c4b3a9314a8fa2d871d44c09ca6.png" alt="画像"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後はRSA-8192です。</font><font style="vertical-align: inherit;">メインの公開鍵は、暗号化された形式（Base64 + RC4）でPEファイルの.dataセクションに保存されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ac/8df/55b/1ac8df55bcd053ecb2a8ae74b3aea402.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
base64をデコードし、パスワードfuckavでRC4を復号化した後のRSA-8192キーは、次のようになります。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28f/391/52a/28f39152afd386a8d167a45b1acb1e0b.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、暗号化プロセス全体は次のようになります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのファイルの暗号化に使用される128ビットAESキーの生成。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルごとにIVを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA-2048セッションの鍵ペアを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64およびRC4を使用した既存のRSA-8192キーの復号化。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のステップのAES-128-CBCアルゴリズムを使用してファイルの内容を暗号化します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA-2048公開鍵とbase64でのエンコードを使用した暗号化IV。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暗号化されたIVを各暗号化ファイルの最後に追加します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AESキーとRSA-2048セッションの秘密キーを構成に追加します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font><font style="vertical-align: inherit;">感染したコンピュータ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に関する情報の収集」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションで説明されている構成データは</font><font style="vertical-align: inherit;">、RSA-8192プライマリ公開鍵を使用して暗号化されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暗号化されたファイルは次のとおりです。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号化されたファイルの例：</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">感染したコンピュータに関する情報を収集する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ランサムウェアはキーを収集して感染ファイルを復号化するため、攻撃者は実際に復号化プログラムを作成できます。</font><font style="vertical-align: inherit;">さらに、Nemtyは、ユーザー名、コンピューター名、ハードウェアプロファイルなどのユーザーデータを収集します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/54e/bce/cef/54ebcecef4b2b83158b96286067c2749.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GetLogicalDrives（）、GetFreeSpace（）、GetDriveType（）関数を呼び出して、感染したコンピュータのディスクに関する情報を収集します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
収集された情報は、構成ファイルに格納されます。</font><font style="vertical-align: inherit;">行をデコードすると、構成ファイルにパラメーターのリストが表示されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea8/9a6/ce1/ea89a6ce141ae197211e4777230d77d4.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
感染したコンピュータの構成例：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea8/9a6/ce1/ea89a6ce141ae197211e4777230d77d4.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成テンプレートは次のように表すことができます：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{"一般"：{"IP"： "[IP]"、 "国"： "[国]"、 "コンピューター名"： "[コンピューター名]"、 "ユーザー名"： "[ユーザー名] "、" OS "：" [OS] "、" isRU "：false、" version "：" 1.4 "、" CompID "：" {[CompID]} "、" FileID "：" _ NEMTY_ [FileID] _ " 、 "UserID"： "[UserID]"、 "key"： "[key]"、 "pr_key"： "[pr_key] </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
収集されたデータNemtyはJSON形式でファイル％USER％/ _ NEMTY_.nemtyに保存します。FileID7文字長ランダムに生成された例：_NEMTY_tgdLYrd_.nemty。FileIDも暗号化されたファイルの最後に追加されます。</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">差し押さえメッセージ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デスクトップ上のファイルを暗号化すると、_NEMTY_ [FileID] -DECRYPT.txtファイルは次のようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f68/286/0fc/f682860fc423590dd6c46d41f130277c.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルの最後には、感染したコンピュータに関する暗号化された情報が含まれています。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/397/233/cca/397233cca003e199f312bbc2ce79e197.png" alt="画像"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク通信</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ironman.exeプロセスは、アドレス</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://dist.torproject.org/torbrowser/8.5.4/tor-win32-0.4.0.5.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からTorブラウザーディストリビューションをダウンロードし、</font><font style="vertical-align: inherit;">インストールを試み</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Nemtyは構成データを127.0.0.1:9050に送信しようとします。そこで、Torブラウザープロキシが機能していることが検出されます。</font><font style="vertical-align: inherit;">ただし、デフォルトでは、Torプロキシはポート9150でリッスンし、ポート9050はLinuxではTorデーモンを、WindowsではExpertバンドルを使用します。</font><font style="vertical-align: inherit;">したがって、データは攻撃者のサーバーに送信されません。</font><font style="vertical-align: inherit;">代わりに、ユーザーは身代金メッセージによって提供されたリンクでTor復号化サービスにアクセスすることにより、構成ファイルを手動でダウンロードできます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Torプロキシへの接続：</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e1f/349/300/e1f349300c72c9a760a69fa63c182893.png" alt="画像"><br>
<img src="https://habrastorage.org/getpro/habr/post_images/cea/9a2/e8d/cea9a2e8d5a6571c9e95f183861c4277.png" alt="画像"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTP GETは127.0.0.1:9050/public/gate?data=でリクエストを作成します</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f7/884/d28/6f7884d28aa6b3e769a3d4a460320b80.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに、TORlocalプロキシーによって使用される開いているTCPポートが表示されます。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e9/394/d26/5e9394d265cb6403add24b040aa2569d.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Torネットワーク上のNemty復号化サービス：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/597/303/351/59730335151d25d50e8065a9f7252e0a.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号化された写真（jpg、png、bmp）をアップロードして、復号化サービスをテストできます。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/597/303/351/59730335151d25d50e8065a9f7252e0a.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この後、攻撃者は身代金の支払いを要求します。</font><font style="vertical-align: inherit;">不払いの場合、価格は2倍になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/009/6a4/633/0096a46333473867e25380350c54d4a2.png" alt="画像"></div> <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、Nemtyによって暗号化されたファイルの復号化は、身代金を支払わなければ機能しません。このバージョンのランサムウェアは、BuranランサムウェアやレガシーGandCrabとの類似点があります。BorlandDelphiでのコンパイルと同じテキストの画像です。さらに、これは8092ビットのRSAキーを使用する最初の暗号化プログラムです。これも、1024ビットのキーで十分に保護できるため、意味がありません。最後に、不思議なことに、彼はTorのローカルプロキシサービスに間違ったポートを使用しようとしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acronis Backup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acronis True Image</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソリューションで</font><font style="vertical-align: inherit;">は、ユーザーのPCとデータにNemtyランサムウェアを使用できません。プロバイダーは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acronis Backup Cloudで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客を保護できます</font><font style="vertical-align: inherit;">。完全な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイバー防御</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップだけでなく、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acronis Active Protection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用した保護も提供します</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">。AcronisActive Protection</font></a><font style="vertical-align: inherit;">は、人工知能と行動ヒューリスティックスに基づく特別なテクノロジーで、未知のマルウェアをも中和できます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471954/index.html">自分のインターネットラジオ</a></li>
<li><a href="../ja471956/index.html">アニメーション化された状態グラフ</a></li>
<li><a href="../ja471958/index.html">バグのあるGAのAmazon EX Windowsですが、誰よりも高速です</a></li>
<li><a href="../ja471960/index.html">操作TA505、パート2：NetSupport RATによるServHelperバックドアの学習</a></li>
<li><a href="../ja471964/index.html">オラクルが救いに来る</a></li>
<li><a href="../ja471974/index.html">2人の船長が将軍になった方法：白と赤</a></li>
<li><a href="../ja471976/index.html">ITスペシャリストはどのように海外で仕事を得るのですか？</a></li>
<li><a href="../ja471978/index.html">ディープラーニングだけで構築されたAIシステムは信頼できない</a></li>
<li><a href="../ja471980/index.html">電話詐欺師。第4幕、最終...</a></li>
<li><a href="../ja471982/index.html">PHPの将来について議論する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>