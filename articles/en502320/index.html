<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öíÔ∏è ü§µüèº ‚õàÔ∏è Kubernetes best practices. Kubernetes organization with namespace üë∂üèΩ ‚ôèÔ∏è ü§ß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes best practices. Creating Small Containers
 
 As you begin to create more and more Kubernetes services, easy-to-start tasks get more complic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kubernetes best practices. Kubernetes organization with namespace</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/502320/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes best practices. Creating Small Containers</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As you begin to create more and more Kubernetes services, easy-to-start tasks get more complicated. For example, development teams cannot create services or deployments under the same name. If you have thousands of hearths, a simple listing of them will take a lot of time, not to mention providing them with normal management. And this is just the tip of the iceberg.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's take a look at how namespace namespace makes Kubernetes resource management easier. So what exactly is a namespace? Namespace can be thought of as a virtual cluster inside your Kubernetes cluster. You can have multiple namespaces isolated from each other within the same Kubernetes cluster. They can really help you and your teams with organization, security and even system performance. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7x/_w/-o/7x_w-ofdjxdkohjjt3vmg-5ngta.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On most Kubernetes distributions, the cluster is ‚Äúout of the box‚Äù with a namespace called ‚Äúdefault‚Äù. There are actually three namespaces that Kubernetes is dealing with: default, kube-system, and kube-public. Currently, Kube-public is not used very often.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/fs/5v/iq/fs5viqqjynuywdojlqfukfqmz08.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not touching the kube namespace is a good idea, especially on a managed system like the Google Kubernetes Engine. It uses the default namespace as the place where your services and applications are created. There is absolutely nothing special about it, except that Kubernetes is out of the box configured to use it, and you cannot remove it. This is great for getting started and systems with little performance, but I would not recommend using the default namespace in large prod systems. In the latter case, one development team can easily rewrite someone else‚Äôs code and disrupt the work of another team without even realizing it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, you should create several namespaces and use them to segment your services into manageable links. A namespace can be created with a single command. If you want to create a namespace called test, then use the $ kubectl create namespace test command or just create a YAML file and use it like any other Kubernetes resource. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/ck/_r/h7ck_rzgh6is6fe-rb1ylfwehia.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can view all namespaces using the $ kubectl get namespace command. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zl/z6/tu/zlz6tuefrycwzivyjs6sdc05r4g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After its execution, you will see three built-in namespaces and a new namespace called "test". Let's look at a simple YAML file for creating pods. You may notice that there is no mention of a namespace in it.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2g/hs/mk/2ghsmkc6fe9deh48zfanymdg0mm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you use kubectl to run this file, it will create the mypod module in the current active namespace. This will be the default namespace until you change it. There are 2 ways to tell Kubernetes in which namespace you want to create your resource. The first way is to use the namespace flag when creating the resource. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3b/ed/z0/3bedz0daexg4lg0tcxztm5zvgye.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second way is to specify the namespace in the YAML declaration. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gt/vq/k4/gtvqk40ra9jqtg1e9xj0r9dtwsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you specify a namespace in YAML, then the resource will always be created in this space. If you try to use a different namespace when using the namespace flag, the command will fail. Now, if you try to find your pod, you can‚Äôt do it.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yq/dr/hq/yqdrhqmpvu9cmdakcmqgty6haq0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is because all commands are executed outside the current active namespace. To find your pod, you need to use the namespace flag, but this is quickly boring, especially if you work as a developer in a group that uses its own namespace and does not want to use such a flag for each individual command. Let's see how this can be fixed.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eq/ik/jb/eqikjbeq7hlcgzs5rkzoybqoolo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Out of the box, your active namespace is called default. If you do not specify the namespace in the YAML of the resource, then all Kubernetes commands will use this active default namespace. Unfortunately, an attempt to manage the active namespace using kubectl may fail. However, there is a very good tool called Kubens, which greatly simplifies this process. When you run the kubens command, you see all the namespaces with the highlighted active namespace. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/ws/-v/tvws-vin5om7jaxnvhbclacre6g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To switch the active namespace to the test namespace, you simply run the $ kubens test command. If after this you enter the $ kubens command again, you can see that a new active namespace is now allocated - test.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/fp/o2/cyfpo2btatkdunsidxffjzrn9h4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This means that you do not need a namespace flag to see the pod in the test namespace. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/i9/sg/mgi9sgq_mfaniofrcztmbcoyx2m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, namespaces are hidden from each other, but not isolated from each other. A service from one namespace can quite easily communicate with a service in another namespace, which is often very useful. The ability to communicate between different namespaces means that the service of your developers can interact with the service of another dev-command in a different namespace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usually, when your application wants to access the Kubernetes service, you use the built-in DNS discovery service and just give your application the name of the service. However, you can create a service under the same name in several namespaces, which is invalid.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cs/3z/0g/cs3z0gnefkbokdbqnkmboitb890.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, this is easily circumvented by using the expanded form of the DNS address. Services at Kubernetes expose their endpoints using a common DNS pattern. It looks something like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m-/e6/d9/m-e6d9rzvygcic0saafqvazhsss.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typically, you just need a service name, and DNS will automatically determine the full address. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/8e/de/cq8ede81fvlqqwuu9el2zggtwyu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, if you need to access the service in a different namespace, just use the service name plus the namespace name: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/it/gu/qd/itguqdid_5tif88pws58xdrov_0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, if you want to connect to the service database in the test namespace, you can use the database address database.test </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d2/ep/dz/d2epdz20fzq4nx67piacet42mrw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to connect to the service database in the prod namespace, you are using database.prod.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ad/vx/zj/advxzj6uvtw6_jnqouiyp6ye7gs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you really want to isolate and restrict access to the namespace, Kubernetes allows you to do this using Kubernetes Network Policies. I will talk about this in the next series. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I am often asked how many namespaces need to be created and for what purposes? What is a managed piece of data? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you create too many namespaces, they just get in your way. If there are too few of them, you will lose all the advantages of such a solution. I think that there are four main stages that each company goes through in the process of creating its own organizational structure. Depending on the stage of development at which your project or company is located, you can adopt the appropriate strategy for creating a namespace.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine that you are part of a small team that works on the development of 5-10 microservices and you can easily assemble all the developers in one room. In this situation, it makes sense to run all prod services in the default namespace. Of course, for greater scope of action, you can use 2 namespaces - separately for prod and dev. And most likely, you are testing your development on a local computer using something like Minikube.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose the conditions have changed and now you have a rapidly growing team that is simultaneously working on more than 10 microservices. There comes a time when you need to use multiple clusters or namespaces, separately for prod and dev. You can split a team into several subgroups so that each of them has its own microservices and each of these teams can choose its own namespace to facilitate the process of managing the development and release of software. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/mo/r6/qfmor6tzbdo_axdx9klge1i5rw8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As each team member gets an idea of ‚Äã‚Äãhow the system as a whole works, coordinating each change with all other developers becomes more and more difficult. Trying to spin a full stack on your local computer is getting harder every day.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In large companies, developers do not know at all who exactly is working on what. Teams communicate using service contracts or use Service mesh technology, which adds an abstraction layer over the network, such as the Istio configuration tool. Attempting to run the entire stack locally is simply not possible. I highly recommend using a continuous delivery (CD) platform like Spinnaker on Kubernetes. So, the moment comes when each team definitely needs its own namespace. Each command can even select multiple namespaces for the dev environment and the prod environment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, there are large entrepreneurial companies in which one development group is not even aware of the existence of other groups. Such a company can generally hire third-party developers who interact with through well-documented APIs. In each such group there are several teams and several microservices. In this case, you must use all the tools that I mentioned earlier. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/oe/m5/iwoem5w8z6ywbakvrs7xhibjm7e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Programmers should not deploy services manually and should not have access to namespaces that do not concern them. At this stage, it is advisable to have several clusters to reduce the "explosion radius" of poorly configured applications, to simplify billing and resource management processes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, using your organization‚Äôs namespaces correctly makes Kubernetes more manageable, manageable, secure, and flexible. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes best practices. </font><font style="vertical-align: inherit;">Kubernetes viability test with Readiness and Liveness tests</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/xpnZX3if9Tc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit of advertising :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for staying with us. Do you like our articles? Want to see more interesting materials? Support us by placing an order or recommending to your friends, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS for developers from $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unique analog of entry-level servers that was invented by us for you: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The whole truth about VPS (KVM) E5-2697 v3 (6 Cores) 10GB DDR4 480GB SSD 1Gbps from $ 19 or how to divide the server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (options are available with RAID1 and RAID10, up to 24 cores and up to 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 times cheaper at the Equinix Tier IV data center in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Only we have </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV from $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the Netherlands!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - from $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read about</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to Build Infrastructure Bldg. </font><font style="vertical-align: inherit;">class c using Dell R730xd E5-2650 v4 servers costing 9,000 euros for a penny?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502306/index.html">From the history of ‚Äúnon-standard‚Äù satellite broadcasting</a></li>
<li><a href="../en502308/index.html">What keeps the stock market from a large-scale fall and what does the technology company have to do with it?</a></li>
<li><a href="../en502312/index.html">Visual and instrument flight rules</a></li>
<li><a href="../en502316/index.html">FCC opens 6 GHz band for wireless networks - why not everyone thinks it's a good idea</a></li>
<li><a href="../en502318/index.html">Smart sequins</a></li>
<li><a href="../en502322/index.html">Instructions for transferring your consciousness to digital media</a></li>
<li><a href="../en502324/index.html">Dive into Delta Lake: Enforcement and Evolution</a></li>
<li><a href="../en502326/index.html">How to pay programmers</a></li>
<li><a href="../en502328/index.html">The best time to release a pet project</a></li>
<li><a href="../en502330/index.html">The problem of choice: how I tried to buy a TV and not go crazy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>