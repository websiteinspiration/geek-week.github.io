<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùÑÔ∏è üîç üé© Gesture control of application interface (Keras + CoreML) ü§æüèæ ‚úäüèæ üå™Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Currently, the popularity of programs using artificial neural networks is growing, in connection with this there is a large number of technologies to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Gesture control of application interface (Keras + CoreML)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487158/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Currently, the popularity of programs using artificial neural networks is growing, in connection with this there is a large number of technologies to simplify the work associated with them. </font><font style="vertical-align: inherit;">This article will describe one of the possible ways to implement the application with the introduction of such technologies.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What will our application do?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recognize two positions of the hand - fist and palm. </font><font style="vertical-align: inherit;">And depending on it, change the application interface elements.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lz/h9/ts/lzh9tsyz8civ6gtvlftpncmgk8c.gif" width="300"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What do we need?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To train our neural network, we will use the Keras library, we will implement the interface in the Swift programming language, and for the bundle we will use the Apple framework presented at WWDC'17 for working with machine learning technologies CoreML.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's start with the model of our ANN and its training</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we use the data in the form of images, we need a convolution base. </font><font style="vertical-align: inherit;">The Keras framework includes many pre-trained imageNet convolutional models, such as: Xception, ResNet50, MobileNetV2, DenseNet, NASNet, InceptionV3, VGG16, VGG19, and so on. </font><font style="vertical-align: inherit;">Our project will use the VGG16 model and it looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/an/lw/vd/anlwvdexab2gpbujezmfwzdmnow.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's create it: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/gs/eq/8jgseqm1niq5fkelies6yvbofja.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data preprocessing</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Before being transferred to the network, the data must be converted into a tensor with real numbers. </font><font style="vertical-align: inherit;">Currently, data is stored in the form of images, so they need to be prepared for transmission to the network by following these steps:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read image files;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decode images from the .PNG, .JPG format to the RGB pixel table;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convert them to tensors with real numbers;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Normalize values.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will also use the data extension to prevent retraining of the network and increase its accuracy. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5w/uu/ld/5wuuldnkttctesdyinujpunb9so.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we set up the model for training, run it using the model generator and save it. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/av/3b/kpav3bmnm93l8csqw1iwrwg6ohe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We trained our network, but the .h5 extension is not suitable for solving our problem. </font><font style="vertical-align: inherit;">Therefore, we should convert it to a view acceptable for CoreML, that is, to the .mlmodel format. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, install </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coremltools</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">$ pip install --upgrade coremltools</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And we transform our model:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vz/dx/p-/vzdxp-w9w3zdln-hpyghaahrw_s.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are writing an application</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We go in Xcode, create an application and first of all give permission to use the camera. To do this, go to info.plist and add the following lines to XML: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/3u/p7/px3up7u3cm4zcoc2ipobedi4lu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, go to the ViewController.swift file. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dj/ju/jt/djjujtwgpqenzxmr1f4bptprljk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, configure cameraInput and cameraOutput, add them to the session and run it to get the data stream. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/ls/8m/lsls8mxdn1rqg7rwm97reufg--i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Earlier we added the delagate method AVCaptureVideoDataOutputSampleBufferDelegate, which is called with every new frame received from the camera. Now we set the request in it and execute it. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/yz/ws/pxyzwsvthl_gxtiuo-rz-yleeis.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this method, we connect the WristModel.mlmodel model, which we transferred to our project: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0o/ix/v4/0oixv4_c2gx061t_6xlthd6t9ma.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also check its connection and asynchronously change the position of our square depending on the coefficient.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But our application will not work without preliminary processing of images entering the network, so we add it: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/gu/hb/uaguhbgedqwbkmoxjbzlc9qvf6m.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch the application: </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/4c/zz/q_/4czzq_audp7bdjtv7qwimom5-gm.gif" width="300"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hurray</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we managed to create control of the interface of our application using gestures. </font><font style="vertical-align: inherit;">Now you can use the full potential of ANN in your iOS applications. </font><font style="vertical-align: inherit;">Thank you for the attention!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of sources and literature</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keras.io</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apple.github.io/coremltools</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
3) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/company/mobileup/blog/332500</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
4) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developer.apple.com/documentation/coreml</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487138/index.html">Graph theory in machine learning for the smallest</a></li>
<li><a href="../en487140/index.html">Saving business logic in Swift Combine. Part 1</a></li>
<li><a href="../en487144/index.html">Test Jabra Panacast panoramic camera with a viewing angle of 180 ¬∞ (video)</a></li>
<li><a href="../en487146/index.html">ResizeObserver - a new powerful tool for working with adaptability</a></li>
<li><a href="../en487154/index.html">Exploration of the sand shader game Journey</a></li>
<li><a href="../en487162/index.html">Does modern businessmen and companies need privacy?</a></li>
<li><a href="../en487168/index.html">Toxic Grandfather Interface Tales ‚ÄúInstrumental Trash‚Äù (s1 e2)</a></li>
<li><a href="../en487172/index.html">Open course "Deep Learning in NLP" from the creators of DeepPavlov based on the course cs224n</a></li>
<li><a href="../en487174/index.html">Raise your Webogram instance with proxying via nginx</a></li>
<li><a href="../en487176/index.html">Hold COVID-19. All about pandemic air filtration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>