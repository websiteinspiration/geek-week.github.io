<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòó üèº üìï DBLog - uma estrutura comum para o Change Data Capture üë®‚Äçüë®‚Äçüë¶ üê∑ üëÜüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° a todos! Oferecemos a voc√™ a leitura do artigo, preparado especialmente para os alunos do curso "High Load Architect" .
 
 
 
 Introdu√ß√£o
 O rastr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DBLog - uma estrutura comum para o Change Data Capture</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/494784/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√° a todos! </font><font style="vertical-align: inherit;">Oferecemos a voc√™ a leitura do artigo, preparado especialmente para os alunos do curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"High Load Architect"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/0l/li/m7/0llim77k9jjhhp94nyd5qozgmxw.png"><br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O rastreamento de altera√ß√µes de dados (Change Data Capture, CDC) permite que voc√™ receba em tempo real as altera√ß√µes confirmadas no banco de dados e as distribua a v√°rios consumidores [1] [2]. O CDC est√° se tornando cada vez mais popular quando a sincroniza√ß√£o entre data warehousing heterog√™neo √© necess√°ria (por exemplo, MySQL e ElasticSearch) e √© uma alternativa aos m√©todos tradicionais, como transa√ß√µes de grava√ß√£o dupla e transa√ß√µes distribu√≠das [3] [4].</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fonte do CDC, em bancos de dados como MySQL e PostgreSQL, √© o log de transa√ß√µes (log de transa√ß√µes). Mas como os logs de transa√ß√µes geralmente s√£o truncados, eles podem n√£o conter todo o hist√≥rico de altera√ß√µes. Portanto, para obter o estado completo da fonte, precisamos de dumps. Examinamos v√°rios projetos de CDC de c√≥digo aberto, geralmente usando as mesmas bibliotecas, APIs de banco de dados e protocolos, e encontramos v√°rias limita√ß√µes neles que n√£o atendiam aos nossos requisitos. Por exemplo, parando o processamento de eventos de log at√© a conclus√£o do despejo (captura instant√¢nea de dados completos), a incapacidade de iniciar o despejo de despejo sob demanda ou implementa√ß√£o, afetando o tr√°fego de grava√ß√£o devido ao uso de bloqueios de tabela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso nos levou a desenvolver o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBLog.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com uma abordagem unificada para processar logs e despejos. </font><font style="vertical-align: inherit;">Para suport√°-lo, v√°rias fun√ß√µes devem ser implementadas no DBMS, que j√° est√£o no MySQL, PostgreSQL, MariaDB e v√°rios outros bancos de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns dos recursos do DBLog:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos de log s√£o processados ‚Äã‚Äãna ordem em que ocorrem.</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dumps podem ser feitos a qualquer momento</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para todas as tabelas, para uma tabela ou para chaves prim√°rias espec√≠ficas de uma tabela.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O processamento de log alterna com o processamento de dump, dividindo o dump em blocos. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, o processamento de log pode ocorrer em paralelo com o processamento de despejo. </font><font style="vertical-align: inherit;">Se o processo terminar, ele poder√° ser retomado ap√≥s o √∫ltimo bloco conclu√≠do sem precisar reiniciar novamente. </font><font style="vertical-align: inherit;">Tamb√©m permite ajustar a taxa de transfer√™ncia ao criar um dump e, se necess√°rio, interromper sua cria√ß√£o.</font></font></li>
<li><b>   </b>,          .</li>
<li><b>   </b>: ,     API.</li>
<li><b>     </b>.    ,           .</li>
</ul><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, discutimos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradu√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), uma plataforma para enriquecimento e sincroniza√ß√£o de dados. O objetivo da Delta √© sincronizar v√°rios armazenamentos de dados, onde um deles √© prim√°rio (por exemplo, MySQL) e os outros derivados (por exemplo, ElasticSearch). Um dos principais requisitos de desenvolvimento era um baixo atraso na propaga√ß√£o de altera√ß√µes da origem para os destinat√°rios, bem como uma alta disponibilidade do fluxo de eventos. Essas condi√ß√µes se aplicam independentemente de todos os armaz√©ns de dados serem usados ‚Äã‚Äãpor uma equipe ou se uma equipe possui os dados e a outra os consome. Em um artigo sobre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradu√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), tamb√©m descrevemos casos de uso que v√£o al√©m da sincroniza√ß√£o de dados, como o processamento de eventos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para sincronizar dados e processar eventos, al√©m de poder rastrear altera√ß√µes em tempo real, precisamos atender aos seguintes requisitos:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtendo o estado completo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As lojas derivadas (como ElasticSearch) devem finalmente armazenar o estado completo da fonte. </font><font style="vertical-align: inherit;">Implementamos isso atrav√©s de despejos do banco de dados original.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicie a recupera√ß√£o do estado a qualquer momento. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez de considerar o despejo como uma opera√ß√£o √∫nica apenas para inicializa√ß√£o prim√°ria, podemos faz√™-lo a qualquer momento: para todas as tabelas, para uma tabela ou para chaves prim√°rias espec√≠ficas. </font><font style="vertical-align: inherit;">Isso √© muito importante para a recupera√ß√£o de consumidores em casos de perda ou corrup√ß√£o de dados.</font></font></li>
<li><b>    - </b>.          . ,        (,    ).              - .  ,  -        .</li>
<li><b>    </b>.                          .     API,     , ,  .        ,          ,  ,  .</li>
<li><b>   </b>.     Netflix   ,   Kafka, SQS, Kinesis,     Netflix,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Keystone</a>.   ,           (,    ),      (,    ).           .        API.</li>
<li><b>   </b>.  Netflix  ,    (MySQL, PostgreSQL)  AWS RDS.        .</li>
</ul><br>
<br>
<h3> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinamos v√°rias solu√ß√µes de c√≥digo aberto existentes, incluindo: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxwell</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpinalTap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Yelp </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Streamer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debezium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Em termos de coleta de dados, todos eles funcionam de maneira semelhante, usando um log de transa√ß√µes. </font><font style="vertical-align: inherit;">Por exemplo, usando o protocolo de replica√ß√£o binlog no MySQL ou os slots de replica√ß√£o no PostgreSQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas ao processar despejos, eles t√™m pelo menos uma das seguintes limita√ß√µes:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pare de processar eventos de log ao criar um despejo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Como resultado, se o dump for grande, o processamento dos eventos de log ser√° interrompido por um longo per√≠odo. </font><font style="vertical-align: inherit;">Isso ser√° um problema se os consumidores confiarem em pequenos atrasos na propaga√ß√£o das altera√ß√µes.</font></font></li>
<li><b>     </b>.                .                (,   ElasticSearch)        .</li>
<li><b>      </b>.         .                    [5].          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a>,         .         . ,  PostgreSQL RDS        .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando fun√ß√µes espec√≠ficas do banco de dados</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Descobrimos que algumas solu√ß√µes usam recursos adicionais de banco de dados que n√£o est√£o presentes em todos os sistemas. </font><font style="vertical-align: inherit;">Por exemplo, usando o mecanismo blackhole no MySQL ou obtendo um instant√¢neo consistente de despejos atrav√©s de slots de replica√ß√£o no PostgreSQL. </font><font style="vertical-align: inherit;">Isso limita a reutiliza√ß√£o de c√≥digo entre diferentes bancos de dados.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, decidimos adotar uma abordagem diferente para trabalhar com despejos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eventos alternativos de log e despejo para que possam ser executados juntos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iniciar um despejo a qualquer momento;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o use bloqueios de mesa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o use recursos espec√≠ficos do banco de dados.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Framework DBLog</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBLog √© uma estrutura java para receber despejos e altera√ß√µes em tempo real. Os despejos s√£o executados em partes para que eles alternem com eventos em tempo real e n√£o atrasem seu processamento por um longo per√≠odo. Dumps podem ser feitos a qualquer momento atrav√©s da API. Isso permite que os consumidores obtenham o estado completo do banco de dados no est√°gio de inicializa√ß√£o ou posterior para recupera√ß√£o de desastres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao projetar a estrutura, pensamos em minimizar o impacto no banco de dados. Os despejos podem ser pausados ‚Äã‚Äãe retomados conforme necess√°rio. Isso funciona tanto para recupera√ß√£o de falhas quanto para parar se o banco de dados se tornar um gargalo. Tamb√©m n√£o bloqueamos tabelas para n√£o afetar as opera√ß√µes de grava√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O DBLog permite registrar eventos de v√°rias formas, inclusive em outro banco de dados ou atrav√©s da API. </font><font style="vertical-align: inherit;">Para armazenar o estado associado ao processamento de logs e despejos, bem como selecionar o n√≥ principal, usamos o Zookeeper. </font><font style="vertical-align: inherit;">Ao criar o DBLog, implementamos a capacidade de conectar v√°rios plug-ins, permitindo que voc√™ altere a implementa√ß√£o como desejar (por exemplo, substitua o Zookeeper por outra coisa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, consideramos com mais detalhes o processamento de logs e despejos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hist√≥rico</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A estrutura requer que o banco de dados registre eventos para cada linha alterada em tempo real, mantendo a ordem das confirma√ß√µes. A origem desses eventos √© assumida como o log de transa√ß√µes. O banco de dados os envia atrav√©s de um transporte que o DBLog pode usar. Para esse transporte, usamos o termo "log de altera√ß√µes". Um evento pode ser dos seguintes tipos: criar, criar, atualizar ou excluir. Para cada evento, as seguintes informa√ß√µes devem ser fornecidas: o n√∫mero de sequ√™ncia no log (n√∫mero de sequ√™ncia do log), o estado da coluna durante a opera√ß√£o e o esquema que foi aplicado no momento em que a opera√ß√£o foi executada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada altera√ß√£o √© serializada no formato de evento DBLog e enviada ao gravador, para posterior transfer√™ncia para a sa√≠da. </font><font style="vertical-align: inherit;">Enviar eventos ao gravador √© uma opera√ß√£o sem bloqueio, porque o gravador √© executado em um encadeamento separado e acumula eventos no buffer interno. </font><font style="vertical-align: inherit;">Eventos em buffer s√£o enviados na ordem em que foram recebidos. </font><font style="vertical-align: inherit;">A estrutura permite conectar um formatador personalizado para serializar eventos em um formato arbitr√°rio. </font><font style="vertical-align: inherit;">A sa√≠da √© uma interface simples que permite conectar-se a qualquer destinat√°rio, como um fluxo, data warehouse ou mesmo uma API.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lix√µes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os despejos s√£o necess√°rios porque os logs de transa√ß√µes t√™m um tempo de armazenamento limitado, o que impede que sejam usados ‚Äã‚Äãpara restaurar o conjunto de dados original completo. Os dumps s√£o criados em blocos (chunk) para que possam alternar com os eventos de log, permitindo que sejam processados ‚Äã‚Äãsimultaneamente. Para cada linha selecionada do bloco, um evento √© gerado e serializado no mesmo formato que o evento de log. Portanto, o consumidor n√£o precisa se preocupar com a ocorr√™ncia de um evento do log ou despejo. Eventos de log e eventos de despejo s√£o enviados para a sa√≠da atrav√©s do mesmo gravador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dumps podem ser agendados a qualquer momento atrav√©s da API para todas as tabelas, uma tabela ou para chaves prim√°rias espec√≠ficas da tabela. Um despejo da tabela √© realizado por blocos de um determinado tamanho. Voc√™ tamb√©m pode configurar um atraso no processamento de novos blocos, permitindo apenas eventos de log no momento. O tamanho e o atraso do bloco permitem equilibrar o processamento de eventos de log e dump. Ambas as configura√ß√µes podem ser alteradas em tempo de execu√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os blocos (bloco) s√£o selecionados ordenando a tabela em ordem crescente da chave prim√°ria e selecionando as linhas em que a chave prim√°ria √© maior que a √∫ltima chave prim√°ria do bloco anterior. O banco de dados √© necess√°rio para executar essa consulta com efici√™ncia, o que geralmente √© aplic√°vel aos sistemas que implementam uma varredura de intervalo em um intervalo de chaves prim√°rias.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ka/io/cc/kaioccujfq6yx3mcch7btisn-zo.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 1. Divis√£o da tabela com 4 colunas c1-c4 e c1 como a chave prim√°ria (pk). A chave prim√°ria de um tipo inteiro, tamanho do bloco 3. O bloco 2 √© selecionado pela condi√ß√£o c1&gt; 4. Os</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
blocos devem ser tomados de forma a n√£o atrasar o processamento dos eventos de log por um longo per√≠odo e salvar o hist√≥rico de altera√ß√µes para que a linha selecionada com o valor antigo n√£o possa sobrescrever o novo. evento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para poder selecionar os blocos sequencialmente, no registro de altera√ß√µes, criamos "marcas d'√°gua" reconhec√≠veis. </font><font style="vertical-align: inherit;">As marcas d'√°gua s√£o implementadas por meio de uma tabela no banco de dados de origem. </font><font style="vertical-align: inherit;">Esta tabela √© armazenada em um espa√ßo de nome especial para que n√£o haja conflitos com as tabelas de aplicativos. </font><font style="vertical-align: inherit;">Apenas uma linha com um valor UUID √© armazenada nela. </font><font style="vertical-align: inherit;">Uma marca d'√°gua √© criada quando esse valor muda para um UUID espec√≠fico. </font><font style="vertical-align: inherit;">A atualiza√ß√£o da linha leva a um evento de mudan√ßa, que finalmente recebemos atrav√©s do log de altera√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dumps com marca d'√°gua s√£o criados da seguinte maneira:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suspendemos temporariamente o processamento de eventos de log.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gere uma marca d'√°gua "baixa" atualizando a tabela de marcas d'√°gua.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciamos SELECT para o pr√≥ximo bloco e salvamos na mem√≥ria o resultado indexado pela chave prim√°ria.</font></font></li>
<li> ‚Äú‚Äù (high)  ,    .</li>
<li>    .         .</li>
<li>              ,     .</li>
<li>     ,     ,         .</li>
<li>   ,     1.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT deve retornar um estado que represente uma altera√ß√£o confirmada at√© um ponto no hist√≥rico. Ou, equivalente ao seguinte: SELECT √© executado em uma determinada posi√ß√£o do log de altera√ß√µes, levando em considera√ß√£o as altera√ß√µes at√© este ponto. Os bancos de dados geralmente n√£o fornecem informa√ß√µes sobre o tempo de execu√ß√£o de um SELECT (com exce√ß√£o do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A id√©ia principal de nossa abordagem √© que, no log de altera√ß√µes, definimos uma janela que garanta a preserva√ß√£o da posi√ß√£o SELECT no bloco. A janela √© aberta escrevendo a marca d'√°gua inferior, ap√≥s a qual SELECT √© executado, e a janela √© fechada escrevendo a marca d'√°gua superior. Como a posi√ß√£o exata do SELECT √© desconhecida, todas as linhas selecionadas que conflitam com os eventos de log nesta janela s√£o exclu√≠das. Isso garante que n√£o haja reescrita do hist√≥rico no log de altera√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que isso funcione, SELECT deve ler o estado da tabela a partir do momento da marca d'√°gua mais baixa ou mais tarde (√© permitido incluir as altera√ß√µes feitas ap√≥s a marca d'√°gua mais baixa e antes da leitura). Em geral, </font><b><font style="vertical-align: inherit;">SELECT</font></b><font style="vertical-align: inherit;"> √© necess√°rio para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ver as altera√ß√µes feitas antes de ser executado.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Chamamos isso de "leituras n√£o obsoletas". Al√©m disso, como a marca d'√°gua superior √© escrita depois, √© garantido que SELECT ser√° executado antes dela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As Figuras 2a e 2b ilustram o algoritmo de sele√ß√£o de blocos. Como exemplo, fornecemos uma tabela com chaves prim√°rias de k1 a k6. Cada entrada no log de altera√ß√µes representa um evento de cria√ß√£o, atualiza√ß√£o ou exclus√£o para a chave prim√°ria. A Figura 2a mostra a gera√ß√£o da marca d'√°gua e a sele√ß√£o de blocos (etapas 1 a 4). A atualiza√ß√£o da tabela de marca d'√°gua nas etapas 2 e 4 cria dois eventos de altera√ß√£o (magenta), que s√£o finalmente recebidos atrav√©s do log. Na Figura 2b, focamos nas linhas do bloco atual que s√£o removidas do conjunto de resultados com chaves prim√°rias que aparecem entre as marcas d'√°gua (etapas 5 a 7).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/3w/ej/8w3wej0evpfqtnpdkbozswm58yu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 2a - Algoritmo de marca d'√°gua para sele√ß√£o de blocos (etapas 1 a 4). </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sg/i5/9s/sgi59s3d8zgf-f2eusi2itklqyu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 2b - Algoritmo de marca d'√°gua para sele√ß√£o de blocos (etapas 5 a 7).</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que, entre as marcas d'√°gua inferior e superior, um grande n√∫mero de eventos pode aparecer no log se uma ou mais transa√ß√µes fizerem muitas altera√ß√µes de linha. </font><font style="vertical-align: inherit;">Por esse motivo, suspendemos a curto prazo o processamento do log nos est√°gios 2‚Äì4 para n√£o perder as marcas d'√°gua. </font><font style="vertical-align: inherit;">Portanto, o processamento de eventos de log pode ser retomado evento por evento, o que permite detectar marcas d'√°gua sem a necessidade de armazenar em cache os eventos de log do log. </font><font style="vertical-align: inherit;">O processamento do log √© suspenso apenas por um curto per√≠odo de tempo, pois as etapas 2 a 4 devem ser r√°pidas: atualizar as marcas d'√°gua √© uma opera√ß√£o de grava√ß√£o √∫nica e o SELECT √© executado com uma restri√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que a marca d'√°gua superior √© recebida na etapa 7, as linhas n√£o conflitantes do bloco s√£o transmitidas para a sa√≠da na ordem em que foram recebidas. </font><font style="vertical-align: inherit;">Esta √© uma opera√ß√£o sem bloqueio, porque o gravador √© executado em um encadeamento separado, o que permite retomar rapidamente o processamento do log ap√≥s a etapa 7. Depois disso, o processamento do log continua para eventos que ocorrem ap√≥s a marca d'√°gua superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Figura 2c mostra a ordem de grava√ß√£o para todo o bloco usando o mesmo exemplo das figuras 2a e 2b. </font><font style="vertical-align: inherit;">Os eventos no log que aparecem antes da marca d'√°gua superior s√£o registrados primeiro. </font><font style="vertical-align: inherit;">Em seguida, as linhas restantes do bloco resultam (magenta). </font><font style="vertical-align: inherit;">E, finalmente, os eventos que ocorrem ap√≥s a marca d'√°gua superior s√£o registrados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4y/er/et/4yeretd8vbgtxvbp7sm9ppdxe7m.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 2c - A ordem de grava√ß√£o da sa√≠da. </font><font style="vertical-align: inherit;">Tira altern√¢ncia com despejo.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bancos de dados suportados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar o DBLog, o banco de dados deve fornecer um log de altera√ß√µes como um hist√≥rico linear de altera√ß√µes confirmadas com leituras n√£o obsoletas. Essas condi√ß√µes s√£o atendidas por sistemas como MySQL, PostgreSQL, MariaDB, etc., portanto a estrutura pode ser usada da mesma maneira com esses bancos de dados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© agora, adicionamos suporte ao MySQL e PostgreSQL. Cada banco de dados usa suas pr√≥prias bibliotecas para receber eventos de log, pois cada um deles usa um protocolo propriet√°rio. Para o MySQL, usamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shyiko / mysql-binlog-connector</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que implementa o protocolo de replica√ß√£o de binlog. Para o PostgreSQL, h√° slots de replica√ß√£o com o plugin </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wal2json</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . As altera√ß√µes s√£o aceitas atrav√©s do protocolo de replica√ß√£o de streaming, que √© implementado pelo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">driver jdbc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL </font><font style="vertical-align: inherit;">A defini√ß√£o do esquema para cada altera√ß√£o capturada √© diferente no MySQL e no PostgreSQL. </font><font style="vertical-align: inherit;">No PostgreSQL, o wal2json cont√©m nomes, tipos de colunas e valores. </font><font style="vertical-align: inherit;">Para o MySQL, as mudan√ßas de esquema devem ser rastreadas como eventos binlog. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O processamento do dump foi realizado usando SQL e JDBC, exigindo apenas a implementa√ß√£o da sele√ß√£o de blocos e a atualiza√ß√£o da marca d'√°gua. </font><font style="vertical-align: inherit;">Para MySQL e PostgreSQL, o mesmo c√≥digo √© usado, que pode ser usado para outros bancos de dados semelhantes. </font><font style="vertical-align: inherit;">O processamento do dump em si n√£o depende de SQL ou JDBC e permite usar bancos de dados que atendem aos requisitos do DBLog, mesmo que eles usem padr√µes diferentes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/wg/nz/wuwgnzkxmagsrtt2_qnyp_yfiy8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 3 - Arquitetura de alto n√≠vel do DBLog.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alta disponibilidade</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O DBLog usa uma arquitetura passiva ativa de n√≥ √∫nico. </font><font style="vertical-align: inherit;">Uma inst√¢ncia √© ativa (principal), enquanto as outras s√£o passivas (em espera). </font><font style="vertical-align: inherit;">Para selecionar o host, usamos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zookeeper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Uma concess√£o √© usada para o n√≥ principal, que deve ser atualizado periodicamente para continuar sendo o principal. </font><font style="vertical-align: inherit;">Em caso de rescis√£o da renova√ß√£o do arrendamento, as fun√ß√µes do l√≠der s√£o transferidas para outro n√≥. </font><font style="vertical-align: inherit;">Atualmente, implantamos uma c√≥pia para cada AZ (zona de disponibilidade, geralmente temos 3 AZ); portanto, se um AZ cair, a c√≥pia em outro AZ poder√° continuar processando com um tempo de inatividade total m√≠nimo. </font><font style="vertical-align: inherit;">As inst√¢ncias de backup podem estar localizadas em diferentes regi√µes, embora seja recomend√°vel trabalhar na mesma regi√£o que o host do banco de dados para fornecer baixa lat√™ncia para capturar altera√ß√µes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso na produ√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBLog √© a base para os conectores MySQL e PostgreSQL usados ‚Äã‚Äãno </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Desde 2018, a Delta √© usada na produ√ß√£o para sincronizar data warehouses e processamento de eventos em aplicativos de est√∫dio da Netflix. </font><font style="vertical-align: inherit;">Os conectores Delta usam seu serializador de eventos. </font><font style="vertical-align: inherit;">Fluxos espec√≠ficos da Netflix, como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keystone,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o usados ‚Äã‚Äãcomo sa√≠da </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5g/3j/fo/5g3jfo6pe8l-mpsqrngh6ylvtyc.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 4 - Delta Connector. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do Delta, o DBLog tamb√©m √© usado na Netflix para criar conectores para outras plataformas de movimenta√ß√£o de dados que possuem seus pr√≥prios formatos de dados.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fique conosco</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O DBLog possui recursos adicionais que n√£o s√£o abordados neste artigo, como:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capacidade de obter esquemas de tabela sem usar bloqueios.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integra√ß√£o com armazenamento de esquema. </font><font style="vertical-align: inherit;">Para cada evento, o esquema √© armazenado no armazenamento, cujo link √© indicado na carga √∫til do evento.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo de grava√ß√£o monot√¥nica. </font><font style="vertical-align: inherit;">Garantindo que, ap√≥s salvar o estado de uma linha espec√≠fica, seu estado passado n√£o possa ser substitu√≠do. </font><font style="vertical-align: inherit;">Assim, os consumidores recebem mudan√ßas de estado apenas na dire√ß√£o para a frente, sem se mover para frente e para tr√°s no tempo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Planejamos abrir o c√≥digo-fonte DBLog em 2020 e incluir documenta√ß√£o adicional nele.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecimentos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gostar√≠amos de agradecer √†s seguintes pessoas por contribu√≠rem para o desenvolvimento do DBLog: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Josh Snyder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raghuram Onti Srinivasan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tharanga Gamaethige</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yun Wang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refer√™ncias</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[1] Das, Shirshanka, et al. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúTodos a bordo do Databus!: Plataforma consistente e escal√°vel de captura de dados de altera√ß√µes do Linkedin.‚Äù </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terceiro Simp√≥sio da ACM sobre Computa√ß√£o em Nuvem. </font><font style="vertical-align: inherit;">ACM, 2012 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[2] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúSobre o Change Data Capture (SQL Server)‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , documentos do Microsoft SQL, 2019 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[3] Kleppmann, Martin, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúUsando logs para criar uma infraestrutura de dados s√≥lida (ou: por que as grava√ß√µes duplas s√£o uma m√° ideia)‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Confluent, 2015 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[4] Kleppmann, Martin, Alastair R. Beresford, Boerge Svingen. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Processamento de eventos online." </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comunica√ß√µes do ACM 62.5 (2019): 43‚Äì49 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[5] </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://debezium.io/documentation/reference/0.10/connectors/mysql.html#snapshots </font></font><br>
</a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saiba mais sobre o curso.</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt494766/index.html">Tend√™ncias da tecnologia de comunica√ß√µes em um futuro pr√≥ximo</a></li>
<li><a href="../pt494772/index.html">Como est√° se desenvolvendo a luta contra chamadas rob√≥ticas nos EUA - sobre as medidas de pol√≠ticos e empresas de telecomunica√ß√µes</a></li>
<li><a href="../pt494776/index.html">Antipadr√µes do PostgreSQL: calculando condi√ß√µes no SQL</a></li>
<li><a href="../pt494780/index.html">Revela√ß√µes e medos de um funcion√°rio da Amazon na era do coronav√≠rus</a></li>
<li><a href="../pt494782/index.html">Classifique imagens no Android usando o TensorFlow Lite e o Azure Custom Vision</a></li>
<li><a href="../pt494786/index.html">Suporte a RTOS do tipo MitM no GDB</a></li>
<li><a href="../pt494788/index.html">Como o email funciona</a></li>
<li><a href="../pt494792/index.html">Yandex.Routing: como mergulhamos na log√≠stica e decidimos mudar o futuro</a></li>
<li><a href="../pt494794/index.html">Temos bra√ßos compridos</a></li>
<li><a href="../pt494798/index.html">Snowden: a pandemia terminar√°, mas a vigil√¢ncia da popula√ß√£o continuar√°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>