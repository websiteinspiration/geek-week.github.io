<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😊 🧗🏿 🥂 BpfTrace: finalmente, un reemplazo completo para Dtrace en Linux 🦅 😭 🔚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sucede que los sistemas tienen errores, se ralentizan, se descomponen. Cuanto más grande es el sistema, más difícil es encontrar la causa. Para averig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>BpfTrace: finalmente, un reemplazo completo para Dtrace en Linux</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/500456/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sucede que los sistemas tienen errores, se ralentizan, se descomponen. </font><font style="vertical-align: inherit;">Cuanto más grande es el sistema, más difícil es encontrar la causa. </font><font style="vertical-align: inherit;">Para averiguar por qué algo no funciona como se esperaba, para solucionar o prevenir problemas futuros, debe mirar dentro. </font><font style="vertical-align: inherit;">Para esto, los sistemas deben poseer la propiedad de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">observabilidad</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se logra mediante instrumentación en el sentido amplio de la palabra.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/6ExXwQecMrs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peter Zaitsev (Percona) revisó la infraestructura disponible para el rastreo en Linux y habló sobre bpfTrace, que (como su nombre lo indica) ofrece muchas ventajas. </font><font style="vertical-align: inherit;">Creamos una versión de texto del informe, por lo que sería conveniente para usted revisar los detalles y los materiales adicionales siempre estuvieron a la mano.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La instrumentación se puede dividir en dos grandes bloques:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estático</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuando la recopilación de información está conectada al código: registro de registros, contadores, tiempo, etc.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dinámico</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuando el código no está instrumentado por sí mismo, pero es posible hacerlo cuando sea necesario.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra opción de clasificación se basa en el enfoque para registrar datos:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguimiento</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : los eventos se generan si un determinado código ha funcionado.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muestreo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : se verifica el estado del sistema, por ejemplo, 100 veces por segundo y determina lo que está sucediendo en él.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La instrumentación estática ha existido durante muchos años y está en casi todo. </font><font style="vertical-align: inherit;">En Linux, muchas herramientas estándar como Vmstat o top lo usan. </font><font style="vertical-align: inherit;">Leen datos de procfs, donde, en términos generales, se escriben diferentes temporizadores y contadores desde el código del núcleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no puede insertar muchos de estos contadores; no puede cubrir todo en el mundo con ellos. </font><font style="vertical-align: inherit;">Por lo tanto, la instrumentación dinámica puede ser útil, lo que le permite ver exactamente lo que necesita. </font><font style="vertical-align: inherit;">Por ejemplo, si hay algún problema con la pila TCP / IP, puede profundizar e instruir detalles específicos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/nh/hz/x8nhhza-v08u7nlo01rb778nxqs.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dtrace</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DTrace es uno de los primeros marcos de seguimiento dinámico conocidos creados por Sun Microsystems. Comenzó a fabricarse en 2001 y, por primera vez, se lanzó en Solaris 10 en 2005. El enfoque resultó ser muy popular y luego entró en muchas otras distribuciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, DTrace le permite instrumentar tanto el espacio del kernel como el espacio del usuario. Puede colocar rastreos en cualquier llamada a funciones e instruir específicamente a los programas: introduzca puntos de rastreo DTrace especiales, que para los usuarios pueden ser más comprensibles que los nombres de funciones.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto fue especialmente importante para Solaris, porque no es un sistema operativo abierto. No fue posible simplemente mirar el código y comprender que el punto de rastreo debe ponerse en una función como ahora se puede hacer en el nuevo software Linux de código abierto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las características únicas, especialmente en ese momento, de DTrace es que </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si bien el rastreo no está habilitado, no cuesta nada</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Funciona de tal manera que simplemente reemplaza algunas instrucciones de la CPU con una llamada DTrace, que ejecuta estas instrucciones cuando regresa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En DTrace, la instrumentación está escrita en un lenguaje D especial, similar a C y Awk.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Más tarde, DTrace apareció en casi todas partes, excepto Linux: en MacOS en 2007, en FreeBSD en 2008, en NetBSD en 2010. Oracle en 2011 incluyó DTrace en Oracle Unbreakable Linux. </font><font style="vertical-align: inherit;">Pero pocas personas usan Oracle Linux, y DTrace nunca ingresó al Linux principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, en 2017, Oracle finalmente otorgó la licencia de DTrace bajo GPLv2, lo que en principio permitió incluirlo en Linux principal sin dificultades de licencia, pero ya era demasiado tarde. </font><font style="vertical-align: inherit;">En ese momento, Linux tenía un buen BPF, que se usaba principalmente para la estandarización. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DTrace incluso se incluirá en Windows; ahora está disponible en algunas versiones de prueba.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rastreo de Linux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Qué hay en Linux en lugar de DTrace? </font><font style="vertical-align: inherit;">De hecho, en Linux hay muchas cosas en la mejor (o peor) manifestación del espíritu de código abierto, a lo largo de este tiempo se han acumulado varios marcos de rastreo diferentes. </font><font style="vertical-align: inherit;">Por lo tanto, descubrir qué es lo que no es tan simple. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wr/vu/ij/wrvuijy1unvtq2thcngvonvzsrq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea familiarizarse con esta variedad y está interesado en la historia, consulte el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artículo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con imágenes y una descripción detallada de los enfoques para el rastreo en Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hablamos de la infraestructura para el rastreo en Linux en general, hay tres niveles:</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfaz para instrumentación de kernel:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kprobe, Uprobe, sonda Dtrace, etc.</font></font></li>
<li><strong>«»,    .</strong> ,  probe,      ,          user space   .       :   ,     user space,  Kernel Module,   - ,  eBPF.</li>
<li><strong>-</strong>,    ,    : Perf, SystemTap, SysDig, BCC  .. bpfTtrace       ,  ,   .</li>
</ol><br>
<h2>eBPF —   Linux</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con todos estos marcos, eBPF se ha convertido en el estándar en Linux en los últimos años. </font><font style="vertical-align: inherit;">Esta es una herramienta más avanzada, altamente flexible y efectiva que permite casi todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Qué es eBPF y de dónde vino? </font><font style="vertical-align: inherit;">De hecho, eBPF es un filtro de paquetes de Berkeley extendido, y BPF se desarrolló en 1992 como una máquina virtual para el filtrado eficiente de paquetes por un firewall. </font><font style="vertical-align: inherit;">Inicialmente, no tenía relación con el monitoreo, la observabilidad o el rastreo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En versiones más modernas, eBPF se ha ampliado (de ahí la palabra extendida), como un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marco</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> común </font><strong><font style="vertical-align: inherit;">para el manejo de eventos</font></strong><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Las versiones actuales están integradas con el compilador JIT para una mayor eficiencia. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diferencias de eBPF de BPF clásico:</font></font></strong><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registros agregados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha aparecido una pila;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay estructuras de datos adicionales (mapas).</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/gj/9v/uh/gj9vuhqn64yciwp2zyjmekazpvs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora la gente olvida con mayor frecuencia que había un BPF antiguo, y eBPF simplemente se llama BPF. </font><font style="vertical-align: inherit;">En la mayoría de las expresiones modernas, eBPF y BPF son lo mismo. </font><font style="vertical-align: inherit;">Por lo tanto, la herramienta se llama bpfTrace, no eBpfTrace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
eBPF se ha incluido en la línea principal de Linux desde 2014 y se incluye gradualmente en muchas herramientas de Linux, incluidas Perf, SystemTap, SysDig. </font><font style="vertical-align: inherit;">Hay una estandarización. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, el desarrollo aún está en marcha. </font><font style="vertical-align: inherit;">Los núcleos modernos soportan eBPF cada vez mejor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f9/ad/xi/f9adxi6tahas6qaz0crpgc4fldk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedes ver qué versiones modernas del kernel han aparecido </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programas EBPF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ¿qué es eBPF y por qué es interesante? </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eBPF es un programa en su código de bytes especial</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se incluye directamente en el núcleo y realiza el procesamiento de eventos de rastreo. Además, el hecho de que esté hecho en un código de bytes especial permite que el núcleo realice cierta verificación de que el código es bastante seguro. Por ejemplo, verifique que no use bucles, porque el bucle en la sección crítica del núcleo puede colgar todo el sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero esto no permite ser completamente seguro. Por ejemplo, si escribe un programa eBPF muy complejo, insértelo en un evento en el núcleo que ocurra 10 millones de veces por segundo, entonces todo se puede ralentizar mucho. Pero al mismo tiempo, eBPF es mucho más seguro que el enfoque anterior, cuando solo se insertaron algunos módulos de kernel a través de insmod, y cualquier cosa podría estar en estos módulos. Si alguien cometió un error, o simplemente debido a la incompatibilidad binaria, todo el núcleo podría caerse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LLVM Clang puede compilar el código eBPF, es decir, en general, usar un subconjunto de C para crear programas eBPF, lo que, por supuesto, es bastante complicado. Y es importante que la compilación dependa del núcleo: los encabezados se usan para comprender qué estructuras se usan y para qué se usan, etc. Esto no es muy conveniente en el sentido de que algunos módulos relacionados con un núcleo específico siempre se suministran o necesitan ser recompilados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El diagrama muestra cómo funciona eBPF. </font></font><br>
<img src="https://habrastorage.org/webt/vf/f6/fq/vff6fqzhay_0tskbjguckrqe6e4.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.brendangregg.com/ebpf.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El usuario crea un programa eBPF. Además, el núcleo, por su parte, lo comprueba y lo carga. Después de eso, eBPF puede conectarse a varias herramientas para rastrear, procesar información, guardarla en mapas (estructura de datos para almacenamiento temporal). Luego, el programa de usuario puede leer estadísticas, recibir eventos de rendimiento, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muestra qué características de eBPF en qué versiones de kernels de Linux. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/ck/gr/cyckgrqgpnhpfmbg2wptd77b1q0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se puede ver que casi todos los subsistemas del kernel de Linux están cubiertos, además de que hay una buena integración con los datos del hardware, eBPF tiene acceso a todo tipo de predicción de pérdida de caché o de rama, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si está interesado en eBPF, consulte el proyecto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IO Visor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, contiene la mayoría de las herramientas. </font><font style="vertical-align: inherit;">La compañía IO Visor se dedica a su desarrollo, tendrán las últimas versiones y muy buena documentación. </font><font style="vertical-align: inherit;">Cada vez aparecen más herramientas eBPF en las distribuciones de Linux, por lo que recomendaría que siempre use las últimas versiones disponibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendimiento EBPF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En términos de rendimiento, eBPF es bastante efectivo. </font><font style="vertical-align: inherit;">Para comprender cuánto y si hay gastos generales, puede agregar una sonda, que se mueve varias veces por segundo, y verificar cuánto tiempo se tarda en ejecutarla. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/jb/tq/rbjbtq7wvfiqdggh5bohn0dcaxc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los chicos de Cloudflare hicieron un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">punto de referencia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Una simple sonda eBPF les tomó alrededor de 100 ns, mientras que una más compleja tomó 300 ns. </font><font style="vertical-align: inherit;">Esto significa que incluso una sonda compleja puede activarse en un solo núcleo aproximadamente 3 millones de veces por segundo. </font><font style="vertical-align: inherit;">Si la sonda se mueve 100 mil o un millón de veces por segundo en un procesador multinúcleo, esto no afectará demasiado el rendimiento.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frontend para eBPF</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si está interesado en eBPF y el tema de la Observabilidad en general, probablemente haya oído hablar de Brendan Gregg. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y habla </font><font style="vertical-align: inherit;">mucho sobre esto </font><font style="vertical-align: inherit;">e hizo una imagen tan hermosa que muestra herramientas para eBPF. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/-o/fi/da-ofi9xtmuvnkvygmbhzdftz00.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí puede ver que, por ejemplo, puede usar Raw BPF, solo escriba bytecode, esto le dará una gama completa de características, pero será muy difícil trabajar con él. Raw BPF trata sobre cómo escribir una aplicación web en ensamblador; en principio, es posible, pero sin la necesidad de hacerlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, bpfTrace, por un lado, le permite obtener casi todo de BCC y BPF sin procesar, pero es mucho más fácil de usar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi opinión, dos herramientas son las más útiles:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCC </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pesar del hecho de que de acuerdo con el esquema de Gregg, BCC es complejo, incluye </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muchas funciones listas para</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usar que simplemente se pueden iniciar desde la línea de comandos.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BpfTrace</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le permite simplemente escribir su propio kit de herramientas o usar soluciones preparadas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedes imaginar lo fácil que es escribir en bpfTrace si miras el código de la misma herramienta en dos versiones.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/yj/rg/dfyjrg8q4abkcjgcsnp00vuuymg.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTrace vs bpfTrace</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, DTrace y bpfTrace se usan para lo mismo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rh/uo/rm/rhuormrzvwap7cr3uwlqk8hcnqu.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.brendangregg.com/blog/2018-10-08/dtrace-for-linux-2018.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La diferencia es que también hay un BCC en el ecosistema BPF que puede usarse para herramientas complejas. </font><font style="vertical-align: inherit;">No hay un equivalente de BCC en DTrace, por lo tanto, para hacer kits de herramientas complejos, generalmente use el paquete Shell + DTrace.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al crear bpfTrace, no había tarea para emular completamente DTrace. Es decir, no puede tomar un script DTrace y ejecutarlo en bpfTrace. Pero esto no tiene mucho sentido, porque la lógica en las herramientas de nivel inferior es bastante simple. Por lo general, es más importante comprender a qué puntos de rastreo necesita conectarse, y los nombres de las llamadas al sistema y lo que hacen directamente a un nivel bajo difieren en Linux, Solaris, FreeBSD. Ahí es donde surge la diferencia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, bpfTrace se realiza 15 años después de DTrace. Tiene algunas características adicionales que DTrace no tiene. Por ejemplo, puede hacer rastros de pila. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, por supuesto, mucho se hereda de DTrace. Por ejemplo, los </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombres de funciones y la sintaxis son similares</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aunque no completamente equivalentes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9l/cf/0z/9lcf0z37mltxok_7fsdvdhxanv8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los scripts DTrace y bpfTrace tienen un tamaño de código cercano y una complejidad similar y capacidades de lenguaje similares.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/ud/br/reudbrcb_yoslb9ylo0loe9e-os.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bpfTrace</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos con más detalle qué hay en bpfTrace, cómo se puede usar y qué se necesita para esto. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos de Linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para usar bpfTrace: </font></font><br>
<img src="https://habrastorage.org/webt/1_/sc/tk/1_sctkrpgkd3rd2b0ccrk4fur2y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar todas las funciones, necesita una versión de al menos 4.9. </font><font style="vertical-align: inherit;">BpfTrace le permite hacer muchas sondas diferentes, comenzando con uprobe para instrumentar una llamada de función en una aplicación de usuario, sondas de kernel, etc.</font></font><br>
<img src="https://habrastorage.org/webt/la/v4/zq/lav4zqiss3uj4a42cx9lf5cu9hs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, hay una sonda de uret equivalente para una función de levantamiento personalizada. Para kernel, lo mismo es kprobe y kretprobe. Esto significa que, de hecho, en el marco de seguimiento puede generar eventos cuando se llama a la función y una vez completada esta función, esto se usa a menudo para la temporización. O puede analizar los valores que devolvió la función y agruparlos de acuerdo con los parámetros con los que se llamó a la función. Si captura una llamada de función y regresa de ella, puede hacer muchas cosas interesantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dentro de bpfTrace funciona así: escribimos un programa bpf que se analiza, se convierte a C, luego se procesa a través de Clang, que genera el código de byte bpf, luego de lo cual se carga el programa.</font></font><br>
<img src="https://habrastorage.org/webt/2r/my/_i/2rmy_ipzm97oydg5q8xdltdbchs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El proceso es bastante difícil, por lo que hay limitaciones. </font><font style="vertical-align: inherit;">En servidores potentes, bpfTrace funciona bien. </font><font style="vertical-align: inherit;">Pero arrastrar Clang a un pequeño dispositivo integrado para descubrir qué está pasando no es una buena idea. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ply es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adecuado para esto </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por supuesto, no tiene todas las características de bpfTrace, pero genera bytecode directamente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte de Linux</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hace aproximadamente un año se lanzó una versión estable de bpfTrace, por lo que no está disponible en distribuciones de Linux anteriores. </font><font style="vertical-align: inherit;">Es mejor tomar paquetes o compilar la última versión que distribuye IO Visor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, el último Ubuntu LTS 18.04 no tiene bpfTrace, pero puede entregarse usando el paquete snap. </font><font style="vertical-align: inherit;">Por un lado, esto es conveniente, pero por otro lado, debido a la forma en que se hacen y aíslan los paquetes a presión, no todas las funciones funcionarán. </font><font style="vertical-align: inherit;">Para el rastreo del kernel, un paquete con snap funciona bien; para el rastreo del usuario, puede que no funcione correctamente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d3/si/co/d3sicofnas8mpwyrsvmkp1kdbvm.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de rastreo de procesos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere el ejemplo más simple que le permite obtener estadísticas sobre las solicitudes de E / S:</font></font><br>
<br>
<pre><code class="bash hljs">bpftrace -e <span class="hljs-string">'kprobe:vfs_read { @start[tid] = nsecs; }
kretprobe:vfs_read /@start[tid]/ { @ns[comm] = hist(nsecs - @start[tid]); delete(@start[tid]); }'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí nos conectamos a la función </font></font><code>vfs_read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tanto kretprobe como kprobe. </font><font style="vertical-align: inherit;">Además, para cada ID de subproceso (tid), es decir, para cada solicitud, rastreamos el comienzo y el final de su ejecución. </font><font style="vertical-align: inherit;">Los datos se pueden agrupar no solo por la totalidad del sistema completo, sino también por diferentes procesos. </font><font style="vertical-align: inherit;">A continuación se muestra la salida IO para MySQL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e1/dx/om/e1dxomau1ormvas-7juk1as0sqy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La distribución de E / S bimodal clásica es visible. </font><font style="vertical-align: inherit;">Una gran cantidad de solicitudes rápidas son datos que se leen del caché. </font><font style="vertical-align: inherit;">El segundo pico es leer datos del disco, donde la latencia es mucho mayor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede guardar esto como un script (generalmente se usa la extensión bt), escribir comentarios, formatearlo y simplemente usarlo más </font></font><code>#bpftrace read.bt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="bash hljs">// read.bt file<font></font>
tracepoint:syscalls:sys_enter_read<font></font>
{<font></font>
  @start[tid] = nsecs;<font></font>
}<font></font>
tracepoint:syscalls:sys_exit_read / @start[tid]/ <font></font>
{<font></font>
  @<span class="hljs-built_in">times</span> = hist(nsecs - @start[tid]);<font></font>
  delete(@start[tid]);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El concepto general del lenguaje es bastante simple.</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sintaxis:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seleccione la sonda para conectar </font></font><code>probe[,probe,...] /filter/ { action }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtro:</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especifique un filtro, por ejemplo, solo datos en un proceso dado de un Pid dado.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acción: un</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mini programa que se convierte directamente en un programa bpf y se ejecuta cuando se llama a bpfTrace.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Más detalles se pueden encontrar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Herramientas bpftrace</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BpfTrace también tiene una caja de herramientas. </font><font style="vertical-align: inherit;">Muchas herramientas bastante simples en BCC ahora se implementan en bpfTrace. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/sr/f1/dzsrf1-klsvpjawbgtdzffgegra.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La colección</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aún es pequeña, pero hay algo que no está en el BCC. </font><font style="vertical-align: inherit;">Por ejemplo, killsnoop le permite rastrear las señales causadas por kill (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si está interesado en mirar el código bpf, en bpfTrace puede </font></font><code>-v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ver el código de byte generado. </font><font style="vertical-align: inherit;">Esto es útil si desea comprender una sonda pesada o no. </font><font style="vertical-align: inherit;">Después de mirar el código y solo haber estimado su tamaño (una o dos páginas), puedes entender lo complicado que es.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fo/sr/zg/fosrzgluhzrwsysvgvtsrkth8qe.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de rastreo de MySQL</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Déjame mostrarte un ejemplo de MySQL, cómo funciona. </font><font style="vertical-align: inherit;">MySQL tiene una función </font></font><code>dispatch_command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la cual ocurren todas las ejecuciones de consultas MySQL.</font></font><br>
<br>
<pre><code class="bash hljs">bpftrace -e <span class="hljs-string">'uprobe:/usr/sbin/mysqld:dispatch_command { printf("%s\n", str(arg2)); }'</span>
failed to <span class="hljs-built_in">stat</span> uprobe target file /usr/sbin/mysqld: No such file or directory</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo quería conectar un uprobe para imprimir el texto de las consultas que llegan a MySQL, una tarea primitiva. </font><font style="vertical-align: inherit;">Tengo un problema: dice que no existe tal archivo. </font><font style="vertical-align: inherit;">Como no cuando aquí está:</font></font><br>
<br>
<pre><code class="xml hljs">root@mysql1:/# ls -la /usr/sbin/mysqld<font></font>
-rwxr-xr-x 1 root root 60718384 Oct 25 09:19 /usr/sbin/mysqld</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas son solo sorpresas con snap. </font><font style="vertical-align: inherit;">Si se establece mediante snap, puede haber problemas a nivel de aplicación. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego instalé a través de la versión apt, una nueva Ubuntu, comencé de nuevo:</font></font><br>
<br>
<pre><code class="xml hljs">root@mysql1:~# bpftrace -e 'uprobe:/usr/sbin/mysqld:dispatch_command { printf("%s\n", str(arg2)); }'<font></font>
Attaching 1 probe...<font></font>
Could not resolve symbol: /usr/sbin/mysqld:dispatch_command</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"No hay tal símbolo" - ¿cómo no? </font><font style="vertical-align: inherit;">Miro </font></font><code>nm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si hay tal símbolo o no:</font></font><br>
<br>
<pre><code class="xml hljs">root@mysql1:~# nm -D /usr/sbin/mysqld | grep dispatch_command<font></font>
00000000005af770 T <font></font>
_Z16dispatch_command19enum_server_commandP3THDPcjbb<font></font>
<font></font>
root@localhost:~# bpftrace -e 'uprobe:/usr/sbin/mysqld:_Z16dispatch_command19enum_server_commandP3THDPcjbb { printf("%s\n", str(arg2)); }'<font></font>
Attaching 1 probe...<font></font>
select @@version_comment limit 1<font></font>
select 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe dicho símbolo, pero dado que MySQL se compila a partir de C ++, allí se usa la manipulación. </font><font style="vertical-align: inherit;">De hecho, el nombre actual de la función que se utiliza en esta orden, los siguientes: </font></font><code>_Z16dispatch_command19enum_server_commandP3THDPcjbb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si lo usa en una función, puede conectarse y obtener el resultado. </font><font style="vertical-align: inherit;">En el ecosistema de perf, muchas herramientas hacen que la eliminación automática se realice automáticamente, y bpfTrace aún no es capaz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
También preste atención a la bandera </font></font><code>-D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para </font></font><code>nm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es importante porque MySQL, y ahora muchos otros paquetes, vienen sin símbolos dinámicos (símbolos de depuración); vienen en otros paquetes. </font><font style="vertical-align: inherit;">Si desea utilizar estos caracteres, necesita una bandera </font></font><code>-D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, de lo contrario nm no los verá.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlaces útiles</font></font></b>
                        <div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/zoidbergwill/awesome-ebpf</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">slideplayer.com/slide/12710510</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.brendangregg.com/ebpf.html</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vger.kernel.org/netconf2018_files/BrendanGregg_netconf2018.pdf</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.brendangregg.com/Slides/Velocity2017_BPF_superpowers.pdf</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lwn.net/Articles/740157</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tracingsummit.org/w/images/8/82/Tracingsummit2018-bpftrace-robertson.pdf</a></li>
</ul></div>
                    </div><br>
<blockquote><i>   :</i>  ++ 25–26    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>        ,     .    ,       ,            . <br>
<br>
<i>   :</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">++ Online</a>   .       5 900        ,      ,        -.<br>
<br>
<i>   :</i>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DevOpsConf 2019</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HighLoad++ 2019</a> —   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>. <br>
<br>
       — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>, . </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es500446/index.html">Algunas palabras sobre R2DBC y PostgreSQL</a></li>
<li><a href="../es500448/index.html">Prometheus: monitoreo HTTP a través del exportador Blackbox</a></li>
<li><a href="../es500450/index.html">Hacer un teclado MIDI a partir de un sintetizador para niños viejos</a></li>
<li><a href="../es500452/index.html">Alto razonamiento en aprendizaje profundo</a></li>
<li><a href="../es500454/index.html">"¿Qué puertos deportivos?" o controlamos el controlador a través de bluetooth usando una aplicación móvil en Xamarin (Android)</a></li>
<li><a href="../es500458/index.html">Características técnicas del discurso en línea: paquete de inicio</a></li>
<li><a href="../es500462/index.html">Detectar cambios de escena y guardar videoclips h264 en Raspberry Pi sin decodificar</a></li>
<li><a href="../es500468/index.html">Guía de características de Java 8-14</a></li>
<li><a href="../es500470/index.html">Adaptando su solución comercial existente para SwiftUI. Parte 3. Trabajando con arquitectura</a></li>
<li><a href="../es500472/index.html">Python es hora de hacer espacio. Sobre las perspectivas de Julia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>