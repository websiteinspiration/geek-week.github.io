<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ø üë©üèª‚Äçüç≥ üí≥ Membuat Viberbot lengkap di Django 2 dan API Viber REST. Bagian Satu - Webhook üí≠ üôÖüèæ üè¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instal Webhook untuk bot agar berfungsi di viber dan kirim permintaan POST pertama ke messenger backend
 Berdasarkan pengalaman saya dalam mengembangk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Membuat Viberbot lengkap di Django 2 dan API Viber REST. Bagian Satu - Webhook</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486826/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal Webhook untuk bot agar berfungsi di viber dan kirim permintaan POST pertama ke messenger backend</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berdasarkan pengalaman saya dalam mengembangkan untuk Viber dan banyak pendapat yang beragam, saya menerbitkan serangkaian artikel tentang membuat dan meluncurkan viberbot. Untuk memahami gambaran lengkap secara keseluruhan, kami akan bekerja dengan VIBER REST API yang bersih, tanpa pembungkus apa pun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Radio Viber terbukti terlalu non-standar, jadi kami akan membuat bot dialog klasik ( </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ribuan di antaranya telah bercerai dalam telegram</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada saat yang sama, kita akan melihat semua kelemahan dan keuntungan botviber dan memahami: apa yang lebih mudah di Rusia - botviber VS bottelegram, perbedaan utama antara pengembangan bot platform ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/k4/py/cik4pyycxovsxsmki6rjrtupv6a.jpeg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan seperangkat metode yang lebih sedikit daripada di keranjang - namun, di Viber Anda dapat membuat antarmuka UI yang jauh lebih efektif dan tidak membatasi diri Anda pada </font><font style="vertical-align: inherit;">warna </font><font style="vertical-align: inherit;">abu </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> abu </font><s><font style="vertical-align: inherit;">kusam</font></s><font style="vertical-align: inherit;"> dari tombol menu dan tombol sebaris.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini lebih ditargetkan untuk pemula yang tidak berhasil berurusan dengan API Viber REST. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam sebulan, 1-2 tutorial per minggu, siapa pun yang ingin mempelajari cara membuat bot pada messenger Viber, dengan panel admin pribadi, alat distribusi pesan massal, tanpa perancang dan platform. </font><font style="vertical-align: inherit;">Kami juga membuat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">halaman minilanding</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (seperti bot telegram) untuk mencari dan mempromosikan bot Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya merekomendasikan mempelajari Django secara paralel, yang belum memulai, dan fitur karyanya dalam mode pengembangan dan produksi.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bot tidak cukup - maka mari kita mulai</font></font></h4><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Instal dan jalankan Django&gt; = 2.1 dan Python&gt; = 3.6. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 buat aplikasi myviberbot menggunakan perintah standar manajer Django:</font></font><br>
 <br>
<pre><code class="plaintext hljs">python manage.py startapp myviberbot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan lupa untuk menambahkannya ke file settings.py di bagian ini:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    settings.py </span><font></font>
<font></font>
DEBUG = <span class="hljs-literal">True</span><font></font>
<font></font>
ALLOWED_HOSTS = [<span class="hljs-string">'*'</span>]<font></font>
<font></font>
<span class="hljs-comment"># Application definition</span><font></font>
<font></font>
INSTALLED_APPS = [<font></font>
    <span class="hljs-string">'django.contrib.admin'</span>,
    <span class="hljs-string">'django.contrib.auth'</span>,
    <span class="hljs-string">'django.contrib.contenttypes'</span>,
    <span class="hljs-string">'django.contrib.sessions'</span>,
    <span class="hljs-string">'django.contrib.messages'</span>,
    <span class="hljs-string">'django.contrib.staticfiles'</span>,
    <span class="hljs-string">'myviberbot'</span>, <span class="hljs-comment">#    </span><font></font>
]<font></font>
<span class="hljs-comment">#</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan saya menautkan domain HTTPS saya dan saya ingin menginstal webhook untuk viber-bot di: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yourdomain.ru/webhook2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dan Anda mengubah domaindomain.ru ke domain Anda, tentu saja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami akan menangani semua acara di fungsi def trx_bot () dari myviberbot.views - tetapi lebih lanjut tentang itu ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, kami akan membuat koreksi yang sesuai dengan file urls.py dalam daftar isinya lengkap:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># urls.py</span>
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path
<span class="hljs-keyword">from</span> myviberbot.views <span class="hljs-keyword">import</span> trx_bot
<span class="hljs-keyword">from</span> django.conf <span class="hljs-keyword">import</span> settings
<span class="hljs-keyword">from</span> django.conf.urls.static <span class="hljs-keyword">import</span> static<font></font>
<font></font>
urlpatterns = [<font></font>
    path(<span class="hljs-string">'admin/'</span>, admin.site.urls),<font></font>
    path(<span class="hljs-string">'webhook2020'</span>, trx_bot), <span class="hljs-comment">#url    - webhook2020, </span>
<span class="hljs-comment">#  ,   </span><font></font>
    ]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tidak masuk jauh ke dalam seluk-beluk Django, di sini, dalam kode di atas, kami benar-benar mengirim semua permintaan (permintaan) ke webhook2020 ke fungsi trx_bot, yang terletak di folder proyek myviberbot di file views.py. </font><font style="vertical-align: inherit;">Pertimbangkan di bawah ini.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># views.py   myviberbot</span><font></font>
<font></font>
<span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> HttpResponse
<span class="hljs-keyword">from</span> django.views.decorators.csrf <span class="hljs-keyword">import</span> csrf_exempt<font></font>
<font></font>
<span class="hljs-meta">@csrf_exempt</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trx_bot</span>(<span class="hljs-params">request</span>):</span>
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">"POST"</span>:<font></font>
        viber = json.loads(request.body.decode(<span class="hljs-string">'utf-8'</span>))
        <span class="hljs-keyword">if</span> viber[<span class="hljs-string">'event'</span>] == <span class="hljs-string">'webhook'</span>:<font></font>
            print(viber)<font></font>
            print(<span class="hljs-string">"Webhook  "</span>) <span class="hljs-comment"># -    </span>
<span class="hljs-comment">#       webhook</span>
            <span class="hljs-keyword">return</span> HttpResponse(status=<span class="hljs-number">200</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"  Webhook -   ,   POSTMAN"</span>) 
            <span class="hljs-keyword">return</span> HttpResponse(status=<span class="hljs-number">500</span>)
        <span class="hljs-keyword">return</span> HttpResponse(status=<span class="hljs-number">200</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menerima 200 OK dari kami, server backend viber siap bekerja dengan kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda akan melihat pesan yang datang ke messenger Anda di chat bot Anda (fungsi dialog ditambahkan atau Chat 1to1 ditambahkan). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi bagaimana cara mengirim permintaan POST ke backend Viber atau menginstal Webhook - pertanyaan ini membuat khawatir banyak orang yang terbiasa bekerja dengan telegram menggunakan metode get, tetapi tidak apa-apa - kami dengan cermat membaca: </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Saya yakin bahwa pada titik ini, Anda telah menerima token bot </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan menyebarkan aplikasi Django di hosting ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VDS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dibagikan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) atau di lingkungan lokal (dalam hal ini, terowongan sementara ngrok akan membantu), </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a) Jika kami menguji proyek pada mesin lokal, maka kami akan memulainya dengan tim manajer: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
python manage.py runserver</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah awal yang sukses, kami lampirkan ngrok. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 b) Dan ada banyak cara untuk memulai di hosting - secara pribadi, saya menggunakan penumpang saat beget. </font><font style="vertical-align: inherit;">Dalam hal beget, masukkan versi container dengan php5.6 tidak lebih tinggi - ini adalah saran dari begetovtsev.</font></font><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi - aplikasi sudah mulai - pasang webhook</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siapa pun yang tahu cara menggunakan plugin POSTMAN untuk Chrome dapat melewati paragraf berikutnya dan mengirim POST untuk webhook langsung dari browser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan membuat file di mesin lokal dengan nama apa pun, misalnya sethook.py, tidak melupakan pustaka permintaan (permintaan pemasangan pip)</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#sethook</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json<font></font>
auth_token = <span class="hljs-string">'xxxxxxxxx-ttttttttttttttttt-wwwwwwwwwwww'</span> <span class="hljs-comment">#       #.2</span>
hook = <span class="hljs-string">'https://chatapi.viber.com/pa/set_webhook'</span>
headers = {<span class="hljs-string">'X-Viber-Auth-Token'</span>: auth_token}<font></font>
<font></font>
<font></font>
sen = dict(url=<span class="hljs-string">'https://yourdomain.ru/webhook2020'</span>,<font></font>
           event_types = [<span class="hljs-string">'unsubscribed'</span>, <span class="hljs-string">'conversation_started'</span>, <span class="hljs-string">'message'</span>, <span class="hljs-string">'seen'</span>, <span class="hljs-string">'delivered'</span>])
<span class="hljs-comment"># sen -  body     backend  viber</span>
<span class="hljs-comment">#seen, delivered -  ,     ,</span>
<span class="hljs-comment">#         ,   )</span><font></font>
<font></font>
r = requests.post(hook, json.dumps(sen), headers=headers)<font></font>
<span class="hljs-comment"># r -       viber </span><font></font>
print(r.json())<font></font>
<span class="hljs-comment">#   print    "status_message":"ok" -   ,</span>
<span class="hljs-comment">#    </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita memulainya dengan perintah dari direktori kerja: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
python sethook.py </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu dia! </font><font style="vertical-align: inherit;">Webhook diatur oleh metode POST. </font><font style="vertical-align: inherit;">Anda melihat pesan yang datang ke obrolan Anda (fungsi Dialog ditambahkan), yang berarti bahwa webhook diinstal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk dilanjutkan ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel berikutnya kami akan menganalisis acara ["conversation_started"], untuk kontak awal dengan pengguna dan inisialisasi interaksi dengan mereka, Anda akan mengetahui bahwa viberbot Anda mengetahui tentang semua pengguna dan apa yang tidak dia ketahui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BAGIAN 2: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat Viberbot lengkap di Django 2 dan API Viber REST. </font><font style="vertical-align: inherit;">Bagian Dua -</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bahan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">onversation_started</font></a><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentasi </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">viber </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">REST API </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django versi 2.2 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Radio-penambang</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id486826/">https://habr.com/ru/post/id486826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486814/index.html">Zabbix: topologi jaringan jelas dan otomatis</a></li>
<li><a href="../id486818/index.html">Porting Quake ke iPod Classic</a></li>
<li><a href="../id486820/index.html">70 Pertanyaan Wawancara Javascript</a></li>
<li><a href="../id486822/index.html">[Di dermaga] Berkibar. Bagian 4. Untuk pengembang web</a></li>
<li><a href="../id486824/index.html">Saran buruk ketika bekerja dengan ANTLR</a></li>
<li><a href="../id486828/index.html">Intisari Desain Makanan, Januari 2020</a></li>
<li><a href="../id486832/index.html">Berapa tahun pergi taiga - mengerti tidak</a></li>
<li><a href="../id486842/index.html">Konsul + iptables =: 3</a></li>
<li><a href="../id486844/index.html">Evolusi pemrosesan webhook Facebook: dari nol menjadi 25.000 per detik</a></li>
<li><a href="../id486850/index.html">Kursi baru yang dipesan - seperti hotel kapsul</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>