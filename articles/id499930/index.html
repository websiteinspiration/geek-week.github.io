<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💝 🎆 💅 Bagaimana saya merancang blok dan transaksi di blockchain Go saya 👨‍👨‍👧‍👦 🚩 🕊️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk akhirnya menghasilkan blockchain, dan bukan hanya database, kita perlu menambahkan 3 elemen penting ke proyek kami: 
 
 

- Deskripsi struktur d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bagaimana saya merancang blok dan transaksi di blockchain Go saya</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499930/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk akhirnya menghasilkan blockchain, dan bukan hanya database, kita perlu menambahkan 3 elemen penting ke proyek kami: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deskripsi struktur data dan metode blok</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deskripsi struktur data dan metode transaksi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fungsi Blockchain yang menyimpan blok dalam database dan menemukannya di sana dengan hash atau tinggi (atau sesuatu yang lain).</font></font></li>
</ul><br>
<img src="https://habrastorage.org/getpro/habr/post_images/633/90e/12c/63390e12c9217c81913a097b1474cee7.jpg" alt="gambar"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah artikel kedua tentang blockchain untuk industri, yang pertama di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengingat pertanyaan-pertanyaan yang diajukan pembaca kepada saya di artikel sebelumnya dari seri ini, harus dicatat: dalam kasus ini, basis data LevelDB digunakan untuk menyimpan data blockchain, tetapi tidak mengganggu penggunaan yang lain, ucapkan MySQL yang sama. Dan sekarang kita akan memahami struktur data ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan transaksi: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/Rusldv/bcstartup/blob/master/transaction/builder.go</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Berikut adalah struktur datanya:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> TX <span class="hljs-keyword">struct</span> {<font></font>
	DataType <span class="hljs-keyword">byte</span>		
	TxHash <span class="hljs-keyword">string</span> 
	TxType <span class="hljs-keyword">byte</span>	
	Timestamp <span class="hljs-keyword">int64</span>		<font></font>
	INs []TxIn<font></font>
	OUTs []TxOut<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> TxIn <span class="hljs-keyword">struct</span> {<font></font>
	ThatTxHash <span class="hljs-keyword">string</span>
	TxOutN <span class="hljs-keyword">int</span>
	ByteCode <span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> TxOut <span class="hljs-keyword">struct</span> {<font></font>
	Value <span class="hljs-keyword">int</span>
	ByteCode <span class="hljs-keyword">string</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TX menyimpan tipe data (untuk transaksi 2), hash transaksi ini, tipe transaksi itu sendiri, stempel waktu, dan juga input dan output. Input TxIn menyimpan hash transaksi yang menjadi rujukan output, jumlah output ini dan bytecode, dan output TxOut menyimpan beberapa nilai dan juga bytecode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat tindakan apa yang dapat dilakukan transaksi pada datanya, mis. mari kita menganalisis metodenya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membuat transaksi, gunakan fungsi transaction.NewTransaction (txtype byte) * TX. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode AddTxIn (thattxhash [] byte, txoutn int, kode [] byte) (* TxIn, error) menambahkan input ke transaksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode AddTxOut (nilai int, data [] byte) (* TxOut, kesalahan) menambahkan output ke transaksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ToBytes () [] byte mengubah transaksi menjadi irisan byte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi internal string preByteHash (byte [] byte) digunakan dalam Build () dan Periksa () untuk kompatibilitas hash transaksi yang dibuat dengan hash transaksi yang dihasilkan dari aplikasi JavaScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode Build () menetapkan hash transaksi sebagai berikut: tx.TxHash = preByteHash (tx.ToBytes ()). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ToJSON () string mengubah transaksi menjadi string JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode kesalahan FromJSON (data [] byte) memuat transaksi dari format JSON yang dikirim sebagai irisan byte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode Periksa () bool membandingkan hash yang diterima dari bidang hash transaksi dengan hash yang diperoleh sebagai hasil hashing transaksi ini (tidak termasuk bidang hash). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transaksi ditambahkan ke blok: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/Rusldv/bcstartup/blob/master/block/builder.go</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Struktur data blok ini lebih produktif:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Block <span class="hljs-keyword">struct</span> {<font></font>
	DataType <span class="hljs-keyword">byte</span>				
	BlockHeight <span class="hljs-keyword">int</span>					
        Timestamp <span class="hljs-keyword">int64</span>				 
        HeaderSize <span class="hljs-keyword">int</span>					
        PrevBlockHash <span class="hljs-keyword">string</span>				 
        SelfBlockHash <span class="hljs-keyword">string</span>			
	TxsHash <span class="hljs-keyword">string</span>			
	MerkleRoot <span class="hljs-keyword">string</span>
	CreatorPublicKey <span class="hljs-keyword">string</span>			
	CreatorSig <span class="hljs-keyword">string</span>
	Version <span class="hljs-keyword">int</span>
	TxsN <span class="hljs-keyword">int</span><font></font>
	Txs []transaction.TX<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DataType menyimpan tipe data, simpul di atasnya, dan melepaskan blok dari transaksi atau data lainnya. Untuk blok, nilai ini adalah 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BlockHeight menyimpan ketinggian blok. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stempel waktu stempel waktu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ukuran blok HeaderSize dalam byte. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PrevBlockHash hash dari blok sebelumnya, dan SelfBlockHash - saat ini. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TxsHash adalah hash transaksi yang umum. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MerkleRoot - Akar pohon Merkle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikutnya dalam bidang adalah kunci publik pencipta blok, tanda tangan pencipta, versi blok, jumlah transaksi dalam blok dan transaksi ini sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan metodenya:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi block.NewBlock () digunakan untuk membuat blok: NewBlock (prevBlockHash string, height int) * Block, yang mengambil hash dari blok sebelumnya dan ketinggian yang ditetapkan untuk blok yang dibuat di blockchain. Tipe blok dari konstanta paket tipe juga disetel:</font></font><pre><code class="go hljs">b.DataType = types.BLOCK_TYPE.</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode AddTx (tx * transaction.TX) menambahkan transaksi ke blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode Build () memuat nilai ke bidang blok dan menghasilkan dan menetapkan hash saat ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode byte ToBytesHeader () [] menerjemahkan header blok (tanpa transaksi) menjadi irisan byte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ToJSON () dari string menerjemahkan blok ke dalam format JSON dalam representasi string dari data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode kesalahan FromJSON (data [] byte) memuat data dari JSON ke dalam struktur blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode Periksa () bool menghasilkan hash blok dan membandingkannya dengan yang ditentukan dalam bidang hash blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode string GetTxsHash () mengembalikan hash umum dari semua transaksi di blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode GetMerkleRoot () menetapkan akar pohon Merkle untuk transaksi di blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode Tanda (string privk) menandatangani blok dengan kunci pribadi pembuat blok.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode SetHeight (tinggi int) menulis ketinggian blok ke bidang struktur blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode int GetHeight () mengembalikan ketinggian blok seperti yang ditunjukkan dalam bidang yang sesuai dari struktur blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode byte ToGOBBytes () [] mengkodekan blok dalam format GOB dan mengembalikannya sebagai irisan byte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode kesalahan FromGOBBytes (data [] byte) menulis data blok ke struktur blok dari slice byte yang ditransmisikan dalam format GOB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
String metode GetHash () mengembalikan hash dari blok ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
String metode GetPrevHash () mengembalikan hash dari blok sebelumnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode SetPublicKey (string pubk) menulis kunci publik pencipta blok ke blok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, dengan menggunakan metode objek Block, kita dapat dengan mudah mengonversinya menjadi format untuk transmisi melalui jaringan dan menyimpannya ke basis data LevelDB.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi paket blockchain bertanggung jawab untuk menyimpan ke blockchain: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/Rusldv/bcstartup/tree/master/blockchain.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Untuk ini, blok harus mengimplementasikan antarmuka IBlock:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> IGOBBytes <span class="hljs-keyword">interface</span> {<font></font>
	ToGOBBytes() []<span class="hljs-keyword">byte</span>
	FromGOBBytes(data []<span class="hljs-keyword">byte</span>) error<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> IBlock <span class="hljs-keyword">interface</span> {<font></font>
	IGOBBytes<font></font>
	GetHash() <span class="hljs-keyword">string</span>
	GetPrevHash() <span class="hljs-keyword">string</span>
	GetHeight() <span class="hljs-keyword">int</span>
	Check() <span class="hljs-keyword">bool</span><font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Koneksi database dibuat sekali selama inisialisasi paket dalam fungsi init (): </font></font><br>
<pre><code class="go hljs">db, err = leveldb.OpenFile(BLOCKCHAIN_DB_DEBUG, <span class="hljs-literal">nil</span>).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CloseDB () adalah pembungkus untuk db.Cloce () - dipanggil setelah bekerja dengan fungsi paket untuk menutup koneksi database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi kesalahan SetTargetBlockHash (hash string) menulis hash dari blok saat ini dengan kunci yang ditentukan oleh konstanta BLOCK_HASH dalam database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi GetTargetBlockHash () (string, error) mengembalikan hash dari blok saat ini yang disimpan dalam database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi kesalahan SetTargetBlockHeight (height int) menulis ke database nilai ketinggian blockchain untuk node dengan kunci yang ditentukan oleh konstanta BLOCK_HEIGHT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi GetTargetBlockHeight () (int, error) mengembalikan ketinggian blockchain untuk node tertentu yang disimpan dalam database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi bool CheckBlock (blok IBlock) memeriksa kebenaran blok sebelum menambahkan blok ini ke blockchain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi kesalahan AddBlock (blok IBlock) menambahkan blok ke blockchain.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi untuk menerima dan melihat blok terletak di file explore.go dari paket blockchain: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi GetBlockByHash (hash string) (* block.Block, error) menciptakan objek blok kosong, memuat blok dari database yang hash dilewatkan ke sana dan mengembalikan pointer ke sana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blok genesis dibuat oleh fungsi kesalahan Genesis () dari file genesis.go dari paket blockchain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel selanjutnya, kita akan berbicara tentang menghubungkan ke node klien menggunakan mekanisme WebSocket.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499910/index.html">Seimbang dalam pengambilan keputusan. Fork "pengalaman acak"</a></li>
<li><a href="../id499920/index.html">Trik Kecil SSH</a></li>
<li><a href="../id499922/index.html">Akhirnya kami berurusan dengan baud rate Modbus</a></li>
<li><a href="../id499926/index.html">30 April Java Digest</a></li>
<li><a href="../id499928/index.html">Udalenka: apa yang berubah dengan COVID-19 dan siapa yang sekarang bahkan lebih baik dari sebelumnya</a></li>
<li><a href="../id499934/index.html">Efek cambuk dan permainan bir: pemodelan dan manajemen rantai pasokan</a></li>
<li><a href="../id499936/index.html">Alasan utama mengapa Linux</a></li>
<li><a href="../id499944/index.html">Panduan Gaya Google di C ++. Bagian 10</a></li>
<li><a href="../id499960/index.html">JanusGraph grafik percobaan DBMS untuk memecahkan masalah menemukan jalur yang cocok</a></li>
<li><a href="../id499962/index.html">Beberapa fakta tentang pengklasifikasi cascading, yang jarang dipertimbangkan secara serius dalam artikel ilmiah.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>