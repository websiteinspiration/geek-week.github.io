<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍✈️ 🍞 🧒🏻 Mithril.jsでのシンプルなメモSPAのサンプル 💮 🤟🏽 👨🏽‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mithril.jsは、クライアントWebアプリケーションを構築するための人気のないツールです。このトピックに関するハブレに関する出版物は事実上ありません。この投稿では、Mithrilで小さなアプリケーションを作成する方法を紹介します。申請はこの出版物に基づいて行われます（翻訳）
 
 Mihtri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mithril.jsでのシンプルなメモSPAのサンプル</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492496/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、クライアントWebアプリケーションを構築するための人気のないツールです。</font><font style="vertical-align: inherit;">このトピックに関するハブレに関する出版物は事実上ありません。</font><font style="vertical-align: inherit;">この投稿では、Mithrilで小さなアプリケーションを作成する方法を紹介します。</font><font style="vertical-align: inherit;">申請はこの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出版物に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基づいて行われます</font><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mihtrilとは</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MithrilはSPA（単一ページのWebアプリケーション）を作成するために設計されたリアクティブフレームワークです。全体として、それは単なるJavaScriptとAPI関数の13個のシグネチャです。さらに、ミスリルに含まれておらず、個別に使用されるミスリルストリームライブラリがあります。ミスリルの中核には、アプリケーションのルーティングとXHRリクエストの操作が含まれます。中心となる概念は抽象化、つまり仮想ノード（vnode）です。仮想ノードは、いくつかの属性セットを持つ単なるjsオブジェクトです。仮想ノードは、特別な関数m（）によって作成されます。インターフェースの現在の状態は、仮想ノード（仮想DOM）のリストに格納されます。アプリケーションページの最初のレンダリング時に、仮想DOMはDOMに変換されます。 DOM APIイベントハンドラーが開始したとき、m.request（）promiseが完了したとき、およびURLが変更されたとき（アプリケーションのルートに沿ったナビゲーション）、新しい仮想DOM配列が生成されます。古いものと比較し、変更されたノードはブラウザのDOMを変更します。 DOMイベントとm.request（）リクエストの完了に加えて、m.redraw（）関数を使用して手動で再描画を呼び出すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのままの状態でmithrilにHTMLのようなテンプレートはありません。JSXサポートはありませんが、必要に応じて、これらすべてをさまざまなプラグインで使用してビルドできます。ここではこれらの機会を使用しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m（）の最初の引数が文字列（たとえば、 'div'）の場合、関数は単純な仮想ノードを返し、その結果、HTMLタグがDOMに表示されます</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m（）の最初の引数がオブジェクトまたはオブジェクトを返す関数である場合、そのようなオブジェクトにはview（）メソッドが必要であり、そのようなオブジェクトはコンポーネントと呼ばれます。次に、コンポーネントのview（）メソッドは、常にm（）関数（または次のタイプの配列：[m（）、]）を返す必要があります。したがって、コンポーネントオブジェクトの階層を構築できます。そして、最終的にすべてのコンポーネントが単純なvnodeノードを返すことは明らかです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想ノードとコンポーネントの両方にライフサイクルメソッドがあり、それらは同じoninit（）、oncreate（）、onbeforeupdate（）などと呼ばれます。これらの各メソッドは、ページレンダリングの特定の時点で呼び出されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータをオブジェクトとして仮想ノードまたはコンポーネントに渡すことができます。これはm（）関数の2番目の引数である必要があります。 vnode.attrs表記を使用して、ノード内のこのオブジェクトへのリンクを取得できます。 m（）関数の3番目の引数はこのノードの子孫であり、vnode.childrenリンクを介してアクセスできます。 m（）関数に加えて、単純なノードがm.trust（）関数によって返されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ミスリルの作者は特別なアプリケーション設計パターンを提供していませんが、「厚すぎる」コンポーネントやコンポーネントツリーの子孫の操作など、いくつかの失敗した決定を避けるようにアドバイスしています。また、アプリケーション全体またはコンポーネントの状態を制御するための特別な方法や方法も提供していません。ドキュメントには、ノード自体の状態を使用すべきではないと記載されていますが、操作してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ミスリルのこれらすべての機能は非常に不便に思われ、フレームワークは完成していないようです。特別な推奨事項はなく、状態/ストレージ、レデューサー/イベントディスパッチャー、テンプレートはありません。</font><font style="vertical-align: inherit;">一般的には、できる限り行います。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例に必要なもの </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我々は使用するだろう：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.jsバージョン2.0.4</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cssライブラリ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pure.css</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン1.0.1</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイコン用</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">fontawesome v5.12</font></a></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションを構築するための</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">rollup.js</font></a><font style="vertical-align: inherit;">バージョン1.32</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgREST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン5.2.0、バックエンドRESTサーバーとして</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースとしてpostgresqlバージョン9.6以降。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フロントエンドサーバーはここでは重要ではありません。クライアントにindex.htmlとスクリプトとスタイルファイルを提供するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
node_modulesにはミスリルをインストールせず、アプリケーションコードとフレームワークを1つのファイルにバインドします。</font><font style="vertical-align: inherit;">アプリケーションコードとミスリルは別々にページにアップロードされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ツールのインストール手順については説明しませんが、postgRESTについては言うことができます。バイナリファイルをダウンロードして別のフォルダーに配置し、次のようにtest.conf構成ファイルを作成します。</font></font><br>
<br>
<pre><code class="plaintext hljs">db-uri = "postgres://postgres:user1@localhost:5432/testbase"<font></font>
server-port= 5000<font></font>
# The name of which database schema to expose to REST clients<font></font>
db-schema= "public"<font></font>
# The database role to use when no client authentication is provided.<font></font>
# Can (and probably should) differ from user in db-uri<font></font>
db-anon-role = "postgres" </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、postgesqlクラスターにはtestbaseベースとuser1が必要です。</font><font style="vertical-align: inherit;">このテストベースで、テーブルを作成します。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-comment">-- Postgrest sql notes table </span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> notes (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">serial</span> primary <span class="hljs-keyword">key</span>,<font></font>
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">127</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">content</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
created <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,<font></font>
completed <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">with</span> <span class="hljs-built_in">time</span> zone,<font></font>
ddel <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
postgRESTサーバーを起動するには、次のコマンドを使用します。</font></font><br>
<br>
<pre><code class="bash hljs">postgrest test.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーを起動すると、データベースへの接続に関する情報メッセージと、クライアントがリッスンするポートを表示します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトの計画</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ミトリルの仕組みが大まかに理解されている場合は、アプリケーションの作成方法を理解する必要があります。</font><font style="vertical-align: inherit;">ここに計画があります：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションデータをローカルオブジェクトに保存し、そのモデルを呼び出しましょう</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIアプリケーションは別のファイルに保存されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションルートを別のファイルに保存します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パスファイルは、アプリケーションを構築するためのエントリポイントになります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各個別のコンポーネント（およびコンポーネントレンダリングスキームを使用します）とそれに関連付けられた関数は、個別のファイルに保存されます</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルデータをレンダリングする各コンポーネントは、モデルにアクセスできます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントDOMイベントハンドラーはコンポーネントにローカライズされています</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、カスタムイベントは必要ありません。ネイティブDOMイベントではなく、これらのイベントのコールバックはコンポーネントにローカライズされています。</font><font style="vertical-align: inherit;">双方向バインディングを使用します。</font><font style="vertical-align: inherit;">おそらく誰もがこのアプローチを好むわけではありませんが、だれもがreduxやvuexを好むわけではありません。</font><font style="vertical-align: inherit;">さらに、一方向のバインディング手法は、ミスリルストリームを使用して、ミトリルでエレガントに実装することもできます。</font><font style="vertical-align: inherit;">しかし、この場合、これは冗長なソリューションです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションのフォルダー構造</font></font></h3><br>
<img src="https://habrastorage.org/webt/yp/uy/fa/ypuyfap4tlxl_ccqo86wbtb9h98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パブリックフォルダーはフロントサーバーによって提供され、index.htmlファイル、およびスタイルとスクリプトを含むディレクトリがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
srcフォルダーには、ルーターのルートとAPI定義、およびモデルとビューの2つのディレクトリが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトのルートには、rollup.config構成ファイルがあり、プロジェクトは次のコマンドを使用してビルドされます。</font></font><br>
<br>
<pre><code class="bash hljs">rollup –c</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.comで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
利用できるコードの長いチャンクに読者を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">飽きさせないために、</font></a><font style="vertical-align: inherit;">私は主要な実装要素についてのみコメントし、僧帽弁の慣用的なアプローチを示します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIとルーター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIコード：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// used by backend server</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> restApi= {
  <span class="hljs-attr">notes</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">'notes'</span>, <span class="hljs-attr">editable</span>: [<span class="hljs-string">'add'</span>, <span class="hljs-string">'edit'</span>, <span class="hljs-string">'del'</span>] }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// used by routers</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appApi = {
  <span class="hljs-attr">root</span>: <span class="hljs-string">"/"</span>,<font></font>
}<font></font>
<span class="hljs-comment">// used by navBar</span>
<span class="hljs-comment">// here array of arrays though it may be hash eg</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appMenu = [<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Home'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'About'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Contacts'</span>],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RESTサーバーとルーターのAPIを定義しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルーター：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { restApi, appApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'./appApi'</span>;
<span class="hljs-keyword">import</span> { moModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'./model/moModel'</span>;
<span class="hljs-keyword">import</span> { vuView, vuApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuApp'</span>;
<span class="hljs-keyword">import</span> { vuNavBar } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuNavBar'</span>;<font></font>
<font></font>
<span class="hljs-comment">// application router</span>
<span class="hljs-keyword">const</span> appRouter = { [appApi.root]: {<font></font>
  render() {<font></font>
    <span class="hljs-keyword">const</span> view = m(vuApp, {
      <span class="hljs-attr">model</span>: moModel.getModel( restApi.notes ),<font></font>
    });<font></font>
    <span class="hljs-keyword">return</span> vuView( {<span class="hljs-attr">menu</span>: vuNavBar}, view);<font></font>
  }<font></font>
}};<font></font>
<font></font>
<span class="hljs-comment">// once per app</span>
m.route(<span class="hljs-built_in">document</span>.body, <span class="hljs-string">"/"</span>, appRouter);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでルーターはドキュメント本体に取り付けられています。</font><font style="vertical-align: inherit;">ルーター自体は、このルートで使用されるルートとコンポーネントを記述するオブジェクトであり、render（）関数はvnodeを返す必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
appApiオブジェクトはすべての有効なアプリケーションルートを定義し、appMenuオブジェクトはアプリケーションのすべての可能なナビゲーション要素を定義します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
render関数は、呼び出されると、アプリケーションモデルを生成し、それをルートノードに渡します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションモデル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関連データを格納する構造をモデルと呼びました。</font><font style="vertical-align: inherit;">モデルを返す関数のソースコード：</font></font><br>
<br>
<pre><code class="javascript hljs">getModel(<font></font>
    {url=<span class="hljs-literal">null</span>, method=<span class="hljs-string">"GET"</span>, order_by=<span class="hljs-string">'id'</span>, editable=<span class="hljs-literal">null</span>} = {}<font></font>
  ) {<font></font>
<span class="hljs-comment">/**
  * url - string of model's REST API url
  * method - string of model's REST method
  * order_by - string "order by" with initially SELECT 
  * editable - array defines is model could changed
*/</span>
    <span class="hljs-keyword">const</span> model = {
      <span class="hljs-attr">url</span>: url,
      <span class="hljs-attr">method</span>: method,
      <span class="hljs-attr">order_by</span>: order_by,
      <span class="hljs-attr">editable</span>: editable,
      <span class="hljs-attr">key</span>: order_by, <span class="hljs-comment">// here single primary key only</span>
      <span class="hljs-attr">list</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// main data list </span>
      <span class="hljs-attr">item</span>: {}, <span class="hljs-comment">// note item</span>
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Promise error</span>
      <span class="hljs-attr">save</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// save status</span>
      <span class="hljs-attr">editMode</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// view switch flag</span>
      <span class="hljs-attr">word</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// dialog header word</span><font></font>
    };  <font></font>
    model.getItem= <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {<font></font>
      model.item= {};<font></font>
      <span class="hljs-keyword">if</span> ( !id ) {<font></font>
        model.editMode= <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">const</span> key= model.key;
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">let</span> it <span class="hljs-keyword">of</span> model.list ) {
        <span class="hljs-keyword">if</span> (it[key] == id) {<font></font>
          model.item= <span class="hljs-built_in">Object</span>.assign({}, it);
          <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
      }<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    };<font></font>
    <span class="hljs-keyword">return</span> model;<font></font>
  },</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ここで初期化され、モデルオブジェクトを返します。</font><font style="vertical-align: inherit;">オブジェクト内のリンクは変更される可能性がありますが、オブジェクト自体へのリンクは一定のままです。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
getModel関数に加えて、グローバルmoModelオブジェクトには、m.request（）mitry関数用のラッパー関数があり、これらはgetList（モデル）、およびformSubmit（イベント、モデル、メソッド）です。</font><font style="vertical-align: inherit;">modelパラメータは、実際にはモデルオブジェクトへの参照です。eventは、フォームの送信時に生成されるイベントオブジェクトです。methodは、メモの保存に使用するHTTPメソッドです（POSTは新しいメモ、PATCH、DELETEは古い）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表現</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビューフォルダには、個々のページ要素のレンダリングを担当する関数が含まれています。</font><font style="vertical-align: inherit;">私はそれらを4つの部分に分けました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuApp-アプリケーションのルートコンポーネント、 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNavBar-ナビゲーションバー、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes-ノートのリスト、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm-ノート編集フォーム、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuDialog-HTMLダイアログ要素 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルーターは、vuView（メニュー、ビュー）が単一のルートで返されることを決定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この関数の定義：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuView= <span class="hljs-function">(<span class="hljs-params">appMenu, view</span>)=&gt;</span> m(vuMain, appMenu, view);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、vuMainコンポーネントを返す単なるラッパーです。appMenuオブジェクトが外部オブジェクトと同様の構造でネストされたオブジェクトを持つのに十分複雑な場合、そのようなラッパーは、異なるナビゲーション要素と子コンポーネントを持つコンポーネントを返す適切な方法です（必要なコードを少なくするだけです）。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VuMainコンポーネント：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> vuMain= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-comment">// We use ivnode as argument as it is initial vnode</span>
  <span class="hljs-keyword">const</span> { menu }= ivnode.attrs;
  <span class="hljs-keyword">return</span> { view(vnode) {
    <span class="hljs-comment">// IMPORTANT !</span>
    <span class="hljs-comment">// If we use vnode inside the view function we MUST provide it for view</span>
    <span class="hljs-keyword">return</span> [<font></font>
      m(menu),<font></font>
      m(<span class="hljs-string">'#layout'</span>, vnode.children)<font></font>
    ];<font></font>
  }};<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは単に、ナビゲーションのvnodeとページの実際のコンテンツを返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下では、コンポーネントを定義できる場合は、クロージャーを使用します。</font><font style="vertical-align: inherit;">クロージャーは、ページの最初のレンダリング中に1回呼び出され、オブジェクトへのすべての渡されたリンクと独自の関数の定義をローカルに格納します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
定義として閉じると、常にコンポーネントが返されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして実際にはアプリケーションコンテンツコンポーネント：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuApp= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-comment">//initially get notes</span><font></font>
  moModel.getList( model );<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() { 
    <span class="hljs-keyword">return</span> [<font></font>
      m(vuNotes, { model }),<font></font>
      m(vuNoteForm, { model }),<font></font>
      vuModalDialog(model)<font></font>
    ];<font></font>
  }};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでにモデルがあるので、クロージャーを呼び出すときに、データベースからノートのリスト全体を取得したいと思います。</font><font style="vertical-align: inherit;">ページには3つのコンポーネントがあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes-追加ボタンのあるメモのリスト、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm-ノート編集フォーム、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuModalDialog-モーダルに表示し、必要に応じて非表示にするダイアログ要素。 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの各コンポーネントは、それ自体を描画する方法を知っている必要があるため、それぞれのモデルオブジェクトへのリンクを渡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンポーネントノートリスト：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//Notes List</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuNotes= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-keyword">const</span> _display= <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> model.editMode ? <span class="hljs-string">'display:none'</span>: <span class="hljs-string">'display:block'</span>;
  <span class="hljs-keyword">const</span> vuNote= noteItem(model); <span class="hljs-comment">// returns note function</span><font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() {
    <span class="hljs-keyword">return</span> model.error ? m(<span class="hljs-string">'h2'</span>, {<span class="hljs-attr">style</span>: <span class="hljs-string">'color:red'</span>}, model.error) :<font></font>
    !model.list ? m(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'...LOADING'</span> ) :<font></font>
    m(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">style</span>: _display() }, [<font></font>
      m(addButton , { model } ),<font></font>
      m(<span class="hljs-string">'.pure-g'</span>, m(<span class="hljs-string">'.pure-u-1-2.pure-u-md-1-1'</span>,<font></font>
        m(<span class="hljs-string">'.notes'</span>, model.list.map( vuNote ) )<font></font>
      ))<font></font>
    ]);<font></font>
  }};<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bool editModeフラグはモデルオブジェクトに格納されます。フラグの値がtrueの場合は編集フォームを表示し、それ以外の場合はノートのリストを表示します。</font><font style="vertical-align: inherit;">チェックのレベルを1レベル上げることはできますが、フラグを切り替えるたびに仮想ノードとDOMノード自体の数が変わるため、これは不要な作業です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではミトリルの慣用句として、ページを生成し、三項演算子を使用してモデル内の属性の有無をチェックしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、ノート表示関数を返すクロージャです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> noteItem= <span class="hljs-function"><span class="hljs-params">model</span>=&gt;</span> {
  <span class="hljs-comment">// click event handler</span>
  <span class="hljs-keyword">const</span> event= <span class="hljs-function">(<span class="hljs-params"> msg, word=<span class="hljs-string">''</span>, time=<span class="hljs-literal">null</span></span>)=&gt;</span> <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    model.getItem(e.target.getAttribute(<span class="hljs-string">'data'</span>));
    <span class="hljs-keyword">if</span> ( !!msg ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">msg</span>: msg };<font></font>
      model.word= word;<font></font>
      <span class="hljs-keyword">if</span> ( !!time )<font></font>
        model.item.completed= time;<font></font>
      vuDialog.open();<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      model.editMode= <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  };<font></font>
  <span class="hljs-comment">// trash icon's click handler</span>
  <span class="hljs-keyword">const</span> _trash= event(<span class="hljs-string">'trash'</span>, <span class="hljs-string">'Dlelete'</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// check icon's click handler</span>
  <span class="hljs-keyword">const</span> _check= event(<span class="hljs-string">'check'</span>, <span class="hljs-string">'Complete'</span>,
    <span class="hljs-comment">// postgre timestamp string</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString().split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-string">'T'</span>, <span class="hljs-string">' '</span>));<font></font>
  <font></font>
  <span class="hljs-comment">// edit this note</span>
  <span class="hljs-keyword">const</span> _edit= event(<span class="hljs-string">''</span>);<font></font>
  <font></font>
  <span class="hljs-keyword">const</span> _time= <span class="hljs-function"><span class="hljs-params">ts</span>=&gt;</span> ts.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>];<font></font>
  <font></font>
  <span class="hljs-comment">// Single Note </span>
  <span class="hljs-keyword">const</span> _note= <span class="hljs-function"><span class="hljs-params">note</span>=&gt;</span> m(<span class="hljs-string">'section.note'</span>, {<span class="hljs-attr">key</span>: note.id}, [<font></font>
    m(<span class="hljs-string">'header.note-header'</span>, [ m(<span class="hljs-string">'p.note-meta'</span>, [
      <span class="hljs-comment">// note metadata</span>
      m(<span class="hljs-string">'span'</span>, { <span class="hljs-attr">style</span>: <span class="hljs-string">'padding: right: 3em'</span> }, <span class="hljs-string">`Created: <span class="hljs-subst">${_time( note.created )}</span>`</span>),<font></font>
      note.completed ? m(<span class="hljs-string">'span'</span>, <span class="hljs-string">`  Completed: <span class="hljs-subst">${_time( note.completed )}</span>`</span>) : <span class="hljs-string">''</span>, 
      <span class="hljs-comment">// note right panel </span>
      m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-trash'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _trash } )),<font></font>
      note.completed ? <span class="hljs-string">''</span> : [<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-pen'</span>, {<span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _edit } )),<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-check'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _check} ))<font></font>
      ]<font></font>
    ]),<font></font>
      m(<span class="hljs-string">'h2.note-title'</span>, { <span class="hljs-attr">style</span>: note.completed ? <span class="hljs-string">'text-decoration: line-through'</span>: <span class="hljs-string">''</span>}, note.title)<font></font>
    ]),<font></font>
    m(<span class="hljs-string">'.note-content'</span>, m(<span class="hljs-string">'p'</span>, note.content))<font></font>
  ]);<font></font>
  <span class="hljs-keyword">return</span> _note;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのクリックハンドラーはローカルで定義されます。モデルはノートオブジェクトがどのように構造化されているかを認識していません。model.list配列から目的の要素を選択できるキープロパティのみを定義しました。ただし、コンポーネントは、描画するオブジェクトの構造を正確に把握している必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモを編集するためのフォームのコードの全文を提供するのではなく、フォーム送信ハンドラを個別に調べます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// form submit handler</span>
  <span class="hljs-keyword">const</span> _submit= <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    e.preventDefault();<font></font>
    model.item.title= clean(model.item.title);<font></font>
    model.item.content= clean(model.item.content);<font></font>
    <span class="hljs-keyword">const</span> check= check_note(model.item);
    <span class="hljs-keyword">if</span> ( !!check ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">msg</span>: check }; <font></font>
      model.word= <span class="hljs-string">'Edit'</span>;<font></font>
      vuDialog.open();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">return</span> moModel.formSubmit(e, model, _method() ).then(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { model.editMode=<span class="hljs-literal">false</span>; <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;}).catch(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { vuDialog.open(); <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; } );<font></font>
  };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 定義はクロージャ内で発生するため、モデルへのリンクがあり、結果の後続処理でプロミスを返します。リクエストが正常に完了したとき、またはエラーが発生した場合にフォームを表示することの禁止-エラーテキスト付きのダイアログを開きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックエンドサーバーにアクセスするたびに、メモのリストが再度読み込まれます。</font><font style="vertical-align: inherit;">この例では、メモリ内のリストを調整する必要はありませんが、これは可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダイアログコンポーネントは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">表示できます。</font><font style="vertical-align: inherit;">強調する必要があるのは、この場合、オブジェクトのリテラルを使用してコンポーネントを定義していることです。これは、ウィンドウの開閉機能を他のコンポーネントで使用できるようにするためです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このフレームワークのイディオムに固執するために、JavaScriptとmithril.jsで小さなSPAアプリケーションを作成しました。</font><font style="vertical-align: inherit;">これが単なるJavaScriptコードであることをもう一度注意したいと思います。</font><font style="vertical-align: inherit;">多分かなりきれいではない。</font><font style="vertical-align: inherit;">このアプローチでは、小さなコードをカプセル化し、コンポーネントのメカニズムを分離して、すべてのコンポーネントに共通の状態を使用できます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja492482/index.html">3月16日から22日までのモスクワでのデジタルイベント</a></li>
<li><a href="../ja492484/index.html">3月16日から3月22日までのサンクトペテルブルクでのデジタルイベント</a></li>
<li><a href="../ja492486/index.html">Nuxt + Django + GraphQLなど</a></li>
<li><a href="../ja492488/index.html">OpenID Connect：汎用から標準までの内部アプリケーションの承認</a></li>
<li><a href="../ja492492/index.html">NikiRobot-教育用ロボット工学の進化</a></li>
<li><a href="../ja492500/index.html">ロシア語の科学ガレージ。アメリカの番組の翻訳経験</a></li>
<li><a href="../ja492502/index.html">MIP * = RE：物理学と数学にドミノ効果を引き起こしたコンピュータサイエンスの分野からの画期的な証拠</a></li>
<li><a href="../ja492504/index.html">JSモジュールを2回インポートするとどうなりますか？</a></li>
<li><a href="../ja492506/index.html">Angularで大きなリストをレンダリングする3つの方法</a></li>
<li><a href="../ja492508/index.html">DevOpsのKubernetesを予約する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>