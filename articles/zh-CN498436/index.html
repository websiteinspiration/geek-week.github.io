<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–ğŸ» ğŸ‘¨â€ğŸš€ ğŸ‘©ğŸ¼â€ğŸ”¬ GitLab CI / CDæŒ‡å—ï¼ˆå‡ ä¹ï¼‰ç»å¯¹å…¥é—¨ ğŸ‘ ğŸ˜ ğŸ––</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ–è€…å¦‚ä½•åœ¨ä¸€ä¸ªè½»æ¾çš„ç¼–ç ä¸­è·å¾—ä¸€ä¸ªç¾ä¸½çš„å¾½ç« ï¼Œä¸ºæ‚¨çš„é¡¹ç›®åšä¸€ä¸ªæ™šä¸Š
 

å¯èƒ½æ¯ä¸ªå¼€å‘äººå‘˜è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªå® ç‰©é¡¹ç›®ï¼Œåœ¨æŸä¸ªæ—¶å€™ï¼Œéƒ½ä¼šå‡ºç°å…³äºå¸¦æœ‰çŠ¶æ€ï¼Œä»£ç è¦†ç›–èŒƒå›´ä»¥åŠnugetä¸­çš„ç¨‹åºåŒ…ç‰ˆæœ¬çš„æ¼‚äº®å¾½ç« çš„ä¸»é¢˜çš„ç—’ã€‚åœ¨å‡†å¤‡ç¼–å†™å®ƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­è·å¾—äº†å¦‚æ­¤ç¾ä¸½ï¼š
 


 

æœ¬æ–‡å°†ä»‹ç»åœ¨GitLab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>GitLab CI / CDæŒ‡å—ï¼ˆå‡ ä¹ï¼‰ç»å¯¹å…¥é—¨</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498436/"><p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–è€…å¦‚ä½•åœ¨ä¸€ä¸ªè½»æ¾çš„ç¼–ç ä¸­è·å¾—ä¸€ä¸ªç¾ä¸½çš„å¾½ç« ï¼Œä¸ºæ‚¨çš„é¡¹ç›®åšä¸€ä¸ªæ™šä¸Š</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½æ¯ä¸ªå¼€å‘äººå‘˜è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªå® ç‰©é¡¹ç›®ï¼Œåœ¨æŸä¸ªæ—¶å€™ï¼Œéƒ½ä¼šå‡ºç°å…³äºå¸¦æœ‰çŠ¶æ€ï¼Œä»£ç è¦†ç›–èŒƒå›´ä»¥åŠnugetä¸­çš„ç¨‹åºåŒ…ç‰ˆæœ¬çš„æ¼‚äº®å¾½ç« çš„ä¸»é¢˜çš„ç—’ã€‚</font><font style="vertical-align: inherit;">åœ¨å‡†å¤‡ç¼–å†™å®ƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­è·å¾—äº†å¦‚æ­¤ç¾ä¸½ï¼š</font></font></p><br>
<p><img src="https://habrastorage.org/webt/kx/ak/yi/kxakyimb1it83wyhml_lbxmqbvm.png" alt="ç»“æœ"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æ–‡å°†ä»‹ç»åœ¨GitLabä¸­ä¸º.Net Coreç±»åº“é¡¹ç›®è¿›è¡ŒæŒç»­é›†æˆå’Œäº¤ä»˜çš„åŸºæœ¬è®¾ç½®ï¼Œå¹¶åœ¨GitLabé¡µé¢ä¸­å‘å¸ƒæ–‡æ¡£ï¼Œå¹¶å°†æ”¶é›†åˆ°çš„åŒ…å‘é€åˆ°Azure DevOpsä¸­çš„ç§äººæè¦ã€‚ </font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VS Codeç”¨ä½œå¸¦æœ‰</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab Workflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰©å±•çš„å¼€å‘ç¯å¢ƒ</font><font style="vertical-align: inherit;">ï¼ˆç”¨äºç›´æ¥ä»å¼€å‘ç¯å¢ƒéªŒè¯è®¾ç½®æ–‡ä»¶ï¼‰ã€‚</font></font></p><a name="habracut"></a><br>
<h2 id="kratkoe-vvedenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®€å•çš„ä»‹ç»</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CD-è¿™æ˜¯æ‚¨åˆšåˆšæ¨é€çš„å†…å®¹ï¼Œå®¢æˆ·ç«¯å·²ç»å…¨éƒ¨æ‰äº†å—ï¼Ÿ</font></font></blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆæ˜¯CI / CDï¼Œä¸ºä»€ä¹ˆéœ€è¦è½»æ¾ä½¿ç”¨Googleã€‚</font><font style="vertical-align: inherit;">å…³äºå¦‚ä½•åœ¨GitLabä¸­é…ç½®ç®¡é“çš„å®Œæ•´æ–‡æ¡£</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿå¾ˆå®¹æ˜“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰¾åˆ°</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘å°†ç®€è¦å¹¶å°½å¯èƒ½æ²¡æœ‰ç¼ºé™·åœ°ä»é¸Ÿç°çš„è§’åº¦æè¿°ç³»ç»Ÿçš„è¿‡ç¨‹ï¼š</font></font></p><br>
<ul>
<li>    ,  merge request  , <em>  -      </em>,</li>
<li>    ,        ,</li>
<li>      ,</li>
<li>    â€” .. <em></em>     ,</li>
<li>    (..        ) â€”   (<em> </em>),</li>
<li>    ,    .</li>
</ul><br>
<p> , :</p><br>
<ul>
<li> â€”  ,   ,    , ,  ,      ,  .,</li>
<li> (<strong>stage</strong>) â€”   ,  1+ ,</li>
<li> (<strong>job</strong>) â€”    .    (),  ,  /    .</li>
</ul><br>
<p>,    CI/CD   ,    ,      ,      .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> : ?</b>
                        <div class="spoiler_text"><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆé€‰æ‹©GitLabï¼Ÿ</font></font></li>
</ul><br>
<p>,         -,  GitHub'e   ,   â€” .   ,            GitHub.</p><br>
<ul>
<li>  Azure DevOps Pipelines?</li>
</ul><br>
<p>     â€”      .     git â€”   ,  SSH-      â€” ,       .</p></div>
                    </div><br>
<h2 id="ishodnaya-poziciya-chto-imeetsya-i-chego-hochetsya"> :     </h2><br>
<p>:</p><br>
<ul>
<li>  GitLab.</li>
</ul><br>
<p>:</p><br>
<ul>
<li>      merge request,</li>
<li>    merge request            ,</li>
<li>       Azure DevOps,</li>
<li>     GitLab Pages,</li>
<li><em>!11</em></li>
</ul><br>
<p>       :</p><br>
<ul>
<li> 1 â€” <br>
<ul>
<li> ,     </li>
</ul></li>
<li> 2 â€” <br>
<ul>
<li>    ,  ,    </li>
</ul></li>
<li> 3 â€” <br>
<ul>
<li> 1 â€”  nuget-    Azure DevOps</li>
<li> 2 â€”    xmldoc       GitLab Pages</li>
</ul></li>
</ul><br>
<p>!</p><br>
<h2 id="sobiraem-konfiguraciyu"> </h2><br>
<h3 id="gotovim-akkaunty"> </h3><br>
<ol>
<li><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Microsoft Azure</a></p><br>
</li>
<li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Azure DevOps</a></p><br>
</li>
<li><p>  </p><br>
<ol>
<li> â€” </li>
<li> â€” <br>
<img src="https://habrastorage.org/webt/to/_f/mp/to_fmps8ypj2ekynmz2gih2y_bw.png" alt="Azure DevOps-ä¸€ä¸ªæ–°é¡¹ç›®"></li>
</ol><br>
</li>
<li><p>    Create   ,       .       ,     (     -&gt; Overview -&gt;  Azure DevOps Services)<br>
<img src="https://habrastorage.org/webt/mw/qe/az/mwqeaz0lnj5bk9hmq348azezwyu.png" alt="æœåŠ¡è®¾ç½®"></p><br>
</li>
<li><p>  Atrifacts,  Create feed</p><br>
<ol>
<li>  </li>
<li> </li>
<li>  <strong>Include packages from common public sources</strong>,      <s></s>  nuget<br>
<img src="https://habrastorage.org/webt/n8/vt/x9/n8vtx9qslsiysnu-9htq49pet6a.png" alt="é…ç½®è½¯ä»¶åŒ…æº"></li>
</ol><br>
</li>
<li><p> Connect to feed,  Visual Studio,   Machine Setup  Source<br>
<img src="https://habrastorage.org/webt/wf/ib/ik/wfibikh0dqsuhylr4jdmhgzaboe.png" alt="æ¥æºç½‘å€"></p><br>
</li>
<li><p>   ,  Personal Access Token<br>
<img src="https://habrastorage.org/webt/i2/ll/oa/i2lloaky-xdfiunjqh9b53diqsu.png" alt="ä¸ªäººè®¿é—®ä»¤ç‰Œ"></p><br>
</li>
<li><p>   </p><br>
<ol>
<li> â€” </li>
<li> â€” </li>
<li>  â€”  1 </li>
<li>  (scope) â€” Packaging/Read &amp; Write<br>
<img src="https://habrastorage.org/webt/mf/dn/zo/mfdnzobz6pbitmtjee9hijxahrm.png" alt="åˆ›å»ºPAT"></li>
</ol><br>
</li>
<li><p>   â€” <strong>      </strong></p><br>
</li>
<li><p>     GitLab,   CI/CD<br>
<img src="https://habrastorage.org/webt/2i/vx/lq/2ivxlqmonl_6u8ihoqzhaelmnau.png" alt="GitLab CI / CDè®¾ç½®"></p><br>
</li>
<li><p>  Variables,  </p><br>
<ol>
<li> â€”    (    )</li>
<li> â€”    . 9</li>
<li> Mask variable<br>
<img src="https://habrastorage.org/webt/z9/wk/hd/z9wkhdwqbxoy1ehiv6xle6ybcl0.png" alt="GitLab-æ–°å˜é‡"></li>
</ol><br>
</li>
</ol><br>
<p>    .</p><br>
<h3 id="gotovim-karkas-konfiguracii">  </h3><br>
<p> ,   CI/CD  GitLab   <code>.gitlab-ci.yml</code>   .          ,       .</p><br>
<p>   ,      <code>YAML</code>.    ,        ,      .</p><br>
<p>       docker-,      .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  .Net Core  Docker Hub</a>.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>   ,      .       .Net Core 3.1,       </p><br>
<pre><code class="plaintext hljs">image: mcr.microsoft.com/dotnet/core/sdk:3.1</code></pre><br>
<p>       Microsoft    ,         .</p><br>
<p>  â€”  <strong>stage</strong>'.   GitLab  5 :</p><br>
<ul>
<li><code>.pre</code> â€”    ,</li>
<li><code>.post</code> â€”    ,</li>
<li><code>build</code> â€”   <code>.pre</code> ,</li>
<li><code>test</code> â€”  ,</li>
<li><code>deploy</code> â€”  .</li>
</ul><br>
<p>     , . ,    ,   ,    .   ,   :</p><br>
<pre><code class="plaintext hljs">stages:<font></font>
  - build<font></font>
  - test<font></font>
  - deploy</code></pre><br>
<p>       ,    .    ,      ,   <code>before_script</code>:</p><br>
<pre><code class="plaintext hljs">before_script:<font></font>
  - $PSVersionTable.PSVersion<font></font>
  - dotnet --version<font></font>
  - nuget help | select-string Version</code></pre><br>
<p>     ,      .       :</p><br>
<pre><code class="plaintext hljs">dummy job:<font></font>
  script:<font></font>
    - echo ok</code></pre><br>
<p> ,  ,   , , ,     â€¦     â€” <code>bash: .PSVersion: command not found</code>. WTF?</p><br>
<p>  â€”   runner' (    ,   GitLab')  <code>bash</code>   .    ,     ,        :</p><br>
<pre><code class="plaintext hljs">dummy job on windows:<font></font>
  script:<font></font>
    - echo ok<font></font>
  tags:<font></font>
    - windows</code></pre><br>
<p>!   .</p><br>
<p> ,   , ,      <code>test</code>,     .   , <code>test</code>    .</p><br>
<p>   ,   ,  :</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  script:<font></font>
    - echo "building..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: build<font></font>
<font></font>
test and cover job:<font></font>
  script:<font></font>
    - echo "running tests and coverage analysis..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: test<font></font>
<font></font>
pack and deploy job:<font></font>
  script:<font></font>
    - echo "packing and pushing to nuget..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: deploy<font></font>
<font></font>
pages:<font></font>
  script:<font></font>
    - echo "creating docs..."<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: deploy</code></pre><br>
<p>   ,      .</p><br>
<h3 id="nastroyka-triggerov"> </h3><br>
<p>- ,          ,   <strong></strong>       .          ,      .</p><br>
<p>     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">only/except</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rules</a>. , <code>only/except</code>      (<code>merge_request</code>,  â€”                 ,      )    ( ..    ); <code>rules</code>     , ,           (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>when</code>  GitLab CI/CD</a>).</p><br>
<p>   â€”      merge request,     Azure DevOps â€”  merge request    ,   â€”    .</p><br>
<p>     ,      merge request:</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  # snip<font></font>
  only:<font></font>
    - merge_request</code></pre><br>
<p>       merge request     :</p><br>
<pre><code class="plaintext hljs">pack and deploy job:<font></font>
  # snip<font></font>
  only:<font></font>
    - merge_request<font></font>
    - master</code></pre><br>
<p> ,    .</p><br>
<p>         merge request      :</p><br>
<pre><code class="plaintext hljs">  rules:<font></font>
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "master"</code></pre><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a>;  <code>rules</code>     <code>only/except</code>.</p><br>
<h3 id="nastroyka-sohraneniya-artefaktov">  </h3><br>
<p>    <code>build job</code>      ,      .        ,           ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>artifacts</code></a>:</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  # snip<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - path/to/build/artifacts<font></font>
      - another/path<font></font>
      - MyCoolLib.*/bin/Release/*</code></pre><br>
<p>  wildcards,     .</p><br>
<p>   ,           â€”          ,       .        .</p><br>
<p>,     ( )  ,        .</p><br>
<h3 id="pishem-skripty"> </h3><br>
<p>, - ,  - ,   (     .net)     .   ,       3 :</p><br>
<pre><code class="plaintext hljs">dotnet build<font></font>
dotnet test<font></font>
dotnet pack</code></pre><br>
<p>,   , -     .</p><br>
<ol>
<li>  ,    ,      <code>-c Release</code></li>
<li>        ,        :<br>
<ol>
<li>       <code>coverlet.msbuild</code>: <code>dotnet add package coverlet.msbuild</code>   </li>
<li>     <code>/p:CollectCoverage=true</code></li>
<li>          (. )</li>
</ol></li>
<li>    nuget-     : <code>-o .</code></li>
</ol><br>
<h4 id="sobiraem-dannye-pokrytiya-koda">   </h4><br>
<p>Coverlet         :</p><br>
<pre><code class="plaintext hljs">Calculating coverage result...<font></font>
  Generating report 'C:\Users\xxx\source\repos\my-project\myProject.tests\coverage.json'<font></font>
<font></font>
+-------------+--------+--------+--------+<font></font>
| Module      | Line   | Branch | Method |<font></font>
+-------------+--------+--------+--------+<font></font>
| project 1   | 83,24% | 66,66% | 92,1%  |<font></font>
+-------------+--------+--------+--------+<font></font>
| project 2   | 87,5%  | 50%    | 100%   |<font></font>
+-------------+--------+--------+--------+<font></font>
| project 3   | 100%   | 83,33% | 100%   |<font></font>
+-------------+--------+--------+--------+<font></font>
<font></font>
+---------+--------+--------+--------+<font></font>
|         | Line   | Branch | Method |<font></font>
+---------+--------+--------+--------+<font></font>
| Total   | 84,27% | 65,76% | 92,94% |<font></font>
+---------+--------+--------+--------+<font></font>
| Average | 90,24% | 66,66% | 97,36% |<font></font>
+---------+--------+--------+--------+</code></pre><br>
<p>GitLab       ,       .         <code>coverage</code>;     capture-,       :</p><br>
<pre><code class="plaintext hljs">test and cover job:<font></font>
  # snip<font></font>
  coverage: /\|\s*Total\s*\|\s*(\d+[,.]\d+%)/</code></pre><br>
<p>          .</p><br>
<h3 id="publikuem-pakety-i-dokumentaciyu">   </h3><br>
<p>         â€”      ,      .</p><br>
<p>      :</p><br>
<ol>
<li><p>       nuget (<code>nuget.config</code>),  : <code>dotnet new nugetconfig</code></p><br>
<p><em>:</em>           (  ) .    ,          .</p><br>
</li>
<li>      : <code>nuget sources add -name &lt;name&gt; -source &lt;url&gt; -username &lt;organization&gt; -password &lt;gitlab variable&gt; -configfile nuget.config -StorePasswordInClearText</code><br>
<ol>
<li><code>name</code> â€”   ,  </li>
<li><code>url</code> â€” URL    " ", . 6</li>
<li><code>organization</code> â€”    Azure DevOps</li>
<li><code>gitlab variable</code> â€”     ,   GitLab (" ", . 11). ,   <code>$variableName</code></li>
<li><code>-StorePasswordInClearText</code> â€”        (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">      </a>)</li>
<li>       <code>-verbosity detailed</code></li>
</ol></li>
<li>   : <code>nuget push -source &lt;name&gt; -skipduplicate -apikey &lt;key&gt; *.nupkg</code><br>
<ol>
<li>     ,  <code>*.nupkg</code>.</li>
<li><code>name</code> â€”   .</li>
<li><code>key</code> â€”  .  Azure DevOps   Connect to feed       <code>az</code>.</li>
<li><code>-skipduplicate</code> â€”             <code>409 Conflict</code>;     .</li>
</ol></li>
</ol><br>
<p>   :</p><br>
<ol>
<li> ,  ,   master,   docfx.        <code>docfx init</code>          .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>.<br>
<ol>
<li>      <code>..\public</code> â€” GitLab      public       Pages. ..         â€”       .</li>
</ol></li>
<li>   GitLab.</li>
<li>     <code>pages</code> (       GitLab Pages):<br>
<ol>
<li>:<br>
<ol>
<li><code>nuget install docfx.console -version 2.51.0</code> â€”  docfx;        .</li>
<li><code>.\docfx.console.2.51.0\tools\docfx.exe .\docfx_project\docfx.json</code> â€”  </li>
</ol></li>
<li> artifacts:</li>
</ol></li>
</ol><br>
<pre><code class="plaintext hljs">pages:<font></font>
  # snip<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - public</code></pre><br>
<h4 id="liricheskoe-otstuplenie-pro-docfx">   docfx</h4><br>
<p>            .   â€”      .  ,    ,      <code>metadata.src</code>:</p><br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"metadata"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"src"</span>: [<font></font>
        {<font></font>
          <span class="hljs-attr">"src"</span>: <span class="hljs-string">"../"</span>,
          <span class="hljs-attr">"files"</span>: [
            <span class="hljs-string">"**/*.csproj"</span><font></font>
          ],<font></font>
          <span class="hljs-attr">"exclude"</span>:[
            <span class="hljs-string">"*.tests*/**"</span><font></font>
          ]<font></font>
        }<font></font>
      ],<font></font>
      <span class="hljs-comment">// --- snip ---</span><font></font>
    },<font></font>
    <span class="hljs-comment">// --- snip ---</span><font></font>
  ],<font></font>
  <span class="hljs-comment">// --- snip ---</span>
}</code></pre><br>
<ol>
<li><code>metadata.src.src: "../"</code> â€”       <code>docfx.json</code>, ..         .</li>
<li><code>metadata.src.files: ["**/*.csproj"]</code> â€”  ,    C#   .</li>
<li><code>metadata.src.exclude: ["*.tests*/**"]</code> â€”  ,      <code>.tests</code>  </li>
</ol><br>
<h3 id="promezhutochnyy-itog"> </h3><br>
<p>            ,           ,      ,   ,         README .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"> .gitlab-ci.yml</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">image: mcr.microsoft.com/dotnet/core/sdk:3.1<font></font>
<font></font>
before_script:<font></font>
  - $PSVersionTable.PSVersion<font></font>
  - dotnet --version<font></font>
  - nuget help | select-string Version<font></font>
<font></font>
stages:<font></font>
  - build<font></font>
  - test<font></font>
  - deploy<font></font>
<font></font>
build job:<font></font>
  stage: build<font></font>
  script:<font></font>
    - dotnet build -c Release<font></font>
  tags:<font></font>
    - windows<font></font>
  only:<font></font>
    - merge_requests<font></font>
    - master<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - your/path/to/binaries<font></font>
<font></font>
test and cover job:<font></font>
  stage: test<font></font>
  tags:<font></font>
    - windows<font></font>
  script:<font></font>
    - dotnet test -c Release /p:CollectCoverage=true<font></font>
  coverage: /\|\s*Total\s*\|\s*(\d+[,.]\d+%)/<font></font>
  only:<font></font>
    - merge_requests<font></font>
    - master<font></font>
<font></font>
pack and deploy job:<font></font>
  stage: deploy<font></font>
  tags:<font></font>
    - windows<font></font>
  script:<font></font>
    - dotnet pack -c Release -o .<font></font>
    - dotnet new nugetconfig<font></font>
    - nuget sources add -name feedName -source https://pkgs.dev.azure.com/your-organization/_packaging/your-feed/nuget/v3/index.json -username your-organization -password $nugetFeedToken -configfile nuget.config -StorePasswordInClearText<font></font>
    - nuget push -source feedName -skipduplicate -apikey az *.nupkg<font></font>
  only:<font></font>
    - master<font></font>
<font></font>
pages:<font></font>
  tags:<font></font>
    - windows<font></font>
  stage: deploy<font></font>
  script:<font></font>
    - nuget install docfx.console -version 2.51.0<font></font>
    - $env:path = "$env:path;$($(get-location).Path)"<font></font>
    - .\docfx.console.2.51.0\tools\docfx.exe .\docfx\docfx.json<font></font>
  artifacts:<font></font>
    paths:<font></font>
      - public<font></font>
  only:<font></font>
    - master</code></pre></div>
                    </div><br>
<h4 id="kstati-o-beydzhikah">  </h4><br>
<p>     !</p><br>
<p>         GitLab   CI/CD   Gtntral pipelines:</p><br>
<p><img src="https://habrastorage.org/webt/zt/rp/ih/ztrpihz2fangy7ec_kk2if4ut-y.png" alt="GitLabä¸­çš„å¾½ç« "></p><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Shields.io</a> â€”    ,          .</p><br>
<pre><code class="plaintext hljs">![  Shields.io](https://img.shields.io/badge/custom-badge-blue)</code></pre><br>
<p><img src="https://img.shields.io/badge/custom-badge-blue" alt="Shields.ioçš„ç¤ºä¾‹"></p><br>
<p>Azure DevOps Artifacts          .       Azure DevOps    Create badge      markdown-:</p><br>
<p><img src="https://habrastorage.org/webt/hf/f_/2f/hff_2f_lxmq7lsu5v_85qigk6ra.png" alt="åœ¨Azure DevOpsä¸Šåˆ›å»ºå¾½ç« "></p><br>
<p><img src="https://habrastorage.org/webt/rp/sq/g2/rpsqg29eimjws5m3prikgvkdw2k.png" alt="Azure DevOpså¾½ç« ä¿¡æ¯"></p><br>
<h3 id="dobavlyaem-krasoty"> </h3><br>
<h4 id="vydelyaem-obschie-fragmenty-konfiguracii">   </h4><br>
<p>       ,      YAML â€”  .</p><br>
<p>    ,      <code>windows</code>  ,      /    ( ).    ,   :</p><br>
<pre><code class="plaintext hljs">.common_tags: &amp;common_tags<font></font>
  tags:<font></font>
    - windows<font></font>
.common_only: &amp;common_only<font></font>
  only:<font></font>
    - merge_requests<font></font>
    - master</code></pre><br>
<p>         :</p><br>
<pre><code class="plaintext hljs">build job:<font></font>
  &lt;&lt;: *common_tags<font></font>
  &lt;&lt;: *common_only</code></pre><br>
<p>     ,      .</p><br>
<h4 id="versionirovanie-paketov"> </h4><br>
<p>       ,     â€”  ;   Version,        . ,      ,       ,      .</p><br>
<p>    â€”            ,    .            ,  â€”        ,           .</p><br>
<p>,         <code>release (v./ver./version) &lt;version number&gt; (rev./revision &lt;revision&gt;)?</code>,         ,          <code>dotnet pack</code>.    â€”     .</p><br>
<p>    : </p><br>
<pre><code class="powershell hljs"><span class="hljs-comment">#       </span>
<span class="hljs-variable">$rx</span> = <span class="hljs-string">"release\s+(v\.?|ver\.?|version)\s*(?&lt;maj&gt;\d+)(?&lt;min&gt;\.\d+)?(?&lt;rel&gt;\.\d+)?\s*((rev\.?|revision)?\s+(?&lt;rev&gt;[a-zA-Z0-9-_]+))?"</span>
<span class="hljs-comment">#     ,      GitLab' </span>
<span class="hljs-variable">$found</span> = <span class="hljs-variable">$env:CI_COMMIT_MESSAGE</span> <span class="hljs-operator">-match</span> <span class="hljs-variable">$rx</span>
<span class="hljs-comment">#   - </span>
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$found</span>) { <span class="hljs-built_in">Write-Output</span> <span class="hljs-string">"no release info found, aborting"</span>; <span class="hljs-keyword">exit</span> }
<span class="hljs-comment">#     </span>
<span class="hljs-variable">$maj</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-string">'maj'</span>]
<span class="hljs-variable">$min</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-string">'min'</span>]
<span class="hljs-comment">#      -  ,  -  </span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$matches</span>.ContainsKey(<span class="hljs-string">'rel'</span>)) { <span class="hljs-variable">$rel</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-string">'rel'</span>] } <span class="hljs-keyword">else</span> { <span class="hljs-variable">$rel</span> = <span class="hljs-string">".<span class="hljs-variable">$</span>(get-date -format "</span>yyyy<span class="hljs-string">")"</span> }
<span class="hljs-comment">#     -    </span>
<span class="hljs-variable">$bld</span> = <span class="hljs-variable">$</span>(<span class="hljs-built_in">get-date</span> <span class="hljs-literal">-format</span> <span class="hljs-string">"MMdd"</span>)
<span class="hljs-comment">#       -    </span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$matches</span>.ContainsKey(<span class="hljs-string">'rev'</span>)) { <span class="hljs-variable">$rev</span> = <span class="hljs-string">"-<span class="hljs-variable">$</span>(<span class="hljs-variable">$matches</span>['rev'])"</span> } <span class="hljs-keyword">else</span> { <span class="hljs-variable">$rev</span> = <span class="hljs-string">''</span> }
<span class="hljs-comment">#    </span>
<span class="hljs-variable">$version</span> = <span class="hljs-string">"<span class="hljs-variable">$maj</span><span class="hljs-variable">$min</span><span class="hljs-variable">$rel</span>.<span class="hljs-variable">$bld</span><span class="hljs-variable">$rev</span>"</span>
<span class="hljs-comment">#  </span>
dotnet pack <span class="hljs-literal">-c</span> Release <span class="hljs-literal">-o</span> . /p:Version=<span class="hljs-variable">$version</span></code></pre><br>
<p>    <code>pack and deploy job</code>            .</p><br>
<h2 id="itogo"></h2><br>
<p>  -    ,    powershell , ,   ,        . </p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œä¸é˜…è¯»æœ¬æŒ‡å—åç›¸æ¯”ï¼ŒGitLab CI / CDçš„åŠŸèƒ½æ›´åŠ å¹¿æ³›ä¸”æ¶‰åŠé¢æ›´å¹¿- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»å¯¹ä¸æ˜¯</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”šè‡³è¿˜æœ‰</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auto DevOps</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå…è®¸</font></font></p><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªåŠ¨æ£€æµ‹ï¼Œæ„å»ºï¼Œæµ‹è¯•ï¼Œéƒ¨ç½²å’Œç›‘è§†æ‚¨çš„åº”ç”¨ç¨‹åº</font></font></blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘æ‰“ç®—é…ç½®ç®¡é“ï¼Œä»¥ä½¿ç”¨Pulumiåœ¨Azureä¸­éƒ¨ç½²åº”ç”¨ç¨‹åºå¹¶è‡ªåŠ¨æ£€æµ‹ç›®æ ‡ç¯å¢ƒï¼Œè¿™å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»ã€‚</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN498416/index.html">Yandexå°†è‡ªåŠ¨å°†å¡é“¾æ¥åˆ°å¦ä¸€ä¸ªå¸æˆ·</a></li>
<li><a href="../zh-CN498418/index.html">åœ¨åª’ä½“æœåŠ¡å™¨ä¸­å®æ–½WebRTC-åšæ³•å’Œæ”¿ç­–</a></li>
<li><a href="../zh-CN498426/index.html">æˆ‘ä»¬å¦‚ä½•ç–æ•£Yandexçš„èŒè´£è½¬ç§»</a></li>
<li><a href="../zh-CN498428/index.html">WAL-Gï¼šæ–°åŠŸèƒ½å’Œç¤¾åŒºæ‰©å±•ã€‚ä¹”æ²»Â·é›·æ´›å¤«ï¼ˆGeorgy Rylovï¼‰</a></li>
<li><a href="../zh-CN498430/index.html">4æœˆ22æ—¥è¿è¾“ä¼šæ€æ ·</a></li>
<li><a href="../zh-CN498438/index.html">å®ä¹ å¯¼å¸ˆçš„8ä¸ªç®€å•é—®é¢˜</a></li>
<li><a href="../zh-CN498440/index.html">å¨èƒèšç„¦ï¼šNeshtaæ–‡ä»¶ç—…æ¯’</a></li>
<li><a href="../zh-CN498442/index.html">ä½¿ç”¨Polyspaceäº§å“çš„å…¨é¢é™æ€åˆ†æ</a></li>
<li><a href="../zh-CN498444/index.html">æ•°æ®ä¸­å¿ƒçš„ç›‘æ§ï¼šæˆ‘ä»¬å¦‚ä½•å°†æ—§çš„BMSæ›´æ”¹ä¸ºæ–°çš„BMSã€‚ç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN498446/index.html">å·¥ä½œé—®é¢˜ï¼šæƒ³è±¡ä¸­çš„ç¨³å®šæ€§ï¼Œé”™è¯¯çš„å¥‰çŒ®å’Œå®šä½</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>