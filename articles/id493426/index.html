<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌵 🤽🏼 📲 Organisasi kode dalam layanan microser dan pendekatan saya menggunakan arsitektur heksagonal dan DDD 👐🏾 🚑 🤜🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Di Monolith, semua kode harus dalam gaya yang sama, dan dalam berbagai layanan mikro Anda dapat menggunakan berbagai pendekatan, bahasa pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Organisasi kode dalam layanan microser dan pendekatan saya menggunakan arsitektur heksagonal dan DDD</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493426/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/h6/c_/akh6c_safonprea6vtagzdaoy58.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halo, Habr! Di Monolith, semua kode harus dalam gaya yang sama, dan dalam berbagai layanan mikro Anda dapat menggunakan berbagai pendekatan, bahasa pemrograman, dan kerangka kerja. Untuk layanan microser sederhana dengan 1 hingga 2 pengontrol dan 1 hingga 10 aksi, tidak ada gunanya memblokir lapisan abstraksi. Untuk layanan Microsoft yang rumit dengan kondisi yang berbeda dan logika transisi di antara keduanya, sebaliknya, lebih baik tidak malas pada awalnya. Saya ingin berbicara tentang pengalaman saya dengan mengatur kode dan menggunakan pendekatan DDD, Ports, dan Adapters untuk kedua kasus. Ada ringkasan singkat artikel: Juni - menulis kode di controller. Tengah - menulis banyak abstraksi. Senior - tahu kapan harus menulis kode di controller, dan kapan abstraksi diperlukan.</font></font><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di sini Anda perlu segera mengakhiri I - Ports di C # adalah antarmuka atau abstrak, dan Adaptor adalah implementasi konkret (kelas, struct). </font><font style="vertical-align: inherit;">Untuk referensi, saya sarankan membaca terjemahan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDD ini, Hexagonal, Bawang, Bersih, CQRS ... bagaimana saya menggabungkan semuanya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan artikel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kesalahpahaman Arsitektur Bersih ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Di sini, perlu diingat bahwa pendekatan ini digambarkan untuk monolit yang besar dan kompleks. </font><font style="vertical-align: inherit;">Saya ingin berbicara tentang variasi pendekatan ini dalam layanan microser 80 persen di antaranya sederhana dan 20 kompleksitas sedang atau tinggi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminologi</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Adaptor Utama </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memperkenalkan antarmuka yang ramah pengguna untuk </font><font style="vertical-align: inherit;">sistem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panggilan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eksternal </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Panggil dan gunakan SecondaryApdapters and Logic. </font><font style="vertical-align: inherit;">Mereka memberi tahu aplikasi untuk melakukan sesuatu. </font><font style="vertical-align: inherit;">Titik masuk ke kode Anda. </font><font style="vertical-align: inherit;">Perwakilan khas: ItemsService, CreateItemCommandHandler. </font><font style="vertical-align: inherit;">Gunakan Logic dan SecondaryAdapters untuk pekerjaan mereka.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Adaptor Sekunder </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menyediakan antarmuka ke sistem eksternal yang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disebut</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nyaman untuk digunakan oleh sistem kami. </font><font style="vertical-align: inherit;">Dia menerima perintah dari aplikasi. </font><font style="vertical-align: inherit;">Perwakilan khas: ItemsRepository, EmailSender, Logger, DistributedCache. </font><font style="vertical-align: inherit;">Mereka menggunakan pustaka dan kerangka kerja seperti EntityFramework untuk pekerjaan mereka.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Logika</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1) Entitas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gabungkan data dan logika. </font><font style="vertical-align: inherit;">Objek OOP yang khas. </font><font style="vertical-align: inherit;">Barang, Uang, Pengguna. </font><font style="vertical-align: inherit;">Ada juga ValueObjects dan Acara. </font><font style="vertical-align: inherit;">Hanya objek lain dari lapisan Entitas yang digunakan. </font><font style="vertical-align: inherit;">Secara teori, lapisan ini adalah inti dari aplikasi yang tidak bergantung pada siapa pun. </font><font style="vertical-align: inherit;">Semua tergantung padanya.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2) Layanan Domain</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Komputasi telanjang. </font><font style="vertical-align: inherit;">Mereka diperlukan untuk logika yang tidak dapat dilampirkan ke satu entitas tertentu. </font><font style="vertical-align: inherit;">Gunakan Entitas atau Layanan Domain lainnya. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gunakan PrimaryAdapters (mereka selalu menggunakan semuanya sendiri) dan SecondaryAdapters. </font><font style="vertical-align: inherit;">Biasanya ini semua jenis AmountCalculator, Validator dan banyak lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alur panggilan kode harus selalu dalam satu arah, PrimaryAdapters -&gt; Logic and SecondaryAdapters.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah area subjek di mana sistem sedang dikembangkan. </font><font style="vertical-align: inherit;">Misalnya, untuk Domain Online Store, ini adalah E-Commerce.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konteks terikat</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BoundedContext digunakan untuk membagi sistem menjadi bagian-bagian yang terisolasi dengan tanggung jawab tertentu. Salah satu cara untuk sukses dalam desain sistem adalah menemukan dan menyorot semua BoundedContexts di dalamnya. Dalam arsitektur microservice, 1 microservice = 1 BoundedContext. Misalnya: Toko online mungkin memiliki Keranjang Belanja BoundedContext dan BoundedContext bekerja dengan pesanan, BoundedContext bekerja dengan file. Dan satu BoundedContext besar dapat dipecah menjadi bagian-bagian kecil di dalamnya. Misalnya, untuk Konteks Terbatas dari keranjang barang, Anda dapat membuat divisi ke dalam konteks menambahkan barang ke keranjang dan konteks mengeluarkan barang dari keranjang. Dalam monolit 1, BoundedContext besar adalah satu Modul. Di sini perlu untuk membuat pernyataan bahwa semua Entitas hidup dalam konteks tertentu yaituItem dari konteks keranjang barang dan Item dari konteks showcase barang, ini dapat menjadi kelas yang berbeda dengan bidang dan metode yang berbeda. Dalam sebuah monolit, mereka hanya memetakan satu sama lain dan menggunakan beberapa ItemDto yang dilewati EF untuk bekerja dengan database dan yang memiliki bidang yang sama untuk semua, yaitu, jika Item dari konteks (modul) Keranjang memiliki properti Property1, dan Item dari konteks etalase toko barang memiliki properti Property2 maka ItemDto akan memiliki Property1 dan Property2. Dalam setiap konteks akan ada repositori sendiri yang akan mengeluarkan Item, yang sudah menjadi karakteristik dari konteks ini, dari database. Dalam layanan microser, ini mudah. Masing-masing memiliki database sendiri dan esensinya sendiri. Setiap layanan dunia memiliki kelasnya sendiri. Secara sederhanaDalam sebuah monolit, mereka hanya memetakan satu sama lain dan menggunakan beberapa ItemDto yang dilewati EF untuk bekerja dengan database dan yang memiliki bidang yang sama untuk semua, yaitu, jika Item dari konteks (modul) Keranjang memiliki properti Property1, dan Item dari konteks etalase toko barang memiliki properti Property2 maka ItemDto akan memiliki Property1 dan Property2. Dalam setiap konteks akan ada repositori sendiri yang akan menarik dari database Item yang sudah menjadi karakteristik dari konteks ini. Dalam layanan microser, ini mudah. Masing-masing memiliki database sendiri dan esensinya sendiri. Setiap layanan dunia memiliki kelasnya sendiri. Secara sederhanaDalam sebuah monolit, mereka hanya memetakan satu sama lain dan menggunakan beberapa ItemDto yang dilewati EF untuk bekerja dengan database dan yang memiliki bidang yang sama untuk semua, yaitu, jika Item dari konteks (modul) Keranjang memiliki properti Property1, dan Item dari konteks etalase toko barang memiliki properti Property2 maka ItemDto akan memiliki Property1 dan Property2. Dalam setiap konteks akan ada repositori sendiri yang akan mengeluarkan Item, yang sudah menjadi karakteristik dari konteks ini, dari database. Dalam layanan microser, ini mudah. Masing-masing memiliki database sendiri dan esensinya sendiri. Setiap layanan dunia memiliki kelasnya sendiri. Secara sederhanaDalam setiap konteks akan ada repositori sendiri yang akan mengeluarkan Item, yang sudah menjadi karakteristik dari konteks ini, dari database. Dalam layanan microser, ini mudah. Masing-masing memiliki database sendiri dan esensinya sendiri. Setiap layanan dunia memiliki kelasnya sendiri. Secara sederhanaDalam setiap konteks akan ada repositori sendiri yang akan menarik dari database Item yang sudah menjadi karakteristik dari konteks ini. Dalam layanan microser, ini mudah. Masing-masing memiliki database sendiri dan esensinya sendiri. Setiap layanan dunia memiliki kelasnya sendiri. Secara sederhana</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bahwa Item dan ItemsRepository dari BoundedContext yang berbeda dapat berupa objek yang berbeda dengan metode dan properti yang berbeda. </font><font style="vertical-align: inherit;">Seringkali, BoundedContext dalam layanan microser dilanggar oleh pengenalan beberapa perpustakaan umum. </font><font style="vertical-align: inherit;">Hasilnya adalah kelas yang memiliki beberapa lusin metode atau properti dan masing-masing layanan microser menggunakan 1 - 2 hanya yang dibutuhkan, jadi Anda harus berhati-hati dengan pustaka bersama dalam layanan microser.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketergantungan antar lapisan</font></font></h3><br>
<img src="https://habrastorage.org/webt/8g/kb/4y/8gkb4yjeoduvybjcxsyo77apjre.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi untuk layanan microser sederhana yang undang-undang Pareto 80 persen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buang layer PrimaryAdatapters dan SecondaryAdapters. Sisakan hanya lapisan Logika. Lebih tepatnya, dalam aplikasi ASP.NET yang biasa kita gunakan - PimaryAdater adalah Controller, dan SecondaryAdapter adalah DbContext dari EF. Jika Controller tiba-tiba menjadi terlalu besar, maka kita potong-potong menggunakan parsial. Ini jauh lebih baik daripada membiakkan abstraksi yang tidak perlu dan menghabiskan waktu untuk itu. Sebagai contoh, Microsoft melakukan ini untuk layanan BasketMicrotservice dalam contoh aplikasi EShop pada wadah buruh pelabuhan. Ya, cukup tulis kode ke controller. Hanya saja, jangan menulis kode spageti. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penting</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingat bahwa lapisan Logik tetap bersama kami dan kami masih menggunakan Entitas dengan logika mereka dan DomainServices dengan perhitungan mereka dan tidak hanya menulis dinding kode spaghetti di controller. </font><font style="vertical-align: inherit;">Kami hanya membuang ItemService dan ItemRepository yang khas. </font><font style="vertical-align: inherit;">ItemValidator tua yang baik, ItemMapper, AmountCalculator, dll. Dalam semangat ini masih tetap bersama kami. </font><font style="vertical-align: inherit;">Karena kita masih memiliki lapisan Logika yang terbentuk, kita dapat beralih ke opsi yang lebih rumit kapan saja dengan membungkus abstraksi tambahan dengan ItemsService, ItemsRepository.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Layanan yang menghitung harga akhir suatu produk dengan diskon. </font><font style="vertical-align: inherit;">Secara teori, ini adalah bagian dari Domain Online Store dan mewakili katalog produk BoundedContext. </font><font style="vertical-align: inherit;">Untuk kesederhanaan, saya melewatkan semua logika validasi. </font><font style="vertical-align: inherit;">Itu dapat dijelaskan dalam semacam ItemValidator dan DiscountValidator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Folder logika: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.1) Folder entitas: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diskon:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Discount</span><font></font>
    {<font></font>
        [<span class="hljs-meta">Key</span>]
        <span class="hljs-keyword">public</span> Guid Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uang:</font></font><br>
<br>
<pre><code class="cs hljs">    [<span class="hljs-meta">Owned</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Money</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> Amount { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Money <span class="hljs-title">Apply</span>(<span class="hljs-params">Discount discount</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> amount = Amount * (<span class="hljs-number">1</span> - discount.Value);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Money()<font></font>
            {<font></font>
                Amount = amount<font></font>
            };<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Produk:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Item</span><font></font>
    {<font></font>
        [<span class="hljs-meta">Key</span>]
        <span class="hljs-keyword">public</span> Guid Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> Money Price { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span> Money();<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.2) Folder DomainServices </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kalkulator harga </font><font style="vertical-align: inherit;">produk </font><font style="vertical-align: inherit;">, termasuk diskon:</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPriceCalculator</span><font></font>
    {<font></font>
        <span class="hljs-function">Money <span class="hljs-title">WithDiscounts</span>(<span class="hljs-params">Item item, IEnumerable&lt;Discount&gt; discounts</span>)</span>;<font></font>
    }<font></font>
<font></font>
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PriceCalculator</span>:<span class="hljs-title">IPriceCalculator</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Money <span class="hljs-title">WithDiscounts</span>(<span class="hljs-params">Item item, IEnumerable&lt;Discount&gt; discounts</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> discounts.Aggregate(item.Price, (m, d) =&gt; m.Apply(d));<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) DbContext </font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsDbContext</span> : <span class="hljs-title">DbContext</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsDbContext</span>(<span class="hljs-params">DbContextOptions&lt;ItemsDbContext&gt; options</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">options</span>)</span><font></font>
        {<font></font>
<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> DbSet&lt;Item&gt; Items { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> DbSet&lt;Discount&gt; Discounts { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Pengendali</font></font><br>
<br>
<pre><code class="cs hljs">    [<span class="hljs-meta">ApiController</span>]<font></font>
    [<span class="hljs-meta">Route(<span class="hljs-meta-string">"api/v1/items"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsController</span> : <span class="hljs-title">ControllerBase</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ItemsDbContext _context;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPriceCalculator _priceCalculator;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsController</span>(<span class="hljs-params">ItemsDbContext context, IPriceCalculator priceCalculator</span>)</span><font></font>
        {<font></font>
            _context = context;<font></font>
            _priceCalculator = priceCalculator;<font></font>
        }<font></font>
<font></font>
        [<span class="hljs-meta">HttpGet(<span class="hljs-meta-string">"{id}/price-with-discounts"</span>)</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">await</span> _context.Items.FindAsync(id);
            <span class="hljs-keyword">var</span> discounts = <span class="hljs-keyword">await</span> _context.Discounts.ToListAsync();
            <span class="hljs-keyword">return</span> _priceCalculator.WithDiscounts(item, discounts).Amount;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi untuk layanan microser kompleks yang 20 persen dan untuk sebagian besar monolit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kami menggunakan pendekatan standar dengan isolasi maksimum lapisan dari satu sama lain. </font><font style="vertical-align: inherit;">Tambahkan kelas untuk PrimaryAdapter (ItemService) dan untuk SecondaryAdapter (ItemRepository). </font><font style="vertical-align: inherit;">Dalam folder Logika, semuanya tetap seperti sebelumnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Folder SecondaryAdapters</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IItemsRepository</span><font></font>
    {<font></font>
        <span class="hljs-function">Task&lt;Item&gt; <span class="hljs-title">Get</span>(<span class="hljs-params">Guid id</span>)</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsRepository</span> : <span class="hljs-title">IItemsRepository</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ItemsDbContext _context;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsRepository</span>(<span class="hljs-params">ItemsDbContext context</span>)</span><font></font>
        {<font></font>
            _context = context;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;Item&gt; <span class="hljs-title">Get</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">await</span> _context.Items.FindAsync(id);
            <span class="hljs-keyword">return</span> item;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDiscountsRepository</span><font></font>
    {<font></font>
        Task&lt;List&lt;Discount&gt;&gt; Get();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DiscountsRepository</span> : <span class="hljs-title">IDiscountsRepository</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ItemsDbContext _context;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DiscountsRepository</span>(<span class="hljs-params">ItemsDbContext context</span>)</span><font></font>
        {<font></font>
            _context = context;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> Task&lt;List&lt;Discount&gt;&gt; Get()<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> _context.Discounts.ToListAsync();<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) folder PrimaryAdapters</font></font><br>
<br>
<pre><code class="cs hljs">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IItemService</span><font></font>
    {<font></font>
        <span class="hljs-function">Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemService</span> : <span class="hljs-title">IItemService</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IItemsRepository _items;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IDiscountsRepository _discounts;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPriceCalculator _priceCalculator;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemService</span>(<span class="hljs-params">IItemsRepository items, IDiscountsRepository discounts, IPriceCalculator priceCalculator</span>)</span><font></font>
        {<font></font>
            _items = items;<font></font>
            _discounts = discounts;<font></font>
            _priceCalculator = priceCalculator;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">await</span> _items.Get(id);
            <span class="hljs-keyword">var</span> discounts = <span class="hljs-keyword">await</span> _discounts.Get();
            <span class="hljs-keyword">return</span> _priceCalculator.WithDiscounts(item, discounts).Amount;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengontrol kami sekarang menggunakan IItemService kami</font></font><br>
<br>
<pre><code class="cs hljs">    [<span class="hljs-meta">ApiController</span>]<font></font>
    [<span class="hljs-meta">Route(<span class="hljs-meta-string">"api/v1/items"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemsController</span> : <span class="hljs-title">ControllerBase</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IItemService _service;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ItemsController</span>(<span class="hljs-params">IItemService service</span>)</span><font></font>
        {<font></font>
            _service = service;<font></font>
        }<font></font>
<font></font>
        [<span class="hljs-meta">HttpGet(<span class="hljs-meta-string">"{id}/price-with-discounts"</span>)</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">decimal</span>&gt; <span class="hljs-title">GetPriceWithDiscount</span>(<span class="hljs-params">Guid id</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> _service.GetPriceWithDiscount(id);
            <span class="hljs-keyword">return</span> result;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menambahkan banyak kode tambahan. Sebaliknya, peningkatan fleksibilitas sistem. Sekarang lebih mudah untuk mengubah Contoller dan umumnya ASP.NET Core ke sesuatu yang lain atau mengubah DbContext dan EntityFramework Core ke sesuatu yang lain atau menambahkan caching ke Redis. Pendekatan pertama menang dalam layanan microser sederhana dan monolit yang sangat sederhana dan kecil. Yang kedua dalam semua kasus lain, ketika Anda perlu menambahkan dan menyelesaikan kode ini selama lebih dari satu tahun. Nah, dalam pendekatan kedua, selain Item Entitas dan Diskon, akan berguna untuk membuat DTO terpisah yang akan menggunakan DbContex EF dan memisahkan DTO (Model) yang akan digunakan oleh Pengontrol ASP.NET dengan menggunakan I.e. ItemDto dan ItemModel. Ini akan membuat model domain lebih mandiri. Dan akhirnya, contoh aplikasi sederhana yang saya tulis menggunakan pendekatan 2nd </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TestRuvds</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Faktanya, dia berlebihan di sini, dan semua abstraksi ini ada di sini sebagai contoh.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh implementasi</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modul VirtualServers</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ucapan Terima Kasih</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
terima kasih </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canxes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AndrewDemb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk kesalahan tata bahasa ditemukan.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id493412/index.html">Game dengan Wifi di ESP32</a></li>
<li><a href="../id493416/index.html">IDA Pro dan teknik reverse engineering</a></li>
<li><a href="../id493418/index.html">Mengapa pembelajaran mesin menggunakan data "sintetis"</a></li>
<li><a href="../id493420/index.html">Cara saya untuk memperkenalkan siswa sekolah menengah pertama ke Python</a></li>
<li><a href="../id493424/index.html">Kami menerapkan konversi kode Python</a></li>
<li><a href="../id493428/index.html">"Kami tidak akan memunculkan teori konspirasi." Bicara tentang konferensi ML dengan orang-orang dari perusahaan sains dan TI</a></li>
<li><a href="../id493430/index.html">Arsitektur Net untuk Aplikasi Web</a></li>
<li><a href="../id493432/index.html">Mengapa tidak memulai karier di perusahaan kecil non-IT</a></li>
<li><a href="../id493436/index.html">Program untuk mengubah hak akses dan mendaftar nama file / direktori di Bash</a></li>
<li><a href="../id493438/index.html">Tampilkan hasil pencarian dan masalah kinerja</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>