<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>◾️ 🙆🏾 🏜️ Accélérez le rendu de MatTable en quelques étapes 🕸️ 🏴󠁧󠁢󠁥󠁮󠁧󠁿 🚋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il arrive souvent que la majeure partie de l'application soit composée de différentes listes et tableaux. Afin de ne pas réinventer la roue à chaque f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Accélérez le rendu de MatTable en quelques étapes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503844/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il arrive souvent que la majeure partie de l'application soit composée de différentes listes et tableaux. </font><font style="vertical-align: inherit;">Afin de ne pas réinventer la roue à chaque fois, j'ai, comme beaucoup, souvent utilisé des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tables de matériaux angulaires</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus tard, ces tableaux ont augmenté, les données textuelles et les éléments imbriqués ont été placés dans des cellules. </font><font style="vertical-align: inherit;">Tout cela grandit et devient une bonne charge sur la machine de l'utilisateur. </font><font style="vertical-align: inherit;">Et bien sûr, personne n'aime ça. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon dernier projet à domicile, il y avait une table dont les cellules étaient pour la plupart remplies de différents champs (on pourrait même dire que c'était une seule grande forme). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le rendu a pris environ 8 secondes (table 40 x 40). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, comment pouvez-vous optimiser MatTable pour les grandes listes?</font></font><br>
<br>
<img src="https://mohamed-sabry.com/wp-content/uploads/2019/02/performance.jpg" alt="image"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cas de test</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'aider les autres à résoudre ce problème, j'ai écrit une petite application de test. Tous la même table MatTable, avec cinq colonnes (la première est l'id de l'élément, les autres sont des champs de texte MatFormField normaux). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fk/rc/4u/fkrc4uph55ayejqbdqbnitwb-nu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que ce soit une simple table, mais même en rendant 100 le drain d'une telle table ne prend ni plus ni moins de 2 secondes (Oh, ce matériau et ses performances "top"). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x2/dl/vm/x2dlvmlcvsotvdikpcoebafj4ia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le rendu lui-même dans ce cas a pris seulement (860 ms), cependant, la page a gelé pendant 2,2 secondes et l'utilisateur était bouleversé.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, essayons de rendre un tableau avec 300 lignes. </font><font style="vertical-align: inherit;">Et le roulement de tambour, on attend un peu et on voit que près de 10 secondes ont été consacrées au script et au rendu au total. </font><font style="vertical-align: inherit;">Autrement dit, dans le cas où l'utilisateur souhaite afficher un tel tableau sur 300 lignes, sa page se fige pendant 10 secondes. </font><font style="vertical-align: inherit;">C'est très effrayant et étonnant (en fait pas). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2b/y4/z7/2by4z7zeyqjjcl1vmst-x1rm_ge.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, j'essayais toujours de mesurer le temps qu'il faudrait pour dessiner 1000 éléments, mais mon pathétique i7 ne pouvait pas le supporter et la page tombait constamment. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous essaierons de le faire plus tard avec la solution déjà appliquée.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solution au problème</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et donc, tout le monde peut prendre des mesures à l'aide d'utilitaires basés sur un navigateur, mais il n'y a pas de solution à ce problème. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette décision m’a conduit à raisonner sur l’essence même du problème.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une bonne compréhension du problème représente déjà au moins la moitié de sa solution.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pense que tout le monde comprend que cela se produit parce que les données de la table sont d'abord traitées par des scripts, puis crachées en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un seul morceau</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">À son tour, c'est précisément pourquoi nous voyons une suspension caractéristique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Problème trouvé. </font><font style="vertical-align: inherit;">Reste maintenant à découvrir comment le résoudre. </font><font style="vertical-align: inherit;">La toute première solution qui vient à l'esprit est la plus simple. </font><font style="vertical-align: inherit;">Si le problème traite toutes les données en même temps, vous devez faire en sorte que la table traite les données en plusieurs parties. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais comment faire ça? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pensons à ce que nous avons pour cela hors de la boîte. </font><font style="vertical-align: inherit;">La première chose qui me vient à l'esprit est la fonction Track By. </font><font style="vertical-align: inherit;">Lors de la modification de la source de données, la table entière ne sera pas restituée, mais uniquement ses modifications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutons cette fonction à notre tableau:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">mat-table</span> [<span class="hljs-attr">trackBy</span>]=<span class="hljs-string">"trackByFn"</span> [<span class="hljs-attr">dataSource</span>]=<span class="hljs-string">"commonDataSource"</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, mais nous n'avons pas une telle condition que les données de la table changent d'une manière ou d'une autre, et ce n'est pas le sujet de la conversation maintenant. </font><font style="vertical-align: inherit;">Mais que se passe-t-il si nous écrivons Pipe, qui, lors de l'initialisation de la source de données, cassera les données et les donnera à la table par portions. </font><font style="vertical-align: inherit;">À son tour, la fonction trackBy aidera à éviter un rendu complet.</font></font><br>
<br>
<pre><code class="javascript hljs">@Pipe({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'splitSchedule'</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SplitPipe</span> <span class="hljs-title">implements</span> <span class="hljs-title">PipeTransform</span> </span>{<font></font>
  public transform(value: any, <span class="hljs-attr">takeBy</span>: number = <span class="hljs-number">4</span>, <span class="hljs-attr">throttleTime</span>: number = <span class="hljs-number">40</span>): Observable&lt;<span class="hljs-built_in">Array</span>&lt;any&gt;&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.isArray(value)<font></font>
      ? <span class="hljs-keyword">this</span>.getSplittedThread(value, takeBy, throttleTime)<font></font>
      : <span class="hljs-keyword">of</span>(value);<font></font>
  }<font></font>
<font></font>
  private getSplittedThread(data: <span class="hljs-built_in">Array</span>&lt;any&gt;, takeBy: number, <span class="hljs-attr">throttleTime</span>: number): Observable&lt;<span class="hljs-built_in">Array</span>&lt;any&gt;&gt; {
    <span class="hljs-keyword">const</span> repeatNumber = <span class="hljs-built_in">Math</span>.ceil(data.length / takeBy);
    <span class="hljs-keyword">return</span> timer(<span class="hljs-number">0</span>, throttleTime).pipe(<font></font>
      map(<span class="hljs-function">(<span class="hljs-params">current</span>) =&gt;</span> data.slice(<span class="hljs-number">0</span>, takeBy * ++current)),<font></font>
      take(repeatNumber)<font></font>
    );<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un si petit morceau de code qui aidera votre matériel à rendre de si grandes tables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appliquez ce tuyau à notre source de données.</font></font><br>
<br>
<pre><code class="xml hljs">
<span class="hljs-tag">&lt;<span class="hljs-name">mat-table</span> [<span class="hljs-attr">trackBy</span>]=<span class="hljs-string">"trackByFn"</span>
           [<span class="hljs-attr">dataSource</span>]=<span class="hljs-string">"commonDataSource | splitSchedule | async"</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons maintenant de prendre des mesures. </font><font style="vertical-align: inherit;">Rendu 100, 300 et 1000 éléments. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k9/ge/dy/k9gedy95dj4dxjuwc1_oe6dr2fc.png"><br>
<br>
<img src="https://habrastorage.org/webt/-m/gw/sk/-mgwskq0o-c_hlgms6e0jzo0tjw.png"><br>
<br>
<img src="https://habrastorage.org/webt/ep/fh/id/epfhidruvwampy1yxgrusej__sc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et que voyons-nous? </font><font style="vertical-align: inherit;">Ce qui est vraiment le succès n'est pas ce que nous attendions:</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 300 éléments rendus 1 seconde plus vite </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1000 rendus en 11 secondes et l'onglet n'est pas mort </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et 100 éléments rendus généralement 150 ms de plus </font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ne vous précipitez pas pour tirer des conclusions, examinons d'abord le comportement de la page dans les deux cas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/l0/bv/wil0bvryq-7p4webmepcdnmg9cs.gif"><br>
 <br>
<img src="https://habrastorage.org/webt/4a/ho/pm/4ahopmeahip3lcxghuq7li6v4ju.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, dans le cas habituel, la page se fige pendant quelques secondes et l'utilisateur ne peut rien faire à ce moment, alors que l'utilisation de notre pipe avec un lien vers trackBy donne à l'utilisateur une initialisation presque instantanée de la table et ne cause aucun inconfort lors de l'utilisation de l'application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espère que cet article aide quelqu'un. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code source de l'application de test se trouve sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack Blitz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr503830/index.html">Amazon a ouvert un grand refuge pour les sans-abri</a></li>
<li><a href="../fr503832/index.html">Recettes PostgreSQL: moteur de modèle de moustache</a></li>
<li><a href="../fr503836/index.html">Avantages et inconvénients des technologies de modération des commentaires (+ sondage)</a></li>
<li><a href="../fr503838/index.html">ACLcheck - Utilitaire de vérification de liste d'accès Cisco IOS</a></li>
<li><a href="../fr503842/index.html">Prothèse cérébrale: synchronisation des réseaux neuronaux artificiels et biologiques</a></li>
<li><a href="../fr503846/index.html">Flash, "Qu'il meure à nouveau est inconnu, mais les fleurs disparaissent ..."</a></li>
<li><a href="../fr503848/index.html">Nous vous invitons à des webinaires gratuits sur l'impression SLS sur Sinterit 26.05 et les scanners 3D Shining 28.05</a></li>
<li><a href="../fr503854/index.html">Utilisez SIL au maximum</a></li>
<li><a href="../fr503858/index.html">Le livre "Terraform: infrastructure au niveau du code"</a></li>
<li><a href="../fr503860/index.html">Configuration de l'environnement du réseau de neurones Mask R-CNN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>