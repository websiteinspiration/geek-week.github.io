<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîµ üèì üëæ Confer√™ncia DEFCON 27. Buttplug: True Penetration Testing. Parte 1 üò± üëÉüèº üöµüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os analistas acreditam que atualmente existem cerca de 10 bilh√µes de dispositivos do mundo da Internet das Coisas (IoT). √Äs vezes, esses dispositivos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Confer√™ncia DEFCON 27. Buttplug: True Penetration Testing. Parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495378/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os analistas acreditam que atualmente existem cerca de 10 bilh√µes de dispositivos do mundo da Internet das Coisas (IoT). √Äs vezes, esses dispositivos ganham seu lugar no mercado, literalmente subindo no traseiro humano. Como se viu, chips de r√°dio baratos e de baixa pot√™ncia n√£o s√£o √≥timos apenas para automa√ß√£o residencial - eles tamb√©m mudam a maneira como as pessoas interagem com brinquedos sexuais. Neste relat√≥rio, mergulharemos no mundo das dild√¥nicas da televis√£o, a tecnologia do sexo a uma dist√¢ncia na qual t√°til, temperatura e outras sensa√ß√µes s√£o transmitidas entre os parceiros atrav√©s de uma linha de comunica√ß√£o bidirecional. O orador lhe dir√° que a seguran√ßa dos brinquedos sexuais anal eletr√¥nicos eletr√¥nicos Buttplug pode se opor a um invasor que encontra e explora vulnerabilidades em cada n√≠vel da pilha. Por fim, isso permite que os brinquedos sexuais sejam comprometidos,e os dispositivos aos quais eles se conectam.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um hacker com o apelido smea, ou Smealum, iniciou sua carreira como desenvolvedor de videogames para consoles de jogos como o Nintendo DS, tentando simultaneamente decifr√°-los. Em algum momento, os consoles adquiriram sistemas de seguran√ßa s√©rios, e Smea passou do software dom√©stico para o desenvolvimento de t√©cnicas para quebr√°-lo. Smea √© conhecido por seu "trabalho" no Nintendo 3DS e no Wii U, embora tamb√©m tenha contribu√≠do para o desenvolvimento de explora√ß√µes para os mais populares navegadores da Web e pilhas de virtualiza√ß√£o. Provavelmente, agora ele se interessou em invadir plugues anal "inteligentes".</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√° pessoal, eu sou Smia, e hoje falaremos sobre como quebrar um plug de inicializa√ß√£o. Este √© um objeto que tenho na m√£o, n√£o sei se voc√™ j√° viu antes, pessoalmente n√£o. Mas, nos √∫ltimos dois anos, conheci muitos representantes interessantes da ind√∫stria da Internet das Coisas, e agora chegou a vez disso. Voc√™ pode estar se perguntando como pode quebrar um bootplag, porque √© apenas um peda√ßo de silicone que precisa ser inserido em algum lugar, e voc√™ concorda que n√£o h√° muitos lugares para isso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, isso n√£o requer nenhum componente eletr√¥nico. Mas, nos √∫ltimos anos, ou mesmo d√©cadas, surgiu uma nova ind√∫stria de dispositivos eletr√¥nicos chamada teledildonika. A origem desse termo √© mostrada no slide: a palavra grega "tele" significa "de longe" e o ingl√™s "dildo" significa apenas um vibrador. Tentei encontrar a origem da palavra vibrador, mas ningu√©m sabe de onde ela veio. Mas isso √© compreens√≠vel, certo? A id√©ia √© que voc√™ queira fazer brinquedos sexuais que de alguma forma possam ser controlados √† dist√¢ncia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem v√°rios cen√°rios para isso. Eu s√≥ quero explicar como isso funciona, porque nem todos est√£o familiarizados com esses dispositivos. Ent√£o, voc√™ pega o bootplag, insira-o quando necess√°rio e pode control√°-lo remotamente de onde quiser - do seu telefone, laptop etc. Este √© o primeiro cen√°rio chamado "jogo solo". O segundo cen√°rio que chamei de "multiplayer local" - √© quando voc√™ transfere o controle dessa coisa para outra pessoa. Isso √© algo bastante real que geralmente √© anunciado - voc√™ pode, por exemplo, ir a um bar com ela e ningu√©m saber√° como √© divertido. Mas tecnicamente, isso cria um novo vetor de ataque, porque voc√™ d√° o controle do dispositivo a algu√©m de fora, e aqui o modelo de amea√ßa realmente muda.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terceiro cen√°rio, "multiplayer remoto", √© semelhante ao segundo, s√≥ que agora voc√™ permite que outra pessoa controle o dispositivo pela Internet. Lembre-se de que essa pessoa pode ser um estranho. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/nb/hr/mnnbhrbihysuf1iengokudmgudm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para muitos, fazer sexo √† dist√¢ncia parece bem legal e divertido, e n√£o vou brincar sobre isso. Alguns usam teledildonics para ganhar a vida, e o cen√°rio 3B √© chamado de "multiplayer pago remoto". Portanto, o fato de eu estar tentando quebrar o plug anal n√£o √© apenas entretenimento - isso d√° aos meus estudos de penetra√ß√£o uma certa justificativa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gn/g0/m4/gng0m40-kjudzygpgp6fkeczt_i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitas pessoas, n√£o sei como cham√°-las - meninos, meninas - oferecem entretenimento sexual din√¢mico na Internet, permitindo que outras pessoas controlem seus brinquedos sexuais por dinheiro. A empresa que produz essas bundas possui uma patente para o conceito de dedu√ß√£o de lucros ao usar seus produtos para jogos sexuais na Internet. Nesse cen√°rio, para dedu√ß√µes de US $ 5, voc√™ tem o direito de colocar um link, por exemplo, no Twitter, para fornecer a algu√©m a oportunidade de gerenciar seu bootplag por um tempo limitado. Como as pessoas confiam nesses brinquedos como ferramentas para ganhar dinheiro, na minha opini√£o, √© muito importante considerar sua seguran√ßa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos cen√°rios que s√£o de interesse dos invasores. O primeiro √© um hack local, quando um invasor que est√° ao alcance do dispositivo intercepta o controle por meio de comunica√ß√£o sem fio. Houve muita pesquisa sobre esse m√©todo de hackers, por isso n√£o ficaremos presos √† nossa aten√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/wb/8g/gywb8gehwmsgsmf_5pra4m_lmr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tecnicamente, essa interven√ß√£o pode ser considerada abuso sexual; portanto, seja legal ou n√£o, n√£o tente faz√™-lo. De acordo com o cen√°rio a seguir, um invasor faz a mesma coisa, mas remotamente, pela Internet. Como eu j√° disse, se voc√™ ganhar assim, poder√° muito bem fornecer voluntariamente a um estranho - um atacante com acesso remoto ao seu brinquedo sexual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso significa que um hacker pode comprometer seus brinquedos sexuais "inteligentes" ou dispositivos relacionados, em suma, fazer algo ruim para voc√™ e √© completamente legal, j√° que voc√™ mesmo deu a ele acesso. Para um hacker, essa √© uma op√ß√£o mais interessante, por isso permaneceremos nela por mais um tempo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/cb/hz/8vcbhzhmae_kgh9ka8v37s2jg_8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terceiro cen√°rio √© o oposto - o pr√≥prio invasor usa o plug-in de inicializa√ß√£o para controlar um computador ou telefone e hackear dispositivos localizados na lateral do usu√°rio que participa remotamente de jogos com o plug-in. As pessoas n√£o entendem que isso √© um risco real, mas voc√™ provavelmente imagina como as bucetas podem ser insidiosas (risos no corredor). Tamb√©m estamos explorando esse cen√°rio.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vn/tv/sr/vntvsrxrvefsyh_y7k48hqd7fiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora que voc√™ tem uma id√©ia do mundo da teledildonics, vejamos como fica na pr√°tica. No slide, voc√™ v√™ um modelo de vibrador chamado Lovense Hush, e mais tarde mostrarei uma demonstra√ß√£o com essa coisa no ar. Este √© o primeiro modelo de dildo-teledildonics do mundo, um plugue anal que pode ser controlado a partir do seu telefone ou computador. Existem aplicativos para IoS e Android para esse problema, voc√™ pode control√°-lo em um computador executando o Mac OS e o Windows. Os aplicativos m√≥veis oferecem suporte a recursos sociais, como bate-papo, compartilhamento de texto, fotos, v√≠deos e controle de brinquedos com amigos ou estranhos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/ry/zq/b-ryzqagf71doiiyxeoj_hzvzm8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No Windows, voc√™ precisa usar uma chave USB especial, que mostrarei mais adiante, porque agora este plug-in de inicializa√ß√£o est√° conectado ao meu computador. A chave do flash drive eletr√¥nico foi desenvolvida pela mesma empresa, ‚ÄúLovens‚Äù, fabricante de um plug-in de inicializa√ß√£o que criou seu pr√≥prio ecossistema de vibradores ‚Äúinteligentes‚Äù e gasta cerca de US $ 5 em comiss√£o por uma sess√£o na Internet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bv/lg/dl/bvlgdlcsp4qckbaej8gps_szkua.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O slide a seguir mostra minha vis√£o de um ataque a um plug-in de inicializa√ß√£o usando um aplicativo para PC. H√° uma conex√£o BLE (BlueTooth Low Energy) entre o plug de inicializa√ß√£o e a chave USB, a chave est√° conectada ao computador do usu√°rio, que por sua vez est√° conectado √† Internet. O cen√°rio n¬∫ 1 √© usado por um invasor na se√ß√£o de chave USB do plug-in de inicializa√ß√£o, ou seja, a conex√£o BLE √© atacada. De fato, n√£o h√° prote√ß√£o, para que qualquer estranho possa assumir o controle deste brinquedo. No ano passado, houve uma discuss√£o s√©ria sobre uma ferramenta chamada BTLE Jack, que permite atacar com √™xito essa conex√£o.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l_/ma/24/l_ma24foabt77cti9__dmq7ufam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cen√°rio n¬∫ 2 consiste em atacar uma se√ß√£o da conex√£o com a Internet do computador de um usu√°rio. O terceiro cen√°rio √© uma tentativa de invadir qualquer um dos tr√™s sites: BLE, USB, Internet. √â prov√°vel que exista um projeto aberto Buttplug ... voc√™ pode rir, foi uma piada. Ent√£o, por onde come√ßamos nosso "verdadeiro teste de penetra√ß√£o"?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cj/ov/21/cjov21ngohs6fh0gqaccbp2mdn0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o encontrei c√≥digos ou bin√°rios para o vibrador e o dongle, mas existem arquivos de aplicativos bin√°rios para dispositivos m√≥veis e um computador dispon√≠vel para download na Internet. Eu instalei esses arquivos no meu computador e comecei a trabalhar neles. No pr√≥ximo slide, voc√™ ver√° a interface do aplicativo para gerenciar o plug-in de inicializa√ß√£o. No centro da tela, h√° um controle deslizante para ajustar a vibra√ß√£o do brinquedo e, √† esquerda, o painel de controle com bot√µes - acesso √† conta, modo de controle na rede local, modo de controle remoto via Internet. Para entender a estrutura do aplicativo, voc√™ s√≥ precisa ler um pouco de c√≥digo JavaScript confuso.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/tc/l_/gytcl_o4cfm0iolamia3r6cfryo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o gosto de JavaScript, mas o que h√° de bom nisso √© a presen√ßa de v√°rios nomes de vari√°veis ‚Äã‚Äãe nomes de campos de objetos, e tudo isso √© de engenharia reversa perfeitamente. Basta soltar o c√≥digo no Beautifier e descobrir como ele funciona. Depois de fazer isso, voc√™ pode come√ßar a entender o funcionamento da chave eletr√¥nica.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fp/km/1s/fpkm1shgzrwislgaj09vm2ileg8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descobrindo que essa √© apenas uma porta serial para conex√£o via USB, comecei a cheirar o tr√°fego entre a chave e o aplicativo. Preste aten√ß√£o nas linhas √† direita do slide - antes de tudo, notei que as mensagens entre o dongle e o aplicativo estavam no formato de texto JSON. Para c√≥digo JavaScript, isso √© familiar, mas para uma chave USB, que √© um microcontrolador de 32 bits, a incorpora√ß√£o do analisador JSON parece estranha ... Para n√≥s, √© muito conveniente, porque os analisadores JSON geralmente cont√™m bugs de firmware que podem ser usados.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/5r/rk/hj5rrk2imjq5byefebbencwwmsg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, encontrar bugs sem o c√≥digo da chave em si √© uma tarefa tediosa, mas como eu tinha o c√≥digo do aplicativo, comecei a procurar um mecanismo para atualizar o firmware da chave USB e logo encontrei o que queria - a URL do n√≥ de atualiza√ß√£o. Aconteceu que o firmware n√£o estava criptografado ou assinado de forma alguma, ent√£o eu apenas o baixei e peguei um bin√°rio para an√°lise. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/q7/vs/xcq7vsjbakxsctt8th2gd_fwhni.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o eu comecei a engenharia reversa e chamei a aten√ß√£o para duas coisas. Em primeiro lugar, existem 2 manipuladores de comando para a porta USB serial. O primeiro usa comandos simples, como redefinir ou tipo de dispositivo, o segundo usa comandos como DFU para atualizar o firmware do dispositivo, para que possamos enviar esses comandos e atualizar o firmware.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/ol/b-/oyolb-kfxvjs8uq4ccxmvyrowdw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tendo examinado o analisador JSON, que √© de maior interesse para n√≥s, descobri o bug esperado - a fun√ß√£o parseJsonString. Ele s√≥ precisa alocar uma c√≥pia da string original em um novo buffer e tamb√©m trabalhar com coisas como sequ√™ncias de escape. Ao calcular o comprimento do novo buffer, ele n√£o corresponde ao comprimento real usado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/n7/vw/pon7vwgs51_0b0xicll5adjy0km.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta fun√ß√£o funciona assim: suporta uma sequ√™ncia de escape de 5 par√¢metros U em vez de, como esperado, igualando-os a 0. Gra√ßas a isso, podemos evitar uma string terminada em nulo e tornar incorreto o comprimento da primeira string calculada.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/am/4y/lgam4y0v4ijpkvue8j2snjfr7xm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta pequena anima√ß√£o mostra o que est√° acontecendo aqui. A barra invertida antes de U significa que 6 caracteres devem ser descartados. Em seguida, a fun√ß√£o salta pelo terminador nulo, o que √© um problema. Em seguida, o processo continua, todos os caracteres s√£o copiados e caem no buffer com um comprimento de apenas 6 bytes. Aqui o segundo problema aparece - o risco de estouros de buffer. Isso √© √≥timo, mas ainda n√£o sabemos como o hardware do dongle funciona. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/ea/hl/wjeahlydyx11z5kl0e_entwcoiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos certeza de que ele n√£o possui randomiza√ß√£o do espa√ßo de endere√ßo ASLR, nenhuma pilha de cookies, mas √© poss√≠vel que a chave tenha prote√ß√£o, como preven√ß√£o de execu√ß√£o de dados DEP ou prote√ß√£o XN, que impede a execu√ß√£o de c√≥digo na mem√≥ria, exceto na regi√£o .text.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A chave √© equipada com um chip SoC NRF51822 com um processador Cortex M0, sem prote√ß√£o DEP, muito popular para dispositivos BLE e equipada com v√°rios contatos de depura√ß√£o. Portanto, √© bastante simples conectar-se a essa chave soldando algumas coisas e fazer depura√ß√£o na interface para depurar e piscar chips SWD, se n√£o estiver desativado nas configura√ß√µes de f√°brica. Ao conectar via SWD, podemos liberar o conte√∫do da pilha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que ele √© usado apenas para o analisador JSON, o que n√£o √© muito interessante, mas o heap cont√©m metadados. Ent√£o, o que pode ser estragado aqui? Claro, metadados da pilha! Dessa forma, criamos uma explora√ß√£o para o analisador JSON.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qw/9o/zh/qw9ozhk_k6ixcm_iupcoyvun3xa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma pilha √© apenas uma lista gr√°tis. Se voc√™ olhar para este c√≥digo, poder√° ver que cada distribui√ß√£o tem seu pr√≥prio comprimento e ponteiro. Se voc√™ usar o estouro de buffer, poder√° arruinar o comprimento e a posi√ß√£o do pr√≥ximo ponteiro, o que permite controlar o local da pr√≥xima distribui√ß√£o. Ao copiar uma nova linha para ele, voc√™ pode organizar facilmente dados arbitr√°rios em um local arbitr√°rio. Tudo isso pode ser feito enquanto o depurador estiver conectado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tb/hk/y7/tbhky7ub8kj5cbgpjhmrl-frong.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No lado direito do slide, voc√™ v√™ uma pilha que √© redefinida e completamente substitu√≠da com apenas 8 caracteres. Isso nos d√° a execu√ß√£o do c√≥digo da chave USB, o que √© bem legal.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembrei-me de que, infelizmente, este dongle possui um modo de atualiza√ß√£o de firmware DFU de emerg√™ncia. Eu esperava que, por analogia com os consoles de jogos de hackers, esse modo sirva para autenticar a atualiza√ß√£o de qualquer maneira poss√≠vel. Acontece que aqui o DFU usa o c√°lculo cl√°ssico de soma de verifica√ß√£o CRC16, que, se voc√™ entender criptografia, n√£o √© autentica√ß√£o de nenhum tipo. Eu n√£o acho que eles realmente quisessem usar autentica√ß√£o nesse caso, provavelmente eles apenas decidiram que poucas pessoas estariam interessadas em executar o c√≥digo da chave USB para o plug de inicializa√ß√£o. No entanto, isso me interessou.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/lg/py/iflgpyq2h1z6kusfwcpqf-x0vxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No momento, eu tinha duas maneiras diferentes de executar c√≥digo neste dispositivo, mas a confus√£o com o analisador JSON, no qual passei muito tempo, acabou n√£o sendo particularmente eficaz devido √† presen√ßa do modo DFU. Mais tarde, consideraremos esse m√©todo juntamente com a vulnerabilidade do analisador existente. At√© agora, fiquei mais interessado em saber se √© poss√≠vel simplesmente modificar o arquivo main.bin, recalcular seu CRC16 e incorpor√°-lo usando o programa inclu√≠do no aplicativo Remoto Lovense. Descobriu-se que √© poss√≠vel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, obtivemos uma chave USB que foi comprometida pelo uso de um aplicativo para PC e foi definitivamente a parte mais f√°cil de quebrar. Tendo adquirido o controle da chave, comecei a procurar uma maneira de executar o c√≥digo no pr√≥prio plug-in.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vi/k2/vm/vik2vmib-ohaqm0hlaaldyaqmgc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, virei para o "hardware" do nosso brinquedo sexual - provavelmente tamb√©m tinha um depurador e valia a pena dar uma olhada. Tendo examinado o plug de inicializa√ß√£o, encontrei um chip mais s√©rio, com uma grande quantidade de mem√≥ria flash e RAM e um processador Cortex M4 mais poderoso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu facilmente descobri o que estava faltando e o que estava a bordo do bootplag. N√£o h√° DEP, como em um dongle, na parte superior h√° fios que levam √† bateria, a seguir est√° a porta de carregamento, contatos do motor vibrador, v√°rias almofadas de contato para depura√ß√£o e uma antena Bluetooth. Assim, gra√ßas √† presen√ßa de SWD, o dispositivo pode ser facilmente reflu√≠do.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r8/ln/rd/r8lnrdx8uis5lkt3f-gtdkpssr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ v√™ o que aconteceu - eu n√£o tenho acionista, mas na bolsa sempre haver√° um monte de buchas para experi√™ncias. Ent√£o eu comecei a engenharia reversa e depurando o bootplag, redefinindo o firmware original. N√£o havia analisadores JSON, apenas comandos simples, mas em grandes n√∫meros.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu pensei que, se o modo de atualiza√ß√£o de firmware do dongle fosse t√£o inseguro, √© poss√≠vel que haja vulnerabilidades. Acabou do jeito que est√°. Como resultado da pesquisa do DFU, encontrei duas coisas: o manipulador de comandos DFU comum e a linha DfuTarg no setor de inicializa√ß√£o. Esse DfuTarg √© usado da mesma maneira que o identificador do plug-in de inicializa√ß√£o do LVS-Z00, ou seja, √© semelhante ao gerenciador de inicializa√ß√£o do DFU para BLE. Portanto, no modo DFU, o registro de inicializa√ß√£o √© reconhecido como um dispositivo com o nome DfuTarg, e esse identificador exclusivo pode ser usado para procurar o dispositivo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se voc√™ enviar exatamente a ele o mesmo comando DFU que enviamos para a chave, o bootplag entrar√° no modo de atualiza√ß√£o de firmware do dispositivo. Para piscar, voc√™ pode usar as ferramentas propriet√°rias do fabricante do microcircuito Nordic Semiconductor - nRF Toolbox.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/iy/pr/xbiyprlhoukirnf_su9htx71rqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando um sniffer de hardware, voc√™ pode visualizar pacotes BLE no Wireshark. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xc/ea/9o/xcea9of9tdquhsfcjnjglzcsj78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enviei uma mensagem curta ‚Äúol√° do plug‚Äù, e isso significa que voc√™ pode executar o c√≥digo no batplag sem hackers, e isso n√£o √© uma vulnerabilidade, mas simplesmente um tipo de design de desenvolvedor que permite atualizar o dispositivo. Talvez a comunidade de c√≥digo aberto queira essa solu√ß√£o. A conclus√£o √© que qualquer pessoa que possa se conectar ao seu plug-in de inicializa√ß√£o poder√° executar seu pr√≥prio c√≥digo nele, e isso j√° √© uma coisa bastante perigosa. Nesse caso, o hacker deve estar na √°rea da conex√£o local, ou seja, estar pr√≥ximo o suficiente do brinquedo sexual para obter controle sobre ele atrav√©s de um dongle comprometido e um canal BLE. Ao mesmo tempo, voc√™ pode usar o dongle em si ou qualquer outro dispositivo BLE.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d_/uo/uy/d_uouyokp1p8mdsyx2x0yehkl14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A quest√£o √©: o que realmente pode ser feito com o plug-in de inicializa√ß√£o, tendo a oportunidade de executar seu pr√≥prio c√≥digo nele? Eu tenho algumas ideias. O primeiro - assumindo o controle dessa coisa, voc√™ pode criar um r√≥tulo de inicializa√ß√£o de ransomware. Voc√™ pode modificar o firmware para que o usu√°rio n√£o possa ativar o modo DFU at√© que voc√™ forne√ßa uma determinada chave ou simplesmente desligue a fun√ß√£o de vibra√ß√£o e pe√ßa 50 d√≥lares para desbloquear este dispositivo √∫til.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cl/jb/ob/cljbobzlggrarkc30am8im-fe14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para muitos, isso servir√° como um tipo de vacina do uso desses brinquedos. A segunda id√©ia √© transformar o bootplag em uma arma. Possui uma bateria bastante potente que alimenta o motor vibrador, podemos dizer que 80% do conte√∫do do plug de inicializa√ß√£o √© uma bateria. Voc√™ provavelmente se lembra do que aconteceu com os smartphones Samsung Galaxy Note - eles simplesmente explodiram (risos), por isso √© prov√°vel que isso possa acontecer com as buchas. N√£o sei qual √© a probabilidade da explos√£o, mas se voc√™ tem muitos brinquedos sexuais com motor, deve pensar nisso. A equipe de desenvolvimento afirma que essas coisas s√£o absolutamente seguras, apesar da presen√ßa de muitas partes m√≥veis. Mas, se esse for o caso, o recurso de seguran√ßa do dispositivo ser√° codificado em software, n√£o em hardware.Nesse caso, a execu√ß√£o de c√≥digo malicioso pode ter consequ√™ncias desastrosas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Brinquedos sexuais equipados com uma bomba de ar tamb√©m s√£o perigosos. Eles tamb√©m t√™m um motor bastante potente com uma bateria, portanto, voc√™ tamb√©m deve prestar aten√ß√£o neles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, a √∫ltima id√©ia √© um plug-in de batalha hostil. Hostil, n√£o no sentido de que √© capaz de explodir sua bunda, mas no fato de que pode servir como um meio de invadir o resto de seus dispositivos. Portanto, consideraremos o plug-in de batalha do ponto de vista de sua hostilidade, garantida pela execu√ß√£o de c√≥digo malicioso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar descobrir se √© poss√≠vel obter a execu√ß√£o de c√≥digo no aplicativo para o plug-in de inicializa√ß√£o, considerando como ele processa as mensagens recebidas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/ov/1v/g_ov1vzowj7o8hifa6xhfoo5gmq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä esquerda, voc√™ v√™ um retorno de chamada em JavaScript e √† direita, como ele interage com o aplicativo atrav√©s da porta serial. O retorno de chamada √© colocado em uma sequ√™ncia e processado por v√°rias fun√ß√µes diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira fun√ß√£o √© encontrar a chave, ela processa as mensagens de inicializa√ß√£o provenientes da chave. A segunda fun√ß√£o est√° ativada ("Dados"), uma fun√ß√£o de processamento que aceita um pacote JSON de entrada, cujo comprimento, a prop√≥sito, n√£o pode exceder 32 caracteres. Em seguida, a an√°lise e tudo o mais √© feito. De fato, n√£o h√° processamento s√©rio aqui - apenas uma solicita√ß√£o √© feita para o status do dispositivo, verificando a carga da bateria e outras despesas gerais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A √∫ltima fun√ß√£o √© muito mais interessante - eu chamo de log de depura√ß√£o, embora na verdade n√£o tenha nome no c√≥digo real. Esta fun√ß√£o registra tudo o que entra no dispositivo atrav√©s da porta serial e redefine essas linhas para o console, que, se necess√°rio, exibe uma mensagem de erro. Al√©m disso, essa fun√ß√£o cria um novo elemento DOM como um elemento HTML e lan√ßa todo o conte√∫do recebido pela porta serial nesse HTML. N√£o sou desenvolvedor web, mas acho que essa √© uma vulnerabilidade s√©ria ao XSS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se voc√™ tiver controle sobre o dongle, poder√° enviar qualquer coisa pela porta serial, for√ßando o aplicativo a interpretar isso como HTML. </font><font style="vertical-align: inherit;">Esse √© o problema, porque o HTML tem a capacidade de criar um novo c√≥digo JavaScript em um aplicativo instalado no seu computador, ou seja, pode compromet√™-lo. </font><font style="vertical-align: inherit;">A quest√£o √©: qual malware pode ser inventado, sabendo que apenas 32 caracteres s√£o permitidos por vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22:00 min </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Confer√™ncia DEFCON 27. Buttplug: teste de penetra√ß√£o genu√≠no. </font><font style="vertical-align: inherit;">Parte 2</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Voc√™ gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anal√≥gico exclusivo de servidores </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b√°sicos </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">que foi inventado por n√≥s para voc√™: </font></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps de 10GB de US $ 19 ou como dividir o servidor?</font></a><font style="vertical-align: inherit;"> (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente n√≥s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como construir infraestrutura </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt495366/index.html">16 tipos de programadores ou desenvolvedores n√£o s√£o os mesmos rob√¥s</a></li>
<li><a href="../pt495368/index.html">N√≥s nos auto-registramos em auto-c√£es que andam em condi√ß√µes de auto-isolamento</a></li>
<li><a href="../pt495370/index.html">P√∫blico √© mau</a></li>
<li><a href="../pt495374/index.html">Plafon decorativo General Lumino 02</a></li>
<li><a href="../pt495376/index.html">T√©dio da quarentena. Como gastar mais dinheiro no Azure com um clique</a></li>
<li><a href="../pt495380/index.html">Grande firewall eg√≠pcio</a></li>
<li><a href="../pt495384/index.html">Minha experi√™ncia de est√°gio na Microsoft Redmond e recebendo uma oferta</a></li>
<li><a href="../pt495388/index.html">Programa de televis√£o da d√©cada de 1970 que se tornou um ancestral dos eSports</a></li>
<li><a href="../pt495390/index.html">STM32CubeMonitor vale a pena tentar</a></li>
<li><a href="../pt495392/index.html">Como procurar bugs no front end: 4 est√°gios principais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>