<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüíº üöπ üöô An√°lisis forense, inyecci√≥n SQL y gato sufrido: an√°lisis de la tarea n. ¬∞ 3 de la etapa en l√≠nea NeoQUEST-2020 üñ®Ô∏è üëè üë®üèº‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy consideraremos la tarea m√°s controvertida de NeoQUEST-2020 : su primera parte es un campe√≥n en el n√∫mero de participantes que la aprobaron, y la s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>An√°lisis forense, inyecci√≥n SQL y gato sufrido: an√°lisis de la tarea n. ¬∞ 3 de la etapa en l√≠nea NeoQUEST-2020</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neobit/blog/495296/"><img src="https://habrastorage.org/webt/gd/oc/8f/gdoc8fvxf7oimhxlgxvmijvuwmk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy consideraremos la tarea m√°s controvertida de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeoQUEST-2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : su primera parte es un campe√≥n en el n√∫mero de participantes que la aprobaron, y la segunda parte obedeci√≥ solo a unos pocos. </font><font style="vertical-align: inherit;">¬øQu√© tiene √©l de especial? </font><font style="vertical-align: inherit;">¬°Entiende el corte!</font></font><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øAlguna vez has tenido que investigar un volcado de RAM? ¬øSabes cu√°ntas cosas interesantes puedes obtener de all√≠? (spoiler: todo, incluidos los resultados de la ejecuci√≥n de scripts, fotos recientes, as√≠ como el historial del navegador). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© pasa con las inyecciones SQL ex√≥ticas? Carga una determinada imagen en el sitio y recibe informaci√≥n de una base de datos cerrada. ¬øNo es un delito ideal? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la primera parte del art√≠culo, consideraremos las herramientas para analizar el volcado de memoria y aprenderemos c√≥mo extraer la informaci√≥n que necesitamos de all√≠, y en la segunda parte del art√≠culo mostraremos claramente el proceso de manipulaci√≥n de etiquetas de imagen para una inyecci√≥n complicada :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, la tarea es descargar el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que contiene un archivo binario de 1 GB con el nombre hablado memdump.bin, seg√∫n el cual podemos suponer que se trata de un volcado de RAM. Utilizaremos el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marco de volatilidad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para su investigaci√≥n </font><font style="vertical-align: inherit;">. Volatility admite varios complementos que facilitan la b√∫squeda y extracci√≥n del volcado de informaci√≥n √∫til para </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chantajear a un</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analista. Primero, use el comando imageinfo y obtenga informaci√≥n sobre el volcado:</font></font><br>
<cut></cut><br>
<img src="https://habrastorage.org/webt/8b/po/2n/8bpo2nbfia9ykmdpqohz8zt4w0a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A juzgar por el resultado del comando imageinfo, estamos lidiando con un volcado de memoria de Windows 7. A continuaci√≥n, veremos la lista de procesos en ejecuci√≥n en el sistema en el momento en que se elimin√≥ el volcado utilizando el comando pslist: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ja/1n/py/ja1npywtltvjjnzwwhbs7mkk1ho.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en esta lista, puede ver varios procesos interesantes. Comencemos el estudio con el proceso chrome.exe: siempre puede encontrar algo intrigante en el navegador. Existen complementos adicionales para la volatilidad que automatizan la extracci√≥n de informaci√≥n de los procesos. Por ejemplo, el complemento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chromehistory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos permitir√° extraer un historial de visitas del navegador de un volcado de RAM: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lx/oo/o7/lxooo7skzcqwcxf-hw_njv5rmdk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en el historial de Chrome, se pueden notar varias cosas interesantes a la vez. Primero, un enlace </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a la segunda parte de la tarea</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as√≠ como consultas de b√∫squeda sobre metadatos en im√°genes PNG, que tambi√©n es una pista para la segunda parte, pero veremos esto m√°s adelante. En la etapa actual, nos interesan las solicitudes de un c√≥digo promocional </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para un descuento</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el sitio y los archivos pdf, lo que sugiere el objeto de nuevas b√∫squedas (la ejecuci√≥n de Acrobat Reader`a tambi√©n puede solicitarnos esto). Intentemos encontrar documentos pdf en un basurero usando el comando filescan: ¬° </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sb/ro/qk/sbroqkdf1jetkddyzac1rhasqh0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buena suerte! Parece que hay algo de promo.pdf en el basurero. Intentemos extraerlo usando el comando dumpfiles:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-w/gn/iz/-wgnizdzvl_kszkhof-z1bldwxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, pueden surgir dificultades menores debido al hecho de que algunos visores de documentos pdf pueden no reconocer el archivo reci√©n extra√≠do (solo necesita eliminar los bytes adicionales al final del archivo). Pero, ¬ørealmente tenemos miedo de algunos bytes adicionales? :) Al final, abra el documento y vea el c√≥digo QR, despu√©s de leerlo, obtenemos la bandera de la primera parte de la tarea (y al mismo tiempo el c√≥digo promocional para recibir un regalo del equipo NeoQUEST - entregamos premios memorables todos los participantes que completaron al menos una tarea).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/84/od/xp84odjm5frx774wqy9ka75rjws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, intente obtener la segunda bandera. Regresamos al sitio, cuyo enlace se encontr√≥ en el historial del navegador. Para acceder al sitio debe ingresar un c√≥digo promocional. Recordamos el historial de b√∫squeda en el navegador y la descripci√≥n del documento en s√≠ (USAR ESTO PARA UNIRSE), a partir del cual podemos suponer que la primera marca es el c√≥digo promocional que necesitamos. Lo ingresamos al campo y llegamos al sitio donde se nos ofrece cargar una imagen: a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n9/kb/vu/n9kbvuleozzylxcgoa2hxy5trhq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
juzgar por la frecuencia con la que el sitio se congela, nuestros participantes decidieron verificar experimentalmente la carga de todos los tipos posibles de documentos. Una cierta cantidad de tiempo despu√©s entendemos que solo las im√°genes PNG se pueden cargar en el sitio. El siguiente acertijo es el mensaje "¬°No hay suficientes datos para almacenar esta imagen, lo siento!", Que se produce cuando intenta cargar una imagen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Volviendo al historial del navegador, recordamos las solicitudes del formulario "agregar metadatos al archivo png". Utilizando inferencias simples, llegamos a la conclusi√≥n de que, muy probablemente, se deben ingresar ciertos valores en los metadatos para cargar una imagen en un sitio. Puede comenzar explorando el formato PNG (para obtener una descripci√≥n, por ejemplo, haga clic </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Primero, verifique la lista de palabras clave est√°ndar para im√°genes PNG de metadatos, por ejemplo: "Autor", "Descripci√≥n", etc. Usando, por ejemplo, la utilidad de conversi√≥n del conjunto ImageMagick, agregue metadatos a la imagen de prueba: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
convert test.png -set 'T√≠tulo' '1' -set 'Autor' '2' -set 'Descripci√≥n' '3' -set 'Copyright' '4 '-set' Tiempo de creaci√≥n '' 5 '-set' Software '' 6 '-set' Descargo de responsabilidad '' 7 '-set 'Advertencia' '8' -set 'Fuente' '9' -set 'Comentario' '0' out.png</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentamos subir la imagen resultante al sitio y disfrutar del √©xito: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/7o/pw/sa7opwndturwyzaqse9f4qah83g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que los campos de metadatos necesarios son T√≠tulo, Descripci√≥n, Autor y Copyright. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una pista para esto, por cierto, tambi√©n se puede encontrar en el volcado de memoria: puede encontrar la menci√≥n del archivo mr_cat.png usando volatilidad. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/bw/cn/ixbwcn3pzw3ndqxlbnfb6btadyk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestros participantes decidieron que era con la ayuda del Sr. Cat que era necesario inyectar el sitio (muchos mensajes llegaron a nuestro correo con el Sr. Cat en una </font><font style="vertical-align: inherit;">apariencia </font><font style="vertical-align: inherit;">comprimida, invertida, reflejada y de otra </font><font style="vertical-align: inherit;">apariencia </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desagradable</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ¬°pero el gato no tuvo nada que ver con eso! Simplemente distrae y sugiere a los participantes: bueno, m√≠renme, ¬°hay algo interesante dentro! Dentro del vertedero, la imagen solo se conservaba parcialmente; sin embargo, en sus restos puede observar los campos de metadatos necesarios rellenados:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/4h/0o/zv4h0ogsh94higmrsqslbzbxzby.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adelante: ahora podemos subir archivos al sitio; sin embargo, ¬øqu√© da y c√≥mo buscar una bandera? Es l√≥gico suponer que una vez que se requieren metadatos para la descarga, es posible que de alguna manera se utilicen para almacenar archivos descargados (por ejemplo, como claves en una base de datos). ¬°Hurra! Nos estamos acercando al postre: necesitamos revisar el sitio para ver la posibilidad de inyecci√≥n SQL. Descubrimos que si uno de los par√°metros se sustituye con una comilla doble ("), el sitio nos notificar√° un error en lugar de cargar la imagen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/s2/bf/f7s2bfigyph9mkfj9jfg6wfxhxc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora vemos la consulta SQL en s√≠ y entendemos qu√© campos podemos operar para construir una inyecci√≥n para extraer datos de la base de datos utilizada. En cuanto a la ubicaci√≥n de la bandera, en este caso es l√≥gico verificar la primera imagen que se ha cargado en la base de datos. Adem√°s, durante la operaci√≥n de inyecci√≥n, debe prestar atenci√≥n al hecho de que INSERT se ejecuta en la solicitud. Esto lo obliga a construir consultas espec√≠ficas, porque no puede realizar expl√≠citamente una operaci√≥n SELECT desde la misma tabla en la que est√° insertando al mismo tiempo que la operaci√≥n de inserci√≥n (INSERT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hagamos una solicitud con la que extraemos la Descripci√≥n de la primera imagen en la base de datos:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
convert test1.png -set 'T√≠tulo' '1' -set 'Autor' '", (SELECCIONE descripci√≥n DESDE (SELECCIONAR * DESDE imagen) COMO l√≠mite x 0,1)) - -' -set 'Descripci√≥n' '3' - configure 'Copyright' '4' test.png </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cargue la imagen resultante en el sitio web y obtenga la descripci√≥n en el campo Copyright, que es una bandera: ¬° </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vz/k8/6x/vzk86xyosytdwsvc9orcwkypybi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hurra, tarea completada! Esperamos haber convencido a todos de que verifiquen la entrada del usuario por millon√©sima vez, y tambi√©n la mantengan segura manzana de tu ojo al crear un volcado de tu RAM :) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Termina el art√≠culo con una cita de los grandes sabios:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qg/9i/un/qg9iunp8zncqovjy3_qg990lmlc.png"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495280/index.html">Max Patrol SIEM. Descripci√≥n general del sistema de gesti√≥n de eventos de seguridad de la informaci√≥n</a></li>
<li><a href="../es495282/index.html">Validaci√≥n de XML utilizando XSD, JAXB y Spring Framework</a></li>
<li><a href="../es495290/index.html">Explorando la calidad del c√≥digo del sistema operativo Zephyr</a></li>
<li><a href="../es495292/index.html">Lanzamiento de InterSystems IRIS 2020.1</a></li>
<li><a href="../es495294/index.html">Macros para un pitonista. Informe Yandex</a></li>
<li><a href="../es495298/index.html">Evaluar las opciones de Monte Carlo Clojure</a></li>
<li><a href="../es495302/index.html">C√≥mo aumentar las ventas 2.5 veces en 4 meses en una tienda en l√≠nea: un caso para la promoci√≥n SEO</a></li>
<li><a href="../es495304/index.html">Rejuvenecimiento de c√©lulas humanas debido a su reprogramaci√≥n</a></li>
<li><a href="../es495308/index.html">Rastrillo en el camino para mantenerse vivo</a></li>
<li><a href="../es495310/index.html">Recorrido electr√≥nico: biometr√≠a y multiformato</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>