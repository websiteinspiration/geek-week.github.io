<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👡 🛌🏻 🕟 PHP: array_key_exists recherche 500 fois plus vite que in_array 👝 🔖 👨‍❤️‍👨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2014, ils avaient déjà écrit sur la recherche du réseau , mais presque personne ne comprenait.
 
 Depuis lors, de nombreuses versions de PHP ont ét...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PHP: array_key_exists recherche 500 fois plus vite que in_array</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490664/"><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En 2014, ils avaient déjà écrit sur la recherche du réseau</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais presque personne ne comprenait.</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depuis lors, de nombreuses versions de PHP ont été publiées et n'ont pas été corrigées, ce qui signifie que les commentaires sont mauvais et que peu de gens le savent. Sur python c'est pareil, et en 3 * pire qu'en 2.7.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parfois, vous devez trouver une chaîne dans un tableau de chaînes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - une opération très fréquente dans différents algorithmes et si le tableau est petit et semble un peu et pas en boucle, alors in_array est normal, cela n'affecte pas la vitesse globale, mais si vous avez besoin de données volumineuses et recherchez un tableau d'un milliard de lignes et d'un milliard de fois , alors c'est critique: une meilleure heure au lieu de la semaine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un test simple montre:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in_array recherche</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone.com/Yb1mDa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6600ms</font><font style="vertical-align: inherit;">en 6-9 secondes</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et array_key_exists cherche la même chose, mais plus vite que 250 (php5.6 / py3. *) 400+ fois (php7.3 / py2.7)</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone .com / gwSmFc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(cycle augmenté 100 fois) 12 ms (6600/12 = 550 fois + -10% de propagation en raison de la charge et du cache) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi cela se produit-il? </font><font style="vertical-align: inherit;">Considérez en détail:</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) La recherche de chaînes dans un assembleur / s pur consiste à trier un tableau de chaînes (rapide ou à bulles), puis à effectuer une recherche binaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nombre d'étapes dans un journal de recherche binaire (n) fois dépend de la taille du tableau et est beaucoup plus petit qu'une recherche simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez trier un tableau de chaînes à l'avance, une fois, et mettre en cache, puis effectuer un milliard de recherches. </font><font style="vertical-align: inherit;">Mais cela n'aide pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par défaut, le tri se produit à chaque fois, bien qu'ils aient écrit qu'ils s'étaient améliorés dans 7.2 in_array grâce à un hachage, mais pas beaucoup.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Rechercher l'index / la clé (sous forme de chaîne) dans l'association. tableau / dictionnaire se produit par le hachage des chaînes et le traitement des collisions (erreurs de recherche de hachage). Un hachage est l'index numérique du tableau et le récupère en tant que (adresse de l'élément zéro) + offset * la taille du pointeur vers le tableau de chaînes avec ce hachage) en 2 étapes. + collisions par force brute, pas en moyenne inférieur à la recherche binaire. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le hachage d'index est effectué automatiquement une fois à l'avance lors de la création de l'élément de dictionnaire $ m [key] = val et est mis en cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La taille du hachage, l'algorithme de hachage est cousu dans le moteur php et il ne peut pas être changé, bien que le code source soit ouvert, vous pouvez télécharger pour changer et compiler si votre serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous ne pouvez pas lire plus loin, changez in_array en array_combine + array_key_exists et c'est tout.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nombre d'étapes lors de la recherche par hachage dépend du nombre de collisions et du nombre de lignes avec le même hachage. Ils doivent être triés ou également triés et recherche binaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour réduire les collisions, vous pouvez allouer plus de mémoire, s'il est possible que ce ne soit plus le cas il y a 50 ans quand 1 ko de mémoire sur des bobines magnétiques coûtait comme un avion. Et c'est alors que tous les algorithmes de base ont été inventés: tri / zip / gif / jpg / etc. - ils n'ont pas besoin de beaucoup de mémoire, mais ils sont mauvais, maintenant ils sont bien meilleurs, mais ils ont besoin de beaucoup de mémoire 1-16 Mo. Oui, il y a des serveurs avec 256 Mo et chacun a un flux séparé et 16 Mo c'est déjà beaucoup, mais sur l'appareil de l'utilisateur moyen 1 Go au moins et 16 Mo est une goutte dans le seau.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez obtenir encore plus d'effet si vous remplacez l'appel à array_key_exists par la construction isset ($ m [key]), il n'efface pas la file d'attente de commandes et le cache, il n'utilise pas la pile et est plus rapide d'environ 20%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez également l'accélérer si vous créez un tableau des 2 premières lettres - 4 * 16 Ko et regardez d'abord l'offset (index = code du 1er caractère + 2e * 256) un pointeur vers le tableau de hachage pour le reste de la ligne, puis recherchez un petit tableau de «queues» de chaînes et les collisions sont beaucoup plus petites. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il nécessite encore plus de mémoire et l'algorithme est plus compliqué, mais la recherche est 30 fois plus rapide. Mais ceci n'est pas implémenté en php, vous pouvez écrire votre bibliothèque so / dll et l'appeler, ou demander aux développeurs de l'ajouter en 7.5. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez rechercher dans mySQL, mais vous devez regrouper les requêtes et ce sera toujours plus lent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS: Cette méthode a été accidentellement trouvée en tapant, en intuition et en expérience lorsque j'ai accéléré un grand site lent, il y a beaucoup de telles subtilités et astuces, j'ai réussi à télécharger des données vers Excel de 40 secondes à 0,8 secondes, afficher des listes avec tri et filtres, et bien d'autres des choses où les techniques standard, les frameworks et les frameworks le font trop lentement, bien qu'ils soient bien sûr pratiques et accélèrent le développement.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490650/index.html">Les principales erreurs dans la compilation d'un CV par des informaticiens débutants</a></li>
<li><a href="../fr490652/index.html">Logistique. introduction À peu près compliqué</a></li>
<li><a href="../fr490654/index.html">Pointillé sur les capteurs de gaz de la série MQ - compréhension approfondie de la fiche technique et du réglage</a></li>
<li><a href="../fr490656/index.html">Tâches externes Camunda - un outil puissant pour créer des applications avec une architecture résiliente et évolutive</a></li>
<li><a href="../fr490660/index.html">Comment avons-nous assuré la croissance de CityMobile</a></li>
<li><a href="../fr490668/index.html">L'histoire de la transformation du produit au projet et vice versa (en utilisant l'exemple de la bonté dans la région de Moscou)</a></li>
<li><a href="../fr490670/index.html">Comment faire en sorte qu'une voiture écrive des tests à partir du code pour vous</a></li>
<li><a href="../fr490674/index.html">Habr Wickley # 41 / Plus de voitures autonomes, prof. Fortran, Yandex, la douleur du robot, comment bloquer le site d'un concurrent</a></li>
<li><a href="../fr490676/index.html">Tests unitaires, sciences et mathématiques</a></li>
<li><a href="../fr490678/index.html">Utilisation de RabbitMQ avec MonsterMQ Partie 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>