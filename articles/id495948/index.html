<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌉 🚡 🌝 Tertanam Karat. Pengembangan untuk prosesor Cortex-M3 menggunakan papan debug STM32F103C8T6 (Black Pill) 📻 🤹🏼 👺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo! Saya ingin memperkenalkan Anda dengan proyek Embedded Rust . Hal ini memungkinkan kita untuk menggunakan bahasa pemrograman Rust untuk pengemban...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tertanam Karat. Pengembangan untuk prosesor Cortex-M3 menggunakan papan debug STM32F103C8T6 (Black Pill)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495948/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo! </font><font style="vertical-align: inherit;">Saya ingin memperkenalkan Anda dengan proyek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embedded Rust</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hal ini memungkinkan kita untuk menggunakan bahasa pemrograman Rust untuk pengembangan untuk platform tertanam (Embedded Linux / RTOS / Bare Metal). </font></font><br>
<img src="https://habrastorage.org/webt/sh/5h/se/sh5hsergasrx_filqfoqh-yrbyu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, kami akan mempertimbangkan komponen yang diperlukan untuk memulai pengembangan untuk mikroprosesor Cortex-M3. </font><font style="vertical-align: inherit;">Setelah itu kita akan menulis contoh sederhana - berkedip LED built-in.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, kita memerlukan papan debug Cina STM32F103C8T6 atau Black Pill yang terjangkau dan murah (karena warna hitam dan ukuran kecil). </font><font style="vertical-align: inherit;">Ada juga versi papan berwarna biru - Pil Biru. </font><font style="vertical-align: inherit;">Saya tidak merekomendasikannya, karena saya dengar ada resistor yang salah, yang menyebabkan masalah saat menggunakan port USB. </font><font style="vertical-align: inherit;">Perbedaan kedua dari Pill Hitam dalam pengaturan pin (kesimpulan). </font><font style="vertical-align: inherit;">Tetapi lebih lanjut tentang itu nanti. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami juga akan membutuhkan programmer untuk papan debug STM32. </font><font style="vertical-align: inherit;">Pada artikel ini, kita akan menggunakan programmer ST-Link V2 Cina yang murah dan terjangkau.</font></font><br>
<img src="https://habrastorage.org/webt/cb/rg/eu/cbrgeuyxins21rilbd3ayspihrg.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versi Kompiler Karat</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memulai, Anda perlu memastikan versi kompiler Anda adalah 1,31 atau lebih baru. </font><font style="vertical-align: inherit;">Anda dapat memeriksa versi kompiler Anda dengan memasukkan perintah:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; rustc --version</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemasangan Komponen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita dapat mulai menginstal komponen yang diperlukan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU Arm Embedded Toolchain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan membutuhkan debugger untuk chip ARM - arm-none-eabi-gdb. </font><font style="vertical-align: inherit;">Luncurkan penginstal dan ikuti instruksi. </font><font style="vertical-align: inherit;">Di akhir instalasi, pastikan untuk memeriksa opsi " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambahkan path ke variabel lingkungan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan unduhan</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Setelah instalasi, Anda dapat memeriksa apakah semuanya beres dengan memasukkan yang berikut di baris perintah:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; arm-none-eabi-gdb -v</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika semuanya beres, maka Anda akan melihat versi komponen yang diinstal.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST-Link Driver</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari beralih ke menginstal driver untuk programmer ST-Link. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ikuti instruksi penginstal dan pastikan Anda menginstal versi driver yang benar ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enam puluh empat bit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiga puluh dua bit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), tergantung pada kedalaman bit sistem operasi Anda. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan untuk mengunduh</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST-Link Tools</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah selanjutnya adalah menginstal alat yang diperlukan untuk firmware - ST-Link Tools. </font><font style="vertical-align: inherit;">Unduh arsip dan unzip ke tempat yang nyaman, Anda juga perlu menentukan path ke subfolder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stlink-1.3.0 \ bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) dalam variabel lingkungan " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PATH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan untuk mengunduh</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">binutils kargo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, instal paket kargo-binutils, ini dilakukan oleh dua perintah di konsol.</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo install cargo-binutils<font></font>
&gt; rustup component add llvm-tools-preview</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini menyelesaikan pemasangan komponen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat dan mengatur proyek</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melanjutkan, kita perlu membuat proyek baru dengan nama " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stm32f103c8t6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Biarkan saya mengingatkan Anda, ini dilakukan oleh perintah:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo new stm32f103c8t6</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketergantungan dan Optimasi Proyek</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubungkan perpustakaan yang diperlukan di file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargo.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="json hljs">[package]<font></font>
name = <span class="hljs-string">"stm32f103c8t6"</span>
version = <span class="hljs-string">"0.1.0"</span>
authors = [<span class="hljs-string">"Nick"</span>]<font></font>
edition = <span class="hljs-string">"2018"</span><font></font>
<font></font>
#      Cortex-M3<font></font>
[dependencies]<font></font>
cortex-m = <span class="hljs-string">"*"</span>
cortex-m-rt = <span class="hljs-string">"*"</span>
cortex-m-semihosting = <span class="hljs-string">"*"</span>
panic-halt = <span class="hljs-string">"*"</span>
nb = <span class="hljs-string">"0.1.2"</span>
embedded-hal = <span class="hljs-string">"0.2.3"</span><font></font>
<font></font>
#       stm32f1<font></font>
[dependencies.stm32f1xx-hal]<font></font>
version = <span class="hljs-string">"0.5.2"</span>
features = [<span class="hljs-string">"stm32f100"</span>, <span class="hljs-string">"rt"</span>]<font></font>
<font></font>
#   `cargo fix`!<font></font>
[[bin]]<font></font>
name = <span class="hljs-string">"stm32f103c8t6"</span>
test = <span class="hljs-literal">false</span>
bench = <span class="hljs-literal">false</span><font></font>
<font></font>
#   <font></font>
[profile.release]<font></font>
codegen-units = <span class="hljs-number">1</span> #  <font></font>
debug = <span class="hljs-literal">true</span> #  ,     Flash <font></font>
lto = <span class="hljs-literal">true</span> #  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda juga dapat melihat bahwa, di akhir file, optimasi kode telah diaktifkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pustaka cortex-m-rt mengharuskan kita membuat file di direktori root proyek, itu harus disebut " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memory.x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Ini menunjukkan berapa banyak memori yang dimiliki perangkat kita dan alamatnya:</font></font><br>
<br>
<pre><code class="json hljs">MEMORY<font></font>
{<font></font>
 FLASH : ORIGIN = <span class="hljs-number">0x08000000</span>, LENGTH = 64K<font></font>
 RAM : ORIGIN = <span class="hljs-number">0x20000000</span>, LENGTH = 20K<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menetapkan platform target dan tujuan kompilasi default</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita perlu mengatur platform target untuk kompiler, ini dilakukan dengan perintah:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; rustup target add thumbv7m-none-eabi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, buat folder </font><font style="vertical-align: inherit;">" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.cargo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " di direktori root dan file " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">config</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">di dalamnya </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isi file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">konfigurasi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="json hljs">[target.thumbv7m-none-eabi]<font></font>
<font></font>
[target.'cfg(all(target_arch = <span class="hljs-string">"arm"</span>, target_os = <span class="hljs-string">"none"</span>))']<font></font>
<font></font>
rustflags = [<span class="hljs-string">"-C"</span>, <span class="hljs-string">"link-arg=-Tlink.x"</span>]<font></font>
<font></font>
[build]<font></font>
target = <span class="hljs-string">"thumbv7m-none-eabi"</span>  # Cortex-M3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di dalamnya, kami mengidentifikasi tujuan kompilasi default, ini memungkinkan kami untuk mengkompilasi kode kami ke </font><font style="vertical-align: inherit;">file </font><font style="vertical-align: inherit;">ARM </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan perintah sederhana dan akrab:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memastikan itu berfungsi, pertimbangkan contoh paling sederhana - mengedipkan LED. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isi file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.rs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="rust hljs"><span class="hljs-meta">#![deny(unsafe_code)]</span>
<span class="hljs-meta">#![no_std]</span>
<span class="hljs-meta">#![no_main]</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> panic_halt <span class="hljs-keyword">as</span> _;<font></font>
<font></font>
<span class="hljs-keyword">use</span> nb::block;<font></font>
<font></font>
<span class="hljs-keyword">use</span> stm32f1xx_hal::{<font></font>
    prelude::*,<font></font>
    pac,<font></font>
    timer::Timer,<font></font>
};<font></font>
<span class="hljs-keyword">use</span> cortex_m_rt::entry;
<span class="hljs-keyword">use</span> embedded_hal::digital::v2::OutputPin;<font></font>
<font></font>
<span class="hljs-comment">//   .</span>
<span class="hljs-meta">#[entry]</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; ! {<font></font>
    <font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">let</span> cp = cortex_m::Peripherals::take().unwrap();
    <span class="hljs-keyword">let</span> dp = pac::Peripherals::take().unwrap();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> flash = dp.FLASH.constrain();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> rcc = dp.RCC.constrain();<font></font>
<font></font>
    <span class="hljs-keyword">let</span> clocks = rcc.cfgr.freeze(&amp;<span class="hljs-keyword">mut</span> flash.acr);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> gpiob = dp.GPIOB.split(&amp;<span class="hljs-keyword">mut</span> rcc.apb2);<font></font>
<font></font>
    <span class="hljs-comment">//   b12   .</span>
    <span class="hljs-comment">//  "crh"      .</span>
    <span class="hljs-comment">//   0-7,    "crl".</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> led = gpiob.pb12.into_push_pull_output(&amp;<span class="hljs-keyword">mut</span> gpiob.crh);
    <span class="hljs-comment">//        .</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> timer = Timer::syst(cp.SYST, &amp;clocks)<font></font>
    .start_count_down(<span class="hljs-number">1</span>.hz());<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-comment">//    .</span>
    <span class="hljs-keyword">loop</span> {<font></font>
        block!(timer.wait()).unwrap();<font></font>
        led.set_high().unwrap();<font></font>
        block!(timer.wait()).unwrap();<font></font>
        led.set_low().unwrap();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di baris pertama, menggunakan atribut - </font></font><code>#![deny(unsafe_code)]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, kami menghapus kemungkinan menggunakan kode yang tidak aman. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di baris kedua, kita menempatkan atribut </font></font><code>#![no_std]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, itu diperlukan, karena kita membuat aplikasi untuk besi kosong, dan perpustakaan standar membutuhkan sistem operasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya adalah atribut </font></font><code>#![no_main]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang memberitahu kompiler bahwa kita tidak menggunakan fungsi default default dengan vektor argumen dan tipe pengembalian. Ini tidak masuk akal, karena kita tidak memiliki sistem operasi atau runtime lain yang memanggil fungsi dan memproses nilai kembali. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah atribut, kami pasang modul yang diperlukan ke dalam ruang lingkup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini diikuti oleh fungsi, dalam kasus kami, karena kebiasaan, kami menyebutnya -</font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ini adalah titik masuk ke program, ditentukan oleh atribut </font></font><code>#[entry]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di dalam fungsi utama, kami membuat pegangan ke objek periferal yang "memiliki" semua perangkat periferal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, kita dapat mengatur pin yang bertanggung jawab untuk LED yang terpasang di papan ke output. Karena dalam kasus saya ini adalah papan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pill Hitam</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , LED di dalamnya terhubung ke pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika Anda memiliki papan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blue Pill</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C13</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bertanggung jawab untuk LED bawaan </font><font style="vertical-align: inherit;">. Oleh karena itu, kami menetapkan pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebagai output push-pull dan menetapkannya ke variabel </font></font><code>led</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita dapat mengatur waktu pemicu acara pembaruan untuk penghitung waktu sistem, dan menyimpannya dalam variabel</font></font><code>timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dalam contoh kita, waktu ini adalah satu detik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian, dalam loop tanpa akhir, kita dapat menggambarkan logika program kita. </font><font style="vertical-align: inherit;">Sangat sederhana, pertama-tama </font></font><code>timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memblokir eksekusi program hingga waktu yang ditentukan di dalamnya telah berlalu. </font><font style="vertical-align: inherit;">Langkah selanjutnya adalah mengatur pin LED bawaan ke </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tinggi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sehingga menyala. </font><font style="vertical-align: inherit;">Setelah itu, eksekusi program kembali diblokir oleh penghitung waktu yang sama, selama satu detik. </font><font style="vertical-align: inherit;">Dan pin LED diatur ke </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendah</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena itu padam. </font><font style="vertical-align: inherit;">Selanjutnya, program ini diulang secara siklis.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kompilasi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita telah mengetahui kode program dan logika, kita dapat mengkompilasinya menjadi </font><font style="vertical-align: inherit;">file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan perintah:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Format ini tidak hanya berisi kode biner, tetapi juga beberapa header dan banyak lagi. </font><font style="vertical-align: inherit;">Ini berguna ketika file diluncurkan oleh perangkat lunak lain, seperti sistem operasi atau bootloader. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi, untuk menjalankan program pada bare metal, kita tidak perlu file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">File </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah gambar perangkat lunak yang dapat ditulis byte ke dalam memori mikrokontroler. </font><font style="vertical-align: inherit;">File </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat dikonversi ke file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menggunakan perintah:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo objcopy --bin stm32f103c8t6 --target thumbv7m-none-eabi --release -- -O binary stm32f103c8t6.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang file biner kami siap untuk firmware.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Koneksi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan mem-flash board menggunakan programmer ST-Link V2. Untuk melakukan ini, Anda harus terlebih dahulu menghubungkannya ke papan tulis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada kasus programmer ada pengaturan pin konektor. Anda perlu memperhatikan potongan di konektor, itu juga ditampilkan pada diagram, yang memungkinkan Anda untuk memahami cara membuat koneksi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubungkan </font><font style="vertical-align: inherit;">pin </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> programmer dengan pin yang sesuai di papan tulis. Ping </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWDIO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terhubung untuk menyematkan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan menyematkan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWCLK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk menyematkan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menghubungkan papan ke pemrogram, kita dapat menghubungkan ST-Link ke komputer. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhatian!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebelum menghubungkan, lepaskan semua sumber daya lain dari papan, jika ada, jika tidak dapat merusak papan atau komputer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita dapat memeriksa koneksi:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-info --descr</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di konsol, kita akan melihat garis " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perangkat kepadatan menengah F1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara opsional, sebelum berkedip, Anda dapat menghapus memori papan jika ada sesuatu yang tertulis di dalamnya:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-flash erase</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, kita dapat memulai firmware: </font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; st-flash write stm32f1.bin 0x8000000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika semuanya dilakukan dengan benar, Anda akan melihat LED yang berkedip. </font><font style="vertical-align: inherit;">Selamat!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, untuk mem-flash board, Anda harus menggunakan set perintah yang dimasukkan secara berurutan:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; cargo build --release<font></font>
&gt; cargo objcopy --bin stm32f103c8t6 --target thumbv7m-none-eabi --release -- -O binary stm32f103c8t6.bin<font></font>
&gt; st-flash erase<font></font>
&gt; st-flash write stm32f1.bin 0x8000000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menyederhanakan hidup kita, kita dapat membuat </font><font style="vertical-align: inherit;">file </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan perintah ini dan menjalankannya dari konsol.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dari penulis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tertarik dengan panduan ini, selamat datang di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saluran YouTube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga, baru-baru ini, saya memulai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saluran Telegram di</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mana saya menerbitkan berbagai terjemahan buku pedoman dan buku, berita, humor, dan hal-hal lain yang berkaitan dengan bahasa pemrograman Rust. </font><font style="vertical-align: inherit;">Di sana Anda dapat menemukan tautan ke beberapa ruang obrolan untuk mengajukan pertanyaan dan mendapatkan bantuan, mengirimkan proyek, atau hanya mengobrol dengan orang yang berpikiran sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terimakasih atas perhatiannya!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495934/index.html">DataGelola di rumah</a></li>
<li><a href="../id495938/index.html">Pilihan artikel tentang pembelajaran mesin: kasus, panduan dan studi untuk Maret 2020</a></li>
<li><a href="../id495942/index.html">Hemat waktu, saraf dan jam kerja</a></li>
<li><a href="../id495944/index.html">TOP50 yang diperbarui (peringkat superkomputer CIS): dinamika dan tren</a></li>
<li><a href="../id495946/index.html">Norbert Wiener: ayah sibernetika yang terganggu</a></li>
<li><a href="../id495954/index.html">Bagaimana cara Cisco beroperasi dalam mode akses jarak jauh dan garis batas yang tidak ada selama 20 tahun?</a></li>
<li><a href="../id495956/index.html">Harus cepat. Mengoptimalkan permintaan konten email IMAP</a></li>
<li><a href="../id495960/index.html">Hanya AH-ny Wi-Fi. Atau bagaimana kami membangun jaringan Wi-Fi 6 (AX) di lembaga pendidikan</a></li>
<li><a href="../id495962/index.html">Udalenka: bagaimana di X5 mereka berencana untuk beralih ke format kerja jarak jauh</a></li>
<li><a href="../id495966/index.html">Kode tidak masuk akal atau "bagaimana tidak menulis"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>