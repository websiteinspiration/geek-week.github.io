<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧚 🧒🏿 🚠 Table in Atlassian Confluence based on data from a REST request 🌝 👨🏾‍🎓 👨🏿‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 
 In this article I will tell you how to make a page in Atlassian Confluence with a table, the data to which will come from a REST request. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Table in Atlassian Confluence based on data from a REST request</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504566/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article I will tell you how to make a page in Atlassian Confluence with a table, the data to which will come from a REST request. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will create a page in Confluence with a table that will contain project data in Jira. </font><font style="vertical-align: inherit;">We will get this data from Jira using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">from the standard Jira REST API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can watch the video on this article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install Power Scripts for Confluence</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will make a call to the Jira REST API using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Power Scripts for Confluence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plugin </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This is a free plugin, so this solution will not cost you anything. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, the first thing we need to do is install the Power Scripts for Confluence plugin in our Confluence. </font><font style="vertical-align: inherit;">Detailed instructions on how to do this can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Write a script</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now go to the gear menu item -&gt; Manage apps -&gt; SIL Manager. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cf/p0/rs/cfp0rs6wpqyi7poq-gzue4krfpa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create the getProjects.sil file with the following code:</font></font><br>
<br>
<pre><code class="java hljs">struct Project {<font></font>
    string key;<font></font>
    string name;<font></font>
    string projectTypeKey;<font></font>
}<font></font>
<font></font>
HttpRequest request;<font></font>
HttpHeader authHeader = httpBasicAuthHeader(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"admin"</span>);<font></font>
request.headers += authHeader;<font></font>
 <font></font>
Project [] projects = httpGet(<span class="hljs-string">"http://host.docker.internal:8080/rest/api/2/project"</span>, request);<font></font>
runnerLog(projects);<font></font>
<span class="hljs-keyword">return</span> projects;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Change the address of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">host.docker.internal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 8080 / to the address of your Jira instance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run the script to verify that the data is selected from Jira:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3e/f0/ue/3ef0ue1q7kzhg3fkdl1bi7ighw4.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create a page in Confluence</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now create a page in Confluence with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIL table</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macro </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the scripts field, enter the name of our script getProjects.sil: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/nh/9t/5rnh9t3nhjkgcxyc9xcn17qosxg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Publish the page and you will see this result:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7f/sw/q5/7fswq5klwzqw8zfguljbvdorugw.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's complicate the task</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add the following functionality to the table:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">display information about the project manager</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">give the fields more understandable names and preferably in Russian</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, make changes to the getProjects.sil script. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the same time, we refactor a little. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is what our script will do:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get project data from Jira through a call to the Jira REST API</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we convert the received data on projects into a tabular view</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print the result</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how it looks in code:</font></font><br>
<br>
<pre><code class="java hljs">Project [] projects = getProjectData();<font></font>
TableRow [] tableRows =  convertProjectDataToTableData(projects);<font></font>
<font></font>
<span class="hljs-keyword">return</span> tableRows;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's specify how we get project data:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create a request</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create a header in the request with information about the user who receives data from Jira</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add the expand parameter to our query. </font><font style="vertical-align: inherit;">We need to select data about the project manager, but in the default answer there is no such data. </font><font style="vertical-align: inherit;">Therefore, we need to tell Jira that we want to see the data about the project manager in the response. </font><font style="vertical-align: inherit;">For this, the expand parameter is used.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we fulfill the request</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return data</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the words turned into code:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">getProjectData</span><span class="hljs-params">()</span> </span>{<font></font>
    HttpRequest request;<font></font>
    HttpHeader authHeader = httpBasicAuthHeader(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"admin"</span>);<font></font>
    request.headers += authHeader;<font></font>
    HttpQueryParam param = httpCreateParameter(<span class="hljs-string">"expand"</span>, <span class="hljs-string">"description,lead,url,projectKeys"</span>);<font></font>
    request.parameters += param;<font></font>
    Project[] projects = httpGet(<span class="hljs-string">"http://host.docker.internal:8080/rest/api/2/project"</span>, request);
    <span class="hljs-keyword">return</span> projects;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's define data structures for our projects. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is the answer that the project method returns from the Jira REST API (I deleted unnecessary data to make the answer shorter and therefore more readable):</font></font><br>
<br>
<pre><code class="json hljs">[<font></font>
   {<font></font>
      <span class="hljs-attr">"key"</span>:<span class="hljs-string">"KAN"</span>,
      <span class="hljs-attr">"lead"</span>:{
         <span class="hljs-attr">"name"</span>:<span class="hljs-string">"admin"</span>,
         <span class="hljs-attr">"displayName"</span>:<span class="hljs-string">"Alexey Matveev"</span>,<font></font>
      },<font></font>
      <span class="hljs-attr">"name"</span>:<span class="hljs-string">"kanban"</span>,
      <span class="hljs-attr">"projectTypeKey"</span>:<span class="hljs-string">"software"</span><font></font>
   },<font></font>
   {<font></font>
      <span class="hljs-attr">"key"</span>:<span class="hljs-string">"SCRUM"</span>,
      <span class="hljs-attr">"description"</span>:<span class="hljs-string">""</span>,
      <span class="hljs-attr">"lead"</span>:{
         <span class="hljs-attr">"name"</span>:<span class="hljs-string">"admin"</span>,
         <span class="hljs-attr">"displayName"</span>:<span class="hljs-string">"Alexey Matveev"</span>,<font></font>
      },<font></font>
      <span class="hljs-attr">"name"</span>:<span class="hljs-string">"scrum"</span>,
      <span class="hljs-attr">"projectTypeKey"</span>:<span class="hljs-string">"software"</span><font></font>
   }<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As we can see, the values ​​for the key, name and projectTypeKey fields are defined at the first level of our json. </font><font style="vertical-align: inherit;">But for the lead field, instead of the value, we see json. </font><font style="vertical-align: inherit;">And this json already contains the values ​​of the name and displayName fields. </font><font style="vertical-align: inherit;">Therefore, first we create a structure for json in the lead (Lead) field:</font></font><br>
<br>
<pre><code class="java hljs">struct Lead {<font></font>
    string name;<font></font>
    string displayName;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we are ready to make the structure for the first level of our json (Project):</font></font><br>
<br>
<pre><code class="java hljs">struct Project {<font></font>
    string key;<font></font>
    string name;<font></font>
    string projectTypeKey;<font></font>
    Lead lead;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the problem is that the SIL table macro can only work with json with one level of nesting, so we need to convert our structure with two levels of nesting (Project) into a structure with one level of nesting (flat structure). </font><font style="vertical-align: inherit;">But first, create a flat structure (TableRow):</font></font><br>
<br>
<pre><code class="java hljs">struct TableRow {<font></font>
    string key;<font></font>
    string name;<font></font>
    string projectTypeKey;<font></font>
    string lead;<font></font>
    string leadDisplayName;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And now we’ll write a function to convert the data in the Project structure to the TableRow structure:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">convertProjectDataToTableData</span><span class="hljs-params">(Project [] projectData)</span> </span>{<font></font>
    TableRow [] tableRows;<font></font>
    <span class="hljs-keyword">for</span> (Project project in projectData) {<font></font>
        TableRow tableRow;<font></font>
        tableRow.key = project.key;<font></font>
        tableRow.name = project.name;<font></font>
        tableRow.projectTypeKey = project.projectTypeKey;<font></font>
        tableRow.lead = project.lead.name;<font></font>
        tableRow.leadDisplayName = project.lead.displayName;<font></font>
        tableRows = arrayAddElement(tableRows, tableRow);<font></font>
    } <font></font>
    <span class="hljs-keyword">return</span> tableRows;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All. </font><font style="vertical-align: inherit;">The script is ready! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is the final getProjects.sil code:</font></font><br>
<br>
<pre><code class="json hljs">struct Lead {<font></font>
    string name;<font></font>
    string displayName;<font></font>
}<font></font>
<font></font>
struct Project {<font></font>
    string key;<font></font>
    string name;<font></font>
    string projectTypeKey;<font></font>
    Lead lead;<font></font>
}<font></font>
<font></font>
struct TableRow {<font></font>
    string key;<font></font>
    string name;<font></font>
    string projectTypeKey;<font></font>
    string lead;<font></font>
    string leadDisplayName;<font></font>
}<font></font>
<font></font>
function getProjectData() {<font></font>
    HttpRequest request;<font></font>
    HttpHeader authHeader = httpBasicAuthHeader(<span class="hljs-attr">"admin"</span>, <span class="hljs-attr">"admin"</span>);<font></font>
    request.headers += authHeader;<font></font>
    HttpQueryParam param = httpCreateParameter(<span class="hljs-attr">"expand"</span>, <span class="hljs-attr">"description,lead,url,projectKeys"</span>);<font></font>
    request.parameters += param;<font></font>
    string pp = httpGet(<span class="hljs-attr">"http://host.docker.internal:8080/rest/api/2/project"</span>, request);<font></font>
    runnerLog(pp);<font></font>
    Project[] projects = httpGet(<span class="hljs-attr">"http://host.docker.internal:8080/rest/api/2/project"</span>, request);<font></font>
    return projects;<font></font>
}<font></font>
<font></font>
function convertProjectDataToTableData(Project [] projectData) {<font></font>
    TableRow [] tableRows;<font></font>
    for (Project project in projectData) {<font></font>
        TableRow tableRow;<font></font>
        tableRow.key = project.key;<font></font>
        tableRow.name = project.name;<font></font>
        tableRow.projectTypeKey = project.projectTypeKey;<font></font>
        tableRow.lead = project.lead.name;<font></font>
        tableRow.leadDisplayName = project.lead.displayName;<font></font>
        tableRows = arrayAddElement(tableRows, tableRow);<font></font>
    } <font></font>
    return tableRows;<font></font>
}Project [] projects = getProjectData();<font></font>
TableRow [] tableRows =  convertProjectDataToTableData(projects);<font></font>
<font></font>
return tableRows;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we’ll refresh the page in Confluence and see that our data on the project manager pulled up: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/hk/8v/ruhk8vmn3ebygvpsejcsvod7mbe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the column names are somehow unintelligible. </font><font style="vertical-align: inherit;">Let's give more beautiful names. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We edit the page, Edit the SIL table macro and enter “Project Key, Project Name, Project Type, Project Manager, Name of the Project Manager” in the columns field: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/jp/om/fajpom05uedpykk7mb8y_g6na9i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Save the page and here is the result: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/rp/ls/oerpls3m57fijobzqps8krnap-m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything turned out!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504556/index.html">Gesture management: handling gesture conflicts. Part 3</a></li>
<li><a href="../en504558/index.html">Is vaccination mandatory a new reality?</a></li>
<li><a href="../en504560/index.html">Let's discuss the face of domestic crowdfunding</a></li>
<li><a href="../en504562/index.html">Proxmox VE incremental backup with VBR</a></li>
<li><a href="../en504564/index.html">IoT in my life. How to create a smart office, as well as track the growth of potatoes in your apartment thanks to IoT</a></li>
<li><a href="../en504568/index.html">Isaac Asimov: Where do people get new ideas from?</a></li>
<li><a href="../en504572/index.html">Speak like Winston Churchill: who needs to sell their soul to communicate in English SO</a></li>
<li><a href="../en504576/index.html">How home audio developed - from song nights to the first mechanical players</a></li>
<li><a href="../en504578/index.html">How Americans Become Millionaires: FIRE Principles</a></li>
<li><a href="../en504582/index.html">HackTheBox. Walkthrough Resolute. Password spraying. From DnsAdmin to SYSTEM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>