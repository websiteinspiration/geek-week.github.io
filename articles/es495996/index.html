<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔊 🕴🏿 ⚠️ Raspberry Pi, Python y riego de plantas de interior 👵🏾 👷 👩🏽‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No tengo relación con las plantas de interior. El hecho es que me olvido de regarlos. Sabiendo esto, comencé a reflexionar sobre el hecho de que algui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi, Python y riego de plantas de interior</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/495996/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No tengo relación con las plantas de interior. </font><font style="vertical-align: inherit;">El hecho es que me olvido de regarlos. </font><font style="vertical-align: inherit;">Sabiendo esto, comencé a reflexionar sobre el hecho de que alguien, con seguridad, ya había encontrado una manera de automatizar el riego. </font><font style="vertical-align: inherit;">Al final resultó que, hay muchas maneras. </font><font style="vertical-align: inherit;">Es decir, estamos hablando de soluciones basadas en Arduino o Raspberry Pi. </font><font style="vertical-align: inherit;">En este artículo quiero hablar sobre cómo creé un sistema basado en Raspberry Pi y Python, diseñado para automatizar las plantas de riego.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/yl/yf/f3/ylyff31evrdtianmwk_5stnbgf4.jpeg"></a><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Componentes y recursos útiles</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inmediatamente me gustaría señalar que no soy en absoluto un experto en electrónica. </font><font style="vertical-align: inherit;">Si me piden que dibuje un diagrama eléctrico o que cuente en detalle cómo funciona cualquier componente electrónico, no puedo dibujar nada sensato ni decirlo. </font><font style="vertical-align: inherit;">De hecho, hice este proyecto solo con conocimientos básicos de electricidad y solo experimentando con componentes. </font><font style="vertical-align: inherit;">Le pido que tenga mucho cuidado al trabajar con electricidad. </font><font style="vertical-align: inherit;">Y, si siente una falta de conocimiento en esta área, sugiero al menos un poco de comprensión de esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí hay una lista de componentes que utilicé en mi proyecto.</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 3 Starter Kit</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bomba de agua, 12V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuente de alimentación, 12V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relé, 5V</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cables de conexión</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cables con conectores de cocodrilo</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tubos de silicona</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Participo en el programa de afiliados de Amazon, por lo que se proporcionan los enlaces anteriores. </font><font style="vertical-align: inherit;">Si los revisas y compras algo, ganaré un poco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de obtener todos los componentes que necesito, es hora de investigar un poco. </font><font style="vertical-align: inherit;">La siguiente es una lista de recursos que me ayudaron a conectar correctamente los componentes electrónicos y comprender los puntos principales con respecto a su funcionamiento:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Cómo funciona la electricidad?</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo usar un relé</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuente de alimentación de relé Raspberry Pi</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexión de una fuente de alimentación de 12 V a un relé</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí hay un diagrama de los puertos GPIO de la Raspberry Pi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/0bf/981/e1e0bf981b31d01f59837b4885bc31ba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de puerto GPIO Raspberry Pi</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte un relé a la Raspberry Pi</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencé conectando un relé a la Raspberry Pi. </font><font style="vertical-align: inherit;">Así es como se ve.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ec3/cf5/763/ec3cf5763b5451d4a4bf9b6da4fc4a95.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexión del relé a la Raspberry Pi El</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
cable rojo (hembra-hembra) va desde el pin de la placa de relé JD_VCC al pin de 5V (pin No. 2) del Raspberry Pi. </font><font style="vertical-align: inherit;">Un cable naranja (hembra-hembra) conduce desde el pin de la placa de relé VCC al pin de 3.3V (pin No. 1) de la Raspberry Pi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a6/17c/868/4a617c868ef4a058c20f714a1c7b6fad.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pines JD_VCC y VCC de la placa de relés</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Con estos cables, suministramos energía a la placa de relés. </font><font style="vertical-align: inherit;">Para poder controlar relés individuales, debe conectar la placa de relés y la Raspberry Pi con dos cables más que se conectan a los pines GND e IN1 de la placa de relés.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/071/ec9/94e/071ec994e83748306c3a9d35e8dc0791.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pines GND e IN1 de la placa de relé El</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
cable negro (hembra-hembra) es el cable de tierra que conecta el pin GND de la placa de relé y el pin de tierra en la Raspberry Pi (lo conecté al pin No. 34). </font><font style="vertical-align: inherit;">Un cable blanco (hembra-hembra) conduce desde el pin IN1 de la placa de relés hasta el pin No. 12 de la Raspberry Pi. </font><font style="vertical-align: inherit;">Es este cable blanco el que nos permite controlar mediante programación el relé, activando y desactivando los relés individuales ubicados en el tablero.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/226/d5c/d14/226d5cd14bb1dd4ad3f31ae02bace405.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cables blancos y negros conectados a la Raspberry Pi</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si decide reproducir mi proyecto, puede organizar el relé y la Raspberry Pi para que se comuniquen utilizando los pines adecuados. </font><font style="vertical-align: inherit;">Pero tenga en cuenta que si el diagrama de conexión de los componentes de su proyecto es diferente del diagrama de conexión de los componentes de mi proyecto, deberá realizar los cambios apropiados en mi código.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexión de la fuente de alimentación al relé</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de conectar la placa de relé a la Raspberry Pi, conecté la fuente de alimentación a uno de los relés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No enchufe la fuente de alimentación a una toma de corriente hasta que haya completado todas las operaciones de recolección de componentes del sistema. </font><font style="vertical-align: inherit;">Tenga en cuenta el riesgo de descarga eléctrica.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b3/95a/d58/4b395ad58f4d7384efeb067ede209486.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexión de la fuente de alimentación a uno de los relés La</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fuente de alimentación de 12 V utilizada por mí viene con un adaptador al que es conveniente conectar los cables de conexión. </font><font style="vertical-align: inherit;">Conecté el cable rojo (macho-macho) al conector del adaptador "+" y el cable marrón (macho-macho) al conector del adaptador "-". </font><font style="vertical-align: inherit;">Luego conecté el cable con el conector "Crocodile" (hembra-macho) al cable marrón.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fc/faf/f7f/0fcfaff7f05b281f5cc23e73bf66fcc6.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptador que viene con la fuente de alimentación</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La placa de relés tiene cuatro relés separados. </font><font style="vertical-align: inherit;">Cada uno de ellos tiene tres pines a los que se pueden conectar los cables. </font><font style="vertical-align: inherit;">En el centro de cada relé hay un conector al que está conectada la salida positiva de una fuente de alimentación externa. </font><font style="vertical-align: inherit;">A la izquierda está el conector al que está conectada la entrada positiva del dispositivo al que se va a conectar la alimentación.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c64/ecd/dca/c64ecddca0322384223dc85d0e397526.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al conectar un relé separado,</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
conecté un cable rojo desde la fuente de alimentación (terminal positivo) al contacto central del relé. </font><font style="vertical-align: inherit;">Luego conecté el cable naranja (macho-macho) al conector izquierdo del relé y conecté el cable con el "cocodrilo" (hembra-macho) a este cable.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f7/7ee/a36/3f77eea36c73477d3e50dbfcb4148c21.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cables rojos y naranjas</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff3/9e3/6b9/ff39e36b9e57544b8167c24d5d2d773f.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuente de alimentación y adaptador</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98d/38d/875/98d38d875d52addfa9d57b245b61ce2c.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relé y Raspberry Pi</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectar una bomba de agua a un relé</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora solo queda conectar los conectores “cocodrilos” a la bomba de agua. </font><font style="vertical-align: inherit;">El orden de su conexión determina la dirección del flujo de agua. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, necesitaba agua para entrar en el canal izquierdo de la bomba y salir del canal derecho. </font><font style="vertical-align: inherit;">Por lo tanto, conecté el conector de "cocodrilo" del cable negro al terminal de la bomba, cerca del cual hay un punto rojo, y el otro "cocodrilo" al otro terminal de la bomba. </font><font style="vertical-align: inherit;">Si conectara los "cocodrilos" en un orden diferente, el agua iría en la dirección opuesta, desde el canal derecho hacia el izquierdo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/059/a2f/bc0/059a2fbc0b0267b29ec9800fc13405f2.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectar una bomba de agua a un relé</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84b/755/96b/84b75596b0b1ad9d0277e58e2ddd06fa.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistema de riego completo: el agua ingresa a la bomba a través del canal izquierdo, sale de la derecha y va a la planta</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El código</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Así que llegamos a lo que soy realmente bueno. Llegamos al código. Para que el software funcione con los puertos GPIO de Raspberry Pi, utilicé la biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gpiozero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Es fácil de usar, oculta una gran cantidad de mecanismos de bajo nivel del programador, que generalmente debe comprender para alguien que quiere trabajar con pines GPIO. La biblioteca está bien documentada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de escribir el código, debe conectar un monitor, mouse y teclado a su Raspberry Pi. O necesita conectarse a la Raspberry Pi a través de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de ingresar a Raspberry Pi, vaya a la carpeta </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y cree una carpeta allí </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Crea una carpeta en esta carpeta </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Y en la carpeta, </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cree un archivo </font></font><code>Hardware.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Debe tener el siguiente código:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> gpiozero <span class="hljs-keyword">import</span> OutputDevice<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Relay</span>(<span class="hljs-params">OutputDevice</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, pin, active_high</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(Relay, self).__init__(pin, active_high)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este archivo, acabo de declarar una nueva clase </font></font><code>Relay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que es descendiente de la clase </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OutputDevice</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, en la carpeta, </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creé un nuevo archivo </font></font><code>TimeKeeper.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> datetime<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimeKeeper</span>:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, current_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.current_time = current_time<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.time_last_watered = <span class="hljs-literal">None</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_current_time</span>(<span class="hljs-params">self, updated_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.current_time = updated_time<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_time_last_watered</span>(<span class="hljs-params">self, updated_time</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.time_last_watered = updated_time<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;@staticmethod<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_current_time</span>():</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now = datetime.datetime.now()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> now.strftime(<span class="hljs-string">"%I:%M:%S %p"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El propósito de esta clase es rastrear la hora actual y el momento en que se realizó el último riego. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, los archivos </font></font><code>Hardware.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>TimeKeeper.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">están en la carpeta </font></font><code>classes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ahora, fuera de esta carpeta, creo un archivo </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> classes <span class="hljs-keyword">import</span> Hardware
<span class="hljs-keyword">from</span> classes <span class="hljs-keyword">import</span> TimeKeeper <span class="hljs-keyword">as</span> TK
<span class="hljs-keyword">import</span> schedule
<span class="hljs-keyword">import</span> smtplib
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> ssl<font></font>
<font></font>
<span class="hljs-comment"># WATERING_TIME must be in "00:00:00 PM" format</span>
WATERING_TIME = <span class="hljs-string">'11:59:50 AM'</span>
SECONDS_TO_WATER = <span class="hljs-number">10</span>
RELAY = Hardware.Relay(<span class="hljs-number">12</span>, <span class="hljs-literal">False</span>)<font></font>
EMAIL_MESSAGES = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'last_watered'</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'subject'</span>: <span class="hljs-string">'Raspberry Pi: Plant Watering Time'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'message'</span>: <span class="hljs-string">'Your plant was last watered at'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'check_water_level'</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'subject'</span>: <span class="hljs-string">'Raspberry Pi: Check Water Level'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'message'</span>: <span class="hljs-string">'Check your water level!'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_email</span>(<span class="hljs-params">time_last_watered, subject, message</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;port = <span class="hljs-number">465</span>
&nbsp;&nbsp;&nbsp;&nbsp;smtp_server = <span class="hljs-string">"smtp.gmail.com"</span>
&nbsp;&nbsp;&nbsp;&nbsp;FROM = TO = <span class="hljs-string">"YOUR_EMAIL@gmail.com"</span>
&nbsp;&nbsp;&nbsp;&nbsp;password = <span class="hljs-string">"YOUR_PASSWORD"</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">''</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> time_last_watered == <span class="hljs-literal">False</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">"Subject: {}\n\n{}"</span>.format(subject, message)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complete_message = <span class="hljs-string">"Subject: {}\n\n{} {}"</span>.format(subject, message, time_last_watered)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;context = ssl.create_default_context()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">with</span> smtplib.SMTP_SSL(smtp_server, port, context=context) <span class="hljs-keyword">as</span> server:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.login(FROM, password)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.sendmail(FROM, TO, complete_message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_last_watered_email</span>(<span class="hljs-params">time_last_watered</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;message = EMAIL_MESSAGES[<span class="hljs-string">'last_watered'</span>][<span class="hljs-string">'message'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;subject = EMAIL_MESSAGES[<span class="hljs-string">'last_watered'</span>][<span class="hljs-string">'subject'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;send_email(time_last_watered, subject, message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_check_water_level_email</span>():</span>
&nbsp;&nbsp;&nbsp;&nbsp;message = EMAIL_MESSAGES[<span class="hljs-string">'check_water_level'</span>][<span class="hljs-string">'message'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;subject = EMAIL_MESSAGES[<span class="hljs-string">'check_water_level'</span>][<span class="hljs-string">'subject'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;send_email(<span class="hljs-literal">False</span>, subject, message)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">water_plant</span>(<span class="hljs-params">relay, seconds</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;relay.on()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"Plant is being watered!"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(seconds)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"Watering is finished!"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;relay.off()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;time_keeper = TK.TimeKeeper(TK.TimeKeeper.get_current_time())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(time_keeper.current_time == WATERING_TIME):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;water_plant(RELAY, SECONDS_TO_WATER)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_keeper.set_time_last_watered(TK.TimeKeeper.get_current_time())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"\nPlant was last watered at {}"</span>.format(time_keeper.time_last_watered))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># send_last_watered_email(time_keeper.time_last_watered)</span><font></font>
<font></font>
<span class="hljs-comment"># schedule.every().friday.at("12:00").do(send_check_water_level_email)</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># schedule.run_pending()</span>
&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;main()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí puede cambiar los valores de las variables </font></font><code>WATERING_TIME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>SECONDS_TO_WATER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las que le parezcan adecuadas. La primera variable determina a qué hora regar las plantas. El segundo establece la duración del riego. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además, creé aquí un mecanismo para enviar notificaciones y recordatorios por correo electrónico. Gracias a este mecanismo, el propietario del sistema de riego recibe un correo electrónico cada vez que se enciende el sistema y riega las plantas. Además, todos los viernes recibe una carta que le recuerda que debe verificar los suministros de agua de riego. En el código, se comenta la llamada de los métodos correspondientes, como resultado, el programa puede funcionar normalmente sin configuraciones relacionadas con el correo electrónico. Si desea habilitar estos recordatorios, haga lo siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debe ingresar en la línea </font></font><code>FROM = TO = «YOUR_EMAIL@gmail.com»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>password = «YOUR_PASSWORD»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">su dirección de correo electrónico y contraseña de Gmail.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descomente las siguientes líneas: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;# send_last_watered_email (time_keeper.time_last_watered)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># schedule.every (). friday.at ("12:00"). do (send_check_water_level_email)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># schedule.run_pending ()</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debe ir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , iniciar sesión en su cuenta de Gmail y activar el interruptor en esta página. </font><font style="vertical-align: inherit;">De lo contrario, cuando intente enviar un correo electrónico utilizando Gmail, recibirá un mensaje de error.&nbsp;</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además, es importante tener en cuenta que mi sistema de recordatorio solo funciona con cuentas de Gmail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que todo está listo para el trabajo, debería obtener la siguiente estructura de archivos y carpetas:</font></font><br>
<br>
<pre><code class="bash hljs">run<font></font>
├── classes<font></font>
│ ├── Hardware.py<font></font>
│ └── TimeKeeper.py<font></font>
└── water_plant.py<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una carpeta </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se puede colocar en cualquier lugar. </font><font style="vertical-align: inherit;">Decidí dejarlo en la carpeta </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No me atraía la posibilidad de conectarme a Raspberry Pi cada vez que tenía que iniciarlo </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Me gustaría que este script se ejecute automáticamente cuando Raspberry Pi esté activado. </font><font style="vertical-align: inherit;">Esto, por ejemplo, facilitaría apagar el sistema, moverlo a otro lugar, encenderlo y no tener que preocuparse por nada. </font><font style="vertical-align: inherit;">Para implementar este escenario atractivo, necesitamos un equipo </font></font><code>crontab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra la ventana de terminal en la Raspberry Pi e ingrese el siguiente comando:</font></font><br>
<br>
<pre><code class="bash hljs">sudo crontab -e
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En respuesta a esto, el sistema debería generar algo parecido a lo que se muestra en la siguiente figura.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca0/3cd/f45/ca03cdf45a0400ea64b5e163357e9079.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuración de tareas cron</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agregue la siguiente línea a este archivo:</font></font><br>
<br>
<pre><code class="bash hljs">@reboot python3 /home/pi/Desktop/run/water_plant.py
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces este archivo debe guardarse usando la combinación de teclas </font></font><code>Ctrl+X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ingresando </font></font><code>Y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y presionando </font></font><code>Enter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la línea anterior, le damos a Raspberry Pi las siguientes instrucciones: "Cada vez que reinicie, ejecute el archivo </font></font><code>water_plant.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ubicado en la carpeta </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que está en la carpeta </font></font><code>Desktop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">Si su carpeta </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se encuentra en una forma diferente, edite este comando en consecuencia.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ver el código del proyecto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si lo desea, puede clonar inmediatamente su repositorio con este comando:</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/AlanConstantino/rpi-plant-project.git
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¡Eso es todo! </font><font style="vertical-align: inherit;">Ahora ya sabe cómo crear un sistema de riego automatizado para plantas de interior basado en Raspberry Pi. </font><font style="vertical-align: inherit;">Ella sabe cómo regar las plantas cada 24 horas y puede enviar notificaciones y recordatorios por correo electrónico a su propietario. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¡Queridos lectores! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Cómo desarrollarías un sistema de riego de plantas automatizado en el hogar?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495982/index.html">Estudiamos el motor VoIP Mediastreamer2. Parte 4</a></li>
<li><a href="../es495984/index.html">Reacción, rendimiento y -500 milisegundos en el lanzamiento: el historial de nuestras optimizaciones en números</a></li>
<li><a href="../es495986/index.html">Análisis de documentos internacionales sobre gestión de riesgos de seguridad de la información. Parte 2</a></li>
<li><a href="../es495990/index.html">Divulgación del número de teléfono y geolocalización a través de la vulnerabilidad en Telegram</a></li>
<li><a href="../es495994/index.html">Comienzo del trimestre académico o cómo me convertí en coordinador de educación a distancia.</a></li>
<li><a href="../es495998/index.html">Crear un tema oscuro para el desbordamiento de pila</a></li>
<li><a href="../es496004/index.html">Nuevos modelos de búsqueda y análisis de datos. WSDM 2020 a través de los ojos del equipo Yandex.Tolki</a></li>
<li><a href="../es496006/index.html">Proxy inverso superado: tecnología para protección remota y optimización del sitio sin cambiar los registros A de DNS</a></li>
<li><a href="../es496010/index.html">Qué sucede con el transporte durante la crisis (primera semana de abril)</a></li>
<li><a href="../es496014/index.html">Seminarios semanales de IBM - abril de 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>