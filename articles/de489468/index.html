<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦓 👨🏿‍✈️ 🤵🏾 Einfache Slack App zum Veröffentlichen von Inhalten aus Google Sheets 🤙🏼 🥕 🏇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir probieren gerne neue Dinge aus und teilen daher häufig Links zu interessanten Informationen aus der IT- und Programmierwelt mit unseren Kollegen. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Einfache Slack App zum Veröffentlichen von Inhalten aus Google Sheets</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489468/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir probieren gerne neue Dinge aus und teilen daher häufig Links zu interessanten Informationen aus der IT- und Programmierwelt mit unseren Kollegen. Wir sind langjährige Nutzer von Slack und für solche Links haben wir einen separaten Bildungskanal, in dem jeder etwas Interessantes für sich finden kann. Aber da wir normale Menschen sind, die sich regelmäßig in der Hitze der Arbeit befinden, vergessen wir, dass wir diese Verbindungen teilen müssen, und die Aktivität im Kanal schwindet, obwohl viele von uns etwas zu teilen haben.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir standen vor einer interessanten Aufgabe, einen „Bot“ zu entwickeln, der automatisch vorab gesammelte Informationen aufnimmt und regelmäßig Links dazu teilt. </font><font style="vertical-align: inherit;">Wir suchten nach einer vorgefertigten Lösung im Internet, und jetzt ist sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">als Integration von Zapier und Slack erschienen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gb/zc/el/gbzcelbfefmw2trwii1temk6f2a.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine solche Integration haben wir jedoch vorher nicht gefunden und beschlossen, unser eigenes kleines Fahrrad zu schreiben. </font><font style="vertical-align: inherit;">Im Folgenden werden wir beschreiben, wie genau wir es gemacht haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Nachdenken über das Problem kam mir folgende Lösung in den Sinn: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javascript-Code, der Informationen zu relevanten nützlichen Links aus der Google-Tabelle empfängt und an Slack sendet. </font><font style="vertical-align: inherit;">Aufrufen eines Skripts vom ersten Element eines Zeitplans mit cron. </font><font style="vertical-align: inherit;">Fangen wir in der richtigen Reihenfolge an.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Token für Slack bekommen.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist alles einfach und wurde in anderen Artikeln wiederholt beschrieben, daher werde ich nur eine kurze Beschreibung geben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt zwei Möglichkeiten: Erstellen Sie Ihre eigene Slack-Anwendung oder verwenden Sie ältere Token. Die erste Option ist etwas komplizierter, wird jedoch von Slack empfohlen. Die zweite Option ist einfacher und für unsere Anforderungen gut geeignet, da wir sie aufgrund ihrer Einfachheit auswählen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir öffnen einen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link, um ein neues Token zu generieren</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ein neues Token für den gewünschten Arbeitsbereich zu erstellen (vergessen Sie nicht, es zu kopieren, das Token wird einmal ausgestellt). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bu/fw/bq/bufwbqnmxbfoliu35xk_lky8gtm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir in Zukunft Code implementieren, der mit der Slack-API und Google Sheets interagiert, können wir dieses Token für den beabsichtigten Zweck verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen Sie das Token für Google Sheets erhalten. Öffnen Sie zunächst </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js Quickstart für Google Sheets</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und aktivieren Sie die Google Sheets-API. </font><font style="vertical-align: inherit;">Dann kopieren wir den Code index.js aus dem Beispiel und führen ihn aus, durchlaufen den Autorisierungsprozess und erhalten die Anmeldeinformationen in der Datei, die für die Verwendung mit unserem Skript nützlich sind.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skriptimplementierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist es an der Zeit, ein Skript zum Veröffentlichen von Nachrichten von Google Sheets an Slack zu entwickeln. </font><font style="vertical-align: inherit;">Den vollständigen Skriptcode finden Sie, indem Sie auf den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> klicken </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst analysieren wir den Teil des Codes, der Nachrichten an den Slack-Kanal sendet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies geschieht durch Aufrufen der Slack REST-API.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> post = <span class="hljs-keyword">async</span> (text, channel = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CHANNEL</span> <span class="hljs-attr">ID</span>&gt;</span>) =&gt; {
  const uri = `https://slack.com/api/chat.postMessage?token=${SLACK_AUTH_TOKEN}&amp;channel=${channel}&amp;text=${text}`;
  const result = await fetch(encodeURI(uri), {
    headers: {
      'Content-Type': 'application/json',
    },
    method: 'POST',
    body: JSON.stringify({
      channel,
      text,
      as_user: true
    })
  });

  await result.json();
};
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Autorisierung in der Google-API werden zwei Funktionen verwendet (authorize, getNewToken), deren Code aus Node.js Quickstart stammt. Wir werden nicht näher darauf eingehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der nächste interessante Codeblock besteht darin, Informationen aus Google-Tabellen zu senden. Dies erfolgt mithilfe der folgenden Funktion:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> getMessageAndPost = <span class="hljs-keyword">async</span> (auth, spreadsheetId = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ID</span>  <span class="hljs-attr">Google</span> &gt;</span>) =&gt; {
  const sheets = google.sheets({ version: 'v4', auth });
  sheets.spreadsheets.values.get({
    spreadsheetId,
    range: 'Sheet1!A1:B999',
  }, async (err, res) =&gt; {
    if (err) return console.log('The API returned an error: ' + err);
    const rows = res.data.values;
    if (rows.length) {
      // Print columns A and E, which correspond to indices 0 and 4.
      const ix = rows.findIndex(r =&gt; !r[1]);
      await post(rows[ix][0]);
      sheets.spreadsheets.values.update({
        spreadsheetId: '18VzilQTEDGXBnaH1f_k-uAfa8Mb470gx32Phir6xQT4',
        range: `Sheet1!B${ix + 1}`,
        valueInputOption: 'RAW',
        requestBody: {
          range: `Sheet1!B${ix + 1}`,
          values: [['x']]
        }

      })
    } else {
      console.log('No data found.');
    }
  });
};</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Tabelle, mit der das Skript interagiert, hat die folgende Form: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/lr/1r/tylr1rijbae8u53q8qvuwbls5te.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dementsprechend setzt </font><font style="vertical-align: inherit;">das Skript </font><font style="vertical-align: inherit;">für jeden Link nach dem Senden einer Nachricht an Slack "x". Um die Nachricht zu finden, die Sie senden möchten, sollten Sie die erste Zeile auswählen, die noch kein „x“ hat, die Nachricht aufnehmen, senden und die ausgewählte Zeile markieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Skript, das wir gerade zerlegt haben, ist recht einfach und hat seine Leistung seit mehreren Jahren in unserem Team bestätigt. Wir müssen dieses Skript nur auf dem Server bereitstellen und es gerne verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dafür verwenden wir in unserem Unternehmen das übliche Ubuntu VPS auf Digital Ocean (selbst das mit dem geringsten Stromverbrauch). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst müssen Sie die Umgebung für die Ausführung von Javascript-Code konfigurieren. Dazu müssen Sie node.js (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installationsanleitung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurieren Sie anschließend die Cron-Task so, dass das Skript nach einem Zeitplan aufgerufen wird:</font></font><br>
<br>
<pre><code class="plaintext hljs">crontab -e<font></font>
<font></font>
#### <font></font>
<font></font>
24 14 * * 1-5 cd /root/google-sheets-to-slack &amp;&amp; node post.js<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit diesen Einstellungen wird unser Skript aus dem Ordner / root / täglich von Montag bis Freitag um 14:24 Uhr aufgerufen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Setup ist beendet, aber der aufmerksame Leser muss einige Fehler im Skript bemerkt haben. Wenn beispielsweise beim Aufrufen des Skripts ein Fehler auftritt, werden wir nie davon erfahren, da es "leise herunterfällt" und das ist alles. </font><font style="vertical-align: inherit;">Um dieses Problem zu lösen, können Sie die Fehlerbehandlung und Ausgabe des Ergebnisses des Skriptaufrufs derselben Google-Tabelle oder Protokolldatei hinzufügen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anstatt eine Nachricht zu einem festgelegten Zeitpunkt zu senden, können Sie sie auch mit einer zufälligen Verzögerung senden, sodass unsere Nachricht eher einer Nachricht eines "Live" -Benutzers ähnelt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere interessante Idee eines unserer Kollegen war es, eine zweite Tabelle zu erstellen, von der aus Nachrichten ausschließlich freitags gesendet werden und die unterhaltsamer ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen sehen wir unzählige Ideen zur Verfeinerung und werden sie schrittweise umsetzen, aber in der vorhandenen Form war dieses Skript durchaus brauchbar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Beispieltabelle, die verwendet werden kann, finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank fürs Lesen und viel Spaß beim Verwenden.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489444/index.html">Verwandeln Sie die Natur mit 3D-Scannen in Dekoration</a></li>
<li><a href="../de489452/index.html">Microsoft JavaScript-Aufgaben</a></li>
<li><a href="../de489456/index.html">Empfehlungen nach der Ernennung eines Zahnarztes</a></li>
<li><a href="../de489460/index.html">Zwei-Finger-UV</a></li>
<li><a href="../de489464/index.html">"Ich komme wieder!": Wie sich Arnold Schwarzeneggers Englisch in den USA über 50 Jahre verändert hat</a></li>
<li><a href="../de489470/index.html">Das Wettbewerbspotential von Belagerungs-ähnlichen Simulationen</a></li>
<li><a href="../de489472/index.html">Webarchiv: Substitution importieren</a></li>
<li><a href="../de489474/index.html">So komprimieren Sie das fastText-Modell 100 Mal</a></li>
<li><a href="../de489476/index.html">Gestalten von Kontrollkästchen und Optionsfeldern mit CSS3</a></li>
<li><a href="../de489482/index.html">Was Sie wissen müssen, wenn Sie Go-Funktionen vom Assembler aus aufrufen möchten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>