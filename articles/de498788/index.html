<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèø üëåüèª üõÄüèª Einen Mini-Schrittmotor lernen ü§ûüèø üë∏üèæ üë£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Schrittmotoren sind in der modernen Industrie und in hausgemachten Produkten weit verbreitet. Sie werden dort eingesetzt, wo es notwendig ist, die Gen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Einen Mini-Schrittmotor lernen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498788/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schrittmotoren sind in der modernen Industrie und in hausgemachten Produkten weit verbreitet. Sie werden dort eingesetzt, wo es notwendig ist, die Genauigkeit der Positionierung mechanischer Komponenten sicherzustellen, ohne auf R√ºckkopplungen und genaue Messungen zur√ºckgreifen zu m√ºssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute m√∂chte ich √ºber eine spezielle Art von Schrittmotoren sprechen - Miniatur-Schrittmotoren, die beim Aufbau optischer Systeme verwendet werden. Wir werden uns ihr Ger√§t genauer ansehen und wie man so kleine Motoren steuert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/sz/_x/zhsz_xl6lm4btv11g953x7e2kwa.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Schrittmotor ist ein b√ºrstenloser (b√ºrstenloser) Elektromotor mit mehreren Wicklungen (Phasen) am Stator und Magneten (oft permanent) am Rotor. Durch Anlegen einer Spannung an die Statorwicklungen k√∂nnen wir die Position des Rotors festlegen, und durch Anlegen einer Spannung an die Wicklungen k√∂nnen wir nacheinander die Bewegung des Rotors von einer Position zur anderen erhalten (Schritt), und dieser Schritt hat einen festen Winkelwert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden nicht auf die Betrachtung jedes Schrittmotortyps eingehen. Im Netzwerk und zum Beispiel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> viel dar√ºber geschrieben </font><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte √ºber eine spezielle Art von Schrittmotoren sprechen - Miniatur-Schrittmotoren, die beim Aufbau optischer Systeme verwendet werden. </font><font style="vertical-align: inherit;">Diese Kinder stehen zum Verkauf. </font><font style="vertical-align: inherit;">Im Netzwerk, insbesondere im russischsprachigen Raum, gibt es jedoch nur sehr wenige Informationen zu solchen Motoren. </font><font style="vertical-align: inherit;">Wenn ich sie in meinem Projekt verwenden musste, musste ich daher ziemlich nach Informationen suchen und ein paar Experimente durchf√ºhren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die Ergebnisse meiner Suchen und Experimente in diesem Artikel teilen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden das Management solcher kleinen Motoren betrachten, n√§mlich:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Treiber L293D + Mikrocontroller ATtiny44;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMC2208-Treiber + ATtiny44-Mikrocontroller;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikrocontroller ATtiny44 (ohne Treiber).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich kann hier nur der letzte Punkt Fragen aufwerfen. </font><font style="vertical-align: inherit;">Glauben Sie mir, ich war auch √ºberrascht, als ich auf einen Videoclip stie√ü ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier ist er</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), in dem der Typ den Schrittmotor einfach aufnimmt und direkt an die Stifte des Mikrocontrollers hakt! </font><font style="vertical-align: inherit;">Aber lassen Sie uns √ºber alles in Ordnung sprechen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekanntschaft</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zun√§chst ein kleiner Blick auf das Aussehen unseres Helden: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s9/6n/lu/s96nlurhh1cpirq8g8zrtv1t_t0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Er ist wirklich sehr klein! Nach dem Smart Book Petrenko S.F. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Piezoelektrische Motoren in der Instrumentierung", kleinere elektromagnetische Motoren, sind im Prinzip unm√∂glich zu erzeugen ... das hei√üt, es ist m√∂glich, aber mit einer Verringerung des Durchmessers des Drahtes, aus dem die Wicklungen hergestellt werden, wird immer mehr Energie als W√§rme an die Umgebung abgegeben, was zu einer Verringerung des Motorwirkungsgrads und der Leistung f√ºhrt ihre Verwendung ist irrational. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bemerkenswert ist, dass die Welle sehr kurz ist und eine spezielle Nut zum Einbau des Zahnrads oder Hebels aufweist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deutlich sichtbar sind zwei Wicklungen, die sogar mit einer Isolierung in verschiedenen Farben bedeckt sind. Unser Motor geh√∂rt also h√∂chstwahrscheinlich zur Klasse der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bipolaren Schrittmotoren</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mal sehen, wie es funktioniert: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/ds/2w/5vds2wkt6kjahi0m55emzq5ipmc.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich denke, unsere Bekanntschaft mit diesen Motoren wird nicht vollst√§ndig sein, wenn wir nicht sehen, was sich darin befindet. Es ist immer interessant, in den Mechanismus zu schauen! Etwa nicht?</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Eigentlich haben wir nichts Ungew√∂hnliches gesehen. Der Rotor ist magnetisiert. Es gibt nirgendwo Lager, alles ist auf den Buchsen. Die Hinterradnabe wird in das Motorgeh√§use gedr√ºckt. Die Front ist durch nichts fixiert. Interessanterweise wurde der Motork√∂rper durch Punktschwei√üen zusammengebaut. Also musste die vordere Abdeckung geschnitten werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun wenden wir uns dem Thema Verbindung und ihren elektrischen Eigenschaften zu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sicher, dass er bipolar ist, indem Sie die Wicklungen klingeln. Wirklich bipolar, genau wie auf dem Bild oben. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Wicklungswiderstand betr√§gt ca. 26 Ohm</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , obwohl der Verk√§ufer 14 Ohm angegeben hat.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Beschreibung besagt, dass die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versorgungsspannung 5V betr√§gt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Obwohl wir alle wissen, dass f√ºr einen Schrittmotor der Strom, den seine Wicklungen verbrauchen, wichtig ist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir versuchen uns zu verbinden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versuch Nr. 1. </font><font style="vertical-align: inherit;">L293D + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie wir wissen, ist es zur Steuerung eines bipolaren Schrittmotors erforderlich, nicht nur die beiden Wicklungen in der gew√ºnschten Reihenfolge mit Spannung zu versorgen, sondern auch die Richtung des Stroms in diesen Wicklungen zu √§ndern und dies unabh√§ngig voneinander zu tun. Hierzu ben√∂tigt jede Wicklung eine eigene H-Br√ºcke. Um ihn nicht von Transistoren abzuhalten, wurde ein fertiger L293D-Chip genommen. Ein weiterer Vorteil: Der Chip verf√ºgt √ºber spezielle Pins Enable1 und Enable2, die jede Br√ºcke ein- und ausschalten. Sie k√∂nnen verwendet werden, um ein PWM-Signal bereitzustellen, so dass es m√∂glich ist, die Versorgungsspannung jeder Br√ºcke zu steuern. Warum dies erforderlich sein kann, werden wir weiter sehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dar√ºber hinaus kann der L293D </font><b><font style="vertical-align: inherit;">Spannungen bis zu 36</font></b><font style="vertical-align: inherit;"> V umschalten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und bis zu 1,2 A pro Kanal ausgeben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, was ausreichen sollte, um die Wicklungen unseres Motors anzutreiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Diagramm: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ap/eu/sm/apeusmkkhcddqmhrdrmvwkpjbsk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die L293D-Steuereing√§nge sind mit den OC0A- und OC0B-Ausg√§ngen verbunden, sodass wir in Zukunft ein PWM-Signal an sie senden k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden den Controller durch den In-Circuit-Programmierer flashen (in der Abbildung nicht gezeigt). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht die zusammengebaute Schaltung auf einem Steckbrett aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gx/87/jg/gx87jgsrgeuethu-dotn-_a-fsc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und so befindet sich unser </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/so/xw/xrsoxwzgqmg1q80dx9dwecpcg68.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testpilot </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Jetzt k√∂nnen Sie mit dem Experimentieren beginnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir berechnen den Strom, der durch die Motorwicklungen flie√üt, wenn diese an eine Spannung von 5 V angeschlossen sind: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I = U / R = 5 V / 26 Ohm = 190 mA </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sehr klein. Ich frage mich, wie lange er einen solchen Strom halten und nicht √ºberhitzen kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir nehmen ein Amperemeter und ein Voltmeter in den Stromkreis einer der Wicklungen auf und messen die entsprechenden Werte, wenn diese Wicklung √ºber den Treiber mit Strom versorgt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Spannung an der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,56-V-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wicklung </font><b><font style="vertical-align: inherit;">abf√§llt, zeigt das Amperemeter einen Strom von 150 mA an</font></b><font style="vertical-align: inherit;"> , und es ist deutlich zu erkennen, wie die St√§rke des Stroms w√§hrend des Erhitzens der Wicklungen zu fallen beginnt. Es ist zu beachten, dass es nicht so hei√ü ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie sichergestellt haben, dass die 5-V-Spannung f√ºr den Motor nicht gef√§hrlich ist, versuchen Sie, sie in verschiedene Richtungen zu drehen. Und jetzt ein paar Worte zu den Betriebsarten des Schrittmotors. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist ziemlich gut , </font><font style="vertical-align: inherit;">sagt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden nicht wiederholen, aber denken Sie daran, dass ein Schrittmotor in drei Modi arbeiten kann:</font></font><br>
<br>
<ul>
<li>           ,   ,       . </li>
<li>          ,  ,      ,     .</li>
<li>        ,     ,      ,   (   )    . ,  ,          ( , ,   ).   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, die ersten beiden Modi auf dem L293D-Chip zu implementieren, und f√ºr den Mikroschrittmodus lassen wir einen speziellen Treiber aus dem zweiten Experiment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Quellcode des Programms lautet wie folgt:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinAVR-Quellcode</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2)); <span class="hljs-comment">//   </span><font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1); <span class="hljs-comment">//    </span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4))); <font></font>
	 <font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2))); <font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);  <font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<span class="hljs-comment">//2</span><font></font>
	<font></font>
	PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<span class="hljs-comment">//3</span><font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<span class="hljs-comment">//4</span><font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stepper_OFF</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
	<span class="hljs-comment">//    ,       ,    </span><font></font>
	<font></font>
	PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1);<font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">255</span>; <span class="hljs-comment">//    (0-255)</span><font></font>
<font></font>
    OCR0B = <span class="hljs-number">255</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
    PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	LED_ON;<font></font>
		<font></font>
        L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	LED_OFF;<font></font>
		<font></font>
	L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		  <font></font>
    } <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollschrittmodus. </font><font style="vertical-align: inherit;">Einzelphase</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/_U7lQKinBe8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Motor ben√∂tigt 16 Schritte pro Umdrehung. </font><font style="vertical-align: inherit;">Dar√ºber hinaus haben die Schritte f√ºr die beiden Phasen nicht den gleichen Winkelwert. </font><font style="vertical-align: inherit;">Ich wei√ü nicht, womit es verbunden ist. </font><font style="vertical-align: inherit;">Vielleicht ist das Design des Motors das? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns die maximale H√§ufigkeit von Schritten an, die er in diesem Modus ausf√ºhren kann, ohne sie zu verpassen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die minimale Verz√∂gerung zwischen den Schritten betr√§gt 2 ms, was 500 Schritte / Sekunde bedeutet. </font><font style="vertical-align: inherit;">Nicht schlecht, es ist 31 U / min = 1850 U / min.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollschrittmodus. </font><font style="vertical-align: inherit;">Zwei Phasen</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/AGNc-i35tkI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bitte beachten Sie, dass in diesem Fall die Schritte reibungsloser und gleich gro√ü sind (in jedem Fall mehr gleich als im vorherigen Fall). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall werden nat√ºrlich zwei Wicklungen gleichzeitig erregt und die W√§rme√ºbertragung nimmt zu. </font><font style="vertical-align: inherit;">Nach ein paar Sekunden heizt sich der Motor ziemlich stark auf, so dass ich das Experiment abgebrochen habe. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist mit der maximalen H√§ufigkeit von Schritten? </font><font style="vertical-align: inherit;">500 Schritte / Sekunde; </font><font style="vertical-align: inherit;">31 U / min = 1875 U / min. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es muss gesagt werden, dass es f√ºr einen Schrittmotor ziemlich flink ist. </font><font style="vertical-align: inherit;">Dies ist auf die geringe Anzahl von Magnetpolen am Rotor zur√ºckzuf√ºhren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir machen weiter ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versuch Nr. 2. </font><font style="vertical-align: inherit;">TMC2208 + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TMC2208 ist der Name eines Treiberchips zur Steuerung von bipolaren Schrittmotoren, ein darauf basierendes Modul, das auch f√ºr die Installation in hausgemachten (und nicht nur) 3D-Druckern hergestellt wird und ein einheitliches Pin-Layout aufweist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viel und klar √ºber dieses Modul </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gesagt </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Internet wurde viel dar√ºber geschrieben, wie man es in seinem 3D-Drucker installiert, aber wir sind daran interessiert, wie man das Modul an den Mikrocontroller anschlie√üt. Lassen Sie uns also verstehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Eigenschaften des Chips sind beeindruckend (nur beeindruckbare Personen):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versorgungsspannung des logischen Teils: 3-5V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Motorversorgungsspannung 5,5-36 V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spitzenstrom 2A;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einstellen des maximalen Motorstroms;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterst√ºtzung der UART-Schnittstelle zum Verwalten und Konfigurieren interner Register;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automatische Abschaltung;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterst√ºtzung f√ºr den Mikroschrittmodus der Motorsteuerung bis zu 1/16 Schritt.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/hy/4x/fg/hy4xfgf0clqt-j9hxilghfje85u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist sehr einfach zu verwalten, tats√§chlich ben√∂tigen Sie nur zwei Pins des Mikrocontrollers. </font><font style="vertical-align: inherit;">Einer ist mit DIR verbunden - wir geben die Drehrichtung des Motors an, der andere ist mit STEP verbunden - wenn ein Impuls angelegt wird, f√ºhrt die Mikroschaltung die erforderlichen Manipulationen mit Str√∂men und Spannungen an den Motorwicklungen durch und dauert einen Schritt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Anschlussdiagramm sieht folgenderma√üen aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p6/7m/s1/p67ms10_2wbu6fdbxjmkcz7y5f8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zus√§tzlich habe ich den EN-Pin verwendet, um den Motor auszuschalten und die Wicklungen lange Zeit nicht unter Spannung zu halten.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinAVR-Quellcode</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     TMC2208</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR PB2</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN PA6</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP PA7</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_OFF PORTA |=(1&lt;&lt;EN)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_ON PORTA &amp;=(~(1&lt;&lt;EN))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_FOR PORTB |=(1&lt;&lt;DIR)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_BACK PORTB &amp;=(~(1&lt;&lt;DIR))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_ON PORTA |=(1&lt;&lt;STP)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_OFF PORTA &amp;=(~(1&lt;&lt;STP))</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TMS2208_STEP</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay</span>)</span> {<font></font>
<font></font>
    <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//  </span><font></font>
	<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:<font></font>
			DIR_FOR;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:<font></font>
			DIR_BACK;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
	}<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//      </span><font></font>
	<font></font>
		STP_ON; <span class="hljs-comment">//   </span><font></font>
		<font></font>
		delay_microsecond(<span class="hljs-number">100</span>); <span class="hljs-comment">//   100</span><font></font>
		<font></font>
		STP_OFF;<font></font>
		<font></font>
		delay_millisecond(step_delay);<span class="hljs-comment">//   </span><font></font>
	<font></font>
	    step_quantity--;<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
<font></font>
        DDRB |=(<span class="hljs-number">1</span>&lt;&lt;DIR);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;EN);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;STP);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	   LED_ON;<font></font>
	   <font></font>
	   EN_ON;<font></font>
	<font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">10</span>); <span class="hljs-comment">// TMS2208_STEP ( ,  F/B,   )</span><font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	   <font></font>
	   LED_OFF;<font></font>
	   <font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">10</span>);<font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
}  </code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie alles starten, m√ºssen Sie das Modul vorkonfigurieren. Stellen Sie zun√§chst den gew√ºnschten Mikroschrittmodus ein. Zweitens stellen Sie den gew√ºnschten maximalen Motorstrom ein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit einem Mikroschritt ist alles einfach. Verantwortlich daf√ºr sind die Pins MS1 und MS2. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/vf/ba/mrvfbaqfm3rvb_fkop2w28ybtiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich stelle fest, dass die Mikroschaltung die Spannung nicht schrittweise √§ndert, sondern ‚Äûreibungslos‚Äú. Da die Mikroschaltung jedoch digital ist, ist der Ausgang kein glattes Signal, sondern ein Signal mit einem kleinen Schritt. Gem√§√ü der Dokumentation wird jeder Schritt in 256 Mikroschritte unterteilt. Dies wurde durchgef√ºhrt, um die Laufruhe zu erh√∂hen, das Ger√§usch des Motors zu reduzieren und theoretisch nicht zuzulassen, dass die Struktur, mit der es verschraubt ist, in Resonanz eintritt. Kurz gesagt, alles, um den 3D-Drucker leiser zu machen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Motorstrom einzustellen, muss die Spannung am Kontakt Vref gemessen werden, die in der Abbildung angegeben ist. Der Spannungswert kann mit einem Potentiometer neben dem Kontakt ge√§ndert werden. Die Spannung am Kontakt ist proportional zum Strom des Motors und die Abh√§ngigkeit hat die folgende Form: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vref = I * 1,44; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Motor ben√∂tigt ca. 150mA, da Vref = 0.216V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wir installieren ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es versteht sich, dass eine Erh√∂hung des Stroms die Mikroschaltung durch Erh√∂hen der Spannung √ºber der Wicklung liefert. Daher m√ºssen Sie sicherstellen, dass diese Spannung ausreicht. Aber ich glaube, 5 V sollten f√ºr diesen kleinen Motor ausreichen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden den Betrieb des Motors mit verschiedenen Mikroschrittmodi testen und sehen, was passiert (die Pause zwischen den Mikroschritten betr√§gt 10 ms):</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/smws8Omm5Gk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen feststellen, dass die Bewegungen des Motors ruhiger geworden sind (im Vergleich zum vorherigen Experiment), die charakteristischen 16 Schritte jedoch immer noch recht deutlich beobachtet werden. </font><font style="vertical-align: inherit;">Nun ... anscheinend ist dies ein Merkmal von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schrittmotoren mit einem Permanentmagnetrotor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist auch zu beachten, dass sich der Motor in diesem Modus fast so stark erw√§rmt wie in einem Vollschrittmodus mit zwei Phasen. </font><font style="vertical-align: inherit;">Es ist verst√§ndlich, dass die Wicklungen st√§ndig mit Strom versorgt werden und kontinuierlich W√§rme erzeugt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich glaube, dass f√ºr solche Motoren die Verwendung eines solchen Treibers und in der Tat Mikroschrittmodi nicht sehr ratsam ist.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versuch Nr. 3. </font><font style="vertical-align: inherit;">ATtiny44 Treiber</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kehren wir kurz zum ersten Experiment zur√ºck und erinnern uns, dass die Eing√§nge EN1 und EN2 des Treiberchips mit den Pins OC0A und OC0B des Mikrocontrollers verbunden sind. Dies bedeutet, dass wir dort ein mit dem TIMER0-Timer erzeugtes PWM-Signal senden und so die an die Motorwicklungen angelegte Spannung √§ndern und den durch sie flie√üenden Strom entsprechend regeln k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laut Datenblatt des ATtiny44-Mikrocontrollers betr√§gt der maximale Strom, den ein Pin liefern kann, nur 40 mA. Dar√ºber hinaus ist nicht angegeben, f√ºr welche Art von Strom (pulsierend oder konstant) diese Eigenschaft ist. Es ist einfach da und es ist so ... Ich </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
muss sagen, dass ich seit mehr als 7 Jahren mit ATMEL-Mikrocontrollern vertraut bin. Und ich hatte nie den Wunsch, diese Zeile aus dem Datenblatt zu √ºberpr√ºfen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7g/-s/b3/7g-sb3h1t3qbhccp7kyvd0knqge.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht ist der Hersteller nur sicher und kann tats√§chlich mehr abgeben, oder vielleicht ist es wirklich das Maximum, das einen Stift geben kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden es herausfinden. Aber zuerst m√ºssen Sie herausfinden, bei welchem ‚Äã‚ÄãMindeststrom sich der Motor im Allgemeinen drehen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der Schaltung aus dem ersten Experiment stellen wir den Wert des Stroms durch die Wicklungen auf 40 mA ein. Wir starten im Vollschrittmodus mit zwei Phasen (da das Drehmoment h√∂her sein wird): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ausgezeichnet! </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei 40mA startete der Motor erfolgreich!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der f√ºr den stabilen Betrieb des Motors erforderliche Mindestwert des Wicklungsstroms wurde ebenfalls ermittelt und betr√§gt 30 mA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich wird das Drehmoment viel geringer sein, aber die Tatsache, dass wir es geschafft haben, den Motor mit einem so geringen Stromverbrauch zu starten, ist f√ºr uns wichtig.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Anschlussdiagramm des Schrittmotors zum Mikrocontroller lautet wie folgt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8z/no/s8/8znos8hnrnwto939rm8yap_znpw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da jeder Pin des Mikrocontrollers als Halbbr√ºcke fungiert (er kann den Ausgang des Mikroschaltkreises entweder auf Vcc oder GND umschalten), ben√∂tigen wir zur Steuerung des bipolaren Schrittmotors 4 Pins des Mikrocontrollers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Programmcode:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinAVR-Quellcode</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//        </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">// DL - driver less</span><font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1); <font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">160</span>; <font></font>
	<font></font>
    OCR0B = <span class="hljs-number">160</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//  </span><font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
	DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
	<font></font>
	DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <span class="hljs-comment">//  </span><font></font>
<font></font>
	    LED_ON;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
            delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	    LED_OFF;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie mich ein wenig erkl√§ren, wie dieses Programm funktioniert. Dies ist ein modifizierter Code aus dem ersten Experiment. Wie oben erw√§hnt, wird ein 8-Bit-TIMER0 verwendet, um ein PWM-Signal an den Ausg√§ngen OC0A und OC0B zu erzeugen. Der Timer wird mit einem Prescaler von 8 auf den FastPWM-Modus eingestellt (die Signalfrequenz bei 8 MHz des Takts des Mikrocontrollers betr√§gt 3906 Hz). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Polarit√§t der Signale an den Wicklungen zu √§ndern, wird der Mikrocontroller-Pin von Vcc auf GND umgeschaltet, indem das entsprechende Bit im PORTx-Register ge√§ndert und das PWM-Tastverh√§ltnis durch Schreiben von Werten in die Register OCR0A und OCR0B ge√§ndert wird (die Werte wurden experimentell ausgew√§hlt). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und so:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yvaAGt1vhxs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein im ersten Jahr des Instituts absolvierter Schaltungskurs legt nahe, dass das Multimeter den Effektivwert der Spannung und des Stroms im Motor anzeigt. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Schrittmotor dreht sich ohne Treiber von den Stiften des Mikrocontrollers! </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber hier gehen wir zumindest nicht √ºber die F√§higkeiten des Mikrocontrollers hinaus, wie in der Dokumentation beschrieben. </font><font style="vertical-align: inherit;">In diesem Modus k√∂nnen der Mikrocontroller und der Motor lange arbeiten. </font><font style="vertical-align: inherit;">In der Tat dauerte das Experiment 20 Minuten. </font><font style="vertical-align: inherit;">W√§hrend dieser Zeit gab es keine Sprungschritte, kein Zur√ºcksetzen der Steuerung oder √úberhitzung (weder der Motor noch die Steuerung).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legen Sie alle Vorsichtsma√ünahmen beiseite</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir entfernen die PWM aus dem Experiment und steuern die Pins des Mikrocontrollers direkt mithilfe der PORTx-Register. </font><font style="vertical-align: inherit;">Mal sehen, was danach mit dem Mikrocontroller passiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es funktioniert ... mit einem maximalen Strom von 51 mA ... Nun ... unerwartet scheint es, dass dies der maximale Strom ist, der einen Pin des Mikrocontrollers ergeben kann? </font><font style="vertical-align: inherit;">Wenn ich falsch liege, korrigiere mich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In jedem Fall wurde das Video von YouTube nicht get√§uscht. </font><font style="vertical-align: inherit;">In der Tat k√∂nnen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie diesen Motor ohne Treiber steuern</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben uns eingehend mit bipolaren Miniatur-Schrittmotoren, ihrem Design und ihrer Steuerung f√ºr den Einsatz in unseren eigenen Anwendungen befasst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Der Miniatur-Bipolar-Schrittmotor mit einem Permanentmagnet-Rotor ist wirklich Miniatur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seine Hauptmerkmale:</font></font><br>
<br>
<ul>
<li>   ,  ,    ( , ,  16);</li>
<li>    (   ),     1875 /;</li>
<li>     (    );</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Der Miniatur-Schrittmotor kann von allen Treibern gesteuert werden, die f√ºr die Arbeit mit bipolaren Schrittmotoren geeignet sind. Sie m√ºssen nur die Wicklungsstromparameter ausw√§hlen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Die Verwendung eines speziellen TMC2208-Treibers ist ein kontroverses Thema, da der Mikroschrittmodus von der Engine selbst nicht unterst√ºtzt wird, obwohl √úberg√§nge zwischen Schritten reibungsloser ausgef√ºhrt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Es ist m√∂glich, einen Schrittmotor direkt an die Anschl√ºsse des Mikrocontrollers anzuschlie√üen. </font><font style="vertical-align: inherit;">Dies ist jedoch nur im Rahmen des Experiments m√∂glich, da das Drehmoment in diesem Fall sehr unbedeutend ist und selbst ein kleiner Strom keine Schritte mit hoher Geschwindigkeit zul√§sst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√§chstes Mal werde ich Ihnen sagen, warum wir so kleine Schrittmotoren brauchten.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de498760/index.html">Kostenlose Quarant√§ne-Schulungskurse: Business, Management, Marketing</a></li>
<li><a href="../de498762/index.html">Sind F√§lschungen dumm oder ernst?</a></li>
<li><a href="../de498766/index.html">Beste IT-Kom√∂dien. Top 3 TV-Sendungen</a></li>
<li><a href="../de498768/index.html">Verwendung eines Rauchmelders in Fahrzeugen</a></li>
<li><a href="../de498782/index.html">Kampfexperimentatoren - Sand and Stick Science - Inokulation des wissenschaftlichen Denkens in die √ñffentlichkeit</a></li>
<li><a href="../de498796/index.html">Inhaltssicherheitsrichtlinie in Magento 2</a></li>
<li><a href="../de498798/index.html">Lernen Sie weiter und lernen Sie mit JetBrains</a></li>
<li><a href="../de498800/index.html">Wie ich meinem Computer beigebracht habe, Dobble mit OpenCV und Deep Learning zu spielen</a></li>
<li><a href="../de498808/index.html">Vim mit YAML-Unterst√ºtzung f√ºr Kubernetes</a></li>
<li><a href="../de498814/index.html">Sie haben eine theoretische Frage zur sozialen Sicherheit nicht beantwortet, und sie haben Ihnen ein Ende gesetzt. Es ist in Ordnung? // Wir sind zum Scheitern verurteilt # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>