<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèº üëàüèª üë©‚Äç‚úàÔ∏è BFCache, o There and back. Informe Yandex üö¥üèæ üë®‚Äç‚ù§Ô∏è‚Äçüë® üîπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La gente usa el bot√≥n de retorno a la p√°gina anterior en el navegador muy a menudo, tal vez m√°s a menudo de lo que piensas. Y si es as√≠, ¬øpor qu√© tira...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>BFCache, o There and back. Informe Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/496360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La gente usa el bot√≥n de retorno a la p√°gina anterior en el navegador muy a menudo, tal vez m√°s a menudo de lo que piensas. </font><font style="vertical-align: inherit;">Y si es as√≠, ¬øpor qu√© tirar inmediatamente la p√°gina de la memoria del navegador y despu√©s de pasar un segundo tiempo y reabrir el tr√°fico? </font><font style="vertical-align: inherit;">Para que el usuario pueda regresar r√°pidamente, se invent√≥ la tecnolog√≠a BFCache, que es importante recordar al desarrollar interfaces. </font><font style="vertical-align: inherit;">Victor Khomyakov</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">victor-homyakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descubri√≥ el "almacenamiento en cach√© de ida y vuelta" y compil√≥ una tabla de compatibilidad BFCache con diferentes API.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vz2IsHcSaKE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Hola, me llamo Victor. </font><font style="vertical-align: inherit;">Trabajo como parte de un equipo bastante grande que se ocupa de la p√°gina de b√∫squeda.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ai/mc/ut/aimcutfjg_xnumc1xre2li547vw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como m√≠nimo, ya has visto la misma p√°gina o una similar en Google. Y en particular, me ocupo del problema de la velocidad de descarga de esta p√°gina, para que se muestre en el servidor lo m√°s r√°pido posible y se descargue y muestre a los clientes lo m√°s r√°pido posible. ¬øPor qu√© es importante? Mientras menos espere el cliente a que se cargue su p√°gina, es menos probable que no espere y lo deje. Y cuanto m√°s probable sea que el cliente se convierta con √©xito en otra cosa, mayor ser√° el puntaje neto de la promoci√≥n. Es decir, el cliente felizmente le dir√° a todos los que conocen que esta es una p√°gina genial: se carga muy r√°pido, es muy conveniente de usar. Y en √∫ltima instancia, cuanto m√°s dinero pueda ganar. O su empresa, entonces le dar√° un premio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dar√© una serie de ejemplos de compa√±√≠as conocidas. Google realiz√≥ un experimento. Intencionalmente incrustaron un retraso en la p√°gina de b√∫squeda y midieron c√≥mo esto afecta el rendimiento. Result√≥ que, en promedio, hab√≠a medio por ciento menos b√∫squedas por usuario. ¬øQu√© es medio por ciento? Calcular: medio porcentaje de cientos de millones de usuarios de Google es un n√∫mero bastante grande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bing hizo el mismo experimento. No le creyeron a Google, decidieron verificarlo dos veces. Obtuvieron resultados similares: notablemente menos ingresos por usuario cuando la p√°gina se ralentiza. ¬øPor qu√© ralentizar? Porque es m√°s f√°cil ralentizar la p√°gina por el n√∫mero exacto de milisegundos para que pueda reproducirse f√°cilmente en la producci√≥n que acelerarla en la misma cantidad.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo de AliExpress. Aceleraron su sitio en un 36% y recibieron significativamente m√°s pedidos de los usuarios. Los pedidos son dinero directo. En general, ya est√° claro para todos que la velocidad es bastante importante, afecta, a trav√©s de una cierta cantidad de m√©tricas, el dinero ganado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y un factor m√°s. Hoy ya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hemos hablado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre la optimizaci√≥n de im√°genes. Al optimizar su tr√°fico, reduciendo la cantidad de descargas, usted paga menos dinero a sus anfitriones por el tr√°fico saliente. Este es tambi√©n el dinero que permanecer√° en su bolsillo. ¬øQu√© sucede si de repente le ofrezco un 10% de descuento en el tr√°fico de cualquier host sin restricciones ni condiciones? ¬øY si propongo asegurarme de que el usuario cargue casi al instante la parte de sus p√°ginas, por ejemplo, el diez por ciento? Nadie se negar√°.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tecnolog√≠a de la que tratar√© de hablar hoy es una de las posibles soluciones que impone pocas restricciones con respecto a la pila con la que trabaja, con qu√© tecnolog√≠as, pero al mismo tiempo promete brindarle ganancias bastante significativas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, Google recopila estad√≠sticas sobre c√≥mo se utilizan estos navegadores en sus navegadores. Y publicaron tal n√∫mero: resulta, en promedio, de todas las aperturas de p√°gina, de toda la navegaci√≥n en Chrome m√≥vil, aproximadamente el 19% es un movimiento de ida y vuelta a trav√©s de la historia. Piensa lo que eso significa? Si redondeas, resulta que el 20% de la navegaci√≥n se mueve a la p√°gina donde el usuario acaba de estar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para nosotros, como para los autores de las p√°ginas, esto significa: incluso si el usuario lo abandona, existe una posibilidad considerable de que est√© a punto de regresar. Por un lado, este puede ser precisamente el problema de los tel√©fonos m√≥viles: todo es peque√±o, es f√°cil perder un dedo, hacer clic en el enlace y salir de la p√°gina, luego decir: "¬°Oh, demonios! Quiero regresar". Pero en las computadoras de escritorio, la situaci√≥n es casi la misma: all√≠ el n√∫mero es menor, pero todav√≠a hay un porcentaje significativo de retornos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© estamos haciendo en este momento? Gastamos de manera ineficaz el tiempo y el tr√°fico del usuario. Es decir, comenzamos a volver a cargar la misma p√°gina, analizarla, recrear el DOM, volver a dibujar todo en la pantalla, cargar, ejecutar JavaScript.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El navegador es una cosa bastante poderosa. √âl est√° tratando de usar cach√©s siempre que sea posible. Y la mayor√≠a de los recursos pueden estar en su cach√©. No los esperar√° de la red, sino que los recoger√° directamente del cach√©. Por ejemplo, en el motor V8, el resultado del an√°lisis de JavaScript tambi√©n se almacena en cach√©. Es decir, el navegador no volver√° a cargar y analizar JS, y en la mayor√≠a de los casos se necesitar√° ejecutarlo de inmediato. Pero a√∫n as√≠, la reconstrucci√≥n del DOM, la recarga de recursos no almacenados en cach√© y la ejecuci√≥n de JS requieren una cantidad considerable de tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La soluci√≥n se sugiere por s√≠ misma. ¬øQue estamos haciendo? Nosotros, cuando el usuario abandona nuestra p√°gina, no la limpiamos de inmediato. Simplemente guardamos su estado y lo ocultamos visualmente al usuario para que, bajo el cap√≥, permanezca a disposici√≥n del navegador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© haremos si el usuario decide regresar? </font><font style="vertical-align: inherit;">Solo mu√©strele la misma p√°gina guardada. </font><font style="vertical-align: inherit;">Se puede mostrar casi al instante. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/xm/7d/axxm7doualef_atc2j8_ufybr2i.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta tecnolog√≠a se llama cach√© hacia atr√°s / adelante, de las palabras "adelante y atr√°s". </font><font style="vertical-align: inherit;">Corto para bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay un ejemplo de c√≥mo se comporta el mismo navegador, el mismo ensamblaje cuando bfcache est√° apagado y encendido. </font><font style="vertical-align: inherit;">La apertura de la primera p√°gina es igualmente lenta tanto all√≠ como all√≠. </font><font style="vertical-align: inherit;">Pero adem√°s, cuando comenzamos a avanzar y retroceder por la historia, se nota una pausa a la izquierda y no a la derecha. </font><font style="vertical-align: inherit;">A la izquierda, el movimiento habitual a trav√©s de la historia lleva un tiempo notable. </font><font style="vertical-align: inherit;">A la derecha, todo sucede muy, muy r√°pido.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar GIF</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/lf/0n/h1/lf0nh1gnji5qf1w9kj_irqcagrm.gif" width="350"><img src="https://habrastorage.org/webt/og/ca/_n/ogca_ny6xmytv-_iqvdl4xslpcq.gif" width="350"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ejemplo similar de nuestra b√∫squeda. A la izquierda est√° el Safari habitual en macOS con bfcache deshabilitado, a la derecha est√° el mismo Safari con la configuraci√≥n predeterminada y bfcache habilitado. Este es un caso bastante com√∫n: una persona viene en busca, puede no saber exactamente lo que est√° buscando, puede pedir varias opciones de consulta. Hice la primera solicitud, algo no est√° bien. La segunda solicitud parece ser mejor. Tercero: no, peor, regrese a la solicitud anterior. Y en este momento ser√≠a muy bueno no hacerlo esperar. Acaba de ver esta solicitud anterior, mu√©strela de inmediato.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O la segunda opci√≥n, si tiene paginaci√≥n y varias p√°ginas sobre el tema. Hombre hojeando el tema. Fui a la segunda, tercera, cuarta p√°gina, mir√©, no, hay algo mal, volver√©. Y nosotros, nuevamente, podemos mostrarle las p√°ginas anteriores casi al instante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tema importante es la seguridad. Si bien la p√°gina en la que el usuario no estaba oculto, puede acceder a varias API que le permiten leer el estado del hardware de su tel√©fono o computadora. Aqu√≠ hay una breve lista de lo que se le ocurri√≥ de inmediato: geolocalizaci√≥n, cambio de la posici√≥n de su dispositivo en el espacio, acceso a la c√°mara y sonido desde el micr√≥fono.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, cuando aparece la p√°gina, es importante que no obtenga acceso a todos los eventos que ocurrieron durante el tiempo que estuvo oculta. </font><font style="vertical-align: inherit;">De lo contrario, se abrir√° un canal adicional para espiar a los usuarios. </font><font style="vertical-align: inherit;">Es importante que ella no tenga un historial de sus movimientos durante todo este tiempo y la grabaci√≥n del micr√≥fono y la c√°mara. </font><font style="vertical-align: inherit;">Los desarrolladores de navegadores tampoco deber√≠an olvidarse de esto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API y soporte de navegador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√°s cerca del tema. Supongamos que ya lo he persuadido: "S√≠, un buen tema, debemos trabajar con esto". ¬øQu√© API tenemos a nuestra disposici√≥n, con qu√© podemos trabajar si aceptamos tener en cuenta bfcache y c√≥mo los navegadores lo admiten? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øD√≥nde ya existe bfcache, d√≥nde puedo verlo? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Durante mucho tiempo se ha implementado en los navegadores Firefox, Safari (y macOS e iOS), as√≠ como en Internet Explorer 11 (!). Por lo general, rega√±amos a los desarrolladores de Microsoft, pero aqu√≠ simplemente lo intentaron. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Se implementa en el navegador UC Browser 11/12, versi√≥n para Android. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- De repente no est√° en Chrome. Y en Chromium esta caracter√≠stica est√° en desarrollo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_v/dh/yq/_vdhyq6ph84lnnb05f2ffw75ud4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, cuando hacen esto en Chromium, casi todos estos navegadores (y esta no es una lista completa) tarde o temprano obtendr√°n esta funcionalidad, de forma gratuita, sin SMS ni registro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øHay alg√∫n tipo de API? Quiero administrar bfcache, quiero activarlo y desactivarlo directamente desde JavaScript, para averiguar si hay alguna p√°gina en bfcache o no. ¬øQu√© tal una API de este tipo? No existe tal API. Y esto se hizo conscientemente: la p√°gina no deber√≠a querer activar o desactivar bfcache para todos y para s√≠ misma. O averig√ºe si hay alguien en este bfcache o no. Todo esto se debe a la seguridad. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4m/5i/ra/4m5iragmxqrikl_7i8dqp-0ijcy.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero que tenemos? Tipos de navegaci√≥n. Hay un tipo de enlace: representaci√≥n previa de enlaces, cuando queremos representar una p√°gina por adelantado. Hay un tipo especial de navegaci√≥n para √©l: esta p√°gina se abrir√° con el tipo de navegaci√≥n "prerender". Si solo abrimos la p√°gina en un navegador, habr√° "navegar". Si hacemos clic en el bot√≥n "Actualizar", ser√° "recargar". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ estamos interesados ‚Äã‚Äãen el tipo de navegaci√≥n "hacia atr√°s", esto indica claramente que el usuario avanz√≥ y retrocedi√≥ a trav√©s de la historia. Este es exactamente el tipo de navegaci√≥n con el que nuestro bfcache puede trabajar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/8o/o_/ud8oo_rhzpnyzjfdymvr11pfg4i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra API son los eventos de presentaci√≥n de p√°ginas. Ya exist√≠an en los navegadores. En consecuencia, pagehow se activa cuando su p√°gina se muestra en el navegador para el usuario, pagehide se activa cuando la p√°gina se oculta por cualquier motivo. Y se complementaron con el campo persistente. Si la p√°gina se est√° ocultando y al mismo tiempo se colocar√° en bfcache, entonces el campo persistente ser√° verdadero. Si la p√°gina se muestra al subirla desde bfcache, el campo persistente volver√° a ser verdadero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consecuencia, si el navegador no va a almacenar en cach√© la p√°gina, entonces el ocultamiento de la p√°gina persistir√° falso. Y si el navegador muestra la p√°gina durante la carga normal, o no usa bfcache, pagehow tambi√©n persistir√° falso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/kh/kh/7vkhkhw8tjkz6y10o97urigdhea.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La compatibilidad con eventos est√° disponible en casi todos los navegadores, incluso en aquellos que a√∫n no admiten bfcache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/6w/7h/om6w7hjxxswbq5uvpaiu-afe5to.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace desde la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lo mismo ocurre con el campo persistente. Ya existe en Chrome, y Chrome todav√≠a no es compatible con bfcache. Es decir, este campo siempre estar√° en √©l, pero por ahora ser√° falso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando me encontr√© con este fen√≥meno, bfcache, tuve que estudiarlo, tocar todos los lados y ver c√≥mo funciona. Inmediatamente quise ver en mi p√°gina cuando abro a qu√© es igual el valor del campo persistente en mis controladores.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/k6/qe/dxk6qegw2k1ohv-osipeghzjccw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que todo es bastante simple. Escrib√≠ un controlador y salida a console.log () lo que viene a m√≠. Pero al abrir DevTools en algunos navegadores, bfcache puede cerrarse repentinamente. Es decir, abr√≠ DevTools, voy y vengo a trav√©s de las p√°ginas, y mi persistencia siempre es falsa, la p√°gina no entra en bfcache. Bien, tengo otra herramienta poderosa: alerta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no. Los navegadores modernos al descargar una p√°gina en la p√°gina oculta, antes de descargar y descargar los controladores simplemente ignoran la alerta, simplemente no funciona all√≠. Y de nuevo, no veo lo que quiero. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/by/1b/ij/by1bijibkuzglk6vvkhbcvrmmgo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acuerdo, tengo un producto a√∫n m√°s asesino. Estoy en un bloque justo en mi propia p√°gina, que estoy explorando, simplemente agrego el texto del contenido de mi evento y, por lo tanto, registro todo. Este m√©todo funcion√≥.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/xt/o1/jwxto1ndmuldxtn4hpoa_3z6-bk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo, por favor, se puede usar. Depur√© mi c√≥digo, funciona para m√≠, puedo continuar para continuar con √©l. Por supuesto, no olvido que, despu√©s de todo, un script est√°tico externo es m√°s adecuado para no cargar el mismo c√≥digo en l√≠nea en la p√°gina, sino para usar el almacenamiento en cach√© de archivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puse este c√≥digo depurado en un script externo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x1/5m/s0/x15ms0a9q4solt69-vucvdyoqgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no, ¬°los manejadores de pie de p√°gina cayeron en Safari! Por alguna raz√≥n, no funcionan desde un script externo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien, ya tengo una versi√≥n funcional. Tuve que dejarlo as√≠.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/kq/aw/tdkqawklgz4m_mdw7d_elw7a27m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voy a enumerar brevemente lo que logr√© pisar en solo un d√≠a. Primero, DevTools puede deshabilitar el almacenamiento en cach√©. Probablemente recuerde que en DevTools en la pesta√±a Red en Chrome hay una casilla de verificaci√≥n "Desactivar cach√©". Deshabilita la memoria cach√© de la red, puede no afectar a bfcache o puede hacerlo. La analog√≠a es clara: abrimos DevTools, lo que significa que estamos desarrollando y es posible que no necesitemos almacenamiento en cach√©. Tal vez nos molesta. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4d/up/mb/4dupmbrpcewpmpngg49_fddhuf4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda caracter√≠stica es alerta. Firefox y Safari lo ignorar√°n en silencio y continuar√°n ejecutando controladores a√∫n m√°s, como si no hubiera ninguna alerta. Y solo un Chrome antiguo en la consola escribir√° un error en rojo: tiene una alerta, la bloque√©, ¬°con√≥zcalo! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez m√°s, les recuerdo que los controladores de un script externo en Safari pueden no ser llamados, esto es muy extra√±o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y una noticia m√°s importante. </font><font style="vertical-align: inherit;">Si su p√°gina est√° en cach√©, es decir, recibi√≥ un evento de ocultaci√≥n de p√°gina, y dice que persiste como verdadero, y el navegador le dice: "S√≠, lo puse en la cach√©", esto no garantiza que la p√°gina vuelva a ser posterior. desde este cach√© se genera y se muestra de nuevo al usuario. </font><font style="vertical-align: inherit;">Porque el navegador puede decidir borrar este cach√© si se queda sin memoria. </font><font style="vertical-align: inherit;">Porque el usuario puede cerrar el navegador y no navegar a ning√∫n lado. </font><font style="vertical-align: inherit;">Recuerda esto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caracter√≠sticas de implementaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenc√© a profundizar en la documentaci√≥n, a investigar c√≥mo puedo vivir con este conocimiento. Sorprendentemente, la documentaci√≥n fue. Es decir, puede desenterrar en Internet una descripci√≥n de c√≥mo funciona bfcache en los navegadores. Pero, cuanto m√°s leo, m√°s diferencias se acumulan entre los diferentes navegadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En uno, funciona as√≠, en el otro funciona. En uno, uno interfiere, el otro no interfiere. Los desarrolladores no saben c√≥mo procesar correctamente una serie de API al colocar una p√°gina en bfcache. Dicen: est√° bien, si la p√°gina usa esta API, simplemente la ignoro, nunca la guardo en la cach√© bajo ninguna circunstancia. Y esta lista es diferente en diferentes navegadores, cada uno hace lo que le conviene. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y luego comenc√© a combinar lo que aprend√≠ en una sola mesa. Tengo algo como lo siguiente:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/qm/iy/9vqmiyq_zcjwc5ln8nciv8golra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le√≠ la documentaci√≥n para los navegadores: para Firefox, Safari, la familia Chromium. Hab√≠a documentaci√≥n disponible en IE, aunque desactualizada. A los programadores no nos gusta actualizar la documentaci√≥n despu√©s de los cambios en el navegador. Cuando me di cuenta de que la informaci√≥n no estaba actualizada, comenc√© a probar mis p√°ginas peque√±as en los navegadores y a verificar qu√© API funciona y cu√°l no. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto tampoco fue suficiente: no s√© qu√© API mirar en principio, pero no ordenar todo en absoluto. Y tuve que buscar en el c√≥digo fuente de los motores del navegador, es decir, el c√≥digo result√≥ ser la fuente de conocimiento m√°s precisa y confiable. Por el momento, esta placa (frente a usted es una parte de ella, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠ hay un enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a la versi√≥n completa) es la recopilaci√≥n de conocimiento m√°s completa sobre qu√© API permiten o proh√≠ben que bfcache funcione en los navegadores.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las API que no interfieren con una marca de verificaci√≥n y un color verde, aquellas que definitivamente evitar√°n que la p√°gina entre en bfcache est√°n marcadas en rojo. </font><font style="vertical-align: inherit;">Los campos blancos son espacios que no se describen en ninguna parte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay algunos detalles interesantes de navegadores espec√≠ficos. Comenzar√© con Firefox, √©l fue el primero en hacerlo todo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/bt/fh/fhbtfhn8db-lqcxhqe8n8vm8z6u.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lo m√°s importante que aprend√≠ de las fuentes de Firefox es que cuando trabaja con bfcache puede escribir en el registro de texto en el disco todas las razones por las que no puede colocar la p√°gina en la memoria cach√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/xp/jr/ddxpjraedcefaftwi0u9cdys2tg.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E incluso logr√© descubrir c√≥mo hacerlo. Hay dos variables de entorno secretas: en una indicamos qu√© registrar, en la segunda, en qu√© archivo escribir un registro. Despu√©s de eso, lanzamos el binario, ¬°y listo! Veremos aproximadamente que en la diapositiva anterior, las l√≠neas del formulario "dicho html no se pueden almacenar en cach√© por tal raz√≥n, por una raz√≥n diferente". Podemos leerlo de inmediato, muy conveniente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/_u/3m/ci_u3mrg5k5um_zah0gtm7splmy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea experimentar una vez, puede abrir la p√°gina about: networking en Firefox. All√≠ puede ingresar los mismos campos en la secci√≥n "Diario". Podemos indicar en dos campos qu√© y d√≥nde registrar, y con los botones iniciar y detener el registro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w3/8s/zb/w38szbgmjgikrkqg-2f7tt6px0a.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva ¬ø</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cu√°ndo Firefox se niega a almacenar en cach√© la p√°gina? Si tiene solicitudes incompletas, incluidas solicitudes AJAX o solicitudes de recursos como im√°genes, entonces se negar√° a poner la p√°gina en bfcache. √âl cree que no se ha completado, no ha terminado de descargar, hay alg√∫n tipo de actividad sospechosa. Pero todo esto no se aplica al favicon. Si olvid√≥ el favicon, si no se carga, piensa: est√° bien, lo har√°, es normal para su sitio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tiene un script de larga ejecuci√≥n, el navegador le preguntar√°: ya que lleva tiempo, bloquea la interfaz de usuario, ¬øtal vez lo supera? Y si est√° de acuerdo, se considera que esa p√°gina es un poco incorrecta y no la almacenamos en cach√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si usa IndexedDB ... Esta es una historia instructiva. Anteriormente, en la primera implementaci√≥n, buscaban: si tiene IndexedDB y hay una transacci√≥n incompleta, esa p√°gina no se almacena en cach√©, porque no est√° claro c√≥mo trabajar con ella (estamos tratando de ocultarla justo en el medio de la transacci√≥n). Pero luego simplemente perdieron este fragmento de c√≥digo durante la refactorizaci√≥n. Y como te puedes imaginar, no ten√≠an pruebas para esto. Incluso tienen un error en el rastreador de errores. √âl ya tiene dos a√±os con algo. La gente escribi√≥: "Mi bfcache con IndexedDB no funciona correctamente, ¬øqu√© debo hacer?" Los desarrolladores de Firefox respondieron: realmente se descompone, acabamos de perder este fragmento de texto durante la refactorizaci√≥n, est√° bien, d√©jenlo continuar. Moraleja: escribe pruebas, incluso si escribes Firefox, de lo contrario todo puede terminar tristemente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y otro factor interesante de no disponibilidad en bfcache, si se permite expl√≠citamente contenido mixto. ¬øLo que es? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/2s/le/fm2sleys4nir1cuff_lw8q87cqi.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace desde la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Suponga que su p√°gina se abre a trav√©s de HTTPS, pero a√∫n carga algunos recursos a trav√©s de HTTP, especialmente scripts. Es decir, tiene un script que no es de seguridad, puede ser modificado por cualquier persona. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/k8/kj/tsk8kj6weynueewx9goi38sm81o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace desde la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De manera predeterminada, Firefox, como otros navegadores, no ejecuta una secuencia de comandos que no sea de seguridad ahora. Pero si es muy importante para usted, subi√≥ a la configuraci√≥n y permiti√≥ que se ejecute, por lo tanto, no almacenar√° en cach√© dicha p√°gina. √âl dir√°, bueno, ¬°me dijiste que no ejecutara el c√≥digo, pero luego no, no!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/fg/_f/pmfg_fqywdhl7tihvcy09agmaxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro ajuste es el tama√±o de bfcache en s√≠. Aqu√≠, el valor predeterminado es menos uno. Eso significa cu√°nta memoria tiene Firefox, tantas p√°ginas que intenta almacenar en cach√©. Pero podemos deshabilitar por la fuerza el cach√© al poner un cero, o establecer expl√≠citamente un n√∫mero; por ejemplo, recuerde no m√°s de cinco p√°ginas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia: la siguiente diapositiva contiene c√≥digo de muestra en el lenguaje aterrador de C ++, esto puede ser peligroso en una conferencia front-end. No intente copiarlo, ejec√∫telo en la consola del navegador. Su disco puede estar formateado, la pantalla puede explotar o se pueden extraer bitcoins. Te lo adverti. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/l-/uo/31l-uokshfiuo6dyxcivmfzsm5o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, el c√≥digo Gecko. </font><font style="vertical-align: inherit;">Se puede abrir, leer, ver de forma gratuita en Internet. </font><font style="vertical-align: inherit;">Y rebusqu√©. </font><font style="vertical-align: inherit;">Existe el m√©todo m√°s importante: CanSavePresentation (), responde a la pregunta: ¬øes posible almacenar en cach√© este documento? </font><font style="vertical-align: inherit;">Es decir, esta es la √∫ltima fuente de verdad sobre lo que ahora se implementa en Firefox. </font><font style="vertical-align: inherit;">Y sin embargo, fue a partir de ah√≠ que aprend√≠ que puedes leer el registro. </font><font style="vertical-align: inherit;">Existe tal variable: gPageCacheLog. </font><font style="vertical-align: inherit;">Este es el registro en el que todo est√° escrito. </font><font style="vertical-align: inherit;">Aqu√≠ hay una historia tan interesante sobre una excursi√≥n a C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, abre el enlace, mira el c√≥digo, busca (hay una b√∫squeda conveniente y, adem√°s, r√°pida) y puede encontrar los detalles de implementaci√≥n reales en la √∫ltima versi√≥n del navegador, aquellos que simplemente faltan en la documentaci√≥n.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo m√°s cruel que hace Safari cuando una p√°gina llega a bfcache: si tiene solicitudes AJAX pendientes, Safari simplemente las mata. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/bh/8p/vpbh8ppqy9qpfbpljjsu2huhtda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso si los superpuso con controladores de errores e intenta verificar todo, corr√≠jalo; parece que la solicitud no exist√≠a en absoluto. Despu√©s de recuperarse de bfcache, no tendr√° ning√∫n error, ning√∫n "OK", nada en absoluto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/jx/yk/icjxykful4yo0d7hbjopj_woljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los controladores de pagehow ocultan p√°ginas, como dije, en Safari solo se llaman si est√°n escritos en un script que est√° en l√≠nea en la p√°gina. Desde un script externo, pueden o no funcionar, qu√© suerte. Pero te lo advert√≠.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0i/o7/ns/0io7nsvts4isj0qbirjisggubeg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra diferencia interesante: los controladores antes de descargar y descargar no interfieren con el ingreso de la p√°gina a bfcache. En este caso, siempre se llama a beforeunload, y cuando entra en el cach√©, y cuando no se golpea. Pero descargar cuando la p√°gina llega al cach√© no se llama. Y aqu√≠ hay otro rastrillo ubicado: la p√°gina puede ir al cach√© y nunca aparecer de ella, y si escribi√≥ alg√∫n c√≥digo importante en la descarga, nunca se puede llamar, aunque no se produjo un solo error en la p√°gina. Es decir, fue correctamente al cach√©, y de all√≠ a ninguna parte, y nunca se llamar√° a su descarga.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6e/m2/xy/6em2xyin9409en33_y-xk3ewxtg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro punto interesante. Como sabes, puedes abrir varias ventanas a trav√©s de window.open (). Y al mismo tiempo, estas ventanas tienen enlaces entre s√≠. Es decir, pueden subir simult√°neamente a la ventana del otro, leer / escribir diferentes propiedades. Esta apertura de ventanas secundarias no interfiere con bfcache. Y aqu√≠, lo m√°s probable, Safari es tan cruel como lo es con las solicitudes de AJAX, es decir, todo se est√° rompiendo y adi√≥s. A los desarrolladores de Apple les encanta m√°s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De nuevo un minuto C ++! Las fuentes de WebKit tampoco son secretas, tambi√©n se pueden abrir, leer y estudiar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a4/p5/cs/a4p5cs2yfjtvgxb_3iud8b-xog4.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace desde la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Est√°n en GitHub, all√≠ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
destaqu√© </font><font style="vertical-align: inherit;">dos funciones importantes: </font><font style="vertical-align: inherit;">- canCacheFrame () - verifica si este marco se puede almacenar en cach√©.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- En diferentes objetos de la p√°gina, como un elemento HTML o una fuente, existen m√©todos canSuspendForDocumentSuspension (). Este objeto es responsable de si puede almacenar en cach√©, congelar o no. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y un aspecto m√°s importante: WebKit tiene pruebas muy convenientes. All√≠, justo en la carpeta LayoutTests / fast / history, en forma de html peque√±o, compacto y conciso, hay pruebas para el trabajo de diferentes API que se implementan en Safari con bfcache. Este es un ejemplo vivo de c√≥mo puede escribir c√≥digo en Safari con estas API y c√≥mo afectan o no afectan si permiten o no los golpes de bfcache. Muy interesante de ver.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/r-/un/hxr-un8ehvr-zc5dqa_kgr4ieki.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir de ah√≠, aprend√≠ que Safari tambi√©n escribe todo su conocimiento sobre bfcache, todas las funciones, en un registro de texto. </font><font style="vertical-align: inherit;">Pero, desafortunadamente, nunca descubr√≠ c√≥mo habilitar este registro o, si est√° habilitado, d√≥nde encontrar este archivo en el disco. </font><font style="vertical-align: inherit;">Si alguien lo sabe, d√≠game, le estar√© muy agradecido.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cromo.</font></font></h3><br>
<img src="https://habrastorage.org/webt/8z/yv/b5/8zyvb5feibkmt6njztlfuxgipas.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya dije, todav√≠a hay trabajo en progreso, todo est√° cerrado bajo la bandera. Puede descargar el nuevo canario de Chrome, vaya a las banderas. La configuraci√≥n est√° oculta all√≠; puedes intentar jugar con ella. Puede que veas algo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/fr/lw/nufrlwudx02dcxcxuwq0n-fk57e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lo interesante: ya habl√© sobre abrir una p√°gina a trav√©s de window.open (). En Chromium, tales p√°ginas no est√°n en cach√© hasta ahora. No descubrieron c√≥mo resolver todo esto correctamente y lo cortaron descaradamente, como en Safari, su conciencia no se lo permite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si DOMContentLoaded no se produce, la p√°gina tampoco se almacenar√° en cach√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchas API nuevas que comienzan con "Web"; tambi√©n es dif√≠cil e incomprensible con ellas, y hasta ahora todas ellas desactivan bfcache de forma predeterminada. Es decir, si se usa algo moderno, nuevo en la p√°gina, como WebGL, WebVR, WebUSB, WebBluetooth, etc., dicha p√°gina no entrar√° en bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajador del servicio. Adem√°s, todav√≠a no almacenamos en cach√© dicha p√°gina, pero planeamos procesarla correctamente, ocultarla de los ojos vigilantes del Trabajador de servicio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la geolocalizaci√≥n est√° habilitada, todav√≠a no la almacenamos en cach√©. Tan simple por ahora. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si durante el tiempo que la p√°gina estaba en el cach√©, las cookies estaban podridas, creemos que ha expirado alg√∫n tipo de autorizaci√≥n. Quiz√°s fue la banca en l√≠nea o alguna otra cosa. Esto significa que la p√°gina ya no es v√°lida; la borramos del cach√©. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ae/et/dj/aeetdjeogvqqqmflxx5rtdbtz1o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los chicos de Google fueron a√∫n m√°s lejos. </font><font style="vertical-align: inherit;">Propusieron unificar todo formalizar, unificar en todos los navegadores, propusieron una especificaci√≥n del ciclo de vida de la p√°gina para todos los estados, propusieron agregar nuevos eventos a las transiciones entre diferentes estados. </font><font style="vertical-align: inherit;">Puedes mirar el enlace que pensaron all√≠. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/nn/tw/blnntwl767kxalazcyls6lhx98c.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace de la diapositiva</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fuentes. </font><font style="vertical-align: inherit;">Como saben, las fuentes de cromo tambi√©n est√°n disponibles. </font><font style="vertical-align: inherit;">Todo esto se encuentra en una clase llamada BackForwardCacheImpl: muy buena denominaci√≥n, casi no ten√≠a que buscar. </font><font style="vertical-align: inherit;">El m√©todo principal que verifica si se puede guardar un documento se llama CanStoreDocument (). </font><font style="vertical-align: inherit;">Tambi√©n hay un m√©todo GetDisallowedFeatures (), que simplemente enumera todas las nuevas funciones y API que no son compatibles con bfcache. </font><font style="vertical-align: inherit;">Muy conveniente: concentrado en un solo lugar, ley√≥ y se dio cuenta de lo que actualmente es posible y lo que no se puede usar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer 11</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una excursi√≥n a la historia para quienes a√∫n tienen IE 11. Para quienes tienen todo mal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/st/sy/hwstsylp95mjeehn-yapop5nwqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay bfcache all√≠, y este es el problema principal, porque tienes que lidiar con eso. </font><font style="vertical-align: inherit;">La documentaci√≥n dice que bfcache supuestamente solo funciona a trav√©s de HTTP. </font><font style="vertical-align: inherit;">De hecho, en producci√≥n, tambi√©n funciona en HTTPS por alguna raz√≥n. </font><font style="vertical-align: inherit;">Moraleja: si es desarrollador, preste atenci√≥n a su documentaci√≥n. </font><font style="vertical-align: inherit;">Entonces tienes que sufrir por ella. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hay un controlador anterior a la descarga, evitar√° que ingrese al cach√©. </font><font style="vertical-align: inherit;">No dijeron nada sobre la descarga en la documentaci√≥n, tal vez no lo supieron ni lo olvidaron. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la p√°gina no ha terminado de cargarse, tampoco se almacena en cach√©. </font><font style="vertical-align: inherit;">Si alguien usa componentes ActiveX, tampoco almacenamos en cach√©. </font><font style="vertical-align: inherit;">Y si DevTools tambi√©n est√° abierto all√≠. </font><font style="vertical-align: inherit;">√âste es un punto importante.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/lh/n5/8olhn5ii0fctbxehrs7ab4blwro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo sin errores? Se agreg√≥ un campo persistente, pero a veces no funciona. Es decir, la p√°gina realmente ingresa al cach√©, regresa de ella y persiste no se establece en verdadero. ¬øQu√© hacer? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ten√≠amos un c√≥digo hermoso que determina si volvimos del cach√© o volvimos a cargarlo desde el servidor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/h1/xb/oph1xbddsxbkhzjlygiyoavtmam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora ten√≠a que ser complementado con una muleta para IE. Determinamos que tenemos IE y, en algunas soluciones, entendemos que la p√°gina todav√≠a se extrajo de la memoria cach√© y, al mismo tiempo, ten√≠amos un historial de navegaci√≥n (hacia atr√°s). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/xe/af/ctxeafrbbmwt1h_9j16jw4fviji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, ¬øc√≥mo saber si una p√°gina est√° en cach√©? Tomamos su tiempo de carga. Si se carg√≥ desde el servidor en 50 milisegundos o m√°s r√°pido, esto b√°sicamente no puede estar en IE, ¬°significa que es del cach√©! :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j-/ib/ch/j-ibchnxog-rdmeez6gmjnbmwr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya mencion√© la navegaci√≥n a trav√©s de la historia. </font><font style="vertical-align: inherit;">Si tenemos el tipo de navegaci√≥n back_forward, revisamos el historial, y si la p√°gina es del cach√©, significa bfcache, no hay otras opciones en IE.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQue sigue?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© hacer a continuaci√≥n con este conocimiento? </font><font style="vertical-align: inherit;">No quisiera que salgas y olvides todo esto como una pesadilla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- En primer lugar, aqu√≠ est√° lo m√°s valioso que encontr√© y a lo que quiero empujarlo: ¬°use navegadores de c√≥digo abierto! </font><font style="vertical-align: inherit;">En el acceso abierto a Internet en este momento se encuentra el c√≥digo fuente de todos los principales navegadores que utilizan nuestros clientes. </font><font style="vertical-align: inherit;">Y esta es la documentaci√≥n m√°s relevante sobre c√≥mo y c√≥mo se admite, d√≥nde y c√≥mo funciona. </font><font style="vertical-align: inherit;">Incluyendo hay pruebas que se escriben directamente en HTML y JS. </font><font style="vertical-align: inherit;">Uso, mira!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- En segundo lugar, considere en las aplicaciones existentes que pueden ejecutarse en bfcache. </font><font style="vertical-align: inherit;">Informe a sus evaluadores sobre esto para que cuando verifiquen la navegaci√≥n, sepan que al navegar por el historial, la p√°gina se puede abrir tanto desde el servidor como desde bfcache. </font><font style="vertical-align: inherit;">Aqu√≠ hay un video del error real que corregimos cuando bfcache funcion√≥ para nosotros:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIF abierto</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/vx/1j/dv/vx1jdv4ubukownlagrvftn30g6k.gif" width="400"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El usuario ingresa cuatro solicitudes, ve cuatro problemas. </font><font style="vertical-align: inherit;">Despu√©s de eso, vuelve, ve el problema 3 y la consulta 4. Otro problema anterior es el 2 y la consulta 3. Es decir, tiene un estado no coincidente de la p√°gina: el contenido de las cadenas de b√∫squeda y b√∫squeda se contradice entre s√≠. </font><font style="vertical-align: inherit;">Tenga esto en cuenta en sus aplicaciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Y en tercer lugar, si est√° escribiendo un nuevo c√≥digo, piense si necesita bfcache. </font><font style="vertical-align: inherit;">Si es as√≠, use la tabla de compatibilidad API. </font><font style="vertical-align: inherit;">Si no, no lo use, pero si accidentalmente entra en bfcache, considere las caracter√≠sticas de Safari y otros navegadores que mencion√©. </font><font style="vertical-align: inherit;">Algunas cosas pueden romperse insolentemente y no podr√°s entender por qu√© sucede esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n lo prometido, un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a los materiales.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es496348/index.html">Estudios de casos de API de almacenamiento web</a></li>
<li><a href="../es496350/index.html">¬°No pasar√°s! - Las impresoras 3D responden al coronavirus</a></li>
<li><a href="../es496354/index.html">Programaci√≥n ternaria: juega con el emulador</a></li>
<li><a href="../es496356/index.html">Crear un navegador utilizando tecnolog√≠as de realidad aumentada y m√©todos de aprendizaje autom√°tico</a></li>
<li><a href="../es496358/index.html">Prepar√°ndose para celebrar el D√≠a de la Cosmon√°utica en l√≠nea (la lista se est√° actualizando)</a></li>
<li><a href="../es496362/index.html">Restablecimiento de m√°scaras</a></li>
<li><a href="../es496366/index.html">Miniserie: computadora ternaria de bricolaje</a></li>
<li><a href="../es496368/index.html">La startup australiana desarrolla PC h√≠brida a partir de componentes electr√≥nicos y biol√≥gicos</a></li>
<li><a href="../es496370/index.html">Alegr√≠as y tristezas de las victorias sobre C: hacemos dulces del prototipo wc en Haskell</a></li>
<li><a href="../es496372/index.html">C√≥mo crear una vista personalizada para alert (), confirm () y prompt () para usar en JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>