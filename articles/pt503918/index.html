<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😮 👩🏾‍🚀 ☢️ Gerenciando pacotes com módulos Go: um guia pragmático 👩‍🎓 ◽️ 😷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá a todos. Antecipando o início do curso Golang Developer, preparamos outra tradução interessante para você.
 
 
 Os módulos são uma maneira de lida...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Gerenciando pacotes com módulos Go: um guia pragmático</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/503918/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olá a todos. </font><font style="vertical-align: inherit;">Antecipando o início do curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Golang Developer,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> preparamos outra tradução interessante para você.</font></font></b></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os módulos são uma maneira de lidar com dependências no Go. Inicialmente apresentados como um experimento, os módulos devem ser introduzidos no campo como um novo padrão para gerenciar pacotes da versão 1.13. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acho esse tópico incomum o suficiente para iniciantes vindos de outros idiomas e, por isso, decidi coletar algumas idéias e dicas aqui para ajudar outras pessoas como eu a ter uma idéia do gerenciamento de pacotes no Go. Começaremos com uma introdução geral e passaremos para os aspectos menos óbvios, incluindo o uso da pasta vendor, o uso de módulos com o Docker no desenvolvimento, as dependências de ferramentas etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você já conhece os módulos Go e conhece o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, como as costas da sua mão, este artigo provavelmente não será muito útil para você. </font><font style="vertical-align: inherit;">Porém, quanto ao resto, ele pode economizar várias horas de tentativa e erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, se você estiver a caminho, entre e aproveite o passeio.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/tr/d9/eq/trd9eqcuki5uwi4w5b2gexcp8q4.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Começo rápido</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o controle de versão já estiver integrado ao seu projeto, você pode simplesmente executar</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod init</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou especifique o caminho para o módulo manualmente. </font><font style="vertical-align: inherit;">É algo como um nome, URL e caminho de importação para o seu pacote:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod init github.com/you/hello</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso criará um arquivo </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que também define os requisitos e o lochit do projeto, dependendo da versão correta (como uma analogia para você, como é </font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e </font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combinada em um único arquivo):</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Execute </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para adicionar uma nova dependência ao seu projeto: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que, embora você não possa especificar um intervalo de versões com go get, o que você define aqui não é uma versão específica, mas uma versão mínima. </font><font style="vertical-align: inherit;">Como veremos mais adiante, existe uma maneira de atualizar as dependências normalmente de acordo com sempre.</font></font></i><br>
<br>
<pre><code class="go hljs"># use Git tags
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@v4<span class="hljs-number">.0</span><span class="hljs-number">.1</span><font></font>
# or Git branch name<font></font>
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@master<font></font>
# or Git commit hash<font></font>
<span class="hljs-keyword">go</span> get github.com/<span class="hljs-keyword">go</span>-chi/chi@<span class="hljs-number">08</span>c92af</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, nosso arquivo é </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o seguinte:</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span>
require github.com/<span class="hljs-keyword">go</span>-chi/chi v4<span class="hljs-number">.0</span><span class="hljs-number">.2</span>+incompatible <span class="hljs-comment">// indirect</span></code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O sufixo é </font></font><code>+incompatible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adicionado a todos os pacotes que ainda não estão configurados para os módulos Go ou violam suas regras de controle de versão. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como não importamos este pacote em nenhum lugar do nosso projeto, ele foi marcado como </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Podemos arrumar isso com o seguinte comando:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod tidy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependendo do estado atual do seu repositório, ele excluirá um módulo não utilizado ou excluirá um comentário </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se alguma dependência por si só não tiver </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(por exemplo, ainda não estiver configurada para módulos), todas as dependências serão gravadas no arquivo pai </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(como opção, seu arquivo </font></font><code>go.mod)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juntamente com um comentário </font></font><code>// indirect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para indicar que não são de importação direta Em seu</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
plano global, o objetivo </font></font><code>go mod tidy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">também é adicionar as dependências necessárias para outras combinações de SO, arquiteturas e tags de compilação. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute-o antes de cada versão.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Certifique-se de criar um arquivo após adicionar a dependência</font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Você pode pensar que este é um arquivo de bloqueio. </font><font style="vertical-align: inherit;">Mas, na verdade, ele </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">já fornece informações suficientes para compilações 100% reproduzíveis. </font><font style="vertical-align: inherit;">O arquivo </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é criado para fins de verificação: contém as somas de verificação criptográficas esperadas do conteúdo de versões individuais do módulo. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em parte porque não é </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um arquivo de bloqueio, ele salva as somas de verificação escritas para a versão do módulo, mesmo depois que você para de usá-lo. </font><font style="vertical-align: inherit;">Isso permite que você verifique as somas de verificação se continuar usando-o posteriormente, o que fornece segurança adicional.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/_5/j8/vi/_5j8vigrklvhkwaucssmy7zaf88.png"><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Mkcert acabou de migrar para os módulos (com fornecedor / para compatibilidade com versões anteriores) e tudo correu bem </font></font></i> <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/FiloSottile/mkcert/commit/26ac5f35395fb9cba3805faf1a5a04d260271291</font></font></a><br>
<br>
<pre><code class="go hljs">$ GO111MODULE=on go1<span class="hljs-number">.11</span>rc1 mod init<font></font>
$ GO111MODULE=on go1<span class="hljs-number">.11</span>rc1 mod vendor<font></font>
$ git add <span class="hljs-keyword">go</span>.mod <span class="hljs-keyword">go</span>.sum vendor<font></font>
$ git rm Gopkg.lock Gopkg.toml Makefile</code></pre><br>
<img src="https://habrastorage.org/webt/kt/ch/ro/ktchrocah4xszqqrfkqtug3qzty.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FAQ: Devo cometer </font></font><code>go.sum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no git? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A: Definitivamente sim. </font><font style="vertical-align: inherit;">Com isso, os proprietários de suas fontes não precisam confiar em outros repositórios do GitHub e proprietários de caminhos de importação personalizados. </font><font style="vertical-align: inherit;">Já a caminho de nós, algo melhor, mas por enquanto esse é o mesmo modelo dos hashes nos arquivos de bloqueio.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os comandos </font></font><code>go build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>go test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carregarão automaticamente todas as dependências ausentes, embora você possa fazer isso explicitamente com a ajuda de </font></font><code>go mod download</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preencher previamente os caches locais que podem ser úteis para o IC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por padrão, todos os nossos pacotes de todos os projetos são carregados para o diretório </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Discutiremos isso com mais detalhes posteriormente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualizando versões do pacote</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode usar </font></font><code>go get -u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tanto </font></font><code>go get -u=patch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para atualizar dependências para a última versão menor ou remendo, respectivamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas você não pode atualizar para versões principais como essa. </font><font style="vertical-align: inherit;">O código incluído nos módulos Go deve cumprir tecnicamente as seguintes regras:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine semver (tag de exemplo VCS v1.2.3).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o módulo for da versão v2 ou superior, a versão principal do módulo deverá ser incluída </font></font><code>/vN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no final do caminho do módulo usado no arquivo </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e no caminho de importação do pacote:</font></font></li>
</ul><br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/you/hello/v2"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aparentemente, isso é feito para que diferentes versões dos pacotes possam ser importadas em um assembly (consulte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o problema de dependência de diamante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em poucas palavras, o Go espera que você seja muito cuidadoso ao apresentar as principais versões.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Substituindo Módulos Importados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode especificar o módulo necessário para sua própria bifurcação ou até o caminho local para o arquivo usando a diretiva </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod edit -replace github.com/<span class="hljs-keyword">go</span>-chi/chi=./packages/chi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resultado:</font></font><br>
<br>
<pre><code class="go hljs">module github.com/you/hello
<span class="hljs-keyword">go</span> <span class="hljs-number">1.12</span>
require github.com/<span class="hljs-keyword">go</span>-chi/chi v4<span class="hljs-number">.0</span><span class="hljs-number">.2</span>+incompatible<font></font>
replace github.com/<span class="hljs-keyword">go</span>-chi/chi =&gt; ./packages/chi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode excluir a linha manualmente ou executar:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod edit -dropreplace github.com/<span class="hljs-keyword">go</span>-chi/chi</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerenciamento de Dependências do Projeto </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Historicamente, todo o código Go foi armazenado em um repositório mono gigante, porque é assim que o Google organiza sua base de códigos e isso afeta o design da linguagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os módulos Go são um desvio dessa abordagem. Você não precisa mais manter todos os seus projetos </font></font><code>$GOPATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, tecnicamente todas as suas dependências baixadas ainda são inseridas </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se você usar contêineres do Docker para desenvolvimento local, isso pode ser um problema, pois as dependências são armazenadas fora do projeto. Por padrão, eles simplesmente não são visíveis no seu IDE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ye/2c/_o/ye2c_o9jcsodsrhdekb4djz7lve.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso geralmente não é um problema para outros idiomas, mas foi o que encontrei pela primeira vez ao trabalhar com a base de código Go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, existem várias maneiras (não documentadas) de resolver esse problema.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opção 1. Instale o GOPATH dentro do diretório do projeto.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À primeira vista, isso pode parecer contra-intuitivo, mas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se você executar o Go a partir de um contêiner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , poderá substituir o GOPATH para que aponte para o diretório do projeto para que os pacotes fiquem acessíveis a partir do host:</font></font><br>
<br>
<pre><code class="go hljs">version: <span class="hljs-string">'3.7'</span><font></font>
<font></font>
services:<font></font>
  app:<font></font>
    command: tail -f /dev/null<font></font>
    image: golang:<span class="hljs-number">1.12</span><span class="hljs-number">.6</span>-stretch<font></font>
    environment:<font></font>
      #        - /code/.<span class="hljs-keyword">go</span>/pkg/mod<font></font>
      - GOPATH=/code/.<span class="hljs-keyword">go</span><font></font>
    ports:<font></font>
      - <span class="hljs-number">8000</span>:<span class="hljs-number">8000</span><font></font>
    volumes:<font></font>
      - ./:/code:cached<font></font>
    working_dir: /code</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os IDEs populares devem poder instalar o GOPATH no nível do projeto (espaço de trabalho): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_t/jz/d_/_tjzd_trva2fekp6vmt5ewc_xke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A única desvantagem dessa abordagem é a falta de interação com o tempo de execução do Go no computador host. </font><font style="vertical-align: inherit;">Você deve executar todos os comandos Go dentro do contêiner.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opção 2: vendendo suas dependências</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra maneira é copiar as dependências do seu projeto para uma pasta </font></font><code>vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod vendor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se observar imediatamente: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NÃO permitimos que o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Go faça o upload direto de materiais para a pasta do fornecedor: isso não é possível com os módulos. </font><font style="vertical-align: inherit;">Simplesmente copiamos pacotes já baixados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, se você desatar as suas dependências, como no exemplo acima, limpe </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e tente adicionar várias novas dependências ao seu projeto, você verá o seguinte:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Go reconstruirá o cache de download de todos os pacotes de software </font></font><code>$GOPATH/pkg/mod/cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os módulos carregados serão copiados para </font></font><code>$GOPATH/pkg/mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, finalmente, o Go copiará esses módulos para uma </font></font><code>vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasta, excluindo exemplos, testes e alguns outros arquivos dos quais você não depende diretamente.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, faltam muitas coisas nessa pasta de fornecedor recém-criada: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/w-/lt/rjw-ltm1y1s8jwia34bfars6ngw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um arquivo típico do Docker Compose se parece com isso (observe as ligações do volume):</font></font><br>
<br>
<pre><code class="go hljs">version: <span class="hljs-string">'3.7'</span><font></font>
<font></font>
services:<font></font>
  app:<font></font>
    command: tail -f /dev/null<font></font>
    image: golang:<span class="hljs-number">1.12</span><span class="hljs-number">.6</span>-stretch<font></font>
    ports:<font></font>
      - <span class="hljs-number">8000</span>:<span class="hljs-number">8000</span><font></font>
    volumes:<font></font>
     #    <span class="hljs-keyword">go</span>,           <font></font>
      - modules:/<span class="hljs-keyword">go</span>/pkg/mod/cache<font></font>
      - ./:/code:cached<font></font>
    working_dir: /code <font></font>
<font></font>
volumes:<font></font>
  modules:<font></font>
    driver: local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por favor, note que eu NÃO coloque essa pasta de fornecedores em quadrinhos no sistema de controle de versão ou não a usarei na produção. </font><font style="vertical-align: inherit;">Este é um script de desenvolvimento estritamente local, que geralmente pode ser encontrado em outros idiomas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, quando leio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comentários de alguns mantenedores do Go</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e algumas ofertas relacionadas a vendas parciais (?), Tenho a impressão de que esse recurso foi originalmente destinado não a esse caso de usuário. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comentaristas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do reddit me ajudou a esclarecer isso:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geralmente, as pessoas vendem suas dependências por motivos como o desejo de ter assemblies restritos sem acesso à rede, além da disponibilidade de uma cópia de dependências prontas no caso de uma falha ou repositório do github desaparecer, e a capacidade de auditar com mais facilidade as alterações de dependência usando as ferramentas VCS padrão, etc. .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sim, ele não se parece com nada do fato de que eu poderia estar interessado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com o comando Ir, você pode facilmente ativar a venda, definindo uma variável de ambiente </font></font><code>GOFLAGS=-mod=vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Eu não recomendo fazer isso. O uso de sinalizadores simplesmente será interrompido </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem fornecer outros benefícios ao seu fluxo de trabalho diário: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/ul/uw/dfuluwbr13eacullfzphguhrbeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, o único local necessário para ativar a venda é o seu IDE:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jv/x2/pz/jvx2pzgtrx5wcfmlum4s5hheorw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após algumas tentativas e erros, criei o procedimento a seguir para adicionar dependências de fornecedores nessa abordagem.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 1. Requisito</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode exigir uma dependência com </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> get github.com/rs/zerolog@v1<span class="hljs-number">.14</span><span class="hljs-number">.3</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 2. Importar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, importe-o em algum lugar do seu código:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> (<font></font>
   _ <span class="hljs-string">"github.com/rs/zerolog"</span>
)</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 3. Venda</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, reabra suas dependências:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> mod vendor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proposta pendente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para permitir que o fornecedor de mod go aceite determinados modelos de módulo que podem (ou não) resolver alguns dos problemas associados a esse fluxo de trabalho. </font></font><br>
<br>
<code>go mod vendor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">já requer importações perdidas automaticamente, portanto, a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etapa 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é opcional neste fluxo de trabalho (se você não desejar especificar restrições de versão). No entanto, sem a etapa 2, ele não receberá o pacote baixado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa abordagem funciona melhor com o sistema host, mas é bastante confusa quando se trata de editar suas dependências.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pessoalmente, acho que redefinir o GOPATH é uma abordagem mais limpa, pois não sacrifica a funcionalidade </font></font><code>go get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No entanto, eu queria mostrar as duas estratégias, porque a pasta do fornecedor pode ser mais familiar para pessoas provenientes de outros idiomas, como PHP, Ruby, Javascript, etc. Como você pode ver na fraude descrita neste artigo, esta não é uma escolha particularmente boa para o Go.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependências da ferramenta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez seja necessário instalar algumas ferramentas baseadas em Go que não são importadas, mas usadas como parte do ambiente de desenvolvimento do projeto. </font><font style="vertical-align: inherit;">Um exemplo simples dessa ferramenta é o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CompileDaemon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que pode monitorar seu código em busca de alterações e reiniciar seu aplicativo. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> abordagem </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">oficialmente recomendada</font></a><font style="vertical-align: inherit;"> é adicionar um </font></font><code>tools.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo (o nome não importa) com o seguinte conteúdo:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// +build tools</span>
<span class="hljs-keyword">package</span> tools
<span class="hljs-keyword">import</span> (<font></font>
_ <span class="hljs-string">"github.com/githubnemo/CompileDaemon"</span>
)</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A limitação </font></font><code>// +build tools</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impede que seus assemblies regulares realmente importem sua ferramenta.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A expressão import permite que os comandos go gravem com precisão as informações da versão de suas ferramentas no arquivo do </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">módulo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então é só isso. </font><font style="vertical-align: inherit;">Espero que você não fique tão confuso quanto eu quando comecei a usar os módulos Go. </font><font style="vertical-align: inherit;">Você pode visitar o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki Go Modules</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obter mais detalhes.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entre no curso.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503904/index.html">O mundo en mundos, ou matemática para as humanidades</a></li>
<li><a href="../pt503906/index.html">LabVIEW NXG - Tipos de dados simples e coerção de tipos</a></li>
<li><a href="../pt503908/index.html">Ligue para bibliotecas compartilhadas do Similink</a></li>
<li><a href="../pt503910/index.html">Experiências com pessoas que foram para "udalenka"</a></li>
<li><a href="../pt503916/index.html">Aprendendo a negociar na bolsa. Parte um: configurando um ambiente de teste</a></li>
<li><a href="../pt503920/index.html">Como testamos os sistemas de microfone no STM32: a experiência dos desenvolvedores de dispositivos Yandex</a></li>
<li><a href="../pt503922/index.html">Por que a UE erradica paredes de biscoitos</a></li>
<li><a href="../pt503924/index.html">Visão geral do scanner 3D intraoral Medit i500</a></li>
<li><a href="../pt503926/index.html">Quem é quem no ecossistema de pagamentos 2020. Parte 2</a></li>
<li><a href="../pt503928/index.html">Irrigação por aerossol VS: qual é melhor e há alguma diferença?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>