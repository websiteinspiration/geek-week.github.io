<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🔬 👩🏾‍🎤 📽️ 暗号トークンPKCS＃11。「タイムスタンプに署名して追加する機能を備えた」グラフィックユーティリティ。パート1 🍫 🤳🏿 🤚🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事「スクリプト言語でのPKCS＃11暗号トークンメカニズムの使用」のコメントで、読者は コフセルグ 書いた：
 「文書に署名し、タイムスタンプを追加する機能を備えた記事を楽しみにしています。」 以前にも、Habrの別のメンバー pas 「誰もが自分自身を数えることができる」PKCS＃11トークン（...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>暗号トークンPKCS＃11。「タイムスタンプに署名して追加する機能を備えた」グラフィックユーティリティ。パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453164/"><img src="https://habrastorage.org/webt/xh/tq/ph/xhtqphqpspdmceylr6o1duj5vpu.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事「スクリプト言語でのPKCS＃11暗号トークンメカニズムの使用」のコメントで、読者は </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コフセルグ</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書いた</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「文書に署名し、タイムスタンプを追加する機能を備えた記事を楽しみにしています。」 </font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前にも、Habrの別のメンバー </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「誰もが自分自身を数えることができる」PKCS＃11トークン（主にキーを生成し、電子キーを生成およびチェックするための暗号化操作を意味します）に最適であると</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">書き</font></a><font style="vertical-align: inherit;">、中間層のすべての種類を取り除き、トークン自体のメカニズムを使用して、証明書要求を生成し、ドキュメントに署名し、ドキュメントの署名を検証し、署名と証明書の有効性を検証します。</font></font><br>
<a name="habracut"></a><br>
<h3><font color="1368c2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティとの知り合い</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、ユーザーの法廷にユーティリティを提示します </font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guipkcs7_tclpkcs11 / cryptoarmpkcs：</font></font></b>
                        <div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Linux32</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Linux64</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">OS X</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">WIN32</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">WIN64</a></li>
</ul><br>
</div>
                    </div><br>
<img src="https://habrastorage.org/webt/et/my/sq/etmysqfvbidordcaocyqfjqqeem.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このユーティリティの原動力は、</font><font style="vertical-align: inherit;">少なくともGOST R 34.10-2012のロシア語暗号をサポート</font><font style="vertical-align: inherit;">する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKCS＃11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暗号</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">トークン</font></a><font style="vertical-align: inherit;">です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共サービス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等</font><font style="vertical-align: inherit;">を利用する</font><font style="vertical-align: inherit;">場合でも、ロシアのFSBの認証制度で認定試験に合格したトークンを購入する必要があります。これが内部の電子ドキュメント管理である場合、これはもちろん、あなたの裁量に任されています。 PKCS＃11トークンは異なる場合があります。ソフトウェア、ハードウェア、または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラウド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。ユーティリティはスクリプト言語</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Tcl / Tkで</font></a><font style="vertical-align: inherit;">書かれています</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 PKCS＃11トークンを購入するときは、さまざまなプラットフォーム用に購入したトークンのライブラリをダウンロードできる場所を入手するか質問することを忘れないでください。ライブラリは一般に無料で入手できます。ユーティリティは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TclPKCS11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージを使用して、暗号化</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">機能</font></a><font style="vertical-align: inherit;">やその他のトークン</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">機能</font></a><font style="vertical-align: inherit;">にアクセスし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。ユーティリティは、トークンをサポートするライブラリを選択することから始まります。ライブラリライブラリは複数のトークンで同時に動作する可能性があることに注意してください（コンボボックス「トークン/スマートカードを選択」）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/1j/zc/hr1jzcxcrdug57at8an0in9ahik.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題が発生する可能性がありますが、トークンが初期化されていない場合やPINコードなどを変更する必要がある場合はどうすればよいですか？答えは簡単です</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。p11conf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トークン設定ユーティリティを使用して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トークンのリストを更新するには（トークンが無効になり、新しいトークンが追加されます）、</font><font style="vertical-align: inherit;">コンボボックス[トークン/スマートカードを選択して</font><font style="vertical-align: inherit;">ください] </font><font style="vertical-align: inherit;">の右側</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
にあるアイコンを</font><font style="vertical-align: inherit;">クリック</font><font style="vertical-align: inherit;">します</font></font><img src="https://habrastorage.org/webt/wj/dj/xy/wjdjxy2orhsi7op3stcjzpogisa.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。「</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンボ」証明書には、選択した（現在の）トークンに保存されているすべての証明書のラベルがあり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ws/ew/bx/wsewbxr_8nksvtk9j-ckfs_ixwe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。 [ </font></font><img src="https://habrastorage.org/webt/ko/sk/sc/koskscpianfsm5kgw_1peg91t6u.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書]コンボボックスの右側</font><font style="vertical-align: inherit;">にあるアイコン</font><font style="vertical-align: inherit;">に、証明書の内容を含むウィンドウが表示さ</font></font><br>
<br>
<img src="https://habrastorage.org/webt/he/f3/ky/hef3kynxtfbmgy6jetmjxp3zhg8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
れます。表示ウィンドウの[保存/保存]ボタンをクリックすると、解析された証明書の内容が指定したファイルにテキスト形式で保存されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のトークンに関する情報を表示するには、[6。トークン情報]ボタンをクリックするか、カーソルをトークンラベルに移動します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cb/hn/5y/cbhn5yy0qyyremnetuakmcreoia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のトークンがサポートする暗号化メカニズムを見つけるには、「5。メカニズムのリスト」ボタンをクリックするだけです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0z/d2/d_/0zd2d_rk1jpetlsa883wthvye0e.png"><br>
<br>
<h3><font color="1368c2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書リクエストを作成する</font></font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティの主な機能に移ります。</font><font style="vertical-align: inherit;">そして、最初のそのような機能は、証明書要求を作成することです（ボタン「3.証明書要求」）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/ef/lf/z9eflfzgcrus2an8mc86t9djsv8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
選択したトークンがこのタイプのキーの生成をサポートしていない場合、メッセージ「トークンはキーをサポートしていません...」が表示されます。</font><font style="vertical-align: inherit;">この場合、別のタイプのキーまたは別のトークンを選択する必要があります。</font><font style="vertical-align: inherit;">この例では、RuToken ECP 2.0トークンを使用できます（2番目のスクリーンショットを参照）。</font><font style="vertical-align: inherit;">コンボボックス「Certificate Holder」を使用すると、個人、法人、個人の起業家など、誰が証明書を所有するかを指定できます。</font><font style="vertical-align: inherit;">これに応じて、記入するフィールドが次のページに形成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで重要なフィールドは「名前CIPF」フィールドです。これは、適格な証明書の不可欠な部分であり、暗号化情報保護手段が鍵ペアを生成する方法を示します。暗号情報保護証明書の名称は、商品フォームまたはトークンの購入時に確認できます。トークン情報のタイプフィールドは暗号情報保護システムの名前と一致していますか？そのため、フォームを見た方がよいでしょう。 [次へ]ボタンを押して必要なフィールドに</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/vi/rx/gjvirxly5zr2gy1d22h-ifdzoei.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
入力し</font><font style="vertical-align: inherit;">ます。入力</font><font style="vertical-align: inherit;">時に、ユーティリティは適切な警告を発行して、フィールド（電子メール、OGRNなど）の入力の正確さを制御しようとします。メインフィールドに入力した後、コンピューター上の証明書要求の形式と保存場所を決定するよう求められます。トークンのPINコードも入力する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/xm/bm/kgxmbm_2xtski-x5fhh4jzkyeys.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[次へ]ボタンをクリックした後、入力内容をもう一度確認し、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kk/yv/gr/kkyvgr2ayqktgluvfms_ooxhn5w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[完了] </font><font style="vertical-align: inherit;">キーを押して決定を確認するよう求められ</font><font style="vertical-align: inherit;">ます。[完了]ボタンをクリックすると、トークンにキーペアが生成され、作成され、リクエストは署名</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/hj/nr/uohjnrhhbt6ih9qbsbdxzu3wqg0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
されています</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">キーが生成されてトークンに保存されていることを確認することは可能ですか？はい。 「7.トークンオブジェクト」ボタンを押し、PINコードを入力してトークンにアクセスし、SKO_PRIVATE_KEYオブジェクトとCKO_PUBLIV_KEYオブジェクトを探します。これらのラベルは、証明書リクエストの作成時に入力した「COMMON NANE」（CN）フィールドと一致します。私たちの例では、それは「全能のハーバー」でした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/rp/jm/vvrpjmoqxpgjfolr_mzino1uwhc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見て、すぐに別のページに移動します。</font><font style="vertical-align: inherit;">鍵ペアが正常に作成されたことを示す最良の証拠は、署名されたリクエスト自体の存在です。</font><font style="vertical-align: inherit;">これを確認するには、「リクエスト/証明書の表示」ボタンをクリックし、保存されたリクエストを選択し、「証明書リクエストの表示」ボタンをクリックして、キーペア情報</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/xq/o7/hnxqo7b6iqsoa0mcqwxwtjfg5da.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を確認します。リクエストが正常に作成されたことを確認したら、秘密キーでトークンを安全に非表示にしますまたは、私たちはそれを私たちの心に近づけ（古い世代の人々はパーティーやコムソモールのチケットを保存する方法を知っています）、フラッシュドライブのリクエストをコピーし、必要なドキュメント（パスポートなど）を取り、CAに移動して証明書を取得します。</font><font style="vertical-align: inherit;">はい、これが部門のCAでない場合でも、お金を支払う必要があります。</font><font style="vertical-align: inherit;">すべてが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パスポートの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よう</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAで証明書を取りに行く</font></font></b>
                        <div class="spoiler_text">       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>     .     :<br>
<br>
<img src="https://habrastorage.org/webt/nj/za/wt/njzawtbm3ze91qnj2widi-if4wg.png"><br>
<br>
        ,         :<br>
<br>
<img src="https://habrastorage.org/webt/so/pr/zq/soprzqefs9b5w0_5phvien6amog.png"><br>
<br>
             :<br>
<br>
<img src="https://habrastorage.org/webt/tw/kx/ex/twkxex2i3htjet9bkxm1kdoiuya.png"><br>
<br>
        :<br>
<br>
<img src="https://habrastorage.org/webt/hb/ox/1c/hbox1clfovnx8ghzsvne5fvsmys.png"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書が発行された後、CAの従業員は発行された証明書をHon。Habrのフラッシュドライブにエクスポートします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/71/3r/zi/713rzi-nn3sd1v0ockcyfpwphie.png"><br>
<br>
<h3><font color="1368c2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トークン証明書を入れます</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、証明書の幸運な所有者は彼の母国に戻り、まず最初にトークンの証明書を鍵ペアの隣に置くことを決定します。</font><font style="vertical-align: inherit;">これを行うには、ユーティリティのメインウィンドウで、「4.ビュー要求/証明書」ボタンをクリックし、証明書を使用してファイル操作「の表示証明書」を選択して操作を実行するボタンをクリックして「：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/uh/1n/vpuh1n5xtmcgzri4vf1im1wfq64.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我々はまた、証明書の有効性を確認することができます（ただし、我々はそれを撤回する時間がなかったです）か、適切な操作を選択することによる彼の署名の正確さ：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4x/en/yf/4xenyfg6oq0uem5e24pskrf8qgk.png"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書署名検証ユーティリティコード</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">#!/usr/bin/env tclsh<font></font>
package require pki<font></font>
load ./tclpkcs11.so Tclpkcs11<font></font>
#     PKCS#11<font></font>
#set pkcs11_module "/usr/local/lib64/librtpkcs11ecp_2.0.so"<font></font>
set pkcs11_module "/usr/local/lib64/libls11sw2016.so"<font></font>
puts "Connect the Token and press Enter"<font></font>
gets stdin yes<font></font>
set handle [pki::pkcs11::loadmodule $pkcs11_module]<font></font>
set slots [pki::pkcs11::listslots $handle]<font></font>
set i 0<font></font>
foreach slotinfo $slots {<font></font>
	set slotid [lindex $slotinfo 0]<font></font>
	set slotlabel [lindex $slotinfo 1]<font></font>
	set slotflags [lindex $slotinfo 2]<font></font>
	if {[lsearch -exact $slotflags TOKEN_PRESENT] != -1} {<font></font>
		set token_slotlabel $slotlabel<font></font>
		set token_slotid $slotid<font></font>
#   <font></font>
		incr i<font></font>
		break<font></font>
	}<font></font>
}<font></font>
if {$i == 0} {<font></font>
    puts "   . ."<font></font>
    exit<font></font>
}<font></font>
# PEM  DER<font></font>
proc ::cert_to_der {data} {<font></font>
    if {[string first "-----BEGIN CERTIFICATE-----" $data] != -1} {<font></font>
	set data [string map {"\r\n" "\n"} $data]<font></font>
    }<font></font>
    array set parsed_cert [::pki::_parse_pem $data "-----BEGIN CERTIFICATE-----" "-----END CERTIFICATE-----"]<font></font>
    if {[string range $parsed_cert(data) 0 0 ] == "0" } {<font></font>
#   DER- "0" == 0x30 <font></font>
	set asnblock $parsed_cert(data)<font></font>
    } else {<font></font>
	set asnblock ""<font></font>
    }<font></font>
    return $asnblock<font></font>
}<font></font>
proc usage {use error} {<font></font>
    puts "Copyright(C) Orlov Vladimir (http://museum.lissi-crypto.ru/) 2019"<font></font>
    if {$use == 1} {<font></font>
	puts $error<font></font>
	puts "Usage:\nverify_cert_with_pkcs11 &lt;file with certificate&gt; \[&lt;file with CA certificate&gt;\]\n"<font></font>
    }<font></font>
}<font></font>
set countcert [llength $argv]<font></font>
if { $countcert &lt; 1 ||  $countcert &gt; 2 } {<font></font>
    usage 1 "Bad usage!"<font></font>
    exit<font></font>
}<font></font>
set file [lindex $argv 0]<font></font>
if {![file exists $file]} {<font></font>
    usage 1 "File $file not exist"<font></font>
    exit<font></font>
}<font></font>
#  cert_user<font></font>
puts "Loading user certificate: $file"<font></font>
set fd [open $file]<font></font>
chan configure $fd -translation binary<font></font>
set cert_user [read $fd]<font></font>
close $fd<font></font>
if {$cert_user == "" } {<font></font>
    usage 1 "Bad file with certificate user: $file"<font></font>
    exit<font></font>
}<font></font>
set cert_user [cert_to_der $cert_user]<font></font>
if {$cert_user == ""} {<font></font>
    puts "User certificate bad"<font></font>
    exit<font></font>
}<font></font>
catch {array set cert_parse [::pki::x509::parse_cert $cert_user]}<font></font>
if {![info exists cert_parse]} {<font></font>
    puts "User certificate bad"<font></font>
    exit<font></font>
}<font></font>
#parray cert_parse<font></font>
if {$countcert == 1} {<font></font>
    if {$cert_parse(issuer) != $cert_parse(subject)} {<font></font>
	puts "Bad usage: not self signed certificate"<font></font>
    } else {<font></font>
	set cert_CA $cert_user<font></font>
    }<font></font>
} else {<font></font>
    set fileca [lindex $argv 1]<font></font>
    if {![file exists $fileca]} {<font></font>
	usage 1 "File $fileca not exist"<font></font>
	exit<font></font>
    }<font></font>
    #  cert_CA<font></font>
    puts "Loading CA certificate: $fileca"<font></font>
    set fd [open $fileca]<font></font>
    chan configure $fd -translation binary<font></font>
    set cert_CA [read $fd]<font></font>
    close $fd<font></font>
    if {$cert_CA == "" } {<font></font>
	usage 1 "Bad file with certificate CA=$fileca"<font></font>
	exit<font></font>
    }<font></font>
    set cert_CA [cert_to_der $cert_CA]<font></font>
    if {$cert_CA == ""} {<font></font>
	puts "CA certificate bad"<font></font>
	exit<font></font>
    }<font></font>
}<font></font>
foreach slotinfo $slots {<font></font>
	set slotid [lindex $slotinfo 0]<font></font>
	set slotlabel [lindex $slotinfo 1]<font></font>
	set slotflags [lindex $slotinfo 2]<font></font>
	if {[lsearch -exact $slotflags TOKEN_PRESENT] != -1} {<font></font>
		set token_slotlabel $slotlabel<font></font>
		set token_slotid $slotid<font></font>
	}<font></font>
}<font></font>
#   <font></font>
catch {array set cert_parse_CA [::pki::x509::parse_cert $cert_CA]}<font></font>
if {![info exists cert_parse_CA]} {<font></font>
    puts "CA certificate bad"<font></font>
    exit<font></font>
}<font></font>
# <font></font>
if {$cert_parse(issuer) != $cert_parse_CA(subject)} {<font></font>
    puts "Bad issuer"<font></font>
    exit<font></font>
}<font></font>
set aa [dict create pkcs11_handle $handle pkcs11_slotid $token_slotid]<font></font>
set tbs_cert [binary format H* $cert_parse(cert)]<font></font>
catch {set signature_algo_number [::pki::_oid_name_to_number $cert_parse(signature_algo)]}<font></font>
if {![info exists signature_algo_number]} {<font></font>
    set signature_algo_number $cert_parse(signature_algo)<font></font>
}<font></font>
switch -- $signature_algo_number {<font></font>
    "1.2.643.2.2.3" - "1 2 643 2 2 3" { <font></font>
#    "GOST R 34.10-2001 with GOST R 34.11-94"<font></font>
	set digest_algo "gostr3411"<font></font>
    }<font></font>
    "1.2.643.7.1.1.3.2" - "1 2 643 7 1 1 3 2" {<font></font>
#     "GOST R 34.10-2012-256 with GOSTR 34.11-2012-256"<font></font>
	set digest_algo "stribog256"<font></font>
    }<font></font>
    "1.2.643.7.1.1.3.3" - "1 2 643 7 1 1 3 3" { <font></font>
#    "GOST R 34.10-2012-512 with GOSTR 34.11-2012-512"<font></font>
	set digest_algo "stribog512"<font></font>
    }<font></font>
    default {<font></font>
	puts "  :$signature_algo_number"<font></font>
	exit<font></font>
    }<font></font>
}<font></font>
#   tbs-!!!!<font></font>
set digest_hex    [pki::pkcs11::digest $digest_algo $tbs_cert  $aa]<font></font>
# asn-  <font></font>
#   <font></font>
binary scan $cert_CA H* cert_CA_hex<font></font>
array set infopk [pki::pkcs11::pubkeyinfo $cert_CA_hex  [list pkcs11_handle $handle pkcs11_slotid $token_slotid]] <font></font>
set lpk [dict create pkcs11_handle $handle pkcs11_slotid $token_slotid]<font></font>
# pybkeyinfo    <font></font>
lappend lpk "pubkeyinfo"<font></font>
lappend lpk $infopk(pubkeyinfo)<font></font>
array set lpkar $lpk<font></font>
puts "Enter PIN user for you token \"$token_slotlabel\":"<font></font>
gets stdin password<font></font>
if { [pki::pkcs11::login $handle $token_slotid $password] == 0 } {<font></font>
    puts "Bad PIN"<font></font>
    exit<font></font>
}<font></font>
if {[catch {set verify [pki::pkcs11::verify $digest_hex $cert_parse(signature) $lpk]} res] } {<font></font>
    puts "  =$res"<font></font>
    exit<font></font>
}<font></font>
if {$verify != 1} {<font></font>
    puts "BAD SIGNATURE=$verify"<font></font>
} else {<font></font>
    puts "SIGNATURE OK=$verify"<font></font>
}</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし今、私たちはトークンに受け取った証明書をインポートする操作に興味があります。 「トークン用の証明書のインポート」操作を選択し、「操作の実行」ボタンをクリックします。ユーティリティは証明書の電子署名を検証します。これを行うには、トークンのPINコードを入力する必要があります。そして、すべてがうまくいけば、証明書はトークンにインポートされます。証明書の</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vn/o5/q0/vno5q0k5jrvwic9p_4uzqfpjyte.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラベル（ニックネーム）は、証明書のリストに表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ov/ja/kk/ovjakktrr_aco5_y75htmflyp68.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、個人の証明書であり、鍵ペアがある証明書です。トークン上のオブジェクトのリストをもう一度見ると、ラベル「UT 12_512の全能のハブ」と同じCKA_IDを持つ3つのオブジェクトが見つかります。これら</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3つのオブジェクト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書自体（CKO_CERTIFICATE）、公開（CKO_PUBLIC_KEY）および秘密（CKO_PRIVATE_KEY）キーです。</font><font style="vertical-align: inherit;">この3つのオブジェクトのラベルは次のように設定されます：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;CNパブリッシャー証明書&gt;からの&lt;CN所有者証明書&gt;。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に、ラベルを変更する方法を示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トークンに証明書を配置したので、それにアクセスする方法は？</font><font style="vertical-align: inherit;">トークンにある証明書を操作する機能にアクセスするには、カーソルを「証明書」ラベルに移動し、マウスの右ボタンを押します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/he/cb/kdhecbhcpq7frlxxaa2lw77nhv4.png"><br>
<br>
<h3><font color="1368c2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の文書に電子署名を付ける</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の記事を待ちましょう。</font><font style="vertical-align: inherit;">数日待たなければならない。</font><font style="vertical-align: inherit;">他に何が考慮されるかは、スクリーンショットから理解できます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q-/bq/sp/q-bqspoaaal056weiylzz4wchek.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに続く</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja453148/index.html">AirBnbはそのアカウントを無視します</a></li>
<li><a href="../ja453154/index.html">インターネットの歴史：双方向性の強化</a></li>
<li><a href="../ja453156/index.html">ゼネラルモーターズはそのすべての新しい車に魂を与えるでしょう（デジタルシェル）</a></li>
<li><a href="../ja453158/index.html">プロセッサの仕組みがわからなかったので、ソフトウェアシミュレータを作成しました</a></li>
<li><a href="../ja453162/index.html">骨董品：ThinkPad 380E、Economy 90s、Windows 95</a></li>
<li><a href="../ja453166/index.html">ViewPagerをiOSスタイルのアニメーションでフラグメントマネージャーに変える</a></li>
<li><a href="../ja453168/index.html">研究：ゲーム理論を使用したブロッキングプロキシサービスの作成</a></li>
<li><a href="../ja453170/index.html">ブレーンストーミング：タスクを別の角度から見る方法</a></li>
<li><a href="../ja453174/index.html">新しいYandex.Kassi APIに切り替える8つの理由</a></li>
<li><a href="../ja453178/index.html">コードを改善する開発者の主なスキル</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>