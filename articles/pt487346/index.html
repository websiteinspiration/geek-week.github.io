<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ∑ üòò üë®üèº Casos para usar ferramentas de an√°lise de anomalias de rede: detec√ß√£o de vazamentos ‚ô†Ô∏è ‚úñÔ∏è üèØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em um dos eventos, houve uma discuss√£o interessante sobre a utilidade das solu√ß√µes da classe NTA (Network Traffic Analysis), que, usando a infraestrut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Casos para usar ferramentas de an√°lise de anomalias de rede: detec√ß√£o de vazamentos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cisco/blog/487346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em um dos eventos, houve uma discuss√£o interessante sobre a utilidade das solu√ß√µes da classe NTA (Network Traffic Analysis), que, usando a infraestrutura de rede de telemetria Netflow (ou outros protocolos de fluxo), possibilita detectar uma ampla variedade de ataques. Meus oponentes argumentaram que, ao analisar os cabe√ßalhos e informa√ß√µes relacionadas (e o NTA n√£o analisa o corpo dos dados do pacote, diferentemente dos sistemas cl√°ssicos de detec√ß√£o de ataques, IDS), voc√™ n√£o pode ver muita coisa. Neste artigo, tentarei refutar essa opini√£o e tornar a conversa mais substantiva; darei alguns exemplos reais quando o NTA realmente ajudar a identificar v√°rias anomalias e amea√ßas que est√£o faltando no per√≠metro ou mesmo al√©m do per√≠metro. E come√ßarei com a amea√ßa que veio em primeiro lugar na classifica√ß√£o de amea√ßas do ano passado e, acho, continuar√° sendo este ano.Ser√° sobre vazamentos de informa√ß√µes e a capacidade de detect√°-los via telemetria de rede.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o considerarei a situa√ß√£o com as m√£os tortas dos administradores que deixaram a Internet parecendo desprotegidos Elastic ou MongoDB. Vamos falar sobre as a√ß√µes direcionadas dos atacantes, como foi o caso da aclamada hist√≥ria das ag√™ncias de cr√©dito Equifax. Deixe-me lembr√°-lo de que, nesse caso, os invasores primeiro penetraram na vulnerabilidade n√£o corrigida no portal da Web p√∫blico e depois nos servidores de banco de dados internos. Permanecendo despercebido por v√°rios meses, eles conseguiram roubar dados de 146 milh√µes de clientes de ag√™ncias de cr√©dito. Esse incidente poderia ser identificado usando solu√ß√µes DLP? Provavelmente n√£o, pois os DLPs cl√°ssicos n√£o s√£o adaptados √† tarefa de monitorar o tr√°fego de bancos de dados usando protocolos espec√≠ficos, e mesmo sob a condi√ß√£o de que esse tr√°fego seja criptografado.Mas a solu√ß√£o da classe NTA pode facilmente detectar esses vazamentos excedendo um certo valor limite da quantidade de informa√ß√µes baixadas do banco de dados. A seguir, mostrarei como tudo isso √© configurado e descoberto usando a solu√ß√£o Cisco Stealthwatch Enterprise.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a primeira coisa que precisamos fazer √© entender onde nossos servidores de banco de dados est√£o localizados na rede, determinar seus endere√ßos e agrup√°-los. No Cisco Stealthwatch, a tarefa de invent√°rio pode ser executada manualmente ou usando um classificador especial que analisa o tr√°fego e, de acordo com os protocolos usados ‚Äã‚Äãe o comportamento do n√≥, permite atribu√≠-lo a uma ou outra categoria. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/n5/uy/rin5uykkickqn7znft9qa0ulllu.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de termos informa√ß√µes sobre todos os servidores de banco de dados, iniciamos uma investiga√ß√£o para descobrir se estamos vazando grandes quantidades de dados do grupo de n√≥s desejado. Vemos que, no nosso caso, os bancos de dados se comunicam mais ativamente com servidores DHCP e controladores de dom√≠nio.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lb/xq/1z/lbxq1znvwtgzs01n4quxfwtgjli.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os invasores geralmente estabelecem controle sobre qualquer um dos n√≥s da rede e o usam como ponte para desenvolver seu ataque. No n√≠vel do tr√°fego de rede, parece uma anomalia - a varredura em rede desse n√≥ est√° se tornando mais frequente, os dados est√£o sendo capturados a partir do compartilhamento de arquivos ou da intera√ß√£o com qualquer servidor. Portanto, nossa pr√≥xima tarefa √© entender com quem exatamente nossos bancos de dados costumam se comunicar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wb/er/0b/wber0bo8wqxtkswej7n7vmoffc8.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No grupo de servidores DHCP, verifica-se que este √© um n√≥ com o endere√ßo 10.201.0.15, intera√ß√£o com a qual responde por cerca de 50% de todo o tr√°fego dos servidores de banco de dados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/yb/vb/yzybvbnmgicokharg8oxu57lxwm.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥xima pergunta l√≥gica que nos colocamos como parte da investiga√ß√£o √©: ‚ÄúE como √© esse n√≥ como 10.201.0.15? Com quem ele est√° interagindo? Com que frequ√™ncia? Quais protocolos? ‚Äù</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mt/-s/ac/mt-sacge5hjgo2jwerw7omqwmlk.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que o n√≥ de interesse para n√≥s se comunica com v√°rios segmentos e n√≥s da nossa rede (o que n√£o √© surpreendente, pois √© um servidor DHCP), mas a quest√£o causa muita intera√ß√£o com o servidor de terminal com o endere√ßo 10.201.0.23. Isso √© normal? Existe claramente algum tipo de anomalia. Um servidor DHCP n√£o pode se comunicar t√£o ativamente com um servidor de terminal - fluxos de 5610 e 23,5 GB de dados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4i/mk/jm/4imkjmqkv1eumztrmdyb88etx3c.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E essa intera√ß√£o √© realizada atrav√©s do NFS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/2a/wo/vl2awoxjk2kijyg494rvz8bqsr4.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damos o pr√≥ximo passo e tentamos entender com quem nosso servidor de terminal interage? Acontece que ele tem uma comunica√ß√£o bastante ativa com o mundo exterior - com n√≥s nos EUA, Gr√£-Bretanha, Canad√°, Dinamarca, Emirados √Årabes Unidos, Catar, Su√≠√ßa, etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uw/yr/3s/uwyr3shmwntm1clarsxud2xfcgq.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A suspeita foi causada pelo fato da intera√ß√£o P2P com Porto Rico, respons√°vel por 90% de todo o tr√°fego. Al√©m disso, nosso servidor de terminal transmitiu mais de 17 GB de dados para Porto Rico atrav√©s da 53¬™ porta, que est√° conectada ao protocolo DNS. Voc√™ pode imaginar que voc√™ tem esse volume de dados transmitidos via DNS? E lembro que, de acordo com a pesquisa da Cisco, 92% dos malwares usam DNS para ocultar sua atividade (baixar atualiza√ß√µes, receber comandos, descarregar dados). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/mm/5b/f1mm5b4rmsqx5butgpw-mlsmk0e.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se o protocolo DNS da ITU n√£o √© apenas aberto, mas n√£o inspecionado, temos um enorme buraco em nosso per√≠metro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/_4/dj/yt_4djyxlui4rzkyvsko1zsejlu.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que o n√≥ 10.201.0.23 nos causou tais suspeitas, vamos ver com quem ele ainda est√° falando?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/ya/7r/zhya7r8umwppjkxvidzpmpca9zy.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosso "suspeito" troca metade de todo o tr√°fego com o n√≥ 10.201.3.18, que √© colocado em um grupo de esta√ß√µes de trabalho de funcion√°rios do departamento de vendas e marketing. Qu√£o t√≠picas s√£o para a nossa organiza√ß√£o o servidor de terminal "se comunicar" com o computador do vendedor ou comerciante?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/vq/nf/puvqnfekb1fdkqjenprrlsesxpi.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por isso, realizamos uma investiga√ß√£o e descobrimos a seguinte imagem. Os dados do servidor de banco de dados foram "derramados" em um servidor DHCP com sua subsequente transfer√™ncia via NFS para um servidor de terminal dentro da nossa rede e, em seguida, para endere√ßos externos em Porto Rico usando o protocolo DNS. Esta √© uma viola√ß√£o clara das pol√≠ticas de seguran√ßa. Ao mesmo tempo, o servidor de terminal tamb√©m interagiu com uma das esta√ß√µes de trabalho na rede. O que causou esse incidente? Uma conta roubada? Dispositivo infectado? N√≥s n√£o sabemos. Isso exigir√° a continua√ß√£o da investiga√ß√£o, baseada na solu√ß√£o da classe NTA, que permite analisar anomalias de tr√°fego na rede.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ge/wt/vo/gewtvo6-5k-41fdkkxaozhlep7q.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora estamos interessados ‚Äã‚Äãno que faremos com as viola√ß√µes identificadas da pol√≠tica de seguran√ßa? Voc√™ pode realizar an√°lises regulares de acordo com o esquema acima, ou pode configurar a pol√≠tica NTA para que ela imediatamente sinalize quando viola√ß√µes semelhantes s√£o detectadas. Isso √© feito atrav√©s do menu geral correspondente ou para cada conex√£o detectada durante a investiga√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/rp/qa/ccrpqaqizyxou5zjqqfw36hsl4i.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a apar√™ncia da regra de detec√ß√£o de intera√ß√£o, cuja origem √© o servidor de banco de dados e o destino s√£o quaisquer n√≥s externos e internos, exceto servidores Web.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/xy/ah/huxyah2skmz8jpc7d3dhtxtl3xe.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se um evento desse tipo for detectado, o sistema de an√°lise de tr√°fego de rede gera imediatamente um sinal de alarme de correspond√™ncia e, dependendo das configura√ß√µes, o envia para o SIEM, usando os meios de comunica√ß√£o com o administrador, ou pode at√© bloquear automaticamente a viola√ß√£o detectada (o Cisco Stealthwatch faz isso interagindo com o Cisco ISE ) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/ii/rn/ljiirng2huuf6qzjxg-kiagufcu.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de que, quando mencionei o caso com o Equifax, mencionei que os atacantes usavam um canal criptografado para despejar dados. Para o DLP, esse tr√°fego se torna uma tarefa insol√∫vel, mas para as solu√ß√µes da classe NTA, elas n√£o o fazem - elas rastreiam qualquer tr√°fego em excesso ou intera√ß√£o n√£o autorizada entre os n√≥s, independentemente da criptografia.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u2/qg/qg/u2qgqgkkrsk_etuu7nav-k9hndg.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apenas um caso foi mostrado acima (nos seguintes materiais, consideraremos outros exemplos de uso do NTA para fins de seguran√ßa da informa√ß√£o), mas, de fato, as solu√ß√µes modernas da classe Network Traffic Analysis permitem criar regras muito flex√≠veis e levar em conta n√£o apenas os par√¢metros b√°sicos do cabe√ßalho do pacote IP: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/15/ya/uk/15yaukzbimtm-o-yf41wnibz2ik.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mas tamb√©m fa√ßa uma an√°lise mais profunda, at√© associar o incidente ao nome de usu√°rio do Active Directory, procurando arquivos maliciosos por hash (por exemplo, obtido como um indicador de comprometimento da SOSOPKA, FinCERT, Cisco Threat Grid, etc.), etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/oe/55/dcoe55wr_luv_kvpjjrqwapc5jc.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â f√°cil de implementar. Por exemplo, √© assim que a regra usual procura detectar todos os tipos de intera√ß√£o entre servidores de banco de dados e n√≥s externos usando qualquer protocolo nos √∫ltimos 30 dias. Vemos que nossos bancos de dados "se comunicaram" com n√≥s externos ao segmento DBMS usando os protocolos DNS, SMB e porta 8088. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/70/nh/hn70nhlbp10lmjmgbkjj_8_bs8i.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do formul√°rio tabular para apresenta√ß√£o dos resultados de investiga√ß√µes ou pesquisas, tamb√©m podemos visualiz√°-los. Para o nosso cen√°rio, um fragmento do diagrama de fluxo da rede pode se parecer com o seguinte: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zs/yv/jf/zsyvjfgvrptgxwgv0eefnyz5pju.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, a partir do mesmo mapa, podemos gerenciar pol√≠ticas - bloquear conex√µes ou automatizar o processo de cria√ß√£o de regras de monitoramento para os fluxos de interesse para n√≥s.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/tj/rk/ixtjrkszqelbtsgpwdmdxdluubm.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° um exemplo bastante interessante e din√¢mico do uso de ferramentas de monitoramento do Netflow (e outros protocolos de fluxo) para seguran√ßa cibern√©tica. </font><font style="vertical-align: inherit;">Nas notas a seguir, pretendo mostrar como voc√™ pode usar o NTA para detectar c√≥digo malicioso (por exemplo, Shamoon), servidores maliciosos (por exemplo, a campanha de DNSpionage), programas de acesso remoto (RAT), ignorar proxies corporativos etc.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt487346/">https://habr.com/ru/post/pt487346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt487332/index.html">Teste as l√¢mpadas LED Ergolux baratas</a></li>
<li><a href="../pt487334/index.html">Como "remoto" melhora a colabora√ß√£o</a></li>
<li><a href="../pt487336/index.html">Unidade - Habilite Multidex ou Muitos M√©todos</a></li>
<li><a href="../pt487340/index.html">Como fizemos no pr√≥ximo designer de chat bots. Parte 1</a></li>
<li><a href="../pt487342/index.html">Li√ß√£o # 2 - Reuni√µes e Eventos</a></li>
<li><a href="../pt487348/index.html">Classifica√ß√£o de tarefas priorit√°rias - aplicativo IL TEMPO</a></li>
<li><a href="../pt487356/index.html">Voc√™ vai mudar? Pense de novo</a></li>
<li><a href="../pt487358/index.html">BERT, ELMO e Co. em imagens (como o treinamento de transfer√™ncia chegou √† PNL)</a></li>
<li><a href="../pt487360/index.html">O anonimato dos dados n√£o garante seu anonimato completo</a></li>
<li><a href="../pt487362/index.html">O Angular 9 j√° est√° dispon√≠vel - Ivy chegou</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>