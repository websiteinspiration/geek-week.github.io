<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎾 🙏 ☝🏽 Teste de automação de aplicativos Web chave na mão, sem registro e SMS 🏊 🍡 💆🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitas vezes acontece que um aplicativo da Web consiste em um grande número de formulários de reestruturação dinamicamente com texto e controles difer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Teste de automação de aplicativos Web chave na mão, sem registro e SMS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/499476/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muitas vezes acontece que um aplicativo da Web consiste em um grande número de formulários de reestruturação dinamicamente com texto e controles diferentes. Testar esse aplicativo se transforma em um pesadelo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você precisa clicar em 100500 páginas e verificar todas as funcionalidades ... E antes do próximo lançamento, verifique o mesmo novamente ... E novamente ... E amanhã novamente. Em algum momento, a verificação começa a demorar mais que o desenvolvimento de novas funcionalidades. "E os testes e2e?" - você pergunta. Mas, primeiro, eles ainda precisam ser escritos. Em segundo lugar, antes de começar a escrevê-los, você precisa escrever casos de teste. Muitos casos de teste.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se, ao ler essas linhas, sua testa estiver coberta de suor, não se preocupe. </font><font style="vertical-align: inherit;">Neste artigo, compartilharei com você a idéia de como, na Tinkoff, automatizamos o teste de um dos aplicativos da web sem escrever um único caso de teste e teste e2e.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/_7/al/vg_7alujkcmr1vpvnfes86eirdo.png"><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gravando casos de teste automaticamente</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aconteceu que o teste de nosso aplicativo da Web está principalmente relacionado a verificações de interface. </font><font style="vertical-align: inherit;">Você precisa verificar se o botão está presente na tela, o título e o texto desejados são exibidos e, quando você insere um valor inválido na </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entrada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , é exibida uma mensagem de erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, ao escrever um caso de teste, você precisa registrar todas as ações:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pressionou o botão"</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Introduziu o valor de XXX"</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Selecionou o valor AAAA na lista suspensa"</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e verificações:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"O texto apareceu: XXX"</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"A mensagem de erro apareceu: AAA"</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"O cabeçalho apareceu: ZZZ"</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de analisar toda a funcionalidade de nosso aplicativo da web, identificamos cerca de 30 ações e verificações exclusivas. Ficou claro que esse processo pode ser automatizado. Para fazer isso, você só precisa acompanhar todas as ações do testador na página e a reação do site a essas ações. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos começar interceptando eventos. Para rastrear a interação com controles como botões, botões de opção e caixas de seleção, você precisa se inscrever no evento click. Cada estrutura possui seus próprios métodos para isso. Por exemplo, fromEvent em Angular e document.addEventListener em JavaScript e React. Para controles de entrada, como calendário ou entrada, apenas o tipo de evento no qual você deseja se inscrever será alterado: em vez de clicar, o foco será.</font></font><br>
<br>
<pre><code class="javascript hljs">fromEvent(<span class="hljs-keyword">this</span>.elementRef.nativeElement, <span class="hljs-string">'click'</span>)<font></font>
.subscribe(<span class="hljs-function"><span class="hljs-params">tagName</span> =&gt;</span> {
 	<span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'BUTTON'</span>) {
   		<span class="hljs-keyword">this</span>.testCaseService.addAction(<span class="hljs-string">`   "<span class="hljs-subst">${action.name}</span>"`</span>);<font></font>
 	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'INPUT-CALENDAR'</span>) {
   		<span class="hljs-keyword">this</span>.testCaseService<font></font>
     			.addAction(<span class="hljs-string">`  "<span class="hljs-subst">${action.name}</span>" "<span class="hljs-subst">${action.value}</span>"`</span>);<font></font>
 	}<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, finalmente, a coisa mais importante é verificar. </font><font style="vertical-align: inherit;">A maneira como o site deve se comportar em resposta às ações do testador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que o testador geralmente verifica? </font><font style="vertical-align: inherit;">Por exemplo, ele inseriu um valor inválido na </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entrada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o site respondeu com uma mensagem de erro. </font><font style="vertical-align: inherit;">Ou, digamos, clicamos em um botão e, em resposta, uma nova tela apareceu, o título mudou, um novo texto apareceu e os controles foram reconstruídos. </font><font style="vertical-align: inherit;">Todas essas alterações estão relacionadas à alteração na árvore do DOM. </font><font style="vertical-align: inherit;">Existem muitas opções para rastreá-los. </font><font style="vertical-align: inherit;">Você pode, por exemplo, usar MutationObserver em React e JavaScript ou ngAfterViewInit em Angular (colocando uma diretiva nos elementos do formulário de interesse no site).</font></font><br>
<br>
<pre><code class="javascript hljs">ngAfterViewInit() {
    <span class="hljs-keyword">const</span> tagName = <span class="hljs-keyword">this</span>.nativeElement.nodeName;
	<span class="hljs-keyword">const</span> text = <span class="hljs-keyword">this</span>.nativeElement.textContent;
    <span class="hljs-keyword">if</span> ([<span class="hljs-string">'SPAN'</span>, <span class="hljs-string">'P'</span>].includes(tagName)) {
 	 	 <span class="hljs-keyword">this</span>.testCaseService.addContent(<span class="hljs-string">`** ** "<span class="hljs-subst">${text}</span>"\n`</span>);<font></font>
     } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'H1'</span>) {
 	  	<span class="hljs-keyword">this</span>.testCaseService.addContent(<span class="hljs-string">`** ** "<span class="hljs-subst">${text}</span>"\n`</span>);<font></font>
     } …	<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O código dependerá muito do layout. </font><font style="vertical-align: inherit;">Vamos dar uma olhada na marcação. </font><font style="vertical-align: inherit;">Esses botões são retirados do tradutor do Google.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/eb/f5/ctebf5n4u2p4djpqzvcv6ebwl_0.png"><br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tlid-input-button input-button header-button tlid-input-button-text text-icon"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"tab"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"-1"</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tlid-input-button input-button header-button tlid-input-button-docs documents-icon"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"tab"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"-1"</span>&gt;</span>
 	 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar do fato de os botões não serem representados como tags de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">botão</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , observando a marcação, é possível selecionar todos os botões da página usando a classe css "botão de entrada" e obter nomes de botões da classe css "text" aninhada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metade do trabalho foi feito, resta apenas anotar tudo o que rastreamos em um caso de teste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluímos a interceptação de todas as ações no site para uma combinação de teclas específica e apenas no circuito de teste. </font><font style="vertical-align: inherit;">Paramos a interceptação de todos os eventos no site por uma certa combinação de teclas. </font><font style="vertical-align: inherit;">Isso permite iniciar e parar a gravação automática do caso de teste de qualquer lugar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gravando automaticamente testes e2e</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você observar o caso de teste gerado automaticamente, esses são essencialmente scripts de usuário reduzidos para o mesmo formulário. Portanto, eles podem ser convertidos em testes e2e. Você pode escrever imediatamente testes e2e imediatamente após interceptar todas as ações e verificações, ignorando os casos de teste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, há um grande número de estruturas diferentes com notação de pepino, com base em scripts comportamentais: SpecFlow, xBehave.net., Cucumber.js, CodeceptJS, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obter recursos do caso de teste, é necessário adicionar a </font><font style="vertical-align: inherit;">palavra-chave </font><font style="vertical-align: inherit;">When antes das ações e antes todas as verificações Then e And. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obtenha o teste e2e gerado automaticamente:</font></font><br>
<br>
<pre><code class="lisp hljs">Feature:   <span class="hljs-number">2</span>-<font></font>
  Background:<font></font>
 	When  <span class="hljs-string">""</span> <span class="hljs-string">""</span><font></font>
<font></font>
  Scenario:<font></font>
 	When    <span class="hljs-string">" - "</span>
 	Then    <span class="hljs-string">"  "</span>
 	And   <span class="hljs-string">" - "</span>
 	When    <span class="hljs-string">"  "</span> <span class="hljs-string">""</span>
 	When    <span class="hljs-string">""</span> <span class="hljs-string">"  "</span>
 	When    <span class="hljs-string">""</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para executar o teste, os recursos gerados são poucos - você precisa escrever um manipulador para todas as ações e verificações. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há boas notícias: você não precisa escrever um manipulador para cada recurso. </font><font style="vertical-align: inherit;">Como eu disse, apesar do grande número de formulários diferentes no site, temos apenas 30 ações e verificações exclusivas, o que significa que haverá exatamente o mesmo número de métodos no processador comum para todos os testes do e2e. </font><font style="vertical-align: inherit;">O código será um pouco diferente - dependendo da estrutura escolhida, com notação e layout de pepino no site. </font><font style="vertical-align: inherit;">Mas escrever o manipulador em si não leva muito tempo.</font></font><br>
<br>
<pre><code class="lisp hljs">When('   {string}', async function (<span class="hljs-name">button</span>: string) {<font></font>
	const xpath = <span class="hljs-string">"//button"</span><span class="hljs-comment">;</span>
	const btn = await getItemByText(<span class="hljs-name">xpath</span>, button)<span class="hljs-comment">;</span>
	await waitAndClick(<span class="hljs-name">btn</span>)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
When('  {string} {string}', async function (<span class="hljs-name">label</span>: string, text: string) {<font></font>
	const xpath = <span class="hljs-string">"//*[contains(text(),'"</span> + label + <span class="hljs-string">"')]/ancestor::outline"</span><span class="hljs-comment">;</span>
	await inputSendKeys(<span class="hljs-name">currentBrowser</span>().element(<span class="hljs-name">by</span>.xpath(<span class="hljs-name">xpath</span>)), text)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, verificando a próxima tarefa, um caso de teste é gravado automaticamente para o testador e o teste e2e gerado automaticamente é executado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, você precisa:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assine eventos de interação com controles e a reação do site a essas ações (por meio do rastreamento da reconstrução da árvore do DOM).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Converta dados do parágrafo 1 em testes e2e.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escreva um manipulador geral para executar testes do e2e.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa abordagem ajudará você a se afastar da rotina. </font><font style="vertical-align: inherit;">Você pode automatizar a gravação de casos de teste e testes e2e para verificações simples relacionadas à interface. </font><font style="vertical-align: inherit;">Fomos ainda mais longe e verificamos automaticamente também o registro no banco de dados e o envio para serviços de terceiros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falei sobre isso, bem como sobre a versão, a pilha de tecnologia e até sobre os problemas no primeiro estágio da implementação e sua solução na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conferência Heisenbug-2019 em Moscou</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, tentei transmitir a ideia principal sem entrar em detalhes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, em média, demoramos 2 minutos para escrever um caso de teste e um teste e2e - isso é 60 vezes mais rápido que os cálculos iniciais, quando queríamos escrever casos de teste e testes e2e manualmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não mudamos os processos na equipe. </font><font style="vertical-align: inherit;">Não era mais necessário alocar a capacidade de teste para escrever casos de teste e levá-la à equipe de automação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saímos completamente da noção de regressão. </font><font style="vertical-align: inherit;">Se antes, com uma corrida de duas semanas, a regressão levava mais de três dias, agora a regressão leva tempo para executar todos os testes do e2e, e isso é de apenas 2 horas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao escrever manualmente testes e2e, é muito difícil acompanhar os testes. </font><font style="vertical-align: inherit;">Agora, os testes do e2e são gravados automaticamente durante o teste da tarefa e o testador não precisa verificar a mesma funcionalidade duas vezes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, nossa equipe, sem alterar a composição, começou a trabalhar com muito mais eficiência.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499460/index.html">Concorrência, corotinas, máquinas de eventos, ... matemática viva</a></li>
<li><a href="../pt499464/index.html">MOS Technology 6502 - Domando a semente de semicondutores</a></li>
<li><a href="../pt499470/index.html">Não toque! Gerenciar uma página da Web usando uma webcam</a></li>
<li><a href="../pt499472/index.html">Como o coronavírus acelerará a quarta revolução industrial</a></li>
<li><a href="../pt499474/index.html">Como implementar Atlassian Jira + Confluence em uma corporação. Problemas técnicos</a></li>
<li><a href="../pt499482/index.html">Como os investidores economizam finanças em uma crise: abordagens para diversificação, seleção de ativos de baixo risco e otimização de custos</a></li>
<li><a href="../pt499486/index.html">Retórica como ferramenta de segurança</a></li>
<li><a href="../pt499490/index.html">Algoritmos Aleatórios</a></li>
<li><a href="../pt499492/index.html">É possível que um desenvolvedor no Vale do Silício se torne um milionário? Staff Engineer analisando na Lyft</a></li>
<li><a href="../pt499502/index.html">Por que o OceanStor Dorado V6 é o armazenamento mais rápido e confiável</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>