<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👳🏿 👨🏾‍💼 ♾ 線形時間がO（n²）でWindowsになる仕組み 💪🏻 🙇🏽 👩🏾‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、ワークステーションで数分の遅延が発生しました。調査の結果、問題の原因は5分間続く可能性のあるロックであり、その間にロックのソースが基本的に9つの命令のサイクルでスピンしたことが判明しました。
 
 私は私の記事のために良い見出しを選択することが非常に重要ですが、私はすぐに「48個のコアは9つの...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>線形時間がO（n²）でWindowsになる仕組み</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479498/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41c/2e8/f34/41c2e8f34752be4805fac21fec9b9ae0.png" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、ワークステーションで数分の遅延が発生しました。</font><font style="vertical-align: inherit;">調査の結果、問題の原因は5分間続く可能性のあるロックであり、その間にロックのソースが基本的に9つの命令のサイクルでスピンしたことが判明しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は私の記事のために良い見出しを選択することが非常に重要ですが、私はすぐに「48個のコアは9つの命令によってブロックされている」適切な名前がされたことを思い出し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、すでに撮影した</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少なくヶ月前よりも書かれたポストでHabréに]。</font><font style="vertical-align: inherit;">ブロックされたプロセッサの数は異なり、サイクルは少し長くなりますが、実際には、これによりdeja vuが発生します。</font><font style="vertical-align: inherit;">そこで、発見された新たな問題を説明しながら、</font><em><font style="vertical-align: inherit;">なぜこれがいつも起こるのか</font></em><font style="vertical-align: inherit;">を振り返りたかっ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なんでこんなことが起こっているの？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大まかに言えば、このような問題は、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドーソンのコンピューティングに関する第一法則</font></font></em> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ぶ観察の結果として発生します</font><em><font style="vertical-align: inherit;">。O </font></em></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、適切にスケーリングされないアルゴリズムの磁石です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。彼らがそこに着いたとき。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bea/017/fb8/bea017fb89b90af6566d8ad77298efb9.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の動作-私のケースから取得したデータ</font></font></i><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が起こっている？開発者はコードを記述し、O（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">アルゴリズムを使用します</font><font style="vertical-align: inherit;">。おそらく彼はこれを認識していないか、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">バグのために</font></a><font style="vertical-align: inherit;">アルゴリズムがO（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">なる</font><font style="vertical-align: inherit;">か、開発者は彼がO（n </font><sup><font style="vertical-align: inherit;">2</font></sup><font style="vertical-align: inherit;">）である</font><font style="vertical-align: inherit;">ことを知って</font><font style="vertical-align: inherit;">いますが、それは重要ではないと考えています。実験室の条件では、コード速度は許容範囲内であり、現実世界のほとんどのユーザーが許容範囲内ですが、誰かが</font><font style="vertical-align: inherit;">App Verifierをオンにして</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">7,000のプロセス</font></a><font style="vertical-align: inherit;">を作成するか</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">、180,000のCFG要素を含むバイナリファイルを</font></a><font style="vertical-align: inherit;">作成するか、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20170118033032/" rel="nofollow"><font style="vertical-align: inherit;">常に</font></a><font style="vertical-align: inherit;">大きなDLLを収集します</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20170118033032/" rel="nofollow"><font style="vertical-align: inherit;">単一のリンクリストがスキャンされ</font></a><font style="vertical-align: inherit;">、プロセッサ全体が使用されます。 ValveのSource 2エンジンの起動時間を検討しているときに、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20170118033032/" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">アルゴリズム</font><font style="vertical-align: inherit;">。それぞれがエンジンの起動時間に約30秒を追加しました。つまり、この問題は非常に異なる開発者で発生します。</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、適切にスケーリングしないアルゴリズムの磁石です。これらは、本番環境に入るには十分高速ですが、そこに到達するとすべてを台無しにするほど低速です。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
丁度。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、App Verifierのログファイル名</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">作成は</font></a><font style="vertical-align: inherit;">、実行中のプロセスごと</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">に線形時間</font></a><font style="vertical-align: inherit;">で実行されます。これは</font><font style="vertical-align: inherit;">、多くのプロセスが実行されている場合</font><font style="vertical-align: inherit;">にO（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">なることに気付くまでは正常です</font><font style="vertical-align: inherit;">。ネストされたループがあることや、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正式</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にはO（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、またはサイクルが非常に長くて速度に大きな影響を与える</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能性</font><font style="vertical-align: inherit;">があることは明らかではありません... </font><font style="vertical-align: inherit;">したがって、この可能性を考慮し、コードを書くときにそれを考慮し、高負荷でのパフォーマンスのスケーリング方法を監視し、プロファイリング中に疑わしいコードセクションを調べますそのような重い負荷。</font><font style="vertical-align: inherit;">または、私に任せて、検索してブログに記事を書くことができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常の苦情に戻る</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつものように、48の論理プロセッサと96 GBのRAMを備えた、古いながらも強力なワークステーションに取り組みました。</font><font style="vertical-align: inherit;">Chromiumを構築するために</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忍者クロム</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を導入しました</font><font style="vertical-align: inherit;">が、何も起こりませんでした。</font><font style="vertical-align: inherit;">20秒間見て待ちましたが、組み立ては始まりませんでした。</font><font style="vertical-align: inherit;">したがって、もちろん、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETW</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に切り替えて</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ETW</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トレースを記録しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">より正確には、私はそれをやろうとしました。</font><font style="vertical-align: inherit;">トレースの記録を開始しようとすると、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETWがフリーズし</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">私の練習で初めて、バグは保護対策を使用して、私がそれを探索できないようにしました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1〜2分後、Chromiumのアセンブリが始まり、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETW</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> トレースを開始しましたが、開始が遅すぎて、何が起こったのかについての情報がほとんどありませんでした。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/485/76e/b86/48576eb86c46f3254d1b891d180cc25e.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">循環バッファトレースが選択され</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
た</font><i><font style="vertical-align: inherit;">UIforETWオプション</font></i><font style="vertical-align: inherit;">同じことが2日後に発生した場合、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETWは</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再び何もできませんでした。</font><font style="vertical-align: inherit;">今回は、3回目のハングが発生するという事実に備えるために、トレースを循環メモリバッファで機能させるために残しました。</font><font style="vertical-align: inherit;">しかし、これによりビルドツールの速度が大幅に低下したため、数時間後にはあきらめました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、この状況は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再び</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">繰り返され</font><em><font style="vertical-align: inherit;">ました</font></em><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">今回は、Microsoft- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpruiが</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成したETWトレース</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;">ログ</font></em></a><font style="vertical-align: inherit;">ツールを実行して、</font><font style="vertical-align: inherit;">記録を開始することができました。</font><font style="vertical-align: inherit;">約40秒後、アセンブリが機能し始めて、トレースを取得しました！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今すぐ調査を開始できますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前、「タスクマネージャ」で、これらの</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フリーズ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中に</font><em><font style="vertical-align: inherit;">WinMgmt.exe</font></em><font style="vertical-align: inherit;">が</font><em><font style="vertical-align: inherit;">実行さ</font></em><font style="vertical-align: inherit;">れていることに気付きました</font><font style="vertical-align: inherit;">。 WPAでCPU使用率（正確）のデータを確認したところ、40秒以上経過した後、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exe</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がほぼ唯一の動作中のプロセス</font><font style="vertical-align: inherit;">であったため、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exeがシャットダウン</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">した</font><font style="vertical-align: inherit;">後、私のマシンが</font><em><font style="vertical-align: inherit;">稼働し始めたと確信</font></em><font style="vertical-align: inherit;">しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02a/cd4/35d/02acd435d1b3dec571ae9ebb5b56b67a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exeの完了後にプロセスが覚醒することを期待しています。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これはすべて疑わしいことですが、私の賢明な読者は、「後」が「原因」ではなく、証明が必要であることを知っています。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">前回</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
と同様</font><font style="vertical-align: inherit;">に、チャートでロックを解除した瞬間を概算し、</font><em><font style="vertical-align: inherit;">スイッチイン時間で</font></em><font style="vertical-align: inherit;">コンテキストスイッチをソートし、</font><em><font style="vertical-align: inherit;">最後の経過時間の</font></em><font style="vertical-align: inherit;">値が長い</font><font style="vertical-align: inherit;">（スレッドが実行されなかった時間の長さを示す）</font><font style="vertical-align: inherit;">最初のスイッチを探しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ダウンタイムが短いダースのスレッドを見逃していたので、41.57秒待機した最初のスレッドを見つけました。</font><font style="vertical-align: inherit;">睡眠のスレッドが目を覚ますしませんでした</font><em><font style="vertical-align: inherit;">WINMGMT.EXEを</font></em><font style="vertical-align: inherit;">、私はすぐにそれが目が覚めたスレッドによって目覚めたことが判明</font><em><font style="vertical-align: inherit;">WINMGMT.EXEを</font></em></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> その前のミリ秒の端数。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU使用量（正確）のグラフと準備スレッド/新規スレッドの概念の説明については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このチュートリアル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このドキュメントを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご覧ください</font><font style="vertical-align: inherit;">。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテンツスイッチングデータを含むスクリーンショットでは、行17にストリーム</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">72,748（WinMgmt.exe）</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が含まれており</font><font style="vertical-align: inherit;">、ストリーム</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74,156（svchost.exe）</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をアクティブにします</font><em><font style="vertical-align: inherit;">。</font></em><font style="vertical-align: inherit;">次に、19行目に、スレッド</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74156（SVCHOST.EXE）は</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、スレッドを活性化</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58704（SVCHOST.EXE）</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 41.57秒を待っていました、。</font><font style="vertical-align: inherit;">これは、長いスリープ後に目覚める最初のスレッドであり、これによりフローのアクティブ化のチェーンが継続します。</font><font style="vertical-align: inherit;">アクティブ化されたばかりのスレッドは、[ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいスレッドID</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]列に表示</font><font style="vertical-align: inherit;">され、数行下がると、[ </font><em><font style="vertical-align: inherit;">Readying Thread Id</font></em><font style="vertical-align: inherit;"> ]列に表示されます。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のスレッドをアクティブ化します。名前とプロセスIDは、コンテキストを理解するのに役立ちます。行17は行18および19に関連付けられ、行19は行20に関連付けられ、行23は行27に関連付けられ、以下同様です。各スレッドは、チェーン内の前のスレッドによってアクティブ化されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41c/2e8/f34/41c2e8f34752be4805fac21fec9b9ae0.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-モンスターが覚醒している</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
41.57 </font><i><font style="vertical-align: inherit;">長いアイドルスレッドは生命に来て</font></i><font style="vertical-align: inherit;">、これは、ストリームをブロックするために長い時間ですが、実際には、スレッドの数百人がブロックされました、そして、彼らはブロックされました- </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ずっと</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長いです。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後からの時間の</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値が約41.5秒である</font><font style="vertical-align: inherit;">唯一の理由</font><font style="vertical-align: inherit;">は、ハングする前のトレースの長さが解決されたためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は、問題が</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exe</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">あるという理論と一致しているようですが、</font><font style="vertical-align: inherit;">証明されていません。私の自信は、私が見たときに増加した</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のsvchost.exe（3024）</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trace-&gt;システム設定- &gt;サービス</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とそれがあることが判明</font><em><font style="vertical-align: inherit;">にWinmgmt</font></em><font style="vertical-align: inherit;">サービス</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、私はまだより確実性が必要でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう少し詳しく（時間を前後に移動して）、私は対話が複雑すぎて詳細に分析できないと判断しました。特に</font><font style="vertical-align: inherit;">、</font><em><font style="vertical-align: inherit;">svchost.exe（3024）の</font></em><font style="vertical-align: inherit;"> 25の異なるスレッドが何をしているか</font><font style="vertical-align: inherit;">を示唆する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリーム名</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">ないと判断しました</font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証拠！</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exeの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有罪の</font><em><font style="vertical-align: inherit;">証明に</font></em><font style="vertical-align: inherit;">別の</font><font style="vertical-align: inherit;">方法でアプローチすることにしました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">おそらく、これから始める価値はありますが、単純すぎます。</font><font style="vertical-align: inherit;">WPA </font><font style="vertical-align: inherit;">の</font><em><font style="vertical-align: inherit;">プロセス</font></em><font style="vertical-align: inherit;">テーブルから</font><font style="vertical-align: inherit;">コマンドライン</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exeを取得</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font><font style="vertical-align: inherit;">手動で起動しました。</font><font style="vertical-align: inherit;">コマンドの形式は次のとおりです。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winmgmt.exe / verifyrepository</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完了するまでに約5分かかりました。</font><font style="vertical-align: inherit;">うまくいきました（そして私は多くの時間を過ごしました）が、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETW</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からETWトレースを開始できないことがわかりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このような証拠は、私が実行できる複雑な分析よりも優れていました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a0/c6f/d64/1a0c6fd64820226eddd120b5e9ab2ab7.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長い休止スレッドのみを表示するための構成</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、すでに実行中のトレースを使用して再現を再度実行しました。</font><font style="vertical-align: inherit;">トレースを分析した後</font><font style="vertical-align: inherit;">、スレッドが</font><em><font style="vertical-align: inherit;">5分</font></em><font style="vertical-align: inherit;">以上ブロックされて</font><font style="vertical-align: inherit;">いる</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以上の</font><font style="vertical-align: inherit;">プロセス</font><font style="vertical-align: inherit;">を発見しました</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして再びポイントに...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
習慣から、CPU使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">率</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（サンプリング）データを</font><em><font style="vertical-align: inherit;">もう一度</font></em><font style="vertical-align: inherit;">見て、</font><em><font style="vertical-align: inherit;">WinMgmt.exeが</font></em><font style="vertical-align: inherit;">時間を浪費していた</font><font style="vertical-align: inherit;">ものを確認</font><font style="vertical-align: inherit;">しました。</font><font style="vertical-align: inherit;">サンプルの96.5％が</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repdrvfs.dll</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にあることがすぐにわかりました</font><em><font style="vertical-align: inherit;">！CPageCache :: Read（）</font></em><font style="vertical-align: inherit;">、4つの異なるスタックで呼び出されます：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/544/7d9/5f1/5447d95f1b431681cdd83ad42df7e731.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私をCPageCacheに導いた4つのパス::読み取り</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この関数の完全なスタックツリーは、主にこの問題を調査したいMicrosoftの人々のためにここに表示されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e6/6b3/519/0e66b35191db016e98ded6eb08445569.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPageCacheにつながるフルスタック：3つの方法で読み取る</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
アドレス列を追加し、サンプルの95.3％が9つの命令の1サイクルにあることを発見しました（サンプルは常に9つの命令のうち7つだけ</font><i><font style="vertical-align: inherit;">に分類</font></i><font style="vertical-align: inherit;">されます（理由を知りたい場合、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照</font><font style="vertical-align: inherit;">）、ただし、デバッガーは完全なループサイズを示した）：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ecf/8e6/04a/ecf8e604adbd110fdfaf77bb87dd378a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドレスによるサンプル</font></font></i><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">-7 </font></em><i><font style="vertical-align: inherit;">つの非常に「ホット」なアドレス</font></i><em><font style="vertical-align: inherit;">次に、</font></em><font style="vertical-align: inherit;">手動で</font><em><font style="vertical-align: inherit;">winmgmt.exe / verifyrepository</font></em></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を開始</font><font style="vertical-align: inherit;">し、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時に</font></font></em><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、実行されていた分岐命令に関するCPUカウンターからデータを収集しました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これから、ループが何回実行されたかを大まかに把握できました。これはおそらく必要ではなかったでしょうが、ループが何度も実行され、（何らかの理由で）ゆっくりと実行されないようにしたかったのです。</font><font style="vertical-align: inherit;">バッチファイルに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小さな変更</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">加えるだけで、それを簡単に実行できるのはとてもクールだと思いました</font><font style="vertical-align: inherit;">。</font><em><font style="vertical-align: inherit;">winmgmt.exeが</font></em><font style="vertical-align: inherit;">見つかりました</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サイクルごとに約1つの分岐命令を実行しました。つまり、サイクル（すでに知っているように、CPU時間のほとんどを消費しました）は非常に高速で、数億回実行されたためにスローダウンが発生しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xperf遅延</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
細心の注意のために、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETW</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がこのインシデント中にトレースを開始できなかった</font><font style="vertical-align: inherit;">理由を確認</font><font style="vertical-align: inherit;">することにしました。</font><font style="vertical-align: inherit;">それは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なっ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ていることが</font><em><font style="vertical-align: inherit;">UIforETWをして</font></em><font style="vertical-align: inherit;">実行している</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xperfはし</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ますが、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xperfはでした</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、このコールスタックに41.5秒（実際にはそれ以上）のためにアイドル：</font></font><br>
<br>
<blockquote>xperf.exe!wmain<br>
xperf.exe!CStopTrace::Execute<br>
perfctrl.dll!LoggingSession::EnumLoggers<br>
perfctrl.dll!LoggingSession::LoggingSession<br>
perfctrl.dll!LoggingSession::CreateProviderList<br>
perfctrl.dll!GetProviderInfoCache<br>
perfctrl.dll!CProviderInfoCache::CProviderInfoCache<br>
tdh.dll!TdhfEnumerateProviders<br>
tdh.dll!TdhpWbemConnect<br>
wbemprox.dll!CLocator::ConnectServer<br>
wbemprox.dll!CDCOMTrans::DoActualConnection</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xperf</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wbem</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって</font><em><font style="vertical-align: inherit;">呼び出さ</font></em><font style="vertical-align: inherit;">れる</font><font style="vertical-align: inherit;">ため、この問題によってブロックされます。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xperfは</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、トレースを開始する前にトレースを停止しようとしています。これ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、トレース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">開始をフォールトトレラント</font></a><font style="vertical-align: inherit;">にするためにこの動作を追加したため</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ハングがまだ発生するのではないかと思いますが、確かではありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">計算量のグラフを作成します</font></font></h2><br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exe</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がディレクトリ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c：\ windows \ System32 \ wbem \ Repositoryを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スキャンして</font><font style="vertical-align: inherit;">
いることに気付いた</font><font style="vertical-align: inherit;">ので、私のマシンでは1.9 GBでしたので、職場とTwitterで、このディレクトリがデータポイントを取得するのにどれだけかかるかを尋ねました。私はまた、人々に</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winmgmt.exe / verifyrepositoryの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランタイムを修正するように依頼</font><font style="vertical-align: inherit;">し、スケジュールを開始しました。これらのテストは、CPU速度が異なるまったく異なるマシンで実行されましたが、グラフはかなり明確であることがわかりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/539/dd8/23d/539dd823d7fb9b33df39dc61f9e183dd.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間の平方根とリポジトリーのサイズの関係リポジトリーのサイズ</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
に対するsqrt（時間）の比率のこのグラフは、6つの異なるマシンから受信したデータには信じられないほど理想的ですが、それでも本物です。</font><font style="vertical-align: inherit;">明らかに、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VerifyRepository</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の</font><font style="vertical-align: inherit;">パフォーマンスはO（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）です。</font><font style="vertical-align: inherit;">nがリポジトリー・ディレクトリーのサイズ（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GB）の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VerifyRepository</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は約1.6 * n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分かかります。</font><font style="vertical-align: inherit;">これは、一瞬から10分までのすべての値の適切な概算です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関連性</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は幸運であるか、私はただ観察しているだけです。なぜなら、2、3週間、誰もこの問題に遭遇していないからです。車で奇妙なことが起こっていると思いました。しかし、突然、同僚から不審な同様の苦情が聞こえ始めました。そのうちの1つには2.6 GBのリポジトリがあり、確認に10分かかりました。この問題は一部の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発者に</font><font style="vertical-align: inherit;">影響を及ぼし</font><font style="vertical-align: inherit;">、他の人々に</font><font style="vertical-align: inherit;">も影響を及ぼしました</font><font style="vertical-align: inherit;">。私の同僚は通常、Windowsマシンのパフォーマンスに問題が発生した場合、私はこれを言わなければならないことを知っていますが、おそらくこのバグによって妨げられているWindowsの下で働いている他の多くのGoogle社員がいるでしょうが、彼らはこれを認識していません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸い、私はすでにIT部門との共同作業を開始しています。</font><em><font style="vertical-align: inherit;">WinMgmt</font></em><font style="vertical-align: inherit;">を開始するスクリプトを見つけました</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それが毎時間実行されることがわかりました。</font><font style="vertical-align: inherit;">これは、私のマシンが</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinMgmt.exe / verifyrepositoryを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10％の時間</font><em><font style="vertical-align: inherit;">実行しており</font></em><font style="vertical-align: inherit;">、同僚の何人かが16％を超える時間を</font><em><font style="vertical-align: inherit;">費やしていた</font></em><font style="vertical-align: inherit;">ことを意味し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">組み立ての前に10分の遅れのかなり高い確率があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レポートが届き始める頃には、修正はすでに本番環境に移行しています。</font><font style="vertical-align: inherit;">スクリプトはオプションであり、確かにそれが引き起こす問題に値するものではなかったため、修正はその呼び出しをオフにすることでした。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h2><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winmgmt.exe / verifyrepositoryに</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、9つの命令のサイクルが含まれています。実行の反復回数は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、wbemリポジトリの</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズの2乗に比例し</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このため、コマンドの実行には最大10分かかりますが、実際には数秒で実行されるはずです。</font><font style="vertical-align: inherit;">これ自体は悪いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに悪いことに、チームは運用中にWMI（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Management Instrumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">ロック</font><font style="vertical-align: inherit;">を実行するため、WMI操作を実行するプロセスはすべてフリーズします。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驚くべきなぞなぞ</font></font></h2><br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winmgmt.exe / verifyrepositoryを</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1時間ごとに</font><em><font style="vertical-align: inherit;">実行する</font></em><font style="vertical-align: inherit;">スクリプト</font><font style="vertical-align: inherit;">はこれを何年もの間実行していましたが、問題のある動作は1〜2か月前に現れ始めました。おそらく、これはwbemリポジトリが最近非常に大きくなったことを意味します。 0.5 GBでの遅延は見過ごされがちですが、1.0 GB以上ではすでに負荷がかかります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitterで提案、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私が走った</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strings.exeを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objects.dataファイルを。最も一般的な文字列の多くには名前にpolmkrが含まれていますが、それが何を意味するのかはわかりません。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Twitter</font></a><font style="vertical-align: inherit;">で</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">バグレポート</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開したところ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最初</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はWMIチームから何らかの動き</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がありましたが、回答が得られなくなったため、現在の状況はわかりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスの問題の修正を確認したいのですが、IT部門がwbemリポジトリを非常に大きくする問題を見つけて修正できるようにしたいと考えています。</font><font style="vertical-align: inherit;">しかし今のところ、IT部門は、/ verifyrepositoryコマンドを1時間ごとに実行しないことを約束しました。これにより、最悪の症状を回避できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ETWチュートリアル、調査、およびドキュメントの一般的なリストは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">https</font></a><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">//tinyurl.com/etwcentralに</font></a><font style="vertical-align: inherit;">あります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU使用量（サンプル）チュートリアル（CPU時間の消費量を調べるため）は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ドキュメントは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらです。</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU使用率（正確）のチュートリアル（スレッドが実行できない理由を見つけるため）は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にあり、ドキュメントは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ここに</font></a><font style="vertical-align: inherit;">あり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個々の記事へのリンクは、投稿の本文に記載されています。また、私のカテゴリーで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">レポートを</font></a><font style="vertical-align: inherit;">見つけることもできます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O（n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">アルゴリズムに関する他のストーリー</font><font style="vertical-align: inherit;">は、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">偶然2次</font></a><font style="vertical-align: inherit;">で読むことができます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redditに関する記事のディスカッションは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ハッカーニュースのディスカッションは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Twitterのスレッドは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合によっては</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479482/index.html">SARIF SDKとそのエラー</a></li>
<li><a href="../ja479486/index.html">異種混合プログラミングと1つのAPIツールキット。インテルの専門家による即興講義があなたの質問に答えます</a></li>
<li><a href="../ja479488/index.html">ラップトップから-Mikrotikルーターへの冗長電源を備えたホームサーバー</a></li>
<li><a href="../ja479492/index.html">OpenWhiskに基づくサーバーレスコンピューティング、パート3</a></li>
<li><a href="../ja479496/index.html">JavaScriptでのWTFタスクの解析</a></li>
<li><a href="../ja479502/index.html">地球の歴史の中で最も厳しい氷河期を生き残るには？</a></li>
<li><a href="../ja479504/index.html">Raspberry PiベースのRDPシンクライアントの構築</a></li>
<li><a href="../ja479508/index.html">PostgreSQLアンチパターン：有害なJOINとOR</a></li>
<li><a href="../ja479510/index.html">PocketBook Xのレビュー-E Ink Carta Mobius画面と金属ケースを備えた巨大な10.3インチリーダー</a></li>
<li><a href="../ja479514/index.html">設計によるプライバシーとデフォルトのプライバシー（GDPRによる設計されたデータ保護とデフォルトのプライバシー）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>