<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò≠ ‚ùì üëßüèª Cas d'utilisation des outils d'analyse d'anomalies r√©seau: d√©tection des fuites ‚ôäÔ∏è üë®‚Äçüé® üé±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors de l'un des √©v√©nements, une discussion int√©ressante s'est ensuivie sur l'utilit√© des solutions NTA (Network Traffic Analysis) qui, √† l'aide de l'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cas d'utilisation des outils d'analyse d'anomalies r√©seau: d√©tection des fuites</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cisco/blog/487346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de l'un des √©v√©nements, une discussion int√©ressante s'est ensuivie sur l'utilit√© des solutions NTA (Network Traffic Analysis) qui, √† l'aide de l'infrastructure r√©seau de t√©l√©m√©trie Netflow (ou d'autres protocoles de flux), permettent de d√©tecter un large √©ventail d'attaques. Mes adversaires ont fait valoir que lors de l'analyse des en-t√™tes et des informations connexes (et NTA n'analyse pas le corps des donn√©es par paquets, contrairement aux syst√®mes de d√©tection d'attaque classiques, IDS), vous ne pouvez pas voir grand-chose. Dans cet article, j'essaierai de r√©futer cette opinion et de rendre la conversation plus substantielle, je donnerai de vrais exemples lorsque le NTA aide vraiment √† identifier diverses anomalies et menaces qui manquent sur le p√©rim√®tre ou m√™me au-del√† du p√©rim√®tre. Et je vais commencer par la menace qui est arriv√©e en t√™te du classement des menaces de l‚Äôann√©e derni√®re et, je pense, le restera cette ann√©e.Il s'agira des fuites d'informations et de la capacit√© de les d√©tecter via la t√©l√©m√©trie r√©seau.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne consid√©rerai pas la situation avec les mains tordues des administrateurs qui ont quitt√© Internet sans Elastic ou MongoDB. Parlons des actions cibl√©es des attaquants, comme ce fut le cas avec l'histoire acclam√©e des bureaux de cr√©dit d'Equifax. Permettez-moi de vous rappeler que dans ce cas, les attaquants ont d'abord p√©n√©tr√© la vuln√©rabilit√© non corrig√©e vers le portail Web public, puis vers les serveurs de base de donn√©es internes. Rest√©s inaper√ßus pendant plusieurs mois, ils ont pu voler des donn√©es sur 146 millions de clients de bureaux de cr√©dit. Un tel incident pourrait-il √™tre identifi√© √† l'aide de solutions DLP? Probablement pas, car les DLP classiques ne sont pas adapt√©s √† la t√¢che de surveillance du trafic √† partir de bases de donn√©es √† l'aide de protocoles sp√©cifiques, et m√™me √† condition que ce trafic soit chiffr√©.Mais la solution de la classe NTA permet de d√©tecter assez facilement de telles fuites en d√©passant une certaine valeur seuil de la quantit√© d'informations t√©l√©charg√©es depuis la base de donn√©es. Ensuite, je vais montrer comment tout cela est configur√© et d√©couvert √† l'aide de la solution Cisco Stealthwatch Enterprise.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la premi√®re chose que nous devons faire est de comprendre o√π nos serveurs de bases de donn√©es sont situ√©s dans le r√©seau, de d√©terminer leurs adresses et de les regrouper. Dans Cisco Stealthwatch, la t√¢che d'inventaire peut √™tre effectu√©e manuellement ou √† l'aide d'un classificateur sp√©cial qui analyse le trafic et, selon les protocoles utilis√©s et le comportement du n≈ìud, vous permet de l'attribuer √† l'une ou l'autre cat√©gorie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/n5/uy/rin5uykkickqn7znft9qa0ulllu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que nous avons des informations sur tous les serveurs de base de donn√©es, nous commen√ßons une enqu√™te pour savoir si nous perdons de grandes quantit√©s de donn√©es du groupe de n≈ìuds souhait√©. Nous constatons que dans notre cas, les bases de donn√©es communiquent le plus activement avec les serveurs DHCP et les contr√¥leurs de domaine.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lb/xq/1z/lbxq1znvwtgzs01n4quxfwtgjli.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les attaquants √©tablissent souvent le contr√¥le de l'un des n≈ìuds du r√©seau et l'utilisent comme t√™te de pont pour d√©velopper leur attaque. Au niveau du trafic r√©seau, cela ressemble √† une anomalie: l'analyse du r√©seau √† partir de ce n≈ìud devient plus fr√©quente, les donn√©es sont captur√©es √† partir du partage de fichiers ou l'interaction avec n'importe quel serveur. Par cons√©quent, notre prochaine t√¢che est de comprendre avec qui exactement nos bases de donn√©es communiquent le plus souvent. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wb/er/0b/wber0bo8wqxtkswej7n7vmoffc8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le groupe des serveurs DHCP, il s'av√®re qu'il s'agit d'un n≈ìud avec l'adresse 10.201.0.15, interaction avec laquelle repr√©sente environ 50% de tout le trafic provenant des serveurs de base de donn√©es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/yb/vb/yzybvbnmgicokharg8oxu57lxwm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prochaine question logique que nous nous posons dans le cadre de l'enqu√™te est: ¬´Et √† quoi ressemble ce n≈ìud comme 10.201.0.15? Avec qui interagit-il? √Ä quelle fr√©quence? Quels protocoles? "</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mt/-s/ac/mt-sacge5hjgo2jwerw7omqwmlk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que le n≈ìud qui nous int√©resse communique avec divers segments et n≈ìuds de notre r√©seau (ce qui n'est pas surprenant, car il s'agit d'un serveur DHCP), mais la question provoque trop d'interaction avec le serveur de terminal avec l'adresse 10.201.0.23. Est-ce normal? Il y a clairement une sorte d'anomalie. Un serveur DHCP ne peut pas communiquer si activement avec un serveur Terminal Server - 5610 flux et 23,5 Go de donn√©es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4i/mk/jm/4imkjmqkv1eumztrmdyb88etx3c.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et cette interaction est r√©alis√©e via NFS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/2a/wo/vl2awoxjk2kijyg494rvz8bqsr4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous passons √† l'√©tape suivante et essayons de comprendre avec qui notre serveur de terminal interagit? Il s'av√®re qu'il a une communication assez active avec le monde ext√©rieur - avec des n≈ìuds aux √âtats-Unis, en Grande-Bretagne, au Canada, au Danemark, aux √âmirats arabes unis, au Qatar, en Suisse, etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uw/yr/3s/uwyr3shmwntm1clarsxud2xfcgq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La suspicion a √©t√© caus√©e par le fait de l'interaction P2P avec Porto Rico, qui repr√©sentait 90% de tout le trafic. De plus, notre serveur terminal a transmis plus de 17 Go de donn√©es √† Porto Rico via le 53e port, qui est connect√© avec le protocole DNS. Pouvez-vous imaginer que vous avez un tel volume de donn√©es transmises via DNS? Et je vous rappelle que selon les recherches de Cisco, 92% des logiciels malveillants utilisent DNS pour masquer leur activit√© (t√©l√©chargement de mises √† jour, r√©ception de commandes, d√©chargement de donn√©es). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/mm/5b/f1mm5b4rmsqx5butgpw-mlsmk0e.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si le protocole DNS de l'UIT n'est pas seulement ouvert, mais non inspect√©, alors nous avons un √©norme trou dans notre p√©rim√®tre. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/_4/dj/yt_4djyxlui4rzkyvsko1zsejlu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√®s que le n≈ìud 10.201.0.23 nous a caus√© de tels soup√ßons, voyons √† qui il parle encore?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/ya/7r/zhya7r8umwppjkxvidzpmpca9zy.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre ¬´suspect¬ª √©change la moiti√© de tout le trafic avec le n≈ìud 10.201.3.18, qui est plac√© dans un groupe de postes de travail d'employ√©s du service commercial et marketing. Dans quelle mesure ceux-ci sont-ils typiques de notre organisation pour que le serveur de terminal "communique" avec l'ordinateur du vendeur ou de l'agent de commercialisation?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/vq/nf/puvqnfekb1fdkqjenprrlsesxpi.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc men√© une enqu√™te et d√©couvert l'image suivante. Les donn√©es du serveur de base de donn√©es ont √©t√© ¬´vers√©es¬ª sur un serveur DHCP avec leur transfert ult√©rieur via NFS vers un serveur terminal √† l'int√©rieur de notre r√©seau, puis vers des adresses externes √† Porto Rico en utilisant le protocole DNS. Il s'agit d'une violation manifeste des politiques de s√©curit√©. Dans le m√™me temps, le serveur de terminaux a √©galement interagi avec l'un des postes de travail du r√©seau. Qu'est-ce qui a caus√© cet incident? Un compte vol√©? Appareil infect√©? Nous ne savons pas. Cela n√©cessitera la poursuite de l'enqu√™te, qui √©tait bas√©e sur la solution de classe NTA, qui permet d'analyser les anomalies du trafic r√©seau.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ge/wt/vo/gewtvo6-5k-41fdkkxaozhlep7q.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, nous voulons savoir ce que nous ferons des violations identifi√©es de la politique de s√©curit√©? Vous pouvez effectuer une analyse r√©guli√®re selon le sch√©ma ci-dessus, ou vous pouvez configurer la strat√©gie NTA afin qu'elle signale imm√©diatement quand des violations similaires sont d√©tect√©es. Cela se fait soit via le menu g√©n√©ral correspondant, soit pour chaque connexion d√©tect√©e lors de l'enqu√™te. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/rp/qa/ccrpqaqizyxou5zjqqfw36hsl4i.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemblera la r√®gle de d√©tection d'interaction, dont la source est le serveur de base de donn√©es et la destination est tous les n≈ìuds externes, ainsi que tous les n≈ìuds internes, √† l'exclusion des serveurs Web.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/xy/ah/huxyah2skmz8jpc7d3dhtxtl3xe.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si un tel √©v√©nement est d√©tect√©, le syst√®me d'analyse du trafic r√©seau g√©n√®re imm√©diatement un signal d'alarme de correspondance et, selon les param√®tres, l'envoie √† SIEM, en utilisant les moyens de communication avec l'administrateur, ou peut m√™me bloquer automatiquement la violation d√©tect√©e (Cisco Stealthwatch le fait en interagissant avec Cisco ISE ) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lj/ii/rn/ljiirng2huuf6qzjxg-kiagufcu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rappelez-vous, lorsque j'ai mentionn√© le cas d'Equifax, j'ai mentionn√© que les attaquants utilisaient un canal crypt√© pour vider les donn√©es. Pour DLP, ce trafic devient une t√¢che insoluble, mais pour les solutions de classe NTA, ils ne le font pas - ils suivent tout trafic exc√©dentaire ou interaction non autoris√©e entre les n≈ìuds, quel que soit le chiffrement.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u2/qg/qg/u2qgqgkkrsk_etuu7nav-k9hndg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un seul cas a √©t√© montr√© ci-dessus (dans les documents suivants, nous consid√©rerons d'autres exemples d'utilisation de NTA √† des fins de s√©curit√© de l'information), mais en fait, les solutions modernes de la classe Network Traffic Analysis vous permettent de cr√©er des r√®gles tr√®s flexibles et de prendre en compte non seulement les param√®tres de base de l'en-t√™te du paquet IP: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/15/ya/uk/15yaukzbimtm-o-yf41wnibz2ik.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mais aussi effectuer une analyse plus approfondie, jusqu'√† associer l'incident au nom d'utilisateur d'Active Directory, rechercher des fichiers malveillants par hachage (par exemple, obtenu comme indicateur de compromis aupr√®s de SOSOPKA, FinCERT, Cisco Threat Grid, etc.), etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/oe/55/dcoe55wr_luv_kvpjjrqwapc5jc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est facile √† mettre en ≈ìuvre. Par exemple, voici √† quoi ressemble la r√®gle habituelle pour d√©tecter tous les types d'interaction entre les serveurs de base de donn√©es et les n≈ìuds externes en utilisant n'importe quel protocole au cours des 30 derniers jours. Nous constatons que nos bases de donn√©es ¬´communiquent¬ª avec des n≈ìuds externes au segment SGBD en utilisant les protocoles DNS, SMB et port 8088. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/70/nh/hn70nhlbp10lmjmgbkjj_8_bs8i.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du formulaire tabulaire de pr√©sentation des r√©sultats des investigations ou recherches, nous pouvons √©galement les visualiser. Pour notre sc√©nario, un fragment du diagramme de flux r√©seau peut ressembler √† ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zs/yv/jf/zsyvjfgvrptgxwgv0eefnyz5pju.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et directement √† partir de la m√™me carte, nous pouvons g√©rer des politiques - bloquer les connexions ou automatiser le processus de cr√©ation de r√®gles de surveillance pour les flux qui nous int√©ressent.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/tj/rk/ixtjrkszqelbtsgpwdmdxdluubm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple assez int√©ressant et vivant d'utilisation des outils de surveillance Netflow (et d'autres protocoles de flux) pour la cybers√©curit√©. </font><font style="vertical-align: inherit;">Dans les notes suivantes, j'ai l'intention de montrer comment vous pouvez utiliser NTA pour d√©tecter du code malveillant (par exemple, Shamoon), des serveurs malveillants (par exemple, la campagne DNSpionage), des programmes d'acc√®s √† distance (RAT), contourner les proxys d'entreprise, etc.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487332/index.html">Testez les ampoules LED Ergolux pas ch√®res</a></li>
<li><a href="../fr487334/index.html">Comment ¬´√† distance¬ª am√©liore la collaboration</a></li>
<li><a href="../fr487336/index.html">Unity - Activer Multidex ou trop de m√©thodes</a></li>
<li><a href="../fr487340/index.html">Comme nous l'avons fait le prochain concepteur de chat bots. Partie 1</a></li>
<li><a href="../fr487342/index.html">Le√ßon # 2 - R√©unions et √©v√©nements</a></li>
<li><a href="../fr487348/index.html">Classement des t√¢ches prioritaires - IL TEMPO app</a></li>
<li><a href="../fr487356/index.html">Allez-vous changer? D√©trompez-vous</a></li>
<li><a href="../fr487358/index.html">BERT, ELMO et Co. en images (comment la formation au transfert est arriv√©e √† la PNL)</a></li>
<li><a href="../fr487360/index.html">L'anonymisation des donn√©es ne garantit pas votre anonymat complet</a></li>
<li><a href="../fr487362/index.html">Angular 9 est maintenant disponible - Ivy est arriv√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>