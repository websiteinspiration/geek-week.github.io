<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤²ğŸ½ ğŸ¤§ ğŸ˜… zipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¯ã©ã®ã‚ˆã†ã«è¦‹ãˆã€ãã‚Œã§ä½•ãŒã§ãã‚‹ã‹ã€‚ãƒ‘ãƒ¼ãƒˆ2-ãƒ‡ãƒ¼ã‚¿è¨˜è¿°å­ã¨åœ§ç¸® ğŸ‘ƒğŸ½ ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸ‘‰ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¨˜äº‹ã®ç¶šãzipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®å¤–è¦³ã¨ãã‚Œã§ä½•ãŒã§ãã‚‹ã‹ã€‚
 åºæ–‡
 

è‰¯ã„ä¸€æ—¥ã€‚
 ã¾ãŸã€æ”¾é€ä¸­ã€PHPã§ã®å‹ç ´ã‚Šãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒã‚ã‚Šã¾ã™ã€‚
 

ä»¥å‰ã®è¨˜äº‹ã§ã¯ã€å°Šæ•¬ã•ã‚Œã‚‹èª­è€…ã¯zipåœ§ç¸®ã¨zipã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«èˆˆå‘³ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚ä»Šæ—¥ã¯å°‘ã—ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’é–‹ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
 

è¦‹ã¦ã¿ã¾ã—ã‚‡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>zipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¯ã©ã®ã‚ˆã†ã«è¦‹ãˆã€ãã‚Œã§ä½•ãŒã§ãã‚‹ã‹ã€‚ãƒ‘ãƒ¼ãƒˆ2-ãƒ‡ãƒ¼ã‚¿è¨˜è¿°å­ã¨åœ§ç¸®</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472966/"><p><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜äº‹ã®ç¶šã</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®å¤–è¦³ã¨ãã‚Œã§ä½•ãŒã§ãã‚‹ã‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></i></p><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åºæ–‡</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‰¯ã„ä¸€æ—¥ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãŸã€æ”¾é€ä¸­ã€PHPã§ã®å‹ç ´ã‚Šãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒã‚ã‚Šã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥å‰ã®è¨˜äº‹ã§ã¯ã€å°Šæ•¬ã•ã‚Œã‚‹èª­è€…ã¯zipåœ§ç¸®ã¨zipã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«èˆˆå‘³ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ä»Šæ—¥ã¯å°‘ã—ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’é–‹ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦‹ã¦ã¿ã¾ã—ã‚‡ã†</font></font><br>
<br>
</p><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰ã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//        (1.txt  2.txt)   :</span><font></font>
$entries = [<font></font>
    <span class="hljs-string">'1.txt'</span> =&gt; <span class="hljs-string">'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc id ante ultrices, fermentum nibh eleifend, ullamcorper nunc. Sed dignissim ut odio et imperdiet. Nunc id felis et ligula viverra blandit a sit amet magna. Vestibulum facilisis venenatis enim sed bibendum. Duis maximus felis in suscipit bibendum. Mauris suscipit turpis eleifend nibh commodo imperdiet. Donec tincidunt porta interdum. Aenean interdum condimentum ligula, vitae ornare lorem auctor in. Suspendisse metus ipsum, porttitor et sapien id, fringilla aliquam nibh. Curabitur sem lacus, ultrices quis felis sed, blandit commodo metus. Duis tincidunt vel mauris at accumsan. Integer et ipsum fermentum leo viverra blandit.'</span>,<font></font>
    <font></font>
    <span class="hljs-string">'2.txt'</span> =&gt; <span class="hljs-string">'Mauris in purus sit amet ante tempor finibus nec sed justo. Integer ac nibh tempus, mollis sem vel, consequat diam. Pellentesque ut condimentum ex. Praesent finibus volutpat gravida. Vivamus eleifend neque sit amet diam scelerisque lacinia. Nunc imperdiet augue in suscipit lacinia. Curabitur orci diam, iaculis non ligula vitae, porta pellentesque est. Duis dolor erat, placerat a lacus eu, scelerisque egestas massa. Aliquam molestie pulvinar faucibus. Quisque consequat, dolor mattis lacinia pretium, eros eros tempor neque, volutpat consectetur elit elit non diam. In faucibus nulla justo, non dignissim erat maximus consectetur. Sed porttitor turpis nisl, elementum aliquam dui tincidunt nec. Nunc eu enim at nibh molestie porta ut ac erat. Sed tortor sem, mollis eget sodales vel, faucibus in dolor.'</span>,<font></font>
];<font></font>
<font></font>
<span class="hljs-comment">//      Lorem.zip,      cwd (      )</span>
$destination = <span class="hljs-string">'Lorem.zip'</span>;<font></font>
$handle = fopen($destination, <span class="hljs-string">'w'</span>);<font></font>
<font></font>
<span class="hljs-comment">//      ,    ,     ,   "" Central Directory File Header</span>
$written = <span class="hljs-number">0</span>;<font></font>
$dictionary = [];<font></font>
<span class="hljs-keyword">foreach</span> ($entries <span class="hljs-keyword">as</span> $filename =&gt; $content) {
    <span class="hljs-comment">//         Local File Header,    </span>
    <span class="hljs-comment">//        ,      .</span><font></font>
    <font></font>
    $fileInfo = [<font></font>
        <span class="hljs-comment">//    </span>
        <span class="hljs-string">'versionToExtract'</span>      =&gt; <span class="hljs-number">10</span>,                                      
        <span class="hljs-comment">//   0,        -</span>
        <span class="hljs-string">'generalPurposeBitFlag'</span> =&gt; <span class="hljs-number">0</span>,                                       
        <span class="hljs-comment">//      ,    0</span>
        <span class="hljs-string">'compressionMethod'</span>     =&gt; <span class="hljs-number">0</span>,                                       
        <span class="hljs-comment">// -    mtime ,    ,      ?</span>
        <span class="hljs-string">'modificationTime'</span>      =&gt; <span class="hljs-number">28021</span>,                                   
        <span class="hljs-comment">//   , ?</span>
        <span class="hljs-string">'modificationDate'</span>      =&gt; <span class="hljs-number">20072</span>,
        <span class="hljs-comment">//      .     ,       ,   ?</span>
        <span class="hljs-string">'crc32'</span>                 =&gt; hexdec(hash(<span class="hljs-string">'crc32b'</span>, $content)),
        <span class="hljs-comment">//     .        . </span>
        <span class="hljs-comment">//       :)</span>
        <span class="hljs-string">'compressedSize'</span>        =&gt; $size = strlen($content),
        <span class="hljs-string">'uncompressedSize'</span>      =&gt; $size,
        <span class="hljs-comment">//   </span>
        <span class="hljs-string">'filenameLength'</span>        =&gt; strlen($filename),
        <span class="hljs-comment">//  .    ,   0.</span>
        <span class="hljs-string">'extraFieldLength'</span>      =&gt; <span class="hljs-number">0</span>,<font></font>
    ];<font></font>
    <font></font>
    <span class="hljs-comment">//      .</span>
    $LFH = pack(<span class="hljs-string">'LSSSSSLLLSSa*'</span>, ...array_values([
        <span class="hljs-string">'signature'</span> =&gt; <span class="hljs-number">0x04034b50</span>, <span class="hljs-comment">//  Local File Header</span>
    ] + $fileInfo + [<span class="hljs-string">'filename'</span> =&gt; $filename]));<font></font>
    <font></font>
    <span class="hljs-comment">//       ,       Central Directory File Header</span><font></font>
    $dictionary[$filename] = [<font></font>
        <span class="hljs-string">'signature'</span>     =&gt; <span class="hljs-number">0x02014b50</span>, <span class="hljs-comment">//  Central Directory File Header</span>
        <span class="hljs-string">'versionMadeBy'</span> =&gt; <span class="hljs-number">798</span>,        <span class="hljs-comment">//  .    ,  -  .</span><font></font>
    ] + $fileInfo + [<font></font>
        <span class="hljs-string">'fileCommentLength'</span>      =&gt; <span class="hljs-number">0</span>,          <span class="hljs-comment">//    . No comments</span>
        <span class="hljs-string">'diskNumber'</span>             =&gt; <span class="hljs-number">0</span>,          <span class="hljs-comment">//     0,       </span>
        <span class="hljs-string">'internalFileAttributes'</span> =&gt; <span class="hljs-number">0</span>,          <span class="hljs-comment">//   </span>
        <span class="hljs-string">'externalFileAttributes'</span> =&gt; <span class="hljs-number">2176057344</span>, <span class="hljs-comment">//   </span>
        <span class="hljs-string">'localFileHeaderOffset'</span>  =&gt; $written,   <span class="hljs-comment">//      Local File Header</span>
        <span class="hljs-string">'filename'</span>               =&gt; $filename,  <span class="hljs-comment">//  .</span><font></font>
    ];<font></font>
    <font></font>
    <span class="hljs-comment">//     </span><font></font>
    $written += fwrite($handle, $LFH);<font></font>
    <span class="hljs-comment">//   </span><font></font>
    $written += fwrite($handle, $content);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ,     ,    .</span>
<span class="hljs-comment">//          End of central directory record (EOCD)</span><font></font>
$EOCD = [<font></font>
    <span class="hljs-comment">//  EOCD</span>
    <span class="hljs-string">'signature'</span>                    =&gt; <span class="hljs-number">0x06054b50</span>, 
    <span class="hljs-comment">//  .    ,   0</span>
    <span class="hljs-string">'diskNumber'</span>                   =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-comment">//      -  0</span>
    <span class="hljs-string">'startDiskNumber'</span>              =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-comment">//       .</span>
    <span class="hljs-string">'numberCentralDirectoryRecord'</span> =&gt; $records = count($dictionary), 
    <span class="hljs-comment">//    .    ,    </span>
    <span class="hljs-string">'totalCentralDirectoryRecord'</span>  =&gt; $records, 
    <span class="hljs-comment">//   Central Directory Record. </span>
    <span class="hljs-comment">//      ,     </span>
    <span class="hljs-string">'sizeOfCentralDirectory'</span>       =&gt; <span class="hljs-number">0</span>, 
    <span class="hljs-comment">// ,    Central Directory Records</span>
    <span class="hljs-string">'centralDirectoryOffset'</span>       =&gt; $written,
    <span class="hljs-comment">//    </span>
    <span class="hljs-string">'commentLength'</span>                =&gt; <span class="hljs-number">0</span><font></font>
];<font></font>
<font></font>
<span class="hljs-comment">//     !  </span>
<span class="hljs-keyword">foreach</span> ($dictionary <span class="hljs-keyword">as</span> $entryInfo) {<font></font>
    $CDFH = pack(<span class="hljs-string">'LSSSSSSLLLSSSSSLLa*'</span>, ...array_values($entryInfo));<font></font>
    $written += fwrite($handle, $CDFH);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ,   .  ,   </span>
$EOCD[<span class="hljs-string">'sizeOfCentralDirectory'</span>] = $written - $EOCD[<span class="hljs-string">'centralDirectoryOffset'</span>];<font></font>
    <font></font>
<span class="hljs-comment">//     End of central directory record</span>
$EOCD = pack(<span class="hljs-string">'LSSSSLLS'</span>, ...array_values($EOCD));<font></font>
$written += fwrite($handle, $EOCD);<font></font>
<font></font>
<span class="hljs-comment">//  . </span><font></font>
fclose($handle);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . $written . <span class="hljs-string">' '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'     `unzip -tq '</span> . $destination . <span class="hljs-string">'`'</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> PHP_EOL;
</code></pre><br>
</div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½¼ã®å•é¡Œã¯ä½•ã§ã™ã‹ï¼Ÿã¾ã‚ã€å…¬å¹³ã«è¨€ã†ã¨ã€ãã®å”¯ä¸€ã®åˆ©ç‚¹ã¯ã€ãã‚ŒãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã¨ã€ãã“ã«å•é¡ŒãŒã‚ã‚‹ã“ã¨ã§ã™ãŒã€ãã‚Œã§ã‚‚ãªãŠæ³¨ç›®ã«å€¤ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®æ„è¦‹ã§ã¯ã€ä¸»ãªå•é¡Œã¯ã€ã¾ãš</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆLFHï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crc32</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ãƒ•ã‚¡ã‚¤ãƒ«é•·ã§</font><font style="vertical-align: inherit;">æ›¸ãè¾¼ã¿ã€</font><font style="vertical-align: inherit;">æ¬¡ã«ãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã®å†…å®¹ã‚’æ›¸ãè¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ã“ã¨ã§ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã¯ä½•ã‚’è„…ã‹ã—ã¦ã„ã¾ã™ã‹ï¼Ÿã¾ãŸã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«ãƒ­ãƒ¼ãƒ‰ã—ã€ãã®ãŸã‚ã«crc32ã‚’æ¤œè¨ã—ã€LFHã‚’æ›¸ãè¾¼ã¿</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯I / Oã®ç‚¹ã§çµŒæ¸ˆçš„ã§ã™ãŒã€å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯å—ã‘å…¥ã‚Œã‚‰ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’2å›èª­ã¿å–ã‚Šã¾ã™-æœ€åˆã«ãƒãƒƒã‚·ãƒ¥ã‚’è¨ˆç®—ã—ã€æ¬¡ã«å†…å®¹ã‚’èª­ã¿å–ã£ã¦ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«æ›¸ãè¾¼ã¿ã¾ã™-RAMã®è¦³ç‚¹ã‹ã‚‰ã¯çµŒæ¸ˆçš„ã§ã™ãŒã€ãŸã¨ãˆã°ã€æœ€åˆã«ãƒ‰ãƒ©ã‚¤ãƒ–ã®è² è·ãŒ2å€ã«ãªã‚Šã€å¿…ãšã—ã‚‚SSDã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒªãƒ¢ãƒ¼ãƒˆã«ã‚ã‚Šã€ãã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒã€ãŸã¨ãˆã°1.5GBã®å ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚ 1.5GBã‚’ã™ã¹ã¦ãƒ¡ãƒ¢ãƒªã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‹ã€ã“ã‚Œã‚‰ã®1.5GBãŒã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¾ã§å¾…ã¡ã€ãƒãƒƒã‚·ãƒ¥ã‚’è¨ˆç®—ã—ã¦ã‹ã‚‰å†åº¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã€ãŸã¨ãˆã°stdoutã‹ã‚‰èª­ã¿å–ã£ãŸãƒ€ãƒ³ãƒ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã‚’ã‚ªãƒ³ã‚¶ãƒ•ãƒ©ã‚¤ã§æä¾›ã—ãŸã„å ´åˆã€ã“ã‚Œã¯ä¸€èˆ¬ã«å—ã‘å…¥ã‚Œã‚‰ã‚Œã¾ã›ã‚“-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ãƒ‡ãƒ¼ã‚¿ãŒå¤‰æ›´ã•ã‚Œã€ãƒ€ãƒ³ãƒ—ãƒ‡ãƒ¼ã‚¿ãŒå¤‰æ›´ã•ã‚Œã€å®Œå…¨ã«ç•°ãªã‚‹ãƒãƒƒã‚·ãƒ¥ãŒå­˜åœ¨ã—ã€ç„¡åŠ¹ãªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€ç‰©äº‹ã¯æ‚ªã„ã§ã™ã€‚</font></font></p><br>
<h3> Data Descriptor     </h3><br>
<p>  ,  ZIP     ,     <b>Data Descriptor (DD)</b>  ,      crc32,        .     <strike> 3    </strike>  <b>LFH </b> <b>generalPurposeBitFlag </b> <b>0x0008</b>,  <b>crc32</b>, <b>compressedSize</b>  <b>uncompressedSize</b>  <b>0</b>.       <b>DD</b>,    - :</p><br>
<br>
<pre><code class="php hljs">pack(<span class="hljs-string">'LLLL'</span>, ...array_values([
    <span class="hljs-string">'signature'</span>        =&gt; <span class="hljs-number">0x08074b50</span>,        <span class="hljs-comment">//  Data Descriptor       </span>
    <span class="hljs-string">'crc32'</span>            =&gt; $crc32,            <span class="hljs-comment">//  crc32   </span>
    <span class="hljs-string">'compressedSize'</span>   =&gt; $compressedSize,   <span class="hljs-comment">//   </span>
    <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, <span class="hljs-comment">//    .</span>
]));</code></pre><br>
<p>  <b>Central Directory File Header (CDFH)</b>   <b>generalPurposeBitFlag</b>,     .    ,   <b>CDFH</b>     ,           .</p><br>
<p> , , .     PHP.<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Hash</a>      .     ,        ,      . ,      ,  <i>hash('crc32b', $content)</i>,         . <br>
<br>
   - :<br>
<br>
</p><pre><code class="php hljs">$hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);<font></font>
$handle = fopen($source, <span class="hljs-string">'r'</span>);
<span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
    $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);<font></font>
    hash_update($hashCtx, $chunk);<font></font>
    $chunk = <span class="hljs-literal">null</span>;<font></font>
}<font></font>
<font></font>
$hash = hash_final($hashCtx);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ãŒæ­£ã—ãè¡Œã‚ã‚Œã¦ã„ã‚Œã°ã€å€¤ã¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash_fileï¼ˆ 'crc32b'ã€$ sourceï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ãŸã¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashï¼ˆ 'crc32b'ã€file_get_contentï¼ˆ$ sourceï¼‰ï¼‰ã¨ã¾ã£ãŸãåŒã˜ã«ãªã‚Š</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã‚’ä½•ã‚‰ã‹ã®æ–¹æ³•ã§1ã¤ã®é–¢æ•°ã«ãƒ©ãƒƒãƒ—ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¾¿åˆ©ãªæ–¹æ³•ã§èª­ã¿å–ã£ã¦ã€æœ€å¾Œã«ãƒãƒƒã‚·ãƒ¥ã¨é•·ã•ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã“ã‚Œã‚’åŠ©ã‘ã¦ãã‚Œã¾ã™ï¼š</font></font><br>
<br>
</p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $length = <span class="hljs-number">0</span>;<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);<font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);<font></font>
        <font></font>
        $length += strlen($chunk);<font></font>
        hash_update($hashCtx, $chunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $chunk;<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; hexdec(hash_final($hashCtx))];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ä»Šã€ç§ãŸã¡ã¯ã¡ã‚‡ã†ã©ã§ãã¾ã™ </font></font><br>
<br>
<pre><code class="php hljs">$reader = read(<span class="hljs-string">'https://speed.hetzner.de/1GB.bin'</span>);
<span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {
    <span class="hljs-comment">// -   . </span><font></font>
}<font></font>
<span class="hljs-comment">//      .</span>
[<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; $crc32] = $reader-&gt;getReturn(); 
<span class="hljs-keyword">echo</span> round(memory_get_peak_usage(<span class="hljs-literal">true</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>, <span class="hljs-number">2</span>) . <span class="hljs-string">'MB - Memory Peak Usage'</span> . PHP_EOL;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®æ„è¦‹ã§ã¯ã€ãã‚Œã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ä¾¿åˆ©ã§ã™ã€‚</font><font style="vertical-align: inherit;">1 GBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ãŸå ´åˆã€ãƒ”ãƒ¼ã‚¯æ™‚ã®ãƒ¡ãƒ¢ãƒªæ¶ˆè²»é‡ã¯2 MBã§ã—ãŸã€‚</font></font><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã«ã€å‰ã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ã€ã“ã®é–¢æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</font></font><br>
<br>
</p><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€çµ‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $length = <span class="hljs-number">0</span>;<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);<font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);<font></font>
        <font></font>
        $length += strlen($chunk);<font></font>
        hash_update($hashCtx, $chunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $chunk;<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; hexdec(hash_final($hashCtx))];<font></font>
}<font></font>
<font></font>
$entries = [<span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span>, <span class="hljs-keyword">__FILE__</span>];<font></font>
<font></font>
$destination = <span class="hljs-string">'test.zip'</span>;<font></font>
$handle = fopen($destination, <span class="hljs-string">'w'</span>);<font></font>
<font></font>
$written = <span class="hljs-number">0</span>;<font></font>
$dictionary = [];<font></font>
<span class="hljs-keyword">foreach</span> ($entries <span class="hljs-keyword">as</span> $entry) {<font></font>
    $filename = basename($entry);<font></font>
    <font></font>
    $fileInfo = [<font></font>
        <span class="hljs-string">'versionToExtract'</span>      =&gt; <span class="hljs-number">10</span>,      
        <span class="hljs-comment">//       Data Descriptor,     00008, </span>
        <span class="hljs-comment">//   00000    .</span>
        <span class="hljs-string">'generalPurposeBitFlag'</span> =&gt; <span class="hljs-number">0x0008</span>,           
        <span class="hljs-string">'compressionMethod'</span>     =&gt; <span class="hljs-number">0</span>,                                       
        <span class="hljs-string">'modificationTime'</span>      =&gt; <span class="hljs-number">28021</span>,                                   
        <span class="hljs-string">'modificationDate'</span>      =&gt; <span class="hljs-number">20072</span>,
        <span class="hljs-string">'crc32'</span>                 =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'compressedSize'</span>        =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'uncompressedSize'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'filenameLength'</span>        =&gt; strlen($filename),
        <span class="hljs-string">'extraFieldLength'</span>      =&gt; <span class="hljs-number">0</span>,<font></font>
    ];<font></font>
    <font></font>
    $LFH = pack(<span class="hljs-string">'LSSSSSLLLSSa*'</span>, ...array_values([
        <span class="hljs-string">'signature'</span> =&gt; <span class="hljs-number">0x04034b50</span>, <font></font>
    ] + $fileInfo + [<span class="hljs-string">'filename'</span> =&gt; $filename]));<font></font>
    <font></font>
    $fileOffset = $written;<font></font>
    $written += fwrite($handle, $LFH);<font></font>
    <font></font>
    <span class="hljs-comment">//    </span><font></font>
    $reader = read($entry);<font></font>
    <span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {
        <span class="hljs-comment">//     </span><font></font>
        $written += fwrite($handle, $chunk);<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//      </span>
    [<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; $crc32] = $reader-&gt;getReturn();<font></font>
    <font></font>
    <span class="hljs-comment">//    fileInfo,     CDFH</span>
    $fileInfo[<span class="hljs-string">'crc32'</span>] = $crc32;<font></font>
    $fileInfo[<span class="hljs-string">'compressedSize'</span>] = $length;<font></font>
    $fileInfo[<span class="hljs-string">'uncompressedSize'</span>] = $length;<font></font>
    <font></font>
    <span class="hljs-comment">//  Data Descriptor</span>
    $DD = pack(<span class="hljs-string">'LLLL'</span>, ...array_values([
        <span class="hljs-string">'signature'</span>        =&gt; <span class="hljs-number">0x08074b50</span>,
        <span class="hljs-string">'crc32'</span>            =&gt; $fileInfo[<span class="hljs-string">'crc32'</span>],
        <span class="hljs-string">'compressedSize'</span>   =&gt; $fileInfo[<span class="hljs-string">'compressedSize'</span>],
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $fileInfo[<span class="hljs-string">'uncompressedSize'</span>],<font></font>
    ]));<font></font>
    <font></font>
    $written += fwrite($handle, $DD);<font></font>
    <font></font>
    $dictionary[$filename] = [<font></font>
        <span class="hljs-string">'signature'</span>     =&gt; <span class="hljs-number">0x02014b50</span>,
        <span class="hljs-string">'versionMadeBy'</span> =&gt; <span class="hljs-number">798</span>,<font></font>
    ] + $fileInfo + [<font></font>
        <span class="hljs-string">'fileCommentLength'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'diskNumber'</span>             =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'internalFileAttributes'</span> =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'externalFileAttributes'</span> =&gt; <span class="hljs-number">2176057344</span>,
        <span class="hljs-string">'localFileHeaderOffset'</span>  =&gt; $fileOffset,
        <span class="hljs-string">'filename'</span>               =&gt; $filename,<font></font>
    ];<font></font>
}<font></font>
<font></font>
$EOCD = [<font></font>
    <span class="hljs-string">'signature'</span>                    =&gt; <span class="hljs-number">0x06054b50</span>, 
    <span class="hljs-string">'diskNumber'</span>                   =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'startDiskNumber'</span>              =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'numberCentralDirectoryRecord'</span> =&gt; $records = count($dictionary), 
    <span class="hljs-string">'totalCentralDirectoryRecord'</span>  =&gt; $records, 
    <span class="hljs-string">'sizeOfCentralDirectory'</span>       =&gt; <span class="hljs-number">0</span>, 
    <span class="hljs-string">'centralDirectoryOffset'</span>       =&gt; $written,
    <span class="hljs-string">'commentLength'</span>                =&gt; <span class="hljs-number">0</span><font></font>
];<font></font>
<font></font>
<span class="hljs-keyword">foreach</span> ($dictionary <span class="hljs-keyword">as</span> $entryInfo) {<font></font>
    $CDFH = pack(<span class="hljs-string">'LSSSSSSLLLSSSSSLLa*'</span>, ...array_values($entryInfo));<font></font>
    $written += fwrite($handle, $CDFH);<font></font>
}<font></font>
<font></font>
$EOCD[<span class="hljs-string">'sizeOfCentralDirectory'</span>] = $written - $EOCD[<span class="hljs-string">'centralDirectoryOffset'</span>];<font></font>
$EOCD = pack(<span class="hljs-string">'LSSSSLLS'</span>, ...array_values($EOCD));<font></font>
$written += fwrite($handle, $EOCD);<font></font>
<font></font>
fclose($handle);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . memory_get_peak_usage(<span class="hljs-literal">true</span>) . <span class="hljs-string">' '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . $written . <span class="hljs-string">' '</span> . PHP_EOL;<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'   `unzip -tq '</span> . $destination . <span class="hljs-string">'`: '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&gt; '</span> . exec(<span class="hljs-string">'unzip -tq '</span> . $destination) . PHP_EOL;
<span class="hljs-keyword">echo</span> PHP_EOL;</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡ºåŠ›ã§ã¯ã€test.zipã¨ã„ã†åå‰ã®Zipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€ä¸Šè¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨100MB.binã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã€ã‚µã‚¤ã‚ºã¯ç´„100 MBã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã®åœ§ç¸®</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’åœ§ç¸®ã—ã€ãã®å ´ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®äº‹å®Ÿä¸Šã™ã¹ã¦ãŒæƒã„ã¾ã—ãŸã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é–¢æ•°ã«å°ã•ãªãƒãƒ£ãƒ³ã‚¯ã‚’ä¸ãˆã‚‹ã“ã¨ã§ãƒãƒƒã‚·ãƒ¥ã‚’å–å¾—ã™ã‚‹ã®ã¨åŒã˜ã‚ˆã†ã«ã€ç´ æ™´ã‚‰ã—ã„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</font><font style="vertical-align: inherit;">ã¨ãã®</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deflate_init</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚ˆã³</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deflate_addé–¢æ•°ã®</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‹ã’ã§ãƒ‡ãƒ¼ã‚¿ã‚’åœ§ç¸®ã™ã‚‹ã“ã¨ã‚‚ã§ã</font><i><font style="vertical-align: inherit;">ã¾ã™</font></i><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
</p><pre><code class="php hljs">$deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string">'level'</span> =&gt; <span class="hljs-number">6</span>]);<font></font>
$handle = fopen($source, <span class="hljs-string">'r'</span>);
<span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
    $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);
    <span class="hljs-keyword">yield</span> deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH);<font></font>
    $chunk = <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯ã“ã®ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å‡ºãã‚ã—ã¾ã—ãŸã€å‰ã®ã‚‚ã®ã¨æ¯”è¼ƒã—ã¦ã€ãã‚Œã¯æœ€å¾Œã«ã„ãã¤ã‹ã®ã‚¼ãƒ­ã‚’è¿½åŠ ã—ã¾ã™ã€‚</font></font></i><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒã‚¤ãƒ©ãƒ¼ã®è¦‹å‡ºã—</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword">while</span> (!feof($handle)) {
    <span class="hljs-keyword">yield</span> deflate_add($deflateCtx, $chunk, ZLIB_SYNC_FLUSH);<font></font>
}<font></font>
<span class="hljs-keyword">yield</span> deflate_add($deflateCtx, <span class="hljs-string">''</span>, ZLIB_FINISH);</code></pre><br>
</div></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ã‹ã—ã€è§£å‡ã‚’èª“ã£ãŸã®ã§ã€ãã®ã‚ˆã†ãªå˜ç´”åŒ–ã‚’å–ã‚Šé™¤ãå¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font></font></i><br>
<br>
<p><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªãƒ¼ãƒ€ãƒ¼ã‚’</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿®æ­£ã—ã¦</font><font style="vertical-align: inherit;">ã€ãƒ‡ãƒ¼ã‚¿ã‚’ã™ãã«åœ§ç¸®ã—ã€æœ€å¾Œã«ãƒãƒƒã‚·ãƒ¥ã€åœ§ç¸®ãªã—ã®ãƒ‡ãƒ¼ã‚¿é•·ã€ãŠã‚ˆã³åœ§ç¸®ã‚ã‚Šã®ãƒ‡ãƒ¼ã‚¿é•·ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚</font></font><br>
<br>
</p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $uncompressedSize = <span class="hljs-number">0</span>;<font></font>
    $compressedSize = <span class="hljs-number">0</span>;<font></font>
    <font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);<font></font>
    $deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string">'level'</span> =&gt; <span class="hljs-number">6</span>]);<font></font>
<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);        <font></font>
        <font></font>
        hash_update($hashCtx, $chunk);<font></font>
        $compressedChunk = deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH);<font></font>
        <font></font>
        $uncompressedSize += strlen($chunk);<font></font>
        $compressedSize += strlen($compressedChunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $compressedChunk;<font></font>
        <font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
        $compressedChunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, 
        <span class="hljs-string">'compressedSize'</span>   =&gt; $compressedSize, 
        <span class="hljs-string">'crc32'</span>            =&gt; hexdec(hash_final($hashCtx))<font></font>
    ];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
100 mbãƒ•ã‚¡ã‚¤ãƒ«ã§è©¦ã—ã¦ãã ã•ã„ï¼š</font></font><br>
<br>
<pre><code class="php hljs">$reader = read(<span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span>);
<span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {
    <span class="hljs-comment">// -   . </span><font></font>
}<font></font>
<font></font>
[<span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, <span class="hljs-string">'compressedSize'</span> =&gt; $compressedSize, <span class="hljs-string">'crc32'</span> =&gt; $crc32] = $reader-&gt;getReturn();<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'Uncompressed size: '</span> . $uncompressedSize . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'Compressed size: '</span> . $compressedSize . PHP_EOL;
<span class="hljs-keyword">echo</span> round(memory_get_peak_usage(<span class="hljs-literal">true</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>, <span class="hljs-number">2</span>) . <span class="hljs-string">'MB - Memory Peak Usage'</span> . PHP_EOL;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«ãƒ­ãƒ¼ãƒ‰ã—ãªã‹ã£ãŸã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã‚Œã‚’ã™ã¹ã¦ã¾ã¨ã‚ã¦ã€æœ€å¾Œã«æœ¬å½“ã«æœ¬ç‰©ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¢ãƒ¼ã‚«ã‚¤ãƒã‚’å…¥æ‰‹ã—ã¾ã—ã‚‡ã†ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã¯ç•°ãªã‚Šã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generalPurposeBitFlag</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒå¤‰æ›´ã•ã‚Œã¾ã™</font><font style="vertical-align: inherit;">-ç¾åœ¨ã®å€¤ã¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0018</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã‚ã‚Šã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compressionMethod</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆã¤ã¾ã‚Šã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deflate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã§ã™ã€‚</font></font><br>
<br>
</p><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€çµ‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $uncompressedSize = <span class="hljs-number">0</span>;<font></font>
    $compressedSize = <span class="hljs-number">0</span>;<font></font>
    <font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);<font></font>
    $deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string">'level'</span> =&gt; <span class="hljs-number">6</span>]);<font></font>
<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);        <font></font>
        <font></font>
        hash_update($hashCtx, $chunk);<font></font>
        $compressedChunk = deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH);<font></font>
        <font></font>
        $uncompressedSize += strlen($chunk);<font></font>
        $compressedSize += strlen($compressedChunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $compressedChunk;<font></font>
        <font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
        $compressedChunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, 
        <span class="hljs-string">'compressedSize'</span>   =&gt; $compressedSize, 
        <span class="hljs-string">'crc32'</span>            =&gt; hexdec(hash_final($hashCtx))<font></font>
    ];<font></font>
}<font></font>
<font></font>
$entries = [<span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span>, <span class="hljs-keyword">__FILE__</span>];<font></font>
<font></font>
$destination = <span class="hljs-string">'test.zip'</span>;<font></font>
$handle = fopen($destination, <span class="hljs-string">'w'</span>);<font></font>
<font></font>
$written = <span class="hljs-number">0</span>;<font></font>
$dictionary = [];<font></font>
<span class="hljs-keyword">foreach</span> ($entries <span class="hljs-keyword">as</span> $entry) {<font></font>
    $filename = basename($entry);<font></font>
    <font></font>
    $fileInfo = [<font></font>
        <span class="hljs-string">'versionToExtract'</span>      =&gt; <span class="hljs-number">10</span>,      
        <span class="hljs-comment">//   ,        0x0018  0x0008</span>
        <span class="hljs-string">'generalPurposeBitFlag'</span> =&gt; <span class="hljs-number">0x0018</span>,           
        <span class="hljs-string">'compressionMethod'</span>     =&gt; <span class="hljs-number">8</span>,     
        <span class="hljs-comment">//      : 8 - Deflate</span>
        <span class="hljs-string">'modificationTime'</span>      =&gt; <span class="hljs-number">28021</span>,                                   
        <span class="hljs-string">'modificationDate'</span>      =&gt; <span class="hljs-number">20072</span>,
        <span class="hljs-string">'crc32'</span>                 =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'compressedSize'</span>        =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'uncompressedSize'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'filenameLength'</span>        =&gt; strlen($filename),
        <span class="hljs-string">'extraFieldLength'</span>      =&gt; <span class="hljs-number">0</span>,<font></font>
    ];<font></font>
    <font></font>
    $LFH = pack(<span class="hljs-string">'LSSSSSLLLSSa*'</span>, ...array_values([
        <span class="hljs-string">'signature'</span> =&gt; <span class="hljs-number">0x04034b50</span>, <font></font>
    ] + $fileInfo + [<span class="hljs-string">'filename'</span> =&gt; $filename]));<font></font>
    <font></font>
    $fileOffset = $written;<font></font>
    $written += fwrite($handle, $LFH);<font></font>
    <font></font>
    $reader = read($entry);<font></font>
    <span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {<font></font>
        $written += fwrite($handle, $chunk);<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
<font></font>
    [<font></font>
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, 
        <span class="hljs-string">'compressedSize'</span> =&gt; $compressedSize, 
        <span class="hljs-string">'crc32'</span> =&gt; $crc32<font></font>
    ] = $reader-&gt;getReturn();<font></font>
    <font></font>
    $fileInfo[<span class="hljs-string">'crc32'</span>] = $crc32;<font></font>
    $fileInfo[<span class="hljs-string">'compressedSize'</span>] = $compressedSize;<font></font>
    $fileInfo[<span class="hljs-string">'uncompressedSize'</span>] = $uncompressedSize;<font></font>
    <font></font>
    $DD = pack(<span class="hljs-string">'LLLL'</span>, ...array_values([
        <span class="hljs-string">'signature'</span>        =&gt; <span class="hljs-number">0x08074b50</span>,
        <span class="hljs-string">'crc32'</span>            =&gt; $fileInfo[<span class="hljs-string">'crc32'</span>],
        <span class="hljs-string">'compressedSize'</span>   =&gt; $fileInfo[<span class="hljs-string">'compressedSize'</span>],
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $fileInfo[<span class="hljs-string">'uncompressedSize'</span>],<font></font>
    ]));<font></font>
    <font></font>
    $written += fwrite($handle, $DD);<font></font>
    <font></font>
    $dictionary[$filename] = [<font></font>
        <span class="hljs-string">'signature'</span>     =&gt; <span class="hljs-number">0x02014b50</span>,
        <span class="hljs-string">'versionMadeBy'</span> =&gt; <span class="hljs-number">798</span>,<font></font>
    ] + $fileInfo + [<font></font>
        <span class="hljs-string">'fileCommentLength'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'diskNumber'</span>             =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'internalFileAttributes'</span> =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'externalFileAttributes'</span> =&gt; <span class="hljs-number">2176057344</span>,
        <span class="hljs-string">'localFileHeaderOffset'</span>  =&gt; $fileOffset,
        <span class="hljs-string">'filename'</span>               =&gt; $filename,<font></font>
    ];<font></font>
}<font></font>
<font></font>
$EOCD = [<font></font>
    <span class="hljs-string">'signature'</span>                    =&gt; <span class="hljs-number">0x06054b50</span>, 
    <span class="hljs-string">'diskNumber'</span>                   =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'startDiskNumber'</span>              =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'numberCentralDirectoryRecord'</span> =&gt; $records = count($dictionary), 
    <span class="hljs-string">'totalCentralDirectoryRecord'</span>  =&gt; $records, 
    <span class="hljs-string">'sizeOfCentralDirectory'</span>       =&gt; <span class="hljs-number">0</span>, 
    <span class="hljs-string">'centralDirectoryOffset'</span>       =&gt; $written,
    <span class="hljs-string">'commentLength'</span>                =&gt; <span class="hljs-number">0</span><font></font>
];<font></font>
<font></font>
<span class="hljs-keyword">foreach</span> ($dictionary <span class="hljs-keyword">as</span> $entryInfo) {<font></font>
    $CDFH = pack(<span class="hljs-string">'LSSSSSSLLLSSSSSLLa*'</span>, ...array_values($entryInfo));<font></font>
    $written += fwrite($handle, $CDFH);<font></font>
}<font></font>
<font></font>
$EOCD[<span class="hljs-string">'sizeOfCentralDirectory'</span>] = $written - $EOCD[<span class="hljs-string">'centralDirectoryOffset'</span>];<font></font>
$EOCD = pack(<span class="hljs-string">'LSSSSLLS'</span>, ...array_values($EOCD));<font></font>
$written += fwrite($handle, $EOCD);<font></font>
<font></font>
fclose($handle);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . memory_get_peak_usage(<span class="hljs-literal">true</span>) . <span class="hljs-string">' '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . $written . <span class="hljs-string">' '</span> . PHP_EOL;<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'   `unzip -tq '</span> . $destination . <span class="hljs-string">'`: '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&gt; '</span> . exec(<span class="hljs-string">'unzip -tq '</span> . $destination) . PHP_EOL;
<span class="hljs-keyword">echo</span> PHP_EOL;</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®çµæœã€ã‚µã‚¤ã‚ºãŒ360183ãƒã‚¤ãƒˆã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãŒå¾—ã‚‰ã‚Œï¼ˆ100MBã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯éå¸¸ã«ã‚ˆãåœ§ç¸®ã•ã‚Œã€ãŸã¶ã‚“åŒä¸€ã®ãƒã‚¤ãƒˆã®ã‚»ãƒƒãƒˆã«ã™ã</font><font style="vertical-align: inherit;">ã¾ã›ã‚“</font><font style="vertical-align: inherit;">ï¼‰ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unzip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«ã‚¨ãƒ©ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã“ã¨ã‚’ç¤ºã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµè«–</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ãŒåˆ¥ã®è¨˜äº‹ã«ååˆ†ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨æ™‚é–“ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€ç§ã¯ã©ã®ã‚ˆã†ã«ã€ãã—ã¦æœ€ã‚‚é‡è¦ãªã“ã¨ã«ã¯ã€ã“ã‚ŒãŒã™ã¹ã¦ä½¿ç”¨ã§ãã‚‹ç†ç”±ã‚’ç¤ºã™ã‚ˆã†ã«åŠªã‚ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã«é–¢ã™ã‚‹ä»–ã®ã“ã¨ã«èˆˆå‘³ãŒã‚ã‚‹å ´åˆ-ã‚³ãƒ¡ãƒ³ãƒˆã§ææ¡ˆã—ã¦ãã ã•ã„ã€‚ç§ã¯ã‚ãªãŸã®è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’æä¾›ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŠãã‚‰ãã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã™ã§ã«æˆé•·ã—ã¦ãŠã‚Šã€å®Ÿéš›ã«ã¯ãã®ã‚ˆã†ãªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¯ã‚ã¾ã‚Šä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‚ˆã†ã«æ€ã‚ã‚Œã‚‹ãŸã‚ã€æš—å·åŒ–ã¯æ‰±ã„ã¾ã›ã‚“ã€‚</font></font></p><br>
<br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ãªãŸã®æ³¨æ„ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚ã‚ŠãŒã¨ã†ã€‚</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja472956/index.html">ã‚­ãƒ£ã‚¿ãƒ”ãƒ©ãƒ¼ãƒ­ãƒœãƒƒãƒˆã®æ§‹ç¯‰ã®æ­´å²</a></li>
<li><a href="../ja472958/index.html">Arduinoã§Windowsãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja472960/index.html">ã‚½ãƒ‹ãƒ¼ã®æœ€é«˜ã®ä¾¡æ ¼/å“è³ªã®ãƒ¬ãƒ³ã‚º</a></li>
<li><a href="../ja472962/index.html">ãƒ“ãƒ‡ã‚ªãƒã‚¹ãƒˆï¼šç§‘å­¦çš„è¦–è¦šåŒ–ã®ä¸€å½¢æ…‹ã¨ã—ã¦ã®å®Ÿé¨“</a></li>
<li><a href="../ja472964/index.html">çŠ¶æ³ï¼šã¾ã™ã¾ã™å¤šãã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ä¼æ¥­ãŒãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™-å°‚é–€å®¶ã®æ„è¦‹ã«ã¤ã„ã¦è©±ã—åˆã„ã¾ã™</a></li>
<li><a href="../ja472970/index.html">Telegramãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨çµ„ç¹”çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«å¯¾ã™ã‚‹æ‰¹åˆ¤ã€‚ãƒ‘ãƒ¼ãƒˆ1ã€æŠ€è¡“ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã‚¼ãƒ­ã‹ã‚‰ä½œæˆã—ãŸçµŒé¨“-TLã€MT</a></li>
<li><a href="../ja472972/index.html">ç§ãŸã¡ã¯ã€JavaScriptã‚¯ãƒ©ã‚¹ã¨ã—ã¦Cookieã‚’ä½¿ç”¨ã—ã¾ã™</a></li>
<li><a href="../ja472978/index.html">å½¼è‡ªèº«ã®æ¯å­ã®ãŸã‚ã®Arduinoã‚ªãƒ¼ã‚µãƒªãƒ³ã‚°ã‚³ãƒ¼ã‚¹</a></li>
<li><a href="../ja472980/index.html">ã‚·ãƒ§ãƒ¼ãƒ„Belokamentseva</a></li>
<li><a href="../ja472982/index.html">ã€Œæ•…éšœã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«èã„ã¦ãã ã•ã„ã€ï¼šæ•…éšœã—ãŸç”£æ¥­æ©Ÿæ¢°ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªéŒ²éŸ³ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>