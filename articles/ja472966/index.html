<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤲🏽 🤧 😅 zipアーカイブはどのように見え、それで何ができるか。パート2-データ記述子と圧縮 👃🏽 👨🏾‍🤝‍👨🏼 👉🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事の続きzipアーカイブの外観とそれで何ができるか。
 序文
 

良い一日。
 また、放送中、PHPでの型破りなプログラミングがあります。
 

以前の記事では、尊敬される読者はzip圧縮とzipストリーミングに興味を持っていました。今日は少しこのトピックを開いてみましょう。
 

見てみましょ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>zipアーカイブはどのように見え、それで何ができるか。パート2-データ記述子と圧縮</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472966/"><p><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の続き</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zipアーカイブの外観とそれで何ができるか</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i></p><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序文</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">良い一日。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、放送中、PHPでの型破りなプログラミングがあります。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前の記事では、尊敬される読者はzip圧縮とzipストリーミングに興味を持っていました。</font><font style="vertical-align: inherit;">今日は少しこのトピックを開いてみましょう。</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見てみましょう</font></font><br>
<br>
</p><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前の記事のコード</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">//        (1.txt  2.txt)   :</span><font></font>
$entries = [<font></font>
    <span class="hljs-string">'1.txt'</span> =&gt; <span class="hljs-string">'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc id ante ultrices, fermentum nibh eleifend, ullamcorper nunc. Sed dignissim ut odio et imperdiet. Nunc id felis et ligula viverra blandit a sit amet magna. Vestibulum facilisis venenatis enim sed bibendum. Duis maximus felis in suscipit bibendum. Mauris suscipit turpis eleifend nibh commodo imperdiet. Donec tincidunt porta interdum. Aenean interdum condimentum ligula, vitae ornare lorem auctor in. Suspendisse metus ipsum, porttitor et sapien id, fringilla aliquam nibh. Curabitur sem lacus, ultrices quis felis sed, blandit commodo metus. Duis tincidunt vel mauris at accumsan. Integer et ipsum fermentum leo viverra blandit.'</span>,<font></font>
    <font></font>
    <span class="hljs-string">'2.txt'</span> =&gt; <span class="hljs-string">'Mauris in purus sit amet ante tempor finibus nec sed justo. Integer ac nibh tempus, mollis sem vel, consequat diam. Pellentesque ut condimentum ex. Praesent finibus volutpat gravida. Vivamus eleifend neque sit amet diam scelerisque lacinia. Nunc imperdiet augue in suscipit lacinia. Curabitur orci diam, iaculis non ligula vitae, porta pellentesque est. Duis dolor erat, placerat a lacus eu, scelerisque egestas massa. Aliquam molestie pulvinar faucibus. Quisque consequat, dolor mattis lacinia pretium, eros eros tempor neque, volutpat consectetur elit elit non diam. In faucibus nulla justo, non dignissim erat maximus consectetur. Sed porttitor turpis nisl, elementum aliquam dui tincidunt nec. Nunc eu enim at nibh molestie porta ut ac erat. Sed tortor sem, mollis eget sodales vel, faucibus in dolor.'</span>,<font></font>
];<font></font>
<font></font>
<span class="hljs-comment">//      Lorem.zip,      cwd (      )</span>
$destination = <span class="hljs-string">'Lorem.zip'</span>;<font></font>
$handle = fopen($destination, <span class="hljs-string">'w'</span>);<font></font>
<font></font>
<span class="hljs-comment">//      ,    ,     ,   "" Central Directory File Header</span>
$written = <span class="hljs-number">0</span>;<font></font>
$dictionary = [];<font></font>
<span class="hljs-keyword">foreach</span> ($entries <span class="hljs-keyword">as</span> $filename =&gt; $content) {
    <span class="hljs-comment">//         Local File Header,    </span>
    <span class="hljs-comment">//        ,      .</span><font></font>
    <font></font>
    $fileInfo = [<font></font>
        <span class="hljs-comment">//    </span>
        <span class="hljs-string">'versionToExtract'</span>      =&gt; <span class="hljs-number">10</span>,                                      
        <span class="hljs-comment">//   0,        -</span>
        <span class="hljs-string">'generalPurposeBitFlag'</span> =&gt; <span class="hljs-number">0</span>,                                       
        <span class="hljs-comment">//      ,    0</span>
        <span class="hljs-string">'compressionMethod'</span>     =&gt; <span class="hljs-number">0</span>,                                       
        <span class="hljs-comment">// -    mtime ,    ,      ?</span>
        <span class="hljs-string">'modificationTime'</span>      =&gt; <span class="hljs-number">28021</span>,                                   
        <span class="hljs-comment">//   , ?</span>
        <span class="hljs-string">'modificationDate'</span>      =&gt; <span class="hljs-number">20072</span>,
        <span class="hljs-comment">//      .     ,       ,   ?</span>
        <span class="hljs-string">'crc32'</span>                 =&gt; hexdec(hash(<span class="hljs-string">'crc32b'</span>, $content)),
        <span class="hljs-comment">//     .        . </span>
        <span class="hljs-comment">//       :)</span>
        <span class="hljs-string">'compressedSize'</span>        =&gt; $size = strlen($content),
        <span class="hljs-string">'uncompressedSize'</span>      =&gt; $size,
        <span class="hljs-comment">//   </span>
        <span class="hljs-string">'filenameLength'</span>        =&gt; strlen($filename),
        <span class="hljs-comment">//  .    ,   0.</span>
        <span class="hljs-string">'extraFieldLength'</span>      =&gt; <span class="hljs-number">0</span>,<font></font>
    ];<font></font>
    <font></font>
    <span class="hljs-comment">//      .</span>
    $LFH = pack(<span class="hljs-string">'LSSSSSLLLSSa*'</span>, ...array_values([
        <span class="hljs-string">'signature'</span> =&gt; <span class="hljs-number">0x04034b50</span>, <span class="hljs-comment">//  Local File Header</span>
    ] + $fileInfo + [<span class="hljs-string">'filename'</span> =&gt; $filename]));<font></font>
    <font></font>
    <span class="hljs-comment">//       ,       Central Directory File Header</span><font></font>
    $dictionary[$filename] = [<font></font>
        <span class="hljs-string">'signature'</span>     =&gt; <span class="hljs-number">0x02014b50</span>, <span class="hljs-comment">//  Central Directory File Header</span>
        <span class="hljs-string">'versionMadeBy'</span> =&gt; <span class="hljs-number">798</span>,        <span class="hljs-comment">//  .    ,  -  .</span><font></font>
    ] + $fileInfo + [<font></font>
        <span class="hljs-string">'fileCommentLength'</span>      =&gt; <span class="hljs-number">0</span>,          <span class="hljs-comment">//    . No comments</span>
        <span class="hljs-string">'diskNumber'</span>             =&gt; <span class="hljs-number">0</span>,          <span class="hljs-comment">//     0,       </span>
        <span class="hljs-string">'internalFileAttributes'</span> =&gt; <span class="hljs-number">0</span>,          <span class="hljs-comment">//   </span>
        <span class="hljs-string">'externalFileAttributes'</span> =&gt; <span class="hljs-number">2176057344</span>, <span class="hljs-comment">//   </span>
        <span class="hljs-string">'localFileHeaderOffset'</span>  =&gt; $written,   <span class="hljs-comment">//      Local File Header</span>
        <span class="hljs-string">'filename'</span>               =&gt; $filename,  <span class="hljs-comment">//  .</span><font></font>
    ];<font></font>
    <font></font>
    <span class="hljs-comment">//     </span><font></font>
    $written += fwrite($handle, $LFH);<font></font>
    <span class="hljs-comment">//   </span><font></font>
    $written += fwrite($handle, $content);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ,     ,    .</span>
<span class="hljs-comment">//          End of central directory record (EOCD)</span><font></font>
$EOCD = [<font></font>
    <span class="hljs-comment">//  EOCD</span>
    <span class="hljs-string">'signature'</span>                    =&gt; <span class="hljs-number">0x06054b50</span>, 
    <span class="hljs-comment">//  .    ,   0</span>
    <span class="hljs-string">'diskNumber'</span>                   =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-comment">//      -  0</span>
    <span class="hljs-string">'startDiskNumber'</span>              =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-comment">//       .</span>
    <span class="hljs-string">'numberCentralDirectoryRecord'</span> =&gt; $records = count($dictionary), 
    <span class="hljs-comment">//    .    ,    </span>
    <span class="hljs-string">'totalCentralDirectoryRecord'</span>  =&gt; $records, 
    <span class="hljs-comment">//   Central Directory Record. </span>
    <span class="hljs-comment">//      ,     </span>
    <span class="hljs-string">'sizeOfCentralDirectory'</span>       =&gt; <span class="hljs-number">0</span>, 
    <span class="hljs-comment">// ,    Central Directory Records</span>
    <span class="hljs-string">'centralDirectoryOffset'</span>       =&gt; $written,
    <span class="hljs-comment">//    </span>
    <span class="hljs-string">'commentLength'</span>                =&gt; <span class="hljs-number">0</span><font></font>
];<font></font>
<font></font>
<span class="hljs-comment">//     !  </span>
<span class="hljs-keyword">foreach</span> ($dictionary <span class="hljs-keyword">as</span> $entryInfo) {<font></font>
    $CDFH = pack(<span class="hljs-string">'LSSSSSSLLLSSSSSLLa*'</span>, ...array_values($entryInfo));<font></font>
    $written += fwrite($handle, $CDFH);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ,   .  ,   </span>
$EOCD[<span class="hljs-string">'sizeOfCentralDirectory'</span>] = $written - $EOCD[<span class="hljs-string">'centralDirectoryOffset'</span>];<font></font>
    <font></font>
<span class="hljs-comment">//     End of central directory record</span>
$EOCD = pack(<span class="hljs-string">'LSSSSLLS'</span>, ...array_values($EOCD));<font></font>
$written += fwrite($handle, $EOCD);<font></font>
<font></font>
<span class="hljs-comment">//  . </span><font></font>
fclose($handle);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . $written . <span class="hljs-string">' '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'     `unzip -tq '</span> . $destination . <span class="hljs-string">'`'</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> PHP_EOL;
</code></pre><br>
</div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼の問題は何ですか？まあ、公平に言うと、その唯一の利点は、それが機能することと、そこに問題があることですが、それでもなお注目に値します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の意見では、主な問題は、まず</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルファイルヘッダー（LFH）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crc32</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とファイル長で</font><font style="vertical-align: inherit;">書き込み、</font><font style="vertical-align: inherit;">次にファイル自体の内容を書き込む必要があることです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは何を脅かしていますか？または、ファイル全体をメモリにロードし、そのためにcrc32を検討し、LFHを書き込み</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ファイルのコンテンツはI / Oの点で経済的ですが、大きなファイルでは受け入れられません。または、ファイルを2回読み取ります-最初にハッシュを計算し、次に内容を読み取ってアーカイブに書き込みます-RAMの観点からは経済的ですが、たとえば、最初にドライブの負荷が2倍になり、必ずしもSSDではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ファイルがリモートにあり、そのボリュームが、たとえば1.5GBの場合はどうでしょうか。 1.5GBをすべてメモリにロードするか、これらの1.5GBがすべてダウンロードされるまで待ち、ハッシュを計算してから再度ダウンロードしてコンテンツを取得する必要があります。その場合、たとえばstdoutから読み取ったダンプデータベースなどをオンザフライで提供したい場合、これは一般に受け入れられません-データベース内のデータが変更され、ダンプデータが変更され、完全に異なるハッシュが存在し、無効なアーカイブが取得されます。もちろん、物事は悪いです。</font></font></p><br>
<h3> Data Descriptor     </h3><br>
<p>  ,  ZIP     ,     <b>Data Descriptor (DD)</b>  ,      crc32,        .     <strike> 3    </strike>  <b>LFH </b> <b>generalPurposeBitFlag </b> <b>0x0008</b>,  <b>crc32</b>, <b>compressedSize</b>  <b>uncompressedSize</b>  <b>0</b>.       <b>DD</b>,    - :</p><br>
<br>
<pre><code class="php hljs">pack(<span class="hljs-string">'LLLL'</span>, ...array_values([
    <span class="hljs-string">'signature'</span>        =&gt; <span class="hljs-number">0x08074b50</span>,        <span class="hljs-comment">//  Data Descriptor       </span>
    <span class="hljs-string">'crc32'</span>            =&gt; $crc32,            <span class="hljs-comment">//  crc32   </span>
    <span class="hljs-string">'compressedSize'</span>   =&gt; $compressedSize,   <span class="hljs-comment">//   </span>
    <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, <span class="hljs-comment">//    .</span>
]));</code></pre><br>
<p>  <b>Central Directory File Header (CDFH)</b>   <b>generalPurposeBitFlag</b>,     .    ,   <b>CDFH</b>     ,           .</p><br>
<p> , , .     PHP.<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Hash</a>      .     ,        ,      . ,      ,  <i>hash('crc32b', $content)</i>,         . <br>
<br>
   - :<br>
<br>
</p><pre><code class="php hljs">$hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);<font></font>
$handle = fopen($source, <span class="hljs-string">'r'</span>);
<span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
    $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);<font></font>
    hash_update($hashCtx, $chunk);<font></font>
    $chunk = <span class="hljs-literal">null</span>;<font></font>
}<font></font>
<font></font>
$hash = hash_final($hashCtx);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが正しく行われていれば、値は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash_file（ 'crc32b'、$ source）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash（ 'crc32b'、file_get_content（$ source））とまったく同じになり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これを何らかの方法で1つの関数にラップして、ファイルを便利な方法で読み取って、最後にハッシュと長さを取得できるようにしましょう。</font><font style="vertical-align: inherit;">そしてジェネレーターはこれを助けてくれます：</font></font><br>
<br>
</p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $length = <span class="hljs-number">0</span>;<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);<font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);<font></font>
        <font></font>
        $length += strlen($chunk);<font></font>
        hash_update($hashCtx, $chunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $chunk;<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; hexdec(hash_final($hashCtx))];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして今、私たちはちょうどできます </font></font><br>
<br>
<pre><code class="php hljs">$reader = read(<span class="hljs-string">'https://speed.hetzner.de/1GB.bin'</span>);
<span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {
    <span class="hljs-comment">// -   . </span><font></font>
}<font></font>
<span class="hljs-comment">//      .</span>
[<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; $crc32] = $reader-&gt;getReturn(); 
<span class="hljs-keyword">echo</span> round(memory_get_peak_usage(<span class="hljs-literal">true</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>, <span class="hljs-number">2</span>) . <span class="hljs-string">'MB - Memory Peak Usage'</span> . PHP_EOL;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の意見では、それは非常にシンプルで便利です。</font><font style="vertical-align: inherit;">1 GBのファイルを使用した場合、ピーク時のメモリ消費量は2 MBでした。</font></font><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、前の記事のコードを変更して、この関数を使用できるようにします。</font></font><br>
<br>
</p><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終スクリプト</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $length = <span class="hljs-number">0</span>;<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);<font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);<font></font>
        <font></font>
        $length += strlen($chunk);<font></font>
        hash_update($hashCtx, $chunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $chunk;<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; hexdec(hash_final($hashCtx))];<font></font>
}<font></font>
<font></font>
$entries = [<span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span>, <span class="hljs-keyword">__FILE__</span>];<font></font>
<font></font>
$destination = <span class="hljs-string">'test.zip'</span>;<font></font>
$handle = fopen($destination, <span class="hljs-string">'w'</span>);<font></font>
<font></font>
$written = <span class="hljs-number">0</span>;<font></font>
$dictionary = [];<font></font>
<span class="hljs-keyword">foreach</span> ($entries <span class="hljs-keyword">as</span> $entry) {<font></font>
    $filename = basename($entry);<font></font>
    <font></font>
    $fileInfo = [<font></font>
        <span class="hljs-string">'versionToExtract'</span>      =&gt; <span class="hljs-number">10</span>,      
        <span class="hljs-comment">//       Data Descriptor,     00008, </span>
        <span class="hljs-comment">//   00000    .</span>
        <span class="hljs-string">'generalPurposeBitFlag'</span> =&gt; <span class="hljs-number">0x0008</span>,           
        <span class="hljs-string">'compressionMethod'</span>     =&gt; <span class="hljs-number">0</span>,                                       
        <span class="hljs-string">'modificationTime'</span>      =&gt; <span class="hljs-number">28021</span>,                                   
        <span class="hljs-string">'modificationDate'</span>      =&gt; <span class="hljs-number">20072</span>,
        <span class="hljs-string">'crc32'</span>                 =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'compressedSize'</span>        =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'uncompressedSize'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'filenameLength'</span>        =&gt; strlen($filename),
        <span class="hljs-string">'extraFieldLength'</span>      =&gt; <span class="hljs-number">0</span>,<font></font>
    ];<font></font>
    <font></font>
    $LFH = pack(<span class="hljs-string">'LSSSSSLLLSSa*'</span>, ...array_values([
        <span class="hljs-string">'signature'</span> =&gt; <span class="hljs-number">0x04034b50</span>, <font></font>
    ] + $fileInfo + [<span class="hljs-string">'filename'</span> =&gt; $filename]));<font></font>
    <font></font>
    $fileOffset = $written;<font></font>
    $written += fwrite($handle, $LFH);<font></font>
    <font></font>
    <span class="hljs-comment">//    </span><font></font>
    $reader = read($entry);<font></font>
    <span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {
        <span class="hljs-comment">//     </span><font></font>
        $written += fwrite($handle, $chunk);<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//      </span>
    [<span class="hljs-string">'length'</span> =&gt; $length, <span class="hljs-string">'crc32'</span> =&gt; $crc32] = $reader-&gt;getReturn();<font></font>
    <font></font>
    <span class="hljs-comment">//    fileInfo,     CDFH</span>
    $fileInfo[<span class="hljs-string">'crc32'</span>] = $crc32;<font></font>
    $fileInfo[<span class="hljs-string">'compressedSize'</span>] = $length;<font></font>
    $fileInfo[<span class="hljs-string">'uncompressedSize'</span>] = $length;<font></font>
    <font></font>
    <span class="hljs-comment">//  Data Descriptor</span>
    $DD = pack(<span class="hljs-string">'LLLL'</span>, ...array_values([
        <span class="hljs-string">'signature'</span>        =&gt; <span class="hljs-number">0x08074b50</span>,
        <span class="hljs-string">'crc32'</span>            =&gt; $fileInfo[<span class="hljs-string">'crc32'</span>],
        <span class="hljs-string">'compressedSize'</span>   =&gt; $fileInfo[<span class="hljs-string">'compressedSize'</span>],
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $fileInfo[<span class="hljs-string">'uncompressedSize'</span>],<font></font>
    ]));<font></font>
    <font></font>
    $written += fwrite($handle, $DD);<font></font>
    <font></font>
    $dictionary[$filename] = [<font></font>
        <span class="hljs-string">'signature'</span>     =&gt; <span class="hljs-number">0x02014b50</span>,
        <span class="hljs-string">'versionMadeBy'</span> =&gt; <span class="hljs-number">798</span>,<font></font>
    ] + $fileInfo + [<font></font>
        <span class="hljs-string">'fileCommentLength'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'diskNumber'</span>             =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'internalFileAttributes'</span> =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'externalFileAttributes'</span> =&gt; <span class="hljs-number">2176057344</span>,
        <span class="hljs-string">'localFileHeaderOffset'</span>  =&gt; $fileOffset,
        <span class="hljs-string">'filename'</span>               =&gt; $filename,<font></font>
    ];<font></font>
}<font></font>
<font></font>
$EOCD = [<font></font>
    <span class="hljs-string">'signature'</span>                    =&gt; <span class="hljs-number">0x06054b50</span>, 
    <span class="hljs-string">'diskNumber'</span>                   =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'startDiskNumber'</span>              =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'numberCentralDirectoryRecord'</span> =&gt; $records = count($dictionary), 
    <span class="hljs-string">'totalCentralDirectoryRecord'</span>  =&gt; $records, 
    <span class="hljs-string">'sizeOfCentralDirectory'</span>       =&gt; <span class="hljs-number">0</span>, 
    <span class="hljs-string">'centralDirectoryOffset'</span>       =&gt; $written,
    <span class="hljs-string">'commentLength'</span>                =&gt; <span class="hljs-number">0</span><font></font>
];<font></font>
<font></font>
<span class="hljs-keyword">foreach</span> ($dictionary <span class="hljs-keyword">as</span> $entryInfo) {<font></font>
    $CDFH = pack(<span class="hljs-string">'LSSSSSSLLLSSSSSLLa*'</span>, ...array_values($entryInfo));<font></font>
    $written += fwrite($handle, $CDFH);<font></font>
}<font></font>
<font></font>
$EOCD[<span class="hljs-string">'sizeOfCentralDirectory'</span>] = $written - $EOCD[<span class="hljs-string">'centralDirectoryOffset'</span>];<font></font>
$EOCD = pack(<span class="hljs-string">'LSSSSLLS'</span>, ...array_values($EOCD));<font></font>
$written += fwrite($handle, $EOCD);<font></font>
<font></font>
fclose($handle);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . memory_get_peak_usage(<span class="hljs-literal">true</span>) . <span class="hljs-string">' '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . $written . <span class="hljs-string">' '</span> . PHP_EOL;<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'   `unzip -tq '</span> . $destination . <span class="hljs-string">'`: '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&gt; '</span> . exec(<span class="hljs-string">'unzip -tq '</span> . $destination) . PHP_EOL;
<span class="hljs-keyword">echo</span> PHP_EOL;</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力では、test.zipという名前のZipアーカイブが得られます。このファイルには、上記のスクリプトと100MB.binのファイルがあり、サイズは約100 MBです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zipアーカイブでの圧縮</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これで、データを圧縮し、その場で実行するための事実上すべてが揃いました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数に小さなチャンクを与えることでハッシュを取得するのと同じように、素晴らしい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリ</font><font style="vertical-align: inherit;">とその</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deflate_init</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deflate_add関数の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おかげでデータを圧縮することもでき</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
</p><pre><code class="php hljs">$deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string">'level'</span> =&gt; <span class="hljs-number">6</span>]);<font></font>
$handle = fopen($source, <span class="hljs-string">'r'</span>);
<span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
    $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);
    <span class="hljs-keyword">yield</span> deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH);<font></font>
    $chunk = <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はこのようなオプションに出くわしました、前のものと比較して、それは最後にいくつかのゼロを追加します。</font></font></i><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スポイラーの見出し</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword">while</span> (!feof($handle)) {
    <span class="hljs-keyword">yield</span> deflate_add($deflateCtx, $chunk, ZLIB_SYNC_FLUSH);<font></font>
}<font></font>
<span class="hljs-keyword">yield</span> deflate_add($deflateCtx, <span class="hljs-string">''</span>, ZLIB_FINISH);</code></pre><br>
</div></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、解凍を誓ったので、そのような単純化を取り除く必要がありました。</font></font></i><br>
<br>
<p><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リーダーを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修正して</font><font style="vertical-align: inherit;">、データをすぐに圧縮し、最後にハッシュ、圧縮なしのデータ長、および圧縮ありのデータ長を返すようにします。</font></font><br>
<br>
</p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $uncompressedSize = <span class="hljs-number">0</span>;<font></font>
    $compressedSize = <span class="hljs-number">0</span>;<font></font>
    <font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);<font></font>
    $deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string">'level'</span> =&gt; <span class="hljs-number">6</span>]);<font></font>
<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);        <font></font>
        <font></font>
        hash_update($hashCtx, $chunk);<font></font>
        $compressedChunk = deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH);<font></font>
        <font></font>
        $uncompressedSize += strlen($chunk);<font></font>
        $compressedSize += strlen($compressedChunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $compressedChunk;<font></font>
        <font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
        $compressedChunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, 
        <span class="hljs-string">'compressedSize'</span>   =&gt; $compressedSize, 
        <span class="hljs-string">'crc32'</span>            =&gt; hexdec(hash_final($hashCtx))<font></font>
    ];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
100 mbファイルで試してください：</font></font><br>
<br>
<pre><code class="php hljs">$reader = read(<span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span>);
<span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {
    <span class="hljs-comment">// -   . </span><font></font>
}<font></font>
<font></font>
[<span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, <span class="hljs-string">'compressedSize'</span> =&gt; $compressedSize, <span class="hljs-string">'crc32'</span> =&gt; $crc32] = $reader-&gt;getReturn();<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'Uncompressed size: '</span> . $uncompressedSize . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'Compressed size: '</span> . $compressedSize . PHP_EOL;
<span class="hljs-keyword">echo</span> round(memory_get_peak_usage(<span class="hljs-literal">true</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>, <span class="hljs-number">2</span>) . <span class="hljs-string">'MB - Memory Peak Usage'</span> . PHP_EOL;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモリ使用量は、ファイル全体をメモリにロードしなかったことを示しています。</font></font><br>
<br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それをすべてまとめて、最後に本当に本物のスクリプトアーカイバを入手しましょう。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のバージョンとは異なり、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generalPurposeBitFlag</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が変更されます</font><font style="vertical-align: inherit;">-現在の値は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0018</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compressionMethod</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（つまり、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deflate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）です。</font></font><br>
<br>
</p><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終スクリプト</font></font></b><div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $path</span>): \<span class="hljs-title">Generator</span> 
</span>{<font></font>
    $uncompressedSize = <span class="hljs-number">0</span>;<font></font>
    $compressedSize = <span class="hljs-number">0</span>;<font></font>
    <font></font>
    $hashCtx = hash_init(<span class="hljs-string">'crc32b'</span>);<font></font>
    $deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string">'level'</span> =&gt; <span class="hljs-number">6</span>]);<font></font>
<font></font>
    $handle = fopen($path, <span class="hljs-string">'r'</span>);
    <span class="hljs-keyword">while</span> (!feof($handle)) {<font></font>
        $chunk = fread($handle, <span class="hljs-number">8</span> * <span class="hljs-number">1024</span>);        <font></font>
        <font></font>
        hash_update($hashCtx, $chunk);<font></font>
        $compressedChunk = deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH);<font></font>
        <font></font>
        $uncompressedSize += strlen($chunk);<font></font>
        $compressedSize += strlen($compressedChunk);<font></font>
        <font></font>
        <span class="hljs-keyword">yield</span> $compressedChunk;<font></font>
        <font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
        $compressedChunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    fclose($handle);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, 
        <span class="hljs-string">'compressedSize'</span>   =&gt; $compressedSize, 
        <span class="hljs-string">'crc32'</span>            =&gt; hexdec(hash_final($hashCtx))<font></font>
    ];<font></font>
}<font></font>
<font></font>
$entries = [<span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span>, <span class="hljs-keyword">__FILE__</span>];<font></font>
<font></font>
$destination = <span class="hljs-string">'test.zip'</span>;<font></font>
$handle = fopen($destination, <span class="hljs-string">'w'</span>);<font></font>
<font></font>
$written = <span class="hljs-number">0</span>;<font></font>
$dictionary = [];<font></font>
<span class="hljs-keyword">foreach</span> ($entries <span class="hljs-keyword">as</span> $entry) {<font></font>
    $filename = basename($entry);<font></font>
    <font></font>
    $fileInfo = [<font></font>
        <span class="hljs-string">'versionToExtract'</span>      =&gt; <span class="hljs-number">10</span>,      
        <span class="hljs-comment">//   ,        0x0018  0x0008</span>
        <span class="hljs-string">'generalPurposeBitFlag'</span> =&gt; <span class="hljs-number">0x0018</span>,           
        <span class="hljs-string">'compressionMethod'</span>     =&gt; <span class="hljs-number">8</span>,     
        <span class="hljs-comment">//      : 8 - Deflate</span>
        <span class="hljs-string">'modificationTime'</span>      =&gt; <span class="hljs-number">28021</span>,                                   
        <span class="hljs-string">'modificationDate'</span>      =&gt; <span class="hljs-number">20072</span>,
        <span class="hljs-string">'crc32'</span>                 =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'compressedSize'</span>        =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'uncompressedSize'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'filenameLength'</span>        =&gt; strlen($filename),
        <span class="hljs-string">'extraFieldLength'</span>      =&gt; <span class="hljs-number">0</span>,<font></font>
    ];<font></font>
    <font></font>
    $LFH = pack(<span class="hljs-string">'LSSSSSLLLSSa*'</span>, ...array_values([
        <span class="hljs-string">'signature'</span> =&gt; <span class="hljs-number">0x04034b50</span>, <font></font>
    ] + $fileInfo + [<span class="hljs-string">'filename'</span> =&gt; $filename]));<font></font>
    <font></font>
    $fileOffset = $written;<font></font>
    $written += fwrite($handle, $LFH);<font></font>
    <font></font>
    $reader = read($entry);<font></font>
    <span class="hljs-keyword">foreach</span> ($reader <span class="hljs-keyword">as</span> $chunk) {<font></font>
        $written += fwrite($handle, $chunk);<font></font>
        $chunk = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
<font></font>
    [<font></font>
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $uncompressedSize, 
        <span class="hljs-string">'compressedSize'</span> =&gt; $compressedSize, 
        <span class="hljs-string">'crc32'</span> =&gt; $crc32<font></font>
    ] = $reader-&gt;getReturn();<font></font>
    <font></font>
    $fileInfo[<span class="hljs-string">'crc32'</span>] = $crc32;<font></font>
    $fileInfo[<span class="hljs-string">'compressedSize'</span>] = $compressedSize;<font></font>
    $fileInfo[<span class="hljs-string">'uncompressedSize'</span>] = $uncompressedSize;<font></font>
    <font></font>
    $DD = pack(<span class="hljs-string">'LLLL'</span>, ...array_values([
        <span class="hljs-string">'signature'</span>        =&gt; <span class="hljs-number">0x08074b50</span>,
        <span class="hljs-string">'crc32'</span>            =&gt; $fileInfo[<span class="hljs-string">'crc32'</span>],
        <span class="hljs-string">'compressedSize'</span>   =&gt; $fileInfo[<span class="hljs-string">'compressedSize'</span>],
        <span class="hljs-string">'uncompressedSize'</span> =&gt; $fileInfo[<span class="hljs-string">'uncompressedSize'</span>],<font></font>
    ]));<font></font>
    <font></font>
    $written += fwrite($handle, $DD);<font></font>
    <font></font>
    $dictionary[$filename] = [<font></font>
        <span class="hljs-string">'signature'</span>     =&gt; <span class="hljs-number">0x02014b50</span>,
        <span class="hljs-string">'versionMadeBy'</span> =&gt; <span class="hljs-number">798</span>,<font></font>
    ] + $fileInfo + [<font></font>
        <span class="hljs-string">'fileCommentLength'</span>      =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'diskNumber'</span>             =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'internalFileAttributes'</span> =&gt; <span class="hljs-number">0</span>,
        <span class="hljs-string">'externalFileAttributes'</span> =&gt; <span class="hljs-number">2176057344</span>,
        <span class="hljs-string">'localFileHeaderOffset'</span>  =&gt; $fileOffset,
        <span class="hljs-string">'filename'</span>               =&gt; $filename,<font></font>
    ];<font></font>
}<font></font>
<font></font>
$EOCD = [<font></font>
    <span class="hljs-string">'signature'</span>                    =&gt; <span class="hljs-number">0x06054b50</span>, 
    <span class="hljs-string">'diskNumber'</span>                   =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'startDiskNumber'</span>              =&gt; <span class="hljs-number">0</span>,          
    <span class="hljs-string">'numberCentralDirectoryRecord'</span> =&gt; $records = count($dictionary), 
    <span class="hljs-string">'totalCentralDirectoryRecord'</span>  =&gt; $records, 
    <span class="hljs-string">'sizeOfCentralDirectory'</span>       =&gt; <span class="hljs-number">0</span>, 
    <span class="hljs-string">'centralDirectoryOffset'</span>       =&gt; $written,
    <span class="hljs-string">'commentLength'</span>                =&gt; <span class="hljs-number">0</span><font></font>
];<font></font>
<font></font>
<span class="hljs-keyword">foreach</span> ($dictionary <span class="hljs-keyword">as</span> $entryInfo) {<font></font>
    $CDFH = pack(<span class="hljs-string">'LSSSSSSLLLSSSSSLLa*'</span>, ...array_values($entryInfo));<font></font>
    $written += fwrite($handle, $CDFH);<font></font>
}<font></font>
<font></font>
$EOCD[<span class="hljs-string">'sizeOfCentralDirectory'</span>] = $written - $EOCD[<span class="hljs-string">'centralDirectoryOffset'</span>];<font></font>
$EOCD = pack(<span class="hljs-string">'LSSSSLLS'</span>, ...array_values($EOCD));<font></font>
$written += fwrite($handle, $EOCD);<font></font>
<font></font>
fclose($handle);<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . memory_get_peak_usage(<span class="hljs-literal">true</span>) . <span class="hljs-string">' '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'  : '</span> . $written . <span class="hljs-string">' '</span> . PHP_EOL;<font></font>
<font></font>
<span class="hljs-keyword">echo</span> <span class="hljs-string">'   `unzip -tq '</span> . $destination . <span class="hljs-string">'`: '</span> . PHP_EOL;
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&gt; '</span> . exec(<span class="hljs-string">'unzip -tq '</span> . $destination) . PHP_EOL;
<span class="hljs-keyword">echo</span> PHP_EOL;</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、サイズが360183バイトのアーカイブが得られ（100MBのファイルは非常によく圧縮され、たぶん同一のバイトのセットにすぎ</font><font style="vertical-align: inherit;">ません</font><font style="vertical-align: inherit;">）、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unzip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はアーカイブにエラーが見つからなかったことを示しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私が別の記事に十分なエネルギーと時間を持っている場合、私はどのように、そして最も重要なことには、これがすべて使用できる理由を示すように努めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このトピックに関する他のことに興味がある場合-コメントで提案してください。私はあなたの質問に対する回答を提供しようとします。</font><font style="vertical-align: inherit;">おそらくスクリプトはすでに成長しており、実際にはそのようなアーカイブはあまり使用されていないように思われるため、暗号化は扱いません。</font></font></p><br>
<br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたの注意とコメントをありがとう。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja472956/index.html">キャタピラーロボットの構築の歴史</a></li>
<li><a href="../ja472958/index.html">ArduinoでWindowsプログラムを作成する方法</a></li>
<li><a href="../ja472960/index.html">ソニーの最高の価格/品質のレンズ</a></li>
<li><a href="../ja472962/index.html">ビデオポスト：科学的視覚化の一形態としての実験</a></li>
<li><a href="../ja472964/index.html">状況：ますます多くのオープンソース企業がライセンスを変更しています-専門家の意見について話し合います</a></li>
<li><a href="../ja472970/index.html">Telegramプロトコルと組織的アプローチに対する批判。パート1、技術：クライアントをゼロから作成した経験-TL、MT</a></li>
<li><a href="../ja472972/index.html">私たちは、JavaScriptクラスとしてCookieを使用します</a></li>
<li><a href="../ja472978/index.html">彼自身の息子のためのArduinoオーサリングコース</a></li>
<li><a href="../ja472980/index.html">ショーツBelokamentseva</a></li>
<li><a href="../ja472982/index.html">「故障を見つけるために聞いてください」：故障した産業機械のオーディオ録音が公開されました</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>