<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë© üîå üöë Xiaomi Gateway (versi√≥n de la UE - Lumi.gateway.mieu01) pirateado üì∑ üö¥üèø ‚úçüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Xiaomi Zigbee Gateway Hack
 
 En este art√≠culo quiero compartir con ustedes mis mejores pr√°cticas y √©xitos en el an√°lisis de la puerta de enlace Xiaom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Xiaomi Gateway (versi√≥n de la UE - Lumi.gateway.mieu01) pirateado</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494296/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xiaomi Zigbee Gateway Hack</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En este art√≠culo quiero compartir con ustedes mis mejores pr√°cticas y √©xitos en el an√°lisis de la puerta de enlace Xiaomi (Versi√≥n con euro plug con I take.ru). </font><font style="vertical-align: inherit;">Te dir√© c√≥mo instalar un software alternativo en √©l, c√≥mo restaurar una puerta de enlace con un software borrado e incluso revivir una puerta de enlace con un arranque en U borrado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------- MUCHAS FOTOS -------------</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/aa/to/qs/aatoqssn86dgak8fgyoirmaiyae.png"><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En primer lugar, te dir√© c√≥mo conectarte a la placa de la puerta de enlace y obtener la ra√≠z. </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, algunos detalles sobre la puerta de enlace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo analiza la versi√≥n de la puerta de enlace integrada en el procesador </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imx6ull</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunas especificaciones t√©cnicas de la placa:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wifi RTL8723BS: el controlador se carga por separado por alg√∫n motivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU IMX6ULL</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM 256 mb</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROM 256 mb</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo ZIgbee basado en JN5169.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el tablero, se muestran los dimes de servicio, P2 y P4. Idealmente, se hacen debajo de las pogopins, pero son m√°s f√°ciles de soldar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
P2 es la verruga 0 del procesador donde se muestra toda la informaci√≥n del servicio, el registro de arranque uboot y la administraci√≥n del sistema, puede usar cualquier adaptador usb-uart. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
P4: USB OTG, que se utiliza para cargar firmware a nand. (Como un OTG completo, hasta el final no pude iniciarlo, cuando estaba conectado, se detecta el dispositivo, pero aparentemente falta algo m√°s). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ia/zf/wn/iazfwn64giouka5exv5urahv-1w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La placa adaptadora usb china es ideal para los apodos P4. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/na/ty/7a/naty7aswx3muah3ityxjrswxq_s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que todo est√© soldado y conectado, primero debe obtener la ra√≠z. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo hice de acuerdo con estas instrucciones </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(enlace al manual),</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pero con una peque√±a aclaraci√≥n despu√©s del punto 5, debe escribir el comando de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arranque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de lo contrario, el sistema se sienta y espera un comando, las instrucciones probablemente fueron escritas con la esperanza de que todos entiendan Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por alguna raz√≥n, el servidor SSH no se encendi√≥ de acuerdo con las instrucciones y se encendi√≥ solo manualmente al iniciar el comando para iniciar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/init.d/dropbear start.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El siguiente paso, despu√©s de recibir la ra√≠z, copi√© el contenido del sistema usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinScp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (seleccionamos el modo SCP al crear la conexi√≥n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, debe hacer una copia de seguridad del sistema completo, en caso de que los experimentos tengan consecuencias tristes (como lo hice, pero no hice una copia de seguridad). La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
memoria flash de la puerta de enlace se divide en 4 secciones. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lx/kb/qs/lxkbqs0mfj1ggqsaz5hftqbyzpw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result√≥ que tampoco hay mucho espacio libre, mientras que en la memoria hay muchos archivos duplicados diferentes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/sl/5m/cisl5mcfvpafxdna0tzjs2w7iko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de jugar durante un par de horas, cambi√© algo en el software y la puerta de enlace dej√≥ de cargar :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora, descubramos c√≥mo revivir este pedazo de hierro y llenarlo con cualquier cosa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Realiza acciones solo si tienes un ladrillo!</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El procesador Imx6ULL contiene toda la informaci√≥n en forma abierta, todos los paneles de datos y manuales de referencia est√°n disponibles en el sitio web del fabricante despu√©s del registro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
U-boot todav√≠a me estaba cargando ... Pero mientras intentaba recuperarme, copi√© accidentalmente un comando adicional y limpi√© completamente la nand. Y u-boot, como result√≥, estaba en Nanda. Y √©l consigui√≥ un ladrillo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El procesador admite varios modos de arranque. En el manual de referencia, se describen todos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/dq/qb/nudqqbeastlqyzr8ttgb4cpahti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las placas de desarrollo generalmente tienen interruptores, pero no hay nada de eso. La hoja de datos describe qu√© tipo de dimes de procesador es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/ca/nx/xbcanxw13rmesy3gosochuueqio.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y luego los chinos tambi√©n hicieron un muy buen regalo. Los llevaron a un lugar muy conveniente y casi los firmaron) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la placa junto al procesador, se sueldan dos resistencias, donde los pines del modo de arranque simplemente encajan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/mq/ak/vjmqakv9dquslukw8leus3myyra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas dos resistencias son solo interruptores de los modos de arranque, de forma predeterminada se configura como nand, pero al mover cada uno de ellos hacia el lado obtenemos el modo de arranque en serie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transfer√≠ mi puerta de enlace al modo de arranque en serie, de alguna manera este modo es m√°s conveniente para probar varios firmware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cargar el firmware, se utiliza una utilidad patentada de NXP mfgtools. Lo √∫nico que hay es preparar un perfil para el procesador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mfgtools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El archivo ya est√° preparado versi√≥n con todas las configuraciones necesarias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conectamos la puerta de enlace a trav√©s de USB. En el modo de arranque en serie, la puerta de enlace intentar√° descargar el firmware a trav√©s de la interfaz USB y aparecer√° un nuevo dispositivo HID en la computadora. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mfgtools, a su vez, le informar√° que ve un nuevo dispositivo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/dc/hg/xbdchgif-86a8uy3htahr8_xey4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces la computadora no lo ve, con lo que est√° conectado no puedo decirlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez que la utilidad lo haya visto, haga clic en Inicio y comenzar√° el proceso de descarga del firmware. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La utilidad formatear√° el nand, inundar√° el nuevo ubut, kernel, dtb y rootfs. Los rootfs en el archivo fueron compilados por un amigo Aleksandr Faronov, √©l cre√≥ una compilaci√≥n limpia de Linux en Yocto. Las secciones U-boot, Kernel, DTB se extrajeron del firmware nativo de la puerta de enlace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ensamblado de Linux, solo se iniciar√° un sistema limpio, no habr√° nada m√°s (</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zigby tampoco funciona todav√≠a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de que la utilidad funcione en mi caso, la puerta de enlace no har√° nada y tampoco se cargar√°, ya que recordamos el procesador en el modo de arranque en serie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, debe recibir una imagen de arranque U-boot. </font><font style="vertical-align: inherit;">En el archivo con mfgtools hay una utilidad adicional uuu que realiza la carga de arranque en U en el Ram de la placa, vamos a la carpeta que lo contiene. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cerramos mfgtools y volvemos a conectar la puerta de enlace con una nueva, el dispositivo HID debe detectarse nuevamente, luego ejecutamos el comando.</font></font><br>
<br>
<pre><code class="plaintext hljs">uuu u-boot-small.imx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La placa comenzar√° a cargarse, pero como no tiene env, se levantar√° despu√©s de cargar U-boot. </font><font style="vertical-align: inherit;">En la consola de la puerta de enlace, ejecutamos dos comandos, registramos ENV para cargar.</font></font><br>
<br>
<pre><code class="plaintext hljs">setenv bootargs 'console=ttymxc0,115200 ubi.mtd=3 root=ubi0:rootfs rootfstype=ubifs cma=96M mtdparts=gpmi-nand:3m(boot),7m(kernel),1m(dtb),-(rootfs)'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e inicie el arranque de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arranque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la puerta de enlace comienza a cargarse desde nanda y desde el firmware que cargamos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/oi/n5/9voin5jgztxajypsqjkol1ki-p0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, eso es todo. </font><font style="vertical-align: inherit;">En mfgtools, en la carpeta \ Profiles \ Linux \ OS Firmware \ files, se encuentran todos los archivos de firmware, reemplazando los cuales puede cargar cualquier sistema compatible. </font><font style="vertical-align: inherit;">Intent√© descargar openwrt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wf/qy/ye/wfqyyekyy177yvbh0uczs_aryoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema se est√° cargando, pero a√∫n no he descubierto c√≥mo deslizar el n√∫cleo correcto y d√≥nde conseguirlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que con esfuerzos conjuntos podamos llevar esta puerta de enlace a su conclusi√≥n l√≥gica) </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copia de seguridad de los directorios de la puerta de enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegrama para discusi√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es494284/index.html">Antis√©ptico casero de lo que hay en la farmacia. Hacemos alcohol con vodka sin alcohol a la antigua usanza</a></li>
<li><a href="../es494286/index.html">Embox RTOS en Raspberry Pi</a></li>
<li><a href="../es494290/index.html">#YAMYWork. Una decisi√≥n que puede ser correcta</a></li>
<li><a href="../es494292/index.html">Wrike: 5 a√±os con OKR</a></li>
<li><a href="../es494294/index.html">Impresi√≥n 3D certificada para las industrias de petr√≥leo y gas y marina.</a></li>
<li><a href="../es494298/index.html">Enviado para los peque√±os.</a></li>
<li><a href="../es494300/index.html">Delegar la gesti√≥n de sesiones RDP</a></li>
<li><a href="../es494302/index.html">Objetivos del d√≠a como herramienta de gesti√≥n de equipos.</a></li>
<li><a href="../es494304/index.html">30 consejos UX en realidad aumentada</a></li>
<li><a href="../es494308/index.html">Lo que te espera en Space 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>