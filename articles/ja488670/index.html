<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈸 👍 👩🏻‍🌾 マスクレジスタについて 🌹 🐤 🐌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="AVX-512命令セットには、8つのいわゆるマスクレジスタ[1]（k0 [2]からk7まで）が含まれていました。これらはほとんどのALU演算での使用に適しており、デスティネーションレジスタ[3]でデータをゼロ化またはマージすることでベクトル要素に対してマスク演算を実行できるため、コードを高速化し、A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>マスクレジスタについて</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/488670/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVX-512命令セットには、8つのいわゆるマスクレジスタ[1]（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [2]から</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k7</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まで）が</font><i><font style="vertical-align: inherit;">含ま</font></i><font style="vertical-align: inherit;">れてい</font><i><font style="vertical-align: inherit;">ました</font></i><font style="vertical-align: inherit;">。これらはほとんどのALU演算での使用に適しており、デスティネーションレジスタ[3]でデータをゼロ化またはマージすることでベクトル要素に対してマスク演算を実行できるため、コードを高速化し、AVX2命令セットおよび以前のバージョンで追加のマージ演算が必要になります。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記がマスクレジスターのカルトのフォロワーになるのに十分でない場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウィキペディアの記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からの抜粋を引用します</font><font style="vertical-align: inherit;">。これが最終的に理解できるようになることを願っています。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほとんどのAVX-512コマンドは、8つのマスクレジスタ（k0〜k7）のいずれかに対応するオペランドマスクを使用できます。マスクレジスタが演算マスクとして使用される場合、k0レジスタは他のマスクレジスタとは異なる動作をします。この場合、このレジスタは、この演算ではマスクが適用されないことを示すハードコードされた定数として機能します。ただし、算術演算と論理演算、およびレジスタをマスクするために値を書き込む場合、k0は通常の作業レジスタのように動作します。ほとんどのコマンドでは、マスクレジスタは、出力レジスタに書き込むアイテムを決定するマスクとして使用されます。オペランドマスクの動作はフラグによって異なります。フラグが設定されている場合、選択されていないすべての要素がリセットされます（「ゼロ化」モード、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロ）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）そうでない場合、選択されていないすべての要素は以前の状態を保持</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます（</font><i><font style="vertical-align: inherit;">マージ</font></i><font style="vertical-align: inherit;">モード、</font><i><font style="vertical-align: inherit;">マージ</font></i><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">マージモードは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブレンド命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と同じ効果があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、マスクレジスタ[4]は重要な革新ですが、たとえば、汎用レジスタ（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eax</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など）またはSIMDレジスタ（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xmm0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ymm5</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など）</font><font style="vertical-align: inherit;">とは対照的に、それらが記憶されることはほとんどありません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">マイクロアーキテクチャリソースのサイズを示すIntelのプレゼンテーションでは、マスクレジスタは言及されていません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xa/ty/eq/xatyeq9cozm0-7xfqmlxg4caffo.png" alt="画像"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の知る限りでは</font><font style="vertical-align: inherit;">、マスクレジスタ</font><font style="vertical-align: inherit;">の物理レジスタファイル（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理レジスタファイル、PRF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の</font><font style="vertical-align: inherit;">サイズに関する情報</font><font style="vertical-align: inherit;">も公開されていません。それを修正します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は、</font><font style="vertical-align: inherit;">コマンドの並べ替えバッファー（</font><i><font style="vertical-align: inherit;">ROB</font></i><font style="vertical-align: inherit;">）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">を測定するため</font></a><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ツールの</font></a><font style="vertical-align: inherit;">修正版を使用しました</font><font style="vertical-align: inherit;">。これは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、Henry Wong</font></a><font style="vertical-align: inherit;"> [5]（以下、単にHenry）</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">によって</font></a><font style="vertical-align: inherit;">作成および</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">記述されてい</font></a><font style="vertical-align: inherit;">ます。このツールを使用して</font><font style="vertical-align: inherit;">、以前のアーキテクチャ</font><font style="vertical-align: inherit;">での</font><i><font style="vertical-align: inherit;">異常な実行の</font></i><font style="vertical-align: inherit;">文書化された構造と文書化されていない構造のサイズを計算しました</font><font style="vertical-align: inherit;">。ヘンリーのメモを読んでいない場合は、停止して戻ってください。そして私の記事は待ちます。</font><font style="vertical-align: inherit;">
さて、読んで？危害を加えるために、ヘンリーの記事の要約を以下に示します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2>     ROB</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュミスのある2つの読み取り命令の間にいくつかの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バラスト命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">挿入されます[6]。</font><font style="vertical-align: inherit;">正確な数は、測定するプロセッサリソースによって異なります。バラストコマンドがそれほど多くない場合、両方のキャッシュミスが並行して処理されるため、それらの遅延は重複し、合計実行時間は、1つのキャッシュミスの場合とほぼ同じ[7]になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、バラストコマンドの数が特定のクリティカルしきい値を超えると、対応するリソースが完全に使い果たされ、ROB内のチームの配置が停止してから、キャッシュミスのある2番目のコマンドが発行されます。この場合、それらの並列処理は不可能であり、合計時間はそのような1つの操作の時間のほぼ2倍になり、グラフに鋭いジャンプとして反映されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、テストは、チームがチェック対象のリソースの正確に1ユニットを使用するように作成されます。この場合、グラフのピークピークはその合計ボリュームを示します。</font><font style="vertical-align: inherit;">したがって、標準の汎用コマンドは、原則として、汎用PRFレジスタから1つの物理レジスタを使用するため、特定のリソースのボリュームを測定するのに最適です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスクレジスタの物理レジスタファイルのサイズ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテストでは、マスクレジスタに値を書き込むコマンドを実行して、これらのレジスタのPRFサイズを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一連のチーム</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kaddd k1、k2、k3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から始めましょう</font><font style="vertical-align: inherit;">（16のバラストチームが表示されています）。</font></font><br>
<br>
<pre><code class="cpp hljs">mov    rcx,QWORD PTR [rcx]  ;    -<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
kaddd  k1,k2,k3<font></font>
mov    rdx,QWORD PTR [rdx]  ;    -<font></font>
lfence                      ;      ,    <font></font>
                            ;   <font></font>
;     <span class="hljs-number">16</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kaddd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">は、1つの物理マスクレジスタを使用します。バラストコマンドの数がマスクレジスタの数以下の場合、キャッシュミスは並列処理され、それ以外の場合はシーケンシャルモードで処理されます。したがって、並列モードから順次モードに切り替えると、グラフに急激なジャンプが見られ、実行時間の増加を示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがまさに私たちが観察していることです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gu/0u/0s/gu0u0s6phxsglrya170shjhls30.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上昇を詳しく見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/ve/yl/ixveylwsz7jjcbdwnoxcfqynjbu.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今見ているように、ジャンプは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それほどシャープで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はあり</font><i><font style="vertical-align: inherit;">ません</font></i><font style="vertical-align: inherit;">。130から134までのバラストコマンドの数では、実行速度は最小レベルと最大レベルの間の中間値を取ります。ヘンリーはこの行動を</font><i><font style="vertical-align: inherit;">不完全だ</font></i><font style="vertical-align: inherit;">と呼びます</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;全部ではありませんが、これらのテストの多くでそれを観察しました。事実、ハードウェアの実装では、リソースが限界に近づくにつれて、リソースが完全に使い尽くされるとは限らない[8]-場合によってはこれが成功することもあれば、少数のチームだけが理論的な最大に足りないこともある。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに関しては、速度が低速モードよりもまだ高い最後から2番目の上昇点に興味があります。このポイントは、使用可能なリソースユニットの数を示します。つまり、少なくとも同じ数の物理レジスタが存在します。ご覧のとおり、この場合は約134にあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、SKXに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、マスクレジスタの推測値（予測実行で取得）を格納できる物理レジスタが134個あります</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ヘンリーは、8つのマスクレジスタの現在のアーキテクチャ状態を格納するためにさらに8つが使用されることを示唆しています。そのため、それらのPRFの全量は142と見積もることができます。これは、汎用レジスタ（180）およびSIMDレジスタ（168）のファイルのサイズよりわずかに小さいですかなりたくさんあります（</font><font style="vertical-align: inherit;">他のプラットフォーム用の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">並外れた実行のリソースのサイズの表を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このファイルが十分に大きいため、実際に完全に占有する時間がない場合：コマンドのほぼ60％[9]がマスクレジスタに[10]を書き込む実際のコードを想像することは困難です。 。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの異なるレジストリファイルはありますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
お気づきのとおり、これまでのところ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、デフォルト</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではマスクレジスタPRFは他のタイプのレジスタファイルと交差しない別個のファイルである</font><i><font style="vertical-align: inherit;">と想定し</font></i><font style="vertical-align: inherit;">ています。これは、マスクレジスタの動作原理と、それらがレジスタの名前を変更するための別のドメインの一部であるという事実に基づいている可能性が非常に高いと思います[11]。私の仮定を支持する別の議論は、PRFマスクレジスターの観測されたサイズが、汎用レジスターファイルまたはSIMDレジスターファイルのサイズと一致しないという事実です。実際、これをテストで受けてテストすることができます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテストは前のテストに似てい</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">が、現在は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kadddコマンド</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汎用レジスターまたはSIMDレジスターを使用するコマンドと交互になります。マスクレジスタが同じレジスタファイルの最初または2番目のレジスタと組み合わされている場合、グラフのジャンプは対応するPRFのサイズを示しているはずです。レジスタファイルがマージされない場合、他のいくつかの制限に遭遇します。これは、2つのレジスタファイルのいずれかのサイズとは異なりますが、たとえばROBのサイズと同じになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト29</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kadddコマンド</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とスカラー</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">の代替</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs">mov    rcx,QWORD PTR [rcx]<font></font>
add    ebx,ebx<font></font>
kaddd  k1,k2,k3<font></font>
add    esi,esi<font></font>
kaddd  k1,k2,k3<font></font>
add    ebx,ebx<font></font>
kaddd  k1,k2,k3<font></font>
add    esi,esi<font></font>
kaddd  k1,k2,k3<font></font>
add    ebx,ebx<font></font>
kaddd  k1,k2,k3<font></font>
add    esi,esi<font></font>
kaddd  k1,k2,k3<font></font>
add    ebx,ebx<font></font>
kaddd  k1,k2,k3<font></font>
mov    rdx,QWORD PTR [rdx]<font></font>
lfence</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフを見て</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/ew/hc/vhewhcthcquksk66f8wircsk6n4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ください。ご覧のとおり、ピークを占めるバラストチームの数は、PRF汎用レジスターとマスクレジスターのサイズよりも大きくなっています。</font><font style="vertical-align: inherit;">このことから、マスクレジスタは汎用レジスタファイルに含まれていないと結論付けます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、それらはSIMDレジスタファイルに含まれているのでしょうか？</font><font style="vertical-align: inherit;">結局のところ、マスクレジスタは、汎用コマンドよりもSIMDコマンドに関連付けられています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確認するには、テスト35を使用します。テスト35は、テスト29と同じですが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kadddコマンド</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">vxorpsコマンドと</font></i><font style="vertical-align: inherit;">交互になっている</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点が異なり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">mov    rcx,QWORD PTR [rcx]<font></font>
vxorps ymm0,ymm0,ymm1<font></font>
kaddd  k1,k2,k3<font></font>
vxorps ymm2,ymm2,ymm3<font></font>
kaddd  k1,k2,k3<font></font>
vxorps ymm4,ymm4,ymm5<font></font>
kaddd  k1,k2,k3<font></font>
vxorps ymm6,ymm6,ymm7<font></font>
kaddd  k1,k2,k3<font></font>
vxorps ymm0,ymm0,ymm1<font></font>
kaddd  k1,k2,k3<font></font>
vxorps ymm2,ymm2,ymm3<font></font>
kaddd  k1,k2,k3<font></font>
vxorps ymm4,ymm4,ymm5<font></font>
kaddd  k1,k2,k3<font></font>
mov    rdx,QWORD PTR [rdx]<font></font>
lfence</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフ：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/66/r4/zj/66r4zjzixtvauqfascucqdqk5tq.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテストでは、前のテストと同じ動作が見られるため、マスクレジスタとSIMDレジスタのレジスタファイルも分離されていると結論付けます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未解決の謎</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それにもかかわらず、どちらのテストでも、このマイクロアーキテクチャのROBサイズは224ですが、ピークの終わりは約212コマンドに達します。これは、</font><font style="vertical-align: inherit;">以前にすでに観察し</font><font style="vertical-align: inherit;">た</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不完全な動作に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すぎないの</font><font style="vertical-align: inherit;">でしょうか。さて、これをチェックしてみましょう：これら2つのテストの結果をテスト4の結果と比較します。ここでは、バラストコマンドとして</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nop</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドのみが使用されています</font><font style="vertical-align: inherit;">。ROBを除いて、他のリソースを消費するべきではありません。試験4（のグラフ比較</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）及び試験29（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kaddd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及びスカラー</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加算</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互に</font><font style="vertical-align: inherit;">）</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/1y/re/ch1yream9tyqh6opy8t2343ai0q.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低速モードの開始は正確に224マークにあります（ベクトル画像なので、それらを増やして自分で確認できます）。 212（この時点から、汎用レジスタまたはSIMDレジスタとマスクレジスタを交互に使用するとスローモードが開始する）であることがわかります。これが他のリソースの制限です。比較試験4と-実際には、我々は、我々の代替汎用レジスタとSIMDレジスタがあっても、同じ制限に遭遇</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">試験21</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（これは汎用レジスタとSIMD添加組み合わせ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vxorpsコマンド</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：）</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fg/ha/2r/fgha2rlaljpa5z1qrazmq3eb8am.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたの中</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、下に同じ見出し（「未解決の謎」）を持つヘンリーは同じ効果を説明しますが、さらに顕著です：</font></font><br>
<blockquote>  ,     AVS  SSE  Sandy Bridge      147 ,       ROB.    (,     ,   AVX-   ,  NOP-),    ,    SSE/AVX,     ,   -   ,        147,        –  ,       .</blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詳細については、ヘンリーの記事を参照してください。</font><font style="vertical-align: inherit;">同様の影響が見られますが、それほど顕著ではありません。ROBボリュームの95％を占めることに成功しましたが、完全に使い果たしていません。</font><font style="vertical-align: inherit;">おそらく、不可解なレジスターの共通プールは、解放のメカニズム、たとえば、コマンドの完了時に解放できるレジスターを追跡するPRRTテーブル[12]に関連付けられています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、マスクレジスタのいくつかの機能について説明し、汎用レジスタとSIMDレジスタで使用できる最適化メカニズムがそれらに適用できるかどうかを確認します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">置換をコピー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
汎用またはSIMDコマンドの場合、いわゆる</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移動除去</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を適用できます</font><font style="vertical-align: inherit;">。この最適化により、レジスタの名前を変更するメカニズムにより、あるレジスタから別のレジスタに値をコピーするコマンド（たとえば、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov eax</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vmovdqu ymm1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ymm2）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を実行できなくなります。</font><font style="vertical-align: inherit;">代わり</font><font style="vertical-align: inherit;">に、</font><i><font style="vertical-align: inherit;">デスティネーション</font></i><font style="vertical-align: inherit;">レジスタは「単純に」[13] RATのソースレジスタに再割り当てされます。 ALUを使用せずに実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、コピーの置き換えが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmov k1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドに適用できるかどうかを確認します</font><font style="vertical-align: inherit;">。まず、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト28</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のグラフを見てください</font><font style="vertical-align: inherit;">。ここで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmovd k1は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バラストチームです</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<img src="https://habrastorage.org/webt/wc/s3/jc/wcs3jcnzmjp4pffpopov47ybtg4.png" alt="画像"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このグラフは、前に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kaddd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドで説明したテスト27とまったく同じに見えます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、同じように動作し、同じサイズのコピーを置き換えるときに使用される他のリソースを誤って使い果たした場合を除いて、入力されるのは物理レジスタであると想定するのが妥当です[14]。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uops.info Webサイトで追加の確認が見つかりました。</font><font style="vertical-align: inherit;">マスクレジスタ間</font><font style="vertical-align: inherit;">の</font><i><font style="vertical-align: inherit;">kmov</font></i><font style="vertical-align: inherit;"> copy </font><i><font style="vertical-align: inherit;">コマンドの</font></i><font style="vertical-align: inherit;">すべてのバリアントが、</font><font style="vertical-align: inherit;">ポート</font><i><font style="vertical-align: inherit;">p0で</font></i><font style="vertical-align: inherit;">実行される1つのマイクロオペレーションを占有し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ていると述べ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">代替コピーがあった場合、ポートでのアクティビティは観察されません。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このことから、マスクレジスタ[15]を使用するコピーコマンドは置き換えられないと結論付けます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中毒イディオム</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86アーキテクチャーで汎用レジスター</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">を</font></a><font style="vertical-align: inherit;">無効にする</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">最善の方法</font></a><font style="vertical-align: inherit;">は、排他的ORイディオム（xor）を使用することです：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xor reg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その動作は、この演算を使用して値をそれ自体と比較するとゼロになるという事実に基づいています。</font><font style="vertical-align: inherit;">このコマンドは、明白な</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mov eax</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よりも短く（バイト数は少なく）、さらに</font><font style="vertical-align: inherit;">高速です。これは、プロセッサが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リセットイディオムで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あることをプロセッサが理解し</font><font style="vertical-align: inherit;">、必要なレジスタの名前変更を実行するため[16]、ALUとポートのロードが不要になるためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、このイディオムはデータの依存関係を排除します。通常、コマンド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xor reg1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">reg2の</font></i><font style="vertical-align: inherit;">結果</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg2レジスタ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の値に依存しますが、</font><i><font style="vertical-align: inherit;">reg1</font></i><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">reg2に</font></i><font style="vertical-align: inherit;">同じ値が含まれる特殊なケースでは、依存関係はありません。入力値の場合、出力はゼロになるためです。最近のすべてのx86プロセッサは、この[17]特殊なケースを認識します。同じことは、XORイディオムのこれらのバージョンのために真であること、使用のSIMDレジスタ、すなわち</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vpxor</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">業務</font><font style="vertical-align: inherit;">整数との</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vxorps</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vxorpd操作</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実数では。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、好奇心旺盛な読者が尋ねるかもしれません：このイディオム</font><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">kxorコマンドの</font></i><font style="vertical-align: inherit;">同様の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バリアント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">動作し</font><font style="vertical-align: inherit;">ますか？たとえば、</font><i><font style="vertical-align: inherit;">kxorb k1、k1、k1</font></i><font style="vertical-align: inherit;"> [18] </font><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">はリセットイディオムと見なされますか？</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、リセットイディオムの使用による影響は2つのコンポーネントで構成されるため、これらは2つの異なる質問です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行モジュールをバイパスするゼロ遅延実行（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行除去</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存関係の排除</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各質問には個別に対応します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">置換実行</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで、xorを使用するコマンド、たとえば</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxorb k1、k1、k1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、実行モジュールに配置されずにレジスタを再割り当てすることで置き換えることができますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
番号。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はそれを証明するために自分で何もする必要はありません。すべての情報はuops.info Webサイトにあります。彼らは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのようなテスト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を実施し</font><font style="vertical-align: inherit;">、このコマンドが1クロックサイクルの遅延で実行され、ポート</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p0で</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1つのマイクロ操作を実行することを示したためです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、マスクレジスタのxorリセットイディオムは機能しません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存関係の排除</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、実行モジュールに配置する必要がある場合でも、kxorを使用してイディオムをリセットしてもデータの依存関係が解消される場合はどうでしょうか。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでuops.infoは役に立ちません。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドに</font><font style="vertical-align: inherit;">は1クロックサイクルの遅延があり、単一のポート（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）で</font><font style="vertical-align: inherit;">実行される</font><font style="vertical-align: inherit;">ため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><i><font style="vertical-align: inherit;">チェーン</font></i><font style="vertical-align: inherit;">が依存関係があるかどうかに関係なく、同じ速度で実行される</font><font style="vertical-align: inherit;">という興味深い（？）状況があります。</font><font style="vertical-align: inherit;">能力1コマンド/サイクルは、遅延1コマンド/サイクルと同じパフォーマンス低下をもたらします！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何もありません。まだいくつかのトリックがあります。次のテストは、この質問に答えるのに役立ちます。</font><i><font style="vertical-align: inherit;">kxorを</font></i><font style="vertical-align: inherit;">埋め込む</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドのチェーンで、後続の各コマンドは前のコマンドに依存し、このチェーンの合計実行時間はボトルネックを形成するのに十分な大きさである必要があります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドで</font><font style="vertical-align: inherit;">依存関係が解消されない</font><font style="vertical-align: inherit;">場合、</font><font style="vertical-align: inherit;">チェーンの合計実行時間は、構成コマンドの遅延の合計に等しくなります。依存関係がなくなると、チェーンは短いシーケンスに分割され、遅延がオーバーラップし、実行の速度はスループットの制限値によって制限されます（たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポートの競合に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関連付けられ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">）。これはスキームを使用して明確に示すことができますが、私はこれに強いわけではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてのテストは、ベンチマーク</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><i><font style="vertical-align: inherit;">uarch</font></i></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ベンチ</font></a><font style="vertical-align: inherit;">にあります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、私が以下に与える重要なポイント。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、汎用レジスターから標準コピー時間を測定し、その逆も同様です。</font></font><br>
<br>
<pre><code class="cpp hljs">kmovb k0, eax<font></font>
kmovb eax, k0<font></font>
;   <span class="hljs-number">127</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのコマンドのペアは、4つのメジャーで[19]実行されます。それらのそれぞれにどれだけの時間がかかるかは正確にはわかりません：2メジャーまたは1メジャー、そして3メジャーは他のメジャー[20]？ただし、私たちのタスクの場合、前後にコピーする合計時間に関心があるため、これは無関係です。各コマンドは独自のポート（</font><font style="vertical-align: inherit;">それぞれ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p5</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）で</font><font style="vertical-align: inherit;">実行されるため、このシーケンスの帯域幅は1クロックサイクルであり、これは遅延の4倍の速さ</font><font style="vertical-align: inherit;">です。これは、帯域幅の影響から遅延の影響を分離できることを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、チェーンに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドを含めます</font><font style="vertical-align: inherit;">。これは、ケースのリセットにつながらないことが保証されています。</font></font><br>
<br>
<pre><code class="cpp hljs">kmovb k0, eax<font></font>
kxorb k0, k0, k1<font></font>
kmovb eax, k0<font></font>
;   <span class="hljs-number">127</span> </code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">kxorbに</font></i><font style="vertical-align: inherit;">は1クロックサイクルの遅延がある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことがわかっ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ている</font><font style="vertical-align: inherit;">
ので</font><font style="vertical-align: inherit;">、合計実行時間は5サイクルに増加するはずです。これは、テストが示すものです（最初の2つのテストの結果が表示されています）。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs">**   avx512 :  AVX512 **<font></font>
                                       <font></font>
mov  GP  kreg                    <span class="hljs-number">4.00</span>         <span class="hljs-number">1.25</span><font></font>
mov  GP  kreg   + <font></font>
kxorb                              <span class="hljs-number">5.00</span>         <span class="hljs-number">1.57</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後に、メインのテスト：</font></font><br>
<pre><code class="cpp hljs">kmovb k0, eax<font></font>
kxorb k0, k0, k0<font></font>
kmovb eax, k0<font></font>
;   <span class="hljs-number">127</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回は</font><font style="vertical-align: inherit;">、ケースをリセットし</font><font style="vertical-align: inherit;">て</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxorb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドを使用します</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxorb k0、k0、k0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">レジスタk0の値への依存がなくなる場合、これは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmovb eax、k0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">が以前の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmovb k0、eax</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドに依存しなくなった</font><font style="vertical-align: inherit;">ことと、チェーンが壊れて総実行時間が減少</font><font style="vertical-align: inherit;">することを意味</font><font style="vertical-align: inherit;">します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドラムロール... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の例と同じように、すべて同じ5.0メジャーを取得しました。</font></font><br>
<br>
<pre><code class="cpp hljs">**   avx512 :  AVX512 **<font></font>
                                     <font></font>
mov  GP  kreg                   <span class="hljs-number">4.00</span>         <span class="hljs-number">1.25</span><font></font>
mov  GP  kreg   + <font></font>
kxorb                             <span class="hljs-number">5.00</span>         <span class="hljs-number">1.57</span><font></font>
mov  GP  kreg   + <font></font>
kxorb                             <span class="hljs-number">5.00</span>         <span class="hljs-number">1.57</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
予備的な結論は次のとおりです。マスクのレジスタに適用された場合、リセットイディオムはプロセッサによって認識されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我々は交換する：結論として、私たちは必ず私たちの推論が正しい作るために別のテストを実施します</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kxorの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でコマンドを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmovの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">ご存知のように、、、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依存関係を削除します。</font></font><br>
<br>
<pre><code class="cpp hljs">kmovb k0, eax<font></font>
kmovb k0, ecx<font></font>
kmovb eax, k0<font></font>
;   <span class="hljs-number">127</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終的な回答を以下に示します。</font><font style="vertical-align: inherit;">最後のテストははるかに高速です-わずか2クロックサイクルで、ボトルネックはポート</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p5です</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（両方の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kmov k、r32コマンド</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はこのポートでのみ実行されます）。</font></font><br>
<br>
<pre><code class="cpp hljs">**   avx512 :  AVX512 **<font></font>
                                       <font></font>
mov  GP  kreg                   <span class="hljs-number">4.00</span>            <span class="hljs-number">1.25</span><font></font>
mov  GP  kreg   + <font></font>
kxorb                             <span class="hljs-number">5.00</span>            <span class="hljs-number">1.57</span><font></font>
mov  GP  kreg   + <font></font>
kxorb                             <span class="hljs-number">5.00</span>            <span class="hljs-number">1.57</span><font></font>
mov  GP  kreg   + <font></font>
mov  GP                                  <span class="hljs-number">2.00</span>            <span class="hljs-number">0.63</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの仮定は正しいことがわかります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再生結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinuxまたはWindows（WSLの下）で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">robsize</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
実行可能ファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実行することにより、この記事に示されたすべての結果を自分で再現できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それら</font><font style="vertical-align: inherit;">を収集してプロットするための</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">スクリプト</font></a><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">同様</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、リポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">も利用でき</font></a><font style="vertical-align: inherit;">ます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SKXアーキテクチャのマスクレジスタは、別の物理レジスタファイルにあります。</font><font style="vertical-align: inherit;">それらの134は投機的な値を格納するように設計されており、マスクレジスタの総数は142です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この数値は、他のタイプのレジスタファイルやROBバッファのサイズと同等であり、マスクレジスタを操作するときにパフォーマンスの低下を経験しないほど十分に大きい</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスクレジスタを含むコピーコマンドは置き換えられません</font></font></li>
<li>  [21]               </li>
</ul><br>
<ol>
<li>   <i>k-</i>   <i>kregs</i> –  -. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>,  <i>k</i>     –           «» (<i>m</i>)   «» (<i>f</i>). </li>
<li>   (             AVX-512  ),  <i>k0</i> –     ,      , ,    .    : <i>k0</i> –   ,     ,     ,     <i>k</i>,   SIMD-,     (,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   AVX-512).    SIMD-  <i>k0</i>    ,                . </li>
<li>        ,        -,        0,  ,          .  , ,    ,  ,  -   -      . </li>
<li>       « »,     <i>kreg</i> –        (  <i>k0</i>, <i>k1</i>  ..), –    «kreg»  « » ( ). </li>
<li>H. Wong, <i>Measuring Reorder Buffer Capacity</i>, May, 2013. [Online]. (. , «    »,  2013. -.) : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">blog.stuffedcow.net/2013/05/measuring-rob-capacity</a></li>
<li>        100  300 .     ,              -    2     50  100 ,     –   2,5 (,  2   5 ).     TLB-/               .</li>
<li> «»     .   ,       ,  .            . ,   29       104,    ,    –  ,     200.      ,   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>)    –   ,   -           (         ),        . </li>
<li> , , ,                 (<i>register alias table, RAT</i>),      .  RAT  ,     ,        ,        ,       .     RAT      ,                ,    . </li>
<li> 60%   134  224, ..    PRF     ROB.   ,      ROB   224  ,        ,   ,      [10]   60% ,   ROB. ,       -  ,   60%   ,       ROB,    <i></i>.</li>
<li> ,        ,    . ,      (, SIMD-   ),     . [2]</li>
<li>    ,          .  ,   2      2  SIMD- (    ),  4   . </li>
<li>    <i>Physical Register Reclaim Table</i> (   )  <i>Post Retirement Reclaim Table</i> (     ).</li>
<li>        –   ,    «  », ..   ,        ,        .        ,    .     :       ,       . </li>
<li> ,        ( 7)   ,      PRF         ROB. </li>
<li> ,           ,     ,     .  ,             ( ,  ,      ,       –      ). </li>
<li>        RAT  ,           RAT  , ,     . </li>
<li>      <i>xor</i>,              ,  <i>sub reg,reg</i>   <i>sbb reg, reg</i>.     ,      <i>reg</i>  0  -1 (  )     .    ,     <i>reg</i>, –     ,            .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>           . </li>
<li> ,      :   <i>kxorb k1, k1, k1</i>   ,        <i>kxorb k1, k2, k2</i>. </li>
<li> ,    ,      <br>
<br>
<pre><code class="cpp hljs">./uarch-bench.sh --test-name=avx512<span class="hljs-comment">/*. </span></code></pre><br>
</li>
<li>  uops.info   <i>kmov r32, k,</i>   <i>kmov k, 32</i>    <i>&lt;= 3</i>.  ,       4 .          1 , ,         3 . </li>
<li>,      xor,      , , -, ,         .  ,    :     ,            . </li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja488660/index.html">Reactを忘れてSvelteにアップグレードする時がきましたか？</a></li>
<li><a href="../ja488662/index.html">すべてのWeb開発者が必要とするブラウザ拡張</a></li>
<li><a href="../ja488664/index.html">完璧なツールキットを見つける：人気のあるPythonプロジェクトテンプレートの分析</a></li>
<li><a href="../ja488666/index.html">すべての機会のための10の反応コンポーネント</a></li>
<li><a href="../ja488668/index.html">CI / CDチェーンとDocker自動化</a></li>
<li><a href="../ja488672/index.html">UARTによるARM Cortex-Mマイクロコントローラーのデバッグ</a></li>
<li><a href="../ja488674/index.html">ExcelとPowerPointを使用したインフォグラフィック</a></li>
<li><a href="../ja488678/index.html">Node.jsでの小さなバッファの大きな競争</a></li>
<li><a href="../ja488680/index.html">Zimbra OSEスパムメーリングリスト</a></li>
<li><a href="../ja488682/index.html">Pythonプログラミングスキルをテストする方法 Yandexからのタスク</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>