<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤢 🛒 👏 "Utilisons Kubernetes!" Vous avez maintenant 8 problèmes 📁 🚵 👩‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous utilisez Docker, la prochaine étape logique semble passer à Kubernetes, ce sont les K8, non? Eh bien, supposez. Cependant, les solutions conçu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>"Utilisons Kubernetes!" Vous avez maintenant 8 problèmes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/it-grad/blog/493142/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous utilisez Docker, la prochaine étape logique semble passer à Kubernetes, ce sont les K8, non? </font><font style="vertical-align: inherit;">Eh bien, supposez. </font><font style="vertical-align: inherit;">Cependant, les solutions conçues pour 500 ingénieurs logiciels développant simultanément une seule application sont très différentes des solutions pour 50 personnes. </font><font style="vertical-align: inherit;">Et la solution pour une équipe de 5 programmeurs est une autre histoire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous travaillez dans une petite équipe, Kubernetes n'est probablement pas pour vous. </font><font style="vertical-align: inherit;">Cela vous apportera beaucoup de douleur en échange d'avantages extrêmement modestes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons pourquoi cela peut arriver.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout le monde aime les «pièces mobiles»</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes bouge et change beaucoup: concepts, sous-systèmes, processus, machines, code ... Et tout cela signifie beaucoup de difficultés.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plusieurs voitures</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes est un système distribué: il a une machine hôte qui contrôle le reste, les travailleurs. </font><font style="vertical-align: inherit;">Chaque machine effectue des travaux dans des conteneurs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous parlons donc déjà d'au moins deux machines physiques ou virtuelles, qui ne sont nécessaires que pour le faire fonctionner. </font><font style="vertical-align: inherit;">Mais en fait, vous obtenez ... une seule voiture. </font><font style="vertical-align: inherit;">Si vous allez évoluer (c'est là que le chien est enterré!), Vous aurez besoin de trois, quatre ou peut-être jusqu'à dix-sept machines virtuelles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Très, beaucoup de code</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base de code Kubernetes au début du mois de mars 2020 comprend plus de 580 000 lignes de code sur Go. Et ce n'est que du code propre, à l'exclusion des commentaires, des lignes vides et des packages de fournisseurs. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'examen de la sécurité de 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> décrit la base de code comme suit: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
«La base de code Kubernetes peut être considérablement améliorée. Il est grand et complexe, contient de grandes sections de code avec une documentation minimale et un grand nombre de dépendances, y compris des systèmes qui ne font pas partie de Kubernetes. Dans la base de code, il existe également de nombreux cas de réimplémentation de la logique, qui pourraient être centralisés dans les bibliothèques de support, ce qui réduirait la complexité, simplifierait les corrections et réduirait la charge des documents dans divers domaines de la base de code. »</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour être honnête, on peut en dire autant de nombreux autres grands projets, mais tout ce code devrait fonctionner correctement si vous ne voulez pas que votre application échoue.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Complexité architecturale, opérationnelle, de configuration et conceptuelle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes est un système complet avec de nombreux services, systèmes et plus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de pouvoir lancer votre seule application, vous devrez fournir l'architecture considérablement simplifiée suivante (l'image d'origine est tirée de la documentation de Kubernetes): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w2/rx/h8/w2rxh88tfa7n3dmfhvyrahxjd0k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La documentation du concept K8s comprend de nombreux éléments purement «éducatifs», tels que l'extrait de code suivant:</font></font><br>
<blockquote>In Kubernetes, an EndpointSlice contains references to a set of network endpoints. The EndpointSlice controller automatically creates EndpointSlices for a Kubernetes Service when a selector is specified. These EndpointSlices will include references to any Pods that match the Service selector. EndpointSlices group network endpoints together by unique Service and Port combinations.<br>
By default, EndpointSlices managed by the EndpointSlice controller will have no more than 100 endpoints each. Below this scale, EndpointSlices should map 1:1 with Endpoints and Services and have similar performance.</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, je comprends de quoi il s'agit, mais faites attention au nombre de concepts que vous devez apprendre: EndpointSlice, Service, selector, Pod, Endpoint. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et - oui, la plupart du temps, vous n'utiliserez pas toutes ces fonctionnalités. Par conséquent, la plupart du temps, vous n'aurez pas du tout besoin de Kubernetes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un autre extrait aléatoire:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par défaut, le trafic envoyé à un service ClusterIP ou NodePort peut être acheminé vers n'importe quelle adresse principale du service. </font><font style="vertical-align: inherit;">Depuis Kubernetes 1.7, il a été possible d'acheminer le trafic «externe» vers les pods exécutés sur le nœud qui a reçu le trafic, mais cela n'est pas pris en charge pour les services ClusterIP, et les topologies plus complexes - telles que le routage zonal - n'ont pas été possibles. </font><font style="vertical-align: inherit;">La fonctionnalité Topologie de service résout ce problème en permettant au créateur du service de définir une stratégie de routage du trafic en fonction des étiquettes de nœud pour les nœuds d'origine et de destination.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici ce que la revue de sécurité en dit:</font></font><br>
<blockquote>Kubernetes —   ,    .   ,     Kubernetes —  ,       ,    ,     .</blockquote><br>
<h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus vous en obtenez chez Kubernetes, plus le processus de développement normal devient difficile: vous avez besoin de tous ces concepts (Pod, Déploiement, Service, etc.) juste pour faire fonctionner votre code. Ainsi, vous devez promouvoir un système K8 à part entière, même uniquement pour les tests via une machine virtuelle ou des conteneurs Docker imbriqués. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, comme votre application devient plus difficile à exécuter localement, le développement est compliqué par de nombreuses options pour résoudre ce problème, d'un environnement de banc au proxy d'un processus local à un cluster (j'ai écrit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet outil il y a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quelques années </font><font style="vertical-align: inherit;">) et au proxy d'un processus distant à une machine locale ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez choisissez une option, mais aucune ne sera parfaite. La façon la plus simple de ne pas utiliser du tout Kubernetes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microservices (c'est une mauvaise idée)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un problème secondaire est que, puisque votre système vous permet d'exécuter de nombreux services, vous devez écrire ces nombreux services. </font><font style="vertical-align: inherit;">Mauvaise idée. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La qualité de l'application distribuée est difficile à écrire. </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En effet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , plus les pièces sont mobiles, plus ces problèmes interfèrent avec le travail. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les applications distribuées sont difficiles à déboguer. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous aurez besoin d'un tout nouveau type d'outils de débogage et de journalisation, qui vous donnera toujours moins que les journaux d'une application monolithique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les microservices sont l'une des techniques de mise à l'échelle dans les organisations: lorsque vous avez 500 développeurs qui desservent un site Web productif, il est logique de composer avec le coût d'un système distribué à grande échelle s'il permet aux équipes de développement de travailler de manière indépendante. </font><font style="vertical-align: inherit;">Ainsi, chaque équipe de 5 personnes reçoit un seul microservice et prétend que tous les autres microservices sont des services externes auxquels vous ne devez pas faire confiance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si toute votre équipe est composée de 5 personnes, vous disposez de 20 microservices et les circonstances de force majeure ne vous obligent pas à créer un système distribué, alors quelque part vous avez mal calculé. </font><font style="vertical-align: inherit;">Au lieu de 5 personnes pour 1 microservice, comme dans les grandes entreprises, vous obtenez 0,25 personne. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes n'est-il pas utile du tout?</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise à l'échelle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes peut être utile si vous avez besoin d'une évolutivité sérieuse. </font><font style="vertical-align: inherit;">Cependant, voyons quelles alternatives vous avez:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez acheter des machines virtuelles dans le cloud et elles auront jusqu'à 416 CPU virtuels et 8 To de RAM, c'est-à-dire une puissance totalement peu flatteuse. </font><font style="vertical-align: inherit;">Cela vous coûtera un joli sou, mais ce sera extrêmement simple à faire.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nombreuses applications Web simples peuvent être mises à l'échelle de manière assez simple avec des services tels que Heroku.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est supposé, bien sûr, qu'une augmentation du nombre de machines virtuelles actives jouera également entre vos mains:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart des applications ne nécessitent pas de mise à l'échelle significative, elles auront une optimisation suffisante de haute qualité.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le goulot d'étranglement pour la mise à l'échelle de la plupart des applications Web est les bases de données, pas les travailleurs Web</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fiabilité</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus il y a de pièces mobiles, plus le risque d'erreur se produise. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les capacités de Kubernetes, renforcées par une fiabilité accrue (contrôles d'intégrité, déploiements roulants), peuvent dans de nombreux cas être déjà intégrées ou implémentées beaucoup plus facilement. Par exemple, nginx peut effectuer des contrôles d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intégrité</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur les processus de travail, et vous pouvez également utiliser </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">docker-autoheal</font></a><font style="vertical-align: inherit;"> ou quelque chose de similaire pour redémarrer automatiquement ces processus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous êtes particulièrement préoccupé par les temps d'arrêt, la première pensée qui vous rendra visite ne devrait pas être "comment puis-je réduire les temps d'arrêt lors du déploiement de 1 seconde à 1 milliseconde), mais ce devrait être" comment puis-je m'assurer que les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modifications apportées au schéma de la base de données permettent un retour en arrière</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si je quelque part quelque part? "</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si vous avez besoin de travailleurs Web fiables sans une seule machine comme point de défaillance, il existe de nombreuses façons de l'implémenter sans Kubernetes. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meilleures pratiques?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, aucune meilleure pratique n'existe dans la nature. </font><font style="vertical-align: inherit;">Il n'y a que les meilleures pratiques pour chaque situation spécifique. </font><font style="vertical-align: inherit;">Par conséquent, si quelque chose est à la mode et populaire, cela ne signifie pas du tout que c'est le bon choix pour vous en particulier. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans certains cas, Kubernetes est la meilleure option. </font><font style="vertical-align: inherit;">Le reste est une perte de temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À moins que vous ne ressentiez le besoin urgent de toutes ces complexités, vous disposez d'une large sélection d'outils qui résoudront vos problèmes: Docker Compose pour une machine, Hashicorp's </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour l'orchestration, Heroku et systèmes similaires pour la mise à l'échelle, et quelque chose comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shakemake</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le calcul des pipelines.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mot de la rédaction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que fournisseur de cloud, nous rencontrons régulièrement une grande variété de clients, des petites startups aux grandes organisations avec des processus métier complexes et des demandes d'infrastructure connexes. </font><font style="vertical-align: inherit;">Quelle que soit la qualité de la technologie, il y aura toujours des précédents dans lesquels son application entraînera des difficultés inutiles. </font><font style="vertical-align: inherit;">Vous devez toujours partir de la situation et peser soigneusement les avantages et les inconvénients des options disponibles. </font><font style="vertical-align: inherit;">L'auteur de l'article a un peu épaissi ses couleurs, mais son message est assez clair: parfois, pour prendre la bonne décision, il vaut la peine de se détourner des tendances et d'évaluer de manière impartiale votre projet. </font><font style="vertical-align: inherit;">Cela permettra de sauver la force des développeurs et l'utilisation des ressources de l'entreprise le rendra plus approprié.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493130/index.html">Pourquoi ne pas avoir peur du coronavirus: mythes et presque la vérité sur COVID-2019</a></li>
<li><a href="../fr493132/index.html">Autour de data.table</a></li>
<li><a href="../fr493136/index.html">FAST VP dans Unity Storage: comment cela fonctionne</a></li>
<li><a href="../fr493138/index.html">Parlez-moi: ce que les robots vocaux peuvent faire aujourd'hui</a></li>
<li><a href="../fr493140/index.html">Les aventures de Cipollino: Quarantine IT Quest from Flant</a></li>
<li><a href="../fr493146/index.html">Projets parallèles passionnants que vous pouvez faire aujourd'hui</a></li>
<li><a href="../fr493150/index.html">"À distance" avec un routeur Cisco</a></li>
<li><a href="../fr493152/index.html">Réseaux de neurones et Process Mining: essayer de se faire des amis</a></li>
<li><a href="../fr493158/index.html">Loghouse 0.3 - la mise à jour tant attendue de notre système de journalisation à Kubernetes</a></li>
<li><a href="../fr493160/index.html">Comment nous avons amélioré la recherche intelligente sur hh.ru en 2019: infographie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>