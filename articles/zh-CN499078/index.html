<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👥 🈁 📟 TypeScript和React的Clean Architecture。第1部分：基础知识 🎆 👬 💖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="下午好，亲爱的读者们。在本文中，我们将讨论Web开发中的软件体系结构。很长时间以来，我和我的同事使用了“清洁架构”的一种变体在其Frontend项目中构建架构。最初，我在过渡到TypeScript时将其投入使用，因为我在React的开发世界中没有找到其他合适的通用架构方法（而且我来自Android开...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TypeScript和React的Clean Architecture。第1部分：基础知识</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499078/"><img src="https://habrastorage.org/webt/q7/ls/cw/q7lscw7mpm4ex_ivtew-qlanrkw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下午好，亲爱的读者们。在本文中，我们将讨论Web开发中的软件体系结构。很长时间以来，我和我的同事使用了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“清洁架构”的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一种变体</font><font style="vertical-align: inherit;">在其Frontend项目中构建架构。最初，我在过渡到TypeScript时将其投入使用，因为我在React的开发世界中没有找到其他合适的通用架构方法（而且我来自Android开发，很久以前，在Kotlin之前，我对</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fernando Cejas的一篇文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大惊小怪</font><font style="vertical-align: inherit;">，我有时仍然会提到）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我想向您介绍我们在使用TypeScript的React应用程序中使用Clean Architecture的经验。</font><font style="vertical-align: inherit;">我为什么要告诉这个？</font><font style="vertical-align: inherit;">-有时我必须向尚不熟悉这种方法的开发人员澄清并证明其用法。</font><font style="vertical-align: inherit;">因此，在这里我将进行详细的分析，并附有直观的解释，以后我可以参考。</font></font><br>
<a name="habracut"></a><br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></b></u><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理论部分</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建筑的目的是什么？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清洁建筑的原始定义</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前端的干净架构</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实践部分</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web授权申请说明</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 源代码结构</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UML项目图</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码解析</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源和来源</font></font></li>
</ol><br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.简介</font></font></u></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，架构是全球性的事物。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在特定的编程语言的上下文中，不需要理解它。您通常需要了解关键思想，这意味着可以实现使用一种或另一种体系结构的好处。其原理与设计模式或SOLID相同-它们不是为特定的语言而是为整个编程方法（例如OOP）而发明的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看到整个图景时，最容易理解体系结构。因此，在本文中，我不仅会讨论“理论上”应该如何做，还将提供该项目的具体示例。首先，我们将在前端处理使用Clean Architecture的理论部分，然后考虑一个带有UML图和每个类的描述的Web应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要说明：清洁体系结构并没有为组织应用程序建立严格的规则，仅给出建议。每种平台和语言都有其细微差别。本文介绍了我已经与同事一起使用并且现在正在使用的方法-它不是万能药。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我还想指出，对于小型项目，使用这种架构方法可能是多余的。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何体系结构的主要目标都是使代码易于理解，支持和测试。但是，如果您的应用程序在没有体系结构，测试和其他条件的情况下使用JS编写的速度更快，这是很正常的。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要在不需要的地方进行过度设计。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 请记住，架构/测试的主要优势是在具有多个开发人员的大型项目中获得的，您需要在其中理解和更改其他人的代码。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD_0</font></font></b>
                        <div class="spoiler_text"><b>UPD_0:</b>            .      ,     — <b>  ,   ,     .</b>          - ,      .      ,       ,      .<br>
<br>
   ,  ,    :<br>
<br>
<blockquote>  —   ( )   .<br>
<br>
—  , «Computer Programming as an Art» (1974)<br>
</blockquote><br>
<br>
 , « —  ».     - ,       (  ,      ). <br>
</div>
                    </div><br>
<br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.理论部分</font></font></b></u><br>
<br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1。建筑的目的是什么？</font></font></b></u><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">答：架构对于节省开发过程中的时间，在较长的开发周期内保持系统的可测试性和可扩展性是必不可少的。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
如果您不为大型应用程序构建体系结构会发生什么情况，您可以更详细地阅读，例如，在Bob Martin撰写的《 The Clean Architecture》一书中。为了简要说明，我将提供本书的以下图表：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/t2/pr/7nt2praknbscvpol8lrcqetew7c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在该图表上，我们看到每个新版本（假设它们定期发布）会向系统中添加越来越少的行，并且增加了一行的成本。这是由于系统的复杂性，并且进行更改开始需要不合理的大量工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在“干净的体系结构”中，此图是不良体系结构的一个示例。</font><font style="vertical-align: inherit;">这种方法迟早会导致这样一个事实，即扩展系统的成本要比系统本身的收益高。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次关于开发时间的比例</font></font></b>
                        <div class="spoiler_text">           (   ):<br>
<blockquote>«  90    10  ,   .   10     90 »<br>
<br>
—  , Bell Labs</blockquote><br>
:   ,      ,       .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们（开发人员，项目经理，客户）希望在我们的项目中看到我的“理想”选项：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/46/h9/_s/46h9_st273xssd8efxtwezq5uhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该图清楚地表明，行数的增长率不会因版本而变化。</font><font style="vertical-align: inherit;">一行代码的成本（取决于版本）会增加，但考虑到我们正在谈论数百万行的代码，这并不会显着增加。</font><font style="vertical-align: inherit;">不幸的是，如果我们谈论的是大型企业系统，那么这种选择是不可能的，因为随着产品的扩展，系统的复杂性增加，开发人员的变化，因此开发成本将不可避免地增加。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，我也可以请您-我们正在谈论前端应用程序！让我们面对现实-通常，此类应用程序不会增长到数百万行，否则浏览器会讨厌下载此类应用程序。在极端情况下，它们会分为不同的产品，并且主要逻辑位于后端。因此，在某种程度上，我们可以努力争取上述增加代码成本的趋势（根据应用程序的大小，成功的方法不同）。如果我们的项目维护成本比没有好的体系结构便宜50％，这已经节省了开发人员的时间和客户资金。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初构建了良好且清晰的架构之后，我们获得了以下</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优势</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><b>  </b> (,     );</li>
<li><b>  </b> (,       -  “  ”);</li>
<li><b>     </b>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我认为问题“为什么这是必要的？！”我回答。接下来，我们进入问题的技术部分。</font></font><br>
<br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2。最初的定义</font></font></b></u><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
我将不对“干净的体系结构”进行详细描述，因为该主题已在许多文章中进行了披露，而只是简要地阐述了问题的实质。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在2012年Bob Martin的原始文章中，显示了下图：该图的</font></font><br>
<br>
<img src="https://habrastorage.org/webt/58/se/fx/58sefxx6ubqmvllmbzzwsiw_yz0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关键思想是将应用程序划分为几层（可以有任意数量的层）。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内层不知道外层，依赖关系变成中心</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。该层离中心越远，它对应用程序的“非加权”细节（例如，使用哪种框架以及屏幕上有多少个按钮）的了解就越多。</font></font><br>
<br>
<ul>
<li><b>Entities.</b>      Entities ().    -       . Entities   - . ,   Cart () —      ,    ..    ,  React,  ,  —    .<br>
<br>
      ,        React\Angular\Express\Nest.js\DI  .. , ,  ,       Web-  React’e —      NodeJS  .</li>
<li><b>Use cases.</b>      Use Cases (  —  ,   — Interactors).   ,        . ,      ,       —   ,            (. ).</li>
<li><b>Gateways, Presenters, etc.</b>    (Gateways = Repositories, Presenters = View Models) —  ,      -      . ,   ,        API  ,  View Model      React-   -.<br>
<br>
:    Use Cases  Repositories,  ,     ,      frontend         API.</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部接口。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台相关层。</font><font style="vertical-align: inherit;">这是对API，React组件等的直接调用。</font><font style="vertical-align: inherit;">这层是最难测试和抽象的（React'e中的一个按钮-有一个React'e按钮）。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3。</font><font style="vertical-align: inherit;">在前端环境中进行定义</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
现在，让我们进入前端区域。</font><font style="vertical-align: inherit;">在Frontend的上下文中，上图可以这样表示：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/5l/_e/gp5l_eksd3uomyw5w82-gigeozo.png"><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">业务实体与原始体系结构中的相同。</font><font style="vertical-align: inherit;">请注意，实体可以存储状态，并且通常用于此目的。</font><font style="vertical-align: inherit;">例如，实体“购物篮”可以存储当前会话的订单，以便提供用于处理它们的方法（获取总价，商品总量等）。</font></font></li>
<li><b>Repository interfaces.</b>     API, ,   . .   ,        “”  . ,   ,         .         ,    .      SOLID’a (     ,    ).     (,   ,      API     ).</li>
<li><b>Use Cases</b>.   . ,   -     (. . ,     — , , , ).</li>
<li><b>View Models  View Interfaces.</b><br>
<br>
ViewModel —   Presenters   .       MVVP  MVP\MVC\MV*.   ,   MVP   : Presenter   View    ,  ViewModel    View,       . View  “”  View Model. MVVP    (View → ViewModel),  MVP —  (View ︎ Presenter).   —  .<br>
<br>
View Interfaces —   ,      View,   View Model    View  .     onViewModelChanged(): void.     .</li>
<li><b>5. External interfaces.</b>   ,       .     —   React’a       API.         (AngularJS, React Native)     (IndexDB, local storage  ..). The Clean Architecutre     ,   ,      -   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果以三层应用程序的形式显示上面的图，则它采用以下形式：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xo/wp/vo/xowpvop6kgrincjtlrapfycy6hm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
红色箭头显示数据流（但不显示依赖关系，依赖关系图显示在上面的饼图中）。矩形图形式的图像使您可以更好地了解数据流如何在应用程序内部移动。我在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这篇</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文章中</font><font style="vertical-align: inherit;">以这种图表的形式看到了描述的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">想法</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请记住，在更复杂的应用程序中，层结构可能会发生变化。例如，当每个层都高于域时，这是一种常见的做法-它可以具有自己的映射器以进行数据转换。</font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.示例应用程序</font></font></u></b><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1。 Web授权申请说明</font></font></u></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使体系结构的应用程序更直观和易于理解，我创建了一个基于其构建的Web应用程序。</font><font style="vertical-align: inherit;">您可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub存储库中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看应用程序的源代码</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该应用程序如下所示：该</font></font><br>
<br>
<img src="https://habrastorage.org/webt/br/rj/wy/brrjwylya7qywcwp6vrjexacmk0.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序是一个简单的登录窗口。</font><font style="vertical-align: inherit;">为了使应用程序本身复杂化（以便使体系结构适用），我们进行以下介绍：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段不能为空（验证）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入的邮件必须具有正确的格式（验证）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问数据必须在服务器上验证（API存根）并接收验证密钥。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了进行授权，API方法需要提供验证数据和验证密钥。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授权后，访问密钥必须保存在应用程序（实体层）中。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出后，必须从内存中删除授权密钥。</font></font></li>
</ol><br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2。</font><font style="vertical-align: inherit;">源代码结构</font></font></u></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在我们的示例中，src文件夹的结构如下：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/5i/gz/cu5igzdr9m0fk_kvvyuqm_snlm0.png"><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -包含用于处理数据的类。</font><font style="vertical-align: inherit;">该目录是饼图中的最后一个圆圈，因为它包含用于实现存储库接口的类。</font><font style="vertical-align: inherit;">因此，这些类知道API和特定于平台的内容（本地存储，cookie等）。</font></font></li>
<li><b>domain </b> —   .   Entities, Use Cases  Repository Interfaces.   entities     : models  structures.      ,  models —    ,  structures —    (  POJO  Java).     ,    models   ,    ()    ,   structures — ,      JSON- (json2ts, «»)        .</li>
<li><b>presentation </b> —  View Models, View Interfaces  View ( ),   util —   ,   ..</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，结构可能因项目而异。</font><font style="vertical-align: inherit;">例如，在我的一个项目中，表示的根本是用于监视侧栏状态的类和用于在页面之间导航的类。</font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3。</font><font style="vertical-align: inherit;">URM项目图</font></font></u></b><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/580/b00/846/580b008464e6c4e0ea26e20879989581.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
不断增加的源</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矩形清楚地显示了按层划分类。</font><font style="vertical-align: inherit;">请注意，依赖关系直接指向域层（根据示意图）。</font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4。</font><font style="vertical-align: inherit;">代码</font></font></u></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实体层的</font></font></b><font style="vertical-align: inherit;"><b><u><font style="vertical-align: inherit;">分析</font></u></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在本节中，我们将遍历所有类并描述其工作逻辑。</font><font style="vertical-align: inherit;">让我们从最远的圆-实体开始，因为其余的类都基于它。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthListener.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//    </span>
<span class="hljs-comment">//   AuthHolder</span>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;interface&nbsp;AuthListener&nbsp;{<font></font>
&nbsp;&nbsp;onAuthChanged():&nbsp;<span class="hljs-keyword">void</span>;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthHolder.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>&nbsp;AuthListener&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./AuthListener'</span>;<font></font>
<font></font>
<span class="hljs-comment">//      (. 3.1.5).  , </span>
<span class="hljs-comment">//  presentation ,    Observer</span>
<span class="hljs-comment">//   AuthListener</span>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">AuthHolder</span>&nbsp;</span>{<font></font>
&nbsp;&nbsp;private&nbsp;authListeners:&nbsp;AuthListener[];<font></font>
&nbsp;&nbsp;private&nbsp;isAuthorized:&nbsp;boolean;<font></font>
&nbsp;&nbsp;private&nbsp;authToken:&nbsp;string;<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;<span class="hljs-keyword">constructor</span>()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isAuthorized&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authListeners&nbsp;=&nbsp;[];
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authToken&nbsp;=&nbsp;<span class="hljs-string">''</span>;<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;onSignedIn(authToken:&nbsp;string):&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isAuthorized&nbsp;=&nbsp;<span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authToken&nbsp;=&nbsp;authToken;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.notifyListeners();<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;onSignedOut():&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isAuthorized&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authToken&nbsp;=&nbsp;<span class="hljs-string">''</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.notifyListeners();<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;isUserAuthorized():&nbsp;boolean&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">this</span>.isAuthorized;<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@throws&nbsp;<span class="hljs-type">{Error}</span>&nbsp;</span>if&nbsp;user&nbsp;is&nbsp;not&nbsp;authorized
&nbsp;&nbsp;&nbsp;*/</span><font></font>
&nbsp;&nbsp;public&nbsp;getAuthToken():&nbsp;string&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(!<span class="hljs-keyword">this</span>.isAuthorized)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-built_in">Error</span>(<span class="hljs-string">'User&nbsp;is&nbsp;not&nbsp;authorized'</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">this</span>.authToken;<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;addAuthListener(authListener:&nbsp;AuthListener):&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authListeners.push(authListener);<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;removeAuthListener(authListener:&nbsp;AuthListener):&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authListeners.splice(<span class="hljs-keyword">this</span>.authListeners.indexOf(authListener),&nbsp;<span class="hljs-number">1</span>);<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;private&nbsp;notifyListeners():&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authListeners.forEach(<span class="hljs-function">(<span class="hljs-params">listener</span>)&nbsp;=&gt;</span>&nbsp;listener.onAuthChanged());<font></font>
&nbsp;&nbsp;}<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthorizationResult.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//       </span>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;interface&nbsp;AuthorizationResult&nbsp;{
&nbsp;&nbsp;<span class="hljs-attr">authorizationToken</span>:&nbsp;string;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationResult.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//        </span>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;interface&nbsp;ValidationResult&nbsp;{
&nbsp;&nbsp;<span class="hljs-attr">validationKey</span>:&nbsp;string;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样就结束了实体层。</font><font style="vertical-align: inherit;">请注意，该层专门处理业务逻辑（状态存储），并用于在应用程序的其余部分中传输数据。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，状态不需要存储在业务逻辑类中。</font><font style="vertical-align: inherit;">为此，具有使用场景（用于数据转换）的存储库包非常适合。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库接口</font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthRepository.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>&nbsp;ValidationResult&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../entity/auth/stuctures/ValidationResult'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthorizationResult&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../entity/auth/stuctures/AuthorizationResult'</span>;<font></font>
<font></font>
<span class="hljs-comment">//    ,        API</span>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;interface&nbsp;AuthRepository&nbsp;{
&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@throws&nbsp;<span class="hljs-type">{Error}</span>&nbsp;</span>if&nbsp;validation&nbsp;has&nbsp;not&nbsp;passed
&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;validateCredentials(email:&nbsp;string,&nbsp;<span class="hljs-attr">password</span>:&nbsp;string):&nbsp;<span class="hljs-built_in">Promise</span>&lt;ValidationResult&gt;;<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;{Error}&nbsp;if&nbsp;credentials&nbsp;have&nbsp;not&nbsp;passed
&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;login(email:&nbsp;string,&nbsp;<span class="hljs-attr">password</span>:&nbsp;string,&nbsp;<span class="hljs-attr">validationKey</span>:&nbsp;string):&nbsp;<span class="hljs-built_in">Promise</span>&lt;AuthorizationResult&gt;;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用例</font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoginUseCase.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>&nbsp;AuthRepository&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../repository/auth/AuthRepository'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthHolder&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../entity/auth/models/AuthHolder'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">LoginUseCase</span>&nbsp;</span>{<font></font>
&nbsp;&nbsp;private&nbsp;authRepository:&nbsp;AuthRepository;<font></font>
&nbsp;&nbsp;private&nbsp;authHolder:&nbsp;AuthHolder;<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;<span class="hljs-keyword">constructor</span>(authRepository:&nbsp;AuthRepository,&nbsp;authHolder:&nbsp;AuthHolder)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authRepository&nbsp;=&nbsp;authRepository;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authHolder&nbsp;=&nbsp;authHolder;<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@throws&nbsp;<span class="hljs-type">{Error}</span>&nbsp;</span>if&nbsp;credentials&nbsp;are&nbsp;not&nbsp;valid&nbsp;or&nbsp;have&nbsp;not&nbsp;passed
&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;public&nbsp;<span class="hljs-keyword">async</span>&nbsp;loginUser(email:&nbsp;string,&nbsp;<span class="hljs-attr">password</span>:&nbsp;string):&nbsp;<span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;validationResult&nbsp;=&nbsp;<span class="hljs-keyword">await</span>&nbsp;<span class="hljs-keyword">this</span>.authRepository.validateCredentials(email,&nbsp;password);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;authResult&nbsp;=&nbsp;<span class="hljs-keyword">await</span>&nbsp;<span class="hljs-keyword">this</span>.authRepository.login(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;password,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validationResult.validationKey,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authHolder.onSignedIn(authResult.authorizationToken);<font></font>
&nbsp;&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这种情况下，用例只有一种方法。通常，用例只有一个公共方法，该方法为一项操作实现复杂的逻辑。在这种情况下，您必须首先进行验证，然后将验证数据发送到授权API方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，如果将具有共同逻辑的多个场景组合到一个场景中，通常会使用一种方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仔细确保用例不包含必须存在于实体中的逻辑。用例中过多的方法或存储状态通常用作指示代码应在另一层中的指示。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库实现</font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthFakeApi.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>&nbsp;AuthRepository&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../domain/repository/auth/AuthRepository'</span>;
<span class="hljs-keyword">import</span>&nbsp;ValidationResult&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../domain/entity/auth/stuctures/ValidationResult'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthorizationResult&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../domain/entity/auth/stuctures/AuthorizationResult'</span>;<font></font>
<font></font>
<span class="hljs-comment">// ,    API</span>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">AuthFakeApi</span>&nbsp;<span class="hljs-title">implements</span>&nbsp;<span class="hljs-title">AuthRepository</span>&nbsp;</span>{
&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@throws&nbsp;<span class="hljs-type">{Error}</span>&nbsp;</span>if&nbsp;validation&nbsp;has&nbsp;not&nbsp;passed
&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;validateCredentials(email:&nbsp;string,&nbsp;<span class="hljs-attr">password</span>:&nbsp;string):&nbsp;<span class="hljs-built_in">Promise</span>&lt;ValidationResult&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,&nbsp;reject</span>)&nbsp;=&gt;</span>&nbsp;{
      <span class="hljs-comment">//  ,      </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(password.length&nbsp;&lt;&nbsp;<span class="hljs-number">5</span>)&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-built_in">Error</span>(<span class="hljs-string">'Password&nbsp;length&nbsp;should&nbsp;be&nbsp;more&nbsp;than&nbsp;5&nbsp;characters'</span>));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">validationKey</span>:&nbsp;<span class="hljs-string">'A34dZ7'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@throws&nbsp;<span class="hljs-type">{Error}</span>&nbsp;</span>if&nbsp;credentials&nbsp;have&nbsp;not&nbsp;passed
&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;login(email:&nbsp;string,&nbsp;<span class="hljs-attr">password</span>:&nbsp;string,&nbsp;<span class="hljs-attr">validationKey</span>:&nbsp;string):&nbsp;<span class="hljs-built_in">Promise</span>&lt;AuthorizationResult&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,&nbsp;reject</span>)&nbsp;=&gt;</span>&nbsp;{
      <span class="hljs-comment">//    </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(validationKey&nbsp;===&nbsp;<span class="hljs-string">'A34dZ7'</span>)&nbsp;{
        <span class="hljs-comment">//       user@email.com   password</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(email&nbsp;===&nbsp;<span class="hljs-string">'user@email.com'</span>&nbsp;&amp;&amp;&nbsp;password&nbsp;===&nbsp;<span class="hljs-string">'password'</span>)&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">authorizationToken</span>:&nbsp;<span class="hljs-string">'Bearer&nbsp;ASKJdsfjdijosd93wiesf93isef'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">else</span>&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-built_in">Error</span>(<span class="hljs-string">'Validation&nbsp;key&nbsp;is&nbsp;not&nbsp;correct.&nbsp;Please&nbsp;try&nbsp;later'</span>));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-built_in">Error</span>(<span class="hljs-string">'Email&nbsp;or&nbsp;password&nbsp;is&nbsp;not&nbsp;correct'</span>));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此类中，我们模拟了对API的访问。我们将返回一个Promise，它将返回一个实际的获取请求。如果我们想用真实的API替换实现，只需在App.tsx文件或依赖项注入工具（如果使用）中将AuthFakeApi类更改为AuthApi。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，我们注释了错误描述方法，以便其他程序员理解错误处理的必要性。不幸的是，TypeScript当前没有有关Java中引发类型的指令，因此我们使用一个简单的注释。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">util（表示层）</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在此目录中，我们放置了实现“预防性”数据验证逻辑的类，以及用于UI层的其他类。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FormValidator.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">FormValidator</span>&nbsp;</span>{
&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;isValidEmail(email:&nbsp;string):&nbsp;boolean&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;emailRegex&nbsp;=&nbsp;<span class="hljs-regexp">/^\S+@\S+\.\S+$/</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;emailRegex.test(email);<font></font>
&nbsp;&nbsp;}<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">View接口</font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseView.tsx一个</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
类，允许View模型将更改通知给View。</font><font style="vertical-align: inherit;">由所有View组件实现。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;interface&nbsp;BaseView&nbsp;{<font></font>
&nbsp;&nbsp;onViewModelChanged():&nbsp;<span class="hljs-keyword">void</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图模型</font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseViewModel.tsx一个</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
类，提供用于链接视图模型和视图的基本方法。</font><font style="vertical-align: inherit;">由所有视图模型实现。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>&nbsp;BaseView&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../view/BaseView'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;interface&nbsp;BaseViewModel&nbsp;{<font></font>
&nbsp;&nbsp;attachView(baseView:&nbsp;BaseView):&nbsp;<span class="hljs-keyword">void</span>;<font></font>
&nbsp;&nbsp;detachView():&nbsp;<span class="hljs-keyword">void</span>;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthViewModel.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span>&nbsp;BaseViewModel&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../BaseViewModel'</span>;<font></font>
<font></font>
<span class="hljs-comment">//  ViewModel,    View. </span>
<span class="hljs-comment">//    ,    View</span>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;interface&nbsp;AuthViewModel&nbsp;extends&nbsp;BaseViewModel&nbsp;{
&nbsp;&nbsp;<span class="hljs-attr">emailQuery</span>:&nbsp;string;<font></font>
&nbsp;&nbsp;passwordQuery:&nbsp;string;<font></font>
&nbsp;&nbsp;isSignInButtonVisible:&nbsp;boolean;<font></font>
&nbsp;&nbsp;isSignOutButtonVisible:&nbsp;boolean;<font></font>
<font></font>
&nbsp;&nbsp;isShowError:&nbsp;boolean;<font></font>
&nbsp;&nbsp;errorMessage:&nbsp;string;<font></font>
<font></font>
&nbsp;&nbsp;authStatus:&nbsp;string;<font></font>
&nbsp;&nbsp;isAuthStatusPositive:&nbsp;boolean;<font></font>
<font></font>
&nbsp;&nbsp;onEmailQueryChanged(loginQuery:&nbsp;string):&nbsp;<span class="hljs-keyword">void</span>;<font></font>
&nbsp;&nbsp;onPasswordQueryChanged(passwordQuery:&nbsp;string):&nbsp;<span class="hljs-keyword">void</span>;<font></font>
&nbsp;&nbsp;onClickSignIn():&nbsp;<span class="hljs-keyword">void</span>;<font></font>
&nbsp;&nbsp;onClickSignOut():&nbsp;<span class="hljs-keyword">void</span>;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthViewModelImpl.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">import</span>&nbsp;AuthViewModel&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./AuthViewModel'</span>;
<span class="hljs-keyword">import</span>&nbsp;BaseView&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../view/BaseView'</span>;
<span class="hljs-keyword">import</span>&nbsp;LoginUseCase&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../../domain/interactors/auth/LoginUseCase'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthHolder&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../../domain/entity/auth/models/AuthHolder'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthListener&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../../domain/entity/auth/models/AuthListener'</span>;
<span class="hljs-keyword">import</span>&nbsp;FormValidator&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../util/FormValidator'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">AuthViewModelImpl</span>&nbsp;<span class="hljs-title">implements</span>&nbsp;<span class="hljs-title">AuthViewModel</span>,&nbsp;<span class="hljs-title">AuthListener</span>&nbsp;</span>{<font></font>
&nbsp;&nbsp;public&nbsp;emailQuery:&nbsp;string;<font></font>
&nbsp;&nbsp;public&nbsp;passwordQuery:&nbsp;string;<font></font>
&nbsp;&nbsp;public&nbsp;isSignInButtonVisible:&nbsp;boolean;<font></font>
&nbsp;&nbsp;public&nbsp;isSignOutButtonVisible:&nbsp;boolean;<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;isShowError:&nbsp;boolean;<font></font>
&nbsp;&nbsp;public&nbsp;errorMessage:&nbsp;string;<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;authStatus:&nbsp;string;<font></font>
&nbsp;&nbsp;public&nbsp;isAuthStatusPositive:&nbsp;boolean;<font></font>
<font></font>
&nbsp;&nbsp;private&nbsp;baseView?:&nbsp;BaseView;<font></font>
&nbsp;&nbsp;private&nbsp;loginUseCase:&nbsp;LoginUseCase;<font></font>
&nbsp;&nbsp;private&nbsp;authHolder:&nbsp;AuthHolder;<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;<span class="hljs-keyword">constructor</span>(loginUseCase:&nbsp;LoginUseCase,&nbsp;authHolder:&nbsp;AuthHolder)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.emailQuery&nbsp;=&nbsp;<span class="hljs-string">''</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.passwordQuery&nbsp;=&nbsp;<span class="hljs-string">''</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isSignInButtonVisible&nbsp;=&nbsp;<span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isSignOutButtonVisible&nbsp;=&nbsp;<span class="hljs-literal">false</span>;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">''</span>;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authStatus&nbsp;=&nbsp;<span class="hljs-string">'is&nbsp;not&nbsp;authorized'</span>;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isAuthStatusPositive&nbsp;=&nbsp;<span class="hljs-literal">false</span>;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.loginUseCase&nbsp;=&nbsp;loginUseCase;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authHolder = authHolder;<font></font>
<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">this</span>.authHolder.addAuthListener(<span class="hljs-keyword">this</span>);<font></font>
  }<font></font>
<font></font>
  public attachView = (baseView: BaseView): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
    <span class="hljs-keyword">this</span>.baseView = baseView;<font></font>
  };<font></font>
<font></font>
  public detachView = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
    <span class="hljs-keyword">this</span>.baseView = <span class="hljs-literal">undefined</span>;<font></font>
  };<font></font>
<font></font>
  <span class="hljs-comment">//      AuthListener</span>
&nbsp;&nbsp;public&nbsp;onAuthChanged&nbsp;=&nbsp;():&nbsp;<span class="hljs-function"><span class="hljs-params">void</span>&nbsp;=&gt;</span>&nbsp;{
    <span class="hljs-comment">//   ,  View</span>
    <span class="hljs-comment">//      </span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-keyword">this</span>.authHolder.isUserAuthorized())&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isSignInButtonVisible&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isSignOutButtonVisible&nbsp;=&nbsp;<span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authStatus&nbsp;=&nbsp;<span class="hljs-string">'authorized'</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isAuthStatusPositive&nbsp;=&nbsp;<span class="hljs-literal">true</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">else</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isSignInButtonVisible&nbsp;=&nbsp;<span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isSignOutButtonVisible&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authStatus&nbsp;=&nbsp;<span class="hljs-string">'is&nbsp;not&nbsp;autorized'</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isAuthStatusPositive&nbsp;=&nbsp;<span class="hljs-literal">false</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.notifyViewAboutChanges();<font></font>
&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;onEmailQueryChanged&nbsp;=&nbsp;(loginQuery:&nbsp;string):&nbsp;<span class="hljs-function"><span class="hljs-params">void</span>&nbsp;=&gt;</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.emailQuery&nbsp;=&nbsp;loginQuery;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.notifyViewAboutChanges();<font></font>
&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;onPasswordQueryChanged&nbsp;=&nbsp;(passwordQuery:&nbsp;string):&nbsp;<span class="hljs-function"><span class="hljs-params">void</span>&nbsp;=&gt;</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.passwordQuery&nbsp;=&nbsp;passwordQuery;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.notifyViewAboutChanges();<font></font>
&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;onClickSignIn&nbsp;=&nbsp;<span class="hljs-keyword">async</span>&nbsp;():&nbsp;<span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;&nbsp;=&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(!<span class="hljs-keyword">this</span>.validateLoginForm())&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.notifyViewAboutChanges();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">await</span>&nbsp;<span class="hljs-keyword">this</span>.loginUseCase.loginUser(<span class="hljs-keyword">this</span>.emailQuery,&nbsp;<span class="hljs-keyword">this</span>.passwordQuery);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">''</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">catch</span>&nbsp;(e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;e.message;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">true</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.notifyViewAboutChanges();<font></font>
&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;onClickSignOut&nbsp;=&nbsp;():&nbsp;<span class="hljs-function"><span class="hljs-params">void</span>&nbsp;=&gt;</span>&nbsp;{
    <span class="hljs-comment">//         </span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authHolder.onSignedOut();<font></font>
&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;private&nbsp;validateLoginForm&nbsp;=&nbsp;():&nbsp;<span class="hljs-function"><span class="hljs-params">boolean</span>&nbsp;=&gt;</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(!<span class="hljs-keyword">this</span>.emailQuery)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">'Email&nbsp;cannot&nbsp;be&nbsp;empty'</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-literal">false</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
    <span class="hljs-comment">//  ,      </span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-keyword">this</span>.errorMessage&nbsp;===&nbsp;<span class="hljs-string">'Email&nbsp;cannot&nbsp;be&nbsp;empty'</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">''</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(!FormValidator.isValidEmail(<span class="hljs-keyword">this</span>.emailQuery))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">'Email&nbsp;format&nbsp;is&nbsp;not&nbsp;valid'</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-literal">false</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-keyword">this</span>.errorMessage&nbsp;===&nbsp;<span class="hljs-string">'Email&nbsp;format&nbsp;is&nbsp;not&nbsp;valid'</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">''</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(!<span class="hljs-keyword">this</span>.passwordQuery)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">'Password&nbsp;cannot&nbsp;be&nbsp;empty'</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-literal">false</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-keyword">this</span>.errorMessage&nbsp;===&nbsp;<span class="hljs-string">'Password&nbsp;cannot&nbsp;be&nbsp;empty'</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.isShowError&nbsp;=&nbsp;<span class="hljs-literal">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.errorMessage&nbsp;=&nbsp;<span class="hljs-string">''</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-literal">true</span>;<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;private&nbsp;notifyViewAboutChanges&nbsp;=&nbsp;():&nbsp;<span class="hljs-function"><span class="hljs-params">void</span>&nbsp;=&gt;</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-keyword">this</span>.baseView)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.baseView.onViewModelChanged();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;};<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意方法</font></font><code>onClickSignOut</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-在其中我们直接引用AuthHolder类。</font><font style="vertical-align: inherit;">这是其中使用场景形式的中介是多余的情况之一，因为该方法的逻辑非常琐碎。</font><font style="vertical-align: inherit;">同样，您可以直接访问存储库界面。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，如果代码很复杂，则为了退出，有必要将其放在单独的用例中。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户界面（视图）</font></font></b><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthComponent.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">import</span>&nbsp;React&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span>&nbsp;<span class="hljs-string">'./auth-component.css'</span>;
<span class="hljs-keyword">import</span>&nbsp;BaseView&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../BaseView'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthViewModel&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'../../view-model/auth/AuthViewModel'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span>&nbsp;interface&nbsp;AuthComponentProps&nbsp;{
&nbsp;&nbsp;<span class="hljs-attr">authViewModel</span>:&nbsp;AuthViewModel;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">export</span>&nbsp;interface&nbsp;AuthComponentState&nbsp;{
&nbsp;&nbsp;<span class="hljs-attr">emailQuery</span>:&nbsp;string;<font></font>
&nbsp;&nbsp;passwordQuery:&nbsp;string;<font></font>
&nbsp;&nbsp;isSignInButtonVisible:&nbsp;boolean;<font></font>
&nbsp;&nbsp;isSignOutButtonVisible:&nbsp;boolean;<font></font>
<font></font>
&nbsp;&nbsp;isShowError:&nbsp;boolean;<font></font>
&nbsp;&nbsp;errorMessage:&nbsp;string;<font></font>
<font></font>
&nbsp;&nbsp;authStatus:&nbsp;string;<font></font>
&nbsp;&nbsp;isAuthStatusPositive:&nbsp;boolean;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">AuthComponent</span>&nbsp;
  <span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">AuthComponentProps</span>,&nbsp;<span class="hljs-title">AuthComponentState</span>&gt;
&nbsp;&nbsp;<span class="hljs-title">implements</span>&nbsp;<span class="hljs-title">BaseView</span>&nbsp;</span>{<font></font>
&nbsp;&nbsp;private&nbsp;authViewModel:&nbsp;AuthViewModel;<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;<span class="hljs-keyword">constructor</span>(props:&nbsp;AuthComponentProps)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">super</span>(props);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;{&nbsp;authViewModel&nbsp;}&nbsp;=&nbsp;<span class="hljs-keyword">this</span>.props;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authViewModel&nbsp;=&nbsp;authViewModel;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.state&nbsp;=&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">emailQuery</span>:&nbsp;authViewModel.emailQuery,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">passwordQuery</span>:&nbsp;authViewModel.passwordQuery,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isSignInButtonVisible</span>:&nbsp;authViewModel.isSignInButtonVisible,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isSignOutButtonVisible</span>:&nbsp;authViewModel.isSignOutButtonVisible,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isShowError</span>:&nbsp;authViewModel.isShowError,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errorMessage</span>:&nbsp;authViewModel.errorMessage,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">authStatus</span>:&nbsp;authViewModel.authStatus,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isAuthStatusPositive</span>:&nbsp;authViewModel.isAuthStatusPositive,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;};<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;componentDidMount():&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authViewModel.attachView(<span class="hljs-keyword">this</span>);<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;componentWillUnmount():&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.authViewModel.detachView();<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
  <span class="hljs-comment">//    ViewModel,   </span>
  <span class="hljs-comment">// state  </span>
&nbsp;&nbsp;public&nbsp;onViewModelChanged():&nbsp;<span class="hljs-keyword">void</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.setState({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">emailQuery</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.emailQuery,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">passwordQuery</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.passwordQuery,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isSignInButtonVisible</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.isSignInButtonVisible,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isSignOutButtonVisible</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.isSignOutButtonVisible,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isShowError</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.isShowError,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errorMessage</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.errorMessage,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">authStatus</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.authStatus,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">isAuthStatusPositive</span>:&nbsp;<span class="hljs-keyword">this</span>.authViewModel.isAuthStatusPositive,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;public&nbsp;render():&nbsp;JSX.Element&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emailQuery,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;passwordQuery,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isSignInButtonVisible,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isSignOutButtonVisible,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isShowError,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errorMessage,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authStatus,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isAuthStatusPositive,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;=&nbsp;<span class="hljs-keyword">this</span>.state;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="row&nbsp;flex-grow-1&nbsp;d-flex&nbsp;justify-content-center&nbsp;align-items-center"&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="auth-container&nbsp;col&nbsp;bg-white&nbsp;border&nbsp;rounded-lg&nbsp;py-4&nbsp;px-5"&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="row&nbsp;mt-2&nbsp;mb-4"&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Status:&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;className={`${isAuthStatusPositive&nbsp;?&nbsp;'text-success'&nbsp;:&nbsp;'text-danger'}`}&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{authStatus}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="row&nbsp;mt-2"&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type="text"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placeholder="user@email.com"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onChange={(e:&nbsp;React.FormEvent&lt;HTMLInputElement&gt;):&nbsp;void&nbsp;=&gt;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.authViewModel.onEmailQueryChanged(e.currentTarget.value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value={emailQuery}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;className="form-control"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="row&nbsp;mt-2"&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type="password"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placeholder="password"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onChange={(e:&nbsp;React.FormEvent&lt;HTMLInputElement&gt;):&nbsp;void&nbsp;=&gt;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.authViewModel.onPasswordQueryChanged(e.currentTarget.value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value={passwordQuery}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;className="form-control"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{isShowError&nbsp;&amp;&amp;&nbsp;(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="row&nbsp;my-3&nbsp;text-danger&nbsp;justify-content-center"&gt;{errorMessage}&lt;/div&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{isSignInButtonVisible&nbsp;&amp;&amp;&nbsp;(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="row&nbsp;mt-4"&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;button<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type="button"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;className="col&nbsp;btn&nbsp;btn-primary"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onClick={():&nbsp;void&nbsp;=&gt;&nbsp;this.authViewModel.onClickSignIn()}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sign&nbsp;in<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/button&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{isSignOutButtonVisible&nbsp;&amp;&amp;&nbsp;(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;className="row&nbsp;mt-4"&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;button<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type="button"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;className="col&nbsp;btn&nbsp;btn-primary"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onClick={():&nbsp;void&nbsp;=&gt;&nbsp;this.authViewModel.onClickSignOut()}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sign&nbsp;out<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/button&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该组件取决于框架，因此位于图的最极端。</font><font style="vertical-align: inherit;">安装（</font><font style="vertical-align: inherit;">）时，</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthComponent会</font></font></i><font style="vertical-align: inherit;"></font><code>componentDidMount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthViewModel上，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而当（</font></font><code>componentWillUnmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">消失时</font><font style="vertical-align: inherit;">，</font><i><font style="vertical-align: inherit;">AuthComponent会分离</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">每次</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ViewModel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改时</font><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthComponent都会</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新其状态以进一步更新标记。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据状态注意条件渲染：</font></font><br>
<br>
<pre><code class="javascript hljs"><font></font>
{isSignOutButtonVisible&nbsp;&amp;&amp;&nbsp;(<font></font>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&nbsp;<span class="hljs-attr">className</span>=<span class="hljs-string">"row&nbsp;mt-4"</span>&gt;</span>
&nbsp;&nbsp;  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">className</span>=<span class="hljs-string">"col&nbsp;btn&nbsp;btn-primary"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">onClick</span>=<span class="hljs-string">{():</span>&nbsp;<span class="hljs-attr">void</span>&nbsp;=&gt;</span>&nbsp;this.authViewModel.onClickSignOut()}
&nbsp;&nbsp;&nbsp;&nbsp;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;  Sign&nbsp;out
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
)}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以及调用ViewModel方法以传递值：</font></font><br>
<br>
<pre><code class="javascript hljs">onClick={():&nbsp;<span class="hljs-function"><span class="hljs-params">void</span>&nbsp;=&gt;</span>&nbsp;<span class="hljs-keyword">this</span>.authViewModel.onClickSignOut()}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入口点</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
要进入应用程序，我们使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.tsx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App.tsx文件</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">import</span>&nbsp;React&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span>&nbsp;ReactDOM&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span>&nbsp;<span class="hljs-string">'bootstrap/dist/css/bootstrap.css'</span>;<font></font>
<font></font>
<span class="hljs-keyword">import</span>&nbsp;App&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./App'</span>;
<span class="hljs-keyword">import</span>&nbsp;*&nbsp;<span class="hljs-keyword">as</span>&nbsp;serviceWorker&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./serviceWorker'</span>;<font></font>
<font></font>
ReactDOM.render(<font></font>
&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.StrictMode</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">App</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">React.StrictMode</span>&gt;</span></span>,
&nbsp;&nbsp;<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>),<font></font>
);<font></font>
<font></font>
serviceWorker.unregister();<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App.tsx</font></font></i><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">import</span>&nbsp;React&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span>&nbsp;<span class="hljs-string">'./app.css'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthComponent&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./presentation/view/auth/AuthComponent'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthViewModelImpl&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./presentation/view-model/auth/AuthViewModelImpl'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthFakeApi&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./data/auth/AuthFakeApi'</span>;
<span class="hljs-keyword">import</span>&nbsp;LoginUseCase&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./domain/interactors/auth/LoginUseCase'</span>;
<span class="hljs-keyword">import</span>&nbsp;AuthHolder&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./domain/entity/auth/models/AuthHolder'</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">App</span>(<span class="hljs-params"></span>):&nbsp;<span class="hljs-title">JSX</span>.<span class="hljs-title">Element</span>&nbsp;</span>{
&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;data&nbsp;layer</span>
&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;authRepository&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;AuthFakeApi();
&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;domain&nbsp;layer</span>
&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;authHolder&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;AuthHolder();
&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;loginUseCase&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;LoginUseCase(authRepository,&nbsp;authHolder);
&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;view&nbsp;layer</span>
&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;authViewModel&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;AuthViewModelImpl(loginUseCase,&nbsp;authHolder);<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&nbsp;<span class="hljs-attr">className</span>=<span class="hljs-string">"app-container&nbsp;d-flex&nbsp;container-fluid"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">AuthComponent</span>&nbsp;<span class="hljs-attr">authViewModel</span>=<span class="hljs-string">{authViewModel}</span>&nbsp;/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
&nbsp;&nbsp;);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">default</span>&nbsp;App;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App.tsx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文件</font><font style="vertical-align: inherit;">中的所有依赖项。</font><font style="vertical-align: inherit;">在此应用程序中，我们不会使用依赖注入工具，以免不必要地使代码复杂化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果需要更改某些依赖关系，我们将在此文件中替换它。</font><font style="vertical-align: inherit;">例如，代替以下行：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;authRepository&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;AuthFakeApi();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
写：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;authRepository&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;AuthApi();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还要注意，我们仅使用接口，而不使用特定的实现（一切都基于抽象）。</font><font style="vertical-align: inherit;">声明变量时，我们的意思是：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span>&nbsp;authRepository: AuthRepository&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;AuthFakeApi();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这使您可以隐藏实现细节（以便以后在不更改界面的情况下进行替换）。</font></font><br>
<br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.结论</font></font></b></u><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
我希望阅读本文时，您能了解如何将Clean Architecture应用于React（不仅是项目），并且我们的经验将有助于使您的应用程序更好。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文介绍了在前端项目中使用The Clean Architecture的理论和实践基础。如前所述，“干净的体系结构”仅提供有关如何构建体系结构的建议。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上面是使用此体系结构的简单应用程序的示例。</font><font style="vertical-align: inherit;">请记住，随着应用程序的增长，体系结构可能会发生变化，因此上面的代码不是万能的（如开头所述），本文只是我们经验的一部分。</font></font><br>
<br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.资源</font></font></b></u><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码</font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UML图</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN499064/index.html">使用统计语言模型的替代上下文理解</a></li>
<li><a href="../zh-CN499068/index.html">定义点云转换参数</a></li>
<li><a href="../zh-CN499070/index.html">ПAndroidЕAndroidStudio或如何充分使用VCS工具</a></li>
<li><a href="../zh-CN499074/index.html">如何在symfony 5 bundle中重用代码？第4部分。主机捆绑扩展</a></li>
<li><a href="../zh-CN499076/index.html">如何在symfony 5 bundle中重用代码？第5部分。配置</a></li>
<li><a href="../zh-CN499086/index.html">达斯克家庭集群</a></li>
<li><a href="../zh-CN499088/index.html">无需媒体查询的灵活标记：min（），max（），clamp（）函数</a></li>
<li><a href="../zh-CN499090/index.html">控制台命令的复杂性，1979-2020年</a></li>
<li><a href="../zh-CN499092/index.html">参考模型BIAN。它为银行的企业架构提供了哪些新的有用的功能？</a></li>
<li><a href="../zh-CN499096/index.html">漂亮图片中的模糊逻辑。不同隶属函数的响应面</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>