<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧙🏻 🍞 🙆🏾 ABBYY FineReaderで権限昇格を認識する ⏸️ 🚓 🧚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私がWindowsアプリケーションに権限昇格の脆弱性を見つける方法のサイクルは続いています。前のシリーズ：Steam（CVE-2019-14743、CVE-2019-15316、CVE-2019-17180）およびOrigin（CVE-2019-19247、CVE-2019-19248）。しかし、今...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ABBYY FineReaderで権限昇格を認識する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pm/blog/488826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私がWindowsアプリケーションに権限昇格の脆弱性を見つける方法のサイクルは続いています。</font><font style="vertical-align: inherit;">前のシリーズ：Steam（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-14743</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-15316</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-17180</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）およびOrigin（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-19247、CVE-2019-19248</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">しかし、今日はゲームランチャーではなく、ABBYY FinerReaderアプリケーションソフトウェアパッケージについて説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n6/4z/ac/n64zach5hyh0x3hdcoskm6ojz7m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まとめ-ライセンスをチェックするコンポーネントのおかげで、10分でユーザーレベルからNT AUTHORITY \ SYSTEMに権利を上げる方法を説明します。</font><font style="vertical-align: inherit;">脆弱性には</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ABBYY Webサイトへのリンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">である識別子CVE-2019-20383が割り当てられました</font><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インテリジェンスサービス</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FineReaderの試用版をABBYYのWebサイトからダウンロードし、すぐに確認して、特権を増やすために製品を選択することが理にかなっているかどうかを確認しました。はい。この製品には、「ABBYYネットワークライセンスサーバー」という名前で判断してライセンスに関連付けられ、デフォルトでユーザーNT AUTHORITY \ SYSTEMから起動されるサービスが含まれています。 ProcMonを開始し、サービスの動作を監視し始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の注意は、パス「C：\ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses \ Licensing.cnt」にあるファイルに引き付けられました。サービスはそこから何かを読み取り、そこに何かを書き込みます。一般的に、ファイルは実験の興味深い候補のように見えました。 「C：\ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses」というフォルダを検討してください。親フォルダー（「C：\ ProgramData \ ABBYY \ FineReader \ 15」）から継承されたオールフルアクセスACLは、このフォルダーに対して有効です。つまり、「Licensing.cnt」ファイルを含むすべてのコンテンツを削除できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルの欠如を発見したサービスは、少し奇妙な方法でファイルを作成しようとしました。彼は「tmpXXXX-YYYYYYYYY.tmp」という形式のファイルを作成し、そこにデータを書き込んだ後、「Licensing.cnt」という名前に変更しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この操作が2回実行されたProcMonログは次のとおりです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8h/hk/ro/8hhkroiszje9qtzyovchs1zldjk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、20：36に発生し、次に20:46に発生します。これらのタイムスタンプの間に、ファイルは再度作成されるために削除されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
四角形1は、サービスがファイルの不在を検出した状況を示します。長方形2-一時ファイルを作成します。長方形3-一時ファイルの名前を変更します。長方形4-10分後に操作を繰り返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「tmpXXXX_YYYYYYYYY.tmp」という名前の形式を検討してください。 1つの実行中のプロセスの一部として、XXXXは常に一定です。さらに、実際には、これはこの作業を実行するスレッドの識別子です。 YYYYYYYYYは一定ではありませんが、2つの隣接する開始点（値：430210515および430810515）を見ると、これは単なるタイムマークであるように見えます-数値600000の差-驚くほど10分の差と一致しています。さらにいくつかのテストで、仮定を確認します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この部分を要約します。</font><font style="vertical-align: inherit;">すべてのユーザーがファイル「C：\ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses \ Licensing.cnt」を削除すると、フォルダ「C：\ ProgramData \ ABBYY \ FineReader \ 15 \ Licenses」のコンテンツを非常に頻繁にリクエストできますある時点で、「tmpXXXX_YYYYYYYYY.tmp」というファイルを見つけます。</font><font style="vertical-align: inherit;">これでユーザーは準備が整い、ファイルを削除した後、ユーザーはいつ、どのような名前でファイルが次回作成されるかを正確に知ることができます。</font></font><br>
<br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今、私たちはシンボリックリンクで遊びます</font></font></font></h2><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理者権限なしでシンボリックリンクを作成する方法</font></font></b><div class="spoiler_text">  ,           .     . , ,     «C:\abc\1»   «C:\def\2».<br>
<br>
  NTFS reparse point (  NTFS mount point)   «C:\abc»  «\RPC Control\". «\RPC Control\» –        ,   , ,  .    ,   , ,  ,     .       NTFS reparse point ,  ,             .   - ,  -            .<br>
<br>
          .    "\RPC Control\1" &lt;-&gt; «C:\def\2».  ,     «C:\abc\1»,       «C:\def\2».<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、このようなライセンスファイルのルックスを作成するプロセス：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/zh/8w/lnzh8ws9y5e0ewunx4u_pnnhkh8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（「：\はProgramData \ ABBYY \ FineReaderの\ 15 \ライセンス\ C」我々は名前のフォルダソースをスキップします）：私たちは次のような操作の正確な瞬間を知ったとき、私たちは以下のシンボリックリンクを作成することができます</font><font style="vertical-align: inherit;">
どこYYYYYYYYA、YYYYYYYYB、 YYYYYYYYC、... YYYYYYYYYZ-これらは、YYYYYYYYYY + 10分の異なるタイムスタンプです（タイムスタンプが少し遅い場合）。</font><font style="vertical-align: inherit;">
次に、リンクを作成し</font><font style="vertical-align: inherit;">
ます。これらのファイルは実際には存在しないことに注意してください。これは、たとえばtmpXXXX_YYYYYYYYB.tmpを参照するときに2つのリダイレクトが発生し、その結果、サービスがファイル「C：\ test \ l2 \ nope」で機能するようにするために必要です。</font><font style="vertical-align: inherit;">
ファイル「C：\ test \ l2 \ nope」の作成を発見したらすぐに、2つの新しいシンボリックリンクを作成する必要があります。</font></font><br>
<br>
<code>tmpXXXX_YYYYYYYYA.tmp &lt;-&gt; C:\test\l1\proxy<br>
tmpXXXX_YYYYYYYYB.tmp &lt;-&gt; C:\test\l1\proxy<br>
tmpXXXX_YYYYYYYYC.tmp &lt;-&gt; C:\test\l1\proxy<br>
…<br>
tmpXXXX_YYYYYYYYZ.tmp &lt;-&gt; C:\test\l1\proxy</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>C:\test\l1\proxy &lt;-&gt; C:\test\l2\nope</code><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>C:\test\l1\proxy &lt;-&gt; C:\test\l2\payload<br>
Licensing.cnt &lt;-&gt; C:\target\path</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスは引き続きファイルの内容を「C：\ test \ l2 \ nope」に書き込みますが、新しいシンボリックリンクを通過した後で名前を変更します。したがって、たとえば、「tmpXXXX_YYYYYYYYC.tmp」を「Licensing.cnt」に名前変更する代わりに、「C：\ test \ l2 \ payload」は実際には「C：\ target \ path」に名前変更（移動）されます。実際、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーNT AUTHORITY \ SYSTEMに代わって、任意のコンテンツを含むファイルを任意のパスに配置できます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
概略的には、次のようになります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/bq/cb/m2bqcbiptwhuauds0bpsn4giyjo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。色は、シンボリックリンクの影響により実際に実行される内容を示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のプリミティブを使用して特権を上げることはすでに簡単です。システムプロセスや他の同様のものに独自のdllをアタッチできます。この段階で、ABBYYの担当者に連絡し、脆弱性に関する情報を渡しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ABBYYによれば、現時点ではこの脆弱性はクローズされています。</font></font><br>
<br>
<h2><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイムライン</font></font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">年</font><b><font style="vertical-align: inherit;">11月25</font></b><font style="vertical-align: inherit;">日-脆弱性の検出</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">年11月</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日- </font><b><font style="vertical-align: inherit;">2019</font></b><font style="vertical-align: inherit;">年11 </font><font style="vertical-align: inherit;">月</font><b><font style="vertical-align: inherit;">26</font></b><font style="vertical-align: inherit;">日に</font><font style="vertical-align: inherit;">製造元からのセキュリティ連絡を要求-製造元に</font><font style="vertical-align: inherit;">脆弱性レポートを送信</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09/2019-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脆弱性は</font><font style="vertical-align: inherit;">製造元によって確認され</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました10/01/2020-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脆弱性は</font><b><font style="vertical-align: inherit;">01/22/2020</font></b><font style="vertical-align: inherit;">で修正さ</font><b><font style="vertical-align: inherit;">れました</font></b><font style="vertical-align: inherit;"> -脆弱性にCVE-2019-20383 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.02</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が割り当てられました</font><b><font style="vertical-align: inherit;">.2020-</font></b><font style="vertical-align: inherit;">この記事の公開</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、多くのプロジェクトがあり、「将来のモニタリング」チームを拡大しています。</font><font style="vertical-align: inherit;">私たちは、ソースコードの研究の専門家だけでなく、モバイルアプリケーションの分析の専門家を探しています。</font><font style="vertical-align: inherit;">私のチームに参加したい-アナスタシア（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ana2121</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）またはメールでinfo@amonitoring.ru </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は英語です。</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja488814/index.html">AS3からHaxeへのForge of Empires。死後</a></li>
<li><a href="../ja488816/index.html">ミールを失った方法：宇宙ステーションでの火災、プログレストラックとの衝突、減圧</a></li>
<li><a href="../ja488818/index.html">ブレークスルー#DeepPavlov in 2019：レビューと今年の結果</a></li>
<li><a href="../ja488820/index.html">職場で燃え尽きないようにする方法と、それでも燃え尽きる場合の対処法</a></li>
<li><a href="../ja488824/index.html">RaiffeisenbankでのDGTLデザインコミュニティのミートアップ：ブロードキャスト</a></li>
<li><a href="../ja488828/index.html">スパム、スパム、スパム...</a></li>
<li><a href="../ja488830/index.html">トルクメニスタンのインターネット：価格、可用性、制限</a></li>
<li><a href="../ja488832/index.html">驚いたことに、昨年、企業のHDDはSSDよりも人気があり、その売り上げは伸びています</a></li>
<li><a href="../ja488834/index.html">2009年のエラーがDocker for WindowsとRazer Synapseの間で競合を引き起こす方法</a></li>
<li><a href="../ja488836/index.html">ロードされたアプリケーションを開発するときのディクショナリの操作のいくつかの側面</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>