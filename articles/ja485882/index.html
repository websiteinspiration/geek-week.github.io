<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕒 📲 💅 このリストをどのように分類するのですか？ 🧛🏼 🐊 🍠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="リストがあると仮定します—エレメントがFileクラスとFolderクラスのインスタンスであるディレクトリの内容です。タスクは、このリストをソートすることです。ディレクトリ構造の並べ替えには、よく知られている2つのオプションがあります。ディレクトリが最初に移動し、次にファイルに移動するときと、ファイル...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>このリストをどのように分類するのですか？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485882/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リストがあると仮定します—エレメントがFileクラスとFolderクラスのインスタンスであるディレクトリの内容です。タスクは、このリストをソートすることです。ディレクトリ構造の並べ替えには、よく知られている2つのオプションがあります。ディレクトリが最初に移動し、次にファイルに移動するときと、ファイルとディレクトリが混在して並べ替えられるときです。これらのオプションのいずれかを選択する機会をユーザーに提供する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は初めて、過去の仕事で同じような仕事に出くわしました。ちなみに、この問題はこの記事の方法3で解決されました。なんて美しくないのだと思いました。 「彼らは私にこの問題を与えます、私は間違いなくそれを128倍良く解決します。しかし、どうやって？」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それから5年が経ち、精神的にこの仕事に戻ってきた私は、そのための理想的な解決策を思い付かなかった。</font><font style="vertical-align: inherit;">それにもかかわらず、この間に私はあなたと共有したいいくつかのアイデアを蓄積することができました。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法1.要素の数値優先度</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく最初に思い浮かぶ最初のアイデアでしょう。</font><font style="vertical-align: inherit;">必須のgetName（）メソッドに加えて、ソートでの要素の優先順位に関する情報を提供するint getPriority（）メソッドが追加される基本クラスがあります。</font><font style="vertical-align: inherit;">特定のクラスでは、int型の静的変数が実装され、必要な優先度を決定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、コードでは、これは私が説明しようとしているよりも簡単です：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPriority</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">virtual</span> ~Base() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> PRIORITY;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getPriority</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> PRIORITY;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> File::PRIORITY = <span class="hljs-number">1</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> PRIORITY;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getPriority</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> PRIORITY;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> Folder::PRIORITY = <span class="hljs-number">2</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
並べ替えアルゴリズムのコンパレータ：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;first, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> priorityFirst = first-&gt;getPriority();
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> prioritySecond = second-&gt;getPriority();
    <span class="hljs-keyword">if</span> (priorityFirst != prioritySecond) {
        <span class="hljs-keyword">return</span> priorityFirst &gt; prioritySecond;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列を埋めてソートします。</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt;&gt; files;<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;Folder&gt;(<span class="hljs-string">"1"</span>));<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;File&gt;(<span class="hljs-string">"3"</span>));<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;File&gt;(<span class="hljs-string">"2"</span>));<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;Folder&gt;(<span class="hljs-string">"4"</span>));<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::sort(files.begin(), files.end(), comparator);<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;element: files) {
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; element-&gt;getPrintedName() &lt;&lt; <span class="hljs-string">" "</span>;<font></font>
    }<font></font>
        <font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
すべてが非常に単純で明確であり、そのようなコードを読み書きするために超大国は必要ありません。</font><font style="vertical-align: inherit;">ただし、このコードには重大な欠点があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優先度のタイプはintです。</font><font style="vertical-align: inherit;">クラスの選択された優先順位はどの範囲にあるべきですか？</font><font style="vertical-align: inherit;">これらの優先順位には、0から番号が付けられ、1から番号が付けられますか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソートで既存のクラス間でソートされるように新しいクラス（たとえば、Symlinkなど）を導入する場合は、ほとんどの定数を「シフト」する必要があります。</font><font style="vertical-align: inherit;">これは問題を引き起こす可能性があります-Baseクラスのすべての子孫を見つけることはどのように保証されますか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイテムの並べ替えは、アイテム自体の責任である必要はありません。</font><font style="vertical-align: inherit;">ファイルの要素、フォルダー自体は、それらがそれらをソートしようとしていることを疑うことはできません。</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、この方法は適していません。次に進みます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法2.テキストクラスタイプによってクラスを識別する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスごとに、クラスのタイプを定義する静的文字列変数を入力できます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">virtual</span> ~Base() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TYPE;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> TYPE;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> File::TYPE = <span class="hljs-string">"File"</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TYPE;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> TYPE;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Folder::TYPE = <span class="hljs-string">"Folder"</span>;
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパレータ：</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;first, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;second)</span> </span>{
    <span class="hljs-keyword">if</span> (first-&gt;getType() == Folder::TYPE &amp;&amp; second-&gt;getType() == Folder::TYPE) {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (first-&gt;getType() == Folder::TYPE &amp;&amp; second-&gt;getType() == File::TYPE) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (first-&gt;getType() == File::TYPE &amp;&amp; second-&gt;getType() == Folder::TYPE) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
塗りつぶしと並べ替えは、前のオプションと同じです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記入</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt;&gt; files;<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;Folder&gt;(<span class="hljs-string">"1"</span>));<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;File&gt;(<span class="hljs-string">"3"</span>));<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;File&gt;(<span class="hljs-string">"2"</span>));<font></font>
    files.emplace_back(<span class="hljs-built_in">std</span>::make_unique&lt;Folder&gt;(<span class="hljs-string">"4"</span>));<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::sort(files.begin(), files.end(), comparator);<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;element: files) {
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; element-&gt;getPrintedName() &lt;&lt; <span class="hljs-string">" "</span>;<font></font>
    }<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一般に、それほど複雑なことはありません。</font><font style="vertical-align: inherit;">しかし、マイナス面もあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、要素を比較する機能が明らかに複雑になっています。</font><font style="vertical-align: inherit;">ここに新しい要素（同じSymlink）を追加する必要がある場合はどうなるか想像してみてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、前のクラスをコピーして新しいクラスを作成すると、クラスの文字列型を変更するのを忘れてしまう可能性があり、面白くて苦痛なデバッグが必要になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、この方法はほぼ自動的に</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法3. rttiでクラスを特定する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リフレクションの分野でC ++の（現時点では不足している）機能を利用して、前の例のクラスのタイプを定義する静的変数を取り除きましょう。</font><font style="vertical-align: inherit;">結局のところ、これは、rttiメカニズムを使用して実行時にクラス型を定義することで実行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、クラスの構造がシンプルになりました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">virtual</span> ~Base() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス自体が必要としない追加のフィールドはすでにありませんが、並べ替えアルゴリズムが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列を埋めて並べ替える手順は、以前の方法と比較して変わっていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今コンパレータを見てみましょう：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;first, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;second)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">dynamic_cast</span>&lt;Folder*&gt;(first.get()) != <span class="hljs-literal">nullptr</span> &amp;&amp; <span class="hljs-keyword">dynamic_cast</span>&lt;Folder*&gt;(second.get()) != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">dynamic_cast</span>&lt;Folder*&gt;(first.get()) != <span class="hljs-literal">nullptr</span> &amp;&amp; <span class="hljs-keyword">dynamic_cast</span>&lt;File*&gt;(second.get()) != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">dynamic_cast</span>&lt;File*&gt;(first.get()) != <span class="hljs-literal">nullptr</span> &amp;&amp; <span class="hljs-keyword">dynamic_cast</span>&lt;Folder*&gt;(second.get()) != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、おそらくこのコードは何とかうまく書き直すことができますが、... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチのもう1つの欠点は、プログラムのコンパイル時にrttiを含める必要があることです（驚いたことに、少なくともデフォルトではオンになっています） gcc）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、私と同じように方法は</font><font style="vertical-align: inherit;">まあまあ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法4.複数のスケジューリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の2つの方法を見ると、私がやろうとしていることのように思われる方も</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いらっしゃい</font><font style="vertical-align: inherit;">ます... </font><font style="vertical-align: inherit;">私はここで誰かに興味をそそられましたが、あなたはすでに見出しを見ました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、はい、それは複数のディスパッチのように見えます。</font><font style="vertical-align: inherit;">これは、メソッドを（OOPの意味で）1つの引数からではなく、2つ、3つを同時に呼び出す必要がある場合に発生します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、正方形、円、三角形など、多くの幾何学的形状がある場合。</font><font style="vertical-align: inherit;">そして、これらの図のいずれか2つの交差領域を見つけたいと考えています。</font><font style="vertical-align: inherit;">さらに、私たちは正方形と正方形、正方形と立方体の交点などの面積を求める式を知っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題は、訪問者テンプレートを使用して、このためのC ++バリアントオプションを使用して解決できます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Symlink</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Symlink(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Symlink_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスに不必要なものはありません。</font><font style="vertical-align: inherit;">バリアントクラスを引き続き使用するため、基本クラスもありません。</font><font style="vertical-align: inherit;">その代わりに、私は長い間追加すると脅迫していた新しいSymlinkクラスを持ち込みました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスのバリアントである追加のタイプを紹介します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">using</span> Element = <span class="hljs-built_in">std</span>::variant&lt;Folder, File, Symlink&gt;;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要素を入力して並べ替える方法を見てみましょう。</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Element&gt; files = {Folder(<span class="hljs-string">"1"</span>), File(<span class="hljs-string">"3"</span>), File(<span class="hljs-string">"2"</span>), Folder(<span class="hljs-string">"4"</span>), Symlink(<span class="hljs-string">"1"</span>), Symlink(<span class="hljs-string">"5"</span>), Symlink(<span class="hljs-string">"1"</span>)};<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::sort(files.begin(), files.end(), comparator);<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> Element &amp;element: files) {
        <span class="hljs-built_in">std</span>::visit([](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;elem) {
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; elem.getPrintedName() &lt;&lt; <span class="hljs-string">" "</span>;<font></font>
        }, element);<font></font>
    }<font></font>
        <font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、以前のすべてのオプションよりも充填がさらに簡単です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドの主要部分はコンパレータです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Folder &amp;first, <span class="hljs-keyword">const</span> Folder &amp;second) {
    <span class="hljs-keyword">return</span> first.getName() &lt; second.getName();<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Folder &amp;first, <span class="hljs-keyword">const</span> File &amp;second) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Folder &amp;first, <span class="hljs-keyword">const</span> Symlink &amp;second) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> File &amp;first, <span class="hljs-keyword">const</span> Folder &amp;second) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> File &amp;first, <span class="hljs-keyword">const</span> File &amp;second) {
    <span class="hljs-keyword">return</span> first.getName() &lt; second.getName();<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> File &amp;first, <span class="hljs-keyword">const</span> Symlink &amp;second) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Symlink &amp;first, <span class="hljs-keyword">const</span> Folder &amp;second) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Symlink &amp;first, <span class="hljs-keyword">const</span> File &amp;second) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Symlink &amp;first, <span class="hljs-keyword">const</span> Symlink &amp;second) {
    <span class="hljs-keyword">return</span> first.getName() &lt; second.getName();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Element &amp;first, <span class="hljs-keyword">const</span> Element &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span> result = <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentFirst){
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentSecond){
            <span class="hljs-keyword">return</span> contentFirst &lt; contentSecond;<font></font>
        }, second);<font></font>
    }, first);<font></font>
    <span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
コンパレータ自体は非常に単純です。std::訪問は最初の要素に対して最初に呼び出され、次に2番目の要素に対して呼び出されます。</font><font style="vertical-align: inherit;">次に、比較プロシージャが呼び出されます。</font><font style="vertical-align: inherit;">std :: visitはバリアントにある値のタイプを「保存」するため、比較により正しい関数オーバーロードが選択されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、オーバーロード自体は大きく見えます... </font><font style="vertical-align: inherit;">これらすべてを印刷し、間違いを犯さないことが患者の仕事です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、テンプレート</font><s><font style="vertical-align: inherit;">や他の人の母親を</font></s><font style="vertical-align: inherit;">使うこともできます</font></font><s><font style="vertical-align: inherit;"></font></s> <br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボイラープリントの量を減らす</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ComparePriority</span> {</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Folder &amp;first, <span class="hljs-keyword">const</span> File &amp;second)</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Folder &amp;first, <span class="hljs-keyword">const</span> Symlink &amp;second)</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Symlink &amp;first, <span class="hljs-keyword">const</span> File &amp;second)</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Element &amp;first, <span class="hljs-keyword">const</span> Element &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span> result = <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentFirst){
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentSecond){
            <span class="hljs-keyword">using</span> TypeFirst = <span class="hljs-built_in">std</span>::<span class="hljs-keyword">decay_t</span>&lt;<span class="hljs-keyword">decltype</span>(contentFirst)&gt;;
            <span class="hljs-keyword">using</span> TypeSecond = <span class="hljs-built_in">std</span>::<span class="hljs-keyword">decay_t</span>&lt;<span class="hljs-keyword">decltype</span>(contentSecond)&gt;;
            <span class="hljs-keyword">int</span> compared;
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">constexpr</span> (<span class="hljs-built_in">std</span>::is_invocable_r_v&lt;<span class="hljs-keyword">int</span>, ComparePriority, TypeFirst, TypeSecond&gt;) {<font></font>
                compared = ComparePriority()(contentFirst, contentSecond);<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">constexpr</span> (<span class="hljs-built_in">std</span>::is_invocable_r_v&lt;<span class="hljs-keyword">int</span>, ComparePriority, TypeSecond, TypeFirst&gt;) {<font></font>
                compared = -ComparePriority()(contentSecond, contentFirst);<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">constexpr</span> (<span class="hljs-built_in">std</span>::is_same_v&lt;TypeFirst, TypeSecond&gt;){<font></font>
                compared = <span class="hljs-number">0</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">static_assert</span>(<span class="hljs-built_in">std</span>::is_same_v&lt;TypeFirst, TypeFirst&gt;, <span class="hljs-string">"Error"</span>);<font></font>
            }<font></font>
            <span class="hljs-keyword">if</span> (compared == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> contentFirst.getName() &lt; contentSecond.getName();<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> compared == <span class="hljs-number">1</span>;<font></font>
            }<font></font>
        }, second);<font></font>
    }, first);<font></font>
    <span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコードです</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
が、次のオプションを検討してみましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法5.優先度付きの複数のスケジューリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスの構造は以前のバージョンと同じままです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
    <font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
    <font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
    <font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
    <font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Symlink</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Symlink(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Symlink_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">using</span> Element = <span class="hljs-built_in">std</span>::variant&lt;Folder, File, Symlink&gt;;
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主な違いは、各クラスの数値優先順位を決定することです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">priority</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Folder &amp;)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">priority</span><span class="hljs-params">(<span class="hljs-keyword">const</span> File &amp;)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">priority</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Symlink &amp;)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、コンパレータ自体は次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Element &amp;first, <span class="hljs-keyword">const</span> Element &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span> result = <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentFirst){
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentSecond){
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> priorityFirst = priority(contentFirst);
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> prioritySecond = priority(contentSecond);
            <span class="hljs-keyword">if</span> (priorityFirst != prioritySecond) {
                <span class="hljs-keyword">return</span> priorityFirst &gt; prioritySecond;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> contentFirst.getName() &lt; contentSecond.getName();<font></font>
            }<font></font>
        }, second);<font></font>
    }, first);<font></font>
    <span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さて、すべてが順調です。</font><font style="vertical-align: inherit;">しかし、覚えていれば、最初に、要素を並べ替えるときにクラスの優先順位を構成する機会をユーザーに提供することを約束しました。</font><font style="vertical-align: inherit;">これで、コード内でコンパイルの開始前にのみ、これらの同じ優先順位を構成できます。</font><font style="vertical-align: inherit;">実行時に優先度設定を取得して、何が起こるか見てみましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法6.外部で構成可能な数値優先度</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のメソッドのクラス構造を思い出してみましょう：</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPriority</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">virtual</span> ~Base() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> PRIORITY;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getPriority</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> PRIORITY;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">int</span> File::PRIORITY = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> PRIORITY;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getPriority</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> PRIORITY;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">int</span> Folder::PRIORITY = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;first, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> priorityFirst = first-&gt;getPriority();
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> prioritySecond = second-&gt;getPriority();
    <span class="hljs-keyword">if</span> (priorityFirst != prioritySecond) {
        <span class="hljs-keyword">return</span> priorityFirst &gt; prioritySecond;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、優先順位を構成する方法について考えます。</font><font style="vertical-align: inherit;">さて、すべてが簡単です-静的なPRIORITYメンバーへのリンクを取得して、ユーザーに提供しましょう：</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::pair&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::reference_wrapper&lt;<span class="hljs-keyword">int</span>&gt;&gt;&gt; priorities{{<span class="hljs-string">"Folder"</span>, <span class="hljs-built_in">std</span>::ref(Folder::PRIORITY)}, {<span class="hljs-string">"File"</span>, <span class="hljs-built_in">std</span>::ref(File::PRIORITY)}};<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;[type, ptr]: priorities) {
        <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"Folder"</span>) {<font></font>
            ptr.get() = <span class="hljs-number">2</span>;<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"File"</span>) {<font></font>
            ptr.get() = <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このメソッドはタスクに非常に便利ですが、マルチスレッドコードに問題がありました。異なるスレッドからPRIORITYフィールドにアクセスできる場合、このメソッドはこの問題の解決には適していません。</font><font style="vertical-align: inherit;">したがって、次に進みます</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法7.テキストクラスタイプによってクラスを識別し、外部から優先度を構成する</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造を思い出してください</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">virtual</span> ~Base() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TYPE;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> TYPE;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> File::TYPE = <span class="hljs-string">"File"</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TYPE;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> TYPE;<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Folder::TYPE = <span class="hljs-string">"Folder"</span>;
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、TYPEフィールドは、受信した優先度を格納するいくつかのマップでキーとして機能します。</font><font style="vertical-align: inherit;">その結果、コンパレーターでは、優先順位を抽出するために、まずこのマップにアクセスする必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-keyword">int</span>&gt; &amp;priorities, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;first, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> priorityFirst = priorities.at(first-&gt;getType());
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> prioritySecond = priorities.at(second-&gt;getType());
    <span class="hljs-keyword">if</span> (priorityFirst != prioritySecond) {
        <span class="hljs-keyword">return</span> priorityFirst &gt; prioritySecond;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
優先的な入力と並べ替え：</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-keyword">int</span>&gt; priorities;<font></font>
    priorities.emplace(Folder::TYPE, <span class="hljs-number">2</span>);<font></font>
    priorities.emplace(File::TYPE, <span class="hljs-number">1</span>);<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt;&gt; files;
    <span class="hljs-comment">//  files</span><font></font>
<font></font>
    <span class="hljs-built_in">std</span>::sort(files.begin(), files.end(), <span class="hljs-built_in">std</span>::bind(comparator, <span class="hljs-built_in">std</span>::ref(priorities), _1, _2));
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法8.外部優先度構成でrttiを使用してクラスを特定する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドは前の方法と似ており、文字列定数の代わりにクラスのtypeidのみが使用されます</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-keyword">virtual</span> ~Base() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span>:</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパレータと充填：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unordered_map</span>&lt;<span class="hljs-built_in">std</span>::type_index, <span class="hljs-built_in">std</span>::pair&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-keyword">int</span>&gt;&gt; &amp;priorities, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;first, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt; &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> priorityFirst = priorities.at(<span class="hljs-keyword">typeid</span>(*first.get())).second;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> prioritySecond = priorities.at(<span class="hljs-keyword">typeid</span>(*second.get())).second;
    <span class="hljs-keyword">if</span> (priorityFirst != prioritySecond) {
        <span class="hljs-keyword">return</span> priorityFirst &gt; prioritySecond;<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> first-&gt;getName() &lt; second-&gt;getName();<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<pre><code class="cpp hljs">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unordered_map</span>&lt;<span class="hljs-built_in">std</span>::type_index, <span class="hljs-built_in">std</span>::pair&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-keyword">int</span>&gt;&gt; priorities;<font></font>
    priorities.emplace(<span class="hljs-built_in">std</span>::piecewise_construct, <span class="hljs-built_in">std</span>::forward_as_tuple(<span class="hljs-keyword">typeid</span>(Folder)), <span class="hljs-built_in">std</span>::forward_as_tuple(<span class="hljs-string">"Folder"</span>, <span class="hljs-number">2</span>));<font></font>
    priorities.emplace(<span class="hljs-built_in">std</span>::piecewise_construct, <span class="hljs-built_in">std</span>::forward_as_tuple(<span class="hljs-keyword">typeid</span>(File)), <span class="hljs-built_in">std</span>::forward_as_tuple(<span class="hljs-string">"File"</span>, <span class="hljs-number">1</span>));<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Base&gt;&gt; files;
    <span class="hljs-comment">//  </span><font></font>
<font></font>
    <span class="hljs-built_in">std</span>::sort(files.begin(), files.end(), <span class="hljs-built_in">std</span>::bind(comparator, <span class="hljs-built_in">std</span>::ref(priorities), _1, _2));
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ここでは、unordered_mapを使用して優先順位を見つけ、typeidをstd :: type_indexにラップします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、最後の2つの方法のどこかで停止した可能性があります。</font><font style="vertical-align: inherit;">もちろん、これらの方法には上記の欠点がありますが、おそらくそれらの料金は高すぎません。</font><font style="vertical-align: inherit;">それでも、最後に、デュアルディスパッチメソッドでランタイム構成のアイデアを実装してみましょう</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法9.外部から優先度を構成する複数のスケジューリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスの構造では、いつものように、これ以上はありません：</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス構造</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    File(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Folder</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Folder(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Symlink</span> {</span>
<span class="hljs-keyword">public</span>:<font></font>
<font></font>
    Symlink(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;name)<font></font>
        : name(name)<font></font>
    {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">getPrintedName</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Symlink_"</span> + getName();<font></font>
    }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">using</span> Element = <span class="hljs-built_in">std</span>::variant&lt;Folder, File, Symlink&gt;;
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
優先順位をどこかに保存するには、別のクラス構造を作成する必要があります。</font><font style="vertical-align: inherit;">基本クラスから始めましょう。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ElementPriorityBase</span> {</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">printedType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPriority</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span> </span>= <span class="hljs-number">0</span>;<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはヘルパークラスであり、優先順位を満たすために使用されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして彼の相続人はここにあります：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>&gt;
<span class="hljs-title">struct</span> <span class="hljs-title">ElementPriority</span>:</span> <span class="hljs-keyword">public</span> ElementPriorityBase {
    <span class="hljs-keyword">int</span> priority = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">printedType</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(<span class="hljs-built_in">std</span>::is_same_v&lt;T, File&gt;)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"File"</span>;<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">constexpr</span> (<span class="hljs-built_in">std</span>::is_same_v&lt;T, Folder&gt;) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Folder"</span>;<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">constexpr</span> (<span class="hljs-built_in">std</span>::is_same_v&lt;T, Symlink&gt;) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Symlink"</span>;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setPriority</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span> <span class="hljs-keyword">override</span> </span>{<font></font>
        priority = p;<font></font>
    }<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドの考え方は次のとおりです：ファイル、フォルダーなどによってパラメーター化されたこのクラスの要素からstd ::タプルを作成します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Empty</span> {</span>};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Ts&gt;
<span class="hljs-keyword">auto</span> <span class="hljs-title">makeElementPriorityTupleFromElementVariant</span><span class="hljs-params">(Empty&lt;<span class="hljs-built_in">std</span>::variant&lt;Ts...&gt;&gt;)</span> -&gt; <span class="hljs-built_in">std</span>::tuple&lt;ElementPriority&lt;Ts&gt;...&gt; </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::make_tuple(ElementPriority&lt;Ts&gt;()...);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">using</span> ElementPriorityTuple = <span class="hljs-keyword">decltype</span>(makeElementPriorityTupleFromElementVariant(<span class="hljs-built_in">std</span>::declval&lt;Empty&lt;Element&gt;&gt;()));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
makeElementPriorityTupleFromElementVariant関数は、File、Folder、...クラスのバリアントであるElementタイプから必要なタプルを作成するだけです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バリアントのインスタンスを作成せずにタプルを作成できるように、Emptyクラスが必要です（以下を参照）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパレータは次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;class T&gt;
<span class="hljs-keyword">int</span> <span class="hljs-title">priority</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ElementPriorityTuple &amp;<span class="hljs-built_in">array</span>, <span class="hljs-keyword">const</span> T &amp;element)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::get&lt;ElementPriority&lt;T&gt;&gt;(<span class="hljs-built_in">array</span>).priority;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">comparator</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ElementPriorityTuple &amp;<span class="hljs-built_in">array</span>, <span class="hljs-keyword">const</span> Element &amp;first, <span class="hljs-keyword">const</span> Element &amp;second)</span> </span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span> result = <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentFirst){
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::visit([&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;contentSecond){
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> priorityFirst = priority(<span class="hljs-built_in">array</span>, contentFirst);
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> prioritySecond = priority(<span class="hljs-built_in">array</span>, contentSecond);
            <span class="hljs-keyword">if</span> (priorityFirst != prioritySecond) {
                <span class="hljs-keyword">return</span> priorityFirst &gt; prioritySecond;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> contentFirst.getName() &lt; contentSecond.getName();<font></font>
            }<font></font>
        }, second);<font></font>
    }, first);<font></font>
    <span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパレータ自体について特別なことは何もありません。</font><font style="vertical-align: inherit;">また、補助関数の優先度では、タプルから必要な要素を取得します。これは、この要素をパラメーター化する必要がある型がわかっているためです。</font><font style="vertical-align: inherit;">その結果、マップ検索は必要なく、優先検索は一定の（そして非常に速い）時間で実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
優先度のリストに記入するために、ElementPriorityの実装の詳細に踏み込むことなく操作できる配列を取得する必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> <span class="hljs-keyword">tuple_t</span>&gt;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::pair&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::reference_wrapper&lt;ElementPriorityBase&gt;&gt;&gt; <span class="hljs-title">makeElementPriorityBaseArray</span><span class="hljs-params">(<span class="hljs-keyword">tuple_t</span>&amp; tuple)</span> </span>{
    <span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> get_array = [](<span class="hljs-keyword">auto</span>&amp;... e){
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::pair&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::reference_wrapper&lt;ElementPriorityBase&gt;&gt;&gt;{<span class="hljs-built_in">std</span>::make_pair(e.printedType(), <span class="hljs-built_in">std</span>::ref(<span class="hljs-keyword">static_cast</span>&lt;ElementPriorityBase&amp;&gt;(e)))...};<font></font>
    };<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::apply(get_array, tuple);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、フィルアンドソートリストの作成は次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">    ElementPriorityTuple tuple = makeElementPriorityTupleFromElementVariant(Empty&lt;Element&gt;());<font></font>
<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::pair&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::reference_wrapper&lt;ElementPriorityBase&gt;&gt;&gt; arrayToFill = makeElementPriorityBaseArray(tuple);<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;[typeStr, element]: arrayToFill) {
        <span class="hljs-keyword">if</span> (typeStr == <span class="hljs-string">"Folder"</span>) {<font></font>
            element.get().setPriority(<span class="hljs-number">3</span>);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (typeStr == <span class="hljs-string">"File"</span>) {<font></font>
            element.get().setPriority(<span class="hljs-number">2</span>);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (typeStr == <span class="hljs-string">"Symlink"</span>) {<font></font>
            element.get().setPriority(<span class="hljs-number">1</span>);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Element&gt; files = {Folder(<span class="hljs-string">"1"</span>), File(<span class="hljs-string">"3"</span>), File(<span class="hljs-string">"2"</span>), Folder(<span class="hljs-string">"4"</span>), Symlink(<span class="hljs-string">"1"</span>), Symlink(<span class="hljs-string">"5"</span>), Symlink(<span class="hljs-string">"1"</span>)};<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::sort(files.begin(), files.end(), <span class="hljs-built_in">std</span>::bind(comparator, <span class="hljs-built_in">std</span>::ref(tuple), _1, _2));<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> Element &amp;element: files) {
        <span class="hljs-built_in">std</span>::visit([](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;elem) {
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; elem.getPrintedName() &lt;&lt; <span class="hljs-string">" "</span>;<font></font>
        }, element);<font></font>
    }<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なコード</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
まず、優先度を含むタプルを作成し、それから基本クラスへのリンクの配列を生成し、優先度を入力してから、通常どおりに並べ替えます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、一見単純なタスクの良い解決策を見つけることが常に可能であるとは限りません。</font><font style="vertical-align: inherit;">時には、停止して、何であるかから選択する必要があります。</font><font style="vertical-align: inherit;">これは、「クリーンなコードとは何か」、「理想的なコードはあるか」、「プログラマーが問題をどの程度美しく解決する必要があるか」というホリバーの質問を引き起こします。</font><font style="vertical-align: inherit;">この例を見て、これらの質問に対する答えを考え直したいと思います。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485870/index.html">サハリンにGameDevはありますか？2.V</a></li>
<li><a href="../ja485872/index.html">そしゃくロジスティック回帰</a></li>
<li><a href="../ja485874/index.html">「Pythonの学習：ゲームプログラミング、データの視覚化、Webアプリケーション」という本。第三版</a></li>
<li><a href="../ja485876/index.html">OpenwrtルーターでOpenVPNを高速化します。はんだごてとハードな過激主義のない代替バージョン</a></li>
<li><a href="../ja485878/index.html">JetCalcプラットフォームで管理会計を整理するための一連のステップ</a></li>
<li><a href="../ja485884/index.html">中国のレビトロンを設定する方法</a></li>
<li><a href="../ja485886/index.html">Yandex.DirectおよびGoogle広告からの競合他社のキーと広告を無料で解析する方法（および理由）</a></li>
<li><a href="../ja485888/index.html">サーバー要求偽造、ブラインドSSRF操作</a></li>
<li><a href="../ja485890/index.html">Kerasによるモデルのトレーニングと評価</a></li>
<li><a href="../ja485892/index.html">トライデント時代の終わり</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>