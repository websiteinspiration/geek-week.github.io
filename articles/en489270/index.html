<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùüèæ üê∫ üõèÔ∏è WebAuthn in real life üë∂üèº üåë üèòÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In September 2019, the Mail.ru Mail team supported WebAuthn technology. We became the first email service in the world that implemented the ability to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>WebAuthn in real life</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/489270/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In September 2019, the Mail.ru Mail team supported WebAuthn technology. </font><font style="vertical-align: inherit;">We became the first email service in the world that implemented the ability to log into your account using electronic keys instead of passwords. </font><font style="vertical-align: inherit;">Now this opportunity is available to all our users, you can bind the electronic key to your account in the settings and after that freely use it to enter. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/ke/6l/dfke6l6d7u73ncpy-xvhnyq3lro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">already wrote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news about this event here, on Habr√©. </font><font style="vertical-align: inherit;">In this article I want to talk more about the reasons for implementing WebAuthn in our services and about the technical aspects of working with this technology.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is WebAuthn and why is it needed</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the modern world, most Internet services use passwords to authenticate users. </font><font style="vertical-align: inherit;">The advantage of passwords is their simplicity: to access the necessary resource you just need to know the password and enter it correctly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the disadvantages of passwords often outweigh their advantages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if the password is simple - you can pick it up;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if the same password is used in several services, then breaking one of them the attacker gets access to all the others;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passwords are vulnerable to phishing attacks;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strong and unique passwords are difficult to remember, so the user is forced to write down the password on the sticker and stick it on the monitor, from where it can be easily spied, stolen or lost.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To get rid of the shortcomings of passwords and make the authentication process more secure, various ways to replace passwords appear - this is the use of one-time codes that are sent to the user via SMS or through PUSH notifications, or the use of special TOTP-code generator applications with which the user can log in account without entering your password. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Companies such as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yahoo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> think about using passwordless authentication methods and completely abandon the use of passwords in their services. Mail.ru mail is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no exception</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we have long supported login using one-time codes, which allows users not to remember complex and strong passwords and quickly gain access to their account. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another alternative to passwords is authentication using electronic keys (security keys, another name - electronic authenticators). The principle of its operation is based on the use of asymmetric cryptography and is described in the FIDO2 protocol family, developed by the FIDO (Fast IDentity Online) alliance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In March 2019, W3C released the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first version of the standard.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which describes a browser-based JS API that allows you to interact with electronic keys. </font><font style="vertical-align: inherit;">The standard received the recommendation status and the name Web Authentication: API for access to credentials using a public key: level one (Web Authentication: An API for accessing Public Key Credentials Level 1) - for short, WebAuthn.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How WebAuthn Works</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following key actors in the authentication process using WebAuthn are identified:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Client (WebAuthn Client) - a browser that supports WebAuthn API;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web application - an application running on the client using the WebAuthn API to interact with credentials;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">credentials (Public Key Credential) - a pair of public and private cryptographic keys that are associated with a user account;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authenticator - a device or program - creates user credentials and signs requests from the relying party with these credentials (another name is an electronic key);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the relying party (WebAuthn Relying Party) - the web server - stores the public key associated with the user account, verifies the validity of the signing of their requests with the private key stored in the authenticator.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The WebAuthn API allows you to perform only two operations. </font><font style="vertical-align: inherit;">It allows you to create new credentials and sign requests from the server with already created credentials.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creation of credentials ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MakeCredential</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></h4><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e11/a8f/005/e11a8f00507aed6df55fcb77c12e4775.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheme of the stage with the creation of credentials, taken from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w3.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At this stage, the electronic key is registered in the user account. </font><font style="vertical-align: inherit;">Inside the authenticator, a new pair of public and private keys is generated, and the public key is sent and stored in the user account on the server.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> credential = <span class="hljs-keyword">await</span> navigator.credentials.create({
    <span class="hljs-attr">publicKey</span>: publicKeyMakeCredentialOptions<font></font>
});<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signing a request with credentials already created ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetAssertion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></h4><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/794/f7f/ebd794f7f7c8a8de080696e412b71ad9.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheme of the stage with verification of credentials, taken from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w3.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
At this step, it is checked whether the user has an authenticator whose public key is stored in the user account. A random token is signed with the private key inside the authenticator and sent to the server, where the server checks the signature is correct. Accordingly, if the signature is correct, then we conclude that the user really has this authenticator.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> assertion = <span class="hljs-keyword">await</span> navigator.credentials.get({
    <span class="hljs-attr">publicKey</span>: publicKeyGetAssertionOptions<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can see a demonstration of the process of entering Mail.ru Mail using WebAuthn in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can learn more about the WebAuthn API itself in the WebAuthn specification and, for example, in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this Medium article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the work of WebAuthn is based on the use of electronic keys. </font><font style="vertical-align: inherit;">What is it?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Electronic keys</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Electronic keys (I will sometimes call them also ‚ÄúWebAuthn keys‚Äù, Security Security key) are devices or programs that implement FIDO2 interaction protocols. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the WebAuthn specification and at the household level, all electronic keys are classified in one of two categories:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">platform-independent keys (roaming authenticators);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Platform Authenticators</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Platform-independent keys are external physical devices, such as Yubikey from Yubico or Titan Security Key from Google. Typically, such authenticators are connected to the user's computer or smartphone via USB, NFC or BLE. Communication with such devices takes place using the special CTAP protocol (Client to Authenticator Protocol). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To start working with physical electronic keys, the user needs to bind him once to his account. After that, the user gets the opportunity to use this electronic key to enter on any other device and in any browser. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/9d/5o/ic9d5oypb1role8nor03olfthbk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples of various platform- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">independent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keys, taken from </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">theverge.com</font></a><font style="vertical-align: inherit;"> .</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the mechanism of operation of the first type of keys is more or less clear, then I want to dwell in more detail on the second category. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the second case, public and private cryptographic keys are generated and stored not inside an external physical device, but with some software module inside a computer or smartphone. This software module can be implemented at the specific application level, or at the operating system level. For example, in a secure chip inside a computer, to which your OS will only give access if you are logged in and have proved that you are really you.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In most modern implementations in different browsers, the OS requires the user to confirm themselves either with a fingerprint or by entering the password for the user account. It is important to clarify that although the user needs to put his finger on the fingerprint scanner to use such keys, the fingerprint itself is not stored anywhere and is not transmitted anywhere. This is just the way in which the operating system or browser validates the user. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/qo/to/suqotot9w3zjsggmzahoazkpise.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use of platform-specific authenticators.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Only encoded public key information or a signed random token is returned to the web service from the WebAuthn API, which is then stored and checked on the server side.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, in the case of the built-in authenticator, it will be possible to use it only on the browser and device where it was attached to the account. In other words, platform-dependent keys will have to be registered separately on each device / browser in which you intend to log in to your account. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the future, more ways are expected to appear that will enable the user to activate the use of platform-specific authenticators, for example, by using a face scan, or by entering a PIN code from the device. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When creating credentials or calculating the signature, you can specify the preferred type of authenticator in a special parameter that takes two values ‚Äã‚Äã- </font></font><code>cross-platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In this case, the user will be asked to use only one of the types of electronic keys.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> credential = <span class="hljs-keyword">await</span> navigator.credentials.create({
    <span class="hljs-attr">publicKey</span>: {
        <span class="hljs-attr">authenticatorSelection</span>: {
            <span class="hljs-attr">authenticatorAttachment</span>: <span class="hljs-string">'cross-platform'</span>,<font></font>
        },<font></font>
        ...,<font></font>
    },<font></font>
});<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAuthn Benefits</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What are the benefits of WebAuthn technology for users and developers?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user does not need to remember and enter any passwords, and the server does not store user passwords, respectively, all the shortcomings that the passwords had are gone. </font><font style="vertical-align: inherit;">Stealing a physical authenticator from a user is much more difficult than intercepting a password transmitted electronically over an insecure connection, and a leak of public keys on the site will not open the private key hidden in the device.</font></font></li>
<li>       origin ,       .         origin  .   ,      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">thesslstore.com</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">yubico.com</a>)       .</li>
<li>  WebAuthn      -   . -     web-    ,   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAuthn itself, as an API, provides developers with an abstraction over the implementation of authenticators and allows you to write code once, which then will work with all types and types of electronic keys. </font><font style="vertical-align: inherit;">Thus WebAuthn is a scalable solution for user authentication.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even more about why WebAuthn is safer than a password - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAuthn for developers: 5 steps to better authentication</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Getting started with security keys</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAuthn Support</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Whether or not dongle authentication works on your device depends on several different factors. Starting from whether your browser supports the WebAuthn API, and ending with what connectors are on your computer and what communication methods your authenticator supports. WebAuthn‚Äôs performance also depends heavily on which device and OS you use. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the time of writing, according to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caniuse.com, the WebAuthn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API is supported by 80.5% of users. According to statistics on users of Mail.ru, this figure has the same order - 79.8%. However, in order to use WebAuthn in all these browsers, you will definitely need an external electronic key.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not all browsers that support the WebAuthn API can work with platform-dependent keys (for convenience, I will refer to these keys as ‚ÄúFingerprints‚Äù later on). </font><font style="vertical-align: inherit;">In addition, to work with such keys, it is not enough to install a browser that can work with them. </font><font style="vertical-align: inherit;">It is also necessary that your device and OS have an appropriate module / sensor and be able to interact with it. </font><font style="vertical-align: inherit;">Of all Mail.ru users, only 9.0% have the ability to add platform-specific keys. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I‚Äôll tell you briefly about the support of WebAuthn by different OS and browsers.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebAuthn support on Windows is very good. </font><font style="vertical-align: inherit;">The Windows Hello authentication subsystem can work with electronic keys. </font><font style="vertical-align: inherit;">Therefore, all the latest browser versions for this OS - Microsoft Edge, Google Chrome, Opera and Mozilla Firefox - support working with both foreign keys and fingerprints. </font><font style="vertical-align: inherit;">Internet Explorer API WebAuthn does not support.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/je/nz/tj/jenztjxnptpkhabd0igycdbqex4.jpeg" width="300"></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
External authenticators are usually supported by any modern Linux distributions, as well as browsers such as Google Chrome, Chromium, and Mozilla Firefox. </font><font style="vertical-align: inherit;">However, on some systems </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">additional settings may be required</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to work with foreign keys </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebAuthn support on Android is also good. </font><font style="vertical-align: inherit;">Google Chrome, Opera and Mozilla Firefox - support working with both foreign keys and fingerprints. </font><font style="vertical-align: inherit;">But Microsoft Edge for Android does not support the WebAuthn API at all. </font><font style="vertical-align: inherit;">There is also a bug in Firefox - specifying the preferred type of authenticator using the option does not work for it </font></font><code>authenticatorAttachment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/pn/if/blpnifvrarbh3sfzryufr5fyyha.jpeg"><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Among all browsers for the iOS operating system, WebAuthn only supports mobile Safari version 13.3. </font><font style="vertical-align: inherit;">Moreover, he can only work with external electronic keys. </font><font style="vertical-align: inherit;">Other browsers for iOS do not yet support WebAuthn at all.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macOS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoft Edge, Google Chrome, Opera and Mozilla Firefox support working with foreign keys on macOS. </font><font style="vertical-align: inherit;">Google Chrome also supports fingerprinting, allowing you to use WebAuthn with Touch ID.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/211/b1e/845/211b1e8455b92f5d340a298f4eee9818.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If in Edge, Opera and Chrome the interface for interacting with WebAuthn is the same, then Firefox has distinguished itself here. Instead of a pretty popup in Firefox, when using WebAuthn, a small notification appears in the corner of the screen. If you accidentally click on a page, it simply collapses, leaving the user at a loss what is happening now. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/1t/7c/re1t7crwl47zhqytg9egntqcmlg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, Safari has not yet supported WebAuthn. WebAuthn support was announced in Safari 13, which will be available on macOS 10.15 Catalina. However, at the time of writing, my checks showed that the WebAuthn API in Safari, although present, is extremely unstable and does not work with all authenticators. Like its mobile version, Safari does not work with built-in electronic keys. In addition, it does not yet support any of the foreign electronic keys.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we realized that in addition to support issues, WebAuthn has even greater differences in the UI. </font><font style="vertical-align: inherit;">These differences lead to the fact that you have to explain in more detail to the user what is required of him in order to use the entrance through electronic keys. </font><font style="vertical-align: inherit;">In addition, with each new browser release, these pop-ups may change, and the process of using WebAuthn today can be very different from what it was yesterday. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is clear why this is happening. </font><font style="vertical-align: inherit;">WebAuthn technology is still quite young, and browser developers are still experimenting with different types of implementation. </font><font style="vertical-align: inherit;">One can only hope that over time the support for WebAuthn in browsers will stabilize and we will be able to use it without restrictions.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authenticator Registration</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we give the user the opportunity to register different electronic keys in his account, then he should have the opportunity to view their list and remove obsolete or unnecessary ones from it. This may be useful, for example, in the event of a compromise of one of the keys. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The WebAuthn API is designed so that when creating and using credentials, the client is not available any information about the type, type and name of the authenticators used. Accordingly, we do not have any data by which we could distinguish one key from another. All keys in the list will be presented equally without distinguishing features. Question: what to do?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/504/c74/948/504c7494832c0f8dfadb7c5c05d44a20.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can get some information about the authenticator used if you request the so-called credentials when creating credentials. certification. Certification is a way for an authenticator to prove its authenticity to a server. In some cases, information about the key manufacturer can be obtained from certification. But in the general case, the data used is still not enough to clearly distinguish one electronic key associated with an account from another.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> credential = <span class="hljs-keyword">await</span> navigator.credentials.create({
    <span class="hljs-attr">publicKey</span>: {
        <span class="hljs-attr">attestation</span>: <span class="hljs-string">'direct'</span>,<font></font>
         ...,<font></font>
    },<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, after connecting the key to the account in Mail, we give the user the opportunity to assign some name to the newly created record. And already further the user can distinguish one key from another by this name. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fact that the information that is available to the client and server does not contain any data about the type of authenticator leads to another unpleasant feature of WebAuthn. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine a user who added only one fingerprint to his account, for example, in his smartphone. When we want to log in using the WebAuthn API, we pass in a function call</font></font><code>navigator.credentials.get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">list of all keys associated with an account. But the browser cannot determine from this list which of the authenticators are present on the device and which are not. Therefore, he is forced to always offer the user to use WebAuthn. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, even when trying to log into an account on a computer that does not support authentication through fingerprints, the user will still be offered to use WebAuthn. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To implement the correct behavior in such situations, you need to refine the WebAuthn standard itself. For example, to encode information about whether a cross-platform key or fingerprint was used to create it and not to offer the WebAuthn user in cases when it is known in advance that he will not be able to use it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are ways to get around this behavior in some situations. </font><font style="vertical-align: inherit;">For example, allow the user to register fingerprints and physical keys only individually. </font><font style="vertical-align: inherit;">And when using keys, filter fingerprints on devices that obviously do not support them. </font><font style="vertical-align: inherit;">But this method does not solve the problem completely. </font><font style="vertical-align: inherit;">And there is no reliable way to solve this problem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our users have not yet received complaints about this behavior, so we are currently investigating this feature and deciding what to do in the future.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAuthn work on different subdomains</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As I said earlier, WebAuthn provides out of the box protection against phishing. When registering electronic keys, information is stored </font></font><code>origin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on which this key was registered. WebAuthn does not allow the use of this electronic key on resources, with another </font></font><code>origin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Large web services such as Mail.ru often use several different domains for their work. For example, we have a domain </font></font><code>e.mail.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for Mail and </font></font><code>cloud.mail.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the Cloud. And on each of them we have a common form of authorization. In this case, the standard WebAuthn settings are not enough. So that we can use </font></font><code>origin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keys registered on the other on one </font></font><code>origin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it is necessary that these two domains have a common suffix (a common subdomain of more than the first level). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example at domains</font></font><code>e.mail.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the </font></font><code>cloud.mail.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">common suffix is </font></font><code>mail.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, when registering and using electronic keys, we can specify an </font></font><code>rpId</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">equal </font><font style="vertical-align: inherit;">parameter in the request options </font></font><code>mail.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and then we can use the same key on the subkey itself </font></font><code>https://mail.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and on any of its subdomains.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> credential = <span class="hljs-keyword">await</span> navigator.credentials.create({
    <span class="hljs-attr">publicKey</span>: {
        <span class="hljs-attr">rp</span>: {
            <span class="hljs-attr">name</span>: <span class="hljs-string">'Mail.ru Group'</span>,
            <span class="hljs-attr">id</span>: <span class="hljs-string">'mail.ru'</span>,<font></font>
        },<font></font>
        ...,<font></font>
    },<font></font>
});<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAuthn work in iframe</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For security reasons, calls to WebAuthn methods are forbidden from inside cross-origin iframes. Our projects use a single authorization form, it is located at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://account.mail.ru/login</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and when we want to show the authorization form on any other project, for example, in Mail or in the Cloud, iframe is actually added to the page inside which this url opens. This solution allows us to simultaneously update the form itself on all projects that use it, and simplifies the collection of statistics, and also improves the user‚Äôs UX, allowing him to stay on the same service where he was originally.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/su/tr/khsutrku62gmcaetj4nbi73orl4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our case, the restriction on calls to WebAuthn methods from within the iframe made us look for ways to get around it, because we wanted to allow us to log in via WebAuthn anywhere we show the authorization form. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What have we done. </font><font style="vertical-align: inherit;">To open the authorization form on all services, we use a small library, which essentially only creates an iframe on the page with the correct url and after loading its contents shows the iframe on the page. </font><font style="vertical-align: inherit;">This library supports communication with iframes through </font></font><code>postMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and uses it, for example, to resize iframes when resizing its contents. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We came up with and implemented the following mechanism:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the authorization application when using WebAuthn, we determine whether we are now open inside the iframe or not;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if we are open inside the iframe, then instead of calling the browser API WebAuthn, we serialize the call parameters and send them through the </font></font><code>postMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parent window;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the parent window we deserialize these parameters and call the WebAuthn methods;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when we receive an answer, we serialize it in the same way and send it through the </font></font><code>postMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inside of an iframe, where we accept this answer and perform further processing.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, we circumvented this ban and realized the possibility of using the same key during authorization in all services of the company.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebAuthn Test Automation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our team for all new projects and features, we always write integration UI autotests using selenium-like solutions and the WebDriver protocol. Therefore, during the development of WebAuthn, the question arose of how to write autotests UI on it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The difficulty in writing such autotests is that the WebDriver protocol does not yet have methods for automating interaction with WebAuthn. And in the standard itself there is still no support for testing automation WebAuthn API (but there is an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">issue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on this topic). The first ideas on how this automation can be organized are described in a draft </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Authentication: An API for accessing Public Key Credentials Level 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and have not yet been published, not to mention being supported elsewhere. Therefore, I had to come up with alternative solutions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Because </font><font style="vertical-align: inherit;">we cannot work with the native implementation of WebAuthn functions in autotests (there are no methods for controlling the browser), then we had to do the following. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somewhere in the autotest, before trying to use WebAuthn, we patch the browser‚Äôs global host objects and replace the native functions with our implementations. </font><font style="vertical-align: inherit;">Here we save the arguments with which the native functions were called into a variable and return the promise.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//    WebAuthn   </span>
navigator.credentials.create = <span class="hljs-function">(<span class="hljs-params">options</span>) =&gt;</span> {
    <span class="hljs-built_in">window</span>.credentialsCreateArgs = options;<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">window</span>.credentialsCreateSuccess = resolve;
        <span class="hljs-built_in">window</span>.credentialsCreateFail = reject;<font></font>
    });<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we need to somehow get the result of the function to return it to emulate the work of WebAuthn in the tests. </font><font style="vertical-align: inherit;">We can always return some kind of constant hardcoded answer.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// -    </span>
<span class="hljs-keyword">const</span> credentialsCreateResponse = { <span class="hljs-comment">/* constant object */</span> };<font></font>
<font></font>
<span class="hljs-built_in">window</span>.credentialsCreateSuccess(credentialsCreateResponse);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, we will have to teach our server to accept this answer and not validate it, but consider it automatically correct. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What are the disadvantages of such tests? </font><font style="vertical-align: inherit;">In this case, we will not be able to:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check whether the client correctly forms and rolls parameters into WebAuthn functions;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check the correctness of backend changes when rolling backend releases.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, such tests will not be reliable enough, and this does not suit us. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We decided to go the more difficult way and eventually wrote our own implementation of FIDO2 protocols and algorithms on Node.js, with which we managed to lock these functions as close as possible to the native implementations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, we wrote a function that, based on the request parameters, calculates the response for the locked WebAuthn functions so that the server considers it to be completely correct.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// -    </span>
<span class="hljs-keyword">const</span> credentialsCreateResponse =<font></font>
    calcCredentialsCreateResponse(<span class="hljs-built_in">window</span>.credentialsCreateArgs);<font></font>
 <font></font>
<span class="hljs-built_in">window</span>.credentialsCreateSuccess(credentialsCreateResponse);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the autotest operation scheme is as follows:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get the arguments that the WebAuthn methods were called with;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we run these arguments through a function that implements the same algorithms as inside real authenticators;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we get the result, and return it from our replaced functions;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">all the rest of the code in our service processes these responses in the usual mode and as a result, all the behavior of the service does not differ from its behavior for real users.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sources of such an autotest and the implementation of the most disguised authenticator lie in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the github repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , you can start and investigate their work later. </font><font style="vertical-align: inherit;">When writing the authenticator, we were guided only by the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w3.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> specification </font><font style="vertical-align: inherit;">and the Node.js documentation.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Present and Future of WebAuthn</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So what we have at the moment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">launched a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fully working electronic key entry at the end of September 2019. Now we do not advertise this type of entry, and it is not used very actively - less than a hundred unique users per day. But we are confident that over time their number will only grow, and sooner or later, electronic key logging will become one of the main types of logging into your account. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What keeps us from actively promoting such an entry is that WebAuthn itself is still not sufficiently reliable and stable in browsers, and there are many nuances regarding its support and operation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why is WebAuthn now a feature not for a wide audience?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most basic factor here is that it requires the user to have a special device - an electronic key. Now the need for it is not so acutely felt by users. Many users are not aware of their existence. But over time, when more and more services begin to support this way of logging in, the number of users with such keys will also begin to grow.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A significant leap forward in the popularity of WebAuthn can occur when Google engineers complete the development and testing of the possibility of using smartphones on Android and iOS as external physical electronic keys for WebAuthn and open this opportunity for all Internet services. </font><font style="vertical-align: inherit;">In this case, each owner of a modern smartphone will essentially get the opportunity to use it as a WebAuthn key and the number of WebAuthn users will increase dramatically. </font><font style="vertical-align: inherit;">Now this feature </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is available</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> only to users of the Google email service.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/bc0/124/3d8/bc01243d824383bfcd014b5891526db7.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How else can you use WebAuthn?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mail.ru uses WebAuthn now as an alternative to passwords for entering the account. But essentially WebAuthn can be used like any of the authorization factors. It can be used as instead of the first factor in one-factor authentication. So instead of the second - as an additional password protection with two-factor. In addition, confirmation via an electronic key can be used, for example, when restoring access to an account if the user has lost or forgotten his password.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebAuthn can be used as an additional security measure when editing critical settings of your account. </font><font style="vertical-align: inherit;">Imagine how convenient it is - you go to the profile settings in your favorite service, and you do not need to remember and enter a password to change them! </font><font style="vertical-align: inherit;">Just put your finger on the fingerprint scanner, and you will be passed on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can find even more different scenarios for using WebAuthn in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this Medium article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Popular questions and answers</font></font></h2><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where can I buy an electronic key?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So far, there are not many places in Russia where you can purchase electronic keys compatible with FIDO2 protocols. </font><font style="vertical-align: inherit;">Most suppliers only sell them in bulk, in batches of 10 or more. </font><font style="vertical-align: inherit;">You can buy electronic keys piece by piece in the following stores:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dataway Security</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Softline</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, such keys can be ordered in friendly online stores, for example, on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> there are comparative characteristics of electronic switches 10 models with links to stores where they can be purchased.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What if I lose my electronic key?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using electronic keys, you should treat them with the same attention as with the keys to the apartment or car. </font><font style="vertical-align: inherit;">If we lose the keys to the apartment, we usually change the lock and get new keys. </font><font style="vertical-align: inherit;">The same is with electronic keys: if they are lost, you should immediately remove them from all accounts where they were linked, and attach a new authenticator to all accounts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In case of loss of the main electronic key, you should have several additional authentication methods. </font><font style="vertical-align: inherit;">For example, using the application for generating codes, or using a spare key that can be stored in a specially protected place: in a safe or in a bank cell.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What should I do if someone else gets access to my electronic key?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If two-factor authentication is included in your account and the electronic key is just one of the factors, then in this case your account will be protected from hacking. Unless the attacker has access to the second factor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the electronic key is the only factor sufficient to enter the account, then even in this case the attacker must know the name of the account in which this electronic key is registered. This information is not stored inside the electronic key, and therefore an accidentally lost electronic key with a high degree of probability will be completely useless for a passerby who found it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, there are schemes in which electronic keys can be used as a replacement not only for a password, but also for a login. In such a scenario, the server only provides credentials when requested</font></font><i><code>origin</code></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the credentials themselves are entirely stored in the authenticator. In this case, the lost electronic key can already be easily used to enter your account, and then you should be more careful about your authenticator. For protection in such scenarios, you can use electronic keys with additional security measures, for example, keys, for activation of which you need to enter a PIN code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In any case, as soon as you notice the loss of your key, you should immediately untie it from all accounts in all services, where you can use it to enter. That is why all services should provide the ability to manage a list of bound authenticators. The faster you notice the loss, the less time the attackers will have in order to gain access to your data.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now my biometric data will be stored on Mail.ru/Google/Microsoft servers?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When WebAuthn works with built-in authenticators (for example, using Touch ID on Mac OS), only the corresponding sensor and the operating system itself have access to your biometric data. </font><font style="vertical-align: inherit;">The web service does not receive or process any biometric information; it works only with the public cryptographic key and with data signed with the private key. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And on the server itself, only information about the public key is stored. </font><font style="vertical-align: inherit;">Therefore, WebAuthn does not use your biometric data in any way to work with built-in authenticators.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As we found out, WebAuthn has many important advantages over passwords:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when using WebAuthn it is not required to remember and enter passwords;</font></font></li>
<li>WebAuthn    - ,             ;</li>
<li>WebAuthn     ;</li>
<li>WebAuthn ‚Äî     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, passwords should not be discarded. </font><font style="vertical-align: inherit;">A physical key can still be stolen or lost, just like a password. </font><font style="vertical-align: inherit;">But passwords have an important advantage. </font><font style="vertical-align: inherit;">As long as they are stored </font></font><i><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only</font></font></strong></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the head, they won‚Äôt be able to recognize them without the owner‚Äôs knowledge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Summing up, I want to say that WebAuthn technology is a very promising technology that changes such a basic and important element of the functioning of all modern web-services as authentication. </font><font style="vertical-align: inherit;">It is also a fairly young technology and users are not yet used to it. </font><font style="vertical-align: inherit;">But it is in our power to make it more popular and convenient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope our experience of implementing WebAuthn in Mail.ru Mail will help you to support it in your services, and together we will make the Internet more secure and modern!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Additional materials</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Web Authentication: An API for accessing Public Key Credentials Level 1</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">herrjemand/awesome-webauthn: A curated list of awesome WebAuthn/FIDO2 resources</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">artifact-project/webauthn: A set of tools for building an API and interacts with WebAuthn</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Getting started with security keys</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">4 Password Authentication Risk &amp; How to Avoid Them</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">WebAuthn   ,  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Getting Started with WebAuthn with Nick Steele</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Key generation in Yubico U2F Keys</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489256/index.html">Foundation Fieldbus Automation Systems</a></li>
<li><a href="../en489258/index.html">How are very long integer types implemented in Python?</a></li>
<li><a href="../en489260/index.html">How to design a large-scale automated system for a large enterprise in seven steps</a></li>
<li><a href="../en489262/index.html">Why it's not easy to give developers freedom of choice</a></li>
<li><a href="../en489268/index.html">Implementation of the process of uploading a file from a container with a browser to a test framework</a></li>
<li><a href="../en489272/index.html">Eyes, brain, video quality: reflections on 120fps, 8K, HDR, wands, cones and the ‚Äúsoap opera effect‚Äù</a></li>
<li><a href="../en489274/index.html">Assert messages in tests</a></li>
<li><a href="../en489276/index.html">Blood test for iron - how to control the level, diagnose the reasons why it is important</a></li>
<li><a href="../en489280/index.html">Ping all IPv6 hosts on the channel</a></li>
<li><a href="../en489282/index.html">DirectX 12 - From Leonardo da Vinci to Contemporary Art</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>