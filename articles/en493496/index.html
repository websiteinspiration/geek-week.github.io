<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèΩ üçá üíà ReactJS. Warning: Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memo üéâ üôÜ üë≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habr! 
 
 All reactjs developers who deal with interactivity between the back and front meet sooner or later, or have met, or will encounter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ReactJS. Warning: Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493496/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good day, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reactjs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> developers who deal with interactivity between the back and front meet sooner or later, or have met, or will encounter the following error: </font></font><br>
<img src="https://habrastorage.org/webt/a3/h0/dt/a3h0dtnel-srhhxnykg-ywlc4r0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Literally, it turns out like this:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warning. </font><font style="vertical-align: inherit;">Unable to update React state for an uninstalled component. </font><font style="vertical-align: inherit;">This is not an operation, but it indicates a memory leak in your application. </font><font style="vertical-align: inherit;">To fix, cancel all subscriptions and asynchronous tasks in the useEffect cleanup function.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, everything is quite simple, you just need to pay attention to the following phrases:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unable to perform state update</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an uninstalled component;</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cancel all subscriptions and asynchronous tasks</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useEffect cleanup</font></font></b></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the heart of hooks. </font><font style="vertical-align: inherit;">GO in under the cut!</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All reactjs programmers know what </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">condition</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (state) and that such an update (setState) too. </font><font style="vertical-align: inherit;">I will not be that.</font></font></li>
<li> .        : <br>
 1)   ;<br>
 2)     ;<br>
 3)   ;<br>
   ‚Äî 3 .  . <br>
 </li>
<li>   .     - , :  .    ,       async/await ‚Äî         .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">useEffect</a>.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">return () =&gt; {}  useEffect</a>.  ,    -        , :   . </li>
</ol><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's make a </font><font style="vertical-align: inherit;">
mistake: </font><font style="vertical-align: inherit;">Let's say we are developing a site with movie descriptions </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uploaded</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (we will not go deep into </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">the moviedb API</font></a><font style="vertical-align: inherit;"> , but take a specific movie as a basis). </font><font style="vertical-align: inherit;">We have two pages:</font></font><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Home</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/v6/gk/sl/v6gksl4dwmybbybjo2ja1ug0jaa.png"><br>
</div></div><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About us</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/9i/mf/vk/9imfvkyls0ns0mmgpetw826fgri.png"><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Links to both pages are available in the navigation panel, for example, in the header. </font><font style="vertical-align: inherit;">On the main page ("Home") there is communication with the back to upload information about the film. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/src/Pages/HomePage.js</font></font></i><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<font></font>
<font></font>
<span class="hljs-keyword">import</span> { MOVIE_DB_GET } <span class="hljs-keyword">from</span> <span class="hljs-string">'../config'</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> HomePage = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> fetchData = <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(MOVIE_DB_GET);
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> response.json();
        <span class="hljs-built_in">console</span>.log(result, <span class="hljs-string">'result'</span>)<font></font>
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-built_in">console</span>.error(e.message)<font></font>
      }<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//  get-     </span><font></font>
    fetchData();<font></font>
  }, []);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span><font></font>
  )<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> HomePage;
</code></pre><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/src/Pages/AboutPage.js</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> AboutPage = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
                
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span><font></font>
  )<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> AboutPage;
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To display information through a request, it is necessary to write information to the state for subsequent rendering: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/src/Pages/HomePage.js</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<font></font>
<font></font>
<span class="hljs-keyword">import</span> { MOVIE_DB_GET } <span class="hljs-keyword">from</span> <span class="hljs-string">'../config'</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> HomePage = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// movie - react-;</span>
  <span class="hljs-comment">// setMovie -   react-</span>
  <span class="hljs-keyword">const</span> [ movie, setMovie ] = useState(<span class="hljs-literal">null</span>);<font></font>
<font></font>
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> fetchData = <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(MOVIE_DB_GET);
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> response.json();
        <span class="hljs-built_in">console</span>.log(result, <span class="hljs-string">'result'</span>);<font></font>
        setMovie(result);<font></font>
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-built_in">console</span>.error(e.message)<font></font>
      }<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    fetchData();<font></font>
  }, []);<font></font>
<font></font>
  <span class="hljs-comment">// descriptionMovie -  ,  view,         movie</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

      {
        movie ? descriptionMovie() : false
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span><font></font>
  )<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> HomePage;
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will reproduce the error in the following way - we will switch from one route to another, that is, being on the page ‚ÄúAbout Us‚Äù, we will go to the page ‚ÄúHome‚Äù and immediately return again to the page ‚ÄúAbout Us‚Äù and voila ‚Äú </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Can't perform ... ..</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fact is that the server does not respond to requests instantly, asynchrony is used to still play the request in parallel with the necessary tasks. </font><font style="vertical-align: inherit;">But in the case of a quick return to the About Us page, the Home component is unmounted, which means that the state for this component will be reset, but the asynchronous request will still launch setMovie, which is no longer there and will throw an error. </font><font style="vertical-align: inherit;">The best solution is to prohibit the use of state updates when unmounting a component: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/src/Pages/HomePage.js</font></font></i><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<font></font>
<font></font>
<span class="hljs-keyword">import</span> { MOVIE_DB_GET } <span class="hljs-keyword">from</span> <span class="hljs-string">'../config'</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> HomePage = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// movie - react-;</span>
  <span class="hljs-comment">// setMovie -   react-</span>
  <span class="hljs-keyword">const</span> [ movie, setMovie ] = useState(<span class="hljs-literal">null</span>);<font></font>
<font></font>
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> cleanupFunction = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">const</span> fetchData = <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(MOVIE_DB_GET);
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> response.json();
        <span class="hljs-built_in">console</span>.log(result, <span class="hljs-string">'result'</span>)<font></font>
<font></font>
        <span class="hljs-comment">//     ,    </span>
        <span class="hljs-keyword">if</span>(!cleanupFunction) setMovie(result);<font></font>
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-built_in">console</span>.error(e.message)<font></font>
      }<font></font>
    };<font></font>
<font></font>
    fetchData();<font></font>
<font></font>
    <span class="hljs-comment">//   useEffect</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> cleanupFunction = <span class="hljs-literal">true</span>;<font></font>
  }, []);<font></font>
<font></font>
  <span class="hljs-comment">// descriptionMovie -  ,  view,         movie</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

      {
        movie ? descriptionMovie() : false
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span><font></font>
  )<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> HomePage;
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Features of component unmounting and state update</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Try / catch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> construct interaction </font><font style="vertical-align: inherit;">and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async / await async</font></font></a></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All source code can be viewed here: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://gitlab.com/ImaGadzhiev/react-cant-perform</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493480/index.html">Architecture for beginners or why you do not need to insert a flag in the sword man</a></li>
<li><a href="../en493482/index.html">Meet the cybernetic turtle, the predecessor of Roomba</a></li>
<li><a href="../en493484/index.html">Your C # is already ‚Äúfunctional,‚Äù just let it.</a></li>
<li><a href="../en493486/index.html">The most interesting automotive startups 2019-2020</a></li>
<li><a href="../en493488/index.html">Unity + git = friendship: part 1 gentleman's set</a></li>
<li><a href="../en493504/index.html">Our remote work experience in creating online stores</a></li>
<li><a href="../en493506/index.html">Why do geophysicists believe in flat earth theory in the 21st century?</a></li>
<li><a href="../en493508/index.html">Podcast: what awaits beginner scientists in the field of defense</a></li>
<li><a href="../en493512/index.html">"Pandemic" of scientific publications about COVID-19</a></li>
<li><a href="../en493514/index.html">Autonomous security system on Arduino + GSM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>