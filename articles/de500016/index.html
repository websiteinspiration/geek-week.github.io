<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï£ ‚ôªÔ∏è ‚òùüèª Praktische Arbeit mit FPGAs im Redd-Set. Mastering von DMA f√ºr den Avalon-ST-Bus und Umschalten zwischen Avalon-MM-Bussen üëµüèª üêÜ ‚ûï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir arbeiten weiter an der Schaffung realer Ger√§te, die auf dem Redd FPGA-Komplex basieren. F√ºr ein anderes All-Hardware-Projekt ben√∂tige ich einen ei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Praktische Arbeit mit FPGAs im Redd-Set. Mastering von DMA f√ºr den Avalon-ST-Bus und Umschalten zwischen Avalon-MM-Bussen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500016/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir arbeiten weiter an der Schaffung realer Ger√§te, die auf dem Redd FPGA-Komplex basieren. </font><font style="vertical-align: inherit;">F√ºr ein anderes All-Hardware-Projekt ben√∂tige ich einen einfachen Logikanalysator, also werden wir uns in diese Richtung bewegen. </font><font style="vertical-align: inherit;">Gl√ºck - und zum USB-Bus-Analysator (aber das ist noch auf lange Sicht). </font><font style="vertical-align: inherit;">Das Herz eines jeden Analysators ist RAM und eine Einheit, die zuerst Daten hochl√§dt und dann abruft. </font><font style="vertical-align: inherit;">Heute werden wir es entwerfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu meistern wir den DMA-Block. </font><font style="vertical-align: inherit;">Im Allgemeinen ist DMA mein Lieblingsthema. </font><font style="vertical-align: inherit;">Ich habe sogar einen gro√üartigen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel √ºber DMA auf einigen ARM-Controllern geschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Aus diesem Artikel geht hervor, dass DMA Taktzyklen vom Bus nimmt. </font><font style="vertical-align: inherit;">Im aktuellen Artikel werden wir untersuchen, wie es mit dem FPGA-basierten Prozessorsystem l√§uft.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/77/ve/cg77velzruiaao4svcvahmuumse.png"><br>
<a name="habracut"></a><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorherige Zyklusartikel</font></font></b>
                        <div class="spoiler_text"><ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwicklung der einfachsten ‚ÄûFirmware‚Äú f√ºr in Redd installierte FPGAs und Debugging am Beispiel des Speichertests.</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  ¬´¬ª  ,   Redd.  2.  .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">          .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">     Redd     .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">              Redd.</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> ,       .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    Redd.  1:  .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    Redd.  2:      .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  :        .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    Redd,    FTDI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">     Redd</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       Redd</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> USB-  Windows 10   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   Nios II    Nios II</a></li>
</ol><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware-Erstellung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beginnen mit der Erstellung der Hardware. Um zu verstehen, inwieweit der DMA-Block mit Taktzyklen in Konflikt steht, m√ºssen wir bei hoher Last auf dem Avalon-MM-Bus (Avalon Memory-Mapped) genaue Messungen durchf√ºhren. Wir haben bereits </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herausgefunden,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dass die JTAG-zu-Avalon-MM-Br√ºcke von Altera keine hohen Buslasten liefern kann. Daher m√ºssen wir heute dem System einen Prozessorkern hinzuf√ºgen, damit es mit hoher Geschwindigkeit auf den Bus zugreift. Wie dies gemacht wird, wurde </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beschrieben </font><font style="vertical-align: inherit;">. Deaktivieren Sie aus Gr√ºnden der Optimalit√§t beide Caches f√ºr den Prozessorkern, erstellen Sie jedoch wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einen stark verbundenen Bus </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/a8/xx/4za8xxe_btr14mdgfjmzhpwxusi.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºgen Sie 8 Kilobyte Programmspeicher und Datenspeicher hinzu. Denken Sie daran, dass der Speicher ein Dual-Port sein muss und eine Adresse in einem bestimmten Bereich haben muss (um zu verhindern, dass er springt, sperren Sie ihn, wir haben die Gr√ºnde daf√ºr </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> besprochen </font><font style="vertical-align: inherit;">). </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/kp/km/3v/kpkm3vhuov70qf9zgfl89njhqum.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben das Projekt bereits tausend Mal erstellt, so gibt es nichts besonders interessant in dem Entstehungsprozess selbst (wenn √ºberhaupt, alle Schritte f√ºr die </font><font style="vertical-align: inherit;">Erstellung es beschrieben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Basis ist fertig. Jetzt brauchen wir eine Datenquelle, die wir speichern werden. Das Ideale ist ein st√§ndig tickender Timer. Wenn der DMA-Block w√§hrend einer Ma√ünahme die Daten nicht verarbeiten konnte, sehen wir dies sofort am fehlenden Wert. Nun, das hei√üt, wenn es im Speicher Werte 1234 und 1236 gibt, bedeutet dies, dass der DMA-Block auf der Uhr, als der Zeitgeber 1235 ausgab, keine Daten √ºbertrug. Erstellen Sie eine Datei</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timer_ST.sv</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit einem so einfachen Z√§hler:</font></font><br>
<br>
<pre><code class="plaintext hljs">module Timer_ST (<font></font>
  input              clk,<font></font>
  input              reset,<font></font>
	<font></font>
  input  logic       source_ready,<font></font>
  output logic       source_valid,<font></font>
  output logic[31:0] source_data<font></font>
	<font></font>
);<font></font>
    logic [31:0] counter;<font></font>
    always @ (posedge clk, posedge reset)<font></font>
    if (reset == 1)<font></font>
    begin<font></font>
        counter &lt;= 0;<font></font>
    end else<font></font>
    begin<font></font>
        counter &lt;= counter + 1;<font></font>
    end<font></font>
<font></font>
    assign source_valid = 1;<font></font>
    assign source_data [31:24] = counter [7:0];<font></font>
    assign source_data [23:16] = counter [15:8];<font></font>
    assign source_data [15:8] = counter [23:16];<font></font>
    assign source_data [7:0] = counter [31:24];<font></font>
<font></font>
endmodule<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Z√§hler ist wie ein Pionier: Er ist immer bereit (am Ausgang ist </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source_valid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> immer eins) und z√§hlt immer (mit Ausnahme der Momente des R√ºcksetzzustands). </font><font style="vertical-align: inherit;">Warum das Modul genau diese Signale hat - haben wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in diesem Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> besprochen </font><font style="vertical-align: inherit;">. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt erstellen wir unsere eigene Komponente (wie dies gemacht wird, wird </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beschrieben </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Die Automatisierung hat f√§lschlicherweise den Avalon_MM-Bus f√ºr uns ausgew√§hlt. </font><font style="vertical-align: inherit;">Ersetzen Sie es durch </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avalon_streaming_source</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font><b><font style="vertical-align: inherit;">ordnen Sie</font></b><font style="vertical-align: inherit;"> die Signale wie </font><b><font style="vertical-align: inherit;">folgt zu</font></b><font style="vertical-align: inherit;"> : </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/to/u1/fb/tou1fbktluymact4id-sxeca5qq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gro√üartig. </font><font style="vertical-align: inherit;">F√ºgen Sie unsere Komponente zum System hinzu. </font><font style="vertical-align: inherit;">Jetzt suchen wir nach dem DMA-Block ... Und wir finden nicht einen, sondern drei. </font><font style="vertical-align: inherit;">Alle von ihnen sind im Dokument </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embedded Peripheral IP User Guide</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von Altera beschrieben (wie immer gebe ich Namen, aber keine Links, da sich Links immer √§ndern).</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/0q/a9/lo/0qa9lo90au55qrl5-02u3py-bb8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welches verwenden? Ich kann Nostalgie nicht widerstehen. Bereits 2012 habe ich ein System entwickelt, das auf dem PCIe-Bus basiert. Alle Handb√ºcher von Altera enthielten ein Beispiel, das auf dem ersten dieser Bl√∂cke basierte. Aber er mit der PCIe-Komponente gab eine Geschwindigkeit von nicht mehr als 4 Megabyte pro Sekunde. Damals spuckte ich und schrieb meinen DMA-Block. Jetzt erinnere ich mich nicht mehr an seine Geschwindigkeit, aber er hat die Daten von SATA-Laufwerken an die Grenzen der F√§higkeiten von Laufwerken und SSDs dieser Zeit gebracht. Das hei√üt, ich habe einen Zahn an diesem Block gesch√§rft. Aber ich werde nicht in einen Vergleich der drei Bl√∂cke schl√ºpfen. Tatsache ist, dass wir heute mit einer Quelle arbeiten m√ºssen, die auf Avalon-ST (Avalon Streaming Interface) basiert, und nur der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMA-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Block </font><b><font style="vertical-align: inherit;">Modular Scatter-Gather</font></b><font style="vertical-align: inherit;"> unterst√ºtzt solche Quellen </font><font style="vertical-align: inherit;">. Hier setzen wir es auf das Diagramm. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hlen Sie in den Blockeinstellungen den Modus</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Streaming in den Speicher zugeordnet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Plus - Ich m√∂chte Daten vom Start bis zum Bef√ºllen des SDRAMs √ºbertragen, daher habe ich die maximale Daten√ºbertragungseinheit von 1 Kilobyte auf 4 Megabyte ersetzt. Es stimmt, ich wurde gewarnt, dass der FMax-Parameter am Ende nicht so hei√ü sein wird (selbst wenn Sie den maximalen Block durch 2 Kilobyte ersetzen). Aber f√ºr heute ist FMax akzeptabel (104 MHz), und dann werden wir es herausfinden. Ich habe die restlichen Parameter unver√§ndert gelassen. Sie k√∂nnen den √úbertragungsmodus auch auf Nur Vollwortzugriff einstellen. Dadurch wird FMax auf 109 MHz erh√∂ht. Aber wir werden heute nicht um Leistung k√§mpfen.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/u6/1y/8-/u61y8-h-wpei03u3xgkjsjtuurs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit. Die Quelle ist, DMA ist. Empf√§nger ... SDRAM? In zuk√ºnftigen Kampfbedingungen ja. Aber heute brauchen wir eine Erinnerung mit bekannten Eigenschaften. Leider muss SDRAM regelm√§√üig Befehle senden, die mehrere Taktzyklen dauern, und dieser Speicher kann durch Regeneration belegt werden. Daher verwenden wir stattdessen den integrierten FPGA-Speicher. Alles funktioniert f√ºr sie in einem Schritt, ohne unvorhersehbare Verz√∂gerungen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der SDRAM-Controller Single-Port ist, kann der eingebaute Speicher auch ausschlie√ülich im Single-Port-Modus verwendet werden. Es ist wichtig. Tatsache ist, dass wir mit dem DMA-Blockmaster in den Speicher schreiben m√∂chten, andererseits aber mit dem Prozessorkern oder dem Altera JTAG-zu-Avalon-MM-Block aus diesem Speicher lesen m√∂chten. Die Hand streckt die Hand aus und verbindet die Schreib- und Lesebl√∂cke mit zwei verschiedenen Ports ... Aber das k√∂nnen Sie nicht! Vielmehr ist es durch die Bedingungen des Problems verboten. Denn heute ist es m√∂glich, aber morgen werden wir den Speicher durch einen ausschlie√ülich Single-Port-Speicher ersetzen. Im Allgemeinen erhalten wir einen solchen Block aus drei Komponenten (Timer, DMA und Speicher):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vb/ws/rv/vbwsrvdbjsns34syktoliarkudy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, und nur f√ºr Pro-Forma werde ich UT und Sysid zum JTAG-System hinzuf√ºgen (obwohl das zweite nicht geholfen hat, musste ich trotzdem mit einem JTAG-Adapter zaubern). </font><font style="vertical-align: inherit;">Was es ist und wie ihre Zugabe kleine Probleme l√∂st, haben wir bereits untersucht. </font><font style="vertical-align: inherit;">Ich werde die Reifen nicht t√∂nen, mit ihnen ist alles klar. </font><font style="vertical-align: inherit;">Zeigen Sie einfach, wie alles in meinem Projekt aussieht: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t5/xk/qv/t5xkqv474idlwer3fnklkz5whbs.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das war's. </font><font style="vertical-align: inherit;">Das System ist bereit. </font><font style="vertical-align: inherit;">Wir weisen Adressen zu, weisen Prozessorvektoren zu, generieren ein System (vergessen Sie nicht, dass Sie unter demselben Namen wie das Projekt selbst speichern m√ºssen, dann wird es auf die oberste Ebene der Hierarchie verschoben) und f√ºgen es dem Projekt hinzu. </font><font style="vertical-align: inherit;">Machen Sie das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reset-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bein </font><font style="vertical-align: inherit;">virtuell, verbinden Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit </font><b><font style="vertical-align: inherit;">Pin_25-</font></b><font style="vertical-align: inherit;"> Bein</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir bauen das Projekt zusammen und sch√ºtten es in die Ausr√ºstung ... Wie ist es, armes Ding, im leeren B√ºro wegen der total abgelegenen Lage? ... Es ist einsam und be√§ngstigend f√ºr sie, wahrscheinlich allein ... Aber ich war abgelenkt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen eines Software-Teils</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausbildung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im BSP-Editor schalte ich mit der √ºblichen Handbewegung die C ++ - Unterst√ºtzung ein. </font><font style="vertical-align: inherit;">Ich habe so oft einen Screenshot dieses Falls eingef√ºgt, dass ich damit aufh√∂re. </font><font style="vertical-align: inherit;">Aber ein anderer Screenshot, obwohl er bereits gesehen wurde, ist immer noch so verbreitet. </font><font style="vertical-align: inherit;">Besprechen wir es also noch einmal. </font><font style="vertical-align: inherit;">Wir erinnern uns, dass das System versucht, Daten in den gr√∂√üten Speicherbereich zu stellen. </font><font style="vertical-align: inherit;">Und so ist </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buffer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Deshalb zwingen wir alles zu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/ge/g_/ckgeg_tcmcuz0oa8retrmdrfiiw.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmexperiment</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir machen einen Code, der einfach den Speicher mit dem Inhalt der Quelle f√ºllt (in der Rolle des Z√§hlers).</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code anzeigen</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">#include "sys/alt_stdio.h"<font></font>
#include &lt;altera_msgdma.h&gt;<font></font>
#include &lt;altera_msgdma_descriptor_regs.h&gt;<font></font>
#include &lt;system.h&gt;<font></font>
#include &lt;string.h&gt;<font></font>
<font></font>
int main()<font></font>
{ <font></font>
  alt_putstr("Hello from Nios II!\n");<font></font>
<font></font>
  memset (BUFFER_BASE,0,BUFFER_SIZE_VALUE);<font></font>
<font></font>
  //  ,   <font></font>
  IOWR_ALTERA_MSGDMA_CSR_CONTROL(MSGDMA_0_CSR_BASE,<font></font>
      ALTERA_MSGDMA_CSR_STOP_DESCRIPTORS_MASK);<font></font>
<font></font>
  //   ,      ,<font></font>
  //    ,   .  .<font></font>
<font></font>
  //    FIFO<font></font>
  IOWR_ALTERA_MSGDMA_DESCRIPTOR_READ_ADDRESS(MSGDMA_0_DESCRIPTOR_SLAVE_BASE,<font></font>
      (alt_u32)0);<font></font>
  IOWR_ALTERA_MSGDMA_DESCRIPTOR_WRITE_ADDRESS(MSGDMA_0_DESCRIPTOR_SLAVE_BASE,<font></font>
      (alt_u32)BUFFER_BASE);<font></font>
  IOWR_ALTERA_MSGDMA_DESCRIPTOR_LENGTH(MSGDMA_0_DESCRIPTOR_SLAVE_BASE,<font></font>
      BUFFER_SIZE_VALUE);<font></font>
  IOWR_ALTERA_MSGDMA_DESCRIPTOR_CONTROL_STANDARD(MSGDMA_0_DESCRIPTOR_SLAVE_BASE,<font></font>
      ALTERA_MSGDMA_DESCRIPTOR_CONTROL_GO_MASK);<font></font>
<font></font>
   //  ,    <font></font>
   IOWR_ALTERA_MSGDMA_CSR_CONTROL(MSGDMA_0_CSR_BASE,<font></font>
       ALTERA_MSGDMA_CSR_STOP_ON_ERROR_MASK<font></font>
       &amp; (~ALTERA_MSGDMA_CSR_STOP_DESCRIPTORS_MASK)<font></font>
       &amp;(~ALTERA_MSGDMA_CSR_GLOBAL_INTERRUPT_MASK)) ;<font></font>
<font></font>
<font></font>
   //   <font></font>
   static const alt_u32 errMask = ALTERA_MSGDMA_CSR_STOPPED_ON_ERROR_MASK |<font></font>
           ALTERA_MSGDMA_CSR_STOPPED_ON_EARLY_TERMINATION_MASK |<font></font>
           ALTERA_MSGDMA_CSR_STOP_STATE_MASK |<font></font>
           ALTERA_MSGDMA_CSR_RESET_STATE_MASK;<font></font>
<font></font>
  volatile alt_u32 status;<font></font>
  do<font></font>
  {<font></font>
     status = IORD_ALTERA_MSGDMA_CSR_STATUS(MSGDMA_0_CSR_BASE);<font></font>
  } while (!(status &amp; errMask) &amp;&amp;(status &amp; ALTERA_MSGDMA_CSR_BUSY_MASK));     <font></font>
<font></font>
  alt_putstr("You can play with memory!\n");<font></font>
<font></font>
  /* Event loop never exits. */<font></font>
  while (1);<font></font>
<font></font>
  return 0;<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir fangen an und warten auf die Nachricht </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Du kannst mit dem Ged√§chtnis spielen!"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , setzen Sie das Programm auf Pause und schauen Sie sich den Speicher ab Adresse 0 an. Zuerst hatte ich gro√üe Angst: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rw/yd/kb/rwydkbfypprtgoj5wspybiq3sv8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ab Adresse 0x80 √§ndert der Z√§hler seinen Wert stark. Dar√ºber hinaus eine sehr gro√üe Menge. Aber es stellte sich heraus, dass alles in Ordnung ist. Bei uns h√§lt der Z√§hler nie an und ist immer bereit, und DMA hat eine eigene Vorauslesewarteschlange. Ich m√∂chte Sie an die Einstellungen des DMA-Blocks erinnern:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ty/hk/-6/tyhk-610qcr5r-jpmrr2dnxz4wg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0x80 Bytes sind 0x20 32-Bit-W√∂rter. </font><font style="vertical-align: inherit;">Nur 32 Dezimalstellen. </font><font style="vertical-align: inherit;">Es passt alles zusammen. </font><font style="vertical-align: inherit;">Unter Debugging-Bedingungen ist dies nicht be√§ngstigend. </font><font style="vertical-align: inherit;">Unter Kampfbedingungen funktioniert die Quelle korrekter (ihre Bereitschaft wird zur√ºckgesetzt). </font><font style="vertical-align: inherit;">Daher ignorieren wir diesen Abschnitt einfach. </font><font style="vertical-align: inherit;">In anderen Bereichen z√§hlt das Messger√§t nacheinander. </font><font style="vertical-align: inherit;">Ich werde nur das Dump-Fragment in der Breite zeigen. </font><font style="vertical-align: inherit;">Nehmen Sie ein Wort, dass ich es in seiner Gesamtheit untersucht habe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pw/hg/eq/pwhgeqyxbian3_fg-m46yliilrk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich traute meinen Augen nicht und schrieb einen Code, der die Daten automatisch √ºberpr√ºft:</font></font><br>
<br>
<pre><code class="plaintext hljs">  volatile alt_u32* pData = (alt_u32*)BUFFER_BASE;<font></font>
  volatile alt_u32 cur = pData[0x10];<font></font>
  int nLine = 0;<font></font>
  for (volatile int i=0x11;i&lt;BUFFER_SIZE_VALUE/4;i++)<font></font>
  {<font></font>
	  if (pData[i]!=cur+1)<font></font>
	  {<font></font>
		  alt_printf("Problem at 0x%x\n",i*4);<font></font>
		  if (nLine++ &gt; 10)<font></font>
		  {<font></font>
			  break;<font></font>
		  }<font></font>
	  }<font></font>
	  cur = pData[i];<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Er offenbart auch keine Probleme.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich versuche zumindest einige Probleme zu finden</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Tat ist das Fehlen von Problemen nicht immer gut. </font><font style="vertical-align: inherit;">Als Teil des Artikels musste ich die Probleme finden und dann zeigen, wie sie behoben werden. </font><font style="vertical-align: inherit;">Immerhin liegen die Probleme auf der Hand. </font><font style="vertical-align: inherit;">Ein ausgelasteter Bus kann keine Daten ohne Verz√∂gerungen weitergeben! </font><font style="vertical-align: inherit;">Es sollte Verz√∂gerungen geben! </font><font style="vertical-align: inherit;">Aber lassen Sie uns √ºberpr√ºfen, warum alles so sch√∂n passiert. </font><font style="vertical-align: inherit;">Zun√§chst kann sich herausstellen, dass sich das Ganze im FIFO des DMA-Blocks befindet. </font><font style="vertical-align: inherit;">Reduzieren Sie ihre Gr√∂√üe auf ein Minimum: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z3/vm/9i/z3vm9igmqgqcgynhiyzu-9dr7ss.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles funktioniert weiter! </font><font style="vertical-align: inherit;">Gut. </font><font style="vertical-align: inherit;">Stellen Sie sicher, dass die Anzahl der Zugriffe auf den Bus gr√∂√üer ist als die FIFO-Dimension. </font><font style="vertical-align: inherit;">F√ºgen Sie einen Trefferz√§hler hinzu:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/f4/iq/faf4iqvpkc4ezbvhdz4uhpnrbjo.png"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleicher Text:</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">  volatile alt_u32 status;<font></font>
  volatile int n = 0;<font></font>
  do<font></font>
  {<font></font>
	  status = IORD_ALTERA_MSGDMA_CSR_STATUS(MSGDMA_0_CSR_BASE);<font></font>
	  n += 1;<font></font>
  } while (!(status &amp; errMask) &amp;&amp;(status &amp; ALTERA_MSGDMA_CSR_BUSY_MASK));  <font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende der Arbeit ist es 29. Dies ist mehr als 16. Das hei√üt, das FIFO sollte √ºberlaufen. </font><font style="vertical-align: inherit;">F√ºr alle F√§lle f√ºgen wir weitere Statusregisterwerte hinzu. </font><font style="vertical-align: inherit;">Hilft nicht. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Trauer habe ich mich vom entfernten Redd-Komplex getrennt und das Projekt auf mein vorhandenes Steckbrett √ºbertragen, mit dem ich mich jetzt mit einem Oszilloskop verbinden kann (im B√ºro ist niemand in der Ferne, ich kann das Oszilloskop nicht erreichen). </font><font style="vertical-align: inherit;">Dem Timer wurden zwei Ports hinzugef√ºgt:</font></font><br>
<br>
<pre><code class="plaintext hljs">   output    clk_copy,<font></font>
   output    ready_copy<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ernannte sie:</font></font><br>
<br>
<pre><code class="plaintext hljs">    assign clk_copy = clk;<font></font>
    assign ready_copy = source_ready;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen sah das Modul folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">module Timer_ST (<font></font>
   input           clk,<font></font>
   input           reset,<font></font>
	<font></font>
   input logic     source_ready,<font></font>
   output logic    source_valid,<font></font>
   output logic[31:0] source_data,<font></font>
<font></font>
   output    clk_copy,<font></font>
   output    ready_copy<font></font>
	<font></font>
);<font></font>
    logic [31:0] counter;<font></font>
    always @ (posedge clk, posedge reset)<font></font>
    if (reset == 1)<font></font>
    begin<font></font>
        counter &lt;= 0;<font></font>
    end else<font></font>
    begin<font></font>
        counter &lt;= counter + 1;<font></font>
    end<font></font>
<font></font>
    assign source_valid = 1;<font></font>
    assign source_data [31:24] = counter [7:0];<font></font>
    assign source_data [23:16] = counter [15:8];<font></font>
    assign source_data [15:8] = counter [23:16];<font></font>
    assign source_data [7:0] = counter [31:24];<font></font>
<font></font>
    assign clk_copy = clk;<font></font>
    assign ready_copy = source_ready;<font></font>
<font></font>
endmodule<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuhause habe ich ein kleineres Modell mit einem Kristall, also musste ich den Appetit auf Erinnerung reduzieren. Und es stellte sich heraus, dass mein primitives Programm nicht in einen 4-Kilobyte-Abschnitt passen w√ºrde. Das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im letzten Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angesprochene Thema </font><font style="vertical-align: inherit;">ist also, oh, wie relevant. Speicher im System - kaum genug! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn das Programm startet, erhalten wir eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fertig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Welle von </font><font style="vertical-align: inherit;">entweder 16 oder 17 Ma√ünahmen. Dies ist mit dem FIFO des DMA-Blocks gef√ºllt. Der gleiche Effekt, der mich am Anfang erschreckt hat. Es sind diese Daten, die die sehr falsche Pufferf√ºllung bilden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i6/wy/-a/i6wy-a4xsnbwej_o9indj_plneg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes haben wir ein sch√∂nes Bild bei 40960 Nanosekunden, dh 2048 Zyklen (mit einem Heimkristall musste der Puffer auf 8 Kilobyte reduziert werden, dh 2048 32-Bit-W√∂rter). Hier ist der Anfang: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9h/c5/1d/9hc51dpo8ur2_1whymyreqkvzre.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist das Ende:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5l/3y/le/5l3ylew4zpty3b9xf6bn_zjunlc.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, und √ºberall - kein einziger Fehler. </font><font style="vertical-align: inherit;">Nein, es war klar, dass dies passieren w√ºrde, aber es gab einige Hoffnung ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht sollten wir versuchen, im Bus zu schreiben und nicht nur daraus zu lesen? </font><font style="vertical-align: inherit;">Ich habe dem System einen GPIO-Block hinzugef√ºgt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/lg/o8/rjlgo8iyaj30cxjr8jhkc1njap4.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einen Eintrag hinzugef√ºgt, w√§hrend auf die Bereitschaft gewartet wurde:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/ci/vp/j4civpmja0ccaz_9qinqqc247wu.png"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleicher Text</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">  volatile alt_u32 status;<font></font>
  volatile int n = 0;<font></font>
  do<font></font>
  {<font></font>
	status = IORD_ALTERA_MSGDMA_CSR_STATUS(MSGDMA_0_CSR_BASE);<font></font>
       IOWR_ALTERA_AVALON_PIO_DATA (PIO_0_BASE,0x01);<font></font>
       IOWR_ALTERA_AVALON_PIO_DATA (PIO_0_BASE,0x00);<font></font>
<font></font>
       n += 1;<font></font>
  } while (!(status &amp; errMask) &amp;&amp;(status &amp; ALTERA_MSGDMA_CSR_BUSY_MASK));  <font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt keine Probleme und das wars! </font><font style="vertical-align: inherit;">Wer ist schuld?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt keine Wunder, aber es gibt unerforschte Dinge</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wer ist schuld? Mit Trauer begann ich, alle Men√ºs des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Platform Designer-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tools zu studieren, </font><font style="vertical-align: inherit;">und fand anscheinend einen Hinweis. Wie sieht ein Reifen normalerweise aus? Der Kabelsatz, an den Clients angeschlossen sind. Damit? Es scheint so. Wir sehen dies aus den Zahlen im Herausgeber. Das zweite Ziel des Artikels war es zu zeigen, wie der Bus in zwei unabh√§ngige Segmente unterteilt werden kann, von denen jedes funktioniert, ohne das andere zu st√∂ren. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns jedoch die Meldungen an, die beim Generieren des Systems angezeigt werden. Markieren Sie Stichw√∂rter:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/di/ri/c1/diric1mrzwztjmu2bcw3nrxg5du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und es gibt viele √§hnliche Nachrichten: Es wird hinzugef√ºgt, es wird hinzugef√ºgt. Es stellt sich heraus, dass nach dem Bearbeiten mit Stiften dem System viele zus√§tzliche Dinge hinzugef√ºgt werden. Wie w√ºrden Sie ein Schema betrachten, in dem all dies bereits verf√ºgbar ist? Ich schwimme immer noch darin, aber wir k√∂nnen die wahrscheinlichste Antwort im Rahmen des Artikels erhalten, indem wir diesen Men√ºpunkt w√§hlen: Das </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/7s/k_/vv7sk_blrrjycf7wfixijjcdzus.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ge√∂ffnete Bild ist an sich beeindruckend, aber ich werde es nicht geben. Und sofort </font></font><br>
<br>
<img src="https://habrastorage.org/webt/y-/ub/dv/y-ubdvljrhcecquyc0rg5u5t16e.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
werde ich </font><font style="vertical-align: inherit;">diese Registerkarte ausw√§hlen: </font><font style="vertical-align: inherit;">Und dort sehen wir Folgendes: Ich werde </font></font><br>
<br>
<img src="https://habrastorage.org/webt/18/zk/_9/18zk_94hudf6j0r9lfliuu9wjy8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
das Wichtigste gr√∂√üer anzeigen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/1u/if/gy1uifa4ln0x8_axbm4t9_juypq.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reifen werden nicht kombiniert! </font><font style="vertical-align: inherit;">Sie sind segmentiert! </font><font style="vertical-align: inherit;">Ich kann es nicht rechtfertigen (vielleicht werden mich Experten in den Kommentaren korrigieren), aber es scheint, dass das System die Schalter f√ºr uns eingesetzt hat! </font><font style="vertical-align: inherit;">Es sind diese Schalter, die die isolierten Bussegmente bilden, und das Hauptsystem kann parallel zur DMA-Einheit arbeiten, die zu diesem Zeitpunkt ohne Konflikte auf den Speicher zugreifen kann!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir provozieren echte Probleme</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir all dieses Wissen erhalten haben, kommen wir zu dem Schluss, dass wir sehr gut Probleme provozieren k√∂nnen. </font><font style="vertical-align: inherit;">Dies ist erforderlich, um sicherzustellen, dass das Testsystem sie erstellen kann, was bedeutet, dass die Entwicklungsumgebung sie wirklich unabh√§ngig aufl√∂st. </font><font style="vertical-align: inherit;">Wir werden uns nicht auf abstrakte Ger√§te auf dem Bus beziehen, sondern auf denselben </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pufferspeicher,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> so dass der </font><b><font style="vertical-align: inherit;">cmd_mux_005-</font></b><font style="vertical-align: inherit;"> Block </font><font style="vertical-align: inherit;">den Bus zwischen dem Prozessorkern und dem DMA-Block verteilt. </font><font style="vertical-align: inherit;">Wir schreiben die Funktion des langm√ºtigen Wartens wie folgt um:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zm/ww/4n/zmww4n1xt_p-eo_2hqrfufgtmis.png"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleicher Text</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">  volatile alt_u32 status;<font></font>
  volatile int n = 0;<font></font>
  volatile alt_u32* pBuf = (alt_u32*)BUFFER_BASE;<font></font>
  volatile alt_u32 sum = 0;<font></font>
  do<font></font>
  {<font></font>
	  status = IORD_ALTERA_MSGDMA_CSR_STATUS(MSGDMA_0_CSR_BASE);<font></font>
	  sum += pBuf[n];<font></font>
<font></font>
	  n += 1;<font></font>
  } while (!(status &amp; errMask) &amp;&amp;(status &amp; ALTERA_MSGDMA_CSR_BUSY_MASK));<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und schlie√ülich erschienen Einbr√ºche auf der Wellenform! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/po/rc/vvporcmhdl2i9julycbcib6vnfe.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Speicherpr√ºfungsfunktion hat auch viele Auslassungen festgestellt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xf/pf/8y/xfpf8ytbjo3wqlxsgqprx6eqnj0.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, und wir sehen sehr gut, dass die Daten von Zeile zu Zeile verschoben werden: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eu/eh/uu/euehuuf9rp-ilidebmcy_zsdcuq.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier ist ein Beispiel f√ºr einen bestimmten fehlerhaften Punkt (6CCE488F fehlt): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v_/5e/rj/v_5erjk_wbxw9ujfrhptcxpeudy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt sehen wir, dass das Experiment korrekt durchgef√ºhrt wurde, nur die Entwicklungsumgebung wurde ausgef√ºhrt Optimierung f√ºr uns. </font><font style="vertical-align: inherit;">Dies ist der Fall, wenn ich den Satz ‚ÄûAlles schadet allen Stahl‚Äú nicht mit Spott, sondern mit Dankbarkeit ausspreche. </font><font style="vertical-align: inherit;">Vielen Dank an die Quartus-Entwickler f√ºr diese Angelegenheit!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben gelernt, wie man einen DMA-Block in das System einf√ºgt, um Streaming-Daten in den Speicher zu √ºbertragen. </font><font style="vertical-align: inherit;">Wir haben auch sichergestellt, dass der Download anderer Ger√§te auf dem Bus den Download-Prozess nicht beeintr√§chtigt. </font><font style="vertical-align: inherit;">Die Entwicklungsumgebung erstellt automatisch ein isoliertes Segment, das parallel zu anderen Abschnitten des Busses ausgef√ºhrt wird. </font><font style="vertical-align: inherit;">Wenn sich jemand demselben Segment zuwendet, sind Konflikte und Zeitaufwand f√ºr deren L√∂sung nat√ºrlich unvermeidlich, aber der Programmierer kann solche Dinge durchaus vorhersehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im n√§chsten Artikel werden wir RAM durch einen SDRAM-Controller und den Timer durch einen echten "Kopf" ersetzen und den ersten logischen Analysator herstellen. </font><font style="vertical-align: inherit;">Wird es funktionieren? Ich wei√ü es noch nicht. </font><font style="vertical-align: inherit;">Ich hoffe die Probleme treten nicht auf.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de500002/index.html">IT-Spezialisten gegen Verk√§ufer: und die Welt hat sich halbiert</a></li>
<li><a href="../de500008/index.html">Treffen Sie Upscaler</a></li>
<li><a href="../de500010/index.html">Geschichte des schmutzigen Wasserstoffs</a></li>
<li><a href="../de500012/index.html">Entity Framework Core</a></li>
<li><a href="../de500014/index.html">Vollst√§ndig ansprechendes Design ist mehr als nur Medienabfragen</a></li>
<li><a href="../de500018/index.html">Nachahmung der Freihandzeichnung am Beispiel von RoughJS</a></li>
<li><a href="../de500020/index.html">Google Earth Engine - Einzigartige Plattform f√ºr die Analyse gro√üer Geodaten</a></li>
<li><a href="../de500022/index.html">Warum am Gemeinschaftsleben teilnehmen und wie hilft es dem beruflichen Wachstum?</a></li>
<li><a href="../de500026/index.html">Unsinn in dieser Branche * einfach unglaublich</a></li>
<li><a href="../de500028/index.html">Datenverwaltungsplattformen: Peripherieger√§te zur Cloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>