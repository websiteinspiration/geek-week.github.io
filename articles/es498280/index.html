<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí¨ üë®üèΩ‚Äçüè´ üÜí La historia del p√°jaro Dodo del g√©nero Phoenix. La gran ca√≠da de Dodo es üññüèΩ üóæ üßõüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cada a√±o, el 21 de abril, recordamos la historia de la Gran Ca√≠da de Dodo IS en 2018. El pasado es un maestro cruel pero justo. Vale la pena recordarl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>La historia del p√°jaro Dodo del g√©nero Phoenix. La gran ca√≠da de Dodo es</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/498280/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada a√±o, el 21 de abril, recordamos la historia de la Gran Ca√≠da de Dodo IS en 2018. </font><font style="vertical-align: inherit;">El pasado es un maestro cruel pero justo. </font><font style="vertical-align: inherit;">Vale la pena recordarlo, repetir las lecciones, transmitir el conocimiento acumulado a las nuevas generaciones y tratar con gratitud en lo que nos hemos convertido. </font><font style="vertical-align: inherit;">Debajo del corte, queremos contarte una historia sobre c√≥mo fue y compartir conclusiones. </font><font style="vertical-align: inherit;">Ni siquiera puedes desear esta situaci√≥n al enemigo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sy/r0/jj/syr0jjrgnwuubuusucjvag6ot-o.png"><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gran historia de oto√±o</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√≠a 1. El accidente que nos cost√≥ millones de rublos.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El s√°bado 21 de abril de 2018, el sistema Dodo IS cay√≥. Cay√≥ muy mal. Durante varias horas, nuestros clientes no pudieron realizar un pedido ni a trav√©s del sitio ni a trav√©s de la aplicaci√≥n m√≥vil. La l√≠nea de llamadas al centro de llamadas ha crecido hasta tal estado que la voz autom√°tica del contestador autom√°tico dice: "Volveremos a llamar en 4 horas". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/ha/ac/ekhaac2m8owflsjdblpfmnksux8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ese d√≠a experimentamos una de las ca√≠das m√°s graves de Dodo IS. Lo peor fue que el d√≠a anterior lanzamos la primera campa√±a publicitaria de televisi√≥n federal con un presupuesto de 100 millones de rublos. Fue un gran evento para Dodo Pizza. El equipo de TI tambi√©n estaba bien preparado para la campa√±a. Automatizamos y simplificamos la implementaci√≥n; ahora, con la ayuda de un solo bot√≥n en TeamCity, podr√≠amos implementar un monolito en 12 pa√≠ses. No hicimos todo lo posible y, por lo tanto, la jodimos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La campa√±a publicitaria fue incre√≠ble. Recibimos entre 100 y 150 pedidos por minuto. Esa fue una buena noticia. La mala noticia: Dodo IS no pudo soportar tal carga y muri√≥. Alcanzamos el l√≠mite de escala vertical y ya no pudimos procesar pedidos. El sistema estuvo inestable durante aproximadamente tres horas, recuper√°ndose peri√≥dicamente, pero inmediatamente volvi√≥ a caer. Cada minuto de tiempo de inactividad nos cost√≥ decenas de miles de rublos, sin contar la p√©rdida de respeto de los clientes enojados. El equipo de desarrollo decepcion√≥ a todos: clientes, socios, chicos de pizzer√≠as y un centro de llamadas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/te/kw/nutekwrugivxr0ns__zlnzxo74a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No tuvimos m√°s remedio que arremangarnos y sentarnos para corregir la situaci√≥n. Desde el domingo (22 de abril), trabajamos en modo dif√≠cil, no ten√≠amos derecho a cometer un error.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente es nuestro resumen de experiencia sobre c√≥mo encontrarnos en tal situaci√≥n y c√≥mo salir de ella m√°s tarde. </font><font style="vertical-align: inherit;">Amigos, no cometan nuestros errores.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dos fallas que lanzaron el efecto domin√≥</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena comenzar con c√≥mo comenz√≥ todo y d√≥nde nos equivocamos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/qh/yy/_hqhyy80kusheiqap3xwfchwjvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El s√°bado 21/04/2018, aproximadamente a las 5:00 p.m., notamos que el n√∫mero de bloqueos en la base de datos comenz√≥ a crecer, lo que es un presagio de problemas. </font><font style="vertical-align: inherit;">Ten√≠amos un runbook listo para resolver, ya que entend√≠amos de d√≥nde ven√≠an estos bloqueos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo sali√≥ mal despu√©s de que el runbook fallara dos veces. </font><font style="vertical-align: inherit;">Durante un par de minutos, la base volvi√≥ a la normalidad, y luego nuevamente comenz√≥ a ahogarse con las cerraduras. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por desgracia, la base de datos maestra rollback_on_timeout ten√≠a 600 segundos, raz√≥n por la cual se acumulaban todos los bloqueos. </font><font style="vertical-align: inherit;">Este es el primer archivo importante en esta historia. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una configuraci√≥n simple podr√≠a salvarlo todo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego hubo intentos de revivir el sistema de muchas maneras, ninguna de las cuales tuvo √©xito. </font><font style="vertical-align: inherit;">Hasta que nos dimos cuenta de que hay una diferencia en el esquema de recepci√≥n de pedidos en la aplicaci√≥n m√≥vil y en el nuevo sitio. </font><font style="vertical-align: inherit;">Cort√°ndolos a su vez, pudimos entender d√≥nde est√°n los agujeros en el antiguo esquema de toma de pedidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sistema de aceptaci√≥n de pedidos fue escrito hace mucho tiempo. </font><font style="vertical-align: inherit;">En ese momento, ya se estaba procesando y se implement√≥ en el nuevo sitio dodopizza.ru. </font><font style="vertical-align: inherit;">No se us√≥ en la aplicaci√≥n m√≥vil. </font><font style="vertical-align: inherit;">Inicialmente, las razones para crear un nuevo esquema de pedidos estaban relacionadas con reglas puramente comerciales; los problemas de rendimiento ni siquiera estaban en la agenda. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este es el segundo archivo importante: no conoc√≠amos los l√≠mites de nuestro sistema.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√≠a 2. Eliminaci√≥n de accidentes </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La respuesta del equipo fue muy reveladora. Nuestra estaci√≥n de servicio escribi√≥ una publicaci√≥n sobre Slack, y todos vinieron al d√≠a siguiente: el 22 de abril, el trabajo comenz√≥ a las 8:30 de la ma√±ana. Nadie necesitaba ser persuadido o pedirle que viniera en su d√≠a libre. Todos entendieron todo: lo que necesita ser apoyado, ayudado, con sus manos, con su cabeza, en pruebas, optimizaci√≥n de consultas, infraestructura. ¬°Algunos incluso vinieron con toda la familia! Los muchachos de los equipos vecinos, no relacionados con TI, llegaron a la oficina con comida, y el centro de llamadas trajo fuerzas adicionales por si acaso. Todos los equipos unidos en un solo objetivo: ¬°levantarse! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4u/sv/nt/4usvntb_mitqlbh7sya9rltxoqq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una nueva recepci√≥n de la orden fue el objetivo principal el domingo 22 de abril. Entendimos que el pico de pedidos ser√≠a comparable al del s√°bado. Tuvimos el plazo m√°s severo: a las 17 en punto caer√° una nueva oleada de pedidos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este d√≠a, actuamos de acuerdo con el plan "para asegurarnos de que no se caiga", que elaboramos en la v√≠spera del d√≠a 21 a √∫ltima hora de la tarde, cuando ya hab√≠amos elevado el sistema y entendido lo que hab√≠a sucedido. </font><font style="vertical-align: inherit;">El plan se dividi√≥ condicionalmente en 2 partes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementaci√≥n del esquema con un nuevo orden en la aplicaci√≥n m√≥vil.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimizaci√≥n del proceso de creaci√≥n de pedidos.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al implementar estas cosas, podemos estar seguros de que Dodo IS no caer√°. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Determinamos el frente del trabajo y el trabajo.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n del esquema con un nuevo orden en una aplicaci√≥n m√≥vil fue la m√°xima prioridad. No ten√≠amos n√∫meros exactos para todo el esquema, pero en algunas partes, el n√∫mero y la calidad de las consultas a la base de datos, entendimos de manera experta que aumentar√≠a la productividad. Un equipo de 15 personas trabaj√≥ en la tarea d√≠a tras d√≠a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque, de hecho, la introducci√≥n de un nuevo esquema de pedidos, comenzamos antes de la ca√≠da del 04.21., Pero no terminamos el trato. Todav√≠a hab√≠a errores activos y la tarea colgaba en un estado semiactivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equipo dividi√≥ la regresi√≥n en partes: la regresi√≥n desde dos plataformas m√≥viles, m√°s la gesti√≥n de pizzer√≠as. Pasamos mucho tiempo manualmente para preparar pizzer√≠as de prueba, pero una separaci√≥n clara ayud√≥ a paralelizar la regresi√≥n manual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tan pronto como se introdujo alg√∫n cambio, se implement√≥ inmediatamente en el entorno de preproducci√≥n y se prob√≥ al instante. El equipo siempre estaba en contacto entre ellos, simplemente se sentaban en una sala grande con lugares de reuni√≥n. Los muchachos de Nizhny Novgorod y Syktyvkar tambi√©n estaban siempre en contacto. Si hab√≠a un enchufe, decidi√≥ de inmediato. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo general, presentamos nuevas funcionalidades gradualmente: 1 pizzer√≠a, 5 pizzer√≠as, 10 pizzer√≠as, 20 pizzer√≠as, etc., a toda la red gradualmente. Esa vez necesit√°bamos actuar con m√°s decisi√≥n. No tuvimos tiempo: a las 5 p.m., comenz√≥ un nuevo pico. Simplemente no pod√≠amos dejar de atraparlo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aproximadamente a las 15:00 la actualizaci√≥n se implement√≥ en la mitad de la red (esto es aproximadamente 200 pizzer√≠as). A las 15:30 nos aseguramos de que todo funcionaba bien y activamos toda la red. Alternar caracter√≠sticas, implementaciones r√°pidas, regresi√≥n dividida en partes y API fija ayudaron a hacer todo esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resto del equipo se ocup√≥ de diferentes opciones de optimizaci√≥n al crear un pedido. El nuevo esquema no era completamente nuevo, todav√≠a usaba la parte heredada. Guardar direcciones, aplicar c√≥digos promocionales, generar n√∫meros de pedido: estas partes fueron y siguieron siendo comunes. Su optimizaci√≥n se redujo a reescribir las consultas SQL, a deshacerse de ellas en el c√≥digo o a optimizar sus llamadas. Algo sali√≥ en modo as√≠ncrono, algo que result√≥ ser llamado varias veces en lugar de uno.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equipo de infraestructura se comprometi√≥ a asignar parte de los componentes a instancias separadas simplemente para no cruzar la carga. </font><font style="vertical-align: inherit;">Nuestro principal componente problem√°tico fue la fachada de Legacy, que fue a la base de Legacy. </font><font style="vertical-align: inherit;">Todo el trabajo se dedic√≥ a √©l, incluida la divisi√≥n de instancias.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organiza el proceso</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por la ma√±ana, tuvimos la √∫nica sincronizaci√≥n del d√≠a, nos dividimos en equipos y nos fuimos a trabajar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio, mantuvimos todo el registro de cambios y tareas directamente en Slack, porque al principio no hab√≠a tantas tareas. Pero su n√∫mero estaba creciendo, as√≠ que nos mudamos r√°pidamente a Trello. La integraci√≥n configurada entre Slack y Trello notific√≥ cualquier cambio de estado en el rompecabezas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, era importante para nosotros ver todo el registro de cambios de producci√≥n. La versi√≥n electr√≥nica estaba en Trello, la versi√≥n de respaldo estaba en la placa de infraestructura en forma de tarjetas. En caso de que algo saliera mal, necesit√°bamos averiguar r√°pidamente qu√© cambios revertir. La regresi√≥n completa fue solo para el esquema con un nuevo orden, el resto de los cambios se probaron de manera m√°s leal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las tareas volaron a producci√≥n a una velocidad de bala. En total, actualizamos el sistema 15 veces ese d√≠a. Los chicos fueron desplegados en bancos de pruebas, uno por equipo. Desarrollo, verificaci√≥n r√°pida, implementaci√≥n en producci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s del proceso principal de CTO, Sasha Andronov constantemente se encontr√≥ con equipos con la pregunta "¬øC√≥mo ayudar?". Esto ayud√≥ a redistribuir los esfuerzos y no perder tiempo en el hecho de que alguien no pens√≥ en pedir ayuda. Gesti√≥n de desarrollo semi-manual, un m√≠nimo de distracciones y trabajo al l√≠mite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de ese d√≠a, fue necesario salir con la sensaci√≥n de que hicimos todo lo posible. Y aun m√°s. Y lo hicimos! A las 15:30 se lanz√≥ un nuevo esquema para recibir un pedido para una aplicaci√≥n m√≥vil en toda la red. Modo Hackathon, ¬°menos de 20 implementaciones por producci√≥n por d√≠a!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarde del 22 de abril fue tranquila y clara. </font><font style="vertical-align: inherit;">Ni ca√≠das ni una sola pista es que el sistema puede ser malo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alrededor de las 10 p.m., nos reunimos nuevamente y delineamos un plan de acci√≥n semanal. </font><font style="vertical-align: inherit;">Limitaci√≥n, pruebas de rendimiento, orden asincr√≥nico y mucho m√°s. </font><font style="vertical-align: inherit;">Fue un d√≠a largo y hab√≠a largas semanas por delante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renacimiento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La semana del 23 de abril fue infernal. </font><font style="vertical-align: inherit;">Despu√©s de eso, nos dijimos que hab√≠amos hecho nuestro mejor 200% e hicimos todo lo posible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tuvimos que salvar Dodo IS y decidimos aplicar alguna analog√≠a m√©dica. </font><font style="vertical-align: inherit;">En general, este es el primer caso real de usar una met√°fora (como en el XP original), que realmente ayud√≥ a comprender lo que estaba sucediendo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reanimaci√≥n: cuando necesita salvar a un paciente que est√° muriendo. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tratamiento: cuando hay s√≠ntomas, pero el paciente a√∫n est√° vivo.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/1a/jm/_r/1ajm_re5g-xgtcik_ykvtdlewmu.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resucitaci√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera etapa de la reanimaci√≥n es el runbook est√°ndar para restaurar el sistema en caso de falla de acuerdo con algunos par√°metros. </font><font style="vertical-align: inherit;">Una cosa ha ca√≠do, lo estamos haciendo, esa ha ca√≠do, lo estamos haciendo, y as√≠ sucesivamente. </font><font style="vertical-align: inherit;">En el caso de un bloqueo, encontramos r√°pidamente el runbook deseado, todos se encuentran en GitHub y est√°n estructurados por problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda etapa de la reanimaci√≥n es la limitaci√≥n de las √≥rdenes. </font><font style="vertical-align: inherit;">Adoptamos esta pr√°ctica de nuestras propias pizzer√≠as. </font><font style="vertical-align: inherit;">Cuando se descargan muchos pedidos en la pizzer√≠a, y entienden que no pueden cocinarlos r√°pidamente, se detienen en la parada durante 5 minutos. Solo para despejar la l√≠nea de pedido. </font><font style="vertical-align: inherit;">Hicimos un esquema similar para Dodo IS. </font><font style="vertical-align: inherit;">Decidimos que si se pone realmente mal, activaremos el l√≠mite general y les diremos a los clientes, dicen, 5 minutos y tomaremos su pedido. </font><font style="vertical-align: inherit;">Desarrollamos esta medida por si acaso, pero como resultado, nunca la usamos. </font><font style="vertical-align: inherit;">In√∫til. </font><font style="vertical-align: inherit;">Y bonito.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tratamiento</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comenzar el tratamiento, es necesario hacer un diagn√≥stico, por lo que nos centramos en las pruebas de rendimiento. Parte del equipo fue a recopilar un perfil de carga real de la producci√≥n usando GoReplay, parte del equipo centrado en pruebas sint√©ticas en el escenario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las pruebas sint√©ticas no reflejaron el perfil de carga real, pero dieron algunas bases para mejoras, mostraron algunas debilidades en el sistema. Por ejemplo, poco antes de eso, est√°bamos moviendo el conector MySQL de Oracle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a uno nuevo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En la versi√≥n del conector hab√≠a un error con las sesiones de agrupaci√≥n, lo que condujo al hecho de que los servidores simplemente fueron al techo de la CPU y dejaron de atender las solicitudes. Reproducimos esto con pruebas de Stage, concebido y silenciosamente en producci√≥n. Hubo una docena de tales casos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A medida que diagnostican e identifican las causas de los problemas, se corrigen puntualmente. </font><font style="vertical-align: inherit;">Adem√°s, entendimos que nuestra forma ideal es la recepci√≥n as√≠ncrona de un pedido. </font><font style="vertical-align: inherit;">Comenzamos a trabajar para introducirlo en una aplicaci√≥n m√≥vil.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semanas del infierno: organizaci√≥n del proceso</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un equipo de 40 personas trabaj√≥ en un solo gran objetivo: la estabilizaci√≥n del sistema. Todos los equipos trabajaron juntos. ¬øNo se que hacer? Ayuda a otros equipos. Centrarse en objetivos espec√≠ficos ayud√≥ a no ser rociado y a no participar en tonter√≠as innecesarias para nosotros. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/3e/ik/zu3eikvdviql0uyvqabv3w18axi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tres veces al d√≠a hab√≠a sincronizaci√≥n, un stand-up com√∫n, como en un scrum cl√°sico. Para 40 personas. Solo dos veces en tres semanas (durante casi 90 sincronizaciones) no cumplimos 30 minutos. La sincronizaci√≥n m√°s larga dur√≥ 57 minutos. Aunque generalmente tomaban 20-30 minutos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El objetivo de las sincronizaciones: comprender d√≥nde se necesita ayuda y cu√°ndo llevaremos estas o esas tareas a producci√≥n. Los chicos se unieron en equipos de proyecto, si necesitaban la ayuda de la infraestructura, una persona vino all√≠, todos los problemas se resolvieron r√°pidamente, menos discusi√≥n era m√°s importante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por las noches, para apoyar a los muchachos, nuestro laboratorio de I + D prepar√≥ comida para los desarrolladores durante la noche. Recetas de pizza locas, alitas de pollo, papas! ¬°Eso fue incre√≠blemente genial! Tal apoyo motiv√≥ a los muchachos tanto como fue posible. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/pz/3f/mspz3f9matohgpx7z9sk9bf8pzu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajar en un modo tan continuo era muy dif√≠cil. El mi√©rcoles 25 de abril, a eso de las 5 de la tarde, Oleg Blokhin, uno de nuestros desarrolladores, se acerc√≥ a CTO, que hab√≠a estado pensando el s√°bado sin parar. Hab√≠a fatiga inhumana en sus ojos: "Me fui a casa, no puedo soportarlo m√°s". Dormi√≥ bien y al d√≠a siguiente fue abundante. Entonces puedes describir la condici√≥n general de muchos chicos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El pr√≥ximo s√°bado 28 de abril (fue un s√°bado de trabajo para todos en Rusia) fue m√°s tranquilo. </font><font style="vertical-align: inherit;">No pudimos cambiar nada, vimos el sistema, los chicos descansaron un poco del ritmo. </font><font style="vertical-align: inherit;">Todo fue en silencio. </font><font style="vertical-align: inherit;">La carga no era tan grande, pero lo era. </font><font style="vertical-align: inherit;">Sobrevivieron sin problemas, y esto les dio la confianza de que √≠bamos por el camino correcto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda y tercera semana despu√©s de la ca√≠da ya estaban en un modo m√°s tranquilo, el ritmo infernal desapareci√≥ hasta altas horas de la noche, pero el proceso general de la ley marcial se mantuvo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√≥ximo d√≠a X: prueba de resistencia</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Al d√≠a siguiente X fue el 9 de mayo! </font><font style="vertical-align: inherit;">Alguien estaba sentado en casa y monitoreando el estado del sistema. </font><font style="vertical-align: inherit;">Aquellos de nosotros que salimos a caminar llevamos computadoras port√°tiles con nosotros para estar completamente armados si algo sal√≠a mal. </font><font style="vertical-align: inherit;">Sasha Andronov, nuestra estaci√≥n de servicio, se acerc√≥ al pico de la tarde a una de las pizzer√≠as, para que, en caso de problemas, vea todo con sus propios ojos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ese d√≠a recibimos 91500 pedidos en Rusia (en ese momento, el segundo resultado en la historia del Dodo). </font><font style="vertical-align: inherit;">Ni siquiera hab√≠a el menor indicio de un problema. </font><font style="vertical-align: inherit;">¬°El 9 de mayo confirm√≥ que estamos en el camino correcto! </font><font style="vertical-align: inherit;">Centrarse en la estabilidad, el rendimiento, la calidad. </font><font style="vertical-align: inherit;">El proceso de reestructuraci√≥n nos esperaba a√∫n m√°s, pero esta es una historia completamente diferente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gran ca√≠da retro y 6 pr√°cticas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En situaciones cr√≠ticas, se desarrollan buenas pr√°cticas que pueden y deben transferirse a un momento de silencio. Enfoque, ayuda entre equipos, despliegue r√°pido a producci√≥n sin esperar una regresi√≥n completa. Comenzamos con retro y luego desarrollamos el marco del proceso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/md/ty/wpmdtygdhvy93ufctatnfmxypms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los primeros dos d√≠as pasaron en una discusi√≥n de pr√°cticas. No nos propusimos el objetivo de "poner una retrospectiva a las 2 en punto". Despu√©s de tal situaci√≥n, est√°bamos listos para tomar el tiempo para desarrollar nuestras ideas y nuestro nuevo proceso en detalle. Todos participaron. Todos los que participaron en el trabajo de restauraci√≥n de una forma u otra. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/52/qu/qf52qu_y6lojoqjjcxw3lrronny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, hubo 6 pr√°cticas importantes de las que me gustar√≠a hablar con m√°s detalle.</font></font><br>
<br>
<ol>
<li><b>Top N .</b>   ,  .      Product Owners ,  ,     ,         .    .      ,   .        ,  ,  ,   .   ,         .   N         ‚Äì  Lead Time    . </li>
<li><b> .</b>    .     -,      ,        .         ,        ,  ,     .   . </li>
<li><b> .</b>    ,   ¬´    ¬ª    . ,        . ,     ,     .  ,         -   .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">       Dodo IS.</a>         .</li>
<li><b> Pull Request.</b>      ,     Pull Request,      -   .    .   ,   ,   ,   ,  -   .            , . ,  .  15          .</li>
<li><b>Performance- ‚Äî  .</b>  performance-     .   ,   . Performance-    .   baseline   ,    PR   .       ,   . </li>
<li><b>Performance     .</b>     ‚Äî      .  , , -,  , ,       .         .        ,    . </li>
</ol><br>
<br>
<h2></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">1.    </b>
                        <div class="spoiler_text"><h4><b>21.04.2018 ‚Äì    Dodo IS.     ? </b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> (Site Reliability Engineering)</b></u>:      .  ,    . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> (Site Reliability Engineering, Product Owner   Dodo IS)</b></u>:      . ,    ,   . <br>
<br>
     auth‚Äô,       .         .      ,        . <br>
<br>
   ,    ()   :<br>
<br>
<img src="https://habrastorage.org/webt/_h/qh/yy/_hqhyy80kusheiqap3xwfchwjvk.jpeg"><br>
<br>
        .     ,    . <br>
<br>
      .       ,      .       .     -.  ,         ,      . -  ,  ,    .     ,        -,    ,    . <br>
<br>
         .           redis,      .    .      - ,   .       .<br>
<br>
     Dodo IS   .        .      ,     . ,        , , ,   .     ,      ‚Äî     . <br>
<br>
     .                ¬´ ¬ª.  ¬´  ,   ¬ª    . <br>
<br>
<h4><b> -   ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
   ‚Äì    .       .         . ,             .      .   .<br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
     .     ,       .   (  ), -       .   .<br>
<br>
       .  :<br>
<br>
<ol>
<li>      .</li>
<li>     .</li>
<li>       ,     . </li>
</ol><br>
<h4><b>      ?</b></h4><br>
<br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
,        ,  ,      .<br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
 ,            ,    .     ,     .<br>
<br>
<h4><b>    ?               ?</b></h4><br>
<br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:  ,      ‚Äì  . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li> ‚Äî     . -     -   . <br>
<br>
          ,       .  2018       ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PerformanceLab</a>,      .</li>
<li>     ,          .      Less-. </li>
<li>         .   2018         -,     .      ,    .    - 2018   .</li>
<li>  async  . ,   21.04.2018     .    ,     .     async. </li>
<li> . ,    SaveOrder  async-await.   ,     .      :          ,       LF,         20   .       ,       .  ,         .    !<br>
<br>
    ,   ,           ,     . <br>
<br>
         ,    ,  .          ‚Äî -.       . </li>
<li>     .         ,   (, ).      ,        .  ¬´¬ª    .   nginx   ,    -  ,       . <br>
<br>
    : innodb_lock_wait_timeout = 5; innodb_rollback_on_timeout = ON.         .   ,     ,       ,    ,       . </li>
</ol><br>
<h4><b>   ,       ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li>   ,   ,     ,   .   ,     .</li>
<li>    ,     .</li>
<li>      ,   ,    ,    .         ‚Äì    .</li>
</ol><br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="60"> <u><b> </b></u>:<br>
<br>
<ol>
<li>   .</li>
<li>    .        , ,    -.          .</li>
<li>    .   ,   -    ,    .</li>
</ol><br>
<h4><b>   ,       ?</b></h4><br>
<img src="https://habrastorage.org/webt/4l/3r/6-/4l3r6-lc2cgut1u8ec3gdawjdma.png" align="left" width="60"> <u><b> </b></u>:<br>
<br>
  ¬´¬ª   ,   ¬´¬ª. ,      ,     .    . <br>
<br>
<img src="https://habrastorage.org/webt/lj/ov/je/ljovjerpqe5mx5j5w9nsxer5xxq.png" align="right" width="80"> <u><b> </b></u>:<br>
<br>
  ,      .   , ,     .     .<br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">2. ,        (Dodo IS Architect)</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/ge/pg/qm/gepgqmcioq9qqndtdk9dbz8njjo.png" align="left" width="60">              ‚Äî ,     .       ,      ‚Äî             . <br>
<br>
        ,        ,           . ,         (, ,    )        .<br>
<br>
        IT-.       Dodo IS,         .              ‚Ä¶<br>
<br>
 X ,  .      . Dodo IS  ,         ,   ,        .      ,  , ,    .    .     146%,     .     ,    Dodo IS  ?<br>
<br>
    ,  .    ,    ,         .                  ,       .       ,      !<br>
<br>
     ,   .   ¬´ ¬ª: 11-  ,  ,  2 .  ¬´¬ª       .  3-4     ,          .          ,     .   .<br>
<br>
  , ,            .         . Dodo IS     ,   ¬´ ¬ª.     ! (    ). <br>
<br>
     ,     Dodo IS      ,      .   Dodo IS .       ¬´ ¬ª, ,    .             (   ),         loadtest,   ,   .<br>
</div>
                    </div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498268/index.html">API Mosbirge gratuita en f√≥rmulas de Microsoft Excel</a></li>
<li><a href="../es498270/index.html">¬øQu√© profesionales de TI son contratados durante la crisis econ√≥mica y la pandemia?</a></li>
<li><a href="../es498272/index.html">Ahorre tiempo y esfuerzo en la implementaci√≥n de est√°ndares de desarrollo seguros con OWASP SAMM</a></li>
<li><a href="../es498276/index.html">Campeonato de programaci√≥n deportiva en l√≠nea RuCode</a></li>
<li><a href="../es498278/index.html">Editorial Peter. Venta de primavera</a></li>
<li><a href="../es498282/index.html">[instrucci√≥n] Crear una cuenta y un sitio en la plataforma Google Site</a></li>
<li><a href="../es498284/index.html">C√≥mo optimizar el aprendizaje del ingl√©s</a></li>
<li><a href="../es498288/index.html">Tu ciudad necesita un metro bus</a></li>
<li><a href="../es498290/index.html">Hidrolog√≠a de procedimiento: simulaci√≥n din√°mica de r√≠os y lagos.</a></li>
<li><a href="../es498292/index.html">Ahorre mucho dinero en grandes vol√∫menes en PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>