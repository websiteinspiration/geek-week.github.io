<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∏ ‚ìÇÔ∏è üéµ Raspberry Pi + Fedora (aarch64) = Wi-Fi Hotspot (or a raspberry router in a blue hat) üí£ üì° üôåüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the article Raspberry Pi + CentOS = Wi-Fi Hotspot (or a raspberry router in a red hat) I talked about how to turn a raspberry into a wireless acces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi + Fedora (aarch64) = Wi-Fi Hotspot (or a raspberry router in a blue hat)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492322/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi + CentOS = Wi-Fi Hotspot (or a raspberry router in a red hat)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I talked about how to turn a raspberry into a wireless access point using the CentOS operating system. Having collected my home router from such a drawing, I satisfied my creative ego and received a charge of calm for a critical element of my cozy infrastructure. However, the feeling of incomplete decision and internal perfectionism did not give rest: "an imperfect result of work has no right to exist." The thought that ‚Äúthat ideal can and must be achieved‚Äù did not leave me for a minute.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then one day at one of the thematic forums I came across a discussion of the bit depth of existing operating systems for ‚ÄúMalinka‚Äù (aarch64 vs armhfp): which 64-bit operating systems can basically fit in and make money on Raspberry version 3 ++? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My favorite CentOS for ARM architecture from "Userland" was in no hurry to switch to the latest version kernel and turn into 64-bit. And the EPEL repository, connected God knows where without a digital signature, was a nightmare in my troubled dream ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speaking as an adherent of RPM-based distributions, I was surprised to find that </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fedora</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> turned out to be absolutely forgotten in discussions of the OS for ‚Äúraspberry‚Äù </font><font style="vertical-align: inherit;">! And this despite the fact that its release </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the 28th version officially supports the Raspberry Pi 3B + in 64-bit version!</font></font></a><br>
<a name="habracut"></a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ck/ej/er/ckejerte0wdk7sokq-q4c-fgiqs.png" alt="Fedora aarch64"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I will talk about how to install </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fedora (aarch64)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 3 Model B +</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in an </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extra minimal version</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">I will dwell briefly on the features of raising a Wi-Fi access point identified as a result of the trial operation of my previous configuration on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CentOS 7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0. What is needed</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All the same as listed in the previous article:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 3 Model B +;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">microSD&gt; = 4GB (later you can "transfer" the system to a 2GB drive);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux workstation with microSD card reader;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wired network connection of ‚Äúraspberry‚Äù and the workstation with Linux (in this case, no additional monitor and keyboard are required for configuration), Internet access from both devices;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advanced skill in Linux (to know and not be afraid: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parted</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkfs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Like an iterative </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LFS-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assembly of your own Linux, the Fedora distribution image will be used, and then a minimal system will be created on its basis (without "compilation from source").</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Installing the original distribution</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The coordinates of the raw image of the system on the Web: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https: //.../fedora-secondary/releases/.../Spins/aarch64/images/Fedora-Minimal-...xz</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
After it is written to the microSD and before use it is necessary :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extend the ‚Äúroot‚Äù of the file system (3rd section, ext4)</font></font><br>
<br>
<pre><code class="bash hljs">parted /dev/mmcblk0 resizepart 3 100%<font></font>
e2fsck -f /dev/mmcblk0p3; resize2fs /dev/mmcblk0p3; e2fsck -f /dev/mmcblk0p3<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> 1 2 3; <span class="hljs-keyword">do</span> mkdir -p /mnt/<span class="hljs-variable">$i</span>; mount /dev/mmcblk0p<span class="hljs-variable">$i</span> /mnt/<span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span>
</code></pre><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disable SELinux</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">'SELINUX=disabled'</span> &gt; /mnt/3/etc/selinux/config
</code></pre><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delete the initial setup wizard:</font></font><br>
<br>
<pre><code class="bash hljs">find /mnt/3/etc/systemd/ -iname initial-setup.service -delete
</code></pre><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allow ssh access:</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p /mnt/3/root/.ssh<font></font>
cp -fv ~/.ssh/id_rsa.pub /mnt/3/root/.ssh/authorized_keys<font></font>
sed -i <span class="hljs-string">'s/#PermitRootLogin.*/PermitRootLogin yes/g'</span> /mnt/3/etc/ssh/sshd_config
</code></pre><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you can download the "raspberry" from microSD and connect to it via the network. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A cold start takes about a minute and a half. </font><font style="vertical-align: inherit;">TTX system after boot:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kh/50/wf/kh50wfa9kd4e6kwgtjhcwxo9dti.jpeg" alt="Fedora aarch64"></div><br>
<pre><code class="bash hljs">rpm -qa | wc -l<font></font>
444<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Minimal system assembly</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, the ‚Äúminimal distribution‚Äù from the developers is far from the most modest in resource consumption. </font><font style="vertical-align: inherit;">The image of the system can be made even smaller. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, on the "raspberry" you need to run the script:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span><font></font>
. /etc/os-release<font></font>
P=$(mktemp --directory $(<span class="hljs-built_in">pwd</span>)/<span class="hljs-variable">$ID</span>-<span class="hljs-variable">$VERSION_ID</span>.XXX)<font></font>
<font></font>
dnf --installroot=<span class="hljs-variable">$P</span> --releasever=<span class="hljs-variable">$VERSION_ID</span> --<span class="hljs-built_in">setopt</span>=install_weak_deps=<span class="hljs-literal">false</span> \<font></font>
--assumeyes install  \<font></font>
    bcm283x-firmware \<font></font>
    dnf              \<font></font>
    grub2-efi-aa64   \<font></font>
    kernel           \<font></font>
    openssh-server   \<font></font>
    shim-aa64<font></font>
<font></font>
<span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> /boot/efi/EFI/fedora/grub.cfg \<font></font>
         /boot/efi/EFI/fedora/grubenv  \<font></font>
         /boot/efi/rpi3-u-boot.bin     \<font></font>
         /etc/default/grub             \<font></font>
         /etc/fstab<font></font>
<span class="hljs-keyword">do</span>
  cp -fv <span class="hljs-variable">$f</span> <span class="hljs-variable">$P</span><span class="hljs-variable">$f</span>
<span class="hljs-keyword">done</span><font></font>
<font></font>
rm  -fv <span class="hljs-variable">$P</span>/dev/*<font></font>
rm -rfv <span class="hljs-variable">$P</span>/var/cache/dnf<font></font>
<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"--------------------------------------------------------------------------------"</span>
du -hs <span class="hljs-variable">$P</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After working out the script, a subdirectory ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">will be created in the current directory </font><font style="vertical-align: inherit;">with the contents of the root of the new minimal OS edition. </font><font style="vertical-align: inherit;">You can turn off the ‚Äúraspberry‚Äù and return the microSD to the Linux workstation.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Installing a minimum system</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installation is reduced to copying the files of the minimum ‚Äúimage‚Äù of the OS (obtained in the previous step) to a specially prepared microSD in the appropriate directories. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A 2GB card and two sections on it are enough:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ boot / efi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - EFI + FAT32, boot, 100MB;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (root) - EXT4, all remaining space.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After preparing the microSD and copying files to it, you need:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repair boot OS;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">turn on the network;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configure access via ssh.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Repairing a download consists in replacing the UUID of the sections in the files:</font></font><br>
<br>
<pre><code class="bash hljs">microSD:/boot/efi/EFI/fedora/grub.cfg<font></font>
microSD:/boot/efi/EFI/fedora/grubenv<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saved_entry =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">in the last file </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the file:</font></font><br>
<br>
<pre><code class="bash hljs">microSD:/etc/fstab
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
you can find old values, and current (current) ones in the output of the command:</font></font><br>
<br>
<pre><code class="bash hljs">blkid | grep mmcblk | sort
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After replacing, you should also adjust the contents of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fstab</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to microSD so that the mount points correspond to the new partition UUIDs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first time you turn on the ‚Äúraspberry‚Äù, network performance can be achieved with a small ‚Äúcrutch‚Äù - create a link (schematically):</font></font><br>
<br>
<pre><code class="bash hljs">ln -s /usr/lib/systemd/system/systemd-networkd.service \<font></font>
  microSD:/etc/systemd/system/multi-user.target.wants<font></font>
</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and file:</font></font><br>
<pre><code class="bash hljs">mkdir -p microSD:/etc/systemd/network<font></font>
cat &gt; microSD:/etc/systemd/network/dhcp.network &lt;&lt; EOF<font></font>
[Match]<font></font>
Name=*<font></font>
[Network]<font></font>
DHCP=ipv4<font></font>
EOF<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After a successful boot, tidy up the launch of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">disable</span> systemd-networkd<font></font>
systemctl <span class="hljs-built_in">enable</span> systemd-networkd
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Superuser access via ssh is configured similarly to item 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having done everything neatly and without errors, you can rearrange the microSD in the "raspberry" and start working with 64-bit OS in an extra minimal performance.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Ready system</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The "image" of the finished system, created according to the above instructions, can be downloaded from the link: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fedora-Tiny-31-5.5.7-200.aarch64</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This will be an archive containing two files: an installation script and TGZ with OS files. </font><font style="vertical-align: inherit;">The archive must be unpacked on a Linux workstation, insert a microSD (2GB card is enough) and run the script with the parameter - the name of the device:</font></font><br>
<br>
<pre><code class="bash hljs">./install /dev/mmcblk0
</code></pre><blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Be careful! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Without any warnings, the device will be formatted and an operating system is installed on it.</font></font></b><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After an error-free working out of the script, the card can be rearranged into the ‚Äúraspberry‚Äù and used: to catch by dhcp, password is ‚Äú1‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The system is cleared of all sorts of IDs and keys, which is why each new installation is unique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I repeat again, the system is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minimal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">Therefore, do not be alarmed: DNF is available, for its functionality you will have to ‚Äúcompose‚Äù the correct </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/resolv.conf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A cold start of a raspberry takes about 40 seconds. </font><font style="vertical-align: inherit;">TTX system after boot:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tt/bc/9r/ttbc9rai6igw20wqxo7idhcwulq.jpeg" alt="Fedora aarch64"></div><br>
<pre><code class="bash hljs">rpm -qa | wc -l<font></font>
191<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Wi-Fi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will dwell a little on the features of the implementation of Wi-Fi access points. For specifics, you can refer to my previous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EPEL is no longer needed - all packages are contained in official repositories. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probably, it would be worth abandoning </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnsmasq</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since Fedora, unlike CentOS, has a fairly recent systemd-networkd, in which there are normal built-in DHCP / DNS servers. But the fact that in RHEL8 developers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">refused to support the network stack with anything other than NM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> does not inspire confidence in the bright future of the project (villains). In short, I have not tried it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further, the current drivers of the built-in Wi-Fi adapter can not be "stolen" from the Raspbian distribution, but downloaded directly from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is what Broadcom firmware files look like on my ‚Äúraspberry‚Äù (schematically):</font></font><br>
<br>
<pre><code class="bash hljs">ls /usr/lib/firmware/brcm | grep 43455<font></font>
<font></font>
 [612775] brcmfmac43455-sdio.bin<font></font>
  [14828] brcmfmac43455-sdio.clm_blob<font></font>
[symlink] brcmfmac43455-sdio.raspberrypi,3-model-b-plus.txt -&gt; brcmfmac43455-sdio.txt<font></font>
   [2099] brcmfmac43455-sdio.txt<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Without them, 5GHz / AC will not work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About the number and names of interfaces. </font><font style="vertical-align: inherit;">Now I strongly recommend that everyone without special need not resort to the ‚Äúservices‚Äù of software switches ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bridge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), which add a significant load to the network stack and inhibit routing. </font><font style="vertical-align: inherit;">If several wireless adapters are not planned, then only physical interfaces should be used. </font><font style="vertical-align: inherit;">I have two Wi-Fi, so I only combine them into a software bridge (although you can do without it by taking a different look at the hostapd setting). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And I like to rename interfaces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To do this, create a symbolic link in Fedora:</font></font><br>
<br>
<pre><code class="bash hljs">/etc/systemd/network/99-default.link -&gt; /dev/null
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and then it will be possible to give meaningful names without tinkering with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">udev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but only by means of systemd-networkd. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here, for example, are called network adapters in my router:</font></font><br>
<br>
<pre><code class="bash hljs">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<font></font>
<font></font>
2: wan: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<font></font>
<font></font>
3: lan: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
<font></font>
4: int: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master lan state UP group default qlen 1000<font></font>
<font></font>
5: ext: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master lan state UP group default qlen 1000<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - built-in, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - external (USB) Wi-Fi adapters assembled in the "bridge" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ethernet adapter into which the Internet is connected.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Have you noticed? </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fq_codel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is really a good thing. </font><font style="vertical-align: inherit;">Together with the fresh Linux kernel, they work wonders in the wireless range: the fierce ‚Äútorrent-quality‚Äù will not lead to a sudden degradation of speed among neighbors. </font><font style="vertical-align: inherit;">Even working "over the air" home IP-TV with a loaded channel does not "break up" and does not "stutter" from the word at all! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> daemon service file has undergone minor changes </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It now looks like this (using the built-in adapter as an example):</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=Hostapd IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator<font></font>
After=network.target<font></font>
BindsTo=sys-subsystem-net-devices-int.device<font></font>
<font></font>
[Service]<font></font>
Type=forking<font></font>
PIDFile=/run/hostapd-int.pid<font></font>
<span class="hljs-comment">#ExecStartPre=/usr/sbin/iw dev int set power_save off</span><font></font>
ExecStart=/usr/sbin/hostapd /path/to/hostapd-int.conf -P /run/hostapd-int.pid -B<font></font>
<font></font>
[Install]<font></font>
RequiredBy=sys-subsystem-net-devices-int.device<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And the ‚Äúmagic‚Äù hostapd-int.conf for working in 5GHz / AC:</font></font><br>
<br>
<pre><code class="bash hljs">ssid=rpi<font></font>
wpa_passphrase=FedoRullezZ<font></font>
<font></font>
<span class="hljs-comment"># 5180 MHz  [36] (20.0 dBm)</span>
<span class="hljs-comment"># 5200 MHz  [40] (20.0 dBm)</span>
<span class="hljs-comment"># 5220 MHz  [44] (20.0 dBm)</span>
<span class="hljs-comment"># 5240 MHz  [48] (20.0 dBm)</span>
<span class="hljs-comment"># 5745 MHz [149] (20.0 dBm)</span>
<span class="hljs-comment"># 5765 MHz [153] (20.0 dBm)</span>
<span class="hljs-comment"># 5785 MHz [157] (20.0 dBm)</span>
<span class="hljs-comment"># 5805 MHz [161] (20.0 dBm)</span>
<span class="hljs-comment"># 5825 MHz [165] (20.0 dBm)</span><font></font>
<font></font>
channel=36<font></font>
<span class="hljs-comment">#channel=149</span><font></font>
<font></font>
<span class="hljs-comment"># channel+6</span>
<span class="hljs-comment"># http://blog.fraggod.net/2017/04/27/wifi-hostapd-configuration-for-80211ac-networks.html</span><font></font>
<font></font>
vht_oper_centr_freq_seg0_idx=42<font></font>
<span class="hljs-comment">#vht_oper_centr_freq_seg0_idx=155</span><font></font>
<font></font>
country_code=US<font></font>
<font></font>
interface=int<font></font>
bridge=lan<font></font>
<font></font>
driver=nl80211<font></font>
<font></font>
auth_algs=1<font></font>
wpa=2<font></font>
wpa_key_mgmt=WPA-PSK<font></font>
rsn_pairwise=CCMP<font></font>
<font></font>
macaddr_acl=0<font></font>
<font></font>
hw_mode=a<font></font>
wmm_enabled=1<font></font>
<font></font>
<span class="hljs-comment"># N</span><font></font>
ieee80211n=1<font></font>
require_ht=1<font></font>
ht_capab=[HT40+][SHORT-GI-40][SHORT-GI-20]<font></font>
<font></font>
<span class="hljs-comment"># AC</span><font></font>
ieee80211ac=1<font></font>
ieee80211d=0<font></font>
ieee80211h=0<font></font>
vht_oper_chwidth=1<font></font>
require_vht=1<font></font>
vht_capab=[SHORT-GI-80]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A bit of ‚Äúphotoshop‚Äù made from my ‚ÄúEricsson A1018s‚Äù:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Internet connection - 100Mbps)</font></font></b><div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/4h/xs/jh/4hxsjhmtq02ncoin0srnexe7jo0.jpeg" alt="Fedora aarch64"></div></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And in conclusion, a small FAQ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. FAQ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1 Why make a Wi-Fi router on a Raspberry?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One could answer simply, saying "it is interesting to try and all that." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in fact, it seems to me, the topic is quite serious. In the era of the "bloody" Internet, buying a router in a store and being held hostage by its manufacturer is a very dull prospect. Many people already understand that it is impossible to sit with a CVE or wired backdoor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, you can migrate to WRT firmware from enthusiasts. There is probably more trust in them, but if you do not want to depend on them, then only your own product. Ideally, a full-fledged computer for the possibility of implementing everything in the world on it. In terms of routing, of course. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, the choice of ‚Äúraspberries‚Äù is a purely economic move: a real computer and at the same time - inexpensive. Although, it is also possible - with its ‚Äúdual‚Äù inside.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2 But Raspberry is a ‚Äúsub-router‚Äù: slow and with one Ethernet port!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a home Wi-Fi router, ‚ÄúMalinka‚Äù suits me more than. </font><font style="vertical-align: inherit;">About speed "through the air" I have already said above. </font><font style="vertical-align: inherit;">And just one Ethernet, well, in a similar product from Apple in approximately the same way! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But seriously, of course I would like more. </font><font style="vertical-align: inherit;">And despite the fact that in my household all devices are connected wirelessly, sometimes a copper connection is still required. </font><font style="vertical-align: inherit;">For such cases, I have a ‚Äúmobile hub‚Äù in store:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">device - such as</font></font></b><div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/iy/x6/by/iyx6byfya4tlmt9om_mvd3wmf_4.jpeg" alt="Fedora aarch64"></div></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3 If this is a router, then nothing is said about the ‚Äútuning‚Äù of TCP / IP, because it is important!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to setting up the network stack (tcp_fastopen, YeAH, etc.), this and the previous article did not disclose other nuances, in particular, the process of preparing microSD for optimal use (although the installer tries to format the memory card in a tricky way). </font><font style="vertical-align: inherit;">The process of improvement is endless, you just need to stop in time.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4 Why Fedora?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Because I like! </font><font style="vertical-align: inherit;">Fedora - "mainstream" - a system of geeks, for which, in fact, this article is intended. </font><font style="vertical-align: inherit;">At the time of writing, perhaps the only OS that for Raspberry in 64-bit version is officially supported by a significant staff of developers (from which I can‚Äôt wait for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the 5.6 kernel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5 Does Bluetooth work? </font><font style="vertical-align: inherit;">How is the video / sound / GPIO?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I do not know. </font><font style="vertical-align: inherit;">The article is about the minimal installation of the system and its subsequent use as a Wi-Fi router.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.6 Why do all CentOS / Fedora / RedHat articles start with disabling SELinux?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Because the system is minimal, it does not even have a firewall and utilities for setting it up. </font><font style="vertical-align: inherit;">Who needs it - they can install everything else that is needed.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.7. The system cannot be used, the password cannot be changed - no passwd. </font><font style="vertical-align: inherit;">No ping, nothing!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Or this installation option is not for you - use the distribution kit from the developers.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.8 Where is the SWAP? </font><font style="vertical-align: inherit;">I can‚Äôt live without him!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Truth? </font><font style="vertical-align: inherit;">Oh well:</font></font><br>
<br>
<pre><code class="bash hljs">fallocate -l 1G /swap<font></font>
chmod -v 0600 /swap<font></font>
mkswap -f /swap<font></font>
swapon -v /swap<font></font>
grep <span class="hljs-string">"/swap"</span> /etc/fstab || <span class="hljs-built_in">echo</span> <span class="hljs-string">"/swap swap swap defaults 0 0"</span> &gt;&gt; /etc/fstab
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.9 I would like to download a ready-made image with a configured Wi-Fi access point!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To prepare the installer "for all" will require a certain amount of time and effort. </font><font style="vertical-align: inherit;">If (suddenly!) It really seems interesting and necessary to someone - write, we‚Äôll come up with something.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On it - I will finish. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I wish everyone safe surfing and maximum control over the infrastructure!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492308/index.html">Neurons and their modeling</a></li>
<li><a href="../en492312/index.html">Avro serialization at Kafka</a></li>
<li><a href="../en492314/index.html">Smart Home: Build Water and Electricity Charts in Home Assistant</a></li>
<li><a href="../en492318/index.html">How coronavirus affects the IT industry</a></li>
<li><a href="../en492320/index.html">Covid-19, your society and you in terms of data science</a></li>
<li><a href="../en492324/index.html">We discuss the EARN IT Act - a new US bill that could lead to a ban on E2E encryption</a></li>
<li><a href="../en492326/index.html">Analysis of the popularity of YouTube videos of Eurovision 2020 participants</a></li>
<li><a href="../en492328/index.html">Continuous integration and deployment of desktop applications with GitHub Actions</a></li>
<li><a href="../en492332/index.html">Build apps for free with Azure Cosmos DB Free Tier</a></li>
<li><a href="../en492336/index.html">Analyze your builds programmatically with the C ++ Build Insights SDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>