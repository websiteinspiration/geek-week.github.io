<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👣 😚 🥦 Google Cloud Spanner: bueno, malo, malo 🐣 💓 🌚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habrovsk Tradicionalmente, seguimos compartiendo material interesante en previsión del lanzamiento de nuevos cursos. Hoy, especialmente para uste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Google Cloud Spanner: bueno, malo, malo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489012/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola habrovsk </font><font style="vertical-align: inherit;">Tradicionalmente, seguimos compartiendo material interesante en previsión del lanzamiento de nuevos cursos. </font><font style="vertical-align: inherit;">Hoy, especialmente para usted, hemos publicado un artículo sobre Google Cloud Spanner, programado para coincidir con el lanzamiento del curso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS para desarrolladores</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/aj/iu/8h/ajiu8hhn-nlooidazuy-xsxjb6a.png"><br>
<br>
<hr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Publicado originalmente </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el blog Lightspeed HQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como una compañía que ofrece muchas soluciones POS basadas en la nube para minoristas, restauradores y minoristas en línea de todo el mundo, Lightspeed utiliza varios tipos diferentes de plataformas de bases de datos para una variedad de casos de transacciones, análisis y búsqueda. </font><font style="vertical-align: inherit;">Cada una de estas plataformas de bases de datos tiene sus propias fortalezas y debilidades. En consecuencia, cuando Google introdujo el Cloud Spanner en el mercado, características prometedoras sin precedentes en el mundo de las bases de datos relacionales, como la escalabilidad horizontal prácticamente ilimitada y un acuerdo de nivel de servicio (SLA) del 99.999%, ¡No podíamos perder la oportunidad de tenerlo en nuestras manos!</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para dar una visión general de nuestra experiencia con Cloud Spanner, así como los criterios de evaluación que utilizamos, cubriremos los siguientes temas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestros criterios de evaluación</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud Spanner en pocas palabras</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestra calificación</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestros hallazgos</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/2m/br/l7/2mbrl7cdprixgrcxqn4dp25yvju.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Nuestros criterios de evaluación</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de profundizar en las características de Cloud Spanner, sus similitudes y diferencias con otras soluciones en el mercado, primero hablemos sobre los principales casos de usuarios que teníamos en mente al considerar dónde implementar Cloud Spanner en nuestra infraestructura:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como reemplazo de la solución de base de datos SQL tradicional (predominante)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo una solución OLTP con soporte OLAP</font></font></li>
</ul><br>
<blockquote><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para simplificar y facilitar la comparación, este artículo compara Cloud Spanner con MySQL GCP Cloud SQL y la familia de soluciones Amazon AWS RDS.</font></font></i></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usar Cloud Spanner como reemplazo de una solución de base de datos SQL tradicional</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un entorno de </font><font style="vertical-align: inherit;">base de datos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradicional</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuando el tiempo de respuesta a una consulta de base de datos se acerca o incluso excede los umbrales de aplicación predefinidos (principalmente debido a un aumento en el número de usuarios y / o consultas), hay varias formas de reducir el tiempo de respuesta a niveles aceptables. Sin embargo, la mayoría de estas soluciones incluyen intervención manual. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, el primer paso que debe tomar es observar los diversos parámetros de la base de datos relacionados con el rendimiento y configurarlos para que coincidan con los patrones de uso de la aplicación. Si esto no es suficiente, puede optar por escalar la base de datos vertical u horizontalmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ampliar la aplicación implica actualizar la instancia del servidor, generalmente agregando más procesadores / núcleos, más RAM, almacenamiento más rápido, etc. Agregar más recursos de hardware conduce a un aumento en el rendimiento de la base de datos, medido principalmente en transacciones en segundo, y el retraso de la transacción para los sistemas OLTP. Los sistemas de bases de datos relacionales (que utilizan un enfoque de subprocesos múltiples), como MySQL, se escalan bien verticalmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este enfoque tiene varios inconvenientes, pero el más obvio es el tamaño máximo del servidor en el mercado. Una vez que se alcanza el límite de la instancia de servidor más grande, solo hay una forma: escala horizontal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El escalado horizontal es un enfoque en el que se agregan más servidores al clúster para aumentar de manera ideal el rendimiento de forma lineal con la adición de la cantidad de servidores. La mayoría de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sistemas de bases de datos </font><i><font style="vertical-align: inherit;">tradicionales</font></i><font style="vertical-align: inherit;"> no se escalan bien horizontalmente o no se escalan en absoluto. Por ejemplo, MySQL puede escalar horizontalmente para operaciones de lectura agregando lectores esclavos, pero no puede escalar horizontalmente para operaciones de escritura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por otro lado, debido a su naturaleza, Cloud Spanner puede escalar fácilmente horizontalmente con una mínima interferencia. </font><i><font style="vertical-align: inherit;">DBMS</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
con todas las funciones </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como servicio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser evaluado desde diferentes ángulos. </font><font style="vertical-align: inherit;">Como base, tomamos el DBMS más popular en la nube: para Google, GCP Cloud SQL y para Amazon, AWS RDS. </font><font style="vertical-align: inherit;">En nuestra evaluación, nos centramos en las siguientes categorías:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapeo de características: extensión SQL, DDL, DML; </font><font style="vertical-align: inherit;">bibliotecas / conectores de conexión, soporte de transacciones, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte de desarrollo: facilidad de desarrollo y prueba.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte de administración: gestión de instancias, por ejemplo, escalar / actualizar y actualizar instancias; </font><font style="vertical-align: inherit;">SLA, copia de seguridad y restauración; </font><font style="vertical-align: inherit;">seguridad / control de acceso.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso de Cloud Spanner como OLTP con soporte OLAP</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque Google no afirma explícitamente que Cloud Spanner es para procesamiento analítico, comparte algunos atributos con otros mecanismos, como Apache Impala &amp; Kudu y YugaByte, que están diseñados para cargas de trabajo OLAP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso si hubiera una pequeña posibilidad de que Cloud Spanner incluyera un motor HTAP (procesamiento híbrido transaccional / analítico) consistente y escalable horizontalmente con un conjunto (más o menos) utilizable de características OLAP, creemos que merece nuestra atención. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con esto en mente, examinamos las siguientes categorías:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte de carga de datos, índices y particionamiento</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Query Performance and DML</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Cloud Spanner en pocas palabras</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Spanner es un sistema de gestión de bases de datos relacionales de clúster (RDBMS) que Google utiliza para varios de sus propios servicios. </font><font style="vertical-align: inherit;">Google lo puso a disposición del público para los usuarios de Google Cloud Platform a principios de 2017. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos son algunos de los atributos de Cloud Spanner:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clúster RDBMS escalable altamente coherente: utiliza sincronización de tiempo de hardware para garantizar la coherencia de los datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte de transacciones entre tablas: las transacciones pueden abarcar varias tablas, no necesariamente limitadas a una tabla (a diferencia de Apache HBase o Apache Kudu).</font></font></li>
<li>    :        (),       .      ,           .       ,             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>.</li>
<li> :        .          .     ,        , ,       -.</li>
<li>: Cloud Spanner   .         .         .         .     , ,    ,   .         ,    .</li>
</ul><br>
<i>«Cloud Spanner       .  , Cloud Spanner     ,    - ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>».</i><br>
<br>
<ul>
<li>    (SLA):      SLA  99,99%;    99,999% SLA.          ,   - ,  ,    Google     ,     . ( , 99,999%  26,3     .)</li>
<li>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://cloud.google.com/spanner/</a></li>
</ul><br>
<blockquote><i><b>:</b>  Apache Tephra      Apache HBase (    Apache Phoenix   -).</i></blockquote><br>
<h2>3.  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, todos leemos las declaraciones de Google sobre los beneficios de Cloud Spanner: escala horizontal prácticamente ilimitada mientras se mantiene una alta consistencia y un SLA muy alto. </font><font style="vertical-align: inherit;">Aunque estos requisitos son, en cualquier caso, extremadamente difíciles de cumplir, nuestro objetivo no era refutarlos. </font><font style="vertical-align: inherit;">En cambio, centrémonos en otras cosas que a la mayoría de los usuarios de bases de datos les interesan: paridad y usabilidad.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calificamos Cloud Spanner como un reemplazo para Sharded MySQL</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Cloud SQL y Amazon AWS RDS, los dos DBMS OLTP más populares en el mercado de la nube, tienen un conjunto de características muy amplio. </font><font style="vertical-align: inherit;">Sin embargo, para escalar estas bases de datos más allá del tamaño de un solo nodo, debe realizar una partición de la aplicación. </font><font style="vertical-align: inherit;">Este enfoque crea una complejidad adicional tanto para las aplicaciones como para la administración. </font><font style="vertical-align: inherit;">Observamos cómo encaja Spanner en el escenario de combinar varios segmentos en una instancia y qué características (si las hay) pueden tener que ser sacrificadas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Soporte para SQL, DML y DDL, así como conectores y bibliotecas?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, al comenzar con cualquier base de datos, debe crear un modelo de datos. </font><font style="vertical-align: inherit;">Si cree que puede conectar el JDBC Spanner a su herramienta SQL favorita, encontrará que puede consultar sus datos con ella, pero no puede usarla para crear una tabla o cambio (DDL) o cualquier operación de inserción / actualización / eliminación ( DML). </font><font style="vertical-align: inherit;">El JDBC oficial de Google tampoco es compatible.</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Los controladores no son compatibles actualmente con DML o DDL". </font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Documentación de llave</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la consola GCP, la situación no es mejor: solo puede enviar consultas SELECT. Afortunadamente, hay un controlador JDBC con soporte DML y DDL de la comunidad, que incluye transacciones </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/olavloite/spanner-jdbc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Aunque este controlador es extremadamente útil, la falta del propio controlador JDBC de Google es sorprendente. Afortunadamente, Google ofrece un soporte bastante amplio para las bibliotecas de clientes (basadas en gRPC): C #, Go, Java, node.js, PHP, Python y Ruby.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El uso casi obligatorio de las interfaces de usuario de Cloud Spanner (debido a la falta de DDL y DML en JDBC) conlleva algunas restricciones para áreas de código relacionadas, como grupos de conexiones o marcos de enlace de bases de datos (por ejemplo, Spring MVC). Por lo general, cuando usa JDBC, puede elegir libremente su grupo de conexiones favorito (por ejemplo, HikariCP, DBCP, C3PO, etc.), que se prueba y funciona bien. En el caso de las API de Spanner personalizadas, debemos confiar en los marcos / grupos de enlace / sesiones que creamos nosotros mismos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El diseño de la clave principal (PC) permite que Cloud Spanner sea muy rápido al acceder a los datos a través de una PC, pero también genera algunos problemas de consulta.</font></font><br>
<br>
<ul>
<li>      ;               . (       / .)</li>
<li>  UPDATE  DELETE     WHERE, ,      DELETE all —    , : UPDATE xxx WHERE id IN (SELECT id FROM table1)</li>
<li>    - ,      .   ,        .</li>
</ul><br>
<h4> ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Cloud Spanner tiene soporte incorporado para índices secundarios. Esta es una característica muy agradable que no siempre está presente en otras tecnologías. Apache Kudu no admite actualmente índices secundarios, y Apache HBase no admite índices directamente, pero puede agregarlos a través de Apache Phoenix. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los índices en Kudu y HBase se pueden modelar como una tabla separada con una composición diferente de las claves primarias, pero la atomicidad de las operaciones realizadas en la tabla principal y las tablas de índice relacionadas deben realizarse a nivel de aplicación y no es trivial en la implementación correcta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se mencionó en la revisión de Cloud Spanner, sus índices pueden diferir de los índices de MySQL. </font><font style="vertical-align: inherit;">Por lo tanto, se debe tener especial cuidado al crear consultas y crear perfiles para garantizar que se utilice el índice adecuado donde sea necesario.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Representación?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un objeto muy popular y útil en la base de datos son las vistas. </font><font style="vertical-align: inherit;">Pueden ser útiles para una gran cantidad de casos de usuarios; </font><font style="vertical-align: inherit;">Mis dos favoritos son el nivel de abstracción lógica y el nivel de seguridad. </font><font style="vertical-align: inherit;">Desafortunadamente, Cloud Spanner NO admite envíos. </font><font style="vertical-align: inherit;">Sin embargo, esto solo nos limita parcialmente, porque para los permisos de acceso no hay granularidad a nivel de columna donde las representaciones pueden ser una solución aceptable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La documentación de Cloud Spanner tiene una sección que detalla las cuotas y restricciones ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llave / cuotas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), hay, en particular, uno que puede ser problemático para algunas aplicaciones: Cloud Spanner listo para usar tiene un límite de un máximo de 100 bases de datos por instancia. </font><font style="vertical-align: inherit;">Obviamente, esto puede ser un serio obstáculo para una base de datos diseñada para escalar a más de 100 bases de datos. </font><font style="vertical-align: inherit;">Afortunadamente, después de hablar con nuestro representante técnico de Google, descubrimos que este límite se puede aumentar a casi cualquier valor a través del soporte de Google.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apoyo al desarrollo?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spanner ofrece un soporte bastante decente para que los lenguajes de programación funcionen con su API. </font><font style="vertical-align: inherit;">Las bibliotecas admitidas oficialmente se encuentran en las áreas de C #, Go, Java, node.js, PHP, Python y Ruby. </font><font style="vertical-align: inherit;">La documentación es bastante detallada, pero, al igual que con otras tecnologías avanzadas, la comunidad es bastante pequeña en comparación con las tecnologías de bases de datos más populares, lo que puede conducir a un aumento en el tiempo dedicado a resolver casos o problemas de uso menos comunes.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, ¿qué pasa con el apoyo al desarrollo local?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No encontramos una manera de crear una instancia de Cloud Spanner en el entorno local. </font><font style="vertical-align: inherit;">Lo más parecido que tenemos es la imagen de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CockroachDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Docker </font><font style="vertical-align: inherit;">, que en principio es similar, pero en la práctica es muy diferente. </font><font style="vertical-align: inherit;">Por ejemplo, CockroachDB puede usar PostgreSQL JDBC. </font><font style="vertical-align: inherit;">Dado que el entorno de desarrollo debe ser lo más cercano posible al entorno de trabajo, Cloud Spanner no es ideal, ya que debe confiar en una instancia completa de Spanner. </font><font style="vertical-align: inherit;">Para ahorrar costos, puede elegir una instancia para una región.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Apoyo a la administración?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crear una instancia de Cloud Spanner es fácil. </font><font style="vertical-align: inherit;">Solo necesita elegir entre crear una instancia o región multirregional para una región, especificar las regiones y la cantidad de nodos. </font><font style="vertical-align: inherit;">En menos de un minuto, la instancia estará en funcionamiento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Varias métricas básicas están disponibles directamente en la página de Spanner en la consola de Google. </font><font style="vertical-align: inherit;">Hay vistas más detalladas disponibles a través de Stackdriver, donde también puede establecer métricas de umbral y políticas de alerta.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Acceso a los recursos?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL ofrece permisos de usuario extensos y muy detallados / configuraciones de roles. </font><font style="vertical-align: inherit;">Puede configurar fácilmente el acceso a una tabla específica, o incluso a un subconjunto de sus columnas. </font><font style="vertical-align: inherit;">Cloud Spanner utiliza la herramienta Google Identity &amp; Access Management (IAM), que le permite establecer políticas y permisos solo a un nivel muy alto. </font><font style="vertical-align: inherit;">La opción más detallada es una resolución a nivel de base de datos que no se ajusta a la mayoría de los casos de producción. </font><font style="vertical-align: inherit;">Esta restricción lo obliga a agregar medidas de seguridad adicionales a su código, infraestructura o ambas para evitar el uso no autorizado de los recursos de Spanner.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copias de seguridad?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En términos simples, no hay copias de seguridad en Cloud Spanner. </font><font style="vertical-align: inherit;">Aunque los altos requisitos del SLA de Google pueden garantizar que no perderá ningún dato debido a fallas de hardware o de la base de datos, errores humanos, defectos de la aplicación, etc. Todos conocemos la regla: la alta disponibilidad no reemplaza una estrategia de respaldo razonable. </font><font style="vertical-align: inherit;">Por el momento, la única forma de hacer una copia de seguridad de los datos es transmitirlos mediante programación desde la base de datos a un entorno de almacenamiento separado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta de rendimiento?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos Yahoo! para descargar datos y probar consultas. Benchmark de servicio en la nube. La siguiente tabla muestra la carga de trabajo YCSB B con una relación de lectura del 95% y una relación de escritura del 5%. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vx/po/h4/vxpoh4penig4qvaa5sj1gvflfvm.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* La prueba de carga se realizó en el motor computacional (CE) n1-standard-32 (32 vCPU, 120 GB de memoria), y la instancia de prueba nunca fue un cuello de botella en las pruebas. </font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">** El número máximo de subprocesos en una instancia de YCSB es 400. En total, se tuvieron que ejecutar seis instancias paralelas de pruebas YCSB para obtener un total de 2400 subprocesos.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al observar los resultados de la prueba, en particular la combinación de carga del procesador y TPS, vemos claramente que Cloud Spanner escala bastante bien. </font><font style="vertical-align: inherit;">La gran carga creada por una gran cantidad de subprocesos se compensa con la gran cantidad de nodos en el clúster de Cloud Spanner. </font><font style="vertical-align: inherit;">Aunque el retraso parece bastante alto, especialmente cuando se trabaja con 2400 subprocesos, puede ser necesario volver a probar con 6 instancias más pequeñas del motor computacional para obtener números más precisos. </font><font style="vertical-align: inherit;">Cada instancia ejecutará una prueba YCSB en lugar de una instancia CE grande con 6 pruebas paralelas. </font><font style="vertical-align: inherit;">Por lo tanto, será más fácil distinguir entre los retrasos de solicitud de Cloud Spanner y los retrasos añadidos por la conexión de red entre Cloud Spanner y la instancia CE en la que se ejecuta la prueba.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Cómo maneja Cloud Spanner OLAP?</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Fraccionamiento?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La división de datos en segmentos físicos y / o lógicamente independientes, llamados particiones, es un concepto muy popular inherente a la mayoría de los mecanismos OLAP. Las particiones pueden mejorar significativamente el rendimiento de las consultas y el soporte de la base de datos. Una mayor profundización en la partición aparecería en un artículo (s) por separado, así que solo mencionemos la importancia de tener un esquema de partición y subpartición. La capacidad de particionar datos en particiones y aún más en subparticiones es clave para el desempeño de las consultas analíticas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spanner no admite particiones per se. Divide los datos internamente en la llamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">división</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s basado en rangos de clave primaria. </font><font style="vertical-align: inherit;">La separación se realiza automáticamente para equilibrar la carga en el clúster de Cloud Spanner. </font><font style="vertical-align: inherit;">Una característica muy conveniente de Cloud Spanner es dividir la carga base de la tabla principal (una tabla que no se alterna con otra). </font><font style="vertical-align: inherit;">Spanner determina automáticamente si la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">división</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contiene </font><font style="vertical-align: inherit;">datos que se leen con más frecuencia que los datos de otras </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">divisiones</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y puede decidir una separación adicional. </font><font style="vertical-align: inherit;">Por lo tanto, pueden participar más nodos en la solicitud, lo que también aumenta efectivamente el rendimiento.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Cargando datos?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El método de Cloud Spanner para datos masivos es el mismo que para las descargas regulares. </font><font style="vertical-align: inherit;">Para lograr el máximo rendimiento, debe seguir algunas recomendaciones, que incluyen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ordene sus datos por clave principal.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Divídalos por 10 * el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">número de nodos de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> secciones individuales.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cree un conjunto de tareas de trabajo que carguen datos en paralelo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con esta descarga de datos, se utilizan todos los nodos de Cloud Spanner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos la carga de trabajo A YCSB para generar un conjunto de datos de 10 millones de filas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4n/-o/nj/4n-onjrzn_2nco-hz8o3vnr42d4.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* La prueba de carga se realizó en el motor informático n1-standard-32 (32 vCPU, 120 GB de memoria), y la instancia de prueba nunca fue un cuello de botella en las pruebas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
** No se recomienda una configuración de 1 nodo para ninguna carga de producción.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se mencionó anteriormente, Cloud Spanner procesa automáticamente las divisiones según su carga, por lo que los resultados mejoran después de varias repeticiones sucesivas de la prueba. </font><font style="vertical-align: inherit;">Los resultados presentados aquí son los mejores resultados que hemos recibido. </font><font style="vertical-align: inherit;">Mirando los números anteriores, podemos ver cómo Cloud Spanner se escala (bien) con un aumento en el número de nodos en el clúster. </font><font style="vertical-align: inherit;">Los números que se destacan son retrasos promedio extremadamente bajos que contrastan con los resultados de cargas de trabajo mixtas (95% para lectura y 5% para escritura), como se describe en la sección anterior.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Escalada?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aumentar y disminuir el número de nodos de Cloud Spanner es una tarea de un solo clic. Si desea cargar rápidamente los datos, puede considerar aumentar la instancia al máximo (en nuestro caso, fueron 25 nodos en la región US-EAST), y luego reducir la cantidad de nodos adecuados para su carga regular, después de todos los datos en la base de datos teniendo en cuenta la limitación de 2 TB / nodo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se nos recordó este límite incluso con una base de datos mucho más pequeña. Después de varias ejecuciones de pruebas de carga, nuestra base de datos tenía un tamaño de aproximadamente 155 GB, y cuando se redujo a una instancia de 1 nodo, recibimos el siguiente error: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/_b/ge/bx_bgefdcl_ouf3ldvrdoxglyks.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pudimos reducir la escala de 25 a 2 instancias, pero estábamos atascados en dos nodos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El aumento y la disminución del número de nodos en un clúster de Cloud Spanner se pueden automatizar mediante la API REST. </font><font style="vertical-align: inherit;">Esto puede ser especialmente útil para reducir el aumento de carga en el sistema durante las horas ocupadas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendimiento de la consulta OLAP?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, planeamos dedicar un tiempo considerable a nuestra evaluación de Spanner para esta parte. </font><font style="vertical-align: inherit;">Después de varios RECUENTOS SELECCIONADOS, inmediatamente nos dimos cuenta de que las pruebas serían cortas y que Spanner NO sería un motor OLAP. </font><font style="vertical-align: inherit;">Independientemente del número de nodos en el clúster, una selección simple del número de filas en una tabla de 10 millones de filas tomó de 55 a 60 segundos. </font><font style="vertical-align: inherit;">Además, cualquier solicitud que requirió más memoria para almacenar resultados intermedios falló con un error OOM. </font></font><br>
<br>
<code>SELECT COUNT(DISTINCT(field0)) FROM usertable; — (10M distinct values)-&gt; SpoolingHashAggregateIterator ran out of memory during new row.</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se pueden encontrar algunos números para las solicitudes de TPC-H en el artículo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosql-kudu-spanner-slides.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , diapositivas 42 y 43 de </font><font style="vertical-align: inherit;">Todd Lipcon </font><font style="vertical-align: inherit;">. Estos números son consistentes con nuestros propios resultados (desafortunadamente).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/di/c2/sh/dic2sh_wvmvfus16nhrbftomm1g.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Nuestros hallazgos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado el estado actual de las características de Cloud Spanner, es difícil imaginarlo como un simple reemplazo de una solución OLTP existente, especialmente cuando sus necesidades lo superan. Tendría que dedicar una gran cantidad de tiempo a construir una solución que tenga en cuenta los defectos de Cloud Spanner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando comenzamos a evaluar Cloud Spanner, esperábamos que sus funciones de administración estuvieran al menos o no tan lejos de otras soluciones de Google SQL. Pero nos sorprendió la falta total de copias de seguridad y el control muy limitado del acceso a los recursos. Sin mencionar la falta de vistas, la falta de un entorno de desarrollo local, secuencias no compatibles, JDBC sin compatibilidad con DML y DDL, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ¿a dónde va el que necesita escalar la base de datos transaccional? Parece que no existe una solución única en el mercado que sea adecuada para todos los casos de uso. Hay muchas soluciones de código abierto y cerrado (algunas de las cuales se mencionan en este artículo), cada una de las cuales tiene sus propias fortalezas y debilidades, pero ninguna de ellas ofrece SaaS con un 99.999% de SLA y un alto grado de consistencia. Si su objetivo principal es un SLA alto y no está dispuesto a crear su propia solución para múltiples entornos de nube, Cloud Spanner puede ser la solución que está buscando. Pero debes ser consciente de todas sus limitaciones.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ser justos, debe tenerse en cuenta que Cloud Spanner no se lanzó al público solo en la primavera de 2017, por lo que es razonable esperar que algunas de sus deficiencias actuales eventualmente desaparezcan (espero), y cuando eso suceda, puede cambiar el juego. Después de todo, Cloud Spanner no es solo un proyecto de terceros para Google. Google lo usa como base para otros productos de Google. Y cuando Google reemplazó recientemente a Megastore en Google Cloud Storage con Cloud Spanner, permitió que Google Cloud Storage fuera estrictamente coherente para las listas de objetos a nivel mundial (que todavía no se aplica al </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">S3 </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de Amazon</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">
Entonces, todavía hay esperanza ... esperamos.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo. </font><font style="vertical-align: inherit;">Al igual que el autor del artículo, también seguimos esperando, pero ¿qué opinas sobre esto? </font><font style="vertical-align: inherit;">Escriba los comentarios. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos están invitados a visitar nuestro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seminario web gratuito,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en cuyo marco hablaremos en detalle sobre el </font><font style="vertical-align: inherit;">curso OTUS </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS para desarrolladores</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es489000/index.html">Cómo armar un mitap genial: 16 consejos de tres "mitapers seriales". Eventos de Líder-TI # 1</a></li>
<li><a href="../es489002/index.html">Registro distribuido de juegos de ruedas: experiencia con Hyperledger Fabric</a></li>
<li><a href="../es489004/index.html">Teléfono celular con marcador de disco</a></li>
<li><a href="../es489008/index.html">Enrutamiento en chatbots complejos con el marco Hobot</a></li>
<li><a href="../es489010/index.html">Compartimos la capa de datos más grande de Rusia sobre aprendizaje en línea con proyectos en lingüística, personalización, diseño, ML</a></li>
<li><a href="../es489014/index.html">El libro "Algoritmo perfecto. Algoritmos codiciosos y programación dinámica »</a></li>
<li><a href="../es489016/index.html">German Gref: “Intentamos organizar una discusión sobre el AGI, y no llegó un solo científico respetuoso”</a></li>
<li><a href="../es489020/index.html">El estudio de uno malicioso</a></li>
<li><a href="../es489022/index.html">Usando RabbitMQ con MonsterMQ Parte 2</a></li>
<li><a href="../es489024/index.html">Biblioteca JavaScript de Webix a través de los ojos de un principiante. Parte 5. Trabajar con datos del lado del usuario</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>