<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ½â€ğŸš€ ğŸ˜ ğŸ–±ï¸ Penghitungan Kueri: Pengujian Kinerja Django Dasar âœï¸ ğŸ” ğŸ–¨ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Kami telah menyiapkan terjemahan dari materi lain yang bermanfaat bagi siswa kursus "Pengembang web dengan Python" , yang dimulai kemar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Penghitungan Kueri: Pengujian Kinerja Django Dasar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/490202/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya. </font><font style="vertical-align: inherit;">Kami telah menyiapkan terjemahan dari materi lain yang bermanfaat bagi siswa kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pengembang web dengan Python"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang dimulai kemarin.</font></font><br>
</b></i><br>
<br>
<img src="https://habrastorage.org/webt/-i/l9/rg/-il9rgpfjconn-on4udsprg5vyi.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat sering mendengar tentang metode pengujian seperti TDD, dan cara menguji logika bisnis suatu aplikasi. Namun, menguji kinerja aplikasi adalah tugas yang sama sekali berbeda. Ada banyak cara berbeda, tetapi pendekatan yang paling umum adalah menciptakan lingkungan di mana Anda dapat melakukan serangan DDoS pada aplikasi Anda dan mengamati perilakunya. Ini adalah topik yang sangat menarik, tetapi ini bukan yang ingin saya bicarakan hari ini. Hari ini kita akan melihat tes yang lebih sederhana, yang dapat Anda lakukan menggunakan tes unit Django default: yaitu, menguji berapa kali aplikasi Anda mengakses database.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengujian ini sangat sederhana, dan ini adalah aspek yang dapat melukai kinerja aplikasi pada tahap awal. Aspek ini adalah yang pertama kali diuji ketika sesuatu mulai bekerja lambat. Berita baiknya adalah hanya ada satu hal yang perlu Anda ketahui untuk menulis tes semacam ini: metode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assertNumQueries</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan itu cukup mudah digunakan. Berikut ini sebuah contoh:</font></font><br>
<br>
<pre><code class="django hljs"><span class="xml">from django.test import TestCase, Client
from django.urls import reverse
from trucks.models import Truck

class TrucksTestCase(TestCase):
    def test_list_trucks_view_performance(self):
        client = Client()

        Truck.objects.create(...)

        with self.assertNumQueries(6):
            response = client.get(reverse("trucks:list_trucks"))

        self.assertEqual(response.context["trucks_list"], 1)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode di atas mengklaim bahwa selama tampilan, </font></font><code>"trucks:list_trucks"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplikasi akan mengakses database hanya 6 kali. Tetapi ada sesuatu yang lain, perhatikan bahwa sebelum memulai, pertama-tama kita membuat objek baru </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan setelah itu kita mengatakan bahwa </font></font><code>trucks_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setidaknya ada satu objek </font><font style="vertical-align: inherit;">dalam konteks data tampilan </font><font style="vertical-align: inherit;">. Dalam tes semacam ini, ini penting, karena Anda memerlukan jaminan bahwa Anda tidak menguji pada set data kosong. Penting untuk dipahami bahwa hanya membuat kelas saja </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak cukup. Anda perlu memeriksa apakah sudah dimasukkan dalam konteks. Mungkin Anda memfilter daftar truk, jadi kemungkinan instance Anda </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak akan dimasukkan dalam hasilnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah melakukan semua hal di atas, kami telah membuat kemajuan yang signifikan, tetapi ada langkah penting lain yang mudah dilupakan. Jika kita ingin skala pandangan kita, kita harus memastikan bahwa kinerja tidak menurun ketika jumlah item yang dikembalikan tumbuh. Pada akhirnya, kami masih memiliki masalah kinerja jika kami beralih ke database bukan 6 kali untuk mendapatkan satu item, tetapi 106 jika kami memiliki 100 item. Kami membutuhkan jumlah panggilan database yang konstan, yang tidak akan bergantung pada jumlah item yang dikembalikan. Untungnya, masalah ini juga diselesaikan dengan sangat sederhana, kita perlu menambahkan satu (atau beberapa) elemen lagi ke dalam basis data dan menghitung lagi jumlah hit. Ini adalah bagaimana tes akan terlihat di versi final:</font></font><br>
<br>
<pre><code class="django hljs"><span class="xml">from django.test import TestCase, Client
from django.urls import reverse
from trucks.models import Truck

class TrucksTestCase(TestCase):
    def test_list_trucks_view_performance(self):
        client = Client()

        Truck.objects.create(...)

        with self.assertNumQueries(6):
            response = client.get(reverse("trucks:list_trucks"))

        self.assertEqual(response.context["trucks_list"], 1)

        Truck.objects.create(...)

        with self.assertNumQueries(6):
            response = client.get(reverse("trucks:list_trucks"))

        self.assertEqual(response.context["trucks_list"], 2)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan bahwa kami kembali memeriksa jumlah item yang dikembalikan dalam konteks, tetapi pada putaran kedua kami mengharapkan 2 truk ( </font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Alasan untuk perilaku ini mirip dengan kasus pertama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memastikan jumlah panggilan konstan ke basis data saat menambahkan data baru lebih prioritas daripada memastikan sejumlah kecil panggilan secara umum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal terakhir yang harus dilakukan adalah memastikan bahwa data Anda terhidrasi mungkin. </font><font style="vertical-align: inherit;">Ini berarti bahwa Anda perlu membuat data terkait yang akan digunakan selama pemrosesan tampilan Anda. </font><font style="vertical-align: inherit;">Jika tidak, ada risiko bahwa aplikasi Anda akan mengakses database lebih sering dalam produksi daripada dalam pengujian (meskipun mungkin berhasil). </font><font style="vertical-align: inherit;">Dalam contoh kita, kita perlu membuat </font></font><code>TruckDriver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perusahaan untuk kita</font></font><code>Truck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="django hljs"><span class="xml">from trucks.models import Truck, TruckDriver
...
        truck = Truck.objects.create(...)
        TruckDriver.objects.create(name="Alex", truck=truck)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika jumlah panggilan basis data tidak lagi konstan setelah melakukan langkah-langkah yang dijelaskan di atas, maka cari informasi lebih lanjut tentang metode </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select_related</font></font></a> </i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prefetch_related</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja untuk hari ini, saya harap mulai saat ini Anda akan mulai memeriksa jumlah permintaan aplikasi Anda untuk database pada awal proyek. </font><font style="vertical-align: inherit;">Ini tidak akan memakan banyak waktu, tetapi akan mencegah masalah yang mungkin timbul dengan peningkatan jumlah pengguna aplikasi Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ngomong-ngomong, Anda masih bisa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengikuti kursus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sampai jumpa.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id490186/index.html">Dari mana kami membuat JET BI. Arsitektur Sistem Kecerdasan Bisnis tanpa penyimpangan lirik</a></li>
<li><a href="../id490190/index.html">Saya akan mencari: host geo-positioning dengan alamat IP di Internet global menggunakan pertukaran Binance crypto sebagai contoh</a></li>
<li><a href="../id490194/index.html">Menggunakan RabbitMQ dengan MonsterMQ Bagian 4</a></li>
<li><a href="../id490196/index.html">[Flipper Zero] menolak Raspberry Pi, buat papan sendiri dari awal. Menemukan chip WiFi yang tepat</a></li>
<li><a href="../id490198/index.html">Percaya tapi verifikasi! Zona demo dengan proyektor Epson untuk home theatre di aula demo Pult.ru</a></li>
<li><a href="../id490204/index.html">Intisari acara untuk perekrut SDM dan TI pada bulan Maret 2020</a></li>
<li><a href="../id490208/index.html">Bagian Backend pada DUMP2020: olok-olok, kipas, gagal</a></li>
<li><a href="../id490210/index.html">Mempercepat frontend. Ketika banyak permintaan server bagus</a></li>
<li><a href="../id490222/index.html">Perpustakaan Standar Hari Kematian</a></li>
<li><a href="../id490224/index.html">Siluman yang modis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>