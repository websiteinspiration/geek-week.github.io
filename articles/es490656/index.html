<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏 👨🏼‍🏫 🚕 Tareas externas de Camunda: una herramienta poderosa para crear aplicaciones con una arquitectura resistente y escalable 🤘🏼 🌯 👨🏻‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En Tinkoff, utilizamos el marco Camunda + Spring para desarrollar sistemas de automatización de procesos comerciales . Describimos los procesos empres...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tareas externas de Camunda: una herramienta poderosa para crear aplicaciones con una arquitectura resistente y escalable</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/490656/"><img src="https://habrastorage.org/webt/sw/nv/az/swnvaz2_ifbzirrprmoucnx0zli.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Tinkoff, utilizamos el marco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda + Spring</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para desarrollar sistemas de automatización de procesos comerciales </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Describimos los procesos empresariales utilizando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BPMN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (notación de gestión de procesos empresariales) en forma de diagramas de flujo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El elemento más utilizado en nuestros diagramas son </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las tareas de servicio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (rectángulo de engranaje). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> admite dos formas de realizar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tareas de servicio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando una llamada síncrona a código java.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear una tarea externa.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo método le permite realizar tareas utilizando sistemas externos, por ejemplo, si necesita llamar a una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicación de camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desde otra o incluso delegar el trabajo a cualquier sistema externo.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/27/tm/sd/27tmsdtlkpfvti2vcgdvjl8xcqk.png" alt="imagen"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de diagrama BPMN</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esto es útil cuando tiene la intención de reutilizar la lógica en múltiples aplicaciones. </font><font style="vertical-align: inherit;">O cuando quiere apegarse a la arquitectura de microservicios. </font><font style="vertical-align: inherit;">Por ejemplo, separando los servicios que se ocupan de los procesos comerciales de los servicios que implementan tareas técnicas, como la generación de informes o el envío de correos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Junto con esta característica, una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proporciona una arquitectura escalable y resistente. </font><font style="vertical-align: inherit;">Para comprender por qué sucede esto, primero debe comprender cómo funciona la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los </font><font style="vertical-align: inherit;">niveles </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BPMN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y de aplicación.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea externa en BPMN</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tarea externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implica la creación de una tarea que puede realizar un controlador externo. </font><font style="vertical-align: inherit;">La esencia del patrón de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tareas externas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es que:</font></font><br>
<br>
<ol>
<li>,  «»  ,      «».</li>
<li>     <b>camunda</b>   ,       ,       .</li>
<li>     <b>camunda</b>   (/).</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el diagrama anterior, describí un proceso ficticio en el que queremos obtener una lista de usuarios, enviarles un anuncio y después de 2 horas calcular el número de aplicaciones después del boletín de marketing. </font><font style="vertical-align: inherit;">Y, si hay más de 10 aplicaciones, aumente la selección para el próximo envío. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiero que mi aplicación </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda sea</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> responsable solo de los procesos comerciales, y cualquier otra aplicación </font><b><font style="vertical-align: inherit;">debería ser</font></b><font style="vertical-align: inherit;"> responsable del correo electrónico. </font><font style="vertical-align: inherit;">En este caso, el patrón de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tareas externas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> funciona bien para mí </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En mi proceso, simplemente crearé una tarea de boletín electrónico y esperaré a que algún controlador externo la complete. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para crear una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el diagrama </font><font style="vertical-align: inherit;">, debe:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crea una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regular </font><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cambie su tipo a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea de servicio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establezca la implementación en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especifique el valor del campo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tema</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/qk/sf/0p/qksf0pz_6lglnp8_xu42jxphsmg.png" alt="imagen"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tema</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el nombre de la cola en la que se agregarán tareas de un tipo y a las que se suscribirá un controlador externo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que hay una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el proceso </font><font style="vertical-align: inherit;">, puede iniciarla, pero no se ejecutará, ya que nadie la está procesando.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajador externo de tareas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El patrón de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tareas externas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es bueno, ya que le permite implementar el procesamiento de tareas en cualquier idioma, utilizando cualquier herramienta que pueda realizar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicitudes HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un ejemplo del blog de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El ejemplo implementa un controlador de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> externo </font><font style="vertical-align: inherit;">que, cada 20 segundos, solicita una </font><font style="vertical-align: inherit;">lista de tareas de procesamiento </font><font style="vertical-align: inherit;">de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si hay tareas, las envía y notifica a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre la finalización de la tarea.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">'http://localhost:8080/my-app/rest'</span>;
<span class="hljs-keyword">const</span> workerSettings = {
 <span class="hljs-attr">workerId</span>: <span class="hljs-string">'worker01'</span>, <span class="hljs-comment">// some unique name for the current worker instance</span>
 <span class="hljs-attr">maxTasks</span>: <span class="hljs-number">5</span>,
 <span class="hljs-attr">topics</span>: [<font></font>
   {<font></font>
     <span class="hljs-attr">topicName</span>: <span class="hljs-string">'sendEmail'</span>,
     <span class="hljs-attr">lockDuration</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// How much time the worker thinks he needs to process the task</span>
     <span class="hljs-attr">variables</span>: [<span class="hljs-string">'video'</span>] <span class="hljs-comment">// Which variables should be returned in the response (to avoid additional REST calls to read data)</span><font></font>
   }]};<font></font>
<span class="hljs-keyword">const</span> requestParams = {<span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">headers</span>: {<span class="hljs-attr">contentType</span>: <span class="hljs-string">'application/json'</span>}};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pollExternalTasks</span>(<span class="hljs-params"></span>) </span>{
 <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/external-task/fetchAndLock`</span>, {<font></font>
   ...requestParams,<font></font>
   <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(workerSettings)<font></font>
 })<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processExternalTask</span>(<span class="hljs-params">result = []</span>) </span>{
 <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(result.map(<span class="hljs-function"><span class="hljs-params">externalTask</span> =&gt;</span> {<font></font>
   sendEmail(externalTask); <span class="hljs-comment">// Here the actual work would be done</span><font></font>
<font></font>
   <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/external-task/<span class="hljs-subst">${externalTask.id}</span>/complete`</span>, {<font></font>
     ...requestParams,<font></font>
     <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({<span class="hljs-attr">workerId</span>: workerSettings.workerId}),<font></font>
   })<font></font>
 }));<font></font>
}<font></font>
<font></font>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
 pollExternalTasks().then(processExternalTask)<font></font>
}, <span class="hljs-number">20000</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver en el código anterior, los métodos clave para manejar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tareas externas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetchAndLock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">complete</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">El primer método solicita una lista de tareas y asegura su implementación, y el segundo informa sobre la finalización de la tarea. </font><font style="vertical-align: inherit;">Además de estos dos métodos, existen otros, puede leer sobre ellos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la documentación oficial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliente de tareas externas de Camunda</font></font></h2><br>
<img src="https://habrastorage.org/webt/sf/td/-g/sftd-gp7palq7dtzvgvpjqyj2y0.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> procesamiento de </font><b><font style="vertical-align: inherit;">tareas externas</font></b><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">camunda</font></b><font style="vertical-align: inherit;"> proporcionó clientes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javascript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le permiten crear manejadores de tareas externos en solo unas pocas líneas. </font><font style="vertical-align: inherit;">También hay una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guía detallada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que describe los principios básicos del procesamiento de tareas externas, nuevamente con ejemplos en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javascript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ejemplo de implementación de un controlador externo usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExternalTaskClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String... args)</span> </span>{
       <span class="hljs-comment">// bootstrap the client</span><font></font>
       ExternalTaskClient client = ExternalTaskClient.create()<font></font>
           .baseUrl(<span class="hljs-string">"http://localhost:8080/engine-rest"</span>)<font></font>
           .asyncResponseTimeout(<span class="hljs-number">1000</span>)<font></font>
           .build();<font></font>
<font></font>
       <span class="hljs-comment">// subscribe to the topic</span>
       client.subscribe(<span class="hljs-string">"sendEmail"</span>).handler((externalTask, externalTaskService) -&gt; {
           <span class="hljs-keyword">try</span> {<font></font>
               String result = sendEmail(externalTask)<font></font>
               Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
               variables.put(<span class="hljs-string">"result"</span>, result);<font></font>
               externalTaskService.complete(externalTask, variables);<font></font>
               System.out.println(<span class="hljs-string">"The External Task "</span> + externalTask.getId() + <span class="hljs-string">" has been completed!"</span>);<font></font>
           } <span class="hljs-keyword">catch</span> (e: Exception) {<font></font>
               externalTaskService.handleFailure(externalTask, e.message, e.stackTrace.toString())<font></font>
           }<font></font>
       }).open();<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si su tarea requiere no solo realizar alguna acción sincrónica, sino iniciar todo el proceso, puede hacerlo, por ejemplo, iniciando el proceso a través de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RuntimeService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailWorker</span></span>(
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> runtimeService: RuntimeService<font></font>
) {<font></font>
   <span class="hljs-keyword">val</span> builder = ExternalTaskClientBuilderImpl().baseUrl(<span class="hljs-string">"http://localhost:8080"</span>).workerId(<span class="hljs-string">"myWorker"</span>)
   <span class="hljs-keyword">val</span> taskClient = builder.build()
   <span class="hljs-keyword">val</span> engineClient = (builder <span class="hljs-keyword">as</span> ExternalTaskClientBuilderImpl).engineClient<font></font>
<font></font>
   <span class="hljs-meta">@PostConstruct</span>
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
       taskClient<font></font>
           .subscribe(<span class="hljs-string">"sendEmail"</span>)<font></font>
           .lockDuration(<span class="hljs-number">10000</span>)<font></font>
           .handler { externalTask, externalService -&gt;<font></font>
               runtimeService.startProcessInstanceByKey(<font></font>
                   <span class="hljs-string">"SendEmailProcess"</span>,<font></font>
                   externalTask.getVariable(<span class="hljs-string">"emailId"</span>),<font></font>
                   mapOf(<font></font>
                       <span class="hljs-string">"text"</span> to externalTask.getVariable(<span class="hljs-string">"text"</span>),
                       <span class="hljs-string">"email"</span> to externalTask.getVariable(<span class="hljs-string">"email"</span>)<font></font>
                   )<font></font>
               )<font></font>
           }<font></font>
           .<span class="hljs-keyword">open</span>()<font></font>
   }<font></font>
<font></font>
<font></font>
   <span class="hljs-meta">@PreDestroy</span>
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span> {<font></font>
       taskClient.stop()<font></font>
   }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Delegate from SendEmailProcess process</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailResultDelegate</span></span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> emailWorker: EmailWorker) {
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doExecute</span><span class="hljs-params">(execution: <span class="hljs-type">DelegateExecution</span>)</span></span> {<font></font>
       emailWorker.engineClient.complete(<font></font>
           execution.readVar(EXTERNAL_TASK_ID),<font></font>
           mapOf(<span class="hljs-string">"result"</span> to <span class="hljs-string">"Success"</span>)<font></font>
       )<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, el manejador de tareas externas ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailWorker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), cuando se recibe la tarea, inicia el proceso </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SendEmailProcess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine que este proceso realiza algunas acciones necesarias para enviar un boletín informativo y al final llama a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailResultDelegate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que, a su vez, completa la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarea externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beneficios arquitectónicos de la tarea externa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena señalar que hay una manera de iniciar el proceso en otra aplicación </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una manera más simple: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST: / rest / process-definition / key / $ {id} / start</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cuando usa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , no tiene ninguna garantía de transacción. Pero después de todo, </font><font style="vertical-align: inherit;">también trabajamos </font><font style="vertical-align: inherit;">con </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tareas externas a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> través de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ¿cuál es la diferencia entonces? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diferencia es que no llamamos al servicio externo directamente, sino que solo publicamos tareas que pueden procesarse. Considere un ejemplo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/-3/iv/cv-3ivsxpit3o3q8zosyi1e9jkw.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
algún controlador externo toma una tarea que ahora se le asigna, pero cuando se recibe una respuesta, la conexión se desconecta. Ahora del lado de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una tarea que no se procesará se bloquea porque el controlador externo no recibió una respuesta. Pero esto no da miedo: en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tareas externas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hay un tiempo de espera por el cual la tarea volverá a la cola nuevamente y alguien más puede manejarla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos el caso en que un controlador externo recibió una tarea, la completó y llamó al método </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">completo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que falló debido a problemas de red. Ahora no podrá comprender si la tarea se completó con éxito en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o no. Puede intentarlo nuevamente, pero existe la posibilidad de que los problemas de red continúen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, la mejor solución sería ignorar el problema. Si la tarea se completó con éxito, entonces todo está en orden. De lo contrario, después del tiempo de espera, la tarea volverá a estar disponible para su procesamiento. Pero esto significa que su controlador externo debe ser idempotente o contener lógica para deduplicar tareas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ocurrir un problema similar al iniciar un nuevo proceso, por lo que debe verificar las instancias existentes con los mismos datos, por ejemplo, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">businessKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además de </font><b><font style="vertical-align: inherit;">la tarea externa de</font></b><font style="vertical-align: inherit;"> alta tolerancia a fallas</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le permite escalar fácilmente controladores externos e implementarlos en cualquier lenguaje de programación. </font><font style="vertical-align: inherit;">Al mismo tiempo, el patrón ayuda a implementar microservicios para que se influyan mutuamente lo menos posible, lo que aumenta su estabilidad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Más sobre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la tarea externa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/user-guide/process-engine/external-tasks/ </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/reference/rest/external -task / </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/user-guide/ext-client/</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es490644/index.html">Repositorio rpm simple usando Inotify y webdav</a></li>
<li><a href="../es490648/index.html">Usando Kata Containers en Kubernetes</a></li>
<li><a href="../es490650/index.html">Los principales errores al compilar un CV por parte de especialistas en TI para principiantes</a></li>
<li><a href="../es490652/index.html">Logística. Introducción Casi complicado</a></li>
<li><a href="../es490654/index.html">Puntos sobre los sensores de gas de la serie MQ: comprensión profunda de la hoja de datos y la optimización</a></li>
<li><a href="../es490660/index.html">¿Cómo aseguramos el crecimiento de CityMobile?</a></li>
<li><a href="../es490664/index.html">PHP: array_key_exists busca 500 veces más rápido que in_array</a></li>
<li><a href="../es490668/index.html">La historia de la transformación de producto a proyecto y viceversa (utilizando el ejemplo de la bondad en la región de Moscú)</a></li>
<li><a href="../es490670/index.html">Cómo hacer que un auto escriba pruebas del código para usted</a></li>
<li><a href="../es490674/index.html">Habr Wickley # 41 / Más autos autónomos, prof. Fortran, Yandex, el dolor del robot, cómo bloquear el sitio de un competidor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>