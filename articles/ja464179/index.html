<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗨️ 🐯 🧜 Yandex.Taxiの1つのスタンドアップ、またはバックエンド開発者に教えるために必要なもの 👨‍👩‍👧‍👦 👩🏿‍🎨 ⛹️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私の名前はOleg Ermakovです。私はYandex.Taxiアプリケーションのバックエンド開発チームで働いています。私たちは、日中のスタンドアップを行うのが習慣です。これがどのように起こるかです... 
 
 従業員の名前は変更できますが、タスクはかなり現実的です！
 
 12:45に、チーム...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Yandex.Taxiの1つのスタンドアップ、またはバックエンド開発者に教えるために必要なもの</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/464179/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の名前はOleg Ermakovです。私はYandex.Taxiアプリケーションのバックエンド開発チームで働いています。</font><font style="vertical-align: inherit;">私たちは、日中のスタンドアップを行うのが習慣です。</font><font style="vertical-align: inherit;">これがどのように起こるかです... </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従業員の名前は変更できますが、タスクはかなり現実的です！</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12:45に、チーム全体が会議室に集まります。</font><font style="vertical-align: inherit;">最初の言葉は、研修生の開発者であるIvanが取っています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イワン：</font></font></h3><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は、既知の旅費で乗客が運転手に与えることができる金額のすべての可能なオプションを表示するタスクに取り組みました。</font><font style="vertical-align: inherit;">タスクは非常によく知られています-「コイン交換」と呼ばれています。</font><font style="vertical-align: inherit;">詳細を考慮して、アルゴリズムにいくつかの最適化を追加しました。</font><font style="vertical-align: inherit;">昨日はプールの見直しをお願いしましたが、それ以来コメントを修正しています。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンナの満足した笑顔で、イヴァンが誰の発言を訂正するかが明らかになった。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/ti/f9/zh/tif9zheucthxzkd8q4j8ns9fo1y.png"><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、彼はアルゴリズムの最小分解を行い、紙幣を受け取るように固定されていました。</font><font style="vertical-align: inherit;">最初の実装では、可能な紙幣がコードに登録されていたため、国ごとに構成に取り出されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将来のコメントを追加しました。これにより、読者はアルゴリズムをすばやく理解できます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> exception <span class="hljs-keyword">in</span> self.exceptions[banknote]:<font></font>
    exc_value = value + exception.delta<font></font>
    <span class="hljs-keyword">if</span> exc_value - cost &gt;= banknote:
        <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> exc_value &gt; cost &gt;= exception.banknote:<font></font>
        banknote_results.append(exc_value)<font></font>
<font></font>
<span class="hljs-comment">#      </span>
<span class="hljs-keyword">for</span> exception <span class="hljs-keyword">in</span> self.exceptions[banknote]:
    <span class="hljs-comment">#         </span>
    <span class="hljs-comment">#   </span><font></font>
    exc_value = value + exception.delta<font></font>
    <span class="hljs-comment">#          </span>
    <span class="hljs-comment"># (corner case)</span>
    <span class="hljs-keyword">if</span> exc_value - cost &gt;= banknote:
        <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> exc_value &gt; cost &gt;= exception.banknote:<font></font>
        banknote_results.append(exc_value)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、残りの時間をコード全体をテストでカバーすることに費やしました。</font></font><br>
<br>
<pre><code class="python hljs">RUB = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">500</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">5000</span>]<font></font>
CUSTOM_BANKNOTES = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>]<font></font>
<font></font>
<span class="hljs-meta">@pytest.mark.parametrize(</span>
    <span class="hljs-string">'cost, banknotes, expected_changes'</span>,<font></font>
    [<font></font>
        <span class="hljs-comment"># no banknotes</span><font></font>
        (<font></font>
            <span class="hljs-number">321</span>, [], [],<font></font>
        ),<font></font>
        <span class="hljs-comment"># zero cost</span><font></font>
        (<font></font>
            <span class="hljs-number">0</span>, RUB, [],<font></font>
        ),<font></font>
        <span class="hljs-comment"># negative cost</span><font></font>
        (<font></font>
            <span class="hljs-number">-13</span>, RUB, [],<font></font>
        ),<font></font>
        <span class="hljs-comment"># simple testcase</span><font></font>
        (<font></font>
            <span class="hljs-number">264</span>, RUB, [<span class="hljs-number">265</span>, <span class="hljs-number">270</span>, <span class="hljs-number">300</span>, <span class="hljs-number">400</span>, <span class="hljs-number">500</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">5000</span>],<font></font>
        ),<font></font>
        <span class="hljs-comment"># cost bigger than max banknote</span><font></font>
        (<font></font>
            <span class="hljs-number">6120</span>, RUB, [<span class="hljs-number">6121</span>, <span class="hljs-number">6150</span>, <span class="hljs-number">6200</span>, <span class="hljs-number">6300</span>, <span class="hljs-number">6500</span>, <span class="hljs-number">7000</span>, <span class="hljs-number">8000</span>, <span class="hljs-number">10000</span>],<font></font>
        ),<font></font>
        <span class="hljs-comment"># min cost</span><font></font>
        (<font></font>
            <span class="hljs-number">1</span>, RUB, [<span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">500</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">5000</span>],<font></font>
        ),<font></font>
        ...<font></font>
    ],<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの各ビルド中に実行される通常のテストに加えて、最適化なしのアルゴリズムを使用するテストを作成しました（検討-徹底的な検索）。</font><font style="vertical-align: inherit;">最初の1万件からの請求ごとのこのアルゴリズムの結果はファイルに入れられ、最適化されたアルゴリズムで個別に実行され、実際に正しく機能することが確認されています。</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタンドアップから少し離れて、イヴァンが言うすべてのローカルな結果を要約しましょう。</font><font style="vertical-align: inherit;">コードを書くときの主な目標は、そのパフォーマンスを保証することです。</font><font style="vertical-align: inherit;">この目標を達成するには、次のタスクを完了する必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビジネスロジックをアトミックフラグメントに分解します。</font><font style="vertical-align: inherit;">1つの関数で記述されたコードのキャンバスを表示すると、読みやすさが複雑になります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードの「特に複雑な」部分にコメントを追加します。</font><font style="vertical-align: inherit;">私たちのチームには次のアプローチがあります。コードレビューで実装について質問された場合（アルゴリズムの説明を求められた場合）、コメントを追加する必要があります。</font><font style="vertical-align: inherit;">さらに良いのは、事前に考えて、自分で追加することです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アルゴリズム実行の主要なブランチをカバーするテストを記述します。</font><font style="vertical-align: inherit;">テストは、コードの状態を検証するための方法だけではありません。</font><font style="vertical-align: inherit;">それらはまだあなたのモジュールを使用する例として機能します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悲しいかな、長年の経験を持つ専門家でさえ、常にこれらのアプローチを仕事で使用しているわけではありません。</font><font style="vertical-align: inherit;">で、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックエンドの開発学校</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちが今やっていることを、生徒たちは、アーキテクチャ、高品質なコードを書くことで実践的なスキルを習得します。</font><font style="vertical-align: inherit;">私たちの他の目標は、プロジェクトのテストカバレッジプラクティスを普及させることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、スタンドアップに戻ります。</font><font style="vertical-align: inherit;">イヴァンの後で、アンナが話します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンナ：</font></font></h3><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロモーション画像を返すためのマイクロサービスを開発しています。</font><font style="vertical-align: inherit;">ご存じのように、サービスは最初に静的なデータスタブを提供しました。</font><font style="vertical-align: inherit;">次に、テスターがそれらをカスタマイズするように要求し、私はそれらを構成に入れました。そして今、私はデータベース（PostgreSQL 10.9）からデータを返すという「正直な」実装を行っています。</font><font style="vertical-align: inherit;">ビジネスロジックでデータを受信するためのインターフェースが変更されず、新しいソース（構成、データベース、外部マイクロサービスのいずれであっても）は独自のロジックのみを実装するフレームワークで、元々敷設された分解は非常に役立ちました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dj/jx/r1/djjxr1chqi4vlvevwvpe6nhtow0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
負荷がかかった状態で書かれたシステムをチェックしたところ、データベースにアクセスすると、テストによってハンドルが急激にブレーキングし始めることがわかりました。</font><font style="vertical-align: inherit;">説明によると、インデックスは使用されていません。</font><font style="vertical-align: inherit;">私がそれを修正する方法を理解するまで。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヴァディム：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、どのような要求ですか？</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーニャ：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORでの2つの条件：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> table_1
         <span class="hljs-keyword">JOIN</span> table_2 <span class="hljs-keyword">ON</span> table_1.some_id = table_2.some_id
<span class="hljs-keyword">WHERE</span> (table_2.attr1 = <span class="hljs-string">'val'</span> <span class="hljs-keyword">OR</span> table_1.attr2 <span class="hljs-keyword">IN</span> (<span class="hljs-string">'val1'</span>, <span class="hljs-string">'val2'</span>))
  <span class="hljs-keyword">AND</span> table_1.deleted_at <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
  <span class="hljs-keyword">AND</span> table_2.deleted_at <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> table_2.created_at </code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クエリの説明では、table_2のattr1属性とtable_1のattr2のいずれのインデックスも使用していないことが示されました。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヴァディム：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQLで同様の動作に直面すると、問題は正確にORの条件にあります。そのため、attr2のように、1つのインデックスのみが使用されます。</font><font style="vertical-align: inherit;">そして、2番目の条件はseqスキャンを使用します-テーブルのフルパス。</font><font style="vertical-align: inherit;">リクエストは2つの独立したリクエストに分割できます。</font><font style="vertical-align: inherit;">オプションとして、バックエンド側でクエリ結果を分割してフリーズします。</font><font style="vertical-align: inherit;">ただし、これらの2つの要求をトランザクションでラップするか、UNIONと組み合わせることを検討する必要があります。</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> table_1
         <span class="hljs-keyword">JOIN</span> table_2 <span class="hljs-keyword">ON</span> table_1.some_id = table_2.some_id
<span class="hljs-keyword">WHERE</span> (table_2.attr1 = <span class="hljs-string">'val'</span>)
  <span class="hljs-keyword">AND</span> table_1.deleted_at <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
  <span class="hljs-keyword">AND</span> table_2.deleted_at <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> table_2.created_at <font></font>
<font></font>
<span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> table_1 <span class="hljs-keyword">JOIN</span> table_2
<span class="hljs-keyword">ON</span> table_1.some_id = table_2.some_id
<span class="hljs-keyword">WHERE</span> (table_1.attr2 <span class="hljs-keyword">IN</span> (<span class="hljs-string">'val1'</span>
    , <span class="hljs-string">'val2'</span>)) <span class="hljs-keyword">AND</span> table_1.deleted_at <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">AND</span> table_2.deleted_at <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> table_2.created_at</code></pre></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーニャ：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よろしくお願いします^ _ ^</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度要約すると：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほとんどすべての製品開発タスクは、外部ソース（サービスまたはデータベース）からのレコードの取得に関連しています。</font><font style="vertical-align: inherit;">データをアンロードするクラスの分解の問題に注意深く取り組む必要があります。</font><font style="vertical-align: inherit;">適切に設計されたクラスを使用すると、テストを作成してデータソースを問題なく変更できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースを効果的に使用するには、クエリ実行の機能を理解する必要があります。たとえば、説明を理解する必要があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
情報の操作とデータフローの整理は、バックエンド開発者のタスクの不可欠な部分です。</font><font style="vertical-align: inherit;">学校では、サービス（およびデータソース）の相互作用のアーキテクチャを紹介します。</font><font style="vertical-align: inherit;">学生は、データベースの操作をアーキテクチャ上および操作の面で学習し​​ます-データの移行とテスト。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に話すのはヴァディムです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヴァディム：</font></font></h3><blockquote>   ,   .          :       ,       . <br>
<br>
<i>      —        </i>.<br>
<br>
        request_id,        :<br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   request_id</span><font></font>
logger.info(<font></font>
    <span class="hljs-string">'my log msg'</span>, <font></font>
)<font></font>
<font></font>
<span class="hljs-comment">#   request_id</span><font></font>
logger.info(<font></font>
    <span class="hljs-string">'my log msg'</span>, <font></font>
    extra=log_extra,  <span class="hljs-comment">#   request_id —    </span>
)</code></pre><br>
log_extra —     ,        .   log_extra           ,       request_id. <br>
<br>
    ,        .      .     ,         log_extra.<br>
<br>
       :<br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle</span>(<span class="hljs-params">self, request, handler</span>):</span>
    log_extra = request[<span class="hljs-string">'log_extra'</span>]<font></font>
    log_extra_manager.set_log_extra(log_extra)<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> handler(request)</code></pre><br>
  ,    log_extra    .    .  —  task_factory  eventloop  asyncio:<br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogExtraManager</span>:</span><font></font>
    __init__(self, context: Any,<font></font>
                  settings: typing.Optional[Dict[str, dict]],<font></font>
                  activations_parameters: list) -&gt; <span class="hljs-literal">None</span>:<font></font>
    loop = asyncio.get_event_loop()<font></font>
    task_factory = loop.get_task_factory()<font></font>
    <span class="hljs-keyword">if</span> task_factory <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
        task_factory = _default_task_factory<font></font>
    <font></font>
<span class="hljs-meta">    @functools.wraps(task_factory)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log_extrad_factory</span>(<span class="hljs-params">ev_loop, coro</span>):</span><font></font>
        child_task = task_factory(ev_loop, coro)<font></font>
        parent_task = asyncio.Task.current_task(loop=ev_loop)<font></font>
        log_extra = getattr(parent_task, LOG_EXTRA_CONTEXT_KEY, <span class="hljs-literal">None</span>)<font></font>
        setattr(child_task, LOG_EXTRA_CONTEXT_KEY, log_extra)<font></font>
        <span class="hljs-keyword">return</span> child_task<font></font>
    <font></font>
    <span class="hljs-comment"># updating loop, so any created task will</span>
    <span class="hljs-comment"># get the log_extra of its parent</span><font></font>
    loop.set_task_factory(log_extrad_factory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_log_extra</span>(<span class="hljs-params">log_extra: dict</span>):</span><font></font>
         loop = asyncio.get_event_loop()<font></font>
         task = asyncio.Task.current_task(loop=loop)<font></font>
         setattr(task, LOG_EXTRA_CONTEXT_KEY, log_extra)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のオプションは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contextvars</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用するために、インフラストラクチャコマンドを通じてPython 3.7への移行を「プッシュ」すること</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">です</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">log_extra_var = contextvars.ContextVar(LOG_EXTRA_CONTEXT_KEY)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogExtraManager</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_log_extra</span>(<span class="hljs-params">log_extra: dict</span>):</span>
         log_extra_var.set(log_extra)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、ロガーのlog_extraのコンテキストに格納して転送する必要がありました。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogExtraFactory</span>(<span class="hljs-params">logging.LogRecord</span>):</span>
    <span class="hljs-comment"># this class allows to create log rows with log_extra in the record</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        super().__init__(*args, **kwargs)<font></font>
        task = asyncio.Task.current_task()<font></font>
        log_extra = getattr(task, LOG_EXTRA_CONTEXT_KEY, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> log_extra:
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> log_extra:<font></font>
            self.__dict__[key] = log_extra[key]<font></font>
<font></font>
logging.setLogRecordFactory(LogExtraFactory)</code></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
概要：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Taxi（およびYandexのあらゆる場所）では、asyncioが積極的に使用されています。</font><font style="vertical-align: inherit;">それを使用できるようにするだけでなく、その内部構造を理解することも重要です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">言語のすべての新しいバージョンの変更ログを読む習慣を身に付け、イノベーションの助けを借りて、自分と同僚の生活をより簡単にする方法について考えてください。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準ライブラリを使用する場合は、ソースコードをクロールしてデバイスを理解することを恐れないでください。</font><font style="vertical-align: inherit;">これは非常に便利なスキルであり、モジュールの操作をよりよく理解し、機能の実装に新しい可能性を開くことができます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックエンドスクール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の教師</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">は、</font></a><font style="vertical-align: inherit;"> 1 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ポンド</font></a><font style="vertical-align: inherit;">以上</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">の</font></a><font style="vertical-align: inherit;">塩を食べ、サービスの非同期操作で多くのコーンを満たしました。</font><font style="vertical-align: inherit;">彼らは、実用的なレベルとパッケージ内部の分析の両方で、Pythonの非同期操作の機能について学生に説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本とリンク</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonを学ぶことはあなたを助けることができます：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3冊の本：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python Cookbook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diving Into Python 3、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python Tricks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raymond HettingerやDavid BeasleyなどのIT業界の柱によるビデオ講義。</font><font style="vertical-align: inherit;">最初のビデオ講義から、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Beyond PEP 8-わかりやすい美しいコードのベストプラクティス」</font><font style="vertical-align: inherit;">を区別できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Beasley </font><font style="vertical-align: inherit;">は、asyncioに関する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を監視</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">ことをお</font><font style="vertical-align: inherit;">勧めし</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アーキテクチャをより高度に理解するには、以下の本を読んでください。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">« »</a>.        ( ,    , , ,   . .).</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">«.    »</a>.        ,    ,          .       ,       .             .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自分で無限に成長できる最も重要なスキルのもう1つは、他の誰かのコードを読むことです。</font><font style="vertical-align: inherit;">誰か他の人のコードをめったに読まないことに突然気付いた場合は、新しい人気のある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を定期的に監視する習慣を身に付けることをお勧めし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタンドアップは終わり、全員が仕事に行きました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464165/index.html">Habr Weekly＃14 /グループチャット、独占、危険な情報からの子供たちの保護におけるコミュニケーションのルールについて</a></li>
<li><a href="../ja464169/index.html">議論：最後まで読んだ後、GCがどのようにそしてなぜ正確に機能するかを理解する</a></li>
<li><a href="../ja464171/index.html">ソフトウェア更新セキュリティ</a></li>
<li><a href="../ja464173/index.html">「くすんだギャレー」、またはオフィスの喧噪から足が伸びる場所</a></li>
<li><a href="../ja464177/index.html">本「コトリン。専門家のためのプログラミング」</a></li>
<li><a href="../ja464181/index.html">Poco-AirTest IDEの一部としてのモバイルゲーム向けのPythonベースのUIオートメーション</a></li>
<li><a href="../ja464185/index.html">概要：クリーンアーキテクチャ、Robert C. Martin</a></li>
<li><a href="../ja464189/index.html">オープンソースプロジェクトを作成する方法</a></li>
<li><a href="../ja464191/index.html">常駐プロキシを使用してアグリゲーターサイトの問題を解決する方法</a></li>
<li><a href="../ja464193/index.html">DevOps Deflopeのオープンマイク、SkyengとNvidiaのインフラストラクチャの話だけでなく、</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>