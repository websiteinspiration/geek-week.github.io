<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌭 💪🏿 👩🏼‍💼 Trolley Robot 2.0. Teil 2. Management in rviz und ohne. Elemente der Schönheit in rviz 🤱🏼 ✍🏻 🎮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im letzten Artikel über den autonomen Heimwagen 2.0 haben wir es geschafft, den Kilometerzähler eines Budgetroboters zu verbessern, eine akzeptable 2D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Trolley Robot 2.0. Teil 2. Management in rviz und ohne. Elemente der Schönheit in rviz</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502508/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im letzten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über den autonomen Heimwagen 2.0 haben wir es geschafft, den Kilometerzähler eines Budgetroboters zu verbessern, eine akzeptable 2D-Raumkarte mit Slam-Algorithmen und einem erschwinglichen Lidar zu erstellen und andere Probleme beim Erstellen des Projekts zu klären. </font><font style="vertical-align: inherit;">Dieses Mal werden wir sehen, wie die autonome Navigation in rviz funktioniert, wofür wir verantwortlich sind. Wir werden Programme implementieren, mit denen Sie rviz verlassen können. </font><font style="vertical-align: inherit;">Betrachten Sie auch einige der „Schönheitselemente“ von rviz, die der ROS-Robotik das Leben erleichtern.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/3c1/e03/2dd/3c1e032ddbd49f6df72e4fe6fba41644.gif" alt="Bild"><br>
<a name="habracut"></a> <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen wir mit dem Üben.</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Aufgabe des Roboters</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : unabhängig von Punkt A nach Punkt B oder besser sofort zu mehreren Punkten B zu fahren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird davon ausgegangen, dass die Skripte (Knoten) des Linorobot-Projekts, um das das Projekt erstellt wird, auf dem Roboter gestartet werden und die Visualisierung des Geschehens und die Steuerung durchgeführt werden von einem externen PC, einer virtuellen Maschine (im Folgenden als "PC" bezeichnet). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinem Fall wird von der Software auf dem Wagen, deren Herzstück das Himbeer-Pi-3b-Single-Board ist, Folgendes installiert: Ubuntu 16.04, ROS Kinetic, auf einem PC: Ubuntu 18.04, ROS Melodic. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie irgendwohin gehen, müssen Sie die Abmessungen des Roboters einstellen - Länge und Breite. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu müssen Sie, wie auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projektseite angegeben, die entsprechenden Werte eingeben:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/param/navigation<font></font>
nano costmap_common_params.yaml<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Richtige Footprint-Parameter:</font></font><br>
<br>
<pre><code class="bash hljs">footprint: [[-x, -y], [-x, y], [x, y], [x, -y]]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dabei ist x = Länge des Roboters / 2 und y = Breite / 2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Idealerweise können Sie für den Roboter ein Urdf-Modell zeichnen, wie dies zuvor im vorherigen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt des Roboterwagens</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> getan wurde </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn dies nicht getan wird, leidet die Navigation nicht viel, aber anstelle des Modells des Roboters bewegen sich „TF-Achsen“ auf der Karte. </font><font style="vertical-align: inherit;">Wir werden weiter darauf eingehen, wie Sie die Situation mit der visuellen Darstellung des Roboters auf der Karte ein wenig verbessern und gleichzeitig keine Zeit mit der Erstellung des Urdf-Modells verschwenden können.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir schaffen eine Umgebung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie auf dem Roboter zwei verschiedene Terminals aus:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot bringup.launch<font></font>
roslaunch linorobot navigate.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie auf dem PC die rviz Visual Shell aus:</font></font><br>
<pre><code class="bash hljs">roscd lino_visualize/rviz<font></font>
rviz -d navigate.rviz<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alles gut gegangen ist, können Sie auf dem PC die Position des Roboters in rviz beobachten: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b_/9f/p-/b_9fp-u8g8w-hjpblp-phfjlebq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TF-Achsen sind in rviz sichtbar, sowie die Option Poligon, die im Anzeigefeld hinzugefügt werden kann. Polygon - Dies sind nur die Footprint-Größen des Roboters, die zu Beginn eingeführt wurden, sodass Sie die Abmessungen des Roboters sehen können. * TF-Achsen sind von den Achsen im Bild aus sichtbar: TF-Map - Map und TF-Base-Link - der Roboter selbst, die verbleibenden Achsen werden in Rviz stummgeschaltet, um nicht miteinander zu verschmelzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Daten vom Lidar stimmen geringfügig nicht mit den Wänden auf der Karte überein, der Roboter ist nicht lokalisiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie von dieser Position aus gehen, versucht der Algorithmus, sich anzupassen. Sie können ihm jedoch auch helfen, indem Sie die Startposition direkt in rviz mit der Schaltfläche „2D-Posenschätzung“ angeben:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zk/z6/rc/zkz6rccts3id2z7n0gpxdg6gtbk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geben Sie als Nächstes im rviz-Visualisierungsfenster auf der Karte die anfängliche Position und Richtung des Roboters mit einer kräftigen grünen Pfeil-Anfangspose an (Sie können dies viele Male tun): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ww/pm/1c/wwpm1c_aajdcjcaqglvt5mhlf9q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Klärung der Position verschiebt sich base_link relativ zur Karte geringfügig: Die </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/tu/-l/lstu-lbjdmh95vblibcsjnlffti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
absolute Genauigkeit der Übereinstimmung der Ränder vom Lidar mit der Karte beim manuellen Anpassen der Anfangsposition nicht benötigt, korrigiert der Algorithmus dann alles selbst.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bevor du trotzdem gehst</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setzen Sie jedes Mal die Startposition ein, wenn der Roboter am Boden von derselben Stelle aus startet. </font><font style="vertical-align: inherit;">Daher werden wir den Dienst verwenden (denken Sie daran, dass es zusätzlich zu den Themen in ROS Dienste gibt). Beim Zugriff wird der "Standort des Roboters auf der Karte" gelesen und diese Daten werden dann verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie ein Skript auf dem PC (es spielt keine Rolle, an welcher Stelle)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_pose.py</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#! /usr/bin/env python</span>
<span class="hljs-keyword">import</span> rospy
<span class="hljs-keyword">from</span> std_srvs.srv <span class="hljs-keyword">import</span> Empty, EmptyResponse <span class="hljs-comment"># Import the service message python classes generated from Empty.srv.</span>
<span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> PoseWithCovarianceStamped, Pose<font></font>
robot_pose = Pose()<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">service_callback</span>(<span class="hljs-params">request</span>):</span>
    <span class="hljs-keyword">print</span> (<span class="hljs-string">"Robot Pose:"</span>)
    <span class="hljs-keyword">print</span> (robot_pose)
    <span class="hljs-keyword">return</span> EmptyResponse() <span class="hljs-comment"># the service Response class, in this case EmptyResponse    </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sub_callback</span>(<span class="hljs-params">msg</span>):</span>
    <span class="hljs-keyword">global</span> robot_pose<font></font>
    robot_pose = msg.pose.pose   <font></font>
rospy.init_node(<span class="hljs-string">'service_server'</span>) <font></font>
my_service = rospy.Service(<span class="hljs-string">'/get_pose_service'</span>, Empty , service_callback) <span class="hljs-comment"># create the Service called get_pose_service with the defined callback</span>
sub_pose = rospy.Subscriber(<span class="hljs-string">'/amcl_pose'</span>, PoseWithCovarianceStamped, sub_callback)<font></font>
rospy.spin() <span class="hljs-comment"># mantain the service open.</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Start zeigt das Skript im Terminal nichts an und wartet leise auf den Zugriff. </font><font style="vertical-align: inherit;">Da wir in rviz über die grafische Oberfläche kürzlich die Anfangsposition des Roboters festgelegt haben, können Sie sich auf unser neues Skript beziehen und diese Position herausfinden. </font><font style="vertical-align: inherit;">Ohne das Terminal mit dem Skript zu schließen (wie zuvor gestartete Terminals mit Knoten), werden wir in einem anderen Terminal Folgendes ausführen:</font></font><br>
<br>
<pre><code class="bash hljs">rosservice call /get_pose_service
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem die Anforderung im Terminal mit dem Skript ausgeführt wurde, zeigt get_pose.py die Position des Roboters an: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/np/_x/zvnp_xpbeckxu9wvu3uz-myojye.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speichern Sie diese Indikatoren und fügen Sie sie zu den Einstellungen des amcl-Knotens auf dem Roboter hinzu, sodass der Roboter jedes Mal an der angegebenen Position startet:</font></font><br>
<br>
<pre><code class="bash hljs">nano linorobot/launch/include/amcl.launch
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinzufügen </font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter</font></font></b>
                        <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"initial_pose_x"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0.548767569629"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"initial_pose_y"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0.218281839179"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"initial_pose_z"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0.0"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"initial_orientation_z"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0.128591756735"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"initial_orientation_w"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0.991697615254"</span>/&gt;</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt startet der Roboter beim Start bereits an einer bestimmten Position und muss auch nicht manuell in rviz eingestellt werden:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t_/e7/ja/t_e7jaubijay2gjiqhtfbde3vss.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endlich geht es los</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Starten Sie die zu Beginn angegebenen Befehle für den Roboter und den PC neu und sehen Sie sich den Roboter in rviz an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden das "2D NAV Goal" -Rviz verwenden, um den Roboter zu senden, wohin die Seele es wünscht: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/59/qc/cc/59qcccgwhvmk2-k1vrrqoyte9lo.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können, kann der Roboter nicht nur die Entfernung der Reise, sondern auch die Bewegungsrichtung anzeigen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im obigen Beispiel fuhren wir ein wenig vorwärts, drehten uns um und gingen zurück. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In rviz sind auch die bekannten Amcl-Partikelschwärme „grüne Pfeile“ sichtbar, die zeigen, wo sich der Roboter laut Programm befindet. Nach der Fahrt nähert sich ihre Konzentration dem realen Standort des Roboters, die Gesamtzahl nimmt ab. Der Roboter fährt schnell genug - 0,3 m / s, sodass das Programm mehr Zeit benötigt, um den Roboter zu lokalisieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Navigieren in rviz mithilfe des „2D-NAV-Ziels“, um zu verstehen, wie weit und in welche Richtung sich der Roboter bewegt, ist praktisch. Noch bequemer ist jedoch eine Reise ohne Beteiligung des Betreibers an rviz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher markieren wir auf der Karte die Punkte von Interesse, an die wir gehen werden. Bewegen Sie dazu den Roboter mit "2D NAV Goal" zu den gewünschten Punkten auf der Karte. An diesen Stellen wird auf den Dienst get_pose.py zugegriffen. Als nächstes werden die Koordinaten aller Punkte in das Reiseprogramm übertragen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum nicht einfach den Roboter in Ihren Armen zu Sehenswürdigkeiten bringen? Die Sache ist "Amcl Partikelschwarm", der Algorithmus, der sie erstellt. Selbst wenn sich der Roboter am interessierenden Punkt befindet und seine Position manuell festgelegt wird, wird eine Variante seiner Position über den Bereich um den interessierenden Punkt selbst "gesprüht". Deshalb musst du noch gehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit dem Codenamen „Korridor“:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j8/wu/d3/j8wud3xde2uvln0kxars2rb6hqe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir speichern die Pose, wenn sich der Roboter am gewünschten Punkt befindet, indem wir einen zuvor erstellten Dienst anrufen:</font></font><br>
<br>
<pre><code class="bash hljs">rosservice call /get_pose_service
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weiter - der "Eingang": </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vr/ni/yo/vrniyo_esbuuzo4iqljqmjr84xi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und der letzte Punkt - "die Küche": </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d0/68/zf/d068zft3bm_odnx6d4yjuwbu8kq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist es Zeit, ein Reiseprogramm zu erstellen -</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MoveTBtoGoalPoints.py</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-keyword">import</span> rospy
<span class="hljs-keyword">import</span> actionlib
<span class="hljs-comment"># Use the actionlib package for client and server</span>
<span class="hljs-keyword">from</span> move_base_msgs.msg <span class="hljs-keyword">import</span> MoveBaseAction, MoveBaseGoal
<span class="hljs-comment"># Define Goal Points and orientations for TurtleBot in a list</span>
<span class="hljs-string">"""
pose x,y,x; orientation: x,y,z,w
"""</span>
GoalPoints = [ [(<span class="hljs-number">5.31514576482</span>, <span class="hljs-number">1.36578380326</span>, <span class="hljs-number">0.0</span>), (<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">-0.498454937648</span>, <span class="hljs-number">0.866915610157</span>)], <span class="hljs-comment">#corridor</span>
		[(<span class="hljs-number">5.77521810772</span>, <span class="hljs-number">-1.2464049907</span>, <span class="hljs-number">0.0</span>), (<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>,  <span class="hljs-number">-0.959487358308</span>, <span class="hljs-number">0.281751680114</span>)], <span class="hljs-comment">#prixozaya</span>
		[(<span class="hljs-number">2.14926455346</span>, <span class="hljs-number">-2.7055208156</span>, <span class="hljs-number">0.0</span>), (<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>,  <span class="hljs-number">-0.99147032254</span>, <span class="hljs-number">0.130332649487</span>)]] <span class="hljs-comment">#kitchen</span>
<span class="hljs-comment"># The function assign_goal initializes goal_pose variable as a MoveBaseGoal action type.</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">assign_goal</span>(<span class="hljs-params">pose</span>):</span><font></font>
    goal_pose = MoveBaseGoal()<font></font>
    goal_pose.target_pose.header.frame_id = <span class="hljs-string">'map'</span>
    goal_pose.target_pose.pose.position.x = pose[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<font></font>
    goal_pose.target_pose.pose.position.y = pose[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]<font></font>
    goal_pose.target_pose.pose.position.z = pose[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]<font></font>
    goal_pose.target_pose.pose.orientation.x = pose[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]<font></font>
    goal_pose.target_pose.pose.orientation.y = pose[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]<font></font>
    goal_pose.target_pose.pose.orientation.z = pose[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]<font></font>
    goal_pose.target_pose.pose.orientation.w = pose[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>]<font></font>
 <font></font>
    <span class="hljs-keyword">return</span> goal_pose
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    rospy.init_node(<span class="hljs-string">'MoveTBtoGoalPoints'</span>)
    <span class="hljs-comment"># Create a SimpleActionClient of a move_base action type and wait for server.</span>
    client = actionlib.SimpleActionClient(<span class="hljs-string">'move_base'</span>, MoveBaseAction)<font></font>
    client.wait_for_server()<font></font>
    <span class="hljs-comment"># for each goal point in the list, call the action server and move to goal</span>
    <span class="hljs-keyword">for</span> TBpose <span class="hljs-keyword">in</span> GoalPoints:<font></font>
        TBgoal = assign_goal(TBpose)<font></font>
        <span class="hljs-comment"># For each goal point assign pose</span><font></font>
        client.send_goal(TBgoal)<font></font>
        client.wait_for_result()<font></font>
        <span class="hljs-comment"># print the results to the screen</span>
        <span class="hljs-comment">#if(client.get_state() == GoalStatus.SUCCEEDED):</span>
        <span class="hljs-comment">#    rospy.loginfo("success")</span>
        <span class="hljs-comment">#else:        </span>
        <span class="hljs-comment">#   rospy.loginfo("failed")</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* In GoalPoints fügen wir die zuvor gespeicherten Koordinaten der Trip Points hinzu. Der Code enthält eine Erklärung, in welcher Reihenfolge die Parameter ablaufen: Pose x, y, x; Ausrichtung: x, y, z, w - [(5.31514576482, 1.36578380326, 0.0), (0.0, 0.0, -0.498454937648, 0.866915610157)] </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie das Skript MoveTBtoGoalPoints.py parallel zu den zuvor gestarteten Knoten auf dem Roboter und dem PC aus. Siehe das Ergebnis: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dw/pa/am/dwpaamsd3ltexeajath9fhxowxs.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können Der Roboter fuhr erfolgreich zum Flur und sah sich auf dem Weg in die Küche im Spiegel und blieb stecken. Gut mit Lidars beim Treffen mit Spiegeln, leider so. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was kann getan werden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist möglich, Zwischenpunkte vor und nach den Spiegeln hinzuzufügen, die Geschwindigkeit des Roboters zu verringern und entlang der Route ein undurchsichtiges Klebeband auf den Spiegel zu kleben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies sind jedoch die nächsten Schritte, aber wir werden zunächst die Aufgabe in Betracht ziehen, mit und ohne die Hilfe von rviz von Punkt A nach Punkt B zu reisen. Im Prinzip brauchen wir jetzt keinen externen PC, weil Das Reiseskript führt uns zu den gewünschten Punkten auf der Karte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber lassen Sie uns nicht eilen, um den PC zusammen mit rviz fallen zu lassen, da das Linorobot-Projekt "out of the box" nicht richtig funktioniert und Sie "mit einer Datei" auf dem Navigationsstapel arbeiten müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist die Zeit zum Einspruch - lassen Sie mich sagen, wo ist die autonome Navigation, der Roboter fuhr n Schritte vorwärts, seitwärts, rückwärts und sogar in den Spiegel? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, das ist alles, bis auf einige Details, die ROS auszeichnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns diese Details an.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Angenommen, ein verantwortungsloser Bürger hat ein lebloses Objekt auf dem Weg des Roboters zurückgelassen. </font><font style="vertical-align: inherit;">Dieser Gegenstand befindet sich nicht auf der Karte, die dem Roboter zur Navigation übergeben wurde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/6w/qs/tv6wqskrwnnbckeqldhlav9cdhe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wird passieren? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mal sehen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/dt/b6/qxdtb6nv92prvbtipav6h8kv79s.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen, hat der Lidar ein Hindernis gesehen, der Algorithmus hat es auf der Karte markiert und einen Umweg angeordnet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fügen Sie schließlich etwas Schönheit zu rviz hinzu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der visuelle Editor von rviz verfügt über interessante Plugins, die nicht standardmäßig installiert sind. </font><font style="vertical-align: inherit;">Ihre Verwendung kann bei der Arbeit mit rviz viele interessante Punkte hinzufügen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Repository mit Plugins ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie Plugins auf unserem PC in unserer Umgebung:</font></font><br>
<br>
<pre><code class="bash hljs">roscd; <span class="hljs-built_in">cd</span> ../src;<font></font>
catkin_create_pkg my_rviz_markers rospy<font></font>
<span class="hljs-built_in">cd</span> my_rviz_markers/
<span class="hljs-built_in">cd</span> src<font></font>
git <span class="hljs-built_in">clone</span> https://github.com/jsk-ros-pkg/jsk_visualization<font></font>
git <span class="hljs-built_in">clone</span> https://github.com/ClementLeBihan/rviz_layer
<span class="hljs-built_in">cd</span> ..<font></font>
rosdep install --from-paths -y -r src<font></font>
<span class="hljs-built_in">cd</span> ~/linorobot_ws/<font></font>
catkin_make<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Installation in rviz sollten zusätzliche Plugins angezeigt werden. </font><font style="vertical-align: inherit;">
Fügen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wir nun beispielsweise die Symbole hinzu: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/pm/tb/lgpmtbn86bdy-uygi-66wsdws4e.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie im Ordner my_rviz_markers / samples ein Skript:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pictogram_array_objects_demo.py</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-keyword">import</span> rospy
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">from</span> jsk_rviz_plugins.msg <span class="hljs-keyword">import</span> Pictogram, PictogramArray
<span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> random, choice<font></font>
rospy.init_node(<span class="hljs-string">"pictogram_object_demo_node"</span>)<font></font>
p = rospy.Publisher(<span class="hljs-string">"/pictogram_array"</span>, PictogramArray,  queue_size=<span class="hljs-number">1</span>)<font></font>
<font></font>
r = rospy.Rate(<span class="hljs-number">1</span>)<font></font>
actions = [Pictogram.JUMP, Pictogram.JUMP_ONCE, Pictogram.ADD, <font></font>
           Pictogram.ROTATE_X, Pictogram.ROTATE_Y, Pictogram.ROTATE_Z]<font></font>
pictograms = [<span class="hljs-string">"home"</span>,<span class="hljs-string">"fa-robot"</span>]<font></font>
object_frames = [<span class="hljs-string">"map"</span>,<span class="hljs-string">"base_link"</span>]<font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown():<font></font>
    <font></font>
    arr = PictogramArray()<font></font>
    arr.header.frame_id = <span class="hljs-string">"/map"</span><font></font>
    arr.header.stamp = rospy.Time.now()<font></font>
    <span class="hljs-keyword">for</span> index, character <span class="hljs-keyword">in</span> enumerate(pictograms):<font></font>
        msg = Pictogram()<font></font>
        msg.header.frame_id = object_frames[index]<font></font>
        msg.action = actions[<span class="hljs-number">2</span>]<font></font>
        msg.header.stamp = rospy.Time.now()<font></font>
        msg.pose.position.x = <span class="hljs-number">0</span>
        msg.pose.position.y = <span class="hljs-number">0</span>
        msg.pose.position.z = <span class="hljs-number">0.5</span>
        <span class="hljs-comment"># It has to be like this to have them vertically orient the icons.</span>
        msg.pose.orientation.w = <span class="hljs-number">0.7</span>
        msg.pose.orientation.x = <span class="hljs-number">0</span>
        msg.pose.orientation.y = <span class="hljs-number">-0.7</span>
        msg.pose.orientation.z = <span class="hljs-number">0</span>
        msg.size = <span class="hljs-number">0.5</span>
        msg.color.r = <span class="hljs-number">25</span> / <span class="hljs-number">255.0</span>
        msg.color.g = <span class="hljs-number">255</span> / <span class="hljs-number">255.0</span>
        msg.color.b = <span class="hljs-number">240</span> / <span class="hljs-number">255.0</span>
        msg.color.a = <span class="hljs-number">1.0</span><font></font>
        msg.character = character<font></font>
        arr.pictograms.append(msg)<font></font>
    p.publish(arr)<font></font>
    r.sleep()<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Machen wir es ausführbar:</font></font><br>
<br>
<pre><code class="bash hljs">sudo chmod +x pictogram_array_objects_demo.py
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie im Ordner my_rviz_markers / launch einen Start zum Starten:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">launch</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"my_rviz_markers"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"pictogram_array_objects_demo.py"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pictogram_array_objects_demo"</span> &lt;/<span class="hljs-attr">node</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">launch</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es beginnt wie gewohnt (alle anderen Knoten zu diesem Zeitpunkt sollten ebenfalls funktionieren): </font></font><br>
<br>
<pre><code class="bash hljs">roslaunch my_rviz_markers pictogram_array_objects_demo.launch
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setzen Sie den Marker auf die Karte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Markierungen können hilfreich sein, um zu verstehen, wo sich der Punkt auf der Karte befindet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie wie im vorherigen Beispiel ein Skript im Ordner my_rviz_markers / samples:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic_marker.py</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> rospy
<span class="hljs-keyword">from</span> visualization_msgs.msg <span class="hljs-keyword">import</span> Marker
<span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> Point<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MarkerBasics</span>(<span class="hljs-params">object</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>
        self.marker_objectlisher = rospy.Publisher(<span class="hljs-string">'/marker_basic'</span>, Marker, queue_size=<span class="hljs-number">1</span>)<font></font>
        self.rate = rospy.Rate(<span class="hljs-number">1</span>)<font></font>
        self.init_marker(index=<span class="hljs-number">0</span>,z_val=<span class="hljs-number">0</span>)<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_marker</span>(<span class="hljs-params">self,index=<span class="hljs-number">0</span>, z_val=<span class="hljs-number">0</span></span>):</span><font></font>
        self.marker_object = Marker()<font></font>
        self.marker_object.header.frame_id = <span class="hljs-string">"/map"</span><font></font>
        self.marker_object.header.stamp    = rospy.get_rostime()<font></font>
        self.marker_object.ns = <span class="hljs-string">"start"</span><font></font>
        self.marker_object.id = index<font></font>
        self.marker_object.type = Marker.SPHERE<font></font>
        self.marker_object.action = Marker.ADD<font></font>
<font></font>
        my_point = Point()<font></font>
        my_point.z = z_val<font></font>
        <span class="hljs-comment">#self.marker_object.pose.position = my_point</span>
        self.marker_object.pose.position.x = <span class="hljs-number">5.31514576482</span>
        self.marker_object.pose.position.y = <span class="hljs-number">1.36578380326</span> 
        self.marker_object.pose.orientation.x = <span class="hljs-number">0</span>
        self.marker_object.pose.orientation.y = <span class="hljs-number">0</span>
        self.marker_object.pose.orientation.z = <span class="hljs-number">-0.498454937648</span>
        self.marker_object.pose.orientation.w = <span class="hljs-number">0.866915610157</span>
        self.marker_object.scale.x = <span class="hljs-number">0.2</span>
        self.marker_object.scale.y = <span class="hljs-number">0.2</span>
        self.marker_object.scale.z = <span class="hljs-number">0.2</span><font></font>
    <font></font>
        self.marker_object.color.r = <span class="hljs-number">0.0</span>
        self.marker_object.color.g = <span class="hljs-number">0.0</span>
        self.marker_object.color.b = <span class="hljs-number">1.0</span>
        <span class="hljs-comment"># This has to be, otherwise it will be transparent</span>
        self.marker_object.color.a = <span class="hljs-number">1.0</span><font></font>
<font></font>
        <span class="hljs-comment"># If we want it for ever, 0, otherwise seconds before desapearing</span>
        self.marker_object.lifetime = rospy.Duration(<span class="hljs-number">0</span>)<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown():<font></font>
            self.marker_objectlisher.publish(self.marker_object)<font></font>
            self.rate.sleep()<font></font>
   <font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    rospy.init_node(<span class="hljs-string">'marker_basic_node'</span>, anonymous=<span class="hljs-literal">True</span>)<font></font>
    markerbasics_object = MarkerBasics()<font></font>
    <span class="hljs-keyword">try</span>:<font></font>
        markerbasics_object.start()<font></font>
    <span class="hljs-keyword">except</span> rospy.ROSInterruptException:
        <span class="hljs-keyword">pass</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie im Ordner my_rviz_markers / launch einen Start zum Starten:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic_marker.launch</font></font></b>
                        <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">launch</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"my_rviz_markers"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"basic_marker.py"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basic_marker"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">launch</span>&gt;</span></code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lauf:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch my_rviz_markers basic_marker.launch
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu rviz hinzufügen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pb/ci/yi/pbciyiiovbi8eo_kotdwzpqje9o.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fügen Sie Grafiken hinzu</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier werden der Abstand und der Winkel zwischen den beiden Frames </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/9s/xp/wh9sxpxllgndhu1xaeu4oe-ekuk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
angezeigt </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Erstellen Sie im Ordner my_rviz_markers / launch einen Start zum Starten:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overlay_meny_my.launch overlay_menu_my.launch</font></font></b>
                        <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">launch</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"my_rviz_markers"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"haro_overlay_complete_demo.py"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"overlay_menu"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">launch</span>&gt;</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie im Ordner my_rviz_markers / samples die folgenden Skripte:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haro_overlay_complete_demo.py</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span><font></font>
<font></font>
<span class="hljs-keyword">from</span> jsk_rviz_plugins.msg <span class="hljs-keyword">import</span> OverlayText, OverlayMenu
<span class="hljs-keyword">from</span> std_msgs.msg <span class="hljs-keyword">import</span> ColorRGBA, Float32
<span class="hljs-keyword">import</span> rospy
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> Twist<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaroOverlay</span>(<span class="hljs-params">object</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        <font></font>
        self.text_pub = rospy.Publisher(<span class="hljs-string">"/text_sample"</span>, OverlayText, queue_size=<span class="hljs-number">1</span>)<font></font>
        <font></font>
        self.plot_value_pub = rospy.Publisher(<span class="hljs-string">"/plot_value_sample"</span>, Float32, queue_size=<span class="hljs-number">1</span>)<font></font>
        self.piechart_value_pub = rospy.Publisher(<span class="hljs-string">"/piechart_value_sample"</span>, Float32, queue_size=<span class="hljs-number">1</span>)<font></font>
        self.menu_publisher = rospy.Publisher(<span class="hljs-string">"/test_menu"</span>, OverlayMenu, queue_size=<span class="hljs-number">1</span>)<font></font>
        self.plot_value = <span class="hljs-number">0</span>
        self.piechart_value = <span class="hljs-number">0</span>
        self.max_distance_from_object = <span class="hljs-number">10.0</span><font></font>
        <font></font>
        self.subs = rospy.Subscriber(<span class="hljs-string">"/haro_base_link_to_person_standing_tf_translation"</span>, Twist, self.twist_callback)<font></font>
        <font></font>
        self.counter = <span class="hljs-number">0</span>
        self.rate = rospy.Rate(<span class="hljs-number">100</span>)<font></font>
        self.overlaytext = self.update_overlaytext()<font></font>
        self.menu = self.update_overlay_menu()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">twist_callback</span>(<span class="hljs-params">self, msg</span>):</span><font></font>
        self.plot_value = msg.linear.x<font></font>
        self.piechart_value = msg.angular.z<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_overlaytext</span>(<span class="hljs-params">self, number=<span class="hljs-number">1.23</span>, number2=<span class="hljs-number">20</span></span>):</span>  <font></font>
        <font></font>
        text = OverlayText()<font></font>
        text.width = <span class="hljs-number">200</span>
        text.height = <span class="hljs-number">400</span>
        text.left = <span class="hljs-number">10</span>
        text.top = <span class="hljs-number">10</span>
        text.text_size = <span class="hljs-number">12</span>
        text.line_width = <span class="hljs-number">2</span>
        text.font = <span class="hljs-string">"DejaVu Sans Mono"</span>
        text.text = <span class="hljs-string">"""Distance=  %s.
        Angle=%s.
        Counter = &lt;span style="color: green;"&gt;%d.&lt;/span&gt;
        """</span> % (str(number), str(number2) ,self.counter)<font></font>
        text.fg_color = ColorRGBA(<span class="hljs-number">25</span> / <span class="hljs-number">255.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">240.0</span> / <span class="hljs-number">255.0</span>, <span class="hljs-number">1.0</span>)<font></font>
        text.bg_color = ColorRGBA(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.2</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">return</span> text<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_overlay_textonly</span>(<span class="hljs-params">self, new_text</span>):</span><font></font>
        self.overlaytext.text = new_text<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_overlay_menu</span>(<span class="hljs-params">self</span>):</span><font></font>
        menu = OverlayMenu()<font></font>
        menu.title = <span class="hljs-string">"HaroSystemMode"</span>
        menu.menus = [<span class="hljs-string">"Sleep"</span>, <span class="hljs-string">"Searching"</span>, <span class="hljs-string">"MovingInCircles"</span>,<span class="hljs-string">"Waiting"</span>]<font></font>
        <font></font>
        menu.current_index = self.counter % len(menu.menus)<font></font>
        <span class="hljs-keyword">return</span> menu<font></font>
        <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_overlay_menu_haro_tf</span>(<span class="hljs-params">self</span>):</span><font></font>
        menu = OverlayMenu()<font></font>
        menu.title = <span class="hljs-string">"HaroDistanceFromPerson"</span>
        menu.menus = [<span class="hljs-string">"FarAway"</span>, <span class="hljs-string">"CloseBy"</span>, <span class="hljs-string">"Target"</span>, <span class="hljs-string">"OtherWayRound"</span>]<font></font>
        <font></font>
        fraction = <span class="hljs-number">10.0</span><font></font>
        <font></font>
        <span class="hljs-keyword">if</span> self.piechart_value &lt; (math.pi/fraction):
            <span class="hljs-keyword">if</span> self.plot_value &gt;= self.max_distance_from_object:<font></font>
                index = <span class="hljs-number">0</span>
            <span class="hljs-keyword">elif</span> self.plot_value &gt;= (self.max_distance_from_object/ fraction) <span class="hljs-keyword">and</span> self.plot_value &lt; self.max_distance_from_object:<font></font>
                index = <span class="hljs-number">1</span>
            <span class="hljs-keyword">elif</span> self.plot_value &lt; (self.max_distance_from_object/fraction):<font></font>
                index = <span class="hljs-number">2</span><font></font>
            <font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            index = <span class="hljs-number">3</span><font></font>
            <font></font>
        menu.current_index = index<font></font>
            <font></font>
        <span class="hljs-keyword">return</span> menu<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_dummy_demo</span>(<span class="hljs-params">self</span>):</span><font></font>
        <font></font>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown():<font></font>
            self.overlaytext = self.update_overlaytext()<font></font>
            self.menu = self.update_overlay_menu()<font></font>
            <font></font>
            <span class="hljs-keyword">if</span> self.counter % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:<font></font>
                self.menu.action = OverlayMenu.ACTION_CLOSE<font></font>
            <font></font>
            self.text_pub.publish(self.overlaytext)<font></font>
            <span class="hljs-comment"># If values are very high it autoadjusts so be careful</span>
            self.value_pub.publish(math.cos(self.counter * math.pi * <span class="hljs-number">2</span> / <span class="hljs-number">1000</span>))<font></font>
            self.menu_publisher.publish(self.menu)<font></font>
            <font></font>
            self.rate.sleep()<font></font>
            self.counter += <span class="hljs-number">1</span><font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_harodistance_demo</span>(<span class="hljs-params">self</span>):</span><font></font>
        <font></font>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown():<font></font>
            self.overlaytext = self.update_overlaytext(number=self.plot_value, number2=self.piechart_value)<font></font>
            self.menu = self.update_overlay_menu_haro_tf()<font></font>
            <font></font>
            self.text_pub.publish(self.overlaytext)<font></font>
            <font></font>
            self.plot_value_pub.publish(self.plot_value)<font></font>
            self.piechart_value_pub.publish(self.piechart_value)<font></font>
            <font></font>
            self.menu_publisher.publish(self.menu)<font></font>
            <font></font>
            self.rate.sleep()<font></font>
            self.counter += <span class="hljs-number">1</span><font></font>
  <font></font>
  <font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dummy_overlay_demo</span>():</span>
    rospy.init_node(<span class="hljs-string">'distance_overlay_demo_node'</span>, anonymous=<span class="hljs-literal">True</span>)<font></font>
    haro_overlay_object = HaroOverlay()<font></font>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment">#haro_overlay_object.start_dummy_demo()</span><font></font>
        haro_overlay_object.start_harodistance_demo()<font></font>
    <span class="hljs-keyword">except</span> rospy.ROSInterruptException:
        <span class="hljs-keyword">pass</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    dummy_overlay_demo()<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das zweite Skript ist </font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tf_haro_to_object_listener.py</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> rospy
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">import</span> tf
<span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> Twist, Vector3<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    rospy.init_node(<span class="hljs-string">'tf_listener_haro_to_person'</span>)<font></font>
<font></font>
    listener = tf.TransformListener()<font></font>
<font></font>
    <span class="hljs-keyword">if</span> len(sys.argv) &lt; <span class="hljs-number">3</span>:<font></font>
        print(<span class="hljs-string">"usage: tf_haro_to_object_listener.py parent child"</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        follower_model_name = sys.argv[<span class="hljs-number">1</span>]<font></font>
        model_to_be_followed_name = sys.argv[<span class="hljs-number">2</span>]<font></font>
        <font></font>
        topic_to_publish_name = <span class="hljs-string">"/"</span>+str(follower_model_name)+<span class="hljs-string">"_to_"</span>+str(model_to_be_followed_name)+<span class="hljs-string">"_tf_translation"</span>
        <span class="hljs-comment"># We will publish a Twist message but it's positional data not speed, just reusing an existing structure.</span>
        tf_translation = rospy.Publisher(topic_to_publish_name, Twist ,queue_size=<span class="hljs-number">1</span>)<font></font>
        <font></font>
        rate = rospy.Rate(<span class="hljs-number">10.0</span>)<font></font>
        ctrl_c = <span class="hljs-literal">False</span><font></font>
        <font></font>
        follower_model_frame = <span class="hljs-string">"/"</span>+follower_model_name<font></font>
        model_to_be_followed_frame = <span class="hljs-string">"/"</span>+model_to_be_followed_name<font></font>
        <font></font>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shutdownhook</span>():</span>
            <span class="hljs-comment"># works better than the rospy.is_shut_down()</span>
            <span class="hljs-keyword">global</span> ctrl_c<font></font>
            ctrl_c = <span class="hljs-literal">True</span><font></font>
<font></font>
        rospy.on_shutdown(shutdownhook)<font></font>
        <font></font>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> ctrl_c:
            <span class="hljs-keyword">try</span>:<font></font>
                (trans,rot) = listener.lookupTransform(follower_model_frame, model_to_be_followed_frame, rospy.Time(<span class="hljs-number">0</span>))<font></font>
                translation_object = Vector3()<font></font>
                translation_object.x = trans[<span class="hljs-number">0</span>]<font></font>
                translation_object.y = trans[<span class="hljs-number">1</span>]<font></font>
                translation_object.z = trans[<span class="hljs-number">2</span>]<font></font>
                <font></font>
                angular = math.atan2(translation_object.y, translation_object.x)<font></font>
                linear = math.sqrt(translation_object.x ** <span class="hljs-number">2</span> + translation_object.y ** <span class="hljs-number">2</span>)<font></font>
                cmd = Twist()<font></font>
                cmd.linear.x = linear<font></font>
                cmd.angular.z = angular<font></font>
                tf_translation.publish(cmd)<font></font>
                <font></font>
            <span class="hljs-keyword">except</span> (tf.LookupException, tf.ConnectivityException, tf.ExtrapolationException):
                <span class="hljs-keyword">continue</span><font></font>
            rate.sleep()<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es beginnt so (es wird angenommen, dass alle anderen Hauptknoten und rviz bereits ausgeführt werden):</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot overlay_meny_my.launch<font></font>
python tf_haro_to_object_listener.py base_link map<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden den Winkel und die Entfernung des base_link-Frames relativ zur Karte sehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortsetzung folgt.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de502494/index.html">7 Fehler eines Black Friday und wie Magento Cloud funktioniert - Video</a></li>
<li><a href="../de502496/index.html">Einfacher Webzugriff auf LabVIEW VI PHP-Anwendungen über ActiveX Server</a></li>
<li><a href="../de502498/index.html">Best Practices zur Verbesserung der Leistung in C #</a></li>
<li><a href="../de502500/index.html">Die Entwicklung eines Passscanners: vom Sperrholzhandwerk zum echten Geschäft</a></li>
<li><a href="../de502504/index.html">Umgeben Sie die Benutzerziffer</a></li>
<li><a href="../de502510/index.html">Was in der Cloud zu speichern</a></li>
<li><a href="../de502512/index.html">Ergebnisse des Wettbewerbs der Sofaexperten: die Regeln des wissenschaftlichen Stocherns</a></li>
<li><a href="../de502518/index.html">Wie man auf einen Baum klettert</a></li>
<li><a href="../de502520/index.html">Videoberichte von Mitap-Berichten zur Produktanalyse</a></li>
<li><a href="../de502554/index.html">Mittlere Informationstechnologie als Ausweg aus der Krise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>