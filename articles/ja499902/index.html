<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎈 👨🏻‍🍳 🏁 TCPリセット攻撃のしくみ 🤮 ↩️ 😭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TCPリセット攻撃は、サイズが数バイト以下の単一のデータパケットを使用して実行されます。スプーフィングに置き換えられ、攻撃者によって作成および送信されたTCPセグメントは、2人の被害者をだましてTCP接続を終了させ、それらの間の接続を中断します。
 
 
 この攻撃は現実の世界に影響を及ぼしました。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TCPリセット攻撃のしくみ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499902/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPリセット攻撃は、サイズが数バイト以下の単一のデータパケットを使用して実行されます。</font><font style="vertical-align: inherit;">スプーフィングに置き換えられ、攻撃者によって作成および送信されたTCPセグメントは、2人の被害者をだましてTCP接続を終了させ、それらの間の接続を中断します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0e/768/854/d0e7688544d90ce84fd01f7aae77b348.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この攻撃は現実の世界に影響を及ぼしました。</font><font style="vertical-align: inherit;">その使用に対する恐怖は、TCPプロトコル自体への変更の導入によって引き起こされました。</font><font style="vertical-align: inherit;">この攻撃は、中国政府が中国国外のインターネットを検閲するために使用する大中国のファイアウォール（ゴールデンシールド）の重要なコンポーネントであると考えられています。</font><font style="vertical-align: inherit;">彼女の印象的な背景にもかかわらず、この攻撃の背後にあるメカニズムを理解するには、必ずしもTCPに関する深い知識は必要ありません。</font><font style="vertical-align: inherit;">もちろん、その微妙な点を理解することで、TCPプロトコルの実装機能について多くのことを学ぶことができます。また、すぐにわかるように、1台のラップトップだけを使用してこの攻撃を実行することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この投稿では、次のことを行います。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPの基本を学ぶ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻撃のしくみを学ぶ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単なPythonスクリプトを使用して、自分自身に対する攻撃を実行してみましょう。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
攻撃のメカニズムを分析する前に、実際の攻撃がどのように使用されているかをまず見てみましょう。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Great FirewallでTCPリセット攻撃はどのように使用されますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グレートファイアウォール（GFW）は、中国政府が内部の中国ユーザーのインターネットを検閲するために使用するシステムと技術のセットです。</font><font style="vertical-align: inherit;">GFWは、国内外のサーバーとの接続を積極的にブロックおよび切断し、禁止されているコンテンツのインターネットトラフィックを受動的に監視します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが禁止されたサーバーに接続することさえ防ぐために、GFWは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS汚染</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font><em><font style="vertical-align: inherit;">IPブロッキング</font></em><font style="vertical-align: inherit;">などの技術を使用します</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（どちらも別の記事が必要です）。</font><font style="vertical-align: inherit;">ただし、GFWファイアウォールで接続を許可し、途中で切断する必要がある場合があります。</font><font style="vertical-align: inherit;">たとえば、他のアクションとの相関関係など、接続の低速で保留中の分析を実行する場合に必要です。</font><font style="vertical-align: inherit;">または、ファイアウォールが接続プロセス中に交換されたデータを分析する必要がある場合に使用され、この情報を使用して続行するかブロックするかを決定します。</font><font style="vertical-align: inherit;">たとえば、ニュースWebサイトへのトラフィックは許可されますが、禁止されたキーワードを含むビデオは検閲されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このため、GFWには、すでに確立されている接続を中断できるツールが必要です。</font><font style="vertical-align: inherit;">そのようなツールの1つがTCPリセット攻撃です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPリセット攻撃はどのように機能しますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPリセット攻撃では、攻撃者は2人の被害者間の接続を切断し、1つまたは両方の偽のメッセージを送信して、すぐに切断するように指示します。これらのメッセージは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPリセットセグメント</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。攻撃者が関与しない通常の操作では、コンピュータは予期しないTCPトラフィックを受信し、送信者に送信を停止させたい場合にTCPドロップセグメントを送信します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPリセット攻撃はこのメカニズムを悪用して悪用し、被害者をだまして偽のリセットセグメントを送信してTCP接続を途中で終了させます。誤ったリセットセグメントが正しく作成された場合、レシーバーはそれを実際のセグメントとして受け取り、その側で接続を閉じ、この接続での情報の送信を中断します。データ交換を継続するために、被害者は新しいTCP接続を作成しようとする可能性がありますが、攻撃者はこの新しい接続をリセットする機会を持つ可能性があります。幸い、攻撃者は偽のパケットを作成して送信する時間が必要であるため、ドロップ攻撃は実際には長期間の接続に対してのみ効果があります。短期接続。たとえば、小さなWebページを転送するために使用されます。攻撃者がそれらをリセットできる場合。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPもIPも送信者のIDを確認する独自の方法がないため、偽のTCPセグメントを送信することは、ある意味で簡単なプロセスです。認証を提供するIPSecと呼ばれるIP拡張機能がありますが、それほど広く使用されていません。インターネットサービスプロバイダーは、明らかに偽のIPアドレスからのIPパケットの送信を拒否する必要がありますが、このチェックは非常に平凡であるとされています。受信者が実行できることは、パケットまたはセグメント内の送信元IPアドレスとポートを額面どおりに取得し、可能であれば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://habr.com/2014/03/27/how-does-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの高レベルのプロトコルを使用して送信者を識別すること</font><font style="vertical-align: inherit;">です。ただし、TCPダンプパケットはTCPプロトコル自体の一部であるため、これらの高レベルプロトコルを使用して確認することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
偽のセグメントを送信するのは単純ですが、偽のセグメントを作成してTCPリセット攻撃を成功させることは、依然として困難な作業です。</font><font style="vertical-align: inherit;">これが発生する理由を理解するには、TCPプロトコルの動作を理解する必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPの仕組み</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPプロトコルの目的は、受信者にデータブロックの正確なコピーを送信することです。</font><font style="vertical-align: inherit;">たとえば、サーバーがTCP経由でコンピューターにHTMLを送信する場合、コンピューター</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のTCPスタック</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（オペレーティングシステムのTCPを処理する部分）は、サーバーが送信したのとまったく同じ形式と順序でHTMLを出力する必要があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/54d/bf5/d64/54dbf5d644d0a3d8ece1cff6cde7b790.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、私のHTMLはそのような完全に秩序立った方法でインターネットを介して送信されません。これは多くの小さなフラグメント（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPセグメント</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">分割され</font><font style="vertical-align: inherit;">、それぞれがインターネット経由で個別に送信され、コンピューターのTCPスタックによって転送順に再作成されます。この復元された出力は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、TCPストリーム</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれ</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。各TCPセグメントは独自の</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPパケット</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">送信されますが</font><font style="vertical-align: inherit;">、攻撃を理解するために、IPに関する詳細を知る必要はありません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/468/904/175/4689041752b8fa9f66c57c696c4be2ef.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターネットは信頼できないため、セグメントをストリームに変換するには注意が必要です。</font><font style="vertical-align: inherit;">TCPセグメントが失われる可能性があります。</font><font style="vertical-align: inherit;">故障したり、2度送信されたり、損傷を受けたり、その他の多くの誤った冒険を経験したりします。</font><font style="vertical-align: inherit;">したがって、TCPプロトコルの目的は、信頼性の低いネットワークを介した信頼性の高いデータ伝送を保証することです。</font><font style="vertical-align: inherit;">TCPはこのタスクを実行し、接続の両側で相互間の密接な接触を維持し、受信したデータブロックに関する情報を常に送信することを要求します。</font><font style="vertical-align: inherit;">これにより、送信者は受信者がまだ受信していないデータを理解し、失われたデータを再送信できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロセスがどのように機能するかを理解するには、送信者と受信者が</font><em><font style="vertical-align: inherit;">TCPシーケンス番号を</font></em><font style="vertical-align: inherit;">使用する方法を理解する必要があり</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TCPを介して送信されるデータのマーキングと追跡用。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPシーケンス番号</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCP接続を介して送信される各バイトには、送信者によって割り当てられたシーケンス番号があります。</font><font style="vertical-align: inherit;">受信マシンはシリアル番号を使用して、受信したデータを元の順序に移動します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/402/fbc/144/402fbc144a2864f986debfb2ea9b6412.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2台のマシンがTCP接続をネゴシエートするとき、各マシンは別のランダムな</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開始シーケンス番号を</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信します</font><font style="vertical-align: inherit;">。これは、マシンが送信する最初のバイトに割り当てるシーケンス番号です。後続の各バイトには、前のバイトのシーケンス番号に1を加えた番号が割り当てられます。TCPセグメントには</font><font style="vertical-align: inherit;">、セグメントの先頭に添付されたメタデータである</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPヘッダー</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が含まれ</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。セグメント本体の最初のバイトのシーケンス番号は、このセグメントのTCPヘッダーに含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCP接続は双方向です。つまり、データは両方向に送信でき、TCP接続の各マシンは送信側と受信側の両方として機能します。このため、各マシンは独自の独立したシーケンス番号のセットを割り当てて処理する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ受信確認</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マシンはTCPセグメントを受信すると、セグメントの送信者に、それが受信されたことを通知します。</font><font style="vertical-align: inherit;">受信者は</font><font style="vertical-align: inherit;">、送信者から受信することを期待して</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いる</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイトの</font><font style="vertical-align: inherit;">シーケンス番号を含む</font><font style="vertical-align: inherit;">セグメント</font><font style="vertical-align: inherit;">（「確認応答」の略）を</font><font style="vertical-align: inherit;">送信することにより、これ</font><font style="vertical-align: inherit;">を行います</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">送信側はこの情報を使用して、受信側がこの数までの他のすべてのバイトを正常に受信したことを理解します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セグメントは</font><font style="vertical-align: inherit;">、セグメントのTCPヘッダー内の</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグ</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と対応する確認番号</font><font style="vertical-align: inherit;">の存在によって示され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">TCPプロトコルに</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、リセットセグメントを示す</font><font style="vertical-align: inherit;">フラグ</font><font style="vertical-align: inherit;">（「リセット」-「リセット」の省略形</font><font style="vertical-align: inherit;">）を含め、6つのフラグしかありません</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/242/452/e35/242452e35d360faf406441ab93f8c383.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注：TCPでは、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択的ACK</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の使用も許可されます</font><font style="vertical-align: inherit;">。これは、受信者が番号の範囲内のすべてではなく一部のセグメントを受信したときに送信されます。たとえば、「バイト1000〜3000および4000〜5000を受信しましたが、3001〜3999は受信しませんでした。」簡単にするために、TCPリセット攻撃の説明では、選択的ACKについては考慮しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信者がデータを送信するが受信しない場合</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一定の時間間隔で彼らのために、彼はデータが失われたと想定し、それらに同じシリアル番号を与えて再送信します。これは、レシーバーが同じバイトを2回受け入れる場合、シーケンス番号を簡単に使用して、ストリームを壊すことなく重複を取り除くことを意味します。元のセグメントが後で送信された後、再度送信されたため、または元のセグメントは正常に受信されたが、対応するものが</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信者への途中で失われた</font><font style="vertical-align: inherit;">ため、受信者は重複データを受け入れることができ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6d/22f/a09/e6d22fa098d7375dab30e6c8341ff358.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような重複データは非常にまれですが、それによって引き起こされるリソースの過剰な浪費は問題につながりません。</font><font style="vertical-align: inherit;">すべてのデータが遅かれ早かれ受信者に到達し、対応するデータ</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が送信者に到達した場合、TCP接続がその役割を果たします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偽のセグメントのシリアル番号を選択する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
偽のセグメントを作成する場合、</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻撃者は彼にシリアル番号を与える必要があります。</font><font style="vertical-align: inherit;">受信者は、一貫性のないシリアル番号を持つセグメントを受け入れ、それらを正しい順序で個別に接続する必要があることを非常に喜んでいます。</font><font style="vertical-align: inherit;">ただし、その機能には制限があります。</font><font style="vertical-align: inherit;">シーケンス番号が「あまりにも」間違っているセグメントを受信者が受け取ると、そのようなセグメントは破棄されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、TCPリセット攻撃を成功させるには、もっともらしいシーケンス番号が必要です。</font><font style="vertical-align: inherit;">しかし、そのような数とは何ですか？</font><font style="vertical-align: inherit;">ほとんどのセグメント（後で説明しますが、ではありません</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）では</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、TCPウィンドウのサイズ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって答えが決まり</font><em><font style="vertical-align: inherit;">ます</font></em><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPウィンドウサイズ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現代のギガビット光ファイバーネットワークに接続された1990年代初頭の古代のコンピューターを想像してみてください。超高速ネットワークは、この古いコンピュータに驚くほどの速度でデータを転送できます。これは、マシンが処理できる速度よりも高速です。 TCPセグメントは、受信者が処理できるまで受信されたと見なすことができないため、これは私たちを悩ませます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a5/299/76a/8a529976a3acd7a28babb9e8220bcb7d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンピュータには</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPバッファ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり、コンピュータはそれより前に到着するデータを処理している間、新しい到着データが処理を待ちます。ただし、このバッファのサイズには制限があります。受信者がネットワークによって送信されたデータの量に対処できない場合、バッファはオーバーフローします。バッファがいっぱいになると、受信者は冗長なデータを取り除く以外に選択肢がなくなります。受信者は</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破棄されたデータを</font><font style="vertical-align: inherit;">送信しないため</font><font style="vertical-align: inherit;">、受信者のバッファに空き容量がある場合、送信者はそれらを再送信する必要があります。受信者が対処する時間がない場合、ネットワークがデータをどれだけ速く送信できるかは問題ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたがそれを読むよりも速くあなたに手紙の流れ全体をあなたのメールに送る熱狂的な友人を想像してみてください。メールボックスの内部には一定のバッファスペースがありますが、いっぱいになると、配置されていないすべての文字が地面に落ち、キツネや他の生き物がそれらを食べます。友人は、彼が食べた手紙を再送する必要がありますが、今のところ、以前のメッセージを受信する時間があります。受信者が処理できないほど多くの文字やデータ量を送信すると、エネルギーと伝送チャネルの無駄になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「多すぎる」-どのくらいのデータですか？送信者は、いつデータを送信する必要があるか、および待機する価値があるかをどのように理解しますか？ここで、</font><em><font style="vertical-align: inherit;">TCPウィンドウサイズ</font></em><font style="vertical-align: inherit;">が役立ちます。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。受信者のウィンドウのサイズは、送信者がいつでも受信者に転送できる未確認の最大バイト数です。受信者がそのウィンドウサイズが100,000であると報告したとします（この値がどのように渡されるかはすぐにわかります）。したがって、送信者は100,000バイトを送信します。送信者が10万分の1バイトを送信するまでに、受信者</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がこれらのバイトの最初の10,000の</font><font style="vertical-align: inherit;">セグメント</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">送信したとし</font><font style="vertical-align: inherit;">ます。これは、90,000バイトがまだ確認されていないことを意味します。ウィンドウサイズが100,000であるため、送信者は新しい10,000バイトを待機する前に、さらに10,000バイトを転送できます</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これらの10,000バイトをさらに送信した後</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信されなかった場合、送信者は100,000の未確認バイトの制限に達します。その結果、送信者は新しいデータを受信するまでデータの送信を待機して停止する必要があります（失われたと見なされるデータの再送信を除く）</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afa/5df/46f/afa5df46f3304b04abbf629ca6ef34a0.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCP接続の両側は、接続が開かれたときに実行されるハンドシェイクプロセス中に、ウィンドウのサイズを相手に通知します。さらに、ウィンドウサイズは、接続プロセス中に動的に変更できます。大きなTCPバッファーを備えたコンピューターは、大きなウィンドウサイズを通知してスループットを最大化できます。これにより、それと通信するマシンは、確認を一時停止または待機することなく、TCP接続を介して継続的にデータを送信できます。 TCPバッファーが小さいコンピューターでは、ウィンドウサイズの報告が強制される場合があります。送信者はウィンドウを完全に埋め、一部のセグメントが確認されるまで待たなければならない場合があります。これにより帯域幅が低下しますが、TCPバッファがオーバーフローしないことが必要です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e3/d5e/5e0/8e3d5e5e0e4b574c6896e6ef7adc94bc.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPウィンドウのサイズは、送信された未確認データの量に対する厳密な制限です。</font><font style="vertical-align: inherit;">これを使用して</font></font><code>max_seq_no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、送信者が現時点で送信できる</font><font style="vertical-align: inherit;">最大可能なシーケンス番号（以下の式では私がと指定</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を計算</font><font style="vertical-align: inherit;">できます。</font></font><br>
<br>
<blockquote><code>max_seq_no = max_acked_seq_no + window_size</code></blockquote><br>
<code>max_acked_seq_no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-これは、受信者が送信した最大シーケンス番号です</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、受信者が正確に受信したことを送信者が知っている最大シーケンス番号です。</font><font style="vertical-align: inherit;">送信者は</font></font><code>window_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未確認のバイト</font><font style="vertical-align: inherit;">のみを送信できるため、送信できる</font><font style="vertical-align: inherit;">最大シーケンス番号は</font></font><code>max_acked_seq_no + window_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このため、TCP仕様では、有効なウィンドウの範囲外のシリアル番号を持つデータを受信者が無視する必要があると規定されています。たとえば、受信者が15,000までのすべてのバイトを確認し、そのウィンドウサイズが30,000の場合、シリアル番号が15,000から（15,000 + 30,000 = 45,000）の範囲のデータを受信します。さらに、受信者はこの間隔外のシリアル番号を持つデータを完全に無視します。セグメントにデータが含まれていて、その一部がこのウィンドウ内にあり、一部がそのウィンドウ外にある場合、ウィンドウ内のデータは受け入れられて確認されますが、ウィンドウ外のデータは破棄されます。</font><font style="vertical-align: inherit;">投稿の冒頭で簡単に触れ</font><font style="vertical-align: inherit;">た</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択的なものの</font></font><code>ACK</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能性はまだ無視していることに注意してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどのTCPセグメントの場合、このルールは許容可能なシーケンス番号の間隔を提供します。</font><font style="vertical-align: inherit;">ただし、前述のように、セグメントに課せられる</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制限は、通常のデータ伝送セグメントに対する制限よりもさらに厳しいものです。</font><font style="vertical-align: inherit;">すぐにわかるように、これは</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ブラインドTCPリセット攻撃」</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれるTCPリセット</font><em><font style="vertical-align: inherit;">攻撃の</font></em><font style="vertical-align: inherit;">変種の実行を複雑にするために行われました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSTセグメントの許容シーケンス番号</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常のセグメントは、それらのシーケンス番号が次の予期されるシーケンス番号とこの番号にウィンドウサイズを加えたものの間にある場合に受け入れられます。ただし、パケット</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、シーケンス番号が</font><font style="vertical-align: inherit;">次に予期されるシーケンス番号</font><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全に等しい</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合にのみ受信</font><font style="vertical-align: inherit;">されます。受信者が確認番号15,000を送信した前の例に戻りましょう。パケットを受信する</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、シーケンス番号が正確に15,000である必要があります。受信者</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が15,000以外のシーケンス番号の</font><font style="vertical-align: inherit;">セグメント</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">受信した場合、受信者は</font><font style="vertical-align: inherit;">それを受け入れません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/596/b55/1d9596b55bb0ac4946ed16ff6b878dff.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シーケンス番号が間隔の外にある場合、受信側はそれを完全に無視します。</font><font style="vertical-align: inherit;">ただし、それが予期されるシーケンス番号のウィンドウ内にある場合、受信者は「チャレンジ</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」（「ACKコール」）を</font><font style="vertical-align: inherit;">送信します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、セグメントに</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効なシーケンス番号がある</font><font style="vertical-align: inherit;">ことを送信者に伝えるセグメントです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、受信者が期待するシーケンス番号を送信者に伝えます。</font><font style="vertical-align: inherit;">送信者は、</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通話</font><font style="vertical-align: inherit;">からのこの情報を使用</font><font style="vertical-align: inherit;">して、自分のを再作成して再</font><font style="vertical-align: inherit;">送信できます</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2010年まで、TCPはこれらの追加のセグメント制限を課していませんでした</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">セグメントは、他のセグメント</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と同じルールに従って受け入れまたは拒否されました。</font><font style="vertical-align: inherit;">ただし、これも</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブラインドブラインドTCPリセット攻撃を</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単純化しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブラインドTCP攻撃</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
攻撃者が被害者間で交換されたトラフィックを傍受できる場合、攻撃者は被害者のTCPパケットのシリアル番号と確認番号を読み取ることができます。彼はこの情報を使用して、偽のセグメントに与えるシリアル番号を選択できます</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ただし、攻撃者が被害者のトラフィックを傍受できない場合、攻撃者は挿入するシーケンス番号を知ることができません。しかし、彼は依然として</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、任意の数の異なるシリアル番号を持つ</font><font style="vertical-align: inherit;">任意の数のセグメント</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">転送でき</font><font style="vertical-align: inherit;">、それらの1つが正しいことが判明することを期待しています。このような攻撃は、ブラインドTCPリセット攻撃と呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、TCPプロトコルの初期バージョンでは、攻撃者はシリアル番号を取得するだけで済みました。</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信者のTCPウィンドウ内。</font><font style="vertical-align: inherit;">「Slipping in the Window」というタイトルの記事は、これがブラインド攻撃を簡単にしすぎたことを示しています。ほぼ確実に成功するためには、攻撃者は何万ものセグメントを送信しなければならなかったからです。</font><font style="vertical-align: inherit;">これに対抗するために、受信者にセグメントの受け入れを強制するルールは、</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上記のより厳しい基準に置き換えられました。</font><font style="vertical-align: inherit;">TCPリセット攻撃を実行するための新しいルールのおかげで、何百万ものセグメントを盲目的に送信する必要があり、実際には実現できません。</font><font style="vertical-align: inherit;">詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC-5963を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自分自身に対してTCPリセット攻撃を実行する</font></font></h2><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：このプロセスをOSXでテストしましたが、Linuxでは正しく機能しないというコメントをいくつか受け取りました。</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、TCPリセット攻撃の実行に関するすべてがわかりました。</font><font style="vertical-align: inherit;">攻撃者は次のことを行う必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2人の被害者間の</font><font style="vertical-align: inherit;">ネットワークトラフィックを監視（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「盗聴」</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグを有効にしてTCPセグメントをスニッフィングし、</font></font><code>ACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認済みの番号を読み取ります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグがオン</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、シーケンス番号がインターセプトされたセグメントの確認済み番号に等しい</font><font style="vertical-align: inherit;">偽のTCPセグメントを作成し</font><font style="vertical-align: inherit;">ます（これは低速の転送を意味することに注意してください。そうしないと、選択したシーケンス番号がすぐに古くなります。成功する可能性を高めるために、</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シーケンス番号の間隔が広い</font><font style="vertical-align: inherit;">複数のセグメント</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">転送でき</font><font style="vertical-align: inherit;">ます。 。）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偽のセグメントを1つまたは両方の被害者に送信し、TCP接続が切断されることを期待する</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
練習するために、同じコンピュータ上で自分自身にTCP攻撃を行い、を通じて自分と通信してみましょう</font></font><code>localhost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これには、次のものが必要です。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つのターミナルウィンドウ間のTCP接続を構成する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トラフィックスニッフィングを処理する攻撃プログラムを作成する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偽のセグメントを生成して送信するようにプログラムを変更し</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
始めましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 2つのターミナルウィンドウ間のTCP接続の確立</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ツールを使用してTCP接続を構成します。このツールは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>netcat</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、デフォルトで多くのオペレーティングシステムで使用できます。</font><font style="vertical-align: inherit;">他の</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPクライアントはこれを行います</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最初のターミナルウィンドウで、次のコマンドを実行します。</font></font><br>
<br>
<blockquote><code>nc -nvl 8000</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドは、ローカルマシンのポートをリッスンするTCPサーバーを起動します</font></font><code>8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">2番目のターミナルウィンドウで、次のコマンドを実行します。</font></font><br>
<br>
<blockquote><code>nc 127.0.0.1 8000</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドは</font></font><code>127.0.0.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ポートの</font><font style="vertical-align: inherit;">IPアドレスによってマシンへのTCP接続を作成しようとします</font></font><code>8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これで、ターミナルの2つのウィンドウ間で、TCP接続が確立されます。</font><font style="vertical-align: inherit;">1つのウィンドウに何かを入力してみてください。データはTCP接続を介して送信され、別のウィンドウに表示される必要があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/911/301/786/911301786c4f56287f80d38f67ef73f6.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.トラフィックスニッフィング</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>scapy</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人気のPythonネットワークライブラリ</font><font style="vertical-align: inherit;">
を使用してトラフィックをスニッフィングする攻撃プログラムを作成し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このプログラムはscapyを使用して、端末の2つのウィンドウ間で転送されたデータを読み取りますが、接続の一部ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムコードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、GitHubの私のリポジトリに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿され</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ています</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プログラムは接続トラフィックをスニッフィングし、それを端末に表示します。</font><font style="vertical-align: inherit;">コードの主なコア</font><font style="vertical-align: inherit;">は、ファイルの最後にある</font></font><code>sniff</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリからの</font><font style="vertical-align: inherit;">メソッド呼び出し</font></font><code>scapy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="python hljs">t = sniff(<font></font>
        iface=<span class="hljs-string">'lo0'</span>,<font></font>
        lfilter=is_packet_tcp_client_to_server(localhost_ip, localhost_server_port, localhost_ip),<font></font>
        prn=log_packet,<font></font>
        count=<span class="hljs-number">50</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードは</font></font><code>scapy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、インターフェイス上のパケットをスニッフィングし、</font></font><code>lo0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP接続の一部としてすべてのパケットの詳細をキャプチャする</font><font style="vertical-align: inherit;">よう</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">指示</font><font style="vertical-align: inherit;">しています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">呼び出しには次のパラメーターがあります。</font></font><br>
<br>
<ul>
<li><code>iface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>scapy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークインターフェース</font></font><code>lo0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、またはlocalhost </font><font style="vertical-align: inherit;">をリッスンする</font><font style="vertical-align: inherit;">注文</font></font></li>
<li><code>lfilter</code> —  ,  <code>scapy</code>   ,      IP- localhost   .   ,        ,   <code>lo0</code>.     ,     .</li>
<li><code>prn</code> — ,  <code>scapy</code>     ,    <code>lfilter</code>.          .       ,      <code>RST</code>.</li>
<li><code>count</code> —  ,  <code>scapy</code>    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプログラムをテストするには、ステップ1のTCP接続を構成します。GitHubリポジトリを複製し、構成手順に従って、ターミナルの3番目のウィンドウでプログラムを実行します。</font><font style="vertical-align: inherit;">TCP接続のいずれかの端末にテキストを入力します。</font><font style="vertical-align: inherit;">プログラムが接続セグメントに関する情報の記録を開始することがわかります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.偽のパッケージを送信する </font></font><code>RST</code></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続を確立しました。プログラムは、接続を通過するすべてのTCPセグメントを傍受できます。あとは、偽のセグメントを送信してTCPリセット攻撃を実行するようにプログラムを変更するだけです</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これを行うに</font><font style="vertical-align: inherit;">は、関数の要件を満たすパッケージに対して</font></font><code>prn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出される</font><font style="vertical-align: inherit;">関数を変更します</font><font style="vertical-align: inherit;">（上記のパラメーターのリストを参照）</font><font style="vertical-align: inherit;">。関数の変更バージョンでは、対応するパッケージを単に修正するのではなく、それを調査し、必要なパラメーターを抽出し、これらのパラメーターを使用してセグメントを作成および送信します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">k </font><font style="vertical-align: inherit;">
からのセグメントをインターセプトしたとします</font><font style="vertical-align: inherit;">。彼にはフラグが設定されて</font><font style="vertical-align: inherit;">おり、確認番号は100,000です。セグメントを製造して送信するには、次のようにします。</font></font><code>scapy</code><font style="vertical-align: inherit;"></font><code>lfilter</code><font style="vertical-align: inherit;"></font><code>RST</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>(src_ip, src_port)</code><font style="vertical-align: inherit;"></font><code>(dst_ip, dst_port)</code><font style="vertical-align: inherit;"></font><code>ACK</code><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li>  IP-   ,    .  ,         .          ,  .</li>
<li>  <code>RST</code> ,     ,    <code>RST</code></li>
<li>        ,      ,    </li>
<li>  <code>send</code>  <code>scapy</code>     —   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前のプログラムを必要に応じて変更するには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この行の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コメントを外して、その上の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">行</font></a><font style="vertical-align: inherit;">をコメント化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで本格的な攻撃の準備が整いました。</font><font style="vertical-align: inherit;">手順1に従ってTCP接続を構成します。端末の3番目のウィンドウで、手順2の攻撃プログラムを実行します。</font><font style="vertical-align: inherit;">次に、TCP接続のターミナルの1つにテキストを入力します。</font><font style="vertical-align: inherit;">テキストを入力した端末で、TCP接続が突然、不思議なことに切断されます。</font><font style="vertical-align: inherit;">攻撃完了！</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad9/2a2/b18/ad92a2b18c1533c47d88ab4ff10dedf7.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今後の作業</font></font></h3><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻撃ツールの実験を続けます。</font><font style="vertical-align: inherit;">パッケージのシーケンス番号に1を加算または減算するとどうなるかを追跡します</font></font><code>RST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">傍受したパケットの</font><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">と</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正確に</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一致し</font><font style="vertical-align: inherit;">ている必要があります</font></font><code>ack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li> Wireshark       <code>lo0</code>    .            TCP-,       <code>RST</code>.   <code>ip.src == 127.0.0.1 &amp;&amp; ip.dst == 127.0.0.1 &amp;&amp; tcp.port == 8000</code>       .</li>
<li>  ,      .           <code>RST</code>,       <code>RST</code>         ,      .   ,      <code>RST</code>,       .</li>
</ol><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCPリセット攻撃は、深遠かつ単純です。</font><font style="vertical-align: inherit;">実験で頑張ってください</font><font style="vertical-align: inherit;">。質問やコメントがある場合は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お知らせください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja499884/index.html">CustDevについて理解した11のこと</a></li>
<li><a href="../ja499894/index.html">歌う家。Chipolo ONEスマートキーチェーントラッカーレビュー</a></li>
<li><a href="../ja499896/index.html">リモートサイトに正しく移動します。私たちの作業とプロジェクトの作業をTelegramで整理する方法は？</a></li>
<li><a href="../ja499898/index.html">IT担当者が検疫とどのように関係するか、自己隔離で何をするか、および何を使用するか</a></li>
<li><a href="../ja499900/index.html">製品分析mitap：無料、非接触型、オンライン</a></li>
<li><a href="../ja499904/index.html">"怖いです"。何をすべきか？</a></li>
<li><a href="../ja499906/index.html">おもちゃ業界でのARの使用例</a></li>
<li><a href="../ja499908/index.html">深みに飛び込む：デジタルの世界で選択の自由を実現する方法</a></li>
<li><a href="../ja499910/index.html">意思決定におけるバランス。フォーク「ランダム体験」</a></li>
<li><a href="../ja499920/index.html">SSHリトルトリック</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>