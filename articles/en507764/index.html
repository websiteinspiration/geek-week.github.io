<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÖüèæ üòö üöæ How did I make myself an ABP for a generator üè† üöß ‚úçüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few years ago I made myself an automatic transfer switch (automatic reserve input) for working in the country from a generator. Now many IT workers ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How did I make myself an ABP for a generator</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/507764/"><img src="https://habrastorage.org/webt/k7/ts/fd/k7tsfdbxvx2m-t8icgh6ryzqwbo.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A few years ago I made myself an automatic transfer switch (automatic reserve input) for working in the country from a generator. </font><font style="vertical-align: inherit;">Now many IT workers are moving to a remote location, working from cottages, where the quality of the power supply can leave the best. </font><font style="vertical-align: inherit;">Therefore, I decided to write about my experience with home-made ABP on the ATmega8A microcontroller. </font><font style="vertical-align: inherit;">If the topic is interesting, welcome to kat, there will be a lot of letters and code.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About grounding</font></font></h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before you do anything with electricity, you need to take care of having good grounding in your home. It‚Äôs just not possible to take and connect a regular household gas / diesel / gas generator to the power supply at home. Precautions must be observed. The first one is that your generator must be well grounded. Then you have a good chance of not getting an electric shock when the static from your favorite sweater breaks through the insulation of the generator winding. In general, a running generator should not be touched unnecessarily.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is worth remembering that the network is not always 220V. </font><font style="vertical-align: inherit;">Switching on the lines, lightning discharges in the distance, static discharges give such pickups that short pulses of several kilovolts are frequent in the network. </font><font style="vertical-align: inherit;">They are struggling with this by installing arresters and SPDs at the entrance to the house, but this is a very rare practice in the Russian Federation. </font><font style="vertical-align: inherit;">So let the spark go into the earth, and not through you - make good grounding throughout the house. </font><font style="vertical-align: inherit;">Without this, you can‚Äôt do anything further!</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About generators</font></font></h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, for many household gasoline generators, the windings are in no way connected to the ground. And this is quite normal when you are using one electric tool from the generator. But when you need to connect the generator to the house, you need to make a neutral wire (N) and a phase wire (L). To do this, one of the generator terminals is grounded and from this grounding point two wires must already be independently led into the house - one will be neutral N, and the second - protective earth (PE). When choosing a generator, you need to pay attention to whether it is possible to ground its output, sometimes it is prohibited in the instructions for the generator, then such a generator will not work for you.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Often on the Network you can see the connection diagrams of the generator without grounding and separation of the N and PE lines. </font><font style="vertical-align: inherit;">Do not do this, you will live longer. </font><font style="vertical-align: inherit;">Such schemes work well until the first unfortunate set of circumstances. </font><font style="vertical-align: inherit;">Typical power supplies for modern electronic devices include capacitors from L, N lines to ground. </font><font style="vertical-align: inherit;">If N is not grounded at the generator, then due to these capacitors on the N line there will be, if you're lucky, 110 volts relative to the ground. </font><font style="vertical-align: inherit;">By the way, many gas boilers in this mode generally stop working. </font><font style="vertical-align: inherit;">About the influence of statics without the presence of grounding, I already wrote above.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About ABP schemes</font></font></h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several different schemes for implementing ATS. Further I will write about the safest circuit of single-phase ATS from my point of view. I do not recommend sparingly doing ABP on one contactor or with switching only one phase wire. Only with neutral. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<img src="https://habrastorage.org/webt/vh/v-/rl/vhv-rllrb28jayf15egb9xgltua.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the above diagram, power from the network and from the generator is supplied through inputs 1 and 2. They are protected by paired machines. Through additional machines, switching and indication circuits are fed. It can be seen that the relay coils are mutually interlocked electrically. For the inclusion of a particular input, for simplicity, the microcontroller, not shown in the diagram, which closes the circuit at the switching point TK1 or TK2, is responsible.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fundamental point is the presence in the ATS 2x blocking schemes - mutual mechanical blocking of the switching inputs of the contactors and mutual electrical blocking of the contactors. </font><font style="vertical-align: inherit;">Self-made for the sake of economy, it happens, in their designs neglect these locks, but in vain. </font><font style="vertical-align: inherit;">The circuit without blocking may work for some time, but at some point the contacts will burn, the return springs will weaken and a short circuit will occur between the inputs. </font><font style="vertical-align: inherit;">Firstly, it threatens a big broads if both lines are energized, but this is not the biggest problem. </font><font style="vertical-align: inherit;">It is much more important that your generator, unexpectedly for electricians repairing the wiring, can supply voltage to the common network - in an unfavorable combination of circumstances, the electricians repairing the line can die. </font><font style="vertical-align: inherit;">This is already a criminal article for you.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About contactors</font></font></h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, the use of conventional relays disappears for us, only specialized contactors are suitable. For large capacities, there is still an option with motorized drives, but it is expensive and redundant for typical home use. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To make a mechanical interlock, you need to select contactors that can work in pairs. Mutual blocking is usually achieved by installing the same contactors next to each other and installing an additional option - a mechanical interlock. It is sold separately from contactors and costs a penny. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mutual electrical interlocking is possible if the contactor has additional signaling contacts operating on opening. Sometimes they are immediately built into the contactor, sometimes they can be purchased and installed as an option.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leading manufacturers of contactors have such equipment in their lines. So finding and buying a kit is not difficult. True, the prices of branded contactors are much higher than ours / Chinese. Since the number of switching cycles is not expected to be large, the choice of Chinese contactors is justified. The disadvantages can be attributed only to the fact that the coils of the contactor during operation quite a lot of buzz.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
More about switched power. </font><font style="vertical-align: inherit;">Contactor contacts must withstand the maximum power that you are allowed to consume in the house. </font><font style="vertical-align: inherit;">I have it 10 kW, so I chose the contactors for the permissible current through one contact at about 50 amperes. </font><font style="vertical-align: inherit;">It is worth noting that for some reason the switched power for a typical three-phase contactor is indicated in the passport total for all three phases, so you need to carefully look at what permissible current is through one contact.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About the control scheme</font></font></h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When I was involved in the creation of ABP, I had several special requirements for its work:</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<ul>
<li>      ,   ,      ,          :   ,      ,      ,     </li>
<li>              . ..           </li>
<li>            ,     ,                </li>
<li>, ,       .        </li>
</ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus the picture loomed that I needed a controller with several timers. In those days, I was fond of coding on AVR, so I decided to make such a controller on Atmega 8a. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It would be nice if the controller worked for a long time and reliably. In addition, in order to make a complete galvanic isolation and equip the controller with a watchdog timer, I came up with nothing more. Well, make the scheme and program as simple as possible. Since everything was done for myself, I decided to leave all the settings and calibrations in the code - the entire UI was reduced to one LED) </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main task of the controller is to monitor the voltage at the inputs and, if necessary, switch inputs. At the same time, input from the village network is a priority.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is worth noting here that the quality of the network is such that fluctuations from 150 to 250 are quite common. Therefore, the concept that there is good power from the network is very blurry. After some time, I solved this problem when I put on the whole house one powerful thyristor voltage regulator for 11 kW. But, importantly, the stabilizer can only be set before the ABP, and not after! Turning on the stabilizer for the generator is strongly discouraged. There is a danger that with a certain combination of loads, especially any powerful pumps, the system from the generator and stabilizer will become unstable and will enter into self-oscillations. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After some thought, I drew such a scheme in Eagle.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<img src="https://habrastorage.org/webt/3s/nr/v9/3snrv9ux0nbon6t1wf1vslf9h-c.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The circuit has two identical transformer power sources, if there is voltage at any of the inputs, the circuit is supplied with power. A voltage of 600V is possible between the inputs, so the insulation of the transformers should be good. Meals are taken after the QF3 and QF4 packets, respectively. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each source has a resistive voltage divider, which is protected against overvoltage by a zener diode - it is used to calculate the network voltage using an ADC microcontroller using simple calculations. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To switch contactor coils, a standard datasheet circuit is used to control the seven-cell. 2 pieces ). Coils are an inductive load, so snubber circuits at the output of the resistor and capacitor are required.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I had a relay module with ali, which is used to stop the generator. </font><font style="vertical-align: inherit;">In the diagram, it is just a rectangle with three pins. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of the features, TL431 is also used as a reference voltage generator. </font><font style="vertical-align: inherit;">Otherwise, everything is included as standard for Atmega 8. There are LEDs to indicate the presence of supply voltage at the inputs and one device status LED. </font><font style="vertical-align: inherit;">The circuit is clocked using external 16 MHz quartz. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eagle gave me just such a printed circuit board. </font><font style="vertical-align: inherit;">No SMDs, triacs or stabilizer with lightweight radiators. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<img src="https://habrastorage.org/webt/48/c6/iw/48c6iwzgd0ea_4r-hua23bfriz4.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Two toroidal transformers are installed directly on the board. </font><font style="vertical-align: inherit;">The circuit board was manufactured in the traditional amateur radio fashion using a photoresist. </font><font style="vertical-align: inherit;">After installation, covered with three layers of acrylic varnish. </font><font style="vertical-align: inherit;">I hope his high voltage will not break.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About the management program</font></font></h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The program code is quite long, sorry.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program code</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">/*
 * ABP -    "  "
 *              -
 *       ,  - 
 *     -    .
 *      RS232   ,  SPI  
 *    3 .    
 *         .  
 *      .
 *
 *         printf
 *     -Wl,-u,vfprintf -lprintf_flt
 */</span>
 <span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> F_CPU</span>
 <span class="hljs-meta">#  <span class="hljs-meta-keyword">define</span> F_CPU 16000000UL</span>
 <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BAUD 9600</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/io.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/interrupt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/wdt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-comment">//    </span>
<span class="hljs-keyword">uint8_t</span> mcusr_mirror __attribute__ ((section (<span class="hljs-string">".noinit"</span>)));<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_mcusr</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> \
__<span class="hljs-title">attribute__</span><span class="hljs-params">((naked))</span> \
__<span class="hljs-title">attribute__</span><span class="hljs-params">((section(<span class="hljs-string">".init3"</span>)))</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_mcusr</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
   mcusr_mirror = MCUSR;<font></font>
   MCUSR = <span class="hljs-number">0</span>;<font></font>
   wdt_disable();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// UART      RS232</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">uart_init</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{
<span class="hljs-comment">/* //  
   UBRRH = 0;
   UBRRL = 103; //9600   16  */</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/setbaud.h&gt;</span></span><font></font>
    UBRRH = UBRRH_VALUE;<font></font>
    UBRRL = UBRRL_VALUE;   <font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> USE_2X</span>
      UCSRA |= (<span class="hljs-number">1</span> &lt;&lt; U2X);
    <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
      UCSRA &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; U2X);
   <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
   <span class="hljs-comment">//8  , 1  ,   </span>
   UCSRC = ( <span class="hljs-number">1</span> &lt;&lt; URSEL ) | ( <span class="hljs-number">1</span> &lt;&lt; UCSZ1 ) | ( <span class="hljs-number">1</span> &lt;&lt; UCSZ0 );
   <span class="hljs-comment">//    </span>
   UCSRB = ( <span class="hljs-number">1</span> &lt;&lt; TXEN ) | ( <span class="hljs-number">1</span> &lt;&lt;RXEN );<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">uart_putc</span><span class="hljs-params">(  <span class="hljs-keyword">char</span> c, FILE *file )</span>
</span>{
   <span class="hljs-comment">//    </span>
   <span class="hljs-keyword">while</span>( ( UCSRA &amp; ( <span class="hljs-number">1</span> &lt;&lt; UDRE ) ) == <span class="hljs-number">0</span> );<font></font>
   UDR = c;<font></font>
   wdt_reset();<font></font>
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
FILE uart_stream = FDEV_SETUP_STREAM( uart_putc, <span class="hljs-literal">NULL</span>, _FDEV_SETUP_WRITE );<font></font>
<font></font>
<span class="hljs-comment">//   1    -    </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">timer1_init</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{<font></font>
   TCCR1A = <span class="hljs-number">0</span>; <span class="hljs-comment">//    1 -  </span>
   <span class="hljs-comment">/* 16000000 / 1024 = 15625 ,     15625      1  */</span>
   <span class="hljs-comment">//  CTC, ICP1 interrupt sense (falling)(not used) + prescale /1024 +    (not used) </span>
   TCCR1B = (<span class="hljs-number">0</span> &lt;&lt; WGM13) | (<span class="hljs-number">1</span> &lt;&lt; WGM12) | (<span class="hljs-number">0</span> &lt;&lt; ICES1) | ((<span class="hljs-number">1</span> &lt;&lt; CS12) | (<span class="hljs-number">0</span> &lt;&lt; CS11) | (<span class="hljs-number">1</span> &lt;&lt; CS10)) | (<span class="hljs-number">0</span> &lt;&lt; ICNC1); <font></font>
   OCR1A = <span class="hljs-number">15625</span>;  <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   TIMSK |= (<span class="hljs-number">1</span> &lt;&lt; OCIE1A);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> _ABP_RLY_STATES {<font></font>
   RLY_OFF = <span class="hljs-number">0</span>, <span class="hljs-comment">//  </span>
   RLY_ON <span class="hljs-comment">//  </span><font></font>
} ABP_RLY_STATES;<font></font>
<font></font>
<span class="hljs-comment">//     </span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> _ABP_RLY {<font></font>
   RLY_220N = <span class="hljs-number">0</span>,<font></font>
   RLY_220G,<font></font>
   RLY_GEN<font></font>
} ABP_RLY;<font></font>
<font></font>
<span class="hljs-keyword">volatile</span> ABP_RLY_STATES contactors[RLY_GEN+<span class="hljs-number">1</span>]; <span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> _ABP_TMR_STATES {<font></font>
   TMR_OFF = <span class="hljs-number">0</span>, <span class="hljs-comment">//  </span>
   TMR_ON <span class="hljs-comment">//  </span><font></font>
} ABP_TMR_STATES;<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
   ABP_TMR_STATES state; <span class="hljs-comment">//   </span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> passed_secs; <span class="hljs-comment">//    (  255!!!)</span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> set_secs; <span class="hljs-comment">//     </span><font></font>
} TMR_INSTANCE;<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> _ABP_TMRS {<font></font>
   TMR_220N_ON = <span class="hljs-number">0</span>,  <span class="hljs-comment">//      220  </span>
   TMR_220G_ON, <span class="hljs-comment">//      220  </span>
   TMR_220N_OFF, <span class="hljs-comment">//      220  </span>
   TMR_220G_OFF, <span class="hljs-comment">//      220   </span>
   TMR_PRINT, <span class="hljs-comment">//      </span>
   TMR_GEN_OFF <span class="hljs-comment">//        220  </span><font></font>
} ABP_TMRS;<font></font>
<font></font>
<span class="hljs-keyword">volatile</span> TMR_INSTANCE abp_timers[TMR_GEN_OFF+<span class="hljs-number">1</span>]; <span class="hljs-comment">//    ABP_TMRS</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">abp_timers_init</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span> </span>{
   <span class="hljs-comment">//     </span>
   abp_timers[TMR_220N_ON].set_secs = <span class="hljs-number">10</span>; <span class="hljs-comment">//     </span>
   abp_timers[TMR_220G_ON].set_secs = <span class="hljs-number">60</span>; <span class="hljs-comment">//        </span>
   abp_timers[TMR_220N_OFF].set_secs = <span class="hljs-number">5</span>; <span class="hljs-comment">//     </span>
   abp_timers[TMR_220G_OFF].set_secs = <span class="hljs-number">5</span>; <span class="hljs-comment">//     </span>
   abp_timers[TMR_GEN_OFF].set_secs = <span class="hljs-number">60</span>; <span class="hljs-comment">//      </span>
   abp_timers[TMR_PRINT].set_secs = <span class="hljs-number">2</span>; <span class="hljs-comment">//  </span><font></font>
   <font></font>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i;
   <span class="hljs-keyword">for</span>(i=TMR_220N_ON; i&lt;=TMR_GEN_OFF; i++ ) {<font></font>
      abp_timers[i].state = TMR_OFF;<font></font>
      abp_timers[i].passed_secs = <span class="hljs-number">0</span>;<font></font>
   }<font></font>
   <span class="hljs-keyword">for</span>(i=RLY_220N; i&lt;=RLY_GEN; i++ ) {<font></font>
      contactors[i] = RLY_OFF;<font></font>
   }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">abp_timer_start</span><span class="hljs-params">( ABP_TMRS tmr )</span> </span>{<font></font>
   abp_timers[tmr].passed_secs = <span class="hljs-number">0</span>;<font></font>
   abp_timers[tmr].state = TMR_ON;    <font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">abp_timer_stop</span><span class="hljs-params">( ABP_TMRS tmr )</span> </span>{<font></font>
   abp_timers[tmr].state = TMR_OFF;<font></font>
   abp_timers[tmr].passed_secs = <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-title">abp_timer_check</span><span class="hljs-params">( ABP_TMRS tmr )</span> </span>{
   <span class="hljs-keyword">if</span> (abp_timers[tmr].passed_secs &gt;= abp_timers[tmr].set_secs) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <font></font>
   } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
   }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
ISR(TIMER1_COMPA_vect)<font></font>
{<font></font>
   <span class="hljs-comment">//       /</span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i;
   <span class="hljs-keyword">for</span>(i=TMR_220N_ON; i&lt;=TMR_GEN_OFF; i++ ) {
      <span class="hljs-keyword">if</span> (abp_timers[i].state) {<font></font>
         abp_timers[i].passed_secs++;   <font></font>
      }<font></font>
   }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// COUNTER2      led_State</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">counter2_init</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{<font></font>
   ASSR = <span class="hljs-number">0</span>;  <span class="hljs-comment">/* AS0 = 0 */</span>  <span class="hljs-comment">/* disable asynchronous mode */</span>
   <span class="hljs-keyword">while</span> (ASSR); <span class="hljs-comment">/*EMPTY*/</span><font></font>
<font></font>
   OCR2 = <span class="hljs-number">223</span>;             <span class="hljs-comment">/* 70    */</span><font></font>
<font></font>
   TCCR2 |= (<span class="hljs-number">1</span> &lt;&lt; CS22) | (<span class="hljs-number">1</span> &lt;&lt; CS21) | (<span class="hljs-number">1</span> &lt;&lt; CS20);  <span class="hljs-comment">/* prescale /1024 */</span><font></font>
   <font></font>
   TCCR2 |= (<span class="hljs-number">1</span> &lt;&lt; WGM21);                <span class="hljs-comment">/* mode CTC */</span>
   TCCR2 &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; WGM20);<font></font>
   <font></font>
   TCCR2 &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; COM21);              <span class="hljs-comment">/*    OC2 */</span>
   TCCR2 &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; COM20);<font></font>
   <font></font>
   TIMSK |= (<span class="hljs-number">1</span> &lt;&lt; OCIE2);          <span class="hljs-comment">/* enable compare interrupt */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> _ABP_LED_STATES {<font></font>
   ABP_UNDEF = <span class="hljs-number">0</span>, <span class="hljs-comment">//  </span>
   ABP_1RELAY, <span class="hljs-comment">//  1 </span>
   ABP_2RELAY  <span class="hljs-comment">//  2 </span><font></font>
} ABP_LED_STATES;<font></font>
ABP_LED_STATES led_State = ABP_UNDEF;<font></font>
<font></font>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> led_pattern[<span class="hljs-number">3</span>][<span class="hljs-number">10</span>] =<font></font>
{ { <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span> }, <span class="hljs-comment">//   </span>
  { <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span> }, <span class="hljs-comment">//  1 </span>
  { <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span> } }; <span class="hljs-comment">//  2 </span><font></font>
<font></font>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> timer2_count = <span class="hljs-number">0</span>;         
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> led_cycle = <span class="hljs-number">0</span>; <span class="hljs-comment">//  0  9</span><font></font>
<font></font>
ISR(TIMER2_COMP_vect)  <span class="hljs-comment">//    70   </span><font></font>
{<font></font>
   <span class="hljs-keyword">if</span> (++timer2_count &gt; <span class="hljs-number">6</span>)       <span class="hljs-comment">//    0.1 .    </span><font></font>
   {<font></font>
      timer2_count = <span class="hljs-number">0</span>;           <span class="hljs-comment">//  </span>
      <span class="hljs-keyword">if</span> (led_pattern[led_State][led_cycle]) {<font></font>
         PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB0); <span class="hljs-comment">//         </span>
      } <span class="hljs-keyword">else</span> {<font></font>
         PORTB |=  (<span class="hljs-number">1</span> &lt;&lt; PB0); <span class="hljs-comment">// </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span> (++led_cycle &gt;= <span class="hljs-number">10</span>)<font></font>
         led_cycle = <span class="hljs-number">0</span>;<font></font>
   }  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SAMPLES 2500</span>
<span class="hljs-comment">//    TL431</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> REFERENCEV 2.479</span>
<span class="hljs-comment">//      </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIVIDER1 (12.3/2.13)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIVIDER2 (12.4/2.03)</span><font></font>
<font></font>
<span class="hljs-keyword">double</span> realV1 = <span class="hljs-number">0</span>; <span class="hljs-comment">//     V0</span>
<span class="hljs-keyword">double</span> realV2 = <span class="hljs-number">0</span>; <span class="hljs-comment">//     V1</span><font></font>
<font></font>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> sampleCount = <span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> tempVoltage1 = <span class="hljs-number">0</span>; <span class="hljs-comment">//    </span>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> tempVoltage2 = <span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> sumVoltage1 = <span class="hljs-number">0</span>; <span class="hljs-comment">//         </span>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> sumVoltage2 = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ADC_init</span><span class="hljs-params">()</span> <span class="hljs-comment">// ADC1,0</span>
</span>{
   <span class="hljs-comment">//   2,5, 10 bit </span>
   ADMUX = (<span class="hljs-number">0</span> &lt;&lt; REFS0) | (<span class="hljs-number">0</span> &lt;&lt; REFS1) | (<span class="hljs-number">0</span> &lt;&lt; ADLAR) |<font></font>
   (<span class="hljs-number">0</span> &lt;&lt; MUX3) | (<span class="hljs-number">0</span> &lt;&lt; MUX2) | (<span class="hljs-number">0</span> &lt;&lt; MUX1) | (<span class="hljs-number">0</span> &lt;&lt; MUX0); <span class="hljs-comment">// ADC0</span>
   <span class="hljs-comment">// , free running,  </span>
   ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADEN) | (<span class="hljs-number">1</span> &lt;&lt; ADFR) | (<span class="hljs-number">1</span> &lt;&lt; ADIE) |<font></font>
   (<span class="hljs-number">1</span> &lt;&lt; ADPS2) | (<span class="hljs-number">1</span> &lt;&lt; ADPS1) | (<span class="hljs-number">1</span> &lt;&lt; ADPS0); <span class="hljs-comment">//  128</span><font></font>
   <font></font>
   ADCSRA |= (<span class="hljs-number">1</span> &lt;&lt; ADSC);             <span class="hljs-comment">// Start ADC Conversion</span><font></font>
}<font></font>
<font></font>
ISR(ADC_vect) <span class="hljs-comment">//     2500    </span><font></font>
{<font></font>
   <span class="hljs-keyword">if</span> ((ADMUX &amp; (<span class="hljs-number">1</span> &lt;&lt; MUX0))) { <span class="hljs-comment">//    ADC1</span>
      <span class="hljs-keyword">if</span> (sampleCount++) <span class="hljs-comment">//   </span><font></font>
         tempVoltage1 += ADC;<font></font>
      <span class="hljs-keyword">if</span> (sampleCount &gt;= SAMPLES) {<font></font>
         sampleCount = <span class="hljs-number">0</span>;<font></font>
         sumVoltage1 = tempVoltage1;<font></font>
         tempVoltage2 = <span class="hljs-number">0</span>;<font></font>
         tempVoltage1 = <span class="hljs-number">0</span>;<font></font>
         ADMUX &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; MUX0); <span class="hljs-comment">//   ADC0</span><font></font>
      }        <font></font>
   } <span class="hljs-keyword">else</span> { <span class="hljs-comment">//    ADC0</span>
      <span class="hljs-keyword">if</span> (sampleCount++) <span class="hljs-comment">//   </span><font></font>
         tempVoltage2 += ADC;<font></font>
      <span class="hljs-keyword">if</span> (sampleCount &gt;= SAMPLES) {<font></font>
         sampleCount = <span class="hljs-number">0</span>;<font></font>
         sumVoltage2 = tempVoltage2;<font></font>
         tempVoltage2 = <span class="hljs-number">0</span>;<font></font>
         tempVoltage1 = <span class="hljs-number">0</span>;<font></font>
         ADMUX |= (<span class="hljs-number">1</span> &lt;&lt; MUX0); <span class="hljs-comment">//   ADC1</span><font></font>
      }  <font></font>
   }<font></font>
   ADCSRA |=(<span class="hljs-number">1</span> &lt;&lt; ADIF);              <span class="hljs-comment">// Acknowledge the ADC Interrupt Flag</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> _ABP_U_STATES {<font></font>
   U_INVALID = <span class="hljs-number">0</span>, <span class="hljs-comment">//    </span>
   U_VALID <span class="hljs-comment">//   </span><font></font>
} ABP_U_STATES;<font></font>
<font></font>
ABP_U_STATES u220n, u220g; <span class="hljs-comment">//     </span><font></font>
<font></font>
<span class="hljs-comment">//         </span>
<span class="hljs-comment">//        ,   </span>
<span class="hljs-comment">//    ( ),   </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_V 14.0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MIN_V 7.5</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ports_init</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-comment">//    </span>
   PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB0);<font></font>
   DDRB  |=  (<span class="hljs-number">1</span> &lt;&lt; PB0); <span class="hljs-comment">// output</span>
   PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB0); <span class="hljs-comment">// </span><font></font>
   <font></font>
   <span class="hljs-comment">//    1</span>
   PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD4);<font></font>
   DDRD  |=  (<span class="hljs-number">1</span> &lt;&lt; PD4); <span class="hljs-comment">// output</span>
   PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD4); <span class="hljs-comment">//   - </span>
   <span class="hljs-comment">//    2</span>
   PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD3);<font></font>
   DDRD  |=  (<span class="hljs-number">1</span> &lt;&lt; PD3); <span class="hljs-comment">// output</span>
   PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD3); <span class="hljs-comment">//   - </span>
   <span class="hljs-comment">//     </span>
   PORTD &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PD2);<font></font>
   DDRD  |=  (<span class="hljs-number">1</span> &lt;&lt; PD2); <span class="hljs-comment">// output</span>
   PORTD &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PD2); <span class="hljs-comment">//   - </span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">validate220</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-comment">//       </span>
   realV1 = DIVIDER1 * ((sumVoltage1 * REFERENCEV) / <span class="hljs-number">1024</span>) / SAMPLES;<font></font>
   realV2 = DIVIDER2 * ((sumVoltage2 * REFERENCEV) / <span class="hljs-number">1024</span>) / SAMPLES;<font></font>
   <font></font>
   <span class="hljs-keyword">if</span>( realV1 &gt; MAX_V || realV1 &lt; MIN_V ) { <span class="hljs-comment">//    </span><font></font>
      u220g = U_INVALID;<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
      u220g = U_VALID;<font></font>
   }<font></font>
   <span class="hljs-keyword">if</span>( realV2 &gt; MAX_V || realV2 &lt; MIN_V ) { <span class="hljs-comment">//    </span><font></font>
      u220n = U_INVALID;<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
      u220n = U_VALID;<font></font>
   }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">validate_contactors</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-comment">//      220 </span>
      <span class="hljs-comment">//   RLY_220N = RLY_ON  RLY_OFF</span>
      <span class="hljs-keyword">if</span>( u220n == U_VALID &amp;&amp; contactors[RLY_220N] == RLY_OFF<font></font>
      &amp;&amp; abp_timers[TMR_220N_ON].state == TMR_OFF) { <span class="hljs-comment">//  ,   ,    </span>
         abp_timer_stop( TMR_220N_OFF ); <span class="hljs-comment">//    220</span>
         abp_timer_start( TMR_220N_ON ); <span class="hljs-comment">//    220</span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220n == U_VALID &amp;&amp; contactors[RLY_220N] == RLY_OFF<font></font>
      &amp;&amp; abp_timers[TMR_220N_ON].state == TMR_ON &amp;&amp; abp_timer_check(TMR_220N_ON)) { <span class="hljs-comment">//  ,   ,  </span>
         abp_timer_stop( TMR_220N_OFF ); <span class="hljs-comment">//    220</span>
         abp_timer_stop( TMR_220N_ON ); <span class="hljs-comment">//    220</span>
         contactors[RLY_220N] = RLY_ON; <span class="hljs-comment">//    220</span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220n == U_VALID &amp;&amp; contactors[RLY_220N] == RLY_ON<font></font>
      &amp;&amp; abp_timers[TMR_220N_OFF].state == TMR_ON) { <span class="hljs-comment">//  ,  ,    </span>
         abp_timer_stop( TMR_220N_OFF ); <span class="hljs-comment">//    220</span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220n == U_INVALID &amp;&amp; contactors[RLY_220N] == RLY_ON<font></font>
      &amp;&amp; abp_timers[TMR_220N_OFF].state == TMR_OFF) { <span class="hljs-comment">//  ,   ,    </span>
         abp_timer_stop( TMR_220N_ON ); <span class="hljs-comment">//    220</span>
         abp_timer_start( TMR_220N_OFF ); <span class="hljs-comment">//    220</span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220n == U_INVALID &amp;&amp; contactors[RLY_220N] == RLY_ON<font></font>
      &amp;&amp; abp_timers[TMR_220N_OFF].state == TMR_ON &amp;&amp; abp_timer_check(TMR_220N_OFF)) { <span class="hljs-comment">//  ,   ,  </span>
         abp_timer_stop( TMR_220N_OFF ); <span class="hljs-comment">//    220</span>
         abp_timer_stop( TMR_220N_ON ); <span class="hljs-comment">//    220</span>
         contactors[RLY_220N] = RLY_OFF; <span class="hljs-comment">//    220</span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220n == U_INVALID &amp;&amp; contactors[RLY_220N] == RLY_OFF<font></font>
      &amp;&amp; abp_timers[TMR_220N_ON].state == TMR_ON) { <span class="hljs-comment">//  ,  ,    </span>
         abp_timer_stop( TMR_220N_ON ); <span class="hljs-comment">//    220</span><font></font>
      }<font></font>
      <font></font>
      <span class="hljs-comment">//     </span>
      <span class="hljs-comment">//   RLY_220G = RLY_ON  RLY_OFF</span>
      <span class="hljs-keyword">if</span>( u220g == U_VALID &amp;&amp; contactors[RLY_220G] == RLY_OFF<font></font>
      &amp;&amp; abp_timers[TMR_220G_ON].state == TMR_OFF) { <span class="hljs-comment">//  ,   ,    </span>
         abp_timer_stop( TMR_220G_OFF ); <span class="hljs-comment">//    </span>
         abp_timer_start( TMR_220G_ON ); <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220g == U_VALID &amp;&amp; contactors[RLY_220G] == RLY_OFF<font></font>
      &amp;&amp; abp_timers[TMR_220G_ON].state == TMR_ON &amp;&amp; abp_timer_check(TMR_220G_ON)) { <span class="hljs-comment">//  ,   ,  </span>
         abp_timer_stop( TMR_220G_OFF ); <span class="hljs-comment">//    </span>
         abp_timer_stop( TMR_220G_ON ); <span class="hljs-comment">//    </span>
         contactors[RLY_220G] = RLY_ON; <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220g == U_VALID &amp;&amp; contactors[RLY_220G] == RLY_ON<font></font>
      &amp;&amp; abp_timers[TMR_220G_OFF].state == TMR_ON) { <span class="hljs-comment">//  ,  ,    </span>
         abp_timer_stop( TMR_220G_OFF ); <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220g == U_INVALID &amp;&amp; contactors[RLY_220G] == RLY_ON<font></font>
      &amp;&amp; abp_timers[TMR_220G_OFF].state == TMR_OFF) { <span class="hljs-comment">//  ,   ,    </span>
         abp_timer_stop( TMR_220G_ON ); <span class="hljs-comment">//    </span>
         abp_timer_start( TMR_220G_OFF ); <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220g == U_INVALID &amp;&amp; contactors[RLY_220G] == RLY_ON<font></font>
      &amp;&amp; abp_timers[TMR_220G_OFF].state == TMR_ON &amp;&amp; abp_timer_check(TMR_220G_OFF)) { <span class="hljs-comment">//  ,   ,  </span>
         abp_timer_stop( TMR_220G_OFF ); <span class="hljs-comment">//    </span>
         abp_timer_stop( TMR_220G_ON ); <span class="hljs-comment">//    </span>
         contactors[RLY_220G] = RLY_OFF; <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( u220g == U_INVALID &amp;&amp; contactors[RLY_220G] == RLY_OFF<font></font>
      &amp;&amp; abp_timers[TMR_220G_ON].state == TMR_ON) { <span class="hljs-comment">//  ,  ,    </span>
         abp_timer_stop( TMR_220G_ON ); <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <font></font>
      <span class="hljs-comment">//      </span>
      <span class="hljs-keyword">if</span>( contactors[RLY_220N] == RLY_OFF &amp;&amp; contactors[RLY_GEN] == RLY_OFF) { <span class="hljs-comment">//  ,  </span>
         abp_timer_stop( TMR_GEN_OFF ); <span class="hljs-comment">//    </span>
         contactors[RLY_GEN] = RLY_ON; <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( contactors[RLY_220N] == RLY_ON &amp;&amp; abp_timers[TMR_GEN_OFF].state == TMR_OFF <font></font>
      &amp;&amp; u220g == U_VALID) { <span class="hljs-comment">//  220      </span>
         abp_timer_start( TMR_GEN_OFF ); <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( contactors[RLY_220N] == RLY_ON &amp;&amp; abp_timers[TMR_GEN_OFF].state == TMR_OFF<font></font>
      &amp;&amp; u220g == U_INVALID) { <span class="hljs-comment">//  220      </span>
         abp_timer_stop( TMR_GEN_OFF ); <span class="hljs-comment">//    </span>
         contactors[RLY_GEN] = RLY_OFF; <span class="hljs-comment">//    </span><font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>( contactors[RLY_220N] == RLY_ON &amp;&amp; abp_timers[TMR_GEN_OFF].state == TMR_ON<font></font>
      &amp;&amp;  abp_timer_check(TMR_GEN_OFF) ) { <span class="hljs-comment">//  220      </span>
         abp_timer_stop( TMR_GEN_OFF ); <span class="hljs-comment">//    </span>
         contactors[RLY_GEN] = RLY_OFF; <span class="hljs-comment">//    </span><font></font>
      }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">switch_contactors</span><span class="hljs-params">()</span> </span>{
   <span class="hljs-comment">//   </span>
   <span class="hljs-keyword">if</span>( contactors[RLY_220N] == RLY_ON ) {<font></font>
      PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD4); <span class="hljs-comment">//   -   1 </span>
       _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//      </span>
      PORTD &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PD3); <span class="hljs-comment">//   -   2 220</span><font></font>
      led_State = ABP_2RELAY;<font></font>
   } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span>( contactors[RLY_220G] == RLY_ON ) {<font></font>
         PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD3); <span class="hljs-comment">//   -   2 220</span>
         PORTD &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PD4); <span class="hljs-comment">//   -   1 </span><font></font>
         led_State = ABP_1RELAY;<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
         PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD3); <span class="hljs-comment">//   -   2 220</span>
         PORTD |=  (<span class="hljs-number">1</span> &lt;&lt; PD4); <span class="hljs-comment">//   -   1 </span><font></font>
         led_State = ABP_UNDEF;<font></font>
      }<font></font>
   }<font></font>
   <span class="hljs-keyword">if</span>( contactors[RLY_GEN] != RLY_ON ) { <span class="hljs-comment">// v2       -     </span>
      PORTD &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PD2); <span class="hljs-comment">//   -   -     -  </span>
   } <span class="hljs-keyword">else</span> {<font></font>
      PORTD |= (<span class="hljs-number">1</span> &lt;&lt; PD2); <span class="hljs-comment">//   -   -    </span><font></font>
   }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
   ports_init(); <span class="hljs-comment">//   ,   </span><font></font>
   <font></font>
   uart_init(); <span class="hljs-comment">// uart</span>
   <span class="hljs-built_in">stdout</span> =  &amp;uart_stream;<font></font>
   <font></font>
   counter2_init(); <span class="hljs-comment">//    </span>
   ADC_init(); <span class="hljs-comment">//    220</span>
   abp_timers_init(); <span class="hljs-comment">//      </span>
   timer1_init(); <span class="hljs-comment">//       1</span><font></font>
<font></font>
    set_sleep_mode(SLEEP_MODE_IDLE);  <span class="hljs-comment">//     IDLE</span><font></font>
    sleep_enable();<font></font>
<font></font>
    wdt_enable(WDTO_2S); <span class="hljs-comment">//       2 </span><font></font>
<font></font>
   sei(); <span class="hljs-comment">//   </span><font></font>
   <font></font>
   _delay_ms(<span class="hljs-number">1000</span>); <span class="hljs-comment">//    ,   0</span><font></font>
   wdt_reset();<font></font>
   <span class="hljs-built_in">printf</span>( <span class="hljs-string">"Start flag after reset = %u\r\n"</span>, mcusr_mirror );<font></font>
   abp_timer_start(TMR_PRINT);<font></font>
   <font></font>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<font></font>
    {<font></font>
      wdt_reset(); <span class="hljs-comment">//   </span><font></font>
      <font></font>
      validate220(); <span class="hljs-comment">//   220    </span><font></font>
   <font></font>
      validate_contactors(); <span class="hljs-comment">//      </span><font></font>
      <font></font>
      switch_contactors(); <span class="hljs-comment">//    </span><font></font>
      <font></font>
      <span class="hljs-comment">//     2 </span>
      <span class="hljs-keyword">if</span> (abp_timer_check(TMR_PRINT)) {
         <span class="hljs-built_in">printf</span>( <span class="hljs-string">"V220 = %4.2f VG = %4.2f\r\n"</span>, realV2, realV1 );
         <span class="hljs-built_in">printf</span>( <span class="hljs-string">"valid = %u %u \r\n"</span>, u220n, u220g );
         <span class="hljs-built_in">printf</span>( <span class="hljs-string">"rly = %u %u %u\r\n"</span>, contactors[RLY_220N], contactors[RLY_220G], contactors[RLY_GEN] );<font></font>
         abp_timer_start(TMR_PRINT);<font></font>
      }<font></font>
      <font></font>
        sleep_cpu(); <span class="hljs-comment">//      </span><font></font>
    }<font></font>
}<font></font>
</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
</div>
                    </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The program was developed using the free AVR Studio and uses standard AVR libraries. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the main loop, the program checks the voltage at the inputs of the inputs, evaluates the state of inclusion of the contactors, takes into account the operation of the program timers, makes the necessary adjustments by turning the relays and contactors on or off, and then goes into hibernation. </font><font style="vertical-align: inherit;">For debugging, the conclusion of debugging printing to the serial port of the microcontroller is made. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To control freezes, a watchdog timer is provided. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All measurement cycles are done on interrupts and using hardware timers. </font><font style="vertical-align: inherit;">The second counter is set on timer 1. Upon the interruption of timer 1, the software timers are updated, which are responsible for the delay on and off of contactors and generator relays.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second timer is used to create the flashing effect of the status LED. There are three flashing patterns. The values ‚Äã‚Äãfrom the blinking pattern are taken in the interruption of timer 2. By blinking, you can judge the status of the controller. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Two ADCs also work on timers and average 2500 samples of voltage measurements. To convert measurements to real volts, calibration constants are provided. Their values ‚Äã‚Äãmust be corrected during the configuration of the ATS. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, there are a number of constants that need to be determined during commissioning.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<pre><code class="cpp hljs">abp_timers[TMR_220N_ON].set_secs = <span class="hljs-number">10</span>; <span class="hljs-comment">//     </span>
abp_timers[TMR_220G_ON].set_secs = <span class="hljs-number">60</span>; <span class="hljs-comment">//        </span>
abp_timers[TMR_220N_OFF].set_secs = <span class="hljs-number">5</span>; <span class="hljs-comment">//     </span>
abp_timers[TMR_220G_OFF].set_secs = <span class="hljs-number">5</span>; <span class="hljs-comment">//     </span>
abp_timers[TMR_GEN_OFF].set_secs = <span class="hljs-number">60</span>; <span class="hljs-comment">//      </span>
</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The generator stop relay during operation from the generator is kept on, blocking the supply of voltage to the generator stop circuit. After the generator‚Äôs idle timer is completed, the relay turns off and current flows to the generator stop circuit through this relay. On the generator itself there is a special unit, which, after the appearance of voltage with some delay, closes the ignition circuit to ground, which leads to the generator stopping. The same block contains a generator charging circuit. If anyone is interested in the details, write in the comments, I will make a separate post about this block. There is no code in it, everything is hardware. </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If someone decides to repeat the ABP, then it is worth adjusting the settings. I do not publish the finished firmware, since the program still needs to be corrected during the configuration of the ATS.</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    

      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I must say that my ABP has been working for 4 years without problems, so the circuit can be considered verified as the code.</font></font></div>
      
    </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en507746/index.html">Why and how to check the site loading speed?</a></li>
<li><a href="../en507748/index.html">HMI based on Node-red and Scadavis.io</a></li>
<li><a href="../en507750/index.html">FlexCube - implementation of the revolutionary back-office platform at Rosbank</a></li>
<li><a href="../en507752/index.html">Why slow website loading kills SEO. And how can chinchillas not be left without houses</a></li>
<li><a href="../en507758/index.html">JavaScript memory - no leaks</a></li>
<li><a href="../en507772/index.html">Most Important From Apple's WWDC'20 Conference</a></li>
<li><a href="../en507780/index.html">Recursion of consciousness is a trap of thinking and a barrier to progress. Historical essay</a></li>
<li><a href="../es486176/index.html">Memo de correspondencia de correo electr√≥nico corporativo</a></li>
<li><a href="../es486178/index.html">FOSS News No. 1 - revisi√≥n de noticias gratuitas y de c√≥digo abierto del 27 de enero al 2 de febrero de 2020</a></li>
<li><a href="../es486180/index.html">Consejos y fuentes para crear aplicaciones sin servidor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>