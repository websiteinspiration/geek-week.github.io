<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèº üöä üéÖüèø L'Internet des objets dans Yandex.Cloud: comment les services Yandex IoT Core et Yandex Cloud Functions sont organis√©s üïì üë©üèø‚Äçüé§ üí©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En octobre de l'ann√©e derni√®re, la premi√®re conf√©rence sur le cloud Yandex Yandex Scale a eu lieu. Il a annonc√© le lancement de nombreux nouveaux serv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>L'Internet des objets dans Yandex.Cloud: comment les services Yandex IoT Core et Yandex Cloud Functions sont organis√©s</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/491740/"><img src="https://habrastorage.org/webt/wf/_u/zo/wf_uzobkj9vxp2ddkzxzux7lhbo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En octobre de l'ann√©e derni√®re, la premi√®re conf√©rence sur le cloud Yandex Yandex Scale a eu lieu. Il a annonc√© le lancement de nombreux nouveaux services, y compris Yandex IoT Core, qui vous permet d'√©changer des donn√©es avec des millions d'appareils IoT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je vais vous expliquer pourquoi Yandex IoT Core est n√©cessaire et comment il fonctionne, ainsi que comment il peut interagir avec d'autres services Yandex.Cloud. Vous en apprendrez sur l'architecture, les subtilit√©s de l'interaction des composants et les caract√©ristiques de la mise en ≈ìuvre des fonctionnalit√©s - tout cela vous aidera √† optimiser l'utilisation de ces services.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, rappelons les principaux avantages des clouds publics et de la PaaS - r√©duire le temps et les co√ªts de d√©veloppement, ainsi que les co√ªts de support et d'infrastructure, ce qui est √©galement pertinent pour les projets IoT. Mais il existe quelques fonctionnalit√©s utiles moins √©videntes que vous pouvez obtenir dans le cloud. Cette mise √† l'√©chelle efficace et cette tol√©rance aux pannes sont des aspects importants lorsque vous travaillez avec des appareils, en particulier dans les projets d'infrastructure d'informations critiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une mise √† l'√©chelle efficace est la capacit√© d'augmenter ou de diminuer librement le nombre d'appareils sans rencontrer de probl√®mes techniques et voir un changement pr√©visible du co√ªt du syst√®me apr√®s les changements.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tol√©rance aux pannes est l'assurance que les services sont con√ßus et d√©ploy√©s de mani√®re √† garantir les meilleures performances possibles m√™me en cas de d√©faillance de certaines ressources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entrons maintenant dans les d√©tails.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture de script IoT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons d'abord √† quoi ressemble l'architecture globale du script IoT. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z_/po/yk/z_poykwjdwprirjgwkxmkvjnq0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On y distingue deux grandes parties:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier est la livraison des donn√©es au stockage et la livraison des commandes aux appareils. </font><font style="vertical-align: inherit;">Lorsque vous cr√©ez un syst√®me IoT, cette t√¢che doit √™tre r√©solue dans tous les cas, quel que soit le projet que vous r√©alisez.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le second travaille avec les donn√©es re√ßues. </font><font style="vertical-align: inherit;">Tout est similaire √† tout autre projet bas√© sur l'analyse et la visualisation d'ensembles de donn√©es. </font><font style="vertical-align: inherit;">Vous disposez d'un r√©f√©rentiel avec un tableau initial d'informations, avec lequel travailler vous permettra de r√©aliser votre t√¢che.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re partie est approximativement la m√™me dans tous les syst√®mes IoT: elle est construite sur des principes g√©n√©raux et s'inscrit dans un sc√©nario commun adapt√© √† la plupart des syst√®mes IoT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxi√®me partie est presque toujours unique en termes de fonctions ex√©cut√©es, bien qu'elle soit construite sur des composants standard. Dans le m√™me temps, sans syst√®me d'interaction avec le mat√©riel de haute qualit√©, tol√©rant aux pannes et √©volutif, l'efficacit√© de la partie analytique de l'architecture est r√©duite √† presque z√©ro, car il n'y a tout simplement rien √† analyser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est pourquoi l'√©quipe Yandex.Cloud a tout d'abord d√©cid√© de se concentrer sur la cr√©ation d'un √©cosyst√®me de services pratique qui fournirait rapidement, efficacement et de mani√®re fiable des donn√©es des appareils aux stockages, et vice versa - envoyer des commandes aux appareils.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tq/k8/ug/tqk8ugcmjnp3-s3cscc4ldhmuou.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©soudre ces probl√®mes, nous travaillons sur la fonctionnalit√© et l'int√©gration de Yandex IoT Core, des fonctions Yandex et des services de stockage de donn√©es dans le Cloud: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le service Yandex IoT Core est un courtier MQTT √©volutif √† s√©curit√© int√©gr√©e avec un ensemble de fonctions utiles suppl√©mentaires.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le service Yandex Cloud Functions est repr√©sentatif de la direction prometteuse sans serveur et vous permet d'ex√©cuter votre code en tant que fonction dans un environnement s√ªr, tol√©rant aux pannes et √©volutif automatiquement sans cr√©er ni entretenir de machines virtuelles.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le stockage d'objets Yandex est un stockage efficace de tableaux de donn√©es volumineux et convient parfaitement aux enregistrements d'archives ¬´historiques¬ª.</font></font></li>
<li>          ,    ,      Yandex Managed Service for ClickHouse,     ¬´¬ª  .       ¬´¬ª      ,       ,     ,             .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les services de stockage et d'analyse de donn√©es sont des services `` √† usage g√©n√©ral '' qui ont d√©j√† √©t√© beaucoup √©crits, alors Yandex IoT Core et son interaction avec Yandex Cloud Functions posent g√©n√©ralement beaucoup de questions, en particulier pour les personnes qui commencent tout juste √† comprendre l'Internet des objets et les technologies cloud. </font><font style="vertical-align: inherit;">Et puisque ces services offrent une tol√©rance aux pannes et une mise √† l'√©chelle du travail avec les appareils, nous verrons d'abord ce qu'ils ont sous le capot.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment fonctionne Yandex IoT Core</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex IoT Core est un service de plateforme sp√©cialis√© pour l'√©change de donn√©es bidirectionnel entre le cloud et les appareils ex√©cutant le protocole MQTT. En fait, ce protocole est devenu la norme pour le transfert de donn√©es vers l'IoT. Il utilise le concept de files d'attente nomm√©es (rubriques), o√π, d'une part, vous pouvez √©crire des donn√©es, et d'autre part, les recevoir de mani√®re asynchrone en vous abonnant aux √©v√©nements de cette file d'attente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le service Yandex IoT Core est multi-locataire, ce qui signifie une seule entit√© accessible √† tous les utilisateurs. Autrement dit, tous les appareils et tous les utilisateurs interagissent avec la m√™me instance de service.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela permet, d'une part, d'assurer l'uniformit√© du travail pour tous les utilisateurs, d'autre part, une mise √† l'√©chelle efficace et une tol√©rance aux pannes, afin de maintenir une connexion avec un nombre illimit√© d'appareils et de traiter une quantit√© illimit√©e de donn√©es en volume et en vitesse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'ensuit que le service doit avoir √† la fois des m√©canismes de redondance et la capacit√© de g√©rer de mani√®re flexible les ressources utilis√©es - afin de r√©pondre aux changements de charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, la multi-location n√©cessite une logique particuli√®re de partage des droits d'acc√®s aux rubriques MQTT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment cela est mis en ≈ìuvre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme de nombreux autres services Yandex.Cloud, Yandex IoT Core est logiquement divis√© en deux parties - Plan de contr√¥le et Plan de donn√©es:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8a/u0/f3/8au0f3pzmwa1v-hhsxikvo_l_0m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data Plane est responsable de la logique de fonctionnement sous le protocole MQTT, et Control Plane est responsable de la d√©limitation des droits d'acc√®s √† certains sujets et utilise le registre et le p√©riph√©rique des entit√©s logiques √† cette fin. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eu/b1/1n/eub11nm0nlmhprrhfqzohfwcyow.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque utilisateur de Yandex.Cloud peut avoir plusieurs registres, chacun pouvant contenir son propre sous-ensemble d'appareils. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'acc√®s aux rubriques est fourni comme suit: Les </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/wc/hd/dfwchdy-bdwxs56mkgykrcs0ia4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
appareils peuvent envoyer des donn√©es uniquement √† leur rubrique d'√©v√©nements et √† la rubrique d'√©v√©nements de registre:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/events<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/events</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et abonnez-vous aux messages de votre rubrique de commandes et rubrique de commandes de registre:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/commands<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/commands</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le registre peut envoyer des donn√©es √† toutes les rubriques des commandes de p√©riph√©rique et √† la rubrique des commandes de registre:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/commands<font></font>
$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device2</span> <span class="hljs-attr">ID</span>&gt;</span>/commands<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/commands</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et abonnez-vous aux messages de tous les sujets des √©v√©nements de p√©riph√©rique et du sujet des √©v√©nements de registre:</font></font><br>
<br>
<pre><code class="xml hljs">$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device1</span> <span class="hljs-attr">ID</span>&gt;</span>/events<font></font>
$devices/<span class="hljs-tag">&lt;<span class="hljs-name">Device2</span> <span class="hljs-attr">ID</span>&gt;</span>/events<font></font>
$registries/<span class="hljs-tag">&lt;<span class="hljs-name">Registry</span> <span class="hljs-attr">ID</span>&gt;</span>/events</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour fonctionner avec toutes les entit√©s d√©crites ci-dessus, Data Plane poss√®de un protocole gRPC et un protocole REST, en fonction desquels l'acc√®s est impl√©ment√© via la console GUI de Yandex.Cloud et l'interface de ligne de commande CLI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant au Data Plane, il prend en charge la version 3.1.1 du protocole MQTT. </font><font style="vertical-align: inherit;">Cependant, il existe plusieurs fonctionnalit√©s:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la connexion, assurez-vous d'utiliser TLS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seule la connexion TCP est prise en charge. </font><font style="vertical-align: inherit;">WebSocket n'est pas encore disponible.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'autorisation est disponible √† la fois par login et mot de passe (o√π login est le p√©riph√©rique ou l'ID de registre, et les mots de passe sont d√©finis par l'utilisateur), et √† l'aide de certificats.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'indicateur Conserver n'est pas pris en charge lors de l'utilisation du courtier MQTT qui enregistre le message marqu√© avec l'indicateur et l'envoie la prochaine fois que vous vous abonnez √† la rubrique.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La session persistante n'est pas prise en charge, dans laquelle le courtier MQTT enregistre des informations sur le client (p√©riph√©rique ou registre) pour faciliter la reconnexion.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec l'abonnement et la publication, seuls les deux premiers niveaux de service sont pris en charge:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QoS0 - Au plus une fois. </font><font style="vertical-align: inherit;">Il n'y a pas de garantie de livraison, mais il n'y a pas de nouvelle livraison du m√™me message.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QoS1 - Au moins une fois. </font><font style="vertical-align: inherit;">La livraison est garantie, mais il est possible de recevoir √† nouveau le m√™me message.</font></font></li>
</ol></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour simplifier la connexion √† Yandex IoT Core, nous ajoutons r√©guli√®rement de nouveaux exemples pour diff√©rentes plateformes et langues √† notre r√©f√©rentiel sur GitHub, et d√©crivons √©galement des scripts dans la documentation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'architecture du service ressemble √† ceci: La </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6g/ig/4o/6gig4ofj7dksmbn18wvq5swkpuo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
logique m√©tier du service comprend quatre parties:</font></font><br>
<br>
<ol>
<li> Device management ‚Äî     .   Control Plane.</li>
<li> MQTT Broker ‚Äî  MQTT-.  Data Plane.</li>
<li> Triggers ‚Äî     Yandex Cloud Functions.  Data Plane.</li>
<li> Shards ‚Äî      MQTT-    .  Data Plane.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toute interaction avec le ¬´monde ext√©rieur¬ª passe par des √©quilibreurs de charge. De plus, conform√©ment √† la philosophie du dogfooding, Yandex Load Balancer est utilis√©, disponible pour tous les utilisateurs de Yandex.Cloud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque partie de la logique m√©tier se compose de plusieurs ensembles de trois machines virtuelles - une dans chaque zone de disponibilit√© (dans les sch√©mas A, B et C). Les machines virtuelles sont exactement les m√™mes que tous les utilisateurs de Yandex.Cloud. Lorsque la charge augmente, la mise √† l'√©chelle se fait √† l'aide de l'ensemble complet - trois machines sont ajout√©es √† la fois dans le cadre d'une partie de la logique m√©tier. Cela signifie que si un ensemble de trois machines MQTT Broker ne peut pas g√©rer la charge, un autre ensemble de trois machines MQTT Broker sera ajout√©, tandis que la configuration des autres parties de la logique m√©tier restera la m√™me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et seul Logbroker n'est pas accessible au public. Il s'agit d'un service pour un fonctionnement √† s√©curit√© int√©gr√©e efficace avec des flux de donn√©es. Il est bas√© sur Apache Kafka, mais il a de nombreuses autres fonctions utiles: il impl√©mente des processus de reprise apr√®s sinistre (y compris une seule s√©mantique lorsque vous avez une garantie de livraison de message sans duplication) et des processus de service (tels que la r√©plication entre centres, la distribution de donn√©es clusters de calcul), et dispose √©galement d'un m√©canisme de distribution uniforme et non dupliqu√©e des donn√©es entre les abonn√©s au flux - une sorte d'√©quilibreur de charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les fonctions de gestion des appareils dans Control Plane sont d√©crites ci-dessus. Mais avec Data Plane, tout est beaucoup plus int√©ressant.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque instance de MQTT Broker fonctionne ind√©pendamment et ne sait rien des autres instances. Toutes les donn√©es re√ßues (publi√©es par les clients) sont envoy√©es par les courtiers √† Logbroker, d'o√π elles sont r√©cup√©r√©es par Shards and Triggers. Et c'est dans les fragments que la synchronisation se produit entre les instances des courtiers. Les fragments connaissent tous les clients MQTT et la r√©partition de leurs abonnements (abonnement) entre les instances des courtiers MQTT et d√©terminent o√π envoyer les donn√©es re√ßues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, le client MQTT A est abonn√© au sujet √† partir du courtier A et le client MQTT B est abonn√© au m√™me sujet √† partir du courtier B. Si le client MQTT C effectue la publication sur le m√™me sujet, mais au courtier C, le fragment transf√®re les donn√©es de courtier C aux courtiers A et B, √† la suite de quoi les donn√©es seront re√ßues par le client MQTT A et le client MQTT B.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ia/dv/dz/iadvdzgd2cs6o1r3stjkqfhsq6y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La derni√®re partie de la logique m√©tier, D√©clencheurs, re√ßoit √©galement toutes les donn√©es re√ßues des clients MQTT et, si elles sont configur√©es par l'utilisateur, les transf√®re aux d√©clencheurs du service Yandex Cloud Functions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, Yandex IoT Core a une architecture et une logique de travail assez compliqu√©es, qui sont difficiles √† r√©p√©ter sur les installations locales. </font><font style="vertical-align: inherit;">Cela lui permet de r√©sister √† la perte de deux des trois zones de disponibilit√©, et de travailler sur un nombre illimit√© de connexions et des volumes de donn√©es illimit√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, toute cette logique est cach√©e √† l'utilisateur ¬´sous le capot¬ª, mais de l'ext√©rieur, tout semble tr√®s simple - comme si vous travaillez avec un seul courtier MQTT.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©clencheurs et fonctions cloud Yandex</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex Cloud Functions est un repr√©sentant des services dits "sans serveur" (sans serveur) dans Yandex.Cloud. L'essence principale de ces services est que l'utilisateur ne passe pas son temps √† configurer, d√©ployer et faire √©voluer l'environnement pour ex√©cuter du code, mais ne s'occupe que de la chose la plus pr√©cieuse pour lui - √©crire le code lui-m√™me qui effectue la t√¢che n√©cessaire. Dans le cas des fonctions, il s'agit du code dit sans √©tat atomique qui peut √™tre d√©clench√© par un √©v√©nement. ¬´Atomique¬ª et ¬´sans √©tat¬ª signifient que ce code doit effectuer une t√¢che relativement petite mais int√©grale, tandis que le code ne doit utiliser aucune variable afin de stocker des valeurs entre les appels.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe plusieurs fa√ßons d'appeler des fonctions: un appel HTTP direct, un appel avec minuterie (cron) ou un abonnement √† un √©v√©nement. Comme ce dernier, le service prend d√©j√† en charge l'abonnement aux files d'attente de messages (Yandex Message Queue), les √©v√©nements g√©n√©r√©s par le service de stockage d'objets et (le plus utile pour le sc√©nario IoT) l'abonnement aux messages dans Yandex IoT Core.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgr√© le fait que vous pouvez travailler avec Yandex IoT Core √† l'aide de n'importe quel client compatible MQTT, Yandex Cloud Functions est l'un des moyens les plus optimaux et pratiques pour recevoir et traiter des donn√©es. La raison en est tr√®s simple. Une fonction peut √™tre appel√©e sur chaque message entrant de n'importe quel appareil, et les fonctions seront ex√©cut√©es en parall√®le les unes aux autres (en raison de l'atomicit√© et de l'approche sans √©tat), et le nombre de leurs appels changera naturellement √† mesure que le nombre de messages entrants provenant des appareils changera. Ainsi, l'utilisateur peut ignorer compl√®tement les probl√®mes de mise en place de l'infrastructure et, de plus, contrairement aux m√™mes machines virtuelles, le paiement n'aura lieu que pour le travail r√©ellement effectu√©.Cela vous permettra d'√©conomiser consid√©rablement √† faible charge et d'obtenir un co√ªt clair et pr√©visible avec la croissance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le m√©canisme d'appel des fonctions sur les √©v√©nements (abonnement aux √©v√©nements) est appel√© d√©clencheur (Trigger). Son essence est illustr√©e dans le diagramme: Un </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5u/yv/bn/5uyvbnyviueygxt4ykzdh9n2nug.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
service qui g√©n√®re des √©v√©nements pour appeler des fonctions les place dans une file d'attente dans Logbroker. Dans le cas de Yandex IoT Core, les d√©clencheurs de Data Plane le font. De plus, ces √©v√©nements sont pris par le pr√©processeur, qui recherche un enregistrement dans la base de donn√©es pour cet √©v√©nement indiquant la fonction √† appeler. Si une telle entr√©e est trouv√©e, le pr√©processeur place les informations sur l'appel de fonction (ID de fonction et param√®tres d'appel) dans la file d'attente du service Yandex Message Queue, d'o√π le gestionnaire d'appel la r√©cup√®re. Le gestionnaire, √† son tour, envoie une demande HTTP pour appeler la fonction au service Yandex Cloud Functions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le m√™me temps, encore une fois, conform√©ment √† la philosophie dogfooding, le service Yandex Message Queue, accessible √† tous les utilisateurs, est utilis√© et les fonctions sont appel√©es exactement de la m√™me mani√®re que tout autre utilisateur peut appeler leurs fonctions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disons quelques mots sur Yandex Message Queue. Bien qu'il s'agisse d'un service de file d'attente, comme Logbroker, il existe une diff√©rence significative entre eux. Lors du traitement des messages des files d'attente, le gestionnaire informe la file d'attente qu'elle est termin√©e et que le message peut √™tre supprim√©. Il s'agit d'un m√©canisme de fiabilit√© important dans de tels services, mais il complique la logique de travail avec les messages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex Message Queue vous permet de ¬´parall√©liser¬ª le traitement de chaque message dans la file d'attente. En d'autres termes, le message de la file d'attente en cours de traitement ne bloque pas la possibilit√© qu'un autre "thread" r√©cup√®re l'√©v√©nement suivant de la file d'attente pour traitement. C'est ce qu'on appelle la simultan√©it√© au niveau du message. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et LogBroker fonctionne sur les groupes de messages, et tant que le groupe entier n'est pas trait√©, le groupe suivant ne peut pas √™tre r√©cup√©r√© pour traitement. Cette approche est appel√©e concurrence au niveau de la partition. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et c'est pr√©cis√©ment l'utilisation de Yandex Message Queue qui vous permet de traiter rapidement et efficacement en parall√®le un grand nombre de demandes pour appeler une fonction pour les √©v√©nements d'un service particulier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que les d√©clencheurs soient une unit√© ind√©pendante distincte, ils font partie du service Yandex Cloud Functions. Il nous suffit de comprendre exactement comment les fonctions sont appel√©es.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fb/ew/ke/fbewkedbrp6eyri7zkubwiu6dzu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les demandes d'appeler des fonctions (externes et internes) tombent dans l'√©quilibreur de charge, qui les distribue aux routeurs dans diff√©rentes zones d'acc√®s (AZ), plusieurs √©l√©ments sont d√©ploy√©s dans chaque zone. Lors de la r√©ception d'une demande, le routeur va d'abord au service Identity and Access Manager (IAM) pour s'assurer que la source de la demande a le droit d'appeler cette fonction. Il se tourne ensuite vers le planificateur et demande sur quel travailleur ex√©cuter la fonction. Worker est une machine virtuelle avec un runtime personnalis√© de fonctions isol√©es. De plus, le routeur, ayant re√ßu du planificateur l'adresse du travailleur sur lequel ex√©cuter la fonction, envoie une commande √† ce travailleur pour d√©marrer la fonction avec certains param√®tres.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'o√π vient le travailleur? C'est l√† que toute la magie sans serveur se produit. Les planificateurs, analysant la charge (le nombre et la dur√©e des fonctions), g√®rent (d√©marrent et arr√™tent) les machines virtuelles avec un runtime particulier. NodeJS et Python sont d√©sormais pris en charge. Et ici, un param√®tre est extr√™mement important - la vitesse de lancement des fonctions. L'√©quipe de d√©veloppement des services a fait un excellent travail, et maintenant la machine virtuelle d√©marre dans un maximum de 250 ms, tout en utilisant l'environnement le plus s√©curis√© pour isoler les fonctions les unes des autres - la virtualisation QEMU, qui ex√©cute tout Yandex. Cloud. Dans le m√™me temps, s'il existe d√©j√† un travailleur actif pour la demande entrante, la fonction d√©marre presque instantan√©ment.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, conform√©ment √† la m√™me approche dogfooding, le Load Balancer utilise un service public accessible √† tous les utilisateurs, et le travailleur, le planificateur et le routeur sont des machines virtuelles ordinaires, les m√™mes que tous les utilisateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la tol√©rance aux pannes du service est impl√©ment√©e au niveau de l'√©quilibreur de charge et de la redondance des composants cl√©s du syst√®me (routeur et ordonnanceur), et la mise √† l'√©chelle se produit en raison du d√©ploiement ou de la r√©duction du nombre de travailleurs. </font><font style="vertical-align: inherit;">De plus, chaque zone d'accessibilit√© fonctionne ind√©pendamment, ce qui permet de survivre √† la perte de m√™me deux des trois zones.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion, je souhaite vous donner quelques liens qui vous permettront d'√©tudier plus en d√©tail les services:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex IoT Core: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud.yandex.ru/services/iot-core</font></font></a> </li>
<li> Yandex Cloud Functions: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud.yandex.ru/services/functions</a> </li>
<li> Yandex Message Queue: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud.yandex.ru/services/message-queue</a> </li>
<li> Yandex Managed Service for ClickHouse: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud.yandex.ru/services/managed-clickhouse</a> </li>
<li> Yandex Load Balancer: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud.yandex.ru/services/load-balancer</a> </li>
<li> Yandex Object Storage: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud.yandex.ru/services/storage</a> </li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr491724/index.html">Le livre "Laravel. Guide complet. 2e √©dition</a></li>
<li><a href="../fr491726/index.html">D√©velopper les colonnes imbriqu√©es - listes utilisant le langage R (paquet tidyr et fonctions familiales unnest)</a></li>
<li><a href="../fr491728/index.html">Principe SEC avec Laravel</a></li>
<li><a href="../fr491732/index.html">Y a-t-il une vie apr√®s Scratch, ou comment initier un enfant √† Python</a></li>
<li><a href="../fr491736/index.html">TMS1000: le premier microcontr√¥leur disponible dans le commerce</a></li>
<li><a href="../fr491742/index.html">Sherbet: clavier de jeu ergonomique</a></li>
<li><a href="../fr491744/index.html">Des pirates iraniens ont exploit√© des vuln√©rabilit√©s dans un VPN</a></li>
<li><a href="../fr491746/index.html">L'histoire de la synth√®se vocale: l'√®re des solutions √©lectriques</a></li>
<li><a href="../fr491748/index.html">Technologies qui aident les aveugles √† apprendre l'anglais</a></li>
<li><a href="../fr491750/index.html">Nous √©crivons mieux la recherche de sous-cha√Ænes que dans les manuels</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>