<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèø‚Äçü§ù‚Äçüßëüèø üñïüèø üë®‚ÄçüöÄ C√°lculo r√°pido de f√≥rmulas de Excel en C # ü•å üò± üôãüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øCon qu√© frecuencia escucha a los clientes que enviar√°n datos a Excel o le pedir√°n que los importe o cargue en un formato compatible con Excel? Estoy ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C√°lculo r√°pido de f√≥rmulas de Excel en C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/498032/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øCon qu√© frecuencia escucha a los clientes que enviar√°n datos a Excel o le pedir√°n que los importe o cargue en un formato compatible con Excel? </font><font style="vertical-align: inherit;">Estoy seguro de que en la mayor√≠a de las √°reas, Excel es una de las herramientas m√°s populares, potentes y al mismo tiempo simples y convenientes. </font><font style="vertical-align: inherit;">Pero el punto m√°s problem√°tico es siempre la integraci√≥n de dichos datos con varios sistemas automatizados. </font><font style="vertical-align: inherit;">Se le pidi√≥ a nuestro equipo que considerara la posibilidad de realizar c√°lculos de datos utilizando la configuraci√≥n de un archivo Excel personalizado.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/8g/to/wx/8gtowxbs0dnpmjvr59epns8b0sq.jpeg" alt="C√°lculo r√°pido de f√≥rmulas de Excel en C #"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si necesita elegir una biblioteca productiva para trabajar con archivos Excel o si est√° buscando una soluci√≥n para calcular datos financieros complejos (y no solo) con una herramienta conveniente para administrar y visualizar f√≥rmulas listas para usar, bienvenido a cat.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al estudiar los requisitos de un nuevo proyecto en la empresa, encontramos un punto muy interesante: ‚ÄúLa soluci√≥n desarrollada deber√≠a poder calcular el costo del producto (es decir, el balc√≥n) al cambiar la configuraci√≥n y mostrar instant√°neamente el nuevo costo en la interfaz. Es necesario proporcionar la capacidad de descargar un archivo de Excel con todas las funciones de c√°lculo y listas de precios de componentes ". El cliente necesitaba desarrollar un portal para dise√±ar la configuraci√≥n de balcones en funci√≥n de los tama√±os, formas, tipos de acristalamiento y materiales utilizados, tipos de fijaciones, as√≠ como muchos otros par√°metros relacionados que se utilizan para calcular el costo exacto de producci√≥n y los indicadores de fiabilidad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formalizamos los requisitos de entrada para que sea m√°s f√°cil de entender en qu√© contexto fue necesario resolver el problema:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√°lculo r√°pido de precios en la interfaz al cambiar los par√°metros del balc√≥n;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√°lculo r√°pido de datos de dise√±o, incluidas muchas configuraciones diferentes de balcones y ofertas individuales, suministradas por un archivo de c√°lculo separado;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A largo plazo, el desarrollo de la funcionalidad utilizando varias operaciones que consumen recursos (tareas de optimizaci√≥n de par√°metros, etc.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo esto est√° en un servidor remoto con salida a trav√©s de API, porque </font><font style="vertical-align: inherit;">Todas las f√≥rmulas son propiedad intelectual del cliente y no deben ser visibles para terceros;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flujo de datos de entrada con pico de carga: el usuario puede cambiar los par√°metros con frecuencia y rapidez para seleccionar la configuraci√≥n del producto de acuerdo con sus requisitos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suena muy inusual y s√∫per tentador, ¬°comencemos!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soluciones llave en mano y preparaci√≥n de datos.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cualquier investigaci√≥n para resolver problemas complejos comienza con la navegaci√≥n en StackOverflow, GitHub y muchos foros en busca de soluciones listas para usar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se seleccionaron varias soluciones preparadas que admit√≠an la lectura de datos de archivos de Excel, adem√°s de poder realizar c√°lculos basados ‚Äã‚Äãen f√≥rmulas especificadas dentro de la biblioteca. </font><font style="vertical-align: inherit;">Entre estas bibliotecas hay soluciones completamente gratuitas y desarrollos comerciales.&nbsp;</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioteca</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentaci√≥n</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licencia</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/JanKallman/EPPlus</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/JanKallman/EPPlus/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licencia P√∫blica General de la Biblioteca GNU&nbsp;</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/EPPlusSoftware/EPPlus</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/EPPlusSoftware/EPPlus/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licencia no comercial de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polyform</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.0.0 ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">www.epplussoftware.com/LicenseOverview</font></a><font style="vertical-align: inherit;"> )&nbsp;</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/tonyqus/npoi</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/tonyqus/npoi/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licencia Apache 2.0</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aguja</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.e-iceblue.com/Introduce/excel-for-net-introduce.html</a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.e-iceblue.com/Tutorials/Spire.XLS/Spire.XLS-Program-Guide/Spire.XLS-Program-Guide-Content.html</a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.e-iceblue.com/Tutorials/Licensing/License-Agreement.html</a>&nbsp;</td>
</tr>
<tr>
<td><strong>Excel Interop</strong><i>(Microsoft.Office.Interop.Excel)</i></td>
<td>n/a</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docs.microsoft.com/ru-ru/dotnet/api/microsoft.office.interop.excel._workbook?view=excel-pia</a></td>
<td><i>  Excel     </i></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente paso es escribir pruebas de carga y medir el tiempo de ejecuci√≥n de cada biblioteca. Para hacer esto, prepare los datos de prueba. Creamos un nuevo archivo de Excel, definimos 10 celdas para los par√°metros de entrada y </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√≥rmula </font><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recuerde este momento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) para obtener un resultado que use todos los par√°metros de entrada. En la f√≥rmula, tratamos de utilizar todas las funciones matem√°ticas posibles de diversa complejidad computacional y combinarlas de una manera complicada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porque Tambi√©n se trata de dinero (el costo del producto), es importante tener en cuenta la precisi√≥n de los resultados. En este caso, tomaremos los valores resultantes que se obtuvieron utilizando </font><strong><font style="vertical-align: inherit;">Interoperabilidad de Excel</font></strong><font style="vertical-align: inherit;"> como referencia</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porque Los datos obtenidos de esta manera se calculan a trav√©s del n√∫cleo de Excel y son iguales a los valores que los clientes ven al desarrollar f√≥rmulas y calcular manualmente el costo.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como tiempo de ejecuci√≥n de referencia, utilizaremos c√≥digo nativo escrito manualmente en C # puro para mostrar la misma f√≥rmula escrita en Excel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√≥rmula de prueba inicial traducida:</font></font><br>
<br>
<pre><code class="plaintext hljs">public double Execute(double[] p)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return Math.Pow(p[0] * p[8] / p[4] * Math.Sin(p[5]) * Math.Cos(p[2]) +<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Math.Abs(p[1] - (p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8]))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Math.Sqrt(p[0] * p[0] + p[1] * p[1]) / 2.0 * Math.PI, p[9]);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formamos un flujo de datos de entrada aleatorios para N iteraciones (en este caso, usamos 10,000 vectores). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos los c√°lculos para cada vector de par√°metros de entrada en todo el flujo, obtenemos los resultados y medimos el tiempo de inicializaci√≥n de la biblioteca y el c√°lculo general. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comparar la precisi√≥n de los resultados, utilizamos dos indicadores: la desviaci√≥n est√°ndar y el porcentaje de valores coincidentes con un cierto paso de precisi√≥n epsilon. Si genera aleatoriamente una lista de valores de entrada con un punto flotante despu√©s del punto decimal, debe determinar la precisi√≥n de los par√°metros de entrada; esto le permitir√° obtener los resultados correctos. De lo contrario, los n√∫meros aleatorios pueden tener una gran diferencia de √≥rdenes de magnitud; esto puede afectar en gran medida la precisi√≥n de los resultados y la estimaci√≥n del error del resultado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porque Inicialmente, suponemos que es necesario operar con valores constantes del costo de los materiales, as√≠ como algunas constantes de diferentes campos de conocimiento, podemos aceptar que todos los par√°metros de entrada tendr√°n valores precisos de 3 decimales. Idealmente, debe especificar un rango v√°lido de valores para cada uno de los par√°metros y usarlos solo para generar valores aleatorios, pero dado que la f√≥rmula para la prueba se compil√≥ al azar sin ninguna justificaci√≥n matem√°tica y f√≠sica, entonces no es posible calcular dicho rango de valores para los 10 par√°metros en un per√≠odo de tiempo razonable. Por lo tanto, en los c√°lculos a veces es posible obtener un error de c√°lculo. Excluimos dichos vectores de datos de entrada ya en el momento del c√°lculo para los indicadores de precisi√≥n,pero contaremos tales errores como una caracter√≠stica separada.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura de prueba&nbsp;</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cada biblioteca independiente, su propia clase ha sido creado que implementa una interfaz </font></font><code>ITestExecutor </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que incluye 3 m√©todos - </font></font><code>SetUp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Execute </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>TearDown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">public interface ITestExecutor<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//      <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;void SetUp();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//   ,           <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;double Execute(double[] p);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//    ,      <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;void TearDown();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©todos </font></font><code>SetUp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>TearDown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilizan s√≥lo una vez en el proceso de probar la biblioteca y no se consideran cuando se mide c√°lculos de tiempo en todo el conjunto de datos de entrada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, el algoritmo de prueba se redujo a lo siguiente:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparaci√≥n de datos (formamos un flujo de vectores de entrada de una precisi√≥n dada);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asignaci√≥n de memoria para los datos resultantes (una matriz de resultados para cada biblioteca, una matriz con el n√∫mero de errores);&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicializaci√≥n de bibliotecas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtener resultados de c√°lculo para cada una de las bibliotecas con guardar el resultado en una matriz preparada previamente y registrar el tiempo de ejecuci√≥n;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalizaci√≥n del trabajo con el c√≥digo de bibliotecas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lisis de los datos:</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n se presenta una representaci√≥n gr√°fica de este algoritmo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/yg/e0/slyge0dloc1dednqql-hgga6um4.png" alt="Diagrama de flujo de pruebas de rendimiento y precisi√≥n de bibliotecas de soporte de Excel"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados de la primera iteraci√≥n</font></font></h1><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√çndice</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nativo</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
y </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aguja</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interoperabilidad de Excel</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiempo de inicializaci√≥n (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">257</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">266</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">632</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1653</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mie </font><font style="vertical-align: inherit;">tiempo para 1 pase (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0002</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,4086</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,6847</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.9782</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38.8423</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promedio </font><font style="vertical-align: inherit;">desviaci√≥n</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000394</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000395</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000237</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000631</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / A</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exactitud</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,99%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,92%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,97%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,84%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / A</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.94%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.94%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,52%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.94%</font></font></td>
</tr>
</tbody></table></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© se combinan los resultados de EPPlus 5 y EPPlus 4?</font></font></b>
                        <div class="spoiler_text">      EPPlus      .    ,       ,         .    ,         .     EPPlus 5     ,       .          ,      EPPlus,    .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera iteraci√≥n de las pruebas mostr√≥ un buen resultado, en el que los l√≠deres entre las bibliotecas se hicieron visibles de inmediato. </font><font style="vertical-align: inherit;">Como se puede ver en los datos anteriores, el l√≠der absoluto en esta situaci√≥n es la biblioteca EPPlus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los resultados no son impresionantes en comparaci√≥n con el c√≥digo nativo, pero puedes vivir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto podr√≠a haberse detenido, pero despu√©s de hablar con los clientes surgieron las primeras dudas: los resultados fueron demasiado buenos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zp/7s/ry/zp7sryxdmhkg5rp8xfhwf537kti.jpeg"></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caracter√≠sticas de trabajar con la biblioteca Spire</font></font></b>
                        <div class="spoiler_text">     Spire  ,             InvalidCastException.      ,          Excel-    ,     ,      ,     .                    try...catch.       ,         .<br>
</div>
                    </div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rastrillo de la primera iteraci√≥n de pruebas</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arriba, le ped√≠ que llamara su atenci√≥n sobre un punto que jug√≥ un papel importante en la obtenci√≥n de resultados. Sospechamos que las f√≥rmulas utilizadas en el archivo Excel real del cliente estar√≠an lejos de ser primitivas, con muchas dependencias en su interior, pero no sospechamos que esto podr√≠a afectar en gran medida a los indicadores. Sin embargo, inicialmente, al compilar los datos de prueba, no preve√≠a esto, y los datos del cliente (al menos la informaci√≥n de que se usan al menos 120 par√°metros de entrada en el archivo final) insinuaron que necesitamos pensar y agregar f√≥rmulas con dependencias entre celdas .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos a preparar nuevos datos para la pr√≥xima iteraci√≥n de pruebas. </font><font style="vertical-align: inherit;">Deteng√°monos en 10 par√°metros de entrada y agreguemos 4 nuevas f√≥rmulas adicionales con dependencia solo de par√°metros y 1 f√≥rmula de agregaci√≥n, que se basa en estas cuatro celdas con f√≥rmulas y tambi√©n se basar√° en los valores de los datos de entrada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La nueva f√≥rmula que se utilizar√° para las pruebas posteriores:</font></font><br>
<br>
<pre><code class="plaintext hljs">public double Execute(double[] p)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price1 = Math.Pow(p[0] * p[8] / p[4] * Math.Sin(p[5]) * Math.Cos(p[2]) +<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Math.Abs(p[1] - (p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8]))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Math.Sqrt(p[0] * p[0] + p[1] * p[1]) / 2.0 * Math.PI, p[9]);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price2 = p[4] * p[5] * p[2] / Math.Max(1, Math.Abs(p[7]));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price3 = Math.Abs(p[7] - p[3]) * p[2];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price4 = Math.Sqrt(Math.Abs(p[1] * p[2] + p[3] * p[4] + p[5] * p[6]) + 1.0);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price5 = p[0] * Math.Cos(p[1]) + p[2] * Math.Sin(p[1]);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var sum = p[0] + p[1] + p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8] + p[9];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price6 = sum / Math.Max(1, Math.Abs((p[0] + p[1] + p[2] + p[3]) / 4.0))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ sum / Math.Max(1, Math.Abs((p[4] + p[5] + p[6] + p[7] + p[8] + p[9]) / 6.0));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var pricingAverage = (price1 + price2 + price3 + price4 + price5 + price6) / 6.0;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return pricingAverage / Math.Max(1, Math.Abs(price1 + price2 + price3 + price4 + price5 + price6));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, la f√≥rmula resultante result√≥ ser mucho m√°s complicada, lo que naturalmente afect√≥ los resultados, no para mejor. </font><font style="vertical-align: inherit;">A continuaci√≥n se presenta una tabla con los resultados:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√çndice</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nativo</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4 </font></font></strong><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aguja</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interoperabilidad de Excel</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiempo de inicializaci√≥n (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">241</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">368</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">722</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1640</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mie </font><font style="vertical-align: inherit;">tiempo para 1 pase (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0004</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.9174 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 124%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.8996 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 177%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.7647 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 11%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,7194 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 30%)</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promedio </font><font style="vertical-align: inherit;">desviaci√≥n</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,035884</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / A</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exactitud</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">98,79%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / A</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.28%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3%</font></font></td>
</tr>
</tbody></table></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xg/l5/ye/xgl5yefp3_meak1f4qzj1mctjsm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: porque </font><font style="vertical-align: inherit;">La interoperabilidad de Excel es demasiado grande, tuvo que excluirse del gr√°fico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se puede ver en los resultados, la situaci√≥n se ha vuelto completamente inadecuada para su uso en la producci√≥n. </font><font style="vertical-align: inherit;">Un poco triste, abastecerse de caf√© y sumergirse en el estudio, directamente en la generaci√≥n del c√≥digo.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nv/d_/kh/nvd_khyfluufkuwh64vikgafdpe.jpeg"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codigo de GENERACION</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si de repente nunca enfrent√≥ una tarea similar, realizaremos una breve excursi√≥n.&nbsp;</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La generaci√≥n de c√≥digo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una forma de resolver un problema generando din√°micamente c√≥digo fuente basado en datos de entrada con posterior compilaci√≥n y ejecuci√≥n. </font><font style="vertical-align: inherit;">Hay una generaci√≥n de c√≥digo est√°tico que ocurre durante la construcci√≥n del proyecto (como ejemplo, puedo citar T4MVC, que crea un nuevo c√≥digo basado en plantillas y metadatos que se pueden usar al escribir el c√≥digo de la aplicaci√≥n principal), y un c√≥digo din√°mico que se ejecuta durante el tiempo de ejecuci√≥n.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestra tarea es formar una nueva funci√≥n basada en los datos de origen (f√≥rmulas de Excel), que recibe el resultado en funci√≥n del vector de valores de entrada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, debes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea la f√≥rmula del archivo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recoge todas las dependencias;</font></font></li>
<li>       C#;</li>
<li>     ;</li>
<li>            ;</li>
<li>     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas las bibliotecas presentadas son adecuadas para leer f√≥rmulas, sin embargo, la biblioteca </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> result√≥ ser la interfaz m√°s conveniente para dicha funcionalidad </font><font style="vertical-align: inherit;">. Habiendo hurgado un poco en el c√≥digo fuente de esta biblioteca, descubr√≠ las clases p√∫blicas para formar una lista de tokens y su posterior transformaci√≥n en un √°rbol de expresi√≥n. Bingo, pens√©! Un √°rbol de expresi√≥n listo para usar de la caja es ideal, simplemente rev√≠selo y forme nuestro c√≥digo C #.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero me esperaba una gran captura cuando comenc√© a estudiar los nodos del √°rbol de expresi√≥n resultante. Algunos nodos, en particular la llamada a las funciones de Excel, encapsularon informaci√≥n sobre la funci√≥n utilizada y sus par√°metros de entrada y no proporcionaron ning√∫n acceso abierto a estos datos. Por lo tanto, el trabajo con el √°rbol de expresi√≥n terminado tuvo que posponerse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos un nivel m√°s bajo e intentamos trabajar con la lista de tokens. Aqu√≠ todo es bastante simple: tenemos tokens que tienen tipo y valor. Porque se nos asigna una funci√≥n y necesitamos formar una funci√≥n, luego podemos convertir los tokens del √°rbol al equivalente en C #. Lo principal en este enfoque es organizar funciones compatibles. La mayor√≠a de las funciones matem√°ticas ya eran compatibles, como calcular el coseno, el seno, obtener la ra√≠z y elevar a una potencia. Pero las funciones de agregaci√≥n, como el valor m√°ximo, el m√≠nimo y la cantidad, deb√≠an completarse. La principal diferencia es que en Excel, estas funciones funcionan con un rango de valores. Para simplificar el prototipo, crearemos funciones que toman una lista de par√°metros como entrada, expandiendo previamente el rango de valores en una lista lineal.De esta forma obtenemos la conversi√≥n correcta y compatible de la sintaxis de Excel a la sintaxis de C #.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n se muestra el c√≥digo principal para convertir la lista de tokens de la f√≥rmula de Excel en un c√≥digo C # v√°lido.</font></font><br>
<br>
<pre><code class="plaintext hljs">private string TransformToSharpCode(string formula, ParsingContext parsingContext)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize basic compile components, e.g. lexer<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var lexer = new Lexer(parsingContext.Configuration.FunctionRepository, parsingContext.NameValueProvider);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// List of dependency variables that can be filled during formula transformation<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var variables = new Dictionary&lt;string, string&gt;();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;using (var scope = parsingContext.Scopes.NewScope(RangeAddress.Empty))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Take resulting code line<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var compiledResultCode = TransformToSharpCode(formula, parsingContext, scope, lexer, variables);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var output = new StringBuilder();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Define dependency variables in reverse order.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (var variableDefinition in variables.Reverse())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.AppendLine($"var {variableDefinition.Key} = {variableDefinition.Value};");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Take the result<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.AppendLine($"return {compiledResultCode};");<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return output.ToString();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
private string TransformToSharpCode(ICollection&lt;Token&gt; tokens, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var output = new StringBuilder();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;foreach (Token token in tokens)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token.TokenType)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Function:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(BuildFunctionName(token.Value));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.OpeningParenthesis:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append("(");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.ClosingParenthesis:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(")");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Comma:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(", ");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.ExcelAddress:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var address = token.Value;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(TransformAddressToSharpCode(address, parsingContext, scope, lexer, variables));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Decimal:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Integer:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Boolean:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(token.Value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Operator:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(token.Value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return output.ToString();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente matiz en la conversi√≥n fue el uso de constantes de Excel: son funciones, por lo que en C # tambi√©n deben incluirse en una funci√≥n.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Queda por resolver solo una pregunta: la conversi√≥n de referencias de celda a un par√°metro. En el caso en que el token contenga informaci√≥n sobre la celda, primero determinamos qu√© se almacena en esta celda. Si esta es una f√≥rmula, ampl√≠ela recursivamente. Si la constante se reemplaza con un enlace an√°logo C #, de la forma </font></font><code>p[row, column]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, donde </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede ser una matriz bidimensional o una clase de acceso indexado para la asignaci√≥n correcta de datos. Con un rango de celdas, hacemos lo mismo, solo expandimos previamente el rango en celdas individuales y las procesamos por separado. Por lo tanto, cubrimos la funcionalidad principal al traducir una funci√≥n de Excel.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/kk/hz/gwkkhzpfeudqdzcbfsgsdzdtolo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n se muestra el c√≥digo para convertir un enlace a una celda de hoja de c√°lculo de Excel en un c√≥digo C # v√°lido:</font></font><br>
<br>
<pre><code class="plaintext hljs">private string TransformAddressToSharpCode(string excelAddress, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Try to parse excel range of addresses<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Currently, reference to another worksheet in address string is not supported<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var rangeParts = excelAddress.Split(':');<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (rangeParts.Length == 1)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Unpack single excel address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return UnpackExcelAddress(excelAddress, parsingContext, scope, lexer, variables);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Parse excel range address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(rangeParts[0], out int startRowIndex, out int startColumnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(rangeParts[1], out int endRowIndex, out int endColumnIndex);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var rowDelta = endRowIndex - startRowIndex;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var columnDelta = endColumnIndex - startColumnIndex;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var allAccessors = new List&lt;string&gt;(Math.Abs(rowDelta * columnDelta));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// TODO This part of code doesn't support reverse-ordered range address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;for (var rowIndex = startRowIndex; rowIndex &lt;= endRowIndex; rowIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var columnIndex = startColumnIndex; columnIndex &lt;= endColumnIndex; columnIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Unpack single excel address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allAccessors.Add(UnpackExcelAddress(rowIndex, columnIndex, parsingContext, scope, lexer, variables));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return string.Join(", ", allAccessors);<font></font>
}<font></font>
<font></font>
private string UnpackExcelAddress(string excelAddress, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(excelAddress, out int rowIndex, out int columnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return UnpackExcelAddress(rowIndex, columnIndex, parsingContext, scope, lexer, variables);<font></font>
}<font></font>
<font></font>
private string UnpackExcelAddress(int rowIndex, int columnIndex, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var formula = parsingContext.ExcelDataProvider.GetRangeFormula(_worksheet.Name, rowIndex, columnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (string.IsNullOrWhiteSpace(formula))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// When excel address doesn't contain information about any excel formula, we should just use external input data parameter provider.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $"p[{rowIndex},{columnIndex}]";<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// When formula is provided, try to identify that variable is not defined yet<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// TODO Worksheet name is not included in variable name, potentially that can cause conflicts<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Extracting and reusing calculations via local variables improves performance for 0.0045ms<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var cellVariableId = $"C{rowIndex}R{columnIndex}";<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (variables.ContainsKey(cellVariableId))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return cellVariableId;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// When variable does not exist, transform new formula and register that to variable scope<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;variables.Add(cellVariableId, TransformToSharpCode(formula, parsingContext, scope, lexer, variables));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return cellVariableId;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo queda envolver el c√≥digo convertido resultante en una funci√≥n est√°tica, vincular el ensamblaje con funciones de compatibilidad y compilar el ensamblado din√°mico. </font><font style="vertical-align: inherit;">C√°rguelo en la memoria, obtenga un enlace a nuestra funci√≥n y podr√° usarlo.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escribimos una clase de envoltura para probar y ejecutar pruebas con medici√≥n de tiempo.&nbsp;</font></font><br>
<br>
<pre><code class="plaintext hljs">public void SetUp()<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize excel package by EPPlus library<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_package = new ExcelPackage(new FileInfo(_fileName));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_workbook = _package.Workbook;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_worksheet = _workbook.Worksheets[1];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_inputRange = new ExcelRange[10];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;for (int rowIndex = 0; rowIndex &lt; 10; rowIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_inputRange[rowIndex] = _worksheet.Cells[rowIndex + 1, 2];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Access to result cell and extract formula string<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_resultRange = _worksheet.Cells[11, 2];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var formula = _resultRange.Formula;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize parsing context and setup data provider<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var parsingContext = ParsingContext.Create();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;parsingContext.ExcelDataProvider = new EpplusExcelDataProvider(_package);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Transform Excel formula to CSharp code<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var sourceCode = TransformToSharpCode(formula, parsingContext);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Compile CSharp code to IL dynamic assembly via helper wrappers<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_code = CodeGenerator.CreateCode&lt;double&gt;(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sourceCode,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new string[]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// List of used namespaces<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System", // Required for Math functions<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ExcelCalculations.PerformanceTests" // Required for Excel function wrappers stored at ExcelCompiledFunctions static class<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new string[]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add reference to current compiled assembly, that is required to use Excel function wrappers located at ExcelCompiledFunctions static class<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"....\\bin\\Debug\\ExcelCalculations.PerformanceTests.exe"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Notify that this source code should use parameter;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Use abstract p parameter - interface for values accessing.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new CodeParameter("p", typeof(IExcelValueProvider))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, tenemos un prototipo de esta soluci√≥n y lo marcamos como </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-I</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Despu√©s de ejecutar las pruebas, obtenemos el resultado tan esperado. La aceleraci√≥n es casi 300 veces. Ya no est√° mal, pero el c√≥digo resultante sigue siendo 16 veces m√°s lento que el nativo. ¬øPodr√≠a ser mejor? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°S√≠ tu puedes! Intentemos mejorar el resultado debido al hecho de que reemplazaremos todos los enlaces a celdas adicionales con f√≥rmulas con variables. Nuestra prueba utiliza m√∫ltiples celdas dependientes en la f√≥rmula, por lo que en la primera versi√≥n del traductor recibimos m√∫ltiples c√°lculos de los mismos datos. Por lo tanto, se decidi√≥ utilizar variables intermedias en los c√°lculos. Despu√©s de expandir el c√≥digo utilizando la generaci√≥n de variables dependientes, obtuvimos un aumento de rendimiento de 2 veces m√°s. Esta mejora se llama</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus Compilado, Mark-II</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La tabla de comparaci√≥n se presenta a continuaci√≥n:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioteca</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mie </font><font style="vertical-align: inherit;">tiempo (ms)</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coef. </font><font style="vertical-align: inherit;">ralentizaciones</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nativo</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.00004</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus Compilado, Mark-II</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus Compilado, Mark-I</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0061</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diecis√©is</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,2089</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3023</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En estas condiciones y los l√≠mites de tiempo asignados para la tarea, obtuvimos un resultado que nos acerca al rendimiento del c√≥digo nativo con un ligero retraso, 8 veces, en comparaci√≥n con la versi√≥n original, un retraso de varios √≥rdenes de magnitud, 3028 veces. </font><font style="vertical-align: inherit;">¬øPero es posible mejorar el resultado y acercarse lo m√°s posible al c√≥digo nativo, si elimina los l√≠mites de tiempo y cu√°nto ser√° apropiado?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi respuesta es s√≠, pero, desafortunadamente, ya no tuve tiempo para implementar estas t√©cnicas. </font><font style="vertical-align: inherit;">Quiz√°s dedique un art√≠culo separado a este tema. </font><font style="vertical-align: inherit;">Por el momento, solo puedo hablar sobre las ideas y opciones principales, escribi√©ndolas en forma de res√∫menes cortos que han sido verificados por transformaci√≥n inversa. </font><font style="vertical-align: inherit;">Por conversi√≥n inversa, me refiero a la degradaci√≥n del c√≥digo nativo escrito a mano en la direcci√≥n del c√≥digo generado. </font><font style="vertical-align: inherit;">Este enfoque le permite verificar algunas tesis lo suficientemente r√°pido y no requiere cambios significativos en el c√≥digo. </font><font style="vertical-align: inherit;">Tambi√©n le permite responder a la pregunta de c√≥mo se deteriorar√° el rendimiento del c√≥digo nativo bajo ciertas condiciones, lo que significa que si el c√≥digo generado se mejora autom√°ticamente en la direcci√≥n opuesta, podemos obtener una mejora del rendimiento con un coeficiente similar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Res√∫menes</font></font></h2><br>
<ol>
<li>  ,                     ;</li>
<li>           inline      ;</li>
<li> -     Sum, Max, Min   ;</li>
<li>  Sum  inline     ;</li>
<li>   (         )    .</li>
</ol><br>
<h1></h1><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong></strong></td>
<td><strong>Native</strong></td>
<td><strong>EPPlus Compiled, Mark-II</strong></td>
<td><strong>EPPlus 4</strong><strong>EPPlus 5</strong></td>
<td><strong>NPOI</strong></td>
<td><strong>Spire</strong></td>
<td><strong>Excel Interop</strong></td>
</tr>
<tr>
<td><strong>  ()</strong></td>
<td>0</td>
<td>239</td>
<td>241</td>
<td>368</td>
<td>722</td>
<td>1640</td>
</tr>
<tr>
<td><strong>.   1  ()</strong></td>
<td>0,0004</td>
<td>0,003</td>
<td>0,9174</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,8996</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.7647</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,7194</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promedio </font><font style="vertical-align: inherit;">desviaci√≥n</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,035884</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / A</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exactitud</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">98,79%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100.0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / A</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Errores</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.28%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3%</font></font></td>
</tr>
</tbody></table></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kd/py/vy/kdpyvy0-qfqtfbwgtvbwjo28coo.png" alt="C√°lculo r√°pido de f√≥rmulas de Excel en C #"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resumiendo los pasos, tenemos un mecanismo para convertir f√≥rmulas directamente desde un documento Excel personalizado en c√≥digo de trabajo en el servidor. </font><font style="vertical-align: inherit;">Esto le permite utilizar la incre√≠ble flexibilidad de integrar Excel con cualquier soluci√≥n empresarial sin perder la potente interfaz de usuario con la que est√° acostumbrado a trabajar un gran n√∫mero de usuarios. </font><font style="vertical-align: inherit;">¬øFue posible desarrollar una interfaz tan conveniente con el mismo conjunto de herramientas para analizar y visualizar datos que en Excel durante un per√≠odo de desarrollo tan corto? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øY cu√°les fueron las integraciones m√°s inusuales e interesantes con los documentos de Excel que tuvo que implementar?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498022/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 341 (del 13 al 19 de abril)</a></li>
<li><a href="../es498024/index.html">Construyendo ciudades con un clic del mouse con Houdini y Python</a></li>
<li><a href="../es498026/index.html">FOSS News No. 12 - revisi√≥n de noticias gratuitas y de c√≥digo abierto del 13 al 19 de abril de 2020</a></li>
<li><a href="../es498028/index.html">Simulaci√≥n de la pandemia de Python COVID-19</a></li>
<li><a href="../es498030/index.html">Copia de seguridad: ¬ød√≥nde, c√≥mo y por qu√©?</a></li>
<li><a href="../es498034/index.html">El avi√≥n de dise√±o moderno est√° protegido contra amenazas biol√≥gicas (COVID-19) mejor de lo que piensas</a></li>
<li><a href="../es498036/index.html">Mark Andriessen: es hora de crear para nosotros mismos (es hora de construir)</a></li>
<li><a href="../es498038/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 411 (13-19 de abril de 2020)</a></li>
<li><a href="../es498042/index.html">Analizar, no validar</a></li>
<li><a href="../es498046/index.html">Los investigadores est√°n desarrollando un enfoque para reducir el sesgo en los conjuntos de datos de visi√≥n por computadora</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>