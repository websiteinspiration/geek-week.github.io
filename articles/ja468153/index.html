<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤚🏿 ⤴️ 👰🏾 Next.jsでの動的レンダリング 👏 ♓️ 📣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="キャッシュとサーバーレンダリング（SSR）
 Next.js（React）上のアプリケーションには、サーバー側のページがそのまま表示されます。これは、SEOとFMPメトリック（ページを開いてから最初の重要なコンテンツまでの時間）に非常に適しています。
 
 
 
 フレームワークはすぐにSSRで使用...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Next.jsでの動的レンダリング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468153/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャッシュとサーバーレンダリング（SSR）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next.js（React）上のアプリケーションには、サーバー側のページがそのまま表示されます。</font><font style="vertical-align: inherit;">これは、SEOと</font></font><abbr title="最初の意味のあるペイント"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FMP</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メトリック（ページを開いてから最初の重要なコンテンツまでの時間</font><font style="vertical-align: inherit;">）に非常に適して</font><font style="vertical-align: inherit;">います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eu/el/65/euel65zpnyiewg3jzvcn99r0_va.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームワーク</font><font style="vertical-align: inherit;">はすぐ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にSSR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で使用</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">できる</font></a><font style="vertical-align: inherit;">ように思え</font><font style="vertical-align: inherit;">ます</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">が</font></a><font style="vertical-align: inherit;">、なぜ記事を書くのでしょうか？</font><font style="vertical-align: inherit;">注意点が1つあります。ページを2回レンダリングします。最初はサーバー上で、次にクライアント上であり、合計読み込み時間は必然的に増加します。</font></font><br>
<br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSR、SSR、動的レンダリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、クライアント、サーバー、動的レンダリングについて少し補足します。</font></font><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSR</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSR</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小さなHTMLをダウンロード</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトをダウンロードする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトの初期化</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリング</font></font></li>
</ol><br>
</td>
<td><ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーレンダリング</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優れたHTMLとスタイルをダウンロードする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトをダウンロードする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトの初期化</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水分補給</font></font></li>
</ol><br>
</td>
</tr>
</tbody>
</table></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Googleでは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、SEOが重要な場合は動的レンダリングを使用することを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">お勧め</font></a><font style="vertical-align: inherit;">します。</font></font><br>
<blockquote>          (,   ).      ,       .        ,     ,   HTML-.        ,     .</blockquote><br>
<img src="https://habrastorage.org/getpro/habr/post_images/4bc/5b3/770/4bc5b3770f886915e5c8679a05cea95d.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの開発者であるアプリケーションやサイトは、マシンではなく、主にユーザーのために作られていることを忘れないでください。では、ロボット以外のサイトの表示を高速化してみませんか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーとマシンの両方でサーバーレンダリングを有効にします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSRをオンにした後、サイトの読み込み時間が無作為に増加していることがわかりました。私たちは反対を求めましたが。何故ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前にサーバーが小さなhtmlファイルをすぐに渡してから、ブラウザー自体がjavascript、cssをダウンロードしてページをレンダリングした場合、サーバーがページをレンダリングし、大きなhtmlをクライアントに送信するのを待っています。</font></font><br>
<img src="https://habrastorage.org/getpro/habr/post_images/ffb/848/ca9/ffb848ca9c82d6259b1f3ed15c06a80c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、SSRの利点は何ですか？</font><font style="vertical-align: inherit;">動的レンダリングを使用すべきではないでしょうか？</font><font style="vertical-align: inherit;">答えはアプリケーションによって異なります。</font><font style="vertical-align: inherit;">私たちの場合、すでに2番目のステップであるSSRの場合、スタイルと既製のマークアップを使用してページ全体が表示されているため、ユーザーはコンテンツをより早く受け取りました。</font><font style="vertical-align: inherit;">総ダウンロード時間は増加しましたが、最初の重要なコンテンツまでの時間ほど重要ではないと感じています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSR時間を短縮</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアント上で正しく準備された反応が迅速にレンダリングされる場合、サーバー上の反応は、サーバーメトリックによると、許されないほど遅くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、サーバーのレンダリングプロセスをキャッシュする必要があります。</font><font style="vertical-align: inherit;">しかし、これは、next.jsの箱から出してすでに機能していません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロセス自体とキャッシュメカニズムは、別の記事のトピックです。</font><font style="vertical-align: inherit;">express-jsには多くのライブラリがあり、何でもキャッシュするためのライブラリがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュが設定されているように見え、ページがすぐに読み込まれ始めました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャッシュがウォームアップされましたか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページのオープン時間は重要な指標です。そして、ダウンロードを待たずに離れることができる潜在的なクライアントの観点からだけではありません。検索エンジンも遅いウェブサイトを好きではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのプロジェクトには、フィルタリング結果を含む多くのページがあります。また、メインページがキャッシュの99.999％で開く場合、残りのページにアクセスする頻度が低くなり、コールドの開始の割合が比類なく高くなります。検索エンジンは明らかにこれを好まない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、他の人のために毎回フィルター設定を変更してキャッシュをウォームアップするユーザーは、明らかに自分の運命を羨ましく思わないでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
反応のレンダリングによってサーバーが水平方向にスケーリングされると、ウォームアップのケースが多くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
起動時にキャッシュ全体をウォームアップすることは現実的ではありません。そのような操作には数分かかる場合があります。</font><font style="vertical-align: inherit;">エレガントな解決策はありません。</font><font style="vertical-align: inherit;">ページの人気が低下するにつれて、分析結果に基づいてキャッシュをウォームするよう努力する必要があります。</font><font style="vertical-align: inherit;">覚えておきましょう。URLに多数のフィルタリングオプションが組み込まれていると、キャッシュ内のページ数が不適切に大きくなる可能性があります。</font><font style="vertical-align: inherit;">したがって、特定のしきい値を設定する価値があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変化：ユーザーエージェント</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし残念ながら、URLだけでなくユーザーエージェントによってもキャッシュする必要があります。</font><font style="vertical-align: inherit;">サーバーとモバイルデバイスの両方のプロセッサ時間も占めるようにモバイルデバイス用の複雑なメニューをレンダリングする必要がないので、後で「display：none」によって要素を非表示にしますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
わかりました、明確にして、キャッシングミドルウェアを改善してください。</font><font style="vertical-align: inherit;">ユーザーエージェントに応じて、3つの異なるレイアウトをレンダリングします。</font><font style="vertical-align: inherit;">チェック-動作します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Lighthouseで結果を確認すると、すべてがちらつきます。</font><font style="vertical-align: inherit;">Google Lighthouseで結果を確認すると、すべてがちらつきます。</font><font style="vertical-align: inherit;">ヘッダー `Vary：user-agent`を指定するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィキペディアから：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クローキング-（英語から。クローク-マントル、マスク、カバー）「ブラック」検索最適化の手法。これは、同じページでユーザーと検索ロボットに提供される情報が異なるという事実から成ります。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、心配しないでください。Googleの推奨事項からの抜粋です。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Googlebotは、ページのすべてのバージョンに同じコンテンツが含まれている場合、動的レンダリングを偽装とは見なしません。</font><font style="vertical-align: inherit;">&lt;...&gt;動的表示中にユーザーとロボットがまったく異なるバージョンのページを表示する場合、これは偽装と見なされます。</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各デバイス（モバイルまたはデスクトップ）は、対応する静的コンテンツを受信し始めました。</font><font style="vertical-align: inherit;">ちらつきのスタイルやコンテンツはありません。</font><font style="vertical-align: inherit;">総ダウンロード時間（10〜40ミリ秒）のわずかな増加により、検索エンジンのSEO要件を満たしながら、重要なコンテンツの配信速度を大幅に向上させました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468141/index.html">タスク：ロシア語のテキストから主要な表現を抽出する。Python NLP</a></li>
<li><a href="../ja468143/index.html">466テラビット：世界のインターネットトラフィックは増加し続けていますが、衛星は海底ケーブルと競合できますか？</a></li>
<li><a href="../ja468145/index.html">テストまたはタイプ？-錆びバージョン</a></li>
<li><a href="../ja468147/index.html">モスクワでの光のショー「Circle of Light」2019への招待と、サイトの1つからの小さなインサイダー</a></li>
<li><a href="../ja468151/index.html">GeekBrainsの脆弱性：コースをダウンロードできるだけなのに、なぜコースにお金を払うのですか？</a></li>
<li><a href="../ja468155/index.html">新製品のトレンド</a></li>
<li><a href="../ja468157/index.html">Ocmの一般理論に関するEcmaScriptの視点</a></li>
<li><a href="../ja468161/index.html">貪欲な著名人：太陽エネルギーが世界を征服しなかった理由と「ロシアの鉱物」がそれをどのように保存できるか</a></li>
<li><a href="../ja468163/index.html">Oracle VM Server for SPARC for Dummies（ハウツー）</a></li>
<li><a href="../ja468165/index.html">ブラウザが描画する方法。Yandexレポート</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>