<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèΩ ‚õπÔ∏è üå≠ Tentamos entender o StateFlow üßòüèª ü§πüèº ü§üüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° a todos. 
 
 Alguns dias atr√°s, o JetBrains lan√ßou uma nova vers√£o do Corutin - 1.3.6 e uma das inova√ß√µes foi a nova subesp√©cie do Flow - StateFlo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tentamos entender o StateFlow</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501308/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√° a todos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns dias atr√°s, o JetBrains lan√ßou uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nova vers√£o do Corutin - 1.3.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e uma das inova√ß√µes foi a nova subesp√©cie do Flow - StateFlow, que substitui o ConflatedBroadcastChannel. </font><font style="vertical-align: inherit;">Decidi experimentar o StateFlow em a√ß√£o e estudar a estrutura interna.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu acho que muitos que usam o Kotlin no desenvolvimento para Android ou MPP est√£o familiarizados com esses termos, que n√£o s√£o - essas entidades s√£o an√°logas ao BehaviorProcessor / BehaviorSubject do RxJava e LiveData / MutableLiveData do Jetpack. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O StateFlow em si √© uma extens√£o simples da interface Flow e vem de duas formas:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StateFlow</span>&lt;<span class="hljs-type">out T</span>&gt; : <span class="hljs-type">Flow</span>&lt;<span class="hljs-type">T</span>&gt; </span>{
    <span class="hljs-comment">/**
     * The current value of this state flow.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> value: T<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MutableStateFlow</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">StateFlow</span>&lt;<span class="hljs-type">T</span>&gt; </span>{
    <span class="hljs-comment">/**
     * The current value of this state flow.
     *
     * Setting a value that is [equal][Any.equals] to the previous one does nothing.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A id√©ia √© a mesma do LiveData / MutableLiveData - por uma interface, ele pode apenas ler o estado atual e pela outra, tamb√©m pode ser instalado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que a StateFlow nos oferece em compara√ß√£o com o ConflatedBroadcastChannel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Uma implementa√ß√£o interna mais simples e sem lixo. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A necessidade de um item padr√£o. </font><font style="vertical-align: inherit;">Nulo tamb√©m √© poss√≠vel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Separa√ß√£o em interfaces somente leitura e leitura / grava√ß√£o. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comparar elementos via igualdade em vez de comparar links. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos tentar implementar um uso simples do StateFlow. </font><font style="vertical-align: inherit;">Para fazer isso, criei um inv√≥lucro elementar com a capacidade de definir qualquer tipo com um elemento nulo por padr√£o:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateFlowRepository</span>&lt;<span class="hljs-type">T</span>&gt;</span>(initialValue: T? = <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> stateFlow = MutableStateFlow(initialValue)<font></font>
<font></font>
    <span class="hljs-keyword">var</span> value: T?
        <span class="hljs-keyword">get</span>() = stateFlow.value
        <span class="hljs-keyword">set</span>(value) {<font></font>
            stateFlow.value = value<font></font>
        }<font></font>
<font></font>
    <span class="hljs-keyword">val</span> stream: Flow&lt;T?&gt; = stateFlow<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s obtemos os dados:</font></font><br>
<br>
<pre><code class="kotlin hljs">lifecycleScope.launch {<font></font>
            simpleRepo.stream.collect {<font></font>
                addData(it.toString())<font></font>
            }<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E exibimos na tela a interface mais simples para testes, ela n√£o causa problemas e tudo funciona como um rel√≥gio: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/cv/_c/pncv_c41cwncgwkfc3hd3wxzfh0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
agora vamos olhar para dentro e ver como ela √© implementada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para minha surpresa, a implementa√ß√£o √© realmente muito simples e atualmente ocupa apenas 316 linhas, 25% das quais s√£o javadoki. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E assim, a principal classe de implementa√ß√£o √© a classe StateFlowImpl:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateFlowImpl</span>&lt;<span class="hljs-type">T</span>&gt;</span>(initialValue: Any) : SynchronizedObject(), MutableStateFlow&lt;T&gt;, FusibleFlow&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _state = atomic(initialValue) <span class="hljs-comment">// T | NULL</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sequence = <span class="hljs-number">0</span> <span class="hljs-comment">// serializes updates, value update is in process when sequence is odd</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> slots = arrayOfNulls&lt;StateFlowSlot?&gt;(INITIAL_SIZE)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> nSlots = <span class="hljs-number">0</span> <span class="hljs-comment">// number of allocated (!free) slots</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> nextIndex = <span class="hljs-number">0</span> <span class="hljs-comment">// oracle for the next free slot index</span><font></font>
<font></font>
. . .<font></font>
}<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_state</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - link at√¥mico para armazenar nosso estado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sequ√™ncia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - um indicador auxiliar que, dependendo da paridade / estranheza, informa sobre o processo atual de atualiza√ß√£o dos </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slots de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estado </font><font style="vertical-align: inherit;">- array / pool StateFlowSlot. StateFlowSlot - abstra√ß√£o auxiliar de cada "conex√£o" ao StateFlow. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nSlots, nextIndex</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - vari√°veis ‚Äã‚Äãauxiliares para trabalhar com os slots de matriz extens√≠veis </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos considerar StateFlowSlot antecipadamente. Ele representa apenas:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _state = atomic&lt;Any?&gt;(<span class="hljs-literal">null</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©todos positivos para alterar os estados dos slots. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada slot pode estar em um dos estados: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √© criado, mas n√£o √© usado </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NENHUM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estado PENDING do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coletor usado </font><font style="vertical-align: inherit;">- em antecipa√ß√£o ao envio de um novo valor ao coletor </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CancellableContinuationImpl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - estado suspenso pr√≥ximo ao estado PENDING de destino, est√° suspendendo o coletor at√© que um novo estado no fluxo de estado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere o que acontece quando voc√™ define um novo valor:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
        <span class="hljs-keyword">get</span>() = NULL.unbox(_state.value)
        <span class="hljs-keyword">set</span>(value) {
            <span class="hljs-keyword">var</span> curSequence = <span class="hljs-number">0</span>
            <span class="hljs-keyword">var</span> curSlots: Array&lt;StateFlowSlot?&gt; = <span class="hljs-keyword">this</span>.slots <span class="hljs-comment">// benign race, we will not use it</span>
            <span class="hljs-keyword">val</span> newState = value ?: NULL<font></font>
            synchronized(<span class="hljs-keyword">this</span>) {
                <span class="hljs-keyword">val</span> oldState = _state.value
                <span class="hljs-keyword">if</span> (oldState == newState) <span class="hljs-keyword">return</span> <span class="hljs-comment">// Don't do anything if value is not changing</span><font></font>
                _state.value = newState<font></font>
                curSequence = sequence<font></font>
                <span class="hljs-keyword">if</span> (curSequence and <span class="hljs-number">1</span> == <span class="hljs-number">0</span>) { <span class="hljs-comment">// even sequence means quiescent state flow (no ongoing update)</span>
                    curSequence++ <span class="hljs-comment">// make it odd</span><font></font>
                    sequence = curSequence<font></font>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// update is already in process, notify it, and return</span>
                    sequence = curSequence + <span class="hljs-number">2</span> <span class="hljs-comment">// change sequence to notify, keep it odd</span>
                    <span class="hljs-keyword">return</span><font></font>
                }<font></font>
                curSlots = slots <span class="hljs-comment">// read current reference to collectors under lock</span><font></font>
            }<font></font>
            <span class="hljs-comment">/*
               Fire value updates outside of the lock to avoid deadlocks with unconfined coroutines
               Loop until we're done firing all the changes. This is sort of simple flat combining that
               ensures sequential firing of concurrent updates and avoids the storm of collector resumes
               when updates happen concurrently from many threads.
             */</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// Benign race on element read from array</span>
                <span class="hljs-keyword">for</span> (col <span class="hljs-keyword">in</span> curSlots) {<font></font>
                    col?.makePending()<font></font>
                }<font></font>
                <span class="hljs-comment">// check if the value was updated again while we were updating the old one</span>
                synchronized(<span class="hljs-keyword">this</span>) {
                    <span class="hljs-keyword">if</span> (sequence == curSequence) { <span class="hljs-comment">// nothing changed, we are done</span>
                        sequence = curSequence + <span class="hljs-number">1</span> <span class="hljs-comment">// make sequence even again</span>
                        <span class="hljs-keyword">return</span> <span class="hljs-comment">// done</span><font></font>
                    }<font></font>
                    <span class="hljs-comment">// reread everything for the next loop under the lock</span><font></font>
                    curSequence = sequence<font></font>
                    curSlots = slots<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A principal tarefa aqui √© corrigir as altera√ß√µes do estado StateFlow de diferentes fluxos para chamadas sucessivas ao FlowCollector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√°rios passos podem ser distinguidos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definindo um novo valor.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definir o marcador de sequ√™ncia com um valor √≠mpar significa que j√° estamos no processo de atualiza√ß√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makePending () - configurando todos os estados do slot (ou seja, todas as conex√µes) para PENDING - em breve enviaremos um novo valor.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O loop verifica a sequ√™ncia == curSequence que todas as tarefas est√£o conclu√≠das e define a sequ√™ncia como um n√∫mero par.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que acontece no m√©todo de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coleta</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        <span class="hljs-keyword">val</span> slot = allocateSlot()
        <span class="hljs-keyword">var</span> prevState: Any? = <span class="hljs-literal">null</span> <span class="hljs-comment">// previously emitted T!! | NULL (null -- nothing emitted yet)</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// The loop is arranged so that it starts delivering current value without waiting first</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// Here the coroutine could have waited for a while to be dispatched,</span>
                <span class="hljs-comment">// so we use the most recent state here to ensure the best possible conflation of stale values</span>
                <span class="hljs-keyword">val</span> newState = _state.value
                <span class="hljs-comment">// Conflate value emissions using equality</span>
                <span class="hljs-keyword">if</span> (prevState == <span class="hljs-literal">null</span> || newState != prevState) {<font></font>
                    collector.emit(NULL.unbox(newState))<font></font>
                    prevState = newState<font></font>
                }<font></font>
                <span class="hljs-comment">// Note: if awaitPending is cancelled, then it bails out of this loop and calls freeSlot</span>
                <span class="hljs-keyword">if</span> (!slot.takePending()) { <span class="hljs-comment">// try fast-path without suspending first</span>
                    slot.awaitPending() <span class="hljs-comment">// only suspend for new values when needed</span><font></font>
                }<font></font>
            }<font></font>
        } <span class="hljs-keyword">finally</span> {<font></font>
            freeSlot(slot)<font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tarefa principal √© enviar o valor padr√£o inicial e aguardar novos valores: </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criamos ou reutilizamos um slot para uma nova conex√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificamos o estado para nulo ou para altera√ß√£o de estado. </font><font style="vertical-align: inherit;">Emittim √© um novo significado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificamos se h√° slots prontos para atualiza√ß√£o (estado PENDENTE) e, se n√£o, suspendemos o slot antecipando novos valores.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, √© tudo. </font><font style="vertical-align: inherit;">N√£o consideramos como ocorre a aloca√ß√£o de slots e a altera√ß√£o de seus estados, mas achei que isso n√£o √© importante para o quadro geral do StateFlow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt501292/index.html">Estimativa do custo de navios comerciais. Aritm√©tica e bom senso</a></li>
<li><a href="../pt501296/index.html">Como fazer carreira como programador sem resolver um problema de neg√≥cios</a></li>
<li><a href="../pt501298/index.html">Criando seu pr√≥prio reposit√≥rio de plug-in QGIS</a></li>
<li><a href="../pt501302/index.html">Por favor n√£o fa√ßa barulho</a></li>
<li><a href="../pt501306/index.html">Construindo um pipeline para entregar a Imagem Nativa Graal aos usu√°rios finais</a></li>
<li><a href="../pt501310/index.html">Sobre o per√≥xido de hidrog√™nio e o bug do foguete</a></li>
<li><a href="../pt501312/index.html">Alpine.js - estrutura leve com sintaxe conveniente</a></li>
<li><a href="../pt501316/index.html">Estudo da Microsoft: o treinamento de funcion√°rios √© um dos fatores-chave na introdu√ß√£o da intelig√™ncia artificial nos neg√≥cios</a></li>
<li><a href="../pt501318/index.html">Como usar js e folhas de google para se tornar vizinho de clube de golfe de Bill Gates</a></li>
<li><a href="../pt501320/index.html">Driver de LED com custo de BOM inferior a US $ 1. √â poss√≠vel?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>