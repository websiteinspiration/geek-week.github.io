<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔸 👩🏼‍🤝‍👨🏿 👎 Conférence DEFCON 27. Buttplug: True Penetration Testing. Partie 2 👼🏾 🍥 👨🏿‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les analystes estiment qu'il existe actuellement environ 10 milliards d'appareils du monde de l'Internet des objets (IoT). Parfois, ces appareils gagn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Conférence DEFCON 27. Buttplug: True Penetration Testing. Partie 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495792/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les analystes estiment qu'il existe actuellement environ 10 milliards d'appareils du monde de l'Internet des objets (IoT). Parfois, ces appareils gagnent leur place sur le marché, grimpant littéralement les culs humains. Il s'est avéré que les puces radio bon marché et de faible puissance ne sont pas seulement idéales pour la domotique - elles changent également la façon dont les gens interagissent avec les jouets sexuels. Dans ce rapport, nous allons plonger dans le monde de la télévision dildonique, la technologie du sexe à distance dans laquelle les sensations tactiles, thermiques et autres sont transmises entre partenaires via une ligne de communication bidirectionnelle. L'orateur vous dira que la sécurité des jouets sexuels électroniques électroniques Buttplug peut être opposée à un attaquant qui trouve et exploite des vulnérabilités à chaque niveau de la pile. En fin de compte, cela permet aux sextoys eux-mêmes d'être compromis,et les appareils auxquels ils se connectent.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un pirate avec le surnom de smea, ou Smealum, a commencé sa carrière en tant que développeur de jeux vidéo pour des consoles de jeux telles que Nintendo DS, en essayant simultanément de les casser. À un moment donné, les consoles ont acquis de sérieux systèmes de sécurité et Smea est passé de logiciels locaux à des techniques de développement pour les casser. Smea est connu pour son «travail» sur Nintendo 3DS et Wii U, bien qu'il ait également contribué au développement d'exploits pour les navigateurs Web et les piles de virtualisation les plus populaires. Probablement, maintenant, il s'est intéressé à percer des plugs anaux «intelligents».</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conférence DEFCON 27. Buttplug: True Penetration Testing. Partie 1</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xq/wz/de/xqwzdenvl7ovwamxxyxf_byvjiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bien sûr, vous pouvez gérer les messages entrants même avec une longueur de ligne aussi courte. Par exemple, 30 caractères suffisent pour exécuter du JavaScript malveillant. Cette diapositive montre un exemple de balise de 30 caractères pour une image provenant d'une source inexistante &lt;img src = a onerror = 'alert (1)'&gt;, ce qui fait que l'application affiche un message d'erreur. Ce message sera affiché chaque fois que le chargement de l'image est vraiment impossible. La capture d'écran montre que la connexion via un dongle compromis vous permet d'exécuter du JavaScript malveillant.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/p8/9x/kdp89xy1fdjf_ib5vcifs6wmix4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La limite de 32 caractères est ennuyeuse car il est difficile de réaliser la charge utile en volume, mais c'est tout à fait possible. Donc, vous voyez que nous avons réussi à compromettre l'application à l'aide d'une clé USB et que nous sommes maintenant à mi-chemin pour inverser le piratage, c'est-à-dire pour compromettre l'application à l'aide d'un bootplag de pirate. Le piratage sur un site de dongle-ordinateur peut se produire de deux manières: via un ordinateur, vous pouvez compromettre un dongle, et via un dongle, vous pouvez compromettre un ordinateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dongle agit comme un petit pont entre le plug de démarrage et l'application. La question se pose: est-il possible d'utiliser la même vulnérabilité pour compromettre une application sur un ordinateur directement via le bootplag. Malheureusement, la réponse à cette question est négative et la raison en est qu'il existe une autre limitation sur la longueur des caractères du message provenant du plug-in de démarrage de l'application.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/xp/_c/bixp_ckg43nxt6acd4aq_px4wae.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dongle emballe simplement les messages du bootplag et les transmet à l'application, et à cette étape, vous pouvez y insérer votre code HTML. Cependant, à la fois, il peut recevoir un message ne dépassant pas 20 octets, ce qui n'est pas suffisant pour effectuer une attaque XSS. Cependant, il y a un bug dans le firmware du dongle: il n'y a pas de vérification pour le terminateur nul à la fin de la ligne. Par conséquent, si vous pouvez placer des données non initialisées après la fin d'une chaîne de 20 caractères, vous pourrez envoyer l'application à plus de 20 caractères. Malheureusement, je n'ai pas trouvé de moyen d'utiliser cette vulnérabilité dans la pratique, mais une telle opportunité mérite d'être gardée à l'esprit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problème est donc que vous ne pouvez probablement pas utiliser cette vulnérabilité pour forcer l'application à exécuter le code reçu directement du plug-in de démarrage. Il est triste, mais encore plus triste que si vous regardez le firmware du dongle, vous pouvez voir qu'en principe il ne fait rien avec les données reçues, mais les copie simplement sur une nouvelle ligne et les envoie plus loin. Par conséquent, nous ne pourrons pas utiliser sa vulnérabilité pour attaquer en débordant la mémoire tampon. Cependant, s'il est impossible de pirater l'application directement à partir du plug-in de démarrage, il sera peut-être possible de le faire via la chaîne de démarrage-plug-dongle-computer? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La bonne chose est que la puce de dongle vous permet de placer beaucoup plus de code que nécessaire pour le programme de développement Lovense Hush d'origine.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9m/bf/k7/9mbfk7wqpqdoodi2nndnppiirfo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mémoire flash du dongle contient une zone réservée au chargeur DFU, une zone pour l'application Lovense elle-même et une zone SoftDevice fermée pour le pilote matériel de la puce BLE Nordic Semiconductor. C'est là que le protocole BLE lui-même est traité. Par exemple, lorsqu'une application souhaite envoyer un message BLE à un jouet, elle accède à SoftDevice via un appel SVC. En plus de ces 3 zones, le dongle dispose d'une zone inutilisée de mémoire flash d'un volume suffisamment important. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour trouver la vulnérabilité dans la pile BLE SoftDevice, vous devez utiliser la rétro-ingénierie, car elle n'est pas open-source. J'ai fait de même pour trouver la vulnérabilité du plug-in de firmware. Dans ce cas, il est très facile de suivre le flux de données, car il n'y a pas non plus d'ASLR, et il est facile de déterminer le code qui traitera ces messages.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/wq/ch/yhwqchpeynrmburahytjp2gxqd8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la droite de la diapositive, vous voyez le gestionnaire de paquets entrants GATTC (un profil d'attributs communs), qui, en substance, est un dongle. En particulier, il s'agit d'un gestionnaire de lecture par type de paquets de réponse. Je ne suis pas un spécialiste des appareils Bluetooth, mais je pense que le point ici est que le dongle lit le type de périphérique et utilise des gestionnaires pour toutes les variantes des attributs associés à ce type. Cela signifie qu'en fait, vous pouvez obtenir plus d'un attribut à la fois, et la taille de chaque gestionnaire d'une paire de données d'attribut est codée comme un champ à l'intérieur du package, ce qui vous permet de les gérer.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/sa/9h/cksa9hsxwiqwgqoyklkgwwhx2pa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diapositive montre un exemple d'un tel package. Les clients GATT peuvent envoyer un paquet de demande de lecture par type qui contient le type et la plage de descripteurs à lire. Les serveurs qui répondent à la demande de lecture par type renvoient des données associées aux gestionnaires dans la plage correspondant à ce type. Le nombre de paires descripteur / données est déterminé en divisant la longueur du paquet restant par la longueur de champ de la paire descripteur / données, et ce champ est toujours 0x7 ou 0x15.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/zf/gm/j7zfgmebqqi3va1lslmsmr3pzr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diapositive montre le fonctionnement de la fonction qui nous intéresse: vous voyez comment le paquet est rempli de données à partir d'un tableau d'attributs, et une longueur de tampon fixe leur est allouée. C'est là que la valeur du descripteur est placée, puis le pointeur qui lui est associé. Un tableau d'attributs est une donnée binaire placée à l'intérieur du tampon au format hexadécimal. Les données sont surlignées en bleu et à côté se trouve le descripteur 0D et son pointeur associé 00, il est surligné en orange. Le package des deuxième et troisième gestionnaires semble similaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vulnérabilité est la suivante. Si vous lisez le code à droite, vous pouvez voir le paramètre attribute_data_length placé dans le cadre violet - la longueur du message entrant, dont la valeur est entièrement contrôlée par un attaquant potentiel. Si nous y plaçons une valeur nulle, nous obtenons une boucle infinie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wk/mo/hi/wkmohi2rrehqx3o1mgupqhdseek.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La boucle devient infinie car le code ne vérifie pas si les données qu'il écrit dans le tampon de sortie se trouvent dans ce tampon de sortie. En conséquence, nous obtenons un débordement de tampon de pile classique, car le périphérique n'a pas d'ASLR ou DEP, et le code s'exécute immédiatement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En affectant une valeur de zéro et en obtenant une boucle infinie, vous remplacez en fait toutes les données RAM par des ordures. Cependant, il s'agit d'une solution infructueuse, car elle est susceptible de provoquer une défaillance de l'appareil. Mais si vous utilisez une valeur de 1, cela limitera le nombre d'octets contenus dans le message entrant. Cela signifie ce qui suit - vous pouvez légèrement surcharger ce tampon, puis le tampon, basé sur la pile, pourra endommager tout ce qui se trouve à côté.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/rf/iy/vgrfiyhiseechjyxntzkrztnp14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons à quoi ressemble la pile avant le débordement. Le tableau des attributs de tampon dont nous avons parlé est surligné en jaune, les registres enregistrés en bleu et l'adresse de retour en orange. En définissant la longueur d'attribut sur 0x01, nous pouvons provoquer un débordement de nombreuses paires poignée / pointeur de données. Les descripteurs se composent de 2 octets, mais les deux premiers octets du descripteur DWORD ne sont pas effacés. Le tampon que nous débordons est sur la pile sans cookies, ni ASLR, ni DEP.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/es/oo/ko/esooko6lhrdqef9gglnoyx2ffh8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous testons le système: envoyez un paquet plein d'octets 0xDA avec une longueur d'attribut 0x01. Il s'avère que nous réécrivons l'adresse de retour avec un pointeur sur nos données d'attribut. Puisqu'il n'y a pas de DEP, cela signifie qu'à chaque fois que la fonction revient, le code qui est à l'intérieur de notre package sera exécuté. La seule limitation est que nous avons besoin de l'adresse de retour pour que le LSB soit défini sur le bit le moins significatif, de sorte que le code s'exécute en mode Thumb, car le processeur Cortex M0 ne prend pas en charge le mode ARM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/5w/gl/rc5wglu00lbsx5v9gnix6v1as2c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous réécrivons également plusieurs variables locales, tout en veillant à ne pas réécrire quoi que ce soit utilisé sur le chemin du retour. Fondamentalement, nous obtenons un package de porte dérobée classique. Si vous faites attention à cette pile, vous verrez que la réécriture ne correspond pas à la bordure, ce qui entraînera le plantage du programme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une autre exigence concernant les registres stockés. Ce sont des variables locales qui sont également écrasées lorsque la fonction revient. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/kv/m2/ftkvm2tpkt7iepg-fwtrpx2kkiq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un d'eux est utilisé pour déréférencer une bordure 32 bits, et une incompatibilité de contenu avec la bordure entraînera le plantage du programme. Par conséquent, vous devez vous assurer que saved_arg_3 = 0, saved_arg_4 correspond à DWORD, c'est-à-dire qu'il se trouve à l'intérieur de la bordure et que LSB est défini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, nous devons nous assurer que ce package fonctionne. Heureusement, c'est vraiment facile, car la façon dont SoftDevice distribue ces paquets entrants est un tampon en anneau sans aucune exigence d'alignement forcé. Whiteshark a permis de vérifier que l'alignement du paquet suivant peut être contrôlé en modifiant la longueur du paquet précédent. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/3j/ia/mr3jiaai4k_cnlfzea9a0zyvgqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le jaune et le bleu ont mis en évidence 2 paquets envoyés avant l'envoi du paquet d'exploits. Cela me permet de contrôler l'alignement du dernier paquet et de faire en sorte qu'il ne provoque pas de plantage du programme, ce que nous visons.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je note qu'il existe un certain obstacle d'ingénierie: Nordic SoftDevice ne fournit pas d'interface pour l'envoi de paquets BLE bruts. </font><font style="vertical-align: inherit;">Pour le contourner, vous pouvez utiliser 2 options: implémenter votre propre pile BLE ou casser des crochets dans les packages d'origine. </font><font style="vertical-align: inherit;">Comme je suis paresseux, j'ai choisi l'option 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces crochets sont assez simples, mais nécessitent une ingénierie inverse. </font><font style="vertical-align: inherit;">Les méthodes de piratage peuvent être trouvées sur github, l'interface est assez «sale» et il n'y a aucune garantie que cela fonctionnera, mais je l'ai fait. </font><font style="vertical-align: inherit;">Il vaut mieux utiliser BTLEJack.</font></font><br>
<br>
<pre><code class="plaintext hljs">void ble_outgoing_hook(uint8_t* buffer, uint8_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce pointeur SoftDevice est appelé chaque fois qu'un paquet BLE est envoyé, il peut donc être modifié à l'avance:</font></font><br>
<br>
<pre><code class="plaintext hljs">int ble_incoming_hook(uint8_t* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce hook SoftDevice appelle chaque fois qu'un paquet BLE est reçu. La valeur de retour détermine si le traitement SoftDevice normal doit être ignoré.</font></font><br>
<br>
<pre><code class="plaintext hljs">int send_packet(void* handle, void* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble la fonction d'envoi du paquet brut à cette connexion BLE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment puis-je traiter plus de 4 octets de code à la fois? Besoin d'envoyer des colis! Sur la droite, vous voyez le tampon en anneau des paquets BLE entrants. Le premier paquet est affiché en vert: le code shell qui exécute un appel de fonction avec des paramètres contrôlés puis retourne «propre». Le deuxième paquet est affiché en jaune - il s'agit d'un tampon de données qui peut être utilisé par un appel de fonction. Le troisième paquet est affiché en bleu - un tampon contenant les valeurs des paramètres d'appel de fonction, et en orange - le paquet qui lance la vulnérabilité à l'aide de l'instruction C1 E7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/47/up/ki/47upki5tumqqj_c4ysc09rw2i0g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir renvoyé la fonction pure, nous pouvons renvoyer ce package. L'envoi de ces 4 paquets exécute n'importe quel morceau de code arbitraire à l'intérieur du dongle, et cela peut être fait encore et encore.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z2/hg/jg/z2hgjgfs0udpsjpfcm0l7gppqmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est pratique car de cette façon, je peux vraiment appeler memcpy plusieurs fois pour copier le plus grand code binaire du shell dans la RAM. Ensuite, nous appelons cette fonction pour patcher le code du dongle d'origine en mémoire et l'utiliser pour compromettre l'application installée sur l'ordinateur. Étant donné que la charge utile XSS est importante, nous ne l'envoyons pas, mais la générons dans le code shell sur le dongle lui-même. Le code shell est le suivant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c7/bi/oy/c7bioypcqko4flgvncaxbz8e2qm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À la suite de ces manipulations, on obtient ce qui suit: si nous pouvons contrôler l'application, alors nous pouvons contrôler le dongle et le bootplag.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zq/qj/dv/zqqjdv3mounl3az58buw63jinri.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe 2 façons de pirater la section dongle-dongle: le dongle peut compromettre le jouet et le buttplag peut compromettre à la fois le dongle et l'ordinateur. Le bonus est que la vulnérabilité Nordic BLE est présente non seulement dans les produits Lovense, mais aussi dans tous les appareils qui utilisent SoftDevise S110, S120 ou S130 pour le côté client de BLE.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc la possibilité de compromettre l'application en utilisant le bootplag. Comment cela peut-il être utilisé? Nous exécutons toujours du code JavaScript dans l'application Lovense, et la question est, qu'est-ce que cela nous donne? Il s'avère que l'application lovense.exe fonctionne sur Medium IL et fonctionne sur Windows, elle offre des possibilités vraiment illimitées: même sans privilèges d'administrateur, vous pouvez accéder aux fichiers sur votre ordinateur, vous pouvez exécuter du code arbitraire, vous pouvez implémenter XSS, accéder au réseau etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/zo/ng/zezongcdgttvaxcxleyye2bzrwi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La question suivante: si vous pouvez créer un programme de rançongiciel qui infecte non seulement le bootplag, mais aussi l'ordinateur de l'utilisateur, existe-t-il un moyen de le diffuser davantage en le rendant viral? Nous avons maintenant un piratage au niveau local, mais pour un pirate, il serait beaucoup plus utile de prendre le contrôle de nombreux ordinateurs d'utilisateurs via Internet. Comment faisons-nous cela? Les fonctions sociales du jouet, telles que le chat vidéo, le chat texte, le transfert d'image et la télécommande elle-même, augmentent considérablement la surface d'attaque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contrôle à distance est un excellent objectif, car si un développeur souhaite utiliser un programme propriétaire, il aura certainement des bugs et des vulnérabilités. Comment l'utiliser? Par exemple, vous pouvez envoyer à un partenaire un objet JSON contenant des commandes, par exemple, la commande "Vibrer: 10":</font></font><br>
<br>
<pre><code class="plaintext hljs">{<font></font>
cate: "id",<font></font>
id: {<font></font>
DEADBABEBEEF: {<font></font>
v: 10<font></font>
}<font></font>
}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, le récepteur analyse le JSON entrant, génère une commande pour le jouet et l'envoie plus loin, et ici il y a 2 modes. Le premier mode "id:" envoie une commande à un jouet sexuel spécifique, le deuxième mode "all:" envoie une commande à tous les jouets distants. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les données entrantes sont-elles validées correctement? Étant donné que JSON est très flexible, le code, en attendant un nombre, peut obtenir une chaîne entière à la place. Si nous pouvons contrôler les commandes envoyées au jouet, nous pouvons probablement utiliser le bug de l'analyseur de dongle. Sur la diapositive suivante, le cadre orange montre où les données d'entrée sont utilisées et le bleu montre où elles sont vérifiées.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce bogue est que l'application ne vérifie pas correctement que l'entrée d'une commande telle que vibrate est en fait un entier. Dans ce cas, en mode "id:", seulement que l'indice d'intensité de vibration est n&gt; = 0 est vérifié, et si vous passez un entier 12 supérieur à zéro, ce paramètre passera le test. Même si vous passez une chaîne, c'est-à-dire le nombre entre guillemets «12», le système l'acceptera. Il n'acceptera pas seulement une chaîne sous la forme d'une combinaison de chiffres et de lettres, par exemple, «12test».</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/wo/30/p3wo30wl9o4ep3sbfovnxegq2zw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, cette vérification ne nous permet pas d'entrer une commande de texte. Cependant, si vous regardez en bas du code, vous verrez la même vérification, mais cette fois, l'application vérifie la condition n &lt;0. Maintenant, si nous entrons "12test", nous ne passerons pas le test, car l'application considérera que l'expression donnée sous forme de chaîne n'est pas inférieure à 0. Mais si nous entrons une chaîne avec un contrôle d'inégalité de la forme! ("12test" &lt;0), le système la considérera comme vraie , malgré le fait qu'il ne s'agit pas d'un entier et non d'un nombre, mais d'une combinaison alphanumérique. En substance, cela signifie que nous pouvons entrer dans cette commande une chaîne arbitraire qui sera envoyée au dongle. Cela nous permet d'envoyer le code d'exploitation de la même manière que nous l'avons fait auparavant pour compromettre le dongle via l'analyseur JSON. La seule différence est que maintenant cela peut se faire via Internet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/br/ep/cv/brepcvtjvqntad29bb6yrjzvmqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, grâce à un bug dans l'implémentation du filtre pour vérifier les données entrantes, nous avons pu à distance via Internet via l'application Lovense pour compromettre le dongle, à travers lequel, à son tour, nous pouvons casser l'ordinateur de l'utilisateur. Pirater un dongle est une bonne chose, mais la condition du succès est le consentement du partenaire à transférer la télécommande du jouet à l'attaquant déguisé. Ceci est pratique pour une attaque ciblée, mais totalement inadapté à une attaque virale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, le chat texte et les images ne nécessitent aucune autorisation, ce qui permet parfaitement une attaque XSS classique en envoyant du code HTML malveillant dans un message texte de chat. La diffusion du virus devient triviale: il suffit de créer la bonne fonction JavaScript et de spammer vos amis.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/l_/8x/khl_8xhfj3bvdiisecommxrbloe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce stade, nous ne pouvons exécuter le code qu'en envoyant un message et avons essentiellement atteint notre objectif. </font><font style="vertical-align: inherit;">La charge utile XSS finale fonctionne comme ceci:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faites tout ce qui doit arriver sur la machine de la victime.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prenez un objet JavaScript qui vous permet d'accéder au chat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoyez une charge utile XSS qui télécharge ce script sur les ordinateurs de tous vos amis.</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/8_/x5/6c/8_x56cslpr-tywovkeqgo7qbml0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous avons compromis chaque nœud du réseau du plug-in de démarrage à Internet. </font><font style="vertical-align: inherit;">Maintenant, vous pouvez compromettre n'importe quel appareil à partir de n'importe quel appareil - nous avons créé un ver bout à bout, ou un virus appelé «ver de cul».</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/iq/lu/gjiqlujshp5vcsj5tm-hv6cbl8q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai promis, je vais maintenant vous montrer une vidéo en direct. La première chose que je vais montrer est d'utiliser la prise BTLE pour intercepter la connexion entre le plug-in de démarrage et la machine virtuelle Windows normale à laquelle le dongle est connecté. Maintenant, je vais essayer d'allumer le bootplag - j'espère que vous entendez tous les sons de vibration! (rire). Donc, ça a marché, maintenant je vais essayer d'ajouter mon jouet au panneau de contrôle de l'application. Voyez que le programme a trouvé Hush, mais attendez une minute! J'ai oublié de démarrer le processus de prise BTLE. La seule raison pour laquelle vous devez utiliser la prise BTLE dans ce mode est parce qu'elle facilite la démonstration en direct, mais en pratique, vous pouvez intercepter une connexion existante sans avoir besoin de renifler. Je lance donc cette chose juste pour simplifier l'expérience. Répétons encore une fois. Vous voyez que la connexion au jouet est établie.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/v6/_h/nzv6_hy7ygt8gu9nqx7opfjz6-u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le renifleur de gauche montre qu'il a trouvé cette connexion. Nous avons donc une application associée à notre sextoy. Je ne sais pas si vous entendez que je peux vraiment contrôler la prise de démarrage (smea déplace le curseur vers le haut, après quoi un son de vibration amplificateur est entendu). Maintenant, j'éteins cette chose (déplace le curseur vers le bas, le son des vibrations disparaît). Maintenant, je dois pirater cette connexion. Pour ce faire, je copie plusieurs paramètres, les colle dans la ligne smea @ ubuntu et à la fin j'entre le paramètre t - une commande pour intercepter la connexion.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u4/cm/bo/u4cmbo-uglzsqjur_ikimj7lifg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si cela fonctionne, cela interrompt la connexion avec l'application. Comme vous pouvez le voir, un message est apparu dans la fenêtre de l'application que la connexion avec l'appareil a été perdue. Merci BTLE jack pour un excellent outil! Le journal de démarrage s'est déconnecté de l'application et est désormais contrôlé via la machine virtuelle ubuntu. Théoriquement, nous devrions pouvoir le faire vibrer à distance. Je recrute une équipe Vibrate 20, et comme vous pouvez le voir, tout fonctionne - nous avons pu contrôler à distance le bootplag sans utiliser l'application officielle (applaudissements du public). Maintenant, je vais le mettre en mode DFU, et si cela fonctionne, je devrai arrêter cette chose. J'entre la commande appropriée et la vibration s'arrête.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1-/e4/xa/1-e4xaksu_5edfbsymanvlja6ii.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, je prends mon smartphone et vérifie si je peux reconnecter le jouet via l'application. Parmi mes applications, je trouve la mise à jour du plug-in du firmware et sélectionne le DfuTarg cible - l'appareil sur lequel il est nécessaire de mettre à jour le firmware, mais en fait - y introduit un exploit malveillant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/ft/wt/yjftwtho753czqelp_td1n8gtq4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous voyez comment se déroule le processus de mise à jour. Un message s'affiche à l'écran indiquant que le micrologiciel de l'appareil a été mis à jour avec succès. Maintenant, je vais essayer à nouveau de connecter le bootplag à l'application installée sur mon ordinateur, et vous voyez ce qui se passe: l'économiseur d'écran du ransomware apparaît à l'écran (applaudissements du public)! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/fz/tj/o6fztjlfigtenb5mujgp6ukz9ho.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
«Oups, votre plug anal est crypté! Payez pour la restauration de l'accès à cet important jouet avec 50 bitcoins en 3 jours, sinon en une semaine vous le perdrez pour toujours. Voici comment ça fonctionne!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, vous avez exécuté le code sur le dongle, puis sur l'ordinateur et via Internet, vous êtes arrivé à la prise de démarrage. Comme vous pouvez le voir, en termes de sécurité, ce plug anal est très faible, probablement il a été fabriqué par la Corée du Nord. Vous avez vu que j'avais installé une machine virtuelle qui exécutait l'application sans être connectée à un dongle ou à un autre matériel. Cette machine virtuelle venait d'être connectée à Internet et semblait être connectée à l'ordinateur de mon ami. Nous avons donc réussi à propager le virus rançongiciel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que d'après tout ce qui a été dit, quelques leçons utiles peuvent être tirées. En utilisant cet appareil comme exemple, nous avons examiné la vulnérabilité du monde de l'Internet des objets. Certains appareils sont utilisés pour le maintien de la vie, et les gens ne réalisent pas à quel point ces nouvelles technologies sont vulnérables. En piratant une chose «intelligente», vous pouvez brancher d'autres appareils «intelligents» dans votre maison via Internet. J'espère que le résultat de mes recherches ne s'applique pas seulement aux jouets sexuels. De plus, j'ai l'intention d'apprendre tout le code de cette chose, alors rejoignez-moi sur Twitter. Je vais également publier mes outils sur GitHub aujourd'hui au cas où vous voudriez commencer à pirater vos propres bootloops.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/45/wc/wp45wcacsbefq8-9i-6p3k-qqmg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je tiens à remercier tous mes amis qui m'ont aidé dans le pentesting et m'ont fait découvrir le monde des plugs de combat, les gays extrêmes. </font><font style="vertical-align: inherit;">Je ne donnerai pas de noms, mais Aaron, tu sais toi-même qui tu es (rires). </font><font style="vertical-align: inherit;">Merci les gars, c'était génial!</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicité :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des matériaux plus intéressants? Soutenez-nous en passant une commande ou en recommandant à vos amis, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS pour les développeurs à partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entrée de gamme que nous avons inventé pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la vérité sur VPS (KVM) E5-2697 v3 (6 cœurs) 10 Go DDR4 480 Go SSD 1 Gbit / s à partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'à 24 cœurs et jusqu'à 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de données Equinix Tier IV à Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV à partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - à partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> création d'un bâtiment d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 coûtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495782/index.html">FOSS News n ° 10 - examen des nouvelles gratuites et open source du 30 mars au 5 avril 2020</a></li>
<li><a href="../fr495784/index.html">SamsPcbGuide, Part 14: Technology - Microdevelopment and Chip-On-Technology Technology</a></li>
<li><a href="../fr495786/index.html">Annulation globale</a></li>
<li><a href="../fr495788/index.html">Un appareil d'un coronavirus ou un autre chariot d'une miche de pain?</a></li>
<li><a href="../fr495790/index.html">La bourse comme outil de couverture des risques: pourquoi avons-nous besoin de futures inhabituels</a></li>
<li><a href="../fr495794/index.html">À propos des verbes à particule</a></li>
<li><a href="../fr495796/index.html">Choisir des cartes Flash: un guide détaillé pour sécuriser les variétés numériques</a></li>
<li><a href="../fr495798/index.html">Kubernetes en 3 jours. À peu près compliqué</a></li>
<li><a href="../fr495800/index.html">Si j'ai enseigné Frontend aujourd'hui. Conseils pour débutants</a></li>
<li><a href="../fr495802/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 409 (30 mars - 5 avril 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>