<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî∏ üë©üèº‚Äçü§ù‚Äçüë®üèø üëé Conf√©rence DEFCON 27. Buttplug: True Penetration Testing. Partie 2 üëºüèæ üç• üë®üèø‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les analystes estiment qu'il existe actuellement environ 10 milliards d'appareils du monde de l'Internet des objets (IoT). Parfois, ces appareils gagn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Conf√©rence DEFCON 27. Buttplug: True Penetration Testing. Partie 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495792/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les analystes estiment qu'il existe actuellement environ 10 milliards d'appareils du monde de l'Internet des objets (IoT). Parfois, ces appareils gagnent leur place sur le march√©, grimpant litt√©ralement les culs humains. Il s'est av√©r√© que les puces radio bon march√© et de faible puissance ne sont pas seulement id√©ales pour la domotique - elles changent √©galement la fa√ßon dont les gens interagissent avec les jouets sexuels. Dans ce rapport, nous allons plonger dans le monde de la t√©l√©vision dildonique, la technologie du sexe √† distance dans laquelle les sensations tactiles, thermiques et autres sont transmises entre partenaires via une ligne de communication bidirectionnelle. L'orateur vous dira que la s√©curit√© des jouets sexuels √©lectroniques √©lectroniques Buttplug peut √™tre oppos√©e √† un attaquant qui trouve et exploite des vuln√©rabilit√©s √† chaque niveau de la pile. En fin de compte, cela permet aux sextoys eux-m√™mes d'√™tre compromis,et les appareils auxquels ils se connectent.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un pirate avec le surnom de smea, ou Smealum, a commenc√© sa carri√®re en tant que d√©veloppeur de jeux vid√©o pour des consoles de jeux telles que Nintendo DS, en essayant simultan√©ment de les casser. √Ä un moment donn√©, les consoles ont acquis de s√©rieux syst√®mes de s√©curit√© et Smea est pass√© de logiciels locaux √† des techniques de d√©veloppement pour les casser. Smea est connu pour son ¬´travail¬ª sur Nintendo 3DS et Wii U, bien qu'il ait √©galement contribu√© au d√©veloppement d'exploits pour les navigateurs Web et les piles de virtualisation les plus populaires. Probablement, maintenant, il s'est int√©ress√© √† percer des plugs anaux ¬´intelligents¬ª.</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conf√©rence DEFCON 27. Buttplug: True Penetration Testing. Partie 1</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xq/wz/de/xqwzdenvl7ovwamxxyxf_byvjiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bien s√ªr, vous pouvez g√©rer les messages entrants m√™me avec une longueur de ligne aussi courte. Par exemple, 30 caract√®res suffisent pour ex√©cuter du JavaScript malveillant. Cette diapositive montre un exemple de balise de 30 caract√®res pour une image provenant d'une source inexistante &lt;img src = a onerror = 'alert (1)'&gt;, ce qui fait que l'application affiche un message d'erreur. Ce message sera affich√© chaque fois que le chargement de l'image est vraiment impossible. La capture d'√©cran montre que la connexion via un dongle compromis vous permet d'ex√©cuter du JavaScript malveillant.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/p8/9x/kdp89xy1fdjf_ib5vcifs6wmix4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La limite de 32 caract√®res est ennuyeuse car il est difficile de r√©aliser la charge utile en volume, mais c'est tout √† fait possible. Donc, vous voyez que nous avons r√©ussi √† compromettre l'application √† l'aide d'une cl√© USB et que nous sommes maintenant √† mi-chemin pour inverser le piratage, c'est-√†-dire pour compromettre l'application √† l'aide d'un bootplag de pirate. Le piratage sur un site de dongle-ordinateur peut se produire de deux mani√®res: via un ordinateur, vous pouvez compromettre un dongle, et via un dongle, vous pouvez compromettre un ordinateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dongle agit comme un petit pont entre le plug de d√©marrage et l'application. La question se pose: est-il possible d'utiliser la m√™me vuln√©rabilit√© pour compromettre une application sur un ordinateur directement via le bootplag. Malheureusement, la r√©ponse √† cette question est n√©gative et la raison en est qu'il existe une autre limitation sur la longueur des caract√®res du message provenant du plug-in de d√©marrage de l'application.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/xp/_c/bixp_ckg43nxt6acd4aq_px4wae.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dongle emballe simplement les messages du bootplag et les transmet √† l'application, et √† cette √©tape, vous pouvez y ins√©rer votre code HTML. Cependant, √† la fois, il peut recevoir un message ne d√©passant pas 20 octets, ce qui n'est pas suffisant pour effectuer une attaque XSS. Cependant, il y a un bug dans le firmware du dongle: il n'y a pas de v√©rification pour le terminateur nul √† la fin de la ligne. Par cons√©quent, si vous pouvez placer des donn√©es non initialis√©es apr√®s la fin d'une cha√Æne de 20 caract√®res, vous pourrez envoyer l'application √† plus de 20 caract√®res. Malheureusement, je n'ai pas trouv√© de moyen d'utiliser cette vuln√©rabilit√© dans la pratique, mais une telle opportunit√© m√©rite d'√™tre gard√©e √† l'esprit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me est donc que vous ne pouvez probablement pas utiliser cette vuln√©rabilit√© pour forcer l'application √† ex√©cuter le code re√ßu directement du plug-in de d√©marrage. Il est triste, mais encore plus triste que si vous regardez le firmware du dongle, vous pouvez voir qu'en principe il ne fait rien avec les donn√©es re√ßues, mais les copie simplement sur une nouvelle ligne et les envoie plus loin. Par cons√©quent, nous ne pourrons pas utiliser sa vuln√©rabilit√© pour attaquer en d√©bordant la m√©moire tampon. Cependant, s'il est impossible de pirater l'application directement √† partir du plug-in de d√©marrage, il sera peut-√™tre possible de le faire via la cha√Æne de d√©marrage-plug-dongle-computer? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La bonne chose est que la puce de dongle vous permet de placer beaucoup plus de code que n√©cessaire pour le programme de d√©veloppement Lovense Hush d'origine.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9m/bf/k7/9mbfk7wqpqdoodi2nndnppiirfo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La m√©moire flash du dongle contient une zone r√©serv√©e au chargeur DFU, une zone pour l'application Lovense elle-m√™me et une zone SoftDevice ferm√©e pour le pilote mat√©riel de la puce BLE Nordic Semiconductor. C'est l√† que le protocole BLE lui-m√™me est trait√©. Par exemple, lorsqu'une application souhaite envoyer un message BLE √† un jouet, elle acc√®de √† SoftDevice via un appel SVC. En plus de ces 3 zones, le dongle dispose d'une zone inutilis√©e de m√©moire flash d'un volume suffisamment important. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour trouver la vuln√©rabilit√© dans la pile BLE SoftDevice, vous devez utiliser la r√©tro-ing√©nierie, car elle n'est pas open-source. J'ai fait de m√™me pour trouver la vuln√©rabilit√© du plug-in de firmware. Dans ce cas, il est tr√®s facile de suivre le flux de donn√©es, car il n'y a pas non plus d'ASLR, et il est facile de d√©terminer le code qui traitera ces messages.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/wq/ch/yhwqchpeynrmburahytjp2gxqd8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la droite de la diapositive, vous voyez le gestionnaire de paquets entrants GATTC (un profil d'attributs communs), qui, en substance, est un dongle. En particulier, il s'agit d'un gestionnaire de lecture par type de paquets de r√©ponse. Je ne suis pas un sp√©cialiste des appareils Bluetooth, mais je pense que le point ici est que le dongle lit le type de p√©riph√©rique et utilise des gestionnaires pour toutes les variantes des attributs associ√©s √† ce type. Cela signifie qu'en fait, vous pouvez obtenir plus d'un attribut √† la fois, et la taille de chaque gestionnaire d'une paire de donn√©es d'attribut est cod√©e comme un champ √† l'int√©rieur du package, ce qui vous permet de les g√©rer.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/sa/9h/cksa9hsxwiqwgqoyklkgwwhx2pa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diapositive montre un exemple d'un tel package. Les clients GATT peuvent envoyer un paquet de demande de lecture par type qui contient le type et la plage de descripteurs √† lire. Les serveurs qui r√©pondent √† la demande de lecture par type renvoient des donn√©es associ√©es aux gestionnaires dans la plage correspondant √† ce type. Le nombre de paires descripteur / donn√©es est d√©termin√© en divisant la longueur du paquet restant par la longueur de champ de la paire descripteur / donn√©es, et ce champ est toujours 0x7 ou 0x15.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/zf/gm/j7zfgmebqqi3va1lslmsmr3pzr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diapositive montre le fonctionnement de la fonction qui nous int√©resse: vous voyez comment le paquet est rempli de donn√©es √† partir d'un tableau d'attributs, et une longueur de tampon fixe leur est allou√©e. C'est l√† que la valeur du descripteur est plac√©e, puis le pointeur qui lui est associ√©. Un tableau d'attributs est une donn√©e binaire plac√©e √† l'int√©rieur du tampon au format hexad√©cimal. Les donn√©es sont surlign√©es en bleu et √† c√¥t√© se trouve le descripteur 0D et son pointeur associ√© 00, il est surlign√© en orange. Le package des deuxi√®me et troisi√®me gestionnaires semble similaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vuln√©rabilit√© est la suivante. Si vous lisez le code √† droite, vous pouvez voir le param√®tre attribute_data_length plac√© dans le cadre violet - la longueur du message entrant, dont la valeur est enti√®rement contr√¥l√©e par un attaquant potentiel. Si nous y pla√ßons une valeur nulle, nous obtenons une boucle infinie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wk/mo/hi/wkmohi2rrehqx3o1mgupqhdseek.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La boucle devient infinie car le code ne v√©rifie pas si les donn√©es qu'il √©crit dans le tampon de sortie se trouvent dans ce tampon de sortie. En cons√©quence, nous obtenons un d√©bordement de tampon de pile classique, car le p√©riph√©rique n'a pas d'ASLR ou DEP, et le code s'ex√©cute imm√©diatement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En affectant une valeur de z√©ro et en obtenant une boucle infinie, vous remplacez en fait toutes les donn√©es RAM par des ordures. Cependant, il s'agit d'une solution infructueuse, car elle est susceptible de provoquer une d√©faillance de l'appareil. Mais si vous utilisez une valeur de 1, cela limitera le nombre d'octets contenus dans le message entrant. Cela signifie ce qui suit - vous pouvez l√©g√®rement surcharger ce tampon, puis le tampon, bas√© sur la pile, pourra endommager tout ce qui se trouve √† c√¥t√©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/rf/iy/vgrfiyhiseechjyxntzkrztnp14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons √† quoi ressemble la pile avant le d√©bordement. Le tableau des attributs de tampon dont nous avons parl√© est surlign√© en jaune, les registres enregistr√©s en bleu et l'adresse de retour en orange. En d√©finissant la longueur d'attribut sur 0x01, nous pouvons provoquer un d√©bordement de nombreuses paires poign√©e / pointeur de donn√©es. Les descripteurs se composent de 2 octets, mais les deux premiers octets du descripteur DWORD ne sont pas effac√©s. Le tampon que nous d√©bordons est sur la pile sans cookies, ni ASLR, ni DEP.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/es/oo/ko/esooko6lhrdqef9gglnoyx2ffh8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous testons le syst√®me: envoyez un paquet plein d'octets 0xDA avec une longueur d'attribut 0x01. Il s'av√®re que nous r√©√©crivons l'adresse de retour avec un pointeur sur nos donn√©es d'attribut. Puisqu'il n'y a pas de DEP, cela signifie qu'√† chaque fois que la fonction revient, le code qui est √† l'int√©rieur de notre package sera ex√©cut√©. La seule limitation est que nous avons besoin de l'adresse de retour pour que le LSB soit d√©fini sur le bit le moins significatif, de sorte que le code s'ex√©cute en mode Thumb, car le processeur Cortex M0 ne prend pas en charge le mode ARM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/5w/gl/rc5wglu00lbsx5v9gnix6v1as2c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous r√©√©crivons √©galement plusieurs variables locales, tout en veillant √† ne pas r√©√©crire quoi que ce soit utilis√© sur le chemin du retour. Fondamentalement, nous obtenons un package de porte d√©rob√©e classique. Si vous faites attention √† cette pile, vous verrez que la r√©√©criture ne correspond pas √† la bordure, ce qui entra√Ænera le plantage du programme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une autre exigence concernant les registres stock√©s. Ce sont des variables locales qui sont √©galement √©cras√©es lorsque la fonction revient. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/kv/m2/ftkvm2tpkt7iepg-fwtrpx2kkiq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un d'eux est utilis√© pour d√©r√©f√©rencer une bordure 32 bits, et une incompatibilit√© de contenu avec la bordure entra√Ænera le plantage du programme. Par cons√©quent, vous devez vous assurer que saved_arg_3 = 0, saved_arg_4 correspond √† DWORD, c'est-√†-dire qu'il se trouve √† l'int√©rieur de la bordure et que LSB est d√©fini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, nous devons nous assurer que ce package fonctionne. Heureusement, c'est vraiment facile, car la fa√ßon dont SoftDevice distribue ces paquets entrants est un tampon en anneau sans aucune exigence d'alignement forc√©. Whiteshark a permis de v√©rifier que l'alignement du paquet suivant peut √™tre contr√¥l√© en modifiant la longueur du paquet pr√©c√©dent. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/3j/ia/mr3jiaai4k_cnlfzea9a0zyvgqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le jaune et le bleu ont mis en √©vidence 2 paquets envoy√©s avant l'envoi du paquet d'exploits. Cela me permet de contr√¥ler l'alignement du dernier paquet et de faire en sorte qu'il ne provoque pas de plantage du programme, ce que nous visons.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je note qu'il existe un certain obstacle d'ing√©nierie: Nordic SoftDevice ne fournit pas d'interface pour l'envoi de paquets BLE bruts. </font><font style="vertical-align: inherit;">Pour le contourner, vous pouvez utiliser 2 options: impl√©menter votre propre pile BLE ou casser des crochets dans les packages d'origine. </font><font style="vertical-align: inherit;">Comme je suis paresseux, j'ai choisi l'option 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces crochets sont assez simples, mais n√©cessitent une ing√©nierie inverse. </font><font style="vertical-align: inherit;">Les m√©thodes de piratage peuvent √™tre trouv√©es sur github, l'interface est assez ¬´sale¬ª et il n'y a aucune garantie que cela fonctionnera, mais je l'ai fait. </font><font style="vertical-align: inherit;">Il vaut mieux utiliser BTLEJack.</font></font><br>
<br>
<pre><code class="plaintext hljs">void ble_outgoing_hook(uint8_t* buffer, uint8_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce pointeur SoftDevice est appel√© chaque fois qu'un paquet BLE est envoy√©, il peut donc √™tre modifi√© √† l'avance:</font></font><br>
<br>
<pre><code class="plaintext hljs">int ble_incoming_hook(uint8_t* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce hook SoftDevice appelle chaque fois qu'un paquet BLE est re√ßu. La valeur de retour d√©termine si le traitement SoftDevice normal doit √™tre ignor√©.</font></font><br>
<br>
<pre><code class="plaintext hljs">int send_packet(void* handle, void* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble la fonction d'envoi du paquet brut √† cette connexion BLE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment puis-je traiter plus de 4 octets de code √† la fois? Besoin d'envoyer des colis! Sur la droite, vous voyez le tampon en anneau des paquets BLE entrants. Le premier paquet est affich√© en vert: le code shell qui ex√©cute un appel de fonction avec des param√®tres contr√¥l√©s puis retourne ¬´propre¬ª. Le deuxi√®me paquet est affich√© en jaune - il s'agit d'un tampon de donn√©es qui peut √™tre utilis√© par un appel de fonction. Le troisi√®me paquet est affich√© en bleu - un tampon contenant les valeurs des param√®tres d'appel de fonction, et en orange - le paquet qui lance la vuln√©rabilit√© √† l'aide de l'instruction C1 E7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/47/up/ki/47upki5tumqqj_c4ysc09rw2i0g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir renvoy√© la fonction pure, nous pouvons renvoyer ce package. L'envoi de ces 4 paquets ex√©cute n'importe quel morceau de code arbitraire √† l'int√©rieur du dongle, et cela peut √™tre fait encore et encore.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z2/hg/jg/z2hgjgfs0udpsjpfcm0l7gppqmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est pratique car de cette fa√ßon, je peux vraiment appeler memcpy plusieurs fois pour copier le plus grand code binaire du shell dans la RAM. Ensuite, nous appelons cette fonction pour patcher le code du dongle d'origine en m√©moire et l'utiliser pour compromettre l'application install√©e sur l'ordinateur. √âtant donn√© que la charge utile XSS est importante, nous ne l'envoyons pas, mais la g√©n√©rons dans le code shell sur le dongle lui-m√™me. Le code shell est le suivant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c7/bi/oy/c7bioypcqko4flgvncaxbz8e2qm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la suite de ces manipulations, on obtient ce qui suit: si nous pouvons contr√¥ler l'application, alors nous pouvons contr√¥ler le dongle et le bootplag.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zq/qj/dv/zqqjdv3mounl3az58buw63jinri.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe 2 fa√ßons de pirater la section dongle-dongle: le dongle peut compromettre le jouet et le buttplag peut compromettre √† la fois le dongle et l'ordinateur. Le bonus est que la vuln√©rabilit√© Nordic BLE est pr√©sente non seulement dans les produits Lovense, mais aussi dans tous les appareils qui utilisent SoftDevise S110, S120 ou S130 pour le c√¥t√© client de BLE.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc la possibilit√© de compromettre l'application en utilisant le bootplag. Comment cela peut-il √™tre utilis√©? Nous ex√©cutons toujours du code JavaScript dans l'application Lovense, et la question est, qu'est-ce que cela nous donne? Il s'av√®re que l'application lovense.exe fonctionne sur Medium IL et fonctionne sur Windows, elle offre des possibilit√©s vraiment illimit√©es: m√™me sans privil√®ges d'administrateur, vous pouvez acc√©der aux fichiers sur votre ordinateur, vous pouvez ex√©cuter du code arbitraire, vous pouvez impl√©menter XSS, acc√©der au r√©seau etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/zo/ng/zezongcdgttvaxcxleyye2bzrwi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La question suivante: si vous pouvez cr√©er un programme de ran√ßongiciel qui infecte non seulement le bootplag, mais aussi l'ordinateur de l'utilisateur, existe-t-il un moyen de le diffuser davantage en le rendant viral? Nous avons maintenant un piratage au niveau local, mais pour un pirate, il serait beaucoup plus utile de prendre le contr√¥le de nombreux ordinateurs d'utilisateurs via Internet. Comment faisons-nous cela? Les fonctions sociales du jouet, telles que le chat vid√©o, le chat texte, le transfert d'image et la t√©l√©commande elle-m√™me, augmentent consid√©rablement la surface d'attaque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contr√¥le √† distance est un excellent objectif, car si un d√©veloppeur souhaite utiliser un programme propri√©taire, il aura certainement des bugs et des vuln√©rabilit√©s. Comment l'utiliser? Par exemple, vous pouvez envoyer √† un partenaire un objet JSON contenant des commandes, par exemple, la commande "Vibrer: 10":</font></font><br>
<br>
<pre><code class="plaintext hljs">{<font></font>
cate: "id",<font></font>
id: {<font></font>
DEADBABEBEEF: {<font></font>
v: 10<font></font>
}<font></font>
}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, le r√©cepteur analyse le JSON entrant, g√©n√®re une commande pour le jouet et l'envoie plus loin, et ici il y a 2 modes. Le premier mode "id:" envoie une commande √† un jouet sexuel sp√©cifique, le deuxi√®me mode "all:" envoie une commande √† tous les jouets distants. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les donn√©es entrantes sont-elles valid√©es correctement? √âtant donn√© que JSON est tr√®s flexible, le code, en attendant un nombre, peut obtenir une cha√Æne enti√®re √† la place. Si nous pouvons contr√¥ler les commandes envoy√©es au jouet, nous pouvons probablement utiliser le bug de l'analyseur de dongle. Sur la diapositive suivante, le cadre orange montre o√π les donn√©es d'entr√©e sont utilis√©es et le bleu montre o√π elles sont v√©rifi√©es.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce bogue est que l'application ne v√©rifie pas correctement que l'entr√©e d'une commande telle que vibrate est en fait un entier. Dans ce cas, en mode "id:", seulement que l'indice d'intensit√© de vibration est n&gt; = 0 est v√©rifi√©, et si vous passez un entier 12 sup√©rieur √† z√©ro, ce param√®tre passera le test. M√™me si vous passez une cha√Æne, c'est-√†-dire le nombre entre guillemets ¬´12¬ª, le syst√®me l'acceptera. Il n'acceptera pas seulement une cha√Æne sous la forme d'une combinaison de chiffres et de lettres, par exemple, ¬´12test¬ª.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/wo/30/p3wo30wl9o4ep3sbfovnxegq2zw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, cette v√©rification ne nous permet pas d'entrer une commande de texte. Cependant, si vous regardez en bas du code, vous verrez la m√™me v√©rification, mais cette fois, l'application v√©rifie la condition n &lt;0. Maintenant, si nous entrons "12test", nous ne passerons pas le test, car l'application consid√©rera que l'expression donn√©e sous forme de cha√Æne n'est pas inf√©rieure √† 0. Mais si nous entrons une cha√Æne avec un contr√¥le d'in√©galit√© de la forme! ("12test" &lt;0), le syst√®me la consid√©rera comme vraie , malgr√© le fait qu'il ne s'agit pas d'un entier et non d'un nombre, mais d'une combinaison alphanum√©rique. En substance, cela signifie que nous pouvons entrer dans cette commande une cha√Æne arbitraire qui sera envoy√©e au dongle. Cela nous permet d'envoyer le code d'exploitation de la m√™me mani√®re que nous l'avons fait auparavant pour compromettre le dongle via l'analyseur JSON. La seule diff√©rence est que maintenant cela peut se faire via Internet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/br/ep/cv/brepcvtjvqntad29bb6yrjzvmqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, gr√¢ce √† un bug dans l'impl√©mentation du filtre pour v√©rifier les donn√©es entrantes, nous avons pu √† distance via Internet via l'application Lovense pour compromettre le dongle, √† travers lequel, √† son tour, nous pouvons casser l'ordinateur de l'utilisateur. Pirater un dongle est une bonne chose, mais la condition du succ√®s est le consentement du partenaire √† transf√©rer la t√©l√©commande du jouet √† l'attaquant d√©guis√©. Ceci est pratique pour une attaque cibl√©e, mais totalement inadapt√© √† une attaque virale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, le chat texte et les images ne n√©cessitent aucune autorisation, ce qui permet parfaitement une attaque XSS classique en envoyant du code HTML malveillant dans un message texte de chat. La diffusion du virus devient triviale: il suffit de cr√©er la bonne fonction JavaScript et de spammer vos amis.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/l_/8x/khl_8xhfj3bvdiisecommxrbloe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, nous ne pouvons ex√©cuter le code qu'en envoyant un message et avons essentiellement atteint notre objectif. </font><font style="vertical-align: inherit;">La charge utile XSS finale fonctionne comme ceci:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faites tout ce qui doit arriver sur la machine de la victime.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prenez un objet JavaScript qui vous permet d'acc√©der au chat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoyez une charge utile XSS qui t√©l√©charge ce script sur les ordinateurs de tous vos amis.</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/8_/x5/6c/8_x56cslpr-tywovkeqgo7qbml0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous avons compromis chaque n≈ìud du r√©seau du plug-in de d√©marrage √† Internet. </font><font style="vertical-align: inherit;">Maintenant, vous pouvez compromettre n'importe quel appareil √† partir de n'importe quel appareil - nous avons cr√©√© un ver bout √† bout, ou un virus appel√© ¬´ver de cul¬ª.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/iq/lu/gjiqlujshp5vcsj5tm-hv6cbl8q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai promis, je vais maintenant vous montrer une vid√©o en direct. La premi√®re chose que je vais montrer est d'utiliser la prise BTLE pour intercepter la connexion entre le plug-in de d√©marrage et la machine virtuelle Windows normale √† laquelle le dongle est connect√©. Maintenant, je vais essayer d'allumer le bootplag - j'esp√®re que vous entendez tous les sons de vibration! (rire). Donc, √ßa a march√©, maintenant je vais essayer d'ajouter mon jouet au panneau de contr√¥le de l'application. Voyez que le programme a trouv√© Hush, mais attendez une minute! J'ai oubli√© de d√©marrer le processus de prise BTLE. La seule raison pour laquelle vous devez utiliser la prise BTLE dans ce mode est parce qu'elle facilite la d√©monstration en direct, mais en pratique, vous pouvez intercepter une connexion existante sans avoir besoin de renifler. Je lance donc cette chose juste pour simplifier l'exp√©rience. R√©p√©tons encore une fois. Vous voyez que la connexion au jouet est √©tablie.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/v6/_h/nzv6_hy7ygt8gu9nqx7opfjz6-u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le renifleur de gauche montre qu'il a trouv√© cette connexion. Nous avons donc une application associ√©e √† notre sextoy. Je ne sais pas si vous entendez que je peux vraiment contr√¥ler la prise de d√©marrage (smea d√©place le curseur vers le haut, apr√®s quoi un son de vibration amplificateur est entendu). Maintenant, j'√©teins cette chose (d√©place le curseur vers le bas, le son des vibrations dispara√Æt). Maintenant, je dois pirater cette connexion. Pour ce faire, je copie plusieurs param√®tres, les colle dans la ligne smea @ ubuntu et √† la fin j'entre le param√®tre t - une commande pour intercepter la connexion.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u4/cm/bo/u4cmbo-uglzsqjur_ikimj7lifg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si cela fonctionne, cela interrompt la connexion avec l'application. Comme vous pouvez le voir, un message est apparu dans la fen√™tre de l'application que la connexion avec l'appareil a √©t√© perdue. Merci BTLE jack pour un excellent outil! Le journal de d√©marrage s'est d√©connect√© de l'application et est d√©sormais contr√¥l√© via la machine virtuelle ubuntu. Th√©oriquement, nous devrions pouvoir le faire vibrer √† distance. Je recrute une √©quipe Vibrate 20, et comme vous pouvez le voir, tout fonctionne - nous avons pu contr√¥ler √† distance le bootplag sans utiliser l'application officielle (applaudissements du public). Maintenant, je vais le mettre en mode DFU, et si cela fonctionne, je devrai arr√™ter cette chose. J'entre la commande appropri√©e et la vibration s'arr√™te.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1-/e4/xa/1-e4xaksu_5edfbsymanvlja6ii.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, je prends mon smartphone et v√©rifie si je peux reconnecter le jouet via l'application. Parmi mes applications, je trouve la mise √† jour du plug-in du firmware et s√©lectionne le DfuTarg cible - l'appareil sur lequel il est n√©cessaire de mettre √† jour le firmware, mais en fait - y introduit un exploit malveillant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/ft/wt/yjftwtho753czqelp_td1n8gtq4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous voyez comment se d√©roule le processus de mise √† jour. Un message s'affiche √† l'√©cran indiquant que le micrologiciel de l'appareil a √©t√© mis √† jour avec succ√®s. Maintenant, je vais essayer √† nouveau de connecter le bootplag √† l'application install√©e sur mon ordinateur, et vous voyez ce qui se passe: l'√©conomiseur d'√©cran du ransomware appara√Æt √† l'√©cran (applaudissements du public)! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/fz/tj/o6fztjlfigtenb5mujgp6ukz9ho.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬´Oups, votre plug anal est crypt√©! Payez pour la restauration de l'acc√®s √† cet important jouet avec 50 bitcoins en 3 jours, sinon en une semaine vous le perdrez pour toujours. Voici comment √ßa fonctionne!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, vous avez ex√©cut√© le code sur le dongle, puis sur l'ordinateur et via Internet, vous √™tes arriv√© √† la prise de d√©marrage. Comme vous pouvez le voir, en termes de s√©curit√©, ce plug anal est tr√®s faible, probablement il a √©t√© fabriqu√© par la Cor√©e du Nord. Vous avez vu que j'avais install√© une machine virtuelle qui ex√©cutait l'application sans √™tre connect√©e √† un dongle ou √† un autre mat√©riel. Cette machine virtuelle venait d'√™tre connect√©e √† Internet et semblait √™tre connect√©e √† l'ordinateur de mon ami. Nous avons donc r√©ussi √† propager le virus ran√ßongiciel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que d'apr√®s tout ce qui a √©t√© dit, quelques le√ßons utiles peuvent √™tre tir√©es. En utilisant cet appareil comme exemple, nous avons examin√© la vuln√©rabilit√© du monde de l'Internet des objets. Certains appareils sont utilis√©s pour le maintien de la vie, et les gens ne r√©alisent pas √† quel point ces nouvelles technologies sont vuln√©rables. En piratant une chose ¬´intelligente¬ª, vous pouvez brancher d'autres appareils ¬´intelligents¬ª dans votre maison via Internet. J'esp√®re que le r√©sultat de mes recherches ne s'applique pas seulement aux jouets sexuels. De plus, j'ai l'intention d'apprendre tout le code de cette chose, alors rejoignez-moi sur Twitter. Je vais √©galement publier mes outils sur GitHub aujourd'hui au cas o√π vous voudriez commencer √† pirater vos propres bootloops.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/45/wc/wp45wcacsbefq8-9i-6p3k-qqmg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je tiens √† remercier tous mes amis qui m'ont aid√© dans le pentesting et m'ont fait d√©couvrir le monde des plugs de combat, les gays extr√™mes. </font><font style="vertical-align: inherit;">Je ne donnerai pas de noms, mais Aaron, tu sais toi-m√™me qui tu es (rires). </font><font style="vertical-align: inherit;">Merci les gars, c'√©tait g√©nial!</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√© pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495782/index.html">FOSS News n ¬∞ 10 - examen des nouvelles gratuites et open source du 30 mars au 5 avril 2020</a></li>
<li><a href="../fr495784/index.html">SamsPcbGuide, Part 14: Technology - Microdevelopment and Chip-On-Technology Technology</a></li>
<li><a href="../fr495786/index.html">Annulation globale</a></li>
<li><a href="../fr495788/index.html">Un appareil d'un coronavirus ou un autre chariot d'une miche de pain?</a></li>
<li><a href="../fr495790/index.html">La bourse comme outil de couverture des risques: pourquoi avons-nous besoin de futures inhabituels</a></li>
<li><a href="../fr495794/index.html">√Ä propos des verbes √† particule</a></li>
<li><a href="../fr495796/index.html">Choisir des cartes Flash: un guide d√©taill√© pour s√©curiser les vari√©t√©s num√©riques</a></li>
<li><a href="../fr495798/index.html">Kubernetes en 3 jours. √Ä peu pr√®s compliqu√©</a></li>
<li><a href="../fr495800/index.html">Si j'ai enseign√© Frontend aujourd'hui. Conseils pour d√©butants</a></li>
<li><a href="../fr495802/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 409 (30 mars - 5 avril 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>