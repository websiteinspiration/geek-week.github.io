<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèª üê≥ üé± Monitoring in the data center: how we changed the old BMS to a new one. Part 2 üê§ üòû üè¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part, we talked about why we decided to change the old BMS system in our data centers to a new one. And not just change, but develop from...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Monitoring in the data center: how we changed the old BMS to a new one. Part 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/linxdatacenter/blog/498444/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f74/337/aba/f74337abaf221413fa0caf5be0549da0.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the first part, we talked about why we decided to change the old BMS system in our data centers to a new one. </font><font style="vertical-align: inherit;">And not just change, but develop from scratch to fit your requirements. </font><font style="vertical-align: inherit;">In the second part we tell how we did it.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Market analysis</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the </font><font style="vertical-align: inherit;">wishes and decisions </font><font style="vertical-align: inherit;">described in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first part</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , to refuse to upgrade the existing system, we wrote a statement of work to find a solution on the market and made inquiries to several large companies that are only involved in the creation of SCADA industrial systems.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first answers from them showed that the leaders of the monitoring systems market mainly continue to work on iron servers, although the process of migration to the clouds in this segment has already begun. </font><font style="vertical-align: inherit;">As for backup virtual machines - no one supported this option. </font><font style="vertical-align: inherit;">Moreover, there was a feeling that none of the developers visible on the market even showed an understanding of the need for redundancy: "the cloud does not fall," was the most common answer. </font><font style="vertical-align: inherit;">In fact, we were offered to place data center monitoring in a cloud physically located in the same data center.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here it is necessary to make a small digression about the process of selecting a contractor. The price, of course, matters, but during any tender for the implementation of a complex project, at the stage of dialogue with suppliers, you begin to feel which of the candidates is more interested and able to implement it.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is especially noticeable on complex projects.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the nature of the clarification questions for TK, it is possible to divide the contractors into those interested simply to sell (the standard pressure of the sales manager is felt) and those interested in developing the product, having heard and understanding the customer, to make constructive amendments to the technical specifications even before the final choice (even despite the real risk to improve someone else‚Äôs TK and lose the tender), in the end, just ready to accept the professional challenge and make a good product.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this made us pay attention to a relatively small local developer - the Sunline group of companies, which responded to most of our requirements right away and was ready to fulfill all the needs regarding the new BMS.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The risks</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While the big players were trying to understand what we want, and we were in leisurely correspondence with the help of presale specialists, a local developer made an appointment at our office with the participation of his technical team. </font><font style="vertical-align: inherit;">At this meeting, the contractor once again demonstrated a desire to participate in the project and - most importantly - explained how the required system will be implemented.&nbsp;&nbsp;&nbsp;&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before the meeting, we saw two risks of working with a team that does not have the resources of a large national or international company:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specialists could overestimate their capabilities and as a result simply cannot cope, for example, they will use sophisticated software or design impracticable backup algorithms.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the implementation of the project, the project team may break up and, therefore, product support will be in jeopardy.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To minimize these risks, we invited our own development specialists to the meeting. </font><font style="vertical-align: inherit;">Employees of a potential contractor were thoroughly interviewed about what the system is based on, how it is planned to implement reservations, and on other issues in which we, as an operation service, are not competent enough. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The verdict was positive: the architecture of the existing BMS platform is modern, simple and reliable, can be finalized, the proposed backup and synchronization scheme is logical and efficient.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They coped with the first risk. They excluded the second one, having received confirmation from the contractor that they were ready to give us the source code for the system and documentation, as well as choosing the Python programming language, which is well known to our specialists. This guaranteed us the opportunity to maintain the system on our own without any difficulties and a long period of training for employees in case the developer company leaves the market.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An additional advantage of the platform was that it was implemented in Docker containers: in this environment, the kernel, the web interface and the product database function. </font><font style="vertical-align: inherit;">This approach provides many advantages, including preset settings for the highest deployment speed of the solution compared to the "classics" and the simple addition of new devices to the system. </font><font style="vertical-align: inherit;">The principle of ‚Äúall together‚Äù simplifies the implementation of the system as much as possible: it is enough to unpack the system and you can immediately operate it.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With such a solution, it is easier to make copies of the system, and it is possible to improve it and implement upgrades in a separate environment, without stopping the solution as a whole.&nbsp;&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After both risks were minimized, the contractor provided KP. </font><font style="vertical-align: inherit;">It worked out all the most important parameters of the BMS system for us.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reservation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The new BMS system was supposed to be in the cloud on a virtual machine.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hardware, no servers and all the inconveniences and risks associated with this deployment model - the cloud solution allowed us to get rid of them forever. It was decided that the system will work in our cloud at two data center sites in St. Petersburg and Moscow. These are two fully functional systems operating in active standby mode with access for all authorized specialists.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The two systems insure each other, providing a full reserve for both computing power and data transmission channels. </font><font style="vertical-align: inherit;">Additional security measures have also been set up, including backing up data and channels, systems, virtual machines in general, and a separate database backup once a month (the most valuable resource in the perspective of management and analysis).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that redundancy as an option of the BMS-solution was developed specifically for our request. </font><font style="vertical-align: inherit;">The backup scheme itself looked like this:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0bf/d68/713/0bfd687131f3df7ed3b46c2d79358fc1.png"></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most important point for the effective operation of a BMS solution is technical support.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is simple here: a new system would cost us 35,000 rubles in this indicator. per month for the SLA "response within 8 hours", that is, 35,000 x 12/80 = $ 5,250 per year. The first year is free.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For comparison: the support of the old BMS from the vendor cost $ 18,000 dollars a year with an increase in the amount for each new device added! At the same time, the company did not provide a dedicated manager, all interaction took place through a sales manager who is interested in us as a potential buyer with a corresponding emphasis in processing requests.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For less money, we received full support for the product, with an account manager who would take part in the development of the product, with a single entry point, etc. </font><font style="vertical-align: inherit;">Support became much more flexible - thanks to direct access to developers for operational adjustments on any aspects of the system, integration via API, etc.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updates</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to the proposed KP in the new BMS, all updates are included in the cost of support, i.e. </font><font style="vertical-align: inherit;">do not require additional payment. </font><font style="vertical-align: inherit;">An exception is the development of additional functionality beyond that specified in the ToR.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The old system assumed payment both for updating the firmware of free software (such as Java) and for fixing bugs. </font><font style="vertical-align: inherit;">It was impossible to refuse this, in the absence of updates the system as a whole ‚Äúslowed down‚Äù due to old versions of internal components. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And, of course, it was impossible to update the software without buying a support package.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flexible approach</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another fundamental requirement concerned the interface. We wanted to provide access to it through a web browser from anywhere, without the presence of an engineer in the data center. In addition, we strove to create an animated interface, so that the dynamics of the functioning of the infrastructure was more visible to the duty engineers.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also in the new system, it was necessary to provide support for formulas for calculating the operation of virtual sensors in engineering systems - for example, for the optimal distribution of electrical power among racks with equipment. To do this, you must have at your disposal all the usual mathematical operations applicable to the indicators of sensors.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further, access to the SQL database was required with the ability to take from it the necessary data on the operation of the equipment - namely, all records on monitoring two thousand devices and two thousand virtual sensors that generate about 20 thousand variables.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also needed a module for accounting equipment in the rack, giving a graphical representation of the location of devices in each unit with the calculation of the total weight of hardware, maintaining a library of devices and detailed information about each element.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Harmonization of TK and signing of an agreement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At that time, when it was necessary to begin work on the new system, correspondence with "large" companies was still very far from discussing the cost of their proposals, so we compared the received KP with the costs of updating the old BMS (see the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first part</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), and As a result, it turned out to be more attractive in terms of price and corresponding to our requirements. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The choice has been made. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After choosing a contractor, lawyers began to draw up a contract, and technical teams on both sides polished the technical specifications. As you know, a detailed and competent TK is the basis for the success of any work. The more specifics in TK, the less disappointments like ‚Äúbut we didn‚Äôt like that‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will give two examples of the level of detail of requirements in TK:</font></font><br>
<br>
<ol>
<li>      BMS  ,    PDU.   BMS    ¬´¬ª,         ,     .    .         .     ,     :      ,         .       .</li>
<li>&nbsp;   BMS     :  ‚Äì   ,  ‚Äì  ,  ‚Äì ¬´¬ª.&nbsp;    ¬´¬ª      , ,     .                ,    BMS         .      <s></s>      ,     ,  ¬´¬ª  ,   ,  ¬´¬ª   ,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With a similar degree of detail, charting and reporting formats, interface outlines, a list of devices that needed to be monitored, and many other things were prescribed.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was a truly creative work of three working groups - customer service, which dictated its requirements and conditions; </font><font style="vertical-align: inherit;">technical specialists from both sides whose task was to convert these conditions into technical documentation; </font><font style="vertical-align: inherit;">teams of contractor programmers that implemented customer requirements for the developed technical documentation ... As a result, we adapted some of our unprincipled requirements to the functionality of an existing platform, something the contractor undertook to add for us.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parallel operation of two systems</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/194/055/485/1940554850185a57b43adf7fa805494f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is time for implementation. In practice, this meant that we were giving the contractor the opportunity to deploy a BMS prototype in our virtual cloud and provide network access to all devices that require monitoring. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover, the new system was not yet ready for operation. At this stage, it was important for us to maintain monitoring in the old system and at the same time give access to the devices of the new system. It is impossible to build a system normally without seeing devices in it, which in turn cannot be disconnected from monitoring by the old system.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Whether the devices can withstand simultaneous polling by two systems was not obvious without real tests. </font><font style="vertical-align: inherit;">There was a possibility that simultaneous double polling would lead to frequent denial of responses from devices and we would receive many errors due to device unavailability, which in turn would block the operation of the old monitoring system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The network department threw virtual routes from the prototype of the new BMS deployed in the cloud to devices, and we got the results:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices connected via SNMP protocol practically did not fall into disconnect due to simultaneous calls,&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devices connected via gateways using modbas-TCP protocols had problems that were resolved by a reasonable reduction in the frequency of their polling.&nbsp;&nbsp;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And then we began to observe how a new system was being built before our eyes, already familiar to us devices appeared in it, but in a different interface - convenient, fast, accessible even from the phone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will talk about what happened as a result in the third part of our article.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498430/index.html">What happens to transport on April 22</a></li>
<li><a href="../en498436/index.html">GitLab CI / CD Guide for the (almost) Absolute Beginner</a></li>
<li><a href="../en498438/index.html">8 easy questions for internship mentors</a></li>
<li><a href="../en498440/index.html">Threat Spotlight: Neshta File Virus</a></li>
<li><a href="../en498442/index.html">Comprehensive Static Analysis Using Polyspace Products</a></li>
<li><a href="../en498446/index.html">Job Questions: Imaginary Stability, False Devotion and Positioning</a></li>
<li><a href="../en498450/index.html">MultiSim redundancy - what it is and how it works</a></li>
<li><a href="../en498452/index.html">Django: A Quick Guide to Internationalization</a></li>
<li><a href="../en498454/index.html">Tales of the developers of your favorite games about what they are proud of</a></li>
<li><a href="../en498456/index.html">CSS Scroll Snapping Practice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>