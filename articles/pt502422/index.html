<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òïÔ∏è üëÇüèΩ ‚ùì Redu√ß√£o de 60% no tamanho do aplicativo React Native em algumas etapas simples üõåüèª üì´ ‚öîÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eu trabalho na Mutual . Ela trabalha no Brasil, no campo da igualdade de cr√©dito. Ajudamos mutu√°rios e credores a se conectarem. Os primeiros buscam b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Redu√ß√£o de 60% no tamanho do aplicativo React Native em algumas etapas simples</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/502422/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu trabalho na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ela trabalha no Brasil, no campo da igualdade de cr√©dito. </font><font style="vertical-align: inherit;">Ajudamos mutu√°rios e credores a se conectarem. </font><font style="vertical-align: inherit;">Os primeiros buscam boas apostas, enquanto os segundos buscam renda que excede o que o mercado pode oferecer. </font><font style="vertical-align: inherit;">Nosso produto √© usado por uma ampla gama de usu√°rios, trabalhamos em um pa√≠s grande. </font><font style="vertical-align: inherit;">Como resultado, nossos aplicativos iOS e Android React baseados em nativos s√£o baixados para dispositivos muito diferentes.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/59/3g/lf/593glf1nnlud4u0pbaogbghegiy.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note-se que a maioria dos nossos usu√°rios instala aplicativos em dispositivos econ√¥micos. </font><font style="vertical-align: inherit;">Podemos tirar essas conclus√µes usando os dados da biblioteca de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">classes de dispositivos</font></a><font style="vertical-align: inherit;"> do Facebook </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">no ano</font></a><font style="vertical-align: inherit;"> .</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esta biblioteca, ap√≥s receber informa√ß√µes sobre o modelo do dispositivo, informa em que ano esse dispositivo seria considerado um telefone principal de gama alta. </font><font style="vertical-align: inherit;">Por exemplo, o telefone mais popular entre nossos usu√°rios √© o Samsung Galaxy A10. </font><font style="vertical-align: inherit;">Este telefone, embora tenha sido lan√ßado em 2019, poderia ser considerado o carro-chefe apenas em 2013. Analisando dados em dispositivos de usu√°rios, podemos dizer que 85% desses dispositivos s√≥ poderiam ser reconhecidos como dispositivos de ponta em 2015 ou vers√µes anteriores. </font><font style="vertical-align: inherit;">Por esse motivo, temos requisitos especiais para otimizar nosso aplicativo m√≥vel. </font><font style="vertical-align: inherit;">O objetivo da otimiza√ß√£o √© que mesmo usu√°rios com dispositivos fracos possam usar confortavelmente nosso aplicativo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/e6b/cf3/1e2e6bcf354e0ed85e47f70b1570dbba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Porcentagem de dispositivos que poderiam ser reconhecidos como carro-chefe em um ano espec√≠fico</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse sentido, prestamos muita aten√ß√£o ao tamanho do aplicativo. No caso de sua vers√£o do Android, era 26,8 MB. Embora esse tamanho n√£o seja t√£o grande, √© definitivamente mais do que o tamanho m√©dio dos aplicativos de nossos usu√°rios. Este valor, de acordo com o Google Play Console, √© de 16,3 MB. O tamanho do aplicativo pode ser um fator decisivo para usu√°rios com planos tarif√°rios limitados ou para aqueles com dispositivos com pouca mem√≥ria, o que for√ßa os usu√°rios a selecionar cuidadosamente os aplicativos que eles instalar√£o. Como resultado, alguns aplicativos precisam ser desinstalados. Isso √© especialmente importante no caso do aplicativo Mutual, pois os mutu√°rios pagam parcelas mensais por meio desse aplicativo. Quando o mutu√°rio desinstala nosso aplicativo, as chances de ele efetuar o pagamento no prazo s√£o bastante reduzidas.E isso afeta diretamente os ganhos dos investidores que usam nossa plataforma.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/cea/78e/72ccea78ee7c05e86b626c0cf6ea45ef.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho do aplicativo M√∫tuo √© muito maior que o tamanho m√©dio dos</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
aplicativos</font><i><font color="#999999"><font style="vertical-align: inherit;"> de nossos usu√°rios.O</font></font></i><font style="vertical-align: inherit;"> tamanho do aplicativo afeta n√£o apenas o n√≠vel de desinstala√ß√µes. Tamanho tamb√©m afeta a taxa de convers√£o das configura√ß√µes do aplicativo.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqui est√° um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bom artigo sobre isso, escrito pela equipe do Google Play. Este artigo discute a import√¢ncia do tamanho do aplicativo. Em particular, ele afirma que todos os 6 MB adicionais do tamanho do arquivo APK reduzem a taxa de convers√£o das instala√ß√µes em 1%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles tamb√©m falam sobre o fato de que nos pa√≠ses em desenvolvimento onde os dispositivos or√ßament√°rios s√£o a norma, esse efeito √© ainda mais forte. Nomeadamente, reduzir o tamanho do arquivo APK em 10 MB nos mercados emergentes corresponde a um aumento na taxa de convers√£o das instala√ß√µes em cerca de 2,5%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/624/15d/1c162415de7e88ff4c5ed89853b6483b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aumentando a taxa de convers√£o de instala√ß√µes para cada 10 Mb de redu√ß√£o do tamanho do arquivo APK em diferentes pa√≠ses (de acordo com os dados internos do Google),</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ficamos muito motivados com a forma como a redu√ß√£o do tamanho do aplicativo pode afetar o n√≠vel de desinstala√ß√µes e a taxa de convers√£o das configura√ß√µes do aplicativo. </font><font style="vertical-align: inherit;">Como resultado, come√ßamos a trabalhar com o objetivo de reduzir o tamanho do aplicativo o m√°ximo poss√≠vel, levando em considera√ß√£o sua conveni√™ncia para os usu√°rios. </font><font style="vertical-align: inherit;">A primeira etapa deste projeto foi analisar as</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recomenda√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oficiais do</font><font style="vertical-align: inherit;">Google para desenvolvedores do Android.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacote de aplicativos para Android</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lendo as recomenda√ß√µes, aprendemos que a maneira mais f√°cil de reduzir o tamanho de um aplicativo √© usar um novo m√©todo de distribui√ß√£o de aplicativos chamado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android App Bundle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (AAB). At√© esse momento, distribu√≠mos o aplicativo, coletando o bom e antigo arquivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Package</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (APK), que pode ser executado na maioria dos dispositivos Android, e enviando-o para o Google Play Console. Mas o pacote AAB cont√©m apenas c√≥digo e recursos compilados. Como resultado, quando √© baixado, o Google √© respons√°vel por gerar arquivos APK otimizados para v√°rios tipos de dispositivos, levando em considera√ß√£o suas especifica√ß√µes e arquitetura da CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que, ao fazer uma simples altera√ß√£o no processo de compila√ß√£o do projeto, podemos obter uma redu√ß√£o s√©ria no tamanho do aplicativo sem fazer mais esfor√ßo? Isso √© bom demais para a verdade! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de ler a documenta√ß√£o, alteramos o script de constru√ß√£o React Native Gradle para que ele </font></font><code>assembleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fosse executado em </font><font style="vertical-align: inherit;">vez do atual </font></font><code>bundleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. √â tudo o que precisamos para criar o arquivo AAB. Depois de mais algumas modifica√ß√µes feitas na </font></font><code>supply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configura√ß√£o </font><font style="vertical-align: inherit;">do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fastlane em</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rela√ß√£o ao upload autom√°tico de materiais diretamente para a Play Store, mudamos para o AAB, e uma nova vers√£o do nosso aplicativo apareceu no Google Play Console.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somente essa altera√ß√£o levou a uma redu√ß√£o no tamanho dos arquivos APK transferidos para os dispositivos do usu√°rio. A redu√ß√£o variou de 9,1 a 12,4 Mb. Como se viu, o uso do Android App Bundle √© uma t√©cnica eficaz que, de fato, permite reduzir o tamanho do aplicativo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/feb/57b/9e5feb57bf54450425a6dc54da48f613.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O arquivo APK antigo e o novo pacote AAB, cuja utiliza√ß√£o leva ao fato de que o tamanho do aplicativo em dispositivos diferentes pode ser de 14,4 a 17,7 MB</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
True, voc√™ deve ter cuidado aqui. </font><font style="vertical-align: inherit;">Se voc√™ usa o React Native with</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hermes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pode ser necess√°rio atualizar sua depend√™ncia</font></font><code>soloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(veja detalhes</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Caso contr√°rio, existe o risco de fornecer ao usu√°rio um aplicativo que conter√° um erro cr√≠tico. </font><font style="vertical-align: inherit;">Tivemos sorte, conseguimos identificar esse problema durante o teste da vers√£o alfa do projeto. </font><font style="vertical-align: inherit;">Mas o erro pode facilmente entrar em produ√ß√£o, pois n√£o aparece durante o teste local ou na cria√ß√£o do arquivo APK.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimizando recursos de aplicativos usando o Android Size Analyzer</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥xima sugest√£o para otimizar aplicativos que encontramos na documenta√ß√£o foi o uso do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Size Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta √© uma ferramenta de linha de comando que analisa aplicativos Android e procura maneiras de reduzir seu tamanho. </font><font style="vertical-align: inherit;">Lan√ßamos essa ferramenta usando um comando do seguinte formul√°rio:</font></font><br>
<br>
<pre><code class="javascript hljs">size-analyzer check-bundle [BUNDLE].aab
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, obtivemos uma lista de excelentes recursos e imagens de aplicativos que podemos otimizar. </font><font style="vertical-align: inherit;">Tamb√©m nos foi recomendado configurar o ProGuard.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/a26/0b0/ed0a260b0a19878cf664c53ec54c9026.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relat√≥rio do analisador de tamanho</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GuProGuard</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ProGuard √© uma ferramenta para compactar, ofuscar e otimizar o bytecode Java. </font><font style="vertical-align: inherit;">Ainda n√£o exploramos a possibilidade de usar essa ferramenta, pois aprendemos que ela pode n√£o ser compat√≠vel com algumas bibliotecas do Android. </font><font style="vertical-align: inherit;">Como nos esfor√ßamos para reduzir o tamanho de nosso aplicativo o mais r√°pido poss√≠vel, e para simplificar o m√°ximo poss√≠vel, decidimos deixar esse m√©todo de otimiza√ß√£o no futuro.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçGrandes recursos de aplicativos</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao execut√°-lo </font></font><code>size-analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novamente, com a chave </font></font><code>-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, obtemos uma lista de recursos do aplicativo, classificados por tamanho. </font><font style="vertical-align: inherit;">Como essa ferramenta n√£o sabe exatamente como os usu√°rios trabalham com o aplicativo, nos deu a oportunidade de decidir independentemente quais recursos devem ser removidos e quais devem ser carregados dinamicamente no aplicativo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/d84/262/900d84262161b1440fe03e0d8b0d4fab.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de grandes recursos de aplicativos classificados por tamanho</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O primeiro e maior recurso desta lista foi o pacote configur√°vel React Native JavaScript. </font><font style="vertical-align: inherit;">Agora n√£o podemos dividir este pacote e carreg√°-lo dinamicamente. </font><font style="vertical-align: inherit;">Mas depois pensaremos sobre isso. </font><font style="vertical-align: inherit;">Mais abaixo na lista est√£o arquivos de fonte grandes (TTF) e arquivos de imagem (JPG e PNG).</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Images Imagens desnecess√°rias</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chamamos nossa aten√ß√£o imediatamente para as enormes imagens JPG usadas no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storybook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Usamos esse sistema para desenvolver e testar componentes. </font><font style="vertical-align: inherit;">S√£o 2 MB de lixo que ca√≠ram na vers√£o de produ√ß√£o do projeto. </font><font style="vertical-align: inherit;">Erro vergonhoso! </font><font style="vertical-align: inherit;">Quando algo assim acontece, sentimos que fizemos alguma estupidez s√©ria. </font><font style="vertical-align: inherit;">Mas no mundo complexo do desenvolvimento de software, todos cometem erros. </font><font style="vertical-align: inherit;">Acredito que se voc√™ falar publicamente sobre seus erros, isso ajudar√° outros desenvolvedores a aprender com esses erros. </font><font style="vertical-align: inherit;">Existe a possibilidade de voc√™ cometer os mesmos erros se n√£o analisar a estrutura de recursos do aplicativo, cujo tamanho est√° aumentando gradualmente.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Fontes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que nos livramos rapidamente de imagens desnecess√°rias, passamos a analisar outros elementos da lista de recursos. Ficou claro que havia muitas fontes internas nele. Depois de conversarmos sobre isso com nossos designers, eles nos disseram que muitos componentes antigos n√£o diferem na ader√™ncia estrita aos manuais tipogr√°ficos. Portanto, descobrimos quais componentes podem ser removidos e nos quais voc√™ pode usar as fontes atualizadas apropriadas. Gra√ßas a isso, conseguimos reduzir o n√∫mero de fontes usadas de seis para quatro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra coisa que notamos foi o tamanho dos arquivos de fonte. O tamanho de cada um deles era de aproximadamente 670 Kb. Isso significa que quatro fontes no pacote descompactado ocupam impressionantes 2,7 Mb. Felizmente, por√©m, existe uma ferramenta chamada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FontForge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que permite analisar e modificar profundamente os arquivos de fonte. Usando essa ferramenta, descobrimos que o principal motivo do grande tamanho dos arquivos de fonte s√£o caracteres cir√≠licos estendidos e glifos desnecess√°rios. N√≥s poder√≠amos remover tudo isso com seguran√ßa, pois a parte do texto do nosso aplicativo est√° completamente escrita em portugu√™s. Gra√ßas a essa altera√ß√£o, conseguimos reduzir o tamanho dos arquivos de fonte de 670 Kb para 70 Kb - em 90%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d0/144/f9c/7d0144f9c3954dee6570347075fbe392.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplos de alguns glifos inclu√≠dos em nossas fontes:</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
devido ao fato de termos eliminado fontes desnecess√°rias e otimizado as demais, conseguimos reduzir o tamanho do aplicativo em 3,8 Mb. </font><font style="vertical-align: inherit;">Isso levou a uma agrad√°vel redu√ß√£o no tamanho total do arquivo APK em 2 MB.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/62c/a55/52b62ca55ea0178919421a1c08304adc.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de fontes e seus tamanhos antes da otimiza√ß√£o</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83e/374/6db/83e3746db754c475501170c6e4372c49.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de fontes e seus tamanhos ap√≥s otimiza√ß√£o</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PtOtimiza√ß√£o de imagens</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s analisar as imagens que ainda permaneciam no aplicativo, percebemos que algumas s√£o bastante grandes. </font><font style="vertical-align: inherit;">Processamos v√°rias dessas imagens com a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ferramenta de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> otimiza√ß√£o de gr√°ficos </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">TinyPNG</font></a><font style="vertical-align: inherit;"> e </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">observamos</font></a><font style="vertical-align: inherit;"> uma redu√ß√£o significativa no tamanho dessas imagens. </font><font style="vertical-align: inherit;">Depois disso, decidimos otimizar todas as imagens JPG e PNG usadas no aplicativo. </font><font style="vertical-align: inherit;">Havia 41 deles.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/8e9/9e6/aa58e99e6307077787f37d0d60fc59db.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagem antes e depois da otimiza√ß√£o</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Isso nos deu a oportunidade de reduzir o tamanho das imagens de 2,5 MB para 756 KB, ou seja, em 70%. </font><font style="vertical-align: inherit;">No entanto, devido ao fato de as imagens n√£o terem sido otimizadas anteriormente, elas foram compactadas durante a cria√ß√£o do arquivo APK final. </font><font style="vertical-align: inherit;">Aconteceu que nossa otimiza√ß√£o levou a uma redu√ß√£o no tamanho do aplicativo baixado pelo usu√°rio em apenas 500 Kb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, percebemos que j√° t√≠nhamos esgotado todas as possibilidades de otimiza√ß√£o r√°pida. </font><font style="vertical-align: inherit;">Continuar a otimiza√ß√£o de recursos exigiria grandes esfor√ßos ou apenas pequenas melhorias.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reagir a otimiza√ß√£o de pacote JavaScript nativo</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de descobrirmos os recursos do aplicativo espec√≠ficos para a plataforma Android, √© hora de analisar o pacote JavaScript. </font><font style="vertical-align: inherit;">A otimiza√ß√£o de pacotes pode ser considerada uma boa ideia por tr√™s raz√µes. </font><font style="vertical-align: inherit;">Em primeiro lugar, reduz o tamanho do arquivo APK finalizado. </font><font style="vertical-align: inherit;">Em segundo lugar, isso leva a um lan√ßamento mais r√°pido do aplicativo, pois a m√°quina virtual JS precisa processar menos c√≥digo. </font><font style="vertical-align: inherit;">Finalmente, e mais importante, ele acelera as atualiza√ß√µes do OTA que fazemos v√°rias vezes por semana usando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodePush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Analisador de pacotes e otimiza√ß√£o de c√≥digo</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para tomar uma decis√£o sobre como reduzir o tamanho do pacote configur√°vel, primeiro, voc√™ precisa descobrir o que ocupa mais espa√ßo no pacote configur√°vel. Para fazer isso, usamos a excelente ferramenta de c√≥digo aberto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react-native-bundle-visualizer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ap√≥s analisar o projeto com sua ajuda, obtivemos uma visualiza√ß√£o na qual todas as pastas e todas as depend√™ncias de aplicativos estavam presentes, indicando os tamanhos das entidades correspondentes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f2/641/4c0/7f26414c02bec1a7cf7bcd6b901fb837.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instant√¢neo das bibliotecas e pastas da base de c√≥digo do front-end do aplicativo Mutual com a indica√ß√£o dos tamanhos</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Descobrimos que o tamanho total do pacote configur√°vel √© 5,49 Mb. 57,5% desse volume √© representado por depend√™ncias da pasta</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 27,5% - c√≥digo do aplicativo. O que resta, a ferramenta usada por n√≥s n√£o p√¥de ser identificada. Durante o processo de montagem do pacote configur√°vel, o c√≥digo n√£o utilizado j√° foi exclu√≠do; portanto, o que vimos foi o c√≥digo que √© realmente usado pelo aplicativo. Mas, mesmo considerando isso, no pacote voc√™ pode sempre encontrar algo que pode ser aprimorado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maior depend√™ncia do projeto √©</font></font><code>math.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Essa biblioteca, como o pr√≥prio nome sugere, implementa muitas opera√ß√µes matem√°ticas. N√£o temos uma necessidade especial desta biblioteca devido ao fato de realizarmos todos os c√°lculos importantes no servidor, ap√≥s o que simplesmente enviamos os resultados para o aplicativo. Quando analisamos o c√≥digo do aplicativo, verificou-se que a biblioteca √© usada apenas para executar algumas opera√ß√µes simples. Provavelmente foi usado por um desenvolvedor que trabalhava no c√≥digo do servidor apenas em virtude do h√°bito. N√≥s rapidamente extra√≠mos os m√©todos apropriados da biblioteca e os constru√≠mos em nossa base de c√≥digo, eliminando completamente essa depend√™ncia. Isso permitiu reduzir o tamanho do pacote para 4,64 Mb. A recusa de apenas uma biblioteca permitiu reduzir o tamanho do pacote em 15,5%!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° mencionado, usamos o Storybook para desenvolver e testar componentes. √â verdade que os recursos correspondentes devem estar dispon√≠veis apenas em ambientes local e intermedi√°rio. Os usu√°rios finais n√£o precisam disso. Gra√ßas a isso, usamos a vari√°vel </font></font><code>ENVIRONMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para controlar a inclus√£o da parte correspondente do aplicativo. Embora isso seja adequado para restringir o acesso, o empacotador n√£o pode saber qual valor est√° gravado nessa vari√°vel. Por causa dessa limita√ß√£o, todo o c√≥digo do Storybook caiu no pacote de produ√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para corrigir o problema, isolamos a importa√ß√£o desta se√ß√£o em um √∫nico arquivo. Em seguida, criamos duas vers√µes desse arquivo: uma que inclui o Storybook e a outra para produ√ß√£o, que cont√©m apenas o layout do componente. Para alternar entre esses arquivos ao preparar a vers√£o de produ√ß√£o do pacote configur√°vel, escrevemos um script que √© executado antes da cria√ß√£o do projeto e alteramos um arquivo para outro. Gra√ßas a esse m√©todo, conseguimos remover completamente o c√≥digo do Storybook da vers√£o de produ√ß√£o do aplicativo, removendo a depend√™ncia </font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o c√≥digo usual da configura√ß√£o das ‚Äúhist√≥rias‚Äù do Storybook.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/4cc/276/9964cc2769a8a23b3b18d5b0d273cfd9.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pasta Storybook atualizada com duas vers√µes do arquivo de</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
√≠ndice.Estas duas altera√ß√µes reduziram o tamanho do pacote de 5,49 MB para 4,2 MB. </font><font style="vertical-align: inherit;">Isso significa que, entre outras coisas, o aplicativo carregar√° mais r√°pido e atualizar√° mais rapidamente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/06f/f53/03406ff53c8a918119c9febd41e6d752.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho do pacote final era de 4,2 MB.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ap√≥s todas essas melhorias, baixamos novamente o aplicativo na Play Store. </font><font style="vertical-align: inherit;">Agora fomos informados de que o tamanho do arquivo APK finalizado estar√° na faixa de 10,5 a 13,7 Mb. </font><font style="vertical-align: inherit;">Isso, considerando que o aplicativo originalmente tinha um tamanho de 26,8 MB, significa simplesmente uma incr√≠vel redu√ß√£o no tamanho do projeto em cerca de 60%! </font><font style="vertical-align: inherit;">Portanto, como dissemos em um artigo da equipe do Google Play, podemos esperar que a taxa de convers√£o das instala√ß√µes aumente em 3,75%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/715/69e/cec/71569ececb25a15225a48cef54bfb254.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compara√ß√£o da vers√£o APK original do aplicativo com a vers√£o final do AAB, na qual s√£o feitas todas as melhorias descritas acima</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s, como programadores voltados para neg√≥cios, sabemos que, √†s vezes, as empresas, para o desenvolvimento mais r√°pido de um projeto, podem muito bem aumentar sua d√≠vida t√©cnica. </font><font style="vertical-align: inherit;">Isto √© especialmente verdade para jovens startups como a Mutual, que est√£o tentando encontrar seu lugar no mercado. </font><font style="vertical-align: inherit;">Mas se voc√™ n√£o observar essa d√≠vida, poder√° cometer erros irritantes, como enviar 2 MB de imagens de teste para produ√ß√£o e uso injustificado de uma enorme biblioteca. </font><font style="vertical-align: inherit;">D√≠vidas t√©cnicas n√£o devem ficar fora de controle e causar problemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, muitas vezes acontece que os desenvolvedores simplesmente perdem as oportunidades dispon√≠veis para otimizar projetos. </font><font style="vertical-align: inherit;">Portanto, √†s vezes √© recomend√°vel analisar criticamente seus projetos. </font><font style="vertical-align: inherit;">Apenas para verificar se voc√™ perdeu alguma oportunidade de otimizar rapidamente o tamanho, a velocidade ou algum outro aspecto do aplicativo. </font><font style="vertical-align: inherit;">Levamos apenas dois dias para analisar a aplica√ß√£o, planejar o trabalho e fazer melhorias no projeto, o que nos permitiu reduzir o tamanho da aplica√ß√£o em 60%. </font><font style="vertical-align: inherit;">√â dif√≠cil encontrar outra coisa que possa produzir os mesmos resultados em t√£o pouco tempo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ otimiza seus projetos React Native?</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt502412/index.html">Guilloch√© de uma maneira diferente</a></li>
<li><a href="../pt502414/index.html">FOSS News No. 16 - uma revis√£o do software livre e de c√≥digo aberto de 11 a 17 de maio de 2020</a></li>
<li><a href="../pt502416/index.html">Complementando o SQL. Parte 1. A complexidade da an√°lise. Hist√≥rias sobre como finalizar o arquivo ANTLR</a></li>
<li><a href="../pt502418/index.html">Monitor de imagem 3D</a></li>
<li><a href="../pt502420/index.html">CSS Interessante Encontra no Design do Twitter</a></li>
<li><a href="../pt502424/index.html">Parar de importar pacotes JavaScript inteiros</a></li>
<li><a href="../pt502428/index.html">Guloseimas sint√°ticas Julia</a></li>
<li><a href="../pt502430/index.html">Melhores pr√°ticas do Kubernetes. Teste de viabilidade Kubernetes com testes de prontid√£o e vida</a></li>
<li><a href="../pt502432/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 415 (11 a 17 de maio de 2020)</a></li>
<li><a href="../pt502436/index.html">CI TeamCity - Automa√ß√£o de processos de compila√ß√£o de testes de Android e UI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>