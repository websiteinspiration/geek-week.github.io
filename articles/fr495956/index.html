<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïû üßñ üó°Ô∏è Faut que vous y allez rapidement. Optimisation des demandes de contenu de messagerie IMAP üöÉ ü¶ã üñêüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Dans un article pr√©c√©dent, j'ai expliqu√© comment synchroniser rapidement le contenu d'une bo√Æte dans le cache local. Ici, je veux parl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Faut que vous y allez rapidement. Optimisation des demandes de contenu de messagerie IMAP</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495956/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour √† tous! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans un article pr√©c√©dent,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> j'ai expliqu√© comment synchroniser rapidement le contenu d'une bo√Æte dans le cache local. </font><font style="vertical-align: inherit;">Ici, je veux parler des caract√©ristiques de la demande de contenu de lettres et de la meilleure fa√ßon de demander du contenu, sans avoir peur de la forte consommation de trafic.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kk/4w/8a/kk4w8ac2scl3dawogln5zyvg7fg.jpeg" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Souvenons-nous rapidement de ce que nous avons appris dans le dernier article:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMAP est un protocole avec √©tat</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour voir le contenu de la bo√Æte de r√©ception, vous devez d'abord le s√©lectionner avec la commande SELECT</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour synchroniser rapidement la bo√Æte dans laquelle nous nous trouvons, vous pouvez utiliser la commande NOOP</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afin de ne pas trier les messages du stockage local pour mettre √† jour la bo√Æte aux lettres que nous avons d√©j√† quitt√©e, vous pouvez utiliser CONDSTORE et QRESYNC, √† condition que votre serveur prenne en charge les donn√©es d'extension de protocole</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suffisant!</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi de vous rappeler la commande de demander le corps de la lettre:</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH number (BODY[])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela va cr√©er une demande pour obtenir le corps entier de la lettre et toutes les pi√®ces jointes. </font><font style="vertical-align: inherit;">Il suffit de voir combien de temps il faut pour obtenir un message en 42 paragraphe de Lorem Ipsum et avec une photo de 2 m√©gaoctets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, demandez la taille du message sur le serveur. </font><font style="vertical-align: inherit;">Cela se fait par la commande:</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH 18871 (RFC822.SIZE)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RFC822.SIZE renvoie la taille du message en octets:</font></font><br>
<br>
<pre><code class="bash hljs">* 18871 FETCH (RFC822.SIZE 3937793)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, notre message occupe pr√®s de 4 m√©gaoctets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, n√©anmoins, nous allons utiliser la demande pour le corps complet de la lettre et jeter un ≈ìil √† l'heure:</font></font><br>
<br>
<pre><code class="bash hljs">1 OK Fetch completed (0.007 + 3.265 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3,3 secondes! </font><font style="vertical-align: inherit;">Et ce n'est qu'un seul message avec la pi√®ce jointe, et imaginez-les tel sera la bo√Æte enti√®re. </font><font style="vertical-align: inherit;">Ensuite, il faudra plus d'une minute pour t√©l√©charger au moins les vingt et uni√®mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez admettre que l'activit√© d'un client qui, en 2020, ne peut pas synchroniser le courrier plus rapidement qu'en une minute est mauvaise. </font><font style="vertical-align: inherit;">Mais que faire?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donnez-moi une bouch√©e une fois</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bruissez RFC3501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la clause </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui d√©crit les param√®tres possibles pour la commande FETCH, vous remarquerez une demande int√©ressante:</font></font><br>
<br>
<pre><code class="bash hljs">BODY[&lt;section&gt;]&lt;&lt;partial&gt;&gt;
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">section - quelle partie de la lettre obtenir</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partiel - la taille de cette partie</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment est construit partiellement? </font><font style="vertical-align: inherit;">Et c'est tr√®s simple. </font><font style="vertical-align: inherit;">Tout d'abord, l'octet √† partir duquel vous devez commencer la lecture est √©crit √† travers le point, puis combien d'octets en g√©n√©ral doivent √™tre lus:</font></font><br>
<br>
<pre><code class="bash hljs">BODY[&lt;section&gt;]&lt;&lt;0.1024&gt;&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous demandons la partie de la lettre de z√©ro octet √† 1024. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'accord, quelle est la section? </font><font style="vertical-align: inherit;">Tout d'abord, je vais parler d'un param√®tre aussi utile dans une requ√™te FETCH que BODYSTRUCTURE:</font></font><br>
<br>
<pre><code class="bash hljs">1 FETCH 18871 (BODYSTRUCTURE)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce param√®tre, comme vous l'avez probablement compris √† partir de la signature, renvoie la structure de la lettre sous la forme d√©crite dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME-IMB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="bash hljs">* 18871 FETCH (BODYSTRUCTURE (((<span class="hljs-string">"text"</span> <span class="hljs-string">"plain"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 25604 337 NIL NIL NIL NIL)(<span class="hljs-string">"text"</span> <span class="hljs-string">"html"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 29593 390 NIL NIL NIL NIL) <span class="hljs-string">"alternative"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_763_774309787.1586268692"</span>) NIL NIL NIL)(<span class="hljs-string">"image"</span> <span class="hljs-string">"jpeg"</span> (<span class="hljs-string">"name"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>) NIL NIL <span class="hljs-string">"base64"</span> 3880726 NIL (<span class="hljs-string">"attachment"</span> (<span class="hljs-string">"filename"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>)) NIL NIL) <span class="hljs-string">"mixed"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_210_297656922.1586268692"</span>) NIL NIL NIL))
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetez un ≈ìil √† cette structure et votre t√™te tourne? </font><font style="vertical-align: inherit;">N'ayez pas peur, maintenant nous allons le d√©couvrir. </font><font style="vertical-align: inherit;">Comparez les supports d'ouverture et de fermeture.</font></font><br>
<br>
<pre><code class="bash hljs">(<font></font>
BODYSTRUCTURE&nbsp;<font></font>
(<font></font>
[1] (<font></font>
[1.1] (<span class="hljs-string">"text"</span> <span class="hljs-string">"plain"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 25604 337 NIL NIL NIL NIL)<font></font>
[1.2] (<span class="hljs-string">"text"</span> <span class="hljs-string">"html"</span> (<span class="hljs-string">"charset"</span> <span class="hljs-string">"utf-8"</span>) NIL NIL <span class="hljs-string">"quoted-printable"</span> 29593 390 NIL NIL NIL NIL) <span class="hljs-string">"alternative"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_763_774309787.1586268692"</span>) NIL NIL NIL<font></font>
)<font></font>
[2] (<span class="hljs-string">"image"</span> <span class="hljs-string">"jpeg"</span> (<span class="hljs-string">"name"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>) NIL NIL <span class="hljs-string">"base64"</span> 3880726 NIL (<span class="hljs-string">"attachment"</span> (<span class="hljs-string">"filename"</span> <span class="hljs-string">"IMG_20200217_000236.jpg"</span>)) NIL NIL) <span class="hljs-string">"mixed"</span> (<span class="hljs-string">"boundary"</span> <span class="hljs-string">"--=_Part_210_297656922.1586268692"</span>) NIL NIL NIL<font></font>
)<font></font>
)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous remarquerez peut-√™tre que j'ai mis des chiffres pr√®s de quelques crochets. </font><font style="vertical-align: inherit;">Ceci est une section. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment les calculer? </font><font style="vertical-align: inherit;">La premi√®re parenth√®se doit √™tre saut√©e, car elle contient simplement la r√©ponse √† la demande, puis chaque parenth√®se ouvrante doit √™tre num√©rot√©e selon la r√®gle car les en-t√™tes des documents sont num√©rot√©s:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous num√©rotons chaque support d'ouverture en tenant compte de la section pr√©c√©dente</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la section est imbriqu√©e, la section actuelle passant par le point est ajout√©e au num√©ro pr√©c√©dent</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la section n'est pas imbriqu√©e, augmentez son nombre d'une unit√©.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, dans ce cas, dans la premi√®re partie qui se termine par ¬´alternative¬ª (c'est-√†-dire, c'est la partie de la lettre en plusieurs parties / alternative, o√π nous sommes libres de choisir laquelle des parties afficher pour l'utilisateur), il y a deux sections qui sont num√©rot√©es par un point. </font><font style="vertical-align: inherit;">J'ai rencontr√© un serveur o√π il peut y avoir une imbrication √† trois niveaux (c'est-√†-dire [1.1.1], [1.1.2], etc.). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analysons la partie [1.1] examinant la structure de tout cela dans le document </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME-IMB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√Ä en juger, l'en-t√™te Content-Type est le premier. </font><font style="vertical-align: inherit;">Il comprend:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type MIME, ici c'est text / plain</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encodage (charset = utf8)</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici deux param√®tres √©crits comme NIL. </font><font style="vertical-align: inherit;">Franchement, je n'ai pas compris de quoi il s'agissait, mais jusqu'√† pr√©sent je n'en ai pas eu besoin, donc je vais le manquer. </font><font style="vertical-align: inherit;">Je m'excuse pour cette frivolit√©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite est l'en-t√™te Content-Transfer-Encoding, il y est inclus, qui d√©crit le m√©canisme de codage, ici il est cit√©-imprimable.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux nombres suivants d√©crivent la taille de la partie en octets et le nombre de lignes, si possible. </font><font style="vertical-align: inherit;">Avec leur aide, nous pouvons calculer le nombre d'octets √† prendre pour afficher un certain nombre de lignes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les lignes suivantes qui ne figurent pas dans cette partie:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Id, qui est utilis√© dans la ligne de la lettre</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Description, une ligne qui d√©crit ce qu'est cette partie</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les deux autres param√®tres, je n'ai pas pu trouver de r√©ponse d√©finitive, mais l'un de ces param√®tres peut contenir des parties MD5, ce qui peut parfois √™tre utile. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la partie [2], tout est pareil, sauf qu'il s'agit d'une image, d'une pi√®ce jointe avec un nom et d'un encodage base64. Si ce n'est pas encore compl√®tement clair ce qui se passe ici, alors </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur ce site, il est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parfaitement expliqu√© exactement comment calculer la section. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu'est-ce que √ßa donne? Et le fait qu'au stade de l'affichage de la lettre, nous ne pouvons d√©j√† demander que la partie sup√©rieure du contenu et ne pas charger les pi√®ces jointes jusqu'√† ce que l'utilisateur lui-m√™me entre le message et clique sur le bouton "t√©l√©charger". Toutes les informations pour afficher les pi√®ces jointes nous parviennent dans BODYSCTRUCTURE afin que le nom, le format et la taille puissent √™tre affich√©s sans charger la pi√®ce jointe elle-m√™me.&nbsp;</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons √† la pratique. </font><font style="vertical-align: inherit;">Nous demanderons un kilo-octet de contenu de message sans pi√®ce jointe, juste pour savoir ce qu'ils nous ont envoy√©.</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (body[1.1]&lt;0.1024&gt;)<font></font>
* 18871 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consecte=<font></font>
tur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. Praesent et enim te=<font></font>
llus. Nunc vestibulum diam tortor, id posuere turpis tempor luctus. Vivam=<font></font>
us molestie non nunc nec placerat. Cras finibus ut erat et tristique. Cur=<font></font>
abitur vitae commodo risus. Etiam sed scelerisque erat. Quisque cursus bl=<font></font>
andit finibus. Nullam ac lectus accumsan, molestie quam non, mollis urna.=<font></font>
&nbsp;Nulla at arcu <span class="hljs-keyword">in</span> libero condimentum mollis ut non velit. Vestibulum sed =<font></font>
risus et magna congue iaculis. Vestibulum nec interdum elit, ut commodo m=<font></font>
auris. Nulla ipsum leo, vestibulum nec ligula non, elementum ullamcorper =<font></font>
risus. Nunc et malesuada sem, id venenatis massa. Integer dolor ante, max=<font></font>
imus <span class="hljs-keyword">in</span> eleifend nec, ultricies ut risus. Mauris posuere eget tortor at p=<font></font>
orttitor.=0AIn porta elementum ornare. Suspendisse aliquam, tortor sed al=<font></font>
iquam bibendum, nulla ante rhoncus elit, placerat accumsan augue nibh non=<font></font>
&nbsp;est. Duis finibus vel tortor finibu)<font></font>
1 OK Fetch completed (0.073 + 0.000 + 0.072 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Environ 100 millisecondes et nous voyons d√©j√† une partie du contenu de la lettre! </font><font style="vertical-align: inherit;">C'est juste un excellent r√©sultat, √©tant donn√© qu'auparavant, il nous fallait pr√®s de 4 secondes pour t√©l√©charger le contenu d'une lettre. </font><font style="vertical-align: inherit;">Ensuite, vous pouvez simplement charger tout le contenu de la lettre dans le flux d'arri√®re-plan, de l'ext√©rieur, il semblerait que les lettres soient charg√©es instantan√©ment. </font><font style="vertical-align: inherit;">Tout ce qui √©tait n√©cessaire √©tait de regarder la structure de la lettre et de t√©l√©charger uniquement ce qui √©tait n√©cessaire pour un affichage rapide.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un seul instant. </font><font style="vertical-align: inherit;">Cette demande fera appara√Ætre le message sur le serveur comme lu. </font><font style="vertical-align: inherit;">Mais vous pouvez r√©soudre ce probl√®me en ajoutant uniquement PEEK √† la demande de corps</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (BODY.PEEK[1.1]&lt;0.1024&gt;)<font></font>
* 18871 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consecte=<font></font>
tur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. Praesent et enim te=<font></font>
llus. Nunc vestibulum diam tortor, id posuere turpis tempor luctus. Vivam=<font></font>
us molestie non nunc nec placerat. Cras finibus ut erat et tristique. Cur=<font></font>
abitur vitae commodo risus. Etiam sed scelerisque erat. Quisque cursus bl=<font></font>
andit finibus. Nullam ac lectus accumsan, molestie quam non, mollis urna.=<font></font>
&nbsp;Nulla at arcu <span class="hljs-keyword">in</span> libero condimentum mollis ut non velit. Vestibulum sed =<font></font>
risus et magna congue iaculis. Vestibulum nec interdum elit, ut commodo m=<font></font>
auris. Nulla ipsum leo, vestibulum nec ligula non, elementum ullamcorper =<font></font>
risus. Nunc et malesuada sem, id venenatis massa. Integer dolor ante, max=<font></font>
imus <span class="hljs-keyword">in</span> eleifend nec, ultricies ut risus. Mauris posuere eget tortor at p=<font></font>
orttitor.=0AIn porta elementum ornare. Suspendisse aliquam, tortor sed al=<font></font>
iquam bibendum, nulla ante rhoncus elit, placerat accumsan augue nibh non=<font></font>
&nbsp;est. Duis finibus vel tortor finibu)<font></font>
1 OK Fetch completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le tour est jou√©! </font><font style="vertical-align: inherit;">La lettre reste non lue et une partie du contenu que nous avons re√ßu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout devient encore plus facile si la fonction de requ√™te </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">PREVIEW</font></a><font style="vertical-align: inherit;"> est impl√©ment√©e sur votre serveur.&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<pre><code class="bash hljs">1 fetch 18871 (PREVIEW)<font></font>
* 18871 FETCH (PREVIEW (FUZZY <span class="hljs-string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consectetur enim in nisi venenatis, id varius tellus viverra. Praesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis t"</span>))<font></font>
1 OK Fetch completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous ne passons pas de temps √† interroger la structure et nous obtenons l'aper√ßu du message instantan√©ment. </font><font style="vertical-align: inherit;">Mais n'oubliez pas que la structure de requ√™te est utile pour d√©finir des pi√®ces jointes afin qu'elles ne soient pas charg√©es dans l'inactif.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attendre</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presque tous les clients de messagerie impl√©mentent le bouton "Actualiser" si l'utilisateur souhaite recevoir de nouvelles lettres maintenant. </font><font style="vertical-align: inherit;">Mais en quelque sorte, ce n'est pas cool pour notre temps, o√π il y a des notifications √† la fois dans les appareils et dans les navigateurs. </font><font style="vertical-align: inherit;">Que dit IMAP √† ce sujet? </font><font style="vertical-align: inherit;">Et il dit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDLE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette op√©ration conserve la connexion au dossier et vous informe des modifications apport√©es au dossier. </font><font style="vertical-align: inherit;">Veuillez noter, pas la bo√Æte aux lettres, mais les dossiers. </font><font style="vertical-align: inherit;">Pour ce faire, vous avez besoin du serveur pour impl√©menter la fonction IDLE.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√©lectionnez d'abord le dossier pour lequel le serveur enverra des alertes, puis activez IDLE</font></font><br>
<br>
<pre><code class="bash hljs">1 SELECT Inbox<font></font>
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span>)<font></font>
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span> \*)] Flags permitted.<font></font>
* 18872 EXISTS<font></font>
* 0 RECENT<font></font>
* OK [UNSEEN 18685] First unseen.<font></font>
* OK [UIDVALIDITY 1532079879] UIDs valid<font></font>
* OK [UIDNEXT 20155] Predicted next UID<font></font>
* OK [HIGHESTMODSEQ 26338] Highest<font></font>
1 OK [READ-WRITE] Select completed (0.002 + 0.000 + 0.001 secs).<font></font>
1 IDLE<font></font>
+ idling</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La r√©ponse "+ ralenti" signale l'inclusion du ralenti dans le dossier. </font><font style="vertical-align: inherit;">Que se passe-t-il si une nouvelle lettre arrive?</font></font><br>
<br>
<pre><code class="bash hljs">* 18873 EXISTS<font></font>
* 1 RECENT</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je me suis envoy√© la m√™me lettre et Idle m'a inform√© que je devrais demander la lettre 18873, qu'il y avait 18873 lettres dans le dossier et qu'une lettre venait d'arriver. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, je demanderai cette lettre dans une autre connexion, nous sommes int√©ress√©s par la lettre avec la r√©ponse EXISTS.</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 18873 (BODY.PEEK[1.1]&lt;0.1024&gt;)<font></font>
* 18873 FETCH (BODY[1.1]&lt;0&gt; {1024}<font></font>
---- Original Message ---- Tue, Apr 7, 2020, 17:11=0ASubject=<font></font>
: Lorem Ipsum=0A&nbsp; Lorem ipsum dolor sit amet, consectetur adipiscing elit=<font></font>
. Vivamus consectetur enim <span class="hljs-keyword">in</span> nisi venenatis, id varius tellus viverra. P=<font></font>
raesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis te=<font></font>
mpor luctus. Vivamus molestie non nunc nec placerat. Cras finibus ut erat=<font></font>
‚Ä¶</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est tr√®s important de comprendre. </font><font style="vertical-align: inherit;">IDLE n√©cessite une connexion distincte, vous ne pouvez donc pas recevoir de modifications ni demander de messages dans la m√™me session. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que peut faire IDLE d'autre? </font><font style="vertical-align: inherit;">Il est capable de notifier les lettres supprim√©es et les lettres dont les drapeaux ont chang√©. </font><font style="vertical-align: inherit;">Examinons la lettre √† titre d'exemple, mettant ainsi le drapeau "/ vu" dessus et supprimons la lettre.</font></font><br>
<br>
<pre><code class="bash hljs">* 18873 FETCH (FLAGS (\Seen \Recent))<font></font>
* OK Still here<font></font>
* OK Still here<font></font>
* 18873 EXPUNGE<font></font>
* 18871 EXPUNGE<font></font>
* 0 RECENT</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai supprim√© la conversation (18873, 18871) et j'ai regard√© une autre lettre (r√©ponse FETCH). </font><font style="vertical-align: inherit;">Pourquoi cette lettre est-elle devenue 18871? </font><font style="vertical-align: inherit;">Parce que IMAP recompose le num√©ro de lettre si quelque chose a chang√©. </font><font style="vertical-align: inherit;">Depuis qu'il est devenu le top, son nombre a √©galement chang√©.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec IDLE, on peut synchroniser rapidement l'√©tat de la box, mais il est d√©sagr√©able qu'il n√©cessite une connexion s√©par√©e. </font><font style="vertical-align: inherit;">Cela pourrait-il √™tre mieux? </font><font style="vertical-align: inherit;">Voil√† pourquoi je suis ici.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criez comment allez-vous</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si je vous dis qu'il existe une fonctionnalit√© qui vous permet de recevoir des notifications du serveur dans la m√™me connexion, et m√™me sp√©cialement configur√©es pour les bo√Ætes aux lettres, et m√™me pas une. </font><font style="vertical-align: inherit;">Cela ressemble √† un conte de f√©es, mais ne devenez pas fou, c'est une vraie capacit√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOTIFIER</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il en sait beaucoup, par exemple:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer des dossiers sp√©cifiques √† partir desquels nous attendons des notifications</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âcoutez les changements d'√©tat du dossier (lecture des lettres, nouvelles lettres)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finissez le format de notification, c'est-√†-dire ce que nous voulons voir lors du changement de dossier</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âcoutez les changements de nom de dossier</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âcouter les modifications des m√©tadonn√©es du dossier</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardons un exemple de la fa√ßon dont nous pouvons √©couter les changements d'√©tat des dossiers</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (inboxes (MessageNew FlagChange MessageExpunge))<font></font>
1 OK NOTIFY completed (0.001 + 0.000 secs).</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le serveur nous enverra des notifications avec les statuts des dossiers, par exemple, j'ajouterai quelques messages √† diff√©rents dossiers</font></font><br>
<br>
<pre><code class="bash hljs">* STATUS INBOX/Ozon (MESSAGES 312 UIDNEXT 321 UNSEEN 48)<font></font>
* STATUS <span class="hljs-string">"INBOX/Company News"</span> (MESSAGES 178 UIDNEXT 179 UNSEEN 1)<font></font>
* STATUS <span class="hljs-string">"INBOX/Company News"</span> (MESSAGES 177 UIDNEXT 179 UNSEEN 0)</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'analyserai la commande: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'abord vient la commande NOTIFY SET. </font><font style="vertical-align: inherit;">Ensuite, entre parenth√®ses, nous s√©lectionnons les dossiers que nous √©couterons:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bo√Ætes de r√©ception - pour tous les dossiers que vous pouvez s√©lectionner</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Personnel - dossiers qui se trouvent dans l'espace de noms de l'utilisateur</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abonn√© - dossiers auxquels l'utilisateur est abonn√©</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous-arbre - sous-arbre du dossier √† sp√©cifier</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bo√Ætes aux lettres - ici vous pouvez lister les dossiers √† √©couter.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√©lectionn√© - alerte uniquement pour les dossiers s√©lectionn√©s</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et les param√®tres qui sont responsables du filtre d'alerte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MessageNew - si un nouveau message arrive</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FlagChange - si le drapeau a chang√©</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MessageExpunge - si le message a √©t√© supprim√© ou d√©plac√©</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais avec une telle commande, nous ne pouvons pas recevoir les param√®tres d'un message nouveau, modifi√© ou supprim√©. </font><font style="vertical-align: inherit;">Pour ce faire, s√©lectionnez le param√®tre Selected et sp√©cifiez exactement ce qui doit √™tre renvoy√©. </font><font style="vertical-align: inherit;">Nous pouvons ajouter une autre alerte sans supprimer la pr√©c√©dente.</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> status (selected (MessageNew (uid preview) MessageExpunge))
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, dans MessageNew, nous sp√©cifions les param√®tres que la notification doit renvoyer. </font><font style="vertical-align: inherit;">Je vais choisir Inbox et encore une fois je vais me jeter lorem ipsum.</font></font><br>
<br>
<pre><code class="bash hljs">* 18868 FETCH (UID 20157 PREVIEW (FUZZY <span class="hljs-string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus consectetur enim in nisi venenatis, id varius tellus viverra. Praesent et enim tellus. Nunc vestibulum diam tortor, id posuere turpis t"</span>))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√áa vous pla√Æt? </font><font style="vertical-align: inherit;">Pour l'inactif, nous devons conserver deux connexions, dont l'une demande √©galement des messages que l'inactif nous a renvoy√©s. </font><font style="vertical-align: inherit;">Imm√©diatement, ils nous apportent tout sur un plateau d'argent.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et pour que nous puissions √©couter les changements de nom de dossier</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (inboxes (MailboxName))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Renommez un dossier et voyez le r√©sultat.</font></font><br>
<br>
<pre><code class="bash hljs">* LIST () <span class="hljs-string">"/"</span> 1111 (<span class="hljs-string">"OLDNAME"</span> (aaaa))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, nous savons qu'il y avait un dossier "aaaa", et est devenu "1111". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, vous pouvez √©couter le changement de drapeaux et la suppression des messages. </font><font style="vertical-align: inherit;">Pour ce faire, utilisez le param√®tre FlagChange</font></font><br>
<br>
<pre><code class="bash hljs">1 notify <span class="hljs-built_in">set</span> (selected (MessageNew (uid) FlagChange MessageExpunge))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et lorsque vous modifiez les indicateurs de message et supprimez, nous obtenons</font></font><br>
<br>
<pre><code class="bash hljs">* 18865 EXPUNGE<font></font>
* 18864 FETCH (FLAGS ())<font></font>
* 18864 FETCH (FLAGS (\Answered))</code></pre><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et apr√®s</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes ces fonctionnalit√©s aident le client de messagerie √† travailler aussi rapidement et facilement que possible pour l'utilisateur. </font><font style="vertical-align: inherit;">IDLE et NOTIFY informent l'utilisateur des changements dans les dossiers, demandant qu'une partie de la lettre acc√©l√®re son chargement.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le dernier article, je voudrais parler du m√©canisme de recherche dans IMAP et comment il peut √™tre acc√©l√©r√© et r√©duire la charge sur le r√©seau. </font><font style="vertical-align: inherit;">Merci d'avoir lu jusqu'au bout.&nbsp;</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495942/index.html">Gagnez du temps, des nerfs et des heures de travail</a></li>
<li><a href="../fr495944/index.html">Mise √† jour du TOP50 (classement des supercalculateurs CIS): dynamique et tendances</a></li>
<li><a href="../fr495946/index.html">Norbert Wiener: le p√®re distrait de la cybern√©tique</a></li>
<li><a href="../fr495948/index.html">Rouille int√©gr√©e. D√©veloppement pour les processeurs Cortex-M3 utilisant la carte de d√©bogage STM32F103C8T6 (Black Pill)</a></li>
<li><a href="../fr495954/index.html">Comment Cisco fonctionne-t-il en mode d'acc√®s √† distance et dans un p√©rim√®tre absent depuis 20 ans?</a></li>
<li><a href="../fr495960/index.html">Juste une connexion Wi-Fi AH-ny. Ou comment nous avons construit un r√©seau Wi-Fi 6 (AX) dans un √©tablissement d'enseignement</a></li>
<li><a href="../fr495962/index.html">Udalenka: comment dans X5 ils envisageaient de passer √† un format de travail √† distance</a></li>
<li><a href="../fr495966/index.html">Code absurde ou "comment ne pas √©crire"</a></li>
<li><a href="../fr495970/index.html">Outils pour le travail d'√©quipe √† distance: du suivi du temps √† la finance</a></li>
<li><a href="../fr495974/index.html">Observations photographiques de m√©t√©ores, Pers√©ides 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>