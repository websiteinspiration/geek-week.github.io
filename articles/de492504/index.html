<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍪 🛎️ 👵🏿 Was passiert, wenn ein JS-Modul zweimal importiert wird? 🤹🏿 👩‍🎤 😙</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beginnen wir diesen Artikel mit einer Frage. Das ES2015-Modul incremententhält den folgenden Code:
 
 

// increment.js let counter = 0; counter++;  e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Was passiert, wenn ein JS-Modul zweimal importiert wird?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/492504/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen wir diesen Artikel mit einer Frage. </font><font style="vertical-align: inherit;">Das ES2015-Modul </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enthält den folgenden Code:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// increment.js</span>
<span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;<font></font>
counter++;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> counter;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem anderen Modul, das wir aufrufen werden </font></font><code>consumer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wird das obige Modul zweimal importiert:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// consumer.js</span>
<span class="hljs-keyword">import</span> counter1 <span class="hljs-keyword">from</span> <span class="hljs-string">'./increment'</span>;
<span class="hljs-keyword">import</span> counter2 <span class="hljs-keyword">from</span> <span class="hljs-string">'./increment'</span>;<font></font>
<font></font>
counter1; <span class="hljs-comment">// =&gt; ???</span>
counter2; <span class="hljs-comment">// =&gt; ???</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt eigentlich eine Frage. </font><font style="vertical-align: inherit;">Was kommt in die Variablen </font></font><code>counter1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>counter2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nach dem Modul </font></font><code>consumer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">
Um diese Frage zu beantworten, müssen Sie wissen, wie JavaScript Module ausführt und wie sie importiert werden.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/-e/gq/3p/-egq3px2qo7a_nyjchhabkyhms4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modulausführung</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu verstehen, wie die internen JavaScript-Mechanismen funktionieren, ist es hilfreich, die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spezifikation zu untersuchen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gemäß der Spezifikation wird jedes JavaScript - </font><font style="vertical-align: inherit;">Modul mit einer zugehörigen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modul Bilanz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einheit </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dieser Eintrag verfügt über eine Methode </font></font><code>Evaluate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die das Modul ausführt: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn dieses Modul bereits erfolgreich ausgeführt wurde, geben Sie undefined zurück. </font><font style="vertical-align: inherit;">[...]. </font><font style="vertical-align: inherit;">Andernfalls führen Sie transitiv alle Abhängigkeiten dieses Moduls aus und führen Sie dann dieses Modul aus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen stellt sich heraus, dass dasselbe Modul nur einmal ausgeführt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider ist das, was Sie zur Beantwortung unserer Frage wissen müssen, nicht darauf beschränkt. </font><font style="vertical-align: inherit;">So stellen Sie sicher, dass die Anweisung aufgerufen wird</font></font><code>import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wenn Sie dieselben Pfade verwenden, wird dasselbe Modul zurückgegeben.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importbefehle zulassen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die abstrakte Operation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HostResolveImportedModule ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist dafür verantwortlich, den Pfad zum Modul ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Bezeichner</font></a><font style="vertical-align: inherit;"> ) einem bestimmten Modul </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">zuzuordnen</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Der Modul-Importcode sieht folgendermaßen aus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> <span class="hljs-built_in">module</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Spezifikation heißt es dazu: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Implementierung von HostResolveImportedModule muss die folgenden Anforderungen erfüllen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der normale Rückgabewert sollte eine Instanz einer bestimmten Unterklasse von Module Record sein.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Moduldatensatzentität, die dem Paar referenziert, das auf ScriptOrModule verweist, nicht vorhanden ist oder eine solche Entität nicht erstellt werden kann, wird eine Ausnahme ausgelöst.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jedes Mal, wenn diese Operation aufgerufen wird und ein bestimmtes Paar von referencingScriptOrModule-Spezifizierern als Argumente an sie übergeben wird, sollte sie im Falle ihrer üblichen Ausführung dieselbe Instanz der Module Record-Entität zurückgeben.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie dies nun verständlicher. </font></font><br>
<br>
<code>HostResolveImportedModule(referencingScriptOrModule, specifier)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- eine abstrakte Operation kehrt dass das Modul mit einem Paar von Parametern entspricht </font></font><code>referencingScriptOrModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>specifier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Parameter </font></font><code>referencingScriptOrModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist das aktuelle Modul, dh das zu importierende Modul.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Parameter </font></font><code>specifier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist eine Zeichenfolge, die dem Modulpfad in der Anweisung entspricht </font></font><code>import</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende der Beschreibung </font></font><code>HostResolveImportedModule()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird angegeben, dass beim Importieren von Modulen, die demselben Pfad entsprechen, dasselbe Modul importiert wird:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> moduleA <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
<span class="hljs-keyword">import</span> moduleB <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
<span class="hljs-keyword">import</span> moduleC <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;<font></font>
<font></font>
<span class="hljs-comment">// moduleA, moduleB  moduleC -    </span><font></font>
<font></font>
moduleA === moduleB; <span class="hljs-comment">// =&gt; true</span>
moduleB === moduleC; <span class="hljs-comment">// =&gt; true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interessanterweise gibt die Spezifikation an, dass der Host (Browser, Node.js-Umgebung im Allgemeinen - alles, was versucht, JavaScript-Code auszuführen) eine bestimmte Implementierung bereitstellen sollte </font></font><code>HostResolveImportedModule()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antworten</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach sorgfältigem Lesen der Spezifikation wird deutlich, dass JavaScript-Module beim Import nur einmal ausgeführt werden. </font><font style="vertical-align: inherit;">Beim Importieren eines Moduls über denselben Pfad wird dieselbe Instanz des Moduls zurückgegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommen wir zurück zu unserer Frage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Modul wird </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">immer nur einmal ausgeführt:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// increment.js</span>
<span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;<font></font>
counter++;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> counter;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unabhängig davon, wie oft ein Modul importiert wurde </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wird ein Ausdruck </font></font><code>counter++</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nur einmal ausgewertet. </font><font style="vertical-align: inherit;">Eine Variable, </font></font><code>counter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die mit dem Standardexportmechanismus exportiert wird, ist wichtig </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen Sie sich nun das Modul an </font></font><code>consumer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// consumer.js</span>
<span class="hljs-keyword">import</span> counter1 <span class="hljs-keyword">from</span> <span class="hljs-string">'./increment'</span>;
<span class="hljs-keyword">import</span> counter2 <span class="hljs-keyword">from</span> <span class="hljs-string">'./increment'</span>;<font></font>
<font></font>
counter1; <span class="hljs-comment">// =&gt; 1</span>
counter2; <span class="hljs-comment">// =&gt; 1</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Befehle </font></font><code>import counter1 from './increment'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>import counter2 from './increment'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verwenden den gleichen Pfad - </font></font><code>'./increment'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Als Ergebnis stellt sich heraus, dass dieselbe Instanz des Moduls importiert wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass </font><font style="vertical-align: inherit;">der gleiche Wert 1 </font><font style="vertical-align: inherit;">in die Variablen </font></font><code>counter1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>counter2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in geschrieben wird </font></font><code>consumer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir eine einfache Frage untersucht hatten, konnten wir mehr darüber erfahren, wie JavaScript-Module ausgeführt und importiert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die beim Importieren von Modulen verwendeten Regeln sind recht einfach: Das gleiche Modul wird nur einmal ausgeführt. Mit anderen Worten, was im Umfang der Modulebene liegt, wird nur einmal ausgeführt. Wenn ein Modul, das bereits einmal ausgeführt wurde, erneut importiert wird, wird es nicht erneut ausgeführt. Beim Importieren eines Moduls wird anhand der Ergebnisse einer vorherigen Sitzung ermittelt, was genau exportiert wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ein Modul mehrmals importiert wird, der Modulspezifizierer (Pfad dazu) jedoch gleich bleibt, stellt die JavaScript-Spezifikation sicher, dass dieselbe Modulinstanz importiert wird. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liebe Leser!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wie oft lesen Sie die JavaScript-Spezifikation, um die Funktionsweise bestimmter Sprachkonstrukte herauszufinden?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de492488/index.html">OpenID Connect: Autorisierung interner Anwendungen von generisch zu standard</a></li>
<li><a href="../de492492/index.html">NikiRobot - eine Weiterentwicklung der pädagogischen Robotik</a></li>
<li><a href="../de492496/index.html">Beispiel für ein Simple Notes SPA unter Mithril.js</a></li>
<li><a href="../de492500/index.html">Wissenschaftsgarage auf Russisch. Erleben Sie die Übersetzung einer amerikanischen Show</a></li>
<li><a href="../de492502/index.html">MIP * = RE: epochale Beweise aus dem Bereich der Informatik, die den Dominoeffekt in Physik und Mathematik verursacht haben</a></li>
<li><a href="../de492506/index.html">3 Möglichkeiten, große Listen in Angular zu rendern</a></li>
<li><a href="../de492508/index.html">Buchen Sie Kubernetes für DevOps</a></li>
<li><a href="../de492510/index.html">ES6-Module im Browser: Sind sie bereit oder nicht?</a></li>
<li><a href="../de492512/index.html">CSS: Abenteuer im Land der Transluzenz</a></li>
<li><a href="../de492514/index.html">Wie kann ein rechtlich bedeutender elektronischer Dokumentenfluss von Gegenparteien in Russland und Kasachstan hergestellt werden?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>