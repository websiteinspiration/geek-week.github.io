<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèΩ‚Äçü§ù‚Äçüßëüèº üåò üëâüèº Conferencia DEFCON 27. Buttplug: Pruebas de penetraci√≥n real. Parte 2 üö∏ ü•î üë©üèª‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los analistas creen que actualmente hay alrededor de 10 mil millones de dispositivos del mundo de Internet de las cosas (IoT). A veces, estos disposit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Conferencia DEFCON 27. Buttplug: Pruebas de penetraci√≥n real. Parte 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/495792/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los analistas creen que actualmente hay alrededor de 10 mil millones de dispositivos del mundo de Internet de las cosas (IoT). A veces, estos dispositivos ganan su lugar en el mercado, literalmente escalando culos humanos. Result√≥ que los chips de radio baratos y de baja potencia no solo son excelentes para la automatizaci√≥n del hogar, sino que tambi√©n cambian la forma en que las personas interact√∫an con los juguetes sexuales. En este informe, nos sumergiremos en el mundo de la televisi√≥n dildonics, la tecnolog√≠a del sexo a una distancia en la cual las sensaciones t√°ctiles, de temperatura y otras se transmiten entre las parejas a trav√©s de una l√≠nea de comunicaci√≥n bidireccional. El orador le dir√° que la seguridad de los juguetes electr√≥nicos de sexo anal electr√≥nicos de Buttplug se puede oponer a un atacante que encuentra y explota vulnerabilidades en cada nivel de la pila. En √∫ltima instancia, esto permite que los juguetes sexuales se vean comprometidos,y los dispositivos a los que se conectan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/yr/ar/z5yraruqzcjhhyd_pc_eym4a5ly.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un hacker con el apodo smea, o Smealum, comenz√≥ su carrera como desarrollador de videojuegos para consolas de juegos como la Nintendo DS, tratando simult√°neamente de descifrarlos. En alg√∫n momento, las consolas adquirieron serios sistemas de seguridad, y Smea cambi√≥ del software interno al desarrollo de t√©cnicas para romperlo. Smea es conocido por su "trabajo" en Nintendo 3DS y Wii U, aunque tambi√©n contribuy√≥ al desarrollo de exploits para los navegadores web y las pilas de virtualizaci√≥n m√°s populares. Probablemente, ahora se interes√≥ en irrumpir en tapones anales "inteligentes".</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conferencia DEFCON 27. Buttplug: Pruebas de penetraci√≥n real. Parte 1</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xq/wz/de/xqwzdenvl7ovwamxxyxf_byvjiu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por supuesto, puede administrar los mensajes entrantes incluso con una longitud de l√≠nea tan corta. Por ejemplo, 30 caracteres son suficientes para ejecutar JavaScript malicioso. Esta diapositiva muestra una etiqueta de ejemplo con una longitud de 30 caracteres para una imagen de una fuente inexistente &lt;img src = a onerror = 'alert (1)'&gt;, lo que hace que la aplicaci√≥n muestre un mensaje de error. Este mensaje se mostrar√° cuando la carga de im√°genes sea realmente imposible. La captura de pantalla muestra que conectarse a trav√©s de un dongle comprometido le permite ejecutar JavaScript malicioso.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/p8/9x/kdp89xy1fdjf_ib5vcifs6wmix4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El l√≠mite de 32 caracteres es molesto porque es dif√≠cil darse cuenta de la carga √∫til del volumen, pero es bastante posible. Entonces, ver√° que hemos comprometido con √©xito la aplicaci√≥n usando una llave USB y ahora estamos a mitad de camino para revertir el pirateo, es decir, comprometer la aplicaci√≥n usando un bootplag de pirata inform√°tico. La pirater√≠a en un sitio de dongle-computer puede ocurrir de dos maneras: a trav√©s de una computadora, puede comprometer un dongle, y a trav√©s de un dongle, puede comprometer una computadora.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El dongle act√∫a como un peque√±o puente entre el conector de arranque y la aplicaci√≥n. Surge la pregunta: ¬øes posible utilizar la misma vulnerabilidad para comprometer una aplicaci√≥n en una computadora directamente a trav√©s del bootplag? Desafortunadamente, la respuesta a esta pregunta es negativa, y la raz√≥n es que hay otra limitaci√≥n en la longitud de los caracteres del mensaje que provienen del complemento de arranque de la aplicaci√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/xp/_c/bixp_ckg43nxt6acd4aq_px4wae.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El dongle simplemente empaqueta los mensajes del complemento de arranque y los env√≠a a la aplicaci√≥n, y en este paso puede insertar su c√≥digo HTML en ellos. Sin embargo, a la vez puede recibir un mensaje de no m√°s de 20 bytes, que no es suficiente para llevar a cabo un ataque XSS. Sin embargo, hay un error en el firmware del dongle: no se verifica el terminador nulo al final de la l√≠nea. Por lo tanto, si puede colocar algunos datos no inicializados despu√©s del final de una cadena de 20 caracteres, podr√° enviar a la aplicaci√≥n m√°s de 20 caracteres. Desafortunadamente, no encontr√© una manera de usar esta vulnerabilidad en la pr√°ctica, pero vale la pena tener en cuenta esa oportunidad.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, el problema es que probablemente no pueda usar esta vulnerabilidad para forzar a la aplicaci√≥n a ejecutar el c√≥digo recibido directamente desde el complemento de arranque. Es triste, pero a√∫n m√°s triste que si observa el firmware del dongle, puede ver que, en principio, no hace nada con los datos recibidos, sino que simplemente los copia en una nueva l√≠nea y los env√≠a m√°s. Por lo tanto, no podremos usar su vulnerabilidad al ataque desbordando el b√∫fer de memoria. Sin embargo, si es imposible hackear la aplicaci√≥n directamente desde el complemento de arranque, ¬øtal vez sea posible hacerlo a trav√©s de la cadena de computadora de plug-dongle de arranque? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo bueno es que el chip dongle le permite colocar mucho m√°s c√≥digo del que se requiere para el programa original de desarrolladores Lovense Hush.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9m/bf/k7/9mbfk7wqpqdoodi2nndnppiirfo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La memoria flash del dongle contiene un √°rea reservada para el cargador DFU, un √°rea para la aplicaci√≥n Lovense y un √°rea cerrada de SoftDevice para el controlador de hardware para el chip BLE de Nordic Semiconductor. Aqu√≠ es donde se procesa el protocolo BLE. Por ejemplo, cuando una aplicaci√≥n quiere enviar un mensaje BLE a un juguete, accede a SoftDevice a trav√©s de una llamada SVC. Adem√°s de estas 3 √°reas, el dongle tiene un √°rea no utilizada de memoria flash de un volumen suficientemente grande. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para encontrar la vulnerabilidad en la pila de BLE SoftDevice, debe usar ingenier√≠a inversa, ya que no es de c√≥digo abierto. Hice lo mismo para encontrar la vulnerabilidad del complemento de firmware. En este caso, es muy f√°cil seguir el flujo de datos, porque tampoco hay ASLR all√≠, y es f√°cil determinar el c√≥digo que procesar√° estos mensajes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/wq/ch/yhwqchpeynrmburahytjp2gxqd8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la derecha de la diapositiva, ver√° el controlador de paquetes entrantes GATTC (un perfil de atributos comunes), que, en esencia, es un dongle. En particular, es un controlador de lectura por tipo de paquetes de respuesta. No soy especialista en dispositivos Bluetooth, pero creo que el punto aqu√≠ es que el dongle lee el tipo de dispositivo perif√©rico y usa controladores para todas las variantes de los atributos asociados con este tipo. Esto significa que, de hecho, puede obtener m√°s de 1 atributo a la vez, y el tama√±o de cada controlador de un par de datos de atributos se codifica como un campo dentro del paquete, lo que le permite administrarlos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/sa/9h/cksa9hsxwiqwgqoyklkgwwhx2pa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diapositiva muestra una muestra de dicho paquete. Los clientes GATT pueden enviar un paquete de solicitud de lectura por tipo que contiene el tipo y el rango de descriptores para leer. Los servidores que responden a la solicitud de lectura por tipo devuelven los datos asociados con los controladores dentro del rango correspondiente a este tipo. El n√∫mero de pares de descriptor / datos se determina dividiendo la longitud del paquete restante por la longitud del campo del par de descriptor / datos, y este campo siempre es 0x7 o 0x15.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/zf/gm/j7zfgmebqqi3va1lslmsmr3pzr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La diapositiva muestra el funcionamiento de la funci√≥n que nos interesa: puede ver c√≥mo se llena el paquete con datos de una matriz de atributos y se les asigna una longitud de b√∫fer fija. Aqu√≠ es donde se coloca el valor del descriptor, y luego el puntero asociado con √©l. Una matriz de atributos son datos binarios que se colocan dentro del b√∫fer en formato hexadecimal. Los datos se resaltan en azul, y al lado est√° el descriptor 0D y su puntero asociado 00, se resalta en naranja. El paquete del segundo y tercer controlador se ve similar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vulnerabilidad es la siguiente. Si lee el c√≥digo de la derecha, puede ver el par√°metro attribute_data_length ubicado en el marco p√∫rpura: la longitud del mensaje entrante, cuyo valor est√° completamente controlado por un atacante potencial. Si colocamos un valor cero all√≠, obtenemos un bucle infinito. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wk/mo/hi/wkmohi2rrehqx3o1mgupqhdseek.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El bucle se vuelve infinito porque el c√≥digo no verifica si los datos que escribe en el b√∫fer de salida est√°n dentro de este b√∫fer de salida. Como resultado, obtenemos un desbordamiento de b√∫fer de pila cl√°sico, ya que el dispositivo no tiene ASLR o DEP, y el c√≥digo se ejecuta inmediatamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Asignando un valor de cero y obteniendo un bucle infinito, en realidad reemplaza todos los datos de RAM con basura. Sin embargo, esta es una soluci√≥n fallida, ya que es probable que cause una falla del dispositivo. Pero si usa un valor de 1, entonces limitar√° el n√∫mero de bytes que est√°n dentro del mensaje entrante. Esto significa lo siguiente: puede sobrellenar ligeramente este b√∫fer, y luego el b√∫fer, que se basa en la pila, podr√° da√±ar todo lo que est√° al lado.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/rf/iy/vgrfiyhiseechjyxntzkrztnp14.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos c√≥mo se ve la pila antes del desbordamiento. El conjunto de atributos de b√∫fer del que hablamos se resalta en amarillo, los registros guardados en azul y la direcci√≥n de retorno en naranja. Al establecer la longitud del atributo en 0x01, podemos causar un desbordamiento de muchos pares de punteros de manejador / datos. Los descriptores consisten en 2 bytes, pero los dos primeros bytes del descriptor DWORD no se borran. El b√∫fer que estamos desbordando est√° en la pila sin cookies, sin ASLR, sin DEP.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/es/oo/ko/esooko6lhrdqef9gglnoyx2ffh8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, probamos el sistema: env√≠e un paquete lleno de bytes 0xDA con una longitud de atributo de 0x01. Resulta que reescribimos la direcci√≥n de retorno con un puntero a nuestros datos de atributos. Como no hay DEP, esto significa que cada vez que la funci√≥n regrese, se ejecutar√° el c√≥digo que est√° dentro de nuestro paquete. La √∫nica limitaci√≥n es que necesitamos la direcci√≥n de retorno para tener el LSB configurado en el bit menos significativo, por lo que el c√≥digo se ejecuta en modo Thumb, porque el procesador Cortex M0 no admite el modo ARM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/5w/gl/rc5wglu00lbsx5v9gnix6v1as2c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n reescribimos varias variables locales, mientras nos aseguramos de no reescribir nada usado en el camino de regreso. B√°sicamente, obtenemos un paquete cl√°sico de puerta trasera. Si prestas atenci√≥n a esta pila, ver√°s que la reescrita no corresponde al borde, lo que har√° que el programa se bloquee. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay otro requisito con respecto a los registros almacenados. Estas son variables locales que tambi√©n se sobrescriben cuando la funci√≥n regresa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/kv/m2/ftkvm2tpkt7iepg-fwtrpx2kkiq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uno de ellos se usa para desreferenciar un borde de 32 bits, y la falta de coincidencia de contenido con el borde har√° que el programa se bloquee. Por lo tanto, debe asegurarse de que saved_arg_3 = 0, saved_arg_4 corresponde a DWORD, es decir, est√° dentro del borde y LSB est√° configurado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, debemos asegurarnos de que este paquete funcione. Afortunadamente, esto es realmente f√°cil, porque la forma en que SoftDevice distribuye estos paquetes entrantes es un buffer de anillo sin ning√∫n requisito de alineaci√≥n forzada. Whiteshark hizo posible verificar que la alineaci√≥n del paquete posterior se puede controlar cambiando la longitud del paquete anterior. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/3j/ia/mr3jiaai4k_cnlfzea9a0zyvgqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El amarillo y el azul resaltaron 2 paquetes que se env√≠an antes de que se env√≠e el paquete exploit. Esto me permite controlar la alineaci√≥n del √∫ltimo paquete y hacer que no cause un bloqueo del programa, que es a lo que apuntamos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observo que hay un cierto obst√°culo de ingenier√≠a: Nordic SoftDevice no proporciona una interfaz para enviar paquetes BLE sin procesar. </font><font style="vertical-align: inherit;">Para evitarlo, puede usar 2 opciones: implementar su propia pila BLE o romper algunos ganchos en los paquetes originales. </font><font style="vertical-align: inherit;">Como soy flojo, eleg√≠ la opci√≥n 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos ganchos son bastante simples, pero requieren algo de ingenier√≠a inversa. </font><font style="vertical-align: inherit;">Los m√©todos de pirateo se pueden encontrar en github, la interfaz est√° bastante "sucia" y no hay garant√≠as de que esto funcione, pero lo hice. </font><font style="vertical-align: inherit;">A√∫n est√°s mejor usando BTLEJack.</font></font><br>
<br>
<pre><code class="plaintext hljs">void ble_outgoing_hook(uint8_t* buffer, uint8_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este puntero de SoftDevice se llama cada vez que se env√≠a un paquete BLE, por lo que se puede modificar de antemano:</font></font><br>
<br>
<pre><code class="plaintext hljs">int ble_incoming_hook(uint8_t* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este enlace SoftDevice llama cada vez que se recibe un paquete BLE. El valor de retorno determina si se debe omitir el procesamiento normal de SoftDevice.</font></font><br>
<br>
<pre><code class="plaintext hljs">int send_packet(void* handle, void* buffer, uint16_t length);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve la funci√≥n de enviar el paquete sin formato a esta conexi√≥n BLE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo puedo procesar m√°s de 4 bytes de c√≥digo a la vez? ¬°Necesito enviar algunos paquetes! A la derecha, ver√° el b√∫fer en anillo de los paquetes BLE entrantes. El primer paquete se muestra en verde: el c√≥digo de shell que ejecuta una llamada de funci√≥n con par√°metros controlados y luego devuelve "clean". El segundo paquete se muestra en amarillo: este es un b√∫fer de datos que puede ser utilizado por una llamada de funci√≥n. El tercer paquete se muestra en azul, un b√∫fer que contiene los valores de los par√°metros de llamada de funci√≥n, y naranja, el paquete que inicia la vulnerabilidad utilizando la instrucci√≥n C1 E7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/47/up/ki/47upki5tumqqj_c4ysc09rw2i0g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de devolver la funci√≥n pura, podemos reenviar este paquete. El env√≠o de estos 4 paquetes ejecuta cualquier pieza arbitraria de c√≥digo dentro del dongle, y esto se puede hacer una y otra vez.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z2/hg/jg/z2hgjgfs0udpsjpfcm0l7gppqmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es conveniente porque de esta manera realmente puedo llamar a memcpy varias veces para copiar el c√≥digo binario de shell m√°s grande en la RAM. Luego llamamos a esta funci√≥n para parchear el c√≥digo original del dongle en la memoria y usarlo para comprometer la aplicaci√≥n instalada en la computadora. Como la carga √∫til de XSS es grande, no la enviamos, sino que la generamos en el c√≥digo de shell en el dongle. El c√≥digo de shell es el siguiente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c7/bi/oy/c7bioypcqko4flgvncaxbz8e2qm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado de estas manipulaciones, se obtiene lo siguiente: si podemos controlar la aplicaci√≥n, entonces podemos controlar el dongle y el bootplag.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zq/qj/dv/zqqjdv3mounl3az58buw63jinri.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay dos formas de hackear la secci√≥n dongle de buttplag: el dongle puede comprometer el juguete y el buttplag puede comprometer tanto el dongle como la computadora. La ventaja es que la vulnerabilidad Nordic BLE est√° presente no solo en los productos Lovense, sino tambi√©n en cualquier dispositivo que use SoftDevise S110, S120 o S130 para el lado del cliente de BLE.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, tenemos la oportunidad de comprometer la aplicaci√≥n usando el bootplag. ¬øC√≥mo se puede usar esto? Todav√≠a estamos ejecutando c√≥digo JavaScript dentro de la aplicaci√≥n Lovense, y la pregunta es, ¬øqu√© nos da esto? Resulta que la aplicaci√≥n lovense.exe se ejecuta en Medium IL y funciona en Windows, ofrece posibilidades verdaderamente ilimitadas: incluso sin privilegios de administrador, puede acceder a archivos en su computadora, puede ejecutar c√≥digo arbitrario, puede implementar XSS, acceder a la red etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/zo/ng/zezongcdgttvaxcxleyye2bzrwi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente pregunta: si puede crear un programa de ransomware que no solo infecte el bootplag, sino tambi√©n la computadora del usuario, ¬øhay alguna manera de extenderlo a√∫n m√°s haci√©ndolo viral? Ahora tenemos un hack a nivel local, pero para un hacker ser√≠a mucho m√°s √∫til obtener el control de muchas computadoras de usuario a trav√©s de Internet. C√≥mo hacemos esto? Las funciones sociales del juguete, como el video chat, el chat de texto, la transferencia de im√°genes y el control remoto en s√≠, expanden significativamente la superficie de ataque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El control remoto es un objetivo excelente, porque si un desarrollador quiere usar un programa propietario, definitivamente tendr√° errores y vulnerabilidades. ¬øC√≥mo usarlo? Por ejemplo, puede enviar a un socio un objeto JSON que contenga comandos, por ejemplo, el comando "Vibrar: 10":</font></font><br>
<br>
<pre><code class="plaintext hljs">{<font></font>
cate: "id",<font></font>
id: {<font></font>
DEADBABEBEEF: {<font></font>
v: 10<font></font>
}<font></font>
}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, el receptor analiza el JSON entrante, genera un comando para el juguete y lo env√≠a m√°s, y aqu√≠ hay 2 modos. El primer modo "id:" env√≠a un comando a un juguete sexual espec√≠fico, el segundo modo "all:" env√≠a un comando a todos los juguetes remotos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øLos datos entrantes se validan correctamente? Como JSON es muy flexible, el c√≥digo, que espera un n√∫mero, puede obtener una cadena completa. Si podemos controlar los comandos enviados al juguete, entonces probablemente podamos usar el error del analizador de dongle. En la siguiente diapositiva, el marco naranja muestra d√≥nde se usan los datos de entrada y el azul muestra d√≥nde se verifica.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este error es que la aplicaci√≥n no verifica correctamente que la entrada para un comando como vibrar sea en realidad un n√∫mero entero. En este caso, en el modo "id:", solo se verifica que el √≠ndice de intensidad de vibraci√≥n sea n&gt; = 0, y si pasa un n√∫mero entero 12 que es mayor que cero, este par√°metro pasar√° la prueba. Incluso si pasa una cadena, es decir, el n√∫mero entre comillas "12", el sistema lo aceptar√°. No aceptar√° solo una cadena en forma de una combinaci√≥n de n√∫meros y letras, por ejemplo, "12test".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p3/wo/30/p3wo30wl9o4ep3sbfovnxegq2zw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, esta verificaci√≥n no nos permite ingresar un comando de texto. Sin embargo, si observa la parte inferior del c√≥digo, ver√° la misma verificaci√≥n, solo que esta vez la aplicaci√≥n verifica la condici√≥n n &lt;0. Ahora, si ingresamos "12test", no pasaremos la prueba, porque la aplicaci√≥n considerar√° que la expresi√≥n dada como una cadena no es menor que 0. ¬°Pero si ingresamos una cadena con una comprobaci√≥n de desigualdad de la forma! ("12test" &lt;0), el sistema lo considerar√° verdadero , a pesar de que no es un n√∫mero entero ni un n√∫mero, sino una combinaci√≥n alfanum√©rica. En esencia, esto significa que podemos ingresar en este comando una cadena arbitraria que se enviar√° al dongle. Esto nos permite enviar el c√≥digo de explotaci√≥n de la misma manera que lo hicimos antes para comprometer el dongle a trav√©s del analizador JSON. La √∫nica diferencia es que ahora se puede hacer a trav√©s de Internet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/br/ep/cv/brepcvtjvqntad29bb6yrjzvmqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, gracias a un error en la implementaci√≥n del filtro para verificar los datos entrantes, tuvimos la oportunidad de comprometer remotamente el dongle a trav√©s de la aplicaci√≥n Lovense, a trav√©s de la cual, a su vez, podemos romper la computadora del usuario. Piratear un dongle es una gran cosa, pero la condici√≥n para el √©xito es el consentimiento del compa√±ero para transferir el control remoto sobre el juguete al atacante disfrazado. Esto es conveniente para un ataque dirigido, pero completamente inadecuado para un ataque viral. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, el chat de texto y las im√°genes no requieren ning√∫n permiso, lo que permite un ataque XSS cl√°sico mediante el env√≠o de c√≥digo HTML malicioso en un mensaje de texto de chat. La distribuci√≥n del virus se vuelve trivial: solo cree la funci√≥n JavaScript correcta y env√≠e spam a sus amigos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/l_/8x/khl_8xhfj3bvdiisecommxrbloe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, podemos ejecutar el c√≥digo solo enviando un mensaje y b√°sicamente logramos nuestro objetivo. </font><font style="vertical-align: inherit;">La carga √∫til final de XSS funciona as√≠:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haga todo lo que deber√≠a suceder en la m√°quina de la v√≠ctima.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tome un objeto JavaScript que le permita acceder al chat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Env√≠e una carga √∫til XSS que descargue este script a las computadoras de todos sus amigos.</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/8_/x5/6c/8_x56cslpr-tywovkeqgo7qbml0.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, comprometimos cada nodo de la red desde el complemento de arranque a Internet. </font><font style="vertical-align: inherit;">Ahora puede comprometer cualquier dispositivo desde cualquier dispositivo: creamos un gusano trasero o un virus llamado "gusano anal".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/iq/lu/gjiqlujshp5vcsj5tm-hv6cbl8q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como promet√≠, ahora te mostrar√© un video en vivo. Lo primero que mostrar√© es usar el conector BTLE para interceptar la conexi√≥n entre el complemento de arranque y la m√°quina virtual de Windows normal a la que est√° conectado el dongle. Ahora intentar√© encender el bootplag. ¬°Espero que todos escuchen los sonidos de vibraci√≥n! (la risa). As√≠ que funcion√≥, ahora intentar√© agregar mi juguete al panel de control de la aplicaci√≥n. ¬°Mira que el programa encontr√≥ a Hush, pero espera un minuto! Olvid√© iniciar el proceso de jack BTLE. La √∫nica raz√≥n por la que necesita usar el conector BTLE en este modo es porque facilita la demostraci√≥n en vivo, pero en la pr√°ctica, puede interceptar una conexi√≥n existente sin la necesidad de oler. As√≠ que estoy lanzando esto solo para simplificar el experimento. Vamos a repetir todo de nuevo. Ves que la conexi√≥n con el juguete est√° establecida.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/v6/_h/nzv6_hy7ygt8gu9nqx7opfjz6-u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sniffer a la izquierda muestra que encontr√≥ esta conexi√≥n. Entonces, tenemos una aplicaci√≥n que est√° asociada con nuestro juguete sexual. No s√© si escuchas que realmente puedo controlar el complemento de arranque (smea mueve el control deslizante hacia arriba, despu√©s de lo cual se escucha un sonido amplificador de vibraci√≥n). Ahora apago esta cosa (mueve el control deslizante hacia abajo, el sonido de la vibraci√≥n desaparece). Ahora necesito hackear esta conexi√≥n. Para hacer esto, copio varios par√°metros, los pego en la l√≠nea smea @ ubuntu y al final ingreso el par√°metro t, un comando para interceptar la conexi√≥n.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u4/cm/bo/u4cmbo-uglzsqjur_ikimj7lifg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si esto funciona, entonces cerrar√° la conexi√≥n con la aplicaci√≥n. Como puede ver, apareci√≥ un mensaje en la ventana de la aplicaci√≥n que indica que se perdi√≥ la conexi√≥n con el dispositivo. ¬°Gracias BTLE jack por una gran herramienta! El bootlog se desconect√≥ de la aplicaci√≥n y ahora se controla a trav√©s de la m√°quina virtual de ubuntu. Te√≥ricamente, deber√≠amos poder hacer que vibre de forma remota. Escribo el equipo Vibrate 20 y, como pueden ver, todo funciona: pudimos controlar de forma remota el bootplag sin la ayuda de la aplicaci√≥n oficial (aplausos de la audiencia). Ahora lo voy a poner en modo DFU, y si eso funciona, tendr√© que detener esto. Entro en el comando apropiado y la vibraci√≥n se detiene.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1-/e4/xa/1-e4xaksu_5edfbsymanvlja6ii.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora tomo mi tel√©fono inteligente y compruebo si puedo volver a conectar el juguete a trav√©s de la aplicaci√≥n. Entre mis aplicaciones, encuentro la actualizaci√≥n del complemento de firmware y selecciono el DfuTarg de destino, el dispositivo en el que es necesario actualizar el firmware, pero de hecho, introduzco una vulnerabilidad maliciosa en √©l. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/ft/wt/yjftwtho753czqelp_td1n8gtq4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya ves c√≥mo va el proceso de actualizaci√≥n. Aparece un mensaje en la pantalla que el firmware del dispositivo se ha actualizado correctamente. Ahora volver√© a intentar conectar el bootplag a la aplicaci√≥n instalada en mi computadora, y ver√° lo que sucede: ¬°el protector de pantalla de ransomware aparece en la pantalla (aplausos de la audiencia)! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/fz/tj/o6fztjlfigtenb5mujgp6ukz9ho.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Äú¬°Vaya, tu tap√≥n trasero est√° encriptado! Pague la restauraci√≥n del acceso a este importante juguete con $ 50 bitcoins en 3 d√≠as, de lo contrario, en una semana lo perder√° para siempre ‚Äù. ¬°As√≠ es como funciona!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ejecut√≥ el c√≥digo en el dongle, luego en la computadora y a trav√©s de Internet lleg√≥ al enchufe de arranque. Como puede ver, en t√©rminos de seguridad, este tap√≥n trasero es muy d√©bil, probablemente fue fabricado por Corea del Norte. Viste que ten√≠a una m√°quina virtual instalada que ejecutaba la aplicaci√≥n sin estar conectada a un dispositivo de seguridad u otro hardware. Esta m√°quina virtual acababa de conectarse a Internet y parec√≠a estar conectada a la computadora de mi amigo. Por lo tanto, hemos logrado con √©xito la propagaci√≥n viral del ransomware.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que de todo lo que se ha dicho, se pueden aprender un par de lecciones √∫tiles. Usando este dispositivo como ejemplo, examinamos cu√°n vulnerable puede ser el mundo de Internet de las cosas. Algunos dispositivos se utilizan como soporte vital, y las personas no se dan cuenta de cu√°n vulnerables son estas nuevas tecnolog√≠as. Hackeando una cosa "inteligente", puede conectar otros dispositivos "inteligentes" en su hogar a trav√©s de Internet. Espero que el resultado de mi investigaci√≥n sea aplicable no solo a los juguetes sexuales. Adem√°s, tengo la intenci√≥n de aprender todo el c√≥digo de esta cosa, as√≠ que √∫nete a m√≠ en Twitter. Tambi√©n voy a publicar mis herramientas en GitHub hoy en caso de que quieras comenzar a hackear tus propios bootloops.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/45/wc/wp45wcacsbefq8-9i-6p3k-qqmg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiero agradecer a todos mis amigos que me ayudaron en el pentesting y me presentaron al mundo de los enchufes de batalla, siendo homosexuales extremos. </font><font style="vertical-align: inherit;">No dar√© nombres, pero Aaron, t√∫ mismo sabes qui√©n eres (risas). </font><font style="vertical-align: inherit;">Gracias chicos, ¬°eso fue incre√≠ble!</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RnxcPeemHSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de publicidad :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por estar con nosotros. ¬øTe gustan nuestros art√≠culos? ¬øQuieres ver m√°s materiales interesantes? Ap√≥yenos haciendo un pedido o recomendando a sus amigos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS en la nube para desarrolladores desde $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬°Solo tenemos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los Pa√≠ses Bajos!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥mo construir un edificio de infraestructura. </font><font style="vertical-align: inherit;">clase c con servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495782/index.html">FOSS News No. 10 - revisi√≥n de noticias gratuitas y de c√≥digo abierto del 30 de marzo al 5 de abril de 2020</a></li>
<li><a href="../es495784/index.html">SamsPcbGuide, Parte 14: Tecnolog√≠a - Microdesarrollo y tecnolog√≠a de chip en placa</a></li>
<li><a href="../es495786/index.html">Anulaci√≥n global</a></li>
<li><a href="../es495788/index.html">¬øUn dispositivo de un coronavirus u otro carro de una barra de pan?</a></li>
<li><a href="../es495790/index.html">El intercambio como herramienta para cubrir riesgos: por qu√© necesitamos futuros inusuales</a></li>
<li><a href="../es495794/index.html">Acerca de los verbos compuestos</a></li>
<li><a href="../es495796/index.html">Elecci√≥n de tarjetas flash: una gu√≠a detallada para asegurar las variedades digitales</a></li>
<li><a href="../es495798/index.html">Kubernetes en 3 d√≠as. Casi complicado</a></li>
<li><a href="../es495800/index.html">Si ense√±√© Frontend hoy. Consejos para principiantes</a></li>
<li><a href="../es495802/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 409 (30 de marzo - 5 de abril de 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>