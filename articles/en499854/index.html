<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äç‚úàÔ∏è üèöÔ∏è üòØ Apache Bigtop and the choice of Hadoop distribution today üéè ‚ô•Ô∏è ü•¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's probably no secret that last year was a year of great change for Apache Hadoop. Last year, Cloudera and Hortonworks merged (essentially a takeove...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Apache Bigtop and the choice of Hadoop distribution today</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rostelecom/blog/499854/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/mc/g4/_k/mcg4_kr77oelzmcrcsuoak_bvgm.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It's probably no secret that last year was a year of great change for Apache Hadoop. Last year, Cloudera and Hortonworks merged (essentially a takeover of the second), and Mapr, due to serious financial problems, was sold to Hewlett Packard. And if a few years earlier, in the case of on-premises installations, the choice often had to be made between Cloudera and Hortonworks, today, alas, we did not have this choice. Another surprise was the fact that since February of this year, Cloudera announced the termination of the release of binary assemblies of its distribution into a public repository, and now they are available only by paid subscription. Of course, the ability to download the latest versions of CDH and HDP, released before the end of 2019, is still there, and support for them is expected for one to two years. But what to do next? For those,who previously paid for the subscription, nothing has changed. And for those who do not want to switch to a paid version of the distribution kit, but want to be able to get the latest versions of cluster components, as well as patches and other updates, we prepared this article. In it, we will consider possible ways out of this situation.</font></font><br>
<br>
<i>  .          ,          .    ?        Arenadata Hadoop,         ,     .     Vanilla Hadoop,    ,    ‚Äú‚Äù   Apache Bigtop. ?     .</i><br>
<a name="habracut"></a><br>
<h2>Arenadata Hadoop</h2><br>
<img src="https://habrastorage.org/webt/7f/kr/ri/7fkrriu9pcnmo67yb6nogwconaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a completely new and, so far, little-known distribution of domestic development. Unfortunately, at the moment there is only </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on Habr√© about it </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
More information can be found on the official </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">website of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project. Latest distributions are based on Hadoop 3.1.2 for version 3, and 2.8.5 for version 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Information on roadmap can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/yk/gu/rdykgutfce6fdwm1v-chlynbpfg.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arenadata Cluster Manager Interface Arenadata's</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
key product is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arenadata Cluster Manager (ADCM)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is used to install, configure and monitor various software solutions of the company. ADCM is free, and its functionality is expanded by adding bundles to it, which are a set of ansible-playbooks. Bundles are divided into two types: enterprise and community. The latter are available for free download from Arenadata. It is also possible to develop your own bundle and connect it to ADCM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For deployment and management of Hadoop 3, a community version of the bundle in conjunction with ADCM is offered, and for hadoop 2 there is only </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Ambari</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as an alternative. </font><font style="vertical-align: inherit;">As for the repositories with packages, they are open for public access, they can be downloaded and installed in the usual way for all cluster components. </font><font style="vertical-align: inherit;">In general, the distribution looks very interesting. </font><font style="vertical-align: inherit;">I‚Äôm sure there are those who are used to such solutions as Cloudera Manager and Ambari, and who will like ADCM itself. </font><font style="vertical-align: inherit;">For some, the fact that the distribution kit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is included in the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import substitution </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">software registry</font></a><font style="vertical-align: inherit;"> will be a huge plus </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about the cons, they will be the same as for all other Hadoop distributions. </font><font style="vertical-align: inherit;">Namely:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The so-called "vendor lock-in". </font><font style="vertical-align: inherit;">Using the examples of Cloudera and Hortonworks, we already realized that there is always a risk of changing company policies.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Significant lag behind Apache upstream.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vanilla hadoop</font></font></h2><br>
<img src="https://habrastorage.org/webt/uc/ai/cf/ucaicfkxuxclezuxfumjrokgeak.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you know, Hadoop is not a monolithic product, but, in fact, a whole galaxy of services around its distributed HDFS file system. Few people will need one file cluster. One needs Hive, and the other Presto, and there is HBase and Phoenix, Spark is increasingly used. Oozie, Sqoop, and Flume are sometimes found to orchestrate and download data. And if the security issue arises, Kerberos in conjunction with Ranger is immediately remembered.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Binary versions of Hadoop components are available on the website of each ecosystem project in the form of tarballs. </font><font style="vertical-align: inherit;">They can be downloaded and installation started, but with one condition: in addition to self-assembly of packages from ‚Äúraw‚Äù binaries, which you most likely want to run, you will not have any confidence in the compatibility of the downloaded versions of the components with each other. </font><font style="vertical-align: inherit;">The preferred option is to build using Apache Bigtop. </font><font style="vertical-align: inherit;">Bigtop allows you to build from Apache's maven repositories, run tests, and build packages. </font><font style="vertical-align: inherit;">But, which is very important for us, Bigtop will collect those versions of components that will be compatible with each other. </font><font style="vertical-align: inherit;">We will talk about it in more detail below.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache bigtop</font></font></h2><br>
<img src="https://habrastorage.org/webt/-g/qm/q6/-gqmq6irdahwcfpmntftm15tqni.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Bigtop is a tool for building, packaging and testing a number of </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
open source projects, such as, for example, Hadoop and Greenplum. Bigtop has many </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
releases. At the time of writing, the latest stable release was version 1.4, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and in master was 1.5. Different versions of releases use different versions of </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
components. For example, for 1.4, the Hadoop core components are version 2.8.5, and in master </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.10.0. The composition of the supported components is also changing. Something outdated and </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
non-renewable leaves, and in its place comes something new, more in demand, and </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
not necessarily something from the family of Apache itself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bigtop also has many </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we began to get acquainted with Bigtop, we were primarily surprised by its modest, in comparison with other Apache projects, prevalence and fame, as well as a very small community. It follows that there is a minimum of product information, and a search for solutions to problems that have arisen through forums and newsletters may not produce anything at all. At first, it turned out to be a difficult task for us to complete the assembly of the distribution kit due to the features of the tool itself, but we will talk about this a little later. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a teaser, for those who once visited such Linux-universe projects as Gentoo and LFS, it may seem nostalgically pleasant to work with this thing and recall those "old" times when we ourselves searched for (or even wrote) ebuilds and regularly rebuilt with new patches mozilla.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The big plus of Bigtop can be considered the openness and versatility of the tools on which it is based. </font><font style="vertical-align: inherit;">Its foundation is Gradle and Apache Maven. </font><font style="vertical-align: inherit;">Gradle is reasonably well-known as the tool Google collects Android for. </font><font style="vertical-align: inherit;">It is flexible, and, as they say, ‚Äútested in battle‚Äù. </font><font style="vertical-align: inherit;">Maven is a full-time tool for building projects in Apache itself, and since most of its products are released through Maven, it could not do without it. </font><font style="vertical-align: inherit;">It is worth paying attention to POM (project object model) - a ‚Äúfundamental‚Äù xml-file with a description of everything necessary for Maven to work with your project, around which all work is built. </font><font style="vertical-align: inherit;">It is in </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
the Maven part that some obstacles arise that are usually encountered for the first time when they take up Bigtop.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Practice</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So where to start? </font><font style="vertical-align: inherit;">We go to the download page and download the latest stable version as an archive. </font><font style="vertical-align: inherit;">Binary artifacts collected by Bigtop can also be found there. </font><font style="vertical-align: inherit;">By the way, of the common package managers, YUM and APT are supported. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alternatively, you can download the latest stable release directly from </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
github:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ git clone --branch branch-1.4 https://github.com/apache/bigtop.git</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloning in the "bigtop" ...</font></font><br>
<br>
<pre><code class="plaintext hljs">remote: Enumerating objects: 46, done.<font></font>
remote: Counting objects: 100% (46/46), done.<font></font>
remote: Compressing objects: 100% (41/41), done.<font></font>
remote: Total 40217 (delta 14), reused 10 (delta 1), pack-reused 40171<font></font>
 : 100% (40217/40217), 43.54 MiB | 1.05 MiB/s, .<font></font>
 : 100% (20503/20503), .<font></font>
Updating files: 100% (1998/1998), .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The resulting ./bigtop directory looks something like this: </font></font><br>
<br>
<code>./bigtop-bigpetstore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- demo applications, synthetic examples </font></font><br>
<code>./bigtop-ci</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- CI tools, jenkins </font></font><br>
<code>./bigtop-data-generators</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- data generation, synthetics, for smoke tests, etc. </font></font><br>
<code>./bigtop-deploy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- deployment tools </font></font><br>
<code>./bigtop-packages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- configs, scripts, patches for assembly, the main part of the tool </font></font><br>
<code>./bigtop-test-framework</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- testing framework </font></font><br>
<code>./bigtop-tests</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- tests themselves, stress and smoke </font></font><br>
<code>./bigtop_toolchain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- environment for assembly, preparation of the environment for the tool to work </font></font><br>
<code>./build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- working directory of the assembly </font></font><br>
<code>./dl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- directory for downloaded sources </font></font><br>
<code>./docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- assembly in docker- images, testing </font></font><br>
<code>./gradle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- gradle config </font></font><br>
<code>./output </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the directory into which assembly artifacts get into </font></font><br>
<code>./provisioner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- provisioning </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most interesting for us at this stage is the main config</font></font><code>./bigtop/bigtop.bom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, in which we see all supported components with versions. </font><font style="vertical-align: inherit;">This is where we can specify a different version of the product (if suddenly we want to try to build it) or a version of the assembly (if, for example, we added a significant patch). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also of great interest is the subdirectory </font></font><code>./bigtop/bigtop-packages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is directly related to the assembly process of components and packages with them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we downloaded the archive, unpacked it or made a clone with github, can we start the assembly? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No, first prepare the environment.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Environment preparation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here a small digression is needed. </font><font style="vertical-align: inherit;">To build almost any more or less complex product, you need a certain environment - in our case, it is JDK, the same shared libraries, header files, etc., tools, for example, ant, ivy2 and much more. </font><font style="vertical-align: inherit;">One of the options to get the environment necessary for Bigtop is to install the necessary components on the assembly host. </font><font style="vertical-align: inherit;">I may be mistaken in the chronology, but it seems that from version 1.0 there was also a build option in preconfigured and accessible docker images, you can find them here. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As for the preparation of the environment, there is an assistant for this - Puppet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can use the following commands, the launch is done from the root directory of the </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tool,</font></font><code>./bigtop:</code><br>
<br>
<pre><code class="plaintext hljs">./gradlew toolchain<font></font>
./gradlew toolchain-devtools<font></font>
./gradlew toolchain-puppetmodules<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or directly through puppet:</font></font><br>
<br>
<pre><code class="plaintext hljs">puppet apply --modulepath=&lt;path_to_bigtop&gt; -e "include bigtop_toolchain::installer"<font></font>
puppet apply --modulepath=&lt;path_to_bigtop&gt; -e "include bigtop_toolchain::deployment-tools"<font></font>
puppet apply --modulepath=&lt;path_to_bigtop&gt; -e "include bigtop_toolchain::development-tools"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, difficulties may arise already at this stage. </font><font style="vertical-align: inherit;">The general advice here is to use a supported distribution, up to date on the build host, or try the path with docker.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assembly</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What can we try to collect? </font><font style="vertical-align: inherit;">The answer to this question will give the output of the command</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew tasks</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Package tasks section has a number of products that are the final artifacts of Bigtop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They can be identified by the suffix -rpm or -pkg-ind (in case of assembly </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in docker). </font><font style="vertical-align: inherit;">In our case, the most interesting is Hadoop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's try to build in the environment of our build server:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew hadoop-rpm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bigtop itself will download the necessary sources needed for a particular component and begin building. Thus, the tool is tied to Maven repositories and other sources, that is, it needs Internet access. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the process, a standard output is formed. Sometimes you can understand from it and the error messages what went wrong. And sometimes you need more information. In this case, it is worth adding the arguments </font></font><code>--info </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>--debug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and may also be useful </font></font><code>‚Äìstacktrace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. There is a convenient way to generate a data set for subsequent reference to the mailing lists, the key </font></font><code> --scan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With it, bigtop will collect all the information and put it in gradle, after which it will give a link, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
after which a competent person will be able to understand why the assembly failed.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to keep in mind that this option may make information undesirable for you public, such as usernames, nodes, environment variables, etc., so be careful. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Often errors are the result of the inability to obtain any components necessary for assembly. </font><font style="vertical-align: inherit;">As a rule, you can fix the problem by creating a patch to fix something in the source, for example, the address in pom.xml in the root directory of the source. </font><font style="vertical-align: inherit;">This is done by creating and placing it in the appropriate </font></font><code> ./bigtop/bigtop-packages/src/common/oozie/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch </font><font style="vertical-align: inherit;">directory </font><font style="vertical-align: inherit;">, for example, in the form of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch2-fix.diff.</font></font></i><br>
<br>
<pre><code class="apache hljs">--- <span class="hljs-attribute">a</span>/pom.xml<font></font>
+++ <span class="hljs-attribute">b</span>/pom.xml<font></font>
@@ -<span class="hljs-attribute">136</span>,<span class="hljs-number">7</span> +<span class="hljs-number">136</span>,<span class="hljs-number">7</span> @@
<span class="hljs-section">&lt;repositories&gt;</span>
<span class="hljs-section">&lt;repository&gt;</span>
<span class="hljs-section">&lt;id&gt;</span><span class="hljs-attribute">central</span>&lt;/id&gt;<font></font>
- <span class="hljs-section">&lt;url&gt;</span><span class="hljs-attribute">http</span>://repo<span class="hljs-number">1</span>.maven.org/maven<span class="hljs-number">2</span>&lt;/url&gt;<font></font>
+ <span class="hljs-section">&lt;url&gt;</span><span class="hljs-attribute">https</span>://repo<span class="hljs-number">1</span>.maven.org/maven<span class="hljs-number">2</span>&lt;/url&gt;
<span class="hljs-section">&lt;snapshots&gt;</span>
<span class="hljs-section">&lt;enabled&gt;</span><span class="hljs-attribute">false</span>&lt;/enabled&gt;
<span class="hljs-section">&lt;/snapshots&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most likely, at the time of reading this article, the above correction you will not have to do yourself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When introducing any patches and edits into the assembly mechanism, you may need to ‚Äúreset‚Äù the assembly through the cleanup command:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew hadoop-clean<font></font>
&gt; Task :hadoop_vardefines<font></font>
&gt; Task :hadoop-clean<font></font>
BUILD SUCCESSFUL in 5s<font></font>
2 actionable tasks: 2 executed</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This operation will roll back all changes in the assembly of this component, after which the assembly will be performed again. </font><font style="vertical-align: inherit;">This time we will try to build the project in a docker image:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew -POS=centos-7 -Pprefix=1.2.1 hadoop-pkg-ind<font></font>
&gt; Task :hadoop-pkg-ind<font></font>
Building 1.2.1 hadoop-pkg on centos-7 in Docker...<font></font>
+++ dirname ./bigtop-ci/build.sh<font></font>
++ cd ./bigtop-ci/..<font></font>
++ pwd<font></font>
+ BIGTOP_HOME=/tmp/bigtop<font></font>
+ '[' 6 -eq 0 ']'<font></font>
+ [[ 6 -gt 0 ]]<font></font>
+ key=--prefix<font></font>
+ case $key in<font></font>
+ PREFIX=1.2.1<font></font>
+ shift<font></font>
+ shift<font></font>
+ [[ 4 -gt 0 ]]<font></font>
+ key=--os<font></font>
+ case $key in<font></font>
+ OS=centos-7<font></font>
+ shift<font></font>
+ shift<font></font>
+ [[ 2 -gt 0 ]]<font></font>
+ key=--target<font></font>
+ case $key in<font></font>
+ TARGET=hadoop-pkg<font></font>
+ shift<font></font>
+ shift<font></font>
+ [[ 0 -gt 0 ]]<font></font>
+ '[' -z x ']'<font></font>
+ '[' -z x ']'<font></font>
+ '[' '' == true ']'<font></font>
+ IMAGE_NAME=bigtop/slaves:1.2.1-centos-7<font></font>
++ uname -m<font></font>
+ ARCH=x86_64<font></font>
+ '[' x86_64 '!=' x86_64 ']'<font></font>
++ docker run -d bigtop/slaves:1.2.1-centos-7 /sbin/init<font></font>
+<font></font>
CONTAINER_ID=0ce5ac5ca955b822a3e6c5eb3f477f0a152cd27d5487680f77e33fbe66b5bed8<font></font>
+ trap 'docker rm -f<font></font>
0ce5ac5ca955b822a3e6c5eb3f477f0a152cd27d5487680f77e33fbe66b5bed8' EXIT<font></font>
....<font></font>
 <font></font>
....<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-hdfs-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-yarn-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-mapreduce-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-hdfs-namenode-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-hdfs-secondarynamenode-2.8.5-<font></font>
1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-hdfs-zkfc-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-hdfs-journalnode-2.8.5-<font></font>
1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-hdfs-datanode-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-httpfs-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-yarn-resourcemanager-2.8.5-<font></font>
1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-yarn-nodemanager-2.8.5-<font></font>
1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-yarn-proxyserver-2.8.5-<font></font>
1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-yarn-timelineserver-2.8.5-<font></font>
1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-mapreduce-historyserver-2.8.5-<font></font>
1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-client-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-conf-pseudo-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-doc-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-libhdfs-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-libhdfs-devel-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-hdfs-fuse-2.8.5-1.el7.x86_64.rpm<font></font>
Wrote: /bigtop/build/hadoop/rpm/RPMS/x86_64/hadoop-debuginfo-2.8.5-1.el7.x86_64.rpm<font></font>
+ umask 022<font></font>
+ cd /bigtop/build/hadoop/rpm//BUILD<font></font>
+ cd hadoop-2.8.5-src<font></font>
+ /usr/bin/rm -rf /bigtop/build/hadoop/rpm/BUILDROOT/hadoop-2.8.5-1.el7.x86_64<font></font>
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.uQ2FCn<font></font>
+ exit 0<font></font>
+ umask 022<font></font>
Executing(--clean): /bin/sh -e /var/tmp/rpm-tmp.CwDb22<font></font>
+ cd /bigtop/build/hadoop/rpm//BUILD<font></font>
+ rm -rf hadoop-2.8.5-src<font></font>
+ exit 0<font></font>
[ant:touch] Creating /bigtop/build/hadoop/.rpm<font></font>
:hadoop-rpm (Thread[Task worker for ':',5,main]) completed. Took 38 mins 1.151 secs.<font></font>
:hadoop-pkg (Thread[Task worker for ':',5,main]) started.<font></font>
&gt; Task :hadoop-pkg<font></font>
Task ':hadoop-pkg' is not up-to-date because:<font></font>
Task has not declared any outputs despite executing actions.<font></font>
:hadoop-pkg (Thread[Task worker for ':',5,main]) completed. Took 0.0 secs.<font></font>
BUILD SUCCESSFUL in 40m 37s<font></font>
6 actionable tasks: 6 executed<font></font>
+ RESULT=0<font></font>
+ mkdir -p output<font></font>
+ docker cp<font></font>
ac46014fd9501bdc86b6c67d08789fbdc6ee46a2645550ff6b6712f7d02ffebb:/bigtop/build .<font></font>
+ docker cp<font></font>
ac46014fd9501bdc86b6c67d08789fbdc6ee46a2645550ff6b6712f7d02ffebb:/bigtop/output .<font></font>
+ docker rm -f ac46014fd9501bdc86b6c67d08789fbdc6ee46a2645550ff6b6712f7d02ffebb<font></font>
ac46014fd9501bdc86b6c67d08789fbdc6ee46a2645550ff6b6712f7d02ffebb<font></font>
+ '[' 0 -ne 0 ']'<font></font>
+ docker rm -f ac46014fd9501bdc86b6c67d08789fbdc6ee46a2645550ff6b6712f7d02ffebb<font></font>
Error: No such container:<font></font>
ac46014fd9501bdc86b6c67d08789fbdc6ee46a2645550ff6b6712f7d02ffebb<font></font>
BUILD SUCCESSFUL in 41m 24s<font></font>
1 actionable task: 1 executed</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The build was done under CentOS, but you can also do it under Ubuntu:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew -POS=ubuntu-16.04 -Pprefix=1.2.1 hadoop-pkg-ind</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to assembling packages for various Linux distributions, the tool can create a repository with assembled packages, for example:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew yum</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You might also recall smoke tests and deployment in docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create a cluster of three nodes:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew -Pnum_instances=3 docker-provisioner</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run smoke tests in a cluster of three nodes:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew -Pnum_instances=3 -Prun_smoke_tests docker-provisioner</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Delete cluster:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew docker-provisioner-destroy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get commands for connecting inside docker containers:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew docker-provisioner-ssh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Show status:</font></font><br>
<br>
<pre><code class="plaintext hljs">./gradlew docker-provisioner-status</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can read more about Deployment tasks in the documentation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about tests, then there are quite a large number of them, mainly smoke and integration ones. </font><font style="vertical-align: inherit;">Their analysis is beyond the scope of this article. </font><font style="vertical-align: inherit;">I can only say that building the distribution kit is not as difficult as it might seem at first glance. </font><font style="vertical-align: inherit;">We managed to collect and pass all the components that we use in our products in the prod, and we also had no problems with their deployment and performing basic operations in a test environment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the existing components in Bigtop, it is possible to add something else, even your own software development. </font><font style="vertical-align: inherit;">All this is perfectly automated and fits into the CI / CD concept.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviously, a distribution built in this way should not be immediately sent to production. You need to understand that if there is a real need to build and maintain your distribution, then you need to invest financially and time. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nevertheless, in combination with the right approach and a professional team, it is quite possible to do without commercial solutions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is important to note that the Bigtop project itself needs to be developed and it seems that today there is no active development in it. Also, the prospect of the appearance of Hadoop 3 in it is not clear. By the way, if you have a real need for building Hadoop 3, you can look at the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fork</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from Arenadata, in which, in addition to standard </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
components, there are a number of additional components (Ranger, Knox, NiFi).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As for Rostelecom, for us Bigtop is one of the options considered today. </font><font style="vertical-align: inherit;">Whether we stop it or not, time will tell.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appendix</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To include a new component in the assembly, you need to add its description in bigtop.bom and ./bigtop-packages. </font><font style="vertical-align: inherit;">You can try to do this by analogy with existing components. </font><font style="vertical-align: inherit;">Try to figure it out. </font><font style="vertical-align: inherit;">It is not as difficult as it seems at first glance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What do you think? </font><font style="vertical-align: inherit;">We will be glad to see your opinion in the comments and thank you for your attention! </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This article was prepared by the Rostelecom data management team</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499838/index.html">.NET: Dependency Treatment</a></li>
<li><a href="../en499842/index.html">Why do people relearn</a></li>
<li><a href="../en499846/index.html">When separate garbage collection will start working and why video monitoring of sites for garbage containers is needed</a></li>
<li><a href="../en499850/index.html">How to analyze competitors and set up a digital strategy in 40 minutes</a></li>
<li><a href="../en499852/index.html">English-language documentation for Angular</a></li>
<li><a href="../en499858/index.html">What to do on the weekend: an overview of some board games for those who are tired of blue screens</a></li>
<li><a href="../en499870/index.html">Pylint: a detailed test of the code analyzer</a></li>
<li><a href="../en499872/index.html">Modularity in Java 9</a></li>
<li><a href="../en499874/index.html">Cough Detection on Intel NUC</a></li>
<li><a href="../en499876/index.html">Top 5 classic books to improve financial literacy and prepare for the first steps on the exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>