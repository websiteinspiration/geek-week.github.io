<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“¿ ğŸ–Šï¸ ğŸ‘¨ğŸ¿â€ğŸ’¼ UID dan Penguntit Otorisasi pada MAG250 ğŸ® ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ¼ ğŸ“¹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya telah lama tertarik dengan topik otorisasi konsol media di portal Stalker, tetapi itu tidak terjadi sebelumnya. Suatu hari saya tidak sengaja men...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>UID dan Penguntit Otorisasi pada MAG250</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486896/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya telah lama tertarik dengan topik otorisasi konsol media di portal Stalker, tetapi itu tidak terjadi sebelumnya. </font><font style="vertical-align: inherit;">Suatu hari saya tidak sengaja mendapatkan awalan Infomir MAG250 dan saya memutuskan untuk mengatasi masalah ini.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latihan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, saya membongkar awalan, menyolder kabel ke konektor dan menghubungkannya ke komputer. </font><font style="vertical-align: inherit;">Setelah meluncurkan program terminal, saya senang dengan U-Boot yang familier. </font><font style="vertical-align: inherit;">Proses booting juga dapat terganggu dengan menekan tombol apa saja (biasanya pabrikan menonaktifkan chip tersebut dan Anda harus menghabiskan banyak waktu untuk membawa U-Boot ke keadaan yang diinginkan). </font><font style="vertical-align: inherit;">Akses dengan hak akses root juga tersedia melalui ssh. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o-/4t/p6/o-4tp67pijj-mwgwzsxy7tcq0fu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konsol ini dilengkapi dengan DRAM 256MB dan dua flash drive, NOR 1 MB dan NAND 256 MB. </font><font style="vertical-align: inherit;">Dengan NOR, U-Boot dimuat dalam proses, yang memuat kernel dan sistem file dari NAND.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fungsi Getuid ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awalan mengotorisasi dirinya sendiri di portal Stalker, mengirimkan banyak informasi, seperti, misalnya, jenis, versi firmware, versi perangkat keras, nomor seri, dll. Tapi saya secara khusus tertarik pada parameter device_id, yang dikeluarkan oleh fungsi gSTB.GetUID (). Pada pandangan pertama, itu adalah hash seperti SHA256 atau MD5. Mengacu pada dokumentasi resmi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soft.infomir.com/stbapi/JS/v343/gSTB.html#.GetUID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , fungsinya dapat memakan waktu hingga dua parameter, tetapi hal pertama yang saya tertarik adalah opsi tanpa parameter. Dengan memuat stbapp di IDA, kami dapat dengan mudah menemukan fungsi ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ev/5q/ln/ev5qlnsrhnbb2d61izfqbwqktp4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melangkah lebih jauh, kita melihat momen yang menarik</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k7/gr/ow/k7growkphe0iah5oqaidlljtgpe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, program mengalokasikan memori 0x41 byte, membatalkannya, dan memanggil fungsi driver / dev / stapi / stevt_ioctl, meneruskannya dengan memori ini dan parameter 0xC004C919. </font><font style="vertical-align: inherit;">Oleh karena itu, driver stevt_ioctl tertentu bertanggung jawab untuk menghasilkan UID. </font><font style="vertical-align: inherit;">Untuk memeriksanya, saya dengan cepat membuat sketsa kode ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mo/fa/no/mofanof9n_oicnlia9xzepfbbpo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menjalankannya di konsol, saya melihat UID yang sudah dikenal.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stevt_ioctl</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah selanjutnya adalah membongkar driver stapi_ioctl_stripped.ko, yang terletak di / root / modules. </font><font style="vertical-align: inherit;">Kami memuat driver ke dalam IDA dan menemukan handler 0xC004C919 ioctl (saya menyebut fungsi ini calcHash). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/0x/ph/yh0xphq5q-bouv83w_vdpsl10js.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada tiga poin menarik. </font><font style="vertical-align: inherit;">Pertama, memori 0x41 byte disalin dari ruang pengguna ke ruang kernel (inilah yang ditransmisikan oleh pengguna dan dalam kasus kami terdiri dari nol), fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_mem_type disebut</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sepanjang jalan di kernel itu sendiri) dan hasilnya (lagi 0x41 byte) kemudian disalin ke area alamat pengguna. </font><font style="vertical-align: inherit;">Untuk menemukan alamat fungsi get_mem_type, saya melihat dua kemungkinan: lihat saja file / proc / kallsysms, berharap akses tidak dibatasi, yah, atau, jika tidak, tuliskan assembler assembler untuk driver itu sendiri yang akan mengembalikan nilai register r0 di tempat yang tepat. </font><font style="vertical-align: inherit;">Setelah mencari di / proc / kallsysms, saya terkejut dan menemukan alamat fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_mem_type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x8080E380.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inti</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk analisis lebih lanjut, Anda perlu menganalisis kernel. Kernel itu sendiri dapat ditemukan di firmware pabrikan, atau Anda dapat menghapus dump menggunakan U-Boot </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/pw/rk/jypwrkvsciffckeuityrrpxw0gk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
atau me-mount partisi yang diinginkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berdasarkan informasi U-Boot, kernel dimuat pada 0x80800000, dan titik masuknya pada 0x80801000. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memuat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kernel di IDA dan menemukan fungsi </font><b><font style="vertical-align: inherit;">get_mem_type</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menganalisis kode, saya menemukan bagian ini, yang seharusnya mengembalikan UID. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d3/fq/tf/d3fqtfjotcjbowla35u8ww7rzzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi UID disimpan di 0x80D635EC. Selanjutnya, kami mencari di IDA, di mana nilai ini terbentuk. Ini ada dalam fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">init_board_extra</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (saya tidak akan menerjemahkan daftar lengkap)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cl/ws/l2/clwsl2szmjouku6qbpyucp2g2hc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi ini adalah nilai yang tidak diketahui sama di alamat register r4 dari mana hash bunga dihitung (fill_hash dengan cara diselesaikan oleh SHA256). </font><font style="vertical-align: inherit;">Saya benar-benar ingin mengetahui apa itu dan saya dengan cepat menulis sebuah insert assembler, yang, melalui fungsi printk, mengembalikan isi memori ke alamat register r2. </font><font style="vertical-align: inherit;">Setelah memodifikasi kernel dengan cara ini, saya membuat uImage baru dan mengunggahnya ke drive USB. </font><font style="vertical-align: inherit;">Dan di set U-Boot terminal:</font></font><br>
<br>
<pre><code class="plaintext hljs">usb start<font></font>
fatload usb 0:1 80000000 uImage<font></font>
bootm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi setelah tim terakhir, kesedihan seperti itu menunggu saya, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/pw/js/xypwjsvafjdefnqk9q4u18npeji.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
U-Boot dengan sopan menolak untuk mengirimkan kernel baru saya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengedit U-Boot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk meyakinkan U-Boot untuk mem-boot kernel saya, saya memutuskan untuk menambalnya di memori dengan perintah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> itu sendiri </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Untuk memulai, saya membuat dump penuh NOR flash, yang terletak di 0xA0000000. </font><font style="vertical-align: inherit;">Setelah mengarahkan dump ke IDA, saya menemukan alamat memori tempat U-Boot menyalin sendiri. </font><font style="vertical-align: inherit;">Itu 0x8FD00000. </font><font style="vertical-align: inherit;">Sekali lagi, setelah membuang bagian memori ini dan menjalankan IDA, saya dengan mudah menemukan fungsi yang memeriksa tanda tangan. </font><font style="vertical-align: inherit;">Jika semuanya benar, dia mengembalikan 0. Selain itu, dia dipanggil di dua tempat yang berbeda. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/on/tq/eb/ontqebdlazmflevjnrx2kx9nnkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa sebenarnya fungsi ini lakukan tidak menarik bagi saya. </font><font style="vertical-align: inherit;">Dia hanya perlu mengembalikan 0 seperti ini:</font></font><br>
<br>
<pre><code class="plaintext hljs">mov #0x0, r0<font></font>
rts<font></font>
nop</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode yang sesuai untuk U-Boot sekarang seperti ini:</font></font><br>
<br>
<pre><code class="plaintext hljs">usb start<font></font>
mw.l 8fd0ec08 000b200a;<font></font>
mw.l 8fd0ec0c 00900009<font></font>
fatload usb 0:1 80000000 uImage<font></font>
bootm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian U-Boot dengan senang hati memuat kernel saya, yang dikeluarkan</font></font><br>
<br>
<pre><code class="plaintext hljs">EF0F3A38FF7FD567012016J04501200:1a:79:23:7e:2MAG250pq8UK0DAOQD1JzpmBx1Vwdb58f9jP7SN</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisis lengkap</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, terdiri dari apa UID itu? Itu adalah sejumlah 8 byte yang tidak diketahui, nomor seri konsol, alamat MAC, jenis konsol dan sepotong sampah. Masih mencari tahu nomor berapa yang tidak dikenal itu dan dari mana sampah itu berasal. Saya kembali ke fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">init_board_extra lagi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nomor tak dikenal diambil dari bagian kode ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8g/hu/u2/8ghuu2d4buowz6plm_feo1hi9pk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, menggunakan fungsi __ioremap, kernel mengakses memori fisik pada 0x00000000 (yang merupakan alamat NOR flash), menulis 0x0F ke 0x00000000, kemudian 0x98 ke 0x000000AA dan membaca 8 byte mulai dari 0x000000C2. Dan apa ini? Ini adalah perintah protokol CFI dimana kernel berkomunikasi dengan NOR. 0x0F membawa NOR ke keadaan semula, dan dengan 0x98 beralih perintah mods CFI. Dalam modul ini, di alamat 0x000000C2 adalah Area Kode Keamanan atau nomor perangkat unik 64-bit. Itu nomor yang tidak dikenal adalah nomor flash NOR yang unik. Berikut ini adalah tumpukan identifikasi CFI. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5y/y_/ez/5yy_eziyuvoq3pirbxmfecrjfqu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat melakukan dump langsung di U-Boot dengan mengatur</font></font><br>
<pre><code class="plaintext hljs">mw.w a0000000 f0<font></font>
mw.w a00000aa 98<font></font>
md.b a1000000 100<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepotong sampah hanyalah set karakter 32-byte biasa yang dijahit ke dalam kernel itu sendiri.Dan </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n3/dz/tb/n3dztbcvv-kjjud2dhvkg25lrni.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sampah ini diproses sebelum menggunakan fungsi enkripsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swap_pairs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang hanya mengubah posisi byte</font></font><br>
<br>
<pre><code class="plaintext hljs">[0x00000003]&lt;-&gt;[0x0000000F]<font></font>
[0x00000005]&lt;-&gt;[0x0000001F]<font></font>
[0x00000009]&lt;-&gt;[0x00000002]<font></font>
[0x0000000A]&lt;-&gt;[0x0000001D]<font></font>
[0x00000010]&lt;-&gt;[0x00000015]<font></font>
[0x00000004]&lt;-&gt;[0x00000013]<font></font>
[0x0000000D]&lt;-&gt;[0x00000018]</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berdasarkan informasi yang diterima, saya berani berasumsi bahwa database pabrikan berisi informasi pada setiap ID NOR flash dan nomor seri serta alamat MAC yang sesuai. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, tidak mungkin untuk memilih semua ini, tetapi Anda dapat menulis perangkat lunak Anda sendiri, yang akan sepenuhnya meniru konsol.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486880/index.html">Kesalahan penerjemah yang menyebabkan konsekuensi bencana</a></li>
<li><a href="../id486884/index.html">Perusahaan farmasi Jepang mulai menguji obat yang disintesis menggunakan jaringan saraf</a></li>
<li><a href="../id486888/index.html">Buku "Pendekatan Berorientasi Objek. Int 5. ed. "</a></li>
<li><a href="../id486890/index.html">Pengembangan diri: bagaimana saya tidak duduk di dua kursi dan menemukan yang ketiga</a></li>
<li><a href="../id486892/index.html">API Pemilih Kontak, atau cara berbagi kontak Anda dengan browser</a></li>
<li><a href="../id486902/index.html">Pemrograman Berorientasi Protokol dalam Swift 5.1</a></li>
<li><a href="../id486904/index.html">Menampilkan kepada pengembang status kontrol kualitas kode sumber di SonarQube</a></li>
<li><a href="../id486908/index.html">Wulfric Ransomware adalah cryptor yang tidak ada</a></li>
<li><a href="../id486912/index.html">Lowkiq. Kenapa kita melakukannya?</a></li>
<li><a href="../id486914/index.html">8. Fortinet Memulai v6.0. Bekerja dengan pengguna</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>