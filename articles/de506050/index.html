<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍧 👩🏾‍🔬 🧚🏿 Unit Tests in uVision Keil (und nicht nur) 👩🏿‍🔬 👩🏿‍🤝‍👩🏼 🥂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Debatte darüber, ob Unit-Tests überhaupt benötigt werden und wie genau sie zu schreiben sind, hört nicht auf. Zuerst Code schreiben oder zuerst Te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unit Tests in uVision Keil (und nicht nur)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506050/"><p><img src="https://habrastorage.org/webt/xs/md/pa/xsmdpaxzbhl_ljho6y7qhjiyrsi.png" alt="CPAP"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Debatte darüber, ob Unit-Tests überhaupt benötigt werden und wie genau sie zu schreiben sind, hört nicht auf. </font><font style="vertical-align: inherit;">Zuerst Code schreiben oder zuerst Tests schreiben? </font><font style="vertical-align: inherit;">Ist die Kapselung während des Tests unterbrochen oder kann nur die öffentliche API berührt werden? </font><font style="vertical-align: inherit;">Wie viele Prozent des Codes sollten durch Tests abgedeckt werden?</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Testen in eingebetteten Systemen wird ebenfalls kontrovers diskutiert. </font><font style="vertical-align: inherit;">Die Meinungen variieren von "Abdeckung sollte 100% sein + Teststände sind erforderlich" bis zu "Welche anderen Tests habe ich geschrieben? Es bedeutet, dass alles funktioniert."</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich möchte keinen Holivar starten und im Allgemeinen versuche ich, ein vernünftiges Gleichgewicht einzuhalten. </font><font style="vertical-align: inherit;">Daher schlage ich zunächst vor, die am tiefsten hängenden Früchte in Betracht zu ziehen, die das Testen von Einheiten in Bezug auf die eingebettete Entwicklung vereiteln können.</font></font></p><a name="habracut"></a><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie können Code für ein Gerät schreiben, das Sie noch nicht haben. </font><font style="vertical-align: inherit;">Es kann sich um einen Sensor von aliexpress handeln, der zwei Wochen per Post oder ein Haushaltsgerät mit einer Lieferzeit von sechs Monaten benötigt - dies ist nicht so wichtig.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie können den Code ändern und haben keine Angst, dass Ihre Änderungen etwas beschädigen, das zuvor funktioniert hat (sofern dies natürlich durch Tests abgedeckt ist).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Konsequenz aus dem vorherigen Absatz: Sie können die Entwicklung auf eine andere Person übertragen und haben auch keine Angst, dass sie etwas kaputt macht, das zuvor funktioniert hat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie Bibliotheken schreiben (mindestens einen Code, der mehrmals verwendet wird), können Sie mithilfe von Tests Situationen synthetisieren, die Sie sehr lange mit Ihren Händen erfassen können.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der Testkonfiguration können Sie alle Arten von zusätzlichen Tools verwenden, um die Qualität / Zuverlässigkeit des Codes zu bewerten - Desinfektionsmittel, Compileroptionen zum Schutz vor Stapelüberläufen und dergleichen, die nicht in die "Kampf" -Firmware passen</font></font></li>
</ol><br>
<p>     ,      ,    ,             ,        .</p><br>
<p>    ,     -  (  ,     ?).</p><br>
<p>,     ,      (      ,   );           ,   ,        ,      .</p><br>
<p>    -     —  ,  ().       ++</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">,   , ,  </b>
                        <div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   ?</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    Keil'a</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  CppUTest</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Munit</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">UmbaCppTest</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> assert'</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> ,   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">     "" </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">         </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  :</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  :</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    ( )</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
</ul></div>
                    </div><br>
<h1 id="kak-mozhno-zapuskat-testy">   ?</h1><br>
<p>  ,    3 :</p><br>
<ol>
<li>   (    ,  )</li>
<li>   — ..    </li>
<li>  </li>
</ol><br>
<p>      .</p><br>
<h2 id="na-obychnom-pk">  </h2><br>
<p>:</p><br>
<ul>
<li>   </li>
<li>   ,      ,   </li>
<li>   ;      </li>
<li>    — valgrind, </li>
<li>    —  stdout,   ,    —   </li>
</ul><br>
<p> :</p><br>
<p>     .  ,      ,      .   ,     . , ,    —    ,  ,    ;        ,          .</p><br>
<p>:</p><br>
<ul>
<li>     — .. -    <em> </em>,        (, -             86)</li>
<li>      / .      ,   .</li>
<li>  </li>
<li>    </li>
</ul><br>
<h2 id="na-fizicheskom-mk">  </h2><br>
<p>:</p><br>
<ul>
<li>  ,    </li>
<li>   </li>
<li>      </li>
<li>     </li>
</ul><br>
<p>    ,     — ,      ,    . </p><br>
<p>:</p><br>
<ul>
<li>  —   ,   </li>
<li>   ,    .. </li>
<li> -        - ,    </li>
<li>,   </li>
</ul><br>
<h2 id="v-simulyatore"> </h2><br>
<p>:</p><br>
<ul>
<li>   ,     </li>
<li>     </li>
<li>    </li>
<li>  ,        </li>
</ul><br>
<p>    .</p><br>
<p>:</p><br>
<ul>
<li> </li>
<li>    </li>
<li> <em> </em>   ,     </li>
</ul><br>
<p>   —   ,   ?</p><br>
<h1 id="chto-testirovat"> ?</h1><br>
<p>  ,    ,   — .  ,        ,   — .</p><br>
<p> ,    ,     -     . ,   -   <em></em>     —            .</p><br>
<p>, ,    BLDC-  ,     , ,   . , ,    - OLED-    .</p><br>
<p>       ,    .</p><br>
<p>  ?  , -,     ,           .      ,      .</p><br>
<h1 id="istoricheskaya-perspektiva-i-lokalnaya-specifika">    </h1><br>
<p> .    ,       ,   .</p><br>
<p> ,     :</p><br>
<ul>
<li> (.. ) ,     .       ; -    </li>
<li>   ,      ,       - ,   </li>
<li>    ,        "", -:<br>
<ul>
<li>     </li>
<li> DC  BLDC </li>
<li>       </li>
<li>      </li>
</ul></li>
<li>        </li>
</ul><br>
<p>  —  " ",     :</p><br>
<ul>
<li>    "  —  ".        ,      ""   ,      </li>
<li>    Windows,   IDE  uVision Keil.    ,   :) </li>
<li> —  ARM Cortex;   — STM32,  "" — .    .</li>
<li>     ,      ++</li>
<li>   ( )    </li>
<li> ,        </li>
<li>      2013  — C++11   , Keil   4.20    ++11  </li>
</ul><br>
<p>     ?    .</p><br>
<p>    ,      ;      10      .    "  " —     -  IDE,  ,      —  .</p><br>
<p>    ,    Linux (,    QEMU).</p><br>
<p>     -  —   (   ),          .</p><br>
<p>           Keil.         :)</p><br>
<h1 id="zapusk-testov-v-simulyatore-keila">    Keil'a</h1><br>
<h2 id="vybor-freymvorka"> </h2><br>
<p>,  ,   ,   ,   ,    . ,     GoogleTest,       ,             <em> </em>,     ,       .<br>
  CppUTest    IAR'a (    Keil).</p><br>
<p> ,    . ,  CppUTest     Keil'e;       ,   .          IAR,  .</p><br>
<p>  ,     :</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">UtestPlatform.cpp</b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdarg.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;float.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ctype.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;setjmp.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CppUTest/TestHarness.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CppUTest/PlatformSpecificFunctions.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CppUTest/TestRegistry.h"</span></span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-keyword">static</span> jmp_buf test_exit_jmp_buf[<span class="hljs-number">10</span>];
<span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> jmp_buf_index = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificSetJmp</span><span class="hljs-params">(<span class="hljs-keyword">void</span> (*function) (<span class="hljs-keyword">void</span>* data), <span class="hljs-keyword">void</span>* data)</span>
</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == setjmp(test_exit_jmp_buf[jmp_buf_index])) {<font></font>
        jmp_buf_index++;<font></font>
        function(data);<font></font>
        jmp_buf_index--;<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PlatformSpecificLongJmp</span><span class="hljs-params">()</span>
</span>{<font></font>
    jmp_buf_index--;<font></font>
    longjmp(test_exit_jmp_buf[jmp_buf_index], <span class="hljs-number">1</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PlatformSpecificRestoreJumpBuffer</span><span class="hljs-params">()</span>
</span>{<font></font>
    jmp_buf_index--;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PlatformSpecificRunTestInASeperateProcess</span><span class="hljs-params">(UtestShell* shell, TestPlugin* plugin, TestResult* result)</span>
</span>{
   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"-p doesn't work on this platform as it is not implemented. Running inside the process\b"</span>);<font></font>
   shell-&gt;runOneTest(plugin, *result);<font></font>
}<font></font>
<font></font>
<span class="hljs-function">TestOutput::WorkingEnvironment <span class="hljs-title">PlatformSpecificGetWorkingEnvironment</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> TestOutput::vistualStudio;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">///////////// Time in millis</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">TimeInMillisImplementation</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">12345</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">long</span> <span class="hljs-params">(*timeInMillisFp)</span> <span class="hljs-params">()</span> </span>= TimeInMillisImplementation;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">GetPlatformSpecificTimeInMillis</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> timeInMillisFp();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetPlatformSpecificTimeInMillisMethod</span><span class="hljs-params">(<span class="hljs-keyword">long</span> (*platformSpecific) ())</span>
</span>{<font></font>
    timeInMillisFp = (platformSpecific == <span class="hljs-number">0</span>) ? TimeInMillisImplementation : platformSpecific;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">///////////// Time in String</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-title">TimeStringImplementation</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Keil time needs work"</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* (*timeStringFp) () = TimeStringImplementation;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-title">GetPlatformSpecificTimeString</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> timeStringFp();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetPlatformSpecificTimeStringMethod</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* (*platformMethod) ())</span>
</span>{<font></font>
    timeStringFp = (platformMethod == <span class="hljs-number">0</span>) ? TimeStringImplementation : platformMethod;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificAtoI</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*str)</span>
</span>{
   <span class="hljs-keyword">return</span> atoi(str);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">PlatformSpecificStrLen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* str)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">strlen</span>(str);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">PlatformSpecificStrCat</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* s1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s2)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">strcat</span>(s1, s2);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">PlatformSpecificStrCpy</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* s1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s2)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">strcpy</span>(s1, s2);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">PlatformSpecificStrNCpy</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* s1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s2, <span class="hljs-keyword">size_t</span> size)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">strncpy</span>(s1, s2, size);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificStrCmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s2)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">strcmp</span>(s1, s2);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificStrNCmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s2, <span class="hljs-keyword">size_t</span> size)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">strncmp</span>(s1, s2, size);<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">PlatformSpecificStrStr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* s2)</span>
</span>{
   <span class="hljs-keyword">return</span> (<span class="hljs-keyword">char</span>*) <span class="hljs-built_in">strstr</span>(s1, s2);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificVSNprintf</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str, <span class="hljs-keyword">size_t</span> size, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* format, va_list args)</span>
</span>{<font></font>
<font></font>
    <span class="hljs-keyword">char</span>* buf = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> sizeGuess = size;<font></font>
<font></font>
    <span class="hljs-keyword">int</span> result = vsnprintf( str, size, format, args);<font></font>
    str[size<span class="hljs-number">-1</span>] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (result == <span class="hljs-number">-1</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (buf != <span class="hljs-number">0</span>)
            <span class="hljs-built_in">free</span>(buf);<font></font>
        sizeGuess += <span class="hljs-number">10</span>;<font></font>
        buf = (<span class="hljs-keyword">char</span>*)<span class="hljs-built_in">malloc</span>(sizeGuess);<font></font>
        result = vsnprintf( buf, sizeGuess, format, args);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (buf != <span class="hljs-number">0</span>)
        <span class="hljs-built_in">free</span>(buf);
    <span class="hljs-keyword">return</span> result;<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function">PlatformSpecificFile <span class="hljs-title">PlatformSpecificFOpen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* filename, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* flag)</span>
</span>{
   <span class="hljs-keyword">return</span> fopen(filename, flag);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PlatformSpecificFPuts</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* str, PlatformSpecificFile file)</span>
</span>{
   <span class="hljs-built_in">fputs</span>(str, (FILE*)file);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PlatformSpecificFClose</span><span class="hljs-params">(PlatformSpecificFile file)</span>
</span>{<font></font>
   fclose((FILE*)file);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PlatformSpecificFlush</span><span class="hljs-params">()</span>
</span>{<font></font>
  fflush(<span class="hljs-built_in">stdout</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificPutchar</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">putchar</span>(c);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">PlatformSpecificMalloc</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> size)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">malloc</span>(size);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">PlatformSpecificRealloc</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>* memory, <span class="hljs-keyword">size_t</span> size)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">realloc</span>(memory, size);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PlatformSpecificFree</span><span class="hljs-params">(<span class="hljs-keyword">void</span>* memory)</span>
</span>{
   <span class="hljs-built_in">free</span>(memory);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">PlatformSpecificMemCpy</span><span class="hljs-params">(<span class="hljs-keyword">void</span>* s1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>* s2, <span class="hljs-keyword">size_t</span> size)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">memcpy</span>(s1, s2, size);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">PlatformSpecificMemset</span><span class="hljs-params">(<span class="hljs-keyword">void</span>* mem, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">size_t</span> size)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">memset</span>(mem, c, size);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">PlatformSpecificFabs</span><span class="hljs-params">(<span class="hljs-keyword">double</span> d)</span>
</span>{
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">fabs</span>(d);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificIsNan</span><span class="hljs-params">(<span class="hljs-keyword">double</span> d)</span>
</span>{
    <span class="hljs-keyword">return</span> isnan(d);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">PlatformSpecificVSNprintf</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> size, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* format, <span class="hljs-keyword">void</span>* args)</span>
</span>{
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
   <span class="hljs-comment">//return vsnprintf( str, size, format, (va_list) args);</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">PlatformSpecificToLower</span><span class="hljs-params">(<span class="hljs-keyword">char</span> c)</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">tolower</span>(c);<font></font>
}</code></pre></div>
                    </div><br>
<p>  ,       ( <code>--exceptions</code>)           (  15 ).     ,       —  Keil   "target".</p><br>
<p> ,  ,    <code>--c99</code>,    ,     Keil .-    .</p><br>
<p>   Keil'a   ,   99  ,       ..</p><br>
<h2 id="vyvod-rezultatov"> </h2><br>
<p> CppUTest   printf'  ,      .   ?</p><br>
<p>         UART,     , ,  putty —   Keil'a        UART'a.</p><br>
<p> ,      Cortex     ITM.     JTAG (     STLink   SWD,         SWO)       ITM ,   stdout     .</p><br>
<p> ,  ITM    ,  Keil'a   !      ,   <code>View-&gt;Serial windows-&gt;Debug (printf)</code>.</p><br>
<p><img src="https://habrastorage.org/webt/cw/cr/ur/cwcrurozrbutnpxjpocbtorr3yk.png" alt="Cpputest printf"></p><br>
<p>   ,      .       ,      ,      .    <code>stdout</code>,   <code>stdin</code>  <code>stderr</code>   .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">retarget</b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> __CC_ARM || ( (__ARMCC_VERSION) &amp;&amp; (__ARMCC_VERSION &gt;= 6010050) )</span><font></font>
<font></font>
    <span class="hljs-comment">// armclang</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> ( (__ARMCC_VERSION) &amp;&amp; (__ARMCC_VERSION &gt;= 6010050) )</span><font></font>
<font></font>
        <span class="hljs-keyword">asm</span>(<span class="hljs-string">".global __use_no_semihosting_swi\n"</span>);<font></font>
<font></font>
    <span class="hljs-comment">// armcc    </span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">elif</span> __CC_ARM</span><font></font>
<font></font>
        <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> import(__use_no_semihosting_swi)</span><font></font>
<font></font>
        <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span> { <span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">FILE</span> {</span> <span class="hljs-keyword">int</span> handle;} ; }<font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;rt_sys.h&gt;</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;rt_misc.h&gt;</span></span><font></font>
<font></font>
    <span class="hljs-built_in">std</span>::FILE <span class="hljs-built_in">std</span>::__stdout;
    <span class="hljs-built_in">std</span>::FILE <span class="hljs-built_in">std</span>::__stdin;
    <span class="hljs-built_in">std</span>::FILE <span class="hljs-built_in">std</span>::__stderr;<font></font>
<font></font>
    <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span><font></font>
    { <font></font>
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fputc</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c, FILE *f)</span>
        </span>{
            <span class="hljs-keyword">return</span> ITM_SendChar(c);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fgetc</span><span class="hljs-params">(FILE *f)</span>
        </span>{
            <span class="hljs-keyword">char</span> ch = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">return</span>((<span class="hljs-keyword">int</span>)ch);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ferror</span><span class="hljs-params">(FILE *f)</span>
        </span>{
            <span class="hljs-comment">/* Your implementation of ferror */</span>
            <span class="hljs-keyword">return</span> EOF;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">void</span> _ttywrch(<span class="hljs-keyword">int</span> ch)<font></font>
        {<font></font>
            ITM_SendChar(ch);            <font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">char</span> *_sys_command_string(<span class="hljs-keyword">char</span> *cmd, <span class="hljs-keyword">int</span> len)<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">//   main</span>
        <span class="hljs-keyword">void</span> _sys_exit(<span class="hljs-keyword">int</span> return_code) <font></font>
        {<font></font>
            <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) { __BKPT(<span class="hljs-number">0xAA</span>); }<font></font>
        }        <font></font>
    }<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre></div>
                    </div><br>
<h2 id="sami-testy"> </h2><br>
<p>,   ,       CppUTest ,        </p><br>
<pre><code class="cpp hljs">TEST(Loader, FirmwareCrcCheck_ErrorOnCheck)<font></font>
{<font></font>
    makeLoaderReadyForBlockAddress(testLoader);<font></font>
<font></font>
    sendSuccessfulWriteRandomDataBlock(testLoader, test_chunk_size);<font></font>
<font></font>
    mockSender.isSent = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//   ,    </span><font></font>
    mockFlasher.curMode = MockFlasher::Modes::ALL_FW_ERR;<font></font>
<font></font>
    <span class="hljs-keyword">uint32_t</span> crc = <span class="hljs-number">0x11223344</span>;
    <span class="hljs-keyword">uint32_t</span> fwEnd = mockFlasher.getFreeFlashAddrMin() + Loader_Data_Block_Size;<font></font>
<font></font>
    sendFwCrcCheck(testLoader, crc, fwEnd);<font></font>
<font></font>
    checkIfError();<font></font>
<font></font>
    CHECK( mockFlasher.isAllFwChecked == <span class="hljs-literal">true</span>);<font></font>
<font></font>
    <span class="hljs-comment">//     </span><font></font>
    CHECK( mockFlasher.fwStart == mockFlasher.getFreeFlashAddrMin() );<font></font>
    CHECK( mockFlasher.fwEnd == fwEnd);<font></font>
    CHECK( mockFlasher.fwCrc == crc);<font></font>
}</code></pre><br>
<h2 id="vpechatleniya-ot-cpputest">  CppUTest</h2><br>
<p>:</p><br>
<ul>
<li>   </li>
<li>    </li>
</ul><br>
<p>:</p><br>
<ul>
<li> ++,       ++ (      ++)</li>
<li>    </li>
<li>    .   ,      <code>setjmp/longjmp</code>,    !</li>
<li>   ,               -</li>
<li>  —  ,      .   <code>CamelCase</code>  <code>snaking_case</code>,  <code>NeitherOfThemIsVeryReadable</code> <code>when_test_name_is_long_enough</code>,      .</li>
<li>   -  <em> </em>:<br>
<ul>
<li><code>CHECK</code> — ,  </li>
<li><code>CHECK_TEXT</code> — ,    </li>
<li><code>CHECK_FALSE</code> — ,      <code>CHECK( .. == false)</code>?</li>
<li><code>CHECK_EQUAL</code> — ?</li>
<li><code>STRCMP_EQUAL</code> — , ?      strcmp ...</li>
<li><code>STRNCMP_EQUAL</code> —  </li>
<li><code>LONGS_EQUAL</code> — CppUTest ,  !</li>
<li><code>UNSIGNED_LONGS_EQUAL</code> — !!!<br>
,   ,       ,     !   Catch2 -    <code>REQUIRE</code>.</li>
</ul></li>
<li>  ,         ,       TDD;  90%    ,     </li>
<li>  ,      :</li>
</ul><br>
<pre><code class="plaintext hljs">src\Core\Loader\Bootloading\loader_test.cpp(815): error: Failure in TEST(Loader, SuccessfulWriteBlockWithoutErase)<font></font>
        CHECK(mockFlasher.isBlockWritten != true) failed<font></font>
<font></font>
Errors (1 failures, 76 tests, 76 ran, 1942 checks, 0 ignored, 0 filtered out, 0 ms)</code></pre><br>
<p>           </p><br>
<ul>
<li>   ,   -        ,      ;        </li>
</ul><br>
<p>,      .  CppUTest    , , ,  .          .       munit.</p><br>
<h2 id="munit">Munit</h2><br>
<p>    -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   -   </a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">munit</a> —      -;  ,         :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> mu_assert(message, test) do { <span class="hljs-meta-keyword">if</span> (!(test)) return message; } while (0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> mu_run_test(test) do { char *message = test(); tests_run++; \
                              <span class="hljs-meta-keyword">if</span> (message) return message; } while (0)</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> tests_run;</code></pre><br>
<p>        !  ++,    ,        <code>return 0</code>,    !    !</p><br>
<p> ,  ++      —     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>,  , ,        .</p><br>
<p>      - ,     ,     ,    , ,     ,         ++.</p><br>
<p>       ++,             <code>BOOST_PP_COUNTER</code>.</p><br>
<h2 id="umbacpptest">UmbaCppTest</h2><br>
<p>    <em>  </em>  -! !     :</p><br>
<ul>
<li>   (,   )</li>
<li>  —  </li>
<li>  </li>
<li>    </li>
<li>    — ,  <code>UMBA_CHECK( cond, text )</code>,  text — </li>
<li>    (.   .h)</li>
<li>"-":   ,   <em></em>   !   ,      <code>BKPT</code>;  !</li>
<li>- ,    —     ,       </li>
<li>  ,          ,  ,    </li>
</ul><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">   .</a></p><br>
<p> :</p><br>
<pre><code class="cpp hljs">UMBA_TEST(<span class="hljs-string">"Check timer with no overflow - one-shot timer shall be handled"</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> time_service;<font></font>
<font></font>
    <span class="hljs-keyword">for</span>( <span class="hljs-keyword">uint32_t</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">1000</span>; i++ )<font></font>
    {<font></font>
        time_service::setCurTime_mcs( Microsec{ i*<span class="hljs-number">1000</span> } );<font></font>
        time_service::setCurTime_ms( i );<font></font>
<font></font>
        testLwipTask.work( i );<font></font>
<font></font>
        <span class="hljs-keyword">if</span>( mockCallbacks.flag == <span class="hljs-literal">true</span> )
            <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    UMBA_CHECK( mockCallbacks.flag == <span class="hljs-literal">true</span> );<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br>
<p>     - :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_TESTS</span><font></font>
<font></font>
        umba::runAllTests();<font></font>
<font></font>
        __BKPT(<span class="hljs-number">0xAA</span>);
        <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {}<font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br>
<p>        ,    <code>umba_cpp_test_config.h</code>      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_LOGGING_ENABLED        1</span><font></font>
<font></font>
<span class="hljs-comment">//     </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_HANG_ON_FAILED_TEST_ENABLED      1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_DISABLE_IRQ()  __disable_irq()</span><font></font>
<font></font>
<span class="hljs-keyword">namespace</span> umba<font></font>
{<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> tests_in_group_max = <span class="hljs-number">200</span>;<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> groups_max = <span class="hljs-number">100</span>;<font></font>
<font></font>
}</code></pre><br>
<p>,   ,      :</p><br>
<ul>
<li>   ,     </li>
<li>   <em></em>    ,      </li>
<li><em></em>      .  ,   ,      —       -_-'</li>
</ul><br>
<h1 id="testy-interfeysov-svyazi">  </h1><br>
<p>    ,        -     —   ,       .</p><br>
<p>   ?</p><br>
<p> .  ,       ,   ? ,  UART'a        :</p><br>
<ul>
<li> </li>
<li> </li>
</ul><br>
<p>   ""      ,      .<br>
      ,   . ,  ,      .<br>
 ,        (..     ,     ),   .<br>
   —        -  —     ,   - ,   .</p><br>
<p>  ,            10  ...</p><br>
<p>,  10     - .     —   "  UART'",    .     UART'a      .</p><br>
<p>.      ?  ,       ,    — .</p><br>
<p> ,   .     .</p><br>
<ul>
<li>  ,      <em> </em>, ..   ifdef' </li>
<li> ,  -  ;     <em></em>    ifdef'a. .</li>
<li> ,     — CRTP,         . </li>
<li>    ""   ++ —   .</li>
</ul><br>
<p>   ifdef'   ,    CRTP.<br>
 ,    ,   - :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Amount</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getValue</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;T <span class="hljs-keyword">const</span>&amp;&gt;(*<span class="hljs-keyword">this</span>).getValue();<font></font>
    }<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Constant42</span> :</span> <span class="hljs-keyword">public</span> Amount&lt;Constant42&gt;<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getValue</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>; }<font></font>
};</code></pre><br>
<p>,  Amount    ,   Constant42  .</p><br>
<p> ,     2  :</p><br>
<ul>
<li>Amount —   ,   . ,          .  <em></em>    !     ,   Keil <em>  </em>          —       ,    .    ,   IDE   ,     .</li>
<li> ,      ,       , -    ++.    <em></em>,     .</li>
</ul><br>
<p>,       .<br>
   ,     ?     <em> </em>,    ,     !</p><br>
<p> , ,   ,   .   :</p><br>
<ul>
<li>   —       —    .</li>
<li>      .      -,      -,     .</li>
</ul><br>
<p>  ,    <em>  </em> —        .        ,  .</p><br>
<p>  ,   ,    .  Keil'e   ,       — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">  </a>.</p><br>
<p>  -       —     ! ,  .    ,     —     .</p><br>
<p>             ,        .      STM  . ,     — …  ?   ,        —   ?</p><br>
<p>,           —     ,     ! ..         .</p><br>
<p>,      (      ) —       (  ) — ..   - .<br>
       .</p><br>
<p>         ,    — <em></em> (mock). ,    UART'a   ,     ""      .</p><br>
<h1 id="inicializaciya-i-deinicializaciya">  </h1><br>
<p> , -     ,    .       ""   .</p><br>
<p>,          <code>setup</code>  <code>teardown</code>;      .</p><br>
<p>   ?</p><br>
<ul>
<li> </li>
<li>  init</li>
</ul><br>
<p> ,     —   , ..      .</p><br>
<p> ,  embedded  <em></em>    —  ,    .   -        static initialization order fiasco, ..      -       .</p><br>
<p>      ,   ;   <code>setup</code>     (       init).     ?</p><br>
<ul>
<li> </li>
<li>  deInit</li>
</ul><br>
<p>    .  embedded     <em></em>   —   main   .   ,     ;     —   .</p><br>
<p>      ,    .      —      -   .<br>
   ,     ,    ,        . </p><br>
<p>   ?</p><br>
<ul>
<li>  init  </li>
<li>  ,   </li>
</ul><br>
<p>   init    —          .      ,    —       … ,      ,     — , CppUTest     .</p><br>
<p>  ,       ,      — <code>placement new</code>!     ++, , -,          .</p><br>
<p> <code>placement new</code>     (,   ,     ),        —        ,     (   )   in place.</p><br>
<p>        (, ,       ++11):</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt; <span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> ... Args &gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">inplace_new</span><span class="hljs-params">( T &amp; object, Args &amp;&amp; ... args )</span>
</span>{
    <span class="hljs-keyword">auto</span> t = &amp;object;
    <span class="hljs-keyword">new</span> (t)T{ <span class="hljs-built_in">std</span>::forward&lt;Args&gt;(args)... };<font></font>
}<font></font>
<font></font>
<span class="hljs-function">A <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)</span></span>;<font></font>
<font></font>
inplace_new( a, <span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span> );</code></pre><br>
<p>        —  armcc (  Arm Compiler 5),      -     Keil'e, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> ++11  </a>.<br>
     ,       ++03.  <code>std::forward</code>      —    .</p><br>
<p>,  Keil'e    <code>placement new</code> ,    "  ",     clang,    forward'a.     forward.</p><br>
<p>   -    - ,          !</p><br>
<h1 id="testirovanie-assertov"> assert'</h1><br>
<p> ,  -   :  —   ,  <em></em>  ;         .<br>
 ,        <code>std::terminate</code>, <code>exit(1)</code>  -  .</p><br>
<p>  ?     <em></em> (..     ) —  <em></em> ( ).</p><br>
<p>     :</p><br>
<ul>
<li> ,   ?</li>
<li>     "" ?</li>
<li>         ?</li>
<li>  ?</li>
<li>    ,  ,  ?</li>
</ul><br>
<h3 id="chto-delat-esli-assert-provalilsya"> ,   </h3><br>
<p> ,    —    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {}</code></pre><br>
<p>  ,      ,    ,  <em></em>   —   <code>std::terminate</code>       ,   .</p><br>
<p>       :</p><br>
<ul>
<li>  ,   ,   </li>
<li>        - </li>
</ul><br>
<p>     —       ,          <code>BKPT</code>.</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_ASSERT( statement )     do { <span class="hljs-meta-keyword">if</span>(! (statement) ) { __disable_irq(); while(1){ __BKPT(0xAC); <span class="hljs-meta-keyword">if</span>(0) break;} }  } while(0)</span></code></pre><br>
<h3 id="dopustimo-li-ostavlyat-asserty-v-reliznoy-proshivke">     "" </h3><br>
<p>   ,       .   ,  :</p><br>
<ul>
<li>   ,       </li>
<li>    watchdog</li>
<li>         -</li>
</ul><br>
<h3 id="dopustimo-li-voobsche-pisat-asserty-ili-vse-oshibki-dolzhny-obrabatyvatsya">         </h3><br>
<p>    ,       .</p><br>
<p>    (  -  ),          .</p><br>
<h2 id="kakoy-assert-ispolzovat">  </h2><br>
<h3 id="assert-vremeni-vypolneniya">  :</h3><br>
<p> ,    <code>assert.h</code>,  -    ,    embedded .<br>
,           . </p><br>
<p> —  .    ++,   ,         ,    . :)</p><br>
<h3 id="assert-vremeni-kompilyacii">  :</h3><br>
<p>  .       ++11  ,    <code>static_assert</code>.  ,    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_STATIC_ASSERT_MSG(condition, msg) typedef char umba_static_assertion_##msg[(condition)?1:-1]</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_STATIC_ASSERT3(X, L) UMBA_STATIC_ASSERT_MSG(X, at_line_##L)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_STATIC_ASSERT2(X, L) UMBA_STATIC_ASSERT3(X, L)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_STATIC_ASSERT(X) UMBA_STATIC_ASSERT2(X, __LINE__)</span></code></pre><br>
<h2 id="nuzhno-li-testirovat-asserty-i-kak">    ( )</h2><br>
<p>  ,   ,  ,     <em></em>       —     ,      .</p><br>
<p>      <em>    </em>        ,    .</p><br>
<p>,    ,        .<br>
,     . ?</p><br>
<h3 id="assert-vremeni-kompilyacii-1">  </h3><br>
<p>    ,    !    ,    ?</p><br>
<p>  stackoverflow (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">    Roland Bock</a>)    :</p><br>
<ul>
<li>    , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> CMake  </a>,     </li>
</ul><br>
<p>    .            ifdef;         .     ,     .</p><br>
<ul>
<li>,   Roland Bock —    ,  decltype  unevaluated context. </li>
</ul><br>
<p>,     ,       ,  .         clang'e (  ,   ).</p><br>
<p>  ,   (,   armcc)      <code>decltype</code>.</p><br>
<ul>
<li> static_assert  . </li>
</ul><br>
<p>Roland       ,          (   —  , ).    static_assert ,     .         ,  assert,       .</p><br>
<p>          ,      .      constant expression   ,       .</p><br>
<p>   -  , , , .</p><br>
<h3 id="assert-vremeni-vypolneniya-1">  </h3><br>
<p>     ,   !         .</p><br>
<p> ,     —       ,        , , ,  .</p><br>
<p>   ,    ?       .</p><br>
<p>         ,      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined USE_TESTS</span><font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_ASSERT( statement )                                               \
        do                                                                         \
        {                                                                          \
            <span class="hljs-meta-keyword">if</span>(! (statement) )                                                     \
            {                                                                      \
                printf(<span class="hljs-meta-string">"\nUmba Assertion failed in "</span> __FILE__ <span class="hljs-meta-string">":%d\n"</span>, __LINE__ ); \
                throw ::umba::AssertionFailedException();                          \
            }                                                                      \
        } while(0)</span><font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;exception&gt;</span></span><font></font>
<font></font>
    <span class="hljs-keyword">namespace</span> umba<font></font>
    {<font></font>
        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssertionFailedException</span> :</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">std</span>::exception<font></font>
        { };<font></font>
    }<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><br>
<p>      ,         4,     ,   CppUTest :)</p><br>
<h1 id="remarka-pro-stek-i-kuchu">    </h1><br>
<p>   ,       .          ,  ,         (       ).</p><br>
<p>            ,     .</p><br>
<p>           (<code>Project-&gt;Options-&gt;Target</code>),        .            -, - :</p><br>
<pre><code class="plaintext hljs">Stack_Size      EQU     0x00000400<font></font>
...<font></font>
Heap_Size       EQU     0x00000000</code></pre><br>
<p>, ,     —   ,    ,   - .      ,        (  -D  ) —   <code>Project-&gt;Options-&gt;Assembler</code>   Define.</p><br>
<h1 id="testy-i-osrv">  </h1><br>
<p>    —   ,   ?</p><br>
<p> :  —    .                <em></em>    .           .</p><br>
<p>    —  embedded ,  ,   .      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">task</span><span class="hljs-params">(<span class="hljs-keyword">void</span> * arg )</span>
</span>{
    <span class="hljs-comment">// </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<font></font>
    {<font></font>
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-comment">// -  </span><font></font>
    }<font></font>
}</code></pre><br>
<p>    !</p><br>
<p>      —      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_TESTS</span>
    <span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">umba::decrementTaskCycleCounter</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OS_IS_RUNNING (::umba::decrementTaskCycleCounter())</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OS_IS_RUNNING 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">task</span><span class="hljs-params">(<span class="hljs-keyword">void</span> * arg )</span>
</span>{
    <span class="hljs-comment">// </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(OS_IS_RUNNING)<font></font>
    {<font></font>
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-comment">// -  </span><font></font>
    }<font></font>
}</code></pre><br>
<p>    :</p><br>
<pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*TaskCycleCallback)</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint32_t</span> taskCycleCounter = <span class="hljs-number">0</span>;
<span class="hljs-keyword">static</span> TaskCycleCallback taskCycleCallback;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setTaskCycleCounter</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> cnt)</span>
</span>{<font></font>
    taskCycleCounter = cnt;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">decrementTaskCycleCounter</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">if</span> (taskCycleCallback != <span class="hljs-literal">nullptr</span>)<font></font>
    {<font></font>
        taskCycleCallback();<font></font>
    }<font></font>
    <span class="hljs-keyword">uint8_t</span> a = taskCycleCounter;<font></font>
    taskCycleCounter--;<font></font>
    <span class="hljs-keyword">return</span> a;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setTaskCycleCallback</span><span class="hljs-params">( TaskCycleCallback cb )</span>
</span>{<font></font>
    taskCycleCallback = cb;<font></font>
}</code></pre><br>
<p>      ""    —   ,  ,      .</p><br>
<p>,      ,   .</p><br>
<p>,   -  -    (,   ),      .</p><br>
<p>  :</p><br>
<ul>
<li>        ;       -</li>
<li>              ,      </li>
</ul><br>
<p>       ,     ,   .  :)</p><br>
<h1 id="testy-na-pk">  </h1><br>
<p> ,    ,    ,    IDE   .</p><br>
<p>   ,      :    Eclipse-CDT   arm-none-eabi-gcc,      .  -     .</p><br>
<p>      ,           .</p><br>
<p>   — Eclipse,    ,    - .</p><br>
<p>         ,    . ,  ?</p><br>
<p>,       .       Google Sanitizer'!    ,        :</p><br>
<ul>
<li>   </li>
<li>  </li>
<li>      </li>
</ul><br>
<p>  ,        . .</p><br>
<p>    ,     (    Eclipse),         -  . </p><br>
<ul>
<li>      gcc ( cross)</li>
<li>     ,     — ,  </li>
<li>  , ,   </li>
<li>    ,       </li>
</ul><br>
<pre><code class="plaintext hljs">-fsanitize=address -fsanitize=leak -fsanitize=undefined</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">-fsanitize=address -fsanitize=leak -fsanitize=undefined</code></pre><br>
<p> ,      — , <code>-fdiagnostics-color=always</code>     <code>-ftrapv -fstack-protector-all -fstack-check</code>     .</p><br>
<p>      —  ,   main'    </p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">main</b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_TESTS</span><font></font>
<font></font>
        <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_DOCKER</span>
            <span class="hljs-comment">//   stdout;    </span>
            <span class="hljs-comment">//     </span>
            setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>, _IONBF, <span class="hljs-number">0</span>);
        <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
        <span class="hljs-keyword">auto</span> res = umba::runAllTests();<font></font>
        (<span class="hljs-keyword">void</span>)res;<font></font>
<font></font>
        <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_DOCKER</span>
            <span class="hljs-keyword">return</span> res;
        <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
            __BKPT(<span class="hljs-number">0xAB</span>);
            <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);
        <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre></div>
                    </div><br>
<p>   ,   gcc        — ,    CMSIS'a,      <code>uint32_t</code>,    <code>uintptr_t</code> —         .</p><br>
<p>  , ,       <code>-I</code> (    ),   <code>-isystem</code>.  ,         ,      Include Paths.</p><br>
<p> ,    ,    Keil'e   Eclipse,       —  .</p><br>
<p>,     . , ,     .      <em></em>,      <em></em>  ! ,   <em> </em>,   .</p><br>
<p>   ,  —  ,    —    Windows Server 2012;   Jenkins-Redmine-Gitblit.</p><br>
<p>   .   ,     ?</p><br>
<ul>
<li>Docker</li>
<li> Eclipce CDT,     </li>
<li>VirtualBox</li>
<li> <em></em>  ,     - Windows</li>
<li>    ( ),    </li>
</ul><br>
<p>  .               .  ,      -     :)</p><br>
<p> ,        ( -  )  . , ,     -   ,       .</p><br>
<p>   "",         ,   ,          .</p><br>
<p>   ,       BKPT   ,      :</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_LOGGING_ENABLED        1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> USE_DOCKER</span>
    <span class="hljs-comment">//  - </span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmsis_compiler.h&gt;</span></span><font></font>
<font></font>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_HANG_ON_FAILED_TEST_ENABLED      1</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_DISABLE_IRQ()                    __disable_irq()</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_STOP_DEBUGGER()                  __BKPT(0xAA)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_HANG_ON_FAILED_TEST_ENABLED      0</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_DISABLE_IRQ()</span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UMBA_TEST_STOP_DEBUGGER()</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-keyword">namespace</span> umba<font></font>
{<font></font>
    <span class="hljs-comment">//      </span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> tests_in_group_max = <span class="hljs-number">200</span>;<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint32_t</span> groups_max = <span class="hljs-number">100</span>;<font></font>
<font></font>
    <span class="hljs-comment">//         </span>
    <span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*TaskCycleCallback)</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> COLOR_RESET[] = <span class="hljs-string">"\x1b[0m"</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> RED_FG[]     = <span class="hljs-string">"\x1b[31m"</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> GREEN_FG[]   = <span class="hljs-string">"\x1b[32m"</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> RED_BG[]     = <span class="hljs-string">"\x1b[41m"</span>;<font></font>
}<font></font>
</code></pre></div>
                    </div><br>
<p>,       ,     .  ,   , ,  , devops'   .<br>
        :)</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">     dockerfile:</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">FROM eclipse:latest<font></font>
<font></font>
# Copy project into the container at /app/project<font></font>
COPY . /app/project<font></font>
<font></font>
# Build project<font></font>
# Replace ~~PROJECT~~ with your Eclipse project name and ~~Docker~~ with docker-friendly configuration<font></font>
RUN ./eclipse/eclipse -nosplash -application org.eclipse.cdt.managedbuilder.core.headlessbuild -import ./project/ -build ~~PROJECT~~/~~Docker~~<font></font>
<font></font>
# Run tests<font></font>
CMD ["/app/project/~~Docker~~/~~PROJECT~~"]</code></pre></div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  Jenkins       :</b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">export DOCKER_CERT_PATH="C:\Users\Jenkins\.docker\machine\machines\default"<font></font>
IS_ERROR=0<font></font>
<font></font>
#   <font></font>
taskkill -F -FI "IMAGENAME eq Vbox*" &amp;&amp; rm -rf /c/Users/Jenkins/.docker/ <font></font>
<font></font>
#           <font></font>
git -C /c/docker/ pull<font></font>
<font></font>
#  <font></font>
printf 'DIR=\"$( cd \"$(dirname \"$0\")\" ; pwd -P )\"\n \"/c/Program Files/Git/bin/bash.exe\" -x /c/docker/Server/start.sh 2&gt; $DIR/__out.txt' &gt; $WORKSPACE/_jenkins.sh &amp;&amp;<font></font>
/d/PSTools/psexec -accepteula -h -u Jenkins -p verysecretpassword "C:\Program Files\Git\bin\bash.exe" $WORKSPACE/_jenkins.sh &amp;&amp;<font></font>
<font></font>
#     .   ,   <font></font>
cd /c/Program\ Files/Docker\ Toolbox/ &amp;&amp;<font></font>
./docker load &lt; /c/docker/eclipse.tar.gz &amp;&amp;<font></font>
./docker build -t=project $WORKSPACE/ &amp;&amp;<font></font>
./docker run --rm --privileged project ||<font></font>
IS_ERROR=1<font></font>
<font></font>
#   <font></font>
taskkill -F -FI "IMAGENAME eq Vbox*" &amp;&amp;<font></font>
rm -rf /c/Users/Jenkins/.docker/ || echo<font></font>
<font></font>
exit $IS_ERROR</code></pre></div>
                    </div><br>
<p> ,         .  <em>   </em>  . ,  ?     :)        15. .</p><br>
<p>  ,     -  ,        ,  ,   :</p><br>
<p><img src="https://habrastorage.org/webt/3s/oo/rp/3soorpr-gjm1-e6ybjykwcab7xe.png"></p><br>
<p>    ,     - :</p><br>
<p><img src="https://habrastorage.org/webt/fo/sw/__/fosw__wkcsu7sqkkzgucphhjxv4.png"></p><br>
<p>     ,      —    ,       !<br>
, , .   ._.</p><br>
<p>,        —   hex-      (      ),     PVS-Studio,  ,   .</p><br>
<p>(:  ,   PVS-Studio       ,       ;      :)</p><br>
<h1 id="izvestnye-problemy"> </h1><br>
<p>   - ,     ,   -    API (     N  ,   ) —    …      ,   100+   . </p><br>
<p>  -     ,  API  ,  -   10.</p><br>
<p> —   "",       .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><ul>
<li><p>BKPT     "";    -  ,      -.      ,  -       .  ,     - ,  Keil    -.</p><br>
</li>
<li><p>..  -     <code>__LINE__</code>,    - .   call-stack'   ,     — <code>doTest56</code>. </p><br>
</li>
<li><p> ,   ,    Eclipse — outline —       ,   .</p><br>
</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/qi/ff/mp/qiffmpvgzjchi9jyb-kxnnalpic.png"></p><br>
<p>,      :)  ,   <code>doTest56</code> —    outline    .</p><br>
<p>  Collapse All (  <code>Ctrl+Shift+/</code>)    ,         .   ,        —   .</p><br>
<p><img src="https://habrastorage.org/webt/kz/kr/sd/kzkrsdahrzcmmoozwhqngseugnk.png"></p><br>
<ul>
<li><p>    —     ,    <code>UMBA_CHECK</code>   ,      .          — <code>UMBA_CHECK_F</code>  <code>UMBA_CHECK_CALL</code>.</p><br>
</li>
<li><p>    — ,      0  nullptr,              <code>const char *</code>.      <code>UMBA_TEST_OK</code>.</p><br>
</li>
<li><p>        ' :(</p><br>
</li>
</ul></div>
                    </div><br>
<h1 id="lichnyy-opyt"> </h1><br>
<p>  "-" (   )       ,              —    ?</p><br>
<p>     ,  ,   ,       .  ,  ,    —   .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><ul>
<li><p>   ,    .      ,   — .      ,      .     - —    .     ,   ?</p><br>
</li>
<li><p>. ,  embedded-    ,     :)            ;        .     ,       - ,               .</p><br>
</li>
<li><p>    ,  "",     .  ""   ,       - Ethernet   -_-'</p><br>
</li>
</ul></div>
                    </div><br>
<h1 id="podvedem-itogi"> </h1><br>
<p>   embedded   -        ,     - .</p><br>
<p> ,      ,      . ,   ,   IDE,     TDD,    -     /  .</p><br>
<p>,         <em></em>!     -   ,       —  <em> </em>      ,          .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus eigener Erfahrung werde ich jedoch sagen, dass Unit-Tests </font><font style="vertical-align: inherit;">Sie dazu </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zwingen</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , modulareren Code zu schreiben, und wirklich das Vertrauen wecken, dass der Code funktioniert. </font><font style="vertical-align: inherit;">Entsetzte Bugs wandern vom Testcode in entfernte Gassen :)</font></font></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich werde den Link zum Repository duplizieren</font></font></a></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS Separat entschuldige ich mich bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polaris99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe diesen Artikel vor ein paar Monaten versprochen -_- Ich hoffe, dass die Länge des Artikels das lange Warten zumindest teilweise kompensiert.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de506024/index.html">Das Buch „Pure Agile. Die Grundlagen der Flexibilität</a></li>
<li><a href="../de506026/index.html">Das Problem veralteter Stammzertifikate. Weiter in der Reihe Lassen Sie uns verschlüsseln und Smart-TVs</a></li>
<li><a href="../de506032/index.html">GAN-Verbesserungen (Generative Adversarial Network)</a></li>
<li><a href="../de506034/index.html">Oracle Glossar: Geschichte</a></li>
<li><a href="../de506042/index.html">Sprachmodelle für neuronale Netze als medizinische Mehrzweck-KI</a></li>
<li><a href="../de506054/index.html">MskDotNet Meetup bei der Raiffeisenbank 11/06</a></li>
<li><a href="../de506064/index.html">Entwickeln Sie eine interaktive Webanwendung in C # ohne JavaScript-Kenntnisse</a></li>
<li><a href="../de506066/index.html">Aufbau eines digitalen Modells einer erfolgreichen Wertpapierhandelsstrategie. Beschreibung. Beweise</a></li>
<li><a href="../de506082/index.html">Linux und WYSIWYG</a></li>
<li><a href="../de506086/index.html">Rechtsprechung Künstliche Intelligenz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>