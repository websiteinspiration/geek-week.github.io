<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎺 🐹 🖊️ تحت غطاء عميل الروبوت Yandex.Music 🏠 😙 🏉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="المقدمة
 مرحبا يا هابر! مرة أخرى ، أنا مع المقالة الثانية التي تؤثر على Yandex.Music API. الحالة مخططة ومذكورة في المقال الأول . 
 
 وصلت اليدين ، تم....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>تحت غطاء عميل الروبوت Yandex.Music</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487428/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المقدمة</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
مرحبا يا هابر! </font><font style="vertical-align: inherit;">مرة أخرى ، أنا مع المقالة الثانية التي تؤثر على Yandex.Music API. </font><font style="vertical-align: inherit;">الحالة مخططة ومذكورة في </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المقال الأول</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
وصلت اليدين ، تم. </font><font style="vertical-align: inherit;">اليوم سأتحدث عن لحظات مثيرة للاهتمام ، في رأيي ، موجودة في قاعدة التعليمات البرمجية الخاصة ببرنامج Telegram الخاص بي ، والتي تضع نفسها كعميل كامل للموسيقى. </font><font style="vertical-align: inherit;">سنلمس أيضًا واجهة برمجة تطبيقات Yandex للتعرف على الموسيقى. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
قبل الانتقال إلى قصة تنفيذ شيء معين نقطة تلو الأخرى ، سيكون من المفيد أن يكون لديك فكرة عن الروبوت نفسه وقدراته الوظيفية.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">عرض فيديو العميل</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/YOw9hs8tFg0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الجزء الرئيسي سأتحدث عن ما يلي:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قم بتسجيل الدخول إلى حسابك من خلال الموقع على </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">صفحات GitHub</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (لماذا ولماذا).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تنسيق البيانات وتعبئتها واستخدامها في بيانات الأزرار.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تحديث التوجيه وإصدار البيانات ورمي السياق إلى المعالجات.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خدمات:</font></font><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خدمة إعادة تحميل المسار في Telegram.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خدمة "الاشتراكات" لتلقي مسار مع إرسال حالة التنزيل.</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أبسط وأنيق تنفيذ التخزين المؤقت للاستعلام.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">التعرف على المسار عن طريق رسالة صوتية وكيف ظهر بشكل عام في الروبوت.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ملاحظات صغيرة.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا كنت مهتمًا بنقطة واحدة على الأقل - مرحبًا بك في القط.</font></font><br>
<img src="https://habrastorage.org/webt/uv/4s/a3/uv4sa3pslohuzlmuzrjzteju2dk.png"><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يعمل البوت مع المستخدمين الذين قاموا بتسجيل الدخول إلى حساباتهم ، ولكن لا. </font><font style="vertical-align: inherit;">كل شيء يدور حول أربع فئات رئيسية للخدمة: الألبوم والفنان وقائمة التشغيل والمسار. </font><font style="vertical-align: inherit;">جميع بيانات الكيان مدعومة ، هناك ترقيم الصفحات مع اختيار الصفحة. </font><font style="vertical-align: inherit;">للتفاعل معهم ، يمكن للمستخدم المصرح له استخدام قائمتهم الشخصية ، والتي تتضمن: قوائم التشغيل الذكية وقائمة التشغيل "أحب" وقوائم التشغيل الخاصة بهم. </font><font style="vertical-align: inherit;">بالنسبة للمستخدمين غير المخولين ، يتوفر البحث - إرسال استعلام بحث كرسالة عادية. </font><font style="vertical-align: inherit;">الآن هناك فقط قائمة جافة بما هو موجود أيضًا: استقبال المسارات والكائنات الأخرى عبر رابط مباشر ، وتلقي كلمات الأغاني ، والقدرة على الإعجاب / عدم الإعجاب بالمسار والفنان ، وعرض المسارات المماثلة ، والتعرف على المسار عن طريق الرسائل الصوتية والمزيد.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء الرئيسي</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. تسجيل الدخول إلى الحساب</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في البداية ، لم يكن من المقرر أن يعمل البوت بدون ترخيص ، لذلك ، حتى أثناء التصميم ، تقرر كيف يجب أن يحدث الترخيص - من خلال </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">موقعه على الإنترنت</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . كانت الحجج الرئيسية الأمن والشفافية. لا تريد بأي حال من الأحوال قبول تسجيلات دخول المستخدم وكلمات المرور في رسائل واضحة. والتفويض من كمبيوتر المستخدم هو أمر أساسي. لذلك ، تمت كتابة موقع للترخيص على </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . إنه شكل من أشكال التفويض مع إعادة التوجيه إلى برنامج التتبُّع. تم أخذ قطعة بتفويض ومعالجة اختبار CAPTCHA من مكتبة </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> وإعادة كتابتها في </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
للترخيص ، يتم استخدام رمز OAuth المميز ، والذي يتم نقله مرة أخرى إلى برنامج التتبُّع عن طريق </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الربط العميق</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يبدو الرابط النهائي لإعادة التوجيه كما يلي: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/music_yandex_bot؟start={oauth_token}</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
أردت الأفضل ، لكن المستخدمين لم يثقوا. تم التصريح لكل مستخدم العاشر فقط (في الوقت الذي كان فيه إلزاميًا). لذلك ، مع التحديثات التالية ، كان علي أن أشرح لماذا يجب أن تثق. تم نشر جميع العناصر حول </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، حصريًا حول الطلبات من جانب العميل </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ورمز المصدر المفتوح</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> على الموقع للحصول على تفويض وتكرارها في رسالة ترحيب في الروبوت. تحسن. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أيضًا ، من بين عوامل انخفاض الإذن ، تبين أن عدم إمكانية الوصول إلى المرايا لـ t.me في روسيا ودعم المستخدمين الذين لديهم اشتراك فقط (المزيد عن هذا في الملاحظات ، الفقرة 7).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تم حل العنصر الأول باستخدام </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tg: //</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ، وفي </font><font style="vertical-align: inherit;">الجزء </font><i><font style="vertical-align: inherit;">السفلي</font></i><font style="vertical-align: inherit;"> ، يوجد بالفعل رابط إلى المرآة (إذا لم تعمل إعادة التوجيه التلقائية ولم يساعد الزر) ، والعنصر الثاني مرة أخرى في البند 7.</font></font><br>
<img src="https://habrastorage.org/webt/ez/2_/0j/ez2_0japfosbu9k4bjelikl8x-i.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. تنسيق البيانات</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لهذا الروبوت ، قررت للمرة الأولى استخدام </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoSQL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DB - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MongoDB</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . مفهوم: عند </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تضمين</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> مستند ، عندما لا. أحب العمل مع mongoengine. لكنني لم أرغب حقًا في تخزين جميع بيانات الأزرار في المنزل ، ولدى العميل </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">معرف</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> السجل </font><font style="vertical-align: inherit;">فقط </font><font style="vertical-align: inherit;">في قاعدة البيانات. لقد شعرت بالرعب من كمية البيانات ، لكنني أردت أخذ خادم مونغو مجاني بحد 512 ميجابايت لتخزين البيانات. إن التوصل إلى إعادة استخدام جميلة للسجلات إذا كانت البيانات تتطابق مع العديد من الأزرار وتنظيف القديمة منها أصعب بكثير من تخزين كل شيء في الأزرار نفسها. بعد تحليل حجم البيانات المراد تخزينها ، استنتجت أنها مناسبة بسهولة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في البداية ، استخدمت </font><i><font style="vertical-align: inherit;">JSON</font></i><font style="vertical-align: inherit;"> للتو</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">، لكنه رفضها بسرعة عندما واجه حدودًا. في Telegram ، لا يمكن أن تزيد محتويات بيانات الزر إلا عن 64 بايت في </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذلك ، مع مطالبة أحد الأصدقاء ، بدأت في النظر في </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">حزمة</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> من وحدة </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الهيكل</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . لذلك ولدت أنواع الاستفسارات ، الشكل البدائي ، والتغليف والتفريغ. الآن يتم استخدامه في الروبوت في كل مكان. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
التنسيق بسيط للغاية. البايت الأول هو النوع ، والثاني هو الإصدار. كل شيء آخر هو بيانات لنوع معين. يتم تخزين الأنواع كـ Enum ، لها </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">معرف</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، وهو البايت الأول. بالإضافة إلى </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المعرّف</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، يحتوي كل نوع على تنسيق لحزم البيانات وتفريغها. على سبيل المثال: اكتب </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW_TRACK_MENU</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أي تنسيق له القيمة "s؟" ، حيث يكون "s" هو المعرف الفريد للمسار و "؟" - هل المسار يحتوي على نص. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في مسارات تستخدم نوع السلسلة للأسباب التالية: أولا، </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> المسار يمكن أن يكون سلسلة من </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> والألبوم </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> المسار من خلال القولون، وثانيا، قد يكون </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">من UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . المسارات باستخدام </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - مسارات ذاتية التحميل ، متاحة فقط للمستخدم الذي قام بتنزيلها. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نظرًا لأن البيانات لا تتوافق دائمًا مع التنسيق ، على سبيل المثال ، </font><font style="vertical-align: inherit;">يمكن تمثيل </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">معرف</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> المسار </font><font style="vertical-align: inherit;">نفسه </font><font style="vertical-align: inherit;">ببساطة عن طريق رقم ، قبل حزمه يجب أن يلقي في نوع التنسيق. في هذه الحالة ، </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ق</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">لذلك ، يوجد في الفصل طريقة تطبيع البيانات المنقولة للتغليف ، حتى لا تفعل ذلك بنفسك عند المرور إلى المنشئ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الأوتار مكتفية ذاتيا وقادرة على تحديد طولها عند التغليف وأخذ هذا الطول في الاعتبار عند التفريغ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لم يتم التخطيط لدعم الإصدارات الأقدم ، لذلك تم طرح استثناء إذا لم تتطابق الإصدارات. </font><font style="vertical-align: inherit;">عند معالجة التحديثات ، والتي سأناقشها في الفقرة التالية ، يتم استدعاء المنطق الضروري. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نظرًا لأن Telegram يأكل حصريًا </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، يتم ترميز البيانات المعبأة في </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">نعم ، أنا أفقد السرعة هنا </font><i><font style="vertical-align: inherit;">وأوفر</font></i><font style="vertical-align: inherit;"> الحجم الأصغر بدون استخدام </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، ولكن بالنظر إلى البيانات الصغيرة ، فإنني أعتبر استخدام </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base85</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> مناسبًا.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مصدر. </font><font style="vertical-align: inherit;">ملف callback_data.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> base64<font></font>
<font></font>
<span class="hljs-keyword">from</span> ext.query_types <span class="hljs-keyword">import</span> QueryType<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BadDataVersion</span>(<span class="hljs-params">Exception</span>):</span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallbackData</span>:</span>
    ACTUAL_VERSION = <span class="hljs-number">7</span>
    BASE_FORMAT = <span class="hljs-string">'&lt;BB'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, type_: QueryType, data=None, version=None</span>):</span><font></font>
        self.type = type_<font></font>
        self.version = version <span class="hljs-keyword">or</span> CallbackData.ACTUAL_VERSION<font></font>
        self.data = data<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> isinstance(self.data, list):<font></font>
            self.data = [self.data]<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.data = self._normalize_data_to_format(self.data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f'&lt;CallbackData&gt; Type: <span class="hljs-subst">{self.type}</span> Version: <span class="hljs-subst">{self.version}</span> Data: <span class="hljs-subst">{self.data}</span>'</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_normalize_data_to_format</span>(<span class="hljs-params">self, data, bytes_object=False</span>):</span><font></font>
        normalized_data = data.copy()<font></font>
        <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(self.type.format):<font></font>
            cast = str<font></font>
            <span class="hljs-keyword">if</span> c.lower() <span class="hljs-keyword">in</span> <span class="hljs-string">'bhilqn'</span>:<font></font>
                cast = int<font></font>
            <span class="hljs-keyword">elif</span> c <span class="hljs-keyword">in</span> <span class="hljs-string">'efd'</span>:<font></font>
                cast = float<font></font>
            <span class="hljs-keyword">elif</span> c == <span class="hljs-string">'?'</span>:<font></font>
                cast = bool<font></font>
<font></font>
            casted = cast(data[i])<font></font>
            <span class="hljs-keyword">if</span> bytes_object <span class="hljs-keyword">and</span> cast == str:<font></font>
                casted = casted.encode(<span class="hljs-string">'utf-8'</span>)<font></font>
            normalized_data[i] = casted<font></font>
<font></font>
        <span class="hljs-keyword">return</span> normalized_data<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode_type</span>(<span class="hljs-params">callback_data</span>):</span>
        decoded = base64.b85decode(callback_data.encode(<span class="hljs-string">'utf-8'</span>))<font></font>
        type_, version = struct.unpack(CallbackData.BASE_FORMAT, decoded[:<span class="hljs-number">2</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> CallbackData.ACTUAL_VERSION != version:
            <span class="hljs-keyword">raise</span> BadDataVersion()<font></font>
<font></font>
        <span class="hljs-keyword">return</span> QueryType(type_), version, decoded<font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">cls, type_, version, decoded</span>):</span>
        start, data = <span class="hljs-number">2</span>, []<font></font>
<font></font>
        <span class="hljs-keyword">if</span> start &lt; len(decoded):<font></font>
            format_iter = iter(type_.format)<font></font>
<font></font>
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> start &gt;= len(decoded):
                    <span class="hljs-keyword">break</span><font></font>
<font></font>
                format_ = next(format_iter, type_.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                decode_str = format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>
                <span class="hljs-keyword">if</span> decode_str:
                    <span class="hljs-comment"># struct.calcsize('b') = 1</span>
                    length = list(struct.unpack(<span class="hljs-string">'b'</span>, decoded[start: start + <span class="hljs-number">1</span>]))[<span class="hljs-number">0</span>]<font></font>
                    start += <span class="hljs-number">1</span><font></font>
<font></font>
                    format_ = <span class="hljs-string">f'<span class="hljs-subst">{length}</span><span class="hljs-subst">{format_}</span>'</span><font></font>
<font></font>
                step = struct.calcsize(format_)<font></font>
<font></font>
                unpacked = list(struct.unpack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, decoded[start: start + step]))
                <span class="hljs-keyword">if</span> decode_str:<font></font>
                    unpacked[<span class="hljs-number">0</span>] = unpacked[<span class="hljs-number">0</span>].decode(<span class="hljs-string">'UTF-8'</span>)<font></font>
<font></font>
                data += unpacked<font></font>
                start += step<font></font>
<font></font>
        <span class="hljs-keyword">return</span> cls(type_, data <span class="hljs-keyword">if</span> data <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>, version)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">self</span>):</span><font></font>
        encode = struct.pack(self.BASE_FORMAT, self.type.value, self.version)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            format_iter = iter(self.type.format)<font></font>
            normalized_data = self._normalize_data_to_format(self.data, bytes_object=<span class="hljs-literal">True</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> normalized_data:<font></font>
                format_ = next(format_iter, self.type.format[<span class="hljs-number">-1</span>])<font></font>
<font></font>
                <span class="hljs-keyword">if</span> format_ <span class="hljs-keyword">in</span> <span class="hljs-string">'ps'</span>:
                    <span class="hljs-comment">#        .  'b'  </span>
                    <span class="hljs-comment"># -      ,    &gt; 36 </span>
                    encode += struct.pack(<span class="hljs-string">'b'</span>, len(data))<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{len(data)}</span><span class="hljs-subst">{format_}</span>'</span>, data)
                <span class="hljs-keyword">else</span>:<font></font>
                    encode += struct.pack(<span class="hljs-string">f'<span class="hljs-subst">{format_}</span>'</span>, data)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> base64.b85encode(encode).decode(<span class="hljs-string">'utf-8'</span>)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. تحديثات التوجيه والسياق</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يستخدم المشروع مكتبة </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> للعمل مع </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram Bot API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">لديها بالفعل نظام لتسجيل معالجات لأنواع معينة من التحديثات التي وصلت ، وفلاتر للتعبيرات العادية ، والأوامر ، وما إلى ذلك. </font><font style="vertical-align: inherit;">ولكن نظرا لبلدي تنسيق البيانات الخاصة وأنواع بلدي، وكان لي أن ترث من </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TelegramHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> وتنفيذ بلدي </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">معالج</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتم تمرير التحديث والسياق إلى كل معالج من خلال الوسائط. </font><font style="vertical-align: inherit;">في هذه الحالة ، لدي سياق خاص بي وهو في </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتم تشكيله ، وهذا هو: استلام و / أو إضافة مستخدم إلى قاعدة البيانات ، والتحقق من ملاءمة الرمز المميز للوصول إلى الموسيقى ، وتهيئة عميل Yandex.Music ، اعتمادًا على حالة التفويض ومدى توفر الاشتراك. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعيدًا عن </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handler'a ، هناك</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> معالجات أكثر تحديدًا ، على سبيل المثال ، </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallbackQueryHandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . باستخدامه ، يتم تسجيل معالج لنوع معين من التحديث (النوع الخاص بي ، بتنسيق بيانات). للتحقق مما إذا كان هذا التحديث مناسبًا للمعالج الحالي ، لا يتم فك كل البيانات ، ولكن فقط أول وحدتي بايت. في هذه المرحلة ، يتم التحقق من الحاجة إلى تشغيل رد اتصال. فقط إذا كان تشغيل رد الاتصال ضروريًا - هل يتم </font><i><font style="vertical-align: inherit;">تفريغ</font></i><font style="vertical-align: inherit;"> البيانات بالكامل ونقلها </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ككرغ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إلى المعالج النهائي. </font><font style="vertical-align: inherit;">على الفور يتم إرسال البيانات التحليلية إلى </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ChatBase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتم التسجيل بالتسلسل ، والأولوية أعلى لمن سيتم تسجيله في وقت سابق (في الواقع ، كما هو الحال في </font><font style="vertical-align: inherit;">توجيه </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، وفي مشاريع أخرى). </font><font style="vertical-align: inherit;">لذلك ، يعد تسجيل معالج إصدار قديم هو الأول بين معالجات </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallBackQuery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
منطق معالجة الإصدار القديم بسيط - أبلغ المستخدم بهذا الأمر وأرسل البيانات المحدثة ، إن أمكن.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. الخدمات</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تتم تهيئة جميع الخدمات عندما يتم إطلاق البوت في فئة تحكم واحدة ، والتي يتم استخدامها عالميًا في أي مكان في البوت ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DJ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كل خدمة لها </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> مع عدد معين من العمال التي يتم إرسال المهام إليها.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إعادة تحميل مسار في Telegram</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الوقت الحالي ، لم تتم إعادة كتابة هذه الخدمة إلى </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Bot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> لتجاوز الحد الأقصى لحجم الملف الذي تم تنزيله في Telegram. كما اتضح ، في Yandex.Music هناك ملفات أكبر من 50 ميغابايت - ملفات بودكاست. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تتحقق الخدمة من حجم الملف ، وفي حالة الزيادة ، توجه تنبيهًا للمستخدم. بفضل نظام التخزين المؤقت الموضح في الفقرة 5 ، يتحقق هذا من توفر واستلام كلمات الأغاني. يتم أيضًا تخزين المسارات مؤقتًا. يتم تخزين تجزئة الملف في قاعدة البيانات. إذا كان هناك واحد ، يتم إرسال صوت مع ذاكرة تخزين مؤقت معروفة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في حالة عدم وجود ملف في قاعدة البيانات ، يتم تلقي ارتباط مباشر من Yandex.Music. على الرغم من أنه في الوقت الحالي ، لا يمتلك المستخدمون القدرة على تغيير إعدادات الجودة ، ولكن يتم تعيينهم جميعًا على القيم القياسية. يتم البحث عن الملف عن طريق معدل البت والترميز من إعدادات المستخدم.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتم تنزيل </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الملف وغلافه</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> كملف </font><i><font style="vertical-align: inherit;">مؤقت. ملف مؤقت ()</font></i><font style="vertical-align: inherit;"> ، وبعد ذلك يتم </font><i><font style="vertical-align: inherit;">تحميلهما</font></i><font style="vertical-align: inherit;"> إلى Telegram. </font><font style="vertical-align: inherit;">تجدر الإشارة إلى أن TG لا تتعرف دائمًا على مدة المسار بشكل صحيح ، لكنني عمومًا صامت بشأن الفنان والعنوان. </font><font style="vertical-align: inherit;">لذلك ، يتم أخذ هذه البيانات من Yandex ، لحسن الحظ ، هناك فرصة لإرسالها إلى سلة التسوق. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عندما يتم إرسال ملف صوتي بواسطة هذه الخدمة ، يتم استدعاء </font><font style="vertical-align: inherit;">finish_callback </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ، مما يشير إلى الخدمة عن طريق الاشتراك حول نهاية التنزيل.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">خدمة الاشتراك لتلقي المسارات وإرسال حالة التنزيل</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لا يتم تحميل المسارات على الفور. من الممكن أن يكون العديد من المستخدمين قد طلبوا نفس المسار. في هذه الحالة ، يكون المستخدم الذي طلب المسار أولاً هو البادئ والمالك للمسار. عند إعادة التحميل لأكثر من ثانية ، تبدأ حالة التنزيل: "يرسل المستخدم رسالة صوتية". المستخدمون الآخرون الذين طلبوا نفس المسار هم مشتركون عاديون. يتم إرسال حالة التنزيل إليهم ، مثل المالك ، مرة واحدة كل 4 ثوانٍ تقريبًا حتى لا تتقاطع الرسالة (يتم تعليق الحالة لمدة 5 ثوانٍ). بمجرد اكتمال تنزيل المسار للمالك ، يتم استدعاء </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finish_callback ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> من الخدمة أعلاه. بعد ذلك ، يتم حذف جميع المشتركين من قائمة الحالة وتلقي المسار الذي تم تنزيله.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الحل المعماري ، يكون مالك المسار مشتركًا أيضًا ، ولكن بعلامة معينة ، نظرًا لأن طرق إرسال المسار مختلفة.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. التخزين المؤقت الاستعلام</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كما نتذكر من مقالتي الأخيرة ، فإن الطلبات إلى Yandex.Music API ثقيلة جدًا. يمكن أن تكون قائمة المسارات 3 أو 5 ميغابايت. علاوة على ذلك ، هناك الكثير من الطلبات. مع كل عملية تحديث ، يتم إرسال طلبين على الأقل إلى Yandex: لتهيئة العميل وإجراء محدد. في بعض الأماكن ، لجمع معلومات كافية (على سبيل المثال ، لقائمة تشغيل) ، تحتاج إلى تقديم طلب لقائمة تشغيل ، لتلقي مساراتها ، للحصول على معلومات من الصفحة المقصودة (إذا كانت هذه قائمة تشغيل ذكية) ، ولا تنسى تهيئة العميل. بشكل عام ، رعب هادئ من حيث عدد الطلبات. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أردت شيئًا عالميًا جدًا ، ولم أقم بأي نوع من التخزين لأشياء معينة ، نفس العملاء. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نظرًا لأن المكتبة تسمح لك بتحديد المثيل الخاص بك لتنفيذ الاستعلام ، على رأس </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الطلبات</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ثم استفدت من هذا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
النقطة بسيطة. فئة ذاكرة التخزين المؤقت نفسها مفردة. لديها معلمتان فقط: عمر التخزين المؤقت ، الحجم. عند تنفيذ الطلب ، يتم استدعاء الغلاف. تم تجاوزه. التحقق من ذاكرة التخزين المؤقت يحدث عن طريق تجزئة من الأقواس والمربعات المجمدة. ذاكرة التخزين المؤقت لديها الوقت لإضافتها. عند التحقق من ضرورة تحديث البيانات ، </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتم الحصول على</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> بيانات من </font><i><font style="vertical-align: inherit;">LimitedSizeDict ،</font></i><font style="vertical-align: inherit;"> أو يتم تقديم طلب حقيقي وإضافته إلى ذاكرة التخزين المؤقت. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لا يمكن تخزين بعض الطلبات في ذاكرة التخزين المؤقت ، على سبيل المثال ، تعيين الإعجاب / عدم الإعجاب. إذا ضغط المستخدم على التسلسل التالي: مثل ، لا يعجبني ، مثل ، ثم في النهاية لن يتم تسليم الإعجاب. في مثل هذه الحالات ، عند إرسال طلب ، تحتاج إلى تمرير وسيطة </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use_cache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> بقيمة تساوي </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">في الواقع ، هذا هو المكان الوحيد حيث لا يتم استخدام ذاكرة التخزين المؤقت. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بفضل هذا ، أقوم بالطلبات الأكثر جرأة حتى يتم تخزينها مؤقتًا. </font><font style="vertical-align: inherit;">لا أحاول تقسيمها إلى أجزاء صغيرة ولا أحتاجها إلا للصفحة الحالية. </font><font style="vertical-align: inherit;">أنا آخذ كل شيء دفعة واحدة ، وعند التبديل بين الصفحات ، لدي سرعة تحويل ضخمة (مقارنة بالنهج القديم). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بالنسبة لي ، تحولت فئة الطلبات المخبأة بشكل جميل وتم دمجها ببساطة.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مصدر</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> copy
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Union
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<font></font>
<font></font>
<span class="hljs-keyword">import</span> requests<font></font>
<font></font>
<span class="hljs-keyword">from</span> yandex_music.utils.request <span class="hljs-keyword">import</span> Request <span class="hljs-keyword">as</span> YandexMusicRequest<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LimitedSizeDict</span>(<span class="hljs-params">OrderedDict</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        self.size_limit = kwargs.pop(<span class="hljs-string">"size_limit"</span>, <span class="hljs-literal">None</span>)<font></font>
        OrderedDict.__init__(self, *args, **kwargs)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__setitem__</span>(<span class="hljs-params">self, key, value</span>):</span><font></font>
        OrderedDict.__setitem__(self, key, value)<font></font>
        self._check_size_limit()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_check_size_limit</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.size_limit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">while</span> len(self) &gt; self.size_limit:<font></font>
                self.popitem(last=<span class="hljs-literal">False</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachedItem</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, response: requests.Response</span>):</span><font></font>
        self.timestamp = time.time()<font></font>
        self.response = response<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span>:</span>
    __singleton: <span class="hljs-string">'Cache'</span> = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, lifetime: Union[str, int], size: Union[str, int]</span>):</span><font></font>
        Cache.__singleton = self<font></font>
<font></font>
        self.lifetime = int(lifetime) * <span class="hljs-number">60</span><font></font>
        self.size = int(size)<font></font>
<font></font>
        self.storage: LimitedSizeDict = LimitedSizeDict(size_limit=int(size))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> self.storage[hash_].response<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, response: requests.Response, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        self.storage.update({hash_: CachedItem(response)})<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">need_to_fetch</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        hash_ = Cache.get_hash(*args, **kwargs)<font></font>
        cached_item = self.storage.get(hash_)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cached_item:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> time.time() - cached_item.timestamp &gt; self.lifetime:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_instance</span>(<span class="hljs-params">cls</span>) -&gt; 'Cache':</span>
        <span class="hljs-keyword">if</span> cls.__singleton <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> cls.__singleton
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">f'<span class="hljs-subst">{cls.__name__}</span> not initialized'</span>)<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">freeze_dict</span>(<span class="hljs-params">d: dict</span>) -&gt; Union[frozenset, tuple, dict]:</span>
        <span class="hljs-keyword">if</span> isinstance(d, dict):
            <span class="hljs-keyword">return</span> frozenset((key, Cache.freeze_dict(value)) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> d.items())
        <span class="hljs-keyword">elif</span> isinstance(d, list):
            <span class="hljs-keyword">return</span> tuple(Cache.freeze_dict(value) <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> d)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> d<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params">*args, **kwargs</span>):</span>
        <span class="hljs-keyword">return</span> hash((args, Cache.freeze_dict(kwargs)))<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span>(<span class="hljs-params">YandexMusicRequest</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_request_wrapper</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
        use_cache = kwargs.get(<span class="hljs-string">'use_cache'</span>, <span class="hljs-literal">True</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'use_cache'</span> <span class="hljs-keyword">in</span> kwargs:<font></font>
            kwargs.pop(<span class="hljs-string">'use_cache'</span>)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> use_cache:<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
        <span class="hljs-keyword">elif</span> use_cache <span class="hljs-keyword">and</span> Cache.get_instance().need_to_fetch(*args, **kwargs):<font></font>
            response = super()._request_wrapper(*args, **copy.deepcopy(kwargs))<font></font>
            Cache.get_instance().update(response, *args, **kwargs)<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            response = Cache.get_instance().get(*args, **kwargs)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> response<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. تتبع التعرف عن طريق الرسائل الصوتية</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في البداية ، لم يكن هناك تفكير في إضافة هذا إلى البوت ، ولكن حدث موقف مثير للاهتمام. يحتوي برنامج التتبُّع على محادثة (يشار إليها في وصف برنامج التتبُّع). بعد مرور بعض الوقت ، لاحظت أن الناس يدخلون إليها ويرسلون رسائل صوتية مع الموسيقى. في البداية ، اعتقدت أنه كان نوعًا جديدًا من الرسائل غير المرغوب فيها بحيث قام شخص ما بالتعبئة وكان يمزح. ولكن ، عندما كان هؤلاء الأشخاص أقل من 10 أعوام وكان الجميع يفعلون نفس الشيء ، اقترح صديقي (نفس الشخص الذي اقترح </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">للبنية</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) أن يقوم المستخدمون بقيادة Yandex.Music في البحث ، في انتظار البوت الرسمي للتعرف على الموسيقى من Yandex ، يرون هناك غرفة دردشة ويرسلون إليها رسائل صوتية بكل جدية! لقد كان مجرد افتراض رائع وحقيقي. ثم قلت مازحا أن الوقت قد حان للاعتراف وإضافة بوت للدردشة. من أجل المتعة ... بعد فترة ، تم ذلك!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن عن </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . في الآونة الأخيرة ، استخدمت Yandex بشكل متزايد مآخذ الويب. قابلت استخدامها في إدارة i.module ومحطة i. تعمل أيضًا خدمة التعرف على الموسيقى. لقد رميت الحد الأدنى من حلول العمل في برنامج الروبوت الخاص بي ، لكنني لم أضيف التنفيذ إلى المكتبة. </font><font style="vertical-align: inherit;">يقع </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> على العنوان التالي: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wss: //voiceservices.yandex.net/uni.ws</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
نحن بحاجة إلى رسالتين فقط - التفويض وطلب </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الاعتراف</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يرسل Yandex نفسه ، في تطبيقه الرسمي ، ملفات قصيرة في ثانية أو ثلاث. استجابة لذلك ، يمكنك الحصول على الحاجة إلى إرسال المزيد من البيانات أو النتيجة - تم العثور عليها أم لا. إذا تم العثور على النتيجة ، فسيتم إرجاع معرف المسار. </font><font style="vertical-align: inherit;">يتم </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إرسال </font><font style="vertical-align: inherit;">ملفات </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ogg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> مع</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENCODER = SpeechKit Mobile SDK v3.28.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">لم أتحقق من كيفية عملها مع برامج التشفير الأخرى ، ولكني قمت فقط بتغييرها في الملف المسجل بواسطة Telegram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند الرجوع باستخدام مقبس ويب ، حدث السحر في بعض الأحيان. </font><font style="vertical-align: inherit;">في بعض الأحيان لم أتمكن من العثور على المسار ، ولكن عندما قمت بتغيير اللغة في الرسالة باستخدام طلب التعرف ، كنت أفعل. </font><font style="vertical-align: inherit;">أو في البداية وجد ، ثم توقف ، على الرغم من أن الملف هو نفسه. </font><font style="vertical-align: inherit;">اعتقدت أن لغة المسار يتم تعيينها من خلال </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpeechKit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> على العميل. </font><font style="vertical-align: inherit;">لا أملك هذه الفرصة للقيام بذلك بنفسي ، أقوم بعملية بحث عن القوة الغاشمة.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تنفيذي للركبة من التعرف على الصوت عن طريق الرسائل الصوتية من Telegram</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> uuid<font></font>
<font></font>
<span class="hljs-keyword">import</span> lomond<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_auth_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"SynchronizeState"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"System"</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"accept_invalid_auth"</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">"auth_token"</span>: <span class="hljs-string">"5983ba91-339e-443c-8452-390fe7d9d308"</span>,
                <span class="hljs-string">"uuid"</span>: str(uuid.uuid4()).replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">''</span>),<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_asr_data</span>():</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"event"</span>: {
            <span class="hljs-string">"header"</span>: {
                <span class="hljs-string">"messageId"</span>: str(uuid.uuid4()),
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"Recognize"</span>,
                <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"ASR"</span>,
                <span class="hljs-string">"streamId"</span>: <span class="hljs-number">1</span><font></font>
            },<font></font>
            <span class="hljs-string">"payload"</span>: {
                <span class="hljs-string">"advancedASROptions"</span>: {
                    <span class="hljs-string">"manual_punctuation"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"partial_results"</span>: <span class="hljs-literal">False</span><font></font>
                },<font></font>
                <span class="hljs-string">"disableAntimatNormalizer"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"format"</span>: <span class="hljs-string">"audio/opus"</span>,
                <span class="hljs-string">"music_request2"</span>: {
                    <span class="hljs-string">"headers"</span>: {
                        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"audio/opus"</span><font></font>
                    }<font></font>
                },<font></font>
                <span class="hljs-string">"punctuation"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"tags"</span>: <span class="hljs-string">"PASS_AUDIO;"</span>,
                <span class="hljs-string">"topic"</span>: <span class="hljs-string">"queries"</span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Recognition</span>:</span>
    URI = <span class="hljs-string">'wss://voiceservices.yandex.net/uni.ws'</span>
    LANGS = [<span class="hljs-string">''</span>, <span class="hljs-string">'ru-RU'</span>, <span class="hljs-string">'en-US'</span>]<font></font>
    POLL_DELAY = <span class="hljs-number">0.3</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, binary_data, status_msg</span>):</span><font></font>
        self.status_msg = status_msg<font></font>
        self.websocket = lomond.WebSocket(self.URI)<font></font>
        self.chunks = self.get_chunks_and_replace_encoder(binary_data)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_track_id</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> lang <span class="hljs-keyword">in</span> Recognition.LANGS:<font></font>
            asr_data = get_asr_data()<font></font>
            <span class="hljs-keyword">if</span> lang:<font></font>
                asr_data[<span class="hljs-string">'event'</span>][<span class="hljs-string">'payload'</span>].update({<span class="hljs-string">'lang'</span>: lang})<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'     <span class="hljs-subst">{lang}</span>...'</span>)
            <span class="hljs-keyword">else</span>:<font></font>
                self.status_msg.edit_text(<span class="hljs-string">f'      ...'</span>)<font></font>
<font></font>
            <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> self.websocket.connect(poll=self.POLL_DELAY):
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'ready'</span>:<font></font>
                    self.websocket.send_json(get_auth_data())<font></font>
                    self.websocket.send_json(asr_data)<font></font>
<font></font>
                    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> self.chunks:<font></font>
                        self.websocket.send_binary(chunk)<font></font>
<font></font>
                <span class="hljs-keyword">if</span> msg.name == <span class="hljs-string">'text'</span>:<font></font>
                    response = msg.json.get(<span class="hljs-string">'directive'</span>)<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> self.is_valid_response(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">return</span> self.parse_track_id(response)
                    <span class="hljs-keyword">elif</span> self.is_fatal_error(response):<font></font>
                        self.websocket.close()<font></font>
<font></font>
                        <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_response</span>(<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'success'</span>:<font></font>
            self.status_msg.edit_text(<span class="hljs-string">f' ,  !'</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_fatal_error</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'header'</span>, {}).get(<span class="hljs-string">'name'</span>) == <span class="hljs-string">'MusicResult'</span> <span class="hljs-keyword">and</span> \<font></font>
                response.get(<span class="hljs-string">'payload'</span>, {}).get(<span class="hljs-string">'result'</span>) == <span class="hljs-string">'music'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_track_id</span>(<span class="hljs-params">response</span>):</span>
        <span class="hljs-keyword">return</span> response[<span class="hljs-string">'payload'</span>][<span class="hljs-string">'data'</span>][<span class="hljs-string">'match'</span>][<span class="hljs-string">'id'</span>]<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_chunks_and_replace_encoder</span>(<span class="hljs-params">binary_data</span>):</span><font></font>
        chunks = []<font></font>
<font></font>
        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> binary_data.split(<span class="hljs-string">b'OggS'</span>)[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> <span class="hljs-string">b'OpusTags'</span> <span class="hljs-keyword">in</span> chunk:<font></font>
                pos = chunk.index(<span class="hljs-string">b'OpusTags'</span>) + <span class="hljs-number">12</span><font></font>
                size = len(chunk)<font></font>
                chunk = chunk[:pos] + <span class="hljs-string">b'#\x00\x00\x00\x00ENCODER=SpeechKit Mobile SDK v3.28.0'</span>
                chunk += <span class="hljs-string">b"\x00"</span> * (size - len(chunk))<font></font>
<font></font>
            chunks.append(<span class="hljs-string">b'\x00\x00\x00\x01OggS'</span> + chunk)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> chunks<font></font>
<font></font>
</code></pre><br>
     ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"> </a>.<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. الملاحظات الصغيرة</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في البداية ، يمكن للمستخدمين الذين لديهم اشتراك فقط استخدام برنامج التتبُّع نظرًا لحقيقة أنه يمكن استخدام الخدمة في عدد محدود من البلدان (بدون اشتراك) ، ويقع الخادم مع برنامج التتبُّع في أوروبا. يتم حل المشكلة باستخدام وكيل لتنفيذ الطلبات من المستخدمين بدون اشتراك. يقع الخادم الوكيل في موسكو. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك اختيار من الصفحات ، لكنه يقتصر على 100 (لا يمكن إضافة المزيد من الأزرار ، تقييد Telegram). تحتوي بعض طلبات الصفحات الشائعة على المزيد من الصفحات.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في بحث Yandex ، يكون عدد العناصر في الصفحة مشفرًا. كم عدد المسارات وعدد قوائم التشغيل. في بعض الأحيان لا يتوافق هذا حتى مع كمية البيانات المعروضة على الجبهة. هناك تغيير في الصفحة ، عدد العناصر عائم. لذلك ، في البوت يقفز أيضًا ، وهو ليس جميلًا جدًا. والجمع بين مروِّحهم ورقمه - شيء من هذا القبيل. في الأماكن الأخرى حيث يمكن طلب عدد معين من العناصر في الصفحة ، كل شيء مثالي. الرسالة الصوتية بعد تنفيذ البحث في البوت هي </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/416</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند إعادة توجيه الصوت في Telegram ، يتم فقد المؤلف وتعيينه لمن قام بإعادة التوجيه. لذلك ، يتم إرسال جميع المسارات بتوقيع اسم مستخدم الروبوت. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
رسالة صوتية بكل ما التقيت به بعد تنفيذ الراديو في المكتبة - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/MarshalC/422</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(حول سلسلة المسارات ، من خلال إرسال كومة من الملاحظات ، </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batch_id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">استنتاج</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
على الرغم من حقيقة أن هذه مقالة أخرى حول برنامج Telegram ، إلا أنك قرأتها حتى هنا ، على الأرجح لأنك كنت مهتمًا بأحد العناصر في المقطع وهذا رائع ، </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">شكرًا جزيلاً لك</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لسوء الحظ ، لم أفتح شفرة المصدر للبوت بالكامل (لأنه في بعض الأماكن أحتاج إلى إعادة البناء). </font><font style="vertical-align: inherit;">تم وصف الكثير في هذه المقالة ، ولكن بعض الجوانب ، على سبيل المثال ، مع لوحات المفاتيح الافتراضية وتوليدها لا تتأثر. </font><font style="vertical-align: inherit;">بالنسبة للجزء الأكبر ، ما هو غير موجود في المقالة هو العمل فقط مع مكتبتي ، لا شيء مثير للاهتمام.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الطبقات التي يدور حولها كل شيء ، عرضتها في الشكل الذي هم فيه الآن. أعترف أن هناك أخطاء ، ولكن كل ذلك يعمل لفترة طويلة. في بعض الأماكن يعجبني الرمز الخاص بي ، وفي بعض الأماكن لا أحب - وهذا أمر طبيعي. لا تنس أن العمل مع WS من أجل الاعتراف هو حل على الركبة. جاهز لقراءة النقد المنطقي في التعليقات. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
على الرغم من أن البوت تم التخطيط له حتى عندما بدأت في كتابة المكتبة ، فقد تبرأت من هذه الفكرة ، ولكن ، على ما يبدو ، عدت (كانت مملة). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Music Bot - مشروع يثبت ملاءمة استخدام </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المكتبة للعمل مع API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> في المشاريع.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
شكرا جزيلا لأمي ، يانا ، صنعاء ، المجد. </font><font style="vertical-align: inherit;">شخص ما يقوم بتدقيق الأخطاء ، والبعض الآخر للتلميحات ، والتي بدونها ربما لم تكن هناك بعض النقاط في هذه المقالة ، وبالنسبة للبعض ببساطة لتقييم المقالة قبل النشر. </font><font style="vertical-align: inherit;">آرثر عن picci للمقال ، Lyod للشعار. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> لدي الآن مشكلة حادة في التوزيع بعد الدراسة. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إذا كنت على استعداد لإجراء مكالمة علي - أخبرني أين أرسل سيرتك الذاتية ، قم بمقابلتي ، من فضلك. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">جميع جهات الاتصال الخاصة بي في ملف التعريف. </font><font style="vertical-align: inherit;">التوقيت يحترق ، آمل لك. </font><font style="vertical-align: inherit;">وفقا للقانون ، لا يمكنني العمل إلا في جمهورية بيلاروس. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> كانت هذه هي المقالة الثانية من ثلاثة ، ولكن بدون أدنى فكرة سيكون لدي الوقت للقيام بمشروع آخر حول هذا الموضوع وما إذا كانت هناك حاجة إليه. </font><font style="vertical-align: inherit;">سأكشف علانية عن موضوعه - العميل عبر الأنظمة الأساسية Yandex.Music.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar487418/index.html">ما هو SAP؟</a></li>
<li><a href="../ar487420/index.html">Sound War Z. اختبار مكبرات الصوت وسماعات MusicDealer</a></li>
<li><a href="../ar487422/index.html">مسؤوليات مسؤول Salesforce: ما الذي يجب فعله ومتى</a></li>
<li><a href="../ar487424/index.html">كيفية التوسع من 1 إلى 100000 مستخدم</a></li>
<li><a href="../ar487426/index.html">المرونة تحدد النجاح.</a></li>
<li><a href="../ar487430/index.html">ما هي المهارات اللازمة لإنشاء تطبيق iOS؟ تقرير ياندكس</a></li>
<li><a href="../ar487432/index.html">على خطى DevConf و CfgMgmtCamp أو ما يمكنك تعلمه من خلال الذهاب إلى المتحدث في مؤتمرين دوليين في أسبوعين</a></li>
<li><a href="../ar487438/index.html">كيف تنشئ شركة تكنولوجيا معلومات من الصفر - بدون خبرة في هذا المجال ومهارات البرمجة؟</a></li>
<li><a href="../ar487444/index.html">"أثناء شرب القهوة ، وتلقي الفواتير وتلقي دفعة للدفع" - ابتكارات تسمح لك بممارسة الأعمال التجارية على مدار الساعة طوال أيام الأسبوع</a></li>
<li><a href="../ar487446/index.html">هل يمكن للشركة أن "تمتلك" اللون؟</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>