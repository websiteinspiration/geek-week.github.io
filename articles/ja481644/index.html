<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♍️ 👩🏻‍🌾 🏕️ 21世紀のSQLデータベースを生き残る方法：クラウド、Kubernetes、PostgreSQLマルチマスター #⃣ 👨🏾‍🌾 👧🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブロフスク。今日、クラスはPostgreSQLコースの最初のグループから始まります。この点について、このコースのオープンウェビナーがどのように行われたかについてお話ししたいと思います。
 
 
 
 では、次のオープンレッスン、我々は雲とKubernetesの時代に直面しているSQLデ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>21世紀のSQLデータベースを生き残る方法：クラウド、Kubernetes、PostgreSQLマルチマスター</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/481644/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブロフスク。</font><font style="vertical-align: inherit;">今日、クラスは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの最初のグループから始まり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この点について、このコースのオープンウェビナーがどのように行われたかについてお話ししたいと思います。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/bk/dg/wb/bkdgwboms19lihcydjxhd_do6is.jpeg"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のオープンレッスン、我々は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">雲とKubernetesの時代に直面しているSQLデータベースに挑戦するかについて話しました。</font><font style="vertical-align: inherit;">同時に、これらの呼び出しの影響下でSQLデータベースがどのように適応および変化するかを調査しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このウェビナーは</font><font style="vertical-align: inherit;">、EPAMシステムのGoogle Cloudプラクティスデリバリーマネージャーである</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valery Bezrukov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が主催しました</font><font style="vertical-align: inherit;">。</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">木々が小さい時...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、前世紀の終わりにDBMSの選択がどのように始まったかを思い出してみましょう。</font><font style="vertical-align: inherit;">ただし、当時のDBMSの選択は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracleで</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始まり、</font><b><font style="vertical-align: inherit;">Oracle</font></b><font style="vertical-align: inherit;">で終わったため、これは難しくありません</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/ro/ub/zaroubp-wzhpvdvm8umssbidsde.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
90年代後半-業界のスケーラブルなデータベースについて言えば、問題の始まり、実際には特別な選択はありませんでした。</font><font style="vertical-align: inherit;">はい、IBM DB2、Sybase、およびその他いくつかのデータベースが現れたり消えたりしましたが、一般的にそれらはOracleに対してそれほど目立ちませんでした。</font><font style="vertical-align: inherit;">したがって、当時のエンジニアのスキルは、存在する唯一の選択肢に何らかの形で結びついていました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oracle DBAは次のことができる必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ディストリビューションからOracle Serverをインストールする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Oracleサーバーを構成します。</font></font></li>
</ul><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">init.ora;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listener.ora;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-作成：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表スペース</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スキーム;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- バックアップと復元; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-モニタリングを実行します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-次善のリクエストに対処します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、Oracle DBAは特に必要ではありませんでした。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データの保存と処理に最適なDBMSまたはその他のテクノロジーを選択できる。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高可用性と水平方向のスケーラビリティを提供します（これは常にDBAの問題ではありませんでした）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">対象分野、インフラストラクチャ、応用アーキテクチャ、OSに関する十分な知識。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データのロードとアンロード、異なるDBMS間のデータ移行を実行します。</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、当時の選択について話すと、80年代後半のソビエトストアでの選択に似ています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u-/ue/hx/u-uehxpuynbhmzgj78jqebims2o.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近では</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それ以来、もちろん、木が成長し、世界が変化し、次のようなものになりまし</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l_/-p/0a/l_-p0anmxny8o64hqnymm3jlow4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
た。DBMS市場も変化しました。これは、最新のGartnerレポートから明確に見ることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/r9/xv/mrr9xvkcwao2s8uf3oukwzdfiz4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、クラウドがニッチになり、人気が高まっていることに注意してください。</font><font style="vertical-align: inherit;">同じガートナーレポートを読むと、次のような結論が得られます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くのお客様がアプリケーションをクラウドに移行する途中です。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいテクノロジーが最初にクラウドに登場し、クラウドフリーのインフラストラクチャに移行することは事実ではありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従量課金制の料金体系がよく知られています。</font><font style="vertical-align: inherit;">誰もが使用した分だけを支払いたいと思っていますが、これはトレンドではなく、単に事実の表明です。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今何？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日、私たちは皆クラウドの中にいます。</font><font style="vertical-align: inherit;">そして私たちが持っている質問は、選択の質問です。</font><font style="vertical-align: inherit;">また、オンプレミス形式のDBMSテクノロジの選択についてのみ話していても、それは巨大です。</font><font style="vertical-align: inherit;">また、サービスとSaaSも管理しています。</font><font style="vertical-align: inherit;">したがって、選択は毎年より複雑になってきています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
選択の質問に加えて、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制限要因</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も適用されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">価格</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">多くの技術はまだお金がかかります。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スキル</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">フリーソフトウェアについて語る場合、スキルの問題が発生します。フリーソフトウェアは、十分な能力を持ってそれを展開および運用する人を必要とするためです。</font></font></li>
<li><b></b>.   ,      , ,      Postgres,    ,   Postgres On-premises.   ,     .  ,      ,   -     . </li>
</ul><br>
<b>    DA/DE:</b><br>
<br>
<ul>
<li>      ;</li>
<li>         ;</li>
<li>          ;</li>
<li>     ;</li>
<li>     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCPベースの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例は</font><font style="vertical-align: inherit;">：データを操作するための特定の技術の選択は、その構造に応じて構成されている方法を示し</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/pp/dh/yxppdhmwfv2mz70myzv_lht2ni4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、それはの用語の下に隠しているため、PostgreSQLは、スキーマに存在しないことに注意してください、そして、すべてを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラウドSQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 Cloud SQLに到達したら、もう一度選択する必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ck/qr/hx/ckqrhx_1ckivxigooielk8zwwf4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この選択は常に明確であるとは限らないため、アプリケーション開発者はしばしば直感に導かれることに注意してください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計：</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに、選択の問題はより緊急になります。</font><font style="vertical-align: inherit;">また、GCP、マネージドサービス、SaaSだけを見た場合でも、RDBMSについての言及は4番目のステップにのみ現れます（近くにSpannerがあります）。</font><font style="vertical-align: inherit;">さらに、PostgreSQLの選択は一般に5番目のステップで表示され、その隣にはMySQLとSQL Serverもあります。つまり、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多数ありますが、を選択する必要があります</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは誘惑の背景の制限を忘れてはなりません。</font><font style="vertical-align: inherit;">ほとんどの人がSpannerを望んでいますが、それは高価です。</font><font style="vertical-align: inherit;">その結果、一般的なクエリは次のようになります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Spannerを実行してください。ただし、Cloud SQLの価格では、専門家です。」</font></font></i></li>
</ol><br>
<img src="https://habrastorage.org/webt/lr/ea/fn/lreafntu62cx39itddembcwmdak.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何をすべきか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
究極の真実であると主張することなく、私たちは次のように言います：</font><b><font style="vertical-align: inherit;">学習へのアプローチを変える必要があり</font></b><font style="vertical-align: inherit;">ます</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学ぶことは、DBAの前に教えられたように、意味がありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの製品の知識だけではもはや十分ではありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、1レベルで数十を知ることは不可能です。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
製品を知るだけでなく、製品の量も知る必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのアプリケーションの使用例;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまな展開方法。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各方法の長所と短所;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情報に基づいた最適な選択を行うための類似製品および代替製品であり、必ずしも使い慣れた製品を優先するわけではありません。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、データを移行し、ETLとの統合の基本原則を理解できる必要もあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際のケース</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近では、モバイルアプリケーションのバックエンドを作成する必要がありました。</font><font style="vertical-align: inherit;">作業を開始する頃には、バックエンドは既に開発されており、実装の準備ができていました。開発チームはこのプロジェクトに約2年を費やしました。</font><font style="vertical-align: inherit;">次のタスクが設定されました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI / CDを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーキテクチャを確認する。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてを稼働させます。 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーション自体はマイクロサービスであり、Python / DjangoコードはゼロからすぐにGCPで開発されました。</font><font style="vertical-align: inherit;">ターゲットオーディエンスについては、米国とEUの2つのリージョンがあると想定され、トラフィックはグローバルロードバランサーを介して分散されました。</font><font style="vertical-align: inherit;">すべてのワークロードと計算ワークロードは、Google Kubernetes Engineで機能しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データに関しては、3つの構造がありました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラウドストレージ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データストア;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud SQL（PostgreSQL）。</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/9c/n8/xn/9cn8xnhmpxyfxzoqvh86nqle8bo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は、なぜCloud SQLが選ばれたのかということです。</font><font style="vertical-align: inherit;">実を言うと、このような質問は近年、やっかいな一時停止を引き起こしました。人々はリレーショナルデータベースに恥ずかしくなり始めたようですが、それでも積極的にデータベースを使用し続けています;-)。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回のケースでは、Cloud SQLが次の理由で選択されました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前述のように、アプリケーションはDjangoを使用して開発され、SQLデータベースからPythonオブジェクト（Django ORM）に永続データをマッピングするためのモデルがあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームワーク自体は、DBMSのかなり限定的なリストをサポートしていました。</font></font></li>
</ol><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オラクル</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLite</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、PostgreSQLはこのリストから直感的に選択されました（実際、選択するのはOracleではありません）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欠けていたもの：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションは2つの地域にのみデプロイされ、計画は3番目（アジア）に表示されました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースは北米地域（アイオワ）にありました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヨーロッパやアジアからの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクセスの遅延</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font><font style="vertical-align: inherit;">、DBMSのダウンタイムが発生した場合の</font><b><font style="vertical-align: inherit;">サービスの</font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中断</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について、お客様側に懸念がありました</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Django自体が複数のデータベースを並行して処理し、読み取りと書き込みによってそれらを分割できるという事実にもかかわらず、アプリケーションにはそれほど多くのレコードがありませんでした（90％以上-読み取り）。そして、一般的に、そして一般的に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヨーロッパとアジアの主要拠点のレプリカを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成できれば</font><font style="vertical-align: inherit;">、これは妥協的な解決策になります。さて、何がそんなに複雑ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして問題は、顧客がマネージドサービスとCloud SQLの使用を放棄したくないということでした。</font><font style="vertical-align: inherit;">また、Cloud SQLの可能性は現在限られています。</font><font style="vertical-align: inherit;">Cloud SQLは高可用性（HA）とリードレプリカ（RR）をサポートしていますが、同じRRは1つのリージョンでのみサポートされています。</font><font style="vertical-align: inherit;">アメリカのリージョンにデータベースを作成した後、Cloud SQLを使用してヨーロッパのリージョンにリードレプリカを作成することはできませんが、postgres自体は干渉しません。</font><font style="vertical-align: inherit;">Googleの従業員とのやり取りは何にもつながりませんでしたが、「私たちは問題を知っており、取り組んでいます。いつか問題は解決されるでしょう」というスタイルの約束で終わりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud SQLの機能を抽象的にリストすると、次のようになります</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。1.高可用性（HA）：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの地域内;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスク複製を介して</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQLメカニズムは使用されません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動および手動制御が可能-フェイルオーバー/フェイルバック;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切り替えると、DBMSは数分間使用できなくなります。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.リードレプリカ（RR）：</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの地域内;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホットスタンバイ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQLストリーミングレプリケーション。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、慣例として、テクノロジーを選択するときは常にいくつかの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制限に直面し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お客様は、GKEを介する場合を除いて、エンティティの作成とIaaSの使用を望んでいませんでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客はセルフサービスのPostgreSQL / MySQLをデプロイしたくないでしょう。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まあ、一般的に言えば、Google Spannerはその価格に合わないのであれば非常に適していますが、Django ORMはこれに対応できず、状況は良好です。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この状況で、お客様は</font><i><font style="vertical-align: inherit;">「Google Spannerのようにすることはできますが、Django ORMでも機能しますか？」</font></i><font style="vertical-align: inherit;">というバックフィルの質問を受けました</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションNo.0</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に頭に浮かんだこと：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudSQL内に留まる</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リージョン間の統合レプリケーションはありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQLによってレプリカを既存のCloud SQLに固定してみます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どこかで、どういうわけかPostgreSQLインスタンスを起動しますが、少なくともマスターは触れません。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悲しいかな、ホストにはアクセスできないため（完全に別のプロジェクトにあります）、pg_hbaなどであり、スーパーユーザーの下にはまだアクセスできないため、これは実行できないことがわかりました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションNo.1</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに考察し、以前の状況を考慮した後、一連の考え方は多少変化しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudSQLのフレームワーク内に留まるように努めていますが、MySQLに切り替えています。これは、Cloud SQL by MySQLに次の外部マスターがあるためです。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-外部MySQLのプロキシです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-MySQLインスタンスのように見えます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-他のクラウドまたはオンプレミスからのデータ移行のために発明されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQLレプリケーションのセットアップはホストへのアクセスを必要としないため、原則としてすべてが機能しますが、非常に不安定で不便です。</font><font style="vertical-align: inherit;">さらに進むと、構造全体をテラフォームで展開したため、それは完全に恐ろしくなり、突然、外部マスターがテラフォームでサポートされていないことがわかりました。</font><font style="vertical-align: inherit;">はい、GoogleにはCLIがありますが、何らかの理由で時々すべてが時々機能しました-作成されましたが、作成されていません。</font><font style="vertical-align: inherit;">おそらく、CLIはレプリカではなく、外部のデータ移行のために発明されたためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これについては、Cloud SQLが言葉にまったく適合しないことが明らかになりました。</font><font style="vertical-align: inherit;">彼らが言うように、私たちはできる限りのことをしました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションNo.2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud SQL内にとどまるように機能しなかったため、妥協ソリューションの要件を定式化しようとしました。</font><font style="vertical-align: inherit;">要件は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesでの作業、Kubernetes（DCSなど）とGCP（LBなど）のリソースと機能の最大使用</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAプロキシのようなクラウド内の不要なものの山からのバラストの欠如。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メインリージョンでHA PostgreSQLまたはMySQLを実行する機能。</font><font style="vertical-align: inherit;">他のリージョン-メインリージョンのRRとそのコピーからのHA（信頼性のため）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチマスター（彼に連絡したくなかったが、それほど重要ではなかった）</font></font></li>
</ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの要件の結果、地平線上にようやく</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">適切なDBMSオプションとバインディング</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が登場しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Galera;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CockroachDB;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQLツール</font></font></li>
</ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-pgpool-II; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-パトロニ。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQLガレラ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL GaleraテクノロジーはCodershipによって開発され、InnoDBのプラグインです。</font><font style="vertical-align: inherit;">特徴：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチマスター;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同期複製</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意のノードからの読み取り。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意のノードに記録します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組み込みのHAメカニズム。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BitnamiのHelmチャートがあります。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゴキブリ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明によると、このことは完全に大げさで、Goで書かれたオープンソースプロジェクトです。</font><font style="vertical-align: inherit;">主な参加者は、（Googleからの移民によって設立された）ゴキブリ研究所です。</font><font style="vertical-align: inherit;">このリレーショナルDBMSは、元々は（水平スケーリングをそのまま使用して）分散され、フォールトトレラントになるように作成されました。</font><font style="vertical-align: inherit;">同社の作成者は、「SQL機能の豊富さと、NoSQLソリューションでよく知られている水平方向の可用性を組み合わせる」という目標の概要を説明しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すばらしいボーナスは、postgres接続プロトコルのサポートです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pgpool</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはPostgreSQLのアドオンであり、実際には、すべての接続を引き継いで処理する新しいエンティティです。</font><font style="vertical-align: inherit;">独自のローダーバランサーとパーサーがあり、BSDライセンスの下でライセンスされています。</font><font style="vertical-align: inherit;">それは十分な機会を提供しますが、新しいエンティティの存在がいくつかの追加の冒険の源となる可能性があるため、それはやや恐ろしいように見えます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パトロニ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは目がついた最後のことであり、結局のところ、無駄ではありません。</font><font style="vertical-align: inherit;">Patroniはオープンソースユーティリティであり、本質的には、さまざまな種類のレプリケーションと自動ロールスイッチングを備えたPostgreSQLクラスターを自動的に維持できるPythonデーモンです。</font><font style="vertical-align: inherit;">この作品は、cuberとうまく統合され、新しいエンティティを持たないため、非常に興味深いものであることがわかりました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終的に何を選択したか</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
選択は簡単ではありませんでした：</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CockroachDB-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">火事ですが、馬鹿げています。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Galera</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もよく使用されますが、MySQLも優れています。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pgpool-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くの追加エンティティー、クラウドやK8とのまあまあの統合。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroni</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - K8S、余分なエンティティとの優れた統合、GCPのLBをと統合</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、選択はパトロニにかかった。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まとめる時が来ました。</font><font style="vertical-align: inherit;">はい、ITインフラストラクチャの世界は大きく変化し、これはほんの始まりにすぎません。</font><font style="vertical-align: inherit;">以前のクラウドが別のタイプのインフラストラクチャであった場合、今ではすべてが異なります。</font><font style="vertical-align: inherit;">それだけでなく、クラウドのイノベーションは絶え間なく現れており、おそらくクラウドにのみ現れ、その後スタートアップの助けを借りてオンプレミスに転送されるでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SQLに関しては、SQLは存続します。</font><font style="vertical-align: inherit;">つまり、PostgreSQLとMySQLは既知である必要があり、それらを使用できるようにする必要がありますが、さらに重要なことに、それらを正しく適用できるようにする必要があります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481628/index.html">テストケースで予備ステップを記述するためのルール</a></li>
<li><a href="../ja481632/index.html">クラウドプロバイダー：市場で最も優れているのは誰ですか？</a></li>
<li><a href="../ja481634/index.html">フードデザインダイジェスト、2019年11月</a></li>
<li><a href="../ja481638/index.html">複雑な生産の3Dモデルが役立つ理由</a></li>
<li><a href="../ja481640/index.html">プラグインDevOpsProdigy KubeGrafの新バージョンのリリース</a></li>
<li><a href="../ja481648/index.html">Junos PyEZは、無料のIPv4サブネットを見つけるためのタスクの例として</a></li>
<li><a href="../ja481652/index.html">バックドア（？）BlackBerry Androidスマートフォン</a></li>
<li><a href="../ja481654/index.html">QAエンジニアがボットフレームワークを使用して、Test ITの助けを借りて人生を楽にした方法の物語</a></li>
<li><a href="../ja481656/index.html">PagerDuty、または手術部門が夜眠れない理由</a></li>
<li><a href="../ja481658/index.html">ZabbixでPortSecurity Cisco Switchイベントを監視する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>