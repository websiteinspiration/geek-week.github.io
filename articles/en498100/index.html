<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçΩÔ∏è üî≠ üôÇ Designing Kubernetes Clusters: How Many Should There Be? üòØ ü§ù üó∫Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Note perev. : This material from the learnk8s educational project is the answer to a popular question when designing infrastructure based on Kubernete...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Designing Kubernetes Clusters: How Many Should There Be?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/498100/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note </font><font style="vertical-align: inherit;">perev. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: This material from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">learnk8s</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> educational project </font><font style="vertical-align: inherit;">is the answer to a popular question when designing infrastructure based on Kubernetes. </font><font style="vertical-align: inherit;">We hope that sufficiently detailed descriptions of the pros and cons of each option will help to make the best choice for your project. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/uz/_v/sp/uz_vspvw6jl4msryd1hwpzmc7lg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL; DR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : the same set of workloads can be run on several large clusters (each cluster will have a large number of workloads) or on many small ones (with a small number of loads in each cluster). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The table below summarizes the pros and cons of each approach:</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/ij/lh/5w/ijlh5wkmppehbxtfe3_01dfghgq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When using Kubernetes as a platform for operating applications, several fundamental questions about the intricacies of cluster configuration often arise:</font></font><br>
<br>
<ul>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How many clusters to use?</font></font></i></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How big do they make?</font></font></i></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What should each cluster include?</font></font></i></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I will try to answer all these questions by analyzing the pros and cons of each approach.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statement of a question</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a software creator, you are likely to develop and operate many applications in parallel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, many instances of these applications are likely to run in various environments - for example, it can be </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The result is a whole matrix of applications and environments: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/na/dp/eznadpf721b-xqsegk1r06-xnzs.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Applications and environments</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In the above example, 3 applications and 3 environments are presented, which ultimately gives 9 possible options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each application instance is a self-contained deployment unit that can be operated independently of others. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an application instance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> may consist of many </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">components.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">such as frontend, backend, database, etc. </font><font style="vertical-align: inherit;">In the case of a microservice application, the instance will include all microservices. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, Kubernetes users have several questions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Should I place all the application instances in one cluster?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Should I create a separate cluster for each instance of the application?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Or maybe you should use a combination of the above approaches?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All of these options are quite viable, because Kubernetes is a flexible system that does not limit the user in possibilities. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are some of the possible ways:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> one large common cluster;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> many small highly specialized clusters;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> one cluster for each application;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> one cluster for each environment.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As shown below, the first two approaches are at the opposite ends of the options scale: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t6/0i/io/t60iio_6be7vuavwfgx00u0dtoc.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From several large clusters (on the left) to many small ones (on the right) </font></font></i><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, one cluster is considered to be ‚Äúlarger‚Äù than the other if it has a larger sum of nodes and pods. </font><font style="vertical-align: inherit;">For example, a cluster with 10 nodes and 100 pods is larger than a cluster with 1 node and 10 pods. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, let's get started!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. One large common cluster</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first option is to place all the workloads in one cluster: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4f/yf/0w/4fyf0w9twiww8juvy388ptrtjgy.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One large cluster</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As part of this approach, the cluster is used as a universal </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">infrastructure platform</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - you just deploy everything you need in an existing Kubernetes cluster. </font></font><br>
<br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namespace'y</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kubernetes allows logically separate part of the cluster from each other, so that its name space can be used for each instance of the application. </font></font></i><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at the pros and cons of this approach.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Efficient use of resources</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of a single cluster, only one copy of all the resources needed to start and manage the Kubernetes cluster is required. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, this is true for master nodes. </font><font style="vertical-align: inherit;">Usually there are 3 master nodes for each Kubernetes cluster, so for one single cluster their number will remain so (for comparison, 10 clusters will need 30 master nodes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The above subtlety applies to other services operating on a cluster-wide basis, such as load balancers, Ingress controllers, authentication, logging and monitoring systems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a single cluster, all these services can be used immediately for all workloads (you do not need to create copies of them, as in the case of several clusters).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Cheap</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a consequence of the foregoing, a smaller number of clusters is usually cheaper because there are no costs for excess resources. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is especially true for master nodes, which can cost significant money regardless of the placement method (on-premises or in the cloud). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some managed Kubernetes services, such as the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Kubernetes Engine (GKE)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Azure Kubernetes Service (AKS)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , provide a control layer for free. </font><font style="vertical-align: inherit;">In this case, the cost issue is less acute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are also managed services that charge a fixed fee for each Kubernetes cluster (for example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Elastic Kubernetes Service, EKS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Effective administration</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Managing a single cluster is easier than several. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Administration may include the following tasks:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> update version of Kubernetes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CI / CD pipeline configuration</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CNI plugin installation;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setting up a user authentication system;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setting access controller;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and many others ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of one cluster, all this will have to be done only once. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For many clusters, operations will have to be repeated many times, which will probably require some automation of processes and tools to ensure a systematic and uniform process. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now a few words about the cons.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Single point of failure</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the event of a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">single</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cluster </font><font style="vertical-align: inherit;">failure </font><font style="vertical-align: inherit;">, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">all</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> workloads </font><font style="vertical-align: inherit;">will stop working immediately </font><font style="vertical-align: inherit;">! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are tons of options when something can go wrong:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> updating Kubernetes leads to unexpected side effects;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the cluster-wide component (for example, the CNI plugin) does not work as expected;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> One of the cluster components is not configured correctly.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a failure in the underlying infrastructure.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One such incident can cause serious damage to all workloads located in a common cluster.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Lack of hard insulation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Working in a shared cluster means that applications share hardware, network capabilities, and the operating system on the cluster nodes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a sense, two containers with two different applications running on the same host are similar to two processes running on the same machine running the same OS kernel. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux containers provide some form of isolation, but it is far from being as strong as that provided by, say, virtual machines. In essence, a process in a container is the same process running on the host operating system.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This can be a security issue: such an organization theoretically allows unrelated applications to interact with each other (intentionally or accidentally).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, all workloads in the Kubernetes cluster share some cluster-wide services, such as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - this allows applications to find the Services of other applications in the cluster. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All of the above items may have different meanings depending on the requirements for application security.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Kubernetes provides various tools to prevent security issues, such as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PodSecurityPolicies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkPolicies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . However, for their proper configuration requires some experience in addition, they are not able to close absolutely all the security holes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It‚Äôs important to always remember that Kubernetes was originally designed for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sharing.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and not for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isolation and security</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Lack of tight multi-tenancy</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Given the abundance of shared resources in the Kubernetes cluster, there are many ways in which different applications can ‚Äúhit each other's heels‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, an application can monopolize some shared resource (like a processor or memory) and deprive other applications running on the same node of access to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes provides various mechanisms for controlling such behavior, such as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resource requests and limits </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(see also the article ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU Limits and aggressive throttling in Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù - approx. Transl.)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ResourceQuotas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LimitRanges</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . However, as in the case of security, their configuration is quite nontrivial and they are not able to prevent absolutely all unforeseen side effects.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- A large number of users</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of a single cluster, many people have to open access to it. </font><font style="vertical-align: inherit;">And the greater their number, the higher the risk that they will ‚Äúbreak something‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside the cluster, you can control who and what can be done using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">role-based access control (RBAC) </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(see the article ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Users and RBAC Authorization in Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù - approx. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Transfer</font></a><font style="vertical-align: inherit;"> )</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">However, it will not prevent users from ‚Äúbreaking‚Äù something within the boundaries of their area of ‚Äã‚Äãresponsibility.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Clusters cannot grow indefinitely</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The cluster that is used for all workloads will probably be quite large (in terms of the number of nodes and pods). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But here another problem arises: clusters in Kubernetes cannot grow indefinitely. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a theoretical limit on cluster size. At Kubernetes, it is approximately </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5,000 nodes, 150 thousand pods and 300 thousand containers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, in real life, problems can begin much earlier - for example, at only </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500 nodes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fact is that large clusters exert a high load on the Kubernetes control layer. In other words, in order to keep the cluster operational and efficiently use resources, careful tuning is required.</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This issue is explored in a related article in the original blog entitled ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecting Kubernetes clusters - choosing a worker node size</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù. </font></font></i><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But let's look at the opposite approach: many small clusters.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Many small, specialized clusters</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With this approach, you use a separate cluster for each deployed element: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g7/yo/qg/g7yoqg0kgb_f7vlpitxwitds32q.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many small clusters</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
For the purposes of this article, a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deployed element</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> refers to an instance of an application ‚Äî for example, the dev version of a separate application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This strategy uses Kubernetes as a specialized </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">runtime</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for individual application instances. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at the pros and cons of this approach.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Limited "blast radius"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When a cluster breaks down, the negative consequences are limited only to those workloads that were deployed in this cluster. </font><font style="vertical-align: inherit;">All other workloads remain intact.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Insulation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Workloads hosted on individual clusters do not share resources such as processor, memory, operating system, network, or other services. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we get a tight isolation between unrelated applications, which may favorably affect their security.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Small number of users</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Given that each cluster contains only a limited set of workloads, the number of users with access to it is reduced. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fewer people have access to the cluster, the lower the risk that something will ‚Äúbreak‚Äù. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at the cons.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Inefficient use of resources</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As mentioned earlier, each Kubernetes cluster requires a certain set of control resources: master nodes, control layer components, and solutions for monitoring and logging. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of a large number of small clusters, it is necessary to allocate a larger share of resources for management.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- High cost</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inefficient use of resources automatically entails high costs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, the maintenance of 30 master nodes instead of three with the same computing power will necessarily affect the costs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Administration difficulties</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Managing multiple Kubernetes clusters is much more difficult than managing one. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, you will have to configure authentication and authorization for each cluster. </font><font style="vertical-align: inherit;">Updating the Kubernetes version will also have to be done several times. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most likely, you will have to apply automation to increase the effectiveness of all these tasks. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now consider less extreme scenarios.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. One cluster per application</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As part of this approach, you create a separate cluster for all instances of a specific application: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/ad/in/ezadindhrerehwyqlgpgw3reukg.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster per application</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This way can be considered as a generalization of the principle of ‚Äú </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separate cluster per team</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù, since usually a team of engineers is engaged in the development of one or more applications. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at the pros and cons of this approach.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Cluster can be customized for the application</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the application has special needs, they can be implemented in a cluster without affecting other clusters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Such needs may include GPU workers, specific CNI plugins, service mesh, or some other service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each cluster can be tailored to the application running in it so that it contains only what is needed.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Different environments in one cluster</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The disadvantage of this approach is that application instances from different environments coexist in the same cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, the prod version of the application runs in the same cluster as the dev version. </font><font style="vertical-align: inherit;">It also means that developers conduct their activities in the same cluster in which the production version of the application is operated. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If, due to the actions of developers or glitches of the dev version in the cluster, a failure occurs, then the prod version can potentially suffer - a huge drawback of this approach. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And finally, the last script on our list.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. One cluster for each environment</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This scenario provides for the allocation of a separate cluster for each environment: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m_/pk/t7/m_pkt7oe54m46rxlmhomubzl-pi.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One cluster for the environment</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
For example, you can have </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clusters </font><font style="vertical-align: inherit;">in which you will run all application instances designed for a specific environment. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here are the pros and cons of this approach.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Isolation of prod environment</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this approach, all environments are isolated from each other. </font><font style="vertical-align: inherit;">However, in practice, this is especially important for the prod environment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Production versions of the application are now independent of what is happening in other clusters and environments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, if a problem suddenly arises in the dev cluster, the prod versions of the applications will continue to work as if nothing had happened.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Cluster can be adjusted to the environment</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each cluster can be tailored to its environment. </font><font style="vertical-align: inherit;">For example, you can:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> install development and debugging tools in the dev cluster;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install test frameworks and tools in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cluster </font><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use more powerful equipment and network channels in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prod</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cluster </font><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This improves the efficiency of both the development and operation of applications.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ Restrict access to the production cluster</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The need to work with a prod cluster directly arises infrequently, so that you can significantly limit the circle of people who have access to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can go even further and generally deprive people of access to this cluster, and perform all deployments using the automated CI / CD tool. </font><font style="vertical-align: inherit;">Such an approach will minimize the risk of human error exactly where it is most relevant. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now a few words about the cons.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Lack of isolation between applications</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main drawback of the approach is the lack of hardware and resource isolation between applications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unrelated applications share cluster resources: the system core, processor, memory, and some other services. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As already mentioned, this can be potentially dangerous.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Inability to localize application dependencies</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the application has special requirements, then they must be satisfied in all clusters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, if an application needs a GPU, then each cluster must contain at least one worker with a GPU (even if it is used only by that application). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we run the risk of higher costs and inefficient use of resources.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have a specific set of applications, you can place them in several large clusters or in many small ones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The article discusses the pros and cons of various approaches, ranging from one global cluster to several small and highly specialized ones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> one large common cluster;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> many small highly specialized clusters;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> one cluster for each application;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> one cluster for each environment.</font></font></li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, which approach to choose? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As usual, the answer depends on the use case: you need to weigh the pros and cons of different approaches and choose the most optimal option. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the choice is not limited to the above examples - you can use any combination of them! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, you can organize a couple of clusters per team: a cluster for development (which will have </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> environments </font><font style="vertical-align: inherit;">) and a cluster for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">production</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (where the production environment will be located). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the information in this article, you can optimize the pros and cons accordingly for a specific scenario. </font><font style="vertical-align: inherit;">Good luck</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Read also in our blog:</font></font><br>
<br>
<ul>
<li> ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">      Kubernetes</a>¬ª;</li>
<li> ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  Kubernetes (  ) :   </a>¬ª;</li>
<li> ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Service Mesh:     Software Engineer    </a>¬ª;</li>
<li> ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">   Kubernetes: , , </a>¬ª.</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498088/index.html">How Avito Researchers Work</a></li>
<li><a href="../en498090/index.html">Sand dunes can "communicate" with each other</a></li>
<li><a href="../en498092/index.html">An alternative method for classifying the ‚Äúgender‚Äù field of a Russian passport using a neural network</a></li>
<li><a href="../en498094/index.html">How we transferred all internal communications in the company to online</a></li>
<li><a href="../en498096/index.html">How a Memories demo fits in 256 bytes</a></li>
<li><a href="../en498104/index.html">How sites are developed from $ 100,000</a></li>
<li><a href="../en498110/index.html">‚ÄúWhat to do when dramatic changes in processes demotivate a team.‚Äù The experience of the backend engineer who became a team leader</a></li>
<li><a href="../en498114/index.html">One pixel attack. Or how to trick a neural network</a></li>
<li><a href="../en498118/index.html">Conferences on the remote: online transformation of the JUG Ru Group</a></li>
<li><a href="../en498120/index.html">Build Time Optimization - Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>