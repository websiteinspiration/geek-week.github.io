<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛁 ↙️ 🍗 Macam apa beban di server membuat mekanisme jaringan? 💕 👶🏾 🍐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat menganalisis operasi subsistem jaringan server, perhatian biasanya diberikan pada indikator seperti latensi, throughput sistem, dan jumlah paket ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Macam apa beban di server membuat mekanisme jaringan?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/503636/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat menganalisis operasi subsistem jaringan server, perhatian biasanya diberikan pada indikator seperti latensi, throughput sistem, dan jumlah paket yang dapat diproses per detik (PPS, Paket Per Detik). Indikator-indikator ini digunakan untuk memahami dalam beban maksimum apa komputer dapat bekerja. Dan meskipun metrik ini penting dan sering dapat mengatakan banyak tentang sistem, mereka tidak memberikan informasi tentang dampak pemrosesan paket jaringan pada program yang berjalan di server. </font><font style="vertical-align: inherit;">
Materi ini bertujuan untuk mempelajari beban yang dibuat oleh mekanisme jaringan di server. Secara khusus, kita akan berbicara tentang berapa banyak waktu prosesor solusi untuk masalah jaringan dapat "mencuri" dari berbagai proses yang berjalan pada sistem Linux.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/q_/0y/ya/q_0yyareydlakrio4dbunpbt8fu.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemrosesan paket jaringan di Linux</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linux memproses sejumlah besar paket dalam konteks proses apa pun yang dijalankan oleh prosesor pada saat memproses IRQ yang sesuai. </font><font style="vertical-align: inherit;">Mesin Sistem Akuntansi akan menetapkan siklus prosesor yang digunakan untuk ini untuk setiap proses yang sedang dijalankan. </font><font style="vertical-align: inherit;">Ini akan dilakukan bahkan jika proses ini tidak ada hubungannya dengan pemrosesan paket jaringan. </font><font style="vertical-align: inherit;">Misalnya, sebuah perintah </font></font><code>top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dapat mengindikasikan bahwa suatu proses tampaknya menggunakan lebih dari 99% sumber daya prosesor, tetapi pada kenyataannya 60% dari waktu prosesor akan dihabiskan untuk memproses paket-paket. </font><font style="vertical-align: inherit;">Dan ini berarti bahwa proses itu sendiri, menyelesaikan masalahnya sendiri, hanya menggunakan 40% dari sumber daya CPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penangan Masuk</font></font><code>net_rx_action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biasanya dilakukan dengan sangat, sangat cepat. Misalnya, dalam waktu kurang dari 25 μs. (Data ini diperoleh dari pengukuran menggunakan eBPF. Jika Anda tertarik dengan detailnya, lihat di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a> <code>net_rx_action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .) Prosesor dapat memproses hingga 64 paket per instance NAPI (NIC atau RPS) sebelum menunda tugas ke siklus SoftIRQ lain. Satu demi satu, tanpa istirahat, hingga 10 siklus SoftIRQ dapat mengikuti, yang memakan waktu sekitar 2 ms (Anda dapat mengetahui lebih lanjut tentang ini dengan membaca tentang </font></font><code>__do_softirq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Jika vektor SoftIRQ, setelah jumlah maksimum siklus telah berlalu, atau waktu telah berlalu, masih memiliki masalah yang belum terpecahkan, maka solusi dari masalah ini tertunda untuk dieksekusi di utas.</font></font><code>ksoftirqd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU spesifik. </font><font style="vertical-align: inherit;">Ketika ini terjadi, sistem ternyata menjadi sedikit lebih transparan dalam arti memperoleh informasi tentang beban prosesor yang dibuat oleh operasi jaringan (meskipun analisis seperti itu dilakukan dengan asumsi bahwa SoftIRQ yang dipelajari, yang terkait dengan pemrosesan paket, dan bukan pada hal lain) . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu cara untuk mendapatkan indikator di atas adalah dengan menggunakan </font></font><code>perf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo perf record -a \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-e irq:irq_handler_entry,irq:irq_handler_exit<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-e irq:softirq_entry --filter="vec == 3" \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-e irq:softirq_exit --filter="vec == 3"&nbsp; \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-e napi:napi_poll \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- sleep 1<font></font>
<font></font>
sudo perf script<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah hasilnya:</font></font><br>
<br>
<pre><code class="plaintext hljs">swapper &nbsp; &nbsp; 0 [005] 176146.491879: irq:irq_handler_entry: irq=152 name=mlx5_comp2@pci:0000:d8:00.0<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.491880:&nbsp; irq:irq_handler_exit: irq=152 ret=handled<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.491880: &nbsp; &nbsp; irq:softirq_entry: vec=3 [action=NET_RX]<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.491942:&nbsp; &nbsp; &nbsp; &nbsp; napi:napi_poll: napi poll on napi struct 0xffff9d3d53863e88 for device eth0 work 64 budget 64<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.491943:&nbsp; &nbsp; &nbsp; irq:softirq_exit: vec=3 [action=NET_RX]<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.491943: &nbsp; &nbsp; irq:softirq_entry: vec=3 [action=NET_RX]<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.491971:&nbsp; &nbsp; &nbsp; &nbsp; napi:napi_poll: napi poll on napi struct 0xffff9d3d53863e88 for device eth0 work 27 budget 64<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.491971:&nbsp; &nbsp; &nbsp; irq:softirq_exit: vec=3 [action=NET_RX]<font></font>
swapper &nbsp; &nbsp; 0 [005] 176146.492200: irq:irq_handler_entry: irq=152 name=mlx5_comp2@pci:0000:d8:00.0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, prosesor idle (maka tampilan entri </font></font><code>swapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk proses), IRQ dipanggil untuk antrian Rx pada CPU 5, pemrosesan SoftIRQ disebut dua kali, 64 paket diproses terlebih dahulu, kemudian 27. IRQ berikutnya dipanggil setelah 229 μs dan memulai siklus lagi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data ini diperoleh pada sistem siaga. Tetapi pada prosesor, tugas apa pun dapat dilakukan. Dalam hal ini, urutan peristiwa di atas terjadi, mengganggu tugas ini dan melakukan tugas IRQ / SoftIRQ. Pada saat yang sama, Sistem Akuntansi mengacu pada proses yang terganggu beban yang dibuat oleh prosesor. Akibatnya, tugas pemrosesan paket jaringan biasanya disembunyikan dari alat pemantau beban prosesor konvensional. Mereka dieksekusi dalam konteks beberapa proses yang dipilih secara acak, dalam konteks "proses korban". Ini membawa kita pada beberapa pertanyaan. Bagaimana memperkirakan waktu proses terputus untuk pemrosesan paket? Bagaimana membandingkan 2 solusi jaringan yang berbeda untuk memahami mana di antara mereka yang memiliki efek lebih rendah pada berbagai tugas yang diselesaikan pada komputer?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menggunakan mekanisme RSS, RPS, RFS, pemrosesan paket biasanya didistribusikan di antara inti prosesor. </font><font style="vertical-align: inherit;">Oleh karena itu, urutan pemrosesan paket di atas terkait dengan setiap CPU tertentu. </font><font style="vertical-align: inherit;">Ketika tingkat kedatangan paket meningkat (saya pikir kita dapat berbicara tentang kecepatan 100.000 paket per detik dan lebih tinggi), setiap CPU harus memproses ribuan atau puluhan ribu paket per detik. </font><font style="vertical-align: inherit;">Memproses begitu banyak paket pasti akan memengaruhi tugas-tugas lain yang dilakukan di server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan satu cara untuk mengevaluasi efek ini.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menonaktifkan Pemrosesan Paket Terdistribusi</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memulai, mari kita hentikan pemrosesan paket yang didistribusikan dengan menonaktifkan RPS dan menyiapkan aturan kontrol aliran yang bertujuan mengatur pemrosesan semua paket yang terkait dengan alamat MAC tertentu pada CPU yang hanya diketahui oleh kita. </font><font style="vertical-align: inherit;">Sistem saya memiliki 2 NIC yang terkumpul dalam konfigurasi 802.3ad. </font><font style="vertical-align: inherit;">Tugas jaringan ditugaskan ke mesin virtual tunggal yang berjalan di komputer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPS pada adaptor jaringan dinonaktifkan sebagai berikut:</font></font><br>
<br>
<pre><code class="plaintext hljs">for d in eth0 eth1; do<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;find /sys/class/net/${d}/queues -name rps_cpus |<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;while read f; do<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 0 | sudo tee ${f}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;done<font></font>
done<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kami menyiapkan aturan kontrol aliran untuk memastikan bahwa paket masuk ke mesin virtual uji menggunakan CPU tunggal:</font></font><br>
<br>
<pre><code class="plaintext hljs">DMAC=12:34:de:ad:ca:fe<font></font>
sudo ethtool -N eth0 flow-type ether dst ${DMAC} action 2<font></font>
sudo ethtool -N eth1 flow-type ether dst ${DMAC} action 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menonaktifkan RPS dan menggunakan aturan kontrol aliran memungkinkan kami untuk memastikan bahwa semua paket yang ditujukan untuk mesin virtual kami diproses pada CPU yang sama. </font><font style="vertical-align: inherit;">Untuk memastikan bahwa paket-paket dikirim ke antrian di mana mereka harus dikirim, Anda dapat menggunakan perintah seperti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ethq</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kemudian Anda dapat mengetahui CPU mana yang dimiliki oleh antrian ini </font></font><code>/proc/interrupts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dalam kasus saya, giliran 2 diproses melalui CPU 5.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perintah kecepatan openssl</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya bisa menggunakan utilitas </font></font><code>perf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font><font style="vertical-align: inherit;">untuk menganalisis runtime SoftIRQ yang bertanggung jawab untuk memproses lalu lintas masuk </font></font><code>bpf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tetapi pendekatan ini cukup rumit. Selain itu, proses observasi itu sendiri pasti mempengaruhi hasil. Solusi yang jauh lebih sederhana dan lebih mudah dipahami adalah mengidentifikasi beban yang dibuat oleh operasi jaringan pada sistem menggunakan beberapa tugas, yang menciptakan beban yang diketahui pada sistem. Sebagai contoh, ini adalah perintah yang </font></font><code>openssl speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digunakan untuk menguji kinerja OpenSSL. Ini akan memungkinkan Anda untuk mengetahui berapa banyak sumber daya prosesor yang didapat oleh program, dan membandingkannya dengan jumlah sumber daya yang seharusnya diterima (ini akan membantu untuk mengetahui berapa banyak sumber daya yang dihabiskan untuk tugas-tugas jaringan).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tim ini </font></font><code>openssl speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hampir 100% tim ruang pengguna. Jika Anda mengikatnya ke CPU tertentu, maka itu, selama pelaksanaan tes, menggunakan semua sumber daya yang tersedia. Tim bekerja dengan mengatur timer ke interval yang ditentukan (di sini, misalnya, untuk membuat perhitungan lebih mudah, dibutuhkan 10 detik), menjalankan tes, dan kemudian, ketika timer dipicu, menggunakannya </font></font><code>times</code><code>()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mencari tahu berapa banyak waktu prosesor yang sebenarnya didapat oleh program. Dari sudut pandang </font></font><code>syscall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terlihat seperti ini:</font></font><br>
<br>
<pre><code class="plaintext hljs">alarm(10) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 0<font></font>
times({tms_utime=0, tms_stime=0, tms_cutime=0, tms_cstime=0}) = 1726601344<font></font>
--- SIGALRM {si_signo=SIGALRM, si_code=SI_KERNEL} ---<font></font>
rt_sigaction(SIGALRM, ...) = 0<font></font>
rt_sigreturn({mask=[]}) = 2782545353<font></font>
times({tms_utime=1000, tms_stime=0, tms_cutime=0, tms_cstime=0}) = 1726602344<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, ternyata </font></font><code>alarm()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sangat sedikit panggilan sistem yang dibuat </font><font style="vertical-align: inherit;">antara menelepon </font><font style="vertical-align: inherit;">dan memeriksa hasilnya. Jika program tidak terganggu, atau terganggu sangat jarang, waktu </font></font><code>tms_utime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan bertepatan dengan waktu pengujian (dalam hal ini, 10 detik). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena ini adalah tes yang dilakukan secara eksklusif di ruang pengguna, setiap waktu sistem yang muncul </font></font><code>times()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan berarti beberapa beban tambahan pada sistem. Ternyata meskipun </font></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini adalah proses yang berjalan pada CPU, CPU itu sendiri mungkin sibuk dengan hal lain. Misalnya, memproses paket jaringan:</font></font><br>
<br>
<pre><code class="plaintext hljs">alarm(10) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 0<font></font>
times({tms_utime=0, tms_stime=0, tms_cutime=0, tms_cstime=0}) = 1726617896<font></font>
--- SIGALRM {si_signo=SIGALRM, si_code=SI_KERNEL} ---<font></font>
rt_sigaction(SIGALRM, ...) = 0<font></font>
rt_sigreturn({mask=[]}) = 4079301579<font></font>
times({tms_utime=178, tms_stime=571, tms_cutime=0, tms_cstime=0}) = 1726618896<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda dapat melihat bahwa ada </font></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemungkinan untuk bekerja pada prosesor selama 7,49 detik (178 + 571 dalam satuan pengukuran yang sesuai dengan 0,01 detik.). </font><font style="vertical-align: inherit;">Tetapi pada saat yang sama 5,71 s. </font><font style="vertical-align: inherit;">Interval ini diwakili oleh waktu sistem. </font><font style="vertical-align: inherit;">Karena dia </font></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak sibuk dengan bisnis apa pun di ruang kernel, ini berarti 5.71 dtk. </font><font style="vertical-align: inherit;">- Ini adalah hasil dari beberapa beban tambahan pada sistem. </font><font style="vertical-align: inherit;">Artinya, inilah saatnya proses itu "dicuri" untuk memenuhi kebutuhan sistem.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan perintah kecepatan openssl untuk mendeteksi beban sistem yang disebabkan oleh mekanisme jaringan</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang setelah kami mengetahui cara kerja tim </font></font><code>openssl speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, kami akan melihat hasil yang dihasilkannya pada server yang tidak aktif:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ taskset -c 5 openssl speed -seconds 10 aes-256-cbc &gt;/dev/null<font></font>
Doing aes-256 cbc for 10s on 16 size blocks: 66675623 aes-256 cbc's in 9.99s<font></font>
Doing aes-256 cbc for 10s on 64 size blocks: 18096647 aes-256 cbc's in 10.00s<font></font>
Doing aes-256 cbc for 10s on 256 size blocks: 4607752 aes-256 cbc's in 10.00s<font></font>
Doing aes-256 cbc for 10s on 1024 size blocks: 1162429 aes-256 cbc's in 10.00s<font></font>
Doing aes-256 cbc for 10s on 8192 size blocks: 145251 aes-256 cbc's in 10.00s<font></font>
Doing aes-256 cbc for 10s on 16384 size blocks: 72831 aes-256 cbc's in 10.00s<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, kami diberitahu bahwa program menghabiskan 9,99 hingga 10 detik untuk memproses blok dengan ukuran berbeda. Ini menegaskan bahwa mekanisme sistem tidak mengambil waktu prosesor dari program. Sekarang, menggunakan </font></font><code>netperf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, kami akan memuat server dengan memproses paket yang berasal dari dua sumber. Jalankan tes lagi:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ taskset -c 5 openssl speed -seconds 10 aes-256-cbc &gt;/dev/null<font></font>
Doing aes-256 cbc for 10s on 16 size blocks: 12061658 aes-256 cbc's in 1.96s<font></font>
Doing aes-256 cbc for 10s on 64 size blocks: 3457491 aes-256 cbc's in 2.10s<font></font>
Doing aes-256 cbc for 10s on 256 size blocks: 893939 aes-256 cbc's in 2.01s<font></font>
Doing aes-256 cbc for 10s on 1024 size blocks: 201756 aes-256 cbc's in 1.86s<font></font>
Doing aes-256 cbc for 10s on 8192 size blocks: 25117 aes-256 cbc's in 1.78s<font></font>
Doing aes-256 cbc for 10s on 16384 size blocks: 13859 aes-256 cbc's in 1.89s<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya sangat berbeda dari yang diperoleh di server idle. Diharapkan bahwa masing-masing pengujian akan dieksekusi dalam 10 detik, tetapi </font></font><code>times()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melaporkan bahwa waktu eksekusi sesungguhnya adalah dari 1,78 menjadi 2,1 detik. Ini berarti bahwa sisa waktu, bervariasi dari 7,9 hingga 8,22 detik, dihabiskan untuk memproses paket, baik dalam konteks proses </font></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau dalam </font></font><code>ksoftirqd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat apa yang akan diberikan tim </font></font><code>top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saat menganalisis peluncuran yang baru saja selesai </font></font><code>openssl speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">PID USER&nbsp; &nbsp; &nbsp; PR&nbsp; NI&nbsp; &nbsp; VIRT&nbsp; &nbsp; RES&nbsp; &nbsp; SHR S&nbsp; %CPU %MEM &nbsp; &nbsp; TIME+ COMMAND&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P&nbsp;<font></font>
&nbsp;8180 libvirt+&nbsp; 20 &nbsp; 0 33.269g 1.649g 1.565g S 279.9&nbsp; 0.9&nbsp; 18:57.81 qemu-system-x86 &nbsp; &nbsp; 75<font></font>
&nbsp;8374 root&nbsp; &nbsp; &nbsp; 20 &nbsp; 0 &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 R&nbsp; 99.4&nbsp; 0.0 &nbsp; 2:57.97 vhost-8180&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 89<font></font>
&nbsp;1684 dahern&nbsp; &nbsp; 20 &nbsp; 0 &nbsp; 17112 &nbsp; 4400 &nbsp; 3892 R&nbsp; 73.6&nbsp; 0.0 &nbsp; 0:09.91 openssl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;38 root&nbsp; &nbsp; &nbsp; 20 &nbsp; 0 &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 R&nbsp; 26.2&nbsp; 0.0 &nbsp; 0:31.86 ksoftirqd/5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda mungkin berpikir bahwa ia </font></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan sekitar 73% dari sumber daya CPU 5, dan </font></font><code>ksoftirqd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sumber daya yang tersisa diperoleh. </font><font style="vertical-align: inherit;">Namun pada kenyataannya, dalam konteksnya </font></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pemrosesan sejumlah besar paket dilakukan sehingga program itu sendiri hanya membutuhkan waktu 18-21% dari waktu prosesor untuk menyelesaikan masalahnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda mengurangi beban jaringan menjadi 1 stream, Anda merasa bahwa </font></font><code>openssl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99% sumber daya sistem dikonsumsi.</font></font><br>
<br>
<pre><code class="plaintext hljs">&nbsp;&nbsp;PID USER&nbsp; &nbsp; &nbsp; PR&nbsp; NI&nbsp; &nbsp; VIRT&nbsp; &nbsp; RES&nbsp; &nbsp; SHR S&nbsp; %CPU %MEM &nbsp; &nbsp; TIME+ COMMAND&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P<font></font>
&nbsp;8180 libvirt+&nbsp; 20 &nbsp; 0 33.269g 1.722g 1.637g S 325.1&nbsp; 0.9 166:38.12 qemu-system-x86 &nbsp; &nbsp; 29<font></font>
44218 dahern&nbsp; &nbsp; 20 &nbsp; 0 &nbsp; 17112 &nbsp; 4488 &nbsp; 3996 R&nbsp; 99.2&nbsp; 0.0 &nbsp; 0:28.55 openssl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5<font></font>
&nbsp;8374 root&nbsp; &nbsp; &nbsp; 20 &nbsp; 0 &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 R&nbsp; 64.7&nbsp; 0.0&nbsp; 60:40.50 vhost-8180&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 55<font></font>
&nbsp;&nbsp;&nbsp;38 root&nbsp; &nbsp; &nbsp; 20 &nbsp; 0 &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 S &nbsp; 1.0&nbsp; 0.0 &nbsp; 4:51.98 ksoftirqd/5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun pada kenyataannya ternyata program yang berjalan di ruang pengguna mendapatkan, dari yang diharapkan 10 detik, hanya sekitar 4 detik:</font></font><br>
<br>
<pre><code class="plaintext hljs">Doing aes-256 cbc for 10s on 16 size blocks: 26596388 aes-256 cbc's in 4.01s<font></font>
Doing aes-256 cbc for 10s on 64 size blocks: 7137481 aes-256 cbc's in 4.14s<font></font>
Doing aes-256 cbc for 10s on 256 size blocks: 1844565 aes-256 cbc's in 4.31s<font></font>
Doing aes-256 cbc for 10s on 1024 size blocks: 472687 aes-256 cbc's in 4.28s<font></font>
Doing aes-256 cbc for 10s on 8192 size blocks: 59001 aes-256 cbc's in 4.46s<font></font>
Doing aes-256 cbc for 10s on 16384 size blocks: 28569 aes-256 cbc's in 4.16s<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alat pemantauan proses konvensional menunjukkan bahwa program ini menggunakan hampir semua sumber daya prosesor, tetapi pada kenyataannya ternyata 55-80% dari sumber daya CPU dihabiskan untuk memproses paket jaringan. </font><font style="vertical-align: inherit;">Throughput sistem pada saat yang sama tampak hebat (lebih dari 22 Gb / s per 25 Gb / s baris), tetapi ini memiliki dampak yang luar biasa pada proses yang berjalan dalam sistem ini.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ringkasan</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kami memeriksa contoh bagaimana mekanisme pemrosesan paket "mencuri" jam prosesor dari patokan sederhana dan tidak terlalu penting. </font><font style="vertical-align: inherit;">Tetapi pada server nyata, proses yang terpengaruh sama bisa apa saja. </font><font style="vertical-align: inherit;">Ini bisa berupa prosesor virtual, utas emulator, utas vhost dari mesin virtual. </font><font style="vertical-align: inherit;">Ini dapat berupa proses sistem yang berbeda, dampak yang dapat memiliki dampak berbeda pada kinerja proses ini dan keseluruhan sistem. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah Anda mempertimbangkan, menganalisis server Anda, dampak pada kinerja aktual dari beban yang terkait dengan operasi jaringan?</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id503624/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 416 (18-24 Mei, 2020)</a></li>
<li><a href="../id503626/index.html">Pengujian. Kesalahan sertifikasi ISTQB atau memecahkan sejuta contoh</a></li>
<li><a href="../id503630/index.html">Kacamata augmented reality: di mana kita sekarang?</a></li>
<li><a href="../id503632/index.html">1000 dan 1 posting: selamat ulang tahun, Habr ❤</a></li>
<li><a href="../id503634/index.html">5 penemuan JavaScript menarik dibuat dalam kode sumber Vue</a></li>
<li><a href="../id503638/index.html">6 kebiasaan yang bermanfaat, yang mengejutkan, hanya beberapa programmer</a></li>
<li><a href="../id503642/index.html">Cara mendapatkan di LinkedIn, Facebook, Google di Silicon Valley</a></li>
<li><a href="../id503650/index.html">VKCup 2020 Stage I. A Long Way</a></li>
<li><a href="../id503652/index.html">Acara digital di Moskow dari 25 Mei hingga 31 Mei</a></li>
<li><a href="../id503654/index.html">Layanan web yang memungkinkan pengguna untuk secara mandiri memelihara budaya komunikasi online</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>