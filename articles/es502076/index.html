<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüëß üë®üèº‚Äçüéì üêô Trolley Robot 2.0. Parte 1. Navegaci√≥n aut√≥noma de un robot dom√©stico basado en ROS üêö üèïÔ∏è üë¶üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El proyecto fue construido sobre la base de otro proyecto bien conocido en sus c√≠rculos: linorobot (linorobot.org), utilizando componentes disponibles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Trolley Robot 2.0. Parte 1. Navegaci√≥n aut√≥noma de un robot dom√©stico basado en ROS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502076/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proyecto fue construido sobre la base de otro proyecto bien conocido en sus c√≠rculos: linorobot (linorobot.org), utilizando componentes disponibles para un simple laico. </font><font style="vertical-align: inherit;">Los objetivos que se establecieron: lograr el movimiento aut√≥nomo del robot en casa utilizando componentes de bajo costo, evaluar el rendimiento de las mini PC para los fines establecidos, configurar la pila de navegaci√≥n para moverse en los espacios estrechos del Khrushchev.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OGxB34-heds" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hierro</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La lista de componentes en los s√≥lidos es la siguiente:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frambuesa pi 3b - 2800 r .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lidar rplidar a1 - 7500 p .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puentes de energ√≠a l298n -2pcs - 400 rub.;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juego de ruedas con codificadores de tipo A y B - 2000 r. </font><font style="vertical-align: inherit;">(210 rpm - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teenzy 3.2 - 2100 r.;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imu 9250 (9150 o 6050) - 240 p .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banco de potencia a 10000mH - 1500 r.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 bater√≠as 18650 y soporte -600 p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convertidor reductor dc-dc c 5V a 3.3V - 20p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una pieza de madera contrachapada, parquet -? </font><font style="vertical-align: inherit;">frotar.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total: 17160 p. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* El costo puede reducirse reemplazando teenzy con arduino mega 2560 (600 p.), Y lidar reemplazando kinect v.1 (1000 p.): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/vb/v4/ecvbv42ipnldzd5vhureodavsqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, debe tenerse en cuenta que el primer kinect tiene una visibilidad m√≠nima (√°rea ciega) de 0.5 m, que puede afectar negativamente la navegaci√≥n en condiciones de hacinamiento y es bastante voluminoso. </font><font style="vertical-align: inherit;">El lidar tiene una zona ciega de menos de 0.2 m. Kinect v.2 no se ajusta a raspberry 3b (no tiene usb 3.0). </font><font style="vertical-align: inherit;">Arduino mega es inferior al tama√±o de teenzy (y algunas caracter√≠sticas), adem√°s, tendr√° que modificar ligeramente el c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, el "dise√±o" se ve as√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ou/ru/x9/ourux9icibrxsh4ruai61e3wkx4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yg/bh/0h/ygbh0hlvz8juq6qi4e9tarrhznq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
no hay belleza aqu√≠, por supuesto, pero no se trata de eso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s del robot en s√≠, es altamente deseable tener una PC externa en la cual se lanzar√°n proyectiles gr√°ficos para visualizar las acciones del robot (rviz, gazebo).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensamblaje de robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√° pintado en detalle en el sitio web del proyecto, un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as√≠ que analicemos los puntos que causan dificultades. </font><font style="vertical-align: inherit;">Primero, debe tener en cuenta que los codificadores del juego de ruedas funcionan con 3.3V y, cuando se aplica 5V, fallan perfectamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script de instalaci√≥n de linorobot se instal√≥ con √©xito en ubuntu 16.04, ubuntu 18.04. </font><font style="vertical-align: inherit;">Versiones ROS: ROS cin√©ticas o ROS mel√≥dicas. </font><font style="vertical-align: inherit;">En raspberry 3b, primero debe crear un archivo de intercambio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo principal de teenzy est√° en el camino:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware/lib/config<font></font>
nano lino_base_config.h<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y vierte en √©l con el comando:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware<font></font>
platformio run --target upload<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los paquetes de comandos anteriores se usar√°n con bastante frecuencia, por lo que tiene sentido agregarlos a los alias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a las dificultades para ensamblar el robot, la correlaci√≥n correcta de los contactos conectados que van de l298n a teenzy puede ser problem√°tica. </font><font style="vertical-align: inherit;">A pesar del diagrama de conexi√≥n extremadamente claro, las ruedas pueden comportarse de manera diferente y tener que experimentar, eligiendo la asignaci√≥n de pin correcta en el c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi caso, result√≥ as√≠:</font></font><br>
<br>
<pre><code class="bash hljs">/// ENCODER PINS
<span class="hljs-comment">#define MOTOR1_ENCODER_A 14</span>
<span class="hljs-comment">#define MOTOR1_ENCODER_B 15 </span><font></font>
<font></font>
<span class="hljs-comment">#define MOTOR2_ENCODER_A 11</span>
<span class="hljs-comment">#define MOTOR2_ENCODER_B 12 </span><font></font>
//MOTOR PINS<font></font>
<span class="hljs-comment">#ifdef USE_L298_DRIVER</span>
  <span class="hljs-comment">#define MOTOR_DRIVER L298</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR1_PWM 21</span>
  <span class="hljs-comment">#define MOTOR1_IN_A 1</span>
  <span class="hljs-comment">#define MOTOR1_IN_B 20</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR2_PWM 5</span>
  <span class="hljs-comment">#define MOTOR2_IN_A 8</span>
  <span class="hljs-comment">#define MOTOR2_IN_B 6</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo punto es prescribir la especificaci√≥n de las ruedas del robot:</font></font><br>
<br>
<pre><code class="bash hljs">//define your robot<span class="hljs-string">' specs here
#define MAX_RPM 210               // motor'</span>s maximum RPM
<span class="hljs-comment">#define COUNTS_PER_REV 1365       // wheel encoder's no of ticks per rev</span>
<span class="hljs-comment">#define WHEEL_DIAMETER 0.065       // wheel's diameter in meters</span>
<span class="hljs-comment">#define PWM_BITS 8                // PWM Resolution of the microcontroller</span>
<span class="hljs-comment">#define LR_WHEELS_DISTANCE 0.235  // distance between left and right wheels</span>
<span class="hljs-comment">#define FR_WHEELS_DISTANCE 0.30   // distance between front and rear wheels. Ignore this if you're on 2WD/ACKERMANN</span>
<span class="hljs-comment">#define MAX_STEERING_ANGLE 0.415  // max steering angle. This only applies to Ackermann st</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las RPM se pueden encontrar en la especificaci√≥n de la rueda, pero el valor calculado es CPR (COUNTS_PER_REV). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPR = PPR x 4. PPR de nuestras ruedas 341. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* PPR se puede ver en la especificaci√≥n o ejecutar el c√≥digo en el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">robot roslaunch linorobot minimal.launch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y girar la rueda 360 grados. PPR ser√° igual al valor num√©rico que se mostrar√° en la pantalla despu√©s de la rotaci√≥n de la rueda: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/7z/ks/be7zksecqhlyuyv-e_dkxqdyrwe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* PPR = abs (RECENT_COUNT - INITIAL_COUNT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces CPR = 1364. Tambi√©n necesita establecer WHEEL_DIAMETER y LR_WHEELS_DISTANCE en metros. Adem√°s, LR_WHEELS_DISTANCE es la distancia entre los ejes centrales de las ruedas, y no de borde a borde. Se pueden ignorar otros indicadores si el robot es de dos ruedas, diferencial (no omnidireccional). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tercer punto que puede causar dificultades: la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calibraci√≥n de la IMU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para hacer esto, siguiendo las instrucciones, es necesario fijar el robot en ciertas posiciones. Las sugerencias estar√°n en el c√≥digo cuando se </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejecute el script rosrun imu_calib do_calib</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : una </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/fj/9e/ggfj9eg71ilp0baj7rvshjl-fmw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vez completado, se generar√° imu_calib.yaml con la configuraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es mejor realizar la calibraci√≥n, a pesar del hecho de que hay un archivo predeterminado con la configuraci√≥n de imu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Adem√°s, result√≥ que la calibraci√≥n de imu puede afectar la direcci√≥n del movimiento del robot a trav√©s de teleop (izquierda en lugar de derecha y viceversa, mientras que el movimiento de ida y vuelta fue correcto). La situaci√≥n no se resolvi√≥ mediante la reorganizaci√≥n de los pines en el c√≥digo. Imu en s√≠ fue reparado y calibrado con soportes invertidos, como fijado en la parte posterior de la base del robot. Su (imu) cambio adicional sin recalibraci√≥n resolvi√≥ el problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuarto punto: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calibraci√≥n pid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el sitio web del proyecto, el procedimiento sobre c√≥mo implementar el ajuste se describe en detalle: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, ser√° dif√≠cil para un principiante descubrir qu√© es y c√≥mo trabajar con √©l. </font><font style="vertical-align: inherit;">En general, se necesita una regulaci√≥n pid para garantizar que el robot se mueva uniformemente, sin sacudidas / frenado repentino. </font><font style="vertical-align: inherit;">Tres par√°metros son responsables de esto: p, i, d. </font><font style="vertical-align: inherit;">Sus valores est√°n contenidos en el c√≥digo principal cargado a teenzy:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define K_P 2.0 // P constant angle</span>
<span class="hljs-comment">#define K_I 0.3 // I constant</span>
<span class="hljs-comment">#define K_D 0.1 // D constant</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedes experimentar con ellos corriendo en el robot:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot minimal.launch
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s en la PC externa en tres terminales diferentes:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun lino_pid pid_configure<font></font>
rosrun teleop_twist_keyboard teleop_twist_keyboard.py<font></font>
rqt<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mover los controles deslizantes p, d, i en el terminal rqt y luego controlar el robot en el terminal teleop_twist_keyboard, puede lograr los resultados necesarios sin tener que descargar el c√≥digo con los nuevos par√°metros pid cada vez en teenzy: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/9m/ef/qr9mefipf7mqz9vwqqyqkktkeug.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
es decir, todo sucede sobre la marcha y en ese momento en el firmware Teenzy puede tener significados completamente diferentes. </font><font style="vertical-align: inherit;">* No puedes concentrarte en los gr√°ficos, porque </font><font style="vertical-align: inherit;">visualmente, y as√≠ se entender√° C√ìMO viaja el robot. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recomiendan comenzar con la configuraci√≥n de los valores p = 1.0, d = 0.1, i = 0.1. </font><font style="vertical-align: inherit;">En nuestro caso, los valores son los siguientes (obtenidos experimentalmente) p = 2.0, i = 0.3, d = 0.1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, estos valores deben establecerse en el c√≥digo y completarse teenzy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, no olvide establecer el c√≥digo (DEBUG 0 en lugar de DEBUG 1):</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define DEBUG 0</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Odometria</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la orientaci√≥n del robot y la navegaci√≥n posterior, se utilizan datos LIDAR, IMU y datos del codificador de rueda. Si la calibraci√≥n de imu se realiza correctamente, el lidar est√° instalado correctamente y los valores del codificador son correctos, entonces no deber√≠a haber problemas con la odometr√≠a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar que la odometr√≠a sea correcta, debe montar un poco en el robot a trav√©s de teleop y ver los valores en el tema principal, esto est√° escrito en la p√°gina del proyecto: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y tambi√©n mire en el caparaz√≥n visual de rviz: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rr/td/si/rrtdsilkdlggf3ifjhk1uhl8bz0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
una celda en rviz es 1 m, por lo que es aconsejable que el robot pase este medidor tanto en el editor visual como en especie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la distancia recorrida se muestra en el indicador w: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/oj/l6/i1ojl6vg5jyugymjwgk-5cfsrlm.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tambi√©n debe tender a 1 m. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo mismo se aplica a los √°ngulos de rotaci√≥n del robot:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l0/uf/bv/l0ufbvhsko99na50frablnrvsc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* En rviz y live, el robot debe girar en los mismos √°ngulos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La odometr√≠a de un lidar se define de manera similar: un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace: la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> distancia del lidar al muro m√°s cercano, tanto en vivo como en rviz, debe coincidir.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ROS, se presta especial atenci√≥n a las transformaciones - tf. </font><font style="vertical-align: inherit;">En t√©rminos generales, este concepto describe la correlaci√≥n de los objetos entre s√≠ en el espacio. </font><font style="vertical-align: inherit;">Para que los objetos no cuelguen en el aire y el programa comprenda c√≥mo se presentan uno con respecto al otro, es necesario prestar atenci√≥n a la configuraci√≥n de tf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el proyecto, todas las conexiones tf ya est√°n configuradas entre s√≠ y solo necesita ajustar los indicadores, por ejemplo, indican c√≥mo est√° ubicado el LIDAR. </font><font style="vertical-align: inherit;">Esto es necesario para que el robot entienda que el obst√°culo no surgi√≥ directamente frente a √©l, sino frente al lidar, que est√° separado del centro del robot a cierta distancia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vayamos al directorio apropiado:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch<font></font>
nano bringup.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base en s√≠ se encuentra a una distancia de 0.065 m del piso:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_footprint_to_base_link"</span> args=<span class="hljs-string">"0 0 0.065 0 0 0  /base_footprint /base_link "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En laser.launch, debe establecer la ubicaci√≥n del lidar en relaci√≥n con el centro de la base del robot:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch/include<font></font>
nano laser.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi caso, el lidar se desplaza a lo largo del eje x: -0.08, y: 0.04 y "sube" por encima de la base (eje z): 0.08m:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf2_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_link_to_laser"</span>
args=<span class="hljs-string">"-0.08 0.04 0.08 0 0 0  /base_link /laser "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En rviz, esta ubicaci√≥n se puede observar visualmente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1v/rz/gj/1vrzgjmhx-gf-jar7jxfbhcovte.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aunque no est√° lejos del lidar, </font><font style="vertical-align: inherit;">ajustaremos </font><font style="vertical-align: inherit;">su frecuencia para que otorgue m√°s puntos (de forma predeterminada, da 4k), esto ayudar√° a construir el mapa:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> linorobot/launch/include/lidar<font></font>
nano rplidar.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A√±adir par√°metro:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"scan_mode"</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Boost"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y cambio </font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"angle_compensate"</span>    <span class="hljs-attr">type</span>=<span class="hljs-string">"bool"</span>   <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora 8k est√° a nuestra disposici√≥n: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zf/u0/fq/zfu0fqd4d7nwmuv50am1qhwqxbm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la ubicaci√≥n f√≠sica del LIDAR en el robot tambi√©n importa:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/46/mw/vq/46mwvqq3kj7nxpskvoadm7xe738.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construyendo un mapa de habitaci√≥n 2D</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el sitio web del proyecto, se propone construir un mapa de la sala mediante el lanzamiento en dos terminales:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot bringup.launch<font></font>
roslaunch linorobot slam.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, la pr√°ctica ha demostrado que slam, que viene con el proyecto por defecto, se niega a funcionar cuando el modo lidar es 8k: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/xa/a5/zexaa5f_1byvgcvvvkvcr7cowbi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mientras que en el modo 4k, las tarjetas no tienen mucho √©xito, son muy ruidosas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, es mejor usar otro golpe: hector-slam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥mo instalarlo se indica </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de la instalaci√≥n, el procedimiento para crear un mapa ser√° el mismo, pero en lugar de roslaunch linorobot slam.launch, ejecute roslaunch my_hector_mapping my_launch.launch Los </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mapas son m√°s limpios, pero luego es mejor modificarlos en un editor gr√°fico, eliminando los innecesarios, especialmente si el lidar colision√≥ con los espejos al construir el mapa : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cn/zo/jv/cnzojvfwpkwgldoo3mylfwwh-yg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No olvide guardar el mapa de la habitaci√≥n:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun map_server map_saver -f my-map
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Los mapas se obtienen mejor en un agradable crep√∫sculo, esto exprimir√° al m√°ximo el presupuesto de LIDAR. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Continuar√°.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es502056/index.html">C√≥mo construir una casa inteligente y no volverse loco</a></li>
<li><a href="../es502066/index.html">Comandos de consola simples que todos deber√≠an saber</a></li>
<li><a href="../es502068/index.html">110 voltios en tu computadora</a></li>
<li><a href="../es502070/index.html">La historia de Pentax (art√≠culo m√°s video)</a></li>
<li><a href="../es502072/index.html">Acoplando la ISS usando JavaScript y br√∫jula</a></li>
<li><a href="../es502080/index.html">M√©todo Kanban: Ejemplo PNZ No. 1, el proceso de estudio de medici√≥n en una startup</a></li>
<li><a href="../es502084/index.html">Verificaci√≥n del portal de servicios p√∫blicos regionales bajo carga a trav√©s de titiritero</a></li>
<li><a href="../es502086/index.html">Configurar Minio para que el usuario solo pueda trabajar con su cubo</a></li>
<li><a href="../es502088/index.html">Una historia de exceso y tiempo perdido. De acuerdo con py3</a></li>
<li><a href="../es502092/index.html">Soporte tecnol√≥gico y regulatorio para servicios de confianza digital en la Federaci√≥n Rusa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>