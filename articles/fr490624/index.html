<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😮 ❎ 🐞 En-tête HTTP et contrôle du navigateur Web 📦 🗾 👩‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il existe une technique totalement incomparable qui vous permet de contrôler les performances d'un projet Web. Elle consiste à introduire dans le proc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>En-tête HTTP et contrôle du navigateur Web</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/490624/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe une technique totalement incomparable qui vous permet de contrôler les performances d'un projet Web. Elle consiste à introduire dans le processus de développement des mécanismes dont les résultats sont clairement visibles. Ces mécanismes sont conçus pour toujours rappeler au programmeur l'importance des performances. Il y a quelque chose dans ce contexte que j'aime beaucoup. Il s'agit de l'en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tête HTTP </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Feature-Policy</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Ce titre est une fonctionnalité relativement nouvelle qui permet à un développeur d'activer et de désactiver certaines fonctionnalités du navigateur lors de la navigation sur son site. </font><font style="vertical-align: inherit;">
Par exemple, vous pouvez indiquer au navigateur qu'il ne doit pas autoriser l'utilisation de l'API de géolocalisation en lui passant l'en-tête suivant:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/_a/mh/zz/_amhzzcwmae7goctptz7hobpnwa.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: geolocation 'none'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation d'un en-tête </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">présente de nombreux avantages en termes de sécurité et de performances. </font><font style="vertical-align: inherit;">Mais j'aime maintenant particulièrement comment </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez l'utiliser pour rendre plus visibles les problèmes de performances des sites Web qui sont généralement faciles à ignorer. </font><font style="vertical-align: inherit;">Cela peut être comparé à quelque chose comme "linting performance". </font><font style="vertical-align: inherit;">En particulier, nous parlons d'identifier les problèmes avec les images utilisées dans les projets Web.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Politique d'images surdimensionnées</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'image est transmise au navigateur dans un format qu'il prend en charge, une telle image sera affichée. Il s'agit d'un comportement de navigateur standard. Le navigateur, essayant d'aider ceux qui consultent la page, redimensionne également automatiquement ces images. Par conséquent, ils ont l'air bien même s'ils sont représentés par d'énormes fichiers graphiques. Par conséquent, si vous utilisez des images plus grandes que les tailles requises par la page, cela est, à première vue, invisible. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Politique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directive</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique au navigateur qu'il ne doit pas autoriser l'utilisation d'images dont la taille dépasse, d'un nombre de fois spécifié, la taille de leurs conteneurs. </font><font style="vertical-align: inherit;">L'image, conformément à la restriction standard, ne peut pas dépasser 2 fois le conteneur. </font><font style="vertical-align: inherit;">Mais cette valeur, si nécessaire, peut être redéfinie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, si le navigateur reçoit l'en-tête suivant, il ne vous permettra pas d'afficher des images prises à partir de n'importe quelles sources (c'est réglé grâce </font></font><code>none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), dont les dimensions sont plus de 2 fois la taille de leurs conteneurs (en largeur ou en hauteur).</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez besoin de plus de flexibilité, vous pouvez indiquer au navigateur qu'il ne doit pas afficher d'images qui sont plus de 3 fois plus grandes que les conteneurs:</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images *(3) 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans tous les cas, si l'image ne correspond pas aux limites spécifiées, un talon sera affiché à la place de l'image et un message d'erreur sera envoyé à la console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c98/1e3/169/c981e3169d9219c226c13236f198c222.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le site utilise la politique d'images surdimensionnées, de grandes images seront téléchargées, mais un talon s'affichera à la place et un message d'erreur s'affichera dans la console.</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Images non optimisées</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre problème courant avec les graphiques est l'utilisation d'images non optimisées. Très souvent, vous pouvez rencontrer des images qui n'ont pas été correctement compressées. Cependant, leur taille peut être sélectionnée correctement. Ainsi, aux fichiers contenant des photos, lors de la prise de vue et de leur création, de nombreuses métadonnées inutiles peuvent être ajoutées, qui restent souvent dans les fichiers lorsqu'elles sont utilisées dans les navigateurs. Un exemple particulièrement ennuyeux de cela est les images, dont les métadonnées contiennent leurs propres miniatures pour l'aperçu. Plusieurs fois, j'ai vu comment la vignette intégrée à l'image (dont les concepteurs et développeurs ne savaient même pas la présence) «pesait» plus que l'image elle-même!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre autres choses, vous pouvez ici rappeler la compression d'image habituelle, prise en charge par de nombreux formats, qui vous permet d'atteindre l'équilibre parfait entre la qualité de l'image et la taille du fichier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">politiques d'images non </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimisées avec perte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et d' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">images non </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">optimisées sans perte indiquent</font></a><font style="vertical-align: inherit;"> au navigateur qu'il correspond à la taille du fichier et à la taille de l'image en pixels.</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unoptimized-lossy-images 'none';<font></font>
Feature-Policy: unoptimized-lossless-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le nombre d'octets par pixel (octet par pixel, BPP) est trop élevé, le navigateur affichera un talon à la place de l'image et affichera un message d'erreur dans la console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/347/215/e57/347215e574f0574312eff1d6737b8d9e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'application de stratégies non optimisées * entraîne l'affichage d'un stub au lieu d'images inappropriées - tout comme l'utilisation de la stratégie d'images surdimensionnées, le</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
niveau BPP recommandé pour les images compressées avec perte est de 0,5 et 1 pour les images compressées sans perte. De plus, lors de l'analyse des images, une légère déviation de leur taille totale par rapport à ces niveaux est autorisée. Or, cet écart pour les images compressées avec perte est de 1 Ko, pour les images compressées sans perte - 10 Ko.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, supposons que nous ayons une image JPEG de 200x200 pixels. JPEG est un format de compression d'image avec perte, ce qui donne un niveau BPP recommandé de 0,5. Dans le même temps, la taille totale de l'image peut dépasser la taille recommandée de seulement 1 Ko. Pour savoir quelle taille une image similaire devrait convenir à un navigateur, vous devez multiplier les dimensions des côtés de l'image en pixels par l'autre et par BPP, puis ajouter l'écart autorisé à ce qui se passe. </font></font><br>
<br>
<code>(200 x 200 x .5) + 1024 = 21,024</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">octet, ou </font></font><code>20.5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ko </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'image est compressée sans perte, un écart par rapport à la taille «idéale» de 10 Ko est autorisé, tandis que le BPP d'une telle image sera de 1. Sinon, les calculs sont exactement les mêmes: </font></font><br>
<br>
<code>(200 x 200 x 1) + 10,240 = 50,240</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">octet ou </font></font><code>49.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ko</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ampleur de l'écart autorisé est susceptible de changer à l'avenir. </font><font style="vertical-align: inherit;">En fait, bien que Blink, par défaut, utilise cet indicateur pour des images compressées sans perte, égal à 10 Ko, des expériences sont déjà en cours avec une politique </font></font><code>unoptimized-lossless-images-strict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui modifie cet indicateur, le ramenant au niveau de 1 Ko.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Média non spécifié</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nouveau est l'ancien bien oublié. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant longtemps, l'utilisation des attributs d'image </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et a </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">été plus ou moins courante. Sans ces attributs, le navigateur ne savait pas combien d'espace l'image devait occuper jusqu'au moment où l'image a été chargée. Cela a entraîné des changements dans les mises en page. La page a été affichée, puis, une fois l'image arrivée, son contenu a changé. Le navigateur a de nouveau dû recomposer la mise en page afin d'allouer de l'espace à l'image. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le moment est venu de disposer de mises en page dans lesquelles les tailles d'image devaient être redimensionnées de manière flexible à l'aide de CSS, la présence ou l'absence de ces attributs ne jouait plus un rôle particulier. En conséquence, beaucoup ont simplement cessé d'utiliser ces attributs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais grâce à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des travaux récents</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initié par Jen Simmons, Firefox et Chrome peut calculer le rapport d'aspect des images en fonction de leurs attributs </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Lorsque cette approche est combinée avec les styles appliqués aux images, il s'avère que les navigateurs peuvent réserver de l'espace pour les images lors du passage initial de la mise en page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stratégie de média non dimensionné</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique au navigateur que tous les éléments multimédias doivent avoir des attributs qui spécifient les tailles de ces éléments. S'il n'y a pas de tels attributs, le navigateur doit utiliser les valeurs par défaut. En fait, tout est un peu plus compliqué, mais l'essentiel est que si l'image n'a pas les attributs appropriés, le navigateur utilise la valeur de </font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixel </font><font style="vertical-align: inherit;">standard </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unsized-media 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque cette stratégie est appliquée, les images seront affichées, mais si leur taille n'est pas spécifiée en HTML, le développeur remarquera rapidement que les images sont affichées dans la taille par défaut. Et, comme d'habitude, un message d'erreur sera envoyé à la console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a4b/b8a/4c5/a4bb8a4c52a7267ef162a8a8244c0f9a.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'application de la politique relative aux médias non dimensionnés conduit au fait que les images et les vidéos sans les attributs de hauteur et de largeur sont affichées, mais le navigateur définit leur taille à 300x150 pixels.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Probablement, il convient de mentionner une fonctionnalité qui m'a d'abord semblé inhabituelle. </font><font style="vertical-align: inherit;">Elle se montre lorsqu'elle partage des politiques</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans cette situation, il ne faut pas s'étonner de l'apparition de plus qu'avant, du nombre de messages sur des images trop grandes. </font><font style="vertical-align: inherit;">Le fait est qu'en raison de l'application de la politique, le</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navigateur redimensionne les images qui n'ont pas d'attributs</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jusqu'à</font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixels. </font><font style="vertical-align: inherit;">Après quoi, c'est cette taille que le navigateur utilise comme point de référence pour déterminer si l'image correspond à son conteneur.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attirer l'attention sur des problèmes moins visibles</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les politiques liées à l'image, j'aime le fait qu'elles, dans le processus de développement de projets, permettent de rendre visible ce qui est habituellement caché. En conséquence, le développeur apprend qu'il n'a pas pris soin d'optimiser les images, ou qu'il a oublié de définir leurs attributs </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Toutes ces erreurs se reflètent immédiatement dans l'apparence des pages. En fait, le principal avantage de l'utilisation des politiques ci-dessus est qu'elles permettent au développeur de trouver rapidement des problèmes avec les images. Alors que la politique</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut entraîner une diminution du nombre de situations dans lesquelles des «changements» de mise en page se produisent, l'utilisation d'autres politiques n'empêche pas le chargement d'images inappropriées. Par conséquent, le seul point fort de l'application de ces politiques est qu'elles attirent l'attention des développeurs sur les problèmes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe plusieurs autres politiques qui peuvent être utiles en termes d'analyse des pages pour l'impact de quelque chose sur leurs performances. C'est là que les politiques comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sync-script</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> viennent à l'esprit </font><font style="vertical-align: inherit;">(cette politique bloque l'exécution des scripts synchrones), </font></font><code>sync-xhr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bloque les requêtes AJAX synchrones) et </font></font><code>document-write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bloque les appels </font></font><code>document.write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces politiques sont d'excellents outils pour contrôler certains aspects des performances des pages, mais elles ne fournissent pas aux développeurs les mêmes commentaires notables que la plupart des politiques ci-dessus fournissent sous la forme d'images manquantes. Bien sûr, si la page a un script synchrone, sans lequel il n'est pas affiché, ce n'est pas facile à manquer (et ces pages ne sont pas si difficiles à trouver). Mais ces politiques indiquent généralement des erreurs sous la forme de messages affichés sur la console. Et pour être honnête, je soupçonne que la plupart des développeurs ne prêtent pas beaucoup d'attention à la console (je pense que nous devrions tous faire plus attention à la console). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, néanmoins, nous pouvons rendre les erreurs détectées par les politiques "invisibles" beaucoup plus visibles en utilisant l'API</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportingObserver</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour surveiller les violations et afficher les notifications pertinentes sur la page. </font><font style="vertical-align: inherit;">Ces notifications peuvent être très visibles.</font></font><br>
<br>
<pre><code class="plaintext hljs">let reportingAlerts = document.createElement('ul');<font></font>
&nbsp;&nbsp;reportingAlerts.setAttribute('id','reportingAlerts');<font></font>
&nbsp;&nbsp;document.body.appendChild(reportingAlerts);<font></font>
<font></font>
const alertBox = document.getElementById('reportingAlerts');<font></font>
<font></font>
new ReportingObserver((reports, observer) =&gt; {<font></font>
&nbsp;&nbsp;let fragment = document.createDocumentFragment();<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;Object.keys(reports).forEach(function(item) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;let li = document.createElement('li');<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;li.textContent = reports[item].body.message + ': ' + reports[item].body.featureId;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fragment.appendChild(li);<font></font>
&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;alertBox.appendChild(fragment)<font></font>
}, {types: ['feature-policy-violation'], buffered: true}).observe();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai esquissé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans CodePen </font><font style="vertical-align: inherit;">de ce à quoi cela pourrait ressembler.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/c18/c8a/2bdc18c8a9bb20db1f18a9e095be4b8e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple de la façon dont vous pouvez afficher les notifications des violations de stratégie spécifiées par l'en-tête Feature-Policy. </font><font style="vertical-align: inherit;">Ces notifications sont conçues pour une sortie dans l'environnement de développement ou lorsque le projet est préparé pour une sortie en production.</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moins d'utilisation de l'en-tête Feature-Policy</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le gros inconvénient de l'utilisation de l'en-tête </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est sa prise en charge par les navigateurs. </font><font style="vertical-align: inherit;">Apparemment, il n'est désormais pris en charge que par les navigateurs basés sur Blink (Opera, Edge, Chrome, Samsung). </font><font style="vertical-align: inherit;">Les navigateurs Firefox et Safari prennent en charge l'attribut </font></font><code>allow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les éléments </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais même là où il est </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pris en charge, pour garantir l'intégrité de la plupart des stratégies, vous devez activer l'indicateur </font></font><code>Experimental Web Platform features</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(vous pouvez le trouver à l'adresse </font></font><code>about:flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment j'utilise l'en-tête de stratégie de fonctionnalité</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce moins du titre </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est mentionné ci-dessus, pour moi personnellement n'est pas un problème particulier. Je préfère utiliser les politiques définies par cet en-tête comme vérificateur de page basé sur un navigateur. Par conséquent, je n'ai pas besoin de m'efforcer de postuler </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en production ou de m'assurer que les politiques fonctionnent pour tous mes utilisateurs. Ils ne sont nécessaires que par moi, ainsi que par ceux qui développent le site. Dans tous les cas, j'utilise Chrome comme navigateur principal dans le processus de développement. Par conséquent, garantir les performances </font></font><code>Feature-Police</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans mon environnement de travail consiste à activer l'indicateur approprié. Après cela, les politiciens travaillent sans aucune intervention supplémentaire de ma part. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai trouvé que la façon la plus simple d'utiliser l'en-tête est </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une extension de navigateur</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModHeader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette extension vous permet de définir vos propres en-têtes qui sont transmis aux pages lors de leur affichage.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/ec2/33b/9c9ec233b6a3913a5e584335ac43a344.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'extension ModHeader vous permet de configurer les options d'en-tête Feature-Policy. </font><font style="vertical-align: inherit;">Ils peuvent être activés et désactivés, si vous le souhaitez</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
. J'ai trois ensembles de valeurs d'en-tête</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que j'utilise périodiquement:</font></font><br>
<br>
<ul>
<li><code>oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>script-sync 'none'; unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je garde souvent le premier allumé. Il est très excitant de parcourir les pages Web auxquelles s'appliquent les politiques qui y sont utilisées. Il est effrayant de voir la taille de certaines images. Il y a beaucoup de choses sur le web moderne qui pourraient être améliorées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, la politique est très souvent déclenchée sur les pages </font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(et je pèche aussi), donc son utilisation pendant le travail normal sur Internet est gênante. C'est pourquoi je l'ai mis en évidence dans une politique distincte, que je peux activer et désactiver. Il en va de même pour les politiques </font></font><code>sync-scripts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont l'application "casse" de nombreux sites.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines des équipes avec lesquelles j'ai travaillé ont commencé à utiliser les politiques que j'ai décrites pendant le développement. </font><font style="vertical-align: inherit;">Cela leur permet de prêter rapidement attention aux problèmes auparavant invisibles. </font><font style="vertical-align: inherit;">Bien sûr, je recommande d'inclure toutes les politiques </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans l'environnement de développement, ce qui vous permet d'identifier rapidement et de corriger les erreurs.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espère que le support </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apparaîtra, par conséquent, non seulement dans Chrome. </font><font style="vertical-align: inherit;">Bien que ce soit mon navigateur principal, je dois également utiliser d'autres navigateurs. </font><font style="vertical-align: inherit;">Il serait utile qu'ils soutiennent </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais ici, cependant, nous voyons cette situation rare où même le soutien expérimental d'une certaine opportunité est suffisant pour qu'elle soit réellement bénéfique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les problèmes de performances subtils sont également des problèmes. </font><font style="vertical-align: inherit;">Et la possibilité de rendre ces problèmes plus visibles est l'une des meilleures méthodes qu'un développeur peut utiliser pour les identifier et les résoudre. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envisagez-vous d'utiliser l'en-tête Feature-Policy pour identifier les problèmes discrets dans les projets Web?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490612/index.html">Approche fonctionnelle des transactions sur Scala ou écrivez votre propre monade utile</a></li>
<li><a href="../fr490616/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 404 (24 février - 1er mars 2020)</a></li>
<li><a href="../fr490618/index.html">Goroutine Stack Buffers</a></li>
<li><a href="../fr490620/index.html">Quand j'entends les mots "restauré le réseau neuronal", je grimpe pour vérifier les sauvegardes</a></li>
<li><a href="../fr490622/index.html">Lutte contre les fuites de mémoire dans les applications Web</a></li>
<li><a href="../fr490626/index.html">Un guide complet des attributs data- * HTML</a></li>
<li><a href="../fr490628/index.html">Que faire lorsque CSS bloque l'analyse des pages?</a></li>
<li><a href="../fr490630/index.html">Chargement de tableaux NumPy à partir du disque: comparaison de memmap () et Zarr / HDF5</a></li>
<li><a href="../fr490634/index.html">Événements numériques à Moscou du 2 au 8 mars</a></li>
<li><a href="../fr490636/index.html">Événements numériques à Saint-Pétersbourg du 2 au 8 mars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>