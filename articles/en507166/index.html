<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ì üöÆ üîò Experience in using Rutoken technology for registering and authorizing users in the system (part 3) üî§ üê´ üôèüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon! 
 
 In the previous part, we successfully created our certification center. How can it be useful for our purposes? 
 
 With the help o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Experience in using Rutoken technology for registering and authorizing users in the system (part 3)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/507166/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good afternoon! </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous part,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we successfully created our certification center. </font><font style="vertical-align: inherit;">How can it be useful for our purposes? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the help of a local certification center, we can issue certificates, as well as verify the signature of these certificates.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When issuing a certificate to a user, the certification authority uses a special request for issuing a Pkcs # 10 certificate, which has the '.csr' file format. This request contains an encoded sequence that the certification authority knows how to parse correctly. The request contains both the public key of the user and the data for creating the certificate (associative array with user data). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to get a request for a certificate, we will consider in the next article, and in this I want to give the main commands of the certification center that will help us complete our task on the backend side. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, first we need to create a certificate. To do this, use the command:</font></font><br>
<br>
<pre><code class="plaintext hljs">openssl ca -batch -in user.csr -out user.crt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ca - openSSL command, which refers to the certification center, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-batch - cancels confirmation requests when generating a certificate. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
user.csr - request to create a certificate (file in .csr format). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
user.crt - certificate (the result of the command). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order for this command to work, the certification center must be configured exactly as described </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the previous part of the article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Otherwise, you will have to additionally specify the location of the root certificate of the certification authority. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certificate Verification Command:</font></font><br>
<br>
<pre><code class="plaintext hljs">openssl cms -verify -in authenticate.cms -inform PEM -CAfile /Users/‚Ä¶‚Ä¶/demoCA/ca.crt -out data.file</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cms is an openSSL command that is used to sign, verify, encrypt data and other cryptographic operations using openSSL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-verify - in this case, we verify the certificate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
authenticate.cms - a file containing the signed data with a certificate that was issued by the previous command. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-inform PEM - uses the PEM format. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-CAfile /Users/DP/demoCA/ca.crt - path to the root certificate. </font><font style="vertical-align: inherit;">(without this, the command did not work for me, although the paths to ca.crt are written in the openssl.cfg file) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-out data.file - I send the decrypted data to the data.file file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The algorithm for applying the certification center on the backend side is as follows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User registration: </font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We receive a request to create a certificate and save it to the user.csr file.</font></font><br>
 </li>
<li>        .bat  .cmd.     ,         user.csr.     user.crt.<br>
 </li>
<li>  user.crt     . <br>
 </li>
</ol><br>
 </li>
<li> : <br>
<ol>
<li>          authenticate.cms. </li>
<li>        .bat  .cmd.     ,        authenticate.cms.      data.file.</li>
<li> data.file      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a>.   ,     .</li>
</ol></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To implement these algorithms, you can use any programming language that is used to write the backend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the next article, we will deal with how to work with the Retoken plugin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for the attention!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en507150/index.html">We draw an interference picture in JavaScript</a></li>
<li><a href="../en507156/index.html">Tetris on bitboards: old songs in a new way</a></li>
<li><a href="../en507158/index.html">Antiquities: Decade of Apple iPad</a></li>
<li><a href="../en507160/index.html">About the ‚Äúmost‚Äù ‚Äúrealistic‚Äù ‚Äúinterpretation‚Äù of quantum mechanics</a></li>
<li><a href="../en507162/index.html">Game Code Command & Conquer: bugs from the 90s. Volume One</a></li>
<li><a href="../en507170/index.html">Are fourteen people viewing this product for sure?</a></li>
<li><a href="../en507172/index.html">What they do at the faculty of low-temperature energy at ITMO University</a></li>
<li><a href="../en507174/index.html">Does the Armed Forces of Russia and other structures of the Ministry of Defense of the Russian Federation need a standard for describing algorithms?</a></li>
<li><a href="../en507176/index.html">MMS system in the data center: how we automated maintenance management</a></li>
<li><a href="../en507178/index.html">Event2Mind for the Russian language. How we taught the model to read between the lines and understand the intentions of the interlocutor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>