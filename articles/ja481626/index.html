<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🚒 🕺🏾 🧙🏻 iOSの複雑な表示コレクション：VKontakteフィードの例に関する問題と解決策 🙇🏿 👃 🙍🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！私の名前はサーシャです。私はVKontakteフィードを作成するチームのiOS開発者です。次に、インターフェイスの表示を最適化し、これに関連する問題を回避する方法について説明します。
 VKテープとは何か想像できると思います。これは、テキスト、静止画像、アニメーションGIF、埋め込み要素...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>iOSの複雑な表示コレクション：VKontakteフィードの例に関する問題と解決策</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/481626/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは！</font><font style="vertical-align: inherit;">私の名前はサーシャです。私はVKontakteフィードを作成するチームのiOS開発者です。</font><font style="vertical-align: inherit;">次に、インターフェイスの表示を最適化し、これに関連する問題を回避する方法について説明します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VKテープとは何か想像できると思います。</font><font style="vertical-align: inherit;">これは、テキスト、静止画像、アニメーションGIF、埋め込み要素（ビデオと音楽）など、さまざまなコンテンツを表示できる画面です。</font><font style="vertical-align: inherit;">これらはすべてスムーズに表示される必要があるため、ソリューションのパフォーマンスに対する高い要求があります。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、マッピングを操作するための標準的なアプローチと、考慮すべき制限または利点について説明します。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読むだけでなく聞くのが好きな人のために、レポートのビデオ録画が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/6u/np/1d/6unp1dycdkq5wxkhtv-6ixrmv-q.png"></p><a name="habracut"></a><br>
<h1 id="soderzhanie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテンツ</font></font></h1><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レイアウトの説明と計算</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.1。</font><font style="vertical-align: inherit;">自動レイアウト</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.2。</font></font><code>frame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手動</font><font style="vertical-align: inherit;">計算</font></font></li>
<li>  <br>
2.1.     <code>UILabel</code>/<code>UITextView</code>/<code>UITextField</code><br>
2.2.  <code>NSAttributedString</code>/<code>NSString</code><br>
2.3. TextKit<br>
2.4. CoreText</li>
<li>   </li>
<li>   <br>
4.1     <br>
4.2. <code>CATransaction.commit</code><br>
4.3. Rendering Pipeline<br>
4.4.     </li>
<li> <br>
5.1. Metal System Trace<br>
5.2.         </li>
</ol><br>
<ul>
<li>  . </li>
<li></li>
<li> </li>
</ul><br>
<h1 id="1-opisanie-i-vychislenie-layout"><strong>1.    layout</strong></h1><br>
<p>  ,      (<em>layout</em>)  .       —        .</p><br>
<h2 id="11-auto-layout"><strong>1.1. Auto Layout</strong></h2><br>
<p>,       iOS —    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Auto Layout</a>  Apple.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Cassowary</a>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> (<em>constraints).</em> </p><br>
<p><em> ,  ,    Auto Layout,   .</em></p><br>
<p><strong> :</strong></p><br>
<ul>
<li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.</li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Cassowary </a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">-</a>.      .   ?      layout       .</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>frame</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIView</code></a> —    .</li>
</ul><br>
<p><strong>   Auto Layout:</strong></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">      </a>. </li>
<li>     ,    «»  Apple.</li>
<li>« »   <code>UIView</code>.</li>
<li>  Interface Builder,    layout  Storyboard  XIB.</li>
<li>     transition.  ,   <code>frame</code>  <code>UIView</code> (!)     layout.</li>
</ul><br>
<p>     .            . ? </p><br>
<p><strong> ,  Auto Layout:</strong></p><br>
<ul>
<li><em>   Main-</em>. ,   Apple  Main-    Auto Layout   frame  <code>UIView</code>.         Auto Layout      Main-.</li>
<li><em>     </em>,     —  ,      .</li>
<li><em></em> <em> iOS 6.0</em>.     ,   .</li>
</ul><br>
<p><em>:   Auto Layout        ,      .</em></p><br>
<h2 id="12-raschyot-frame-vruchnuyu"><strong>1.2.  <code>frame</code> «»</strong></h2><br>
<p> :    <code>frame</code> . ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>layoutSubviews</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>sizeThatFits</code></a>.    <code>layoutSubviews</code>     ,  <code>sizeThatFits</code>  ,       .</p><br>
<p>  ?       Background-,    —   Main-.</p><br>
<p>  ?    ,  .          ,   <code>sizeThatFits</code>.</p><br>
<p><strong>  , :</strong></p><br>
<ul>
<li>   ,  ,    Auto Layout;</li>
<li>    ,   ,         ;</li>
<li>      Background-;</li>
<li>     ,           .<br>
<img src="https://habrastorage.org/webt/tg/-l/nl/tg-lnlwfkzfzkqir1xdd2dun6la.png"></li>
</ul><br>
<p><strong>.</strong>  ,     .      —        .</p><br>
<hr><br>
<h1 id="2-vychislenie-razmera-teksta"><strong>2.   </strong></h1><br>
<p>      ,        .    —    .</p><br>
<h2 id="21-standartnye-metody-vychisleniya-razmera-uilabeluitextviewuitextfield"><strong>2.1.     <code>UILabel</code>/<code>UITextView</code>/<code>UITextField</code></strong></h2><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>sizeThatFits</code></a> (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>sizeToFit</code></a>)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>intrinsicContentSize</code></a> (  Auto Layout)     view. ,      ,    ,   <code>UILabel</code>.</p><br>
<p>  ,       Main- —     . </p><br>
<p><strong>   ?</strong></p><br>
<ul>
<li>    <code>sizeToFit</code>  Auto Layout.</li>
<li>     ,        .</li>
<li>     .</li>
</ul><br>
<h2 id="22-metody-nsattributedstringnsstring"><strong>2.2.  NSAttributedString/NSString</strong></h2><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>boundingRect</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>sizeWithAttributes</code></a>.         <code>UILabel</code>/<code>UITextView</code>/<code>UITextField</code>.         ,   <code>NSString</code>   layout <code>UIView</code>      ( ).       : Foundation  UIKit . ,      boundingRect   <code>UILabel</code>?     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code> NSString</code>    emoji</a>?     . </p><br>
<p>  ,        <code>UILabel</code>/<code>UITextView</code>/<code>UITextField</code>,     .</p><br>
<p><strong> boundingRect  sizeWithAttributes ,  :</strong></p><br>
<ul>
<li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawInRect</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawAtPoint</code></a>     <code>NSString</code>/<code>NSAttributedString</code>. </li>
<li>     Background-. ,       .</li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>, ,    .</li>
</ul><br>
<h2 id="23-textkit"><strong>2.3. TextKit</strong></h2><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>NLayoutManager</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>NSTextStorage</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>NSTextContainer</code></a>.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> layout <code>UILabel</code>/<code>UITextView</code>/<code>UITextField</code>.</p><br>
<p>TextKit  ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">,     </a>:</p><br>
<p><img src="https://habrastorage.org/webt/g8/m1/hi/g8m1hixof_ic7gpugctcvug9gsk.png"></p><br>
<p>  TextKit        ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>  frame</code> /</a>.  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>         layout.     iOS 7.0  .</p><br>
<p><strong>TextKit ,  :</strong></p><br>
<ul>
<li>    layout;</li>
<li>   ;</li>
<li>   ;</li>
<li>  ;</li>
<li>    <code>UITextView</code>.</li>
</ul><br>
<p>  .      <code>UITextView</code>,      <code>NSLayoutManager</code>, <code>NSTextStorage</code>  <code>NSTextContainer</code>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a> <code>UITextView</code>,      layout.        . </p><br>
<p>  TextKit  <code>UILabel</code>  <code>UITextField</code>!   (   <code>UITextView</code>)     <code>NSLayoutManager</code>, <code>NSTextStorage</code>  <code>NSTextContainer</code>.</p><br>
<h2 id="24-coretext"><strong>2.4. CoreText</strong></h2><br>
<p>         iOS.       , , , .   ,   TextKit,     ,   baseline   frame  .</p><br>
<p> ,   ,   .     CoreText   ,     .</p><br>
<p>CoreText      .  ,         .  ,   TextKit       .</p><br>
<p>CoreText  , :</p><br>
<ul>
<li>    API      .  ,        TextKit. </li>
<li>      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CTLine</code></a>)  /.</li>
<li>   iOS 6.0.</li>
</ul><br>
<p>     CoreText. ?   ,        , TextKit   .</p><br>
<hr><br>
<h1 id="3-kak-rabotaet-lenta-vkontakte"><strong>3.    </strong></h1><br>
<p>  ,      ,  layout  .</p><br>
<p><img src="https://habrastorage.org/webt/7g/kx/pt/7gkxptt4lpgjhjzbtyl3prm4vxy.png"></p><br>
<p>  ,   Background-.    ,       .         <code>UIView</code>,           ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">SwiftUI</a>.   layout,   <code>frame</code>    , ,  .    <code>dataSource</code> (<code>dataSourceUpdate</code>).  ,  Background-,   :   ( .   ),  ,    .</p><br>
<p>   Main-.   <code>dataSourceUpdate</code>  <code>UITableView</code>,      ,  .</p><br>
<p>    layout,    ,       :</p><br>
<ul>
<li> API —  ,    .</li>
<li>    (<code>nodes</code>).</li>
<li>    . ,       <code>origin</code>   /   .</li>
<li>     «» <code>UIView</code>  .  ,      <code>UIView</code>      .      <code>origin</code>     ( ) . </li>
<li>     CoreText.</li>
</ul><br>
<p>           -  . ?</p><br>
<p>   —   <code>nodes</code>.        ,        <code>UIView</code>.     «» (view binding)  Main-   ,    . </p><br>
<p>        Background-     .  ,    CPU  GPU ,     .</p><br>
<hr><br>
<h1 id="4-kak-dobitsya-luchshey-proizvoditelnosti"><strong>4.    </strong></h1><br>
<p>   —  Main-, CPU  GPU.   ,      iOS-.      .</p><br>
<h2 id="41-pochemu-voznikayut-problemy-s-proizvoditelnostyu"><strong>4.1     </strong></h2><br>
<p><strong>Core Animation, <code>RunLoop</code>  Scroll</strong><br>
 ,     iOS.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">UIKit</a>,      :  ,       .        — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Core Animation</a> (   macOS).     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>.     .</p><br>
<p> Core Animation   —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CALayer</code></a>.     (Render Tree),    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CATransaction</code></a>.</p><br>
<p> —   , ,    -    .   <code>frame</code>        .    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em>implicit transaction</em></a>.</p><br>
<p>   .       .</p><br>
<p><em>  ,             .</em></p><br>
<p><img src="https://habrastorage.org/webt/84/2n/q5/842nq5jznw5i30ybdmqjrngqhiw.png"></p><br>
<p><strong>    ?</strong>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>RunLoop</code></a>. ,  ,  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<p> Main- <code>RunLoop</code>       ,    (),  , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>NSStream</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>NSPort</code></a>.</p><br>
<p><img src="https://habrastorage.org/webt/rd/f_/_m/rdf__mlll7k8wkiz6ijg8cnhhba.png"></p><br>
<p>   Core Animation  <code>RunLoop</code>?   ,       Render Tree     implicit- (      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CATransaction.begin</code></a>,  - ). ,    <code>RunLoop</code>          (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CATransaction.commit</code></a>).</p><br>
<p><strong> !</strong>   <code>RunLoop</code>      .          « <code>while()</code>».</p><br>
<p> ,     <code>RunLoop</code>  Main-    (scroll):</p><br>
<pre><code class="plaintext hljs">    ...<font></font>
    if (dispatchBlocks.count &gt; 0) { //   MainQueue<font></font>
        doBlocks()<font></font>
    }<font></font>
    ...<font></font>
    if (hasPanEvent) {<font></font>
        handlePan() // UIScrollView change content offset -&gt; change bounds<font></font>
    }<font></font>
    ...<font></font>
    if (hasCATransaction) {<font></font>
        CATransaction.commit()<font></font>
    }<font></font>
    ...</code></pre><br>
<p>  ,   Main-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>dispatch_async</code></a>/<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>dispatch_sync</code></a>.     ,      . </p><br>
<p> UIKit   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">pan-</a> .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIScrollView.contentOffset</code></a>,   — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIScrollView.bounds</code></a>.  <code>bounds</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIScrollView</code></a> (,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UITableView</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UICollectionView</code></a>)       (<code>viewport</code>). </p><br>
<p>   <code>RunLoop</code>,      ,   <code>commit</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>flush</code></a>.</p><br>
<p> ,   ,      .<br>
     :</p><br>
<p><img src="https://habrastorage.org/webt/9c/kw/08/9ckw08wo9cay2nhxqm7qikm1n4w.png"></p><br>
<p>  — <code>CATransaction.commit</code>  <code>handlePan</code>:</p><br>
<p><img src="https://habrastorage.org/webt/0k/h0/xc/0kh0xcaq1yx04htvepmilc_przq.png"></p><br>
<p>  «  » (scroll decelerating) <code>UIScrollView</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CADisplayLink</code></a>,     <code>contentOffset</code>      .</p><br>
<p><img src="https://habrastorage.org/webt/42/gz/5x/42gz5xmatumqfi9jpcl3z1gabic.png"></p><br>
<p>,  <code>CATransaction.commit</code>      <code>RunLoop</code>,      <code>CADisplayLink</code>.    :</p><br>
<p><img src="https://habrastorage.org/webt/oq/si/f0/oqsif0ek7f1-w4f4lguvp_eun20.png"></p><br>
<h2 id="42-catransactioncommit"><strong>4.2. <code>CATransaction.commit</code></strong></h2><br>
<p>     <code>CATransaction.commit</code>    <code>CALayer</code>.        layout (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>layoutSublayers</code></a>)   (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawLayer</code></a>).          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.    <code>UIView</code>   UIKit,         Core Animation.   <code>UIView</code>      .      , <code>UIView</code>      <code>CALayer</code>   ,    :</p><br>
<p><img src="https://habrastorage.org/webt/oq/si/f0/oqsif0ek7f1-w4f4lguvp_eun20.png"></p><br>
<p>       <code>UIView</code>,      <code>UIView</code>.</p><br>
<p>  <code>CATransaction.commit</code>  layout  <code>UIView</code>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>setNeedsLayout</code></a>. ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>layoutSubviews</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>layoutIfNeeded</code></a>   -        <code>CATransaction.commit</code>.      (  <code>CATransaction.begin</code>  <code>CATransaction.commit</code>)     <code>frame</code>   <code>setNeedsLayout</code>,     .         <code>CATransaction.commit</code>.   <code>CALayer</code>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>setNeedsLayout</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>layoutIfNeeded</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>layoutSublayers</code></a>.</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>setNeedsDisplay</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawRect</code></a>.  <code>CALayer</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>setNeedsDisplay</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>displayIfNeeded</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawLayer</code></a>.   <code>CATransaction.commit</code>      ,  <code>setNeedsDisplay</code>.     offscreen-drawing.</p><br>
<p><strong></strong>.      <code>UITableView</code>:</p><br>
<pre><code class="plaintext hljs">    ...<font></font>
    // Layout<font></font>
    UITableView.layoutSubviews()<font></font>
    //  ,   ..<font></font>
    ...<font></font>
    // Offscreen drawing<font></font>
    UITableView.drawRect() <font></font>
    //   <font></font>
    ...</code></pre><br>
<p>UIKit   <code>UITableView</code>/<code>UICollectionView</code>  <code>layoutSubviews</code>:    <code>willDisplayCell</code>   .   <code>CATransaction.commit</code>  offscreen-drawing:   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawInContext</code></a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawRect</code></a>  <code>UIView</code>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>setNeedsDisplay</code></a>. ,   -   <code>drawRect</code>,     ,          . ,       .</p><br>
<p>    <code>CATransaction.commit</code> ? Render Tree   Render Server.</p><br>
<h2 id="43-rendering-pipeline"><strong>4.3. Rendering Pipeline</strong></h2><br>
<p>       iOS (rendering pipeline [WWDC 2014 Session 419. Advanced Graphics and Animations for iOS Apps]):</p><br>
<p><img src="https://habrastorage.org/webt/wh/ac/dj/whacdjlwdz9p3yxk4q2lonad4ag.png"></p><br>
<p>         — Core Animation       ,   Render Server. </p><br>
<p><strong>  .</strong>  (   )      (<code>CATransaction</code>)    , «»     Render Server. ,     .  Render Server   (Render Tree),     ,        .</p><br>
<p>,       «».      60   ,       1/60,   1/30 .  , ,     , Render Server   :</p><br>
<p><img src="https://habrastorage.org/webt/vz/cp/oa/vzcpoae_zvhzw0zkhll1_tjuwwy.png"></p><br>
<p> ,           1/60         1/60    Render Server   .</p><br>
<p>   . <strong>     </strong>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   <code>UIImage</code>/<code>CGImage</code>  Background-.           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CALayer.contents</code></a>.       .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Texture</a>.      <code>CALayer.contents</code>         ,          1/60   60   1/30  (     rendering pipeline  Render Server).</p><br>
<p> , Render Server       blending (. )     [iOS Core Animation: Advanced Techniques. Nick Lockwood].        1/60      <code>CALayer.contents</code>,         .     . </p><br>
<p><em>:    ,     .</em></p><br>
<h2 id="44-samye-uyazvimye-po-proizvoditelnosti-mesta"><strong>4.4.     </strong></h2><br>
<p><strong>Main-thread</strong></p><br>
<p><img src="https://habrastorage.org/webt/yt/c7/2n/ytc72nywgvqohz44yx_lsr9jhti.png"></p><br>
<p><strong><em> 1.     (<code>CATransaction.commit</code>)</em></strong> -   <code>UIView.layoutSubviews</code>     <code>UIView</code> (,  <code>CALayer</code>).   ,         <code>layoutSubviews</code>/<code>cellForRow</code>/<code>willDisplayCell</code>.</p><br>
<p><strong><em> 2.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawInContext</code></a>/<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drawRect</code></a>.</em></strong>  -  Main-      ( <code>CATransaction.commit</code>) —  .                 ,    .</p><br>
<p><strong><em> 3.     </em></strong>.          .        <code>CATransaction.commit</code>,        ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>    .</p><br>
<p><strong><em> 4.   .</em></strong>                <code>UIImage</code>/<code>CGImage</code>. </p><br>
<p><strong><em> 5.  </em></strong>.     Main-thread   ,     scroll.           -  ,       UI.</p><br>
<p><strong><em> 6.    Main-.</em></strong>    , <code>RunLoop</code>  Main-   ,     ,   Main-.         . </p><br>
<p><strong>GPU</strong></p><br>
<p><img src="https://habrastorage.org/webt/xx/gl/cq/xxglcqd-3yjgmjsuxkppjbzbc38.png"></p><br>
<p><strong><em>Blending</em></strong>.        GPU       (  Render Server       GPU,         ).   ,      ,      Background-.</p><br>
<p><strong><em> </em></strong>. ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIBlurEffect</code></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIVibrancyEffect</code></a>    ,  ,    (Render Pass).      ,       ,    .</p><br>
<p><strong>Offscreen rendering (Render Server)</strong></p><br>
<p><img src="https://habrastorage.org/webt/zm/ru/b4/zmrub4eko8bdeelh2lbivcem8bi.png"></p><br>
<p>Render Server        .        , ,     :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>cornerRadius</code></a> —  Render Server      ,         ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>shadowRadius</code></a> —   Render Server    ,   ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>mask</code></a> —        .</li>
</ul><br>
<p>   <code>CALayer</code>,       ,    Offscreen rendering.    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UIVisualEffect</code></a> (   ,     Render Server  CPU,   GPU).</p><br>
<p> ,       .</p><br>
<hr><br>
<h1 id="5-instrumenty-izmereniy"><strong>5.  </strong></h1><br>
<p>   ,    ,    Time Profiler.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Metal System Trace</a> —         Time Profiler    .</p><br>
<h2 id="51-metal-system-trace"><strong>5.1. Metal System Trace</strong></h2><br>
<p> ,          ( ).   ,    : ,    . </p><br>
<p> ,   Metal System Trace  ,           .     ,       Render Server.       ,      Main-,   — ,     .</p><br>
<p><img src="https://habrastorage.org/webt/gy/pv/ay/gypvay-wwr1f0ldbjazina-ewtg.png"></p><br>
<p>     - ,   :</p><br>
<p><img src="https://habrastorage.org/webt/0r/af/6e/0raf6e-cvoukj_6jzt1o6frzjom.png"></p><br>
<p> Metal System Trace   .     64- ,     iPhone 5s.  ,    <em></em>    .   , -   ,  ,          UI.</p><br>
<h2 id="52-fiksiruem-prosadki-proizvoditelnosti-v-kode-vo-vremya-raboty-prilozheniya"><strong>5.2.         </strong></h2><br>
<p>        . ,   - -  .         ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>CADisplayLink</code></a>. </p><br>
<p>  <code>CADisplayLink</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>timestamp</code></a> —     (    Render Server).         <code>CADisplayLink.timestamp</code>     <code>timestamp</code>.   ,          (, 1/60 )  :</p><br>
<pre><code class="plaintext hljs">    //  CADisplayLink.<font></font>
    link = [CADisplayLink displayLinkWithTarget:target selector:selector]<font></font>
    [link addToRunLoop:[NSRunLoop mainRunLoop] forMode:UITrackingRunLoopMode]<font></font>
<font></font>
    //    CADisplayLink : <font></font>
    diff = prevTimestamp - link.timestamp<font></font>
    if (diff &gt; 1/fps) { //  freeze }<font></font>
    prevTimestamp = link.timestamp</code></pre><br>
<p><code>CADisplayLink</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>UITrackingRunLoopMode</code></a>,       .</p><br>
<p>    Rendering Pipeline:<br>
<img src="https://habrastorage.org/webt/yv/ca/t3/yvcat3yxparod3whs19qzwwjzhw.png"></p><br>
<p>     UI-,         .    «»     <code>freezeFrameTimeRate</code>:</p><br>
<pre><code class="plaintext hljs">scrollTime //    Scroll<font></font>
freezeFrameTime //     ,  "",      <font></font>
freezeFrameTimeRate = freezeFrameTime / scrollTime</code></pre><br>
<p> ,            -    <code>UIView</code>.   ,      «»:</p><br>
<p><img src="https://habrastorage.org/webt/ws/l7/tr/wsl7trcro6gr-t7ax-paqn_rxls.png"></p><br>
<p> ,          ,    « <code>UIView</code>»         . ?   ,   . , ,      ,     : <code>CADisplayLink</code> ,       Render Server    <code>link.timetamp</code>,    Render Server     ,      .   60     UI-,         Render Server.   Render Server      ,     .</p><br>
<p> ,     ,   ,  Render Server    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Metal</a>,        Render Server. ,  ,       iOS,   Render Server            .</p><br>
<h2 id="kak-issledovat-problemy-rekomendacii"><strong>  . </strong></h2><br>
<p>  ,   ,      .             ,        .</p><br>
<p>:   —   !          —        .</p><br>
<hr><br>
<h1 id="zaklyuchenie"><strong></strong></h1><br>
<p>  —               .    ,     ,      .</p><br>
<hr><br>
<h1 id="istochniki-informacii"><strong> </strong></h1><br>
<p> ,        —        .        ,   . </p><br>
<p> ,        :</p><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Apple</a>.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    Auto Layout</a>.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">The Cassowary Linear Arithmetic Constraint Solving Algorithm</a>.</li>
<li>iOS Core Animation: Advanced Techniques. Nick Lockwood.</li>
<li>WWDC 2014 Session 419. Advanced Graphics and Animations for iOS Apps.</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/ij/vj/ex/ijvjexv2ppdy6bdkepcwbqk7wy8.png"></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481610/index.html">PostgreSQLアンチパターン：負荷のかかった大きなテーブルの更新</a></li>
<li><a href="../ja481616/index.html">測地線ドーム。デバイスと私の計算経験について</a></li>
<li><a href="../ja481618/index.html">UnityのMVPまたは生活を簡素化する方法</a></li>
<li><a href="../ja481620/index.html">ジュニパーSRXとCisco ASA：次のシリーズ</a></li>
<li><a href="../ja481624/index.html">Reduxと組み合わせてFlutterでアプリケーションを作成します</a></li>
<li><a href="../ja481628/index.html">テストケースで予備ステップを記述するためのルール</a></li>
<li><a href="../ja481632/index.html">クラウドプロバイダー：市場で最も優れているのは誰ですか？</a></li>
<li><a href="../ja481634/index.html">フードデザインダイジェスト、2019年11月</a></li>
<li><a href="../ja481638/index.html">複雑な生産の3Dモデルが役立つ理由</a></li>
<li><a href="../ja481640/index.html">プラグインDevOpsProdigy KubeGrafの新バージョンのリリース</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>