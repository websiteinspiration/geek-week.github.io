<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíª üë∂üèº üèø Positionssensor f√ºr Notlichtschalter üÉè „äóÔ∏è ü•¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor allen, die fr√ºher oder sp√§ter ein autonomes Notbeleuchtungssystem entwerfen, tritt das Problem auf, die Notbeleuchtung ein- und auszuschalten. Wie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Positionssensor f√ºr Notlichtschalter</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor allen, die fr√ºher oder sp√§ter ein autonomes Notbeleuchtungssystem entwerfen, tritt das Problem auf, die Notbeleuchtung ein- und auszuschalten. </font><font style="vertical-align: inherit;">Wie geht das auf bequemste und transparenteste Weise, um die Raumgestaltung nicht durch zus√§tzliche Schalter zu beeintr√§chtigen?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f4/90/kp/f490kpxmliwuhfpeeuf-lhmjhou.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der L√∂sungen unter dem Schnitt.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hintergrund</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der modernen Welt sind viele Dinge an eine unterbrechungsfreie Stromversorgung gebunden. Die meisten Arten von intellektuellen Aktivit√§ten sind ohne einen Computer und eine Kommunikation, die rund um die Uhr funktionieren, bereits nicht denkbar. Das ist weder gut noch schlecht, und du musst damit leben. Vor allem, wenn sich Ihr Arbeitsplatz nicht in einem modernen B√ºro befindet, das mit USV- und Notdieselgeneratoren gef√ºllt ist, sondern in einer Wohnung eines gew√∂hnlichen Wohnhochhauses. Und so kam es, dass die Zuverl√§ssigkeit der Energieversorgung von Wohnraum in den meisten St√§dten der ehemaligen UdSSR zu w√ºnschen √ºbrig l√§sst. Infolgedessen hat der Faden, der die Ausgangssteckdose und das n√§chste Kraftwerk verbindet, die schlechte Angewohnheit, regelm√§√üig zu brechen. Wann einmal alle sechs Monate und wann und dreimal am Tag.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deshalb habe ich zu Beginn der Reparaturarbeiten in einer neuen Wohnung im Projekt zun√§chst eine parallele Verkabelung f√ºr eine unterbrechungsfreie Stromversorgung und Beleuchtung verlegt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich h√§tte sehr gerne einen leistungsstarken Generator mit ICE zur Verf√ºgung, der die gesamte Wohnung mit normalem Strom versorgen kann, aber ich musste diese Idee aufgeben. In einem Privathaus w√§re die Frage √ºberhaupt nicht aufgeworfen worden, aber eine Wohnung ist eine ganz andere. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste Problem ist die Entfernung von Abgasen, die in der Wohnung eines Hauses mit Zentralheizung absolut nirgends zu finden sind. Nun, Sie werden den Schlauch nicht direkt vor dem Fenster wegwerfen, wo sofort Rauch in das Fenster des n√§chsten offenen Nachbarn gesaugt wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das zweite Problem ist L√§rm. Ja, moderne Wechselrichter-Viertaktgeneratoren k√∂nnen sehr leise wirken, wenn Sie sie auf der Stra√üe h√∂ren. Und wenn Sie einen zus√§tzlichen Schalld√§mpfer aufh√§ngen, dann ganz leise. Aber glauben Sie mir, in einem stromlosen, was ein v√∂llig ruhiges Wohnhaus bedeutet, wird selbst ein so leises Rumpeln f√ºr alle Nachbarn perfekt h√∂rbar sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt, die Idee mit dem Generator ist gestorben, so klar und nicht geboren. Von den verbleibenden realen Optionen blieben nur Batterien √ºbrig.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au√üerdem erlaube ich mir eine einfache Darstellung meiner emotionalen Pr√ºfungen und der Entscheidungen, die in der ersten Person getroffen wurden, ohne Anspruch auf universelle Wahrheit. </font><font style="vertical-align: inherit;">Und ich warne sofort, dass meine Argumente gegen√ºber jemandem nicht √ºberzeugend erscheinen k√∂nnten und die getroffenen Entscheidungen umstritten sind. </font><font style="vertical-align: inherit;">Trotzdem ist alles, was hier beschrieben wird, derzeit in Hardware implementiert und f√ºhrt die Aufgaben erfolgreich aus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn sich jemand f√ºr die rein praktische Seite des Problems interessiert und es keine Rolle spielt, wie ich zu einem solchen Leben gekommen bin, kann er </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viele Buchstaben √ºberspringen und direkt zur Beschreibung der vorgefertigten L√∂sung √ºbergehen.</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz √ºber die Auswahl des Batterietyps</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und obwohl diese Ausgabe nichts mit dem Thema des Artikels zu tun hat, m√∂chte ich auch hier meine f√ºnf Cent einf√ºgen. Dar√ºber hinaus , </font><font style="vertical-align: inherit;">dass zwangsl√§ufig unter solchen Aussagen Diskussionen entstehen tr√§gt oft eine Menge </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von lulz</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√ºtzlichen Informationen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute, im Jahrhundert der rasanten Entwicklung alternativer Energien, tauchen relativ erschwingliche, industriell hergestellte unterbrechungsfreie Stromversorgungssysteme f√ºr Privathaushalte in Kombination mit Solar- oder Wind-Minikraftwerken auf. Die fortschrittlichsten von ihnen verwenden Lithium-Ionen-Batterien mit einem ganzen Haufen elektronischer "Enhancer" f√ºr die Wirksamkeit des gesamten Systems.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinem Fall kann aus objektiven Gr√ºnden nicht √ºber ein Minikraftwerk gesprochen werden, und nur die Backup-Quelle, die w√§hrend der ‚ÄûAufkl√§rung‚Äú aus einer normalen Steckdose erneuerbar ist, war interessant. Aus diesem Grund wurde beschlossen, die gesamte elektronische F√ºllung der USV-Wohnung selbst zu bewirtschaften. Und da meine H√§nde v√∂llig gel√∂st waren, musste zun√§chst entschieden werden, welcher Batterietyp verwendet werden sollte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst dachte ich so: ‚ÄûWarum nicht Lithium? </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stilvolle trendige Jugend</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Versiegelt, energieeffizient, langlebig. " Aber als ich mir die Preise ansah, lie√ü meine Lithium-Leidenschaft merklich nach. Eine schnelle Suche in Kombination mit Schularithmetik ergab, dass selbst sehr "dumme" chinesische 26650-Banken mit (nat√ºrlich) den ehrlichsten 5000 mAh f√ºnfmal mehr kosten als eine S√§urebatterie mit der gleichen Energieintensit√§t. Und wenn Sie etwas ausw√§hlen, das nicht vom unteren Ende des Preises sortiert ist, erreicht der Unterschied leicht das 8- bis 10-fache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wie k√∂nnen Sie einen so gro√üen Wertunterschied ausgleichen? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, Lithium speichert Energie effizienter f√ºr jedes Kilogramm und jeden Kubikmeter, und eine Batterie von der Gr√∂√üe eines Zigarettenblocks verwendet problemlos eine 10-Kilogramm-Blei-S√§ure-Batterie. Aber ist diese Tatsache f√ºr den station√§ren Gebrauch so wichtig?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich wird ein gutes "Lithium", aber mit dem richtigen Ansatz l√§nger dauern. Aber zehnmal? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig auf der anderen Seite der Skala die potenzielle Explosivit√§t von Batterien unbekannter Herkunft, ein komplexerer Ladealgorithmus, Probleme bei der Entsorgung (jeder Obdachlose wei√ü, wo er eine Bleibatterie gewinnbringend einsetzen kann, w√§hrend Lithium viel komplizierter ist). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt, aufgrund der Summe der Faktoren habe ich beschlossen, die Idee von Lithium auf die n√§chste Iteration zu verschieben. Vielleicht wird sich in ein paar Jahren etwas √§ndern, aber im Moment ist Blei unser Alles.</font></font><br>
<br>
<blockquote>,      ,        .    ,    ,           ,           .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr Bleibatterien gibt es auch mehrere Optionen. Die ‚Äûrichtige‚Äú Option sind spezielle Pufferbatterien, die in USV, an Basisstationen der Mobilfunkkommunikation und an anderen √§hnlichen Orten verwendet werden, an denen sie gro√üe Str√∂me aufnehmen und liefern m√ºssen, gelegentlich eine starke Entladung erfahren und tats√§chlich arbeiten, ohne die Menschen abzulenken f√ºr den Service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere ‚Äûrichtige‚Äú Option sind Traktionsbatterien f√ºr elektrische Autolader oder, was solls, ein Diesel-U-Boot. Diese Batterien haben eine hohe Haltbarkeit und eine gute Toleranz gegen√ºber Tiefenentladungen, ohne dem Besitzer die M√∂glichkeit zu nehmen, "etwas Wasser nachzuf√ºllen".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, die "falsche" Option ist die Starterbatterie aus dem n√§chsten Autohaus. Eine solche Batterie kann kurzzeitig bis zu einem Kilowatt Strom an den Berg abgeben, aber jede Entladung ist f√ºr ihn stressig, wie die Arbeit f√ºr eine faule Person. Und der Ruhm von Einwegbatterien ist im Allgemeinen in modernen Kalziumbatterien verankert: "Entladen - Wechselgeld".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, ich hoffe, niemand zweifelt daran, welche Option ich letztendlich f√ºr die Implementierung ausgew√§hlt habe. Richtig, drittens. Und die Gr√ºnde daf√ºr liegen nicht nur in der bekannten Warzenamphibie, sondern auch in einer einfachen pragmatischen Berechnung. Starterbatterien sind um ein Vielfaches billiger als alle anderen Optionen und erreichen manchmal einen Lithiumwert. Und anstatt √ºber eine teure Batterie zu sch√ºtteln, f√ºhlen Sie sich in einer Situation gesunder Gleichg√ºltigkeit viel freier, wenn der Ersatz f√ºr ein paar Wochen zu Verlusten bei der Nahrungsaufnahme f√ºhrt. Wenn Sie diese Batterien nicht leer werden lassen, bevor Sie einen Impuls verlieren, wird ihre Lebensdauer als Backup f√ºr viele Jahre berechnet. Sie k√∂nnen jederzeit einen Akku mit einer gr√∂√üeren Kapazit√§t einsetzen, die Entladungsgrenze weicher einstellen und dennoch ein besseres Preis- / Leistungsverh√§ltnis als den ‚Äûrichtigen‚Äú Akku erzielen.eine tiefe Entladung erleiden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptsache in dieser Angelegenheit ist die Bel√ºftung mindestens auf der Ebene ‚ÄûLoch in der Wand‚Äú am Ort der Installation der Batterien. </font><font style="vertical-align: inherit;">Organisieren Sie einen banalen Schutz gegen Kurzschl√ºsse, da die niedrige Spannung der Stromquelle die Wachsamkeit tr√ºbt und alles sehr schlecht enden kann.</font></font><br>
<br>
<h3><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktueller Krieg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in einer einzigen Wohnung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach einer gewissen moralischen Best√§tigung durch die endg√ºltige Entscheidung √ºber den Batterietyp schien ein neuer Grund sofort sorgf√§ltig zu √ºberlegen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte Sie daran erinnern, dass ich zun√§chst einen Wechselstromgenerator mit 230 V haben wollte. Nachdem ich mich jedoch mit der objektiven Realit√§t abgefunden und mental auf Batterien umgestellt hatte, f√ºhrte mich die Tr√§gheit des Denkens bereits auf den bekannten chinesischen Online-Markt, um einen geeigneten DC / AC-Wandler auszuw√§hlen. Und w√§hrend der Untersuchung der Eigenschaften tauchte der Begriff ‚Äûmodifizierte Sinuswelle‚Äú, der vergessen wurde, zuerst auf und dann der gesunde Menschenverstand, unangenehme Fragen auf.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Wesentliche der Fragen war wie folgt. Um den gesamten Energiebedarf der Wohnung mit einer kleinen Batterie zu decken, funktioniert dies immer noch nicht. Kessel, eine Mikrowelle, eine Waschmaschine und ein leistungsstarker Desktop-Computer sind immer noch unertr√§glich. Und der K√ºhlschrank, die Haube und sogar der banale L√ºfter k√∂nnen aufgrund dieser sehr modifizierten Sinuswelle nicht richtig funktionieren. Nat√ºrlich gibt es Wechselrichter mit einer echten Sinuswelle, aber sie sind nicht nur teurer, sondern auch weniger effizient. Und das Problem der starken Verbraucher ist immer noch nicht gel√∂st.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche Verbraucher bleiben im Budget? Es gibt nicht so viele von ihnen: Unterhaltungselektronik wie Laptops und Telefone / Tablets, ein Router, ein ARM-Server, die Stimmung ist ein Fernseher und nat√ºrlich Beleuchtung. Dar√ºber hinaus besteht die erste Botschaft des Artikels (und meine pers√∂nliche Motivation) darin, die Funktion der Backup-Workstation in Form eines Laptops und minimalen Haushaltskomfort wie Licht in der Toilette sicherzustellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fast alle diese Ger√§te ben√∂tigen f√ºr ihren Betrieb eine konstante Spannung von 5 bis 21 V, und es besteht keine objektive Notwendigkeit, die Batteriespannung zuerst auf 230 V AC zu erh√∂hen, dann abzusenken und wieder auf plus oder minus den Anfangspegel auszurichten. Bei diesen Transformationen ist es leicht, bis zu 50% der Energie zu verlieren, was ich √ºberhaupt nicht gel√§chelt habe.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt, so reibungslos kam die Idee auf, alternativ ein Niederspannungs-Gleichstromnetz zu verwenden. </font><font style="vertical-align: inherit;">Und nach einer ungef√§hren Berechnung der Verluste in den Dr√§hten wurden die anf√§nglichen 12 (13,8) V zu praktischeren 24 (27,6) V.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuerst wollte ich sogar 36 (41,4) B nehmen, aber nachdem ich die Eigenschaften einiger elektronischer Komponenten untersucht hatte, mit denen ich mit all dieser Wirtschaft arbeiten wollte, musste ich meinen Appetit d√§mpfen.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So wurde bei einer alternativen Verkabelung mit einem Querschnitt von 3,5 mm </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reinem Kupfer letztendlich Spannung von zwei in Reihe geschalteten Autobatterien angelegt.</font></font><br>
<br>
<blockquote>,        .           (   )   .                ,      .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Verbrauchern die M√∂glichkeit zu geben, wurde jedem ‚Äûgro√üen‚Äú Steckdosenblock eine weitere Steckdose hinzugef√ºgt. Und damit niemand eine gew√∂hnliche Steckdose mit einer Ersatzsteckdose verwechseln w√ºrde, wurden die Produkte vom Typ ‚ÄûAmerican‚Äú mit flachen Kontakten unterschiedlicher Breite als letztere installiert. Dies erm√∂glicht erstens nicht, dass der Staubsauger an das Gleichstromnetz angeschlossen wird, und zweitens verwendet eine solche Steckdose im Gegensatz zur europ√§ischen immer die gleiche Polarit√§t, wenn der ‚Äûrichtige‚Äú Stecker verwendet wird.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/sm/th/blsmthnmtxqcekbdftv8dfg3u2a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr diese Steckdosen wurden Laptop-Adapter hergestellt, die die Spannung auf die gew√ºnschten 18 bis 20 V senken und mit den entsprechenden Anschl√ºssen ausgestattet sind. </font><font style="vertical-align: inherit;">Es ist klar, dass die Abs√§tze aus den √ºblichen F√ºnf-Volt-USB-Ladungen f√ºr jede Kleinigkeit hergestellt wurden. </font><font style="vertical-align: inherit;">F√ºr alle F√§lle wurde ein Paar kleiner 24/230-V-Wandler mit einer Leistung von 50 und 200 Watt gekauft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus China wurden Koffer zum Laden mit einem amerikanischen Stecker, denselben Netzkabeln und vorgefertigten Platinen mit Impuls-Abw√§rtswandlern bestellt. </font><font style="vertical-align: inherit;">Ein L√∂tkolben wurde nur zum Verbinden der Dr√§hte ben√∂tigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde in diesem Artikel nicht auf das Kraftwerk eingehen, zumal es nichts Interessantes enth√§lt. Ich werde daher direkt auf eines der "unteren" Probleme eingehen, n√§mlich das Problem der Nutzung der von der Batterie angesammelten Energie f√ºr Beleuchtungszwecke.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beleuchtung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn also die Wohnung parallel zur Hauptverkabelung verdrahtet wurde, wurden Dr√§hte eines alternativen Gleichstromnetzes mit einer Spannung von 24 (27,6) V gezogen. Unter anderem wurde eine Schleife, die aus einem Paar solcher Dr√§hte bestand, in jeden Schaltkasten und dann zusammen mit den 230 V-Netzwerkdr√§hten gewickelt f√ºhrte zu den Deckenleuchten (wenn sich mehrere im Raum befanden, f√ºhrte der alternative Draht nur zu einer).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was mit dem Ausgang des Gleichstromnetzes im Bereich der Lampe zu tun ist, ist eine Frage eines individuellen Ansatzes. Als Lichtquelle wurde ein normaler 24-Volt-LED-Streifen gew√§hlt. Die unterschiedlich langen Segmente (im Verh√§ltnis zur Raumfl√§che) wurden je nach Design der Leuchten entweder direkt in ihren Geh√§usen montiert oder auf die Oberfl√§chen geklebt, von denen sie gut leuchten und von denen sie nicht sehr auff√§llig w√§ren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In jedem Fall ist dies ein √§sthetischeres als ein technisches Problem, und jetzt ist es etwas anderes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Box jedes Schalters habe ich also eine Schleife eines Phasenkabels eines 230-V-Netzwerks zum Einschalten von "normalem" Licht und eine Schleife beider Dr√§hte eines Gleichstromnetzes zur Notbeleuchtung. Daraus und tanzen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende bestand die Herausforderung vor mir darin, ein bestimmtes Ger√§t zu erstellen, das drei Zust√§nde voneinander trennen kann:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wechselstromnetz OK ‚Üí Notlicht ausschalten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Wechselstromnetz ist stromlos, die Schaltkontakte sind geschlossen ‚Üí Notlicht einschalten. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Wechselstromnetz ist stromlos, die Schaltkontakte sind offen ‚Üí Notlicht ausschalten.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir betrachten die Aktionen als einseitig, dh das Ausschalten der bereits ausgeschalteten Beleuchtung √§ndert nichts. </font><font style="vertical-align: inherit;">Diese Zust√§nde k√∂nnen voneinander unterschieden werden, wenn die Aufgaben der Bestimmung des Betriebs des Wechselstromnetzes und der Position der Kontakte des Schalters gel√∂st sind. </font><font style="vertical-align: inherit;">Gleichzeitig hatte ich folgende Ausgangsbedingungen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Verwaltung sowohl der Haupt- als auch der Notbeleuchtung sollte f√ºr ein Leitungsgremium vollst√§ndig transparent sein, keine ‚ÄûKollektivfarm‚Äú der zus√§tzlichen Tasten.</font></font></li>
<li> ,  ,   ,        .</li>
<li>      ,        .</li>
<li>      ‚Äì    ,  .</li>
<li>-        .</li>
<li>        (    ),  .</li>
<li>      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Fehlen eines Wechselstromnetzes in den Nullboxen stellte sich nat√ºrlich als sehr komplizierte Konstruktionsfehlberechnung heraus. </font><font style="vertical-align: inherit;">Ohne sie wird die Bestimmung des Vorhandenseins einer Spannung am Eingang des Schalters unm√∂glich. </font><font style="vertical-align: inherit;">Technisch w√§re es m√∂glich, den negativen Draht eines Gleichstromnetzes als Null zu verwenden, aber dies widerspricht dem v√∂llig unzerst√∂rbaren Absatz 5 meiner Leistungsbeschreibung.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es besteht jedoch eine Alternative zur Messung der Netzspannung. Es ist f√ºr mich nicht erforderlich, das Vorhandensein von Spannung zu bestimmen, es reicht aus, das Vorhandensein von Strom im Phasendraht bei geschlossenen Kontakten des Schalters zu bestimmen. Wenn Strom vorhanden ist, liegt schlie√ülich Spannung vor. Dar√ºber hinaus erm√∂glicht das ‚ÄûAblesen‚Äú genau des Stroms die Aktivierung der Notbeleuchtung nicht nur bei einem Stromausfall, sondern auch bei einem banalen Gl√ºhbirnenausfall. Diese Methode erlaubt es nicht, den Status des AC-Netzwerks zu bestimmen, wenn der Switch ausgeschaltet ist, aber dieser Status st√∂rt mich nicht, weil Sobald der Schalter ausgeschaltet ist, sollte auch die Notbeleuchtung nicht funktionieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Vorhandensein von Strom im Draht zu bestimmen ist recht einfach, insbesondere wenn dieser Strom abwechselt. </font><font style="vertical-align: inherit;">Hier k√∂nnen Sie beispielsweise einen Hallsensor anwenden, der das Magnetfeld um den Draht erfasst. </font><font style="vertical-align: inherit;">Aber Sie k√∂nnen mit einem gew√∂hnlichen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stromwandler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auskommen </font><font style="vertical-align: inherit;">, der aus einem Ringmagnetkreis mit einer Wicklung besteht. </font><font style="vertical-align: inherit;">Durch den Ring wird ein Wechselstromdraht gef√ºhrt, der im Magnetkreis ein Magnetfeld erzeugt. </font><font style="vertical-align: inherit;">Dieses Feld induziert wiederum einen Sekund√§rstrom in der Wicklung, der proportional zum Prim√§rstrom im Draht ist. </font><font style="vertical-align: inherit;">Mit diesem einfachen Ger√§t k√∂nnen Sie die St√§rke des Wechselstroms in einem beliebigen Draht messen, ohne ihn zu unterbrechen und im Allgemeinen ohne galvanische Verbindung mit dem Prim√§rkreis.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Arbeit von Stromzangen, ein sehr n√ºtzliches Werkzeug f√ºr jeden Elektriker, basiert auf dem gleichen Prinzip.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Befindet sich ein solcher Transformator in der N√§he des Schalters, reicht es aus, die Spannung an seiner Sekund√§rwicklung zu messen, um festzustellen, ob im Lampenstromkreis Strom flie√üt. Das Vorhandensein von Strom zeigt, wie gesagt, in erster N√§herung zwei Tatsachen an: Im Netzwerk liegt eine Spannung von 230 V an, und der Schalter ist geschlossen. Die erste dieser Tatsachen ist f√ºr den Betrieb der Notbeleuchtungsaktivierungsvorrichtung wesentlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite "Eingangsparameter" meines zuk√ºnftigen Ger√§ts sollte die Position der Schaltkontakte sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das unter Hobbykollegen eingeleitete ‚ÄûBrainstorming‚Äú brachte verschiedene Optionen zur Bestimmung der Position des Schalters mit sich, die sich haupts√§chlich auf die √Ñnderung des Designs beschr√§nkten, um ihm ein weiteres Kontaktpaar hinzuzuf√ºgen. Hier ist der Spielraum f√ºr Vorstellungskraft ziemlich gro√ü.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war m√∂glich, einen doppelten anstelle eines einzelnen Schalters zu nehmen und seine H√§lften mechanisch zu ‚Äûparallelisieren‚Äú, so dass sie zu einem einzigen Ganzen wurden. Diese Option unterschied sich nicht in der √§u√üeren √Ñsthetik und l√∂ste das Problem nicht in den R√§umen, in denen die Beleuchtung zweikreisig und der Schalter anfangs doppelt war. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere Optionen waren die Einf√ºhrung eines Mikroschalters oder eines Reed-Schalters mit einem Magneten im Schaltermechanismus. Nach dem Studium der Konstruktionen der verwendeten Leistungsschalter verschwanden diese Optionen ebenfalls. Die monolithische Keramikbasis eines guten Schalters l√§sst selbst f√ºr einen kompakten Mikroschalter einfach keine Chance, und der Magnet- und Reedschalter funktionierte aufgrund zu geringer Tastenbewegung und Hysterese in der Betriebs- / Freigabekurve des Reedschalters nicht.</font></font><br>
<br>
<blockquote> ¬´¬ª        ,     . , ,       ,  .  ,   ,    ,               .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt, es war notwendig, eine Methode zu entwickeln, die keine Modifikation des Schalters erfordert. Und diese Methode wurde gefunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oben habe ich einen Stromwandler beschrieben, mit dem Sie das Vorhandensein von Wechselstrom in einem Draht ohne Bruch und galvanischen Kontakt bestimmen k√∂nnen. Jeder Transformator ist jedoch ein bidirektionales Ger√§t (im Gegensatz zum gleichen Hallsensor), dessen Prim√§r- und Sekund√§rwicklung austauschbar sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir Wechselstrom an die Sekund√§rwicklung eines solchen Transformators anlegen, induziert er Spannung an den Enden des Drahtes, der in den Ring eingeschraubt ist. Und vor allem h√§ngt die Energie, die die Wicklung von der Quelle verbraucht, davon ab, ob der Sekund√§rstrom im Draht seinen Weg f√ºr eine Kreisbewegung findet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier wird es interessanter. </font><font style="vertical-align: inherit;">Durch den Ring verl√§uft ein Draht, der sofort in wenigen Zentimetern mit einem der Kontakte des Schalters verbunden ist. </font><font style="vertical-align: inherit;">Es bleibt nur, diesen Strom mit einem R√ºckweg von der anderen Seite des Schalters zu versorgen, um eine Vorrichtung zum "Erfassen" der Position der Kontakte zu erhalten. </font><font style="vertical-align: inherit;">Und aus dem Grund, dass dieser Strom wechselt, kann ein herk√∂mmlicher Kondensator eine Br√ºcke daf√ºr werden.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gs/tr/g1/gstrg12mwdwhgu0qmbnl3twrfjc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diesen Stromkreis unter bestimmten Bedingungen zu schlie√üen, wird im Prinzip kein Kondensator ben√∂tigt. </font><font style="vertical-align: inherit;">Wenn ein Strom mit einer ausreichend hohen Frequenz in den Transformator "gepumpt" wird, reicht die Streukapazit√§t zwischen den Dr√§hten aus, um durchzulaufen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/up/yp/ws/upypwscprb9xjbrlaye26xfkry8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wird also ben√∂tigt, um einen solchen Detektor zu organisieren:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stromwandler.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transformator-Ausgangsspannungsmesser.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle f√ºr hochfrequenten Wechselstrom.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stromz√§hler flie√üt durch die Wicklung eines Umkehrtransformators.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am schwierigsten bei der Auswahl der optimalen Parameter ist ein Transformator, der im Stromwandlermodus eine akzeptable Spannung mit einer Frequenz von 50 Hz liefern sollte und im aktiven "Erfassungsmodus" des Leistungsschalterzustands einen akzeptablen √úbertragungskoeffizienten bei einer Frequenz von Hunderten von kHz aufweist. </font><font style="vertical-align: inherit;">Dieses Element kann in einem Programm zur Modellierung elektronischer Schaltungen nicht simuliert werden, und selbst bei mathematischen Berechnungen stellte sich heraus, dass alles sehr schwierig war. </font><font style="vertical-align: inherit;">Ich musste einen L√∂tkolben in die Hand nehmen und stundenlang verschiedene Optionen fahren, um die besten zu finden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Anzahl der Windungen und der optimale Lastwiderstand wurden empirisch ausgew√§hlt und nicht die Tatsache, dass ich das beste Verh√§ltnis nicht verpasst habe. </font><font style="vertical-align: inherit;">Als Ergebnis der Experimente erschien die folgende Konstruktion:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferritkern mit einer Permeabilit√§t von 10.000, Gr√∂√üe 10x6x4 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wicklung 30 Windungen mit 0,25 mm Lackdraht.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die aktive Last der Wicklung betr√§gt 1 kOhm.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die magnetische Permeabilit√§t ist ziemlich gro√ü, wahrscheinlich w√§re es sinnvoll, einen Ring f√ºr 5000 oder sogar 2000 Einheiten zu verwenden, aber in ausreichenden Mengen hatte ich diese Ringe. </font><font style="vertical-align: inherit;">Im Allgemeinen ist die Permeabilit√§t in diesem Fall ein Kompromisswert. </font><font style="vertical-align: inherit;">Zu niedrig macht den Transformator f√ºr den Betrieb mit einer Frequenz von 50 Hz ungeeignet, und zu hoch verdirbt alles bei Frequenzen √ºber Hunderten von Kilohertz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mehrere Experimente best√§tigten die Realit√§t der Idee und die folgenden Ergebnisse wurden erhalten:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Stromwandlermodus betrug der √úbertragungskoeffizient etwa 1 Millivolt pro Watt Flie√üleistung (Spannung 220-230 V).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Sondenmodus erreichte die Stromdifferenz bei geschlossenen und offenen Kontakten des Schalters je nach Frequenz und Kapazit√§t des Lecks zwei- bis dreimal.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles. </font><font style="vertical-align: inherit;">Beide Werte sind mehr als ausreichend, um sowohl den flie√üenden Strom zuverl√§ssig zu fixieren als auch die Position der Schaltkontakte zu bestimmen. </font><font style="vertical-align: inherit;">Es liegt nur an der konkreten Umsetzung.</font></font><br>
<br>
<a name="Solution"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Eisen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Gegensatz zu den meisten anderen Designs wurde hier bereits in der Anfangsphase der √úberlegungen beschlossen, den Mikrocontroller sofort zu verwenden. </font><font style="vertical-align: inherit;">Aufgrund der Bed√ºrfnisse und Erfahrungen fiel die Wahl auf den ATtiny13A. </font><font style="vertical-align: inherit;">Dieser Chip verf√ºgt √ºber einen ADC und kann anstelle der Versorgungsspannung eine interne Referenzquelle von 1,1 V verwenden. </font><font style="vertical-align: inherit;">Es gibt eine PWM, die sich hervorragend zur Erzeugung eines akustischen Signals eignet. </font><font style="vertical-align: inherit;">Und was sich sp√§ter als wichtig herausstellte, gibt es ein EEPROM, mit dem Sie Kalibrierungsdaten speichern k√∂nnen.</font></font><br>
<br>
<blockquote>,          ¬´  ,       ,       - ¬´¬ª ,  ¬ª.<br>
<br>
      .         .           .   ,   ,  ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier m√ºssen Sie mindestens einen Generator, einen Spannungsmesser und eine Art Trigger kombinieren, um den aktuellen Zustand zwischen den Messungen zu speichern. Im Allgemeinen erforderte jede spekulative Skizze mindestens drei F√§lle nur auf dem "Kern", und die Steuerung erwies sich als viel praktischer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Spannung vom Stromwandler mit einer Last von 10 bis 20 W betr√§gt 10 bis 20 mV und ist zu klein, um sie mit einer Grenze von sogar 1,1 V an den DAC-Eingang zu liefern. Daher ben√∂tigen Sie zus√§tzlich zum Controller auch einen Verst√§rker mit einem √úbertragungskoeffizienten von etwa 100, um das Signalspannungsminimum zu erh√∂hen bis zu Hunderten von Millivolt.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Allgemeinen h√§ngt die Spannung des Ausgangssignals eines Stromwandlers nicht nur von der Lastleistung ab, sondern auch von seiner Art. </font><font style="vertical-align: inherit;">Eine rein aktive Last wie beispielsweise Ilyichs Gl√ºhbirne erzeugt eine Sinuswelle mit Millivoltpegel. </font><font style="vertical-align: inherit;">Eine LED-Lampe mit der gleichen Leistung und einfacher Impulsleistung liefert kurze Bursts f√ºr Volt und mehr. </font><font style="vertical-align: inherit;">Wir k√∂nnten damit spielen, aber erstens wollte ich ein universelles Ger√§t bauen, und zweitens gab es in der Wohnung eine Lampe mit einem externen Netzteil, das mit einer PFC-Schaltung ausgestattet war (dh eine Verbrauchskennlinie nahe aktiv hatte).</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde den Leser nicht mit Zwischenoptionen qu√§len und sofort das endg√ºltige Diagramm des Ger√§ts geben.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/at/a-/vdata-spt78rd_pzv7s5awoobya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier speist die Gleichspannung durch den wirtschaftlichen Linearregler LM2931-5.0 die Steuerung. In Bezug auf Geh√§use, Funktionalit√§t und Pinbelegung √§hnelt dieser Stabilisator dem beliebten 78L05, unterscheidet sich jedoch durch einen geringeren Eigenverbrauch (ca. 500 ŒºA bei einer Last von 10 mA) und eine gr√∂√üere Toleranz gegen√ºber kurzen Eingangsspannungsst√∂√üen. Wenn Sie mit einer Spannung von nicht mehr als 20 V arbeiten m√∂chten, k√∂nnen Sie ein noch wirtschaftlicheres Analogon von LP2950-5.0 verwenden.</font></font><br>
<br>
<blockquote>   LP2950-5.0        30 .      24      .    -      ,     ,       ,     ,   .          50%,   100%.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Transformator ist im Diagramm nicht dargestellt, seine Wicklung ist jedoch mit den Pins TR1 und TR2 verbunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Schl√ºsselelement zum Schalten der Last wird ein Niedrigstrom-P-Kanal-MOS-Transistor 2SJ196 verwendet (ein Strom von bis zu 1 A sollte f√ºr jede LED-Lampe ausreichen), aber jeder andere, der f√ºr die Pinbelegung, den maximalen Strom und die maximale Drain-Spannung geeignet ist, kann verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neben der Steuerung und dem Schl√ºssel der aktiven Elemente werden zwei Transistoren verwendet. Eine wird ben√∂tigt, um den Verschluss des Schl√ºssels zu steuern, der unter der Spannung der Notquelle arbeitet. Das zweite wirkt als Verst√§rkersignal vom Ausgang des Stromwandlers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zeitpunkt k√∂nnten Sie Operationsverst√§rker verwenden, aber in Bezug auf Details war die Verst√§rkung minimal, und Sie m√ºssten vergessen, bei Frequenzen √ºber mehreren hundert Kilohertz zu arbeiten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist nicht das verst√§rkte Signal vom Transformator selbst, das dem ADC zugef√ºhrt wird, sondern seine H√ºllkurve, die von einer einzelnen Probe gemessen werden kann und nicht durch "Streaming" -Digitalisierung f√ºr einige Zeit. Um die H√ºllkurve zu isolieren, werden zwei Schottky-Dioden verwendet, die gem√§√ü der Spannungsverdopplungsschaltung verbunden sind. Ein solcher Einschluss bildet einen klassischen Amplitudendetektor, bei dem der Spannungsabfall an den Dioden selbst weitgehend kompensiert wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Funktionsprinzip des Sensors ist einfach. Betrachten Sie zun√§chst den Algorithmus der Aktionen, die zum Messen des Stroms im Draht erforderlich sind.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Strommessmodus wird Pin PB0 in den Ausgangsmodus versetzt und durch eine logische Null geerdet. Dies verhindert, dass Signale von der Steuerung an Punkt TR1 gesendet werden. Parallel dazu werden die gleichen Aktionen an Pin PB3 ausgef√ºhrt, wodurch der obere Ausgang des Kondensators C2 geerdet wird. Dieser Kondensator erzeugt zusammen mit dem Widerstand R1 ein Tiefpassfilter mit einer Grenzfrequenz von etwa 1500 Hz. Dank dieses Filters wird die Rolle verschiedener hochfrequenter Rauschen bei der Bildung des gemessenen Signals stark reduziert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann wird ein hoher Pegel an PB4 angelegt, um den Signalverst√§rker mit Strom zu versorgen. Nach Abschluss der Transienten wird ein Strom von 50 Hz vom Transformatorausgang verst√§rkt und gelangt zum Gleichrichter, wo er den Kondensator C8 aufl√§dt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ladung des Kondensators C8 wird mit ADC1 gemessen und aus dem erhaltenen Spannungswert wird ein R√ºckschluss auf den durch den Transformator flie√üenden ‚ÄûPrim√§rstrom‚Äú gezogen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die aktive Erfassung wird anders durchgef√ºhrt. Zun√§chst wird Pin PB0 in einen PWM-L√∂ser √ºbersetzt und ihm ein Signal mit einer Frequenz von Hunderten von Kilohertz bis zu Einheiten von Megahertz zugef√ºhrt. Dieses Signal wird durch einen Widerstandsteiler etwas ged√§mpft und der Stromwandlerwicklung am Punkt TR1 zugef√ºhrt. Der Kondensator C1 erzeugt zusammen mit einem Oberarm des Teilers R4 ein Tiefpassfilter mit einer Grenzfrequenz von etwa 1,5 MHz, wodurch der Pegel der Hochfrequenzoberwellen aus Rechteckimpulsen verringert wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Durchlaufen der Transformatorwicklung gelangt das Sondensignal vom Punkt TR2 zum gleichen Verst√§rker und Detektor, wobei der Kondensator C8 am Ende ebenfalls auf eine Spannung aufgeladen wird, die proportional zur Last im "externen" Stromkreis des Transformators ist. In gleicher Weise wird die Kondensatorladung mit dem ADC des Mikrocontrollers gemessen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun Erkl√§rungen f√ºr einige "lose". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Widerstand R5 ist so ausgelegt, dass er die Spannung am Gate des Leistungsschalters begrenzt, die bei Niederspannungs-MOSFETs normalerweise 20 V nicht √ºberschreiten sollte. In meinem Fall hat das Gleichstromnetz eine Spannung von bis zu 30 V, was die Notwendigkeit eines 1: 3-Teilers vorschreibt, der in Verbindung mit R3 erhalten wird. Bei einer Stromversorgung von weniger als 20 V wird der Widerstand R5 nicht ben√∂tigt (durch einen Jumper ersetzt).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Kondensatoren C4 und C5 sind parallel geschaltet, um eine Kapazit√§t von 2 ŒºF zu erreichen. Dieses Kondensatorpaar ist insofern bemerkenswert, als es Signale mit niedrigen und hohen Frequenzen gleich gut √ºbertragen muss. Hier w√§re es m√∂glich, eine Parallelschaltung eines Elektrolytkondensators aus mehreren Mikrofarad und einer Keramik aus hundert oder zwei Nanofarad zu verwenden, aber ein "Elektrolyt" mit einer so geringen Kapazit√§t ergibt im Vergleich zu "Keramik" aus Mikrofarad keinen Gr√∂√üengewinn. Es stimmt, es war nicht m√∂glich, einen Keramikkondensator f√ºr 2 Mikrofarad zu kaufen, also habe ich zwei davon gleich platziert.</font></font><br>
<br>
<blockquote>,   50     2  ,      .   ,        .               .    100   , ,   .       .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Widerst√§nde R4 und R1 bilden eine Spannungsteilung, die die 5-Volt-Wechselspannung am PWM-Ausgang mehr oder weniger mit der Ausgangsspannung des Stromwandlers ausgleicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kondensator C8 akkumuliert, wie bereits erw√§hnt, die zu messende Spannung. Es ist besser, wenn es sich um einen hochwertigen Kondensator mit einem minimalen Leckstrom handelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Besonders hervorzuheben ist der zweipolige ‚ÄûKamm‚Äú TP1 / TP2, der an das R√ºckstellbein des Mikrocontrollers angeschlossen ist. Diese Kontakte werden nicht nur zum Neustart verwendet, sondern auch zum Aufrufen des unten beschriebenen Kalibrierungsmodus. Nach der Implementierung der gesamten Wunschliste verf√ºgte der Controller nicht mehr √ºber freie Pins, und beim Debuggen der Firmware trat die Notwendigkeit auf, ein einfaches Steuerelement hinzuzuf√ºgen. Zu diesem Zweck musste ich den Controller-Reset-Fu√ü verwenden.</font></font><br>
<br>
<blockquote> ¬´¬ª  AVR     RESET       GPIO.         ,       .         ,        .   ,        ,      ,      ,            RESET.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen erwies sich die Schaltung als recht einfach, und die gesamte ‚ÄûMagie‚Äú ist in der Firmware des Mikrocontrollers implementiert. Nach der Herstellung des Prototyps stellte sich jedoch heraus, dass die Verdrahtungskapazit√§t f√ºr einen zuverl√§ssigen Betrieb der "Sonde" oft nicht ausreicht. Die Stromdifferenz durch den Transformator erweist sich einfach als vergleichbar mit dem Interferenzpegel und der Betrieb der Schaltung wird unzuverl√§ssig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher musste ich den frei an den Dr√§hten h√§ngenden Ferritring aufgeben und in einer neuen Revision des Ger√§ts einen Hochspannungskreis direkt auf die Platine legen, um die Pr√ºfaufgabe zu erleichtern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier geht es darum, einen dedizierten Kondensator hinzuzuf√ºgen, der eingeschaltet ist, um den Weg zum HF-Strom durch die Kontakte des Schalters auf k√ºrzestem Weg zu schlie√üen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i-/_f/63/i-_f636miltufzwifkx4xaxnab0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kondensator C10 muss f√ºr eine Spannung von mindestens Kilovolt ausgelegt sein, und seine Kapazit√§t sollte nach einem Kompromissprinzip gew√§hlt werden, damit die Betriebssicherheit f√ºr den praktischen Gebrauch ausreicht und der kapazitive Streustrom durch die Lampe nicht zu gro√ü ist. </font><font style="vertical-align: inherit;">In der Praxis k√∂nnen Sie bei Bedarf versuchen, mit dieser Bezeichnung "herumzuspielen".</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In jedem Fall kann ein mit einem solchen Sensor ausgestatteter Schalter nicht mehr als ideal angesehen werden. </font><font style="vertical-align: inherit;">Es √§hnelt eher einem Schalter mit einer Anzeige, daher kann es zum einen Streulicht oder Flackern von LED-Lampen geringer Qualit√§t verursachen, und zum anderen kann es einen elektrischen Schlag verursachen, wenn auch keinen starken. </font><font style="vertical-align: inherit;">Daher m√ºssen Sie nie mit Beleuchtungskabeln arbeiten. Verlassen Sie sich nur auf den Schalter in der Wand. Schalten Sie immer den ‚ÄûSchalter‚Äú am Eingang aus.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und da ich der Karte noch einen Teil des Wechselstromnetzes hinzuf√ºgen musste, habe ich dort zwei Abschaltdrosseln hinzugef√ºgt, die den hochfrequenten Pr√ºfstrom nicht in die Verkabelung flie√üen lassen. Der praktische Wert der Frequenz der Pr√ºfspannung kann mehrere MHz erreichen, und ich als Funkamateur habe es sehr satt, die Interferenz im Netzwerk mit meinen eigenen H√§nden zu erh√∂hen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Drosseln L1 und L2 m√ºssen mit Strom versorgt sein und mit einem Draht von merklicher Dicke auf die Hantel- oder Ringkerne gewickelt sein. Signaldrosseln im axialen Design "Widerstand" k√∂nnen nicht verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die prim√§re Windung des Stromwandlers ist jetzt ein St√ºck Draht, das durch den Ring gef√ºhrt und an die Punkte TR3 und TR4 auf der Platine gel√∂tet wird. Es ist besser, wenn dieses Kabel abgeschirmt ist, w√§hrend der Bildschirm auf beiden Seiten des Rings mit TR5 und TR6 verbunden wird.</font></font><br>
<br>
<blockquote> TR6       ,   .    -   ,           .          ,          .</blockquote><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Firmware-Code und die zusammengestellte HEX-Datei werden am Ende des Artikels zusammen mit der Schaltung und dem Layout der Leiterplatte angeh√§ngt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Algorithmus des abgestimmten Detektors ist einfach. Alle drei Sekunden wacht der Controller aus dem Tiefschlaf auf, nimmt Messungen vor und √§ndert bei Bedarf den Status des Steuerschl√ºssels in die eine oder andere Richtung. Somit kann die Reaktion auf eine √Ñnderung der Position des Schalters eine Verz√∂gerung von bis zu drei Sekunden haben. Nicht sehr praktisch, aber dies geschieht zum einen, um Energie f√ºr die Backup-Quelle zu sparen, und zum anderen, um das Abfrageintervall signifikant zu verk√ºrzen, wird die Dauer von Transienten in verschiedenen Messphasen nicht ber√ºcksichtigt. Das minimale Intervall kann als gleich einer Sekunde angesehen werden, aber dann befindet sich die Schaltung fast immer im aktiven Verbrauchsmodus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, abschlie√üend √ºber die Konfiguration. Aufgrund der Tatsache, dass verschiedene Sensoren je nach Stromverbrauch der Lampe, L√§nge und anderen Verdrahtungsmerkmalen, Interferenzpegel und dergleichen unter v√∂llig unterschiedlichen Bedingungen arbeiten m√ºssen, stellte sich heraus, dass es unm√∂glich war, einen universellen Satz adaptiver Parameter in die Firmware einzuf√ºgen. Daher erfordert jeder Sensor nach der Installation eine einzige Kalibrierung vor Ort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Sensor wechselt bei jedem Einschalten in den Kalibrierungsmodus, wenn keine Kalibrierungsdaten vorliegen oder nachdem die Kontakte TP1 und TP2 geschlossen wurden. Der Eintritt in die erste Stufe der Kalibrierung wird durch eine f√ºnfmal blinkende Notlampe angezeigt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach f√ºnfmaligem Blinken werden 7,5 Sekunden Zeit gegeben, um den Schalter auf ‚ÄûAus‚Äú zu stellen, falls er zuvor eingeschaltet wurde. Nach dieser Zeit wird der im Wechselstromnetz immer vorhandene St√∂rpegel gemessen. Der erhaltene Wert wird als Ausgangspunkt f√ºr Messungen im Arbeitszyklus verwendet. Auch in diesem Moment wird der Leistungsschalter bei verschiedenen Frequenzen f√ºr die nachfolgende Auswahl der "kontrastreichsten" Frequenz erfasst.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes beginnt die zweite Kalibrierungsstufe und die Notleuchte blinkt zweimal. Es wird 7,5 Sekunden Zeit gegeben, um den Schalter in die Position ‚ÄûEin‚Äú zu schalten. Nach dem Timeout misst das Programm den von der Lampe verbrauchten Strom. Wenn die Lampe mehrere Helligkeitsstufen hat, m√ºssen Sie sie nach dem Einschalten sofort auf ein Minimum schalten, damit der Sensor in Zukunft mit allen verf√ºgbaren Stufen korrekt funktioniert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Beginn der dritten und letzten Kalibrierungsstufe ist durch dreimaliges Blinken der Notleuchte gekennzeichnet und erfordert, dass der Schalter im Ein-Modus bleibt und das Beleuchtungsnetzwerk sp√§testens bis zum Ende auf einem h√∂heren Pegel (dh mit dem Haupt- oder Nebenleistungsschalter auf dem Bedienfeld) abgeschaltet wird 7,5 Sekunden In diesem Fall wird ein zweites Ert√∂nen des Leistungsschalters durchgef√ºhrt, der bereits bei verschiedenen Frequenzen eingeschaltet ist, und unter Ber√ºcksichtigung der in der ersten Stufe erhaltenen Werte wird die Frequenz ausgew√§hlt, bei der die Stromdifferenz durch den Ein- und Ausschalter maximal ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erfolgreiche Abschluss der Kalibrierung wird durch ein einmaliges Blinken der Notleuchte und, wenn das Beleuchtungsnetz nach der dritten Stufe noch stromlos ist, durch Einschalten der Notbeleuchtung im n√§chsten Abrufzyklus angezeigt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die gemessenen Werte von Str√∂men und Widerst√§nden unter verschiedenen Bedingungen zu nahe beieinander liegen und nicht f√ºr eine zuverl√§ssige Erkennung verwendet werden k√∂nnen, schl√§gt die Kalibrierung fehl. </font><font style="vertical-align: inherit;">In diesem Fall blinkt die Notbeleuchtungslampe zweimal, wenn die Schalterstellung nicht erfolgreich ist, oder dreimal, wenn der Standardverbrauch der Beleuchtungslampe zu niedrig ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei anhaltender Unwilligkeit des Sensors, im Finale mit einem doppelten Blinken zu kalibrieren, sollten Sie versuchen, die Kapazit√§t von C10 zu erh√∂hen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesamt</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ger√§t erwies sich als recht einfach, kompakt genug, um in eine Schaltbox zu passen, aber nicht zu sagen, dass es sehr einfach zu konfigurieren ist. </font><font style="vertical-align: inherit;">Nat√ºrlich greift es nicht auf die Komponente eines modernen "Smart Home" zur√ºck, da es nicht √ºber 5G, Cloud-Steuerung und sogar banales WLAN mit GPS verf√ºgt. </font><font style="vertical-align: inherit;">Trotzdem erf√ºllen acht dieser Ger√§te ihre einzige Funktion, und unter Blackout-Bedingungen ist nichts anderes von ihnen erforderlich.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware-Quellcode (Atmel Studio 7)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 9600000 <span class="hljs-comment">//   (  : avrdude.exe -U lfuse:w:0x7a:m -U hfuse:w:0xff:m)</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/io.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/wdt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/interrupt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/eeprom.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//#define PROTEUS</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">bool</span>; <span class="hljs-comment">//   </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> true  (0 == 0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> false (0 != 0)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_U10BIT 0b0000001111111111 <span class="hljs-comment">//      </span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTERVAL         3   <span class="hljs-comment">//  , </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUR_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RES_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_DIV_OFFSET  2   <span class="hljs-comment">//     </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_MAXIMAL_DIV 6   <span class="hljs-comment">//     </span></span><font></font>
<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_cur_edge;<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_res_edge; <font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> EEPROM_frequency_dividor;<font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_edge, res_edge; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frequency_dividor; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> clk = <span class="hljs-number">0</span>; <span class="hljs-comment">//   watchdog</span>
<span class="hljs-keyword">bool</span> tp_reset = <span class="hljs-literal">false</span>; <span class="hljs-comment">//   TP1  TP2</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_vars</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">if</span>(MCUSR &amp; (<span class="hljs-number">1</span> &lt;&lt; EXTRF)) { <span class="hljs-comment">// ,       TP1  TP2</span>
    tp_reset = <span class="hljs-literal">true</span>;<font></font>
    MCUSR &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; EXTRF); <span class="hljs-comment">//  EXTRF       ,   </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_pins</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB0) | (<span class="hljs-number">1</span> &lt;&lt; PB1) | (<span class="hljs-number">1</span> &lt;&lt; PB2) | (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//       </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    watchdog</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_interrupts</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  sleep_enable(); <span class="hljs-comment">//   </span><font></font>
<font></font>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDCE) | (<span class="hljs-number">1</span> &lt;&lt; WDE); <span class="hljs-comment">//  watchdog</span>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDTIE) | WDTO_1S; <span class="hljs-comment">// watchdog      ,  1 </span><font></font>
<font></font>
  sei(); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_settings</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  cur_edge = eeprom_read_word(&amp;EEPROM_cur_edge); <span class="hljs-comment">//   </span>
  res_edge = eeprom_read_word(&amp;EEPROM_res_edge); <span class="hljs-comment">//   </span>
  frequency_dividor = eeprom_read_byte(&amp;EEPROM_frequency_dividor); <span class="hljs-comment">//   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_load</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">blink_load</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> count)</span> </span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">true</span>);<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">false</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   (   )</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) sleep_cpu();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_amp</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//     PB4</span>
    _delay_ms(<span class="hljs-number">250</span>);      <span class="hljs-comment">//       200 .</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB4);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_lpf</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    (  "0")     C2</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    ( )   C2  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_gen</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    TCCR0A |= (<span class="hljs-number">1</span> &lt;&lt; COM0A0) | (<span class="hljs-number">1</span> &lt;&lt; WGM01); <span class="hljs-comment">//    ( )    OC0A      OCR0A</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> PROTEUS</span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00); <span class="hljs-comment">//    1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00) | (<span class="hljs-number">1</span> &lt;&lt; CS02); <span class="hljs-comment">//    1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    OCR0A = FREQ_DIV_OFFSET + frequency_dividor; <span class="hljs-comment">//   ,         OC0A</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    TCCR0A = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_adc</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    ( )</span>
    ADMUX = <span class="hljs-number">0b01</span> | (<span class="hljs-number">1</span> &lt;&lt; REFS0); <span class="hljs-comment">// PB2, 1.1v reference</span>
    ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADPS0) | (<span class="hljs-number">1</span> &lt;&lt; ADPS1) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2) | <span class="hljs-comment">//       = 128 (75 )</span>
             (<span class="hljs-number">1</span> &lt;&lt; ADIE) |  <span class="hljs-comment">//    </span>
             (<span class="hljs-number">1</span> &lt;&lt; ADEN);   <span class="hljs-comment">//  </span>
  } <span class="hljs-keyword">else</span> {<font></font>
    ADCSRA = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    (  "0")   C8</span>
    _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//      C8</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_adc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_ADC); <span class="hljs-comment">//   "" </span>
  <span class="hljs-keyword">do</span> {<font></font>
    sleep_cpu(); <span class="hljs-comment">//      ,      ,   </span>
  } <span class="hljs-keyword">while</span>(ADCSRA &amp; (<span class="hljs-number">1</span> &lt;&lt; ADSC)); <span class="hljs-comment">//        ,  </span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> ADC;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
//  
static void blink_bin(unsigned int value, unsigned char count) {
  for(unsigned char i = 0; i &lt; count; ++i) {
    _delay_ms(1000);
    toggle_load(true);
    if(value &amp; (1 &lt;&lt; (count - i - 1))) {
      _delay_ms(500);
    } else {
      _delay_ms(50);
    }
    toggle_load(false);
  }
}
*/</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur;<font></font>
<font></font>
  toggle_lpf(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  cur = do_adc(); <span class="hljs-comment">//  </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
  toggle_lpf(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> cur;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_resistance</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> res;<font></font>
<font></font>
  toggle_gen(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  toggle_gen(<span class="hljs-literal">false</span>); <span class="hljs-comment">//   ,   C8     </span>
  res = do_adc(); <span class="hljs-comment">//     </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> MAX_U10BIT - res; <span class="hljs-comment">//      ,      </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_current() &gt;= cur_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_toggled_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_resistance() &lt;= res_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">do_main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is_current()) {<font></font>
    toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span>(is_toggled_on()) {<font></font>
      toggle_load(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  ,  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span><font></font>
    }<font></font>
  }<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">first_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (frequency_dividor == <span class="hljs-number">0xff</span>); <span class="hljs-comment">//   EEPROM   0xFF,        FREQ_MAXIMAL_DIV</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_off, cur_on, res_off, res_on, res_on_tmp, res_off_array[FREQ_MAXIMAL_DIV + <span class="hljs-number">1</span>], diff, max_diff, frequency_dividor_tmp;<font></font>
<font></font>
  blink_load(<span class="hljs-number">5</span>); <span class="hljs-comment">//    ,    </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  cur_off = get_current(); <span class="hljs-comment">//      ( )</span><font></font>
<font></font>
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_off_array[frequency_dividor] = get_resistance();<font></font>
  }<font></font>
<font></font>
  blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  cur_on = get_current(); <span class="hljs-comment">//     </span><font></font>
<font></font>
  blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  <font></font>
  res_off = MAX_U10BIT;<font></font>
  res_on = MAX_U10BIT;<font></font>
  frequency_dividor_tmp = <span class="hljs-number">0</span>;<font></font>
  max_diff = <span class="hljs-number">0</span>;
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_on_tmp = get_resistance();<font></font>
<font></font>
    <span class="hljs-comment">//   ,      </span>
    <span class="hljs-keyword">if</span>(res_off_array[frequency_dividor] &gt; res_on_tmp) {<font></font>
      diff = res_off_array[frequency_dividor] - res_on_tmp;<font></font>
      <span class="hljs-keyword">if</span>(diff &gt; max_diff) {<font></font>
        res_off = res_off_array[frequency_dividor];<font></font>
        res_on = res_on_tmp;<font></font>
        frequency_dividor_tmp = frequency_dividor;<font></font>
        max_diff = diff;<font></font>
      }    <font></font>
    }<font></font>
  }<font></font>
  frequency_dividor = frequency_dividor_tmp;<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(cur_on &gt; cur_off + CUR_MINIMAL_DIFF) { <font></font>
    cur_edge = cur_off + (cur_on - cur_off) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,     </span><font></font>
 <font></font>
    <span class="hljs-keyword">if</span>(res_on + RES_MINIMAL_DIFF &lt; res_off) {<font></font>
      res_edge = res_off - (res_off - res_on) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,      </span><font></font>
<font></font>
      <span class="hljs-comment">//   </span><font></font>
      eeprom_write_word(&amp;EEPROM_cur_edge, cur_edge);<font></font>
      eeprom_write_word(&amp;EEPROM_res_edge, res_edge);<font></font>
      eeprom_write_byte(&amp;EEPROM_frequency_dividor, frequency_dividor);<font></font>
      <font></font>
      blink_load(<span class="hljs-number">1</span>); <span class="hljs-comment">//  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
  }<font></font>
}<font></font>
<font></font>
ISR(WDT_vect) {<font></font>
  WDTCR |= (<span class="hljs-number">1</span> &lt;&lt; WDTIE); <span class="hljs-comment">//    watchdog   ""    </span><font></font>
}<font></font>
<font></font>
EMPTY_INTERRUPT(ADC_vect); <span class="hljs-comment">//     ,     </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  init_vars();<font></font>
  init_pins();       <font></font>
  init_interrupts(); <font></font>
  init_settings();<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(tp_reset || first_on()) {<font></font>
    calibrate(); <span class="hljs-comment">//          </span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {<font></font>
    set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
    sleep_cpu(); <span class="hljs-comment">//   watchdog</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span>(++clk &gt;= INTERVAL) {<font></font>
      do_main(); <span class="hljs-comment">//  </span>
      clk = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archiv mit Diagramm, Verkabelung und dem gesamten Atmel Studio 7-Projekt</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de492788/index.html">M√ºde, aber: Deutschland hat die erste Welle von COVID-19 komplett gestoppt</a></li>
<li><a href="../de492798/index.html">Die Leute sind ins Internet gegangen, um zu chatten, aber jetzt tr√§umen sie wieder davon, offline zu sein. Was ist los?</a></li>
<li><a href="../de492800/index.html">GSM IoT-Anbieter f√ºr Wohnungsbau und √∂ffentliche Versorgung (Teil 1)</a></li>
<li><a href="../de492804/index.html">Zum Thema Replikation sozialer Aktivit√§ten im Internet als Schl√ºssel zur Minimierung des Anstiegs der Inzidenz w√§hrend einer Pandemie</a></li>
<li><a href="../de492806/index.html">So verkn√ºpfen Sie Engagement mit Monetarisierung in mobilen Spielen und Apps</a></li>
<li><a href="../de492810/index.html">[COVID-19] Ihre Aufgabe ist es, den Peak zu gl√§tten</a></li>
<li><a href="../de492812/index.html">Versuch, GAN-Netzwerke in OpenVINO auszuf√ºhren</a></li>
<li><a href="../de492816/index.html">Tipps und Tricks zu IntelliJ IDEA: 4. Einstellungen synchronisieren und freigeben</a></li>
<li><a href="../de492820/index.html">.Net Core Api: Abrufen von Daten in einer Anfrage aus verschiedenen Quellen</a></li>
<li><a href="../de492822/index.html">CSS-Entwickler - warum braucht die Welt sie?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>