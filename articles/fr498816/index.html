<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíáüèª ü•å üöØ La v√©rit√© tout d'abord, ou pourquoi le syst√®me doit √™tre con√ßu en fonction du p√©riph√©rique de base de donn√©es ü•ï üî£ ü•å</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! 
 
 Nous continuons d'explorer le sujet de Java et Spring , y compris au niveau de la base de donn√©es. Aujourd'hui, nous vous proposons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>La v√©rit√© tout d'abord, ou pourquoi le syst√®me doit √™tre con√ßu en fonction du p√©riph√©rique de base de donn√©es</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/498816/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous continuons d'explorer le sujet de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y compris au niveau de la base de donn√©es. Aujourd'hui, nous vous proposons de comprendre pourquoi, lors de la conception de grandes applications, c'est la structure de la base de donn√©es, et non le code Java, qui devrait avoir une importance d√©cisive sur la fa√ßon dont cela est fait, et sur les exceptions √† cette r√®gle.</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article plut√¥t tardif, j'expliquerai pourquoi je pense que dans presque tous les cas, le mod√®le de donn√©es dans l'application doit √™tre con√ßu "sur la base de la base de donn√©es", et non "sur la base des capacit√©s de Java" (ou d'un autre langage client avec lequel vous travaillez). </font><font style="vertical-align: inherit;">En choisissant la deuxi√®me approche, vous vous lancez dans un long voyage de douleur et de souffrance d√®s que votre projet commence √† grandir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article est bas√© sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une question</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pos√©e sur Stack Overflow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discussions int√©ressantes sur reddit dans les sections </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / programmation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G√©n√©ration de code</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Combien je suis surpris qu'il y ait une si petite couche d'utilisateurs qui, apr√®s avoir fait connaissance avec jOOQ, sont scandalis√©s par le fait que lorsqu'ils travaillent jOOQ s'appuie s√©rieusement sur la g√©n√©ration de code source. Personne ne vous d√©range pour utiliser jOOQ comme bon vous semble et ne vous oblige pas √† utiliser la g√©n√©ration de code. Mais par d√©faut (comme d√©crit dans le manuel), travailler avec jOOQ se passe comme suit: vous commencez avec le sch√©ma de base de donn√©es (h√©rit√©), vous le r√©tro-concevez avec le g√©n√©rateur de code jOOQ, de sorte que vous obtenez un ensemble de classes repr√©sentant vos tables, puis √©crire des requ√™tes de type s√©curis√© dans ces tables:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-keyword">for</span> (Record2&lt;String, String&gt; record : DSL.using(configuration)
<span class="hljs-comment">//   ^^^^^^^^^^^^^^^^^^^^^^^      </span>
<span class="hljs-comment">//     ,    </span>
<span class="hljs-comment">//   SELECT </span><font></font>
 <font></font>
       .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME)<font></font>
<span class="hljs-comment">//           vvvvv ^^^^^^^^^^^^  ^^^^^^^^^^^^^^^  </span><font></font>
       .from(ACTOR)<font></font>
       .orderBy(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) {
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code est g√©n√©r√© soit manuellement en dehors de l'assembly, soit manuellement avec chaque assembly. </font><font style="vertical-align: inherit;">Par exemple, une telle r√©g√©n√©ration peut suivre imm√©diatement apr√®s la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">migration de la base de donn√©es Flyway, qui peut √©galement √™tre effectu√©e manuellement ou automatiquement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G√©n√©ration de code source</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diverses philosophies, avantages et inconv√©nients sont associ√©s √† de telles approches de g√©n√©ration de code - manuelle et automatique - dont je ne vais pas discuter en d√©tail dans cet article. Mais, en g√©n√©ral, tout l'int√©r√™t du code g√©n√©r√© est qu'il nous permet de reproduire en Java cette ¬´v√©rit√©¬ª que nous tenons pour acquise, que ce soit √† l'int√©rieur ou √† l'ext√©rieur de notre syst√®me. Dans un sens, les compilateurs qui g√©n√®rent du bytecode, du code machine ou un autre type de code bas√© sur la source font la m√™me chose - nous obtenons une repr√©sentation de notre ¬´v√©rit√©¬ª dans une autre langue, ind√©pendamment de raisons sp√©cifiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe de nombreux g√©n√©rateurs de code de ce type. Par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XJC peut g√©n√©rer du code Java bas√© sur des fichiers XSD ou WSDL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le principe est toujours le m√™me:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a une certaine v√©rit√© (interne ou externe) - par exemple, la sp√©cification, le mod√®le de donn√©es, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons besoin d'une repr√©sentation locale de cette v√©rit√© dans notre langage de programmation.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, g√©n√©rer une telle repr√©sentation est presque toujours conseill√© - pour √©viter les redondances.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fournisseurs de types et traitement des annotations</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remarque: une autre approche plus moderne et sp√©cifique de la g√©n√©ration de code pour jOOQ est associ√©e √† l'utilisation de fournisseurs de types, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous la forme dans laquelle ils sont impl√©ment√©s en F #</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans ce cas, le code est g√©n√©r√© par le compilateur, en fait au stade de la compilation. </font><font style="vertical-align: inherit;">Sous forme de sources, un tel code, en principe, n'existe pas. </font><font style="vertical-align: inherit;">Il existe des outils similaires, quoique moins √©l√©gants, en Java - ce sont des processeurs d'annotation tels que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lombok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un certain sens, les m√™mes choses se produisent ici que dans le premier cas, √† l'exception de:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous ne voyez pas le code g√©n√©r√© (peut-√™tre que cette situation semble √† quelqu'un pas si r√©pugnante?)</font></font></li>
<li>  ,    ,  , ¬´¬ª    .     Lombok,   ‚Äú‚Äù.      ,        .</li>
</ul><br>
<h4>     ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus de la question d√©licate de savoir comment il est pr√©f√©rable de d√©marrer la g√©n√©ration de code - manuellement ou automatiquement, il est n√©cessaire de mentionner qu'il y a des gens qui pensent que la g√©n√©ration de code n'est pas du tout n√©cessaire. La justification de ce point de vue, que j'ai rencontr√© le plus souvent, est qu'il est alors difficile de configurer le pipeline d'assemblage. Oui, vraiment dur. Il y a des co√ªts d'infrastructure suppl√©mentaires. Si vous commencez tout juste √† travailler avec un certain produit (que ce soit jOOQ, ou JAXB, ou Hibernate, etc.), il faut du temps pour configurer l'environnement de travail que vous souhaitez consacrer √† l'apprentissage de l'API lui-m√™me, puis en extraire de la valeur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les co√ªts associ√©s √† la compr√©hension du dispositif g√©n√©rateur sont trop importants, alors, en effet, l'API a fait un peu de travail sur l'utilisabilit√© du g√©n√©rateur de code (et √† l'avenir, il s'av√®re que la configuration utilisateur est compliqu√©e). La facilit√© d'utilisation devrait √™tre la priorit√© la plus √©lev√©e pour une telle API. Mais ce n'est qu'un argument contre la g√©n√©ration de code. Pour le reste, il est compl√®tement enti√®rement manuel d'√©crire une repr√©sentation locale de la v√©rit√© interne ou externe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup diront qu‚Äôils n‚Äôont pas le temps de faire tout cela. Ils ont des d√©lais pour leur super produit. Un peu plus tard, nous peignerons les convoyeurs d'assemblage, ce sera dans le temps. Je vais y r√©pondre: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/ah/5v/sdah5v4nuslp0dylmjlrvcu0qfu.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alan O'Rourke, Audience Stack </font></font></a> <br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais dans Hibernate / JPA, il est si simple d'√©crire du code ¬´pour Java¬ª.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vraiment. </font><font style="vertical-align: inherit;">Pour Hibernate et ses utilisateurs, c'est √† la fois une b√©n√©diction et une mal√©diction. </font><font style="vertical-align: inherit;">Dans Hibernate, vous pouvez simplement √©crire quelques entit√©s, comme ceci:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et presque tout est pr√™t. </font><font style="vertical-align: inherit;">D√©sormais, le destin d'Hibernate est de g√©n√©rer des ¬´d√©tails¬ª complexes sur la fa√ßon dont cette entit√© sera d√©finie sur la DDL de votre ¬´dialecte¬ª SQL:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> book (
  <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span> <span class="hljs-keyword">AS</span> <span class="hljs-keyword">IDENTITY</span>,<font></font>
  title <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),<font></font>
 <font></font>
  <span class="hljs-keyword">CONSTRAINT</span> pk_book PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-keyword">id</span>)<font></font>
);<font></font>
 <font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> i_book_title <span class="hljs-keyword">ON</span> book (title);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... et nous commen√ßons √† piloter l'application. </font><font style="vertical-align: inherit;">Une opportunit√© vraiment cool de commencer rapidement et d'essayer diff√©rentes choses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, permettez. </font><font style="vertical-align: inherit;">Je trompais.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate applique-t-il vraiment la d√©finition de cette cl√© primaire nomm√©e?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate cr√©era-t-il un index dans TITLE? </font><font style="vertical-align: inherit;">"Je sais avec certitude que nous aurons besoin de lui."</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate rend-il exactement cette cl√© identifiable dans la sp√©cification d'identit√©?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probablement pas. </font><font style="vertical-align: inherit;">Si vous d√©veloppez votre projet √† partir de z√©ro, il est toujours pratique de simplement supprimer l'ancienne base de donn√©es et d'en g√©n√©rer une nouvelle d√®s que vous ajoutez les annotations n√©cessaires. </font><font style="vertical-align: inherit;">Ainsi, l'entit√© Livre prendra finalement la forme:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
  @Index(name = "i_book_title", columnList = "title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cool. </font><font style="vertical-align: inherit;">R√©g√©n√©rer. </font><font style="vertical-align: inherit;">Encore une fois, dans ce cas, au d√©but, ce sera tr√®s facile.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais alors il faut payer pour √ßa</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√¥t ou tard, vous devez entrer en production. √Ä ce moment-l√†, un tel mod√®le cessera de fonctionner. Parce que: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En production, il ne sera plus possible, si n√©cessaire, de supprimer l'ancienne base de donn√©es et de tout recommencer √† z√©ro. Votre base de donn√©es deviendra une ancienne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä partir de maintenant, vous devrez √©crire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des scripts de migration DDL, par exemple, en utilisant Flyway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et qu'advient-il alors de vos entit√©s? Vous pouvez soit les adapter manuellement (et ainsi doubler votre charge de travail), soit commander √† Hibernate de les r√©g√©n√©rer pour vous (quelles sont les chances que celle g√©n√©r√©e de cette mani√®re r√©ponde √† vos attentes?) Vous perdez quand m√™me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, d√®s que vous entrerez en production, vous aurez besoin de correctifs √† chaud. </font><font style="vertical-align: inherit;">Et ils doivent √™tre mis en production tr√®s rapidement. </font><font style="vertical-align: inherit;">Comme vous n'avez pas pr√©par√© et organis√© un convoyeur fluide de vos migrations pour la production, vous corrigez tout de mani√®re extravagante. </font><font style="vertical-align: inherit;">Et puis vous n‚Äôavez pas le temps de tout faire correctement. </font><font style="vertical-align: inherit;">Et r√©primander Hibernate, parce que tout le monde est toujours √† bl√¢mer, mais pas vous ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de cela, d√®s le d√©but, tout pourrait √™tre fait d'une mani√®re compl√®tement diff√©rente. </font><font style="vertical-align: inherit;">Par exemple, placez des roues rondes sur un v√©lo.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base de donn√©es d'abord</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La v√©ritable ¬´v√©rit√©¬ª dans le sch√©ma de votre base de donn√©es et la ¬´souverainet√©¬ª sur elle r√©side √† l'int√©rieur de la base de donn√©es. </font><font style="vertical-align: inherit;">Un sch√©ma n'est d√©fini que dans la base de donn√©es elle-m√™me et nulle part ailleurs, et chaque client a une copie de ce sch√©ma, il est donc tout √† fait conseill√© d'imposer la conformit√© avec le sch√©ma et son int√©grit√©, de le faire directement dans la base de donn√©es - o√π les informations sont stock√©es. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est m√™me une vieille sagesse us√©e. </font><font style="vertical-align: inherit;">Les cl√©s primaires et uniques sont bonnes. </font><font style="vertical-align: inherit;">Les cl√©s √©trang√®res sont bonnes. </font><font style="vertical-align: inherit;">V√©rifier les restrictions est une bonne chose. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les d√©clarations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont bonnes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, ce n'est pas tout. </font><font style="vertical-align: inherit;">Par exemple, en utilisant Oracle, vous souhaiterez probablement sp√©cifier:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans quel espace de table se trouve votre table? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle est sa valeur PCTFREE? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle est la taille du cache dans votre s√©quence (derri√®re l'identifiant)</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre que tout cela n'est pas important dans les petits syst√®mes, mais il n'est pas n√©cessaire d'attendre la transition vers le domaine des ¬´m√©gadonn√©es¬ª - il est possible et bien plus t√¥t de commencer √† b√©n√©ficier des optimisations de stockage fournies par le fournisseur, telles que celles mentionn√©es ci-dessus. </font><font style="vertical-align: inherit;">Aucun des ORM que j'ai vus (y compris jOOQ) ne donne acc√®s √† l'ensemble complet des options DDL que vous voudrez peut-√™tre utiliser dans votre base de donn√©es. </font><font style="vertical-align: inherit;">Les ORM offrent quelques outils qui aident √† √©crire DDL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais au final, un circuit bien con√ßu est √©crit manuellement en DDL. </font><font style="vertical-align: inherit;">Tout DDL g√©n√©r√© n'est qu'une approximation de celui-ci.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et le mod√®le client?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme mentionn√© ci-dessus, sur le client, vous aurez besoin d'une copie de votre sch√©ma de base de donn√©es, la vue client. Il va sans dire que cette vue client doit √™tre synchronis√©e avec le mod√®le r√©el. Quelle est la meilleure fa√ßon d'y parvenir? Utilisation d'un g√©n√©rateur de code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les bases de donn√©es fournissent leurs m√©ta-informations via SQL. Voici comment obtenir toutes les tables dans diff√©rents dialectes SQL √† partir de votre base de donn√©es:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server</span>
<span class="hljs-keyword">SELECT</span> table_schema, table_name
<span class="hljs-keyword">FROM</span> information_schema.tables<font></font>
 <font></font>
<span class="hljs-comment">-- DB2</span>
<span class="hljs-keyword">SELECT</span> tabschema, tabname
<span class="hljs-keyword">FROM</span> syscat.tables<font></font>
 <font></font>
<span class="hljs-comment">-- Oracle</span>
<span class="hljs-keyword">SELECT</span> owner, table_name
<span class="hljs-keyword">FROM</span> all_tables<font></font>
 <font></font>
<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>
<span class="hljs-keyword">FROM</span> sqlite_master<font></font>
 <font></font>
<span class="hljs-comment">-- Teradata</span>
<span class="hljs-keyword">SELECT</span> databasename, tablename
<span class="hljs-keyword">FROM</span> dbc.tables
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces requ√™tes (ou similaires, selon que vous devez √©galement prendre en compte les repr√©sentations, les repr√©sentations mat√©rialis√©es, les fonctions avec une valeur de table) sont √©galement effectu√©es √† l'aide d'un appel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>DatabaseMetaData.getTables()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de JDBC ou √† l'aide du m√©ta-module jOOQ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä partir des r√©sultats de ces requ√™tes, il est relativement facile de g√©n√©rer une vue client de votre mod√®le de base de donn√©es, quelle que soit la technologie utilis√©e sur votre client.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous utilisez JDBC ou Spring, vous pouvez cr√©er un ensemble de constantes de cha√Æne </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous utilisez JPA, vous pouvez g√©n√©rer des entit√©s elles-m√™mes </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous utilisez jOOQ, vous pouvez g√©n√©rer le m√©ta-mod√®le jOOQ</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon le nombre de fonctionnalit√©s offertes par votre API client (par exemple jOOQ ou JPA), le m√©ta-mod√®le g√©n√©r√© peut √™tre vraiment riche et complet. </font><font style="vertical-align: inherit;">Prenons, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la possibilit√© de jointures implicites </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">apparues dans jOOQ 3.11</font></a><font style="vertical-align: inherit;"> , qui s'appuie sur les m√©ta-informations g√©n√©r√©es sur les relations des cl√©s √©trang√®res entre vos tables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©sormais, tout incr√©ment de la base de donn√©es entra√Ænera automatiquement la mise √† jour du code client. </font><font style="vertical-align: inherit;">Imaginez par exemple:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> title <span class="hljs-keyword">TO</span> book_title;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aimeriez-vous vraiment faire ce travail deux fois? </font><font style="vertical-align: inherit;">Dans aucun cas. </font><font style="vertical-align: inherit;">Corrigez simplement le DDL, ex√©cutez-le dans votre pipeline d'assemblage et obtenez l'entit√© mise √† jour:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
 
  //    ?
  @Index(name = "i_book_title", columnList = "book_title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
 <font></font>
  <span class="hljs-meta">@Column("book_title")</span><font></font>
  String bookTitle;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou une classe jOOQ mise √† jour. </font><font style="vertical-align: inherit;">La plupart des modifications DDL affectent √©galement la s√©mantique, pas seulement la syntaxe. </font><font style="vertical-align: inherit;">Par cons√©quent, il peut √™tre pratique de voir dans le code compil√© quel code sera (ou peut √™tre) affect√© par l'incr√©mentation de votre base de donn√©es.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La seule v√©rit√©</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle que soit la technologie que vous utilisez, il existe toujours un mod√®le qui est la seule source de v√©rit√© pour certains sous-syst√®mes - ou, du moins, nous devrions nous efforcer de le faire et √©viter une telle confusion d'entreprise, o√π la ¬´v√©rit√©¬ª est partout et nulle part. </font><font style="vertical-align: inherit;">Tout peut √™tre beaucoup plus simple. </font><font style="vertical-align: inherit;">Si vous √©changez simplement des fichiers XML avec un autre syst√®me, utilisez simplement XSD. </font><font style="vertical-align: inherit;">Regardez le m√©ta-mod√®le INFORMATION_SCHEMA de jOOQ sous forme XML: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSD est bien compris</font></font></li>
<li>XSD     XML         </li>
<li>XSD        </li>
<li>XSD     Java   XJC</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dernier point est important. </font><font style="vertical-align: inherit;">Lorsque nous communiquons avec un syst√®me externe √† l'aide de messages XML, nous voulons √™tre s√ªrs de la validit√© de nos messages. </font><font style="vertical-align: inherit;">Ceci est tr√®s facile √† r√©aliser avec JAXB, XJC et XSD. </font><font style="vertical-align: inherit;">Il serait compl√®tement insens√© de s'attendre √† ce que, lorsque nous approchons de la conception de ¬´Java d'abord¬ª, o√π nous faisons nos messages sous forme d'objets Java, ils puissent en quelque sorte √™tre clairement affich√©s en XML et envoy√©s pour consommation √† un autre syst√®me. </font><font style="vertical-align: inherit;">Le XML g√©n√©r√© de cette mani√®re serait de tr√®s mauvaise qualit√©, non document√©, et serait difficile √† d√©velopper. </font><font style="vertical-align: inherit;">S'il y avait un accord sur le niveau de qualit√© de service (SLA) sur une telle interface, nous le ruinerions imm√©diatement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honn√™tement, c'est exactement ce qui se passe tout le temps de l'API √† JSON, mais c'est une autre histoire, je le jure la prochaine fois ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bases de donn√©es: c'est la m√™me chose</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous travaillez avec des bases de donn√©es, vous comprenez qu'elles sont, en principe, similaires. La base est propri√©taire de ses donn√©es et doit g√©rer le sch√©ma. Toutes les modifications apport√©es au circuit doivent √™tre impl√©ment√©es directement sur DDL afin de mettre √† jour une seule source de v√©rit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'une mise √† jour source a eu lieu, tous les clients doivent √©galement mettre √† jour leurs copies du mod√®le. Certains clients peuvent √™tre √©crits en Java en utilisant jOOQ et Hibernate ou JDBC (ou tous en m√™me temps). D'autres clients peuvent √™tre √©crits en Perl (il reste √† leur souhaiter bonne chance), et d'autres en C #. Ce n'est pas important. Le mod√®le principal est dans la base de donn√©es. Les mod√®les g√©n√©r√©s √† l'aide d'ORM, g√©n√©ralement de mauvaise qualit√©, sont mal document√©s et difficiles √† d√©velopper.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, ne vous trompez pas. </font><font style="vertical-align: inherit;">Ne faites aucune erreur d√®s le d√©part. </font><font style="vertical-align: inherit;">Travaillez √† partir d'une base de donn√©es. </font><font style="vertical-align: inherit;">Cr√©ez un pipeline de d√©ploiement qui peut √™tre automatis√©. </font><font style="vertical-align: inherit;">Activez les g√©n√©rateurs de code pour faciliter la copie de votre mod√®le de base de donn√©es et le vider sur les clients. </font><font style="vertical-align: inherit;">Et arr√™tez de vous soucier des g√©n√©rateurs de code. </font><font style="vertical-align: inherit;">Ils sont bons. </font><font style="vertical-align: inherit;">Avec eux, vous deviendrez plus productif. </font><font style="vertical-align: inherit;">Il vous suffit de passer un peu de temps d√®s le d√©but pour les configurer - et vous aurez alors des ann√©es de productivit√© accrue qui constitueront l'historique de votre projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'ici l√†, merci.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explication</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de clart√©: cet article ne pr√©conise en aucun cas que, selon le mod√®le de votre base de donn√©es, vous devez plier l'ensemble du syst√®me (c'est-√†-dire le domaine, la logique m√©tier, etc., etc.). </font><font style="vertical-align: inherit;">Dans cet article, je dis que le code client qui interagit avec la base de donn√©es doit agir sur la base du mod√®le de base de donn√©es afin qu'il ne reproduise pas le mod√®le de base de donn√©es dans l'√©tat "premi√®re classe". </font><font style="vertical-align: inherit;">Cette logique est g√©n√©ralement situ√©e au niveau de l'acc√®s aux donn√©es sur votre client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les architectures √† deux niveaux, qui sont encore pr√©serv√©es √† certains endroits, un tel mod√®le de syst√®me peut √™tre le seul possible. </font><font style="vertical-align: inherit;">Cependant, dans la plupart des syst√®mes, le niveau d'acc√®s aux donn√©es me semble √™tre un "sous-syst√®me" encapsulant un mod√®le de base de donn√©es.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exceptions</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des exceptions √† toute r√®gle, et j'ai d√©j√† dit qu'une approche avec la primaut√© de la base de donn√©es et la g√©n√©ration de code source peut parfois √™tre inappropri√©e. </font><font style="vertical-align: inherit;">Voici quelques exceptions (il y en a probablement d'autres):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque le circuit est inconnu et qu'il doit √™tre ouvert. </font><font style="vertical-align: inherit;">Par exemple, vous √™tes un fournisseur d'un outil pour aider les utilisateurs √† naviguer dans n'importe quel sch√©ma. </font><font style="vertical-align: inherit;">phew </font><font style="vertical-align: inherit;">Il n'y a pas de g√©n√©ration de code. </font><font style="vertical-align: inherit;">Mais encore - la base de donn√©es est avant tout.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand un circuit doit √™tre g√©n√©r√© √† la vol√©e pour r√©soudre un certain probl√®me. </font><font style="vertical-align: inherit;">Cet exemple semble √™tre une version l√©g√®rement fantaisiste du mod√®le de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur d'attribut d'entit√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-√†-dire que vous n'avez vraiment pas de sch√©ma bien d√©fini. </font><font style="vertical-align: inherit;">Dans ce cas, il est souvent impossible d‚Äô√™tre certain que le SGBDR vous convient.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les exceptions sont intrins√®quement exceptionnelles. </font><font style="vertical-align: inherit;">Dans la plupart des cas impliquant l'utilisation d'un SGBDR, le sch√©ma est connu √† l'avance, il est situ√© √† l'int√©rieur du SGBDR et est la seule source de ¬´v√©rit√©¬ª, et tous les clients doivent acqu√©rir des copies qui en sont d√©riv√©es. </font><font style="vertical-align: inherit;">Id√©alement, vous devez utiliser un g√©n√©rateur de code.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498796/index.html">Politique de s√©curit√© du contenu dans Magento 2</a></li>
<li><a href="../fr498798/index.html">Continuez √† apprendre et √† apprendre avec JetBrains</a></li>
<li><a href="../fr498800/index.html">Comment j'ai appris √† mon ordinateur √† jouer √† Dobble avec OpenCV et Deep Learning</a></li>
<li><a href="../fr498808/index.html">Vim avec prise en charge YAML pour Kubernetes</a></li>
<li><a href="../fr498814/index.html">Vous avez √©chou√© une question th√©orique sur la s√©curit√© sociale, et ils ont mis fin √† vous. C'est normal? // Nous sommes condamn√©s # 3</a></li>
<li><a href="../fr498820/index.html">Quelques questions plus d√©licates sur .NET et C #</a></li>
<li><a href="../fr498826/index.html">SIL et Salesforce</a></li>
<li><a href="../fr498828/index.html">Comment le sel de table et les prot√©ines augmenteront la survie des implants</a></li>
<li><a href="../fr498830/index.html">Hash + cache: optimisation du traitement des flux</a></li>
<li><a href="../fr498832/index.html">Pr√©sentation des possibilit√©s de Qt Creator 4.12 et QBS 1.16 pour la programmation de microcontr√¥leurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>