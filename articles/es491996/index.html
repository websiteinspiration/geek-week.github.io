<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüîß üë¨ ü¶á M√°s acerca de Coroutines en C ++ üë∞ üë®üèª‚Äçüè´ üë®üèº‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola colegas. 
 
 Como parte del estudio del tema C ++ 20, en un momento nos encontramos con un art√≠culo bastante antiguo (septiembre de 2018) del hub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>M√°s acerca de Coroutines en C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/491996/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola colegas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como parte del estudio del tema C ++ 20, en un momento nos encontramos con un art√≠culo bastante antiguo (septiembre de 2018) del hublog de Yandex, que se llama " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparaci√≥n para C ++ 20. Coroutines TS con un ejemplo real</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Termina con el siguiente voto muy expresivo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a-/m4/xn/a-m4xn5j3yjfy-yl2et7aeek7sc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"¬øPor qu√© no?", Decidimos y tradujimos un art√≠culo de David Pilarski bajo el t√≠tulo "Introducci√≥n de Coroutines". El art√≠culo fue publicado hace poco m√°s de un a√±o, pero espero que sea muy interesante de todos modos.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces sucedi√≥. Despu√©s de muchas dudas, controversia y preparaci√≥n de esta caracter√≠stica, WG21 lleg√≥ a una opini√≥n com√∫n sobre c√≥mo deber√≠an verse las corutinas en C ++, y es muy probable que se incluyan en C ++ 20. Dado que esta es una caracter√≠stica importante, creo que es hora de prepararla y estudiarla ya. ahora (como recordar√°, todav√≠a hay m√°s m√≥dulos, conceptos, rangos para aprender ...) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchos a√∫n se oponen a la rutina. A menudo se quejan de la complejidad de su desarrollo, muchos puntos de personalizaci√≥n y, posiblemente, un rendimiento sub√≥ptimo debido, posiblemente, a una asignaci√≥n de memoria din√°mica poco optimizada (quiz√°s;)).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paralelamente al desarrollo de especificaciones t√©cnicas (TS) aprobadas (publicadas oficialmente), incluso se han hecho intentos para desarrollar paralelamente otro mecanismo de corutina. </font><font style="vertical-align: inherit;">Aqu√≠ hablaremos sobre las corutinas que se describen en TS ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especificaci√≥n t√©cnica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Un enfoque alternativo, a su vez, pertenece a Google. </font><font style="vertical-align: inherit;">Como resultado, result√≥ que el enfoque de Google sufre numerosos problemas, cuya soluci√≥n a menudo requiere caracter√≠sticas extra√±as de C ++ adicionales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final, se decidi√≥ adoptar una versi√≥n de Corutin desarrollada por Microsoft (patrocinada por TS). </font><font style="vertical-align: inherit;">Se trata de tales corutinas que se discutir√°n en este art√≠culo. </font><font style="vertical-align: inherit;">Entonces, comencemos con la cuesti√≥n de ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© son las corutinas?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las corutinas ya existen en muchos lenguajes de programaci√≥n, por ejemplo, en Python o C #. </font><font style="vertical-align: inherit;">Las rutinas son otra forma de crear c√≥digo asincr√≥nico. </font><font style="vertical-align: inherit;">La forma en que difieren de los flujos, por qu√© las corutinas deben implementarse como una funci√≥n de lenguaje dedicada y, finalmente, cu√°l es su uso se explicar√° en esta secci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe un grave malentendido sobre lo que son las corutinas. </font><font style="vertical-align: inherit;">Dependiendo del entorno en el que se usan, se les puede llamar:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corutinas apiladas</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pila de corutinas</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corrientes verdes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fibras</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gorutins</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La buena noticia: las corutinas apiladas, las corrientes verdes, las fibras y las gorutinas son la misma cosa (pero a veces se usan de diferentes maneras). Hablaremos de ellos m√°s adelante en este art√≠culo y los llamaremos fibras o corutinas de pila. Pero la rutina sin pila tiene algunas caracter√≠sticas que deben discutirse por separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comprender las rutinas, incluso en un nivel intuitivo, conozcamos brevemente las funciones y (dig√°moslo as√≠) "su API". La forma est√°ndar de trabajar con ellos es llamar y esperar hasta que termine:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span>{
     <span class="hljs-keyword">return</span>; <span class="hljs-comment">//     </span><font></font>
}	<font></font>
foo(); <span class="hljs-comment">//   / </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de llamar a la funci√≥n, ya es imposible pausar o reanudar su trabajo. Solo puede realizar dos operaciones en las funciones: </font></font><code>start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>finish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cuando se inicia la funci√≥n, debe esperar hasta que se complete. Si se vuelve a llamar a la funci√≥n, su ejecuci√≥n se realizar√° desde el principio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con las corutinas, la situaci√≥n es diferente. No solo puede iniciarlos y detenerlos, sino tambi√©n pausarlos y reanudarlos. Todav√≠a son diferentes de los flujos centrales, porque las corutinas en s√≠ mismas no se est√°n desplazando (por otro lado, las corutinas generalmente fluyen y el flujo se est√° desplazando). Para entender esto, considere un generador definido en Python. Que tal cosa se llame generador en Python, en C ++ se llamar√≠a corutina. Se toma un ejemplo de este </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sitio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_nums</span>():</span>
     num = <span class="hljs-number">0</span>
     <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
          <span class="hljs-keyword">yield</span> num<font></font>
          num = num + <span class="hljs-number">1</span>	<font></font>
<font></font>
nums = generate_nums()<font></font>
	<font></font>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> nums:<font></font>
     print(x)<font></font>
	<font></font>
     <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">9</span>:
          <span class="hljs-keyword">break</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como funciona este c√≥digo: una llamada </font></font><code>generate_nums</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a la </font><font style="vertical-align: inherit;">funci√≥n </font><font style="vertical-align: inherit;">conduce a la creaci√≥n de un objeto de rutina. </font><font style="vertical-align: inherit;">En cada paso de enumerar un objeto de rutina, la misma reanuda el trabajo y lo detiene solo despu√©s de una palabra clave </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el c√≥digo; </font><font style="vertical-align: inherit;">entonces se devuelve el siguiente entero de la secuencia (el bucle for es az√∫car sint√°ctico para llamar a una funci√≥n </font></font><code>next()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que reanuda la rutina). </font><font style="vertical-align: inherit;">El c√≥digo finaliza el ciclo al encontrar una declaraci√≥n de interrupci√≥n. </font><font style="vertical-align: inherit;">En este caso, la corutina nunca termina, pero es f√°cil imaginar una situaci√≥n en la que la corutina llega al final y termina. </font><font style="vertical-align: inherit;">Como podemos ver, a una korutine operaciones aplicables </font></font><code>start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>suspend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>resume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y, finalmente,</font></font><code>finish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">[Nota: C ++ tambi√©n proporciona operaciones de creaci√≥n y destrucci√≥n, pero no son importantes en el contexto de una comprensi√≥n intuitiva de la rutina].</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coroutines como una biblioteca</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ahora est√° aproximadamente claro qu√© son las corutinas. </font><font style="vertical-align: inherit;">Puede saber que hay bibliotecas para crear objetos de fibra. </font><font style="vertical-align: inherit;">La pregunta es, ¬øpor qu√© necesitamos corutinas en forma de una funci√≥n de lenguaje dedicada, y no solo una biblioteca que funcione con las rutinas? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ estamos tratando de responder a esta pregunta y demostrar la diferencia entre las rutinas apiladas y sin pila. </font><font style="vertical-align: inherit;">Esta diferencia es clave para entender la corutina como parte del lenguaje.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pila de corutinas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, primero analicemos qu√© son las corutinas de la pila, c√≥mo funcionan y por qu√© pueden implementarse como una biblioteca. </font><font style="vertical-align: inherit;">Explicarlos es relativamente simple, porque se parecen a las secuencias en t√©rminos de dise√±o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fibra o pila corutina tiene una pila separada que se puede usar para manejar llamadas a funciones. </font><font style="vertical-align: inherit;">Para comprender exactamente c√≥mo funcionan las rutinas de este tipo, examinamos brevemente los marcos de funciones y las llamadas a funciones desde un punto de vista de bajo nivel. </font><font style="vertical-align: inherit;">Pero primero, hablemos de las propiedades de las fibras.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tienen su propia pila,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La vida √∫til de las fibras no depende del c√≥digo que las llama (generalmente tienen un planificador definido por el usuario),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las fibras se pueden separar de un hilo y unir a otro,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Planificaci√≥n cooperativa (la fibra debe decidir cambiar a otra fibra / programador),</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No se puede trabajar simult√°neamente en el mismo hilo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los siguientes efectos resultan de las propiedades anteriores:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El usuario debe cambiar el contexto de las fibras y no el sistema operativo (adem√°s, el sistema operativo puede liberar la fibra y liberar el hilo en el que funciona).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No hay una carrera real de datos entre las dos fibras, ya que en un momento dado solo una de ellas puede estar activa,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El dise√±ador de fibra debe poder elegir el lugar y la hora correctos, d√≥nde y cu√°ndo es apropiado devolver la potencia inform√°tica a un posible programador o llamante.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las operaciones de entrada / salida en la fibra deben ser as√≠ncronas, para que otras fibras puedan realizar sus tareas sin bloquearse entre s√≠.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora echemos un vistazo m√°s de cerca al funcionamiento de las fibras y primero expliquemos c√≥mo la pila participa en las llamadas a funciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, la pila es un bloque continuo de memoria necesaria para almacenar variables locales y argumentos de funci√≥n. Pero, lo que es m√°s importante, despu√©s de cada llamada a la funci√≥n (con algunas excepciones), se inserta informaci√≥n adicional en la pila que le dice a la funci√≥n llamada c√≥mo regresar al llamador y restaurar los registros del procesador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunos de estos registros tienen asignaciones especiales y, al llamar a funciones, se almacenan en la pila. Estos son los registros (en el caso de la arquitectura ARM): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SP - puntero de pila </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LR - </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PC de </font><font style="vertical-align: inherit;">registro de comunicaci√≥n </font><font style="vertical-align: inherit;">- </font><b><font style="vertical-align: inherit;">puntero de pila de</font></b><font style="vertical-align: inherit;"> contador de programa</font></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(SP) es un registro que contiene la direcci√≥n del comienzo de la pila relacionada con la llamada a la funci√≥n actual. Gracias al valor existente, puede referirse f√°cilmente a argumentos y variables locales almacenadas en la pila. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El registro de comunicaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (LR) es muy importante cuando se llaman funciones. Almacena la direcci√≥n de retorno (la direcci√≥n de la parte llamante), donde el c√≥digo se ejecutar√° despu√©s de que se complete la ejecuci√≥n de la funci√≥n actual. Cuando se llama a la funci√≥n, la PC se guarda en LR. Cuando la funci√≥n regresa, la PC se restaura usando LR. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program Counter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (PC) es la direcci√≥n de la instrucci√≥n que se est√° ejecutando actualmente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada vez que se llama a una funci√≥n, se guarda la lista de enlaces, de modo que la funci√≥n sepa a d√≥nde debe regresar el programa una vez que finalice.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nj/r2/yk/njr2ykw0o6hrsww5-uq3ybjjddg.png"><br>
 <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El comportamiento de los registros de PC y LR al llamar y devolver una funci√≥n</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Al ejecutar la rutina de pila, las funciones llamadas usan la pila previamente asignada para almacenar sus argumentos y variables locales. </font><font style="vertical-align: inherit;">Dado que toda la informaci√≥n sobre cada funci√≥n llamada en la pila de corutina se almacena en la pila, la fibra puede suspender cualquier funci√≥n dentro de esta corutina. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nj/r2/yk/njr2ykw0o6hrsww5-uq3ybjjddg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos qu√© pasa en esta imagen. </font><font style="vertical-align: inherit;">En primer lugar, cada fibra e hilo tiene su propia pila separada. </font><font style="vertical-align: inherit;">El color verde indica n√∫meros de serie que indican la secuencia de acciones.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una llamada de funci√≥n regular dentro de un hilo. </font><font style="vertical-align: inherit;">La memoria se asigna en la pila.</font></font></li>
<li><b>   </b>.      .     ,      .    .       ,              . </li>
<li>  .</li>
<li><b> </b>.       .</li>
<li>    .</li>
<li>    .</li>
<li><b> </b>.    ,    , ,      .</li>
<li>    .</li>
<li>    .</li>
<li><b> </b> ‚Äì     ,     . </li>
<li>        ,      .</li>
<li>    .      . </li>
<li>       .    :   ,    . ,          (  ) .</li>
<li>  ,   .</li>
<li>  .</li>
<li><b> </b>.   .     .    ,      .</li>
<li>     .</li>
<li>      , ,     .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se trabaja con rutinas de pila, no hay necesidad de una funci√≥n de lenguaje dedicada que garantice su uso. </font><font style="vertical-align: inherit;">El conjunto completo de korutiny puede implementarse utilizando bibliotecas, y ya existen bibliotecas dise√±adas espec√≠ficamente para este prop√≥sito: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swtch.com/libtask </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code.google.com/archive/p/libconcurrency </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.boost.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Boost.Fiber </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.boost.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the Boost .Coroutine </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De todas estas bibliotecas, solo Boost es C ++, y el resto son C. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obtener una descripci√≥n detallada de c√≥mo funcionan estas bibliotecas, </font><font style="vertical-align: inherit;">consulte la </font><font style="vertical-align: inherit;">documentaci√≥n. </font><font style="vertical-align: inherit;">Pero, en general, todas estas bibliotecas le permiten crear una pila separada para fibra y brindan la oportunidad de reanudar la rutina (a iniciativa de la persona que llama) y pausarla (desde adentro).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere un ejemplo </font></font><code>Boost.Fiber</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;thread&gt;</span></span><font></font>
	<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/intrusive_ptr.hpp&gt;</span></span><font></font>
	<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/fiber/all.hpp&gt;</span></span><font></font>
	<font></font>
<span class="hljs-function"><span class="hljs-keyword">inline</span>
<span class="hljs-keyword">void</span> <span class="hljs-title">fn</span><span class="hljs-params">( <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-keyword">const</span>&amp; str, <span class="hljs-keyword">int</span> n)</span> </span>{
     <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) {
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; str &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
               boost::this_fiber::yield();<font></font>
     }<font></font>
}<font></font>
	<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
     <span class="hljs-keyword">try</span> {<font></font>
          boost::<span class="hljs-function">fibers::fiber <span class="hljs-title">f1</span><span class="hljs-params">( fn, <span class="hljs-string">"abc"</span>, <span class="hljs-number">5</span>)</span></span>;
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"f1 : "</span> &lt;&lt; f1.get_id() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
          f1.join();<font></font>
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"done."</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
	<font></font>
          <span class="hljs-keyword">return</span> EXIT_SUCCESS;<font></font>
     } <span class="hljs-keyword">catch</span> ( <span class="hljs-built_in">std</span>::exception <span class="hljs-keyword">const</span>&amp; e) {
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"exception: "</span> &lt;&lt; e.what() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
     } <span class="hljs-keyword">catch</span> (...) {
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"unhandled exception"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
     }<font></font>
     <span class="hljs-keyword">return</span> EXIT_FAILURE;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boost.Fiber</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la biblioteca tiene un programador incorporado para la rutina. </font><font style="vertical-align: inherit;">Todas las fibras corren en el mismo hilo. </font><font style="vertical-align: inherit;">Dado que la planificaci√≥n de corutina es cooperativa, la fibra primero debe decidir cu√°ndo devolver el control al planificador. </font><font style="vertical-align: inherit;">En este ejemplo, esto sucede cuando se llama a la funci√≥n de rendimiento, que detiene la corutina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como no hay otra fibra, el planificador de fibra siempre decide reanudar la rutina.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corutinas apiladas</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las corutinas apiladas difieren ligeramente en propiedades de las apiladas. </font><font style="vertical-align: inherit;">Sin embargo, tienen las mismas caracter√≠sticas b√°sicas, ya que las corutinas no apiladas tambi√©n pueden iniciarse, y despu√©s de reanudar su suspensi√≥n. </font><font style="vertical-align: inherit;">Coroutinas de este tipo es probable que encontremos en C ++ 20. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hablamos de las propiedades similares de la corutina, las corutinas pueden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corutin est√° estrechamente relacionada con su interlocutor: cuando se llama a una rutina, la ejecuci√≥n se transfiere a ella, y el resultado de la rutina se transfiere nuevamente a la persona que llama.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La vida √∫til de una pila de corutina es igual a la vida de su pila. </font><font style="vertical-align: inherit;">La vida √∫til de una corutina sin pila es igual a la vida de su objeto.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, en el caso de las rutinas sin pila, no hay necesidad de asignar una pila completa. Consumen mucha menos memoria que las de pila, pero esto se debe precisamente a algunas de sus limitaciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, si no asignan memoria para la pila, ¬øc√≥mo funcionan? Donde, en su caso, van todos los datos que deben almacenarse en la pila cuando se trabaja con las rutinas de la pila. Respuesta: en la pila de la persona que llama.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El secreto de las rutinas apiladas es que solo pueden suspenderse de la funci√≥n superior. Para todas las dem√°s funciones, sus datos se encuentran en la pila del lado llamado, por lo que todas las funciones llamadas desde corutina deben completarse antes de suspender el trabajo de la corutina. Todos los datos que necesita la rutina para mantener su estado se asignan din√°micamente en el mont√≥n. Esto generalmente requiere un par de variables y argumentos locales, que son mucho m√°s compactos que una pila completa que deber√≠a asignarse por adelantado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eche un vistazo a c√≥mo funcionan las corutinas sin pila: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ow/vc/nw/owvcnwldgczpxdmjorsjlrh3yvm.png"><br>
 <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desafiando una corutina sin pila</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, ahora solo hay una pila: esta es la pila principal del hilo. </font><font style="vertical-align: inherit;">Echemos un vistazo paso a paso a lo que se muestra en esta imagen (el marco de activaci√≥n de rutina aqu√≠ es de dos colores: el negro muestra lo que est√° almacenado en la pila y el azul, lo que est√° almacenado en el mont√≥n).</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una llamada a funci√≥n regular cuyo marco est√° almacenado en la pila</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La funci√≥n crea una corutina</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es decir, asigna un marco de activaci√≥n para √©l en alg√∫n lugar del mont√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Llamada de funci√≥n normal.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Llama a Corutin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">El cuerpo de Corutin se destaca en una pila regular. </font><font style="vertical-align: inherit;">El programa se ejecuta de la misma manera que en el caso de una funci√≥n regular.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una llamada de funci√≥n regular desde la rutina. </font><font style="vertical-align: inherit;">Una vez m√°s, todo sigue sucediendo en la pila [Nota: no puede pausar la rutina desde este punto, ya que esta no es la funci√≥n m√°s importante en la rutina]</font></font></li>
<li>       [:     .]</li>
<li>  ‚Äì  ,        ,     .</li>
<li>  </li>
<li><b>  </b> ‚Äì      ,        +     .</li>
<li>     5.</li>
<li>     6.</li>
<li><b> </b>.        .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, es obvio que en el segundo caso es necesario recordar muchos menos datos para todas las operaciones de pausa y reanudaci√≥n del trabajo de corutina, sin embargo, la rutina puede reanudarse y pausarse solo a s√≠ misma, y ‚Äã‚Äãsolo desde la funci√≥n m√°s alta. Todas las llamadas a funciones y la rutina ocurren de la misma manera, sin embargo, entre llamadas se requiere guardar algunos datos adicionales, y la funci√≥n debe poder saltar al punto de suspensi√≥n y restaurar el estado de las variables locales. No hay otras diferencias entre el marco de la rutina y el marco de la funci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La corutina tambi√©n puede causar otras corutinas (no se muestran en este ejemplo). </font><font style="vertical-align: inherit;">En el caso de las rutinas sin pila, cada llamada da como resultado la asignaci√≥n de un nuevo espacio para nuevos datos de la rutina (con una llamada repetida de la rutina, la memoria din√°mica tambi√©n se puede asignar varias veces). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La raz√≥n por la cual las corutinas necesitan proporcionar una funci√≥n de lenguaje dedicada es porque el compilador necesita decidir qu√© variables describen el estado de la corutina y crear un c√≥digo estereotipado para saltar a los puntos de suspensi√≥n.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso pr√°ctico de la corutina.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las rutinas en C ++ se pueden usar de la misma manera que en otros lenguajes. </font><font style="vertical-align: inherit;">Las rutinas simplificar√°n la ortograf√≠a:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generadores</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo de entrada / salida as√≠ncrono </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">computaci√≥n perezosa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaciones conducidas por eventos</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que al leer este art√≠culo descubras:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por qu√© en C ++ necesitas implementar corutinas como una caracter√≠stica de lenguaje dedicada</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øCu√°l es la diferencia entre corutinas apiladas y apiladas?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por qu√© se necesitan corutinas</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es491986/index.html">RemoteLoRa - M√°s que ENCENDIDO / APAGADO</a></li>
<li><a href="../es491988/index.html">¬øQu√© hay de nuevo en Red Hat OpenShift 4.2 y 4.3?</a></li>
<li><a href="../es491990/index.html">Trabajar con el chip chino ADC Hx711 (conclusi√≥n)</a></li>
<li><a href="../es491992/index.html">Desarrollo analista</a></li>
<li><a href="../es491994/index.html">Migraci√≥n de Cocoapods a Swift Package Manager</a></li>
<li><a href="../es492000/index.html">Producto muy primero. Agotamiento</a></li>
<li><a href="../es492002/index.html">Alas absorbentes de luz: el secreto de las mariposas s√∫per negras</a></li>
<li><a href="../es492004/index.html">C√≥mo pasar de programador a gerente ("Quiero ser la amante del mar")</a></li>
<li><a href="../es492006/index.html">El poder de PWA: un sistema de videovigilancia con un c√≥digo JS de red neuronal de 300 l√≠neas</a></li>
<li><a href="../es492008/index.html">Resultados de la investigaci√≥n de motivaci√≥n de TI: ¬øest√°n contentos los desarrolladores con su trabajo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>