<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘´ğŸ¿ ğŸ•·ï¸ ğŸ¼ ç”¨Patroniå´©æºƒçš„æ•…äº‹ï¼Œæˆ–å¦‚ä½•åˆ é™¤PostgreSQLé›†ç¾¤ ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ğŸ‘©ğŸ½â€ğŸ“ ğŸ‘©ğŸ¾â€ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PostgreSQLæ²¡æœ‰å¼€ç®±å³ç”¨çš„é«˜å¯ç”¨æ€§ã€‚è¦å®ç°HAï¼Œæ‚¨éœ€è¦æŠ•å…¥ä¸€äº›ç²¾åŠ›ï¼Œç„¶åè¿›è¡Œè®¾ç½®-ä»˜å‡ºåŠªåŠ›ã€‚æœ‰å‡ ç§å·¥å…·å¯ä»¥å¸®åŠ©æé«˜PostgreSQLçš„å¯ç”¨æ€§ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯Patroniã€‚
 
 ä¹ä¸€çœ‹ï¼Œå°†Paâ€‹â€‹troniç½®äºæµ‹è¯•ç¯å¢ƒä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œä»¥åŠå¦‚ä½•è½»æ¾åœ°å¤„ç†æˆ‘ä»¬ç ´åé›†ç¾¤çš„å°è¯•ã€‚ä½†æ˜¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ç”¨Patroniå´©æºƒçš„æ•…äº‹ï¼Œæˆ–å¦‚ä½•åˆ é™¤PostgreSQLé›†ç¾¤</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/489206/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQLæ²¡æœ‰å¼€ç®±å³ç”¨çš„é«˜å¯ç”¨æ€§ã€‚è¦å®ç°HAï¼Œæ‚¨éœ€è¦æŠ•å…¥ä¸€äº›ç²¾åŠ›ï¼Œç„¶åè¿›è¡Œè®¾ç½®-ä»˜å‡ºåŠªåŠ›ã€‚æœ‰å‡ ç§å·¥å…·å¯ä»¥å¸®åŠ©æé«˜PostgreSQLçš„å¯ç”¨æ€§ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯Patroniã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹ä¸€çœ‹ï¼Œå°†Paâ€‹â€‹troniç½®äºæµ‹è¯•ç¯å¢ƒä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œä»¥åŠå¦‚ä½•è½»æ¾åœ°å¤„ç†æˆ‘ä»¬ç ´åé›†ç¾¤çš„å°è¯•ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¹¶éæ‰€æœ‰äº‹ç‰©éƒ½æ€»æ˜¯å¦‚æ­¤ä¼˜ç¾å’Œä¼˜é›…ã€‚ Data Egretäº2018å¹´åº•å¼€å§‹ä½¿ç”¨Patroniï¼Œå¹¶è·å¾—äº†ä¸€äº›ç»éªŒï¼šå¦‚ä½•è¯Šæ–­ï¼Œé…ç½®å®ƒä»¥åŠä½•æ—¶å®Œå…¨ä¸ä¾èµ–è‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨HighLoad ++ä¸Šï¼ŒAlexei Lesovskyä½¿ç”¨ç¤ºä¾‹å’Œæ—¥å¿—åˆ†æè¯¦ç»†æè¿°äº†ä¸Patroniåˆä½œæ—¶å‡ºç°çš„å…¸å‹é—®é¢˜ï¼Œä»¥åŠå…‹æœè¿™äº›é—®é¢˜çš„æœ€ä½³å®è·µã€‚</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lqh1eJwVPtk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡ä¸ä¼šï¼šPatroniå®‰è£…è¯´æ˜å’Œé…ç½®ç¤ºä¾‹ï¼›</font><font style="vertical-align: inherit;">Patroniå’ŒPostgreSQLä»¥å¤–çš„é—®é¢˜ï¼›</font><font style="vertical-align: inherit;">è¿™äº›æ•…äº‹æ˜¯åŸºäºä»–äººçš„ç»éªŒï¼Œä½†ä»…æ˜¯æ•°æ®ç™½é¹­è‡ªå·±è§£å†³çš„é—®é¢˜ã€‚</font></font><br>
<a name="habracut"></a><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³äºæ¼”è®²è€…ï¼š</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alexey Lesovskyï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ—ç´¢å¤«æ–¯åŸº</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰æœ€åˆæ˜¯ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆLinuxç³»ç»Ÿç®¡ç†å‘˜ï¼‰ï¼Œç„¶åæ˜¯ç½‘ç»œå¼€å‘äººå‘˜ï¼ˆPostgreSQLæ•°æ®åº“ç®¡ç†å‘˜ï¼‰ã€‚</font><font style="vertical-align: inherit;">è‡ª2014å¹´ä»¥æ¥ï¼Œå¥¹ä¸€ç›´åœ¨Data Egretå·¥ä½œã€‚</font><font style="vertical-align: inherit;">Data Egretä»äº‹PostgreSQLé¢†åŸŸçš„å’¨è¯¢ï¼Œå¸®åŠ©è®¸å¤šè®¸å¤šå…¬å¸æ­£ç¡®ä½¿ç”¨PostgreSQLï¼Œå½“ç„¶ï¼Œåœ¨æ“ä½œæ•°æ®åº“æ–¹é¢ä¹Ÿç§¯ç´¯äº†ä¸°å¯Œçš„ç»éªŒã€‚</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æ–‡æ‰€åŸºäºçš„æŠ¥å‘Šç§°ä¸ºâ€œ Patroniæ•…éšœæ¡ˆä¾‹æˆ–å¦‚ä½•ä½¿PostgreSQLé›†ç¾¤å´©æºƒâ€ï¼Œè¿™æ˜¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥æ¼”ç¤ºæ–‡ç¨¿</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">é“¾æ¥</font></a><font style="vertical-align: inherit;">ã€‚</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä½ å¼€å§‹ä¹‹å‰</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘æé†’æ‚¨ä»€ä¹ˆæ˜¯Patroniï¼Œå®ƒçš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œå®ƒå¯ä»¥åšä»€ä¹ˆã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroniæ˜¯å¼€ç®±å³ç”¨åœ°æ„å»ºHAçš„æ¨¡æ¿ã€‚</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€ä»¥å®ƒæ˜¯å†™åœ¨æ–‡æ¡£ä¸­çš„ï¼Œä»æˆ‘çš„è§’åº¦æ¥çœ‹-è¿™æ˜¯ä¸€ä¸ªéå¸¸æ­£ç¡®çš„è¯´æ˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¸•ç‰¹ç½—å°¼ä¸æ˜¯ä»–è®¾å®šçš„ä¸‡çµè¯ï¼Œå®ƒå°†è§£å†³æ‰€æœ‰é—®é¢˜ã€‚å¿…é¡»åŠªåŠ›ä½¿å®ƒå¼€å§‹èµ·ä½œç”¨å¹¶å¸¦æ¥å¥½å¤„ã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroni-ä»£ç†æœåŠ¡ã€‚</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒä¸æ•°æ®åº“ä¸€èµ·å®‰è£…åœ¨æ¯å°æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”æ˜¯PostgreSQLçš„ä¸€ç§åˆå§‹åŒ–ç³»ç»Ÿï¼šå®ƒå¯åŠ¨ï¼Œåœæ­¢ï¼Œé‡æ–°å¯åŠ¨ï¼Œæ›´æ”¹é›†ç¾¤çš„é…ç½®å’Œæ‹“æ‰‘ã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroniåœ¨DCSä¸­å­˜å‚¨â€œé›†ç¾¤çŠ¶æ€â€ã€‚</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å­˜å‚¨é›†ç¾¤çŠ¶æ€åŠå…¶å½“å‰è§†å›¾ï¼Œéœ€è¦å­˜å‚¨ã€‚</font><font style="vertical-align: inherit;">Patroniå°†çŠ¶æ€å­˜å‚¨åœ¨å¤–éƒ¨ç³»ç»Ÿä¸­-åˆ†å¸ƒå¼é…ç½®å­˜å‚¨åº“ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥æ˜¯ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ï¼šEtcdï¼ŒConsulï¼ŒZooKeeperæˆ–Etcd Kubernetesã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹å¯ç”¨Patroni AutoFileã€‚</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®‰è£…Patroniä¹‹åï¼Œæ‚¨å°†ç«‹å³è·å¾—è‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦å¤–ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–äº‹æƒ…ï¼Œä¾‹å¦‚ï¼šæœåŠ¡é…ç½®ï¼Œåˆ›å»ºæ–°å‰¯æœ¬ï¼Œå¤‡ä»½ç­‰ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™ä¸€æ¬¡å°†ä¸åœ¨æŠ¥å‘ŠèŒƒå›´å†…ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroniçš„ä¸»è¦ç›®çš„æ˜¯æä¾›å¯é çš„è‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patroniä¸å¿…ç›‘è§†è®¾å¤‡ï¼Œå‘é€é€šçŸ¥ï¼Œè¿›è¡Œæœ‰å…³æ½œåœ¨äº‹æ•…é¢„é˜²çš„å¤æ‚å·¥ä½œç­‰ã€‚</font><font style="vertical-align: inherit;">è¦æ±‚é›†ç¾¤ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”æ— è®ºé›†ç¾¤æ‹“æ‰‘å¦‚ä½•æ›´æ”¹ï¼Œåº”ç”¨ç¨‹åºéƒ½å¯ä»¥ç»§ç»­ä½¿ç”¨æ•°æ®åº“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å¼€å§‹å°†Patroniä¸PostgreSQLç»“åˆä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¼šå˜å¾—æ›´åŠ å¤æ‚ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œé™¤äº†æ•°æ®åº“æœ¬èº«ä¹‹å¤–ï¼Œå½“ä¸»æœåŠ¡å™¨æˆ–å‰¯æœ¬æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼ŒPatroniæœ¬èº«ï¼Œç¾¤é›†çŠ¶æ€çš„åˆ†å¸ƒå¼å­˜å‚¨æˆ–ç½‘ç»œå¯èƒ½ä¼šå´©æºƒã€‚</font><font style="vertical-align: inherit;">è€ƒè™‘æ‰€æœ‰é€‰é¡¹ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç†è§£å…¶åŸå› çš„éš¾åº¦æ–¹é¢å˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜1. DBMSå’ŒDCSåœ¨åŒä¸€ç¾¤é›†ä¸Š</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è€ƒè™‘æœ€ç®€å•çš„æƒ…å†µï¼šæˆ‘ä»¬é‡‡ç”¨ä¸€ä¸ªæ•°æ®åº“é›†ç¾¤ï¼Œå¹¶å°†DCSéƒ¨ç½²åœ¨åŒä¸€é›†ç¾¤ä¸Šã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ªå¸¸è§é”™è¯¯ä¸ä»…ä¸PostgreSQLå’ŒPatroniéƒ¨ç½²é”™è¯¯æœ‰å…³ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä½“ç³»ç»“æ„çš„ä¸€èˆ¬æ„é€ ä¸­çš„ä¸€ä¸ªé”™è¯¯-å°†è®¸å¤šä¸åŒçš„ç»„ä»¶æ•´åˆåˆ°ä¸€ä¸ªä½ç½®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œè¿›è¡Œäº†æ•…éšœè½¬ç§»ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¼€å§‹äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹è¿‡æ¸¡å‘ç”Ÿçš„</font><strong><font style="vertical-align: inherit;">æ—¶é—´ï¼ˆå³é›†ç¾¤çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶é—´ç‚¹ï¼‰</font></strong><font style="vertical-align: inherit;">æ„Ÿå…´è¶£</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></strong><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•…éšœè½¬ç§»ä½•æ—¶å‘ç”Ÿï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤±è´¥å¹¶éæ€»æ˜¯ç«‹å³å‘ç”Ÿï¼›è¿™å¯èƒ½å¾ˆè€—æ—¶ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå®ƒå…·æœ‰å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰äº‹ä»¶éƒ½è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šâ€œå˜èŠ‚ä¹‹å‰â€ï¼Œâ€œæœŸé—´â€å’Œâ€œä¹‹åâ€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œå½“feyloverå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾åŸå› ã€‚</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-2 patroni: INFO: promoted self to leader by acquiring session lock<font></font>
pgdb-2 patroni: WARNING: Loop time exceeded, rescheduling immediately.<font></font>
pgdb-2 patroni: INFO: Lock owner: pgdb-2; I am pgdb-2<font></font>
pgdb-2 patroni: INFO: updated leader lock during promote<font></font>
pgdb-2 patroni: server promoting<font></font>
pgdb-2 patroni: INFO: cleared rewind state after becoming the leader<font></font>
pgdb-2 patroni: INFO: Lock owner: pgdb-2; I am pgdb-2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸Šé¢æ˜¯æ ‡å‡†çš„Patroniæ—¥å¿—ï¼Œä»–åœ¨å…¶ä¸­æŠ¥å‘ŠæœåŠ¡å™¨è§’è‰²å·²æ›´æ”¹ï¼Œå‘å¯¼çš„è§’è‰²å·²ä»å¦ä¸€ä¸ªè§’è‰²ç§»åˆ°è¯¥èŠ‚ç‚¹ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ•…éšœè½¬ç§»ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦äº†è§£å“ªäº›äº‹ä»¶ä½¿ä¸»æœåŠ¡å™¨çš„è§’è‰²ä»ä¸€ä¸ªèŠ‚ç‚¹è½¬ç§»åˆ°äº†å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»¥åŠæ—§ä¸»æœåŠ¡å™¨å‘ç”Ÿäº†ä»€ä¹ˆã€‚</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-2 patroni: patroni.utils.RetryFailedError: 'Exceeded retry deadline'<font></font>
pgdb-2 patroni: ERROR: Error communicating with DCS<font></font>
pgdb-2 patroni: INFO: demoted self because DCS is not accessible and i was a leader<font></font>
pgdb-2 patroni: WARNING: Loop time exceeded, rescheduling immediately.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼š</font></font><code>Error communicating with DCS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ä¸é…ç½®å­˜å‚¨ç³»ç»Ÿäº¤äº’æ—¶å‡ºé”™ã€‚</font><font style="vertical-align: inherit;">èˆ¹é•¿æ„è¯†åˆ°ä»–ä¸èƒ½ä¸DCSåˆä½œï¼Œå¹¶è¯´ä»–ä¸èƒ½å†å½“èˆ¹é•¿è€Œè¾èŒã€‚</font></font><code>demoted self</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ˆåˆ°è¿™ä¸ªã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">feyloverä¹‹å‰æ˜¯ä»€ä¹ˆï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæŸ¥çœ‹feyloverä¹‹å‰çš„äº‹ä»¶ï¼Œåˆ™å¯ä»¥çœ‹åˆ°æˆä¸ºå‘å¯¼ç»§ç»­å­˜åœ¨é—®é¢˜çš„åŸå› ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-2 patroni: ERROR: touch_member<font></font>
                ... python trace <font></font>
pgdb-2 patroni: socket.timeout: timed out <font></font>
pgdb-2 patroni: During handling of the above exception, another exception occurred:<font></font>
                ... python trace <font></font>
pgdb-2 patroni:   raise ReadTimeoutError(self, url, "Read timed out. (read timeout=%s)" % timeout_value) <font></font>
pgdb-2 patroni: urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='127.0.0.1', port=8500): Read timed out. (read timeout=3.3333333333333335) <font></font>
pgdb-2 patroni: During handling of the above exception, another exception occurred:<font></font>
                ... python trace <font></font>
pgdb-2 patroni:     raise MaxRetryError(_pool, url, error or ResponseError(cause)) <font></font>
pgdb-2 patroni: urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='127.0.0.1', port=8500): Max retries exceeded with url: /v1/kv/service/pgdb/members/pgdb-2?acquire=19598b72-c0d5-f066-5d24-09c1a9ad61ee&amp;dc=maindb (Caused by ReadTimeoutError("HTTPConnectionPool(host='127.0.0.1', port=8500): Read timed out. (read timeout=3.3333333333333335)",)) <font></font>
pgdb-2 patroni: INFO: no action.  i am the leader with the lock <font></font>
pgdb-2 patroni: WARNING: Loop time exceeded, rescheduling immediately.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patroniæ—¥å¿—æ˜¾ç¤ºè®¸å¤šä¸åŒçš„è¶…æ—¶é”™è¯¯ã€‚</font><font style="vertical-align: inherit;">Patroni Agentæ— æ³•ä½¿ç”¨DCSï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯Consulï¼Œç«¯å£= 8500ï¼‰ã€‚</font><font style="vertical-align: inherit;">Patroniå’Œæ•°æ®åº“åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œï¼Œâ€‹â€‹è€ŒConsulæœåŠ¡å™¨åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œã€‚</font><font style="vertical-align: inherit;">åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºäº†è´Ÿè½½ä¹‹åï¼Œæˆ‘ä»¬è¿˜ä¸ºConsulæœåŠ¡å™¨åˆ›å»ºäº†é—®é¢˜ï¼Œå› ä¸ºè¿™äº›é—®é¢˜å¯¼è‡´å®ƒä»¬æ— æ³•æ­£å¸¸é€šä¿¡ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€åˆ‡éƒ½æ¢å¤åŸçŠ¶</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿‡äº†ä¸€ä¼šå„¿ï¼Œå½“è´Ÿè½½å‡å°‘æ—¶ï¼Œæˆ‘ä»¬çš„Patronièƒ½å¤Ÿå†æ¬¡ä¸ä»£ç†è¿›è¡Œé€šä¿¡ï¼Œä¸€åˆ‡æ¢å¤äº†ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-2 patroni: INFO: promoted self to leader by acquiring session lock<font></font>
pgdb-2 patroni: WARNING: Loop time exceeded, rescheduling immediately.<font></font>
pgdb-2 patroni: INFO: Lock owner: pgdb-2; I am pgdb-2<font></font>
pgdb-2 patroni: INFO: updated leader lock during promote<font></font>
pgdb-2 patroni: server promoting<font></font>
pgdb-2 patroni: INFO: cleared rewind state after becoming the leader<font></font>
pgdb-2 patroni: INFO: Lock owner: pgdb-2; I am pgdb-2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒä¸€å°pgdb-2æœåŠ¡å™¨å†æ¬¡æˆä¸ºä¸»æœåŠ¡å™¨ã€‚</font><font style="vertical-align: inherit;">æœ‰ä¸€ä¸ªå°å°çš„â€œç¿»è½¬â€-åœ¨ç›¸å¯¹è¾ƒçŸ­çš„æ—¶é—´å†…ï¼Œä»–è¾å»äº†å¤§å¸ˆèŒåŠ¡ï¼Œç„¶åå†æ¬¡å°†å…¶ç½®äºè‡ªå·±èº«ä¸Šã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™å¯ä»¥è¢«è§†ä¸ºè¯¯æŠ¥ï¼Œä¹Ÿå¯ä»¥è¢«è§†ä¸ºPatroniæ‰€åšçš„ä¸€åˆ‡æ­£ç¡®çš„äº‹å®ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†³æ–­</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬è‡ªå·±å†³å®šé—®é¢˜åœ¨äºConsulæœåŠ¡å™¨ä¸æ•°æ®åº“ä½äºåŒä¸€ç¡¬ä»¶ä¸Šã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼ŒCPUå’Œç£ç›˜ä¸Šçš„ä»»ä½•è´Ÿè½½ï¼ˆå¤§é‡IOè¯·æ±‚ï¼Œä¸´æ—¶æ–‡ä»¶ï¼Œè‡ªåŠ¨æ¸…ç†ï¼Œè¿ç§»ï¼Œå¤‡ä»½ç­‰ï¼‰ä¹Ÿä¼šå½±å“ä¸Consulç¾¤é›†çš„äº¤äº’ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å†³å®šä¸è¦å°†å®ƒä¸æ•°æ®åº“æ”¾åœ¨åŒä¸€è®¾å¤‡ä¸Šï¼Œå¹¶ä¸ºConsulåˆ†é…äº†å•ç‹¬çš„é›†ç¾¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ–è€…ï¼Œä½ å¯ä»¥æ—‹è½¬å‚æ•°</font></font><code>ttl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>loop_wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>retry_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç”±äºå…¶å¢åŠ è®¾æ³•ç”Ÿå­˜çŸ­æœŸå³°å€¼è´Ÿè·ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœè´Ÿè½½å¾ˆé•¿ï¼Œæˆ‘ä»¬å°†è¶…å‡ºè¿™äº›å‚æ•°ï¼Œè¯¥æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜2ã€‚ä¸­æ–­</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬äºŒä¸ªé—®é¢˜ä¸ç¬¬ä¸€ä¸ªé—®é¢˜ç›¸ä¼¼ï¼Œå› ä¸ºæˆ‘ä»¬å†æ¬¡é‡åˆ°ä¸DCSç³»ç»Ÿäº¤äº’çš„é—®é¢˜ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">maindb-1 patroni: ERROR: get_cluster <font></font>
maindb-1 patroni: Traceback (most recent call last):<font></font>
                ... python trace <font></font>
maindb-1 patroni: RetryFailedError: 'Exceeded retry deadline' <font></font>
maindb-1 patroni: ERROR: Error communicating with DCS <font></font>
maindb-1 patroni: INFO: closed patroni connection to the postgresql cluster <font></font>
maindb-1 patroni: INFO: postmaster pid=214121 <font></font>
... <font></font>
... <font></font>
maindb-1 patroni: INFO: demoted self because DCS is not accessible and i was a leader <font></font>
maindb-1 patroni: WARNING: Loop time exceeded, rescheduling immediately.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patroniå†æ¬¡è¯´ï¼Œå®ƒæ— æ³•ä¸DCSè¿›è¡Œäº¤äº’ï¼Œå› æ­¤å½“å‰çš„ä¸»æœåŠ¡å™¨ä¸å†æ˜¯ä¸»æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥å‰¯æœ¬æ¨¡å¼ã€‚</font><font style="vertical-align: inherit;">æ—§çš„æ¯ç‰ˆæˆä¸ºå‰¯æœ¬ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">maindb-1 patroni: INFO: Lock owner: maindb-2; I am maindb-1 <font></font>
maindb-1 patroni: INFO: does not have lock <font></font>
maindb-1 patroni: INFO: running pg_rewind from maindb-2 <font></font>
maindb-1 patroni: INFO: running pg_rewind from user=postgres host=192.168.11.18 port=5432 ... <font></font>
maindb-1 patroni: servers diverged at WAL location 1FA/A38FF4F8 on timeline 6 <font></font>
maindb-1 patroni: rewinding from last common checkpoint at 1FA/A38FF450 on timeline 6 <font></font>
maindb-1 patroni: INFO: Lock owner: maindb-2; I am maindb-1 <font></font>
maindb-1 patroni: INFO: running pg_rewind from maindb-2 in progress <font></font>
maindb-1 patroni: Done!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patroniåœ¨è¿™é‡ŒæŒ‰é¢„æœŸæ–¹å¼å·¥ä½œ-å¯åŠ¨</font></font><code>pg_rewind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥å€’å›äº‹åŠ¡æ—¥å¿—ï¼Œç„¶åè¿æ¥åˆ°æ–°çš„ä¸»æœåŠ¡å™¨å¹¶å·²ç»èµ¶ä¸Šæ–°çš„ä¸»æœåŠ¡å™¨ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">feyloverä¹‹å‰æ˜¯ä»€ä¹ˆï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬æ‰¾åˆ°feyloverä¹‹å‰çš„ç¬¬ä¸€ä»¶äº‹-å¯¼è‡´å®ƒçš„é”™è¯¯ã€‚</font><font style="vertical-align: inherit;">Patroniæ—¥å¿—åœ¨è¿™æ–¹é¢å¾ˆæ–¹ä¾¿ï¼šä»–ä»¥ä¸€å®šé—´éš”å†™å…¥ç›¸åŒçš„æ¶ˆæ¯ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥å¿«é€Ÿæ»šåŠ¨å®ƒä»¬ï¼ŒæŸ¥çœ‹æ—¥å¿—ä½•æ—¶æ›´æ”¹ã€‚</font><font style="vertical-align: inherit;">æ­¤æ—¶ï¼Œä¸€äº›é—®é¢˜å¼€å§‹äº†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼ŒPatroniæ—¥å¿—å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="xml hljs">maindb-1 patroni: INFO: Lock owner: maindb-1; I am maindb-1<font></font>
maindb-1 patroni: INFO: no action. i am the leader with the lock<font></font>
maindb-1 patroni: INFO: Lock owner: maindb-1; I am maindb-1<font></font>
maindb-1 patroni: INFO: no action. i am the leader with the lock</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ£€æŸ¥é”çš„æ‰€æœ‰è€…ï¼Œå¦‚æœæ›´æ”¹äº†ï¼Œå¯èƒ½ä¼šå‘ç”ŸPatroniåº”è¯¥å“åº”çš„äº‹ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€åˆ‡éƒ½ä¸æˆ‘ä»¬æ¯æ¯ç›¸å…³ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ»šåŠ¨åˆ°é”™è¯¯å¼€å§‹å‡ºç°çš„ä½ç½®ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªè‡ªåŠ¨è¿‡æ»¤å™¨å‘ç”Ÿäº†ã€‚ç”±äºé”™è¯¯ä¸ä¸DCSçš„äº¤äº’æœ‰å…³ï¼Œå› æ­¤æˆ‘ä»¬è¿˜æŸ¥çœ‹äº†Consulæ—¥å¿—-é‚£é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚å¤§è‡´æ¯”è¾ƒäº†fayloverçš„æ—¶é—´å’Œé¢†äº‹æ—¥å¿—ä¸­çš„æ—¶é—´ï¼Œæˆ‘ä»¬å‘ç°é¢†äº‹é›†ç¾¤ä¸­çš„é‚»å±…å¼€å§‹æ€€ç–‘å…¶ä»–å‚ä¸è€…çš„å­˜åœ¨ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">maindb-2 consul[11581]: serf: EventMemberFailed: maindb-1 192.168.11.19<font></font>
maindb-2 consul[11581]: [INFO] serf: EventMemberFailed: maindb-1 192.168.11.19<font></font>
maindb-2 consul[11581]: memberlist: Suspect maindb-1 has failed, no acks received<font></font>
maindb-2 consul[11581]: [INFO] memberlist: Suspect maindb-1 has failed, no acks received</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæŸ¥çœ‹å…¶ä»–Consulä»£ç†çš„æ—¥å¿—ï¼Œå®ƒè¿˜è¡¨æ˜å­˜åœ¨ç½‘ç»œå´©æºƒï¼šConsulç¾¤é›†çš„æ‰€æœ‰æˆå‘˜éƒ½ç›¸äº’æ€€ç–‘ã€‚</font><font style="vertical-align: inherit;">è¿™å°±æ˜¯failoverçš„åŠ¨åŠ›ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹æ›´æ—©çš„æ¡ç›®ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ï¼ŒPostgreSQLçš„ä»£ç†é¢†äº‹ç³»ç»Ÿå…·æœ‰æ²Ÿé€šå›°éš¾ï¼ˆ</font></font><code>deadline reached</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>RPC failed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">maindb-1 consul: memberlist: Suspect lbs-4 has failed, no acks received<font></font>
maindb-1 consul: [ERR] yamux: keepalive failed: i/o deadline reached<font></font>
maindb-1 consul: yamux: keepalive failed: i/o deadline reached<font></font>
maindb-1 consul: [ERR] consul: "KVS.List" RPC failed to server 192.168.11.115:8300: rpc error making call: EOF<font></font>
maindb-1 consul: [ERR] http: Request GET /v1/kv/service/sam_prod/?recurse=1, error: rpc error making call: EOF from=192.168.11.19<font></font>
maindb-1 consul: [ERR] consul: "KVS.List" RPC failed to server 192.168.11.115:8300: rpc error making call: EOF<font></font>
maindb-1 consul: [ERR] agent: Coordinate update error: rpc error making call: EOF<font></font>
maindb-1 consul: [ERR] http: Request GET /v1/kv/service/sam_prod/?recurse=1, error: rpc error making call: EOF from=192.168.11.19</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†³æ–­</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€ç®€å•çš„ç­”æ¡ˆæ˜¯</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿®å¤ç½‘ç»œ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™å¾ˆå®¹æ˜“å»ºè®®ï¼Œä½†æ˜¯æƒ…å†µå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œè€Œè¿™å¹¶éæ€»æ˜¯å¯èƒ½çš„ã€‚</font><font style="vertical-align: inherit;">è¯¥ç³»ç»Ÿå¯ä»¥å­˜åœ¨äºæ•°æ®ä¸­å¿ƒï¼Œè€Œæˆ‘ä»¬ä¸èƒ½å½±å“è®¾å¤‡ã€‚</font><font style="vertical-align: inherit;">éœ€è¦å…¶ä»–é€‰æ‹©ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰äº›è§£å†³æ–¹æ¡ˆé€‰é¡¹ä¸ä¸ç½‘ç»œä¸€èµ·ä½¿ç”¨ï¼š</font></font><br>
<br>
<ul>
<li><strong> Consul-</strong> â€” <code>checks: []</code>.<br>
   ,     .    ,    Consul-    .           .</li>
<li><strong></strong> <code>raft_multiplier</code>.<br>
   Consul-,     5 (      staging-).         Consul-.  -   .</li>
<li><strong></strong> <code>renice -n -10 consul</code>.<br>
        .  renice   .          Consul-,             .</li>
<li><strong>   consul?</strong><br>
Consul-         . Patroni   Consul-    ,     :    - ,  Patroni      .   etcd,     ,    etcd   . Patroni      etcd-.    -  ,     ,   ,     Consul.</li>
<li><strong>  </strong> <code>ttl, loop_wait, retry_timeout</code>.<br>
     ,         .     Patroni       .</li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜3.èŠ‚ç‚¹ä¸¢å¤±</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœä½¿ç”¨çš„æ˜¯Patroniï¼Œé‚£ä¹ˆæ‚¨å°†ç†Ÿæ‚‰patronictl listå‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ˜¾ç¤ºé›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">$ patronictl list<font></font>
<font></font>
+-----------------+-------------------------+--------------+--------+---------+-----------+<font></font>
|     Cluster     |          Member         |     Host     |  Role  |  State  | Lag in MB |<font></font>
+-----------------+-------------------------+--------------+--------+---------+-----------+<font></font>
| patroni_cluster | pg01.dev.zirconus.local | 10.202.1.101 |        | running |    0.0    |<font></font>
| patroni_cluster | pg03.dev.zirconus.local | 10.202.1.103 | Leader | running |    0.0    |<font></font>
+-----------------+-------------------------+--------------+--------+---------+-----------+<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹ä¸€çœ‹ï¼Œè¿™æ ·çš„ç»“è®ºä¼¼ä¹å¾ˆæ­£å¸¸-æœ‰ä¸€ä¸ªä¸»å‰¯æœ¬ï¼Œä½†æ²¡æœ‰å¤åˆ¶æ»åã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œç›´åˆ°æˆ‘ä»¬çŸ¥é“åœ¨è¯¥ç¾¤é›†ä¸­åº”è¯¥æœ‰3ä¸ªèŠ‚ç‚¹è€Œä¸æ˜¯2ä¸ªèŠ‚ç‚¹ä¹‹å‰ï¼Œæ­¤å›¾ç‰‡æ‰æ˜¯æ­£å¸¸çš„ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ•…éšœè½¬ç§»ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çŸ¥é“å‘ç”Ÿäº†ä¸€ä¸ªè‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ï¼Œæ­¤åä¸€ä¸ªå‰¯æœ¬æ¶ˆå¤±äº†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ‰¾å‡ºå¥¹å¤±è¸ªçš„åŸå› ï¼Œå¹¶æŠŠå¥¹å¸¦å›æ¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å†æ¬¡ç ”ç©¶æ—¥å¿—ä»¥äº†è§£ä¸ºä½•å‡ºç°è‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pg02 patroni[1425]: ERROR: failed to update leader lock<font></font>
pg02 patroni[1425]: INFO: demoted self because failed to update leader lock in DCS<font></font>
pg02 patroni[1425]: WARNING: Loop time exceeded, rescheduling immediately.<font></font>
pg02 patroni[1425]: INFO: Lock owner: None; I am pg02.dev.zirconus.local<font></font>
pg02 patroni[1425]: INFO: not healthy enough for leader race<font></font>
pg02 patroni[1425]: INFO: starting after demotion in progress</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸»pg02æ— æ³•æ›´æ–°ä¸»å¯†é’¥</font></font><code>ERROR: failed to update leader lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åï¼Œdb03çš„ç¬¬äºŒä¸ªå‰¯æœ¬æˆä¸ºä¸»å‰¯æœ¬ï¼Œè¿™é‡Œçš„ä¸€åˆ‡éƒ½äº•äº•æœ‰æ¡ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pg03 patroni[9648]: INFO: promoted self to leader by acquiring session lock<font></font>
pg03 patroni[9648]: server promoting<font></font>
pg03 patroni[9648]: INFO: cleared rewind state after becoming the leader</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‚£è€ä¸»äººå‘¢ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å†³å®šæˆä¸ºå‰¯æœ¬çš„pg02é¦–å…ˆå›æ»šäº‹åŠ¡æ—¥å¿—ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ä¸åœ¨ç¾¤é›†ä¸­çš„å‰¯æœ¬æ—¥å¿—ã€‚</font><font style="vertical-align: inherit;">æ‰“å¼€Patroniæ—¥å¿—ï¼Œå‘ç°åœ¨è¿æ¥åˆ°é›†ç¾¤çš„è¿‡ç¨‹ä¸­ï¼Œè¯¥é˜¶æ®µå‡ºç°äº†é—®é¢˜</font></font><code>pg_rewind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="xml hljs">pg02 patroni[1425]: INFO: running pg_rewind from pg03<font></font>
pg02 patroni[1425]: INFO: running pg_rewind from user=postgres host=10.202.1.103 port=5432 ...<font></font>
pg02 patroni[1425]: servers diverged at WAL location 33F/68E6AD10 on timeline 28<font></font>
pg02 patroni[1425]: could not open file "/data/pgdb/11/pg_wal/0000001C0000033F00000059": No such file or directory<font></font>
pg02 patroni[1425]: could not find previous WAL record at 33F/59FFE368 pg02 patroni[1425]: Failure, exiting<font></font>
pg02 patroni[1425]: ERROR: Failed to rewind from healty master: pg03<font></font>
pg02 patroni[1425]: WARNING: Postgresql is not running.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦è¿æ¥åˆ°ç¾¤é›†ï¼ŒèŠ‚ç‚¹å¿…é¡»ä»å‘å¯¼è¯·æ±‚äº‹åŠ¡æ—¥å¿—å¹¶ä»ä¸­æ•è·å‘å¯¼ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰äº‹åŠ¡æ—¥å¿—ï¼ˆ</font></font><code>No such file or directory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ï¼Œå¹¶ä¸”å‰¯æœ¬æ— æ³•å¯åŠ¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼ŒPostgreSQLå› é”™è¯¯è€Œåœæ­¢ã€‚</font><font style="vertical-align: inherit;">æ‚¨éœ€è¦äº†è§£ä¸ºä»€ä¹ˆæ²¡æœ‰äº‹åŠ¡æ—¥å¿—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬çœ‹çœ‹WALçš„æ–°ä¸»äººï¼š</font></font><br>
<br>
<pre><code class="xml hljs">LOG: checkpoint complete:<font></font>
wrote 62928 buffers (16.0%); 0 WAL file(s) added, 0 removed, 23 recycled;<font></font>
write=12.872 s, sync=0.020 s, total=13.001 s;<font></font>
sync files=16, longest=0.009 s, average=0.001 s;<font></font>
distance=520220 kB, estimate=520220 kB</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹å®è¯æ˜ï¼Œåœ¨è¿è¡Œæ—¶</font></font><code>pg_rewind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå‡ºç°äº†ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼Œå¹¶ä¸”</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸäº›æ—§çš„äº‹åŠ¡æ—¥å¿—å·²é‡å‘½å</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å½“æ—§çš„ä¸»æœåŠ¡å™¨å°è¯•è¿æ¥åˆ°æ–°çš„ä¸»æœåŠ¡å™¨å¹¶è¯·æ±‚è¿™äº›æ—¥å¿—æ—¶ï¼Œå®ƒä»¬å·²ç»è¢«é‡å‘½åï¼Œå®ƒä»¬æ ¹æœ¬ä¸å­˜åœ¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ ¹æ®æ—¶é—´æˆ³ï¼Œè¿™äº›äº‹ä»¶ä¹‹é—´çš„æ—¶é—´é—´éš”å®é™…ä¸Šä¸º150 msã€‚</font></font><br>
<br>
<pre><code class="xml hljs">2019-08-26 00:06:11,369 LOG: checkpoint complete<font></font>
2019-08-26 00:06:11,517 INFO: running pg_rewind</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†è¿™è¶³ä»¥ä½¿å‰¯æœ¬æ— æ³•è¿æ¥å¹¶æ— æ³•èµšé’±ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†³æ–­</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆï¼Œæˆ‘ä»¬ä½¿ç”¨å¤åˆ¶æ’æ§½ã€‚å°½ç®¡åœ¨æ“ä½œçš„ç¬¬ä¸€é˜¶æ®µæˆ‘ä»¬å…³é—­äº†æ’æ§½ï¼Œä½†æ­¤è§£å†³æ–¹æ¡ˆå¯¹æˆ‘ä»¬æ¥è¯´ä¼¼ä¹ä¸é”™ã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œå¦‚æœæ’æ§½ä¸­ä¼šç§¯èšè®¸å¤šæ²ƒå°”ç›åˆ†æ®µï¼Œåˆ™ä¸»æœºå¯èƒ½ä¼šå€’ä¸‹ã€‚ç»å†äº†ä¸€æ®µæ—¶é—´æ²¡æœ‰æ’æ§½çš„ç—›è‹¦ä¹‹åï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬éœ€è¦å®ƒä»¬å¹¶é€€å›å®ƒä»¬ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é—®é¢˜åœ¨äºï¼Œå½“å‘å¯¼è¿›å…¥å‰¯æœ¬çŠ¶æ€æ—¶ï¼Œå‘å¯¼å°†åˆ é™¤æ’æ§½å’Œwalæ®µä»¥åŠå®ƒä»¬ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¢åŠ äº†å‚æ•°</font></font><code>wal_keep_segments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒç­‰äº8ä¸ªç»†åˆ†ï¼Œæˆ‘ä»¬</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æé«˜</font></font><code>wal_keep_segments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°1000ä¸ª</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æˆ‘ä»¬åœ¨ä¸Šåˆ†é…äº†16 GBçš„ç©ºé—´</font></font><code>wal_keep_segments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç°åœ¨ï¼Œåœ¨åˆ‡æ¢æ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸Šå§‹ç»ˆæœ‰16 GBçš„äº‹åŠ¡æ—¥å¿—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºé•¿æœŸç»´æŠ¤ä»»åŠ¡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</font><font style="vertical-align: inherit;">å‡è®¾æˆ‘ä»¬éœ€è¦æ›´æ–°å…¶ä¸­ä¸€ä¸ªå‰¯æœ¬ï¼ˆè½¯ä»¶ï¼ŒOSç­‰ï¼‰ï¼Œç„¶åå°†å…¶å…³é—­ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬å…³é—­å‰¯æœ¬æ—¶ï¼Œè¯¥æ’æ§½ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä½¿ç”¨è¾ƒå°çš„å‚æ•°å€¼</font></font><code>wal_keep_segments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåˆ™å¯¹äºé•¿æ—¶é—´ä¸å­˜åœ¨å‰¯æœ¬çš„æƒ…å†µï¼Œå®ƒå°†è¯·æ±‚é‚£äº›ç”šè‡³å¯èƒ½ä¸ä¼šå‡ºç°åœ¨å‘å¯¼ä¸­çš„äº‹åŠ¡æ—¥å¿—-åˆ™å‰¯æœ¬å°†æ— æ³•è¿æ¥ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¿ç•™äº†å¤§é‡çš„æ‚å¿—ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜4.æ•°æ®ä¸¢å¤±</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç”Ÿäº§åŸºåœ°è¿›è¡Œäº†æ•…éšœè½¬ç§»ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ£€æŸ¥äº†é›†ç¾¤ï¼šä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œæ‰€æœ‰å‰¯æœ¬éƒ½å°±ä½ï¼Œæ²¡æœ‰å¤åˆ¶æ»åï¼Œæ—¥å¿—ä¸­ä¹Ÿæ²¡æœ‰é”™è¯¯ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯äº§å“å›¢é˜ŸæŠ¥å‘Š</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®åº“ä¸­æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -å®ƒä»¬åœ¨ä¸€ä¸ªæºä¸­ï¼Œä½†æ˜¯ä¸åœ¨æ•°æ®åº“ä¸­ã€‚</font><font style="vertical-align: inherit;">æ‚¨éœ€è¦äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆäº‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç«‹å³æ„è¯†åˆ°è¿™æ˜¯</font></font><code>pg_rewind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»–ä»¬çš„éº»çƒ¦ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ‰¾å‡ºåŸå› ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•…éšœè½¬ç§»ä½•æ—¶å‘ç”Ÿï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æ€»æ˜¯å¯ä»¥åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°feyloverå‘ç”Ÿçš„æ—¶é—´ï¼Œè°æˆä¸ºäº†æ–°çš„æ¯ç‰ˆï¼Œè°æ˜¯åŸå…ˆçš„æ¯ç‰ˆä»¥åŠä½•æ—¶ä»–æƒ³æˆä¸ºå‰¯æœ¬çš„æ¯ç‰ˆã€‚</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-1 patroni[17836]: INFO: promoted self to leader by acquiring session lock<font></font>
pgdb-1 patroni[17836]: server promoting<font></font>
pgdb-1 patroni[17836]: INFO: cleared rewind state after becoming the leader<font></font>
pgdb-1 patroni[17836]: INFO: Lock owner: pgdb-1; I am pgdb-1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šä¸¢å¤±äº†å¤šå°‘äº‹åŠ¡æ—¥å¿—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°±åƒè¿™æ ·ï¼šæ—§çš„å‘å¯¼é‡æ–°å¯åŠ¨ï¼Œé€šè¿‡è‡ªåŠ¨è¿è¡Œé‡æ–°å¯åŠ¨åï¼Œå¯åŠ¨äº†Patroniï¼Œç„¶åå¯åŠ¨äº†PostgreSQLã€‚</font><font style="vertical-align: inherit;">PostgreSQLå†³å®šæˆä¸ºPatronié›†ç¾¤çš„æˆå‘˜ï¼Œå¹¶å¯åŠ¨äº†ä¸€ä¸ªè¿‡ç¨‹</font></font><code>pg_rewind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">è¯¥è¿‡ç¨‹</font><font style="vertical-align: inherit;">åˆåˆ é™¤äº†éƒ¨åˆ†äº‹åŠ¡æ—¥å¿—ï¼Œä¸‹è½½äº†æ–°çš„æ—¥å¿—å¹¶è¿›è¡Œäº†è¿æ¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patroniçš„å·¥ä½œå®Œå…¨ç¬¦åˆé¢„æœŸã€‚</font><font style="vertical-align: inherit;">ç¾¤é›†æ¢å¤ï¼šåœ¨feylover 3ä¸ªèŠ‚ç‚¹ä¹‹åå‰©ä¸‹3ä¸ªèŠ‚ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯éƒ¨åˆ†æ•°æ®ä¸¢å¤±äº†ï¼Œæ‚¨éœ€è¦äº†è§£å®ƒæ˜¯ä»€ä¹ˆéƒ¨åˆ†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ—§ä¸»äººçš„æ—¥å¿—ä¸­æŸ¥æ‰¾å‘ç”Ÿçš„æ—¶åˆ»</font></font><code>pg_rewind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-2 patroni[4149]: INFO: running pg_rewind from pgdb-1<font></font>
pgdb-2 patroni[4149]: Lock owner: pgdb-1; I am pgdb-2<font></font>
pgdb-2 patroni[4149]: Deregister service pgdb/pgdb-2<font></font>
pgdb-2 patroni[4149]: running pg_rewind from pgdb-1 in progress<font></font>
pgdb-2 patroni[4149]: running pg_rewind from user=replica host=10.10.1.31 port=5432 ...<font></font>
pgdb-2 patroni[4149]: servers diverged at WAL location 0/5AD1BFD8 on timeline 66<font></font>
pgdb-2 patroni[4149]: rewinding from last common checkpoint at 0/59DD1070 on timeline 66<font></font>
pgdb-2 patroni[4149]: Done!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨éœ€è¦åœ¨äº‹åŠ¡æ—¥å¿—ä¸­æ‰¾åˆ°è¯¥ä½ç½®ï¼Œä»è€Œåœæ­¢äº†æ—§çš„ä¸»æ•°æ®åº“ã€‚</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-2 patroni[4149]: INFO: Local timeline=66 lsn=0/5BDA8EB8<font></font>
pgdb-2 patroni[4149]: INFO: master_timeline=67<font></font>
...<font></font>
pgdb-2 patroni[4149]: servers diverged at WAL location 0/5AD1BFD8 on timeline 66<font></font>
postgres=# select pg_wal_lsn_diff('0/5BDA8EB8','0/5AD1BFD8');<font></font>
pg_wal_lsn_diff<font></font>
----------------<font></font>
17354464</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æ ‡è®°0 / 5BDA8EB8ã€‚</font><font style="vertical-align: inherit;">éœ€è¦ç¬¬äºŒä¸ªæ ‡è®°-0 / 5AD1BFD8-æ¥æ‰¾åˆ°æ—§ä¸»æœºä¸æ–°ä¸»æœºä¹‹é—´çš„è·ç¦»ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨å‡½æ•°</font></font><code>pg_wal_lsn_diff </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬æ¯”è¾ƒè¿™ä¸¤ä¸ªæ ‡è®°ï¼Œæˆ‘ä»¬å¾—åˆ°17 MBã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ˜¯å¦å­˜åœ¨17 MBçš„æ•°æ®å¤§é‡ä¸¢å¤±ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥è‡ªå·±å†³å®šã€‚</font><font style="vertical-align: inherit;">å¯¹äºæŸäº›äººæ¥è¯´ï¼Œè¿™æ˜¯å¾®ä¸è¶³é“çš„ï¼Œä½†æ˜¯å¯¹äºæŸäº›äººæ¥è¯´ï¼Œè¿™æ˜¯å¾ˆå¤šä¸å¯æ¥å—çš„ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªäººè‡ªå·±æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç¡®å®šã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†³æ–­</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®å®š</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡å¯ç³»ç»Ÿåæ˜¯å¦å§‹ç»ˆéœ€è¦Patroniè‡ªåŠ¨å¯åŠ¨</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å»æ‰¾æ—§çš„ä¸»æœºï¼Œçœ‹çœ‹å®ƒä¸å½“å‰çŠ¶æ€æœ‰ä½•ä¸åŒï¼Œä¹Ÿè®¸è¦æ£€æŸ¥äº‹åŠ¡æ—¥å¿—çš„å„ä¸ªéƒ¨åˆ†ã€‚æ‚¨éœ€è¦äº†è§£æ˜¯å¦ä¼šä¸¢å¤±æ­¤æ•°æ®ï¼Œæˆ–è€…éœ€è¦åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹è¿è¡Œæ—§å‘å¯¼æ¥æå–æ•°æ®ã€‚åªæœ‰åœ¨æ­¤ä¹‹åï¼Œæ‰å†³å®šå¦‚ä½•å¤„ç†æ•°æ®ï¼Œç„¶åå°†æ­¤èŠ‚ç‚¹ä½œä¸ºå‰¯æœ¬è¿æ¥åˆ°æˆ‘ä»¬çš„é›†ç¾¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå‚æ•°</font></font><code>maximum_lag_on_failover</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œé»˜è®¤å€¼ä¸º1 Mbã€‚å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ï¼šå¦‚æœå‰¯æœ¬æ¯”å¤åˆ¶æ»åæ—¶é—´è½å1 MBï¼Œåˆ™è¯¥å‰¯æœ¬ä¸å‚ä¸é€‰ä¸¾ã€‚å¦‚æœçªç„¶å‘ç”Ÿæ•…éšœè½¬ç§»ï¼ŒPatroniå°†æŸ¥çœ‹å“ªäº›å‰¯æœ¬ä½äºåé¢ï¼Œè€Œé‚£äº›å‰¯æœ¬åœ¨å¤§é‡äº‹åŠ¡æ—¥å¿—ä¹‹åä¸èƒ½æˆä¸ºä¸»å‰¯æœ¬ã€‚è¿™æ˜¯ä¸€é¡¹å¾ˆå¥½çš„å®‰å…¨åŠŸèƒ½ï¼Œå¯ä»¥é˜²æ­¢ä¸¢å¤±å¤ªå¤šæ•°æ®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¤åˆ¶æ»åä¼šä»¥ä¸€å®šçš„æ—¶é—´é—´éš”è¿›è¡Œæ›´æ–°ï¼Œ</font></font><code>ttl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤</font><font style="vertical-align: inherit;">å€¼ä¸º</font><font style="vertical-align: inherit;">30 sã€‚ DCSä¸­å‰¯æœ¬çš„å¤åˆ¶å»¶è¿Ÿå€¼å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œä½†å®é™…ä¸Šå®ƒå®Œå…¨ä¸åŒï¼Œæˆ–è€…æ ¹æœ¬æ²¡æœ‰å»¶è¿Ÿã€‚è¿™ä¸æ˜¯å®æ—¶å€¼ï¼›å®ƒå¹¶ä¸æ€»æ˜¯åæ˜ çœŸå®æƒ…å†µï¼Œä¹Ÿä¸å€¼å¾—å°†å¤æ‚çš„é€»è¾‘ä¸å…¶è”ç³»èµ·æ¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â€œæŸå¤±â€çš„é£é™©å§‹ç»ˆå­˜åœ¨ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åçš„æƒ…å†µæ˜¯ï¼š</font></font><code>maximum_lag_on_failover + ttl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼š</font></font><code>maximum_lag_on_failover + (loop_wait / 2)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“æ‚¨è®¡åˆ’å®æ–½Patroniå¹¶è¯„ä¼°å¯èƒ½æŸå¤±çš„æ•°æ®é‡æ—¶ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹å…¬å¼ä»¥å¤§è‡´è¡¨ç¤ºå¯èƒ½çš„æŸå¤±ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½æ¶ˆæ¯æ˜¯ï¼Œâ€œæŸå¤±â€ä¸­çš„åå°æµç¨‹å¯èƒ½ä¼šäº§ç”ŸWALã€‚</font><font style="vertical-align: inherit;">è¿™äº›æ•°æ®å¾ˆå®¹æ˜“è¢«å¿½ç•¥å’Œä¸¢å¤±ï¼Œæ²¡æœ‰é—®é¢˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœè®¾ç½®ä¸ºset </font></font><code>maximum_lag_on_failover</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">åˆ™æ—¥å¿—æ˜¾ç¤ºä¸ºä»¥ä¸‹å†…å®¹</font><font style="vertical-align: inherit;">ï¼Œå³å‘ç”Ÿfeyloverï¼Œæ‚¨éœ€è¦é€‰æ‹©ä¸€ä¸ªæ–°å‘å¯¼ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pgdb-1 patroni[6202]: INFO: Lock owner: None; I am pgdb-1<font></font>
pgdb-1 patroni[6202]: INFO: not healthy enough for leader race<font></font>
pgdb-1 patroni[6202]: INFO: changing primary_conninfo and restarting in progress<font></font>
...<font></font>
pgdb-1 patroni[6202]: INFO: following a different leader because i am not the healthiest node<font></font>
pgdb-1 patroni[6202]: INFO: following a different leader because i am not the healthiest node</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¿åˆ¶è€…åªæ˜¯çœ‹å¾—å‡ºè‡ªå·±</font></font><code>not healthy enough for leader race</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯</font><font style="vertical-align: inherit;">å¥¹</font><font style="vertical-align: inherit;">ï¼Œè€Œæ‹’ç»å‚åŠ é¢†å¯¼åŠ›ç«èµ›ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå®ƒåªæ˜¯ç­‰å¾…é€‰æ‹©æ–°çš„å‘å¯¼æ¥è¿æ¥å®ƒã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯é˜²æ­¢æ•°æ®ä¸¢å¤±çš„å¦ä¸€ç§æªæ–½ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜5ï¼šé©±åŠ¨å™¨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº§å“å›¢é˜Ÿå†™é“ï¼Œè¯¥åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨PostgreSQLæ—¶é‡åˆ°é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">åŒæ—¶ï¼Œæ‚¨æ— æ³•è¾“å…¥ä¸»æœåŠ¡å™¨ï¼Œå› ä¸ºå®ƒæ— æ³•é€šè¿‡SSHä½¿ç”¨ï¼Œä½†ä¹Ÿä¸ä¼šå‘ç”Ÿè‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œä¸»æœºè¢«å¼ºåˆ¶é‡æ–°å¼•å¯¼ï¼Œä»è€Œå¯åŠ¨äº†è‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡å¯ä»¥è¿›è¡Œæ‰‹åŠ¨è½¬æ¢ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡æ–°å¯åŠ¨åï¼Œæˆ‘ä»¬å»æŸ¥çœ‹ä¸»æœºå‘ç”Ÿäº†ä»€ä¹ˆã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_1/2u/rj/_12urj0aobgqg0pp2gkkuolhjog.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬äº‹å…ˆäº†è§£äº†ç£ç›˜çš„é—®é¢˜ï¼›é€šè¿‡ç›‘è§†ï¼Œæˆ‘ä»¬çŸ¥é“äº†åœ¨å“ªé‡Œè¿›è¡ŒæŒ–æ˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨PostgreSQLæ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">[COMMIT] LOG: duration: 1138.868 ms statement: COMMIT<font></font>
...<font></font>
[] WARNING: autovacuum worker started without a worker entry<font></font>
...<font></font>
[SELECT] LOG: temporary file: path "base/pgsql_tmp/pgsql_tmp11247.983", size 532996096<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¡¨é¢ä¸Šæ‰€æœ‰æŒ‡ç¤ºç£ç›˜é—®é¢˜çš„è¿¹è±¡ï¼šæäº¤æŒç»­ä¸€ç§’é’Ÿï¼Œautovacuumè¿è¡Œæ—¶é—´å¾ˆé•¿è€Œä¸”å¾ˆå¥‡æ€ªï¼Œå¹¶ä¸”ç£ç›˜ä¸Šæœ‰ä¸´æ—¶æ–‡ä»¶ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æŸ¥çœ‹äº†ç³»ç»Ÿdmesg-å†…æ ¸æ¶ˆæ¯æ—¥å¿—ï¼Œå‘ç°å…¶ä¸­ä¸€ä¸ªç£ç›˜æœ‰é—®é¢˜ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">md/raid10:md2: sde3: rescheduling sector 351273392<font></font>
blk_update_request: I/O error, dev sde, sector 64404728<font></font>
md/raid10:md2: sde3: rescheduling sector 63161592<font></font>
blk_update_request: I/O error, dev sde, sector 64404760<font></font>
...<font></font>
md2 : active raid10 sda3[0] sdc3[2] sdd3[3] sdb3[1] sdh3[7] sdf3[5] sdg3[6]<font></font>
      15623340032 blocks super 1.2 512K chunks 2 near-copies [8/7] [UUUUUUU_]<font></font>
      bitmap: 58/59 pages [232KB], 131072KB chunk</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœåŠ¡å™¨ä¸Šçš„ç£ç›˜å­ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŒ…å«8ä¸ªç£ç›˜çš„è½¯ä»¶Raidï¼Œä½†ç¼ºå°‘ä¸€ä¸ªã€‚</font><font style="vertical-align: inherit;">è¯¥è¡Œ</font></font><code>sda3[0] sdc3[2] sdd3[3] sdb3[1] sdh3[7] sdf3[5] sdg3[6]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸è§äº†</font></font><code>sde[4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç›¸å¯¹è€Œè¨€ï¼Œä¸€ä¸ªç£ç›˜æ‰äº†ä¸‹æ¥ï¼Œè¿™å¯¼è‡´äº†ç£ç›˜é—®é¢˜ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨PostgreSQLé›†ç¾¤æ—¶é‡åˆ°äº†é—®é¢˜ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†³æ–­</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPatroniå°†æ— æ³•æä¾›å¸®åŠ©ï¼Œå› ä¸ºPatroniæ²¡æœ‰ä»»åŠ¡æ¥ç›‘è§†æœåŠ¡å™¨å’Œç£ç›˜çš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">åœ¨å‡ºç°é—®é¢˜æœŸé—´ï¼ŒPatroniç»§ç»­ä¸DCSé›†ç¾¤è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸”æ²¡æœ‰é‡åˆ°ä»»ä½•å›°éš¾ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦å¤–éƒ¨ç›‘è§†ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜6ï¼šé›†ç¾¤æ¨¡æ‹Ÿå™¨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æœ€å¥‡æ€ªçš„é—®é¢˜ä¹‹ä¸€ã€‚</font><font style="vertical-align: inherit;">æˆ‘ç ”ç©¶äº†å¾ˆé•¿æ—¶é—´ï¼Œé‡æ–°é˜…è¯»äº†å¾ˆå¤šæ—¥å¿—ï¼Œå¹¶å°†å…¶ç§°ä¸ºâ€œé›†ç¾¤æ¨¡æ‹Ÿå™¨â€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é—®é¢˜æ˜¯è€ä¸»äººä¸èƒ½æˆä¸ºæ­£å¸¸çš„æç¤ºã€‚</font><font style="vertical-align: inherit;">Patroniè¿è¡Œå®ƒï¼Œè¡¨æ˜è¯¥èŠ‚ç‚¹ä½œä¸ºå‰¯æœ¬å­˜åœ¨ï¼Œä½†åŒæ—¶å®ƒä¸æ˜¯æ™®é€šå‰¯æœ¬ï¼Œç°åœ¨æ‚¨å°†äº†è§£åŸå› ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸å‰é¢çš„æƒ…å†µä¸€æ ·ï¼Œè¿™ä¸€åˆ‡éƒ½å§‹äºç£ç›˜é—®é¢˜ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">14:48:55.601 [COMMIT] LOG: duration: 1478.118 ms statement: COMMIT<font></font>
14:48:56.287 [COMMIT] LOG: duration: 1290.203 ms statement: COMMIT<font></font>
14:48:56.287 [COMMIT] LOG: duration: 1778.465 ms statement: COMMIT<font></font>
14:48:56.287 [COMMIT] LOG: duration: 1778.449 ms statement: COMMIT</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿æ¥æ–­å¼€ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">14:48:58.078 [idle in transaction] LOG: could not send data to client: Broken pipe<font></font>
14:48:58.078 [idle] LOG: could not send data to client: Broken pipe<font></font>
14:48:58.078 [idle] FATAL: connection to client lost<font></font>
14:48:58.107 [idle in transaction] FATAL: connection to client lost</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é•¿æœŸä»¥æ¥äººä»¬å¯¹å“åº”å’Œé˜»æ­¢å„ç§ä¸¥é‡æ€§çš„æœŸæœ›å¾ˆé«˜ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">14:49:26.929 [UPDATE waiting] LOG: process 4298 acquired ExclusiveLock on tuple (2,10) of relation 52082 of database 50587 after 52487.463 ms<font></font>
14:49:26.929 [UPDATE waiting] STATEMENT: UPDATE sessions SET lastaccess='1565005714' WHERE sessionid=...<font></font>
14:49:27.929 [UPDATE waiting] LOG: process 4298 still waiting for ShareLock on transaction 364118337 after 1000.088 ms<font></font>
14:49:27.929 [UPDATE waiting] DETAIL: Process holding the lock: 4294. Wait queue: 4298.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šå¸¸ï¼Œç£ç›˜å­˜åœ¨æ˜æ˜¾çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸´æ—¶æ–‡ä»¶ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯å¯¹æˆ‘æ¥è¯´æœ€ç¥ç§˜çš„æ˜¯-å®ƒé£è¿›æ¥äº†</font></font><code>immediate shutdown request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">14:49:34.102 MSK 5335 @ from [] LOG: received immediate shutdown request<font></font>
14:49:34.689 [authentication] WARNING: terminating connection because of crash of another server process<font></font>
14:49:34.689 [authentication] DETAIL: The postmaster has commanded this server process to roll back the current transaction and exit, because another server process exited abnormally and possibly corrupted shared memory</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PostgreSQLå…·æœ‰ä¸‰ç§å…³é—­æ¨¡å¼ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æˆ‘ä»¬ç­‰å¾…æ‰€æœ‰å®¢æˆ·ç«¯è‡ªè¡Œæ–­å¼€è¿æ¥æ—¶ï¼Œéå¸¸ä¼˜ç¾ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿«é€Ÿï¼Œå½“æˆ‘ä»¬å‘Šè¯‰å®¢æˆ·æ–­å¼€è¿æ¥æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬å°†è¦å…³é—­ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç«‹å³ï¼Œå®ƒä¸ä¼šå‘Šè¯‰å®¢æˆ·ç«¯å¿…é¡»æ–­å¼€è¿æ¥ï¼Œè€Œåªæ˜¯å°†å…¶å…³é—­å¹¶å‘æ‰€æœ‰å®¢æˆ·ç«¯å‘é€RSTæ¶ˆæ¯ï¼ˆTCPä¿¡å·è¡¨æ˜è¿æ¥å·²ä¸­æ–­ï¼‰ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PostgreSQLåå°è¿›ç¨‹ä¸ç›¸äº’å‘é€ç«‹å³å…³é—­è¯·æ±‚ä¿¡å·ï¼Œè€Œä»…å“åº”å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ç´§æ€¥é‡å¯ï¼Œå‘é€è€…å°šä¸æ¸…æ¥šã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯</font></font><code>kill -9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œé‚£ä¹ˆæˆ‘ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°å®ƒï¼Œä½†æ˜¯å®ƒä¸å­˜åœ¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿›ä¸€æ­¥äº†è§£åï¼Œæˆ‘å‘ç°Patroniåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…æœªå†™å…¥æ—¥å¿—-54ç§’é’Ÿæ ¹æœ¬æ²¡æœ‰æ¶ˆæ¯ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤æœŸé—´ï¼Œå…¶ä¸­ä¸€ä¸ªå‰¯æœ¬è¢«â€œå‡çº§â€ï¼Œå¹¶å‡ºç°äº†è‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pgsql03 patroni: 14:48:25,000 INFO: Lock owner: pgsql03; I am pgsql03 <font></font>
pgsql03 patroni: 14:48:25,013 INFO: no action.  i am the leader with the lock <font></font>
pgsql03 patroni: 14:48:37,159 INFO: Lock owner: pgsql03; I am pgsql03 <font></font>
pgsql03 patroni: 14:49:31,155 WARNING: Exception hened during processing of request from 10.1.0.12 <font></font>
pgsql03 patroni: 14:49:31,297 WARNING: Exception hened during processing of request from 10.1.0.11 <font></font>
pgsql03 patroni: 14:49:31,298 WARNING: Exception hened during processing of request from 10.1.0.11</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¸•ç‰¹ç½—å°¼åœ¨è¿™é‡Œå†æ¬¡è¿ä½œå¾—éå¸¸å¥½ï¼Œæ²¡æœ‰è€ä¸»äººï¼Œå› æ­¤å¼€å§‹é€‰ä¸¾æ–°ä¸»äººã€‚</font></font><br>
<br>
<pre><code class="xml hljs">pgsql01 patroni: 14:48:57,136 INFO: promoted self to leader by acquiring session lock<font></font>
pgsql01 patroni: server promoting<font></font>
pgsql01 patroni: 14:48:57,214 INFO: cleared rewind state after becoming the leader<font></font>
pgsql01 patroni: 14:49:05,013 INFO: Lock owner: pgsql01; I am pgsql01<font></font>
pgsql01 patroni: 14:49:05,023 INFO: updated leader lock during promote</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pgsql01æˆä¸ºæ–°çš„é¢†å¯¼è€…ï¼Œè€Œç¬¬äºŒä¸ªå‰¯æœ¬åªæ˜¯å­˜åœ¨é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">å¥¹è¯šå®åœ°å°è¯•é‡æ–°é…ç½®ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">pgsql02 patroni: 14:48:57,124 INFO: Could not take out TTL lock <font></font>
pgsql02 patroni: 14:48:57,137 INFO: following new leader after trying and failing to obtain lock <font></font>
pgsql02 patroni: 14:49:05,014 INFO: Lock owner: pgsql01; I am pgsql02 <font></font>
pgsql02 patroni: 14:49:05,025 INFO: changing primary_conninfo and restarting in progress <font></font>
pgsql02 patroni: 14:49:15,011 INFO: Lock owner: pgsql01; I am pgsql02<font></font>
pgsql02 patroni: 14:49:15,014 INFO: changing primary_conninfo and restarting in progress <font></font>
pgsql02 patroni: 14:49:25,011 INFO: Lock owner: pgsql01; I am pgsql02 <font></font>
pgsql02 patroni: 14:49:25,014 INFO: changing primary_conninfo and restarting in progress <font></font>
pgsql02 patroni: 14:49:35,011 INFO: Lock owner: pgsql01; I am pgsql02 <font></font>
pgsql02 patroni: 14:49:35,014 INFO: changing primary_conninfo and restarting in progress</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥¹å°è¯•æ›´æ”¹recovery.confï¼Œé‡æ–°å¯åŠ¨PostgreSQLï¼Œè¿æ¥åˆ°æ–°å‘å¯¼ã€‚</font><font style="vertical-align: inherit;">æ¯éš”10ç§’å°±ä¼šæœ‰ä¸€æ¡å¥¹æ­£åœ¨å°è¯•çš„æ¶ˆæ¯ï¼Œä½†ä¸èƒ½å‘é€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ—¶ï¼Œç›¸åŒçš„ç«‹å³å…³é—­ä¿¡å·ä¹Ÿä¼ åˆ°äº†æ—§ä¸»æœºä¸Šã€‚</font><font style="vertical-align: inherit;">å‘å¯¼å¯åŠ¨äº†ç´§æ€¥é‡å¯ï¼Œæ¢å¤ä¹Ÿåœæ­¢äº†ã€‚</font><font style="vertical-align: inherit;">å‰¯æœ¬æ— æ³•è¿æ¥åˆ°ä¸»æ•°æ®åº“ï¼Œå› ä¸ºå®ƒå¤„äºå…³é—­æ¨¡å¼ã€‚</font></font><br>
<br>
<pre><code class="xml hljs">14:49:34.293 [idle] LOG:  received replication command: IDENTIFY_SYSTEM <font></font>
WARNING:  terminating connection because of crash of another server process <font></font>
DETAIL:  The postmaster has commanded this server process to roll back the current transaction and exit, because another server process exited abnormally and possibly corrupted shared memory. <font></font>
14:49:35.232 FATAL:  could not receive data from WAL stream: server closed the connection unexpectedly             <font></font>
        This probably means the server terminated abnormally <font></font>
        before or while processing the request. <font></font>
14:49:35.232 LOG:  record with incorrect prev-link 142D46/315602C at 14CF/CF38C160 <font></font>
14:49:35.305 FATAL: could not connect to the primary server: FATAL: the database system is shutting down <font></font>
14:49:40.241 FATAL: could not connect to the primary server: FATAL: the database system is shutting down</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æŸä¸ªæ—¶å€™ï¼Œå‰¯æœ¬å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯å¤åˆ¶æ²¡æœ‰å¼€å§‹ã€‚</font></font><br>
<br>
<pre><code class="xml hljs">14:50:14.024 [] LOG:  record with incorrect prev-link 142D46/315602C at 14CF/CF38C160 <font></font>
14:50:14.028 [] LOG:  fetching timeline history file for timeline 72 from primary server <font></font>
14:50:14.104 [] FATAL:  could not start WAL streaming: ERROR:  requested starting point 14CF/CF000000 on timeline 71 is not in this server's history        <font></font>
DETAIL:  This server's history forked from timeline 71 at 14CF/CEC32E40. <font></font>
14:50:14.104 [] LOG:  new timeline 72 forked off current database system timeline 71 before current recovery point 14CF/CF38C160</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘æœ‰ä¸€ä¸ªå‡è®¾ï¼šåœ¨recovery.confä¸­æ˜¯æ—§ä¸»æœåŠ¡å™¨çš„åœ°å€ã€‚</font><font style="vertical-align: inherit;">å½“æ–°çš„æ¯ç‰ˆå·²ç»å‡ºç°æ—¶ï¼Œç¬¬äºŒä¸ªå‰¯æœ¬å°è¯•è¿æ¥åˆ°æ—§çš„æ¯ç‰ˆã€‚</font><font style="vertical-align: inherit;">å½“Patroniåœ¨ç¬¬äºŒä¸ªå‰¯æœ¬ä¸Šå¯åŠ¨æ—¶ï¼Œè¯¥èŠ‚ç‚¹å·²å¯åŠ¨ï¼Œä½†æ— æ³•é€šè¿‡å¤åˆ¶è¿›è¡Œè¿æ¥ã€‚</font><font style="vertical-align: inherit;">å½¢æˆäº†ä¸€ä¸ªå¤åˆ¶æ»åï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">+-----------------+----------+--------------+--------+---------+-----------+<font></font>
|     Cluster     |  Member  |     Host     |  Role  |  State  | Lag in MB |<font></font>
+-----------------+----------+--------------+--------+---------+-----------+<font></font>
| patroni_cluster |  pgsql01 | 10.2.200.151 | Leader | running |       0.0 |<font></font>
| patroni_cluster |  pgsql02 | 10.2.200.152 |        | running |    9153.0 |<font></font>
| patroni_cluster |  pgsql03 | 10.2.200.153 |        | running |       0.0 |<font></font>
+-----------------+----------+--------------+--------+---------+-----------+</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ä¸‰ä¸ªèŠ‚ç‚¹éƒ½åœ¨é€‚å½“çš„ä½ç½®ï¼Œä½†ç¬¬äºŒä¸ªèŠ‚ç‚¹åœ¨åé¢ã€‚</font><font style="vertical-align: inherit;">ç”±äºäº‹åŠ¡æ—¥å¿—ä¸åŒï¼Œå› æ­¤æ— æ³•å¼€å§‹å¤åˆ¶ã€‚</font><font style="vertical-align: inherit;">å‘å¯¼æä¾›çš„äº‹åŠ¡æ—¥å¿—ï¼ˆåœ¨recovery.confä¸­æŒ‡ç¤ºï¼‰æ ¹æœ¬ä¸é€‚åˆå½“å‰èŠ‚ç‚¹ã€‚</font><font style="vertical-align: inherit;">PostgreSQLæ¯5ç§’æŠ¥å‘Šä¸€æ¬¡é”™è¯¯</font></font><br>
<br>
<pre><code class="xml hljs">14:50:44.143 FATAL:  could not start WAL streaming: ERROR:  requested starting point 14CF/CF000000 on timeline 71 is not in this server's history        <font></font>
         DETAIL:  This server's history forked from timeline 71 at 14CF/CEC32E40. <font></font>
14:50:44.143 LOG:  new timeline 72 forked off current database system timeline 71 before current recovery point 14CF/ CF38C160</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™é‡Œï¼Œæˆ‘çŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”æ²¡æœ‰æ£€éªŒæˆ‘çš„å‡è®¾ï¼Œå³æˆ‘ä»¬æ­£åœ¨è¿æ¥åˆ°é”™è¯¯çš„ä¸»æœåŠ¡å™¨ã€‚</font><font style="vertical-align: inherit;">æˆ‘åˆšåˆšåœ¨å‰¯æœ¬ä¸Šé‡æ–°å¯åŠ¨äº†Patroniã€‚</font><font style="vertical-align: inherit;">è€å®è¯´ï¼Œæˆ‘å·²ç»ç»“æŸäº†å®ƒï¼Œå¹¶è®¤ä¸ºæˆ‘å¿…é¡»é‡åšå®ƒï¼Œä½†æ˜¯ä»ç„¶å†³å®šå°è¯•é‡æ–°å¯åŠ¨å®ƒã€‚</font></font><br>
<br>
<pre><code class="xml hljs">15:14:13.511 LOG: consistent recovery state reached at 14CF/A3F657B0<font></font>
15:14:13.511 LOG: database system is ready to accept read only connections</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¢å¤å¼€å§‹ï¼Œç”šè‡³æ•°æ®åº“æ‰“å¼€ï¼Œå®ƒå‡†å¤‡æ¥å—è¿æ¥ï¼Œå¤åˆ¶å¼€å§‹ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">15:14:17.072 LOG: record with incorrect prev-link 142D46/315602C at 14CF/CF38C160<font></font>
15:14:17.077 LOG: started streaming WAL from primary at 14CF/CF000000 on timeline 72<font></font>
15:14:17.536 LOG: invalid record length at 14CF/CF38C160: wanted 24, got 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ä¸€åˆ†é’Ÿåï¼Œå¥¹å› å‡ºé”™è€Œæ‘”å€’äº†</font></font><code>terminating walreceiver process due to administrator command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-å‰¯æœ¬è¡¨ç¤ºäº‹åŠ¡æ—¥å¿—ä¸é€‚åˆå¥¹ã€‚</font></font><br>
<br>
<pre><code class="xml hljs">15:15:27.823 FATAL: terminating walreceiver process due to administrator command<font></font>
15:15:27.895 LOG: invalid record length at 14CF/CF38C160: wanted 24, got 1<font></font>
15:15:27.895 LOG: invalid record length at 14CF/CF38C160: wanted 24, got 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è€Œä¸”æˆ‘æ²¡æœ‰é‡å¯PostgreSQLï¼Œè€Œæ˜¯é‡å¯äº†Patroniï¼Œå¸Œæœ›å®ƒèƒ½å¤Ÿç¥å¥‡åœ°å¯åŠ¨æ•°æ®åº“ã€‚</font><font style="vertical-align: inherit;">å¤åˆ¶å†æ¬¡å¼€å§‹ï¼Œä½†æ˜¯æ•°æ®åº“åœ¨åŒä¸€ä½ç½®æ‰“å¼€ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">15:17:33.553 LOG: consistent recovery state reached at 14CF/A3F657B0<font></font>
15:17:33.554 LOG: database system is ready to accept read only connections</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹åŠ¡æ—¥å¿—ä¸­çš„æ ‡è®°æ˜¯ä¸åŒçš„ï¼Œå®ƒä»¬ä¸ä¸Šä¸€æ¬¡å¯åŠ¨å°è¯•ä¸­çš„æ ‡è®°ä¸åŒ-äº‹åŠ¡æ—¥å¿—çš„ä½ç½®æ›´æ—©ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">15:17:37.299 LOG: invalid contrecord length 5913 at 14CF/CEFFF7B0<font></font>
15:17:37.304 LOG: started streaming WAL from primary at 14CF/CE000000 on timeline 72</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤åˆ¶å†æ¬¡åœæ­¢ï¼Œå¹¶ä¸”é”™è¯¯æ¶ˆæ¯æœ‰æ‰€ä¸åŒï¼Œå¹¶ä¸”å†æ¬¡æ²¡æœ‰æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">15:18:12.208 FATAL: terminating walreceiver process due to administrator command<font></font>
15:18:12.240 LOG: record with incorrect prev-link 60995000/589DF000 at 14CF/CEFFF7B0<font></font>
15:18:12.240 LOG: record with incorrect prev-link 60995000/589DF000 at 14CF/CEFFF7B0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è¿›è¡Œå®éªŒï¼Œè¯·é‡æ–°å¯åŠ¨ï¼Œç„¶ååœ¨åŒä¸€ä½ç½®æ‰“å¼€åº•åº§ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">15:21:25.135 LOG: consistent recovery state reached at 14CF/A3F657B0<font></font>
15:21:25.135 LOG: database system is ready to accept read only connections</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åï¼Œæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªæƒ³æ³•ï¼šå¦‚æœæˆ‘é‡æ–°å¯åŠ¨PostgreSQLï¼Œåˆ™åœ¨å½“å‰å‘å¯¼çš„è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘å°†æ‰§è¡Œä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼Œä»¥å°†äº‹åŠ¡æ—¥å¿—ä¸­çš„è¯¥ç‚¹ç¨å¾®å‘å‰ç§»åŠ¨ï¼Œå¹¶ä»å¦ä¸€æ—¶åˆ»å¼€å§‹æ¢å¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯åŠ¨Patroniï¼Œåœ¨ä¸»æœåŠ¡å™¨ä¸Šå»ºç«‹äº†å‡ ä¸ªæ£€æŸ¥ç‚¹ï¼Œåœ¨å‰¯æœ¬æœåŠ¡å™¨æ‰“å¼€æ—¶åœ¨å‰¯æœ¬æœåŠ¡å™¨ä¸Šå»ºç«‹äº†å‡ ä¸ªé‡å¯ç‚¹ï¼š</font></font><br>
<br>
<pre><code class="xml hljs">15:22:43.727 LOG: invalid record length at 14D1/BCF3610: wanted 24, got 0<font></font>
15:22:43.731 LOG: started streaming WAL from primary at 14D1/B000000 on timeline 72</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒå¯ä»¥æ­£å¸¸å·¥ä½œ-å¤åˆ¶ä»å¦ä¸€ä¸ªåœ°æ–¹å¼€å§‹ï¼Œä¸å†ä¸­æ–­ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯æˆ‘ä»åœ¨ç»å°½è„‘æ±çš„æœ€ç¥ç§˜çš„é—®é¢˜ä¹‹ä¸€ã€‚</font><font style="vertical-align: inherit;">ç‰¹åˆ«æ˜¯é‚£ä¸ªå¥‡æ€ªçš„ç«‹å³å…³é—­è¯·æ±‚ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šPatroniå¯ä»¥æŒ‰è®¡åˆ’è¿›è¡Œå·¥ä½œå¹¶ä¸”æ²¡æœ‰é”™è¯¯ï¼Œä½†è¿™å¹¶ä¸æ˜¯ç»å¯¹ä¿è¯ä¸€åˆ‡éƒ½äº•äº•æœ‰æ¡ã€‚</font><font style="vertical-align: inherit;">fayloverä¹‹åï¼Œæ‚¨åº”è¯¥å§‹ç»ˆä»”ç»†æ£€æŸ¥é›†ç¾¤æ˜¯å¦ä¸€åˆ‡æ­£å¸¸ï¼šå‰¯æœ¬æ•°æ­£ç¡®ï¼Œæ²¡æœ‰å¤åˆ¶æ»åã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‘˜è¦</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸºäºè¿™äº›ä»¥åŠè®¸å¤šå…¶ä»–ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆ‘åˆ¶å®šäº†ä¸€äº›ä¸€èˆ¬æ€§å»ºè®®ï¼Œå»ºè®®æ‚¨åœ¨æ“ä½œPatroniæ—¶è¦è°¨è®°ã€‚</font></font><br>
<br>
<blockquote><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨Patroniæ—¶ï¼Œå¿…é¡»è¿›è¡Œç›‘è§†ã€‚</font><font style="vertical-align: inherit;">æ‚¨å§‹ç»ˆéœ€è¦çŸ¥é“ä½•æ—¶ä¼šå‡ºç°è‡ªåŠ¨æ–‡ä»¶ï¼Œå› ä¸ºå¦‚æœæ‚¨ä¸çŸ¥é“è‡ªå·±å…·æœ‰è‡ªåŠ¨æ–‡ä»¶ï¼Œå°±æ— æ³•æ§åˆ¶ç¾¤é›†ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;åœ¨æ¯æ¬¡feyloverä¹‹åï¼Œå§‹ç»ˆæ£€æŸ¥é›†ç¾¤ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¿…é¡»ç¡®ä¿ï¼šå‰¯æœ¬å§‹ç»ˆæ˜¯å½“å‰ç¼–å·ï¼›</font><font style="vertical-align: inherit;">æ²¡æœ‰å¤åˆ¶å»¶è¿Ÿï¼›</font><font style="vertical-align: inherit;">ä¸Patroniå’ŒDCSç³»ç»Ÿè¿›è¡Œçš„æµå¤åˆ¶ç›¸å…³çš„æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯ã€‚</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patroniæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å·¥å…·ï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆè¯´ï¼Œè¿™éƒ½ä¸æ˜¯çµä¸¹å¦™è¯ã€‚</font><font style="vertical-align: inherit;">è‡ªåŠ¨åŒ–å¯ä»¥æˆåŠŸè¿›è¡Œï¼Œä½†æ˜¯åŒæ—¶ï¼Œè‡ªåŠ¨åŒ–å¯¹è±¡å¯ä»¥å¤„äºåŠå·¥ä½œçŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">æ— è®ºå¦‚ä½•ï¼Œæ‚¨éœ€è¦äº†è§£PostgreSQLå’Œå¤åˆ¶çš„å·¥ä½œæ–¹å¼ï¼ŒPatroniå¦‚ä½•ç®¡ç†PostgreSQLä»¥åŠå¦‚ä½•ç¡®ä¿èŠ‚ç‚¹ä¹‹é—´çš„äº¤äº’ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†èƒ½å¤Ÿä¿®å¤åŒæ‰‹å‡ºç°çš„é—®é¢˜ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯Šæ–­æ­¥éª¤</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¢°å·§æˆ‘ä»¬ä¸ä¸åŒçš„å®¢æˆ·ä¸€èµ·å·¥ä½œï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä»–ä»¬æ²¡æœ‰ELKå †æ ˆï¼Œæ‚¨å¿…é¡»é€šè¿‡æ‰“å¼€2ä¸ªé€‰é¡¹å¡å’Œ6ä¸ªæ§åˆ¶å°æ¥æ•´ç†æ—¥å¿—ï¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ä¸€ä¸ªPatronié€‰é¡¹å¡ä¸­ï¼Œåœ¨å¦ä¸€ä¸ª-Consulæˆ–PostgreSQLæ—¥å¿—ä¸­ã€‚</font><font style="vertical-align: inherit;">è¯Šæ–­æ‰€æœ‰è¿™äº›éƒ½å¾ˆå›°éš¾ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å¼€å‘äº†ä»¥ä¸‹æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æˆ‘æ€»æ˜¯çœ‹ç€å‘ç”Ÿæ•…éšœè½¬ç§»çš„æ—¶é—´ã€‚</font><font style="vertical-align: inherit;">å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ†æ°´å²­ã€‚</font><font style="vertical-align: inherit;">æˆ‘çœ‹ä¸€ä¸‹åœ¨feyloverä¹‹å‰ï¼ŒæœŸé—´å’Œä¹‹åå‘ç”Ÿçš„äº‹æƒ…ã€‚</font><font style="vertical-align: inherit;">æ•…éšœè½¬ç§»æœ‰ä¸¤ä¸ªæ—¶é—´æˆ³-å¼€å§‹å’Œç»“æŸã€‚</font><font style="vertical-align: inherit;">åœ¨æ—¥å¿—ä¸­ï¼Œæˆ‘æŸ¥çœ‹äº†feyloverä¹‹å‰çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘æ­£åœ¨å¯»æ‰¾åŸå› ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·å°±å¯ä»¥äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆä»¥åŠå°†æ¥å¯ä»¥åšä»€ä¹ˆï¼Œå› æ­¤åœ¨ç›¸åŒæƒ…å†µä¸‹ä¸ä¼šå‘ç”Ÿè¿‡æ¸¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºæ­¤ï¼Œæˆ‘çœ‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼ŒPatroniæ—¥å¿—ã€‚</font></font></li>
<li>  PostgreSQL   DCS    ,     Patroni.</li>
<li>  â€”     ,    .</li>
</ul><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è‡ªåŠ¨æ–‡ä»¶ç®¡ç†å™¨è¿˜æœ‰è®¸å¤šå…¶ä»–äº§å“ï¼šstolonï¼Œrepmgrï¼Œpg_auto_failoverï¼ŒPAFã€‚æˆ‘å°è¯•äº†æ‰€æœ‰4ç§å·¥å…·ï¼Œæˆ‘è®¤ä¸ºPatroniæ˜¯å½“ä»Šå¸‚åœºä¸Šæœ€å¥½çš„å·¥å…·ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘æ¨èå¸•ç‰¹ç½—å°¼å—ï¼Ÿå½“ç„¶ï¼Œæ˜¯çš„ï¼Œå› ä¸ºæˆ‘å–œæ¬¢Patroniï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºæˆ‘å­¦ä¼šäº†çƒ¹é¥ªæ–¹æ³•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨æœ‰å…´è¶£æŸ¥çœ‹Patroniçš„å…¶ä»–é—®é¢˜ï¼Œé™¤äº†æ–‡ç« ä¸­æè¿°çš„é—®é¢˜ï¼Œæ‚¨å¯ä»¥éšæ—¶è®¿é—®é¡µé¢</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/zalando/patroni/issues</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æœ‰å¾ˆå¤šä¸åŒçš„æ•…äº‹ã€‚å°½ç®¡å…¶ä¸­æœ‰ä¸€åŠæ˜¯æ¥è‡ªç›²äººç”¨æˆ·ï¼Œä»–ä»¬è¯¢é—®æ„šè ¢çš„é—®é¢˜å´ä¸æ‰“æ‰°ç®€å•çš„æœç´¢ï¼Œä½†åœ¨é‚£é‡Œä»ç„¶è®¨è®ºäº†æœ‰è¶£çš„é—®é¢˜ï¼Œå¹¶ä¸”é€šè¿‡è®¨è®ºï¼Œåœ¨å¿…è¦æ—¶æ‰“å¼€äº†ä¿®å¤é”™è¯¯çš„ä»»åŠ¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ„Ÿè°¢Zalandoå¼€å‘æ­¤é¡¹ç›®ï¼Œå¹¶æ„Ÿè°¢å¼€å§‹ç ”ç©¶æ­¤äº§å“çš„ä¸¤ä¸ªäººï¼šAlexander Kukushkinå’ŒAlexey Klyukinã€‚éå¸¸æ„Ÿè°¢æ‰€æœ‰Patroniè´¡çŒ®è€…ã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ä»½æŠ¥å‘Šä¹‹åï¼Œæˆ‘ä»¬è®°å½•äº†ä¸€æ¬¡ç®€çŸ­çš„é‡‡è®¿ï¼Œå…¶ä¸­Alexè¯•å›¾å°†ä»–çš„æŠ¥å‘Šé€‚åˆä¸€ä¸ªç†äº‹ä¼šï¼Œå¹¶å‘Šè¯‰äº†ä¸ºä»€ä¹ˆå‚åŠ ä¼šè®®å¹¶åœ¨ä¼šè®®ä¸Šå‘è¨€ã€‚æ­¦è£…èµ·æ¥ï¼Œæ£€æŸ¥ä¸€ä¸‹Saint HighLoad ++çš„æ–¹æ³•ã€‚</font></font></i><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lnw02pCpgRw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<blockquote> HighLoad++   6-7 .      ,    .          ,        ( ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>).      -  <strong></strong>     ,  ,     ,     .<br>
<br>
    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Saint HighLoad++</a>!    ,  ,      PostgreSQL:   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>,     PostgreSQL    JSON    ;   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>   PostgreSQL 13,  ;   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>     .</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN489194/index.html">OpenShiftå¦‚ä½•æ”¹å˜ITç»„ç»‡çš„ç»„ç»‡ç»“æ„ã€‚è½¬å‘PaaSæ—¶ç»„ç»‡æ¨¡å‹çš„æ¼”å˜</a></li>
<li><a href="../zh-CN489196/index.html">Magic Smokeï¼šå¾®æ§åˆ¶å™¨ä¸çº¿æ€§ç¨³å‹å™¨</a></li>
<li><a href="../zh-CN489198/index.html">å¦‚ä½•ä¸ä½¿ç”¨Liquibaseå°„è„š</a></li>
<li><a href="../zh-CN489200/index.html">å“ªäº›åˆåˆ›å…¬å¸æ­£åœ¨å¯»æ‰¾2020å¹´çš„Y Combinator</a></li>
<li><a href="../zh-CN489204/index.html">æ·±å…¥äº†è§£FacebookæœåŠ¡çš„å¯é æ€§</a></li>
<li><a href="../zh-CN489210/index.html">å¸¦æœ‰ç¤ºä¾‹çš„Linuxä»£ç æ€§èƒ½æµ‹è¯•</a></li>
<li><a href="../zh-CN489212/index.html">1C-Bitrixé€šè¿‡è¦æ±‚æäº¤å…¶ä¸ªäººæ•°æ®æ¥é˜²æ­¢é€€è®¢æ–°é—»é€šè®¯</a></li>
<li><a href="../zh-CN489214/index.html">åœ¨iOSä¸Šæµ‹è¯•æœ¬åœ°åŒ–çš„ç°ä»£æ–¹æ³•</a></li>
<li><a href="../zh-CN489218/index.html">å¤©çœŸã€‚è¶…çº§ï¼šç®€å•æ¸¸æˆçš„ä»£ç å’Œæ¶æ„</a></li>
<li><a href="../zh-CN489226/index.html">åœ¨Cï¼ƒ.NETä¸­ä¼˜åŒ–LINQæŸ¥è¯¢çš„æ–¹æ³•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>