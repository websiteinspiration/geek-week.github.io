<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📴 ⛽️ 🤛🏽 Bitrix24：「すぐにレイズしたからといって落下したとは見なされない」 👨 😸 🤵🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今日まで、Bitrix24サービスには数百ギガビットのトラフィックがなく、サーバーの巨大なフリートはありません（もちろん、既存のサーバーは多数ありますが）。しかし、多くの顧客にとって、それは会社で働くための主要なツールであり、実際にビジネスに不可欠なアプリケーションです。したがって、落下-まあ、方法...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bitrix24：「すぐにレイズしたからといって落下したとは見なされない」</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/455112/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日まで、Bitrix24サービスには数百ギガビットのトラフィックがなく、サーバーの巨大なフリートはありません（もちろん、既存のサーバーは多数ありますが）。しかし、多くの顧客にとって、それは会社で働くための主要なツールであり、実際にビジネスに不可欠なアプリケーションです。したがって、落下-まあ、方法はありません。しかし、落下が発生したが、サービスが「反抗」したため、誰も気づかなかった場合はどうなりますか？また、作業の品質と顧客数を失うことなく、どのようにしてフェイルオーバーを実装できますか？ Bitrix24クラウドサービスのディレクターであるAlexander Demidovは、バックアップシステムが製品の存在の7年間でどのように進化したかについてブログに語りました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/iz/9_/xpiz9_ri1tdppyelfb8nu9tzeg8.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「SaaSの形で、私たちは7年前にBitrix24を発売しました。主な問題は、おそらく次のとおりでした。SaaSの形で公開される前は、この製品は単に箱入りのソリューションの形式で存在していました。クライアントは私たちからそれを購入し、サーバーに配置し、企業ポータルを設定しました。これは、従業員のコミュニケーション、ファイルストレージ、タスク管理、CRMなどの一般的なソリューションです。そして2012年までに、SaaSとして起動し、自分で管理し、フォールトトレランスと信頼性を提供することを決定しました。その過程で経験を積みました。それまではそれがなかったからです。サービスプロバイダーではなく、ソフトウェアメーカーだけでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスを開始するとき、最も重要なことは、サービスのフォールトトレランス、信頼性、および一定の可用性を確保することであると理解しました。たとえば、単純な通常のWebサイト、店舗があり、それがあなたから転落して1時間経過した場合-自分だけが苦しみ、注文を失うからです。 、あなたは顧客を失いますが、クライアント自身にとっては-これはそれほど重要ではありません。</font><font style="vertical-align: inherit;">もちろん彼は動揺していたが、別のサイトに行って買った。</font><font style="vertical-align: inherit;">そして、これがすべて社内で機能するアプリケーション、通信、ソリューションが関連付けられている場合、最も重要なことは、ユーザーの信頼を獲得することです。つまり、ユーザーを失望させたり落としたりしないことです。</font><font style="vertical-align: inherit;">内部の何かが機能しない場合、すべての作業が起きる可能性があるためです。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SaaSとしてのBitrix.24</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2011年に公開する1年前に組み立てた最初のプロトタイプ。約一週間で集まり、見て、ねじれた-彼は働いていた。つまり、フォームにアクセスして、そこにポータルの名前を入力し、新しいポータルを展開し、ユーザーベースを設定することができました。それを見て、原則として評価し、電源を切り、1年後に完成させました。 2つの異なるコードベースを作成したくなかった、個別のボックス化された製品、個別のクラウドソリューションをサポートしたくなかったという大きな課題があったため、同じコード内ですべてを実行したかったのです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/zu/fe/lwzufe1w3lchcx7iqtwwh04gqfu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当時の典型的なWebアプリケーションは、いくつかのphpコードが実行されている1つのサーバー、mysqlベース、ファイルのダウンロード、ドキュメント、画像のアップロードフォルダーへの配置です。残念ながら、これでは非常に持続可能なWebサービスを実行することはできません。そこでは分散キャッシュはサポートされておらず、データベースレプリケーションはサポートされていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要件を定式化しました。この機能は異なる場所に配置し、レプリケーションをサポートするため、理想的には地理的に分散した異なるデータセンターに配置するためです。製品のロジックと、実際にはデータのストレージを分離します。負荷に応じて動的にスケーリングでき、一般に静力学を作成します。これらの考慮事項から、実際には、この年に開発したばかりの製品に対する要件がありました。この間、統一されたプラットフォーム-ボックス化されたソリューション、独自のサービス-で、私たちは必要なものをサポートしました。製品自体のレベルでのmysqlレプリケーションのサポート：つまり、コードを作成する開発者は、自分のリクエストがどのように分散されるかを考えず、APIを使用しており、マスターとスレーブ間で書き込みリクエストと読み取りリクエストを正しく分散できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまなクラウドオブジェクトストアを製品レベルでサポートしました：google storage、amazon s3、さらに、オープンスタックswiftのサポート。したがって、サービスにとっても、ボックスソリューションで作業する開発者にとっても便利でした。作業にapiを使用するだけの場合、ファイルシステムのローカルまたはオブジェクトファイルストレージのどこにファイルが保存されるかを考えません。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、データセンター全体のレベルで予約することをすぐに決定しました。</font><font style="vertical-align: inherit;">2012年には、このプラットフォームでの経験がすでにあるため、Amazon AWSで完全に立ち上げました。自社のWebサイトがそこでホストされていました。</font><font style="vertical-align: inherit;">アマゾンの各リージョンにはいくつかのアクセスゾーンがあり、実際には（その用語では）互いに独立している複数のデータセンターがあり、データセンター全体のレベルで予約できるという事実に惹かれました：それは突然失敗し、マスター-マスターデータベースが複製され、Webアプリケーションサーバーが予約され、staticがs3オブジェクトストレージに移動されます。</font><font style="vertical-align: inherit;">負荷は分散されます。その時点ではアマゾンのエルブですが、少し複雑なロジックが必要だったため、少し後に独自のバランサーに到達しました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼らが欲しかった、彼らはそれを手に入れました...</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが提供したかったすべての基本的なもの-サーバー自体、Webアプリケーション、データベースの耐障害性-すべてがうまくいきました。最も単純なシナリオ：一部のWebアプリケーションに障害が発生した場合、すべては単純です-それらはバランスからオフになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0y/vn/7h/0yvn7ho3syy9rpwkz8wo7govryu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マシン自体をクラッシュさせたマシンバランサー（当時はAmazonian elb）が異常とマークし、それらの負荷分散をオフにしました。アマゾンの自動スケーリングが機能しました。負荷が増大すると、新しい車が自動スケーリンググループに追加され、負荷が新しい車に分散されました。バランサーを使用しても、ロジックはほぼ同じです。アプリケーションサーバーで何かが発生した場合は、サーバーからリクエストを削除し、これらのマシンを破棄して、新しいマシンを開始し、作業を続行します。これらすべての年のスキームは少し変更されましたが、引き続き機能します。シンプルで理解可能であり、これに問題はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは世界中で働いており、お客様のピーク時の負荷は完全に異なります。良い意味で、私たちはお客様の目に見えない形でいつでもシステムのコンポーネントを使用して特定のメンテナンス作業を実行できるはずです。したがって、データベースをシャットダウンして、2番目のデータセンターの負荷を再分散する機会があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはどのように機能しますか？ -稼働中のデータセンターにトラフィックを切り替えます-データセンターでの事故の場合、完全に、1つのベースで計画されている作業であれば、これらのクライアントにサービスを提供しているトラフィックの一部を、2番目のデータセンターに切り替えて停止しますレプリケーション。 Webアプリケーションに新しいマシンが必要な場合は、2番目のデータセンターの負荷が増加したため、自動的に起動します。作業が終了し、レプリケーションが復元され、ロード全体が返されます。たとえば、システムアップデートをインストールしたり、2番目のデータベースの設定を変更したりするなど、2番目のDCで作業をミラーリングする必要がある場合は、通常、同じことを逆の方法で繰り返します。そして、これが偶然の場合は、すべてをささいなことで行います。監視システムでは、イベントハンドラーメカニズムを使用します。複数のチェックが機能し、ステータスがクリティカルになった場合、このハンドラーが起動されます。これは、このロジックまたはそのロジックを実行できるハンドラーです。データベースごとに、どのサーバーがフェイルオーバーするか、および使用できない場合にトラフィックを切り替える必要がある場所を登録しました。私たちは-歴史的に発展したように-ある形式または別のnagiosまたはそのフォークのいずれかで使用します。原則として、ほぼすべての監視システムに同様のメカニズムが存在します。複雑なものはまだ使用していませんが、いつかは使用する予定です。現在、監視はアクセス不能によってトリガーされ、何かを切り替えることができます。トラフィックが利用できない場合にトラフィックを切り替える必要がある場所。私たちは-歴史的に発展したように-ある形式または別のnagiosまたはそのフォークのいずれかで使用します。原則として、ほぼすべての監視システムに同様のメカニズムが存在します。まだ複雑なものは使用していませんが、いつかは使用する予定です。現在、監視はアクセス不能によってトリガーされ、何かを切り替えることができます。トラフィックが利用できない場合にトラフィックを切り替える必要がある場所。私たちは-歴史的に発展したように-ある形式または別のnagiosまたはそのフォークのいずれかで使用します。原則として、ほぼすべての監視システムに同様のメカニズムが存在します。まだ複雑なものは使用していませんが、いつかは使用する予定です。現在、監視はアクセス不能によってトリガーされ、何かを切り替えることができます。</font></font><br>
<br>
<h4>   ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはアメリカからの多くの顧客、ヨーロッパからの多くの顧客、東に近い多くの顧客-日本、シンガポールなどを持っています。もちろん、ロシアの顧客の大部分。つまり、仕事が1つの地域に存在することにはほど遠い。ユーザーは迅速な対応を望んでおり、さまざまな地域の法律を遵守するための要件が​​あり、各リージョン内で2つのデータセンター用に予約されています。さらに、1つのリージョン内に配置するのに便利な追加サービスがいくつかあります。地域の仕事。 RESTハンドラー、承認サーバー、それらはクライアント全体にとってそれほど重要ではありません。許容可能なわずかな遅延でそれらを切り替えることができますが、自転車を発明したり、それらを監視したり、それらを使って何をしたりする必要はありません。したがって、既存のソリューションを最大限に活用しようとしています。追加の製品である種の能力を開発するのではなく。そしてどこかで、DNSレベルでの切り替えを簡単に使用し、同じDNSでサービスの活性を判断します。 AmazonにはRoute 53サービスがありますが、すべてを記録できるDNSだけでなく、はるかに柔軟で便利です。それを使用して、地理位置情報を使用して地理分散サービスを構築できます。これを使用してクライアントがどこから来たのかを特定し、特定のレコードを提供すると、フェイルオーバーアーキテクチャを構築できます。 Route 53自体にも同じヘルスチェックが構成されています。監視するエンドポイントを指定し、メトリックを設定し、サービスの活性を決定するプロトコル（tcp、http、https）を指定します。サービスがライブかどうかを決定するチェックの頻度を設定します。そしてDNS自体で、プライマリになるもの、セカンダリになるものを指定します。ルート53内のヘルスチェックがトリガーされた場合に切り替える場所です。これはすべて他のツールを使用して実行できますが、より便利な方法です。一度セットアップしてから、チェックの方法や切り替え方法についても考慮しません。すべてが単独で機能します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の「しかし」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：ルート53自体を予約する方法と方法彼に何かが起こった場合、それは起こりますか？幸いにも、このレーキを踏んだことは一度もありませんが、再び目の前で、なぜまだ予約が必要だと思ったのかを説明します。ここでは事前にストローを敷きます。 1日に数回、ルート53にあるすべてのゾーンを完全にアンロードします。 AmazonのAPIを使用すると、それらをJSONに安全に送信できます。また、いくつかの冗長サーバーを作成し、変換し、構成の形式でアップロードし、大まかに言って、バックアップ構成を用意しています。その場合、手動ですばやく展開できます。DNS設定データは失われません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目の「しかし」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：この写真で予約されていないものは何ですか？バランサー自身！私たちは、地域ごとの顧客の分布を非常にシンプルにしました。 bitrix24.ru、bitrix24.com、.deドメインがあります-非常に異なるゾーンで動作する13の異なるドメインがあります。私たちは次のことを実現しました。各地域には独自のバランサーがあります。ネットワークのピーク負荷の場所に応じて、地域ごとに分散する方が便利です。これがいずれかのバランサーのレベルでの障害である場合は、単に廃止され、DNSから削除されます。バランサーのグループで何らかの問題が発生した場合、それらは他のサイトで予約され、それらの間の切り替えは同じroute53を使用して行われます。これは、短いttlが原因で、切り替えが最大2、3、5分間発生するためです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3番目の「しかし」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：他に何が予約されていませんか？ S3、そうです。ユーザーによって保存されたファイルをs3に配置する私たちは、鎧を貫通するものであり、そこに何も予約する必要がないと誠実に信じていました。しかし、歴史は異なって何が起こるかを示しています。一般的に、AmazonはS3を基本的なサービスとして説明しています。Amazon自体がS3を使用してマシン、構成、AMIイメージ、スナップショットのイメージを保存しているためです...そして、s7がクラッシュした場合、7年間に一度発生したbitrix24の使用量に続いて、ファンが続きます仮想マシンを起動できない、APIの誤動作など、すべての束を引き出します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、S3は落ちることがあります-それは一度起こりました。したがって、私たちは次のスキームに行きました：数年前、ロシアには深刻なオブジェクトのパブリックストレージがなく、私たち自身で何かを行うオプションを検討していました...幸い、私たちはこれを始めませんでした。所有し、おそらくそれをしたでしょう。現在Mail.ruにはs3互換のストレージがあり、Yandexにはそれがあり、多くのプロバイダーにはまだあります。その結果、最初に冗長性を確保し、次にローカルコピーを処理する機能を実現したいという結論に達しました。特定のロシアの地域では、s3とAPI互換性のあるMail.ru Hotboxサービスを使用します。アプリケーション内のコードに重大な変更を加える必要はなく、次のメカニズムを作成しました。s3には、オブジェクトの作成/削除を処理するトリガーがあり、AmazonにはLambdaのようなサービスがあります。これはサーバーレスのコード実行であり、特定のトリガーがトリガーされたときにのみ実行されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yv/y5/cp/yvy5cp7xsn82ryeocsgos7ns7ss.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に簡単に実行しました。トリガーが機能する場合は、オブジェクトをMail.ruリポジトリにコピーするコードを実行します。データのローカルコピーの使用を完全に開始するには、逆同期も必要です。これにより、ロシアのセグメントにあるクライアントは、より近いストレージで作業できます。メールがリポジトリでトリガーを完了しようとしています。すでにインフラストラクチャレベルでリバース同期を実行することは可能ですが、今のところ、これを独自のコードのレベルで実行しています。クライアントが何らかのファイルを配置したことがわかった場合は、コードレベルでイベントをキューに入れて処理し、逆方向のレプリケーションを実行します。なぜそれが悪いのか：もし私たちが私たちの製品の外部にあるオブジェクトを使って何らかの作業をしている場合、つまり何らかの外部的な手段である場合、これは考慮されません。だから最後まで待つトリガーがストレージレベルで表示されると、どこからコードを実行しても、到着したオブジェクトが反対側にコピーされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードレベルでは、クライアントごとに両方のリポジトリが登録されます。1つはメインと見なされ、もう1つはバックアップです。</font><font style="vertical-align: inherit;">すべてが順調であれば、私たちはより近いストレージを使用します。つまり、Amazonにいるお客様、S3を使用しているお客様、ロシアで作業しているお客様はHotboxを使用しています。</font><font style="vertical-align: inherit;">チェックボックスが機能する場合、フェイルオーバーは私たちに接続するはずであり、クライアントを別のストレージに切り替えます。</font><font style="vertical-align: inherit;">このフラグは地域ごとに個別に設定でき、前後に切り替えることができます。</font><font style="vertical-align: inherit;">実際には、これはまだ使用していませんが、このメカニズムは予測されており、いつかはこのスイッチを必要とし、使用することになると考えています。</font><font style="vertical-align: inherit;">これはすでに一度起こっています。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おお、そしてあなたのアマゾンは逃げた...</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この4月は、ロシアでのテレグラムロックの開始の記念日です。この下に来た最も影響を受けたプロバイダーはアマゾンです。そして、残念ながら、世界中で働いていたロシアの企業はさらに苦しみました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会社がグローバルであり、ロシアがそのための非常に小さなセグメントである場合、3-5％-まあ、いずれにせよ、あなたはそれらを寄付することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが純粋にロシアの会社である場合-私はローカルに配置する必要があると確信しています-まあ、それはユーザー自身が便利で快適になるだけで、リスクは少なくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これがグローバルに機能する会社であり、ロシアと世界中のどこかからの顧客のシェアがほぼ等しい場合はどうでしょうか。セグメントの接続性は重要であり、いずれにせよ相互に連携する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018年3月の終わりに、Roskomnadzorは最大の通信事業者に手紙を送り、Zelloメッセンジャーをブロックするために数百万のIPアマゾンをブロックする計画であることを述べました。これらのプロバイダーのおかげで、彼らは全員に手紙を首尾よく漏らし、Amazonとの接続が崩れる可能性があるという理解がありました。それは金曜日でした、私たちはservers.ruから同僚にパニックで走りました：「友達、私たちはロシアではなく、Amazonではなく、たとえばアムステルダムのどこかにないいくつかのサーバーが必要です」たとえば、同じs3のエンドポイントなど、影響を与えることができないいくつかのエンドポイントに対して、少なくとも何らかの形で独自のVPNとプロキシをそこに配置できるようにするために、新しいサービスを上げて別のIPを取得することはできません。あなたはまだそこに着く必要があります。数日で、私たちはこれらのサーバーをセットアップし、それらを上げ、そして一般に、ロックの開始の準備をしました。 ILVが誇大広告と発生したパニックを見て、「いいえ、今は何もブロックしません」と言ったのは奇妙です。 （しかし、これはちょうど彼らが電報をブロックし始めた瞬間までです。）バイパスオプションを設定し、それらがロックに入らないことに気づいたにもかかわらず、私たちはそれでも全体を解体しませんでした。したがって、念のために。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/o1/c1/lao1c1iqnqljjdv76qb1s9hg-qo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして2019年、私たちはまだロックの状態に住んでいます。私は昨夜見ました：約100万のIPがブロックされ続けています。確かに、Amazonはほぼ完全にロック解除され、ピーク時には2,000万のアドレスに達しました...一般的に、現実は接続性、良好な接続性です。突然。技術的な理由ではない可能性があります-火災、掘削機など。または、これまで見てきたように、完全に技術的ではありません。したがって、自分のAS-kamiを持つ大規模な誰かがおそらく他の方法でそれを操縦することができます-直接接続およびその他のものはすでにl2レベルにあります。しかし、単純なバージョンでは、私たちと同じかそれよりも小さい場合でも、念のため、他の場所で発生したサーバーのレベルで冗長性を確保し、事前にvpn、プロキシを構成して、重要な接続があるセグメントの構成をすばやく切り替えることができます。 。これは私たちにとって2回以上役に立ちました。Amazonロックが開始したとき、最悪の場合はS3トラフィックを通過させましたが、徐々にすべてが失敗しました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、どのように予約する...プロバイダー全体？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、Amazon全体で障害が発生した場合のシナリオはありません。</font><font style="vertical-align: inherit;">ロシアについても同様のシナリオがあります。</font><font style="vertical-align: inherit;">ロシアの私たちには1つのプロバイダーがホストしていて、そこからいくつかのサイトを選ぶことにしました。</font><font style="vertical-align: inherit;">また、1年前に問題が発生しました。これらは2つのデータセンターですが、プロバイダーのネットワーク構成レベルですでに両方のデータセンターに影響を与える問題がある可能性があります。</font><font style="vertical-align: inherit;">そして、両方のサイトでアクセス不能になる可能性があります。</font><font style="vertical-align: inherit;">もちろん、それが起こったことです。</font><font style="vertical-align: inherit;">最終的には内部のアーキテクチャを再定義しました。</font><font style="vertical-align: inherit;">大きな変化はありませんが、ロシアでは現在、プロバイダーが1つではなく、2つの異なる2つのサイトがあります。</font><font style="vertical-align: inherit;">それらの1つが失敗した場合、別のものに切り替えることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮に、Amazonが別のプロバイダーのレベルで予約することを検討しています。</font><font style="vertical-align: inherit;">多分グーグル、多分他の誰か...しかし実際には、Amazonが同じアベイラビリティーゾーンレベルでクラッシュする場合、リージョン全体のレベルでクラッシュすることは非常にまれであることが観察されています。</font><font style="vertical-align: inherit;">したがって、理論的には「AmazonはAmazonではない」という予約をするかもしれませんが、実際にはまだ存在しません。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動化について一言</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
常に自動化が必要ですか？ここでは、Dunning-Krueger効果を思い出すことが適切です。 X軸には、私たちが得ている知識と経験、Y軸には、行動に対する自信があります。最初は何も知りませんし、全然わかりません。それから私たちは少し知っていて、非常に自信があります-これはいわゆる「愚かさのピーク」であり、「認知症と勇気」の絵でよく説明されています。さらに、私たちはすでに少し学び、戦闘に入る準備ができています。次に、何か非常に深刻な熊手を踏んで、何かを知っているように見えても絶望の谷に落ちますが、実際にはあまり知りません。そして、あなたが経験を積むにつれて、私たちはより自信を持つようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ha/-x/uy/ha-xuyf7ttz6wyojkkh5idgrli4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまな事故への自動切り替えに関するロジックは、このグラフで非常によく説明されています。私たちは始めました-私たちは何も知りませんでした、ほとんどすべての仕事は手動で行われました。それから、すべてが自動的に吊り下げられ、平和に眠ることができることに気づきました。そして突然、私たちはメガレーキに足を踏み入れました。私たちは誤検知を引き起こし、良い意味でそれが価値のないときにトラフィックを前後に切り替えました。したがって、複製または何か他のものが壊れます-それはまさに絶望の谷です。そして、すべてが賢く扱われなければならないという理解に至ります。つまり、誤警報の可能性を提供する自動化に依存することは理にかなっています。だが！結果が壊滅的なものになる可能性がある場合は、当直勤務に、当直エンジニアに、事故が確実に発生するように確認することをお勧めします。必要なアクションを手動で実行します...</font></font><br>
<br>
<h4></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは7年間、何かが落ちたときにパニックパニックが発生したという事実から、問題はなく、問題だけがあるという理解に至りました。問題は解決する必要があります。ある種のサービスを構築するときは、上から見てそれを見て、起こりうるすべてのリスクを評価してください。それらがすぐに表示されたら、予約とフォールトトレラントインフラストラクチャの構築の可能性を予測します。失敗してサービスが操作不能になる可能性があるポイントは、それを実行します。また、同じs3など、インフラストラクチャの一部の要素が確実に失敗しないように思われる場合でも、失敗する可能性があることに注意してください。そして、少なくとも理論的には、何かが起こった場合にあなたが彼らと何をするかについての考えを持っています。リスク管理計画を立てます。あなたが考えるときすべてを自動または手動で行う-リスクを評価する：自動化がすべてを切り替え始めるとどうなりますか-これは、事故に比べてさらに悪い状況につながりませんか？おそらく、どこかで、自動化の使用と当直のエンジニアの反応との間の合理的な妥協を使用する必要があるどこかで、実際の状況を高く評価し、何かがその場で切り替えられる必要があるかどうかを理解します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全主義と、最終的に得られる計画に費やすことができる実際の力、時間、お金との間の合理的な妥協点。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このテキストは、会議の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稼働時間4日目の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alexander Demidovのレポートの補足および拡張バージョンです</font><font style="vertical-align: inherit;">。</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja455100/index.html">オフィスでコーヒーを整理する方法</a></li>
<li><a href="../ja455102/index.html">IP経由のシリアルインターフェイスの接続</a></li>
<li><a href="../ja455104/index.html">BotAuth-ボットを使用したログインと登録</a></li>
<li><a href="../ja455106/index.html">ソフトウェア開発。2019トレンド</a></li>
<li><a href="../ja455110/index.html">従業員の幸せは興味深い仕事に依存していますか？Badoo、SKB Kontur、Dodo Pizza、Staply、Alternativa Gamesに伝える</a></li>
<li><a href="../ja455114/index.html">CPythonでの整数型の実装</a></li>
<li><a href="../ja455118/index.html">JenkinsとOracle APEXサービスの統合で未来へ</a></li>
<li><a href="../ja455120/index.html">Wi-fiは誰もが利用できるわけではありません。法律でネットワーク内の外国人を承認するにはどうすればよいですか？</a></li>
<li><a href="../ja455122/index.html">より高速なJavaリフレクションの代替</a></li>
<li><a href="../ja455126/index.html">未来のスマートな服：可能性はありますか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>