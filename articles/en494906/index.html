<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚ÄçüöÄ üå¶Ô∏è ‚òéÔ∏è Modes of operation of mail servers ‚úâÔ∏è ‚õπüèº üöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When installing Postfix on Debian-based distributions, a pseudo-graphic interface is launched with a set of templates for installation. These template...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Modes of operation of mail servers</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494906/"><img src="https://habrastorage.org/webt/be/i1/aj/bei1ajyzb92fj3gm59se_-3vgbs.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When installing Postfix on Debian-based distributions, a pseudo-graphic interface is launched with a set of templates for installation. </font><font style="vertical-align: inherit;">These templates are aimed at different modes of operation of the mail server, which depend on whether the mail server will accept mail, forward it and various variations of these two modes. </font><font style="vertical-align: inherit;">But these are just templates that are easy to change after installing the server. </font><font style="vertical-align: inherit;">Although I use Postfix on Debian as an example, these modes are universal for all mail servers.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/5SoT9XuT37E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Previous &lt; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How email works</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Next&gt; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About ports and encryption in mail servers </font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ‚ÄúNo configuration‚Äù</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/gs/nq/kf/gsnqkfkaag7kki54t6cw-rh5zrm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
option The first option in the list is No configuration ‚Äî if you select this, the mail server will not create the main configuration file, which is convenient when we have our own ready-made config file . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to restart the installation script, you need the command:</font></font><br>
<br>
<pre><code class="bash hljs">sudo dpkg-reconfigure postfix</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option ‚ÄúInternet Site‚Äù The</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qw/06/ly/qw06ly6bgwdfk0jqlmidtiplu1k.png"><br>
<br>
<img src="https://habrastorage.org/webt/eq/fz/cp/eqfzcpgtozivtmcnsazbyiap-zm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
second mode - Internet Site - is a template for a standard mail server that will receive mail and send it directly, without intermediaries. Let's go through the configuration options. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/pf/56/dapf56wdickh-mi-vxhbpiwf15e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we need to specify the name of the mail - that is, the domain for the mail addresses that is indicated after the dog. By default, postfix uses users on the system as users of the mail server. Thus, if you have a user user in the system, then he will be able to receive and send mail to user@example.org</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cx/q4/4_/cxq44_dwyn-wz8zb6v2vnlvkeqk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For security reasons, it is not recommended to use the root account to work with mail, so we are asked to indicate the user to whom all mail arriving at the addresses of postmaster, root and other system users will be forwarded. Often, various applications in the system, such as the cron task scheduler, send information to these addresses.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1g/81/y4/1g81y4pl9i43w9o3n9pmzv1a088.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further, the installer asks us to specify the domains to which our mail server will receive mail. Here, in addition to our main domain address, there are also localhost entries and various hostname variations. This is mainly needed for various internal services that send notifications. Also, as an option, some services send certain notifications to the full address of your mail server, let's say that your mail server has been listed in spam lists, for example, to postmaster@mail.example.org.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ib/ox/2y/ibox2y2aq9y1ikesbhmrx7hfcxw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the question is about synchronous updates. This question relates more to loaded mail services and speaks of the following. If we enable synchronous updates, the mail server will make sure the message is written to disk every time a message is sent and received. This reduces the performance of the mail server, but if the server suddenly shuts down when receiving or sending mail, there will be no lost messages. But if we use a journaling file system, such as ext3 or ext4, then our system is not afraid of a sudden shutdown. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g7/st/ua/g7stuahlikrpjkwf6azqjritwzw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is due to the fact that in a journaled file system all changes in the file system are pre-recorded in a special journal, which applies these changes, and then deletes them from the journal.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-q/sb/kk/-qsbkkhd2px48wiszd0-zrbf4nu.png"><br>
<br>
<img src="https://habrastorage.org/webt/wb/wj/kl/wbwjklnmdisz-fmmi5rzwe4izp0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the server suddenly turned off at the time of recording, then when you turn it on, the file system checks the log, sees incomplete changes and writes them to disk. Therefore, if you use a journaling file system, feel free to click No.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wf/if/ky/wfifkydq9w-f2_crusnqpfbb6ku.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we are offered to specify those networks for which postfix will act as a relay host. In this role, the mail server not only accepts mail to its domain, but can also forward messages to other mail servers. Suppose you can send a message to Gmail by specifying not smtp.gmail.com but mail.examle.org as the outgoing mail server, then your mail server will take care of delivering your message to smtp.gmail.com. We will talk about this in more detail later, when we will discuss other templates. In the meantime, if you do not plan to use your server as a host relay, you can leave only the localhost in the field. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/vi/8l/cqvi8lbs9atgnhuuatblmgjwbtg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is simple here - the default maximum size of the user's mailbox, in bytes. If it is 0, no limit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/63/jy/wp63jyaih3-nnqdvsoc9tqld7ki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then something more interesting -</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">custom aliases</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In general, aliases in mail servers are used so that one user can receive mail at several addresses, without creating separate users, mailboxes, etc. Say, if you want all messages to it@example.org to be sent to user@example.org, then an alias is used for this. Also, using aliases, different domains are bound to one user. These aliases can be created by the mail server administrator. But, an administrator can allow users to create something like aliases to make it easier for users to manage their mail. But these user aliases do not replace the entire address, but are added before the dog, after using the special character, say, a plus. As an example, gmail also provides this feature:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mw/cg/hz/mwcghzliwzwl9zepjrrpbns9bzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, user+work@example.org, or user+social@example.org. The user can specify these addresses on various resources during registration, which will make it easier for him to sort letters and manage his mail. If you do not need this functionality, you can leave this field empty. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/uy/dk/nzuydkjmn5sffso_vv-jxjtfsue.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, you should choose whether our mail server will work with ipv4, ipv6, or with both protocols. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On this setup with the Intenet Site template is ready, theoretically you can get to work. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option "Internet with smarthost"</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/yr/mi/uw/yrmiuwgbx9j_jbmbx3i5a2bua_i.png"><br>
<br>
<img src="https://habrastorage.org/webt/rk/ue/h7/rkueh78h0qk6ycqaqsstwdziyri.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The third option among the mail server operating modes is internet with smarthost. This is a configuration template for a server that will accept mail directly, or using any utilities such as fetchmail, but the server will send mail to external addresses using other mail servers - host relays, which are also called smart hosts. This can be used in various cases, for example, if your server‚Äôs IP address is blacklisted, or to allow outgoing corporate mail through a leak prevention service, etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pg/oo/a6/pgooa68lttnnhinjy9ivmwacmdw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, all the options in setting up this mode also look the same, with the exception of the relay server. A smart host can be indicated in square brackets and without, depending on whether you need to send messages immediately or after making an MX request, which allows you to balance traffic between multiple smart hosts. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dl/r2/0q/dlr20qquvluu7rhczwnuhnls19g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the template, we can specify the default smarthost, and in the future we can configure various relays depending on the recipient's domain. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Satellite System Option</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/-5/gl/m0/-5glm0dvgiucq15rr-g9qzi3t8s.png"><br>
<br>
<img src="https://habrastorage.org/webt/nv/sc/yn/nvscynugnsuze6yadek_7rmeuv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another mode of operation of the mail server is the Satellite system. In this mode, the mail server does not accept mail, but only redirects, that is, it works exclusively as a relay host. From the example earlier, this can be useful in large organizations for internal services, as well as for filtering mail for spam, viruses, etc. In this case, the configuration is almost identical to the previously mentioned options, but in mydestionations you should not leave domains so that the host redirects everything to the necessary mail servers. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option "Local only"</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/7a/ej/z5/7aejz5t8_7rp6tjqmbw3s7dfqjo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
And the last template - Local only - when our mail server will not send and receive mail from other servers.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All that we talked about earlier are just templates of the mail service operating modes. </font><font style="vertical-align: inherit;">User cases are different and often such template settings are not enough, and many points need to be reconfigured for your tasks.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494882/index.html">What to do to not go after new eyes after quarantine</a></li>
<li><a href="../en494884/index.html">Digital Dictation 2020 will be held online from March 28 to April 11</a></li>
<li><a href="../en494890/index.html">Chat Rules</a></li>
<li><a href="../en494896/index.html">Coronavirus: a dangerous illusion of mortality</a></li>
<li><a href="../en494904/index.html">Cat infected with COVID-19 virus from its owner in Belgium</a></li>
<li><a href="../en494908/index.html">From pilots to testers: how a former military man built an alternate airfield in IT</a></li>
<li><a href="../en494910/index.html">Blood plasma from coronavirus survivors can be used to fight infection</a></li>
<li><a href="../en494912/index.html">My contribution to the protection against Covid-19</a></li>
<li><a href="../en494916/index.html">How to sell merchant accounts and ride a wave of interest in online business</a></li>
<li><a href="../en494918/index.html">The third week of the remote - normal flight. Reviews from IT QIWI guys about full-time work from home</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>