<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçö üë©üèº‚Äçü§ù‚Äçüë©üèª üë©üèΩ‚ÄçüöÄ PHP: array_key_exists busca 500 veces m√°s r√°pido que in_array üë©üèª‚Äçüè´ üìå üßëüèø‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2014, ya escribieron sobre la b√∫squeda de la matriz , pero casi nadie entendi√≥.
 
 Desde entonces, muchas versiones de PHP se han lanzado y no se h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PHP: array_key_exists busca 500 veces m√°s r√°pido que in_array</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490664/"><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En 2014, ya escribieron sobre la b√∫squeda de la matriz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero casi nadie entendi√≥.</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Desde entonces, muchas versiones de PHP se han lanzado y no se han solucionado, lo que significa que los comentarios son malos y pocas personas lo saben. En python es lo mismo, y en 3 * peor que en 2.7.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A veces necesita encontrar una cadena en una matriz de cadenas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , una operaci√≥n muy frecuente en diferentes algoritmos, y si la matriz es peque√±a y se ve un poco y no en un bucle, entonces in_array es normal, no afecta la velocidad general, pero si necesita grandes datos y busca una matriz de mil millones de filas y mil millones de veces , entonces esto es cr√≠tico: mejor hora en lugar de semana.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una prueba simple muestra:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in_array busca</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone.com/Yb1mDa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6600ms</font><font style="vertical-align: inherit;">en 6-9 segundos</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y array_key_exists busca lo mismo, pero m√°s r√°pido que 250 (php5.6 / py3. *) 400+ veces (php7.3 / py2.7)</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideone .com / gwSmFc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ciclo aumentado 100 veces) 12 ms (6600/12 = 550 veces + -10% de propagaci√≥n debido a la carga y la memoria cach√©) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øPor qu√© sucede esto? </font><font style="vertical-align: inherit;">Considere en detalle:</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Encontrar cadenas en ensamblador / es puro es ordenar un conjunto de cadenas (r√°pido o burbuja), luego b√∫squeda binaria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El n√∫mero de pasos en un registro de b√∫squeda binaria (n) veces depende del tama√±o de la matriz y es mucho m√°s peque√±o que una b√∫squeda simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ordenar una serie de cadenas por adelantado, una vez y almacenarlas en cach√©, y luego hacer mil millones de b√∫squedas. </font><font style="vertical-align: inherit;">Pero eso no ayuda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por defecto, la ordenaci√≥n ocurre cada vez m√°s, aunque escribieron que mejoraron en 7.2 in_array a trav√©s de un hash, pero no mucho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Buscar √≠ndice / clave (como una cadena) en la asociaci√≥n. La matriz / diccionario se produce por hash de cadenas y procesamiento de colisi√≥n (errores de b√∫squeda hash). Un hash es el √≠ndice num√©rico de la matriz y se obtiene como (direcci√≥n del elemento cero) + desplazamiento * el tama√±o del puntero a la matriz de cadenas con este hash) en 2 pasos. + colisiones de fuerza bruta, pasos en promedio inferiores a la b√∫squeda binaria. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El hash de √≠ndice se realiza autom√°ticamente una vez por adelantado al crear el elemento de diccionario $ m [clave] = val y se almacena en cach√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tama√±o del hash, el algoritmo de hash est√° cosido en el motor PCP y no se puede cambiar, aunque el c√≥digo fuente est√° abierto, puede descargarlo para cambiarlo y compilarlo en su servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No puede leer m√°s, cambie in_array a array_combine + array_key_exists y eso es todo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El n√∫mero de pasos cuando se busca por hash depende del n√∫mero de colisiones y del n√∫mero de l√≠neas con el mismo hash. Necesitan ser ordenados o tambi√©n ordenados y b√∫squeda binaria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para reducir las colisiones, puede asignar m√°s memoria, si es posible que ahora no sea un problema como hace 50 a√±os cuando 1 kb de memoria en bobinas magn√©ticas cuesta como un avi√≥n. Y fue entonces cuando se inventaron todos los algoritmos b√°sicos: sort / zip / gif / jpg / etc. - no necesitan mucha memoria, pero son malos, ahora son mucho mejores, pero necesitan mucha memoria 1-16 MB. S√≠, hay servidores con 256 MB y cada uno tiene una secuencia separada y 16 MB ya es mucho, pero en el dispositivo del usuario promedio 1 GB al menos y 16 MB es una gota en el cubo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede obtener a√∫n m√°s efecto si reemplaza la llamada a la funci√≥n array_key_exists con la construcci√≥n isset ($ m [clave]), no borra la cola de comandos y la cach√©, no usa la pila y es m√°s r√°pido en aproximadamente un 20%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n puede acelerarlo si crea una matriz de las primeras 2 letras - 4 * 16kb y mira primero en el desplazamiento (√≠ndice = c√≥digo del primer car√°cter + 2do * 256) un puntero a la matriz hash para el resto de la l√≠nea, luego b√∫squelo entre la peque√±a matriz de "colas" de las l√≠neas y las colisiones son mucho m√°s peque√±as. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Requiere a√∫n m√°s memoria y el algoritmo es m√°s complicado, pero la b√∫squeda es m√°s de 30 veces m√°s r√°pida. Pero esto no est√° implementado en php, puede escribir su biblioteca so / dll y llamarla, o pedirle a los desarrolladores que la agreguen en 7.5. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede buscar a trav√©s de mySQL, pero necesita agrupar las consultas y seguir√° siendo m√°s lento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PD: Este m√©todo se encontr√≥ accidentalmente al escribir, intuici√≥n y experiencia cuando aceler√© un sitio web grande y lento, hay muchas sutilezas y trucos, logr√© exportar los datos de 40 segundos a 0.8 segundos, listas de salida con clasificaci√≥n y filtros, y muchos otros cosas donde las t√©cnicas est√°ndar, los marcos y los marcos lo hacen muy lentamente, aunque, por supuesto, son convenientes y aceleran el desarrollo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es490650/index.html">Los principales errores al compilar un CV por parte de especialistas en TI para principiantes</a></li>
<li><a href="../es490652/index.html">Log√≠stica. Introducci√≥n Casi complicado</a></li>
<li><a href="../es490654/index.html">Puntos sobre los sensores de gas de la serie MQ: comprensi√≥n profunda de la hoja de datos y la optimizaci√≥n</a></li>
<li><a href="../es490656/index.html">Tareas externas de Camunda: una herramienta poderosa para crear aplicaciones con una arquitectura resistente y escalable</a></li>
<li><a href="../es490660/index.html">¬øC√≥mo aseguramos el crecimiento de CityMobile?</a></li>
<li><a href="../es490668/index.html">La historia de la transformaci√≥n de producto a proyecto y viceversa (utilizando el ejemplo de la bondad en la regi√≥n de Mosc√∫)</a></li>
<li><a href="../es490670/index.html">C√≥mo hacer que un auto escriba pruebas del c√≥digo para usted</a></li>
<li><a href="../es490674/index.html">Habr Wickley # 41 / M√°s autos aut√≥nomos, prof. Fortran, Yandex, el dolor del robot, c√≥mo bloquear el sitio de un competidor</a></li>
<li><a href="../es490676/index.html">Pruebas unitarias, ciencias y matem√°ticas.</a></li>
<li><a href="../es490678/index.html">Usando RabbitMQ con MonsterMQ Parte 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>