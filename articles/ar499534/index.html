<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง๐ป ๐ฉ๐พโ๐ผ ๐ด๐พ ุฏููู ุชุทููุฑ ุฎุฏูุฉ ุงููุงุฌูุฉ ุงูุฎูููุฉ ูู Python ๐จ๐พโ๐พ ๐ฉ๐พโโ๏ธ ๐จ๐ฝโ๐ญ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจูุง ุ ุงุณูู ุฃููุณูุฏุฑ ูุงุณูู ุ ูุฃูุง ูุทูุฑ ุฎูููุฉ ูู Edadil. ุจุฏุฃุช ููุฑุฉ ูุฐู ุงููุงุฏุฉ ุจุญูููุฉ ุฃููู ุฃุฑุฏุช ุชุญููู ุงููููุฉ ุงูุชูููุฏูุฉ ( Ya.Disk ) ูู ูุฏุฑุณุฉ Yandex Back...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ุฏููู ุชุทููุฑ ุฎุฏูุฉ ุงููุงุฌูุฉ ุงูุฎูููุฉ ูู Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/499534/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุญุจูุง ุ ุงุณูู ุฃููุณูุฏุฑ ูุงุณูู ุ ูุฃูุง ูุทูุฑ ุฎูููุฉ ูู Edadil. ุจุฏุฃุช ููุฑุฉ ูุฐู ุงููุงุฏุฉ ุจุญูููุฉ ุฃููู ุฃุฑุฏุช ุชุญููู ุงููููุฉ ุงูุชูููุฏูุฉ ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ya.Disk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ูู ูุฏุฑุณุฉ Yandex </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">Backend Development</font></a><font style="vertical-align: inherit;"> School. ููุฏ ุจุฏุฃุช ูู ูุตู ูู ุงูุชูุงุตูู ุงูุฏูููุฉ ูุงุฎุชูุงุฑ ุชูููุงุช ูุนููุฉ ุ ููููุฌูุฉ ุงูุงุฎุชุจุงุฑ ... ูุงุชุถุญ ุฃูู ูุง ููุฌุฏ ุชุญููู ุนูู ุงูุฅุทูุงู ุ ููููู ุฏููู ุชูุตููู ููุบุงูุฉ ุญูู ููููุฉ ูุชุงุจุฉ ุงููุงุฌูุงุช ุงูุฎูููุฉ ูู Python. ูู ุงูููุฑุฉ ุงูุฃูููุฉ ุ ูุงูุช ููุงู ูุชุทูุจุงุช ููุท ููุฎุฏูุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงูููุงุณุจ ุชูููู ุงูุฃุฏูุงุช ูุงูุชูููุงุช. ููุชูุฌุฉ ูุฐูู ุ ุงุณุชููุธุช ุนูู ูุงุฆุฉ ุฃูู ุญุฑู. ูุงู ููุงู ุงููุซูุฑ ุงููุทููุจ ูููุธุฑ ูู ูู ุดูุก ุจุชูุตูู ูุจูุฑ. ูุฐุง ุ ูุฅู ุจุฑูุงูุฌ ุงูู 100 ููููุจุงูุช ุงูุชุงูู: ููููุฉ ุจูุงุก ุฎูููุฉ ููุฎุฏูุฉ ุ ูู ุงุฎุชูุงุฑ ุงูุฃุฏูุงุช ุฅูู ุงููุดุฑ. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/sz/r2/pmszr288srjaplio0w_utpnb4ym.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL ุ DR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุง ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏูุจ GitHub ูุน ุงูุชุทุจูู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููู ูุญุจ ุงูุฎููุท ุงูุทูููุฉ (ุงูุญููููุฉ) - ูู ูุถูู ุ ุชุญุช ุงููุท.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูููู ุจุชุทููุฑ ูุงุฎุชุจุงุฑ ุฎุฏูุฉ REST API ูู Python ุ ูุญุฒููุง ูู ุญุงููุฉ Docker ุฎูููุฉ ุงููุฒู ููุดุฑูุง ุจุงุณุชุฎุฏุงู Ansible.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููู ุชูููุฐ ุฎุฏูุฉ REST API ุจุทุฑู ูุฎุชููุฉ ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช ูุฎุชููุฉ. </font><font style="vertical-align: inherit;">ุงูุญู ุงูููุตูู ููุณ ูู ุงูุญู ุงููุญูุฏ ุงูุตุญูุญ ุ ููุฏ ุงุฎุชุฑุช ุงูุชูููุฐ ูุงูุฃุฏูุงุช ุจูุงุกู ุนูู ุชุฌุฑุจุชู ุงูุดุฎุตูุฉ ูุชูุถููุงุชู.</font></font></blockquote><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ููุนูุ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุงูุฃุฏูุงุช ููุงุฎุชูุงุฑุ</font></font></a></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุทููุฑ</font></font></a><br>
 <ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฐุง ุชุญุชุงุฌ ุฅูู ุงูุจุฏุก ุจู setup.pyุ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุชุญุฏูุฏ ุฅุตุฏุงุฑุงุช ุงูุชุจุนูุฉุ</font></font></a></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุนุฏุฉ ุงูุจูุงูุงุช</font></font></a><br>
 <ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุจุชุตููู ุงููุฎุทุท</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุตู ุงููุฎุทุท ูู SQLAlchemy</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฎุตูุต Alembic</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูููุฏ ุงููุฌุฑุงุช</font></font></a></li>
</ul></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุทุจูู</font></font></a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณูุณู ุงูุจูุงูุงุช</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุงูุฌุงุช</font></font></a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุจุนุฏ / ุงููุงุฑุฏุงุช</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุตุญูุญ / ุงููุงุฑุฏุงุช / $ import_id / ููููุงุทููู / $ ููุงุทู_ุงููุนุฑูู</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู / ุฃุนูุงุฏ ุงููููุงุฏ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงููุฏู / ุณุชุงุช / ุงููุณุจุฉ ุงููุฆููุฉ / ุงูุนูุฑ</font></font></a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชุจุงุฑุงุช</font></font></a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุงูุฌุงุช</font></font></a><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุจุนุฏ / ุงููุงุฑุฏุงุช</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุตุญูุญ / ุงููุงุฑุฏุงุช / $ import_id / ููููุงุทููู / $ ููุงุทู_ุงููุนุฑูู</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู / ุฃุนูุงุฏ ุงููููุงุฏ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงููุฏู / ุณุชุงุช / ุงููุณุจุฉ ุงููุฆููุฉ / ุงูุนูุฑ</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฌุฑุงุช</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฌุณู</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ci</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดุฑ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชุจุงุฑ ุงูุฅุฌูุงุฏ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุงูุฐู ูููู ูุนูู ุฃูุถูุงุ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฎูุฑุง</font></font></a></li>
</ul><br>
<a name="task"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ููุนูุ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุฎูู ุฃู ูุชุฌุฑ ูุฏุงูุง ุนุจุฑ ุงูุฅูุชุฑูุช ูุฎุทุท ูุฅุทูุงู ุญุฏุซ ูู ููุงุทู ูุฎุชููุฉ. </font><font style="vertical-align: inherit;">ููู ุชููู ุงุณุชุฑุงุชูุฌูุฉ ุงููุจูุนุงุช ูุนุงูุฉ ุ ููุงู ุญุงุฌุฉ ุฅูู ุชุญููู ุงูุณูู. </font><font style="vertical-align: inherit;">ูุญุชูู ุงููุชุฌุฑ ุนูู ููุฑุฏ ูุฑุณู ุจุงูุชุธุงู (ุนูู ุณุจูู ุงููุซุงู ุ ุนู ุทุฑูู ุงูุจุฑูุฏ) ุชูุฑูุบ ุงูุจูุงูุงุช ุจูุนูููุงุช ุนู ุงููููููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนูุง ูุทูุฑ ุฎุฏูุฉ Python REST API ุงูุชู ุณุชุญูู ุงูุจูุงูุงุช ุงูููุฏูุฉ ูุชุญุฏุฏ ุงูุทูุจ ุนูู ุงููุฏุงูุง ูู ุงููููููู ูู ูุฎุชูู ุงููุฆุงุช ุงูุนูุฑูุฉ ูู ูุฏู ูุฎุชููุฉ ุญุณุจ ุงูุดูุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุจุชูููุฐ ุงููุนุงูุฌุงุช ุงูุชุงููุฉ ูู ุงูุฎุฏูุฉ:</font></font><br>
<br>
<ul>
<li> <code>POST /imports</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุถูู ุชุญููู ุฌุฏูุฏ ุจุงูุจูุงูุงุช ุ</font></font><br>
 </li>
<li> <code>GET /imports/$import_id/citizens</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฑุฌุงุน ุณูุงู ุงูุชูุฑูุบ ุงููุญุฏุฏ ุ</font></font><br>
 </li>
<li> <code>PATCH /imports/$import_id/citizens/$citizen_id</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุบููุฑ ูุนูููุงุช ุงููููู (ูุฃูุงุฑุจู) ูู ุงูุชูุฑูุบ ุงููุญุฏุฏ ุ</font></font><br>
 </li>
<li> <code>GET /imports/$import_id/citizens/birthdays</code><br>
  ,        ( ),   ;<br>
 </li>
<li> <code>GET /imports/$import_id/towns/stat/percentile/age</code><br>
 50-, 75-  99-   ( )      .<br>
 </li>
</ul><br>
<a name="tools"></a><h1>  ?</h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐูู ุ ูุญู ููุชุจ ุฎุฏูุฉ ูู Python ุจุงุณุชุฎุฏุงู ุฃุทุฑ ุงูุนูู ุงููุฃูููุฉ ูุงูููุชุจุงุช ู DBMS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 ูุญุงุถุฑุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฏูุฑุฉ ุงูููุฏูู ุ ุชู ูุตู DBMSs ุงููุฎุชููุฉ ูุฎุตุงุฆุตูุง. ุจุงููุณุจุฉ ููุชูููุฐ ุ ุงุฎุชุฑุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DBMS </font><font style="vertical-align: inherit;">ุ ุงูุชู ุฃุซุจุชุช ููุณูุง ูุญู ููุซูู ุจู ูุน </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซุงุฆู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุชุงุฒุฉ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุจุงููุบุฉ ุงูุฑูุณูุฉ</font></a><font style="vertical-align: inherit;"> ุ ูุฌุชูุน ุฑูุณู ููู (ููููู ุฏุงุฆููุง ุงูุนุซูุฑ ุนูู ุฅุฌุงุจุฉ ุณุคุงู ุจุงููุบุฉ ุงูุฑูุณูุฉ) ุ ูุญุชู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏูุฑุงุช ุงููุฌุงููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุงููููุฐุฌ ุงูุนูุงุฆูู ูุชุนุฏุฏ ุงูุงุณุชุฎุฏุงูุงุช ูููููู ุฌูุฏูุง ูู ูุจู ุงูุนุฏูุฏ ูู ุงููุทูุฑูู. ุนูู ุงูุฑุบู ูู ุฃูู ูููู ุงูููุงู ุจููุณ ุงูุดูุก ุนูู ุฃู NoSQL DBMS ุ ูู ูุฐู ุงูููุงูุฉ ุณููุธุฑ ูู PostgreSQL.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุฏู ุงูุฑุฆูุณู ูู ุงูุฎุฏูุฉ - ููู ุงูุจูุงูุงุช ุนุจุฑ ุงูุดุจูุฉ ุจูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุนููุงุก - ูุง ููุทูู ุนูู ุญูู ูุจูุฑ ุนูู ุงููุนุงูุฌ ุ ููููู ูุชุทูุจ ุงููุฏุฑุฉ ุนูู ูุนุงูุฌุฉ ุทูุจุงุช ูุชุนุฏุฏุฉ ูู ููุช ูุงุญุฏ. ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 ูุญุงุถุฑุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุนุชุจุฑ ููุฌ ุบูุฑ ูุชุฒุงูู. ูุณูุญ ูู ุจุฎุฏูุฉ ุงูุนุฏูุฏ ูู ุงูุนููุงุก ุจููุงุกุฉ ูู ููุณ ุนูููุฉ ูุธุงู ุงูุชุดุบูู (ุนูู ุนูุณ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูููุฐุฌ ูุง ูุจู ุงูุดููุฉ ุงููุณุชุฎุฏู ูู Flask / Django ุ ูุงูุฐู ูุฎูู ุงูุนุฏูุฏ ูู ุงูุนูููุงุช ููุนุงูุฌุฉ ุงูุทูุจุงุช ูู ุงููุณุชุฎุฏููู ุ ูู ูููู ูุณุชููู ุฐุงูุฑุฉ ุ ููููู ุฎุงูู ูุนุธู ุงูููุช ) ูุฐูู ุ ูููุชุจุฉ ููุชุงุจุฉ ุงูุฎุฏูุฉ ุ ุงุฎุชุฑุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://docs.aio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aiohttp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุบูุฑ ุงููุชุฒุงูู </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
ูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ูุญุงุถุฑุฉ 5TH ูู</font></a><font style="vertical-align: inherit;"> ุฏูุฑุฉ ููุฏูู ูุญูู ุฃู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">SQLAlchemy</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/or/rj/pn/orrjpnx6upvsipcqbsql7f36vzc.png"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุญ ูู ุจุชุญููู ุงูุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ ุฅูู ุฃุฌุฒุงุก ุ ูุฅุนุงุฏุฉ ุงุณุชุฎุฏุงููุง ุ ูุฅูุดุงุก ุงุณุชุนูุงูุงุช ุจูุฌููุนุฉ ุฏููุงููููุฉ ูู ุงูุญููู (ุนูู ุณุจูู ุงููุซุงู ุ ูุชูุญ ูุนุงูุฌ PATCH ุงูุชุญุฏูุซ ุงูุฌุฒุฆู ูููููู ุฐู ุงูุญููู ุงูุนุดูุงุฆูุฉ) ูุงูุชุฑููุฒ ูุจุงุดุฑุฉ ุนูู ููุทู ุงูุฃุนูุงู. ูููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจุฑูุงูุฌ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุดุบูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">asyncpg</font></a><font style="vertical-align: inherit;"> ูุนุงูุฌุฉ ูุฐู ุงูุทูุจุงุช ูููู ุงูุจูุงูุงุช ุจุดูู ุฃุณุฑุน </font><font style="vertical-align: inherit;">ุ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุณุงุนุฏูู asyncpgsa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูู ุชูููู ุตุฏุงูุงุช </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฃุฏุงุฉ ุงูููุถูุฉ ูุฏู ูุฅุฏุงุฑุฉ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุนูู ูุน ุนูููุงุช ุงูุชุฑุญูู ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alembic</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุจุงูููุงุณุจุฉ ุ ููุฏ ุชุญุฏุซุช ุนูู ูุคุฎุฑูุง ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ููุณูู</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชู ูุตู ููุทู ุงูุชุญูู ุจุฅูุฌุงุฒ ุจูุงุณุทุฉ ูุฎุทุทุงุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marshmallow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ุจูุง ูู ุฐูู ุงูุชุญูู ูู ุงูุฑูุงุจุท ุงูุนุงุฆููุฉ). ุงุณุชุฎุฏุงู ูุญุฏุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://github.com/maximdanilchenko/aio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงุตูุงุช aiohttp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ุฑุจุทุช ูุนุงูุฌุงุช ููุฎุทุทุงุช aiohttp ููุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุ ููุงูุช ุงูููุงูุฃุฉ ูู ุฅูุดุงุก ูุซุงุฆู ุจุชูุณูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Swagger</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุนุฑุถูุง ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฌูุฉ ุฑุณูููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุงุจุฉ ุงูุงุฎุชุจุงุฑุงุช ุ ุงุฎุชุฑุช </font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุงููุฒูุฏ ุนููุง ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 ูุญุงุถุฑุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุตุญูุญ ูุฐุง ุงููุดุฑูุน ููุถุน ููู ุชุนุฑูู ูู ุ ุงุณุชุฎุฏูุช ูุตุญุญ PyCharm ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุญุงุถุฑุฉ 9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 ูุญุงุถุฑุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุตู ููููุฉ ุชุดุบูู ุฃู ุฌูุงุฒ ููุจููุชุฑ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ุฃู ุญุชู ุนูู ูุธุงู ุชุดุบูู ูุฎุชูู) ูู ุญุฒู ุฏูู ุงูุญุงุฌุฉ ุฅูู ุถุจุท ุจูุฆุฉ ุงูุชุทุจูู ูุจุฏุก ุงูุชุดุบูู ูุณูููุฉ ุชุซุจูุช / ุชุญุฏูุซ / ุญุฐู ุงูุชุทุจูู ุนูู ุงูุฎุงุฏู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููุดุฑ ุ ุงุฎุชุฑุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ansible</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุณูุญ ูู ุจูุตู ุงูุญุงูุฉ ุงููุฑุบูุจุฉ ููุฎุงุฏู ูุฎุฏูุงุชู ุจุดูู ูุนูู ุ ููุนูู ุนุจุฑ ssh ููุง ูุชุทูุจ ุจุฑุงูุฌ ุฎุงุตุฉ.</font></font><br>
<br>
<a name="development"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุทููุฑ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฑุช ุชุณููุฉ ุญุฒูุฉ Python </font></font><code>analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุฎุฏุงู ุงูุจููุฉ ุงูุชุงููุฉ: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ox/ly/wt/oxlywtje20xt5ceou8pbtfp8an8.png" width="550"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูููู </font></font><code>analyzer/__init__.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุช ุจูุดุฑ ูุนูููุงุช ุนุงูุฉ ุญูู ุงูุญุฒูุฉ: ุงููุตู ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docstring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ุ ุงูุฅุตุฏุงุฑ ุ ุงูุชุฑุฎูุต ุ ุฌูุงุช ุงุชุตุงู ุงููุทูุฑ.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุนุฑุถู ุจูุณุงุนุฏุฉ ูุฏูุฌุฉ</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">$ python<font></font>
&gt;&gt;&gt; import analyzer<font></font>
&gt;&gt;&gt; <span class="hljs-built_in">help</span>(analyzer)<font></font>
<font></font>
Help on package analyzer:<font></font>
<font></font>
NAME<font></font>
    analyzer<font></font>
<font></font>
DESCRIPTION<font></font>
      REST API,    .<font></font>
<font></font>
PACKAGE CONTENTS<font></font>
    api (package)<font></font>
    db (package)<font></font>
    utils (package)<font></font>
<font></font>
DATA<font></font>
    __all__ = (<span class="hljs-string">'__author__'</span>, <span class="hljs-string">'__email__'</span>, <span class="hljs-string">'__license__'</span>, <span class="hljs-string">'__maintainer__'</span>,...<font></font>
    __email__ = <span class="hljs-string">'alvassin@yandex.ru'</span>
    __license__ = <span class="hljs-string">'MIT'</span>
    __maintainer__ = <span class="hljs-string">'Alexander Vasin'</span><font></font>
<font></font>
VERSION<font></font>
    0.0.1<font></font>
<font></font>
AUTHOR<font></font>
    Alexander Vasin<font></font>
<font></font>
FILE<font></font>
    /Users/alvassin/Work/backendschool2019/analyzer/__init__.py</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุชูู ุงูุญุฒูุฉ ุนูู ููุทุชู ุฅุฏุฎุงู - ุฎุฏูุฉ REST API ( </font></font><code>analyzer/api/__main__.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ูุฃุฏุงุฉ ุฅุฏุงุฑุฉ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ( </font></font><code>analyzer/db/__main__.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">ูุชู ุงุณุชุฏุนุงุก ุงููููุงุช </font></font><code>__main__.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุจุจ ูุง - ุฃููุงู ุ ูุซู ูุฐุง ุงูุงุณู ูุฌุฐุจ ุงูุงูุชุจุงู ุ ูููุถุญ ุฃู ุงูููู ูู ููุทุฉ ุฏุฎูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุซุงูููุง ุ ุจูุถู ูุฐุง ุงูููุฌ ูููุงุท ุงูุฏุฎูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>     python -m</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># REST API</span>
$ python -m analyzer.api --<span class="hljs-built_in">help</span><font></font>
<font></font>
<span class="hljs-comment">#    </span>
$ python -m analyzer.db --<span class="hljs-built_in">help</span></code></pre><br>
<a name="setuppy"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฐุง ุชุญุชุงุฌ ุฅูู ุงูุจุฏุก ุจู setup.pyุ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงููุธุฑ ุฅูู ุงููุณุชูุจู ุ ุณูููุฑ ูู ููููุฉ ุชูุฒูุน ุงูุชุทุจูู: ูููู ุชุนุจุฆุชู ูู ุฃุฑุดูู ูุถุบูุท (ููุฐูู ุนุฌูุฉ / ุจูุถุฉ) ุ ุญุฒูุฉ rpm ุ ููู pkg ููุธุงู macOS ูุชุซุจูุชู ุนูู ุฌูุงุฒ ููุจููุชุฑ ุจุนูุฏ ุฃู ุฌูุงุฒ ุงูุชุฑุงุถู ุฃู MacBook ุฃู Docker- ุญุงููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุบุฑุถ ุงูุฑุฆูุณู ูู ุงูููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>setup.py</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุตู ุงูุญุฒูุฉ ูุน ุงูุชุทุจูู </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
ูุฌุจ ุฃู ูุญุชูู ุงูููู ุนูู ูุนูููุงุช ุนุงูุฉ ุญูู ุงูุญุฒูุฉ (ุงูุงุณู ุ ุงูุฅุตุฏุงุฑ ุ ุงููุคูู ุ ููุง ุฅูู ุฐูู) ุ ูููู ููููู ุฃูุถูุง ุชุญุฏูุฏ ุงููุญุฏุงุช ุงููุทููุจุฉ ููุนูู ุ ูุงูุชุจุนูุงุช "ุงูุฅุถุงููุฉ" (ุนูู ุณุจูู ุงููุซุงู ุ ููุงุฎุชุจุงุฑ) ุ ูููุงุท ุงูุฅุฏุฎุงู (ุนูู ุณุจูู ุงููุซุงู ุ ุงูุฃูุงูุฑ ุงููุงุจูุฉ ููุชูููุฐ ) ููุชุทูุจุงุช ุงููุชุฑุฌู. </font><font style="vertical-align: inherit;">
ุชุณูุญ ูู ููููุงุช Setuptools ุจุฌูุน ุงููุทุน ุงูุฃุซุฑูุฉ ูู ุงูุญุฒูุฉ ุงูููุตููุฉ. ููุงู ุฅุถุงูุงุช ูุฏูุฌุฉ: zip ุ egg ุ rpm ุ macOS pkg. ูุชู ุชูุฒูุน ุงูุฅุถุงูุงุช ุงููุชุจููุฉ ุนุจุฑ PyPI: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">wheel</font></a><font style="vertical-align: inherit;"> ุ</font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">distutils</a>/<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">setuptools</a></code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุฎูุงุตุฉ ุ ููุตู ููู ูุงุญุฏ ุ ูุญุตู ุนูู ูุฑุต ุฑุงุฆุนุฉ. </font><font style="vertical-align: inherit;">ููุฐุง ุงูุณุจุจ ูุฌุจ ุฃู ูุจุฏุฃ ุชุทููุฑ ูุดุฑูุน ุฌุฏูุฏ </font></font><code>setup.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงููุธููุฉ ุ </font></font><code>setup()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดุงุฑ ุฅูู ุงููุญุฏุงุช ุงูุชุงุจุนุฉ ุจูุงุฆูุฉ:</font></font><br>
<br>
<pre><code class="python hljs">setup(..., install_requires=[<span class="hljs-string">"aiohttp"</span>, <span class="hljs-string">"SQLAlchemy"</span>])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ูุตูุช ุงูุชุจุนูุงุช ูู ูููุงุช ูููุตูุฉ </font></font><code>requirements.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>requirements.dev.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ุชุณุชุฎุฏู ูู ูุญุชููุงุช </font></font><code>setup.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุจุฏู ูู ุฃูุซุฑ ูุฑููุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุฌูุฏ ุณุฑ: ูู ููุช ูุงุญู ุณูุณูุญ ูู ุจุจูุงุก ุตูุฑุฉ Docker ุจุดูู ุฃุณุฑุน. </font><font style="vertical-align: inherit;">ุณูุชู ุชุนููู ุงูุชุจุนูุงุช ูุฎุทูุฉ ูููุตูุฉ ูุจู ุชุซุจูุช ุงูุชุทุจูู ููุณู ุ ูุนูุฏ ุฅุนุงุฏุฉ ุจูุงุก ุญุงููุฉ Docker ุ ุชููู ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃู ูููู </font></font><code>setup.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฏุฑุง ุนูู ูุฑุงุกุฉ ุชุจุนูุงุช ูู ุงููููุงุช </font></font><code>requirements.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>requirements.dev.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุชู ูุชุงุจุฉ ุงูุฏุงูุฉ:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_requirements</span>(<span class="hljs-params">fname: str</span>) -&gt; list:</span><font></font>
    requirements = []<font></font>
    <span class="hljs-keyword">with</span> open(fname, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> fp:
        <span class="hljs-keyword">for</span> req <span class="hljs-keyword">in</span> parse_requirements(fp.read()):<font></font>
            extras = <span class="hljs-string">'[{}]'</span>.format(<span class="hljs-string">','</span>.join(req.extras)) <span class="hljs-keyword">if</span> req.extras <span class="hljs-keyword">else</span> <span class="hljs-string">''</span><font></font>
            requirements.append(<font></font>
                <span class="hljs-string">'{}{}{}'</span>.format(req.name, extras, req.specifier)<font></font>
            )<font></font>
    <span class="hljs-keyword">return</span> requirements</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููู ุงูุฌุฏูุฑ ุจุงูุฐูุฑ ุฃู </font></font><code>setuptools</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูุชุถูู ุชูุฒูุน ูุตุฏุฑ ุงูุชุฌูุน ุงูุงูุชุฑุงุถู ููุท ุงููููุงุช ุงูุชุฌููุน </font></font><code>.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>.cpp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุฅูู ููู ุงูุชุจุนูุฉ </font></font><code>requirements.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>requirements.dev.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุถุฑุจ ููุณุ ูููุจุบู ุฃู ุชููู ูุญุฏุฏุฉ ุจุดูู ูุงุถุญ ูู ุงูููู </font></font><code>MANIFEST.in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setup.py ุจุงููุงูู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> importlib.machinery <span class="hljs-keyword">import</span> SourceFileLoader<font></font>
<font></font>
<span class="hljs-keyword">from</span> pkg_resources <span class="hljs-keyword">import</span> parse_requirements
<span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> find_packages, setup<font></font>
<font></font>
module_name = <span class="hljs-string">'analyzer'</span><font></font>
<font></font>
<span class="hljs-comment"># ,     (   ), </span>
<span class="hljs-comment">#   __init__.py   machinery.</span><font></font>
module = SourceFileLoader(<font></font>
    module_name, os.path.join(module_name, <span class="hljs-string">'__init__.py'</span>)<font></font>
).load_module()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_requirements</span>(<span class="hljs-params">fname: str</span>) -&gt; list:</span><font></font>
    requirements = []<font></font>
    <span class="hljs-keyword">with</span> open(fname, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> fp:
        <span class="hljs-keyword">for</span> req <span class="hljs-keyword">in</span> parse_requirements(fp.read()):<font></font>
            extras = <span class="hljs-string">'[{}]'</span>.format(<span class="hljs-string">','</span>.join(req.extras)) <span class="hljs-keyword">if</span> req.extras <span class="hljs-keyword">else</span> <span class="hljs-string">''</span><font></font>
            requirements.append(<font></font>
                <span class="hljs-string">'{}{}{}'</span>.format(req.name, extras, req.specifier)<font></font>
            )<font></font>
    <span class="hljs-keyword">return</span> requirements<font></font>
<font></font>
setup(<font></font>
    name=module_name,<font></font>
    version=module.__version__,<font></font>
    author=module.__author__,<font></font>
    author_email=module.__email__,<font></font>
    license=module.__license__,<font></font>
    description=module.__doc__,<font></font>
    long_description=open(<span class="hljs-string">'README.rst'</span>).read(),<font></font>
    url=<span class="hljs-string">'https://github.com/alvassin/backendschool2019'</span>,<font></font>
    platforms=<span class="hljs-string">'all'</span>,<font></font>
    classifiers=[<font></font>
        <span class="hljs-string">'Intended Audience :: Developers'</span>,
        <span class="hljs-string">'Natural Language :: Russian'</span>,
        <span class="hljs-string">'Operating System :: MacOS'</span>,
        <span class="hljs-string">'Operating System :: POSIX'</span>,
        <span class="hljs-string">'Programming Language :: Python'</span>,
        <span class="hljs-string">'Programming Language :: Python :: 3'</span>,
        <span class="hljs-string">'Programming Language :: Python :: 3.8'</span>,
        <span class="hljs-string">'Programming Language :: Python :: Implementation :: CPython'</span><font></font>
    ],<font></font>
    python_requires=<span class="hljs-string">'&gt;=3.8'</span>,<font></font>
    packages=find_packages(exclude=[<span class="hljs-string">'tests'</span>]),<font></font>
    install_requires=load_requirements(<span class="hljs-string">'requirements.txt'</span>),<font></font>
    extras_require={<span class="hljs-string">'dev'</span>: load_requirements(<span class="hljs-string">'requirements.dev.txt'</span>)},<font></font>
    entry_points={<font></font>
        <span class="hljs-string">'console_scripts'</span>: [
            <span class="hljs-comment"># f-strings  setup.py   - </span>
            <span class="hljs-comment"># .</span>
            <span class="hljs-comment">#   ,     Python 3.8, </span>
            <span class="hljs-comment"># source distribution       </span>
            <span class="hljs-comment">#   Python.     </span>
            <span class="hljs-comment"># .</span>
            <span class="hljs-string">'{0}-api = {0}.api.__main__:main'</span>.format(module_name),
            <span class="hljs-string">'{0}-db = {0}.db.__main__:main'</span>.format(module_name)<font></font>
        ]<font></font>
    },<font></font>
    include_package_data=<span class="hljs-literal">True</span>
)</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููู ุชุซุจูุช ุงููุดุฑูุน ูู ูุถุน ุงูุชุทููุฑ ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ ุงูุชุงูู (ูู ุงููุถุน ุงููุงุจู ููุชุญุฑูุฑ ุ ูู ุชููู Python ุจุชุซุจูุช ุงูุญุฒูุฉ ุจุฃููููุง ูู ูุฌูุฏ </font></font><code>site-packages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููู ููุท ุชูุดุฆ ุฑูุงุจุท ุ ูุฐูู ุณุชููู ุฃู ุชุบููุฑุงุช ูุชู ุฅุฌุฑุงุคูุง ุนูู ูููุงุช ุงูุญุฒูุฉ ูุฑุฆูุฉ ุนูู ุงูููุฑ):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#      extra- "dev"</span>
pip install -e <span class="hljs-string">'.[dev]'</span><font></font>
<font></font>
<span class="hljs-comment">#      </span>
pip install -e .</code></pre><br>
<a name="requirements"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุชุญุฏูุฏ ุฅุตุฏุงุฑุงุช ุงูุชุจุนูุฉุ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅูู ุฃูุฑ ุฑุงุฆุน ุนูุฏูุง ูุนูู ุงููุทูุฑูู ุจูุดุงุท ุนูู ุญุฒููู - ูุชู ุฅุตูุงุญ ุงูุฃุฎุทุงุก ุจุดูู ูุดุท ูููุง ุ ูุชุธูุฑ ูุธุงุฆู ุฌุฏูุฏุฉ ููููู ุงูุญุตูู ุนูู ุงูุชุนูููุงุช ุจุดูู ุฃุณุฑุน. ูููู ูู ุจุนุถ ุงูุฃุญูุงู ูุง ุชููู ุงูุชุบููุฑุงุช ูู ุงูููุชุจุงุช ุงูุชุงุจุนุฉ ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ููููู ุฃู ุชุคุฏู ุฅูู ุฃุฎุทุงุก ูู ุชุทุจููู ุฅุฐุง ูู ุชููุฑ ูู ุฐูู ูุณุจููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููู ุญุฒูุฉ ุชุงุจุนุฉ ุ ููููู ุชุญุฏูุฏ ุฅุตุฏุงุฑ ูุนูู ุ ุนูู ุณุจูู ุงููุซุงู </font></font><code>aiohttp==3.6.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุซู ุณูุชู ุถูุงู ุจูุงุก ุงูุชุทุจูู ุนูู ูุฌู ุงูุชุญุฏูุฏ ูุน ุชูู ุงูุฅุตุฏุงุฑุงุช ูู ุงูููุชุจุงุช ุงูุชุงุจุนุฉ ุงูุชู ุชู ุงุฎุชุจุงุฑูุง ูุนูุง. ููู ูุฐุง ุงูููุฌ ูู ุนูุจ - ุฅุฐุง ูุงู ุงููุทูุฑูู ุจุฅุตูุงุญ ุฎุทุฃ ูุงู ูู ุญุฒูุฉ ุชุงุจุนุฉ ูุง ุชุคุซุฑ ุนูู ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ุ ููู ูุฏุฎู ูุฐุง ุงูุฅุตูุงุญ ูู ุงูุชุทุจูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ููุฌ ูุฅุตุฏุงุฑ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุตุฏุงุฑ ุงูุฏูุงูู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุงูุชู ุชูุชุฑุญ ุฅุฑุณุงู ุงููุณุฎุฉ ุจุงูุชูุณูู </font></font><code>MAJOR.MINOR.PATCH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><code>MAJOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ูุฒูุฏ ุนูุฏ ุฅุถุงูุฉ ุชุบููุฑุงุช ุบูุฑ ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ุ</font></font></li>
<li><code>MINOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ุฒูุงุฏุฉ ุนูุฏ ุฅุถุงูุฉ ูุธุงุฆู ุฌุฏูุฏุฉ ูุน ุฏุนู ุงูุชูุงูู ุงูุนูุณู ุ</font></font></li>
<li><code>PATCH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ูุฒูุฏ ุนูุฏ ุฅุถุงูุฉ ุฅุตูุงุญุงุช ุงูุฃุฎุทุงุก ูุน ุฏุนู ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงู ุญุฒูุฉ ุชุนุชูุฏ ูุชุจุน ูุฐุง ุงูููุฌ (ุงูุชู ูุชู ุงูุฅุจูุงุบ ุนููุง ุงููุคูููู ุนุงุฏุฉ ูู ูููุงุช README ูุงูุชุบููุฑ)ุ ูุฅูู ูููู ูุฅุตูุงุญ ูููุฉ </font></font><code>MAJOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>MINOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุญุฏ ูู ูููุฉ ุงูุญุฏ ุงูุฃุฏูู ููPATCH ุงูุฅุตุฏุงุฑ: </font></font><code>&gt;= MAJOR.MINOR.PATCH, == MAJOR.MINOR.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุชูููุฐ ูุซู ูุฐุง ุงูุดุฑุท ุจุงุณุชุฎุฏุงู ุนุงูู ุงูุชุดุบูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ =</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุนูู ุณุจูู ุงููุซุงู ุ </font></font><code>aiohttp~=3.6.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุณูุญ ุจุชุซุจูุช PIP </font></font><code>aiohttp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฅุตุฏุงุฑ 3.6.3 ุ ูููุณ 3.7. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ููุช ุจุชุญุฏูุฏ ุงููุงุตู ุงูุฒููู ูุฅุตุฏุงุฑุงุช ุงูุชุจุนูุฉ ุ ูุณูุนุทู ูุฐุง ููุฒุฉ ุฅุถุงููุฉ ุฃุฎุฑู - ูู ูููู ููุงู ุชุนุงุฑุถ ูู ุงูุฅุตุฏุงุฑ ุจูู ุงูููุชุจุงุช ุงูุชุงุจุนุฉ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ููุช ุชููู ุจุชุทููุฑ ููุชุจุฉ ุชุชุทูุจ ุญุฒูุฉ ุชุจุนูุฉ ูุฎุชููุฉ ุ ููุง ุชุณูุญ ููุง ุจุฅุตุฏุงุฑ ูุงุญุฏ ูุญุฏุฏ ุ ุจู ุจูุงุตู ุฒููู. </font><font style="vertical-align: inherit;">ุซู ุณูููู ูู ุงูุฃุณูู ุจูุซูุฑ ุนูู ูุณุชุฎุฏูู ููุชุจุชู ุงุณุชุฎุฏุงููุง (ูุฌุฃุฉ ูุชุทูุจ ุชุทุจูููู ููุณ ุญุฒูุฉ ุงูุชุจุนูุฉ ุ ูููู ูู ุฅุตุฏุงุฑ ูุฎุชูู). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฅุตุฏุงุฑ ุงูุฏูุงูู ูู ูุฌุฑุฏ ุงุชูุงู ุจูู ูุคููู ููุณุชูููู ุงูุญุฒู. </font><font style="vertical-align: inherit;">ูุง ูุถูู ุฃู ุงููุคูููู ููุชุจูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุฏูู ุฃุฎุทุงุก ููุง ูููููู ุงุฑุชูุงุจ ุฎุทุฃ ูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู ุงูุญุฒูุฉ ุงูุฎุงุตุฉ ุจูู.</font></font><br>
<br>
<a name="db"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุนุฏุฉ ุงูุจูุงูุงุช</font></font></h2><br>
<a name="dbstructure"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุจุชุตููู ุงููุฎุทุท</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏู ูุตู ูุนุงูุฌ POST / ุงููุงุฑุฏุงุช ูุซุงูุงู ุนูู ุงูุชูุฑูุบ ุจูุนูููุงุช ุนู ุงููููููู:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซุงู ููุชุญููู</font></font></b>
                        <div class="spoiler_text"><pre><code class="json hljs">{
  <span class="hljs-attr">"citizens"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"citizen_id"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"town"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">"street"</span>: <span class="hljs-string">" "</span>,
      <span class="hljs-attr">"building"</span>: <span class="hljs-string">"1675"</span>,
      <span class="hljs-attr">"apartment"</span>: <span class="hljs-number">7</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"  "</span>,
      <span class="hljs-attr">"birth_date"</span>: <span class="hljs-string">"26.12.1986"</span>,
      <span class="hljs-attr">"gender"</span>: <span class="hljs-string">"male"</span>,
      <span class="hljs-attr">"relatives"</span>: [<span class="hljs-number">2</span>]<font></font>
    },<font></font>
    {<font></font>
      <span class="hljs-attr">"citizen_id"</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">"town"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">"street"</span>: <span class="hljs-string">" "</span>,
      <span class="hljs-attr">"building"</span>: <span class="hljs-string">"1675"</span>,
      <span class="hljs-attr">"apartment"</span>: <span class="hljs-number">7</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"  "</span>,
      <span class="hljs-attr">"birth_date"</span>: <span class="hljs-string">"01.04.1997"</span>,
      <span class="hljs-attr">"gender"</span>: <span class="hljs-string">"male"</span>,
      <span class="hljs-attr">"relatives"</span>: [<span class="hljs-number">1</span>]<font></font>
    },<font></font>
    {<font></font>
      <span class="hljs-attr">"citizen_id"</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">"town"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">"street"</span>: <span class="hljs-string">" "</span>,
      <span class="hljs-attr">"building"</span>: <span class="hljs-string">"2"</span>,
      <span class="hljs-attr">"apartment"</span>: <span class="hljs-number">11</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"  "</span>,
      <span class="hljs-attr">"birth_date"</span>: <span class="hljs-string">"23.11.1986"</span>,
      <span class="hljs-attr">"gender"</span>: <span class="hljs-string">"female"</span>,
      <span class="hljs-attr">"relatives"</span>: []<font></font>
    },<font></font>
    ...<font></font>
  ]<font></font>
}</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงู ุงูููุฑ ุงูุฃูู ูู ุชุฎุฒูู ุฌููุน ุงููุนูููุงุช ุญูู ุงููููู ูู ุฌุฏูู ูุงุญุฏ </font></font><code>citizens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุญูุซ ุณูุชู ุชูุซูู ุงูุนูุงูุฉ ุจุญูู </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดูู ูุงุฆูุฉ ุฃุนุฏุงุฏ ุตุญูุญุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ูุฐู ุงูุทุฑููุฉ ููุง ุนููุจ ุนุฏูุฏุฉ</font></font></b>
                        <div class="spoiler_text"><ol>
<li>   <code>GET /imports/$import_id/citizens/birthdays</code>   ,      ,     <code>citizens</code>   .          <code>relatives</code>    <code>UNNEST</code>.<br>
<br>
     ,  <b>    10- </b>:<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    relations.citizen_id, <font></font>
    relations.relative_id, <font></font>
    date_part(<span class="hljs-string">'month'</span>, relatives.birth_date) <span class="hljs-keyword">as</span> relative_birth_month
<span class="hljs-keyword">FROM</span> (
	<span class="hljs-keyword">SELECT</span><font></font>
        citizens.import_id, <font></font>
        citizens.citizen_id,<font></font>
        <span class="hljs-keyword">UNNEST</span>(citizens.relatives) <span class="hljs-keyword">as</span> relative_id
	<span class="hljs-keyword">FROM</span> citizens
    <span class="hljs-keyword">WHERE</span> import_id = <span class="hljs-number">1</span>
) <span class="hljs-keyword">as</span> relations
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> citizens <span class="hljs-keyword">as</span> relatives <span class="hljs-keyword">ON</span>
    relations.import_id = relatives.import_id <span class="hljs-keyword">AND</span><font></font>
    relations.relative_id = relatives.citizen_id<font></font>
</code></pre><br>
 </li>
<li>    <b>    <code>relatives</code>   PostgreSQL</b>,   :    <code>relatives</code>     ,      .       (     )         .</li>
</ol></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุงูุฉ ุนูู ุฐูู ุ ูุฑุฑุช ุฅุญุถุงุฑ ุฌููุน ุงูุจูุงูุงุช ุงููุทููุจุฉ ููุนูู ุฅูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดูู ุนุงุฏู ุซุงูุซ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุชู ุงูุญุตูู ุนูู ุงููููู ุงูุชุงูู:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/di/pf/px/dipfpxxw142kafiect0yhrtt4uo.png"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชููู </font><font style="vertical-align: inherit;">ุฌุฏูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุงุณุชูุฑุงุฏ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุนููุฏ ูุชุฒุงูุฏ ุชููุงุฆููุง </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุงู ุญุงุฌุฉ ูุฅูุดุงุก ุชุฏููู ููุชุงุญ ุฎุงุฑุฌู ูู ุงูุฌุฏูู </font></font><code>citizens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุฌุฏูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงุทููู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุชุฎุฒูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุจูุงูุงุช ุงูุนุฏุฏูุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนู ุงููููู (ุฌููุน ุงููุฌุงูุงุช ุจุงุณุชุซูุงุก ุงููุนูููุงุช ุญูู ุงูุนูุงูุงุช ุงูุฃุณุฑูุฉ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ุงุณุชุฎุฏุงู ุงูุฒูุฌ ( </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>citizen_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">ูููุชุงุญ ุฃุณุงุณู </font><font style="vertical-align: inherit;">ุ ููุง ูุถูู ุชูุฑุฏ ุงููููููู </font></font><code>citizen_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุงุฎู ุงูุฅุทุงุฑ </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุถูู </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูููุชุงุญ ุงูุฎุงุฑุฌู </font></font><code>citizens.import_id -&gt; imports.import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุญุชูุงุก ุงูุญูู </font></font><code>citizens.import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุนูููุงุช ุฅูุบุงุก ุงูุชุญููู ุงูููุฌูุฏุฉ ููุท.</font></font><br>
 </li>
<li>  <b>relations</b>    <b> </b>. <br>
<br>
<b>     </b> (     ):           <code>citizens</code>  <code>relations</code>     .<br>
     (<code>import_id</code>, <code>citizen_id</code>, <code>relative_id</code>)  ,      <code>import_id</code>   <code>citizen_id</code>   c  <code>relative_id</code>. <br>
<br>
       : <code>(relations.import_id, relations.citizen_id) -&gt; (citizens.import_id, citizens.citizen_id)</code>  <code>(relations.import_id, relations.relative_id) -&gt; (citizens.import_id, citizens.citizen_id)</code>, ,        <code>citizen_id</code>   <code>relative_id</code>   .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุถูู ูุฐุง ุงููููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุงูู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช PostgreSQL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููุชูุญ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู ุงููููููู ุจููุงุกุฉ ูุน ุงูุฃูุงุฑุจ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ููููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎุถุน ูุดุฑุท ุณุจุงู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูุฏ ุชุญุฏูุซ ุงููุนูููุงุช ุญูู ุงููููููู ุงูุฐูู ูุฏููู ุงุณุชุนูุงูุงุช ุชูุงูุณูุฉ (ุณูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ุชูููุฐ ูุนุงูุฌ PATCH).</font></font><br>
<br>
<a name="do_sqlalchemy"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุตู ุงููุฎุทุท ูู SQLAlchemy</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุตู ุงูุฎุงูุณ ุ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุญุฏุซุช ุนู ููููุฉ ุฅูุดุงุก ุงุณุชุนูุงูุงุช ุจุงุณุชุฎุฏุงู SQLAlchemy ุ ุชุญุชุงุฌ ุฅูู ูุตู ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ูุงุฆูุงุช ุฎุงุตุฉ: ุงูุฌุฏุงูู ููุตููุฉ ุจุงุณุชุฎุฏุงู </font></font><code>sqlalchemy.Table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฒูุฉ ุจุณุฌู </font></font><code>sqlalchemy.MetaData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุจุชุฎุฒูู ุฌููุน ุงููุนูููุงุช ุงููุตููุฉ ุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. ุจุงูููุงุณุจุฉ ุ </font></font><code>MetaData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูููู </font><font style="vertical-align: inherit;">ููุณุฌู </font><font style="vertical-align: inherit;">ููุท ุชุฎุฒูู ุงููุนูููุงุช ุงููุตููุฉ ุงูููุถุญุฉ ูู Python ุ ูููู ุฃูุถูุง ููุซู ุงูุญุงูุฉ ุงูุญููููุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุดูู ูุงุฆูุงุช SQLAlchemy. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุณูุญ ูุฐู ุงูููุฒุฉ ุฃูุถูุง ูู Alembic ุจููุงุฑูุฉ ุงูุดุฑูุท ูุฅูุดุงุก ุฑูุฒ ุงูุชุฑุญูู ุชููุงุฆููุง.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูููุงุณุจุฉ ุ ูู ูุงุนุฏุฉ ุจูุงูุงุช ูุฏููุง ูุธุงู ุชุณููุฉ ุงููููุฏ ุงูุงูุชุฑุงุถูุฉ ุงูุฎุงุตุฉ ุจูุง. </font><font style="vertical-align: inherit;">ุญุชู ูุง ุชุถูุน ุงูููุช ูู ุชุณููุฉ ูููุฏ ุฌุฏูุฏุฉ ุฃู ุงูุจุญุซ / ุชุฐูุฑ ุงููููุฏ ุงูุชู ุชูุดู ุนูู ุฅุฒุงูุชูุง ุ ุชูุชุฑุญ SQLAlchemy ุงุณุชุฎุฏุงู ุฃููุงุท </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃููุงุท </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุงูุชุณููุฉ</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูููู ุชุนุฑูููุง ูู ุงูุชุณุฌูู </font></font><code>MetaData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุฅูุดุงุก ุณุฌู MetaData ููู ุจุชูุฑูุฑ ุฃููุงุท ุงูุชุณููุฉ ุฅููู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># analyzer/db/schema.py</span>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> MetaData<font></font>
<font></font>
convention = {<font></font>
    <span class="hljs-string">'all_column_names'</span>: <span class="hljs-keyword">lambda</span> constraint, table: <span class="hljs-string">'_'</span>.join([<font></font>
        column.name <span class="hljs-keyword">for</span> column <span class="hljs-keyword">in</span> constraint.columns.values()<font></font>
    ]),<font></font>
<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-string">'ix'</span>: <span class="hljs-string">'ix__%(table_name)s__%(all_column_names)s'</span>,<font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-string">'uq'</span>: <span class="hljs-string">'uq__%(table_name)s__%(all_column_names)s'</span>,<font></font>
<font></font>
    <span class="hljs-comment">#  CHECK-constraint-</span>
    <span class="hljs-string">'ck'</span>: <span class="hljs-string">'ck__%(table_name)s__%(constraint_name)s'</span>,<font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-string">'fk'</span>: <span class="hljs-string">'fk__%(table_name)s__%(all_column_names)s__%(referred_table_name)s'</span>,<font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-string">'pk'</span>: <span class="hljs-string">'pk__%(table_name)s'</span><font></font>
}<font></font>
metadata = MetaData(naming_convention=convention)</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ุญุฏุฏุช ุฃููุงุท ุชุณููุฉ ุ ูุณูู ุชุณุชุฎุฏููุง Alembic ุฃุซูุงุก ุงูุชูููุฏ ุงูุชููุงุฆู ูุนูููุงุช ุงูุชุฑุญูู ูุณุชููู ุจุชุณููุฉ ุฌููุน ุงููููุฏ ููููุง ููุง. </font><font style="vertical-align: inherit;">ูู ุงููุณุชูุจู ุ </font></font><code>MetaData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุทูุจ </font><font style="vertical-align: inherit;">ุงูุชุณุฌูู ุงูุฐู ุชู ุฅูุดุงุคู </font><font style="vertical-align: inherit;">ููุตู ุงูุฌุฏุงูู:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุตู ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ูุงุฆูุงุช SQLAlchemy</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># analyzer/db/schema.py</span>
<span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum, unique<font></font>
<font></font>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> (<font></font>
    Column, Date, Enum <span class="hljs-keyword">as</span> PgEnum, ForeignKey, ForeignKeyConstraint, Integer,<font></font>
    String, Table<font></font>
)<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@unique</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Gender</span>(<span class="hljs-params">Enum</span>):</span>
    female = <span class="hljs-string">'female'</span>
    male = <span class="hljs-string">'male'</span><font></font>
<font></font>
<font></font>
imports_table = Table(<font></font>
    <span class="hljs-string">'imports'</span>,<font></font>
    metadata,<font></font>
    Column(<span class="hljs-string">'import_id'</span>, Integer, primary_key=<span class="hljs-literal">True</span>)<font></font>
)<font></font>
<font></font>
citizens_table = Table(<font></font>
    <span class="hljs-string">'citizens'</span>,<font></font>
    metadata,<font></font>
    Column(<span class="hljs-string">'import_id'</span>, Integer, ForeignKey(<span class="hljs-string">'imports.import_id'</span>),<font></font>
           primary_key=<span class="hljs-literal">True</span>),<font></font>
    Column(<span class="hljs-string">'citizen_id'</span>, Integer, primary_key=<span class="hljs-literal">True</span>),<font></font>
    Column(<span class="hljs-string">'town'</span>, String, nullable=<span class="hljs-literal">False</span>, index=<span class="hljs-literal">True</span>),<font></font>
    Column(<span class="hljs-string">'street'</span>, String, nullable=<span class="hljs-literal">False</span>),<font></font>
    Column(<span class="hljs-string">'building'</span>, String, nullable=<span class="hljs-literal">False</span>),<font></font>
    Column(<span class="hljs-string">'apartment'</span>, Integer, nullable=<span class="hljs-literal">False</span>),<font></font>
    Column(<span class="hljs-string">'name'</span>, String, nullable=<span class="hljs-literal">False</span>),<font></font>
    Column(<span class="hljs-string">'birth_date'</span>, Date, nullable=<span class="hljs-literal">False</span>),<font></font>
    Column(<span class="hljs-string">'gender'</span>, PgEnum(Gender, name=<span class="hljs-string">'gender'</span>), nullable=<span class="hljs-literal">False</span>),<font></font>
)<font></font>
<font></font>
relations_table = Table(<font></font>
    <span class="hljs-string">'relations'</span>,<font></font>
    metadata,<font></font>
    Column(<span class="hljs-string">'import_id'</span>, Integer, primary_key=<span class="hljs-literal">True</span>),<font></font>
    Column(<span class="hljs-string">'citizen_id'</span>, Integer, primary_key=<span class="hljs-literal">True</span>),<font></font>
    Column(<span class="hljs-string">'relative_id'</span>, Integer, primary_key=<span class="hljs-literal">True</span>),<font></font>
    ForeignKeyConstraint(<font></font>
        (<span class="hljs-string">'import_id'</span>, <span class="hljs-string">'citizen_id'</span>),<font></font>
        (<span class="hljs-string">'citizens.import_id'</span>, <span class="hljs-string">'citizens.citizen_id'</span>)<font></font>
    ),<font></font>
    ForeignKeyConstraint(<font></font>
        (<span class="hljs-string">'import_id'</span>, <span class="hljs-string">'relative_id'</span>),<font></font>
        (<span class="hljs-string">'citizens.import_id'</span>, <span class="hljs-string">'citizens.citizen_id'</span>)<font></font>
    ),<font></font>
)<font></font>
</code></pre></div>
                    </div><br>
<a name="db_alembic"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฎุตูุต Alembic</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูุชู ูุตู ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ููู ุงูุถุฑูุฑู ุฅูุดุงุก ุนูููุงุช ุงูุชุฑุญูู ุ ูููู ููุฐุง ุชุญุชุงุฌ ุฃููุงู ุฅูู ุชูููู Alembic ุ ูุงูุฐู ุชูุช ููุงูุดุชู ุฃูุถูุง ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุตู 5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุณุชุฎุฏุงู ุงูุฃูุฑ </font></font><code>alembic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฌุจ ุชูููุฐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซุจุช ุงููุฌููุนุฉ: </font></font><code>pip install alembic</code></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููุฆุฉ ุงูุฅูุจูู: </font></font><code>cd analyzer &amp;&amp; alembic init db/alembic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูููู ูุฐุง ุงูุฃูุฑ ุจุฅูุดุงุก ููู ุชูููู </font></font><code>analyzer/alembic.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฌูุฏ </font></font><code>analyzer/db/alembic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุญุชููุงุช ุงูุชุงููุฉ:</font></font><br>
 <ul>
<li> <code>env.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ูุณูู ูู ูู ูุฑุฉ ุชุจุฏุฃ ูููุง Alembic. </font><font style="vertical-align: inherit;">ูุชุตู ุจุชุณุฌูู Alembic </font></font><code>sqlalchemy.MetaData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุน ูุตู ุงูุญุงูุฉ ุงููุฑุบูุจุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช ููุญุชูู ุนูู ุฅุฑุดุงุฏุงุช ูุจุฏุก ุนูููุงุช ุงูุชุฑุญูู.</font></font><br>
 </li>
<li><code>script.py.mako</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ุงููุงูุจ ุงูุฐู ูุชู ุนูู ุฃุณุงุณู ุฅูุดุงุก ุนูููุงุช ุงูุชุฑุญูู.</font></font></li>
<li><code>versions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ุงููุฌูุฏ ุงูุฐู ุณุชุจุญุซ ููู Alembic (ูุชููุฏ) ุนูููุงุช ุงูุชุฑุญูู.</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุญุฏุฏ ุนููุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ููู alembic.ini:</font></font><br>
<br>
<pre><code class="plaintext hljs">; analyzer/alembic.ini<font></font>
[alembic] <font></font>
sqlalchemy.url = postgresql://user:hackme@localhost/analyzer</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฏุฏ ูุตููุง ููุญุงูุฉ ุงููุทููุจุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช (ุงูุชุณุฌูู </font></font><code>sqlalchemy.MetaData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ุจุญูุซ ูููู ูู Alembic ุฅูุดุงุก ุนูููุงุช ุงูุชุฑุญูู ุชููุงุฆููุง:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># analyzer/db/alembic/env.py</span>
<span class="hljs-keyword">from</span> analyzer.db <span class="hljs-keyword">import</span> schema<font></font>
target_metadata = schema.metadata</code></pre></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชู ุชูููู Alembic ููููู ุงุณุชุฎุฏุงูู ุจุงููุนู ุ ูููู ูู ุญุงูุชูุง ูุฐู ุงูุชููุฆุฉ ููุง ุนููุจ ุนุฏูุฏุฉ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ </font></font><code>alembic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุจุญุซ </font></font><code>alembic.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฏููู ุงูุนูู ุงูุญุงูู. </font><font style="vertical-align: inherit;">ููููู </font></font><code>alembic.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฏูุฏ </font><font style="vertical-align: inherit;">ุงููุณุงุฑ ุฅูู </font><font style="vertical-align: inherit;">ูุณูุทุฉ ุณุทุฑ ุงูุฃูุงูุฑ ุ ูููู ูุฐุง ุบูุฑ ูุฑูุญ: ุฃุฑูุฏ ุฃู ุฃููู ูุงุฏุฑูุง ุนูู ุงุณุชุฏุนุงุก ุงูุฃูุฑ ูู ุฃู ูุฌูุฏ ุจุฏูู ูุนููุงุช ุฅุถุงููุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูููู Alembic ููุนูู ูุน ูุงุนุฏุฉ ุจูุงูุงุช ูุญุฏุฏุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุบููุฑ ุงูููู </font></font><code>alembic.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุณูููู ูู ุงูุฃูุณุจ ุชุญุฏูุฏ ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุชุบูุฑ ุงูุจูุฆุฉ ู / ุฃู ูุณูุทุฉ ุณุทุฑ ุงูุฃูุงูุฑ ุ ุนูู ุณุจูู ุงููุซุงู </font></font><code>--pg-url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>alembic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูุฑุชุจุท </font><font style="vertical-align: inherit;">ุงุณู ุงูุฃุฏุงุฉ </font><font style="vertical-align: inherit;">ุจุดูู ุฌูุฏ ูุน ุงุณู ุฎุฏูุชูุง (ููุฏ ูุง ูููู ูุฏู ุงููุณุชุฎุฏู Python ุนูู ุงูุฅุทูุงู ููุง ูุนุฑู ุดูุฆูุง ุนู Alembic). </font><font style="vertical-align: inherit;">ุณูููู ุฃูุซุฑ ููุงุกูุฉ ูููุณุชุฎุฏู ุงูููุงุฆู ุฅุฐุง ูุงูุช ุฌููุน ุงูุฃูุงูุฑ ุงููุงุจูุฉ ููุชูููุฐ ููุฎุฏูุฉ ููุง ุจุงุฏุฆุฉ ูุดุชุฑูุฉ ุ ุนูู ุณุจูู ุงููุซุงู </font></font><code>analyzer-*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ุญู ูุฐู ุงููุดุงูู ุจุงุณุชุฎุฏุงู ุบูุงู ุตุบูุฑ. </font></font><code>analyzer/db/__main__.py:</code><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณุชุฎุฏู Alembic ูุญุฏุฉ ููุทูุฉ ููุงุณูุฉ ููุนุงูุฌุฉ ูุณูุทุงุช ุณุทุฑ ุงูุฃูุงูุฑ </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">argparse</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุณูุญ ูู ุจุฅุถุงูุฉ ูุณูุทุฉ ุงุฎุชูุงุฑูุฉ </font></font><code>--pg-url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูููุฉ ุงูุชุฑุงุถูุฉ ูู ูุชุบูุฑ ุจูุฆุฉ </font></font><code>ANALYZER_PG_URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฑูุฒ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> alembic.config <span class="hljs-keyword">import</span> CommandLine, Config
<span class="hljs-keyword">from</span> analyzer.utils.pg <span class="hljs-keyword">import</span> DEFAULT_PG_URL<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><font></font>
    alembic = CommandLine()<font></font>
    alembic.parser.add_argument(<font></font>
        <span class="hljs-string">'--pg-url'</span>, default=os.getenv(<span class="hljs-string">'ANALYZER_PG_URL'</span>, DEFAULT_PG_URL),<font></font>
        help=<span class="hljs-string">'Database URL [env var: ANALYZER_PG_URL]'</span><font></font>
    )<font></font>
    options = alembic.parser.parse_args()<font></font>
<font></font>
    <span class="hljs-comment">#    Alembic</span><font></font>
    config = Config(file_=options.config, ini_section=options.name,<font></font>
                    cmd_opts=options)<font></font>
<font></font>
    <span class="hljs-comment">#   sqlalchemy.url   Alembic</span>
    config.set_main_option(<span class="hljs-string">'sqlalchemy.url'</span>, options.pg_url)<font></font>
<font></font>
    <span class="hljs-comment">#   alembic</span><font></font>
    exit(alembic.run_cmd(config, options))<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    main()</code></pre></div>
                    </div></li>
<li><font style="vertical-align: inherit;"></font><code>alembic.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุญุณุงุจ </font><font style="vertical-align: inherit;">ูุณุงุฑ ุงูููู </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููููุน ุงูููู ุงููุงุจู ููุชูููุฐ ุ ูููุณ ุฏููู ุงูุนูู ุงูุญุงูู ูููุณุชุฎุฏู.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฑูุฒ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> alembic.config <span class="hljs-keyword">import</span> CommandLine, Config
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<font></font>
<font></font>
<font></font>
PROJECT_PATH = Path(__file__).parent.parent.resolve()<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><font></font>
    alembic = CommandLine()<font></font>
    options = alembic.parser.parse_args()<font></font>
<font></font>
    <span class="hljs-comment">#     (alembic.ini),   </span>
    <span class="hljs-comment">#    </span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isabs(options.config):<font></font>
        options.config = os.path.join(PROJECT_PATH, options.config)<font></font>
<font></font>
    <span class="hljs-comment">#    Alembic</span><font></font>
    config = Config(file_=options.config, ini_section=options.name,<font></font>
                    cmd_opts=options)<font></font>
<font></font>
    <span class="hljs-comment">#      alembic   (,  alembic</span>
    <span class="hljs-comment">#   env.py,       )</span>
    alembic_location = config.get_main_option(<span class="hljs-string">'script_location'</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isabs(alembic_location):<font></font>
        config.set_main_option(<span class="hljs-string">'script_location'</span>,<font></font>
                               os.path.join(PROJECT_PATH, alembic_location))<font></font>
<font></font>
    <span class="hljs-comment">#   alembic</span><font></font>
    exit(alembic.run_cmd(config, options))<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    main()</code></pre></div>
                    </div></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ุชููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ ูุฅุฏุงุฑุฉ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฌุงูุฒุฉ ุ ูููู ุชุณุฌูููุง </font></font><code>setup.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฃูุฑ ูุงุจู ููุชูููุฐ ุจุงุณู ูููู ูููุณุชุฎุฏู ุงูููุงุฆู ูููู ุ ุนูู ุณุจูู ุงููุซุงู </font></font><code>analyzer-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุชุณุฌูู ุฃูุฑ ุชูููุฐู ูู setup.py</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup<font></font>
<font></font>
setup(..., entry_points={<font></font>
    <span class="hljs-string">'console_scripts'</span>: [
        <span class="hljs-string">'analyzer-db = analyzer.db.__main__:main'</span><font></font>
    ]<font></font>
})<font></font>
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฅุนุงุฏุฉ ุชุซุจูุช ุงููุญุฏุฉ ุงูููุทูุฉ ุ ุณูุชู ุฅูุดุงุก ููู ูุณูุตุจุญ </font></font><code>env/bin/analyzer-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃูุฑ </font></font><code>analyzer-db</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุงุญูุง:</font></font><br>
<br>
<pre><code class="bash hljs">$ pip install -e <span class="hljs-string">'.[dev]'</span></code></pre><br>
<a name="db_alembic_migrations"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูููุฏ ุงููุฌุฑุงุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฅูุดุงุก ุนูููุงุช ุงูุชุฑุญูู ุ ููุฒู ูุฌูุฏ ุญุงูุชูู: ุงูุญุงูุฉ ุงููุฑุบูุจุฉ (ุงูุชู ูุตููุงูุง ูุน ูุงุฆูุงุช SQLAlchemy) ูุงูุญุงูุฉ ุงูุญููููุฉ (ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูู ุญุงูุชูุง ุ ูุงุฑุบุฉ). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฑุช ุฃู ุฃุณูู ุทุฑููุฉ ูุฑูุน Postgres ูุงูุช ูุน Docker ุ ููู ุฃุฌู ุงูุฑุงุญุฉ ุ ุฃุถูุช ุฃูุฑูุง ูุดุบู </font></font><code>make postgres</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุงููุฉ ูู ุงูุฎูููุฉ ุจุงุณุชุฎุฏุงู PostgreSQL ุนูู ุงููููุฐ 5432:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุน PostgreSQL ูุฅูุดุงุก ุงูุชุฑุญูู</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">$ make postgres<font></font>
...<font></font>
$ analyzer-db revision --message=<span class="hljs-string">"Initial"</span> --autogenerate<font></font>
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.<font></font>
INFO  [alembic.runtime.migration] Will assume transactional DDL.<font></font>
INFO  [alembic.autogenerate.compare] Detected added table <span class="hljs-string">'imports'</span>
INFO  [alembic.autogenerate.compare] Detected added table <span class="hljs-string">'citizens'</span>
INFO  [alembic.autogenerate.compare] Detected added index <span class="hljs-string">'ix__citizens__town'</span> on <span class="hljs-string">'['</span>town<span class="hljs-string">']'</span>
INFO  [alembic.autogenerate.compare] Detected added table <span class="hljs-string">'relations'</span>
  Generating /Users/alvassin/Work/backendschool2019/analyzer/db/alembic/versions/d5f704ed4610_initial.py ...  <span class="hljs-keyword">done</span></code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุดูู ุนุงู ุ ุชููู Alembic ุจุนูู ุฌูุฏ ูู ุงูุนูู ุงูุฑูุชููู ูุชูููุฏ ุงููุฌุฑุฉ ุ ูููู ุฃูุฏ ุฃู ุฃููุช ุงูุงูุชุจุงู ุฅูู ูุง ููู:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุฅูุดุงุก ุฃููุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ุงููุญุฏุฏุฉ ูู ุงูุฌุฏุงูู ุงูุชู ุชู ุฅูุดุงุคูุง ุชููุงุฆููุง (ูู ุญุงูุชูุง - </font></font><code>gender</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ุ ูููู </font></font><code>downgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font><font style="vertical-align: inherit;">ูุชู </font><font style="vertical-align: inherit;">ุฅูุดุงุก </font><font style="vertical-align: inherit;">ุงูุฑูุฒ ูุญุฐููุง </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุฅุฐุง ููุช ุจุชุทุจูู ุงูุชุฑุงุฌุน ุ ุซู ุงูุชุฑุงุฌุน ุ ุซู ุชุทุจูู ุงูุชุฑุญูู ูุฑุฉ ุฃุฎุฑู ุ ุณูุคุฏู ุฐูู ุฅูู ุญุฏูุซ ุฎุทุฃ ูุฃู ููุน ุงูุจูุงูุงุช ุงููุญุฏุฏ ููุฌูุฏ ุจุงููุนู.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุญุฐู ููุน ุจูุงูุงุช ุงูุฌูุณ ูู ุทุฑููุฉ ุงูุฑุฌูุน ุฅูู ุฅุตุฏุงุฑ ุฃูุฏู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> alembic <span class="hljs-keyword">import</span> op
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, Enum<font></font>
<font></font>
GenderType = Enum(<span class="hljs-string">'female'</span>, <span class="hljs-string">'male'</span>, name=<span class="hljs-string">'gender'</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upgrade</span>():</span><font></font>
    ...<font></font>
    <span class="hljs-comment">#      GenderType   </span>
    op.create_table(<span class="hljs-string">'citizens'</span>, ...,<font></font>
                    Column(<span class="hljs-string">'gender'</span>, GenderType, nullable=<span class="hljs-literal">False</span>))<font></font>
    ...<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">downgrade</span>():</span>
    op.drop_table(<span class="hljs-string">'citizens'</span>)<font></font>
<font></font>
    <span class="hljs-comment">#       </span>
    GenderType.drop(op.get_bind())</code></pre></div>
                    </div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุทุฑููุฉ ุ </font></font><code>downgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ูู ุจุนุถ ุงูุฃุญูุงู ุฅุฒุงูุฉ ุจุนุถ ุงูุฅุฌุฑุงุกุงุช (ุฅุฐุง ุญุฐููุง ุงูุฌุฏูู ุจุฃูููู ุ ูุง ููููู ุญุฐู ููุงุฑุณู ุจุดูู ูููุตู):</font></font><br>
 <br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">downgrade</span>():</span>
op.drop_table(<span class="hljs-string">'relations'</span>)<font></font>
<font></font>
<span class="hljs-comment">#      citizens,    </span>
<span class="hljs-comment">#    </span>
op.drop_index(op.f(<span class="hljs-string">'ix__citizens__town'</span>), table_name=<span class="hljs-string">'citizens'</span>)<font></font>
op.drop_table(<span class="hljs-string">'citizens'</span>)<font></font>
op.drop_table(<span class="hljs-string">'imports'</span>)</code></pre></div>
                    </div></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูููู ุงูุชุฑุญูู ุซุงุจุชูุง ูุฌุงูุฒูุง ุ ูุทุจูู:</font></font><br>
<br>
<pre><code class="bash hljs">$ analyzer-db upgrade head<font></font>
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.<font></font>
INFO  [alembic.runtime.migration] Will assume transactional DDL.<font></font>
INFO  [alembic.runtime.migration] Running upgrade  -&gt; d5f704ed4610, Initial</code></pre><br>
<a name="application"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุทุจูู</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจู ุงูุจุฏุก ูู ุฅูุดุงุก ูุนุงูุฌุงุช ุ ูุฌุจ ุนููู ุชูููู ุชุทุจูู aiohttp.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ูุธุฑุช ุฅูู aiohttp quickstart ุ ููููู ูุชุงุจุฉ ุดูุก ูู ูุฐุง ุงููุจูู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> logging<font></font>
<font></font>
<span class="hljs-keyword">from</span> aiohttp <span class="hljs-keyword">import</span> web<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-comment">#  </span><font></font>
    logging.basicConfig(level=logging.DEBUG)<font></font>
<font></font>
    <span class="hljs-comment">#  </span><font></font>
    app = web.Application()<font></font>
<font></font>
    <span class="hljs-comment">#  </span><font></font>
    app.router.add_route(...)<font></font>
<font></font>
    <span class="hljs-comment">#  </span><font></font>
    web.run_app(app)<font></font>
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุซูุฑ ูุฐุง ุงูุฑูุฒ ุนุฏุฏูุง ูู ุงูุฃุณุฆูุฉ ููุฏูู ุนุฏุฏ ูู ุงูุนููุจ:</font></font><br>
<br>
<ul>
<li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุชูููู ุงูุชุทุจููุ </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุฏ ุฃุฏูู ุ ูุฌุจ ุนููู ุชุญุฏูุฏ ุงููุถูู ูุงููููุฐ ูุชูุตูู ุงูุนููุงุก ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุนูููุงุช ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุญุจ ุญููุง ุญู ูุฐู ุงููุดููุฉ ุจูุณุงุนุฏุฉ ุงููุญุฏุฉ ุงูููุทูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>ConfigArgParse</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ููู ุชูุฏ </font><font style="vertical-align: inherit;">ุงููุดููุฉ </font><font style="vertical-align: inherit;">ุงูููุงุณูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>argparse</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุณูุญ ุจุงุณุชุฎุฏุงู ูุณูุทุงุช ุณุทุฑ ุงูุฃูุงูุฑ ููุชุบูุฑุงุช ุงูุจูุฆุฉ (ุงูุชู ูุง ุบูู ุนููุง ูุชูููู ุญุงููุงุช Docker) ูุญุชู ูููุงุช ุงูุชูููู (ุจุงูุฅุถุงูุฉ ุฅูู ุฏูุฌ ูุฐู ุงูุฃุณุงููุจ) ููุชูููู. </font><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงูู </font></font><code>ConfigArgParse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููููู ุฃูุถูุง ุงูุชุญูู ูู ููู ูุนููุงุช ุชูููู ุงูุชุทุจูู.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซุงู ุนูู ูุนููุงุช ุงููุนุงูุฌุฉ ุจุงุณุชุฎุฏุงู ConfigArgParse</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> aiohttp <span class="hljs-keyword">import</span> web
<span class="hljs-keyword">from</span> configargparse <span class="hljs-keyword">import</span> ArgumentParser, ArgumentDefaultsHelpFormatter<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.utils.argparse <span class="hljs-keyword">import</span> positive_int<font></font>
<font></font>
parser = ArgumentParser(<font></font>
    <span class="hljs-comment">#        ANALYZER_,</span>
    <span class="hljs-comment">#  ANALYZER_API_ADDRESS  ANALYZER_API_PORT</span>
    auto_env_var_prefix=<span class="hljs-string">'ANALYZER_'</span>,<font></font>
<font></font>
    <span class="hljs-comment">#     </span><font></font>
    formatter_class=ArgumentDefaultsHelpFormatter<font></font>
)<font></font>
<font></font>
parser.add_argument(<span class="hljs-string">'--api-address'</span>, default=<span class="hljs-string">'0.0.0.0'</span>,<font></font>
                    help=<span class="hljs-string">'IPv4/IPv6 address API server would listen on'</span>)<font></font>
<font></font>
<span class="hljs-comment">#      </span>
parser.add_argument(<span class="hljs-string">'--api-port'</span>, type=positive_int, default=<span class="hljs-number">8081</span>,<font></font>
                    help=<span class="hljs-string">'TCP port API server would listen on'</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-comment">#   ,     </span>
    <span class="hljs-comment">#  ,    </span><font></font>
    args = parser.parse_args()<font></font>
<font></font>
    <span class="hljs-comment">#       </span><font></font>
    app = web.Application()<font></font>
    web.run_app(app, host=args.api_address, port=args.api_port)<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    main()</code></pre></div>
                    </div><br>
, <code>ConfigArgParse</code>,   <code>argparse</code>,           (     <code>-h</code>  <code>--help</code>).       :<br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">$ python __main__.py --<span class="hljs-built_in">help</span><font></font>
usage: __main__.py [-h] [--api-address API_ADDRESS] [--api-port API_PORT]<font></font>
<font></font>
If an arg is specified <span class="hljs-keyword">in</span> more than one place, <span class="hljs-keyword">then</span> commandline values override environment variables <span class="hljs-built_in">which</span> override defaults.<font></font>
<font></font>
optional arguments:<font></font>
  -h, --<span class="hljs-built_in">help</span>            show this <span class="hljs-built_in">help</span> message and <span class="hljs-built_in">exit</span><font></font>
  --api-address API_ADDRESS<font></font>
                        IPv4/IPv6 address API server would listen on [env var: ANALYZER_API_ADDRESS] (default: 0.0.0.0)<font></font>
  --api-port API_PORT   TCP port API server would listen on [env var: ANALYZER_API_PORT] (default: 8081)</code></pre></div>
                    </div></li>
<li>             โ ,    ยซยป     .          ,  <strong>     </strong>. <br>
<br>
    <code>os.environ.clear()</code>,  Python            (,      <code>asyncio</code>?),        ,   <code>ConfigArgParser</code>.<br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Callable
<span class="hljs-keyword">from</span> configargparse <span class="hljs-keyword">import</span> ArgumentParser
<span class="hljs-keyword">from</span> yarl <span class="hljs-keyword">import</span> URL<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.api.app <span class="hljs-keyword">import</span> create_app
<span class="hljs-keyword">from</span> analyzer.utils.pg <span class="hljs-keyword">import</span> DEFAULT_PG_URL<font></font>
<font></font>
ENV_VAR_PREFIX = <span class="hljs-string">'ANALYZER_'</span><font></font>
<font></font>
parser = ArgumentParser(auto_env_var_prefix=ENV_VAR_PREFIX)<font></font>
parser.add_argument(<span class="hljs-string">'--pg-url'</span>, type=URL, default=URL(DEFAULT_PG_URL),<font></font>
                   help=<span class="hljs-string">'URL to use to connect to the database'</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">clear_environ</span>(<span class="hljs-params">rule: Callable</span>):</span>
    <span class="hljs-string">"""
      ,     
     rule
    """</span>
    <span class="hljs-comment">#   os.environ    tuple,    </span>
    <span class="hljs-comment"># os.environ   </span>
    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> filter(rule, tuple(os.environ)):<font></font>
        os.environ.pop(name)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-comment">#  </span><font></font>
    args = parser.parse_args()<font></font>
<font></font>
    <span class="hljs-comment">#      ANALYZER_</span>
    clear_environ(<span class="hljs-keyword">lambda</span> i: i.startswith(ENV_VAR_PREFIX))<font></font>
<font></font>
    <span class="hljs-comment">#  </span><font></font>
    app = create_app(args)<font></font>
    ...<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    main()</code></pre></div>
                    </div></li>
<li> <strong>   stderr/      .</strong><br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> 9</a> ,    <code>logging.basicConfig()</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>   stderr</code></a>.<br>
<br>
       ,       .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>   aiomisc.<br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    aiomisc</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> logging<font></font>
<font></font>
<span class="hljs-keyword">from</span> aiomisc.log <span class="hljs-keyword">import</span> basic_config<font></font>
<font></font>
basic_config(logging.DEBUG, buffered=<span class="hljs-literal">True</span>)    
</code></pre></div>
                    </div></li>
<li> <strong>  ,     </strong>    ?    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>fork</code></a>     ,           (,  Windows   ).<br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> argv<font></font>
<font></font>
<span class="hljs-keyword">import</span> forklib
<span class="hljs-keyword">from</span> aiohttp.web <span class="hljs-keyword">import</span> Application, run_app
<span class="hljs-keyword">from</span> aiomisc <span class="hljs-keyword">import</span> bind_socket
<span class="hljs-keyword">from</span> setproctitle <span class="hljs-keyword">import</span> setproctitle<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    sock = bind_socket(address=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">8081</span>, proto_name=<span class="hljs-string">'http'</span>)<font></font>
    setproctitle(<span class="hljs-string">f'[Master] <span class="hljs-subst">{os.path.basename(argv[<span class="hljs-number">0</span>])}</span>'</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">worker</span>():</span>
        setproctitle(<span class="hljs-string">f'[Worker] <span class="hljs-subst">{os.path.basename(argv[<span class="hljs-number">0</span>])}</span>'</span>)<font></font>
        app = Application()<font></font>
        run_app(app, sock=sock)<font></font>
<font></font>
    forklib.fork(os.cpu_count(), worker, auto_restart=<span class="hljs-literal">True</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    main()<font></font>
</code></pre></div>
                    </div></li>
<li>    <strong>   -    </strong>?  ,      (   โ    )    ,      <code>nobody</code>.      โ     .<br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> pwd<font></font>
<font></font>
<span class="hljs-keyword">from</span> aiohttp.web <span class="hljs-keyword">import</span> run_app
<span class="hljs-keyword">from</span> aiomisc <span class="hljs-keyword">import</span> bind_socket<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.api.app <span class="hljs-keyword">import</span> create_app<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-comment">#  </span>
    sock = bind_socket(address=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">8085</span>, proto_name=<span class="hljs-string">'http'</span>)<font></font>
<font></font>
    user = pwd.getpwnam(<span class="hljs-string">'nobody'</span>)<font></font>
    os.setgid(user.pw_gid)<font></font>
    os.setuid(user.pw_uid)<font></font>
<font></font>
    app = create_app(...)<font></font>
    run_app(app, sock=sock)<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    main()</code></pre></div>
                    </div></li>
<li>            <code>create_app</code>,         .</li>
</ul><br>
<a name="serialization"></a><h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูุชู ุฅุฑุฌุงุน ุฌููุน ุงุณุชุฌุงุจุงุช ุงููุนุงูุฌ ุงููุงุฌุญุฉ ุจุชูุณูู JSON. </font><font style="vertical-align: inherit;">ุณูููู ูู ุงูููุงุฆู ุฃูุถูุง ููุนููุงุก ุชููู ูุนูููุงุช ุญูู ุงูุฃุฎุทุงุก ูู ูููุฐุฌ ูุชุณูุณู (ุนูู ุณุจูู ุงููุซุงู ุ ููุนุฑูุฉ ุงูุญููู ุงูุชู ูู ุชูุฌุญ ูู ุงูุชุญูู ูู ุงูุตุญุฉ). </font><font style="vertical-align: inherit;">ุชูุฏู </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุซุงุฆู </font></font><code>aiohttp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุฑููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://docs.aio"><code>json_response</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฃุฎุฐ ูุงุฆููุง ุ ุชุณูุณูู ูู JSON ุ ูุชุฑุฌุน ูุงุฆููุง ุฌุฏูุฏูุง </font></font><code>aiohttp.web.Response</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฑุฃุณ </font></font><code>Content-Type: application/json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจูุงูุงุช ูุชุณูุณูุฉ ุจุฏุงุฎูู.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุฅุฌุฑุงุก ุชุณูุณู ููุจูุงูุงุช ุจุงุณุชุฎุฏุงู json_response</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> aiohttp.web <span class="hljs-keyword">import</span> Application, View, run_app
<span class="hljs-keyword">from</span> aiohttp.web_response <span class="hljs-keyword">import</span> json_response<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeView</span>(<span class="hljs-params">View</span>):</span>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> json_response({<span class="hljs-string">'hello'</span>: <span class="hljs-string">'world'</span>})<font></font>
<font></font>
<font></font>
app = Application()<font></font>
app.router.add_route(<span class="hljs-string">'*'</span>, <span class="hljs-string">'/hello'</span>, SomeView)<font></font>
run_app(app)<font></font>
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ููุงู ุทุฑููุฉ ุฃุฎุฑู: aiohttp ูุณูุญ ูู ุจุชุณุฌูู ููุณูุณูู ุนุดูุงุฆู ูููุน ูุญุฏุฏ ูู ุจูุงูุงุช ุงูุงุณุชุฌุงุจุฉ ูู ุงูุชุณุฌูู </font></font><code>aiohttp.PAYLOAD_REGISTRY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ููููู ุชุญุฏูุฏ ููุณูุณูู </font></font><code>aiohttp.JsonPayload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฆูุงุช ูู ููุน </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุนููู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุฐู ุงูุญุงูุฉ ุ ุณูููู ูุงูููุง ุฃู ูููู ุงููุนุงูุฌ ุจุฅุฑุฌุงุน ูุงุฆู </font></font><code>Response</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุจูุงูุงุช ุงูุงุณุชุฌุงุจุฉ ูู ุงููุนููุฉ </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุณูุนุซุฑ aiohttp ุนูู ููุณูุณู ูุทุงุจู ููุน ุงูุจูุงูุงุช ููุณูุณู ุงูุงุณุชุฌุงุจุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุฅุถุงูุฉ ุฅูู ุญูููุฉ ุฃู ุชุณูุณู ุงููุงุฆูุงุช ููุตูู ูู ููุงู ูุงุญุฏ ุ ูุฅู ูุฐุง ุงูููุฌ ุฃูุซุฑ ูุฑููุฉ ุฃูุถูุง - ููู ูุณูุญ ูู ุจุชูููุฐ ุญููู ูุซูุฑุฉ ููุงูุชูุงู ููุบุงูุฉ (ุณููุธุฑ ูู ุฅุญุฏู ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ูู ุงููุนุงูุฌ </font></font><code>GET /imports/$import_id/citizens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุฅุฌุฑุงุก ุชุณูุณู ููุจูุงูุงุช ุจุงุณุชุฎุฏุงู aiohttp.PAYLOAD_REGISTRY</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> types <span class="hljs-keyword">import</span> MappingProxyType
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Mapping<font></font>
<font></font>
<span class="hljs-keyword">from</span> aiohttp <span class="hljs-keyword">import</span> PAYLOAD_REGISTRY, JsonPayload
<span class="hljs-keyword">from</span> aiohttp.web <span class="hljs-keyword">import</span> run_app, Application, Response, View<font></font>
<font></font>
PAYLOAD_REGISTRY.register(JsonPayload, (Mapping, MappingProxyType))<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeView</span>(<span class="hljs-params">View</span>):</span>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> Response(body={<span class="hljs-string">'hello'</span>: <span class="hljs-string">'world'</span>})<font></font>
<font></font>
<font></font>
app = Application()<font></font>
app.router.add_route(<span class="hljs-string">'*'</span>, <span class="hljs-string">'/hello'</span>, SomeView)<font></font>
run_app(app)<font></font>
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูููู ุฃู ูููู ุฃู </font></font><code>json_response</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซู </font></font><code>aiohttp.JsonPayload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฅููุง ุชุณุชุฎุฏู ูุนูุงุฑ </font><font style="vertical-align: inherit;">ุทุฑููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>json.dumps</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ูููู ุฃู ุฃููุงุน ุงูุจูุงูุงุช ูุณุช ูุนูุฏุฉ ุชุณูุณูุ ุนูู ุณุจูู ุงููุซุงูุ </font></font><code>datetime.date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู </font></font><code>asyncpg.Record</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>asyncpg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุงุฆุฏ ุงูุณุฌูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง ูุซููุงุช ูุฐู ุงููุฆุฉ). </font><font style="vertical-align: inherit;">ุนูุงูุฉ ุนูู ุฐูู ุ ูุฏ ุชุญุชูู ุจุนุถ ุงููุงุฆูุงุช ุงููุนูุฏุฉ ุนูู ุฃุดูุงุก ุฃุฎุฑู: ูู ุณุฌู ูุงุญุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฏ ูููู ููุงู ุญูู ููุน </font></font><code>datetime.date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนุงูุฌ ูุทูุฑู Python ูุฐู ุงููุดููุฉ: </font></font><code>json.dumps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชูุญ ูู </font><font style="vertical-align: inherit;">ุงูุทุฑููุฉ </font><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงู ุงููุณูุทุฉ </font></font><code>default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุญุฏูุฏ ุฏุงูุฉ ูุชู ุงุณุชุฏุนุงุคูุง ุนูุฏูุง ูููู ูู ุงูุถุฑูุฑู ุฅุฌุฑุงุก ุชุณูุณู ููุงุฆู ุบูุฑ ูุฃููู. </font><font style="vertical-align: inherit;">ููุชููุน ุฃู ุชููู ุงููุธููุฉ ุจุฅุฑุณุงู ูุงุฆู ุบูุฑ ูุฃููู ุฅูู ููุน ููููู ุฅุฌุฑุงุก ุชุณูุณู ููุญุฏุฉ json.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุชูุฏูุฏ JsonPayload ูุชุณูุณู ุงูุฃุดูุงุก ุงูุชุนุณููุฉ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> date
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial, singledispatch
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Any<font></font>
<font></font>
<span class="hljs-keyword">from</span> aiohttp.payload <span class="hljs-keyword">import</span> JsonPayload <span class="hljs-keyword">as</span> BaseJsonPayload
<span class="hljs-keyword">from</span> aiohttp.typedefs <span class="hljs-keyword">import</span> JSONEncoder<font></font>
<font></font>
<span class="hljs-meta">@singledispatch</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">convert</span>(<span class="hljs-params">value</span>):</span>
    <span class="hljs-keyword">raise</span> NotImplementedError(<span class="hljs-string">f'Unserializable value: <span class="hljs-subst">{value!r}</span>'</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@convert.register(Record)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">convert_asyncpg_record</span>(<span class="hljs-params">value: Record</span>):</span>
    <span class="hljs-string">"""
        , 
    asyncpg
    """</span>
    <span class="hljs-keyword">return</span> dict(value)<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@convert.register(date)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">convert_date</span>(<span class="hljs-params">value: date</span>):</span>
    <span class="hljs-string">"""
       date      โ  
      .     
      ..
    """</span>
    <span class="hljs-keyword">return</span> value.strftime(<span class="hljs-string">'%d.%m.%Y'</span>)<font></font>
    <font></font>
 <font></font>
dumps = partial(json.dumps, default=convert)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JsonPayload</span>(<span class="hljs-params">BaseJsonPayload</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,
                 value: Any,
                 encoding: str = <span class="hljs-string">'utf-8'</span>,
                 content_type: str = <span class="hljs-string">'application/json'</span>,
                 dumps: JSONEncoder = dumps,
                 *args: Any,
                 **kwargs: Any</span>) -&gt; <span class="hljs-keyword">None</span>:</span>
        super().__init__(value, encoding, content_type, dumps, *args, **kwargs)</code></pre></div>
                    </div><br>
<a name="handlers"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุงูุฌุงุช</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณูุญ ูู aiohttp ุจุชูููุฐ ูุนุงูุฌุงุช ุจูุธุงุฆู ููุฆุงุช ุบูุฑ ูุชุฒุงููุฉ. </font><font style="vertical-align: inherit;">ุชุนุฏ ุงููุตูู ุฃูุซุฑ ูุงุจููุฉ ููุชูุณุนุฉ: ุฃููุงู ุ ูููู ูุถุน ุงูุฑูุฒ ุงูุฐู ููุชูู ุฅูู ูุนุงูุฌ ูุงุญุฏ ูู ููุงู ูุงุญุฏ ุ ูุซุงูููุง ุ ุชุณูุญ ูู ุงููุฆุงุช ุจุงุณุชุฎุฏุงู ุงููุฑุงุซุฉ ููุชุฎูุต ูู ุชูุฑุงุฑ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ูุชุทูุจ ูู ูุนุงูุฌ ุงุชุตุงู ูุงุนุฏุฉ ุจูุงูุงุช).</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฆุฉ ูุงุนุฏุฉ ุงููุนุงูุฌ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> aiohttp.web_urldispatcher <span class="hljs-keyword">import</span> View
<span class="hljs-keyword">from</span> asyncpgsa <span class="hljs-keyword">import</span> PG<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseView</span>(<span class="hljs-params">View</span>):</span><font></font>
    URL_PATH: str<font></font>
<font></font>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pg</span>(<span class="hljs-params">self</span>) -&gt; PG:</span>
        <span class="hljs-keyword">return</span> self.request.app[<span class="hljs-string">'pg'</span>]
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุตุนูุจุฉ ูุฑุงุกุฉ ููู ูุงุญุฏ ูุจูุฑ ุ ููุฏ ูุฑุฑุช ุชูุณูู ุงููุนุงูุฌุงุช ุฅูู ูููุงุช. </font><font style="vertical-align: inherit;">ุชุดุฌุน ุงููููุงุช ุงูุตุบูุฑุฉ ุนูู ุถุนู ุงูุงุชุตุงู ุ ูุฅุฐุง ูุงูุช ููุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูููุงุช ุงุณุชูุฑุงุฏ ุญูููุฉ ุฏุงุฎู ุงููุนุงูุฌุงุช ุ ููุฐุง ูุนูู ุฃู ุดูุฆูุง ูุง ูุฏ ูููู ุฎุทุฃ ูู ุชูููู ุงูููุงูุงุช.</font></font><br>
<br>
<a name="imports_handler"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุจุนุฏ / ุงููุงุฑุฏุงุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชููู ูุนุงูุฌ ุงูุฅุฏุฎุงู json ูุน ุจูุงูุงุช ุญูู ุงูุณูุงู. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุฏ ุงูุฃูุตู ุงููุณููุญ ุจู ุญุฌู ุงูุทูุจ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุชู ุงูุชุญูู ูู aiohttp ุจูุงุณุทุฉ ุงูุฎูุงุฑ </font></font><code>client_max_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://docs.aiohttp.org/en/stable/web_reference.html&amp;usg=ALkJrhjEuzlTJICb-3TCmvusN847WfFtWQ#aio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู 2 MB ุงูุชุฑุงุถูุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุฅุฐุง ุชู ุชุฌุงูุฒ ุงูุญุฏ ุ ูุณูู ูุนุฑุถ aiohttp ุงุณุชุฌุงุจุฉ HTTP ุจุงูุญุงูุฉ 413: ุทูุจ ููุงู ุฎุทุฃ ูุจูุฑ ุฌุฏูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูููุช ููุณู ุ ุณูุจูุบ ุญุฌู json ุงูุตุญูุญ ูุน ุฃุทูู ุงูุฎุทูุท ูุงูุฃุฑูุงู ~ 63 ููุบุงุจุงูุช ุ ูุฐุง ูุฌุจ ุชูุณูุน ุงููููุฏ ุนูู ุญุฌู ุงูุทูุจ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุงูุชุญูู ูู ุงูุจูุงูุงุช ูุฅูุบุงุก ุชุณูุณููุง</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุฅุฐุง ูุงูุช ุบูุฑ ุตุญูุญุฉ ุ ูุณุชุญุชุงุฌ ุฅูู ุฅุฑุฌุงุน ุงุณุชุฌุงุจุฉ HTTP </font></font><code>400: Bad Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุช ุจุญุงุฌุฉ ุฅูู ูุธุงููู </font></font><code>Marhsmallow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุงูุฃูู </font></font><code>CitizenSchema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุชุญูู ูู ุจูุงูุงุช ูู ูุฑุฏ ูููู ุ ููุฒูู ุฃูุถูุง ุณูุณูุฉ ุนูุฏ ูููุงุฏ ุณุนูุฏ ุฅูู ุงููุงุฆู </font></font><code>datetime.date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุน ุงูุจูุงูุงุช ูุชูุณูู ูุชูุงูุฑ ุฌููุน ุงูุญููู ุงููุทููุจุฉ ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุฏู ูุฌูุฏ ุญููู ุบูุฑ ูุฃูููุฉ ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุชุญุฏูุฏ ุชุงุฑูุฎ ุงููููุงุฏ ุจุงูุตูุบุฉ </font></font><code>DD.MM.YYYY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูููู ุฃู ูููู ูู ุฃู ุฃูููุฉ ูู ุงููุณุชูุจู ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฃู ุชุญุชูู ูุงุฆูุฉ ุฃูุงุฑุจ ูู ูููู ุนูู ูุนุฑูุงุช ูุฑูุฏุฉ ูููููููู ุงูููุฌูุฏูู ูู ูุฐุง ุงูุชุญููู.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุฎุทุท ุงูุซุงูู </font></font><code>ImportSchema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุชุญูู ูู ุงูุชูุฑูุบ ููู:</font></font><br>
<br>
<ul>
<li><code>citizen_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฌุจ ุฃู ูููู ูู ูููู ูู ุงูุชูุฑูุบ ูุฑูุฏูุง ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฃู ุชููู ุงูุฑูุงุจุท ุงูุนุงุฆููุฉ ุซูุงุฆูุฉ ุงูุงุชุฌุงู (ุฅุฐุง ูุงู ุงููููู ุฑูู 1 ูุฏูู ูููู ุฑูู 2 ูู ูุงุฆูุฉ ุงูุฃูุงุฑุจ ุ ููุฌุจ ุฃู ูููู ูููููู ุฑูู 2 ุฃูุถูุง ูุฑูุจ ุฑูู 1).</font></font></li>
</ul><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ุตุญูุญุฉ ุ ููุฌุจ ุฅุถุงูุชูุง ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุงุนุฏุฉ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฌุฏูุฏุฉ ูุฑูุฏุฉ </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฅุถุงูุฉ ุงูุจูุงูุงุช ุ ุณุชุญุชุงุฌ ุฅูู ุฅุฌุฑุงุก ุงูุนุฏูุฏ ูู ุงูุงุณุชุนูุงูุงุช ูู ุฌุฏุงูู ูุฎุชููุฉ. </font><font style="vertical-align: inherit;">ูุชุฌูุจ ุงูุจูุงูุงุช ุงููุถุงูุฉ ุฌุฒุฆููุง ุฌุฒุฆููุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃ ุฃู ุงุณุชุซูุงุก (ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏ ูุทุน ุงุชุตุงู ุนููู ูู ูุชูู ุงุณุชุฌุงุจุฉ ูุงููุฉ ุ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://docs.aio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aiohttp </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://docs.aio"><font style="vertical-align: inherit;">ุจุทุฑุญ ุงุณุชุซูุงุก CancelledError</font></a><font style="vertical-align: inherit;"> ) ุ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุนููู ุงุณุชุฎุฏุงู ูุนุงููุฉ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุถุฑูุฑู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุฅูู ุงูุฌุฏุงูู ูู ุฃุฌุฒุงุก</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฃูู ูู ุงุณุชุนูุงู ูุงุญุฏ ุฅูู PostgreSQL ูุง ูููู ุฃู ูููู ููุงู ุฃูุซุฑ ูู 32767 ูุณูุทุฉ. </font><font style="vertical-align: inherit;">ููุฌุฏ </font></font><code>citizens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9 ุญููู </font><font style="vertical-align: inherit;">ูู ุงูุฌุฏูู </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููููุง ูุฐูู ุ ุจุงููุณุจุฉ ูุงุณุชุนูุงู ูุงุญุฏ ุ ูููู ููุท ุฅุฏุฑุงุฌ 32ุ767 / 9 = 3ุ640 ุตููุง ูู ูุฐุง ุงูุฌุฏูู ุ ููู ุนูููุฉ ุชุญููู ูุงุญุฏุฉ ูููู ุฃู ูุตู ุนุฏุฏ ุณูุงููุง ุฅูู 10000.</font></font><br>
<br>
<a name="citizens_handler"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุงููุนุงูุฌ ุจุฅุฑุฌุงุน ูุงูุฉ ุงููููููู ูุชูุฑูุบ ูุน ุงููุญุฏุฏ </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุญููู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุญุฏุฏ </font><b><font style="vertical-align: inherit;">ุบูุฑ ููุฌูุฏ</font></b><font style="vertical-align: inherit;"> ุ ููุฌุจ ุนููู ุฅุฑุฌุงุน ุงุณุชุฌุงุจุฉ 404: ูู ูุชู ุงูุนุซูุฑ ุนูู HTTP. </font><font style="vertical-align: inherit;">ูุจุฏู ุฃู ูุฐุง ุงูุณููู ุดุงุฆุน ุจุงููุณุจุฉ ูููุนุงูุฌุงุช ุงูุชู ุชุญุชุงุฌ ุฅูู ุฅูุบุงุก ุชุญููู ููุฌูุฏ ุ ูุฐูู ููุช ุจุณุญุจ ุฑูุฒ ุงูุชุญูู ุฅูู ูุตู ุฏุฑุงุณู ูููุตู.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฆุฉ ุงูุฃุณุงุณูุฉ ูููุนุงูุฌุงุช ุงูุชู ุชุญุชูู ุนูู ุญูููุงุช</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> aiohttp.web_exceptions <span class="hljs-keyword">import</span> HTTPNotFound
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> select, exists<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.db.schema <span class="hljs-keyword">import</span> imports_table<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseImportView</span>(<span class="hljs-params">BaseView</span>):</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">import_id</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> int(self.request.match_info.get(<span class="hljs-string">'import_id'</span>))<font></font>
<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_import_exists</span>(<span class="hljs-params">self</span>):</span><font></font>
        query = select([<font></font>
            exists().where(imports_table.c.import_id == self.import_id)<font></font>
        ])<font></font>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">await</span> self.pg.fetchval(query):
            <span class="hljs-keyword">raise</span> HTTPNotFound()
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุญุตูู ุนูู ูุงุฆูุฉ ุฃูุงุฑุจ ููู ูููู ุ ุณุชุญุชุงุฌ ุฅูู ุฅุฌุฑุงุก </font></font><code>LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฌุฏูู </font></font><code>citizens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุฌุฏูู </font></font><code>relations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุชุฌููุน ุงูุญูู </font></font><code>relations.relative_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌูุนุฉ ุญุณุจ </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>citizen_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูู ููู ูููููู ุฃูุงุฑุจ ุ </font></font><code>LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูู ูุนูุฏ </font></font><code>relations.relative_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููููุฉ </font><font style="vertical-align: inherit;">ูู ูู ุงูุญูู </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุชูุฌุฉ ููุชุฌูุน ุ ุณุชุจุฏู ูุงุฆูุฉ ุงูุฃูุงุฑุจ </font></font><code>[NULL]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฅุตูุงุญ ูุฐู ุงููููุฉ ุบูุฑ ุงูุตุญูุญุฉ ุ ุงุณุชุฎุฏูุช ุงูุฏุงูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array_remove</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุฎุฒู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎ ุจุชูุณูู </font></font><code>YYYY-MM-DD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููููุง ุจุญุงุฌุฉ ุฅูู ุชูุณูู </font></font><code>DD.MM.YYYY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงููุงุญูุฉ ุงููููุฉ ุ ููููู ุชูุณูู ุงูุชุงุฑูุฎ ุฅูุง ุจุงุณุชุฎุฏุงู ุงุณุชุนูุงู SQL ุฃู ุนูู ุฌุงูุจ Python ูู ููุช ุฅุฌุฑุงุก ุชุณูุณู ุงูุงุณุชุฌุงุจุฉ ุจุงุณุชุฎุฏุงู </font></font><code>json.dumps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ุฅุฑุฌุงุน asyncpg ูููุฉ ุงูุญูู </font></font><code>birth_date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุซูู ูููุฆุฉ</font></font><code>datetime.date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏ ุงุฎุชุฑุช ุงูุชุณูุณู ุนูู ุฌุงูุจ Python ุ ูุธุฑูุง ูุฃูู </font></font><code>birth_date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฆู ุงููุญูุฏ </font></font><code>datetime.date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุดุฑูุน ุจุชูุณูู ูุงุญุฏ (ุงูุธุฑ ูุณู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ุชุณูุณู ุงูุจูุงูุงุช"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุงููุนุงูุฌ ูููุฐ ุทูุจูู (ุงูุชุญูู ูู ูุฌูุฏ ุชูุฑูุบ ูุทูุจ ููุญุตูู ุนูู ูุงุฆูุฉ ุจุงููููููู) ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณ ูู ุงูุถุฑูุฑู ุงุณุชุฎุฏุงู ูุนุงููุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุจุดูู ุงูุชุฑุงุถู ุ ูุณุชุฎุฏู PostgreSQL ูุณุชูู ุงูุนุฒู ุ </font></font><code>READ COMMITTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุชู ูู ุฅุญุฏู ุงููุนุงููุงุช ุ ุณุชููู ุฌููุน ุงูุชุบููุฑุงุช ุนูู ุงููุนุงููุงุช ุงูุฃุฎุฑู ุงูููุชููุฉ ุจูุฌุงุญ ูุฑุฆูุฉ (ุฅุถุงูุฉ ุตููู ุฌุฏูุฏุฉ ูุชุบููุฑ ุงููุงุฆูุฉ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุฃู ูุณุชุบุฑู ุงูุชุญููู ุงูุฃูุจุฑ ูู ุนุฑุถ ุงููุต ุญูุงูู 63 ููุบุงุจุงูุช - ููุฐุง ูุซูุฑ ุฌุฏูุง ุ ุฎุงุตุฉ ุจุงููุธุฑ ุฅูู ุฃู ุงูุนุฏูุฏ ูู ุงูุทูุจุงุช ูุงุณุชูุงู ุงูุจูุงูุงุช ูุฏ ุชุตู ูู ููุณ ุงูููุช. </font><font style="vertical-align: inherit;">ููุงู ุทุฑููุฉ ูุซูุฑุฉ ููุงูุชูุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุญุตูู ุนูู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุคุดุฑ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฅุฑุณุงููุง ุฅูู ุงูุนููู ูู ุฃุฌุฒุงุก</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููุงู ุจุฐูู ุ ูุญุชุงุฌ ุฅูู ุชูููุฐ ุดูุฆูู:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุตุฑ </font></font><code>SelectQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุน ูููู </font></font><code>AsyncIterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุฑุฌุงุน ุงูุณุฌูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. </font><font style="vertical-align: inherit;">ูู ุงูููุงููุฉ ุงูุฃููู ุ ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููุชุญ ุงููุนุงููุงุช ูููุดุฆ ุงููุคุดุฑ ุ ูุฃุซูุงุก ุงูุชูุฑุงุฑ ุงูุฅุถุงูู ุ ูููู ุจุฅุฑุฌุงุน ุงูุณุฌูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. </font><font style="vertical-align: inherit;">ูุชู ุฅุฑุฌุงุนูุง ุจูุงุณุทุฉ ุงููุนุงูุฌ.</font></font><br>
 <br>
 <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฏุฏ ุฑูุฒ ุงูุงุณุชุนูุงู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> AsyncIterable
<span class="hljs-keyword">from</span> asyncpgsa.transactionmanager <span class="hljs-keyword">import</span> ConnectionTransactionContextManager
<span class="hljs-keyword">from</span> sqlalchemy.sql <span class="hljs-keyword">import</span> Select<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SelectQuery</span>(<span class="hljs-params">AsyncIterable</span>):</span>
    <span class="hljs-string">"""
    ,     PostgreSQL   
    ,  ,    
    """</span>
    PREFETCH = <span class="hljs-number">500</span><font></font>
<font></font>
    __slots__ = (<font></font>
        <span class="hljs-string">'query'</span>, <span class="hljs-string">'transaction_ctx'</span>, <span class="hljs-string">'prefetch'</span>, <span class="hljs-string">'timeout'</span><font></font>
    )<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, query: Select,
                 transaction_ctx: ConnectionTransactionContextManager,
                 prefetch: int = None,
                 timeout: float = None</span>):</span><font></font>
        self.query = query<font></font>
        self.transaction_ctx = transaction_ctx<font></font>
        self.prefetch = prefetch <span class="hljs-keyword">or</span> self.PREFETCH<font></font>
        self.timeout = timeout<font></font>
<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__aiter__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> self.transaction_ctx <span class="hljs-keyword">as</span> conn:<font></font>
            cursor = conn.cursor(self.query, prefetch=self.prefetch,<font></font>
                                 timeout=self.timeout)<font></font>
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> cursor:
                <span class="hljs-keyword">yield</span> row
</code></pre></div>
                    </div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณูุณู </font></font><code>AsyncGenJSONListPayload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููู ุงูุชูุฑุงุฑ ุนุจุฑ ุงููููุฏุงุช ุบูุฑ ุงููุชุฒุงููุฉ ุ ูุชุณูุณู ุงูุจูุงูุงุช ูู ุงููููุฏ ุบูุฑ ุงููุชุฒุงูู ุฅูู JSON ูุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุนููุงุก ูู ุฃุฌุฒุงุก. </font><font style="vertical-align: inherit;">ูุชู ุชุณุฌููู </font></font><code>aiohttp.PAYLOAD_REGISTRY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณูุณู ููุฃุดูุงุก </font></font><code>AsyncIterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
 <br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ AsyncGenJSONListPayload</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial<font></font>
<font></font>
<span class="hljs-keyword">from</span> aiohttp <span class="hljs-keyword">import</span> Payload<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># ,    JSON  asyncpg.Record  datetime.date</span>
dumps = partial(json.dumps, default=convert, ensure_ascii=<span class="hljs-literal">False</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncGenJSONListPayload</span>(<span class="hljs-params">Payload</span>):</span>
    <span class="hljs-string">"""
       AsyncIterable,     
     JSON   
    """</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, value, encoding: str = <span class="hljs-string">'utf-8'</span>,
                 content_type: str = <span class="hljs-string">'application/json'</span>,
                 root_object: str = <span class="hljs-string">'data'</span>,
                 *args, **kwargs</span>):</span><font></font>
        self.root_object = root_object<font></font>
        super().__init__(value, content_type=content_type, encoding=encoding,<font></font>
                         *args, **kwargs)<font></font>
<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>(<span class="hljs-params">self, writer</span>):</span>
        <span class="hljs-comment">#  </span>
        <span class="hljs-keyword">await</span> writer.write(<font></font>
            (<span class="hljs-string">'{"%s":['</span> % self.root_object).encode(self._encoding)<font></font>
        )<font></font>
<font></font>
        first = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> self._value:
            <span class="hljs-comment">#      </span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> first:
                <span class="hljs-keyword">await</span> writer.write(<span class="hljs-string">b','</span>)
            <span class="hljs-keyword">else</span>:<font></font>
                first = <span class="hljs-literal">False</span><font></font>
<font></font>
            <span class="hljs-keyword">await</span> writer.write(dumps(row).encode(self._encoding))<font></font>
<font></font>
        <span class="hljs-comment">#  </span>
        <span class="hljs-keyword">await</span> writer.write(<span class="hljs-string">b']}'</span>)</code></pre></div>
                    </div></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุงูุฉ ุนูู ุฐูู ุ ูู ุงููุนุงูุฌ ุณูููู ูู ุงููููู ุฅูุดุงุก ูุงุฆู </font></font><code>SelectQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุชูุฑูุฑ ุงุณุชุนูุงู SQL ููุธููุฉ ูู ููุชุญ ุงููุนุงููุฉ ุ ูุฅุนุงุฏุชู ุฅูู </font></font><code>Response body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุฒ ุงููุนุงูุฌ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># analyzer/api/handlers/citizens.py</span>
<span class="hljs-keyword">from</span> aiohttp.web_response <span class="hljs-keyword">import</span> Response
<span class="hljs-keyword">from</span> aiohttp_apispec <span class="hljs-keyword">import</span> docs, response_schema<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.api.schema <span class="hljs-keyword">import</span> CitizensResponseSchema
<span class="hljs-keyword">from</span> analyzer.db.schema <span class="hljs-keyword">import</span> citizens_table <span class="hljs-keyword">as</span> citizens_t
<span class="hljs-keyword">from</span> analyzer.utils.pg <span class="hljs-keyword">import</span> SelectQuery<font></font>
<font></font>
<span class="hljs-keyword">from</span> .query <span class="hljs-keyword">import</span> CITIZENS_QUERY
<span class="hljs-keyword">from</span> .base <span class="hljs-keyword">import</span> BaseImportView<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CitizensView</span>(<span class="hljs-params">BaseImportView</span>):</span>
    URL_PATH = <span class="hljs-string">r'/imports/{import_id:\d+}/citizens'</span><font></font>
<font></font>
<span class="hljs-meta">    @docs(summary='    ')</span>
<span class="hljs-meta">    @response_schema(CitizensResponseSchema())</span>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">await</span> self.check_import_exists()<font></font>
<font></font>
        query = CITIZENS_QUERY.where(<font></font>
            citizens_t.c.import_id == self.import_id<font></font>
        )<font></font>
        body = SelectQuery(query, self.pg.transaction())<font></font>
        <span class="hljs-keyword">return</span> Response(body=body)
</code></pre></div>
                    </div><br>
<code>aiohttp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุดู </font></font><code>aiohttp.PAYLOAD_REGISTRY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุณูุณู </font><font style="vertical-align: inherit;">ุงููุณุฌู </font></font><code>AsyncGenJSONListPayload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฆูุงุช ูู ุงูููุน </font><font style="vertical-align: inherit;">ูู ุงูุชุณุฌูู </font></font><code>AsyncIterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุซู ูููู ุงููุชุณูุณู ุจุชูุฑุงุฑ ุงููุงุฆู </font></font><code>SelectQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุนููู. ูู ุงูููุงููุฉ ุงูุฃููู ุ </font></font><code>SelectQuery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชููู </font><font style="vertical-align: inherit;">ุงููุงุฆู </font><font style="vertical-align: inherit;">ุงุชุตุงูุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููุชุญ ูุนุงููุฉ ูููุดุฆ ุงููุคุดุฑ ุ ูุฃุซูุงุก ุงูุชูุฑุงุฑ ุงูุฅุถุงูู ุ ุณูุชููู ุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงููุคุดุฑ ููุนูุฏูุง ุณุทุฑุงู ุจุณุทุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณูุญ ูุฐุง ุงูููุฌ ุจุนุฏู ุชุฎุตูุต ุฐุงูุฑุฉ ููุงูู ุงูุจูุงูุงุช ูุน ูู ุทูุจ ุ ูููู ูู ุฎุตูุตูุฉ: ูู ูุชููู ุงูุชุทุจูู ูู ุฅุนุงุฏุฉ ุญุงูุฉ HTTP ุงูููุงุจูุฉ ุฅูู ุงูุนููู ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃ (ุจุนุฏ ูู ุดูุก ุ ุญุงูุฉ HTTP ุ ุชู ุฅุฑุณุงู ุงูุฑุคูุณ ุจุงููุนู ุฅูู ุงูุนููู ุ ููุชู ูุชุงุจุฉ ุงูุจูุงูุงุช).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูุญุฏุซ ุงุณุชุซูุงุก ุ ูู ูุจู ุดูุก ุณูู ูุทุน ุงูุงุชุตุงู. </font><font style="vertical-align: inherit;">ูููู ุจุงูุทุจุน ุชุฃููู ุงุณุชุซูุงุก ุ ูููู ูู ูุชููู ุงูุนููู ูู ููู ุงูุฎุทุฃ ุงูุฐู ุญุฏุซ ุจุงูุถุจุท. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุฏ ุชูุดุฃ ุญุงูุฉ ููุงุซูุฉ ุญุชู ุฅุฐุง ูุงู ุงููุนุงูุฌ ูุชููู ุฌููุน ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููู ุงูุดุจูุฉ ูููุถ ุฃุซูุงุก ููู ุงูุจูุงูุงุช ุฅูู ุงูุนููู - ูุง ุฃุญุฏ ูู ูุฃูู ูู ุฐูู.</font></font><br>
<br>
<a name="update_citizen_handler"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุตุญูุญ / ุงููุงุฑุฏุงุช / $ import_id / ููููุงุทููู / $ ููุงุทู_ุงููุนุฑูู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชููู ุงููุนุงูุฌ ูุนุฑู </font><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ุ </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููููู </font></font><code>citizen_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุฐูู json ูุน ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุญูู ุงููููู. </font><font style="vertical-align: inherit;">ูู ุญุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌูุฏ ุชูุฑูุบ ุบูุฑ ููุฌูุฏ ุฃู ูููู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฌุจ ุฅุฑุฌุงุน ุงุณุชุฌุงุจุฉ HTTP </font></font><code>404: Not Found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุญูู ูู</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุจูุงูุงุช ุงููุฑุณูุฉ ูู ูุจู ุงูุนููู </font><strong><font style="vertical-align: inherit;">ูุฅูุบุงุก ุชุณูุณููุง</font></strong><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงูุช ุบูุฑ ุตุญูุญุฉ ุ ูุฌุจ ุนููู ุฅุฑุฌุงุน ุงุณุชุฌุงุจุฉ HTTP </font></font><code>400: Bad Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุฐุช ูุฎุทุท Marshmallow </font></font><code>PatchCitizenSchema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุญูู:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุน ูุชูุณูู ุงูุจูุงูุงุช ููุญููู ุงููุญุฏุฏุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุงุฑูุฎ ุงูููุงุฏุฉ. </font><font style="vertical-align: inherit;">ูุฌุจ ุชุญุฏูุฏู ุจุชูุณูู </font></font><code>DD.MM.YYYY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูููู ุฃู ูููู ุฐุง ุฃูููุฉ ูู ุงููุณุชูุจู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฆูุฉ ุฃูุงุฑุจ ูู ูููู. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูููู ููุง ูุนุฑูุงุช ูุฑูุฏุฉ ูููููููู.</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูููู ุงูุชุญูู </font><font style="vertical-align: inherit;">
ูู ูุฌูุฏ ุงูุฃูุงุฑุจ ุงููุดุงุฑ ุฅูููู ูู ุงูุญูู </font><font style="vertical-align: inherit;">ุจุดูู ูููุตู: ุฅุฐุง ุชูุช ุฅุถุงูุฉ </font></font><code>relations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุบูุฑ ููุฌูุฏ </font><font style="vertical-align: inherit;">ุฅูู ุงูุฌุฏูู ุ </font><font style="vertical-align: inherit;">ูุณูู ุชูุฑุฌุน PostgreSQL ุฎุทุฃู </font></font><code>ForeignKeyViolationError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ูุนุงูุฌุชู ููููู ุฅุฑุฌุงุน ุญุงูุฉ HTTP </font></font><code>400: Bad Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ูู ุงูุญุงูุฉ ุงูุชู ูุฌุจ ุฅุฑุฌุงุนูุง ุฅุฐุง ุฃุฑุณู ุงูุนููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ ููููู ุบูุฑ ููุฌูุฏ ุฃู ุชูุฑูุบ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูู ุงูุฃุตุญ ุฏูุงูุฉ ููุชุญูู ุฃููุงู ูู ูุฌูุฏ ุชูุฑูุบ ููููู (ุฅุฐุง ูู ููู ููุงู ุ ุนูุฏุฉ </font></font><code>404: Not Found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ูุนูุฏุฆุฐ ููุท ูุง ุฅุฐุง ูุงู ุงูุนููู ูุฏ ุฃุฑุณู ุงูุจูุงูุงุช ุงูุตุญูุญุฉ (ุฅู ูู ููู ุ ุงูุนูุฏุฉ </font></font><code>400: Bad Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). ุนููููุง ุ ุบุงูุจูุง ูุง ูููู ุงูุชุญูู ูู ุงูุจูุงูุงุช ุฃููุงู ุฃุฑุฎุต ุ ูููุท ุฅุฐุง ูุงูุช ุตุญูุญุฉ ุ ูู ุจุงููุตูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุงูุฎูุงุฑูู ููุจูู ุ ููููู ูุฑุฑุช ุงุฎุชูุงุฑ ุฎูุงุฑ ุซุงูู ุฃุฑุฎุต ุ ูุฃู ูุชูุฌุฉ ุงูุนูููุฉ ุนูู ุฃู ุญุงู ูู ุฎุทุฃ ูุง ูุคุซุฑ ุนูู ุฃู ุดูุก (ุณูููู ุงูุนููู ุจุชุตุญูุญ ุงูุจูุงูุงุช ุซู ููุชุดู ุฃูุถูุง ุฃู ุงููููู ุบูุฑ ููุฌูุฏ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ุตุญูุญุฉ ุ ููู ุงูุถุฑูุฑู </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฏูุซ ุงููุนูููุงุช ุญูู ุงููููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูู ุงููุนุงูุฌ ุ ุณุชุญุชุงุฌ ุฅูู ุฅุฌุฑุงุก ุงูุนุฏูุฏ ูู ุงูุงุณุชุนูุงูุงุช ูุฌุฏุงูู ูุฎุชููุฉ. ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃ ุฃู ุงุณุชุซูุงุก ุ ูุฌุจ ุงูุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุฐุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฅุฌุฑุงุก ุงูุงุณุชุนูุงูุงุช ูู ุงููุนุงููุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">ุชุณูุญ ูู</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุงูุทุฑููุฉ </font></font><code>PATCH</code> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจููู ุจุนุถ ุงูุญููู ููุท</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููููู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ูุชุงุจุฉ ุงููุนุงูุฌ ุจุทุฑููุฉ ูุง ุชุชุนุทู ุนูุฏ ุงููุตูู ุฅูู ุงูุจูุงูุงุช ุงูุชู ูู ูุญุฏุฏูุง ุงูุนููู ุ ููุง ูููู ุฃูุถูุง ุจุชูููุฐ ุงูุงุณุชุนูุงูุงุช ุนูู ุงูุฌุฏุงูู ุงูุชู ูู ุชุชุบูุฑ ูููุง ุงูุจูุงูุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ุญุฏุฏ ุงูุนููู ุงูุญูู </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููู ุงูุถุฑูุฑู ุงูุญุตูู ุนูู ูุงุฆูุฉ ุจุงูุฃูุงุฑุจ ุงูุญุงูููู. ุฅุฐุง ุชู ุชุบููุฑู ุ ุญุฏุฏ ุงูุณุฌูุงุช ุงูุชู </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุญุฐููุง </font><font style="vertical-align: inherit;">ูู ุงูุฌุฏูู ูุฃููุง </font><font style="vertical-align: inherit;">ูุฌุจ ุฅุถุงูุชูุง ูู ุฃุฌู ุฌุนู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุชูุงุดู ูุน ุทูุจ ุงูุนููู. ุจุดูู ุงูุชุฑุงุถู ุ ูุณุชุฎุฏู PostgreSQL ุนุฒู ุงููุนุงููุงุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code> READ COMMITTED</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ููุฐุง ูุนูู ุฃูู ูุฌุฒุก ูู ุงููุนุงููุฉ ุงูุญุงููุฉ ุ ุณุชููู ุงูุชุบููุฑุงุช ูุฑุฆูุฉ ููุณุฌูุงุช ุงูุญุงููุฉ (ููุฐูู ุงูุฌุฏูุฏุฉ) ูููุนุงููุงุช ุงูููุชููุฉ ุงูุฃุฎุฑู. ูุฐุง ูููู ุฃู ูุคุฏู ุฅูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุงูุฉ ุณุจุงู ุจูู ุงูุทูุจุงุช ุงูุชูุงูุณูุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชุฑุถ ุฃู ููุงู ุชูุฑูุบ ูุน ุงูุณูุงู</font></font><code>#1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>#2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>#3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏูู ุงููุฑุงุจุฉ. ุชุชููู ุงูุฎุฏูุฉ ุทูุจูู ูุชุฒุงูููู ูุชุบููุฑ ุงููููู ุฑูู 1: </font></font><code><nobr>{"relatives": [2]}</nobr></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code><nobr>{"relatives": [3]}</nobr></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุณูููู aiohttp ุจุฅูุดุงุก ูุนุงูุฌูู ูุณุชูุจูุงู ูู ุงูููุช ููุณู ุงูุญุงูุฉ ุงูุญุงููุฉ ูููููู ูู PostgreSQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ููุชุดู ูู ูุนุงูุฌ ุนูุงูุฉ ูุงุญุฏุฉ ุฐุงุช ุตูุฉ ูุณููุฑุฑ ุฅุถุงูุฉ ุนูุงูุฉ ุฌุฏูุฏุฉ ูุน ุงููุฑูุจ ุงููุญุฏุฏ. ูุชูุฌุฉ ูุฐูู ุ ุงููููู ุฑูู 1 ูุฏูู ููุณ ูุฌุงู ุงูุฃูุงุฑุจ </font></font><code>[2,3]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/go/bk/mz/gobkmzuhzr47rfzgvtygkxb1stm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ูููู ูุตู ูุฐุง ุงูุณููู ุจุฃูู ูุงุถุญ. ููุงู ุฎูุงุฑุงู ูุชููุนุงู ูุชูุฑูุฑ ูุชูุฌุฉ ุงูุณุจุงู: ูุฅููุงู ุงูุทูุจ ุงูุฃูู ููุท ุ ูุงูุซุงูู ูุฅุฑุฌุงุน ุงุณุชุฌุงุจุฉ HTTP </font></font><br>
<code>409: Conflict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ุจุญูุซ ููุฑุฑ ุงูุนููู ุงูุทูุจ) ุ ุฃู ูุชูููุฐ ุงูุทูุจุงุช ุจุฏูุฑู (ุณูุชู ูุนุงูุฌุฉ ุงูุทูุจ ุงูุซุงูู ููุท ุจุนุฏ ุงูุชูุงู ุงูุฃูู). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุชูููุฐ ุงูุฎูุงุฑ ุงูุฃูู ุนู ุทุฑูู ุชุดุบูู ูุถุน ุงูุนุฒู</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>SERIALIZABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุฅุฐุง ุชููู ุดุฎุต ุจุงููุนู ุฃุซูุงุก ูุนุงูุฌุฉ ุงูุทูุจ ูู ุชุบููุฑ ุงูุจูุงูุงุช ูุชูููุฐูุง ุ ูุณูุชู ุทุฑุญ ุงุณุชุซูุงุก ุ ูุงูุฐู ูููู ูุนุงูุฌุชู ูุฅุฑุฌุงุน ุญุงูุฉ HTTP ุงูููุงุจูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูุก ูุฐุง ุงูุญู - ุนุฏุฏ ูุจูุฑ ูู ุงูุฃููุงู ูู PostgreSQL ุ </font></font><code>SERIALIZABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุนุทู ุงุณุชุซูุงุก ุ ุญุชู ุฅุฐุง ุบูุฑุช ุงูุงุณุชุนูุงูุงุช ุงูุชูุงูุณูุฉ ุณุฌูุงุช ุงูุณูุงู ูู ุนูููุงุช ุงูุชูุฑูุบ ุงููุฎุชููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู ุขููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุงูุชูุตูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุฅุฐุง ุญุตูุช ุนูู ูุซู ูุฐุง ุงูููู </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุณุชููู ุงูุทูุจุงุช ุงูุชูุงูุณูุฉ ูุนูููุงุช ุงูุชูุฑูุบ ุงููุฎุชููุฉ ูุงุฏุฑุฉ ุนูู ุงูุนูู ุจุงูุชูุงุฒู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุนุงูุฌุฉ ุงูุทูุจุงุช ุงูุชูุงูุณูุฉ ูู ุชุญููู ูุงุญุฏ ุ ููููู ุชูููุฐ ุณููู ุฃู ูู ุงูุฎูุงุฑุงุช: </font></font><code>pg_try_advisory_xact_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุงูู </font><font style="vertical-align: inherit;">ุงููุธููุฉ </font><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู ููู ู</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชููู ุจุฅุฑุฌุงุน ุงููุชูุฌุฉ ุงูููุทููุฉ ุนูู ุงูููุฑ (ุฅุฐุง ูู ููู ูู ุงููููู ุงูุญุตูู ุนูู ุงูููู ุ ูููู ุทุฑุญ ุงุณุชุซูุงุก) ุ </font></font><code>pg_advisory_xact_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุชุธุฑ ุญุชู </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชููุฑ ุงูููุฑุฏ ููุญุธุฑ (ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุชู ุชูููุฐ ุงูุทูุจุงุช ุจุงูุชุณูุณู ุ ููุฏ ุงุณุชูุฑุช ุนูู ูุฐุง ุงูุฎูุงุฑ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชูุฌุฉ ูุฐูู ุ ูุฌุจ ุนูู ุงููุนุงูุฌ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฑุฌุงุน ุงููุนูููุงุช ุงูุญุงููุฉ ุญูู ุงููููู ุงููุญุฏุซ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุงู ูู ุงููููู ูุตุฑ ุฃููุณูุง ุนูู ุฅุนุงุฏุฉ ุงูุจูุงูุงุช ูู ุทูุจู ุฅูู ุงูุนููู (ูุธุฑูุง ูุฃููุง ูุนูุฏ ุงูุฑุฏ ุนูู ุงูุนููู ุ ููุฐุง ูุนูู ุฃูู ูู ุชูู ููุงู ุงุณุชุซูุงุกุงุช ูุชู ุฅููุงู ุฌููุน ุงูุทูุจุงุช ุจูุฌุงุญ). ุฃู - ุงุณุชุฎุฏู ุงููููุฉ ุงูุฑุฆูุณูุฉ RETURNING ูู ุงูุงุณุชุนูุงูุงุช ุงูุชู ุชุนุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชููุฏ ุงุณุชุฌุงุจุฉ ูู ุงููุชุงุฆุฌ. ููู ููุง ุงูููุฌูู ูู ูุณูุญ ููุง ุจุฑุคูุฉ ุงูุญุงูุฉ ูุงุฎุชุจุงุฑูุง ูุน ุณุจุงู ุงูุฏูู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุชูู ููุงู ูุชุทูุจุงุช ุชุญููู ุนุงููุฉ ููุฎุฏูุฉ ุ ูุฐูู ูุฑุฑุช ุฃู ุฃุทูุจ ุฌููุน ุงูุจูุงูุงุช ุนู ุงููููู ูุฑุฉ ุฃุฎุฑู ูุฃุนูุฏ ููุนููู ูุชูุฌุฉ ุตุงุฏูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. </font></font><br>
<br>
<a name="citizen_birthdays_handler"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู / ุฃุนูุงุฏ ุงููููุงุฏ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุงููุนุงูุฌ ุจุญุณุงุจ ุนุฏุฏ ุงููุฏุงูุง ุงูุชู ุณูุญุตู ุนูููุง ูู ูููู ูู ุงูุชูุฑูุบ ูุฃูุงุฑุจู (ุงูุทูุจ ุงูุฃูู). </font><font style="vertical-align: inherit;">ูุชู ุชุฌููุน ุงูุฑูู ุญุณุจ ุงูุดูุฑ ููุชุญููู ูุน ุงููุญุฏุฏ </font></font><code>import_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูู ุญุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุญููู ุบูุฑ ุงูููุฌูุฏ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฌุจ ุฅุนุงุฏุฉ ุงุณุชุฌุงุจุฉ HTTP </font></font><code>404: Not Found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ุฎูุงุฑุงู ููุชูููุฐ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุญุตู ุนูู ุจูุงูุงุช ูููููููู ูุน ุงูุฃูุงุฑุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุนูู ุฌุงูุจ Python ุ ูู ุจุชุฌููุน ุงูุจูุงูุงุช ุญุณุจ ุงูุดูุฑ ูุฅูุดุงุก ููุงุฆู ูุชูู ุงูุฃุดูุฑ ุงูุชู ูุง ุชูุฌุฏ ุจูุงูุงุช ููุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฌููุน ุทูุจ json ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุถุงูุฉ ุจุฐุฑุฉ ููุฃุดูุฑ ุงูููููุฏุฉ.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุณุชูุฑุช ุนูู ุงูุฎูุงุฑ ุงูุฃูู - ูุจุฏู ุจุตุฑููุง ุฃูุซุฑ ูุงุจููุฉ ููููู ูุฏุนูู. ูููู ุงูุญุตูู ุนูู ุนุฏุฏ ุฃุนูุงุฏ ุงููููุงุฏ ูู ุดูุฑ ูุนูู ุจุฌุนู </font></font><code>JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุฌุฏูู ูุน ุงูุฑูุงุจุท ุงูุนุงุฆููุฉ ( </font></font><code>relations.citizen_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ุงููููู ุงูุฐู ูุนุชุจุฑู ุฃุนูุงุฏ ูููุงุฏ ุงูุฃูุงุฑุจ) ูู ุงูุฌุฏูู </font></font><code>citizens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ูุญุชูู ุนูู ุชุงุฑูุฎ ุงููููุงุฏ ุงูุฐู ุชุฑูุฏ ุงูุญุตูู ุนูู ุงูุดูุฑ ููู). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุฃูุง ุชุญุชูู ููู ุงูุดูุฑ ุนูู ุฃุตูุงุฑ ุจุงุฏุฆุฉ. ูุฏ ูุญุชูู ุงูุดูุฑ ุงูุฐู ุชู ุงูุญุตูู ุนููู ูู ุงูุญูู </font></font><code>birth_date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ </font></font><code>date_part</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุตูุฑ ุจุงุฏุฆ. ูุฅุฒุงูุชูุ ุฃุฏูุช </font></font><code>cast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุงุณุชุนูุงู SQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุงููุนุงูุฌ ูุญุชุงุฌ ุฅูู ุชูุจูุฉ ุทูุจูู (ุชุญูู ูู ูุฌูุฏ ุชูุฑูุบ ูุงูุญุตูู ุนูู ูุนูููุงุช ุญูู ุฃุนูุงุฏ ุงููููุงุฏ ูุงููุฏุงูุง) ุ ูุฅู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุนุงููุฉ ุบูุฑ ูุทููุจุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุดูู ุงูุชุฑุงุถู ุ ุชุณุชุฎุฏู PostgreSQL ูุถุน READ COMMITTED ุ ุญูุซ ุชุธูุฑ ุฌููุน ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ (ุงููุถุงูุฉ ุจูุงุณุทุฉ ุงููุนุงููุงุช ุงูุฃุฎุฑู) ูุงูุณุฌูุงุช ุงูุญุงููุฉ (ุงููุนุฏูุฉ ุจูุงุณุทุฉ ูุนุงููุงุช ุฃุฎุฑู) ูู ุงููุนุงููุฉ ุงูุญุงููุฉ ุจุนุฏ ุฅุชูุงููุง ุจูุฌุงุญ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ุชูุช ุฅุถุงูุฉ ุชุญููู ุฌุฏูุฏ ูู ููุช ุงุณุชูุงู ุงูุจูุงูุงุช ุ ููู ูุคุซุฑ ุฐูู ุนูู ุงูุชุญูููุงุช ุงูุญุงููุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ุชู ุชูููุฐ ุทูุจ ุชุบููุฑ ุงููููู ููุช ุงุณุชูุงู ุงูุจูุงูุงุช ุ ูุฅูุง ุฃู ุงูุจูุงูุงุช ูู ุชููู ูุฑุฆูุฉ ุจุนุฏ (ุฅุฐุง ูู ุชูุชูู ุงููุนุงููุฉ ุงููุชุบูุฑุฉ ููุจูุงูุงุช) ุ ุฃู ุณุชูุชูู ุงููุนุงููุฉ ุจุงููุงูู ูุณุชููู ุฌููุน ุงูุชุบููุฑุงุช ูุฑุฆูุฉ ุนูู ุงูููุฑ. </font><font style="vertical-align: inherit;">ูู ูุชู ุงูุชูุงู ุงููุฒุงูุฉ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.</font></font><br>
<br>
<a name="town_age_stat_handler"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงููุฏู / ุณุชุงุช / ุงููุณุจุฉ ุงููุฆููุฉ / ุงูุนูุฑ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุงููุนุงูุฌ ุจุญุณุงุจ ุงููุณุจ ุงููุฆููุฉ 50 ู 75 ู 99 ูู ุงูุฃุนูุงุฑ (ุณููุงุช ูุงููุฉ) ูููููููู ุญุณุจ ุงููุฏููุฉ ูู ุงูุนููุฉ ูุน ูุนุฑู ุงูุงุณุชูุฑุงุฏ ุงููุญุฏุฏ. </font><font style="vertical-align: inherit;">ูู ุญุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุญููู ุบูุฑ ุงูููุฌูุฏ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฌุจ ุฅุนุงุฏุฉ ุงุณุชุฌุงุจุฉ HTTP </font></font><code>404: Not Found</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุงููุนุงูุฌ ูููุฐ ุทูุจูู (ุงูุชุญูู ูู ูุฌูุฏ ุชูุฑูุบ ูุงูุญุตูู ุนูู ูุงุฆูุฉ ุงููููููู) ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณ ูู ุงูุถุฑูุฑู ุงุณุชุฎุฏุงู ุงููุนุงููุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ุฎูุงุฑุงู ููุชูููุฐ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุญุตู ุนูู ุนูุฑ ุงูุณูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุฌูุนุฉ ุญุณุจ ุงููุฏููุฉ ุ ุซู ุนูู ุฌุงูุจ Python ุ ุงุญุณุจ ุงููุณุจ ุงููุฆููุฉ ุจุงุณุชุฎุฏุงู numpy (ุงูุฐู ุชู ุชุญุฏูุฏู ููุฑุฌุน ูู ุงููููุฉ) ููุฑุจ ูุง ูุตู ุฅูู ููุฒููู ุนุดุฑููู.</font></font></li>
<li>     PostgreSQL:  percentile_cont     ,             SQL-,  numpy   .</li>
</ol> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุทูุจ ุงูุฎูุงุฑ ุงูุซุงูู ููู ุจูุงูุงุช ุฃูู ุจูู ุงูุชุทุจูู ู PostgreSQL ุ ูููู ููุณ ูุฏูู ูุดููุฉ ูุงุถุญุฉ ููุบุงูุฉ: ูู PostgreSQL ุ ุงูุชูุฑูุจ ุฑูุงุถู ุ ( </font></font><code>SELECT ROUND(2.5)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฑุฌุงุน 3) ุ ููู Python - ุงููุญุงุณุจุฉ ุ ุฅูู ุฃูุฑุจ ุนุฏุฏ ุตุญูุญ ( </font></font><code>round(2.5)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฑุฌุงุน 2). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุฎุชุจุงุฑ ุงููุนุงูุฌ ุ ูุฌุจ ุฃู ูููู ุงูุชูููุฐ ูู ููุณู ูู ูู ูู PostgreSQL ู Python (ูุจุฏู ุฃู ุชูููุฐ ุฏุงูุฉ ุจุงูุชูุฑูุจ ุงูุฑูุงุถู ูู Python ุฃุณูู). </font><font style="vertical-align: inherit;">ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ุนูุฏ ุญุณุงุจ ุงููุณุจุฉ ุงููุฆููุฉ ุ ูููู ุฃู ูุนูุฏ numpy ู PostgreSQL ุฃุฑูุงููุง ูุฎุชููุฉ ููููุงู ุ ูููู ุจุงููุธุฑ ุฅูู ุงูุชูุฑูุจ ุ ูู ูููู ูุฐุง ุงูุงุฎุชูุงู ููุญูุธูุง.</font></font><br>
<br>
<a name="testing"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชุจุงุฑุงุช</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุงูุฐู ูุฌุจ ุงูุชุญูู ููู ูู ูุฐุง ุงูุชุทุจููุ ุฃููุงู ุ ุฃู ุงููุณุชูููู ููุจูู ุงููุชุทูุจุงุช ููุคุฏูู ุงูุนูู ุงููุทููุจ ูู ุจูุฆุฉ ูุฑูุจุฉ ูุฏุฑ ุงูุฅููุงู ูู ุจูุฆุฉ ุงููุชุงู. ุซุงูููุง ุ ุชุนูู ุนูููุงุช ุงูุชุฑุญูู ุงูุชู ุชุบูุฑ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุฏูู ุฃุฎุทุงุก. ุซุงูุซูุง ุ ููุงู ุนุฏุฏ ูู ุงููุธุงุฆู ุงูุฅุถุงููุฉ ุงูุชู ูููู ุฃูุถูุง ุชุบุทูุชูุง ุจุดูู ุตุญูุญ ูู ุฎูุงู ุงูุงุฎุชุจุงุฑุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฑุช ุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุทุงุฑ pytest ุจุณุจุจ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฑููุชู ูุณูููุฉ ุงุณุชุฎุฏุงูู. ูููุฑ ุขููุฉ ูููุฉ ูุชุญุถูุฑ ุงูุจูุฆุฉ ููุงุฎุชุจุงุฑุงุช - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฑููุจุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุฃู ุชุนูู ูุน ูุตูู</font></font><code>pytest.mark.fixture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุชุญุฏูุฏ ุฃุณูุงุกูู ุจูุงุณุทุฉ ุงููุนููุฉ ูู ุงูุงุฎุชุจุงุฑ. </font><font style="vertical-align: inherit;">ุฅุฐุง ุงูุชุดู pytest ูุนููุฉ ุจุงุณู ุชุซุจูุช ูู ุงูุชุนููู ุงูุชูุถูุญู ููุงุฎุชุจุงุฑ ุ ูุณุชููู ุจุชูููุฐ ูุฐู ุงูุชุฑููุจุงุช ูุชูุฑูุฑ ุงููุชูุฌุฉ ูู ูููุฉ ูุฐู ุงููุนููุฉ. </font><font style="vertical-align: inherit;">ูุฅุฐุง ูุงูุช ุงููุจุงุฑุงุฉ ุนุจุงุฑุฉ ุนู ูููุฏ ุ ูุณุชุฃุฎุฐ ูุนููุฉ ุงูุงุฎุชุจุงุฑ ุงููููุฉ ุงูุชู ุชู ุฅุฑุฌุงุนูุง </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุจุนุฏ ุงูุชูุงุก ุงูุงุฎุชุจุงุฑ ุ </font><font style="vertical-align: inherit;">ุณูุชู </font><font style="vertical-align: inherit;">ุชูููุฐ ุงูุฌุฒุก ุงูุซุงูู ูู </font><font style="vertical-align: inherit;">ุงููุจุงุฑุงุฉ </font><font style="vertical-align: inherit;">ุ ูุงูุฐู ููููู ูุณุญ ุงูููุงุฑุฏ ุฃู ุฅุบูุงู ุงูุงุชุตุงูุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงููุณุจุฉ ููุนุธู ุงูุงุฎุชุจุงุฑุงุช ุ ูุญุชุงุฌ ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL. </font><font style="vertical-align: inherit;">ูุนุฒู ุงูุงุฎุชุจุงุฑุงุช ุนู ุจุนุถูุง ุงูุจุนุถ ุ ููููู ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ูููุตูุฉ ูุจู ูู ุงุฎุชุจุงุฑ ุ ูุญุฐููุง ุจุนุฏ ุงูุชูููุฐ.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุชุฑููุจุงุช ููู ุงุฎุชุจุงุฑ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> uuid<font></font>
<font></font>
<span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine
<span class="hljs-keyword">from</span> sqlalchemy_utils <span class="hljs-keyword">import</span> create_database, drop_database
<span class="hljs-keyword">from</span> yarl <span class="hljs-keyword">import</span> URL<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.utils.pg <span class="hljs-keyword">import</span> DEFAULT_PG_URL<font></font>
<font></font>
PG_URL = os.getenv(<span class="hljs-string">'CI_ANALYZER_PG_URL'</span>, DEFAULT_PG_URL)<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">postgres</span>():</span>
    tmp_name = <span class="hljs-string">'.'</span>.join([uuid.uuid4().hex, <span class="hljs-string">'pytest'</span>])<font></font>
    tmp_url = str(URL(PG_URL).with_path(tmp_name))<font></font>
    create_database(tmp_url)<font></font>
<font></font>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment">#      postgres  -</span>
        <span class="hljs-keyword">yield</span> tmp_url
    <span class="hljs-keyword">finally</span>:<font></font>
        drop_database(tmp_url)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_db</span>(<span class="hljs-params">postgres</span>):</span>
    <span class="hljs-string">"""
     ,  PostgreSQL
    """</span><font></font>
    engine = create_engine(postgres)<font></font>
    <span class="hljs-keyword">assert</span> engine.execute(<span class="hljs-string">'SELECT 1'</span>).scalar() == <span class="hljs-number">1</span>
    engine.dispose()</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงูุช ูุญุฏุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sqlalchemy_utils</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุนูู ุฑุงุฆุน ูู ูุฐู ุงููููุฉ </font><font style="vertical-align: inherit;">ุ ูุน ูุฑุงุนุงุฉ ููุฒุงุช ููุงุนุฏ ุงูุจูุงูุงุช ูุจุฑุงูุฌ ุงูุชุดุบูู ุงููุฎุชููุฉ. ุนูู ุณุจูู ุงููุซุงู ุ ูุง ูุณูุญ PostgreSQL ุจุงูุชูููุฐ </font></font><code>CREATE DATABASE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุชูุฉ ุงููุนุงููุงุช. ุนูุฏ ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุ ูุฅูู </font></font><code>sqlalchemy_utils</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุฑุฌู </font></font><code>psycopg2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ุงูุฐู ุนุงุฏุฉ ูุง ูููุฐ ุฌููุน ุงูุทูุจุงุช ูู ุงููุนุงููุฉ) ุฅูู ูุถุน ุงูุฅูุบุงุก ุงูุชููุงุฆู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฒุฉ ุฃุฎุฑู ูููุฉ: ุฅุฐุง ูุงู ููุงู ุนููู ูุงุญุฏ ุนูู ุงูุฃูู ูุชุตูุงู ุจู PostgreSQL ุ ููุง ูููู ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููู ูุชู </font></font><code>sqlalchemy_utils</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุตู ุฌููุน ุงูุนููุงุก ูุจู ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช. ุณูุชู ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ ุญุชู ุฅุฐุง ุชููู ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุน ุงูุงุชุตุงูุงุช ุงููุดุทุฉ ููุง.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุชุงุฌ ุฅูู PostgreSQL ูู ุญุงูุงุช ูุฎุชููุฉ: ูุงุฎุชุจุงุฑ ุงูุชุฑุญููุงุช ุ ูุญุชุงุฌ ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ูุธููุฉ ุ ุจูููุง ุชุชุทูุจ ุงููุนุงูุฌุงุช ุชุทุจูู ุฌููุน ุนูููุงุช ุงูุชุฑุญูู. </font><font style="vertical-align: inherit;">ููููู ุชุบููุฑ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุฑูุฌููุง ุจุงุณุชุฎุฏุงู ุฃูุงูุฑ Alembic ุ ููู ุชุชุทูุจ ูุงุฆู ุชูููู Alembic ููุงุชุตุงู ุจูุง.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ูุงุฆู ุชูููู Alembic ูุงุนุจุง ุงุณุงุณูุง</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> types <span class="hljs-keyword">import</span> SimpleNamespace<font></font>
<font></font>
<span class="hljs-keyword">import</span> pytest<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.utils.pg <span class="hljs-keyword">import</span> make_alembic_config<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@pytest.fixture()</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">alembic_config</span>(<span class="hljs-params">postgres</span>):</span>
    cmd_options = SimpleNamespace(config=<span class="hljs-string">'alembic.ini'</span>, name=<span class="hljs-string">'alembic'</span>,<font></font>
                                  pg_url=postgres, raiseerr=<span class="hljs-literal">False</span>, x=<span class="hljs-literal">None</span>)
    <span class="hljs-keyword">return</span> make_alembic_config(cmd_options)</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฌู ููุงุญุธุฉ ุฃู ุงูุชุฑููุจุงุช </font></font><code>alembic_config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูุนููุฉ </font></font><code>postgres</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุชุณูุญ ููุท ุจุงูุฅุดุงุฑุฉ ุฅูู ุงุนุชูุงุฏ ุงูุงุฎุชุจุงุฑ ุนูู ุงูุชุฑููุจุงุช ุ ูููู ุฃูุถูุง ุฅูู ุงูุชุจุนูุงุช ุจูู ุงูุชุฑููุจุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุณูุญ ูู ูุฐู ุงูุขููุฉ ุจูุตู ุงูููุทู ุจูุฑููุฉ ููุชุงุจุฉ ููุฏ ููุฌุฒ ููุบุงูุฉ ููุงุจู ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู.</font></font><br>
<br>
<a name="testing_handlers"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุงูุฌุงุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุชุทูุจ ูุนุงูุฌุงุช ุงูุงุฎุชุจุงุฑ ูุงุนุฏุฉ ุจูุงูุงุช ูุน ุงูุฌุฏุงูู ูุฃููุงุน ุงูุจูุงูุงุช ุงูุชู ุชู ุฅูุดุงุคูุง. ูุชุทุจูู ุนูููุงุช ุงูุชุฑุญูู ุ ูุฌุจ ุนููู ุงุณุชุฏุนุงุก ุฃูุฑ ุงูุชุฑููุฉ Alembic ุจุฑูุฌููุง. ูุชุณููุฉ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ูุงุฆู ุจุชูููู Alembic ุ ุงูุฐู ุญุฏุฏูุงู ุจุงููุนู ุจุงูุชุฑููุจุงุช </font></font><code>alembic_config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุชุจุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุนูููุงุช ุงูุชุฑุญูู ููุงููุง ูุณุชููุงู ุชูุงููุง ุ ููููู ุชูุซูููุง ุนูู ุฃููุง ุชุฑููุจุงุช:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> alembic.command <span class="hljs-keyword">import</span> upgrade<font></font>
<font></font>
<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">migrated_postgres</span>(<span class="hljs-params">alembic_config, postgres</span>):</span>
    upgrade(alembic_config, <span class="hljs-string">'head'</span>)
    <span class="hljs-comment">#  DSN  ,    </span>
    <span class="hljs-keyword">return</span> postgres</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูููู ููุงู ุงูุนุฏูุฏ ูู ุนูููุงุช ุงูุชุฑุญูู ูู ุงููุดุฑูุน ุ ูุฏ ูุณุชุบุฑู ุชุทุจูููู ููู ุงุฎุชุจุงุฑ ุงููุซูุฑ ูู ุงูููุช. ูุชุณุฑูุน ุงูุนูููุฉ ุ ููููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ูุน ุนูููุงุช ุงูุชุฑุญูู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฑุฉ ูุงุญุฏุฉ </font><font style="vertical-align: inherit;">ุซู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงููุง ููุงูุจ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุฅุถุงูุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุฎุชุจุงุฑ ุงููุนุงูุฌุงุช ุ ุณุชุญุชุงุฌ ุฅูู ุชุทุจูู ููุฏ ุงูุชุดุบูู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุนููู ุชู ุชููููู ููุนูู ูุน ูุฐุง ุงูุชุทุจูู. ูุชุณููู ุงุฎุชุจุงุฑ ุงูุชุทุจูู ุ ุฃุถุน ุฅูุดุงุฆู ูู ูุธููุฉ </font></font><code>create_app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชุทูุจ ุชุดุบูู ุงููุนููุงุช: ูุงุนุฏุฉ ุจูุงูุงุช ุ ููููุฐ ูู REST API ุ ูุบูุฑูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุฃูุถูุง ุชูุซูู ุงูุญุฌุฌ ูุจุฏุก ุชุดุบูู ุงูุชุทุจูู ุนูู ุฃููุง ุชุฑููุจุงุช ูููุตูุฉ. ูุฅูุดุงุฆูุง ุ ุณุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุงููููุฐ ุงููุฌุงูู ูุชุดุบูู ุชุทุจูู ุงูุงุฎุชุจุงุฑ ูุงูุนููุงู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุคูุชุฉ ุงูุชู ุชู ุชุฑุญูููุง.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุญุฏูุฏ ุงููููุฐ ุงููุฌุงูู ุ ุงุณุชุฎุฏูุช </font></font><code>aiomisc_unused_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฑููุจ ูู ุญุฒูุฉ aiomisc. </font><font style="vertical-align: inherit;">ุณูููู </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชุซุจูุช ุงูููุงุณู </font></font><code>aiohttp_unused_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌูุฏูุง ุฃูุถูุง ุ ููููู ููุฑุฌุน ูุธููุฉ ูุชุญุฏูุฏ ุงูููุงูุฐ ุงููุฌุงููุฉ ุ ุจูููุง </font></font><code>aiomisc_unused_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฑุฌุน ุนูู ุงูููุฑ ุฑูู ุงููููุฐ. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ูุชุทุจูููุง ุ ูุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูููุฐ ูุฌุงูู ูุงุญุฏ ููุท ุ ูุฐูู ูุฑุฑุช ุนุฏู ูุชุงุจุฉ ุณุทุฑ ุฅุถุงูู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุน ููุงููุฉ </font></font><code>aiohttp_unused_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">arguments</span>(<span class="hljs-params">aiomisc_unused_port, migrated_postgres</span>):</span>
    <span class="hljs-keyword">return</span> parser.parse_args(<font></font>
        [<font></font>
            <span class="hljs-string">'--log-level=debug'</span>,
            <span class="hljs-string">'--api-address=127.0.0.1'</span>,
            <span class="hljs-string">f'--api-port=<span class="hljs-subst">{aiomisc_unused_port}</span>'</span>,
            <span class="hljs-string">f'--pg-url=<span class="hljs-subst">{migrated_postgres}</span>'</span><font></font>
        ]<font></font>
    )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุชุถูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุจุงุณุชุฎุฏุงู ูุนุงูุฌุงุช ุทูุจุงุช ุฅูู REST API ุ </font></font><code>aiohttp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ููุฒู </font><font style="vertical-align: inherit;">ุงูุนูู ูุจุงุดุฑุฉ ูุน ุงูุชุทุจูู </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุฐูู ุ ููุช ุจุนูู ุชุซุจูุช ูุงุญุฏ ูููู ุจุชุดุบูู ุงูุชุทุจูู ูุงุณุชุฎุฏุงู ุงููุตูุน </font></font><code>aiohttp_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุจุฅูุดุงุก ูุฅุฑุฌุงุน ุนููู ุงุฎุชุจุงุฑ ููุงุณู ูุชุตู ุจุงูุชุทุจูู </font></font><code>aiohttp.test_utils.TestClient</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> analyzer.api.app <span class="hljs-keyword">import</span> create_app<font></font>
<font></font>
<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">api_client</span>(<span class="hljs-params">aiohttp_client, arguments</span>):</span><font></font>
    app = create_app(arguments)<font></font>
    client = <span class="hljs-keyword">await</span> aiohttp_client(app, server_kwargs={
        <span class="hljs-string">'port'</span>: arguments.api_port<font></font>
    })<font></font>
<font></font>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> client
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-keyword">await</span> client.close()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุ ุฅุฐุง ุญุฏุฏุช ุชุฑููุจุงุช ูู ูุนููุงุช ุงูุงุฎุชุจุงุฑ </font></font><code>api_client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุณูุญุฏุซ ูุง ููู:</font></font><br>
<br>
<ol>
<li> <code>postgres</code>    (  <code>migrated_postgres</code>).</li>
<li> <code>alembic_config</code>    Alembic,      (  <code>migrated_postgres</code>).</li>
<li> <code>migrated_postgres</code>   (  <code>arguments</code>).</li>
<li> <code>aiomisc_unused_port</code>    (  <code>arguments</code>).</li>
<li> <code>arguments</code>     (  <code>api_client</code>).</li>
<li> <code>api_client</code>          .</li>
<li> .</li>
<li> <code>api_client</code>     .</li>
<li> <code>postgres</code>   .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุณูุญ ูู ุงูุชุฑููุจุงุช ุจุชุฌูุจ ุชูุฑุงุฑ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูููู ุจุงูุฅุถุงูุฉ ุฅูู ุฅุนุฏุงุฏ ุงูุจูุฆุฉ ูู ุงูุงุฎุชุจุงุฑุงุช ุ ููุงู ููุงู ูุญุชูู ุขุฎุฑ ุญูุซ ุณูููู ููุงู ุงููุซูุฑ ูู ููุณ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ - ุทูุจุงุช ุงูุชุทุจูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ุนูุฏ ุชูุฏูู ุทูุจ ุ ูุชููุน ุงูุญุตูู ุนูู ุญุงูุฉ HTTP ูุนููุฉ. ุซุงูููุง ุ ุฅุฐุง ูุงูุช ุงูุญุงูุฉ ุชุชุทุงุจู ูุน ุงูุญุงูุฉ ุงููุชููุนุฉ ุ ููุจู ุงูุนูู ูุน ุงูุจูุงูุงุช ุ ุชุญุชุงุฌ ุฅูู ุงูุชุฃูุฏ ูู ุฃู ูุฏููู ุงูุชูุณูู ุงูุตุญูุญ. ูู ุงูุณูู ุงุฑุชูุงุจ ุฎุทุฃ ููุง ููุชุงุจุฉ ูุนุงูุฌ ูููู ุจุฅุฌุฑุงุก ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุงูุตุญูุญุฉ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุนูุฏ ุงููุชูุฌุฉ ุงูุตุญูุญุฉ ุ ููููู ูุง ููุฌุญ ูู ุงูุชุญูู ุงูุชููุงุฆู ุจุณุจุจ ุชูุณูู ุงูุงุณุชุฌุงุจุฉ ุบูุฑ ุงูุตุญูุญ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ุนูู ุณุจูู ุงููุซุงู ุ ููุณู ุฃู ุชูู ุงูุฅุฌุงุจุฉ ูู ุงููุงููุณ ุจููุชุงุญ </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). ูู ูุฐู ุงููุญูุตุงุช ูููู ุฃู ุชุชู ูู ููุงู ูุงุญุฏ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงููุญุฏุฉ</font></font><code>analyzer.testing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุฏ ุฃุนุฏุฏุช ููู ูุณุงุนุฏ ูุธููุฉ ูุณุงุนุฏ ุชุชุญูู ูู ุญุงูุฉ HTTP ุ ุจุงูุฅุถุงูุฉ ุฅูู ุชูุณูู ุงูุงุณุชุฌุงุจุฉ ุจุงุณุชุฎุฏุงู Marshmallow. </font></font><br>
<br>
<a name="test_citizens_handler"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฑุช ุฃู ุฃุจุฏุฃ ุจุงุณุชุฎุฏุงู ูุนุงูุฌ ูููู ุจุฅุฑุฌุงุน ุงููููููู ุ ูุฃูู ูููุฏ ููุบุงูุฉ ููุชุญูู ูู ูุชุงุฆุฌ ูุนุงูุฌุงุช ุฃุฎุฑู ุชุบูุฑ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูู ุฃุณุชุฎุฏู ุฑูุฒูุง ูุถูู ุงูุจูุงูุงุช ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงููุนุงูุฌ </font></font><code>POST /imports</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุนูู ุงูุฑุบู ูู ุฃูู ููุณ ูู ุงูุตุนุจ ุชุญููููุง ุฅูู ูุธููุฉ ูููุตูุฉ. </font><font style="vertical-align: inherit;">ูุญุชูู ุฑูุฒ ุงููุนุงูุฌ ุนูู ุฎุงุตูุฉ ููุชุบููุฑ ุ ูุฅุฐุง ูุงู ููุงู ุฃู ุฎุทุฃ ูู ุงูุฑูุฒ ูุถูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููุงู ุงุญุชูุงู ุฃู ูุชููู ุงูุงุฎุชุจุงุฑ ุนู ุงูุนูู ุนูู ุงููุญู ุงูููุดูุฏ ูุณูุชููู ุงููุทูุฑูู ุถููููุง ุนู ุนุฑุถ ุงูุฃุฎุทุงุก. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุฐุง ุงูุงุฎุชุจุงุฑ ุ ุญุฏุฏุช ูุฌููุนุงุช ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ุงูุชุงููุฉ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ูุน ุนุฏุฉ ุฃูุงุฑุจ. </font><font style="vertical-align: inherit;">ูุชุญูู ูู ุฃูู ุณูุชู ุชุดููู ูุงุฆูุฉ ููู ูููู ูุน ูุนุฑูุงุช ุงูุฃูุงุฑุจ ุจุดูู ุตุญูุญ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ูุน ูููู ูุงุญุฏ ุจุฏูู ุฃูุงุฑุจ. </font><font style="vertical-align: inherit;">ููุชุญูู ูู ุฃู ุงูุญูู </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุจุงุฑุฉ ุนู ูุงุฆูุฉ ูุงุฑุบุฉ (ูุธุฑูุง </font></font><code>LEFT JOIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุนูุงู SQL ุ ูุฏ ุชููู ูุงุฆูุฉ ุงูุฃูุงุฑุจ ูุชุณุงููุฉ </font></font><code>[None]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ูุน ูููู ูู ุฃูุงุฑุจู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฑูุบ ูุงุฑุบ. </font><font style="vertical-align: inherit;">ุงูุชุญูู ูู ุฃู ุงููุนุงูุฌ ูุณูุญ ุจุฅุถุงูุฉ ุชูุฑูุบ ูุงุฑุบ ููุง ูุชูู ูุน ูุฌูุฏ ุฎุทุฃ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุดุบูู ููุณ ุงูุงุฎุชุจุงุฑ ุจุดูู ูููุตู ูู ูู ุนูููุฉ ุชุญููู ุ ุงุณุชุฎุฏูุช ุขููุฉ pytest ุฃุฎุฑู ูููุฉ ุฌุฏูุง - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุนููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุชุณูุญ ูู ูุฐู ุงูุขููุฉ ุจูู ูุธููุฉ ุงูุงุฎุชุจุงุฑ ูู ุงูุฏูููุฑ </font></font><code>pytest.mark.parametrize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุตููุง ุงููุนููุงุช ุงูุชู ูุฌุจ ุฃู ุชุชุฎุฐูุง ูุธููุฉ ุงูุงุฎุชุจุงุฑ ููู ุญุงูุฉ ุงุฎุชุจุงุฑ ูุฑุฏูุฉ.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุฉ ุชุญุฏูุฏ ุงุฎุชุจุงุฑ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> pytest<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.utils.testing <span class="hljs-keyword">import</span> generate_citizen<font></font>
<font></font>
datasets = [<font></font>
    <span class="hljs-comment">#    </span><font></font>
    [<font></font>
        generate_citizen(citizen_id=<span class="hljs-number">1</span>, relatives=[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]),<font></font>
        generate_citizen(citizen_id=<span class="hljs-number">2</span>, relatives=[<span class="hljs-number">1</span>]),<font></font>
        generate_citizen(citizen_id=<span class="hljs-number">3</span>, relatives=[<span class="hljs-number">1</span>])<font></font>
    ],<font></font>
<font></font>
    <span class="hljs-comment">#   </span><font></font>
    [<font></font>
        generate_citizen(relatives=[])<font></font>
    ],<font></font>
<font></font>
    <span class="hljs-comment">#   ,    </span><font></font>
    [<font></font>
        generate_citizen(citizen_id=<span class="hljs-number">1</span>, name=<span class="hljs-string">''</span>, gender=<span class="hljs-string">'male'</span>,<font></font>
                         birth_date=<span class="hljs-string">'17.02.2020'</span>, relatives=[<span class="hljs-number">1</span>])<font></font>
    ],<font></font>
<font></font>
    <span class="hljs-comment">#  </span><font></font>
    [],<font></font>
]<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@pytest.mark.parametrize('dataset', datasets)</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_get_citizens</span>(<span class="hljs-params">api_client, dataset</span>):</span>
    <span class="hljs-string">"""
        4 ,    
    """</span></code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐูู ุ ุณูุถูู ุงูุงุฎุชุจุงุฑ ุงูุชุญููู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ุซู ุ ุจุงุณุชุฎุฏุงู ุทูุจ ุฅูู ุงููุนุงูุฌ ุ ุณูุชููู ูุนูููุงุช ุญูู ุงููููููู ูููุงุฑูุฉ ุงูุชุญููู ุงููุฑุฌุนู ูุน ุงูุชุญููู ุงููุณุชูู. ูููู ููู ุชูุงุฑู ุงูุณูุงูุ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชููู ูู ูููู ูู ุงูุญููู ุงูุนุฏุฏูุฉ ูุญูู </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ูุงุฆูุฉ ูุนุฑูุงุช ุงูุฃูุงุฑุจ. ุงููุงุฆูุฉ ูู Python ูู ููุน ูุฑุชุจุฉ ุ ูุนูุฏ ููุงุฑูุฉ ุชุฑุชูุจ ุนูุงุตุฑ ูู ูุงุฆูุฉ ุ ูููู ุนูุฏ ููุงุฑูุฉ ุงูููุงุฆู ูุน ุงูุฃุดูุงุก ุ ูุง ููู ุงูุชุฑุชูุจ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ุฃุญุถุฑุช </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุงููุฌููุนุฉ ูุจู ุงูููุงุฑูุฉ ุ ูุนูุฏ ุงูููุงุฑูุฉ ูุง ุชุนูู ุนูู ุฅูุฌุงุฏ ูููู ุญูุซ ููุฌุฏ ูุฏู ุฃุญุฏ ุงูุณูุงู ูู ุงูููุฏุงู </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฑุงุฑุงุช. ุฅุฐุง ููุช ุจูุฑุฒ ุงููุงุฆูุฉ ุจูุนุฑูุงุช ุงูุฃูุงุฑุจ ุ ูุณูู ูุชุบูุจ ูุฐุง ุนูู ูุดููุฉ ุงูุชุฑุชูุจ ุงููุฎุชูู ููุนุฑูุงุช ุงูุฃูุงุฑุจ ุ ูููู ูู ููุณ ุงูููุช ููุชุดู ุงูุชูุฑุงุฑุงุช.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏ ููุงุฑูุฉ ูุงุฆูุชูู ูุน ุงููููููู ุ ูุฏ ููุงุฌู ุฃุญุฏููุง ูุดููุฉ ููุงุซูุฉ: ูู ุงููุงุญูุฉ ุงููููุฉ ุ ููุณ ุชุฑุชูุจ ุงูุณูุงู ูู ุงูุชูุฑูุบ ููููุง ุ ูููู ูู ุงูููู ุงูุชุดุงู ูุง ุฅุฐุง ูุงู ููุงู ุณุงููุงู ูููุง ููุณ ุงููุนุฑูุงุช ูู ุชูุฑูุบ ูุงุญุฏ ูููุณ ูู ุงูุขุฎุฑ. </font><font style="vertical-align: inherit;">ูุฐูู ุจุงูุฅุถุงูุฉ ุฅูู ุชูุธูู ุงููุงุฆูุฉ ูุน ุงูุฃูุงุฑุจ ุ ูุญุชุงุฌ ุงูุฃูุงุฑุจ ููู ูููู ุฅูู ุชุฑุชูุจ ุงูุณูุงู ูู ูู ุชูุฑูุบ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุฃู ูููุฉ ููุงุฑูุฉ ุงูุณูุงู ุณุชูุดุฃ ุฃูุซุฑ ูู ูุฑุฉ ุ ููุฏ ููุช ุจุชูููุฐ ูุธููุชูู: ูุงุญุฏุฉ ูููุงุฑูุฉ ุงุซููู ูู ุงููููููู ุ ูุงูุซุงููุฉ ูููุงุฑูุฉ ูุงุฆูุชูู ูุน ุงููููููู:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฑู ุจูู ุงูุณูุงู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Iterable, Mapping<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">normalize_citizen</span>(<span class="hljs-params">citizen</span>):</span>
    <span class="hljs-string">"""
         
    """</span>
    <span class="hljs-keyword">return</span> {**citizen, <span class="hljs-string">'relatives'</span>: sorted(citizen[<span class="hljs-string">'relatives'</span>])}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_citizens</span>(<span class="hljs-params">left: Mapping, right: Mapping</span>) -&gt; bool:</span>
    <span class="hljs-string">"""
      
    """</span>
    <span class="hljs-keyword">return</span> normalize_citizen(left) == normalize_citizen(right)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_citizen_groups</span>(<span class="hljs-params">left: Iterable, right: Iterable</span>) -&gt; bool:</span>
    <span class="hljs-string">"""
          ,   
      
    """</span>
    left = [normalize_citizen(citizen) <span class="hljs-keyword">for</span> citizen <span class="hljs-keyword">in</span> left]<font></font>
    left.sort(key=<span class="hljs-keyword">lambda</span> citizen: citizen[<span class="hljs-string">'citizen_id'</span>])<font></font>
<font></font>
    right = [normalize_citizen(citizen) <span class="hljs-keyword">for</span> citizen <span class="hljs-keyword">in</span> right]<font></font>
    right.sort(key=<span class="hljs-keyword">lambda</span> citizen: citizen[<span class="hljs-string">'citizen_id'</span>])
    <span class="hljs-keyword">return</span> left == right
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุฃูุฏ ูู ุฃู ูุฐุง ุงููุนุงูุฌ ูุง ูุนูุฏ ุณูุงู ุนูููุงุช ุงูุชูุฑูุบ ุงูุฃุฎุฑู ุ ูุฑุฑุช ุฅุถุงูุฉ ุชูุฑูุบ ุฅุถุงูู ูุน ุณุงูู ูุงุญุฏ ูุจู ูู ุงุฎุชุจุงุฑ.</font></font><br>
<br>
<a name="test_imports_handler"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุจุนุฏ / ุงููุงุฑุฏุงุช</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุช ุจุชุนุฑูู ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูุชุงููุฉ ูุงุฎุชุจุงุฑ ุงููุนุงูุฌ:</font></font><br>
<br>
<ul>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุจูุงูุงุช ุงูุตุญูุญุฉ ุ ุงููุชููุน ุฅุถุงูุชูุง ุจูุฌุงุญ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.</font></font></b><br>
 <br>
<ul>
<li>    ( ).<br>
<br>
      .    ,     ,    insert    ,    .</li>
<li>   ( , ).<br>
<br>
,            .<br>
 </li>
<li>    .<br>
<br>
     ,       . :)<br>
 </li>
<li>    <br>
<br>
,  aiohttp             PostgreSQL    32 767  (    ).<br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฑูุบ ูุงุฑุบ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุนูู ุงููุนุงูุฌ ุฃู ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ูุซู ูุฐู ุงูุญุงูุฉ ูุฃูุง ูุณูุท ุ ูุญุงููุงู ุฅุฌุฑุงุก ุฅุฏุฑุงุฌ ูุงุฑุบ ูู ุงูุฌุฏูู ูุน ุงูุณูุงู.</font></font><br>
 </li>
</ul><br>
 </li>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุจูุงูุงุช ุงูุชู ุจูุง ุฃุฎุทุงุก ุ ุชููุน ุงุณุชุฌุงุจุฉ HTTP 400: ุทูุจ ุบูุฑ ุตุญูุญ.</font></font></b><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุงุฑูุฎ ุงููููุงุฏ ุบูุฑ ุตุญูุญ (ุฒูู ุงููุณุชูุจู).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุชูุฒููุฏ ููุณุช ูุฑูุฏุฉ ูู ุงูุชุญููู.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดุงุฑ ุฅูู ุงููุฑุงุจุฉ ุจุดูู ุบูุฑ ุตุญูุญ (ูุง ููุฌุฏ ุณูู ูู ูููู ูุขุฎุฑ ุ ูููู ูุง ุชูุฌุฏ ุชุนูููุงุช).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููููู ูุฏูู ูุฑูุจ ุบูุฑ ููุฌูุฏ ูู ุงูุชูุฑูุบ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนูุงูุงุช ุงูุฃุณุฑูุฉ ููุณุช ูุฑูุฏุฉ ูู ููุนูุง.</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงู ุงููุนุงูุฌ ูุนูู ุจูุฌุงุญ ูุชูุช ุฅุถุงูุฉ ุงูุจูุงูุงุช ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุฅุถุงูุฉ ุงููููููู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุงุฑูุชูู ุจุงูุชูุฑูุบ ุงูููุงุณู. </font><font style="vertical-align: inherit;">ููุญุตูู ุนูู ุงููููููู ุ ุงุณุชุฎุฏูุช ุงููุนุงูุฌ ุงูุฐู ุชู ุงุฎุชุจุงุฑู ุจุงููุนู </font></font><code>GET /imports/$import_id/citizens</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููููุงุฑูุฉ ุ ูุธููุฉ </font></font><code>compare_citizen_groups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a name="test_update_citizen_handler"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุตุญูุญ / ุงููุงุฑุฏุงุช / $ import_id / ููููุงุทููู / $ ููุงุทู_ุงููุนุฑูู</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุดุจู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูู ููุงุญ ูุซูุฑุฉ ุชูู ุงูููุตููุฉ ูู ุงููุนุงูุฌ </font></font><code>POST /imports</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุน ุจุนุถ ุงูุงุณุชุซูุงุกุงุช: ููุงู ูููู ูุงุญุฏ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุท</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููููู ููุนููู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ููุท</font></a><font style="vertical-align: inherit;"> ุชูุฑูุฑ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุงูุญููู ุงูุชู ูุฑูุฏูุง</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฑุช ุงุณุชุฎุฏุงู ุงููุฌููุนุงุช ุงูุชุงููุฉ ูุน ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ ููุชุญูู ูู ุฃู ุงููุนุงูุฌ ุณูุนุฑุถ ุงุณุชุฌุงุจุฉ HTTP </font></font><code>400: Bad request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชู ุชุญุฏูุฏ ุงูุญูู ุ ูููู ุจู ููุน ุจูุงูุงุช ู / ุฃู ุชูุณูู ุบูุฑ ุตุญูุญ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุงุฑูุฎ ุงููููุงุฏ ุบูุฑ ุตุญูุญ (ูู ุงููุณุชูุจู).</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุชูู </font><font style="vertical-align: inherit;">ุงูุญูู </font><font style="vertical-align: inherit;">ุนูู ูุฑูุจ ุบูุฑ ููุฌูุฏ ูู ุงูุชูุฑูุบ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุถุฑูุฑู ุฃูุถูุง ุงูุชุญูู ูู ุฃู ุงููุนุงูุฌ ูููู ุจุชุญุฏูุซ ุงููุนูููุงุช ุจุดูู ุตุญูุญ ุนู ุงููููู ูุฃูุงุฑุจู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููุงู ุจุฐูู ุ ูู ุจุฅูุดุงุก ุชุญููู ูุน ุซูุงุซุฉ ุณูุงู ุ ุงุซูุงู ูููู ุฃูุงุฑุจ ุ ูุฃุฑุณู ุทูุจูุง ุจููู ุฌุฏูุฏุฉ ูุฌููุน ุงูุญููู ุงูุนุฏุฏูุฉ ููุนุฑู ูุณุจู ุฌุฏูุฏ ูู ุงูุญูู </font></font><code>relatives</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุฃูุฏ ูู ุฃู ุงููุนุงูุฌ ูููุฒ ุจูู ุณูุงู ุนูููุงุช ุงูุชูุฑูุบ ุงููุฎุชููุฉ ูุจู ุงูุงุฎุชุจุงุฑ (ูุนูู ุณุจูู ุงููุซุงู ุ ูุง ูุบูุฑ ุงูุณูุงู ุงูุฐูู ูุฏููู ููุณ ุงููุนุฑูุงุช ูู ุชูุฑูุบ ุขุฎุฑ) ุ ููุช ุจุฅูุดุงุก ุชูุฑูุบ ุฅุถุงูู ูุน ุซูุงุซุฉ ุณูุงู ูุฏููู ููุณ ุงููุนุฑูุงุช.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุนูู ุงููุนุงูุฌ ุญูุธ ุงูููู ุงูุฌุฏูุฏุฉ ููุญููู ุงูุนุฏุฏูุฉ ูุฅุถุงูุฉ ูุฑูุจ ุฌุฏูุฏ ูุญุฏุฏ ูุฅุฒุงูุฉ ุงูุนูุงูุฉ ูุน ูุฑูุจ ูุฏูู ุบูุฑ ูุญุฏุฏ. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ุชููู ุฌููุน ุงูุชุบููุฑุงุช ูู ุงููุฑุงุจุฉ ุซูุงุฆูุฉ. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃูุง ุชููู ููุงู ุชุบููุฑุงุช ูู ุนูููุงุช ุงูุชูุฑูุบ ุงูุฃุฎุฑู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุฃู ูุซู ูุฐุง ุงููุนุงูุฌ ูุฏ ูุฎุถุน ูุธุฑูู ุงูุณุจุงู (ุชูุช ููุงูุดุฉ ุฐูู ูู ูุณู ุงูุชุทููุฑ) ุ ุฃุถูุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชุจุงุฑูู ุฅุถุงูููู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุงุญุฏ ูุนูุฏ ุฅูุชุงุฌ ุงููุดููุฉ ูุน ุญุงูุฉ ุงูุณุจุงู (ููุชุฏ ูุฆุฉ ุงููุนุงูุฌ ููุฒูู ุงูููู) ุ ูุงูุซุงูู ูุซุจุช ุฃู ุงููุดููุฉ ูุน ุญุงูุฉ ุงูุณุจุงู ูุง ุชุชูุฑุฑ.</font></font><br>
<br>
<a name="test_citizen_birthdays_handler"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงูููุงุทููู / ุฃุนูุงุฏ ุงููููุงุฏ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุฎุชุจุงุฑ ูุฐุง ุงููุนุงูุฌ ุ ุญุฏุฏุช ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูุชุงููุฉ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฑูุบ ูููู ูููููู ููู ูุฑูุจ ูู ุดูุฑ ูุงุญุฏ ูุงุซููู ูู ุฃูุงุฑุจู ูู ุขุฎุฑ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ูุน ูููู ูุงุญุฏ ุจุฏูู ุฃูุงุฑุจ. </font><font style="vertical-align: inherit;">ุงูุชุญูู ูู ุฃู ุงููุนุงูุฌ ูุง ูุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ูู ุงูุญุณุงุจุงุช.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฑูุบ ูุงุฑุบ. </font><font style="vertical-align: inherit;">ุงูุชุญูู ูู ุฃู ุงููุนุงูุฌ ูู ููุดู ูุณูุนูุฏ ุงููุงููุณ ุงูุตุญูุญ ุฎูุงู 12 ุดูุฑูุง ูู ุงูุงุณุชุฌุงุจุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ูุน ูููู ูู ุฃูุงุฑุจู. </font><font style="vertical-align: inherit;">ุงูุดููุงุช ุฃู ุงููููู ุณูุดุชุฑู ูุฏูุฉ ูุดูุฑ ููุงุฏุชู.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุนูู ุงููุนุงูุฌ ุฅุฑุฌุงุน ูุงูุฉ ุงูุฃุดูุฑ ูู ุงูุงุณุชุฌุงุจุฉ ุ ุญุชู ุฅุฐุง ูู ููู ููุงู ุฃุนูุงุฏ ูููุงุฏ ูู ูุฐู ุงูุฃุดูุฑ. </font><font style="vertical-align: inherit;">ูุชุฌูุจ ุงูุงุฒุฏูุงุฌูุฉ ุ ููุช ุจุนูู ูุธููุฉ ููููู ุชูุฑูุฑ ุงููุงููุณ ุฅูููุง ุจุญูุซ ูููููุง ุจููู ุงูุฃุดูุฑ ุงูููููุฏุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุฃูุฏ ูู ุฃู ุงููุนุงูุฌ ูููุฒ ุจูู ุณูุงู ุนูููุงุช ุงูุชูุฑูุบ ุงููุฎุชููุฉ ุ ุฃุถูุช ุชูุฑูุบูุง ุฅุถุงูููุง ูุน ุงุซููู ูู ุงูุฃูุงุฑุจ. </font><font style="vertical-align: inherit;">ุฅุฐุง ุงุณุชุฎุฏููุง ุงููุนุงูุฌ ุนู ุทุฑูู ุงูุฎุทุฃ ูู ุงูุญุณุงุจุงุช ุ ูุณุชููู ุงููุชุงุฆุฌ ุบูุฑ ุตุญูุญุฉ ูุณููุน ุงููุนุงูุฌ ูุน ูุฌูุฏ ุฎุทุฃ.</font></font><br>
<br>
<a name="test_town_age_stat_handler"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุตูู ุนูู / ุงููุงุฑุฏุงุช / $ import_id / ุงููุฏู / ุณุชุงุช / ุงููุณุจุฉ ุงููุฆููุฉ / ุงูุนูุฑ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชููู ุฎุตูุตูุฉ ูุฐุง ุงูุงุฎุชุจุงุฑ ูู ุฃู ูุชุงุฆุฌ ุนููู ุชุนุชูุฏ ุนูู ุงูููุช ุงูุญุงูู: ูุชู ุญุณุงุจ ุนูุฑ ุงูุณูุงู ุจูุงุกู ุนูู ุงูุชุงุฑูุฎ ุงูุญุงูู. </font><font style="vertical-align: inherit;">ููุชุฃูุฏ ูู ุฃู ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ูุง ุชุชุบูุฑ ุจูุฑูุฑ ุงูููุช ุ ูุฌุจ ุชุณุฌูู ุงูุชุงุฑูุฎ ุงูุญุงูู ูุชูุงุฑูุฎ ูููุงุฏ ุงูุณูุงู ูุงููุชุงุฆุฌ ุงููุชููุนุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ุณูุฌุนู ูู ุงูุณูู ุฅุนุงุฏุฉ ุฅูุชุงุฌ ุฃู ุ ุญุชู ุญุงูุงุช ุงูุญุงูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ูู ุฃูุถู ุชุงุฑูุฎ ููุชุซุจูุชุ </font><font style="vertical-align: inherit;">ูู ุงููุนุงูุฌ ุ ูุญุณุงุจ ุนูุฑ ุงููููููู ุ ูุชู ุงุณุชุฎุฏุงู ูุธููุฉ PostgreSQL </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>AGE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุงูุชู ุชุฃุฎุฐ ุงููุนููุฉ ุงูุฃููู ูุชุงุฑูุฎ ุถุฑูุฑู ูุญุณุงุจ ุงูุนูุฑ ุ ูุงูุซุงููุฉ ูุชุงุฑูุฎ ุฃุณุงุณู (ูุญุฏุฏ ุจูุงุณุทุฉ ุซุงุจุช </font></font><code>TownAgeStatView.CURRENT_DATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชุจุฏู ุงูุชุงุฑูุฎ ุงูุฃุณุงุณู ูู ุงููุนุงูุฌ ุจููุช ุงูุงุฎุชุจุงุฑ</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> unittest.mock <span class="hljs-keyword">import</span> patch<font></font>
<font></font>
<span class="hljs-keyword">import</span> pytz<font></font>
<font></font>
CURRENT_DATE = datetime(<span class="hljs-number">2020</span>, <span class="hljs-number">2</span>, <span class="hljs-number">17</span>, tzinfo=pytz.utc)<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@patch('analyzer.api.handlers.TownAgeStatView.CURRENT_DATE', new=CURRENT_DATE)</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_get_ages</span>(<span class="hljs-params">...</span>):</span>
    ...</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุฎุชุจุงุฑ ุงููุนุงูุฌ ุ ุญุฏุฏุช ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูุชุงููุฉ (ูุฌููุน ุงููููููู ุงูุฐูู ุฃุดุฑุช ุฅูููู ูู ูุฏููุฉ ูุงุญุฏุฉ ุ ูุฃู ุงููุนุงูุฌ ูุฌูุน ุงููุชุงุฆุฌ ุญุณุจ ุงููุฏููุฉ):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ูุน ุงูุนุฏูุฏ ูู ุงูุณูุงู ุงูุฐูู ุบุฏุง ุนูุฏ ูููุงุฏูู (ุงูุนูุฑ - ุนุฏุฉ ุณููุงุช ู 364 ููููุง). </font><font style="vertical-align: inherit;">ูุชุญูู ูู ุฃู ุงููุนุงูุฌ ูุณุชุฎุฏู ุนุฏุฏ ุงูุณููุงุช ุงููุงููุฉ ููุท ูู ุงูุญุณุงุจุงุช.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุบ ูุน ูููู ุนูุฏ ูููุงุฏู ุงูููู (ุงูุนูุฑ - ุจุถุน ุณููุงุช ุจุงูุถุจุท). </font><font style="vertical-align: inherit;">ููุชุญูู ูู ุงูุญุงูุฉ ุงูุฅูููููุฉ - ูุฌุจ ุฃูุง ูุญุณุจ ุนูุฑ ุงููููู ุงูุฐู ูููู ุนูุฏ ูููุงุฏู ุงูููู ูุฎูุถูุง ุจููุฏุงุฑ ุนุงู ูุงุญุฏ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฑูุบ ูุงุฑุบ. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃูุง ููุน ุงููุนุงูุฌ ุนููู.</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><code>numpy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุนูุงุฑ </font><font style="vertical-align: inherit;">
ูุญุณุงุจ ุงููุฆุงุช - </font><font style="vertical-align: inherit;">ูุน ุงูุงุณุชููุงู ุงูุฎุทู ุ ููุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ููุงุฎุชุจุงุฑ ุงูุฐู ููุช ุจุญุณุงุจู ููู. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุชูุฑูุจ ุงูููู ุงููุฆููุฉ ุงููุณุฑูุฉ ุฅูู ููุฒูุชูู ุนุดุฑูุชูู. </font><font style="vertical-align: inherit;">ุฅุฐุง ุงุณุชุฎุฏูุช PostgreSQL ููุชูุฑูุจ ูู ุงููุนุงูุฌ ุ ู Python ูุญุณุงุจ ุงูุจูุงูุงุช ุงููุฑุฌุนูุฉ ุ ููุฏ ุชูุงุญุธ ุฃู </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑูุจ ูู Python 3 ู PostgreSQL ูููู ุฃู ูุนุทู ูุชุงุฆุฌ ูุฎุชููุฉ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs"># Python 3<font></font>
round(2.5)<font></font>
&gt; 2<font></font>
<font></font>
-- PostgreSQL<font></font>
SELECT ROUND(2.5)<font></font>
&gt; 3<font></font>
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงูุญูููุฉ ูู ุฃู Python ุชุณุชุฎุฏู ุงูุชูุฑูุจ ุงูุจููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุฃูุฑุจ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฒูุฌ ุ </font><font style="vertical-align: inherit;">ูุชุณุชุฎุฏู </font><font style="vertical-align: inherit;">PostgreSQL ุงูุฑูุงุถูุงุช (ูุตู ุฅูู ูุตู). </font><font style="vertical-align: inherit;">ุฅุฐุง ุชู ุฅุฌุฑุงุก ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ูุงูุชูุฑูุจ ูู PostgreSQL ุ ูุณูููู ูู ุงูุตุญูุญ ุงุณุชุฎุฏุงู ุงูุชูุฑูุจ ุงูุฑูุงุถู ูู ุงูุงุฎุชุจุงุฑุงุช ุฃูุถูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุจุฏุงูุฉ ูุตูุช ูุฌููุนุงุช ุงูุจูุงูุงุช ุจุชูุงุฑูุฎ ุงููููุงุฏ ุจุชูุณูู ูุตู ุ ูููู ูุงู ูู ุบูุฑ ุงูููุงุฆู ูุฑุงุกุฉ ุงุฎุชุจุงุฑ ุจูุฐุง ุงูุชูุณูู: ูู ูู ูุฑุฉ ูุงู ุนููู ุญุณุงุจ ุนูุฑ ูู ุณุงูู ูู ุฐููู ููู ุฃุชุฐูุฑ ูุง ูุงูุช ูุฌููุนุฉ ุจูุงูุงุช ูุนููุฉ ุชุชุญูู ููู. </font><font style="vertical-align: inherit;">ุจุงูุทุจุน ุ ููููู ุงูุญุตูู ุนูู ุงูุชุนูููุงุช ูู ุงูููุฏ ุ ููููู ูุฑุฑุช ุงูุฐูุงุจ ุฅูู ุฃุจุนุฏ ูู ุฐูู ููููุงู ููุชุจุช ูุธููุฉ </font></font><code>age2date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณูุญ ูู ุจูุตู ุชุงุฑูุฎ ุงููููุงุฏ ูู ุดูู ุงูุนูุฑ: ุนุฏุฏ ุงูุณููุงุช ูุงูุฃูุงู.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูุซู ูุฐุง</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> pytz<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.utils.testing <span class="hljs-keyword">import</span> generate_citizen<font></font>
<font></font>
<font></font>
CURRENT_DATE = datetime(<span class="hljs-number">2020</span>, <span class="hljs-number">2</span>, <span class="hljs-number">17</span>, tzinfo=pytz.utc)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">age2date</span>(<span class="hljs-params">years: int, days: int = <span class="hljs-number">0</span>, base_date=CURRENT_DATE</span>) -&gt; str:</span><font></font>
    birth_date = copy(base_date).replace(year=base_date.year - years)<font></font>
    birth_date -= timedelta(days=days)<font></font>
    <span class="hljs-keyword">return</span> birth_date.strftime(BIRTH_DATE_FORMAT)<font></font>
<font></font>
<span class="hljs-comment">#    ?  ,     ?</span>
generate_citizen(birth_date=<span class="hljs-string">'17.02.2009'</span>)<font></font>
<font></font>
<span class="hljs-comment">#   11       </span>
generate_citizen(birth_date=age2date(years=<span class="hljs-number">11</span>))
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชุฃูุฏ ูู ุฃู ุงููุนุงูุฌ ูููุฒ ุจูู ุณูุงู ุนูููุงุช ุงูุชูุฑูุบ ุงููุฎุชููุฉ ุ ุฃุถูุช ุชูุฑูุบูุง ุฅุถุงูููุง ูุน ุฃุญุฏ ุงููููููู ูู ูุฏููุฉ ุฃุฎุฑู: ุฅุฐุง ุงุณุชุฎุฏูู ุงููุนุงูุฌ ุนู ุทุฑูู ุงูุฎุทุฃ ุ ุณุชุธูุฑ ูุฏููุฉ ุฅุถุงููุฉ ูู ุงููุชุงุฆุฌ ูุณููุดู ุงูุงุฎุชุจุงุฑ.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญูููุฉ ูุซูุฑุฉ ููุงูุชูุงู: ุนูุฏูุง ูุชุจุช ูุฐุง ุงูุงุฎุชุจุงุฑ ูู 29 ูุจุฑุงูุฑ 2020 ุ ุชูููุช ูุฌุฃุฉ ุนู ุชูููุฏ ุญูููุงุช ูุน ุงููููููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุณุจุจ ุฎุทุฃ ูู Faker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (2020 ูู ุณูุฉ ูุจูุณุฉ ุ ูุงูุณููุงุช ุงูุฃุฎุฑู ุงูุชู ุงุฎุชุงุฑูุง Faker ูู ุชูู ุฏุงุฆููุง ููุฒุฉ ูููุง ุฃูุถูุง ูู ููู 29 ูุจุฑุงูุฑ). </font><font style="vertical-align: inherit;">ุชุฐูุฑ ุชุณุฌูู ุงูุชูุงุฑูุฎ ูุญุงูุงุช ุญุงูุฉ ุงูุงุฎุชุจุงุฑ!</font></font></blockquote><br>
<a name="test_migrations"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฌุฑุงุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจุฏู ุฑูุฒ ุงููุฌุฑุฉ ูููููุฉ ุงูุฃููู ูุงุถุญูุง ูุงูุฃูู ุนุฑุถุฉ ููุฎุทุฃ ุ ูููุงุฐุง ูุฎุชุจุฑูุ ูุฐุง ุฎุทุฃ ุฎุทูุฑ ููุบุงูุฉ: ูููู ุฃู ุชุชุฌูู ุฃูุซุฑ ุงูุฃุฎุทุงุก ุงูุฎุงุฏุนุฉ ูููุฌุฑุฉ ูู ุฃูุซุฑ ุงูุฃููุงุช ุบูุฑ ุงูููุงุณุจุฉ. ุญุชู ุฅุฐุง ูู ููุณุฏูุง ุงูุจูุงูุงุช ุ ูููู ุฃู ูุชุณุจุจูุง ูู ุชุนุทู ุบูุฑ ุถุฑูุฑู. </font><font style="vertical-align: inherit;">ูุบูุฑ ุงูุชุฑุญูู </font><i><font style="vertical-align: inherit;">ุงูุฃููู</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุงูููุฌูุฏ ูู ุงููุดุฑูุน </font><font style="vertical-align: inherit;">ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ููููู ูุง ูุบูุฑ ุงูุจูุงูุงุช. ูุง ูู ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ุงูุชู ูููู ุญูุงูุชูุง ูู ูุซู ูุฐู ุงููุฌุฑุงุชุ</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li>  <code>downgrade</code>           (     ,      ,     ).<br>
<br>
   ,        (--):         ,        โ    .<br>
 </li>
<li>C   .</li>
<li>    ( ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูุชู ุงูุชุดุงู ูุนุธู ูุฐู ุงูุฃุฎุทุงุก ุนู ุทุฑูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชุจุงุฑ ุงูุฏุฑุฌ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ููุฑุชู - ูุงุณุชุฎุฏุงู ูุฌุฑุฉ ูุงุญุฏุฉุ ูุฃุฏุงุก ุจุงุณุชูุฑุงุฑ ุงูุฃุณุงููุจ </font></font><code>upgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>downgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>upgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุงููุฌุฑุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ุงูุงุฎุชุจุงุฑ ูููู ูุฅุถุงูุชู ุฅูู ุงููุดุฑูุน ูุฑุฉ ูุงุญุฏุฉ ุ ููุง ูุชุทูุจ ุฏุนููุง ูุณูุฎุฏู ุจุฃูุงูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุฅุฐุง ูุงู ุงูุชุฑุญูู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููููู ุ ุณูุบูุฑ ุงูุจูุงูุงุช ุ ูุณูููู ูู ุงูุถุฑูุฑู ูุชุงุจุฉ ุงุฎุชุจุงุฑ ูููุตู ูุงุญุฏ ุนูู ุงูุฃูู ุ ูุงูุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุชุชุบูุฑ ุจุดูู ุตุญูุญ ูู ุงูุทุฑููุฉ </font></font><code>upgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุนูุฏ ุฅูู ุงูุญุงูุฉ ุงูุฃูููุฉ ูู </font></font><code>downgrade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุท ูู ุญุงูุฉ: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดุฑูุน ุจุฃูุซูุฉ ูุงุฎุชุจุงุฑ ุงููุฌุฑุงุช ุงููุฎุชููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุงูุชู ุฃุนุฏุฏุชูุง </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุฑูุฑ ุญูู Alembic</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ููุณูู ุจุงูุซูู.</font></font><br>
<br>
<a name="build"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฌุณู</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฃุฏุงุฉ ุงูููุงุฆูุฉ ุงูุชู ุณููุดุฑูุง ูุงูุชู ูุฑูุฏ ุงูุญุตูู ุนูููุง ูุชูุฌุฉ ุงูุชุฌููุน ูู ุตูุฑุฉ Docker. ููุจูุงุก ุ ูุฌุจ ุนููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฏูุฏ ุงูุตูุฑุฉ ุงูุฃุณุงุณูุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุงุณุชุฎุฏุงู Python. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>python:latest</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฒู </font><font style="vertical-align: inherit;">ุงูุตูุฑุฉ ุงูุฑุณููุฉ </font><font style="vertical-align: inherit;">~ 1 ุบูุบุงุจุงูุช ุ ูุฅุฐุง ุชู ุงุณุชุฎุฏุงููุง ูุตูุฑุฉ ุฃุณุงุณูุฉ ุ ูุณุชููู ุงูุตูุฑุฉ ูุน ุงูุชุทุจูู ุถุฎูุฉ. ููุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุฑ ุชุนุชูุฏ ุนูู ูุธุงู Alpine OS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุญุฌูู ุฃุตุบุฑ ุจูุซูุฑ. ูููู ูุน ุงูุนุฏุฏ ุงููุชุฒุงูุฏ ูู ุงูุญุฒู ุงููุซุจุชุฉ ุ ุณูุฒุฏุงุฏ ุญุฌู ุงูุตูุฑุฉ ุงูููุงุฆูุฉ ุ ููุชูุฌุฉ ูุฐูู ุ ูู ุชููู ุงูุตูุฑุฉ ุงููุฌูุนุฉ ุนูู ุฃุณุงุณ ุฌุจุงู ุงูุฃูุจ ุตุบูุฑุฉ ุฌุฏูุง. ุงุฎุชุฑุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snakepacker / python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุตูุฑุฉ ุฃุณุงุณูุฉ </font><font style="vertical-align: inherit;">- ููู ุชุฒู ุฃูุซุฑ ุจูููู ูู ุตูุฑ ุฌุจุงู ุงูุฃูุจ ุ ูููููุง ุชุณุชูุฏ ุฅูู Ubuntu ุ ุงูุชู ุชูุฏู ูุฌููุนุฉ ูุจูุฑุฉ ูู ุงูุญุฒู ูุงูููุชุจุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุทุฑูู ุงุฎุฑ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุญุฌู ุงูุตูุฑุฉ ูุน ุงูุชุทุจูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ูุง ุชูุฏุฑุฌ ูู ุงูุตูุฑุฉ ุงูููุงุฆูุฉ ุงููุชุฑุฌู ูุงูููุชุจุงุช ูุงููููุงุช ุงูุชู ุชุญุชูู ุนูู ุฑุคูุณ ููุชุฌููุน ุ ููู ุบูุฑ ูุทููุจุฉ ููู ูุนูู ุงูุชุทุจูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููุงู ุจุฐูู ุ ููููู ุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฌููุน ูุชุนุฏุฏ ุงููุฑุงุญู ูู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Docker:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู ุตูุฑุฉ "ุซูููุฉ" </font></font><code>snakepacker/python:all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(~ 1 ุฌูุฌุง ุจุงูุช ุ ~ 500 ููุฌุง ุจุงูุช ูุถุบูุทุฉ) ุ ูู ุจุฅูุดุงุก ุจูุฆุฉ ุงูุชุฑุงุถูุฉ ุ ููู ุจุชุซุจูุช ูู ุงูุชุจุนูุงุช ูุญุฒูุฉ ุงูุชุทุจูู ูููุง. </font><font style="vertical-align: inherit;">ูุฐู ุงูุตูุฑุฉ ูุทููุจุฉ ุญุตุฑููุง ููุชุฌููุน ุ ููููู ุฃู ุชุญุชูู ุนูู ูุชุฑุฌู ุ ูุฌููุน ุงูููุชุจุงุช ูุงููููุงุช ุงูุถุฑูุฑูุฉ ุฐุงุช ุงูุฑุคูุณ.</font></font><br>
<br>
<pre><code class="python hljs">FROM snakepacker/python:all <span class="hljs-keyword">as</span> builder<font></font>
<font></font>
<span class="hljs-comment">#   </span>
RUN python3<span class="hljs-number">.8</span> -m venv /usr/share/python3/app<font></font>
<font></font>
<span class="hljs-comment">#  source distribution     </span><font></font>
COPY dist/ /mnt/dist/<font></font>
RUN /usr/share/python3/app/bin/pip install /mnt/dist/*</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุจูุณุฎ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุงูููุงุฆูุฉ ุฅูู ุตูุฑุฉ "ุฎูููุฉ" </font></font><code>snakepacker/python:3.8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(~ 100 ููุฌุงุจุงูุช ุ ูุถุบูุทุฉ ~ 50 ููุฌุงุจุงูุช) ุ ูุงูุชู ุชุญุชูู ููุท ุนูู ูุชุฑุฌู ุงูุฅุตุฏุงุฑ ุงููุทููุจ ูู Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงู: ูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุ ูุชู ุงุณุชุฎุฏุงู ุงููุณุงุฑุงุช ุงููุทููุฉ ุ ูุฐูู ูุฌุจ ูุณุฎูุง ุฅูู ููุณ ุงูุนููุงู ุงูุฐู ุชู ุชุฌููุนูุง ููู ูู ุญุงููุฉ ุงููุฌูุน.</font></font><br>
<br>
<pre><code class="python hljs">FROM snakepacker/python:<span class="hljs-number">3.8</span> <span class="hljs-keyword">as</span> api<font></font>
<font></font>
<span class="hljs-comment">#       builder</span>
COPY --<span class="hljs-keyword">from</span>=builder /usr/share/python3/app /usr/share/python3/app<font></font>
<font></font>
<span class="hljs-comment">#  ,     </span>
<span class="hljs-comment"># </span><font></font>
RUN ln -snf /usr/share/python3/app/bin/analyzer-* /usr/local/bin/<font></font>
<font></font>
<span class="hljs-comment">#        </span>
CMD [<span class="hljs-string">"analyzer-api"</span>]</code></pre></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู ุงูููุช ุงูุฐู ูุณุชุบุฑูู ูุจูุงุก ุตูุฑุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูููู ุชุซุจูุช ูุญุฏุงุช ุชุนุชูุฏ ุงูุชุทุจูู ูุจู ุชุซุจูุชู ูู ุจูุฆุฉ ุงูุชุฑุงุถูุฉ. </font><font style="vertical-align: inherit;">ุซู ุณุชููู Docker ุจุชุฎุฒูููุง ูุคูุชูุง ููู ูุชู ุฅุนุงุฏุฉ ุชุซุจูุชูุง ุฅุฐุง ูู ุชุชุบูุฑ.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู Dockerfile ุจุงููุงูู</font></font></b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">###############      ################</span>
<span class="hljs-comment">#  โ ยซยป (~1 ,    ~500 )    </span>
<span class="hljs-comment">#    </span>
FROM snakepacker/python:all <span class="hljs-keyword">as</span> builder<font></font>
<font></font>
<span class="hljs-comment">#      pip</span>
RUN python3<span class="hljs-number">.8</span> -m venv /usr/share/python3/app<font></font>
RUN /usr/share/python3/app/bin/pip install -U pip<font></font>
<font></font>
<span class="hljs-comment">#   ,  .   </span>
<span class="hljs-comment"># Docker   ,  requirements.txt  </span><font></font>
COPY requirements.txt /mnt/<font></font>
RUN /usr/share/python3/app/bin/pip install -Ur /mnt/requirements.txt<font></font>
<font></font>
<span class="hljs-comment">#  source distribution     </span><font></font>
COPY dist/ /mnt/dist/<font></font>
RUN /usr/share/python3/app/bin/pip install /mnt/dist/* \<font></font>
    &amp;&amp; /usr/share/python3/app/bin/pip check<font></font>
<font></font>
<span class="hljs-comment">###########################   ############################</span>
<span class="hljs-comment">#    ยซยป (~100 ,    ~50 )   Python</span>
FROM snakepacker/python:<span class="hljs-number">3.8</span> <span class="hljs-keyword">as</span> api<font></font>
<font></font>
<span class="hljs-comment">#         builder</span>
COPY --<span class="hljs-keyword">from</span>=builder /usr/share/python3/app /usr/share/python3/app<font></font>
<font></font>
<span class="hljs-comment">#  ,     </span>
<span class="hljs-comment"># </span><font></font>
RUN ln -snf /usr/share/python3/app/bin/analyzer-* /usr/local/bin/<font></font>
<font></font>
<span class="hljs-comment">#        </span>
CMD [<span class="hljs-string">"analyzer-api"</span>]</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณูููุฉ ุงูุชุฌููุน ุ ุฃุถูุช ุฃูุฑูุง </font></font><code>make upload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌูุน ุตูุฑุฉ Docker ููุญูููุง ุนูู hub.docker.com.</font></font><br>
<br>
<a name="ci"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ci</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุจุนุฏ ุฃู ุชู ุชุบุทูุฉ ุงูุฑูุฒ ุจุงูุงุฎุชุจุงุฑุงุช ููููููุง ุจูุงุก ุตูุฑุฉ Docker ุ ุญุงู ุงูููุช ูุฃุชูุชุฉ ูุฐู ุงูุนูููุงุช. ุฃูู ุดูุก ูุชุจุงุฏุฑ ุฅูู ุงูุฐูู: ุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ูุฅูุดุงุก ุทูุจุงุช ุงูุชุฌูุน ุ ูุนูุฏ ุฅุถุงูุฉ ุงูุชุบููุฑุงุช ุฅูู ุงููุฑุน ุงูุฑุฆูุณู ุ ูู ุจุชุฌููุน ุตูุฑุฉ Docker ุฌุฏูุฏุฉ ูุชุญููููุง ุฅูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ุฃู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒู GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุฅุฐุง ููุช ูู ุชููู ุจุชูุฒูุน ุงูุตูุฑุฉ ุนูููุง). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏ ููุช ุจุญู ูุฐู ุงููุดููุฉ ูุน </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub Actions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ููููุงู ุจุฐูู ุ ูุงู ูู ุงูุถุฑูุฑู ุฅูุดุงุก ููู YAML ูู ูุฌูุฏ </font></font><code>.github/workflows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุตู ุณูุฑ ุงูุนูู ููู (ูุน ูููุชูู: </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>publish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ุ ุงูุฐู ููุช ุจุชุณููุชู </font></font><code>CI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุชู ุชูููุฐ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููููุฉ ูู </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฑุฉ ูุชู ูููุง ุจุฏุก ุณูุฑ ุงูุนูู </font></font><code>CI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุจุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎุฏูุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุชูุท ุญุงููุฉ ูุน PostgreSQL ุ ุชูุชุธุฑ ุฃู ุชุตุจุญ ูุชุงุญุฉ ุ ููุชู ุฅุทูุงููุง </font></font><code>pytest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุญุงููุฉ </font></font><code>snakepacker/python:all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุชู ุชูููุฐ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููููุฉ </font></font><code>publish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุท ุฅุฐุง ุชู ุฅุถุงูุฉ ุงูุชุบููุฑุงุช ุฅูู ุงููุฑุน </font></font><code>master</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุฐุง ูุงูุช ุงููููุฉ </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฌุญุฉ. </font><font style="vertical-align: inherit;">ูุฌูุน ุชูุฒูุน ุงููุตุฏุฑ ุญุณุจ ุงูุญุงููุฉ </font></font><code>snakepacker/python:all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุซู ูุฌูุน ููุญูู ุตูุฑุฉ Docker </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>docker/build-push-action@v1</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุตู ุงููุงูู ูุณูุฑ ุงูุนูู</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">name: CI<font></font>
<font></font>
# Workflow      <font></font>
#   -  master<font></font>
on:<font></font>
  push:<font></font>
    branches: [ master ]<font></font>
  pull_request:<font></font>
    branches: [ master ]<font></font>
<font></font>
jobs:<font></font>
  #       workflow<font></font>
  test:<font></font>
    runs-on: ubuntu-latest<font></font>
<font></font>
    services:<font></font>
      postgres:<font></font>
        image: docker://postgres<font></font>
        ports:<font></font>
          - 5432:5432<font></font>
        env:<font></font>
          POSTGRES_USER: user<font></font>
          POSTGRES_PASSWORD: hackme<font></font>
          POSTGRES_DB: analyzer<font></font>
<font></font>
    steps:<font></font>
      - uses: actions/checkout@v2<font></font>
      - name: test<font></font>
        uses: docker://snakepacker/python:all<font></font>
        env:<font></font>
          CI_ANALYZER_PG_URL: postgresql://user:hackme@postgres/analyzer<font></font>
        with:<font></font>
          args: /bin/bash -c "pip install -U '.[dev]' &amp;&amp; pylama &amp;&amp; wait-for-port postgres:5432 &amp;&amp; pytest -vv --cov=analyzer --cov-report=term-missing tests"<font></font>
<font></font>
  #    Docker-  <font></font>
  publish:<font></font>
    #        master<font></font>
    if: github.event_name == 'push' &amp;&amp; github.ref == 'refs/heads/master'<font></font>
    # ,   test   <font></font>
    needs: test<font></font>
    runs-on: ubuntu-latest<font></font>
    steps:<font></font>
      - uses: actions/checkout@v2<font></font>
      - name: sdist<font></font>
        uses: docker://snakepacker/python:all<font></font>
        with:<font></font>
          args: make sdist<font></font>
<font></font>
      - name: build-push<font></font>
        uses: docker/build-push-action@v1<font></font>
        with:<font></font>
          username: ${{ secrets.REGISTRY_LOGIN }}<font></font>
          password: ${{ secrets.REGISTRY_TOKEN }}<font></font>
          repository: alvassin/backendschool2019<font></font>
          target: api<font></font>
          tags: 0.0.1, latest<font></font>
</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุ ุนูุฏ ุฅุถุงูุฉ ุงูุชุบููุฑุงุช ุฅูู ุงูุดุฑูุญุฉ ุงูุฑุฆูุณูุฉ ูู ุนูุงูุฉ ุงูุชุจููุจ ุงูุฅุฌุฑุงุกุงุช ุนูู GitHub ุ ููููู ุฑุคูุฉ ุจุฏุก ุงูุงุฎุชุจุงุฑุงุช ูุชุฌููุน ูุชุญููู ุตูุฑุฉ Docker: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r5/qx/pm/r5qxpmy7mlttqniibfvxadvzitw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนูุฏ ุฅูุดุงุก ุทูุจ ุชุฌูุน ูู ุงููุฑุน ุงูุฑุฆูุณู ุ ุณูุชู ุฃูุถูุง ุนุฑุถ ูุชุงุฆุฌ ุงููููุฉ ููู </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pz/d9/nk/pzd9nkmxq7a75fnlcw2tx37i308.png"><br>
<br>
<a name="deployment"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดุฑ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุดุฑ ุงูุชุทุจูู ุนูู ุงูุฎุงุฏู ุงูููุฏู ุ ุชุญุชุงุฌ ุฅูู ุชุซุจูุช Docker ู Docker Compose ูุจุฏุก ุชุดุบูู ุงูุญุงููุงุช ูุน ุงูุชุทุจูู ู PostgreSQL ูุชุทุจูู ุนูููุงุช ุงูุชุฑุญูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุฃุชูุชุฉ ูุฐู ุงูุฎุทูุงุช ุจุงุณุชุฎุฏุงู ูุธุงู ุฅุฏุงุฑุฉ ุชูููู Ansible. ุฅูู ููุชูุจ ุจูุบุฉ Python ุ ููุง ูุชุทูุจ ูููุงุก ุฎุงุตูู (ูุชุตู ูุจุงุดุฑุฉ ุนุจุฑ ssh) ุ ููุณุชุฎุฏู ููุงูุจ jinja ููุณูุญ ุจุดูู ุตุฑูุญ ููุตู ุงูุญุงูุฉ ุงููุทููุจุฉ ูู ูููุงุช YAML. ูุณูุญ ูู ุงูููุฌ ุงูุชุตุฑูุญู ุจุนุฏู ุงูุชูููุฑ ูู ุงูุญุงูุฉ ุงูุญุงููุฉ ูููุธุงู ูุงูุฅุฌุฑุงุกุงุช ุงููุงุฒูุฉ ูุฅุญุถุงุฑ ุงููุธุงู ุฅูู ุงูุญุงูุฉ ุงููุทููุจุฉ. ูู ูุฐุง ุงูุนูู ููุน ุนูู ุฃูุชุงู ูุญุฏุงุช Ansible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณูุญ ูู Ansible ุจุชุฌููุน ุงูููุงู ุฐุงุช ุงูุตูุฉ ุงูููุทููุฉ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฏูุงุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุซู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงููุง. ุณูุญุชุงุฌ ุฏูุฑูู:</font></font><code>docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ุชุซุจูุช ูุชูููู Docker) ู </font></font><code>analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ุชุซุจูุช ูุชูููู ุงูุชุทุจูู). </font><font style="vertical-align: inherit;">ูุถูู </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏูุฑ</font></font><code>docker</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุณุชูุฏุนูุง ูุน Docker ุฅูู ุงููุธุงู ุ ููููู ุจุชุซุจูุช ูุชูููู ุงูุญุฒู </font></font><code>docker-ce</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุดูู ุงุฎุชูุงุฑู ุ ููููู ุชุนููู REST API ููุงุณุชุฆูุงู ุชููุงุฆููุง ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู. ูุชูุญ ูู Ubuntu ุญู ูุฐู ุงููุดููุฉ ุจูุณุงุนุฏุฉ ูุธุงู ุงูุชููุฆุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>systemd</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูุชุญูู ูู ุงููุญุฏุงุช ุงูุชู ุชูุซู ุงูููุงุฑุฏ ุงููุฎุชููุฉ (ุงูุดูุงุทูู ูุงููุขุฎุฐ ูููุงุท ุงูุชุญููู ูุบูุฑูุง). ูุฅุถุงูุฉ ูุญุฏุฉ ุฌุฏูุฏุฉ ุฅูู systemd ุ ูุฌุจ ุนููู ูุตู ุชูููููุง ูู ููู ุฎุฏูุฉ. ูููุตู ููุถุน ูุฐุง ุงูููู ูู ุฃุญุฏ ุงููุฌูุฏุงุช ุงูุฎุงุตุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู </font></font><code>/etc/systemd/system</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุซู ูููู ุชุดุบูู ุงููุญุฏุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุชูููู ุงูุชุญููู ุงูุชููุงุฆู ููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุตููุฉ</font></font><code>docker-ce</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุซูุงุก ุงูุชุซุจูุช ุ ุณูููู ุชููุงุฆููุง ุจุฅูุดุงุก ููู ุจุชูููู ุงููุญุฏุฉ - ูุง ุนููู ุณูู ุงูุชุฃูุฏ ูู ุชุดุบููู ูุชุดุบููู ุนูุฏ ุจุฏุก ุชุดุบูู ุงููุธุงู. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>  docker-compose@.service</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุชู </font><font style="vertical-align: inherit;">ุฅูุดุงุก Docker </font><font style="vertical-align: inherit;">Compose ุจูุงุณุทุฉ Ansible. </font><font style="vertical-align: inherit;">ูุดูุฑ ุงูุฑูุฒ ุงูููุฌูุฏ </font></font><code>@</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุงุณู ุฅูู systemd ุฃู ุงููุญุฏุฉ ุนุจุงุฑุฉ ุนู ูุงูุจ. </font><font style="vertical-align: inherit;">ูุชูุญ ูู ุฐูู ุจุฏุก ุงูุฎุฏูุฉ </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู ูุนููุฉ - ุนูู ุณุจูู ุงููุซุงู ุ ุจุงุณู ุฎุฏูุชูุง ุ ูุงูุชู ุณูุชู ุงุณุชุจุฏุงููุง ุจุฏูุงู ูู </font></font><code>%i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุชูููู ุงููุญุฏุฉ:</font></font><br>
<br>
<pre><code class="plaintext hljs">[Unit]<font></font>
Description=%i service with docker compose<font></font>
Requires=docker.service<font></font>
After=docker.service<font></font>
<font></font>
[Service]<font></font>
Type=oneshot<font></font>
RemainAfterExit=true<font></font>
WorkingDirectory=/etc/docker/compose/%i<font></font>
ExecStart=/usr/local/bin/docker-compose up -d --remove-orphans<font></font>
ExecStop=/usr/local/bin/docker-compose down<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู ุงูุฏูุฑ</font></font><code>analyzer</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุฅูุดุงุก ููู ูู ุงููุงูุจ </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุนููุงู </font></font><code>/etc/docker/compose/analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุณุฌูู ุงูุชุทุจูู ูุฎุฏูุฉ ูุชู ุชุดุบูููุง ุชููุงุฆููุง </font></font><code>systemd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุทุจูู ุงูุชุฑุญูู. </font><font style="vertical-align: inherit;">ุนูุฏูุง ุชููู ุงูุฃุฏูุงุฑ ุฌุงูุฒุฉ ุ ุชุญุชุงุฌ ุฅูู ูุตู ูุชุงุจ ุงููุนุจ.</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
<font></font>
- name: Gathering facts<font></font>
  hosts: all<font></font>
  become: yes<font></font>
  gather_facts: yes<font></font>
<font></font>
- name: Install docker<font></font>
  hosts: docker<font></font>
  become: yes<font></font>
  gather_facts: no<font></font>
  roles:<font></font>
    - docker<font></font>
<font></font>
- name: Install analyzer<font></font>
  hosts: api<font></font>
  become: yes<font></font>
  gather_facts: no<font></font>
  roles:<font></font>
    - analyzer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุชุญุฏูุฏ ูุงุฆูุฉ ุงููุถูููู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููุชุบูุฑุงุช ุงููุณุชุฎุฏูุฉ ูู ุงูุฃุฏูุงุฑ ุ ูู ููู ุงูุฌุฑุฏ </font></font><code>hosts.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">[api]<font></font>
130.193.51.154<font></font>
<font></font>
[docker:children]<font></font>
api<font></font>
<font></font>
[api:vars]<font></font>
analyzer_image = alvassin/backendschool2019<font></font>
analyzer_pg_user = user<font></font>
analyzer_pg_password = hackme<font></font>
analyzer_pg_dbname = analyzer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฃู ุชุตุจุญ ุฌููุน ุงููููุงุช Ansible ุฌุงูุฒุฉ ุ ูู ุจุชุดุบูููุง:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ ansible-playbook -i hosts.ini deploy.yml</code></pre><br>
<a name="load_testing"></a><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญูู ุงุฎุชุจุงุฑ ุงูุฅุฌูุงุฏ</font></font></b>
                        <div class="spoiler_text">,   ,     .      ,      -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>.     :      ,    โ   ,         10 . ,         (, ,   CI-):           .<br>
<br>
,     ,      ,        10 .   ?  ,          ,   .  ,     ,       .<br>
<br>
          RPS,      :      . ,    ,     <code>import_id</code>,    <code>POST /imports</code>      .      . <br>
<br>
,       Python 3,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Locust</a>. <br>
<br>
   ,      <code>locustfile.py</code>     <code>locust</code>.         -     .<br>
<br>
 Locust   .    ,        .       <br>
 <code>self.round</code>           .<br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    locustfile.py</b>
                        <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># locustfile.py</span>
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> http <span class="hljs-keyword">import</span> HTTPStatus<font></font>
<font></font>
<span class="hljs-keyword">from</span> locust <span class="hljs-keyword">import</span> HttpLocust, constant, task, TaskSet
<span class="hljs-keyword">from</span> locust.exception <span class="hljs-keyword">import</span> RescheduleTask<font></font>
<font></font>
<span class="hljs-keyword">from</span> analyzer.api.handlers <span class="hljs-keyword">import</span> (<font></font>
    CitizenBirthdaysView, CitizensView, CitizenView, TownAgeStatView<font></font>
)<font></font>
<span class="hljs-keyword">from</span> analyzer.utils.testing <span class="hljs-keyword">import</span> generate_citizen, generate_citizens, url_for<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnalyzerTaskSet</span>(<span class="hljs-params">TaskSet</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span><font></font>
        super().__init__(*args, **kwargs)<font></font>
        self.round = <span class="hljs-number">0</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_dataset</span>(<span class="hljs-params">self</span>):</span><font></font>
        citizens = [<font></font>
            <span class="hljs-comment">#     .   </span>
            <span class="hljs-comment"># PATCH-  relatives    </span>
            <span class="hljs-comment"># ,     - </span>
            <span class="hljs-comment"># (     ,    </span>
            <span class="hljs-comment"># ).</span>
            generate_citizen(citizen_id=<span class="hljs-number">1</span>, relatives=[<span class="hljs-number">2</span>]),<font></font>
            generate_citizen(citizen_id=<span class="hljs-number">2</span>, relatives=[<span class="hljs-number">1</span>]),<font></font>
            *generate_citizens(citizens_num=<span class="hljs-number">9998</span>, relations_num=<span class="hljs-number">1000</span>,<font></font>
                               start_citizen_id=<span class="hljs-number">3</span>)<font></font>
        ]<font></font>
        <span class="hljs-keyword">return</span> {citizen[<span class="hljs-string">'citizen_id'</span>]: citizen <span class="hljs-keyword">for</span> citizen <span class="hljs-keyword">in</span> citizens}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">request</span>(<span class="hljs-params">self, method, path, expected_status, **kwargs</span>):</span>
        <span class="hljs-keyword">with</span> self.client.request(<font></font>
                method, path, catch_response=<span class="hljs-literal">True</span>, **kwargs<font></font>
        ) <span class="hljs-keyword">as</span> resp:
            <span class="hljs-keyword">if</span> resp.status_code != expected_status:<font></font>
                resp.failure(<span class="hljs-string">f'expected status <span class="hljs-subst">{expected_status}</span>, '</span>
                             <span class="hljs-string">f'got <span class="hljs-subst">{resp.status_code}</span>'</span>)<font></font>
            logging.info(<font></font>
                <span class="hljs-string">'round %r: %s %s, http status %d (expected %d), took %rs'</span>,<font></font>
                self.round, method, path, resp.status_code, expected_status,<font></font>
                resp.elapsed.total_seconds()<font></font>
            )<font></font>
            <span class="hljs-keyword">return</span> resp<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_import</span>(<span class="hljs-params">self, dataset</span>):</span>
        resp = self.request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'/imports'</span>, HTTPStatus.CREATED,<font></font>
                            json={<span class="hljs-string">'citizens'</span>: list(dataset.values())})
        <span class="hljs-keyword">if</span> resp.status_code != HTTPStatus.CREATED:
            <span class="hljs-keyword">raise</span> RescheduleTask
        <span class="hljs-keyword">return</span> resp.json()[<span class="hljs-string">'data'</span>][<span class="hljs-string">'import_id'</span>]<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_citizens</span>(<span class="hljs-params">self, import_id</span>):</span><font></font>
        url = url_for(CitizensView.URL_PATH, import_id=import_id)<font></font>
        self.request(<span class="hljs-string">'GET'</span>, url, HTTPStatus.OK,<font></font>
                     name=<span class="hljs-string">'/imports/{import_id}/citizens'</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_citizen</span>(<span class="hljs-params">self, import_id</span>):</span>
        url = url_for(CitizenView.URL_PATH, import_id=import_id, citizen_id=<span class="hljs-number">1</span>)<font></font>
        self.request(<span class="hljs-string">'PATCH'</span>, url, HTTPStatus.OK,<font></font>
                     name=<span class="hljs-string">'/imports/{import_id}/citizens/{citizen_id}'</span>,<font></font>
                     json={<span class="hljs-string">'relatives'</span>: [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>)]})<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_birthdays</span>(<span class="hljs-params">self, import_id</span>):</span><font></font>
        url = url_for(CitizenBirthdaysView.URL_PATH, import_id=import_id)<font></font>
        self.request(<span class="hljs-string">'GET'</span>, url, HTTPStatus.OK,<font></font>
                     name=<span class="hljs-string">'/imports/{import_id}/citizens/birthdays'</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_town_stats</span>(<span class="hljs-params">self, import_id</span>):</span><font></font>
        url = url_for(TownAgeStatView.URL_PATH, import_id=import_id)<font></font>
        self.request(<span class="hljs-string">'GET'</span>, url, HTTPStatus.OK,<font></font>
                     name=<span class="hljs-string">'/imports/{import_id}/towns/stat/percentile/age'</span>)<font></font>
<font></font>
<span class="hljs-meta">    @task</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">workflow</span>(<span class="hljs-params">self</span>):</span>
        self.round += <span class="hljs-number">1</span><font></font>
        dataset = self.make_dataset()<font></font>
<font></font>
        import_id = self.create_import(dataset)<font></font>
        self.get_citizens(import_id)<font></font>
        self.update_citizen(import_id)<font></font>
        self.get_birthdays(import_id)<font></font>
        self.get_town_stats(import_id)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebsiteUser</span>(<span class="hljs-params">HttpLocust</span>):</span><font></font>
    task_set = AnalyzerTaskSet<font></font>
    wait_time = constant(<span class="hljs-number">1</span>)</code></pre></div>
                    </div><br>
 100  c  ,  ,        :<br>
<br>
<img src="https://habrastorage.org/webt/qx/ri/b3/qxrib3jily9gzmexxhupu35tipa.png"><br>
<br>
       ,           ( โ 95 ,  โ ).        .<br>
<br>
<img src="https://habrastorage.org/webt/dn/px/fn/dnpxfn5ly7vttziqnnfpvvdsl9g.png"><br>
<br>
      โ     Ansible       ~20.15  ~20.30    Locust.<br>
<br>
<img src="https://habrastorage.org/webt/om/1e/ok/om1eoknqvzqmyez-plpgykhz8io.png"></div>
                    </div><br>
<a name="whatelse"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุงูุฐู ูููู ูุนูู ุฃูุถูุงุ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุธูุฑ ุงูููู ุงูุดุฎุตู ููุชุทุจูู ุฃู ุญูุงูู ุฑุจุน ุฅุฌูุงูู ููุช ุชูููุฐ ุทูุจ ุงูุจุญุซ ูุชู ุฅููุงูู ุนูู ุชุณูุณู JSON ูุฅูุบุงุก ุชุณูุณูู: ููุงู ุงููุซูุฑ ูู ุงูุจูุงูุงุช ุงููุฑุณูุฉ ูุงููุณุชููุฉ ูู ุงูุฎุฏูุฉ. </font><font style="vertical-align: inherit;">ูููู ุชุณุฑูุน ูุฐู ุงูุนูููุงุช ุจุดูู ูุจูุฑ ุจุงุณุชุฎุฏุงู ููุชุจุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">orjson</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูููู ูุฌุจ ุชุญุถูุฑ ุงูุฎุฏูุฉ ููููุงู - </font></font><code>orjson</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ููุณุช ุจุฏููุงู ุนู ุงููุญุฏุฉ ุงูููุทูุฉ ุงูููุงุณูุฉ. </font></font><code>json</code> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนุงุฏุฉู ุ ูุชุทูุจ ุงูุฅูุชุงุฌ ุนุฏุฉ ูุณุฎ ูู ุงูุฎุฏูุฉ ูุถูุงู ุชุญูู ุงูุฎุทุฃ ูุงูุชุนุงูู ูุน ุงูุญูู. </font><font style="vertical-align: inherit;">ูุฅุฏุงุฑุฉ ูุฌููุนุฉ ูู ุงูุฎุฏูุงุช ุ ุชุญุชุงุฌ ุฅูู ุฃุฏุงุฉ ุชูุถุญ ูุง ุฅุฐุง ูุงูุช ูุณุฎุฉ ุงูุฎุฏูุฉ "ุญูุฉ" ุฃู ูุง. </font><font style="vertical-align: inherit;">ูููู ุญู ูุฐู ุงููุดููุฉ ุนู ุทุฑูู ูุนุงูุฌ ูููู </font></font><code>/health</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุณุชูุตุงุก ุฌููุน ุงูููุงุฑุฏ ุงููุทููุจุฉ ููุนูู ุ ูู ุญุงูุชูุง ุ ูุงุนุฏุฉ ุจูุงูุงุช. </font><font style="vertical-align: inherit;">ุฅุฐุง</font></font><code>SELECT 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุชูููุฐูุง ูู ุฃูู ูู ุซุงููุฉ ุ ุชููู ุงูุฎุฏูุฉ ุนูู ููุฏ ุงูุญูุงุฉ. ุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุงูุงูุชุจุงู ุฅููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูุนูู ุงูุชุทุจูู ุจุดูู ููุซู ููุบุงูุฉ ูุน ุดุจูุฉ ุ </font><font style="vertical-align: inherit;">ูููู ุฃู ูุฒูุฏ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uvloop</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฃุฏุงุก </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุจุจุฑูุฏุฉ</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนุงูู ููู ูู ุณูููุฉ ูุฑุงุกุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ. ูุชุจ ุฃุญุฏ ุฒููุงุฆู ุ ููุฑู ุดููุงููู ุ ูุญุฏุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุงุฏูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฌูุน ุจูู ุนุฏุฉ ุฃุฏูุงุช </font><font style="vertical-align: inherit;">ููุชุญูู ุงูุชููุงุฆู ูุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูุงูุชู ูู ุงูุณูู ุฅุถุงูุชูุง ุฅูู </font></font><code>pre-commit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุจุท Git ุ ูุงูุชู ุชู ุฅุนุฏุงุฏูุง ุจููู ุชูููู ูุงุญุฏ ุฃู ูุชุบูุฑุงุช ุจูุฆุฉ. ูุณูุญ ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฑูุงุฏู ุจูุฑุฒ ุนูููุงุช ุงูุงุณุชูุฑุงุฏ ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุงูุชุตููู</font></a><font style="vertical-align: inherit;"> ) ุ ูุชุญุณูู ุชุนุจูุฑุงุช python ููููุง ููุฅุตุฏุงุฑุงุช ุงูุฌุฏูุฏุฉ ูู ุงููุบุฉ ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyupgrade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ุ ูุฅุถุงูุฉ ููุงุตู ูู ููุงูุฉ ุงุณุชุฏุนุงุกุงุช ุงููุธุงุฆู ุ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ูุนูููุงุช</font></a><font style="vertical-align: inherit;"> ุงูุงุณุชูุฑุงุฏ ุ ูุงูููุงุฆู ุ ููุง ุฅูู ุฐูู (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add-trailing-comma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ุ ูุฃูุถูุง ุงูุชุจุงุณุงุช ุฅูู ูููุฐุฌ ูุงุญุฏ ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุญูุฏ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<a name="final"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* * *</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูู ุดูุก ุจุงููุณุจุฉ ูู: ููุฏ ูููุง ุจุชุทููุฑ ุงูุฎุฏูุฉ ูุชุบุทูุชูุง ูุชุฌููุนูุง ููุดุฑูุง ุ ููุง ุฃุฌุฑููุง ุงุฎุชุจุงุฑ ุงูุญูู.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดูุฑ ูุชูุฏูุฑ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃูุฏ ุฃู ุฃุนุจุฑ ุนู ุงูุชูุงูู ุงูุนููู ููุฑุฌุงู ุงูุฐูู ูุถูุง ููุชูุง ูู ูุชุงุจุฉ ูุฐุง ุงูููุงู ุ ููุฑุงุฌุนุฉ ุงูููุฏ ุ ูุชูุฏูู ุฃููุงุฑู ูุชุนูููุงุชู: ุฅูู Maria Zelenova </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฒูููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุงุฏูููุฑ ุณููููุงุชูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฑ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุฃูุงุณุชุงุณูุง ุณููููููุง </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฑููู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฑู ุดููุงููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dizballanze</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฎุงุฆูู ุดูุดุจุงููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mishush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููู ููุณูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pavkazzz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฎุงุตุฉ ุฏููุชุฑู ุฃูุฑููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">orlovdl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar499518/index.html">ูุคุชูุฑุงุช ุงูููุฏูู ูู ุงูุขู ุณูู ูุชูููุงุช ุฌุฏูุฏุฉ. Longrid ุ ุงูุฌุฒุก ุงูุฃูู</a></li>
<li><a href="../ar499522/index.html">ุฌููุน ุงุจุชูุงุฑุงุช Windows 10 2004 (20H1)</a></li>
<li><a href="../ar499524/index.html">Quarkus: ุชุฑููุงุช ุงูุชุทุจูู ุจุงุณุชุฎุฏุงู ูุซุงู helloworld ูู JBoss EAP Quickstart</a></li>
<li><a href="../ar499528/index.html">ุฌุณุฑ ุฑูุงุถู "ูุฐูู" ููุชุฏ ุฅูู ูุง ูุฑุงุก ูุธุฑูุฉ ููุฑูุง ุงูุนุธููุฉ</a></li>
<li><a href="../ar499532/index.html">ุงููููุงุช ุจุงูุฃุฑูุงู: ุชุญูููุงุช ูุฏููุฉ ูุฌุงููุฉ habravebinary ูุน Yandex.Metrica</a></li>
<li><a href="../ar499536/index.html">Growbox ูุทุฑููุฉ ููุนุฑูุฉ ุงูุฐุงุช</a></li>
<li><a href="../ar499540/index.html">ููู ูุนูู ุนุฑุถ ุงูุฃูุนุงุจ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ: ุงูุชุฑููุจ ูุชุตููุฉ ุงููุณูุฌ</a></li>
<li><a href="../ar499542/index.html">ุฃุนูู Fakapov ุณูุงูู</a></li>
<li><a href="../ar499544/index.html">ุชุนูู ุงูุดุจูุงุช ุงูุนุตุจูุฉ ูู ุฌุฏุงูู ุจูุงูุงุช Google</a></li>
<li><a href="../ar499546/index.html">ุชุทููุฑ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ููุงููุฑุง ููุฏูู ุชูุงุธุฑูุฉ EVR-Y2022F</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>